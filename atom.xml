<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£˜é€¸å³°çš„åšå®¢</title>
  
  <subtitle>Spring--Javaç¨‹åºå‘˜çš„æ˜¥å¤©</subtitle>
  <link href="https://blog.hanqunfeng.com/atom.xml" rel="self"/>
  
  <link href="https://blog.hanqunfeng.com/"/>
  <updated>2025-07-25T14:23:18.456Z</updated>
  <id>https://blog.hanqunfeng.com/</id>
  
  <author>
    <name>é£˜é€¸å³°</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>K8S UI ä¹‹ Rancher</title>
    <link href="https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/"/>
    <id>https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/</id>
    <published>2025-07-25T14:33:05.000Z</published>
    <updated>2025-07-25T14:23:18.456Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://ranchermanager.docs.rancher.com/zh/">Rancher å®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/rancher/rancher">Rancher Github</a></p></li></ul><span id="more"></span><h2 id="Rancher-ç®€ä»‹">Rancher ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Rancher æ˜¯ä¸€ä¸ª å¼€æºçš„ Kubernetes ç®¡ç†å¹³å°ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·éƒ¨ç½²ã€ç®¡ç†å’Œè¿ç»´å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œå…·æœ‰æ˜“ç”¨çš„ Web UIã€æƒé™æ§åˆ¶ã€é›†ç¾¤ç›‘æ§ã€åº”ç”¨ç®¡ç†ç­‰åŠŸèƒ½ï¼Œå¹¿æ³›åº”ç”¨äºä¼ä¸šçš„äº‘åŸç”Ÿå¹³å°å»ºè®¾ä¸­ã€‚</p></li></ul><h2 id="éƒ¨ç½²-Rancher">éƒ¨ç½² Rancher</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://ranchermanager.docs.rancher.com/zh/getting-started/quick-start-guides/deploy-rancher-manager/helm-cli#%E4%BD%BF%E7%94%A8-helm-%E6%9D%A5%E5%AE%89%E8%A3%85-rancher">ä½¿ç”¨ Helm å®‰è£… Rancher</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  rancher çš„ Helm ä»“åº“</span></span><br><span class="line">helm repo add rancher-latest https://releases.rancher.com/server-charts/latest</span><br><span class="line"><span class="comment"># æ›´æ–° rancher çš„ Helm ä»“åº“</span></span><br><span class="line">helm repo update</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ rancher çš„ç‰ˆæœ¬</span></span><br><span class="line">$ helm search repo rancher -l | <span class="built_in">head</span></span><br><span class="line">NAME                  CHART VERSIONAPP VERSIONDESCRIPTION</span><br><span class="line">rancher-latest/rancher2.11.3       v2.11.3    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.11.2       v2.11.2    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.11.1       v2.11.1    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.11.0       v2.11.0    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.3       v2.10.3    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.2       v2.10.2    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.1       v2.10.1    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.0       v2.10.0    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.9.3        v2.9.3     Install Rancher Server to manage Kubernetes clu...</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">kubectl create namespace cattle-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¯ä¹¦ï¼Œè¯ä¹¦æ˜¯æœºæ„é¢å‘çš„</span></span><br><span class="line">kubectl create secret tls tls-rancher-ingress \</span><br><span class="line">  --key=nginx_ssl/nginx.hanqunfeng.com.key \</span><br><span class="line">  --cert=nginx_ssl/nginx.hanqunfeng.com.pem \</span><br><span class="line">  -n cattle-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Rancher  --version v2.11.3 å¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼Œé»˜è®¤æœ€æ–°ç‰ˆ</span></span><br><span class="line">helm install rancher rancher-latest/rancher \</span><br><span class="line">  --namespace cattle-system \</span><br><span class="line">  --create-namespace \</span><br><span class="line">  --<span class="built_in">set</span> hostname=rancher.hanqunfeng.com \</span><br><span class="line">  --<span class="built_in">set</span> ingress.tls.source=secret \</span><br><span class="line">  --<span class="built_in">set</span> replicas=3 \</span><br><span class="line">  --<span class="built_in">set</span> bootstrapPassword=rancher#2025</span><br><span class="line"></span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># --set hostname=rancher.hanqunfeng.com è®¾ç½® rancher çš„åŸŸå</span></span><br><span class="line"><span class="comment"># --set ingress.tls.source=secret é…ç½® rancher çš„è¯ä¹¦ï¼Œåç§°ä¸º tls-rancher-ingress</span></span><br><span class="line"><span class="comment"># --set replicas=3 è®¾ç½® rancher çš„å‰¯æœ¬æ•°</span></span><br><span class="line"><span class="comment"># --set bootstrapPassword=rancher#2025 è®¾ç½® rancher çš„åˆå§‹å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ä¸è¿‡æ‰§è¡Œä¸Šé¢çš„å®‰è£…å‘½ä»¤ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯å½“å‰çš„ rancher ç‰ˆæœ¬ä¸æ”¯æŒ Kubernetes v1.33.2</span></span><br><span class="line">Error: INSTALLATION FAILED: chart requires kubeVersion: &lt; 1.33.0-0 <span class="built_in">which</span> is incompatible with Kubernetes v1.33.2</span><br><span class="line"></span><br><span class="line"><span class="comment">## è§£å†³åŠæ³•</span></span><br><span class="line"><span class="comment"># ä¸‹è½½å¹¶è§£å‹ rancher å®‰è£…åŒ…</span></span><br><span class="line">helm pull rancher-latest/rancher --untar --untardir ./</span><br><span class="line"><span class="comment"># ä¿®æ”¹å…¶ä¸­çš„ Chart.yaml æ–‡ä»¶</span></span><br><span class="line">kubeVersion: &lt; 1.33.0-0 ==&gt; kubeVersion: &lt; 1.34.0-0</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… rancher</span></span><br><span class="line">helm install rancher rancher \</span><br><span class="line">  --namespace cattle-system \</span><br><span class="line">  --create-namespace \</span><br><span class="line">  --<span class="built_in">set</span> hostname=rancher.hanqunfeng.com \</span><br><span class="line">  --<span class="built_in">set</span> ingress.tls.source=secret \</span><br><span class="line">  --<span class="built_in">set</span> replicas=3 \</span><br><span class="line">  --<span class="built_in">set</span> bootstrapPassword=rancher#2025</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">NAME: rancher</span><br><span class="line">LAST DEPLOYED: Thu Jul 24 23:55:24 2025</span><br><span class="line">NAMESPACE: cattle-system</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">Rancher Server has been installed.</span><br><span class="line"></span><br><span class="line">NOTE: Rancher may take several minutes to fully initialize. Please standby <span class="keyword">while</span> Certificates are being issued, Containers are started and the Ingress rule comes up.</span><br><span class="line"></span><br><span class="line">Check out our docs at https://rancher.com/docs/</span><br><span class="line"></span><br><span class="line">If you provided your own bootstrap password during installation, browse to https://rancher.hanqunfeng.com to get started.</span><br><span class="line"></span><br><span class="line">If this is the first time you installed Rancher, get started by running this <span class="built_in">command</span> and clicking the URL it generates:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> https://rancher.hanqunfeng.com/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class="string">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">To get just the bootstrap password on its own, run:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class="string">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123; &quot;\n&quot; &#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Happy Containering!</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹åˆ›å»ºçš„èµ„æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ k get all,ing -n cattle-system</span><br><span class="line">NAME                                   READY   STATUS      RESTARTS   AGE</span><br><span class="line">pod/helm-operation-8257k               0/2     Completed   0          11m</span><br><span class="line">pod/helm-operation-g8blp               0/2     Completed   0          12m</span><br><span class="line">pod/helm-operation-hwpbp               0/2     Completed   0          10m</span><br><span class="line">pod/helm-operation-qbs5n               0/2     Completed   0          10m</span><br><span class="line">pod/helm-operation-wlptb               0/2     Completed   0          13m</span><br><span class="line">pod/rancher-56689b7d8c-v7hpd           1/1     Running     0          21m</span><br><span class="line">pod/rancher-56689b7d8c-xnrbf           1/1     Running     0          21m</span><br><span class="line">pod/rancher-56689b7d8c-xvqgs           1/1     Running     0          21m</span><br><span class="line">pod/rancher-webhook-5fd5fc44f9-8xwjk   1/1     Running     0          11m</span><br><span class="line"></span><br><span class="line">NAME                               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">service/imperative-api-extension   ClusterIP   10.96.188.28   &lt;none&gt;        6666/TCP         15m</span><br><span class="line">service/rancher                    ClusterIP   10.96.21.41    &lt;none&gt;        80/TCP,443/TCP   21m</span><br><span class="line">service/rancher-webhook            ClusterIP   10.96.85.153   &lt;none&gt;        443/TCP          11m</span><br><span class="line"></span><br><span class="line">NAME                              READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/rancher           3/3     3            3           21m</span><br><span class="line">deployment.apps/rancher-webhook   1/1     1            1           11m</span><br><span class="line"></span><br><span class="line">NAME                                         DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/rancher-56689b7d8c           3         3         3       21m</span><br><span class="line">replicaset.apps/rancher-webhook-5fd5fc44f9   1         1         1       11m</span><br><span class="line"></span><br><span class="line">NAME                                CLASS   HOSTS                    ADDRESS         PORTS     AGE</span><br><span class="line">ingress.networking.k8s.io/rancher   nginx   rancher.hanqunfeng.com   10.211.55.201   80, 443   21m</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµè§ˆå™¨è®¿é—®ï¼š<a href="https://rancher.hanqunfeng.com">https://rancher.hanqunfeng.com</a>ï¼Œè¾“å…¥ä¸Šé¢è®¾ç½®çš„å¯†ç å³å¯ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœå¿˜è®°åˆå§‹å¯†ç å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯†ç </span></span><br><span class="line">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class="string">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123;&quot;\n&quot;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/rHDDMN.png" alt=""></p><h2 id="å¸è½½-Rancher">å¸è½½ Rancher</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸è½½ Rancher</span></span><br><span class="line">helm uninstall rancher -n cattle-system</span><br><span class="line"><span class="comment"># åˆ é™¤ cattle-system å‘½åç©ºé—´</span></span><br><span class="line">kubectl delete namespace cattle-system</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://ranchermanager.docs.rancher.com/zh/&quot;&gt;Rancher å®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/rancher/rancher&quot;&gt;Rancher Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S UI ä¹‹ Kubesphere</title>
    <link href="https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/"/>
    <id>https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/</id>
    <published>2025-07-24T14:33:05.000Z</published>
    <updated>2025-07-24T13:38:25.076Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubesphere.io/zh/">Kubesphere å®˜ç½‘</a></p></li></ul><span id="more"></span><h2 id="Kubesphere-ç®€ä»‹">Kubesphere ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>KubeSphere æ˜¯ä¸€ä¸ªåŸºäº Kubernetes æ„å»ºçš„ ä¼ä¸šçº§å¤šç§Ÿæˆ·å®¹å™¨ç®¡ç†å¹³å°ï¼Œæä¾›äº†ä¸€å¥—å®Œæ•´çš„å®¹å™¨å¹³å°è§£å†³æ–¹æ¡ˆï¼Œè®©ç”¨æˆ·ä»¥å›¾å½¢åŒ–æ–¹å¼è½»æ¾ä½¿ç”¨ Kubernetes å’Œ DevOps èƒ½åŠ›ï¼Œä¸éœ€è¦æ·±å…¥ç†è§£å¤æ‚çš„åº•å±‚æ¶æ„ã€‚</p></li><li class="lvl-2"><p>ä¸ K8S çš„ Dashboard ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p></li></ul><table><thead><tr><th>åŠŸèƒ½ / ç‰¹æ€§</th><th>Kubernetes Dashboard</th><th><strong>KubeSphere</strong></th></tr></thead><tbody><tr><td>âœ… åŸºç¡€èµ„æºç®¡ç†</td><td>âœ… æ”¯æŒ</td><td>âœ… æ›´ä¸°å¯Œï¼Œæ”¯æŒæ›´å¤šç»†ç²’åº¦æ§åˆ¶</td></tr><tr><td>ğŸ‘¥ å¤šç§Ÿæˆ·æ”¯æŒ</td><td>âŒ æ— </td><td>âœ… å†…å»ºä¼ä¸šçº§å¤šç§Ÿæˆ·ã€ç©ºé—´ï¼ˆWorkspaceï¼‰éš”ç¦»</td></tr><tr><td>ğŸ” èº«ä»½è®¤è¯ä¸æƒé™æ§åˆ¶</td><td>âš ï¸ éœ€æ‰‹åŠ¨æ•´åˆ RBAC</td><td>âœ… å†…å»ºç”¨æˆ·ç®¡ç†ã€è§’è‰²ã€å›¢é˜Ÿã€ä¼ä¸šç»„ç»‡æ¶æ„</td></tr><tr><td>ğŸŒ å¤šé›†ç¾¤æ”¯æŒ</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒè·¨åŒºåŸŸå¤šé›†ç¾¤ç»Ÿä¸€ç®¡ç†</td></tr><tr><td>ğŸš€ DevOpsï¼ˆCI/CD æµæ°´çº¿ï¼‰</td><td>âŒ æ— </td><td>âœ… å†…ç½®å›¾å½¢åŒ–æµæ°´çº¿ï¼ˆJenkins é©±åŠ¨ï¼‰</td></tr><tr><td>ğŸ“Š ç›‘æ§ä¸æŒ‡æ ‡ï¼ˆPrometheusï¼‰</td><td>âŒ æ‰‹åŠ¨å®‰è£…</td><td>âœ… å†…ç½®ï¼Œå›¾å½¢åŒ–å±•ç¤º Pod/Node/æœåŠ¡ç­‰ç›‘æ§æ•°æ®</td></tr><tr><td>ğŸ“ æ—¥å¿—æŸ¥è¯¢ä¸åˆ†æï¼ˆEFKï¼‰</td><td>âŒ æ— </td><td>âœ… å†…å»º Fluent Bit + Elasticsearch + Kibana</td></tr><tr><td>ğŸ’¡ å¾®æœåŠ¡æ²»ç†ï¼ˆIstioï¼‰</td><td>âŒ æ— </td><td>âœ… å¯é€‰å¯ç”¨ï¼Œæ”¯æŒæœåŠ¡æ‹“æ‰‘ã€ç°åº¦å‘å¸ƒã€æµé‡æ²»ç†ç­‰</td></tr><tr><td>ğŸ§° åº”ç”¨å•†åº—ï¼ˆHelm å¯è§†åŒ–éƒ¨ç½²ï¼‰</td><td>âŒ æ— </td><td>âœ… æ”¯æŒ Helm åº”ç”¨å¸‚åœºï¼Œç‚¹å‡»å³å¯å®‰è£…å¸¸è§ä¸­é—´ä»¶</td></tr><tr><td>ğŸ”Œ æ’ä»¶æ¶æ„</td><td>âŒ æ— </td><td>âœ… æ”¯æŒæ¨¡å—æŒ‰éœ€å¯ç”¨/å…³é—­</td></tr><tr><td>ğŸ§ª å®¹å™¨é•œåƒä»“åº“ï¼ˆHarborï¼‰</td><td>âŒ æ— </td><td>âœ… å¯é›†æˆæˆ–å†…å»º Harbor å®¹å™¨ä»“åº“</td></tr><tr><td>ğŸ“¦ å®‰è£…å¤æ‚åº¦</td><td>âœ… ç®€å•</td><td>âš ï¸ ç•¥å¤æ‚ï¼Œä½†å¯æŒ‰éœ€å¯ç”¨æ¨¡å—</td></tr></tbody></table><h2 id="éƒ¨ç½²-Kubesphere">éƒ¨ç½² Kubesphere</h2><ul class="lvl-0"><li class="lvl-2"><p>Kubesphere å¯¹ç³»ç»Ÿèµ„æºæœ‰æœ€ä½è¦æ±‚ï¼Œå…·ä½“å‚è€ƒ<a href="https://kubesphere.io/zh/docs/v4.1/03-installation-and-upgrade/01-preparations/01-supported-k8s/">å®˜ç½‘:ç¯å¢ƒè¦æ±‚</a></p></li><li class="lvl-2"><p>éƒ¨ç½²</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæ— æ³•è®¿é—® charts.kubesphere.io, å¯å°† charts.kubesphere.io æ›¿æ¢ä¸º charts.kubesphere.com.cn</span></span><br><span class="line">helm upgrade --install -n kubesphere-system --create-namespace ks-core https://charts.kubesphere.io/main/ks-core-1.1.4.tgz --debug --<span class="built_in">wait</span></span><br><span class="line"><span class="comment">## å®‰è£…æˆåŠŸåä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</span></span><br><span class="line">NOTES:</span><br><span class="line">Thank you <span class="keyword">for</span> choosing KubeSphere Helm Chart.</span><br><span class="line"></span><br><span class="line">Please be patient and <span class="built_in">wait</span> <span class="keyword">for</span> several seconds <span class="keyword">for</span> the KubeSphere deployment to complete.</span><br><span class="line"></span><br><span class="line">1. Wait <span class="keyword">for</span> Deployment Completion</span><br><span class="line"></span><br><span class="line">    Confirm that all KubeSphere components are running by executing the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    kubectl get pods -n kubesphere-system</span><br><span class="line">2. Access the KubeSphere Console</span><br><span class="line"></span><br><span class="line">    Once the deployment is complete, you can access the KubeSphere console using the following URL:</span><br><span class="line"></span><br><span class="line">    http://10.211.55.11:30880</span><br><span class="line"></span><br><span class="line">3. Login to KubeSphere Console</span><br><span class="line"></span><br><span class="line">    Use the following credentials to <span class="built_in">log</span> <span class="keyword">in</span>:</span><br><span class="line"></span><br><span class="line">    Account: admin</span><br><span class="line">    Password: P@88w0rd</span><br><span class="line"></span><br><span class="line">NOTE: It is highly recommended to change the default password immediately after the first login.</span><br><span class="line">For additional information and details, please visit https://kubesphere.io.</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶</span></span><br><span class="line">$ kubectl get pod,deploy,svc -n kubesphere-system</span><br><span class="line">NAME                                         READY   STATUS    RESTARTS       AGE</span><br><span class="line">pod/extensions-museum-ffd8bd9d8-fvcw4        1/1     Running   1 (28m ago)    5h5m</span><br><span class="line">pod/ks-apiserver-7b4479d5f5-2k4c9            1/1     Running   2 (27m ago)    5h5m</span><br><span class="line">pod/ks-console-6bd9b9f5d9-xqlzs              1/1     Running   0              26m</span><br><span class="line">pod/ks-controller-manager-547f9fc8c9-5b88z   1/1     Running   10 (27m ago)   5h5m</span><br><span class="line"></span><br><span class="line">NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/extensions-museum       1/1     1            1           5h14m</span><br><span class="line">deployment.apps/ks-apiserver            1/1     1            1           5h14m</span><br><span class="line">deployment.apps/ks-console              1/1     1            1           5h14m</span><br><span class="line">deployment.apps/ks-controller-manager   1/1     1            1           5h14m</span><br><span class="line"></span><br><span class="line">NAME                            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">service/extensions-museum       ClusterIP   10.96.95.71    &lt;none&gt;        443/TCP        5h14m</span><br><span class="line">service/ks-apiserver            ClusterIP   10.96.12.106   &lt;none&gt;        80/TCP         5h14m</span><br><span class="line">service/ks-console              NodePort    10.96.55.165   &lt;none&gt;        80:30880/TCP   5h14m</span><br><span class="line">service/ks-controller-manager   ClusterIP   10.96.13.243   &lt;none&gt;        443/TCP        5h14m</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµè§ˆå™¨è®¿é—®ï¼š<a href="http://10.211.55.11:30880">http://10.211.55.11:30880</a>ï¼Œè¾“å…¥è´¦å·å¯†ç ï¼šadmin/P@88w0rdï¼Œé¦–æ¬¡ç™»å½•éœ€è¦ä¿®æ”¹å¯†ç ã€‚</p></li></ul><h2 id="é…ç½®-ingress">é…ç½® ingress</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºè¯ä¹¦</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret tls nginx-tls \</span><br><span class="line">    --key=nginx_ssl/nginx.hanqunfeng.com.key \</span><br><span class="line">    --cert=nginx_ssl/nginx.hanqunfeng.com.pem \</span><br><span class="line">    -n kubesphere-system</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º ingress</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubesphere-ingress.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubesphere-nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubesphere-system</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kubesphere.hanqunfeng.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">nginx-tls</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">kubesphere.hanqunfeng.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">ks-console</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h2 id="å¸è½½-Kubesphere">å¸è½½ Kubesphere</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm uninstall ks-core -n kubesphere-system</span><br><span class="line">kubectl delete namespace kubesphere-system</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubesphere.io/zh/&quot;&gt;Kubesphere å®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S UI ä¹‹ Dashboard</title>
    <link href="https://blog.hanqunfeng.com/2025/07/24/k8s-ui-dashboard/"/>
    <id>https://blog.hanqunfeng.com/2025/07/24/k8s-ui-dashboard/</id>
    <published>2025-07-24T13:33:05.000Z</published>
    <updated>2025-07-24T13:37:46.313Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/">Dashboard k8sä»‹ç»</a></p></li></ul><span id="more"></span><h2 id="Dashboard-ç®€ä»‹">Dashboard ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Dashboard æ˜¯åŸºäºç½‘é¡µçš„ Kubernetes ç”¨æˆ·ç•Œé¢ã€‚</p></li><li class="lvl-2"><p>ä½ å¯ä»¥ä½¿ç”¨ Dashboard å°†å®¹å™¨åº”ç”¨éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œä¹Ÿå¯ä»¥å¯¹å®¹å™¨åº”ç”¨æ’é”™ï¼Œè¿˜èƒ½ç®¡ç†é›†ç¾¤èµ„æºã€‚</p></li><li class="lvl-2"><p>ä½ å¯ä»¥ä½¿ç”¨ Dashboard è·å–è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„åº”ç”¨çš„æ¦‚è§ˆä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæˆ–è€…ä¿®æ”¹ Kubernetes èµ„æº ï¼ˆå¦‚ Deploymentã€Jobã€DaemonSet ç­‰ç­‰ï¼‰ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥å¯¹ Deployment å®ç°å¼¹æ€§ä¼¸ç¼©ã€å‘èµ·æ»šåŠ¨å‡çº§ã€é‡å¯ Pod æˆ–è€…ä½¿ç”¨å‘å¯¼åˆ›å»ºæ–°çš„åº”ç”¨ã€‚</p></li><li class="lvl-2"><p>Dashboard åŒæ—¶å±•ç¤ºäº† Kubernetes é›†ç¾¤ä¸­çš„èµ„æºçŠ¶æ€ä¿¡æ¯å’Œæ‰€æœ‰æŠ¥é”™ä¿¡æ¯ã€‚</p></li></ul><h2 id="éƒ¨ç½²-Dashboard">éƒ¨ç½² Dashboard</h2><ul class="lvl-0"><li class="lvl-2"><p>Kubernetes Dashboard ç›®å‰ä»…æ”¯æŒåŸºäº Helm çš„å®‰è£…ï¼Œå› ä¸ºå®ƒé€Ÿåº¦æ›´å¿«ï¼Œ å¹¶ä¸”å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°æ§åˆ¶ Dashboard è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  kubernetes-dashboard ä»“åº“</span></span><br><span class="line">helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/</span><br><span class="line"><span class="comment"># ä½¿ç”¨ kubernetes-dashboard Chart éƒ¨ç½²åä¸º `kubernetes-dashboard` çš„ Helm Release</span></span><br><span class="line">$ helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \</span><br><span class="line">    --create-namespace \</span><br><span class="line">    --namespace kubernetes-dashboard</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Release <span class="string">&quot;kubernetes-dashboard&quot;</span> does not exist. Installing it now.</span><br><span class="line">NAME: kubernetes-dashboard</span><br><span class="line">LAST DEPLOYED: Sun Jul  6 00:40:02 2025</span><br><span class="line">NAMESPACE: kubernetes-dashboard</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">*************************************************************************************************</span><br><span class="line">*** PLEASE BE PATIENT: Kubernetes Dashboard may need a few minutes to get up and become ready ***</span><br><span class="line">*************************************************************************************************</span><br><span class="line"></span><br><span class="line">Congratulations! You have just installed Kubernetes Dashboard <span class="keyword">in</span> your cluster.</span><br><span class="line"></span><br><span class="line">To access Dashboard run:</span><br><span class="line">  kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443</span><br><span class="line"></span><br><span class="line">NOTE: In <span class="keyword">case</span> port-forward <span class="built_in">command</span> does not work, make sure that kong service name is correct.</span><br><span class="line">      Check the services <span class="keyword">in</span> Kubernetes Dashboard namespace using:</span><br><span class="line">        kubectl -n kubernetes-dashboard get svc</span><br><span class="line"></span><br><span class="line">Dashboard will be available at:</span><br><span class="line">  https://localhost:8443</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ helm å®‰è£…çš„åŒ…ï¼Œæ³¨æ„æŒ‡å®š å‘½åç©ºé—´</span></span><br><span class="line">$ helm list -n kubernetes-dashboard</span><br><span class="line">NAME                NAMESPACE           REVISIONUPDATED                                STATUS  CHART                      APP VERSION</span><br><span class="line">kubernetes-dashboardkubernetes-dashboard1       2025-07-24 14:01:06.678570212 +0800 CSTdeployedkubernetes-dashboard-7.13.0</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å¯åŠ¨çš„èµ„æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n kubernetes-dashboard get all</span><br><span class="line">NAME                                                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/kubernetes-dashboard-api-568f47ddd7-tx6f8              1/1     Running   0          20m</span><br><span class="line">pod/kubernetes-dashboard-auth-645b944589-t6v2m             1/1     Running   0          20m</span><br><span class="line">pod/kubernetes-dashboard-kong-648658d45f-7qsm9             1/1     Running   0          20m</span><br><span class="line">pod/kubernetes-dashboard-metrics-scraper-547874fcf-87mrv   1/1     Running   0          20m</span><br><span class="line">pod/kubernetes-dashboard-web-7796b9fbbb-xsdlw              1/1     Running   0          20m</span><br><span class="line"></span><br><span class="line">NAME                                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">service/kubernetes-dashboard-api               ClusterIP   10.96.149.59    &lt;none&gt;        8000/TCP   20m</span><br><span class="line">service/kubernetes-dashboard-auth              ClusterIP   10.96.145.120   &lt;none&gt;        8000/TCP   20m</span><br><span class="line">service/kubernetes-dashboard-kong-proxy        ClusterIP   10.96.171.40    &lt;none&gt;        443/TCP    20m</span><br><span class="line">service/kubernetes-dashboard-metrics-scraper   ClusterIP   10.96.79.48     &lt;none&gt;        8000/TCP   20m</span><br><span class="line">service/kubernetes-dashboard-web               ClusterIP   10.96.247.143   &lt;none&gt;        8000/TCP   20m</span><br><span class="line"></span><br><span class="line">NAME                                                   READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/kubernetes-dashboard-api               1/1     1            1           20m</span><br><span class="line">deployment.apps/kubernetes-dashboard-auth              1/1     1            1           20m</span><br><span class="line">deployment.apps/kubernetes-dashboard-kong              1/1     1            1           20m</span><br><span class="line">deployment.apps/kubernetes-dashboard-metrics-scraper   1/1     1            1           20m</span><br><span class="line">deployment.apps/kubernetes-dashboard-web               1/1     1            1           20m</span><br><span class="line"></span><br><span class="line">NAME                                                             DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/kubernetes-dashboard-api-568f47ddd7              1         1         1       20m</span><br><span class="line">replicaset.apps/kubernetes-dashboard-auth-645b944589             1         1         1       20m</span><br><span class="line">replicaset.apps/kubernetes-dashboard-kong-648658d45f             1         1         1       20m</span><br><span class="line">replicaset.apps/kubernetes-dashboard-metrics-scraper-547874fcf   1         1         1       20m</span><br><span class="line">replicaset.apps/kubernetes-dashboard-web-7796b9fbbb              1         1         1       20m</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">ç¬¬ä¸€æ¬¡åˆ›å»ºkubernetes-dashboardæ—¶ï¼Œæœ‰å‡ ä¸ª pod ä¸€ç›´å¤„äº ContainerCreating çŠ¶æ€ï¼Œé€šè¿‡ describe å‘½ä»¤ï¼ŒæŸ¥çœ‹ pod çš„çŠ¶æ€å‘ç°æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning  FailedCreatePodSandBox  4m52s                kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network <span class="keyword">for</span> sandbox <span class="string">&quot;cfa0b6062fabd77353e6d832ab0e62f96787b4d59346d9e57c28dbc0e19a3127&quot;</span>: plugin <span class="built_in">type</span>=<span class="string">&quot;calico&quot;</span> failed (add): error getting ClusterInformation: connection is unauthorized: Unauthorized</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2"><p>è¿™æ¡é”™è¯¯è¯´æ˜ï¼š</p><ul class="lvl-3"><li class="lvl-6">å®¹å™¨ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰ä½¿ç”¨çš„æ˜¯ Calico</li><li class="lvl-6">Calico åœ¨å°è¯•è·å– Kubernetes é›†ç¾¤çš„ ClusterInformation æ—¶ è®¤è¯å¤±è´¥</li><li class="lvl-6">é”™è¯¯å…³é”®è¯ï¼šconnection is unauthorized: Unauthorized</li></ul></li><li class="lvl-2"><p>ä¸ç¡®å®šå¯¼è‡´è¿™ä¸€é—®é¢˜çš„åŸå› ï¼Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯é‡æ–°å®‰è£… Calico</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f calico.yaml</span><br><span class="line">kubectl apply -f calico.yaml</span><br></pre></td></tr></table></figure></div><ul class="lvl-0"><li class="lvl-2"><p>å¼€æ”¾ä»£ç†ç«¯å£</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å“ªä¸ªæœºå™¨ä¸Šè¿è¡Œçš„å‘½ä»¤ï¼Œå¼€æ”¾çš„å°±æ˜¯å“ªä¸ªæœºå™¨çš„ç«¯å£</span></span><br><span class="line">kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è®¿é—®ï¼šåœ¨å¼€æ”¾ä»£ç†ç«¯å£çš„æœºå™¨ä¸Šä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼š<a href="https://localhost:8443">https://localhost:8443</a></p></li></ul><h2 id="ç™»å½•å¸å·">ç™»å½•å¸å·</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dashboard-adminuser.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span>                    <span class="comment"># åˆ›å»º ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span>                      <span class="comment"># SA åç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span>       <span class="comment"># SA æ‰€åœ¨å‘½åç©ºé—´</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span>                <span class="comment"># é›†ç¾¤è§’è‰²ç»‘å®š</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span>   <span class="comment"># é›†ç¾¤è§’è‰²ç»„ï¼Œè¿™ä¸ªæ˜¯ k8s å†…ç½®çš„</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span>                     <span class="comment"># é›†ç¾¤è§’è‰²</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-admin</span>                   <span class="comment"># é›†ç¾¤ç®¡ç†å‘˜è§’è‰²</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span>                  <span class="comment"># æœåŠ¡è´¦å·</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span>                      <span class="comment"># æœåŠ¡è´¦å·åç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span>       <span class="comment"># æœåŠ¡è´¦å·å‘½åç©ºé—´</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºå¹¶è·å–token</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f dashboard-adminuser.yaml</span><br><span class="line"><span class="comment"># è·å–tokenï¼Œè¯¥ token æœ‰æ•ˆæœŸä¸º 1 å°æ—¶ï¼Œtokenæ ¼å¼ä¸º jwtï¼Œå¯ä»¥é€šè¿‡ jwt.io è§£æ</span></span><br><span class="line">kubectl -n kubernetes-dashboard create token admin-user</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è·å–é•¿æ•ˆtoken</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dashboard-secret.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/service-account.name:</span> <span class="string">&quot;admin-user&quot;</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">kubernetes.io/service-account-token</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f dashboard-secret.yaml</span><br><span class="line"><span class="comment"># è¯¥å‘½ä»¤è·å–tokenï¼Œæ°¸ä¸è¿‡æœŸï¼Œå°†å…¶ä¿å­˜ä¸‹æ¥</span></span><br><span class="line">kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath=<span class="string">&quot;&#123;.data.token&#125;&quot;</span> | <span class="built_in">base64</span> -d</span><br></pre></td></tr></table></figure><h2 id="å¸è½½-kubernetes-dashboard">å¸è½½ kubernetes-dashboard</h2><ul class="lvl-0"><li class="lvl-2"><p>å¸è½½ kubernetes-dashboard</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm uninstall kubernetes-dashboard --namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ¸…ç†ç”¨æˆ·ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kubernetes-dashboard delete serviceaccount admin-user</span><br><span class="line">kubectl -n kubernetes-dashboard delete clusterrolebinding admin-user</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ å‘½åç©ºé—´ï¼Œåˆ é™¤å‘½åç©ºé—´ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰èµ„æº</span></span><br><span class="line">kubectl delete namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/&quot;&gt;Dashboard k8sä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ Tools</title>
    <link href="https://blog.hanqunfeng.com/2025/07/24/k8s-tools/"/>
    <id>https://blog.hanqunfeng.com/2025/07/24/k8s-tools/</id>
    <published>2025-07-24T13:30:05.000Z</published>
    <updated>2025-08-26T02:21:30.959Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-3"><p>K8S çš„ Tools: crictlã€nerdctlã€helm ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li></ul><span id="more"></span><h2 id="crictl-å‘½ä»¤">crictl å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p><code>crictl</code> æ˜¯k8så®˜æ–¹å‡ºå“çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ containerd è¿›è¡Œé€šä¿¡ã€‚</p></li><li class="lvl-2"><p><code>crictl</code> å‘½ä»¤é»˜è®¤éœ€è¦ sudo æƒé™ï¼Œå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ  sudoï¼Œå¯ä»¥å°†ç”¨æˆ·åŠ å…¥ containerd çš„ socket æƒé™ç»„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># containerd çš„é»˜è®¤ socket æ˜¯ /var/run/containerd/containerd.sock</span></span><br><span class="line">$ <span class="built_in">ls</span> -l /var/run/containerd/containerd.sock</span><br><span class="line">srw-rw---- 1 root root 0 7æœˆ   1 10:57 /var/run/containerd/containerd.sock</span><br><span class="line"><span class="comment"># å¦‚æœ group æ˜¯ rootï¼šä½ å¯ä»¥æ”¹ä¸ºå…¶å®ƒç»„ï¼Œæ¯”å¦‚ docker</span></span><br><span class="line"><span class="comment"># å¦‚æœ docker ç»„ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line"><span class="built_in">sudo</span> groupadd docker</span><br><span class="line"><span class="comment"># ä¿®æ”¹æ–‡ä»¶æ‰€å±ç»„ä¸º docker</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chgrp</span> docker /var/run/containerd/containerd.sock</span><br><span class="line"><span class="comment"># ä¸ºç»„æ·»åŠ è¯»å†™æƒé™</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> g+rw /var/run/containerd/containerd.sock</span><br><span class="line"><span class="comment"># æ·»åŠ ç”¨æˆ·åˆ° docker ç»„</span></span><br><span class="line"><span class="built_in">sudo</span> usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"><span class="comment"># åˆ·æ–°æƒé™</span></span><br><span class="line">newgrp docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶è™½ç„¶å·²ç»å¯ä»¥ä¸ç”¨ sudo äº†ï¼Œä½†æ˜¯ä¸€æ—¦é‡å¯ containerd å°±ä¼šé‡æ–°å›åˆ° root æƒé™ï¼Œå› æ­¤éœ€è¦æ·»åŠ å¦‚ä¸‹é…ç½®</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/systemd/system/containerd.service.d/</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/systemd/system/containerd.service.d/override.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">ExecStartPost=/bin/bash -c &#x27;chmod 660 /run/containerd/containerd.sock &amp;&amp; chgrp docker /run/containerd/containerd.sock&#x27;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart containerd</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>crictl</code> å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç±»ä¼¼<code>docker</code>å‘½ä»¤</p></li></ul><table><thead><tr><th>æ“ä½œ</th><th><code>docker</code> å‘½ä»¤</th><th><code>crictl</code> å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</td><td><code>docker ps</code></td><td><code>crictl ps</code></td><td></td></tr><tr><td>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢ï¼‰</td><td><code>docker ps -a</code></td><td><code>crictl ps -a</code></td><td></td></tr><tr><td>æŸ¥çœ‹é•œåƒ</td><td><code>docker images</code></td><td><code>crictl images</code></td><td></td></tr><tr><td>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</td><td><code>docker logs &lt;container_id&gt;</code></td><td><code>crictl logs &lt;container_id&gt;</code></td><td></td></tr><tr><td>è¿›å…¥å®¹å™¨äº¤äº’</td><td><code>docker exec -it &lt;id&gt; sh</code></td><td><code>crictl exec -it &lt;id&gt; sh</code></td><td></td></tr><tr><td>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</td><td><code>docker inspect &lt;container_id&gt;</code></td><td><code>crictl inspect &lt;container_id&gt;</code></td><td></td></tr><tr><td>æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯</td><td>âŒï¼ˆä¸æ”¯æŒï¼‰</td><td><code>crictl inspectp &lt;pod_id&gt;</code></td><td>K8s ä¸“å±</td></tr><tr><td>åˆ é™¤å®¹å™¨</td><td><code>docker rm &lt;container_id&gt;</code></td><td><code>crictl rm &lt;container_id&gt;</code></td><td></td></tr><tr><td>åˆ é™¤é•œåƒ</td><td><code>docker rmi &lt;image_id&gt;</code></td><td><code>crictl rmi &lt;image_id&gt;</code></td><td></td></tr><tr><td>æ‹‰å–é•œåƒ</td><td><code>docker pull nginx</code></td><td><code>crictl pull nginx</code></td><td></td></tr><tr><td>è¿è¡Œå®¹å™¨ï¼ˆé K8s åœºæ™¯ï¼‰</td><td><code>docker run -it nginx</code></td><td>âŒï¼ˆä¸æ”¯æŒï¼‰</td><td><code>crictl</code> ä¸è¿è¡Œå®¹å™¨ï¼Œä»…è°ƒè¯•ç°æœ‰å®¹å™¨</td></tr><tr><td>åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶ä¿¡æ¯</td><td><code>docker info</code></td><td><code>crictl info</code></td><td></td></tr><tr><td>æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€</td><td><code>docker stats</code></td><td><code>crictl stats</code></td><td>ç®€è¦ç‰ˆ</td></tr><tr><td>è®¾ç½®é…ç½®æ–‡ä»¶</td><td><code>~/.docker/config.json</code></td><td><code>/etc/crictl.yaml</code></td><td>å¦‚è®¾ç½® endpoint</td></tr></tbody></table><h2 id="nerdctl">nerdctl</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/containerd/nerdctl">nerdctl</a> æ˜¯ä¸€ä¸ª å…¼å®¹ Docker CLI çš„å®¹å™¨å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† containerd å®¹å™¨è¿è¡Œæ—¶ã€‚</p></li><li class="lvl-2"><p>å®ƒæ˜¯ containerd å®˜æ–¹å­é¡¹ç›®ï¼Œç”± CNCF ç»´æŠ¤ï¼Œå…¶å‘½ä»¤è¯­æ³•ä¸ Docker CLI å…¼å®¹ï¼Œç›®æ ‡æ˜¯è®©ä¹ æƒ¯ Docker çš„ç”¨æˆ·ä¹Ÿèƒ½è½»æ¾ä½¿ç”¨ containerdã€‚</p></li><li class="lvl-2"><p>å®‰è£… nerdctl</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line">VERSION=2.1.3</span><br><span class="line">wget https://github.com/containerd/nerdctl/releases/download/v<span class="variable">$&#123;VERSION&#125;</span>/nerdctl-<span class="variable">$&#123;VERSION&#125;</span>-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è§£å‹</span></span><br><span class="line">tar -xvf nerdctl-<span class="variable">$&#123;VERSION&#125;</span>-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ç§»åŠ¨åˆ°ç³»ç»Ÿ PATH</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> nerdctl /usr/local/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># nerdctl éœ€è¦ sudo æƒé™</span></span><br><span class="line"><span class="comment">## ä¸º sudo æ·»åŠ  PATH</span></span><br><span class="line"><span class="built_in">sudo</span> visudo</span><br><span class="line"><span class="comment">## æ‰¾åˆ°è¿™ä¸€è¡Œ</span></span><br><span class="line">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line"><span class="comment">## ä¿®æ”¹ä¸ºï¼Œå³å°† nerdctl æ‰€åœ¨çš„ç›®å½•åŠ å…¥ PATH</span></span><br><span class="line">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin:/usr/local/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æµ‹è¯•</span></span><br><span class="line"><span class="comment">## æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">sudo</span> nerdctl version</span><br><span class="line"><span class="comment">## åˆ—å‡ºå®¹å™¨ï¼Œ--namespace k8s.io è¡¨ç¤ºæŸ¥çœ‹ k8s ä¸­çš„å®¹å™¨</span></span><br><span class="line"><span class="built_in">sudo</span> nerdctl ps --namespace k8s.io</span><br><span class="line"></span><br><span class="line"><span class="comment">## å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ ä¸Š --namespace k8s.ioï¼Œå¯ä»¥è®¾ç½®åˆ«å</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;alias kps=&#x27;sudo nerdctl --namespace=k8s.io ps&#x27;&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="comment">## æµ‹è¯•</span></span><br><span class="line">kps</span><br></pre></td></tr></table></figure><h2 id="Helm">Helm</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://helm.sh/zh/docs/">å®˜ç½‘æ–‡æ¡£</a></p></li><li class="lvl-2"><p>Helm æ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼äº Linux ä¸‹çš„åŒ…ç®¡ç†å·¥å…·å¦‚ yumã€apt ç­‰ã€‚å¯ä»¥æ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„ yaml æ–‡ä»¶éƒ¨ç½²åˆ° Kunernetes ä¸Šã€‚</p></li></ul><h3 id="Helmçš„å®‰è£…">Helmçš„å®‰è£…</h3><ul class="lvl-0"><li class="lvl-2"><p>å®˜ç½‘<a href="https://helm.sh/zh/docs/intro/install/">å®‰è£…æ–¹æ³•</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://get.helm.sh/helm-v3.17.4-linux-amd64.tar.gz</span><br><span class="line">tar -zxvf helm-v3.17.4-linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> linux-amd64/helm /usr/local/bin/helm</span><br><span class="line">$ helm version</span><br><span class="line">version.BuildInfo&#123;Version:<span class="string">&quot;v3.17.4&quot;</span>, GitCommit:<span class="string">&quot;595a05da6166037d0abebaa27ac8a498fa4d7ed2&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>, GoVersion:<span class="string">&quot;go1.23.10&quot;</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Helm<a href="https://helm.sh/zh/docs/helm/helm_completion_bash/">è‡ªåŠ¨è¡¥å…¨</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… helm çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</span></span><br><span class="line"><span class="comment"># 1 å½“å‰ç”¨æˆ·</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;source &lt;(helm completion bash)&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line">helm completion bash | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/bash_completion.d/helm &gt; /dev/null</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> a+r /etc/bash_completion.d/helm</span><br></pre></td></tr></table></figure><h3 id="Helmçš„ä½¿ç”¨">Helmçš„ä½¿ç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥å‚è€ƒ <a href="/2023/07/10/aws-eks14-helm/" title="AWS-EKS-14--Helm">AWS-EKS-14--Helm</a></p></li></ul><h4 id="ä»“åº“ç®¡ç†">ä»“åº“ç®¡ç†</h4><ul class="lvl-0"><li class="lvl-2"><p>addï¼šæ·»åŠ å›¾è¡¨å­˜å‚¨åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>listï¼šåˆ—å‡ºå›¾è¡¨å­˜å‚¨åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo list</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>removeï¼šåˆ é™¤å›¾è¡¨å­˜å‚¨åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo remove bitnami</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>updateï¼šä»å›¾è¡¨å­˜å‚¨åº“æ›´æ–°æœ¬åœ°å¯ç”¨å›¾è¡¨çš„ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ–°æ‰€æœ‰ä»“åº“</span></span><br><span class="line">helm repo update</span><br><span class="line"><span class="comment"># æ›´æ–°æŒ‡å®šçš„ä»“åº“</span></span><br><span class="line">helm repo update bitnami</span><br></pre></td></tr></table></figure><h4 id="åœ¨ä»“åº“ä¸­æœç´¢">åœ¨ä»“åº“ä¸­æœç´¢</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨æ‰€æœ‰ä»“åº“ä¸­æœç´¢ï¼Œé»˜è®¤åªå±•ç¤ºæœ€æ–°çš„ç‰ˆæœ¬</span></span><br><span class="line">helm search repo nginx</span><br><span class="line"><span class="comment"># åœ¨æŒ‡å®šçš„ä»“åº“ä¸­æœç´¢</span></span><br><span class="line">helm search repo bitnami/wordpress</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰ç‰ˆæœ¬</span></span><br><span class="line">helm search repo nginx -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å…¨éƒ¨ç‰ˆæœ¬ä¸­æœç´¢å¤§äºç­‰äºæŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">$ helm search repo nginx --version ^21.0.0 -l</span><br><span class="line">NAME         CHART VERSIONAPP VERSIONDESCRIPTION</span><br><span class="line">bitnami/nginx21.0.8       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.7       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.6       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.4       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.3       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.2       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.1       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.0       1.29.0     NGINX Open Source is a web server that can be a...</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…åŒ…">å®‰è£…åŒ…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æœ€æ–°ç‰ˆ</span></span><br><span class="line">helm install nginx bitnami/nginx</span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">helm install nginx bitnami/nginx --version 21.0.3</span><br><span class="line"><span class="comment"># å®‰è£…åŒ…åˆ°æŒ‡å®šå‘½åç©ºé—´</span></span><br><span class="line">helm install nginx bitnami/nginx -n &lt;namespace&gt;</span><br><span class="line"><span class="comment"># å®‰è£…åŒ…å¹¶åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">helm install nginx bitnami/nginx -n &lt;namespace&gt; --create-namespace</span><br><span class="line"><span class="comment"># ociï¼š ä» docker ä»“åº“ä¸­å®‰è£…</span></span><br><span class="line">helm pull oci://registry-1.docker.io/bitnamicharts/nginx --version 21.0.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æœ¬åœ° chart ç›®å½•</span></span><br><span class="line">helm install my-release ./nginx</span><br><span class="line"><span class="comment"># å®‰è£… .tgz æ ¼å¼çš„æ‰“åŒ… chart</span></span><br><span class="line">helm install my-release ./nginx-1.2.3.tgz</span><br><span class="line"><span class="comment"># ä»è¿œç¨‹tgzå®‰è£…</span></span><br><span class="line">helm install my-release https://example.com/charts/nginx-1.2.3.tgz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Git ä»“åº“ä¸­çš„ chartï¼ˆç»“åˆ pluginï¼‰</span></span><br><span class="line">helm plugin install https://github.com/aslafy-z/helm-git</span><br><span class="line">helm repo add mychart <span class="string">&#x27;git+https://github.com/myorg/mychart.git&#x27;</span></span><br><span class="line">helm install my-release mychart/nginx</span><br><span class="line"><span class="comment"># å¸è½½helm-gitæ’ä»¶</span></span><br><span class="line">helm plugin remove helm-git</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ --set ä¼ é€’å•ä¸ªæˆ–å¤šä¸ªå€¼</span></span><br><span class="line">helm install my-release bitnami/nginx --<span class="built_in">set</span> service.type=NodePort</span><br><span class="line"><span class="comment"># ä½¿ç”¨ --values æˆ– -f åŠ è½½ YAML é…ç½®æ–‡ä»¶</span></span><br><span class="line">helm install my-release bitnami/nginx -f custom-values.yaml</span><br><span class="line"><span class="comment"># åŒæ—¶ä½¿ç”¨å¤šç§ values æ–‡ä»¶ + --set</span></span><br><span class="line">helm install my-release bitnami/nginx -f base.yaml -f prod.yaml --<span class="built_in">set</span> replicaCount=3</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…">æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´å·²å®‰è£…çš„åŒ…</span></span><br><span class="line">helm list -n &lt;namespace&gt;</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„åŒ…</span></span><br><span class="line">helm list -A</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…çŠ¶æ€</span></span><br><span class="line">helm status ngxin -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><h4 id="å¸è½½åŒ…">å¸è½½åŒ…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm uninstall nginx -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-3&quot;&gt;
&lt;p&gt;K8S çš„ Tools: crictlã€nerdctlã€helm ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ è¿œç¨‹è¿æ¥</title>
    <link href="https://blog.hanqunfeng.com/2025/07/24/k8s-connection/"/>
    <id>https://blog.hanqunfeng.com/2025/07/24/k8s-connection/</id>
    <published>2025-07-24T12:30:05.000Z</published>
    <updated>2025-07-24T02:27:51.050Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»  K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li></ul><span id="more"></span><h2 id="è¿œç¨‹è¿æ¥-k8s-é›†ç¾¤">è¿œç¨‹è¿æ¥ k8s é›†ç¾¤</h2><h3 id="æœ¬åœ°ä¸å­˜åœ¨-kubeconfig-æ–‡ä»¶">æœ¬åœ°ä¸å­˜åœ¨ kubeconfig æ–‡ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>è·å– kubeconfig æ–‡ä»¶ï¼Œä½äº Master èŠ‚ç‚¹ï¼š/etc/kubernetes/admin.confï¼Œå°†å…¶æ‹·è´åˆ°æœ¬åœ°</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/config</span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°å·²å­˜åœ¨-kubeconfig-æ–‡ä»¶">æœ¬åœ°å·²å­˜åœ¨ kubeconfig æ–‡ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>å·²ç»é…ç½®äº†ä¸€ä¸ªé›†ç¾¤çš„è¿æ¥ï¼Œè¿˜æƒ³å†æ·»åŠ ä¸€ä¸ªé›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡é€šè¿‡åˆå¹¶çš„æ–¹å¼æ·»åŠ </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æ–°é›†ç¾¤çš„ kubeconfig æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°</span></span><br><span class="line">scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/new-cluster.conf</span><br><span class="line"><span class="comment"># åˆå¹¶</span></span><br><span class="line">KUBECONFIG=~/.kube/config:new-cluster.conf kubectl config view --flatten &gt; merged-config.yaml</span><br><span class="line"><span class="comment"># æ›¿æ¢</span></span><br><span class="line"><span class="built_in">mv</span> merged-config.yaml ~/.kube/config</span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤">é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤</h3><ul class="lvl-0"><li class="lvl-2"><p>è·å–é›†ç¾¤é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–æ‰€æœ‰é›†ç¾¤é…ç½®</span></span><br><span class="line">kubectl config get-contexts</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰é»˜è®¤çš„ context</span></span><br><span class="line">kubectl config current-context</span><br><span class="line"><span class="comment"># åˆ‡æ¢ context</span></span><br><span class="line">kubectl config use-context &lt;context_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é›†ç¾¤åç§°</span></span><br><span class="line">kubectl config get-clusters</span><br><span class="line"><span class="comment"># è·å–ç”¨æˆ·åç§°</span></span><br><span class="line">kubectl config get-users</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµ‹è¯•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤é›†ç¾¤é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤ context</span></span><br><span class="line">kubectl config delete-context &lt;context_name&gt;</span><br><span class="line"><span class="comment"># åˆ é™¤ cluster</span></span><br><span class="line">kubectl config delete-cluster &lt;cluster_name&gt;</span><br><span class="line"><span class="comment"># åˆ é™¤ user</span></span><br><span class="line">kubectl config delete-user &lt;user_name&gt;</span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘ kubeconfigï¼ˆ~/.kube/configï¼‰ æ–‡ä»¶ï¼Œæ·»åŠ æˆ–åˆ é™¤ä¸éœ€è¦çš„é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»  K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ Secret</title>
    <link href="https://blog.hanqunfeng.com/2025/07/23/k8s-secret/"/>
    <id>https://blog.hanqunfeng.com/2025/07/23/k8s-secret/</id>
    <published>2025-07-23T13:35:15.000Z</published>
    <updated>2025-07-23T09:36:36.272Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/">k8s Secret å®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="Secret-ä»‹ç»">Secret ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>Secret æ˜¯ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€ä»¤ç‰Œæˆ–å¯†é’¥çš„å¯¹è±¡ã€‚ è¿™æ ·çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«æ”¾åœ¨ Pod è§„çº¦ä¸­æˆ–è€…é•œåƒä¸­ã€‚ ä½¿ç”¨ Secret æ„å‘³ç€ä½ ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­åŒ…å«æœºå¯†æ•°æ®ã€‚</p></li><li class="lvl-2"><p>ç”±äºåˆ›å»º Secret å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„ Podï¼Œ å› æ­¤åœ¨åˆ›å»ºã€æŸ¥çœ‹å’Œç¼–è¾‘ Pod çš„å·¥ä½œæµç¨‹ä¸­æš´éœ² Secretï¼ˆåŠå…¶æ•°æ®ï¼‰çš„é£é™©è¾ƒå°ã€‚ Kubernetes å’Œåœ¨é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å¯¹ Secret é‡‡å–é¢å¤–çš„é¢„é˜²æªæ–½ï¼Œ ä¾‹å¦‚é¿å…å°†æ•æ„Ÿæ•°æ®å†™å…¥éæ˜“å¤±æ€§å­˜å‚¨ã€‚</p></li><li class="lvl-2"><p>Secret ç±»ä¼¼äº ConfigMap ä½†ä¸“é—¨ç”¨äºä¿å­˜æœºå¯†æ•°æ®ã€‚</p></li><li class="lvl-2"><p>æ¯ä¸ª Secret çš„å°ºå¯¸æœ€å¤šä¸º 1MiB</p></li><li class="lvl-2"><p>åœ¨ K8S ä¸­ï¼ŒSecret æœ‰å¤šç§ç±»å‹ï¼šæœ¬æ–‡åªè®²è§£ <code>Opaque</code> ç±»å‹ï¼Œå…¶ä½™ç±»å‹å‚è€ƒ[å®˜ç½‘]((<a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/">https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/</a>)ã€‚</p></li></ul><table><thead><tr><th>å†…ç½®ç±»å‹</th><th>ç”¨æ³•æè¿°</th></tr></thead><tbody><tr><td><code>Opaque</code></td><td>ç”¨æˆ·è‡ªå®šä¹‰çš„ä»»æ„æ•°æ®ï¼ˆé»˜è®¤ç±»å‹ï¼‰</td></tr><tr><td><code>kubernetes.io/service-account-token</code></td><td>è‡ªåŠ¨æŒ‚è½½çš„æœåŠ¡è´¦å·ä»¤ç‰Œï¼Œä¾› Pod è®¿é—® API ä½¿ç”¨</td></tr><tr><td><code>kubernetes.io/dockercfg</code></td><td>åºåˆ—åŒ–çš„ <code>~/.dockercfg</code> æ–‡ä»¶ï¼Œç”¨äºç§æœ‰ä»“åº“è®¤è¯ï¼ˆæ—§æ ¼å¼ï¼‰</td></tr><tr><td><code>kubernetes.io/dockerconfigjson</code></td><td>åºåˆ—åŒ–çš„ <code>~/.docker/config.json</code> æ–‡ä»¶ï¼ˆæ¨èï¼‰</td></tr><tr><td><code>kubernetes.io/basic-auth</code></td><td>å­˜å‚¨ç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨äº HTTP åŸºæœ¬è®¤è¯</td></tr><tr><td><code>kubernetes.io/ssh-auth</code></td><td>å­˜å‚¨ SSH ç§é’¥ï¼Œç”¨äº SSH èº«ä»½è®¤è¯</td></tr><tr><td><code>kubernetes.io/tls</code></td><td>å­˜å‚¨ TLS å¯†é’¥å’Œè¯ä¹¦ï¼Œç”¨äº HTTPS æˆ–æœåŠ¡åŠ å¯†é€šä¿¡</td></tr><tr><td><code>bootstrap.kubernetes.io/token</code></td><td>ç”¨äº kubelet åŠ å…¥é›†ç¾¤çš„å¼•å¯¼ä»¤ç‰Œ</td></tr></tbody></table><h2 id="Secret-åˆ›å»ºåŠä½¿ç”¨">Secret åˆ›å»ºåŠä½¿ç”¨</h2><ul class="lvl-0"><li class="lvl-2"><p>Secret ä¸ ConfigMap åˆ›å»ºåŠä½¿ç”¨ç±»ä¼¼ï¼Œéƒ½æ˜¯å­˜å‚¨é”®å€¼å¯¹ï¼Œä½†å­˜å‚¨å†…å®¹ä¸åŒï¼ŒSecret å­˜å‚¨çš„æ˜¯ Base64 ç¼–ç åçš„å†…å®¹ã€‚</p></li></ul><h3 id="ç¯å¢ƒå˜é‡å¼•ç”¨">ç¯å¢ƒå˜é‡å¼•ç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>yamlåˆ›å»º</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysevret.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span>                  <span class="comment"># é»˜è®¤ç±»å‹ ï¼Œå¯ä»¥çœç•¥</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">YWRtaW4=</span>          <span class="comment"># &quot;admin&quot; çš„ base64 ç¼–ç </span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">MWYyZDFlMmU2N2Rm</span>  <span class="comment"># &quot;1f2d1e2e67df&quot; çš„ base64 ç¼–ç </span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œåˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># keyï¼švalue æ–¹å¼åˆ›å»ºï¼Œè¿™é‡Œ value å€¼æ˜¯ æ˜æ–‡ï¼Œk8s ä¼šè¿›è¡Œ base64 ç¼–ç </span></span><br><span class="line">kubectl create secret generic my-secret \</span><br><span class="line">  --from-literal=username=admin \</span><br><span class="line">  --from-literal=password=1f2d1e2e67df</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶æ–¹å¼åˆ›å»º</span></span><br><span class="line"><span class="comment"># --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ Secret ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚</span></span><br><span class="line">kubectl create secret generic my-secret \</span><br><span class="line">  --from-env-file=username.env \</span><br><span class="line">  --from-env-file=password.env</span><br><span class="line"></span><br><span class="line"><span class="comment"># username.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># username=admin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># password.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># password=1f2d1e2e67df</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ Secret çš„å†…å®¹</span></span><br><span class="line">$ k get secrets my-secret -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  password: MWYyZDFlMmU2N2Rm</span><br><span class="line">  username: YWRtaW4=</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">&quot;2025-07-05T13:21:22Z&quot;</span></span><br><span class="line">  name: my-secret</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: <span class="string">&quot;747355&quot;</span></span><br><span class="line">  uid: 4f77269d-d4c3-4ae8-aafc-7cfa56b84a5d</span><br><span class="line"><span class="built_in">type</span>: Opaque</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">env-secret</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;printenv&quot;</span>] <span class="comment"># æ‰“å°ç¯å¢ƒå˜é‡</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">      <span class="attr">envFrom:</span>                  <span class="comment"># ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€ Secret ï¼Œç­‰ç­‰</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">secretRef:</span>            <span class="comment"># è¿™é‡Œå¼•ç”¨ Secret ï¼Œæ­¤å¤„å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">my-secret</span>     <span class="comment"># Secret åç§°</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°† Secret ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod2.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">env-secret2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line">    <span class="attr">args:</span>                       <span class="comment"># å®¹å™¨å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        echo &quot;username: $&#123;SECRET_USERNAME&#125;&quot;</span></span><br><span class="line"><span class="string">        echo &quot;password: $&#123;SECRET_PASSWORD&#125;&quot;</span></span><br><span class="line"><span class="string"></span>    <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">    <span class="attr">env:</span>                        <span class="comment"># ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SECRET_USERNAME</span>     <span class="comment"># è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key</span></span><br><span class="line">      <span class="attr">valueFrom:</span>                <span class="comment"># value æ¥æº</span></span><br><span class="line">        <span class="attr">secretKeyRef:</span>           <span class="comment"># å¼•ç”¨ Secret ä¸­çš„ key</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">my-secret</span>       <span class="comment"># Secret åç§°</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">username</span>         <span class="comment"># Secret ä¸­ key çš„åç§°</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SECRET_PASSWORD</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">secretKeyRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">password</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹podæ—¥å¿—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ k logs pods/env-secret</span><br><span class="line">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br><span class="line">KUBERNETES_SERVICE_PORT=443</span><br><span class="line">HOSTNAME=env-secret</span><br><span class="line">SHLVL=1</span><br><span class="line">username=admin</span><br><span class="line">HOME=/root</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class="line">password=1f2d1e2e67df</span><br><span class="line">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class="line">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br><span class="line">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class="line">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br><span class="line">PWD=/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ k logs pods/env-secret2</span><br><span class="line">username: admin</span><br><span class="line">password: 1f2d1e2e67df</span><br></pre></td></tr></table></figure><h3 id="å­˜å‚¨å·å¼•ç”¨">å­˜å‚¨å·å¼•ç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>yamlåˆ›å»º</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># secret-configfile.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">stringData:</span>                          <span class="comment"># ä½¿ç”¨ stringDataï¼ŒK8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç </span></span><br><span class="line">  <span class="attr">app.properties:</span> <span class="string">|</span>                  <span class="comment"># æ–‡ä»¶å</span></span><br><span class="line">    <span class="string">server.port=8080</span></span><br><span class="line">    <span class="string">log.level=INFO</span></span><br><span class="line">  <span class="attr">db.properties:</span> <span class="string">|</span>                   <span class="comment"># æ–‡ä»¶å</span></span><br><span class="line">    <span class="string">db.host=localhost</span></span><br><span class="line">    <span class="string">db.port=5432</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œåˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment"># æ–‡ä»¶å†…å®¹æ˜¯æ˜æ–‡ï¼Œk8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç </span></span><br><span class="line">kubectl create secret generic my-secret \</span><br><span class="line">  --from-file=app.properties \</span><br><span class="line">  --from-file=db.properties</span><br><span class="line"><span class="comment"># app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># server.port=8080</span></span><br><span class="line"><span class="comment"># log.level=INFO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># db.host=localhost</span></span><br><span class="line"><span class="comment"># db.port=5432</span></span><br><span class="line"></span><br><span class="line">$ k get secrets my-secret -oyaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  app.properties: c2VydmVyLnBvcnQ9ODA4MApsb2cubGV2ZWw9SU5GTwo=</span><br><span class="line">  db.properties: ZGIuaG9zdD1sb2NhbGhvc3QKZGIucG9ydD0xMjU0MzIK</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">&quot;2025-07-05T13:45:14Z&quot;</span></span><br><span class="line">  name: my-secret</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: <span class="string">&quot;750742&quot;</span></span><br><span class="line">  uid: 35ffcdd6-d70a-4f3a-9246-5c56da630bc1</span><br><span class="line"><span class="built_in">type</span>: Opaque</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Pod æŒ‚è½½ Secret ä¸ºæ–‡ä»¶</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># secret-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sleep&quot;</span>, <span class="string">&quot;3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/etc/config</span>              <span class="comment"># æŒ‚è½½è·¯å¾„</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span>                   <span class="comment"># å­˜å‚¨å· åç§°</span></span><br><span class="line">    <span class="attr">secret:</span>                               <span class="comment"># å­˜å‚¨å·ç±»å‹ä¸º Secret</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">my-secret</span>               <span class="comment"># æŒ‚è½½çš„ Secret åç§°ï¼Œæœ¬åˆ©ä¸­å°† Secret ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®¹å™¨å†…çš„ <code>/etc/config/</code> ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/config/app.properties</span><br><span class="line">/etc/config/db.properties</span><br><span class="line"></span><br><span class="line">$ k <span class="built_in">exec</span> -it secret-demo -- <span class="built_in">ls</span> /etc/config/</span><br><span class="line">app.properties  db.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœåªæƒ³æŒ‚è½½ Secret ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>items</code> å­—æ®µæŒ‡å®šï¼š</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># secret-pod2.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret-demo2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sleep&quot;</span>, <span class="string">&quot;3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/etc/config</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">    <span class="attr">secret:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">my-secret</span></span><br><span class="line">      <span class="attr">items:</span>                   <span class="comment"># æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app.properties</span>    <span class="comment"># secret ä¸­çš„key</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">app.properties</span>   <span class="comment"># æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties</span></span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>Secret çš„ç‰¹ç‚¹ä¸ä½¿ç”¨æ–¹æ³•ä¸ ConfigMap éå¸¸ç±»ä¼¼ã€‚</p></li><li class="lvl-2"><p>ğŸ” ConfigMap vs Secret å¯¹æ¯”è¡¨ï¼š</p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>ConfigMap</th><th>Secret</th></tr></thead><tbody><tr><td><strong>ç”¨é€”</strong></td><td>å­˜å‚¨éæ•æ„Ÿé…ç½®ä¿¡æ¯ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ï¼‰</td><td>å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€è¯ä¹¦ã€tokenï¼‰</td></tr><tr><td><strong>æ•°æ®æ˜¯å¦åŠ å¯†</strong></td><td>å¦ï¼Œæ˜æ–‡å­˜å‚¨ï¼ˆBase64 ç¼–ç å¯è¯»ï¼‰</td><td>å¦ï¼ˆé»˜è®¤ Base64 ç¼–ç ï¼‰ï¼Œå¯é…ç½®åŠ å¯†å­˜å‚¨ï¼ˆå¦‚ä½¿ç”¨ KMSï¼‰</td></tr><tr><td><strong>å­—æ®µå</strong></td><td><code>data</code> / <code>binaryData</code></td><td><code>data</code>ï¼ˆéœ€ base64ï¼‰ / <code>stringData</code>ï¼ˆæ˜æ–‡ï¼‰</td></tr><tr><td><strong>å¯å­˜å‚¨çš„æœ€å¤§å¤§å°</strong></td><td>æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB</td><td>æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB</td></tr><tr><td><strong>æ”¯æŒçš„æŒ‚è½½æ–¹å¼</strong></td><td>- ç¯å¢ƒå˜é‡<br>- å·ï¼ˆæ–‡ä»¶ï¼‰</td><td>- ç¯å¢ƒå˜é‡<br>- å·ï¼ˆæ–‡ä»¶ï¼‰</td></tr><tr><td><strong>é»˜è®¤ç±»å‹ï¼ˆtypeï¼‰</strong></td><td>æ— ç±»å‹å­—æ®µ</td><td>é»˜è®¤ä¸º <code>Opaque</code></td></tr><tr><td><strong>å¯å®šä¹‰ä¸ºå¤šä¸ªæ–‡ä»¶æŒ‚è½½</strong></td><td>âœ…</td><td>âœ…</td></tr><tr><td><strong>é»˜è®¤ RBAC è®¿é—®æ§åˆ¶å¼ºåº¦</strong></td><td>å¼±ï¼ˆå¤šæ•°ç”¨æˆ·/Pod å¯è¯»å–ï¼‰</td><td>å¼ºï¼ˆé»˜è®¤å—é™è®¿é—®ï¼‰</td></tr><tr><td><strong>æ”¯æŒçš„å†…ç½®ç±»å‹</strong></td><td>æ— </td><td>âœ… å¦‚ï¼š<code>kubernetes.io/tls</code>ã€<code>kubernetes.io/basic-auth</code> ç­‰</td></tr><tr><td><strong>æ˜¯å¦é€‚åˆå­˜å‚¨å¯†é’¥/å¯†ç </strong></td><td>âŒ ä¸æ¨è</td><td>âœ… æ¨è</td></tr><tr><td><strong>å¯è§†åŒ–æ˜æ–‡è¯»å–</strong></td><td>âœ… ç›´æ¥è¯»å–</td><td>âœ… ä½† Base64 ç¼–ç åéœ€è¦è§£ç </td></tr><tr><td><strong>å¸¸è§ç”¨é€”ç¤ºä¾‹</strong></td><td>App é…ç½®ã€æ—¥å¿—çº§åˆ«ã€è¿æ¥å‚æ•°ç­‰</td><td>æ•°æ®åº“å¯†ç ã€TLS è¯ä¹¦ã€API Token ç­‰</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/&quot;&gt;k8s Secret å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ ConfigMap</title>
    <link href="https://blog.hanqunfeng.com/2025/07/23/k8s-configmap/"/>
    <id>https://blog.hanqunfeng.com/2025/07/23/k8s-configmap/</id>
    <published>2025-07-23T12:35:15.000Z</published>
    <updated>2025-07-23T09:14:54.663Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/">k8s ConfigMap å®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="ConfigMap-åˆ«åcm-ä»‹ç»">ConfigMap(åˆ«åcm) ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>ConfigMap æ˜¯ä¸€ç§ API å¯¹è±¡ï¼Œç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚</p></li><li class="lvl-2"><p>ä½¿ç”¨æ—¶ï¼Œ Pod å¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚</p></li><li class="lvl-2"><p>ConfigMap å°†ä½ çš„ç¯å¢ƒé…ç½®ä¿¡æ¯å’Œå®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹ã€‚</p></li><li class="lvl-2"><p>å¤šä¸ª Pod å¯ä»¥å…³è”åŒä¸€ä¸ª ConfigMap</p></li></ul><h2 id="ConfigMap-åˆ›å»ºåŠä½¿ç”¨">ConfigMap åˆ›å»ºåŠä½¿ç”¨</h2><h3 id="ç¯å¢ƒå˜é‡å¼•ç”¨">ç¯å¢ƒå˜é‡å¼•ç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>yamlåˆ›å»º</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configmap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span>       <span class="comment"># ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myconfigmap</span>   <span class="comment"># configmap åç§°</span></span><br><span class="line"><span class="attr">data:</span>                 <span class="comment"># data å­—æ®µè®¾è®¡ç”¨æ¥ä¿å­˜ UTF-8 å­—ç¬¦ä¸²ï¼Œæœ€å¤§å€¼ä¸º 1M</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">k8s-admin</span> <span class="comment"># key: value</span></span><br><span class="line">  <span class="attr">access_level:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;123456&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œåˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># keyï¼švalue æ–¹å¼åˆ›å»º</span></span><br><span class="line">kubectl create configmap myconfigmap --from-literal=username=k8s-admin --from-literal=access_level=1 --from-literal=password=123456</span><br><span class="line"><span class="comment"># æ–‡ä»¶æ–¹å¼åˆ›å»º</span></span><br><span class="line"><span class="comment"># --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ ConfigMap ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚</span></span><br><span class="line">kubectl create configmap myconfigmap --from-env-file=app.env --from-env-file=other.env</span><br><span class="line"><span class="comment"># app.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># username=k8s-admin</span></span><br><span class="line"><span class="comment"># access_level=1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># other.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># password=123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ ConfigMap çš„å†…å®¹</span></span><br><span class="line">$ k get cm myconfigmap -oyaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  access_level: <span class="string">&quot;1&quot;</span></span><br><span class="line">  password: <span class="string">&quot;123456&quot;</span></span><br><span class="line">  username: k8s-admin</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">&quot;2025-07-05T10:29:15Z&quot;</span></span><br><span class="line">  name: myconfigmap</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: <span class="string">&quot;723770&quot;</span></span><br><span class="line">  uid: ee850cf9-9014-4be2-97d8-5d1840e78d54</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">env-configmap</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;printenv&quot;</span>] <span class="comment"># æ‰“å°ç¯å¢ƒå˜é‡</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">      <span class="attr">envFrom:</span>                  <span class="comment"># ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€configMapï¼Œç­‰ç­‰</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">configMapRef:</span>         <span class="comment"># è¿™é‡Œå¼•ç”¨ ConfigMapï¼Œæ­¤å¤„å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">myconfigmap</span>   <span class="comment"># configMap åç§°</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°† ConfigMap ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod2.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">env-configmap2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line">    <span class="attr">args:</span>                       <span class="comment"># å®¹å™¨å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        echo &quot;username: $&#123;CONFIGMAP_USERNAME&#125;&quot;</span></span><br><span class="line"><span class="string">        echo &quot;password: $&#123;CONFIGMAP_PASSWORD&#125;&quot;</span></span><br><span class="line"><span class="string"></span>    <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">    <span class="attr">env:</span>                        <span class="comment"># ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CONFIGMAP_USERNAME</span>  <span class="comment"># è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key</span></span><br><span class="line">      <span class="attr">valueFrom:</span>                <span class="comment"># value æ¥æº</span></span><br><span class="line">        <span class="attr">configMapKeyRef:</span>        <span class="comment"># å¼•ç”¨ ConfigMap ä¸­çš„ key</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">myconfigmap</span>     <span class="comment"># configMap åç§°</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">username</span>         <span class="comment"># configMap ä¸­ key çš„åç§°</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CONFIGMAP_PASSWORD</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">configMapKeyRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">myconfigmap</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">password</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹podæ—¥å¿—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl logs pods/env-configmap</span><br><span class="line">access_level=1</span><br><span class="line">KUBERNETES_SERVICE_PORT=443</span><br><span class="line">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br><span class="line">HOSTNAME=env-configmap</span><br><span class="line">SHLVL=1</span><br><span class="line">username=k8s-admin</span><br><span class="line">HOME=/root</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class="line">password=123456</span><br><span class="line">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class="line">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br><span class="line">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class="line">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br><span class="line">PWD=/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ kubectl logs pods/env-configmap2</span><br><span class="line">username: k8s-admin</span><br><span class="line">password: 123456</span><br></pre></td></tr></table></figure><h3 id="å­˜å‚¨å·å¼•ç”¨">å­˜å‚¨å·å¼•ç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>yamlåˆ›å»º</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configmap-configfile.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">app.properties:</span> <span class="string">|</span>  <span class="comment"># æ–‡ä»¶åç§° ï¼Œä½¿ç”¨ | åˆ›å»ºå¤šè¡Œ</span></span><br><span class="line">    <span class="string">server.port=8080</span></span><br><span class="line">    <span class="string">log.level=INFO</span></span><br><span class="line">  <span class="attr">db.properties:</span> <span class="string">|</span>   <span class="comment"># æ–‡ä»¶åç§°</span></span><br><span class="line">    <span class="string">db.host=localhost</span></span><br><span class="line">    <span class="string">db.port=5432</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œåˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡</span></span><br><span class="line">kubectl create configmap app-config \</span><br><span class="line">  --from-file=app.properties \</span><br><span class="line">  --from-file=db.properties</span><br><span class="line"><span class="comment"># app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># server.port=8080</span></span><br><span class="line"><span class="comment"># log.level=INFO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># db.host=localhost</span></span><br><span class="line"><span class="comment"># db.port=5432</span></span><br><span class="line"></span><br><span class="line">$ k get cm app-config -oyaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  app.properties: |</span><br><span class="line">    server.port=8080</span><br><span class="line">    log.level=INFO</span><br><span class="line">  db.properties: |</span><br><span class="line">    db.host=localhost</span><br><span class="line">    db.port=5432</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">&quot;2025-07-05T10:49:00Z&quot;</span></span><br><span class="line">  name: app-config</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: <span class="string">&quot;726507&quot;</span></span><br><span class="line">  uid: 05c9a228-ec69-4e88-b8d8-63f97eff2651</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Pod æŒ‚è½½ ConfigMap ä¸ºæ–‡ä»¶</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configmap-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configmap-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sleep&quot;</span>, <span class="string">&quot;3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/etc/config</span>              <span class="comment"># æŒ‚è½½è·¯å¾„</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span>                   <span class="comment"># å­˜å‚¨å· åç§°</span></span><br><span class="line">    <span class="attr">configMap:</span>                            <span class="comment"># å­˜å‚¨å·ç±»å‹ä¸º ConfigMap</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">app-config</span>                    <span class="comment"># æŒ‚è½½çš„ ConfigMap åç§°ï¼Œæœ¬åˆ©ä¸­å°† configMap ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®¹å™¨å†…çš„ <code>/etc/config/</code> ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/config/app.properties</span><br><span class="line">/etc/config/db.properties</span><br><span class="line"></span><br><span class="line">$ k <span class="built_in">exec</span> -it configmap-demo -- <span class="built_in">ls</span> /etc/config/</span><br><span class="line">app.properties  db.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœåªæƒ³æŒ‚è½½ ConfigMap ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>items</code> å­—æ®µæŒ‡å®šï¼š</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configmap-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sleep&quot;</span>, <span class="string">&quot;3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/etc/config</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">    <span class="attr">configMap:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">      <span class="attr">items:</span>                   <span class="comment"># æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app.properties</span>    <span class="comment"># configMapä¸­çš„key</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">app.properties</span>   <span class="comment"># æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties</span></span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p><code>--from-env-file=app.env</code> ä¸ <code>--from-file=app.env</code> çš„åŒºåˆ«</p></li></ul><table><thead><tr><th>é¡¹ç›®</th><th><code>--from-env-file=app.env</code></th><th><code>--from-file=app.env</code></th></tr></thead><tbody><tr><td>ç”¨é€”</td><td>è§£æä¸ºç¯å¢ƒå˜é‡å½¢å¼é”®å€¼å¯¹</td><td>æŒ‰æ–‡ä»¶æ•´ä½“è¯»å…¥ä¸ºå†…å®¹</td></tr><tr><td>é€‚åˆåœºæ™¯</td><td>æƒ³æŠŠæ¯ä¸ªå˜é‡éƒ½å•ç‹¬ç”¨æ‰</td><td>æŒ‚è½½ä¸ºé…ç½®æ–‡ä»¶ä½¿ç”¨</td></tr><tr><td>data ç»“æ„</td><td>æ¯ä¸€è¡Œå˜ä¸€ä¸ªé”®å€¼å¯¹</td><td>æ–‡ä»¶åä¸º keyï¼Œå†…å®¹ä¸ºå€¼</td></tr><tr><td>è¯»å–æ–¹å¼</td><td>ç”¨ <code>envFrom</code> æ³¨å…¥ç¯å¢ƒå˜é‡</td><td>ç”¨ <code>volumeMount</code> æŒ‚è½½æ•´ä¸ªæ–‡ä»¶</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ConfigMap ä¹Ÿæ”¯æŒ <code>äºŒè¿›åˆ¶</code> æ•°æ®ï¼Œä½†éœ€è¦ç”¨ <code>base64</code> ç¼–ç </p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">config.txt:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    Hello, world!</span></span><br><span class="line"><span class="string"></span><span class="attr">binaryData:</span></span><br><span class="line">  <span class="attr">config.bin:</span> <span class="string">aGVsbG8gd29ybGQK</span>   <span class="comment"># è¿™æ˜¯ &quot;hello world&quot; çš„ base64 ç¼–ç </span></span><br></pre></td></tr></table></figure><blockquote><p>binaryData å’Œ data çš„åŒºåˆ«</p></blockquote><table><thead><tr><th>å­—æ®µ</th><th>å†…å®¹ç±»å‹</th><th>ç¼–ç æ–¹å¼</th><th>é€‚åˆå­˜å‚¨</th></tr></thead><tbody><tr><td><code>data</code></td><td>æ–‡æœ¬ï¼ˆUTF-8ï¼‰</td><td>æ˜æ–‡</td><td>é…ç½®æ–‡ä»¶ã€å‚æ•°ã€è„šæœ¬ç­‰</td></tr><tr><td><code>binaryData</code></td><td>ä»»æ„äºŒè¿›åˆ¶æ•°æ®</td><td>base64 ç¼–ç </td><td>å›¾ç‰‡ã€è¯ä¹¦ã€éUTF-8æ–‡ä»¶ç­‰</td></tr></tbody></table><blockquote><p>â—æ³¨æ„äº‹é¡¹</p></blockquote><table><thead><tr><th>é¡¹ç›®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>base64 ç¼–ç æ ¼å¼</td><td><code>binaryData</code> ä¸­çš„å€¼å¿…é¡»æ˜¯æ ‡å‡† base64ï¼Œä¸æ”¯æŒæ¢è¡Œ</td></tr><tr><td>è§£ç åå¤§å°é™åˆ¶</td><td>ConfigMap å•ä¸ªå¯¹è±¡æœ€å¤§ 1MBï¼ˆæ— è®º data è¿˜æ˜¯ binaryDataï¼‰</td></tr><tr><td>äºŒè€…å¯å…±å­˜</td><td><code>data</code> ä¸ <code>binaryData</code> å¯ä»¥åŒæ—¶å‡ºç°åœ¨åŒä¸€ä¸ª ConfigMap ä¸­ï¼ˆå­—æ®µåä¸èƒ½é‡å¤ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹ ConfigMap å ï¼š<code>k edit configmap &lt;configmap-name&gt;</code></p><ul class="lvl-2"><li class="lvl-4">å¦‚æœ Pod æ˜¯ä½œä¸º ç¯å¢ƒå˜é‡ å…³è”çš„ï¼ŒPod ä¸ä¼šæ›´æ–°ï¼Œåªèƒ½é‡æ–°åˆ›å»º</li><li class="lvl-4">å¦‚æœ Pod æ˜¯ä½œä¸º volume æŒ‚è½½çš„ï¼ŒPod ä¼šè‡ªåŠ¨æ›´æ–°(å¤§çº¦å‡ ç§’å)</li></ul></li><li class="lvl-2"><p>åˆ é™¤ ConfigMap åï¼š<code>k delete configmap &lt;configmap-name&gt;</code></p></li></ul><table><thead><tr><th>Pod çŠ¶æ€</th><th>ConfigMap åˆ é™¤åå½±å“</th></tr></thead><tbody><tr><td>æ­£åœ¨è¿è¡Œ</td><td>ä¸å—å½±å“</td></tr><tr><td>é‡å¯ / æ‰©å®¹</td><td><strong>å¤±è´¥</strong>ï¼šæ‰¾ä¸åˆ° ConfigMapï¼Œæ— æ³•åˆ›å»ºå®¹å™¨</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/&quot;&gt;k8s ConfigMap å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ StorageClass</title>
    <link href="https://blog.hanqunfeng.com/2025/07/22/k8s-storageclass/"/>
    <id>https://blog.hanqunfeng.com/2025/07/22/k8s-storageclass/</id>
    <published>2025-07-22T12:35:15.000Z</published>
    <updated>2025-07-22T08:46:03.462Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/">k8s StorageClass å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p>æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS</p></li></ul><span id="more"></span><h2 id="StorageClass-åˆ«åsc-ä»‹ç»">StorageClass(åˆ«åsc) ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>K8s çš„å­˜å‚¨èµ„æºåˆ†ä¸ºä¸¤ç§ä¾›åº”æ¨¡å¼ï¼šé™æ€ä¾›åº”æ¨¡å¼ å’Œ åŠ¨æ€ä¾›åº”æ¨¡å¼ã€‚</p><ul class="lvl-2"><li class="lvl-4">é™æ€æ¨¡å¼ä¸‹ï¼Œç®¡ç†å‘˜éœ€è¦é¢„å…ˆåˆ›å»ºè®¸å¤šPVï¼Œç­‰å¾… PVC  æ¥ç»‘å®šã€‚</li><li class="lvl-4">åŠ¨æ€æ¨¡å¼ä¸‹ï¼ŒKubernetes ä¼šé€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»º PVï¼Œå¹¶å®Œæˆä¸ PVC çš„ç»‘å®šã€‚</li></ul></li><li class="lvl-2"><p>StorageClass æ˜¯ Kubernetes ä¸­ç”¨æ¥å®šä¹‰ <code>å­˜å‚¨åç«¯ç±»å‹å’Œé…ç½®å‚æ•°</code> çš„èµ„æº</p></li><li class="lvl-2"><p>ä½œç”¨ï¼š è‡ªåŠ¨åˆ›å»º PVï¼ˆPersistentVolumeï¼‰çš„â€œæ¨¡æ¿â€æˆ–â€œè§„åˆ™â€</p></li><li class="lvl-2"><p>ä½¿ç”¨åœºæ™¯ï¼š é…åˆ PVC ä½¿ç”¨æ—¶ï¼ŒKubernetes å¯ä»¥æ ¹æ® StorageClass è‡ªåŠ¨ åŠ¨æ€åˆ›å»º å¯¹åº”çš„æŒä¹…å·ã€‚</p></li><li class="lvl-2"><p>âœ… æ ¸å¿ƒä¼˜åŠ¿ï¼š</p><ul class="lvl-2"><li class="lvl-4">æ— éœ€æ‰‹åŠ¨åˆ›å»º PV</li><li class="lvl-4">æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆNFSã€äº‘ç›˜ã€Cephã€GlusterFSã€iSCSIâ€¦ï¼‰</li></ul></li></ul><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/OGGWYb.png" alt=""></p><h2 id="åˆ›å»º-StorageClass">åˆ›å»º StorageClass</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ª NFS çš„ StorageClass çš„ yaml ç¤ºä¾‹</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs-storage.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-csi</span>                                           <span class="comment"># å­˜å‚¨ç±»åç§°</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">nfs.csi.k8s.io</span>                               <span class="comment"># æŒ‡å®šå­˜å‚¨æ’ä»¶çš„ CSI é©±åŠ¨åç§°ï¼Œéœ€è¦å®‰è£… nfs-csi-driver</span></span><br><span class="line"><span class="attr">reclaimPolicy:</span> <span class="string">Delete</span>                                     <span class="comment"># Retainï¼šPVC åˆ é™¤åï¼ŒPV ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆæ•°æ®ä¿ç•™ï¼‰ï¼Œé»˜è®¤æ˜¯ Delete,ç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚</span></span><br><span class="line"><span class="attr">allowVolumeExpansion:</span> <span class="literal">true</span>                                <span class="comment"># æ˜¯å¦å…è®¸ PVC è‡ªåŠ¨æ‰©å®¹ï¼Œnfs æ”¯æŒæ‰©å®¹</span></span><br><span class="line"><span class="attr">mountOptions:</span>                                             <span class="comment"># æŒ‚è½½é€‰é¡¹ï¼Œcsiæ’ä»¶ä¸åŒï¼Œé€‰é¡¹ä¸åŒã€‚è¿™é‡Œæ˜¯ nfsçš„</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">hard</span>                                                  <span class="comment"># æœåŠ¡å™¨å¼‚å¸¸æ—¶å®¢æˆ·ç«¯ä¼šä¸€ç›´å‘è¯·æ±‚ç›´åˆ°æŒ‚è½½æˆåŠŸ</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nfsvers=4.1</span>                                           <span class="comment"># nfsç‰ˆæœ¬    nfs4.1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nolock</span>                                                <span class="comment"># å…è®¸å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®</span></span><br><span class="line"><span class="attr">volumeBindingMode:</span> <span class="string">Immediate</span>                              <span class="comment"># é»˜è®¤å€¼ï¼šImmediate: åˆ›å»ºPVCæ—¶ç«‹å³ç»‘å®š ,WaitForFirstConsumerï¼šç­‰åˆ° Pod è°ƒåº¦åˆ°èŠ‚ç‚¹åå†åˆ†é…å·ï¼Œé€‚åˆå¤šå¯ç”¨åŒºåœºæ™¯</span></span><br><span class="line"><span class="attr">parameters:</span>                                               <span class="comment"># å‚æ•°é…ç½®</span></span><br><span class="line">  <span class="attr">server:</span> <span class="number">10.211</span><span class="number">.55</span><span class="number">.88</span>                                    <span class="comment"># nfsæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">  <span class="attr">share:</span> <span class="string">/nfs-server/data</span>                                 <span class="comment"># nfs-serverä¸Šçš„å­˜å‚¨ç›®å½•</span></span><br></pre></td></tr></table></figure><blockquote><p>csi-driver-nfs ä» v4.x èµ·ï¼Œå·²ç»æ”¯æŒ Delete reclaimPolicy å’Œ allowVolumeExpansion è‡ªåŠ¨æ‰©å®¹ã€‚<br>ç”Ÿäº§ç¯å¢ƒæ…ç”¨ Delete reclaimPolicyï¼Œå› ä¸ºæ­¤æ—¶åˆ é™¤ PVC åï¼Œnfs-server ä¸Šçš„å­˜å‚¨ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>æ¯ä¸ª StorageClass é…ç½®ä¸­æœ‰ä¸‰ä¸ªå¿…å¡«çš„å‚æ•°ï¼š<code>provisioner</code>ã€<code>parameters</code> å’Œ <code>reclaimPolicy</code> å­—æ®µï¼Œ è¿™äº›å­—æ®µä¼šåœ¨ StorageClass éœ€è¦åŠ¨æ€åˆ¶å¤‡ PersistentVolume (PV) ä»¥æ»¡è¶³ PersistentVolumeClaim (PVC) æ—¶ä½¿ç”¨åˆ°ã€‚</p></li></ul><h3 id="provisioner-å­˜å‚¨åˆ¶å¤‡å™¨">provisioner: å­˜å‚¨åˆ¶å¤‡å™¨</h3><ul class="lvl-0"><li class="lvl-2"><p>æ¯ä¸ª StorageClass éƒ½æœ‰ä¸€ä¸ªåˆ¶å¤‡å™¨ï¼ˆProvisionerï¼‰ï¼Œç”¨æ¥å†³å®šä½¿ç”¨å“ªä¸ªå·æ’ä»¶åˆ¶å¤‡ PVã€‚ è¯¥å­—æ®µå¿…é¡»æŒ‡å®šã€‚</p></li><li class="lvl-2"><p>æ¯”å¦‚ NFS å­˜å‚¨åˆ¶å¤‡å™¨ï¼š<code>provisioner: nfs.csi.k8s.io</code>ï¼Œæ˜¯ K8S å®˜æ–¹ç»´æŠ¤çš„ NFS CSI æ’ä»¶ã€‚<a href="https://github.com/kubernetes-csi/csi-driver-nfs">Github</a>ã€‚</p></li><li class="lvl-2"><p>å®‰è£… NFS CSI æ’ä»¶ï¼š<a href="https://github.com/kubernetes-csi/csi-driver-nfs/blob/master/docs/install-csi-driver-master.md">Install NFS CSI Driver</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨çº¿å®‰è£…</span></span><br><span class="line">curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/install-driver.sh | bash -s master --</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯</span></span><br><span class="line">kubectl -n kube-system get pod -o wide -l app=csi-nfs-controller</span><br><span class="line">kubectl -n kube-system get pod -o wide -l app=csi-nfs-node</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¸è½½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/uninstall-driver.sh | bash -s master --</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º StorageClass</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nfs-storage.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹ storageclass</span></span><br><span class="line">$ k get sc</span><br><span class="line">NAME      PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class="line">nfs-csi   nfs.csi.k8s.io   Delete          Immediate           <span class="literal">true</span>                   5s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º PVC æ—¶æŒ‡å®š storageclassï¼ŒStorageClass ä¼šè‡ªåŠ¨åˆ›å»º PV</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs-pvc.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-pvc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs-csi</span>  <span class="comment"># æŒ‡å®š StorageClass çš„åç§°ï¼Œå¦‚æœè®¾ç½®äº†é»˜è®¤çš„scï¼Œæ­¤å¤„å¯ä»¥åˆ é™¤è¯¥é…ç½®</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span>          <span class="comment"># æŒ‡å®šè®¿é—®æ¨¡å¼</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">800Mi</span>         <span class="comment"># ç”³è¯·çš„å®¹é‡</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º PVC</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º PVC</span></span><br><span class="line">$ k apply -f nfs-pvc.yaml</span><br><span class="line">persistentvolumeclaim/nfs-pvc created</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ PVå’ŒPVCï¼Œå¯ä»¥çœ‹åˆ° PV è‡ªåŠ¨åˆ›å»ºäº†</span></span><br><span class="line">$ k get pv,pvc</span><br><span class="line">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">persistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907   800Mi      RWX            Delete           Bound    default/nfs-pvc   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          2m4s</span><br><span class="line"></span><br><span class="line">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class="line">persistentvolumeclaim/nfs-pvc   Bound    pvc-c1d33fec-5e16-4156-8405-1af4fc171907   800Mi      RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 2m4s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è‡ªåŠ¨æ‰©å®¹ï¼Œä¿®æ”¹ PVC å®¹é‡åˆ° 1Gi</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit pvc nfs-pvc</span><br><span class="line"><span class="comment"># ä¿®æ”¹å¦‚ä¸‹</span></span><br><span class="line"><span class="comment"># &quot;storage&quot;:&quot;1Gi&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° è‡ªåŠ¨æ‰©å®¹æˆåŠŸ</span></span><br><span class="line">$ k get pv,pvc</span><br><span class="line">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">persistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907   1Gi        RWX            Delete           Bound    default/nfs-pvc   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          4m50s</span><br><span class="line"></span><br><span class="line">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class="line">persistentvolumeclaim/nfs-pvc   Bound    pvc-c1d33fec-5e16-4156-8405-1af4fc171907   1Gi        RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 4m50s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤PVCï¼Œè‡ªåŠ¨åˆ é™¤PV</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pvc nfs-pvc</span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° PV å·²ç»è¢«è‡ªåŠ¨åˆ é™¤ï¼Œ reclaimPolicy: Delete</span></span><br><span class="line">$ k get pv,pvc</span><br><span class="line">No resources found</span><br><span class="line"><span class="comment"># æ­¤æ—¶ nfs-server çš„ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨</span></span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®é»˜è®¤çš„-StorageClass">è®¾ç½®é»˜è®¤çš„ StorageClass</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢æˆ‘ä»¬åˆ›å»º PVC çš„æ—¶å€™éœ€è¦æŒ‡å®š StorageClassï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œé‚£ä¹ˆåœ¨PVCé‡Œå°±å¯ä»¥çœç•¥æ‰ StorageClass çš„è®¾ç½®ã€‚</p></li><li class="lvl-2"><p>K8S ä¸­åªèƒ½è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚</p></li><li class="lvl-2"><p>è®¾ç½®é»˜è®¤çš„ StorageClass</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸º sc æ·»åŠ  `é»˜è®¤` æ³¨è§£ï¼Œå»æ‰è¯¥æ³¨è§£ æˆ–è€… è®¾ç½®ä¸º false å°±å–æ¶ˆé»˜è®¤äº†ã€‚</span></span><br><span class="line">$ kubectl patch storageclass nfs-csi -p <span class="string">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class="line">storageclass.storage.k8s.io/nfs-csi patched</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹scï¼Œæ­¤æ—¶çœ‹åˆ°åç§°åé¢å¤šäº†ä¸€ä¸ª (default) ï¼Œè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ StorageClass</span></span><br><span class="line">$ k get sc</span><br><span class="line">NAME                PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class="line">nfs-csi (default)   nfs.csi.k8s.io   Delete          Immediate           <span class="literal">true</span>                   14m</span><br></pre></td></tr></table></figure><h2 id="StatefulSet-è‡ªåŠ¨åˆ›å»º-PVC">StatefulSet: è‡ªåŠ¨åˆ›å»º PVC</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢çš„æ–¹å¼è¿˜æ˜¯è¦æ±‚æˆ‘ä»¬å¿…é¡»åˆ›å»º PVCï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä¸ç”¨åˆ›å»º PVC ï¼Œè€Œæ˜¯åœ¨åˆ›å»ºæ§åˆ¶å™¨çš„æ—¶å€™å°±ä¸€èµ·æŠŠ PVC åˆ›å»ºå¥½å‘¢ï¼Ÿ</p></li><li class="lvl-2"><p>ç›®å‰åªæœ‰ <code>StatefulSet</code>æ§åˆ¶å™¨ æ‰æ”¯æŒè‡ªåŠ¨åˆ›å»º PVC</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis-statefulset.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>                  <span class="comment"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æº</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span>                    <span class="comment"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-sts</span>                    <span class="comment"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">sts-ns</span></span><br><span class="line"><span class="attr">spec:</span>                                <span class="comment"># é…ç½®é¡¹</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span>           <span class="comment"># ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚</span></span><br><span class="line">  <span class="attr">selector:</span>                          <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>                     <span class="comment"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">redis</span>                     <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class="line">  <span class="attr">updateStrategy:</span>                    <span class="comment"># æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ ·</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span>              <span class="comment"># 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚</span></span><br><span class="line">                                     <span class="comment"># 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span>                   <span class="comment"># æ»šåŠ¨å‡çº§çš„é…ç½®</span></span><br><span class="line">      <span class="attr">partition:</span> <span class="number">0</span>                   <span class="comment"># ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">redis-svc</span>             <span class="comment"># æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹ï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºå¥½</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span>                        <span class="comment"># å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1</span></span><br><span class="line">  <span class="attr">template:</span>                          <span class="comment"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">redis</span>                   <span class="comment"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">redis:6.2</span>             <span class="comment"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis</span>                  <span class="comment"># å®¹å™¨çš„åç§°</span></span><br><span class="line">        <span class="attr">volumeMounts:</span>                <span class="comment"># æŒ‚è½½æ•°æ®å·</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/data</span>           <span class="comment"># Redis æŒä¹…åŒ–æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span>              <span class="comment"># é…ç½® PVC æ¨¡æ¿</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">redis-data</span>               <span class="comment"># PVC åç§°</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">ReadWriteMany</span>              <span class="comment"># è®¿é—®æ¨¡å¼ï¼šå¤šèŠ‚ç‚¹è¯»å†™</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">500Mi</span>             <span class="comment"># è¯·æ±‚çš„å­˜å‚¨å®¹é‡ï¼Œæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´</span></span><br><span class="line">      <span class="attr">storageClassName:</span> <span class="string">nfs-csi</span>      <span class="comment"># å­˜å‚¨ç±»åç§°ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤å­˜å‚¨ç±»ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®š</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º StatefulSetï¼Œå¹¶æŸ¥çœ‹ PV,PVC</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º StatefulSet</span></span><br><span class="line">$ kubectl apply -f redis-statefulset.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ PV,PVC</span></span><br><span class="line">$ k get pv,pvc -n sts-ns</span><br><span class="line">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">persistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-1   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          19s</span><br><span class="line">persistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-0   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          22s</span><br><span class="line"></span><br><span class="line">NAME                                           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class="line">persistentvolumeclaim/redis-data-redis-sts-0   Bound    pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 22s</span><br><span class="line">persistentvolumeclaim/redis-data-redis-sts-1   Bound    pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 20s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>StatefulSet çš„ volumeClaimTemplates æ¯ä¸ª Pod å•ç‹¬åˆ›å»º PVCï¼ŒPod å’Œ PVC ä¸€ä¸€å¯¹åº”ï¼Œå³æœ‰å‡ ä¸ªå‰¯æœ¬å°±åˆ›å»ºå‡ ä¸ª PVCã€‚PVC åç§°æ˜¯ï¼š<code>&lt;volumeClaimTemplates.metadata.name&gt;-&lt;statefulset-name&gt;-&lt;pod-ordinal&gt;</code></p></li><li class="lvl-2"><p>åˆ é™¤ StatefulSet</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f redis-statefulset.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ PV,PVCï¼Œå‘ç°åˆ é™¤ StatefulSet åï¼ŒPV å’Œ PVC æ˜¯ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ PVC</span></span><br><span class="line">$ k get pv,pvc -n sts-ns</span><br><span class="line">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">persistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-1   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          6m30s</span><br><span class="line">persistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-0   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          6m33s</span><br><span class="line"></span><br><span class="line">NAME                                           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class="line">persistentvolumeclaim/redis-data-redis-sts-0   Bound    pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 6m33s</span><br><span class="line">persistentvolumeclaim/redis-data-redis-sts-1   Bound    pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 6m31s</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨åˆ é™¤ PVCï¼Œå› ä¸ºscé…ç½®çš„å›æ”¶ç­–ç•¥ä¸º Deleteï¼Œæ‰€ä»¥ PV ä¹Ÿä¼šè¢«åˆ é™¤</span></span><br><span class="line">k delete pvc -n sts-ns redis-data-redis-sts-0</span><br><span class="line">k delete pvc -n sts-ns redis-data-redis-sts-1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®é™…ä¸Šï¼Œæ— è®ºæ˜¯åˆ é™¤ statefulset è¿˜æ˜¯ç¼©å®¹ statefulsetï¼ŒPVC éƒ½ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/&quot;&gt;k8s StorageClass å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ æŒä¹…å· PV å’Œ PVC</title>
    <link href="https://blog.hanqunfeng.com/2025/07/21/k8s-storage-pv-pvc/"/>
    <id>https://blog.hanqunfeng.com/2025/07/21/k8s-storage-pv-pvc/</id>
    <published>2025-07-21T15:35:15.000Z</published>
    <updated>2025-07-22T08:52:10.994Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/">k8s PV/PVC å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p>æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS</p></li></ul><span id="more"></span><h2 id="PV-å’Œ-PVC-ä»‹ç»">PV å’Œ PVC ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>PV(PersistentVolume) æ˜¯ Kubernetes ä¸­çš„ä¸€ç§å­˜å‚¨èµ„æºï¼Œç”¨äºå°†åº•å±‚çš„ç‰©ç†å­˜å‚¨ï¼ˆå¦‚ NFSã€iSCSIã€Cephã€äº‘å­˜å‚¨ç­‰ï¼‰æŠ½è±¡æˆ Kubernetes èµ„æºï¼Œä¾› Pod ä½¿ç”¨ã€‚å®ƒæ˜¯å¯¹å­˜å‚¨çš„ä¸€ç§â€œå£°æ˜å¼â€ç®¡ç†ï¼Œç±»ä¼¼äº Pod å£°æ˜è®¡ç®—èµ„æºã€‚PV æ˜¯é›†ç¾¤çº§åˆ«çš„å­˜å‚¨èµ„æºï¼Œä¸æ”¯æŒ Namespaceã€‚</p></li><li class="lvl-2"><p>PVC(PersistentVolumeClaim)ï¼ŒæŒä¹…å·å£°æ˜ï¼Œ æ˜¯ Kubernetes ä¸­ç”¨äºç”³è¯·å­˜å‚¨èµ„æºçš„å¯¹è±¡ã€‚PVC æ˜¯ Namespace çº§åˆ«çš„èµ„æºã€‚</p></li><li class="lvl-2"><p>ç®€è€Œè¨€ä¹‹ï¼š</p><ul class="lvl-2"><li class="lvl-4">PV æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œç”±ç®¡ç†å‘˜æå‰é…ç½®æˆ–åŠ¨æ€åˆ›å»ºã€‚</li><li class="lvl-4">PVCï¼ˆPersistentVolumeClaimï¼‰ æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„ç”³è¯·ã€‚</li><li class="lvl-4">Pod é€šè¿‡ PVC ç»‘å®šåˆ° PVï¼Œä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ã€‚</li><li class="lvl-4">å¼€å‘è€…ç”¨ PVC æ¥ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œä¸å…³å¿ƒå­˜å‚¨çš„å…·ä½“å®ç°æ–¹å¼ã€‚</li><li class="lvl-4">PVC é€šè¿‡ Kubernetes è‡ªåŠ¨åŒ¹é…ä¸€ä¸ªåˆé€‚çš„ PersistentVolumeï¼ˆPVï¼‰è¿›è¡Œç»‘å®šã€‚</li></ul></li><li class="lvl-2"><p>PV ä¸ PVC çš„åŸºæœ¬æµç¨‹</p><ul class="lvl-2"><li class="lvl-4">ç®¡ç†å‘˜åˆ›å»º PVï¼ˆæˆ–è€…é›†ç¾¤é€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚</li><li class="lvl-4">ç”¨æˆ·æäº¤ PVCï¼Œå£°æ˜è‡ªå·±éœ€è¦å¤šå°‘å®¹é‡ã€ä»€ä¹ˆè®¿é—®æ¨¡å¼ã€‚</li><li class="lvl-4">Kubernetes æŸ¥æ‰¾å¯ç”¨çš„ PVï¼Œæ¡ä»¶ç¬¦åˆï¼ˆå®¹é‡ã€è®¿é—®æ¨¡å¼ã€StorageClassï¼‰å°±è‡ªåŠ¨ç»‘å®šã€‚</li><li class="lvl-4">Pod æŒ‚è½½ PVCï¼Œå®ç°æŒä¹…åŒ–å­˜å‚¨ã€‚</li></ul></li></ul><h2 id="PV-ç¤ºä¾‹">PV ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ PV ç¤ºä¾‹</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pv-nfs.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv-nfs-1g</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span>                 <span class="comment"># å­˜å‚¨å·æ¨¡å¼ï¼Œé»˜è®¤ä¸º Filesystem</span></span><br><span class="line">  <span class="attr">capacity:</span>                              <span class="comment"># å­˜å‚¨èƒ½åŠ›</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span>                         <span class="comment"># å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi</span></span><br><span class="line">  <span class="attr">accessModes:</span>                           <span class="comment"># è®¿é—®æ¨¡å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span>                      <span class="comment"># è®¿é—®æ¨¡å¼</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span>  <span class="comment"># å›æ”¶ç­–ç•¥</span></span><br><span class="line">  <span class="attr">nfs:</span>                                   <span class="comment"># æŒä¹…å·ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs-server/data/pv-nfs-1g</span>     <span class="comment"># å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">10.211</span><span class="number">.55</span><span class="number">.88</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv-nfs-2g</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span>                              <span class="comment"># å­˜å‚¨èƒ½åŠ›</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">2Gi</span>                         <span class="comment"># å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi</span></span><br><span class="line">  <span class="attr">accessModes:</span>                           <span class="comment"># è®¿é—®æ¨¡å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span>                      <span class="comment"># è®¿é—®æ¨¡å¼</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span>  <span class="comment"># å›æ”¶ç­–ç•¥</span></span><br><span class="line">  <span class="attr">nfs:</span>                                   <span class="comment"># å­˜å‚¨ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs-server/data/pv-nfs-2g</span>     <span class="comment"># å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">10.211</span><span class="number">.55</span><span class="number">.88</span></span><br></pre></td></tr></table></figure><h3 id="å­˜å‚¨å·æ¨¡å¼">å­˜å‚¨å·æ¨¡å¼</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#volume-mode">å®˜ç½‘æ–‡æ¡£:å­˜å‚¨å·æ¨¡å¼</a></p></li><li class="lvl-2"><p>Kubernetes æ”¯æŒä¸¤ç§å·æ¨¡å¼ï¼ˆvolumeModesï¼‰ï¼šFilesystemï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ å’Œ Blockï¼ˆå—ï¼‰ã€‚</p></li><li class="lvl-2"><p>å¦‚æœè¯¥å‚æ•°è¢«çœç•¥ï¼Œé»˜è®¤çš„å·æ¨¡å¼æ˜¯ Filesystemã€‚</p></li><li class="lvl-2"><p>volumeMode å±æ€§è®¾ç½®ä¸º Filesystem çš„å·ä¼šè¢« Pod æŒ‚è½½ï¼ˆMountï¼‰ åˆ°æŸä¸ªç›®å½•ã€‚</p></li></ul><h3 id="æŒä¹…å·ç±»å‹">æŒä¹…å·ç±»å‹</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes">å®˜ç½‘æ–‡æ¡£:æŒä¹…å·ç±»å‹</a></p></li><li class="lvl-2"><p>âœ… å½“å‰æ”¯æŒçš„æ’ä»¶</p></li></ul><table><thead><tr><th>æ’ä»¶ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>csi</strong></td><td><strong>å®¹å™¨å­˜å‚¨æ¥å£ï¼ˆCSIï¼‰</strong>ï¼Œæ¨èçš„ç°ä»£å­˜å‚¨æ¥å£</td></tr><tr><td><strong>fc</strong></td><td>Fibre Channel å­˜å‚¨</td></tr><tr><td><strong>hostPath</strong></td><td>HostPath å·ï¼ˆä»…ä¾›å•èŠ‚ç‚¹æµ‹è¯•ä½¿ç”¨ï¼›å¤šèŠ‚ç‚¹ä¸æ¨èï¼Œæ¨èä½¿ç”¨ local å·æ›¿ä»£ï¼‰</td></tr><tr><td><strong>iscsi</strong></td><td>iSCSIï¼ˆåŸºäº IP çš„ SCSI å­˜å‚¨ï¼‰</td></tr><tr><td><strong>local</strong></td><td>èŠ‚ç‚¹æœ¬åœ°å­˜å‚¨è®¾å¤‡</td></tr><tr><td><strong>nfs</strong></td><td>ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰å­˜å‚¨</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>âš ï¸ å·²å¼ƒç”¨ä½†ä»å¯ç”¨ï¼ˆéœ€ CSI è¿ç§»ï¼‰</p></li></ul><table><thead><tr><th>æ’ä»¶ç±»å‹</th><th>æè¿°</th><th>CSI è¿ç§»çŠ¶æ€</th></tr></thead><tbody><tr><td><strong>awsElasticBlockStore</strong></td><td>AWS EBS å—å­˜å‚¨</td><td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>azureDisk</strong></td><td>Azure ç£ç›˜å­˜å‚¨</td><td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>azureFile</strong></td><td>Azure æ–‡ä»¶å­˜å‚¨</td><td>ä» v1.24 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>cinder</strong></td><td>OpenStack å—å­˜å‚¨</td><td>ä» v1.21 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>flexVolume</strong></td><td>FlexVolumeï¼ˆæ— è¿ç§»è®¡åˆ’ï¼Œä½†æœªè®¡åˆ’ç§»é™¤ï¼‰</td><td>ä» v1.23 å¼€å§‹å¼ƒç”¨</td></tr><tr><td><strong>gcePersistentDisk</strong></td><td>GCP æŒä¹…ç£ç›˜</td><td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>portworxVolume</strong></td><td>Portworx å­˜å‚¨å·</td><td>ä» v1.31 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>vsphereVolume</strong></td><td>vSphere VMDK å·</td><td>ä» v1.25 å¼€å§‹é»˜è®¤è¿ç§»</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>âŒ å·²åºŸå¼ƒ/å³å°†ç§»é™¤çš„ In-Tree æ’ä»¶</p></li></ul><table><thead><tr><th>æ’ä»¶ç±»å‹</th><th>æè¿°</th><th>å¼ƒç”¨/ç§»é™¤ç‰ˆæœ¬</th></tr></thead><tbody><tr><td><strong>cephfs</strong></td><td>Ceph æ–‡ä»¶ç³»ç»Ÿå·</td><td>v1.31 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>flocker</strong></td><td>Flocker å­˜å‚¨</td><td>v1.25 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>glusterfs</strong></td><td>GlusterFS å­˜å‚¨</td><td>v1.26 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>photonPersistentDisk</strong></td><td>Photon æŒä¹…ç£ç›˜</td><td>v1.15 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>quobyte</strong></td><td>Quobyte å·</td><td>v1.25 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>rbd</strong></td><td>Rados å—è®¾å¤‡ï¼ˆCeph RBDï¼‰</td><td>v1.31 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>scaleIO</strong></td><td>ScaleIO å·</td><td>v1.21 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>storageos</strong></td><td>StorageOS å·</td><td>v1.25 ä¹‹åä¸å¯ç”¨</td></tr></tbody></table><h3 id="accessModes-è®¿é—®æ¨¡å¼">accessModes è®¿é—®æ¨¡å¼</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#access-modes">å®˜ç½‘æ–‡æ¡£:è®¿é—®æ¨¡å¼</a></p></li></ul><table><thead><tr><th>è®¿é—®æ¨¡å¼</th><th>è¯´æ˜</th><th>æ˜¯å¦è·¨èŠ‚ç‚¹æŒ‚è½½</th><th>æ˜¯å¦æ”¯æŒå¤š Pod æŒ‚è½½</th><th>æ˜¯å¦æ”¯æŒè¯»å†™</th></tr></thead><tbody><tr><td><strong>ReadWriteOnce (RWO)</strong></td><td>å·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼ŒåŒä¸€èŠ‚ç‚¹å†…å¤šä¸ª Pod å¯å…±äº«ä½¿ç”¨ã€‚</td><td>âŒ å¦</td><td>âœ… æ˜¯ï¼ˆåŒä¸€èŠ‚ç‚¹ï¼‰</td><td>âœ… æ˜¯</td></tr><tr><td><strong>ReadOnlyMany (ROX)</strong></td><td>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æŒ‚è½½ã€‚</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td>âŒ å¦ï¼ˆåªè¯»ï¼‰</td></tr><tr><td><strong>ReadWriteMany (RWX)</strong></td><td>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ã€‚</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td></tr><tr><td><strong>ReadWriteOncePod (RWOP)</strong></td><td>å·åªèƒ½è¢«å•ä¸ª Pod ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼Œç¡®ä¿é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª Pod ä½¿ç”¨è¯¥å·ï¼ˆv1.29+ç¨³å®šï¼‰ã€‚</td><td>âŒ å¦</td><td>âŒ å¦ï¼ˆåªèƒ½ä¸€ä¸ª Podï¼‰</td><td>âœ… æ˜¯</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>NFS æ”¯æŒå‰ä¸‰ç§è®¿é—®æ¨¡å¼ï¼ŒhostPath åªæ”¯æŒ ReadWriteOnceã€‚</p></li></ul><h3 id="persistentVolumeReclaimPolicy-å›æ”¶ç­–ç•¥">persistentVolumeReclaimPolicy å›æ”¶ç­–ç•¥</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy">å®˜æ–¹æ–‡æ¡£:å›æ”¶ç­–ç•¥</a></p></li></ul><table><thead><tr><th>å›æ”¶ç­–ç•¥</th><th>å«ä¹‰</th><th>å›æ”¶è¡Œä¸º</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Retain</strong></td><td><strong>ä¿ç•™</strong>ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨ä»ç„¶ä¿ç•™</td><td>æ‰‹åŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤å PV çŠ¶æ€ä¸º <code>Released</code>ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†æˆ–é‡æ–°ç»‘å®š</td><td>é‡è¦æ•°æ®ï¼Œé¿å…è¯¯åˆ ï¼›å¦‚æ•°æ®åº“æ•°æ®ç›˜</td></tr><tr><td><strong>Delete</strong></td><td><strong>åˆ é™¤</strong>ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨éƒ½ä¼šè¢«åˆ é™¤</td><td>è‡ªåŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤æ—¶è‡ªåŠ¨åˆ é™¤ PV å’Œåç«¯å­˜å‚¨èµ„æºï¼ˆå¦‚äº‘ç›˜ï¼‰</td><td>ä¸´æ—¶æ•°æ®ã€ä¸é‡è¦çš„å­˜å‚¨</td></tr><tr><td><strong>Recycle</strong></td><td><strong>å›æ”¶</strong>ï¼šç®€å•æ¸…ç©ºæ•°æ®</td><td>è‡ªåŠ¨æ‰§è¡Œ <code>rm -rf /thevolume/*</code>ï¼Œç„¶å PV å˜å› <code>Available</code> çŠ¶æ€</td><td>æ—§ç‰ˆæœ¬é›†ç¾¤çš„å°æ–‡ä»¶ä¸´æ—¶å­˜å‚¨</td></tr></tbody></table><div class="warning"><ul class="lvl-1"><li class="lvl-2"><p><strong>æ³¨æ„</strong>: åˆ›å»º <strong>Recycle</strong> çš„ PV æ—¶ï¼Œä¼šæç¤ºå¦‚ä¸‹å†…å®¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: spec.persistentVolumeReclaimPolicy: The Recycle reclaim policy is deprecated. Instead, the recommended approach is to use dynamic provisioning.</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2"><p>æ„æ€å°±æ˜¯ <strong>Recycle</strong> ç­–ç•¥å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨<code>åŠ¨æ€ä¾›åº”æ¨¡å¼</code>ã€‚ä½†<a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy">å®˜æ–¹æ–‡æ¡£</a>ä¸­å´æç¤º <code>å¯¹äº Kubernetes 1.33 æ¥è¯´ï¼Œåªæœ‰ nfs å’Œ hostPath å·ç±»å‹æ”¯æŒå›æ”¶ï¼ˆRecycleï¼‰ã€‚</code></p></li><li class="lvl-2"><p>æœ¬äººåœ¨ Kubernetes 1.33.2 ä¸­æµ‹è¯•ï¼ŒNFS æ”¯æŒ Recycleï¼Œåˆ é™¤ PVC å PV çŠ¶æ€ä¼šå˜ä¸º <strong>Available</strong></p></li></ul></div><h3 id="ç®¡ç†-PV">ç®¡ç† PV</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º</span></span><br><span class="line">kubectl create -f pv-nfs.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">$ k get pv</span><br><span class="line">NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">pv-nfs-1g   1Gi        RWO            Retain           Available                          &lt;<span class="built_in">unset</span>&gt;                          80s</span><br><span class="line">pv-nfs-2g   2Gi        RWX            Retain           Available                          &lt;<span class="built_in">unset</span>&gt;                          80s</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line">kubectl delete pv pv-nfs-1g</span><br><span class="line">k delete -f pv-nfs.yaml</span><br></pre></td></tr></table></figure><h2 id="PVC-ç¤ºä¾‹">PVC ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Pod é€šè¿‡ PVC å‘ PV ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœ PVC ä¸€ç›´æ— æ³•åŒ¹é…åˆ° PVï¼Œåˆ™ PVC å¤„äº Pending çŠ¶æ€ã€‚</p></li><li class="lvl-2"><p>Pod å¿…é¡»ä¸ PVC å¤„äºåŒä¸€å‘½åç©ºé—´ã€‚</p></li><li class="lvl-2"><p>PVC ä¸ PV æ˜¯ 1:1 çš„å…³ç³»ã€‚ä¸€æ—¦ PV ç»‘å®šåˆ° PVCï¼Œåˆ™ PVC çŠ¶æ€å˜ä¸º Boundã€‚è¯¥ PV å°†ä¸å†è¢«å…¶ä»– PVC ç»‘å®šã€‚</p></li><li class="lvl-2"><p>PVC ä¸ PV åŒ¹é…çš„æ¡ä»¶</p></li></ul><table><thead><tr><th>åŒ¹é…æ¡ä»¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å®¹é‡</strong></td><td><strong>PVC è¯·æ±‚çš„å®¹é‡ â‰¤ PV æä¾›çš„å®¹é‡</strong>ã€‚PV å¿…é¡»è‡³å°‘æ»¡è¶³ PVC çš„å®¹é‡è¯·æ±‚ã€‚</td></tr><tr><td><strong>è®¿é—®æ¨¡å¼</strong></td><td><strong>PV æ”¯æŒ PVC è¯·æ±‚çš„è®¿é—®æ¨¡å¼</strong>ã€‚PVC è¦æ±‚çš„æ‰€æœ‰è®¿é—®æ¨¡å¼ï¼ŒPV éƒ½å¿…é¡»å…·å¤‡ã€‚ä¾‹å¦‚ï¼šPVC è¦æ±‚ <code>ReadWriteOnce</code>ï¼ŒPV è‡³å°‘è¦æ”¯æŒ <code>ReadWriteOnce</code>ã€‚</td></tr><tr><td><strong>StorageClass</strong></td><td><strong>PVC å’Œ PV çš„ <code>storageClassName</code> å¿…é¡»ä¸€è‡´</strong>ã€‚å¦‚æœ PVC æŒ‡å®šäº† <code>storageClassName</code>ï¼Œåªèƒ½ç»‘å®šåŒåçš„ PVã€‚</td></tr><tr><td><strong>Selectorï¼ˆå¯é€‰ï¼‰</strong></td><td>å¦‚æœ PVC æœ‰è®¾ç½® <code>selector</code>ï¼ˆåŸºäºæ ‡ç­¾ï¼‰ï¼ŒPV çš„æ ‡ç­¾ä¹Ÿå¿…é¡»åŒ¹é…ã€‚</td></tr></tbody></table><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">PV ä¸­å£°æ˜çš„ <code>accessModes</code> ä»…ä½œä¸ºä¸ PVC çš„è®¿é—®æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå®é™…æŒ‚è½½åˆ° Pod åï¼Œä¸ä¼šé™åˆ¶ Pod çš„è¯»å†™è®¿é—®</li></ul></div><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ªç®€å•çš„ yaml</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pvc.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mypvc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span>   <span class="comment"># ç”³è¯·åŒ¹é…çš„è®¿é—®æ¨¡å¼</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">500Mi</span>  <span class="comment"># ç”³è¯·çš„å®¹é‡ï¼Œå®é™…å®¹é‡ä»¥åŒ¹é…çš„ PV ä¸ºå‡†</span></span><br><span class="line">  <span class="comment"># selector:         # åŒ¹é…çš„ PV æ ‡ç­¾</span></span><br><span class="line">  <span class="comment">#   matchLabels:</span></span><br><span class="line">  <span class="comment">#     pv: nfs-pv1   # pv çš„æ ‡ç­¾ï¼Œåˆ›å»º pv æ—¶è¦æŒ‡å®š</span></span><br></pre></td></tr></table></figure><h3 id="ç®¡ç†-PVC">ç®¡ç† PVC</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º PVC</span></span><br><span class="line">kubectl apply -f pvc.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹PVCï¼Œæ­¤æ—¶çœ‹åˆ° pv-nfs-1g ç»‘å®šäº† PVC</span></span><br><span class="line">$ k get pv,pvc</span><br><span class="line">NAME                         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">persistentvolume/pv-nfs-1g   1Gi        RWO            Retain           Available                                  &lt;<span class="built_in">unset</span>&gt;                          16s</span><br><span class="line">persistentvolume/pv-nfs-2g   2Gi        RWX            Retain           Bound       default/mypvc                  &lt;<span class="built_in">unset</span>&gt;                          16s</span><br><span class="line"></span><br><span class="line">NAME                          STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class="line">persistentvolumeclaim/mypvc   Bound    pv-nfs-2g   2Gi        RWX                           &lt;<span class="built_in">unset</span>&gt;                 9s</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ PVC</span></span><br><span class="line">kubectl delete pvc mypvc</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶å†æ¬¡æŸ¥çœ‹ PVï¼Œpv-nfs-1g çŠ¶æ€å˜æ›´ä¸º Releasedï¼Œè¡¨ç¤ºå·²ç»é‡Šæ”¾ï¼Œä½†æ˜¯ä¸èƒ½å†è¢«å…¶å®ƒ PVC ç»‘å®šäº†ï¼Œåªèƒ½åˆ é™¤é‡å»ºäº†</span></span><br><span class="line">$ k get pv</span><br><span class="line">NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">pv-nfs-1g   1Gi        RWO            Retain           Available                                              &lt;<span class="built_in">unset</span>&gt;                          18m</span><br><span class="line">pv-nfs-2g   2Gi        RWX            Retain           Released     default/mypvc                             &lt;<span class="built_in">unset</span>&gt;                          18m</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ PV</span></span><br><span class="line">k delete pv pv-nfs-1g</span><br></pre></td></tr></table></figure><h2 id="Pod-ç»‘å®š-PVC">Pod ç»‘å®š PVC</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œä»¥ nginx deployment ä¸ºä¾‹</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx-pvc-deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-pvc-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span>                              <span class="comment"># 3ä¸ª podä¼šå…±äº«ä¸€ä¸ª PVC</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pvc</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pvc</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-storage</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span>  <span class="comment"># æŒ‚è½½åˆ° nginx çš„é»˜è®¤ç½‘é¡µç›®å½•</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-storage</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span>              <span class="comment"># æŒ‡å®šå­˜å‚¨å·ç±»å‹æ˜¯ PVC</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">mypvc</span>                  <span class="comment"># å¯¹åº”ä½ åˆ›å»ºçš„ PVC åç§°</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ª PVC å¯¹åº”ä¸€ä¸ª PVï¼Œä½†æ˜¯ä¸€ä¸ª PVC å¯ä»¥å¯¹åº”å¤šä¸ª Deployment ç­‰æ§åˆ¶å™¨ã€‚ä¸‹é¢æˆ‘ä»¬å°±å†åˆ›å»ºä¸€ä¸ª Deploymentï¼Œå°† ç›¸åŒçš„ PVC æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œå¹¶ä¸”æ¯éš”5ç§’ä¿®æ”¹ä¸€æ¬¡ PVC æŒ‚è½½çš„ç½‘é¡µï¼Œå¹¶é€šè¿‡ nginx å®¹å™¨æŸ¥çœ‹ç»“æœ</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># busybox-deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;while true; do echo $(date) &gt; /data/index.html; sleep 5; done&quot;</span>]</span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-volume</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">mypvc</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåæŸ¥çœ‹ pod ip</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ k get pod -o wide</span><br><span class="line">NAME                                    READY   STATUS    RESTARTS   AGE     IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">busybox-deployment-d7589665d-dx2rs      1/1     Running   0          2m59s   10.244.126.6     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-pvc-deployment-775b8c4f8b-89cw7   1/1     Running   0          44s     10.244.126.8     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-pvc-deployment-775b8c4f8b-fszlf   1/1     Running   0          44s     10.244.194.123   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-pvc-deployment-775b8c4f8b-w9qkt   1/1     Running   0          44s     10.244.126.7     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è®¿é—®ä»»æ„ä¸€ä¸ª nginx pod</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­¤æ—¶ä¼šçœ‹åˆ°é¡µé¢å†…å®¹åœ¨å˜åŒ–</span></span><br><span class="line">watch -n 5 curl 10.244.194.123</span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸º pod ç»‘å®š pvcæ—¶ï¼Œæ¯æ¬¡éƒ½è¦å…ˆåˆ›å»º pv å’Œ pvcï¼Œéå¸¸éº»çƒ¦ã€‚æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ</p><blockquote><p>ä½¿ç”¨ StorageClass å®ç°è‡ªåŠ¨åˆ›å»º PVï¼Œæˆ‘ä»¬ä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•å®ç°ã€‚</p></blockquote></li><li class="lvl-2"><p>å¦‚æœ PVC è¢« Pod ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PVC å—ï¼Ÿ</p><blockquote><p>ä¸å¯ä»¥ï¼ŒPVC è¢« Pod ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… Pod åˆ é™¤åæ‰èƒ½åˆ é™¤ PVCã€‚<br>è‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PVC å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PVC çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PVC çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“å­˜Podå¯¹å‚¨å·çš„ä½¿ç”¨ã€‚<br>æ­¤æ—¶ä¸€æ—¦Pod åˆ é™¤ï¼ŒPVC å°±ä¼šè¢«åˆ é™¤ã€‚</p></blockquote></li><li class="lvl-2"><p>å¦‚æœPV è¢« PVC ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PV å—ï¼Ÿ</p><blockquote><p>ä¸å¯ä»¥ï¼ŒPV è¢« PVC ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… PVC åˆ é™¤åæ‰èƒ½åˆ é™¤ PVã€‚<br>è‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PV å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PV çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PV çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“Podå¯¹å­˜å‚¨å·çš„ä½¿ç”¨ã€‚<br>æ­¤æ—¶ä¸€æ—¦ PVC åˆ é™¤ï¼ŒPV å°±ä¼šè¢«åˆ é™¤ã€‚</p></blockquote></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/&quot;&gt;k8s PV/PVC å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ å­˜å‚¨å· NFS</title>
    <link href="https://blog.hanqunfeng.com/2025/07/21/k8s-storage-nfs/"/>
    <id>https://blog.hanqunfeng.com/2025/07/21/k8s-storage-nfs/</id>
    <published>2025-07-21T15:34:15.000Z</published>
    <updated>2025-07-21T08:34:49.791Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· NFS ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li></ul><span id="more"></span><h2 id="å­˜å‚¨å·-NFS-ä»‹ç»">å­˜å‚¨å· NFS ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ Kubernetes ä¸­ï¼ŒNFS (Network File System) æ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œå°†è¿œç¨‹å­˜å‚¨æŒ‚è½½åˆ° Pod çš„æ–¹å¼ã€‚å®ƒå…è®¸å¤šä¸ª Pod è·¨èŠ‚ç‚¹å…±äº«ç›¸åŒçš„å­˜å‚¨ç›®å½•ï¼Œå¸¸ç”¨äº ReadWriteManyï¼ˆRWXï¼‰ åœºæ™¯ã€‚</p></li><li class="lvl-2"><p>æˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªNFS æœåŠ¡å™¨ï¼Œå¹¶é…ç½® NFS å­˜å‚¨å·ã€‚å…·ä½“å¯ä»¥å‚è€ƒ <a href="/2025/07/21/linux-nfs/" title="Linux å®‰è£… NFS">Linux å®‰è£… NFS</a></p></li><li class="lvl-2"><p>k8sä¸­æ¯ä¸ªworkerèŠ‚ç‚¹éƒ½éœ€è¦å®‰è£… NFS å®¢æˆ·ç«¯ï¼Œä½†æ˜¯ä¸éœ€è¦æŒ‚è½½ NFS å­˜å‚¨å·ï¼Œè¿™ä¸ªä¼šåœ¨podä¸­è¿›è¡Œã€‚</p></li></ul><h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ pod ç¤ºä¾‹</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs-direct-pod.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-direct-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data</span>          <span class="comment"># å®¹å™¨å†…æŒ‚è½½ç‚¹</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span></span><br><span class="line">    <span class="attr">nfs:</span></span><br><span class="line">      <span class="attr">server:</span> <span class="number">10.211</span><span class="number">.55</span><span class="number">.88</span>      <span class="comment"># NFS æœåŠ¡ç«¯åœ°å€</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/nfs-server/data</span>    <span class="comment"># NFS æœåŠ¡ç«¯å…±äº«ç›®å½•</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">false</span>           <span class="comment"># æ˜¯å¦åªè¯»æŒ‚è½½ï¼Œfalse è¡¨ç¤ºå¯è¯»å†™</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º Pod</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nfs-direct-pod.yaml</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ Pod æŒ‚è½½ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹podéƒ¨ç½²åˆ°å“ªä¸ªèŠ‚ç‚¹</span></span><br><span class="line">$ kubectl get pod nfs-direct-pod -o wide</span><br><span class="line">NAME             READY   STATUS    RESTARTS   AGE   IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">nfs-direct-pod   1/1     Running   0          12m   10.244.194.115   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½• k8s-worker1 èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹ nfs æŒ‚è½½ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ åˆ›å»º podæ—¶ä¼šè‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸ŠæŒ‚è½½ nfs</span></span><br><span class="line">$ <span class="built_in">df</span> -t nfs4</span><br><span class="line">Filesystem                    1K-blocks    Used Available Use% Mounted on</span><br><span class="line">10.211.55.88:/nfs-server/data  42872832 3630080  39242752   9% /var/lib/kubelet/pods/e44786a9-fbd9-4ee8-bb28-84eb074fb7d9/volumes/kubernetes.io~nfs/nfs-volume</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹podæŒ‚è½½çš„ç›®å½•</span></span><br><span class="line">$ k <span class="built_in">exec</span> -it nfs-direct-pod -- <span class="built_in">df</span> -t nfs4</span><br><span class="line">Filesystem           1K-blocks      Used Available Use% Mounted on</span><br><span class="line">10.211.55.88:/nfs-server/data</span><br><span class="line">                      42872832   3630080  39242752   8% /data</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘nfsæŒ‚è½½ç›®å½•ä¸­å†™å…¥æ•°æ®</span></span><br><span class="line">k <span class="built_in">exec</span> -it nfs-direct-pod -- sh -c <span class="string">&#x27;echo &quot;hello world&quot; &gt; /data/test.txt&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤pod</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">k delete pod nfs-direct-pod</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡ç™»å½• å®¿ä¸»æœºèŠ‚ç‚¹ï¼Œå‘ç° nfs æŒ‚è½½ç‚¹ä¹Ÿè¢«å¸è½½äº†ï¼Œä½†æ˜¯ nfs-server ä¸­çš„æ–‡ä»¶ä»ç„¶å­˜åœ¨</span></span><br><span class="line">$ <span class="built_in">df</span> -t nfs4</span><br><span class="line"><span class="built_in">df</span>: no file systems processed</span><br></pre></td></tr></table></figure><h2 id="å­˜å‚¨å·ç±»å‹-emptyDirã€hostPathã€NFS-çš„å¯¹æ¯”è¡¨">å­˜å‚¨å·ç±»å‹ emptyDirã€hostPathã€NFS çš„å¯¹æ¯”è¡¨</h2><table><thead><tr><th>ç‰¹æ€§</th><th><code>emptyDir</code></th><th><code>hostPath</code></th><th><code>nfs</code></th></tr></thead><tbody><tr><td><strong>æ•°æ®ç”Ÿå‘½å‘¨æœŸ</strong></td><td>Pod ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆï¼ŒPod åˆ é™¤æ•°æ®ä¸¢å¤±</td><td>ç»‘å®šèŠ‚ç‚¹ä¸Šçš„ç›®å½•ï¼ŒPod åˆ äº†æ•°æ®ä»ä¿ç•™</td><td>å­˜å‚¨åœ¨è¿œç¨‹ NFS Serverï¼ŒPod åˆ é™¤æ•°æ®ä¸ä¸¢å¤±</td></tr><tr><td><strong>å…±äº«èŒƒå›´</strong></td><td><strong>åŒä¸€ä¸ª Pod çš„å¤šä¸ªå®¹å™¨å¯å…±äº«</strong></td><td>åŒä¸€èŠ‚ç‚¹ä¸Šå¤šä¸ª Pod å¯å…±äº«</td><td>é›†ç¾¤å†…å¤šä¸ª Pod è·¨èŠ‚ç‚¹å¯å…±äº«</td></tr><tr><td><strong>æŒä¹…åŒ–èƒ½åŠ›</strong></td><td>âŒ ä¸æŒä¹…åŒ–ï¼Œéš Pod ç”Ÿå‘½å‘¨æœŸç»“æŸæ¶ˆå¤±</td><td>âœ… æŒä¹…åŒ–ï¼Œåªè¦å®¿ä¸»æœºç›®å½•å­˜åœ¨æ•°æ®å°±åœ¨</td><td>âœ… æŒä¹…åŒ–ï¼ŒNFS å­˜å‚¨ç‹¬ç«‹äº Pod å­˜åœ¨</td></tr><tr><td><strong>è·¨èŠ‚ç‚¹å…±äº«</strong></td><td>âŒ ä¸èƒ½</td><td>âŒ ä¸èƒ½</td><td>âœ… æ”¯æŒè·¨èŠ‚ç‚¹å…±äº«</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>ä¸´æ—¶ç¼“å­˜ã€è¿›ç¨‹é—´å…±äº«æ•°æ®</td><td>å®¿ä¸»æœºç‰¹å®šç›®å½•æŒ‚è½½ï¼Œæ—¥å¿—å­˜å‚¨ã€å®¿ä¸»æœºæ’ä»¶å¯¹æ¥</td><td>å¤šå‰¯æœ¬æœåŠ¡å…±äº«å­˜å‚¨ã€æŒä¹…åŒ–æ•°æ®ã€å…±äº«é…ç½®æ–‡ä»¶</td></tr><tr><td><strong>æ•°æ®å®‰å…¨æ€§</strong></td><td>éš Pod åˆ é™¤ï¼Œ<strong>æ•°æ®æ˜“ä¸¢å¤±</strong></td><td>å®¹å™¨æœ‰æƒé™å¯ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ï¼Œå­˜åœ¨é£é™©</td><td>ä¾èµ– NFS Server ç¨³å®šæ€§ï¼Œé…ç½®ä¸å½“å¯èƒ½è¢«æ‰€æœ‰èŠ‚ç‚¹è¯»å†™</td></tr><tr><td><strong>å…¸å‹ç”¨ä¾‹</strong></td><td>Redis ç¼“å­˜ç›®å½•ã€Sidecar å®¹å™¨å…±äº«æ—¥å¿—</td><td>æŒ‚è½½å®¿ä¸»æœº docker.sockã€å®¿ä¸»æœºæ—¥å¿—ç›®å½•</td><td>è·¨ Pod æ–‡ä»¶å…±äº«ã€Web é™æ€èµ„æºã€Tensorflow å¤šå‰¯æœ¬è®­ç»ƒå…±äº«æ•°æ®</td></tr></tbody></table><h2 id="ä¸ºä»€ä¹ˆå·²ç»æœ‰-NFSï¼Œè¿˜æ¨èç”¨-PV-PVCï¼Ÿ">ä¸ºä»€ä¹ˆå·²ç»æœ‰ NFSï¼Œè¿˜æ¨èç”¨ PV/PVCï¼Ÿ</h2><ul class="lvl-0"><li class="lvl-2"><p>âœ… ç®€çŸ­å›ç­”ï¼šPV/PVC æ˜¯å¯¹åº•å±‚å­˜å‚¨ï¼ˆå¦‚ NFSï¼‰çš„æŠ½è±¡å’Œæ ‡å‡†åŒ–ç®¡ç†ã€‚</p></li></ul><table><thead><tr><th>åŸå› </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>âœ… <strong>Kubernetes æ ‡å‡†èµ„æº</strong></td><td>ç”¨ PVC å£°æ˜å­˜å‚¨éœ€æ±‚ï¼Œç”± K8s ç»Ÿä¸€è°ƒåº¦å’Œç®¡ç†ã€‚</td></tr><tr><td>âœ… <strong>å­˜å‚¨ä¸ Pod è§£è€¦</strong></td><td>Pod ä¸“æ³¨äºåº”ç”¨é€»è¾‘ï¼ŒPVC ä¸“æ³¨äºå£°æ˜â€œæˆ‘è¦ä¸€ä¸ª 10Gi çš„ RWX å­˜å‚¨â€ï¼ŒèƒŒåæ˜¯ NFSã€Ceph è¿˜æ˜¯åˆ«çš„ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒã€‚</td></tr><tr><td>âœ… <strong>åŠ¨æ€ä¾›åº”</strong></td><td>æ­é… StorageClass å¯ä»¥å®ç° <strong>è‡ªåŠ¨åˆ›å»º PV</strong>ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ PVã€‚</td></tr><tr><td>âœ… <strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></td><td>PVC è¢«åˆ é™¤æ—¶å¯è§¦å‘ PV å›æ”¶ã€ä¿ç•™æˆ–åˆ é™¤ç­–ç•¥ï¼ˆ<code>Retain</code>ã€<code>Recycle</code>ã€<code>Delete</code>ï¼‰ã€‚ç›´æ¥æŒ‚è½½ NFS æ²¡æœ‰è¿™äº›æœºåˆ¶ã€‚</td></tr><tr><td>âœ… <strong>æƒé™éš”ç¦»</strong></td><td>PV/PVC å¯ä»¥é€šè¿‡ <code>accessModes</code> æ§åˆ¶è®¿é—®çº§åˆ«ï¼Œæ¯”å¦‚åªå…è®¸ç‰¹å®š Pod è®¿é—®ã€‚ç›´æ¥æŒ‚è½½ NFS å®¹æ˜“æƒé™æ··ä¹±ã€‚</td></tr><tr><td>âœ… <strong>æ›´å¥½å…¼å®¹æ€§</strong></td><td>æŸäº›å·¥ä½œè´Ÿè½½ï¼ˆå¦‚ StatefulSetï¼‰<strong>åªèƒ½ç”¨ PVC</strong>ï¼Œä¸æ”¯æŒç›´æ¥ <code>nfs</code> å·ã€‚</td></tr><tr><td>âœ… <strong>æ›´çµæ´»çš„åˆ‡æ¢å­˜å‚¨æ–¹æ¡ˆ</strong></td><td>åæœŸå¦‚æœæ¢æˆ Cephã€EBSã€GlusterFSï¼Œåªéœ€æ”¹ PV/PVCï¼Œä¸éœ€è¦æ”¹ Pod é…ç½®ã€‚</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· NFS ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>Linux å®‰è£… NFS</title>
    <link href="https://blog.hanqunfeng.com/2025/07/21/linux-nfs/"/>
    <id>https://blog.hanqunfeng.com/2025/07/21/linux-nfs/</id>
    <published>2025-07-21T15:34:05.000Z</published>
    <updated>2025-07-21T07:58:09.351Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote % --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» linux ä¸‹ nfs æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ä¸ä½¿ç”¨</p></li><li class="lvl-2"><p>æœ¬æ–‡åŸºäº<code>CentOS8(x86_64)</code></p></li></ul><span id="more"></span><h2 id="NFS-ç®€ä»‹">NFS ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ŒNetwork File Systemï¼‰æ˜¯ä¸€ä¸ªé€šè¿‡ç½‘ç»œå…±äº«æ–‡ä»¶çš„åè®®ï¼Œå…è®¸ä¸åŒæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯åƒæŒ‚è½½æœ¬åœ°ç£ç›˜ä¸€æ ·è®¿é—®è¿œç«¯çš„å…±äº«æ–‡ä»¶ç›®å½•ã€‚</p></li></ul><h2 id="å‡†å¤‡ä¸€å°æœåŠ¡å™¨">å‡†å¤‡ä¸€å°æœåŠ¡å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½® hostname</span></span><br><span class="line">hostnamectl set-hostname nfs-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç½‘å¡</span></span><br><span class="line">ip a</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®IP åˆ†é…æ–¹å¼ï¼Œmanual: æ‰‹åŠ¨æŒ‡å®šIPï¼Œauto: DHCPè‡ªåŠ¨è·å–ï¼Œdisabled: å…³é—­IP</span></span><br><span class="line">nmcli con mod enp0s5 ipv4.method manual</span><br><span class="line"><span class="comment"># è®¾ç½® IP</span></span><br><span class="line">nmcli con mod enp0s5 ipv4.addresses 10.211.55.88/24</span><br><span class="line"><span class="comment"># è®¾ç½® gateway</span></span><br><span class="line">nmcli con mod enp0s5 ipv4.gateway 10.211.55.1</span><br><span class="line"><span class="comment"># è®¾ç½® dns</span></span><br><span class="line">nmcli con mod enp0s5 ipv4.dns <span class="string">&quot;10.211.55.1,8.8.8.8&quot;</span></span><br><span class="line"><span class="comment"># é‡æ–°å¯åŠ¨ç½‘å¡</span></span><br><span class="line">nmcli con up enp0s5</span><br></pre></td></tr></table></figure><h2 id="NFS-å®‰è£…ï¼šæœåŠ¡ç«¯">NFS å®‰è£…ï¼šæœåŠ¡ç«¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… nfs-utils å’Œ rpcbind</span></span><br><span class="line">dnf install rpcbind nfs-utils -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º nfs-server å­˜å‚¨ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /nfs-server/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½® nfs-serverï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªç›®å½•</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/nfs-server/data *(insecure,rw,sync,no_root_squash,no_all_squash)&quot;</span> &gt;&gt; /etc/exports</span><br><span class="line"><span class="comment">## é…ç½®é¡¹è¯´æ˜</span></span><br><span class="line"><span class="comment"># * ï¼šå…è®¸æ‰€æœ‰å®¢æˆ·ç«¯è®¿é—®ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“çš„å®¢æˆ·ç«¯ IP åœ°å€ï¼Œæ¯”å¦‚ï¼š192.168.0.0/24(rw,sync,no_root_squash,no_all_squash)</span></span><br><span class="line"><span class="comment"># insecure ï¼šå…è®¸ä»»æ„ç«¯å£ï¼ˆå…¼å®¹æ€§å¥½,æ”¯æŒk8sï¼‰ï¼Œé»˜è®¤å€¼æ˜¯ secureï¼šåªå…è®¸ 1024 ä»¥ä¸‹ç«¯å£ï¼Œé€‚åˆä¼ ç»ŸæœåŠ¡å™¨</span></span><br><span class="line"><span class="comment"># rw ï¼šè¯»å†™æƒé™ï¼Œroï¼šåªè¯»æƒé™</span></span><br><span class="line"><span class="comment"># sync ï¼šåŒæ­¥æ¨¡å¼ï¼Œå¼ºä¸€è‡´æ€§ï¼Œasyncï¼šå¼‚æ­¥æ¨¡å¼ï¼Œæ€§èƒ½é«˜ï¼Œä½†å­˜åœ¨ä¸¢æ•°æ®é£é™©</span></span><br><span class="line"><span class="comment"># no_root_squash ï¼šå…è®¸ root ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œroot ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·</span></span><br><span class="line"><span class="comment"># no_all_squash ï¼šå…è®¸æ‰€æœ‰ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå¯ä»¥çœç•¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ rpcbindã€nfs æœåŠ¡</span></span><br><span class="line">systemctl start rpcbind &amp;&amp; systemctl start nfs-server</span><br><span class="line"><span class="comment"># å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">systemctl <span class="built_in">enable</span> rpcbind &amp;&amp; systemctl <span class="built_in">enable</span> nfs-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/exportsï¼Œéœ€è¦é‡è½½ nfs é…ç½®</span></span><br><span class="line">systemctl reload nfs-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ nfs æœåŠ¡çŠ¶æ€</span></span><br><span class="line">systemctl status nfs-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ nfs æœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 2049</span></span><br><span class="line">$ rpcinfo -p | grep nfs</span><br><span class="line">    100003    3   tcp   2049  nfs</span><br><span class="line">    100003    4   tcp   2049  nfs</span><br><span class="line">    100227    3   tcp   2049  nfs_acl</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å¯¼å‡ºçš„å…±äº«ç›®å½•</span></span><br><span class="line">$ exportfs -v</span><br><span class="line">/nfs-server/data</span><br><span class="line">                &lt;world&gt;(<span class="built_in">sync</span>,wdelay,hide,no_subtree_check,sec=sys,rw,insecure,no_root_squash,no_all_squash)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¼€æ”¾ç«¯å£">å¼€æ”¾ç«¯å£</h3><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ç«¯å£</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ rpcinfo -p 10.211.55.88</span><br><span class="line">   program vers proto   port  service</span><br><span class="line">    100000    4   tcp    111  portmapper</span><br><span class="line">    100000    3   tcp    111  portmapper</span><br><span class="line">    100000    2   tcp    111  portmapper</span><br><span class="line">    100000    4   udp    111  portmapper</span><br><span class="line">    100000    3   udp    111  portmapper</span><br><span class="line">    100000    2   udp    111  portmapper</span><br><span class="line">    100024    1   udp  36578  status</span><br><span class="line">    100024    1   tcp  46973  status</span><br><span class="line">    100005    1   udp  20048  mountd</span><br><span class="line">    100005    1   tcp  20048  mountd</span><br><span class="line">    100005    2   udp  20048  mountd</span><br><span class="line">    100005    2   tcp  20048  mountd</span><br><span class="line">    100005    3   udp  20048  mountd</span><br><span class="line">    100005    3   tcp  20048  mountd</span><br><span class="line">    100003    3   tcp   2049  nfs</span><br><span class="line">    100003    4   tcp   2049  nfs</span><br><span class="line">    100227    3   tcp   2049  nfs_acl</span><br><span class="line">    100021    1   udp  36529  nlockmgr</span><br><span class="line">    100021    3   udp  36529  nlockmgr</span><br><span class="line">    100021    4   udp  36529  nlockmgr</span><br><span class="line">    100021    1   tcp  45917  nlockmgr</span><br><span class="line">    100021    3   tcp  45917  nlockmgr</span><br><span class="line">    100021    4   tcp  45917  nlockmgr</span><br></pre></td></tr></table></figure><table><thead><tr><th>Program (ç¼–å·)</th><th>æœåŠ¡åç§°</th><th>ç”¨é€”</th><th>ç«¯å£</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>100000</code></td><td>portmapper</td><td>RPC æœåŠ¡æ³¨å†Œè¡¨</td><td>111/tcp, 111/udp</td><td><strong>å¿…é¡»å¼€æ”¾</strong>ï¼Œå®¢æˆ·ç«¯é€šè¿‡å®ƒæŸ¥æ‰¾å…¶å®ƒæœåŠ¡ç«¯å£</td></tr><tr><td><code>100024</code></td><td>status (rpc.statd)</td><td>æ–‡ä»¶é”å®šçŠ¶æ€ç®¡ç†</td><td>36578/udp, 46973/tcp</td><td>å¸¸é…åˆ nlockmgr ä½¿ç”¨ï¼Œéå¿…éœ€</td></tr><tr><td><code>100005</code></td><td>mountd</td><td>æŒ‚è½½æœåŠ¡</td><td>20048/tcp, 20048/udp</td><td><strong>æŒ‚è½½æ—¶å¿…éœ€</strong></td></tr><tr><td><code>100003</code></td><td>nfs</td><td>NFS ä¸»æœåŠ¡</td><td>2049/tcp</td><td><strong>æ ¸å¿ƒæœåŠ¡ï¼Œå¿…éœ€</strong></td></tr><tr><td><code>100227</code></td><td>nfs_acl</td><td>NFS çš„ ACL æƒé™æ§åˆ¶</td><td>2049/tcp</td><td>é€šå¸¸ä¸ nfs ä¸€èµ·</td></tr><tr><td><code>100021</code></td><td>nlockmgr</td><td>æ–‡ä»¶é”ç®¡ç†</td><td>36529/udp, 45917/tcp</td><td>Stateful åº”ç”¨æ¶‰åŠæ–‡ä»¶é”æ—¶éœ€è¦</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æœ€å°ç«¯å£è¦æ±‚ï¼ˆåŸºæœ¬æŒ‚è½½ç”¨ï¼‰</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>éœ€è¦å¼€æ”¾çš„ç«¯å£</th></tr></thead><tbody><tr><td>âœ… <strong>åŸºæœ¬ NFS æŒ‚è½½è¯»å†™</strong></td><td><code>2049/tcp</code> + <code>111/tcp/udp</code></td></tr><tr><td>âœ… <strong>å®¹å™¨æˆ– K8s æŒ‚è½½</strong></td><td>åŒä¸Šï¼Œä¸€èˆ¬è¿˜æ¨è <code>20048/tcp/udp</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¼€æ”¾å¿…é¡»ç«¯å£</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=2049/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=111/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=111/udp</span><br><span class="line">firewall-cmd --permanent --add-port=20048/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=20048/udp</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h2 id="NFS-å®‰è£…ï¼šå®¢æˆ·ç«¯">NFS å®‰è£…ï¼šå®¢æˆ·ç«¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… nfs-utils å’Œ rpcbindï¼Œå®‰è£…åä¸éœ€è¦å¯åŠ¨ nfs-server æœåŠ¡ï¼Œåªéœ€è¦å¯åŠ¨ rpcbind æœåŠ¡ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½è¦è¿è¡Œ</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install rpcbind nfs-utils -y</span><br><span class="line"><span class="built_in">sudo</span> systemctl start rpcbind &amp;&amp; systemctl <span class="built_in">enable</span> rpcbind</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœåŠ¡å™¨çš„å…±äº«èµ„æºåˆ—è¡¨</span></span><br><span class="line"><span class="comment"># showmount -e &lt;nfs-server-ip&gt;</span></span><br><span class="line">$ showmount -e 10.211.55.88</span><br><span class="line">Export list <span class="keyword">for</span> 10.211.55.88:</span><br><span class="line">/nfs-server/data *</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º å®¢æˆ·ç«¯æŒ‚è½½ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /nfs/data</span><br><span class="line"><span class="comment"># æŒ‚è½½</span></span><br><span class="line">mount -t nfs 10.211.55.88:/nfs-server/data /nfs/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‚è½½ç‚¹</span></span><br><span class="line">$ mount | grep nfs/data</span><br><span class="line">10.211.55.88:/nfs-server/data on /nfs/data <span class="built_in">type</span> nfs4 (rw,relatime,vers=4.2,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.211.55.11,local_lock=none,addr=10.211.55.88)</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‚è½½ç‚¹ä¿¡æ¯ï¼Œè¿™ç§æ–¹å¼æ›´å‹å¥½</span></span><br><span class="line">$ <span class="built_in">df</span> -t nfs4</span><br><span class="line">Filesystem                    1K-blocks    Used Available Use% Mounted on</span><br><span class="line">10.211.55.88:/nfs-server/data  42872832 3630080  39242752   9% /nfs/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®è‡ªåŠ¨æŒ‚è½½</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;10.211.55.88:/nfs-server/data /nfs/data nfs defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line"><span class="comment"># æ ¹æ® /etc/fstab æ–‡ä»¶çš„é…ç½®ï¼Œå°è¯•æŒ‚è½½æ‰€æœ‰æœªæŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿã€‚ä¿®æ”¹ /etc/fstab åæ‰§è¡Œ mount -a ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®¢æˆ·ç«¯æŒ‚è½½çš„ç›®å½•ä¸èƒ½åˆ é™¤ï¼Œéœ€è¦å…ˆå¸è½½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -f å¼ºåˆ¶å¸è½½</span></span><br><span class="line">umount -f /nfs/data</span><br><span class="line"></span><br><span class="line">vim /etc/fstab</span><br><span class="line"><span class="comment"># åˆ é™¤æˆ–æ³¨é‡Šæ‰å¯¹åº”çš„ NFS æŒ‚è½½è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /nfs/data</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» linux ä¸‹ nfs æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ä¸ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åŸºäº&lt;code&gt;CentOS8(x86_64)&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="linux" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/linux/"/>
    
    <category term="nfs" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/linux/nfs/"/>
    
    
    <category term="linux" scheme="https://blog.hanqunfeng.com/tags/linux/"/>
    
    <category term="nfs" scheme="https://blog.hanqunfeng.com/tags/nfs/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ å­˜å‚¨å· hostPath</title>
    <link href="https://blog.hanqunfeng.com/2025/07/21/k8s-storage-hostpath/"/>
    <id>https://blog.hanqunfeng.com/2025/07/21/k8s-storage-hostpath/</id>
    <published>2025-07-21T15:33:05.000Z</published>
    <updated>2025-07-21T08:25:15.741Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· hostPath ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li></ul><span id="more"></span><h2 id="å­˜å‚¨å·-hostPath-ä»‹ç»">å­˜å‚¨å· hostPath ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>hostPath æ˜¯ä¸€ç§ç›´æ¥æŠŠ Node èŠ‚ç‚¹æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½• æŒ‚è½½åˆ° Pod å®¹å™¨é‡Œçš„å­˜å‚¨å·ã€‚</p></li><li class="lvl-2"><p>å®¹æ˜“ç ´åèŠ‚ç‚¹ç¯å¢ƒï¼Œä¸å»ºè®®ç”Ÿäº§ä½¿ç”¨</p></li><li class="lvl-2"><p>åŒä¸€ä¸ª Deployment çš„å¤šä¸ª Pod è¢«è°ƒåº¦åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”å®ƒä»¬çš„ hostPath é…ç½®æŒ‡å‘ç›¸åŒçš„å®¿ä¸»æœºè·¯å¾„ï¼Œè¿™äº› Pod ä¹‹é—´æ˜¯å¯ä»¥å…±äº«è¯¥ç›®å½•ä¸­æ–‡ä»¶çš„ã€‚</p></li><li class="lvl-2"><p>å…¸å‹ä½¿ç”¨åœºæ™¯</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>æ—¥å¿—æ”¶é›†</td><td>æŒ‚è½½ <code>/var/log</code> åˆ° Pod å†…éƒ¨</td></tr><tr><td>æŒ‚è½½å®¿ä¸»æœºé…ç½®æ–‡ä»¶</td><td>å¦‚æŒ‚è½½ <code>/etc/hosts</code>ã€<code>/etc/localtime</code></td></tr><tr><td>ä½¿ç”¨å®¿ä¸»æœº docker.sock</td><td>æŒ‚è½½ <code>/var/run/docker.sock</code> è¿è¡Œ Docker-in-Docker</td></tr><tr><td>å­˜å‚¨è°ƒè¯•ä¸´æ—¶æ–‡ä»¶</td><td>Pod è°ƒè¯•æ—¶è®¿é—®å®¿ä¸»æœºç‰¹å®šç›®å½•</td></tr></tbody></table><h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Pod å†…éƒ¨ /mnt/hostdata æ˜ å°„åˆ°å®¿ä¸»æœº /data ç›®å½•</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hostpath-example</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span>                   <span class="comment"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/mnt/hostdata</span>      <span class="comment"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /mnt/hostdata ç›®å½•</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">myvolume</span>                <span class="comment"># å­˜å‚¨å·åç§° ï¼Œä¸ volumes ä¸­å®šä¹‰çš„ volume é…ç½®åç§°ä¸€è‡´</span></span><br><span class="line">  <span class="attr">volumes:</span>                          <span class="comment"># å­˜å‚¨å·å£°æ˜</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myvolume</span>                  <span class="comment"># å­˜å‚¨å·åç§°</span></span><br><span class="line">    <span class="attr">hostPath:</span>                       <span class="comment"># å­˜å‚¨å·ç±»å‹ï¼Œè¿™é‡Œæ˜¯ hostPath</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/data</span>                   <span class="comment"># ä¸»æœºç›®å½•</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">Directory</span>               <span class="comment"># å¯é€‰å­—æ®µï¼Œä¸»è¦ç”¨äºæŒ‚è½½å‰éªŒè¯</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>hostPath.type</code> å¯ä»¥é…ç½®çš„å€¼å¦‚ä¸‹ï¼Œé»˜è®¤ä¸º ç©ºã€‚</p></li></ul><table><thead><tr><th>type</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>DirectoryOrCreate</code></td><td>å¦‚æœ <code>/data</code> ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º ï¼Œæƒé™ä¸º 0755</td></tr><tr><td><code>Directory</code></td><td>å¿…é¡»å­˜åœ¨ä¸”ä¸ºç›®å½•</td></tr><tr><td><code>File</code></td><td>å¿…é¡»å­˜åœ¨ä¸”ä¸ºæ–‡ä»¶</td></tr><tr><td><code>Socket</code></td><td>å¿…é¡»æ˜¯ socket</td></tr><tr><td><code>CharDevice</code></td><td>å­—ç¬¦è®¾å¤‡</td></tr><tr><td><code>BlockDevice</code></td><td>å—è®¾å¤‡</td></tr><tr><td><code>FileOrCreate</code></td><td>ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºç©ºæ–‡ä»¶ï¼Œæƒé™è®¾ç½®ä¸º 0644</td></tr><tr><td><code>ä¸è®¾ç½®</code></td><td>é»˜è®¤å€¼æ˜¯ç©ºï¼Œä¸»æœºä¸Šçš„è·¯å¾„æ— è®ºæ˜¯æ–‡ä»¶ã€ç›®å½•ã€ç”šè‡³ä¸å­˜åœ¨ï¼Œéƒ½ä¼šç›´æ¥æŒ‚è½½ ,å®¹æ˜“å¼•èµ·é¢„æœŸä¹‹å¤–çš„æŒ‚è½½é—®é¢˜</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Kubernetes åœ¨åˆ é™¤ Pod æ—¶ï¼Œä¸ä¼šåˆ é™¤ hostPath æ‰€æŒ‚è½½çš„å®¿ä¸»æœºç›®å½•æˆ–æ–‡ä»¶</p></li></ul><table><thead><tr><th>å­˜å‚¨å·ç±»å‹</th><th>åˆ é™¤ Pod åç›®å½•ä¼šè¢«åˆ é™¤å—ï¼Ÿ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>emptyDir</code></td><td>âœ… <strong>ä¼šè¢«åˆ é™¤</strong></td><td>ä¸´æ—¶ç›®å½•ï¼ŒPod ç”Ÿå‘½å‘¨æœŸç»“æŸè‡ªåŠ¨æ¸…ç†</td></tr><tr><td><code>hostPath</code></td><td>âŒ <strong>ä¸ä¼šåˆ é™¤</strong></td><td>å®¿ä¸»æœºè·¯å¾„ç‹¬ç«‹äº Pod ç”Ÿå‘½å‘¨æœŸï¼Œ<strong>ä¸ä¼šæ¸…ç†</strong></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· hostPath ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ å­˜å‚¨å· emptyDir</title>
    <link href="https://blog.hanqunfeng.com/2025/07/21/k8s-storage-emptydir/"/>
    <id>https://blog.hanqunfeng.com/2025/07/21/k8s-storage-emptydir/</id>
    <published>2025-07-21T15:30:05.000Z</published>
    <updated>2025-07-21T03:30:08.434Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· emptyDir ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li></ul><span id="more"></span><h2 id="å­˜å‚¨å·-emptyDir-ä»‹ç»">å­˜å‚¨å· emptyDir ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>emptyDir æ˜¯ Kubernetes ä¸­æœ€ç®€å•çš„ä¸€ç§ Pod çº§åˆ«çš„ä¸´æ—¶å­˜å‚¨å·ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼šPod ç”Ÿå‘½å‘¨æœŸå†…å…±äº«ä¸´æ—¶å­˜å‚¨ï¼ŒPod åˆ é™¤åæ•°æ®è‡ªåŠ¨ä¸¢å¼ƒã€‚</p></li><li class="lvl-2"><p>åŒä¸€ä¸ª Pod å†…çš„å¤šä¸ªå®¹å™¨å¯ä»¥é€šè¿‡ emptyDir å…±äº«æ•°æ®ã€‚è·¨ Pod ä¸å…±äº«ï¼Œé€‚ç”¨äºä¸´æ—¶æ•°æ®ã€‚</p></li><li class="lvl-2"><p>emptyDir åªèƒ½æŒ‚è½½ç›®å½•ã€‚</p></li></ul><h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸¤ä¸ªå®¹å™¨ app å’Œ sidecar é€šè¿‡ /data å…±äº«ä¸€ä¸ª emptyDir å·ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shared-emptydir-pod.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">shared-emptydir-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.sto:</span> <span class="string">emptydir</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo Hello &gt; /data1/hello; sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span>               <span class="comment"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-data</span>         <span class="comment"># æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸‹é¢ volumes ä¸­å®šä¹‰çš„ volume åç§°ä¸€è‡´</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data1</span>          <span class="comment"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data1 ç›®å½•</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sidecar</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span>               <span class="comment"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-data</span>         <span class="comment"># æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸Šé¢å®¹å™¨ä¸­çš„ volume é…ç½®åç§°ä¸€è‡´</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data2</span>         <span class="comment"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data2 ç›®å½•</span></span><br><span class="line">  <span class="attr">volumes:</span>                      <span class="comment"># å­˜å‚¨å·å£°æ˜</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-data</span>           <span class="comment"># å­˜å‚¨å·åç§°</span></span><br><span class="line">    <span class="attr">emptyDir:</span> &#123;&#125;                <span class="comment"># å£°æ˜ä¸º emptyDir å­˜å‚¨å·</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">k apply -f shared-emptydir-pod.yaml</span><br><span class="line"><span class="comment"># æŸ¥çœ‹podæ‰€åœ¨èŠ‚ç‚¹</span></span><br><span class="line">$ k get pod -l app.sto=emptydir</span><br><span class="line">NAME                  READY   STATUS    RESTARTS   AGE   IP              NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">shared-emptydir-pod   2/2     Running   0          22m   10.244.126.59   k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ pod-uid</span></span><br><span class="line">$ kubectl get pod shared-emptydir-pod -o jsonpath=<span class="string">&#x27;&#123;.metadata.uid&#125;&#x27;</span></span><br><span class="line">d597b4d7-e6b6-4522-887e-73d3f4c01006</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>emptyDir å­˜å‚¨å· é»˜è®¤ä½¿ç”¨èŠ‚ç‚¹æœ¬åœ°ç£ç›˜ï¼Œè·¯å¾„ä¸º <code>/var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt;</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç™»å½• k8s-worker2 èŠ‚ç‚¹</span></span><br><span class="line"><span class="built_in">export</span> POD_UID=d597b4d7-e6b6-4522-887e-73d3f4c01006</span><br><span class="line"><span class="built_in">export</span> POD_UID=6ea6636c-4a24-4dc5-af2a-2448825913b6</span><br><span class="line"><span class="built_in">export</span> VOLUME_NAME=shared-data</span><br><span class="line"><span class="built_in">cd</span> /var/lib/kubelet/pods/<span class="variable">$POD_UID</span>/volumes/kubernetes.io~empty-dir/<span class="variable">$VOLUME_NAME</span></span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">hello</span><br><span class="line">$ <span class="built_in">cat</span> hello</span><br><span class="line">Hello</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿›å…¥å®¹å™¨æŸ¥çœ‹å­˜å‚¨å·å†…å®¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl <span class="built_in">exec</span> -it shared-emptydir-pod -c app -- <span class="built_in">cat</span> /data1/hello</span><br><span class="line">Hello</span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it shared-emptydir-pod -c sidecar -- <span class="built_in">cat</span> /data2/hello</span><br><span class="line">Hello</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹å†…å®¹ï¼Œå®é™…ä¸Šåœ¨å®¹å™¨å†…éƒ¨å’Œå¤–éƒ¨éƒ½å¯ä»¥ä¿®æ”¹å­˜å‚¨å·å†…å®¹ï¼Œä¿®æ”¹åç«‹åˆ»ç”Ÿæ•ˆ</span></span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it shared-emptydir-pod -c sidecar -- sh -c <span class="string">&quot;echo &#x27;Hello World&#x27; &gt; /data2/hello&quot;</span></span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it shared-emptydir-pod -c app -- <span class="built_in">cat</span> /data1/hello</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤PODåemptydirå­˜å‚¨å·ä¼šç«‹åˆ»åˆ é™¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod shared-emptydir-pod</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½• k8s-worker2 èŠ‚ç‚¹æŸ¥çœ‹ emptydir å­˜å‚¨å·</span></span><br><span class="line">$ <span class="built_in">ls</span> /var/lib/kubelet/pods/<span class="variable">$POD_UID</span></span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;/var/lib/kubelet/pods/d597b4d7-e6b6-4522-887e-73d3f4c01006&#x27;</span>: No such file or directory</span><br></pre></td></tr></table></figure><h2 id="å°†-emptydir-å­˜å‚¨å·æ”¹ç”¨-å†…å­˜-å­˜å‚¨">å°† emptydir å­˜å‚¨å·æ”¹ç”¨ å†…å­˜ å­˜å‚¨</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">emptyDir:</span></span><br><span class="line">  <span class="attr">medium:</span> <span class="string">Memory</span>        <span class="comment"># ä½¿ç”¨ å†…å­˜ å­˜å‚¨ï¼ˆtmpfsï¼‰ï¼Œé€‚åˆé«˜ IO ä¸´æ—¶ç¼“å­˜</span></span><br><span class="line">  <span class="attr">sizeLimit:</span> <span class="string">512Mi</span>      <span class="comment"># é™åˆ¶å­˜å‚¨å¤§å°</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œè¦æ³¨æ„ï¼Œå³ä½¿è¿™é‡Œä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œä½†æ˜¯ <code>/var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt;</code> ä¾ç„¶å­˜åœ¨ï¼Œä½†å®ƒæŒ‚è½½çš„æ˜¯ tmpfs æ–‡ä»¶ç³»ç»Ÿ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç™»å½•podæ‰€åœ¨èŠ‚ç‚¹æŸ¥çœ‹æŒ‚è½½ç‚¹</span></span><br><span class="line">$ mount | grep <span class="variable">$POD_UID</span></span><br><span class="line">tmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~empty-dir/shared-data <span class="built_in">type</span> tmpfs (rw,relatime,size=524288k)</span><br><span class="line">tmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~projected/kube-api-access-5nk7d <span class="built_in">type</span> tmpfs (rw,relatime,size=3903212k)</span><br></pre></td></tr></table></figure><table><thead><tr><th>å·ç±»å‹</th><th>æ¥æº</th><th>æŒ‚è½½è·¯å¾„</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>emptyDir</td><td>ä½ é…ç½®çš„</td><td><code>/data1</code>, <code>/data2</code></td><td>Pod å†…éƒ¨å®¹å™¨å…±äº«ä¸´æ—¶å†…å­˜å­˜å‚¨</td></tr><tr><td>projected</td><td>ç³»ç»Ÿè‡ªåŠ¨</td><td><code>/var/run/secrets/kubernetes.io/serviceaccount/</code></td><td>æŒ‚è½½ serviceaccount tokenï¼ŒCA è¯ä¹¦</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å®¹å™¨å†…æŒ‚è½½ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl <span class="built_in">exec</span> shared-emptydir-pod -c app -- mount | grep /data1</span><br><span class="line">tmpfs on /data1 <span class="built_in">type</span> tmpfs (rw,relatime,size=524288k)</span><br><span class="line">$ kubectl <span class="built_in">exec</span> shared-emptydir-pod -c app -- mount | grep serviceaccount</span><br><span class="line">tmpfs on /var/run/secrets/kubernetes.io/serviceaccount <span class="built_in">type</span> tmpfs (ro,relatime,size=3903212k)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· emptyDir ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ Statefulset</title>
    <link href="https://blog.hanqunfeng.com/2025/07/20/k8s-statefulset/"/>
    <id>https://blog.hanqunfeng.com/2025/07/20/k8s-statefulset/</id>
    <published>2025-07-20T15:30:05.000Z</published>
    <updated>2025-07-22T08:48:12.925Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ Statefulset ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/">k8s Statefulset ä»‹ç»</a></p></li></ul><span id="more"></span><h2 id="Statefulset-ä»‹ç»">Statefulset ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>Statefulset(ç¼©å†™ä¸º sts) æ˜¯ K8S å®˜æ–¹æä¾›çš„ä¸€ç§æ§åˆ¶å™¨ï¼Œç”¨äºç®¡ç†æœ‰çŠ¶æ€åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“åº”ç”¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç­‰ç­‰ã€‚</p></li><li class="lvl-2"><p>Statefulset(æœ‰çŠ¶æ€) ä¸ Deployment(æ— çŠ¶æ€) çš„åŒºåˆ«æ˜¯ï¼š</p><ul class="lvl-2"><li class="lvl-4">Statefulset åˆ›å»ºçš„ Pod ä¼šæœ‰ç›¸åŒçš„åç§°ï¼Œå¹¶ä¸”ä¼šåˆ†é…ç›¸åŒçš„æŒä¹…å·ã€‚</li><li class="lvl-4">Statefulset åˆ›å»ºçš„ Pod ä½¿ç”¨ Headless Service(æ— å¤´æœåŠ¡ï¼Œæ²¡æœ‰ClusterIP)è¿›è¡Œé€šä¿¡ã€‚</li></ul></li></ul><h2 id="Statefulset-ç®¡ç†">Statefulset ç®¡ç†</h2><h3 id="Statefulset-åˆ›å»º">Statefulset åˆ›å»º</h3><ul class="lvl-0"><li class="lvl-2"><p>Statefulset åªèƒ½ é€šè¿‡ <code>yaml</code> åˆ›å»ºï¼Œä¸æ”¯æŒ <code>create</code> åˆ›å»º</p></li><li class="lvl-2"><p>ä¸€ä¸ªç®€å•çš„ <code>redis-statefulset.yaml</code> æ–‡ä»¶è¯´æ˜</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                      <span class="comment"># apiç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>                       <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line"><span class="attr">metadata:</span>                           <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-svc</span>                   <span class="comment"># serviceåç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">sts-ns</span></span><br><span class="line"><span class="attr">spec:</span>                               <span class="comment"># é…ç½®</span></span><br><span class="line">  <span class="attr">ports:</span>                            <span class="comment"># ç«¯å£</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">6379</span>                      <span class="comment"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span>                   <span class="comment"># åè®®</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">6379</span>                <span class="comment"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class="line">  <span class="attr">selector:</span>                         <span class="comment"># é€‰æ‹©å™¨</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis</span>                      <span class="comment"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span>                   <span class="comment"># é›†ç¾¤IPè®¾ç½®ä¸ºNoneï¼Œå³ä¸ºâ€œHeadless Serviceâ€</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span>                   <span class="comment"># æœåŠ¡ç±»å‹ï¼Œé»˜è®¤ä¸ºClusterIP</span></span><br><span class="line"><span class="string">---</span>                                 <span class="comment"># åˆ†å‰²çº¿</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>                  <span class="comment"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æº</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span>                    <span class="comment"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-sts</span>                    <span class="comment"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">sts-ns</span></span><br><span class="line"><span class="attr">spec:</span>                                <span class="comment"># é…ç½®é¡¹</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span>           <span class="comment"># ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚</span></span><br><span class="line">  <span class="attr">selector:</span>                          <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>                     <span class="comment"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">redis</span>                     <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class="line">  <span class="attr">updateStrategy:</span>                    <span class="comment"># æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ ·</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span>              <span class="comment"># 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚</span></span><br><span class="line">                                     <span class="comment"># 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span>                   <span class="comment"># æ»šåŠ¨å‡çº§çš„é…ç½®</span></span><br><span class="line">      <span class="attr">partition:</span> <span class="number">0</span>                    <span class="comment"># ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">redis-svc</span>             <span class="comment"># æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span>                        <span class="comment"># å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1</span></span><br><span class="line">  <span class="attr">template:</span>                          <span class="comment"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">redis</span>                   <span class="comment"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">redis:6.2</span>             <span class="comment"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis</span>                  <span class="comment"># å®¹å™¨çš„åç§°ï¼Œå®é™…çš„åç§°ä¸º sts-redis-&lt;number&gt;ï¼Œä» 0 å¼€å§‹é€’å¢</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰§è¡Œåˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">kubectl create namespace sts-ns</span><br><span class="line"><span class="comment"># åˆ›å»º StatefulSet</span></span><br><span class="line">kubectl apply -f redis-statefulset.yaml</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-Statefulset">æŸ¥çœ‹ Statefulset</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ k get all -n sts-ns</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/redis-sts-0   1/1     Running   0          40s</span><br><span class="line">pod/redis-sts-1   1/1     Running   0          24s</span><br><span class="line"></span><br><span class="line">NAME                TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">service/redis-svc   ClusterIP   None         &lt;none&gt;        6379/TCP   40s</span><br><span class="line"></span><br><span class="line">NAME                         READY   AGE</span><br><span class="line">statefulset.apps/redis-sts   2/2     40s</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®podä¸­çš„redisæœåŠ¡">è®¿é—®podä¸­çš„redisæœåŠ¡</h3><ul class="lvl-0"><li class="lvl-2"><p>æ—¢ç„¶æ˜¯Headless Serviceï¼Œå°±åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®</p></li><li class="lvl-2"><p>åœ¨ç›¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>serviceName</code> ç›´æ¥è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ <code>&lt;pod-name&gt;.&lt;service-name&gt;</code></p></li><li class="lvl-2"><p>åœ¨ä¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>&lt;serviceName&gt;.&lt;namespace&gt;</code> æˆ–è€… <code>&lt;serviceName&gt;.&lt;namespace&gt;.svc.cluster.local</code> è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ <code>&lt;pod-name&gt;.&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</code> è®¿é—®ï¼Œå› ä¸º pod-name æ˜¯å›ºå®šä¸”å”¯ä¸€çš„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ k <span class="built_in">exec</span> -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-svc</span><br><span class="line">10.244.126.55   redis-svc.sts-ns.svc.cluster.local</span><br><span class="line">10.244.194.110  redis-svc.sts-ns.svc.cluster.local</span><br><span class="line"></span><br><span class="line">$ k <span class="built_in">exec</span> -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-sts-1.redis-svc</span><br><span class="line">10.244.126.55   redis-sts-1.redis-svc.sts-ns.svc.cluster.local</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ Serviceï¼Œç±»å‹ä¸º NodePort æˆ–è€… LoadBalancerï¼Œå°†redisæœåŠ¡æš´éœ²å‡ºå»</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                      <span class="comment"># apiç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>                       <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line"><span class="attr">metadata:</span>                           <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-svc-out</span>               <span class="comment"># serviceåç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">sts-ns</span></span><br><span class="line"><span class="attr">spec:</span>                               <span class="comment"># é…ç½®</span></span><br><span class="line">  <span class="attr">ports:</span>                            <span class="comment"># ç«¯å£</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">6379</span>                      <span class="comment"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span>                   <span class="comment"># åè®®</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">6379</span>                <span class="comment"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class="line">  <span class="attr">selector:</span>                         <span class="comment"># é€‰æ‹©å™¨</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis</span>                      <span class="comment"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span>                <span class="comment"># è´Ÿè½½å‡è¡¡</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰§è¡Œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º</span></span><br><span class="line">$ k create -f redis-svc-out.yaml</span><br><span class="line"><span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">$ k get svc -n sts-ns</span><br><span class="line">NAME            TYPE           CLUSTER-IP    EXTERNAL-IP     PORT(S)          AGE</span><br><span class="line">redis-svc       ClusterIP      None          &lt;none&gt;          6379/TCP         70m</span><br><span class="line">redis-svc-out   LoadBalancer   10.96.21.96   10.211.55.202   6379:31806/TCP   54m</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨é›†ç¾¤å¤–çš„æœºå™¨ä¸Šè®¿é—® redisï¼Œæ¯æ¬¡è¿æ¥ä¼šè½®è¯¢è®¿é—®å„ä¸ªpod</span></span><br><span class="line">$ redis-cli -h 10.211.55.202 info server | grep redis_version</span><br><span class="line">redis_version:8.0.3</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-Statefulset-è¯¦æƒ…">æŸ¥çœ‹ Statefulset è¯¦æƒ…</h3><ul class="lvl-0"><li class="lvl-2"><p>å½“ Statefulset è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ Statefulset çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå› </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe sts &lt;sts-name&gt;</span><br><span class="line">kubectl describe sts &lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤-Statefulset">åˆ é™¤ Statefulset</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete sts &lt;sts-name&gt;</span><br><span class="line">kubectl delete sts &lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡ yaml æ–‡ä»¶åˆ é™¤</span></span><br><span class="line">kubectl delete -f &lt;yaml-file&gt;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-Statefulset-æ—¥å¿—">æŸ¥çœ‹ Statefulset æ—¥å¿—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs sts/&lt;sts-name&gt;</span><br><span class="line">kubectl logs sts/&lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure><h3 id="æ»šåŠ¨å‡çº§ä¸å›æ»š-Statefulset">æ»šåŠ¨å‡çº§ä¸å›æ»š Statefulset</h3><ul class="lvl-0"><li class="lvl-2"><p>å¯¹ <code>RollingUpdate</code> ç±»å‹çš„ <code>Statefulset</code> çš„ <code>.spec.template</code> çš„ä»»ä½•æ›´æ–°éƒ½å°†è§¦å‘æ»šåŠ¨æ›´æ–°ã€‚</p></li><li class="lvl-2"><p>æˆ‘ä»¬ä¿®æ”¹è¿‡ <code>Statefulset</code> çš„ <code>.spec.template</code>ï¼Œå¹¶ä¿å­˜åï¼Œé‡æ–°è¿è¡Œ <code>kubectl apply -f &lt;yaml-file&gt;</code>å³å¯è§¦å‘æ»šåŠ¨å‡çº§ã€‚</p></li><li class="lvl-2"><p>å¦‚æœåªæ˜¯æ›´æ–°å®¹å™¨çš„é•œåƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è§¦å‘æ»šåŠ¨å‡çº§</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ k <span class="built_in">exec</span> -it pod/redis-sts-0 -n sts-ns -- redis-server -v</span><br><span class="line">Redis server v=6.2.19 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=c51c65e7ae83f735</span><br><span class="line"></span><br><span class="line"><span class="comment"># kubectl set image sts/&lt;sts-name&gt; &lt;container-name&gt;=&lt;image&gt;:&lt;tag&gt; --record=true</span></span><br><span class="line">kubectl <span class="built_in">set</span> image sts redis-sts redis=redis:8.0 --record=<span class="literal">true</span> -n sts-ns</span><br><span class="line"></span><br><span class="line">$ k <span class="built_in">exec</span> -it pod/redis-sts-0 -n sts-ns -- redis-server -v</span><br><span class="line">Redis server v=8.0.3 sha=00000000:1 malloc=jemalloc-5.3.0 bits=64 build=d4cb0aa008da4ca9</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹æ»šåŠ¨å‡çº§çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl rollout status sts/&lt;sts-name&gt;</span></span><br><span class="line">$ kubectl rollout status sts redis-sts -n sts-ns</span><br><span class="line">partitioned roll out complete: 2 new pods have been updated...</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å†å²ç‰ˆæœ¬</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰é¢çš„åºå·è¡¨ç¤ºç‰ˆæœ¬å·</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> sts redis-sts -n sts-ns</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„è¯¦æƒ…</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> sts redis-sts -n sts-ns --revision=1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å›æ»š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å›é€€åˆ°å‰ä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class="line">kubectl rollout undo sts redis-sts -n sts-ns</span><br><span class="line"><span class="comment"># å›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ --to-revision=1 è¡¨ç¤ºå›åˆ°ç‰ˆæœ¬1</span></span><br><span class="line">kubectl rollout undo sts redis-sts -n sts-nsx --to-revision=1</span><br></pre></td></tr></table></figure><h2 id="Deployment-å’Œ-StatefulSet-çš„å¯¹æ¯”æ€»ç»“">Deployment å’Œ StatefulSet çš„å¯¹æ¯”æ€»ç»“</h2><table><thead><tr><th>ç‰¹æ€§</th><th><strong>Deployment</strong></th><th><strong>StatefulSet</strong></th></tr></thead><tbody><tr><td><strong>ç”¨é€”</strong></td><td>æ— çŠ¶æ€åº”ç”¨ï¼ˆå¦‚ Web æœåŠ¡ã€API æœåŠ¡ï¼‰</td><td>æœ‰çŠ¶æ€åº”ç”¨ï¼ˆå¦‚æ•°æ®åº“ã€ç¼“å­˜ï¼šRedisã€MySQLã€Kafkaï¼‰</td></tr><tr><td><strong>Pod åç§°</strong></td><td>Pod åå­—éšæœºç”Ÿæˆï¼Œå¦‚ <code>nginx-abc123</code></td><td>Pod åå­—æœ‰åºï¼Œæ ¼å¼ä¸º <code>name-0</code>ã€<code>name-1</code>ã€<code>name-2</code></td></tr><tr><td><strong>ç¨³å®šçš„æ ‡è¯†</strong></td><td><strong>ä¸æä¾›</strong>ï¼Œæ¯æ¬¡é‡å»º Pod åå­—å¯èƒ½ä¸åŒ</td><td><strong>æä¾›</strong>ï¼Œæ¯ä¸ª Pod çš„åå­—ã€ç½‘ç»œ IDã€å­˜å‚¨æŒä¹…åŒ–ä¸å˜</td></tr><tr><td><strong>å­˜å‚¨å·</strong></td><td>é€šå¸¸é…åˆ PVCï¼Œä½† Pod é‡å»ºæ—¶æŒ‚è½½å·å¯èƒ½å˜åŒ–</td><td>é…ç½® <code>volumeClaimTemplates</code>ï¼Œæ¯ä¸ª Pod ç‹¬ç«‹æŒä¹…å·</td></tr><tr><td><strong>æ»šåŠ¨æ›´æ–°ç­–ç•¥</strong></td><td>æ”¯æŒ <code>maxSurge</code>ã€<code>maxUnavailable</code>ï¼Œå¯å¹¶è¡Œæ›´æ–° Pod</td><td>é»˜è®¤ <strong>é€ä¸ªé¡ºåºæ›´æ–°</strong> Podï¼ˆå¯ç”¨ <code>partition</code> æ§åˆ¶åˆ†æ‰¹æ›´æ–°ï¼‰</td></tr><tr><td><strong>å¯ç”¨æ€§</strong></td><td>é€šå¸¸è®¾è®¡ä¸º <strong>æ— çŠ¶æ€å¤šå‰¯æœ¬é«˜å¯ç”¨</strong>ï¼Œä¸ä¿è¯ Pod å¯åŠ¨é¡ºåºæˆ–å›ºå®š IP</td><td><strong>æœ‰çŠ¶æ€ä¸”æœ‰åºéƒ¨ç½²ã€åˆ é™¤ã€æ›´æ–°</strong>ï¼Œé€šå¸¸å•å‰¯æœ¬é€ä¸ªç»´æŠ¤å¯ç”¨æ€§</td></tr><tr><td><strong>æœåŠ¡è®¿é—®</strong></td><td>é€šè¿‡ ClusterIPã€NodePortã€LoadBalancer è®¿é—®</td><td>æ¨èç”¨ <strong>Headless Service (clusterIP: None)</strong>ï¼ŒPod æœ‰å›ºå®š DNS</td></tr><tr><td><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></td><td>Web åº”ç”¨ã€REST APIã€æ— çŠ¶æ€å¾®æœåŠ¡</td><td>æ•°æ®åº“ï¼ˆMySQLã€PostgreSQLï¼‰ã€ç¼“å­˜ï¼ˆRedisï¼‰ã€é˜Ÿåˆ—ï¼ˆKafkaã€RabbitMQï¼‰</td></tr><tr><td><strong>Pod ä¼¸ç¼©ç‰¹æ€§</strong></td><td><strong>çµæ´»ä¼¸ç¼©</strong>ï¼Œå¢åŠ /å‡å°‘å‰¯æœ¬æ— ç‰¹å®šé¡ºåº</td><td><strong>æœ‰åºä¼¸ç¼©</strong>ï¼Œ<code>name-0</code> -&gt; <code>name-1</code> -&gt; <code>name-2</code>â€¦</td></tr><tr><td><strong>é‡å»ºç­–ç•¥</strong></td><td>Pod å´©æºƒåé‡å»ºçš„æ˜¯æ–° Podï¼Œæ— æŒä¹…å­˜å‚¨æ•°æ®å¯èƒ½ä¸¢å¤±</td><td>Pod å´©æºƒåé‡å»ºçš„æ˜¯ç›¸åŒ Pod åå­—ï¼ŒæŒ‚è½½ç›¸åŒ PVCï¼Œä¸ä¸¢æ•°æ®</td></tr></tbody></table><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>StatefulSet ç±»ä¼¼äº Deploymentï¼ŒåŒæ ·æ”¯æŒæ‰©ç¼©å®¹ï¼ˆscale æˆ–è€… hpaï¼‰ï¼Œä½†å› ä¸ºå…¶æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæ‰€ä»¥éœ€è°¨æ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scale</span></span><br><span class="line">kubectl scale sts redis-sts --replicas=5 -n sts-ns</span><br><span class="line"></span><br><span class="line"><span class="comment"># hpaï¼Œè¦æ±‚podé…ç½®ä¸­æœ‰èµ„æºé™åˆ¶</span></span><br><span class="line">kubectl autoscale sts redis-sts --name=<span class="string">&quot;hpa-redis&quot;</span> --cpu-percent=50 --min=3 --max=10 -n sts-ns</span><br></pre></td></tr></table></figure><table><thead><tr><th>æ“ä½œ</th><th><strong>å¯è¡Œæ€§</strong></th><th><strong>æ¨èæƒ…å†µ</strong></th></tr></thead><tbody><tr><td><strong>æ‰©å®¹ï¼ˆå¢åŠ å‰¯æœ¬æ•°ï¼‰</strong></td><td>âœ… <strong>æ¨è</strong></td><td>å®‰å…¨ï¼Œæ–°å¢ Pod æŒ‰åºä» N-1 å¼€å§‹åˆ›å»ºï¼ˆ<code>sts-name-0</code> -&gt; <code>sts-name-1</code> -&gt; <code>sts-name-2</code>ï¼‰</td></tr><tr><td><strong>ç¼©å®¹ï¼ˆå‡å°‘å‰¯æœ¬æ•°ï¼‰</strong></td><td>âš ï¸ <strong>å°å¿ƒä½¿ç”¨</strong></td><td>å¯èƒ½å¯¼è‡´ Pod åŠå…¶å…³è” PVC è¢«åºŸå¼ƒï¼Œ<strong>æ•°æ®å¯èƒ½ä¸¢å¤±</strong></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ Statefulset ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/&quot;&gt;k8s Statefulset ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ Horizontal Pod Autoscalerï¼ˆHPAï¼‰</title>
    <link href="https://blog.hanqunfeng.com/2025/07/20/k8s-hpa/"/>
    <id>https://blog.hanqunfeng.com/2025/07/20/k8s-hpa/</id>
    <published>2025-07-20T13:30:05.000Z</published>
    <updated>2025-07-20T15:18:40.692Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S ä¸­çš„ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/autoscaling/">Autoscaling k8sç®€ä»‹</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale/">Horizontal Pod Autoscalerï¼ˆHPAï¼‰</a></p></li></ul><span id="more"></span><h2 id="Horizontal-Pod-Autoscalerï¼ˆHPAï¼‰-ç®€ä»‹">Horizontal Pod Autoscalerï¼ˆHPAï¼‰ ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Horizontal Pod Autoscalerï¼ˆç¼©å†™ä¸º hpaï¼‰åŸºäºèµ„æº CPU åˆ©ç”¨ç‡è‡ªåŠ¨è°ƒæ•´ deploymentã€replication controller æˆ–è€… replica ä¸­ pod çš„æ•°é‡ï¼Œè¿™æœ‰åŠ©äºæ‚¨çš„åº”ç”¨ç¨‹åºè¿›è¡Œæ‰©å±•ä»¥æ»¡è¶³å¢é•¿çš„éœ€æ±‚ï¼Œæˆ–åœ¨ä¸éœ€è¦èµ„æºæ—¶è¿›è¡Œç¼©å‡ï¼Œä»è€Œé‡Šæ”¾å‡ºèŠ‚ç‚¹ç”¨äºå…¶ä»–åº”ç”¨ç¨‹åºã€‚å½“æ‚¨è®¾ç½®ç›®æ ‡ CPU åˆ©ç”¨ç‡ç™¾åˆ†æ¯”æ—¶ï¼ŒHPA æ‰©å±•æˆ–ç¼©å‡åº”ç”¨ç¨‹åºæ¥å°è¯•æ»¡è¶³è¯¥ç›®æ ‡ã€‚</p></li><li class="lvl-2"><p>Kubernetes æœ¬èº«å·²ç»åŒ…å«äº† HPA çš„ controllerï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–çš„å®‰è£…æˆ–éƒ¨ç½²ã€‚</p></li><li class="lvl-2"><p>HPA éœ€è¦è·å– metrics ä¿¡æ¯ï¼Œmetrics ä¿¡æ¯éœ€è¦ä» Metrics Server ä¸­è·å–ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®‰è£… Metrics Serverã€‚</p></li><li class="lvl-2"><p>HPA ä¼šå‘¨æœŸæ€§(é»˜è®¤15ç§’)æŸ¥è¯¢ç›®æ ‡èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œç„¶åå’Œ HPA ä¸­å®šä¹‰çš„å€¼åšæ¯”è¾ƒï¼Œå¹¶æ ¹æ®æ¯”è¾ƒç»“æœç›¸åº”çš„è°ƒæ•´ pod æ•°é‡ã€‚</p></li><li class="lvl-2"><p>åˆ›å»ºpodæ—¶ï¼Œå¿…é¡»ä¸ºå…¶è®¾å®šcpuèµ„æºï¼Œç”¨äºä¸ç›®æ ‡å€¼è¿›è¡Œæ¯”è¾ƒï¼Œç›®å‰æœ€æ–°çš„v2ç‰ˆæœ¬çš„HPAé™¤äº†æ”¯æŒCPUçš„å¯¹æ¯”ï¼Œè¿˜å¯ä»¥è®¾å®šå…¶å®ƒæŒ‡æ ‡ï¼Œå…·ä½“å‚è€ƒ<a href="https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/">HorizontalPodAutoscaler æ¼”ç»ƒ</a>ä¸­çš„â€œåŸºäºå¤šé¡¹åº¦é‡æŒ‡æ ‡å’Œè‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡è‡ªåŠ¨æ‰©ç¼©â€ã€‚</p></li><li class="lvl-2"><p>åšä¸»ä¹‹å‰å†™è¿‡ä¸€ç¯‡åœ¨awsçš„eksä¸­ä½¿ç”¨hpaçš„æ–‡ç«  <a href="/2023/07/17/aws-eks17-hpa/" title="AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰">AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰</a>ï¼Œå’Œåœ¨è‡ªå·±æ­å»º k8sé›†ç¾¤ ä¸­ä½¿ç”¨ hpa åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥æœ¬æ–‡ä¸å†å¯¹é‡å¤å†…å®¹è¿›è¡Œèµ˜è¿°ï¼Œå»ºè®®è¯»è€…å…ˆé˜…è¯» <a href="/2023/07/17/aws-eks17-hpa/" title="AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰">AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰</a>ã€‚</p></li></ul><h2 id="å®‰è£…-Metrics-Server">å®‰è£… Metrics Server</h2><ul class="lvl-0"><li class="lvl-2"><p>Kubernetes çš„ HPA æ˜¯ä¾èµ– Metrics API çš„ï¼Œé»˜è®¤å¹¶ä¸å†…ç½®ã€‚éœ€è¦é€šè¿‡ metrics-server æ¥æ”¶é›†å’Œæä¾›èŠ‚ç‚¹/Pod çš„èµ„æºç”¨é‡æ•°æ®ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰ã€‚</p></li><li class="lvl-2"><p>å®‰è£… <a href="https://github.com/kubernetes-sigs/metrics-server">metrics-server</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ curl -L -o metrics-server.yaml https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span><br><span class="line">$ kubectl apply -f metrics-server.yaml</span><br><span class="line">serviceaccount/metrics-server created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/system:metrics-server created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created</span><br><span class="line">service/metrics-server created</span><br><span class="line">deployment.apps/metrics-server created</span><br><span class="line">apiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>éƒ¨ç½²åå‘ç°podæ²¡æœ‰è¿è¡ŒæˆåŠŸ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$  k get all -n kube-system -l k8s-app=metrics-server</span><br><span class="line">NAME                                  READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/metrics-server-867d48dc9c-fgdjq   0/1     Running   0          16s</span><br><span class="line"></span><br><span class="line">NAME                     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">service/metrics-server   ClusterIP   10.96.91.221   &lt;none&gt;        443/TCP   16s</span><br><span class="line"></span><br><span class="line">NAME                             READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/metrics-server   0/1     1            0           16s</span><br><span class="line"></span><br><span class="line">NAME                                        DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/metrics-server-867d48dc9c   1         1         0       16s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ£€æŸ¥æ—¥å¿—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ k logs deployment.apps/metrics-server -n kube-system</span><br><span class="line"><span class="comment">## è¾“å‡ºç±»ä¼¼äº</span></span><br><span class="line">E0703 23:02:38.120831       1 scraper.go:149] <span class="string">&quot;Failed to scrape node&quot;</span> err=<span class="string">&quot;Get \&quot;https://10.211.55.15:10250/metrics/resource\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.15 because it doesn&#x27;t contain any IP SANs&quot;</span> node=<span class="string">&quot;k8s-worker1&quot;</span></span><br><span class="line">E0703 23:02:38.127774       1 scraper.go:149] <span class="string">&quot;Failed to scrape node&quot;</span> err=<span class="string">&quot;Get \&quot;https://10.211.55.16:10250/metrics/resource\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.16 because it doesn&#x27;t contain any IP SANs&quot;</span> node=<span class="string">&quot;k8s-worker2&quot;</span></span><br><span class="line">E0703 23:02:38.140583       1 scraper.go:149] <span class="string">&quot;Failed to scrape node&quot;</span> err=<span class="string">&quot;Get \&quot;https://10.211.55.11:10250/metrics/resource\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.11 because it doesn&#x27;t contain any IP SANs&quot;</span> node=<span class="string">&quot;k8s-master&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ„æ€æ˜¯ metrics-server åœ¨é€šè¿‡ https://<node-ip>:10250 è¯·æ±‚ kubelet çš„æ—¶å€™ï¼Œå‘ç° kubelet çš„è¯ä¹¦ä¸åŒ…å«è¯¥ IP çš„ Subject Alternative Name (SAN)ï¼Œå› æ­¤ TLS æ ¡éªŒå¤±è´¥ã€‚</p></li><li class="lvl-2"><p>è§£å†³æ–¹æ¡ˆ: æ·»åŠ  --kubelet-insecure-tls å‚æ•°ï¼Œè·³è¿‡ kubelet çš„ TLS è¯ä¹¦æ ¡éªŒ(metrics-server æœ¬èº«æƒé™æœ‰é™ï¼Œé£é™©å¯æ§ï¼Œkubelet è‡ªç­¾è¯ä¹¦ç»´æŠ¤æˆæœ¬é«˜)</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit deployment metrics-server -n kube-system</span><br><span class="line"><span class="comment">## åœ¨ args ä¸­æ·»åŠ  --kubelet-insecure-tls</span></span><br><span class="line">  spec:</span><br><span class="line">    containers:</span><br><span class="line">    - args:</span><br><span class="line">      - --cert-dir=/tmp</span><br><span class="line">      - --secure-port=10250</span><br><span class="line">      - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span><br><span class="line">      - --kubelet-use-node-status-port</span><br><span class="line">      - --metric-resolution=15s</span><br><span class="line">      - --kubelet-insecure-tls   <span class="comment"># æ·»åŠ æ­¤è¡Œ</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>wq</code>ä¿å­˜åï¼Œç­‰ä¸€ä¼šå†æ¬¡æŸ¥çœ‹æ‰€æœ‰èµ„æºå‡å·²æ­£å¸¸</p></li><li class="lvl-2"><p>æŸ¥çœ‹æ‰€æœ‰ node çš„èµ„æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ k top nodes</span><br><span class="line">NAME          CPU(cores)   CPU(%)   MEMORY(bytes)   MEMORY(%)</span><br><span class="line">k8s-master    216m         10%      1712Mi          44%</span><br><span class="line">k8s-worker1   79m          3%       1025Mi          26%</span><br><span class="line">k8s-worker2   82m          4%       982Mi           25%</span><br></pre></td></tr></table></figure><table><thead><tr><th>å­—æ®µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>NAME</strong></td><td>èŠ‚ç‚¹åç§°ï¼ŒKubernetes é›†ç¾¤çš„èŠ‚ç‚¹åå­—ã€‚</td></tr><tr><td><strong>CPU(cores)</strong></td><td>å½“å‰èŠ‚ç‚¹ CPU çš„ç¬æ—¶ä½¿ç”¨é‡ï¼Œå•ä½æ˜¯æ ¸å¿ƒæ•°ï¼ˆCoreï¼‰ï¼Œæ¯”å¦‚ <code>216m</code> = 0.216 æ ¸å¿ƒã€‚<code>m</code> = <strong>millicores</strong>ï¼Œ1000m = 1æ ¸ã€‚</td></tr><tr><td><strong>CPU(%)</strong></td><td>å½“å‰ CPU ä½¿ç”¨ç‡ï¼Œç›¸å¯¹äºè¯¥èŠ‚ç‚¹ CPU æ€»æ ¸æ•°çš„ç™¾åˆ†æ¯”ã€‚æ¯”å¦‚ <code>10%</code> è¡¨ç¤ºèŠ‚ç‚¹ CPU çš„ 10% è¢«ä½¿ç”¨ã€‚</td></tr><tr><td><strong>MEMORY(bytes)</strong></td><td>èŠ‚ç‚¹å½“å‰ä½¿ç”¨çš„å†…å­˜ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼ˆä¾‹å¦‚ <code>1712Mi</code> = 1712 Mebibytes â‰ˆ 1.7 GBï¼‰ã€‚</td></tr><tr><td><strong>MEMORY(%)</strong></td><td>èŠ‚ç‚¹å†…å­˜ä½¿ç”¨ç‡ï¼Œå æ€»å†…å­˜çš„ç™¾åˆ†æ¯”ã€‚æ¯”å¦‚ <code>44%</code> è¡¨ç¤ºè¯¥èŠ‚ç‚¹å†…å­˜ä½¿ç”¨äº† 44%ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹æ‰€æœ‰ pod çš„èµ„æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ k top pods -A</span><br><span class="line">NAMESPACE     NAME                                       CPU(cores)   MEMORY(bytes)</span><br><span class="line">default       nginx-5869d7778c-5682r                     0m           9Mi</span><br><span class="line">default       nginx-5869d7778c-thw8f                     0m           4Mi</span><br><span class="line">kube-system   calico-kube-controllers-7bfdc5b57c-q5xwp   6m           35Mi</span><br><span class="line">kube-system   calico-node-7pbbq                          42m          281Mi</span><br><span class="line">kube-system   calico-node-v4hzr                          47m          260Mi</span><br><span class="line">kube-system   calico-node-w47qq                          40m          263Mi</span><br><span class="line">kube-system   coredns-674b8bbfcf-2tvld                   2m           23Mi</span><br><span class="line">kube-system   coredns-674b8bbfcf-h6kx7                   2m           22Mi</span><br><span class="line">kube-system   etcd-k8s-master                            27m          85Mi</span><br><span class="line">kube-system   kube-apiserver-k8s-master                  49m          404Mi</span><br><span class="line">kube-system   kube-controller-manager-k8s-master         28m          100Mi</span><br><span class="line">kube-system   kube-proxy-nkbns                           1m           41Mi</span><br><span class="line">kube-system   kube-proxy-plqw8                           1m           25Mi</span><br><span class="line">kube-system   kube-proxy-sbgh6                           1m           34Mi</span><br><span class="line">kube-system   kube-scheduler-k8s-master                  8m           38Mi</span><br><span class="line">kube-system   metrics-server-56fb9549f4-rtt7n            4m           21Mi</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-HPA">åˆ›å»º HPA</h2><ul class="lvl-0"><li class="lvl-2"><p>å‰é¢çš„æ–‡ç« ä¸­å¤šæ¬¡ä½¿ç”¨ nginx é•œåƒåˆ›å»ºäº† deploymentï¼Œä½†æ˜¯éƒ½æ²¡æœ‰é…ç½®è¿‡èµ„æºï¼Œä¸ºäº†æµ‹è¯• hpaï¼Œéœ€è¦ä¸ºå…¶æŒ‡å®šèµ„æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥ä¿®æ”¹ deploymentï¼Œæ”¹å˜ spec.templateï¼ŒPod ä¼šè¢«é‡å»ºã€‚ä¿å­˜åç«‹åˆ»ç”Ÿæ•ˆ</span></span><br><span class="line">kubectl edit deployment nginx</span><br><span class="line"><span class="comment"># å¢åŠ èµ„æºé™åˆ¶</span></span><br><span class="line">spec:</span><br><span class="line">  replicas: 1   <span class="comment"># ä¿®æ”¹å‰¯æœ¬æ•°ä½ 1ï¼Œä»…æ”¹å˜ replicasï¼ŒPod ä¸ä¼šè¢«é‡å»º</span></span><br><span class="line">  template:     <span class="comment"># ä¿®æ”¹ templateï¼ŒPod ä¼šè¢«é‡å»º</span></span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx</span><br><span class="line">        resources:</span><br><span class="line">          limits:</span><br><span class="line">            cpu: 500m</span><br><span class="line">            memory: 500Mi</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 200m</span><br><span class="line">            memory: 200Mi</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œåˆ›å»º HPA</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºäº†ä¸€ä¸ªå«â€œhpa-nginxâ€çš„ HPAï¼Œé»˜è®¤ä¸ deployment çš„åç§°ç›¸åŒï¼Œå¯ä»¥ç”¨ --name=&#x27;hpa-nginx&#x27; æŒ‡å®šhpaçš„åç§°</span></span><br><span class="line"><span class="comment"># replicas å˜åŠ¨èŒƒå›´æ˜¯æœ€å° 3ï¼Œæœ€å¤§ 10</span></span><br><span class="line"><span class="comment"># ç›®æ ‡cpuåˆ©ç”¨ç‡ä¸º 50%ï¼Œä¸Šé¢æˆ‘ä»¬è®¾å®š CPU request å€¼ä¸º 100mï¼Œæ‰€ä»¥å½“å¹³å‡cpuå€¼ä¸º 100m æ—¶å°±ä¼šè§¦å‘ autoscale</span></span><br><span class="line"><span class="comment"># è¿™é‡Œè¯´å¹³å‡cpuï¼Œæ˜¯æŒ‡æ‰€æœ‰podçš„cpuåˆ©ç”¨ç‡çš„å¹³å‡å€¼</span></span><br><span class="line">$ k autoscale deployment nginx --name=<span class="string">&quot;hpa-nginx&quot;</span> --cpu-percent=50 --min=3 --max=10</span><br><span class="line">horizontalpodautoscaler.autoscaling/hpa-nginx autoscaled</span><br><span class="line"><span class="comment"># è§‚å¯Ÿï¼Œå¤§çº¦ 15ç§’åï¼Œhpa-nginx å‘ç° replicas å€¼ä¸º1ï¼Œ30ç§’çš„æ—¶å€™è‡ªåŠ¨æ‰©å®¹åˆ°3ä¸ªï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®çš„hpaçš„replicasæœ€å°å€¼ä¸º3ï¼Œå¹¶ä¸”é‡‡é›†åˆ°äº†cpuä½¿ç”¨ç‡</span></span><br><span class="line">$ k get hpa -w</span><br><span class="line">NAME        REFERENCE          TARGETS              MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">hpa-nginx   Deployment/nginx   cpu: &lt;unknown&gt;/50%   3         10        0          0s</span><br><span class="line">hpa-nginx   Deployment/nginx   cpu: &lt;unknown&gt;/50%   3         10        1          15s</span><br><span class="line">hpa-nginx   Deployment/nginx   cpu: 0%/50%          3         10        3          30s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ymalæ–‡ä»¶åˆ›å»º HPA</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">autoscaling/v2</span>    <span class="comment"># apiç‰ˆæœ¬ï¼Œè¿™é‡Œè®¾ç½®ä¸º v2</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">HorizontalPodAutoscaler</span> <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hpa-nginx</span>             <span class="comment"># hpaèµ„æºåç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span>          <span class="comment"># å‘½åç©ºé—´</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">maxReplicas:</span> <span class="number">10</span>             <span class="comment"># æœ€å¤§å‰¯æœ¬æ•°</span></span><br><span class="line">  <span class="attr">minReplicas:</span> <span class="number">1</span>              <span class="comment"># æœ€å°å‰¯æœ¬æ•°</span></span><br><span class="line">  <span class="attr">metrics:</span>                    <span class="comment"># æŒ‡æ ‡è®¾å®š</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Resource</span>            <span class="comment"># èµ„æºç±»å‹ï¼Œå¯ä»¥é…ç½®ä¸º Resource/Object/Pods</span></span><br><span class="line">    <span class="attr">resource:</span>                 <span class="comment"># èµ„æºå¯¹è±¡</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">cpu</span>               <span class="comment"># èµ„æºåç§° cpu/memory</span></span><br><span class="line">      <span class="attr">target:</span>                 <span class="comment"># ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">Utilization</span>     <span class="comment"># ç›®æ ‡ç±»å‹ï¼Œå¯ä»¥é…ç½®ä¸º Utilization/AverageValue/Value</span></span><br><span class="line">        <span class="attr">averageUtilization:</span> <span class="number">50</span> <span class="comment"># ç›®æ ‡å€¼ï¼Œè¿™é‡Œæ˜¯å¹³å‡ä½¿ç”¨ç‡çš„ç™¾åˆ†æ¯”</span></span><br><span class="line">  <span class="attr">scaleTargetRef:</span>             <span class="comment"># æŒ‡å®šè¦è‡ªåŠ¨ä¼¸ç¼©çš„èµ„æºå¯¹è±¡</span></span><br><span class="line">    <span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Deployment</span>          <span class="comment"># èµ„æºç±»å‹ä¸º Deployment</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span>               <span class="comment"># èµ„æºåç§°ä¸º nginx</span></span><br></pre></td></tr></table></figure><h2 id="HPA-æ”¯æŒçš„ç›‘æ§æŒ‡æ ‡ç±»å‹">HPA æ”¯æŒçš„ç›‘æ§æŒ‡æ ‡ç±»å‹</h2><table><thead><tr><th>ç±»å‹</th><th>å­—æ®µå</th><th>è¯´æ˜</th><th>å¸¸è§ç”¨é€”</th></tr></thead><tbody><tr><td><strong>Resource</strong></td><td><code>resource</code></td><td>åŸºäº Pod èµ„æºä½¿ç”¨æƒ…å†µï¼ˆCPUã€å†…å­˜ï¼‰ï¼Œæœ€å¸¸ç”¨</td><td>æŒ‰ CPU åˆ©ç”¨ç‡è‡ªåŠ¨æ‰©ç¼©å®¹</td></tr><tr><td><strong>Pods</strong></td><td><code>pods</code></td><td>åŸºäºæ¯ä¸ª Pod çš„è‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡çš„å¹³å‡å€¼ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹ç›‘æ§ç³»ç»Ÿæä¾›ï¼Œæ¯”å¦‚ Prometheus</td><td>æŒ‰ä¸šåŠ¡æŒ‡æ ‡ï¼ˆå¦‚è¯·æ±‚æ•°ã€é˜Ÿåˆ—é•¿åº¦ï¼‰æ‰©ç¼©å®¹</td></tr><tr><td><strong>Object</strong></td><td><code>object</code></td><td>åŸºäºå•ä¸ª Kubernetes å¯¹è±¡ï¼ˆå¦‚ Serviceã€Ingressï¼‰çš„æŒ‡æ ‡ï¼Œï¼Œæ¯”å¦‚ Prometheus</td><td>æŒ‰æŸä¸ªå¯¹è±¡çš„æŒ‡æ ‡æ‰©ç¼©å®¹ï¼Œä¾‹å¦‚é˜Ÿåˆ—é•¿åº¦</td></tr></tbody></table><h3 id="Resource-èµ„æºæŒ‡æ ‡ï¼ˆCPU-å†…å­˜ï¼‰">Resource èµ„æºæŒ‡æ ‡ï¼ˆCPU/å†…å­˜ï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>Utilization: åˆ©ç”¨ç‡ç™¾åˆ†æ¯”</p></li><li class="lvl-2"><p>Utilization ä¸å…³å¿ƒ limitsï¼Œåªçœ‹ requestsã€‚</p></li><li class="lvl-2"><p>å¦‚æœ resources.requests æ²¡æœ‰è®¾ç½®ï¼ŒHPA Utilization ä¼šæŠ¥é”™ï¼ˆé™¤é AverageValueï¼‰ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">metrics:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Resource</span></span><br><span class="line">  <span class="attr">resource:</span>                   <span class="comment"># èµ„æº æŒ‡æ ‡</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cpu</span>                 <span class="comment"># cpu</span></span><br><span class="line">    <span class="attr">target:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">Utilization</span>       <span class="comment"># åˆ©ç”¨ç‡ç™¾åˆ†æ¯”</span></span><br><span class="line">      <span class="attr">averageUtilization:</span> <span class="number">50</span>  <span class="comment"># 50%</span></span><br></pre></td></tr></table></figure><blockquote><p>å½“å‰æœ‰ 3 ä¸ª Podï¼š</p></blockquote><table><thead><tr><th>Pod</th><th>CPU å®é™…ä½¿ç”¨</th><th>CPU requests</th></tr></thead><tbody><tr><td>pod-1</td><td>150m</td><td>200m</td></tr><tr><td>pod-2</td><td>100m</td><td>200m</td></tr><tr><td>pod-3</td><td>50m</td><td>200m</td></tr><tr><td>åˆè®¡</td><td>400m</td><td>600m</td></tr><tr><td><strong>å¹³å‡</strong></td><td><strong>400m Ã· 600m Ã— 100% â‰ˆ 66.7%</strong></td><td></td></tr></tbody></table><blockquote><p>ç”±äº 66.7% &gt; 50%ï¼Œä¼šæ‰©å®¹ï¼›å¦‚æœå°äº 50%ï¼ŒHPA ä¼šç¼©å®¹ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>AverageValue: æŒ‡å®šèµ„æºä½¿ç”¨å¹³å‡å€¼</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">metrics:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Resource</span></span><br><span class="line">  <span class="attr">resource:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">memory</span>                <span class="comment"># ç›‘æ§èµ„æºç±»å‹ä¸º memoryï¼ˆå†…å­˜ï¼‰</span></span><br><span class="line">    <span class="attr">target:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">AverageValue</span>        <span class="comment"># æŒ‡æ ‡ç±»å‹ä¸º AverageValueï¼Œè¡¨ç¤ºæ¯ä¸ª Pod å¹³å‡ä½¿ç”¨å¤šå°‘</span></span><br><span class="line">      <span class="attr">averageValue:</span> <span class="string">400Mi</span>       <span class="comment"># ç›®æ ‡å€¼ï¼šå¹³å‡æ¯ä¸ª Pod ä½¿ç”¨ 400Mi å†…å­˜</span></span><br></pre></td></tr></table></figure><blockquote><p>å‡è®¾å½“å‰éƒ¨ç½²äº† 3 ä¸ªå‰¯æœ¬ï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š</p></blockquote><table><thead><tr><th>Pod</th><th>å½“å‰å†…å­˜ä½¿ç”¨</th></tr></thead><tbody><tr><td>pod-1</td><td>450Mi</td></tr><tr><td>pod-2</td><td>400Mi</td></tr><tr><td>pod-3</td><td>300Mi</td></tr><tr><td><strong>å¹³å‡</strong></td><td><strong>(450+400+300)/3 = 383.3Mi</strong></td></tr></tbody></table><blockquote><p>å› ä¸º 383.3Mi &lt; 400Miï¼Œä¸è§¦å‘æ‰©å®¹ã€‚å¦‚æœå°†æ¥å¹³å‡ä½¿ç”¨è¶…è¿‡ 400Miï¼ŒHPA å°±ä¼šæ‰©å®¹ï¼Œåä¹‹ç¼©å®¹ã€‚</p></blockquote><h2 id="HPA-æ‰©ç¼©å®¹é€Ÿåº¦é…ç½®">HPA æ‰©ç¼©å®¹é€Ÿåº¦é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>HPA çš„æ‰©ç¼©å®¹é€Ÿåº¦æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œé€šè¿‡ behavior å­—æ®µæ¥è‡ªå®šä¹‰æ‰©ç¼©å®¹çš„é€Ÿåº¦å’Œç­–ç•¥ã€‚</p></li><li class="lvl-2"><p>ä»¥ä¸‹æ˜¯é»˜è®¤ç­–ç•¥</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">behavior:</span></span><br><span class="line">  <span class="attr">scaleUp:</span>                                  <span class="comment"># â¬†ï¸ æ‰©å®¹ç­–ç•¥</span></span><br><span class="line">    <span class="attr">tolerance:</span> <span class="number">0.1</span>                          <span class="comment"># å®¹å¿é˜ˆå€¼ï¼Œé»˜è®¤0.1(10%)ï¼Œè¡¨ç¤ºæ¯æ¬¡æ‰©å®¹æ—¶ï¼Œpodä½¿ç”¨ç‡è¶…è¿‡1.1å€ç›®æ ‡å€¼æ—¶æ‰ä¼šè¿›è¡Œæ‰©å®¹</span></span><br><span class="line">    <span class="attr">stabilizationWindowSeconds:</span> <span class="number">0</span>           <span class="comment"># é»˜è®¤0ï¼Œå³å¢åŠ æˆ–å‡å°‘podæ•°é‡åä¿æŒä¸å˜çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span></span><br><span class="line">    <span class="attr">policies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Percent</span>                         <span class="comment"># æ‰©å®¹é€Ÿåº¦æŒ‰ç™¾åˆ†æ¯”é™åˆ¶</span></span><br><span class="line">      <span class="attr">value:</span> <span class="number">100</span>                            <span class="comment"># æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 100% çš„å‰¯æœ¬æ•°</span></span><br><span class="line">      <span class="attr">periodSeconds:</span> <span class="number">15</span>                     <span class="comment"># æ¯ 15 ç§’è®¡ç®—ä¸€æ¬¡æ˜¯å¦å¯ä»¥æ‰©å®¹ï¼Œé»˜è®¤ 15 ç§’</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Pods</span>                            <span class="comment"># æŒ‰å›ºå®š Pod æ•°é‡é™åˆ¶æ‰©å®¹é€Ÿåº¦</span></span><br><span class="line">      <span class="attr">value:</span> <span class="number">4</span>                              <span class="comment"># æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 4 ä¸ª Pod</span></span><br><span class="line">      <span class="attr">periodSeconds:</span> <span class="number">15</span>                     <span class="comment"># åŒæ · 15 ç§’è®¡ç®—ä¸€æ¬¡ï¼Œé»˜è®¤ 15 ç§’</span></span><br><span class="line">    <span class="attr">selectPolicy:</span> <span class="string">Max</span>                       <span class="comment"># å¤šä¸ª policy åŒæ—¶å­˜åœ¨æ—¶ï¼Œå– Percent å’Œ Pods çš„æœ€å¤§å€¼ã€‚Min å–æœ€å°å€¼</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">scaleDown:</span>                                <span class="comment"># â¬‡ï¸ ç¼©å®¹ç­–ç•¥</span></span><br><span class="line">    <span class="comment"># selectPolicy: Disabled                  # ç¦ç”¨ç¼©å®¹</span></span><br><span class="line">    <span class="attr">stabilizationWindowSeconds:</span> <span class="number">300</span>         <span class="comment"># é»˜è®¤ 300ï¼Œå³å¢åŠ æˆ–å‡å°‘podæ•°é‡åä¿æŒä¸å˜çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œé˜²æ­¢å¿«é€Ÿç¼©å®¹ï¼ˆå¹³æ»‘ç­–ç•¥ï¼‰</span></span><br><span class="line">    <span class="attr">policies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Percent</span>                         <span class="comment"># ç¼©å®¹é€Ÿåº¦æŒ‰ç™¾åˆ†æ¯”é™åˆ¶</span></span><br><span class="line">      <span class="attr">value:</span> <span class="number">100</span>                            <span class="comment"># æ¯ 15 ç§’æœ€å¤šç¼©å®¹ 100% çš„å‰¯æœ¬æ•°</span></span><br><span class="line">      <span class="attr">periodSeconds:</span> <span class="number">15</span>                     <span class="comment"># æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ˜¯å¦å¯ä»¥ç¼©å®¹</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®Œæ•´çš„ HPA é…ç½®æ–‡ä»¶ç¤ºä¾‹(ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€ä¿®æ”¹æ‰©ç¼©å®¹é€Ÿåº¦çš„é…ç½®ï¼Œé»˜è®¤ç­–ç•¥æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯)</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">autoscaling/v2</span>                    <span class="comment"># apiç‰ˆæœ¬ï¼Œä½¿ç”¨ v2 ç‰ˆæœ¬æ”¯æŒ behavior æ‰©ç¼©å®¹ç­–ç•¥</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">HorizontalPodAutoscaler</span>                 <span class="comment"># èµ„æºç±»å‹ä¸º HPA</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hpa-nginx</span>                             <span class="comment"># HPA èµ„æºçš„åç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span>                          <span class="comment"># å‘½åç©ºé—´ï¼Œè®¾ç½®ä¸º default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">maxReplicas:</span> <span class="number">10</span>                             <span class="comment"># HPA è‡ªåŠ¨æ‰©å®¹çš„æœ€å¤§å‰¯æœ¬æ•°</span></span><br><span class="line">  <span class="attr">minReplicas:</span> <span class="number">1</span>                              <span class="comment"># HPA è‡ªåŠ¨ç¼©å®¹çš„æœ€å°å‰¯æœ¬æ•°</span></span><br><span class="line">  <span class="attr">metrics:</span>                                    <span class="comment"># è‡ªåŠ¨ä¼¸ç¼©çš„æŒ‡æ ‡é…ç½®</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Resource</span>                            <span class="comment"># æŒ‡æ ‡ç±»å‹ä¸º Resourceï¼ˆèµ„æºå‹ï¼‰</span></span><br><span class="line">    <span class="attr">resource:</span>                                 <span class="comment"># èµ„æºæŒ‡æ ‡å¯¹è±¡</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">cpu</span>                               <span class="comment"># èµ„æºåç§°ä¸º cpuï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º memory</span></span><br><span class="line">      <span class="attr">target:</span>                                 <span class="comment"># ç›®æ ‡æŒ‡æ ‡å¯¹è±¡</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">Utilization</span>                     <span class="comment"># æŒ‡æ ‡ç±»å‹ä¸º Utilizationï¼ˆåˆ©ç”¨ç‡ç™¾åˆ†æ¯”ï¼‰</span></span><br><span class="line">        <span class="attr">averageUtilization:</span> <span class="number">50</span>                <span class="comment"># CPU å¹³å‡ä½¿ç”¨ç‡è¾¾åˆ° 50% æ—¶è¿›è¡Œæ‰©ç¼©å®¹</span></span><br><span class="line">  <span class="attr">scaleTargetRef:</span>                             <span class="comment"># HPA ç»‘å®šçš„ç›®æ ‡èµ„æºå¯¹è±¡</span></span><br><span class="line">    <span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Deployment</span>                          <span class="comment"># ç›®æ ‡ç±»å‹ä¸º Deployment</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span>                               <span class="comment"># ç›®æ ‡ Deployment åç§°ä¸º nginx</span></span><br><span class="line">  <span class="attr">behavior:</span>                                   <span class="comment"># â¬‡ï¸ æ‰©ç¼©å®¹è¡Œä¸ºæ§åˆ¶</span></span><br><span class="line">    <span class="attr">scaleUp:</span>                                  <span class="comment"># æ‰©å®¹ç­–ç•¥</span></span><br><span class="line">      <span class="attr">stabilizationWindowSeconds:</span> <span class="number">30</span>          <span class="comment"># æ‰©å®¹å¹³æ»‘çª—å£ä¸º 30 ç§’ï¼Œé˜²æ­¢çŸ­æ—¶é—´æŠ–åŠ¨é¢‘ç¹æ‰©å®¹</span></span><br><span class="line">      <span class="attr">policies:</span>                               <span class="comment"># æ‰©å®¹é€Ÿåº¦é™åˆ¶ç­–ç•¥</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Percent</span>                         <span class="comment"># æŒ‰ç™¾åˆ†æ¯”è®¡ç®—</span></span><br><span class="line">        <span class="attr">value:</span> <span class="number">100</span>                            <span class="comment"># æ¯ 15 ç§’å†…æœ€å¤šæ‰©å®¹ 100%</span></span><br><span class="line">        <span class="attr">periodSeconds:</span> <span class="number">15</span>                     <span class="comment"># æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ‰©å®¹é€Ÿç‡</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Pods</span>                            <span class="comment"># æŒ‰å›ºå®š Pod æ•°é‡è®¡ç®—</span></span><br><span class="line">        <span class="attr">value:</span> <span class="number">4</span>                              <span class="comment"># æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 4 ä¸ª Pod</span></span><br><span class="line">        <span class="attr">periodSeconds:</span> <span class="number">15</span>                     <span class="comment"># æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ‰©å®¹é€Ÿç‡</span></span><br><span class="line">      <span class="attr">selectPolicy:</span> <span class="string">Max</span>                       <span class="comment"># å¦‚æœå¤šä¸ª policy åŒæ—¶æ»¡è¶³ï¼Œå–æœ€å¤§å€¼ï¼ˆæ›´æ¿€è¿›çš„æ‰©å®¹ï¼‰</span></span><br><span class="line">    <span class="attr">scaleDown:</span>                                <span class="comment"># ç¼©å®¹ç­–ç•¥</span></span><br><span class="line">      <span class="attr">stabilizationWindowSeconds:</span> <span class="number">300</span>         <span class="comment"># ç¼©å®¹å¹³æ»‘çª—å£ä¸º 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰ï¼Œé¿å…çŸ­æ—¶æµé‡é™ä½å¿«é€Ÿç¼©å®¹</span></span><br><span class="line">      <span class="attr">policies:</span>                               <span class="comment"># ç¼©å®¹é€Ÿåº¦é™åˆ¶ç­–ç•¥</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Percent</span>                         <span class="comment"># æŒ‰ç™¾åˆ†æ¯”ç¼©å®¹</span></span><br><span class="line">        <span class="attr">value:</span> <span class="number">30</span>                             <span class="comment"># æ¯ 60 ç§’æœ€å¤šç¼©å®¹ 30%</span></span><br><span class="line">        <span class="attr">periodSeconds:</span> <span class="number">60</span>                     <span class="comment"># æ¯ 60 ç§’è¯„ä¼°ä¸€æ¬¡ç¼©å®¹é€Ÿç‡</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S ä¸­çš„ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/workloads/autoscaling/&quot;&gt;Autoscaling k8sç®€ä»‹&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale/&quot;&gt;Horizontal Pod Autoscalerï¼ˆHPAï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ Ingress Nginx</title>
    <link href="https://blog.hanqunfeng.com/2025/07/19/k8s-ingress-nginx/"/>
    <id>https://blog.hanqunfeng.com/2025/07/19/k8s-ingress-nginx/</id>
    <published>2025-07-19T13:30:05.000Z</published>
    <updated>2025-07-20T13:48:31.217Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S å®‰è£…åŠä½¿ç”¨ Ingress Nginxï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.github.io/ingress-nginx/">ingress-nginx å®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/">ingress-nginx k8sç®€ä»‹</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/">k8sæ”¯æŒçš„ ingress controller</a></p></li></ul><span id="more"></span><h2 id="Ingress-ç®€ä»‹">Ingress ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Ingress(ç¼©å†™ä¸º ing) æä¾›ä»é›†ç¾¤å¤–éƒ¨åˆ°é›†ç¾¤å†…æœåŠ¡çš„ HTTP å’Œ HTTPS è·¯ç”±(7å±‚)ã€‚ æµé‡è·¯ç”±ç”± Ingress èµ„æºæ‰€å®šä¹‰çš„è§„åˆ™æ¥æ§åˆ¶ã€‚</p></li><li class="lvl-2"><p>å®é™…ä¸Š Ingress-Nginx å†…ç½®äº† nginxï¼Œç”± nginx å…¶è´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶è½¬å‘ç»™åç«¯æœåŠ¡ã€‚</p></li><li class="lvl-2"><p>ä¸‹é¢æ˜¯ Ingress çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œå¯å°†æ‰€æœ‰æµé‡éƒ½å‘é€åˆ°åŒä¸€ Service<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/jVrIUP.png" alt=""></p></li></ul><h2 id="å®‰è£…-Ingress-Nginx">å®‰è£… Ingress-Nginx</h2><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…æ—¶è¦æ³¨æ„ ingress-nginx çš„ç‰ˆæœ¬å’Œ Kubernetes çš„ç‰ˆæœ¬å…¼å®¹æ€§ï¼Œå‚è€ƒ Github:<a href="https://github.com/kubernetes/ingress-nginx">ingress-nginx</a>ã€‚</p></li><li class="lvl-2"><p>è·å–å¯¹åº”ç‰ˆæœ¬çš„yamlæ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½æœ€æ–°çš„ v1.13.0 ç‰ˆæœ¬ï¼Œå…¶æ”¯æŒ Kubernetes 1.33 ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">export</span> INGRESS_NGINX_VERSION=v1.13.0</span><br><span class="line">curl -L -o ingress-nginx-controller.yaml https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-<span class="variable">$&#123;INGRESS_NGINX_VERSION&#125;</span>/deploy/static/provider/cloud/deploy.yaml</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£… ingress-nginx</p></li></ul><blockquote><p>è¿™é‡Œè¦æ³¨æ„ï¼Œingress-nginx çš„ <code>service/ingress-nginx-controller</code> é»˜è®¤ä½¿ç”¨ LoadBalancer ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å…ˆä½¿ k8s é›†ç¾¤æ”¯æŒ LoadBalancer ç±»å‹ï¼Œå¯ä»¥å‚è€ƒ <a href="/2025/07/18/k8s-service/" title="K8S ä¹‹ Service">K8S ä¹‹ Service</a> ä¸­ LoadBalancer éƒ¨åˆ†ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f ingress-nginx-controller.yaml</span><br><span class="line">namespace/ingress-nginx created</span><br><span class="line">serviceaccount/ingress-nginx created</span><br><span class="line">serviceaccount/ingress-nginx-admission created</span><br><span class="line">role.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">role.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class="line">configmap/ingress-nginx-controller created</span><br><span class="line">service/ingress-nginx-controller created</span><br><span class="line">service/ingress-nginx-controller-admission created</span><br><span class="line">deployment.apps/ingress-nginx-controller created</span><br><span class="line">job.batch/ingress-nginx-admission-create created</span><br><span class="line">job.batch/ingress-nginx-admission-patch created</span><br><span class="line">ingressclass.networking.k8s.io/nginx created</span><br><span class="line">validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ingress-nginxèµ„æº</span></span><br><span class="line">$ k get all -n ingress-nginx</span><br><span class="line">NAME                                           READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/ingress-nginx-controller-95f6586c6-nznwq   1/1     Running   0          2m46s</span><br><span class="line"></span><br><span class="line">NAME                                         TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                      AGE</span><br><span class="line">service/ingress-nginx-controller             LoadBalancer   10.96.112.234   10.211.55.201   80:30168/TCP,443:30600/TCP   2m46s</span><br><span class="line">service/ingress-nginx-controller-admission   ClusterIP      10.96.245.155   &lt;none&gt;          443/TCP                      2m46s</span><br><span class="line"></span><br><span class="line">NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/ingress-nginx-controller   1/1     1            1           2m46s</span><br><span class="line"></span><br><span class="line">NAME                                                 DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/ingress-nginx-controller-95f6586c6   1         1         1       2m46s</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ IngressClass èµ„æº</span></span><br><span class="line">$ k get ingressclasses.networking.k8s.io</span><br><span class="line">NAME    CONTROLLER             PARAMETERS   AGE</span><br><span class="line">nginx   k8s.io/ingress-nginx   &lt;none&gt;       14m</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-Ingress-èµ„æº">åˆ›å»º Ingress èµ„æº</h2><ul class="lvl-0"><li class="lvl-2"><p>ingress-demo.yaml</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span>                   <span class="comment"># Ingress èµ„æº</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-ingress</span>             <span class="comment"># Ingress åç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span>            <span class="comment"># Ingress æ‰€åœ¨çš„å‘½åç©ºé—´</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span>       <span class="comment"># Ingress ä½¿ç”¨çš„ IngressClass</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">nginx.hanqunfeng.com</span>  <span class="comment"># è½¬å‘åŸŸåï¼Œæ”¯æŒé€šé…ç¬¦ *.hanqunfeng.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span>        <span class="comment"># è·¯å¾„åŒ¹é…è§„åˆ™, å‰ç¼€åŒ¹é…</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span>                 <span class="comment"># è·¯å¾„</span></span><br><span class="line">        <span class="attr">backend:</span>                <span class="comment"># åç«¯æœåŠ¡</span></span><br><span class="line">          <span class="attr">service:</span>              <span class="comment"># å£°æ˜åç«¯æ˜¯ä¸€ä¸ª service</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">nginx</span>         <span class="comment"># serviceåç§°ï¼Œæå‰åˆ›å»ºå¥½ serviceï¼Œç±»å‹å¯ä»¥æ˜¯ClusterIPã€NodePortã€LoadBalancerä»»æ„ï¼Œæ¨èClusterIPï¼Œå› ä¸ºä½¿ç”¨ ingress çš„è¯ï¼Œå°±æ²¡å¿…è¦åˆ›å»ºå…¶å®ƒç±»å‹çš„ service äº†</span></span><br><span class="line">            <span class="attr">port:</span>               <span class="comment"># ç«¯å£</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span>        <span class="comment"># serviceçš„ç«¯å£</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ ingress èµ„æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ k get ing -n ns1</span><br><span class="line">NAME          CLASS   HOSTS                  ADDRESS         PORTS   AGE</span><br><span class="line">web-ingress   nginx   nginx.hanqunfeng.com   10.211.55.201   80      80s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è®¿é—® web-ingress</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†åŸŸå nginx.hanqunfeng.com è§£æåˆ° 10.211.55.201ï¼Œå¦‚æœæ˜¯å†…éƒ¨åŸŸåå¯ä»¥é€šè¿‡ hosts æ–‡ä»¶æ·»åŠ è§£æ</span></span><br><span class="line"><span class="comment"># åªèƒ½é€šè¿‡ nginx.hanqunfeng.com è®¿é—®ï¼Œä¸èƒ½é€šè¿‡ 10.211.55.201 è®¿é—®</span></span><br><span class="line">curl http://nginx.hanqunfeng.com</span><br></pre></td></tr></table></figure><h2 id="è®©-Ingress-æ”¯æŒ-HTTPS-è®¿é—®">è®© Ingress æ”¯æŒ HTTPS è®¿é—®</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºè¯ä¹¦ï¼Œå¯ä»¥åœ¨é˜¿é‡Œäº‘ä¸Šç”³è¯·ä¸€ä¸ªå…è´¹çš„è¯ä¹¦</p></li><li class="lvl-2"><p>åˆ›å»º secret</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret tls nginx-tls \</span><br><span class="line">    --key=nginx.hanqunfeng.com.key \</span><br><span class="line">    --cert=nginx.hanqunfeng.com.pem \</span><br><span class="line">    -n default</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¹Ÿå¯ä»¥é€šè¿‡yamlåˆ›å»º</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-tls</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">tls.crt:</span> <span class="string">base64</span> <span class="string">ç¼–ç çš„è¯ä¹¦ï¼Œè€Œéæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  <span class="attr">tls.key:</span> <span class="string">base64</span> <span class="string">ç¼–ç çš„ç§é’¥ï¼Œè€Œéæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">kubernetes.io/tls</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä½ çš„ Ingress èµ„æºéœ€è¦å¢åŠ  tls å­—æ®µï¼Œå¼•ç”¨ä¸€ä¸ª Secret å­˜å‚¨çš„ TLS è¯ä¹¦ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span>                   <span class="comment"># Ingress èµ„æº</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-ingress</span>             <span class="comment"># Ingress åç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span>            <span class="comment"># Ingress æ‰€åœ¨çš„å‘½åç©ºé—´</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span>       <span class="comment"># Ingress ä½¿ç”¨çš„ IngressClass</span></span><br><span class="line">  <span class="attr">tls:</span>                          <span class="comment"># é…ç½® TLS</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span>                      <span class="comment"># åŸŸååˆ—è¡¨</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nginx.hanqunfeng.com</span>      <span class="comment"># åŸŸå</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">nginx-tls</span>       <span class="comment"># å­˜æ”¾è¯ä¹¦çš„ Secret</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">nginx.hanqunfeng.com</span>  <span class="comment">#è½¬å‘åŸŸå</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span>        <span class="comment"># è·¯å¾„åŒ¹é…è§„åˆ™, å‰ç¼€åŒ¹é…</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span>                 <span class="comment"># è·¯å¾„</span></span><br><span class="line">        <span class="attr">backend:</span>                <span class="comment"># åç«¯æœåŠ¡</span></span><br><span class="line">          <span class="attr">service:</span>              <span class="comment"># service</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">nginx</span>         <span class="comment"># serviceåç§°</span></span><br><span class="line">            <span class="attr">port:</span>               <span class="comment"># ç«¯å£</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span>        <span class="comment"># serviceçš„ç«¯å£</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡æ–°è¿è¡Œingress</span></span><br><span class="line">k apply -f nginx-ingress.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ingressï¼Œæ­¤æ—¶å¤šäº†ä¸€ä¸ª 443 ç«¯å£</span></span><br><span class="line">$ k get ing</span><br><span class="line">NAME          CLASS   HOSTS                  ADDRESS         PORTS     AGE</span><br><span class="line">web-ingress   nginx   nginx.hanqunfeng.com   10.211.55.201   80, 443   51s</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®httpsï¼Œä½†æ­¤æ—¶ 80 ç«¯å£è®¿é—®ä¸äº†ï¼Œéœ€è¦é…ç½® 80 ç«¯å£é‡å®šå‘åˆ° 443</span></span><br><span class="line">curl https://nginx.hanqunfeng.com</span><br></pre></td></tr></table></figure><h2 id="80ç«¯å£é‡å®šå‘åˆ°443">80ç«¯å£é‡å®šå‘åˆ°443</h2><ul class="lvl-0"><li class="lvl-2"><p><code>nginx ingress controller</code>ï¼Œå®ƒå†…ç½®æ”¯æŒé‡å®šå‘ï¼Œä½ å¯ä»¥åœ¨ Ingress ä¸Šæ·»åŠ  annotation</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class="string">&quot;true&quot;</span>  <span class="comment"># 80 é‡å®šå‘åˆ° 443</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®Œæ•´çš„yaml</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nginx.hanqunfeng.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">nginx-tls</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">nginx.hanqunfeng.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è®¿é—®æµ‹è¯•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡æ–°è¿è¡Œingress</span></span><br><span class="line">k apply -f nginx-ingress.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤æƒ…å†µä¸‹ curl ä¸ä¼šè‡ªåŠ¨è·³è½¬ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ä¼šè‡ªåŠ¨é‡å®šå‘ï¼Œ308 è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘</span></span><br><span class="line">$ curl http://nginx.hanqunfeng.com</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;&lt;title&gt;308 Permanent Redirect&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;308 Permanent Redirect&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ  -L å‚æ•°ï¼Œcurl ä¼šè‡ªåŠ¨è·³è½¬</span></span><br><span class="line">$ curl -L http://nginx.hanqunfeng.com</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color-scheme: light dark; &#125;</span><br><span class="line">body &#123; width: 35em; margin: 0 auto;</span><br><span class="line">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you <span class="keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><h3 id="ssl-è¯ä¹¦è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ">ssl è¯ä¹¦è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apply ä¼šç›´æ¥æ›´æ–° Secretï¼Œè€Œä¸æ˜¯åˆ é™¤é‡å»º</span></span><br><span class="line">kubectl create secret tls nginx-tls \</span><br><span class="line">    --key=æ–°çš„.key \</span><br><span class="line">    --cert=æ–°çš„.pem \</span><br><span class="line">    -n default --dry-run=client -o yaml | kubectl apply -f -</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Ingress Controllerï¼ˆå¦‚ nginx-ingressï¼‰é€šå¸¸ä¼šè‡ªåŠ¨ç›‘å¬ Secret å˜åŒ–ï¼Œå¤§æ¦‚ 30 ç§’ ~ 1 åˆ†é’Ÿå†…è‡ªåŠ¨çƒ­åŠ è½½æ–°è¯ä¹¦ï¼Œæ— éœ€é‡å¯ Podã€‚</p></li></ul><h3 id="pathType-å¯ä»¥è®¾ç½®å“ªäº›å€¼ï¼Ÿ">pathType å¯ä»¥è®¾ç½®å“ªäº›å€¼ï¼Ÿ</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ Kubernetes Ingress çš„ pathType å­—æ®µä¸­ï¼Œä¸€å…±å¯ä»¥è®¾ç½®ä»¥ä¸‹ä¸‰ç§å€¼</p></li></ul><table><thead><tr><th><strong>pathType å€¼</strong></th><th><strong>å«ä¹‰</strong></th><th><strong>åŒ¹é…è§„åˆ™è¯´æ˜</strong></th></tr></thead><tbody><tr><td><strong>Exact</strong></td><td>ç²¾ç¡®åŒ¹é…</td><td>è·¯å¾„å¿…é¡»<strong>å®Œå…¨åŒ¹é…</strong></td></tr><tr><td><strong>Prefix</strong></td><td>å‰ç¼€åŒ¹é…</td><td>ä»¥æŒ‡å®šè·¯å¾„ä¸º<strong>å‰ç¼€</strong>å³å¯åŒ¹é…</td></tr><tr><td><strong>ImplementationSpecific</strong></td><td>ç”± Ingress Controller è‡ªå·±å†³å®š</td><td>nginx å¸¸å¸¸è¡¨ç°ä¸ºå‰ç¼€åŒ¹é…</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Exact ç²¾ç¡®åŒ¹é…ï¼Œä¸”åŒºåˆ†å¤§å°å†™</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªåŒ¹é… http://example.com/foo</span></span><br><span class="line"><span class="comment"># ä¸ä¼šåŒ¹é… /foo/abc æˆ– /foo/</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Exact</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">/foo</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Prefix å‰ç¼€åŒ¹é…ï¼Œä¸”åŒºåˆ†å¤§å°å†™</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒ¹é…æ‰€æœ‰ä»¥ /foo å¼€å¤´çš„è·¯å¾„ï¼š</span></span><br><span class="line"><span class="comment">#   /foo</span></span><br><span class="line"><span class="comment">#   /foo/   # ä¼šå¿½ç•¥å°¾éƒ¨çš„ /</span></span><br><span class="line"><span class="comment">#   /foo/abc</span></span><br><span class="line"><span class="comment">#   /foo/bar/test</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">/foo</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ImplementationSpecific æ§åˆ¶å™¨è‡ªå®šä¹‰ï¼ˆä¸æ¨èï¼‰</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒ¹é…è§„åˆ™ç”± Ingress Controller å†³å®šï¼›</span></span><br><span class="line"><span class="comment"># åœ¨ nginx-ingress ä¸­é€šå¸¸è¡Œä¸ºç±»ä¼¼äº Prefixï¼Œä½†ä¸ä¿è¯å…¼å®¹æ€§ï¼›</span></span><br><span class="line"><span class="comment"># Kubernetes å®˜æ–¹ä¸æ¨èç”Ÿäº§ä½¿ç”¨ï¼Œå»ºè®®æ˜¾å¼ä½¿ç”¨ Prefix æˆ– Exactã€‚</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">ImplementationSpecific</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">/foo</span></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®ç¼ºçœçš„-ingressclass">è®¾ç½®ç¼ºçœçš„ ingressclass</h3><ul class="lvl-0"><li class="lvl-2"><p>æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªç¼ºçœçš„ ingressclass ä¸ºé»˜è®¤å€¼ï¼Œè¿™æ ·ï¼Œå½“åˆ›å»ºingressæ—¶ï¼Œå¦‚æœæœªæŒ‡å®šingressclassï¼Œåˆ™ä½¿ç”¨ç¼ºçœå€¼</p></li><li class="lvl-2"><p>å¯ä»¥é€šè¿‡ kubectl patch ä¸º ingressclass ç›´æ¥æ‰“ä¸Šé»˜è®¤æ ‡è¯†(é€šè¿‡ k edit ingressclass ingressclass-name ä¸ºå…¶æ·»åŠ æ³¨è§£ä¹Ÿå¯ä»¥)</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ ingressclasses</span></span><br><span class="line">$ k get ingressclasses</span><br><span class="line">NAME    CONTROLLER             PARAMETERS   AGE</span><br><span class="line">nginx   k8s.io/ingress-nginx   &lt;none&gt;       3h3m</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½® nginx ä¸ºé»˜è®¤ ingressclassï¼Œå°±æ˜¯ä¸ºå…¶åŠ ä¸Šå¦‚ä¸‹æ³¨è§£</span></span><br><span class="line">$ kubectl patch ingressclass nginx -p <span class="string">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;ingressclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="ingerss-nginx-åº”ç”¨ç¤ºä¾‹">ingerss-nginx åº”ç”¨ç¤ºä¾‹</h3><ul class="lvl-0"><li class="lvl-2"><p>åŒä¸€åŸŸåä¸åŒè·¯å¾„<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/s1XbqM.png" alt=""></p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">simple-fanout-example</span></span><br><span class="line"><span class="attr">spec:</span>                       <span class="comment"># æœªæŒ‡å®š ingressClassName ,åˆ™ä½¿ç”¨ ä¸Šæ–‡ä¸­è®¾ç½®çš„é»˜è®¤ ingressClassName</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">foo.bar.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/foo</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service1</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">4200</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/bar</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service2</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸åŒåŸŸåçš„æœåŠ¡<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/sBhmbR.png" alt=""></p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">name-virtual-host-ingress</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">foo.bar.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;/&quot;</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service1</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">bar.foo.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;/&quot;</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service2</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯¹ ingress è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹ä¿å­˜(:wq)åä¼šç«‹åˆ»ç”Ÿæ•ˆ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit ingress web-ingress</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S å®‰è£…åŠä½¿ç”¨ Ingress Nginxï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.github.io/ingress-nginx/&quot;&gt;ingress-nginx å®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/&quot;&gt;ingress-nginx k8sç®€ä»‹&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/&quot;&gt;k8sæ”¯æŒçš„ ingress controller&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ Service</title>
    <link href="https://blog.hanqunfeng.com/2025/07/18/k8s-service/"/>
    <id>https://blog.hanqunfeng.com/2025/07/18/k8s-service/</id>
    <published>2025-07-18T14:30:05.000Z</published>
    <updated>2025-07-20T13:49:29.985Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ Service ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/">k8s Service ä»‹ç»</a></p></li></ul><span id="more"></span><h2 id="Service-ä»‹ç»">Service ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>Service(ç¼©å†™ä¸º svc)æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„Podçš„é€»è¾‘é›†ï¼Œå¹¶ä¸ºè¿™äº›Podæ”¯æŒå¤–éƒ¨æµé‡æš´éœ²ã€è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°ã€‚</p></li><li class="lvl-2"><p>å°½ç®¡æ¯ä¸ªPod éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰Serviceï¼Œè¿™äº›IPä¸ä¼šæš´éœ²åœ¨ç¾¤é›†å¤–éƒ¨ã€‚</p></li><li class="lvl-2"><p>Serviceå…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºæ¥æ”¶æµé‡ã€‚</p></li><li class="lvl-2"><p>Serviceä¹Ÿå¯ä»¥ç”¨åœ¨ServiceSpecæ ‡è®°typeçš„æ–¹å¼æš´éœ²ï¼Œtypeç±»å‹å¦‚ä¸‹ï¼š</p><ul class="lvl-2"><li class="lvl-4">ClusterIPï¼ˆé»˜è®¤ï¼‰ï¼šåœ¨é›†ç¾¤çš„å†…éƒ¨IPä¸Šå…¬å¼€Serviceã€‚è¿™ç§ç±»å‹ä½¿å¾—Serviceåªèƒ½ä»é›†ç¾¤å†…è®¿é—®ã€‚</li><li class="lvl-4">NodePortï¼šä½¿ç”¨NATåœ¨é›†ç¾¤ä¸­æ¯ä¸ªé€‰å®šNodeçš„ç›¸åŒç«¯å£ä¸Šå…¬å¼€Serviceã€‚ä½¿ç”¨ <NodeIP>:<NodePort> ä»é›†ç¾¤å¤–éƒ¨è®¿é—®Serviceã€‚æ˜¯ClusterIPçš„è¶…é›†ã€‚</li><li class="lvl-4">LoadBalancerï¼šåœ¨å½“å‰äº‘ä¸­åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨(å¦‚æœæ”¯æŒçš„è¯)ï¼Œå¹¶ä¸ºServiceåˆ†é…ä¸€ä¸ªå›ºå®šçš„å¤–éƒ¨IPã€‚æ˜¯NodePortçš„è¶…é›†ã€‚</li><li class="lvl-4">ExternalNameï¼šé€šè¿‡è¿”å›å¸¦æœ‰è¯¥åç§°çš„CNAMEè®°å½•ï¼Œä½¿ç”¨ä»»æ„åç§°ï¼ˆç”±specä¸­çš„externalNameæŒ‡å®šï¼‰å…¬å¼€Serviceã€‚ä¸ä½¿ç”¨ä»£ç†ã€‚</li></ul></li></ul><h2 id="åˆ›å»ºService">åˆ›å»ºService</h2><h3 id="ClusterIP">ClusterIP</h3><ul class="lvl-0"><li class="lvl-2"><p>åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆåˆ›å»ºdeploymentï¼Œæ­¤æ—¶ä¼šä¸ºæ¯ä¸ªpodæ·»åŠ ä¸€ä¸ªlabel app=nginx</span></span><br><span class="line">kubectl create deployment nginx --image=nginx --replicas=2</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºserviceï¼Œï¼Œå°†deploymentçš„podæš´éœ²å‡ºæ¥ï¼Œæš´éœ²ç±»å‹ä¸ºClusterIP</span></span><br><span class="line">kubectl expose deployment nginx --<span class="built_in">type</span>=ClusterIP --port=80</span><br><span class="line">$ kubectl get svc nginx</span><br><span class="line">NAME    TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">nginx   ClusterIP   10.96.14.90   &lt;none&gt;        80/TCP    60s</span><br></pre></td></tr></table></figure><h3 id="NodePort">NodePort</h3><ul class="lvl-0"><li class="lvl-2"><p>æš´éœ²å®¿ä¸»æœºçš„ç«¯å£ï¼Œä¾›å¤–éƒ¨è®¿é—®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºserviceï¼Œå°†deploymentçš„podæš´éœ²å‡ºæ¥ï¼Œæš´éœ²ç±»å‹ä¸ºNodePort</span></span><br><span class="line">kubectl expose deployment nginx --<span class="built_in">type</span>=NodePort --port=80</span><br><span class="line"><span class="comment"># æŸ¥çœ‹serviceï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°serviceçš„ç«¯å£å’ŒèŠ‚ç‚¹çš„ç«¯å£ï¼Œä¸ ClusterIP çš„åŒºåˆ«å°±æ˜¯æ˜¯å¦æš´éœ²åœ¨èŠ‚ç‚¹ä¸Šçš„ç«¯å£</span></span><br><span class="line">$ kubectl get svc nginx</span><br><span class="line">NAME    TYPE       CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">nginx   NodePort   10.96.7.8    &lt;none&gt;        80:32691/TCP   31s</span><br></pre></td></tr></table></figure><h3 id="yamlæ–‡ä»¶åˆ›å»ºservice">yamlæ–‡ä»¶åˆ›å»ºservice</h3><ul class="lvl-0"><li class="lvl-2"><p>yamlæ–‡ä»¶æ ¼å¼</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>      <span class="comment"># apiç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>       <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line"><span class="attr">metadata:</span>           <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span>       <span class="comment"># serviceåç§°</span></span><br><span class="line"><span class="attr">spec:</span>               <span class="comment"># é…ç½®</span></span><br><span class="line">  <span class="attr">ports:</span>            <span class="comment"># ç«¯å£</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span>        <span class="comment"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span>   <span class="comment"># åè®®</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span>  <span class="comment"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30080</span> <span class="comment"># nodeæš´éœ²çš„ç«¯å£ï¼Œserviceç±»å‹ä¸º NodePort æ—¶ä½¿ç”¨ï¼Œé»˜è®¤èŒƒå›´åœ¨ 30000-32767 ä¹‹é—´</span></span><br><span class="line">  <span class="attr">selector:</span>         <span class="comment"># é€‰æ‹©å™¨</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span>      <span class="comment"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=nginx</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span>    <span class="comment"># serviceç±»å‹</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼Œservice é»˜è®¤æ˜¯é€šè¿‡<code>æ ‡ç­¾</code>æ¥åŒ¹é…podçš„ï¼Œæ‰€ä»¥åˆ›å»ºserviceçš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿è¯podçš„æ ‡ç­¾æ˜¯å­˜åœ¨çš„ï¼Œå¦åˆ™serviceæ— æ³•åŒ¹é…podï¼Œå¦å¤–è™½ç„¶æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºserviceæ—¶æ˜¯é€šè¿‡<code>kubectl expose deployment nginx --type=NodePort --port=80</code>åˆ›å»ºçš„ï¼Œä½†ä¹Ÿå¹¶ä¸è¡¨ç¤ºserviceåªä¼šåŒ¹é…è¿™ä¸ªdeploymentåˆ›å»ºçš„podï¼Œè€Œæ˜¯ä¼šåŒ¹é…æ‰€æœ‰å…·æœ‰æŒ‡å®šæ ‡ç­¾çš„podï¼ˆapp=nginxï¼‰ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–serviceçš„ selector</span></span><br><span class="line">$ k get svc -owide</span><br><span class="line">NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE    SELECTOR</span><br><span class="line">kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP        4d5h   &lt;none&gt;</span><br><span class="line">nginx        NodePort    10.96.9.77   &lt;none&gt;        80:30080/TCP   8s     app=nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæœ‰ä¸ªåç§°ä¸º kubernetes çš„ serviceï¼Œå…¶ä½œç”¨æ˜¯ä¸ºäº†æ–¹ä¾¿é›†ç¾¤å†…éƒ¨çš„ Pod è°ƒç”¨ API Server çš„ç»Ÿä¸€å…¥å£</span></span><br><span class="line"><span class="comment"># æ— è®º API Server å®é™…è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹å“ªä¸ª IPï¼Œé›†ç¾¤å†…éƒ¨åªè¦è®¿é—®å¦‚ä¸‹åœ°å€å°±èƒ½è®¿é—® API Serverã€‚</span></span><br><span class="line"><span class="comment"># https://kubernetes.default.svc</span></span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line"><span class="comment"># https://10.96.0.1</span></span><br><span class="line"><span class="comment"># è¿™ä¸ª Service æ˜¯ ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œä¸å»ºè®®åˆ é™¤æˆ–ä¿®æ”¹ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="ExternalName">ExternalName</h3><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥å°†å…¶å®ƒ namespace çš„ service åˆ«ååˆ° å½“å‰ namespaceï¼Œè¿™æ ·è®¿é—® service æ—¶å°±ä¸éœ€è¦åŠ ä¸Šå‘½åç©ºé—´åç§°äº†</p></li><li class="lvl-2"><p>ExternalName Service æ˜¯çº¯ DNS CNAME æ˜ å°„ï¼Œæˆ‘ä»¬ä¸ç»å¯ä»¥æ˜ å°„é›†ç¾¤å†…å®¹æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜ å°„é›†ç¾¤å¤–éƒ¨æœåŠ¡ã€‚</p></li><li class="lvl-2"><p>åŸå…ˆçš„ service è®¿é—®æ–¹å¼ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ä¸åŒå‘½åç©ºé—´ä¸‹åˆ›å»ºservice</span></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸¤ä¸ªå‘½åç©ºé—´ä»¥åŠä¸‹é¢çš„èµ„æº</span></span><br><span class="line"><span class="comment">## ns1</span></span><br><span class="line">kubectl create namespace ns1</span><br><span class="line">kubectl create deployment alpine-demo -n ns1 --image=alpine/curl --replicas=1 -- /bin/sh -c <span class="string">&quot;sleep infinity&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ns2</span></span><br><span class="line">kubectl create namespace ns2</span><br><span class="line">kubectl create deployment nginx-demo -n ns2 --image=nginx --replicas=1</span><br><span class="line">kubectl expose deployment nginx-demo -n ns2 --<span class="built_in">type</span>=ClusterIP --port=80 --name=nginx-service</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥ ns1 ä¸­çš„ pod è®¿é—® ns2 ä¸­çš„ nginx-service</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it -n ns1 alpine-demo-66895487c8-sk4t4 -- /bin/sh</span><br><span class="line">curl nginx-service.ns2.svc.cluster.local</span><br><span class="line">curl nginx-service.ns2</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ExternalName è®¿é—®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ ns1 ä¸­åˆ›å»º externalName ç±»å‹çš„ serviceï¼Œ--external-name æŒ‡å®š ns2 ä¸­çš„ nginx-service</span></span><br><span class="line">kubectl create service externalname nginx-service -n ns1 --external-name=nginx-service.ns2.svc.cluster.local</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¹Ÿå¯ä»¥é€šè¿‡ yaml åˆ›å»º</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-service</span>                               <span class="comment"># service åç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ns1</span>                                    <span class="comment"># æŒ‡å®šå‘½åç©ºé—´ ä¸º ns1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">externalName:</span> <span class="string">nginx-service.ns2.svc.cluster.local</span> <span class="comment"># æŒ‡å®šå¤–éƒ¨æœåŠ¡åï¼Œæ¯”å¦‚ www.baidu.com</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ExternalName</span>                                <span class="comment"># æŒ‡å®šä¸º ExternalName ç±»å‹</span></span><br><span class="line">  <span class="attr">selector:</span>                                         <span class="comment"># ä¸éœ€è¦é…ç½® selector</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-service</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ service</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ k get svc -n ns1</span><br><span class="line">NAME            TYPE           CLUSTER-IP   EXTERNAL-IP                           PORT(S)   AGE</span><br><span class="line">nginx-service   ExternalName   &lt;none&gt;       nginx-service.ns2.svc.cluster.local   &lt;none&gt;    16s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶å†æ¬¡è¿›å…¥ ns1 ä¸­çš„ pod è®¿é—® ns2 ä¸­çš„ nginx-service æœåŠ¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -it -n ns1 alpine-demo-66895487c8-sk4t4 -- /bin/sh</span><br><span class="line"><span class="comment"># æ­¤æ—¶å°±ä¸éœ€è¦åŠ ä¸Š ns2 çš„ namespace äº†</span></span><br><span class="line">curl nginx-service</span><br></pre></td></tr></table></figure><h3 id="LoadBalancer">LoadBalancer</h3><ul class="lvl-0"><li class="lvl-2"><p>LoadBalancer æ˜¯ Kubernetes Service çš„ä¸€ç§ç±»å‹ï¼Œç”¨äºè‡ªåŠ¨ç”³è¯·ä¸€ä¸ªäº‘å‚å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ AWS ELBã€GCP LBã€é˜¿é‡Œäº‘ SLBï¼‰ï¼Œå°†å¤–éƒ¨æµé‡è½¬å‘åˆ° Kubernetes é›†ç¾¤å†…éƒ¨çš„ Pod ä¸Šã€‚</p></li><li class="lvl-2"><p>åœ¨ç§æœ‰äº‘ä¸Šï¼Œéœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹è´Ÿè½½å‡è¡¡å™¨æ¥å®ç°ï¼Œæ¯”å¦‚ <a href="https://metallb.io">MetalLB</a>ï¼Œ<a href="https://github.com/metallb/metallb">github</a></p></li></ul><h4 id="å®‰è£…-MetallB">å®‰è£… MetallB</h4><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœæ‚¨åœ¨IPVSæ¨¡å¼ä¸‹ä½¿ç”¨kubeä»£ç†ï¼Œä»Kubernetes v1.14.2å¼€å§‹ï¼Œæ‚¨å¿…é¡»å¯ç”¨ä¸¥æ ¼çš„ARPæ¨¡å¼ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨kube-routerä½œä¸ºæœåŠ¡ä»£ç†ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸ªï¼Œå› ä¸ºå®ƒé»˜è®¤å¯ç”¨äº†ä¸¥æ ¼çš„ARPã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å°†è¦äº§ç”Ÿçš„å˜æ›´ï¼Œå¦‚æœæœ‰å˜æ›´åˆ™è¿”å›éé›¶çŠ¶æ€ç </span></span><br><span class="line">kubectl get configmap kube-proxy -n kube-system -o yaml | \</span><br><span class="line">sed -e <span class="string">&quot;s/strictARP: false/strictARP: true/&quot;</span> | \</span><br><span class="line">kubectl diff -f - -n kube-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®é™…åº”ç”¨å˜æ›´ï¼Œåªæœ‰å‘ç”Ÿé”™è¯¯æ—¶æ‰è¿”å›éé›¶çŠ¶æ€ç </span></span><br><span class="line">kubectl get configmap kube-proxy -n kube-system -o yaml | \</span><br><span class="line">sed -e <span class="string">&quot;s/strictARP: false/strictARP: true/&quot;</span> | \</span><br><span class="line">kubectl apply -f - -n kube-system</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…MetalLB</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> METLB_VERSION=v0.15.2</span><br><span class="line">curl -L -o metallb.yaml https://raw.githubusercontent.com/metallb/metallb/<span class="variable">$&#123;METLB_VERSION&#125;</span>/config/manifests/metallb-native.yaml</span><br><span class="line">kubectl apply -f metallb.yaml</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹MetalLBèµ„æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ k get all -n metallb-system -owide</span><br><span class="line">NAME                              READY   STATUS    RESTARTS      AGE     IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">pod/controller-58fdf44d87-bsp4z   1/1     Running   0             4m13s   10.244.194.104   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod/speaker-sjvq5                 1/1     Running   0             4m13s   10.211.55.15     k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod/speaker-srpp4                 1/1     Running   0             4m13s   10.211.55.16     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod/speaker-tbnls                 1/1     Running   2 (98s ago)   4m13s   10.211.55.11     k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">NAME                              TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE     SELECTOR</span><br><span class="line">service/metallb-webhook-service   ClusterIP   10.96.233.8   &lt;none&gt;        443/TCP   4m14s   component=controller</span><br><span class="line"></span><br><span class="line">NAME                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE     CONTAINERS   IMAGES                            SELECTOR</span><br><span class="line">daemonset.apps/speaker   3         3         3       3            3           kubernetes.io/os=linux   4m13s   speaker      quay.io/metallb/speaker:v0.15.2   app=metallb,component=speaker</span><br><span class="line"></span><br><span class="line">NAME                         READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS   IMAGES                               SELECTOR</span><br><span class="line">deployment.apps/controller   1/1     1            1           4m14s   controller   quay.io/metallb/controller:v0.15.2   app=metallb,component=controller</span><br><span class="line"></span><br><span class="line">NAME                                    DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES                               SELECTOR</span><br><span class="line">replicaset.apps/controller-58fdf44d87   1         1         1       4m13s   controller   quay.io/metallb/controller:v0.15.2   app=metallb,component=controller,pod-template-hash=58fdf44d87</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®åœ°å€æ± :metallb-pool.yaml</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">metallb.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">IPAddressPool</span>                 <span class="comment"># åœ°å€æ± ç±»å‹</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metallb-pool</span>                <span class="comment"># åœ°å€æ± åç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">metallb-system</span>         <span class="comment"># å‘½åç©ºé—´</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">addresses:</span>                        <span class="comment"># é…ç½®åœ°å€æ± </span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">10.211</span><span class="number">.55</span><span class="number">.200</span><span class="number">-10.211</span><span class="number">.55</span><span class="number">.250</span>     <span class="comment"># ä¸ èŠ‚ç‚¹ ç›¸åŒçš„ç½‘æ®µï¼Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥åˆ†é…çš„IPèŒƒå›´</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f metallb-pool.yaml</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®åœ°å€æ± çš„äºŒçº§å…¬å‘Š:metallb-advertisement.yaml</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">metallb.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">L2Advertisement</span>               <span class="comment"># åœ°å€æ± äºŒçº§å…¬å‘Šç±»å‹</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">metallb-advertisement</span>       <span class="comment"># å…¬å‘Šåç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">metallb-system</span>         <span class="comment"># å‘½åç©ºé—´</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ipAddressPools:</span>                   <span class="comment"># åœ°å€æ± åç§°åˆ—è¡¨ï¼Œåªæœ‰è¢«å…¬å‘Šçš„åœ°å€æ± æ‰ä¼šè¢«ä½¿ç”¨</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">metallb-pool</span>                    <span class="comment"># åœ°å€æ± åç§°</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f metallb-advertisement.yaml</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»º-LoadBalancer-ç±»å‹çš„-service">åˆ›å»º LoadBalancer ç±»å‹çš„ service</h4><ul class="lvl-0"><li class="lvl-2"><p>metallb-service.yaml</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>                  <span class="comment"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº Deployment èµ„æº</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>                     <span class="comment"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆDeploymentï¼‰</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span>                       <span class="comment"># æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†èµ„æºï¼Œå¯ä¸ selector åŒ¹é…</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span>                        <span class="comment"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ns1</span>                     <span class="comment"># å‘½åç©ºé—´ï¼Œé»˜è®¤ä¸º default</span></span><br><span class="line"><span class="attr">spec:</span>                                <span class="comment"># é…ç½®é¡¹</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span>                        <span class="comment"># å‰¯æœ¬æ•°ï¼Œè¡¨ç¤ºå¸Œæœ›è¿è¡Œå¤šå°‘ä¸ª Pod å®ä¾‹</span></span><br><span class="line">  <span class="attr">selector:</span>                          <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>                     <span class="comment"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span>                     <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š Deployment ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class="line">  <span class="attr">template:</span>                          <span class="comment"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span>                   <span class="comment"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx</span>                 <span class="comment"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ nginx é•œåƒ</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span>                  <span class="comment"># å®¹å™¨çš„åç§°</span></span><br><span class="line"><span class="string">---</span>                                  <span class="comment"># åˆ†å‰²çº¿</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                       <span class="comment"># apiç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>                        <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line"><span class="attr">metadata:</span>                            <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span>                        <span class="comment"># serviceåç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ns1</span>                     <span class="comment"># å‘½åç©ºé—´</span></span><br><span class="line"><span class="attr">spec:</span>                                <span class="comment"># é…ç½®</span></span><br><span class="line">  <span class="attr">ports:</span>                             <span class="comment"># ç«¯å£</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span>                         <span class="comment"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span>                    <span class="comment"># åè®®</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span>                   <span class="comment"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class="line">  <span class="attr">selector:</span>                          <span class="comment"># é€‰æ‹©å™¨</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span>                       <span class="comment"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=nginx</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span>                 <span class="comment"># serviceç±»å‹</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ k apply -f metallb-service.yaml</span><br><span class="line">deployment.apps/nginx created</span><br><span class="line">service/nginx created</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹service</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ä»¥çœ‹åˆ° service çš„ç±»å‹ä¸º LoadBalancerï¼Œå¹¶åˆ†é…äº† EXTERNAL-IPï¼Œè¿™é‡Œè¿˜å¼€æ”¾äº†nodePort 30613</span></span><br><span class="line">$ kubectl get svc -n ns1</span><br><span class="line">NAME         TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE</span><br><span class="line">nginx        LoadBalancer   10.96.210.244   10.211.55.200   80:30613/TCP   52s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è®¿é—®service</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡ service çš„ port è®¿é—®ï¼Œè¿™é‡Œæ˜¯ 80</span></span><br><span class="line">curl 10.211.55.200</span><br><span class="line"><span class="comment"># åŒæ ·å¯ä»¥åŸºäº nodeIP+nodePort è®¿é—®</span></span><br><span class="line">curl 10.211.55.11:30613</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®serviceï¼Œè½®è¯¢pod">è®¿é—®serviceï¼Œè½®è¯¢pod</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## åœ¨é›†ç¾¤å†…</span></span><br><span class="line"><span class="comment"># åœ¨ç›¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ serviceName ç›´æ¥è®¿é—®</span></span><br><span class="line">curl nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥é€šè¿‡ CLUSTER-IP è®¿é—®</span></span><br><span class="line">curl 10.96.9.77</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ä¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ &lt;serviceName&gt;.&lt;namespace&gt; æˆ–è€… &lt;serviceName&gt;.&lt;namespace&gt;.svc.cluster.local è®¿é—®ï¼Œæ¯”å¦‚æœ¬ç¤ºä¾‹ä¸º</span></span><br><span class="line">curl nginx.default</span><br><span class="line">curl nginx.default.svc.cluster.local</span><br><span class="line"><span class="comment"># è¿™æ˜¯å› ä¸ºåœ¨åˆ›å»º serviceå‰ï¼Œæˆ‘ä»¬æ˜¯ä¸çŸ¥é“ service çš„ IP åœ°å€çš„ï¼Œæ‰€ä»¥åœ¨å…¶å®ƒpodä¸­å°±å¯ä»¥é¢„å…ˆä½¿ç”¨ &lt;serviceName&gt;.&lt;namespace&gt; å ä½ï¼Œk8sä¼šè‡ªåŠ¨å°†å…¶è§£æä¸º service çš„ CLUSTER-IP</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## åœ¨é›†ç¾¤å¤–</span></span><br><span class="line"><span class="comment"># é€šè¿‡ NODE-IP:NODE-PORT è®¿é—®</span></span><br><span class="line">curl 10.211.55.16:30080</span><br></pre></td></tr></table></figure><h2 id="ç®¡ç†service">ç®¡ç†service</h2><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹service</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹service</span></span><br><span class="line">kubectl get svc</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šnamespaceä¸‹çš„service</span></span><br><span class="line">kubectl get svc -n kube-system</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å…¨éƒ¨service</span></span><br><span class="line">kubectl get svc -A</span><br><span class="line"><span class="comment"># æŸ¥çœ‹serviceè¯¦æƒ…</span></span><br><span class="line">kubectl get svc nginx -o yaml</span><br><span class="line">kubectl describe svc nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">k logs svc/nginx</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¼–è¾‘serviceï¼Œä¿å­˜ï¼ˆ:wqï¼‰åç”Ÿæ•ˆï¼Œä¸éœ€è¦é¢å¤– apply æˆ– restart</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit svc nginx</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤service</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete svc nginx</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ Service ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/&quot;&gt;k8s Service ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>acme.sh è‡ªåŠ¨ç”³è¯·å¹¶ç»­ç­¾ SSL è¯ä¹¦çš„å·¥å…·</title>
    <link href="https://blog.hanqunfeng.com/2025/07/17/acme/"/>
    <id>https://blog.hanqunfeng.com/2025/07/17/acme/</id>
    <published>2025-07-17T14:30:05.000Z</published>
    <updated>2025-07-19T07:00:35.350Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»è‡ªåŠ¨ç”³è¯·å¹¶ç»­ç­¾ SSL è¯ä¹¦çš„å·¥å…·: <a href="http://acme.sh">acme.sh</a></p></li><li class="lvl-2"><p><a href="https://github.com/acmesh-official/acme.sh">acme.sh Github</a></p></li></ul><span id="more"></span><h2 id="acme-sh-ä»‹ç»"><a href="http://acme.sh">acme.sh</a> ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="http://acme.sh">acme.sh</a> å®ç°äº† acme åè®®ï¼Œå¯ä»¥ä» ZeroSSLï¼ŒLetâ€™s Encrypt ç­‰ CA ç”Ÿæˆå…è´¹çš„è¯ä¹¦ã€‚</p></li><li class="lvl-2"><p>é€‚ç”¨åœºæ™¯ï¼šshellè„šæœ¬æ–¹å¼ï¼Œå‡ ä¹æ— ä¾èµ–ï¼Œæç®€ï¼Œé€‚åˆä¸æƒ³å®‰è£…Pythonç¯å¢ƒçš„äººã€‚</p></li><li class="lvl-2"><p>ç‰¹ç‚¹ï¼š</p><ul class="lvl-2"><li class="lvl-4">çº¯ Shell è„šæœ¬ï¼Œå•æ–‡ä»¶è¿è¡Œ</li><li class="lvl-4">æ”¯æŒ 100+ DNS API è‡ªåŠ¨ç»­ç­¾ï¼ˆå¦‚ Cloudflareã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰</li><li class="lvl-4">æ”¯æŒé€šé…ç¬¦è¯ä¹¦</li></ul></li></ul><h2 id="acme-sh-å®‰è£…"><a href="http://acme.sh">acme.sh</a> å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>éœ€è¦å…ˆå®‰è£… crontab</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… crontab</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install cronie -y</span><br><span class="line"><span class="comment"># å¯åŠ¨ crond</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now crond</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ crond çŠ¶æ€</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl status crond</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ crontab æ˜¯å¦æ­£å¸¸</span></span><br><span class="line">crontab -l</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£… <a href="http://acme.sh">acme.sh</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨å®‰è£…åˆ° ~/.acme.sh/ ç›®å½•ä¸‹ï¼Œè¯ä¹¦ä¹Ÿä¼šç”Ÿæˆåœ¨è¯¥ç›®å½•ä¸‹</span></span><br><span class="line">curl https://get.acme.sh | sh -s email=qunfeng_han@aliyun.com</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;alias acme.sh=~/.acme.sh/acme.sh&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ crontab ä¸­æ·»åŠ äº†å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©æ£€æŸ¥ä¸€æ¬¡è¯ä¹¦æ˜¯å¦åˆ°è¾¾ä¸‹æ¬¡æ›´æ–°æ—¥æœŸï¼Œå¦‚æœåˆ°æœŸåˆ™è‡ªåŠ¨æ›´æ–°</span></span><br><span class="line"><span class="comment"># è¯ä¹¦æœ‰æ•ˆæœŸé»˜è®¤ä¸º 90 å¤©ï¼Œè¿˜å‰© 30 å¤©æ—¶ä¼šè§¦å‘è‡ªåŠ¨æ›´æ–°</span></span><br><span class="line">crontab -l</span><br><span class="line"><span class="comment"># è¾“å‡ºç±»ä¼¼äº ä»¥ä¸‹å†…å®¹</span></span><br><span class="line">48 1 * * * <span class="string">&quot;/root/.acme.sh&quot;</span>/acme.sh --cron --home <span class="string">&quot;/root/.acme.sh&quot;</span> &gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line">acme.sh -h</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line">acme.sh -v</span><br></pre></td></tr></table></figure><h2 id="å‡çº§-acme-sh">å‡çº§ <a href="http://acme.sh">acme.sh</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡çº§ acme.sh åˆ°æœ€æ–°ç‰ˆ</span></span><br><span class="line">acme.sh --upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯è‡ªåŠ¨å‡çº§</span></span><br><span class="line">acme.sh --upgrade --auto-upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥éšæ—¶å…³é—­è‡ªåŠ¨æ›´æ–°</span></span><br><span class="line">acme.sh --upgrade --auto-upgrade  0</span><br></pre></td></tr></table></figure><h2 id="å¸è½½-acme-sh">å¸è½½ <a href="http://acme.sh">acme.sh</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --uninstall</span><br><span class="line"><span class="built_in">rm</span> -rf ~/.acme.sh</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆè¯ä¹¦">ç”Ÿæˆè¯ä¹¦</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="http://acme.sh">acme.sh</a> å®ç°äº† acme åè®®æ”¯æŒçš„æ‰€æœ‰éªŒè¯åè®®ã€‚</p></li><li class="lvl-2"><p>è¯ä¹¦åˆ›å»ºåä¼šä¿å­˜åœ¨ ~/.acme.sh/ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æˆ‘çš„åŸŸåæ˜¯ <code>acme.hanqunfeng.com</code>ï¼Œåˆ™è¯ä¹¦ä¿å­˜åœ¨ <code>~/.acme.sh/acme.hanqunfeng.com_ecc/</code>ç›®å½•ä¸‹</p></li><li class="lvl-2"><p>åˆ›å»ºè¯ä¹¦æ—¶ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼éªŒè¯: HTTP å’Œ DNS éªŒè¯ã€‚</p></li></ul><h3 id="HTTP-éªŒè¯">HTTP éªŒè¯</h3><ul class="lvl-0"><li class="lvl-2"><p>åªæ”¯æŒå•ä¸ªå­åŸŸåçš„è¯ä¹¦ç”Ÿæˆï¼Œä¸æ”¯æŒé€šé…ç¬¦åŸŸå</p></li><li class="lvl-2"><p>éœ€è¦æå‰å°†åŸŸåè§£æåˆ°æœ¬æœºçš„IPåœ°å€</p></li></ul><h4 id="ç›´æ¥ç­¾å‘">ç›´æ¥ç­¾å‘</h4><ul class="lvl-0"><li class="lvl-2"><p>åªéœ€è¦æŒ‡å®šåŸŸåï¼Œå¹¶æŒ‡å®šåŸŸåæ‰€åœ¨çš„ç½‘ç«™æ ¹ç›®å½•. <a href="http://acme.sh">acme.sh</a> ä¼šå…¨è‡ªåŠ¨çš„ç”ŸæˆéªŒè¯æ–‡ä»¶ï¼Œå¹¶æ”¾åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ï¼ŒéªŒè¯å®Œæˆåä¼šèªæ˜çš„åˆ é™¤éªŒè¯æ–‡ä»¶ï¼Œæ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -d æŒ‡å®šåŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œ--webroot æŒ‡å®šç½‘ç«™æ ¹ç›®å½•</span></span><br><span class="line">acme.sh --issue -d acme.hanqunfeng.com -d www.hanqunfeng.com --webroot /home/wwwroot/mydomain.com/</span><br><span class="line"></span><br><span class="line"><span class="comment"># --server æŒ‡å®š acme.sh ä½¿ç”¨çš„ CA æœåŠ¡å•†ä¸º Let&#x27;s Encryptï¼Œé»˜è®¤ä½¿ç”¨ ZeroSSL</span></span><br><span class="line">acme.sh --issue -d acme.hanqunfeng.com -d www.hanqunfeng.com --webroot /home/wwwroot/mydomain.com/ --server letsencrypt</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨-Nginx-Apache-æ¨¡å¼">ä½¿ç”¨ Nginx/Apache æ¨¡å¼</h4><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä½ ç”¨çš„ Nginx/Apache æœåŠ¡å™¨ï¼Œæˆ–è€…åä»£ï¼Œ<a href="http://acme.sh">acme.sh</a> è¿˜å¯ä»¥æ™ºèƒ½çš„ä» Nginx/Apache çš„é…ç½®ä¸­è‡ªåŠ¨å®ŒæˆéªŒè¯ï¼Œä½ ä¸éœ€è¦æŒ‡å®šç½‘ç«™æ ¹ç›®å½•</p></li><li class="lvl-2"><p>nginx æˆ– httpd å‘½ä»¤è¦åœ¨ç³»ç»ŸPathä¸­</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -d åŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ª, --nginx å‘Šè¯‰ acme.sh ä½¿ç”¨ Nginx æ¨¡å¼</span></span><br><span class="line">acme.sh --issue --nginx -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br><span class="line"><span class="comment"># -d åŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ª, --apache å‘Šè¯‰ acme.sh ä½¿ç”¨ Apache æ¨¡å¼</span></span><br><span class="line">acme.sh --issue --apache -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨ç‹¬ç«‹æœåŠ¡æ¨¡å¼">ä½¿ç”¨ç‹¬ç«‹æœåŠ¡æ¨¡å¼</h4><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰è¿è¡Œä»»ä½• Web æœåŠ¡ï¼Œ80 ç«¯å£æ˜¯ç©ºé—²çš„ï¼Œé‚£ä¹ˆ <a href="http://acme.sh">acme.sh</a> è¿˜èƒ½å‡è£…è‡ªå·±æ˜¯ä¸€ä¸ª WebServerï¼Œä¸´æ—¶ç›‘å¬ 80 ç«¯å£ï¼Œå®ŒæˆéªŒè¯</p></li><li class="lvl-2"><p>éœ€è¦å…ˆå®‰è£… socat å‘½ä»¤ï¼Œsocat å¸¸ç”¨äºä¸´æ—¶å¼€å¯ TCP/UDP ç›‘å¬ç«¯å£</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install socat -y</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç”Ÿæˆè¯ä¹¦ï¼Œè¦æ±‚80ç«¯å£ç©ºé—²ï¼Œå¦åˆ™ä¼šå¤±è´¥</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --standalone ç‹¬ç«‹æœåŠ¡æ¨¡å¼</span></span><br><span class="line">acme.sh --issue --standalone -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br></pre></td></tr></table></figure><h3 id="DNS-éªŒè¯">DNS éªŒè¯</h3><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä½ æ²¡æœ‰æœåŠ¡å™¨ï¼Œæ²¡æœ‰å…¬ç½‘ IPï¼Œåªéœ€è¦ DNS çš„è§£æè®°å½•å³å¯å®ŒæˆéªŒè¯ã€‚</p></li><li class="lvl-2"><p>æ”¯æŒé€šé…ç¬¦åŸŸå</p></li></ul><h4 id="æ‰‹åŠ¨éªŒè¯">æ‰‹åŠ¨éªŒè¯</h4><ul class="lvl-0"><li class="lvl-2"><p>è¿™éœ€è¦ä½ æ‰‹åŠ¨åœ¨åŸŸåä¸Šæ·»åŠ ä¸€æ¡ TXT è§£æè®°å½•ï¼ŒéªŒè¯åŸŸåæ‰€æœ‰æƒã€‚</p></li><li class="lvl-2"><p>æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨æ‰‹åŠ¨éªŒè¯ï¼Œ<a href="http://acme.sh">acme.sh</a> å°†æ— æ³•è‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨æ·»åŠ è§£ææ¥éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚å¦‚æœæœ‰è‡ªåŠ¨æ›´æ–°è¯ä¹¦çš„éœ€æ±‚ï¼Œè¯·ä½¿ç”¨è‡ªåŠ¨éªŒè¯ï¼ˆDNS APIï¼‰ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éœ€è¦åŠ ä¸Š --yes-I-know-dns-manual-mode-enough-go-ahead-please é€‰é¡¹</span></span><br><span class="line">acme.sh --issue --dns -d acme.hanqunfeng.com -d www.hanqunfeng.com --yes-I-know-dns-manual-mode-enough-go-ahead-please</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç„¶åï¼Œ<a href="http://acme.sh">acme.sh</a> ä¼šç”Ÿæˆç›¸åº”çš„è§£æè®°å½•æ˜¾ç¤ºå‡ºæ¥ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„åŸŸåç®¡ç†é¢æ¿ä¸­æ·»åŠ è¿™æ¡ TXT è®°å½•å³å¯ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Add the following txt record:</span><br><span class="line">Domain:_acme-challenge.acme.hanqunfeng.com</span><br><span class="line">Txt value:mUWNg9kuQ9hwOkqYFQ_DFMQ4Eu0CEaxxxxxxxxxxx</span><br><span class="line"></span><br><span class="line">Add the following txt record:</span><br><span class="line">Domain:_acme-challenge.www.hanqunfeng.com</span><br><span class="line">Txt value:vLwDR48eHcmcScOwHrDjaFZo-yw_f9xxxxxxxxxxx</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç­‰å¾…è§£æå®Œæˆä¹‹åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œç°åœ¨ç”¨çš„æ˜¯ --renew å‚æ•°</span></span><br><span class="line">acme.sh --renew -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br></pre></td></tr></table></figure><h4 id="è‡ªåŠ¨éªŒè¯ï¼ˆDNS-APIï¼‰">è‡ªåŠ¨éªŒè¯ï¼ˆDNS APIï¼‰</h4><ul class="lvl-0"><li class="lvl-2"><p>DNS æ–¹å¼çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„åœ¨äºå¯ä»¥ä½¿ç”¨åŸŸåè§£æå•†æä¾›çš„ API è‡ªåŠ¨æ·»åŠ  TXT è®°å½•ï¼Œä¸”åœ¨å®ŒæˆéªŒè¯ååˆ é™¤å¯¹åº”çš„è®°å½•ã€‚</p></li><li class="lvl-2"><p><a href="http://acme.sh">acme.sh</a> ç›®å‰æ”¯æŒ<a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi">è¶…è¿‡ä¸€ç™¾å®¶çš„ DNS API</a>ã€‚</p></li><li class="lvl-2"><p>ä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼Œç™»å½•é˜¿é‡Œäº‘å¸å·ï¼Œè·å– AccessKey å’Œ SecretKeyï¼Œå¹¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªéœ€è¦å‘½ä»¤è¡Œæ‰§è¡Œä¸€æ¬¡ï¼Œè¿è¡Œç”Ÿæˆè¯ä¹¦å‘½ä»¤æ—¶ä¼šä¿å­˜åœ¨ ~/.acme.sh/account.conf ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶è‡ªåŠ¨è·å–ï¼Œæ— éœ€æ‰‹åŠ¨å†è®¾ç½®</span></span><br><span class="line"><span class="built_in">export</span> Ali_Key=<span class="string">&quot;&lt;key&gt;&quot;</span></span><br><span class="line"><span class="built_in">export</span> Ali_Secret=<span class="string">&quot;&lt;secret&gt;&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç”Ÿæˆè¯ä¹¦</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --dns dns_ali æŒ‡å®šé˜¿é‡Œäº‘çš„DNS API</span></span><br><span class="line">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆè¯ä¹¦çš„å…¶å®ƒè¯´æ˜">ç”Ÿæˆè¯ä¹¦çš„å…¶å®ƒè¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="http://acme.sh">acme.sh</a> è„šæœ¬é»˜è®¤ CA æœåŠ¡å•†æ˜¯ ZeroSSLï¼Œ<a href="https://github.com/acmesh-official/acme.sh/wiki/Server">acme.sh æ”¯æŒçš„CA æœåŠ¡å•†åŠå…¶ä½¿ç”¨æ–¹æ³•</a>ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ --server æŒ‡å®š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œä½¿ç”¨ Let&#x27;s Encrypt çš„ CA æœåŠ¡å•†</span></span><br><span class="line">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¹Ÿå¯ä»¥è®¾ç½®å…¨å±€é»˜è®¤çš„ CA æœåŠ¡å•†ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡éƒ½æŒ‡å®š --server</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --set-default-ca --server letsencrypt</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2"><a href="http://acme.sh">acme.sh</a> å®˜ç½‘è¯´ é»˜è®¤çš„ CA æœåŠ¡å•† ZeroSSL ä¸æ˜¯å¾ˆç¨³å®šï¼Œæœ‰æ—¶å¯èƒ½ä¼šå¯¼è‡´è·å–è¯ä¹¦çš„æ—¶å€™ä¸€ç›´å‡ºç°ï¼š<code>Pendingï¼ŒThe CA is processing your orderï¼Œplease just wait.</code>ï¼Œ æ­¤æ—¶åªéœ€è¦æŠŠ CA æœåŠ¡å™¨æ”¹æˆ Letâ€™s Encrypt å³å¯ï¼Œè™½ç„¶æ›´æ”¹ä»¥åè¿˜æ˜¯æœ‰æ¦‚ç‡å‡ºç° pendingï¼Œä½†åŸºæœ¬ 2-3 æ¬¡å³å¯æˆåŠŸã€‚</li><li class="lvl-2">ä½†æ˜¯ Letâ€™s Encrypt è·å–çš„è¯ä¹¦ï¼Œä¸æ”¯æŒæ¯”è¾ƒæ—§çš„è®¾å¤‡ï¼Œæ¯”å¦‚ Android 5.0 ä»¥ä¸‹çš„è®¾å¤‡ï¼Œå¦‚æœæœ‰è¿™æ–¹é¢çš„éœ€è¦è¿˜æ˜¯æ¨èä½¿ç”¨ ZeroSSLã€‚</li><li class="lvl-2">å¸¸è§æ ¹è¯ä¹¦è¡¨</li></ul><table><thead><tr><th>æ ¹è¯ä¹¦ï¼ˆCNï¼‰</th><th>Android 5.0</th><th>å¸¸è§ç­¾å‘æ–¹</th></tr></thead><tbody><tr><td><strong>ISRG Root X1</strong></td><td>âŒ ä¸å…¼å®¹</td><td>Letâ€™s Encrypt</td></tr><tr><td><strong>DST Root CA X3</strong></td><td>âœ… å…¼å®¹ï¼ˆ2021å¹´è¿‡æœŸï¼‰</td><td>Letâ€™s Encrypt è€ç‰ˆæœ¬</td></tr><tr><td><strong>GlobalSign Root R1</strong></td><td>âœ… å…¼å®¹</td><td>GlobalSign</td></tr><tr><td><strong>USERTrust RSA Certification Authority</strong></td><td>âœ… å…¼å®¹</td><td>ZeroSSL, Sectigo</td></tr><tr><td><strong>Starfield Root CA - G2</strong></td><td>âŒ ä¸å…¼å®¹</td><td>GoDaddy æ–°ç‰ˆ</td></tr><tr><td><strong>Starfield Root CA - G1</strong></td><td>âœ… å…¼å®¹</td><td>GoDaddy è€ç‰ˆ</td></tr><tr><td><strong>GTS Root R1/R3</strong></td><td>âŒ ä¸å…¼å®¹</td><td>Google Trust Services</td></tr><tr><td><strong>Amazon Root CA 1</strong></td><td>âŒ ä¸å…¼å®¹</td><td>Amazon Trust</td></tr></tbody></table><ul class="lvl-1"><li class="lvl-2"><p>å¯ä»¥ç”¨åœ¨çº¿å·¥å…·ç›´æ¥æŸ¥çœ‹è¯ä¹¦é“¾ï¼š<a href="https://www.ssllabs.com/ssltest/">https://www.ssllabs.com/ssltest/</a> ï¼Œå®ƒä¼šæ˜¾ç¤ºå®Œæ•´è¯ä¹¦é“¾å’Œå„ç§è®¾å¤‡çš„å…¼å®¹æ€§</p></li></ul></div><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å·²ç»ç”Ÿæˆçš„è¯ä¹¦</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ acme.sh --list</span><br><span class="line">Main_Domain          KeyLength  SAN_Domains  CA           Created               Renew</span><br><span class="line">acme.hanqunfeng.com  <span class="string">&quot;ec-256&quot;</span>   no           ZeroSSL.com  2025-07-17T03:31:30Z  2025-09-14T03:31:30Z</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœç”Ÿæˆè¯ä¹¦æ—¶å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  --debug å‚æ•°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --debug</span><br><span class="line"><span class="comment"># --debug 2 è¾“å‡ºæ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯</span></span><br><span class="line">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --debug 2</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç›®å‰è¯ä¹¦æ¯ 60 å¤©è‡ªåŠ¨æ›´æ–°ï¼Œä½ æ— éœ€ä»»ä½•æ“ä½œã€‚ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥å¼ºåˆ¶ç»­ç­¾è¯ä¹¦ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œè¦å°† --issue æ”¹ä¸º --renewï¼Œ--issue åªæœ‰ç¬¬ä¸€æ¬¡ç”Ÿæˆæ­£å¼æ—¶æ‰ä¼šä½¿ç”¨ã€‚åŒæ—¶åŠ ä¸Š --forceï¼Œæœªåˆ°æ›´æ–°æ—¶é—´å¼ºåˆ¶é‡æ–°ç”Ÿæˆè¯ä¹¦ã€‚</span></span><br><span class="line">acme.sh --renew -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --force</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆè¯ä¹¦åè‡ªåŠ¨éƒ¨ç½²å’Œæ›´æ–°">ç”Ÿæˆè¯ä¹¦åè‡ªåŠ¨éƒ¨ç½²å’Œæ›´æ–°</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢æ— è®ºæ˜¯ http è¿˜æ˜¯ dns æ¨¡å¼ï¼Œç”Ÿæˆè¯ä¹¦åï¼Œéƒ½ä¼šåœ¨ ~/.acme.sh/acme.hanqunfeng.com_ecc/ ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ acme.hanqunfeng.com.cer</span><br><span class="line">â”œâ”€â”€ acme.hanqunfeng.com.conf</span><br><span class="line">â”œâ”€â”€ acme.hanqunfeng.com.csr</span><br><span class="line">â”œâ”€â”€ acme.hanqunfeng.com.csr.conf</span><br><span class="line">â”œâ”€â”€ acme.hanqunfeng.com.key</span><br><span class="line">â”œâ”€â”€ ca.cer</span><br><span class="line">â””â”€â”€ fullchain.cer</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°†è¯ä¹¦æ‹·è´åˆ°çœŸæ­£ä½¿ç”¨è¯ä¹¦çš„ç›®å½•ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨nginxæˆ–è€…apacheï¼Œå¯ä»¥è®© <a href="http://acme.sh">acme.sh</a> å¸®æˆ‘ä»¬è‡ªåŠ¨å°†è¯ä¹¦æ‹·è´åˆ°æ­£ç¡®çš„ç›®å½•ä¸‹ï¼Œå¹¶é‡å¯æœåŠ¡ä½¿è¯ä¹¦ç”Ÿæ•ˆï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè®¾ç½®å³å¯ï¼Œåªéœ€è¦è¿è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œåç»­ä¼šé€šè¿‡ crontab è¿›è¡Œè‡ªåŠ¨æ›´æ–°è¯ä¹¦å¹¶å®Œæˆéƒ¨ç½²ã€‚</p></li><li class="lvl-2"><p>Nginx</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert \</span><br><span class="line">-d acme.hanqunfeng.com \                               <span class="comment"># ç”Ÿæˆè¯ä¹¦æ—¶æŒ‡å®šçš„åŸŸå</span></span><br><span class="line">--key-file /path/to/keyfile/in/nginx/key.pem \    <span class="comment"># nginx ä¸­é…ç½®çš„ key æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">--fullchain-file /path/to/fullchain/nginx/cert.pem \  <span class="comment"># nginx ä¸­é…ç½®çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">--reloadcmd <span class="string">&quot;systemctl reload nginx&quot;</span>                   <span class="comment"># nginx é‡è½½å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ nginx -s reload</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ–‡ä»¶å¯¹åº”å…³ç³»</p></li></ul><table><thead><tr><th><a href="http://acme.sh">acme.sh</a> æ–‡ä»¶</th><th>å«ä¹‰</th><th>ä½ é…ç½®çš„ç›®æ ‡æ–‡ä»¶</th></tr></thead><tbody><tr><td><code>acme.hanqunfeng.com.key</code></td><td><strong>ç§é’¥ (Private Key)</strong></td><td><code>/path/to/keyfile/in/nginx/key.pem</code></td></tr><tr><td><code>fullchain.cer</code></td><td><strong>è¯ä¹¦ + ä¸­é—´è¯ä¹¦é“¾ (Fullchain)</strong></td><td><code>/path/to/fullchain/nginx/cert.pem</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Apache</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert \</span><br><span class="line">-d acme.hanqunfeng.com \</span><br><span class="line">--cert-file      /path/to/certfile/in/apache/cert.pem  \ <span class="comment"># apache è¯ä¹¦æ–‡ä»¶</span></span><br><span class="line">--key-file       /path/to/keyfile/in/apache/key.pem  \   <span class="comment"># apache å¯†é’¥æ–‡ä»¶</span></span><br><span class="line">--fullchain-file /path/to/fullchain/certfile/apache/fullchain.pem \ <span class="comment"># apache å…¨é“¾æ–‡ä»¶</span></span><br><span class="line">--reloadcmd     <span class="string">&quot;systemctl reload httpd&quot;</span>  <span class="comment"># apache é‡è½½å‘½ä»¤</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ–‡ä»¶å¯¹åº”å…³ç³»</p></li></ul><table><thead><tr><th><a href="http://acme.sh">acme.sh</a> æ–‡ä»¶</th><th>å«ä¹‰</th><th>ä½ é…ç½®çš„ç›®æ ‡æ–‡ä»¶</th></tr></thead><tbody><tr><td><code>acme.hanqunfeng.com.key</code></td><td><strong>ç§é’¥ (Private Key)</strong></td><td><code>/path/to/keyfile/in/apache/key.pem</code></td></tr><tr><td><code>acme.hanqunfeng.com.cer</code></td><td><strong>ä»…åŸŸåè¯ä¹¦ (Certificate)</strong></td><td><code>/path/to/certfile/in/apache/cert.pem</code></td></tr><tr><td><code>fullchain.cer</code></td><td><strong>è¯ä¹¦ + ä¸­é—´è¯ä¹¦é“¾ (Fullchain)</strong></td><td><code>/path/to/fullchain/certfile/apache/fullchain.pem</code></td></tr></tbody></table><h2 id="åœæ­¢è‡ªåŠ¨æ›´æ–°å¹¶åˆ é™¤è¯ä¹¦">åœæ­¢è‡ªåŠ¨æ›´æ–°å¹¶åˆ é™¤è¯ä¹¦</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢è‡ªåŠ¨æ›´æ–°</span></span><br><span class="line">acme.sh --remove -d acme.hanqunfeng.com --ecc</span><br><span class="line"><span class="comment"># åˆ é™¤è¯ä¹¦</span></span><br><span class="line"><span class="built_in">rm</span> -rf ~/.acme.sh/acme.hanqunfeng.com_ecc</span><br></pre></td></tr></table></figure><h2 id="å…¶å®ƒsslè‡ªåŠ¨ç»­ç­¾å·¥å…·">å…¶å®ƒsslè‡ªåŠ¨ç»­ç­¾å·¥å…·</h2><table><thead><tr><th>å·¥å…·</th><th>æ¨èåœºæ™¯</th><th>å®˜ç½‘åœ°å€</th><th>ä¾èµ–</th></tr></thead><tbody><tr><td>Certbot</td><td>ä¼ ç»ŸæœåŠ¡å™¨ã€Nginx/Apache</td><td><a href="https://certbot.eff.org/">https://certbot.eff.org/</a></td><td>Python</td></tr><tr><td>Lego</td><td>é™æ€äºŒè¿›åˆ¶ã€K8s</td><td><a href="https://github.com/go-acme/lego">https://github.com/go-acme/lego</a></td><td>æ— ä¾èµ–</td></tr><tr><td>cert-manager</td><td>K8s é›†ç¾¤</td><td><a href="https://cert-manager.io/">https://cert-manager.io/</a></td><td>K8s CRD</td></tr><tr><td>Caddy</td><td>ç®€å•ç«™ç‚¹è‡ªåŠ¨HTTPS</td><td><a href="https://caddyserver.com/">https://caddyserver.com/</a></td><td>æ— éœ€å•ç‹¬å·¥å…·</td></tr><tr><td>Traefik</td><td>å¾®æœåŠ¡ç½‘å…³</td><td><a href="https://traefik.io/">https://traefik.io/</a></td><td>Docker/K8s</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»è‡ªåŠ¨ç”³è¯·å¹¶ç»­ç­¾ SSL è¯ä¹¦çš„å·¥å…·: &lt;a href=&quot;http://acme.sh&quot;&gt;acme.sh&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/acmesh-official/acme.sh&quot;&gt;acme.sh Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="acme" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/acme/"/>
    
    <category term="ssl" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/acme/ssl/"/>
    
    <category term="certificate" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/acme/ssl/certificate/"/>
    
    
    <category term="ssl" scheme="https://blog.hanqunfeng.com/tags/ssl/"/>
    
    <category term="acme" scheme="https://blog.hanqunfeng.com/tags/acme/"/>
    
  </entry>
  
  <entry>
    <title>K8S é•œåƒæ‹‰å– ä¹‹ toomanyrequests çš„è§£å†³æ–¹æ³•</title>
    <link href="https://blog.hanqunfeng.com/2025/07/16/k8s-toomanyrequests/"/>
    <id>https://blog.hanqunfeng.com/2025/07/16/k8s-toomanyrequests/</id>
    <published>2025-07-16T15:30:05.000Z</published>
    <updated>2025-07-18T03:02:52.603Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S é•œåƒæ‹‰å– çš„ <code>toomanyrequests</code> çš„è§£å†³æ–¹æ³• ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li></ul><span id="more"></span><h2 id="toomanyrequests-ä»‹ç»">toomanyrequests ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>å½“æˆ‘ä»¬é€šè¿‡k8såˆ›å»ºpodæ—¶éœ€è¦ä» dockerhub ä¸Šæ‹‰å–é•œåƒï¼Œä½†æ˜¯ dockerhub çš„apiè¯·æ±‚æ˜¯æœ‰é™åˆ¶çš„ï¼Œæœªè®¤è¯ç”¨æˆ·é™åˆ¶ä¸º100/6hï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶å°±ä¼šè¿”å›<code>429 Too Many Requestså“åº”</code>ã€‚<a href="https://docs.docker.com/docker-hub/usage/">Docker Hubçš„ä½¿ç”¨å’Œé™åˆ¶</a></p></li><li class="lvl-2"><p>æˆ‘ä»¬å¯ä»¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œè¿™æ ·å¯ä»¥å°†é™åˆ¶æé«˜åˆ°2000/6hã€‚å¦‚æœè¿˜éœ€è¦è¿›ä¸€æ­¥æé«˜è¯·æ±‚é™åˆ¶ï¼Œå¯ä»¥ç”³è¯·dockerhubçš„pro planã€‚</p></li></ul><h2 id="dockerhub-è®¤è¯">dockerhub è®¤è¯</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º Docker Registry Secret</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®š namespaceï¼Œ é»˜è®¤å‘½åç©ºé—´æ˜¯ default</span></span><br><span class="line">kubectl create secret docker-registry \</span><br><span class="line">  dockerhub-secret \                            <span class="comment"># åˆ›å»º secret åç§°</span></span><br><span class="line">  --namespace=ä½ çš„å‘½åç©ºé—´ \                      <span class="comment"># åˆ›å»º secret æ‰€åœ¨çš„å‘½åç©ºé—´</span></span><br><span class="line">  --docker-server=https://index.docker.io/v1/ \ <span class="comment"># æŒ‡å®š docker registry åœ°å€ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå…¶å®ƒä»“åº“æˆ–ç§æœè¯·æ›´æ”¹ä¸ºå¯¹åº”çš„url</span></span><br><span class="line">  --docker-username=ä½ çš„ç”¨æˆ·å \                  <span class="comment"># ä»“åº“ çš„ç”¨æˆ·å</span></span><br><span class="line">  --docker-password=ä½ çš„å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ \           <span class="comment"># ä»“åº“ çš„å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ</span></span><br><span class="line">  --docker-email=ä½ çš„é‚®ç®±                        <span class="comment"># ä»“åº“ çš„é‚®ç®±</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ secret</span></span><br><span class="line">kubectl get secret dockerhub-secret -o yaml -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥åœ¨åˆ›å»º pod æˆ– deployment æ—¶æŒ‡å®šå‡­è¯</p></li></ul><blockquote><p>pod</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">username/repository:tag</span></span><br><span class="line">  <span class="attr">imagePullSecrets:</span>                         <span class="comment"># æ·»åŠ å‡­è¯</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dockerhub-secret</span></span><br></pre></td></tr></table></figure><blockquote><p>deployment</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">username/repository:tag</span></span><br><span class="line">      <span class="attr">imagePullSecrets:</span>                       <span class="comment"># æ·»åŠ å‡­è¯</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dockerhub-secret</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°† Secret æ·»åŠ åˆ° ServiceAccountï¼Œè¿™æ · Pod åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å°† Secret æŒ‚è½½åˆ° Pod ä¸­</p></li></ul><blockquote><p>æ¯ä¸ª namespace ä¸‹ éƒ½æœ‰ä¸€ä¸ª åç§°ä¸º default çš„ ServiceAccount</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ pod çš„ ServiceAccount</span></span><br><span class="line">$ k describe pod pi-n65gn | grep <span class="string">&quot;Service Account&quot;</span></span><br><span class="line">Service Account:  default</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®š namespace ä¸‹çš„ Pod ä½¿ç”¨è¿™ä¸ªå‡­è¯</span></span><br><span class="line">kubectl patch serviceaccount default -p <span class="string">&#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;]&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å¤šä¸ªå‡­è¯ï¼Œè¿™ä¼šè¦†ç›–ä¹‹å‰çš„è®¾ç½®ï¼Œå¤šä¸ª secret æŒ‰é¡ºåºç”Ÿæ•ˆï¼Œk8s ä¼šé€ä¸ªå°è¯•å»æ‹‰å–é•œåƒ</span></span><br><span class="line">kubectl patch serviceaccount default -p <span class="string">&#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;, &#123;&quot;name&quot;: &quot;harbor-secret&quot;&#125;, &#123;&quot;name&quot;: &quot;aliyun-secret&quot;&#125;]&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿½åŠ ä¸€ä¸ªå‡­è¯ï¼Œä¸ä¼šè¦†ç›–åŸæœ‰çš„è®¾ç½®</span></span><br><span class="line">kubectl patch serviceaccount default --<span class="built_in">type</span>=<span class="string">&#x27;json&#x27;</span> -p=<span class="string">&#x27;[&#123;&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/imagePullSecrets/-&quot;, &quot;value&quot;: &#123;&quot;name&quot;: &quot;new-secret&quot;&#125;&#125;]&#x27;</span> -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ imagePullSecrets çš„ç´¢å¼•ï¼Œä»¥ä¸‹å‘½ä»¤ä¼šè¾“å‡ºå‡­è¯çš„åç§°ï¼Œç´¢å¼•ä» 0 å¼€å§‹</span></span><br><span class="line">kubectl get sa default -o jsonpath=<span class="string">&#x27;&#123;.imagePullSecrets[*].name&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ä¸€ä¸ªå‡­è¯: åˆ é™¤ index ä¸º 1 çš„å‡­è¯</span></span><br><span class="line">kubectl patch serviceaccount default --<span class="built_in">type</span>=json -p=<span class="string">&#x27;[&#123;&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/imagePullSecrets/1&quot;&#125;]&#x27;</span> -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç©ºæ‰€æœ‰å‡­è¯</span></span><br><span class="line">kubectl patch sa default -p <span class="string">&#x27;&#123;&quot;imagePullSecrets&quot;: []&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºæ‰€æœ‰ namespace ä¸‹çš„ Pod æ·»åŠ å‡­è¯</span></span><br><span class="line"><span class="keyword">for</span> ns <span class="keyword">in</span> $(kubectl get ns -o jsonpath=<span class="string">&#x27;&#123;.items[*].metadata.name&#125;&#x27;</span>); <span class="keyword">do</span></span><br><span class="line">  kubectl patch serviceaccount default -n <span class="variable">$ns</span> \</span><br><span class="line">    --<span class="built_in">type</span>=merge \</span><br><span class="line">    -p <span class="string">&#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;]&#125;&#x27;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ ServiceAccount</span></span><br><span class="line">$ kubectl get serviceaccount default -o yaml -n &lt;namespace&gt;</span><br><span class="line">apiVersion: v1</span><br><span class="line">imagePullSecrets:</span><br><span class="line">- name: dockerhub-secret</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">&quot;2025-06-29T14:41:35Z&quot;</span></span><br><span class="line">  name: default</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: <span class="string">&quot;361001&quot;</span></span><br><span class="line">  uid: cb3a0f99-5804-4f21-816a-70533cc3d29d</span><br></pre></td></tr></table></figure><h2 id="æé«˜ä¸‹è½½é¢‘ç‡çš„å…¶ä»–å»ºè®®">æé«˜ä¸‹è½½é¢‘ç‡çš„å…¶ä»–å»ºè®®</h2><ul class="lvl-0"><li class="lvl-2"><p>1.ä½¿ç”¨é•œåƒç¼“å­˜:</p><ul class="lvl-2"><li class="lvl-4">è®¾ç½®é›†ç¾¤å†…é•œåƒç¼“å­˜ï¼ˆå¦‚ Harbor, Nexus Registryï¼‰</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹é›†ç¾¤çš„é•œåƒä»“åº“é…ç½®ï¼ˆvimï¼‰</span></span><br><span class="line">kubectl edit configmap -n kube-system</span><br><span class="line"><span class="comment"># æ‰¾åˆ° imageRepository: æ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€</span></span><br></pre></td></tr></table></figure><ul class="lvl-2"><li class="lvl-4">ä½¿ç”¨ Docker Hub é•œåƒåŠ é€Ÿå™¨ï¼ˆå¦‚æœåœ¨ä¸­å›½å¤§é™†ï¼‰<ul class="lvl-4"><li class="lvl-6">å¦‚æœ k8s ä½¿ç”¨çš„æ˜¯ dockerï¼Œåˆ™åœ¨<code>/etc/docker/daemon.json</code>æ·»åŠ é•œåƒåŠ é€Ÿå™¨é…ç½®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;https://docker.1ms.run&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.xuanyuan.me&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.m.daocloud.io&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure><ul class="lvl-4"><li class="lvl-6">å¦‚æœ k8s ä½¿ç”¨çš„æ˜¯ containerdï¼Œåˆ™åœ¨<code>/etc/containerd/config.toml</code>æ·»åŠ é•œåƒåŠ é€Ÿå™¨é…ç½®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vi /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾åˆ° registry.mirrors å­—æ®µï¼Œæ·»åŠ åŠ é€Ÿå™¨ï¼Œæ¯”å¦‚ï¼š</span></span><br><span class="line">[plugins.<span class="string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors]</span><br><span class="line">  [plugins.<span class="string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="string">&quot;docker.io&quot;</span>]</span><br><span class="line">    endpoint = [<span class="string">&quot;https://docker.1ms.run&quot;</span>, <span class="string">&quot;https://docker.xuanyuan.me&quot;</span>, <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹åé‡å¯ containerd</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart containerd</span><br></pre></td></tr></table></figure></li></ul></li><li class="lvl-2"><p>2.å‡çº§ Docker Hub è®¢é˜…:</p><ul class="lvl-2"><li class="lvl-4">å…è´¹è´¦æˆ·ï¼š200 pulls/6å°æ—¶ï¼ˆåŒ¿åç”¨æˆ·100 pulls/6å°æ—¶ï¼‰</li><li class="lvl-4">Pro/Team è´¦æˆ·ï¼šæ— é™åˆ¶æ‹‰å–</li></ul></li><li class="lvl-2"><p>3.ä½¿ç”¨å¤šä¸ªè´¦æˆ·:</p><ul class="lvl-2"><li class="lvl-4">ä¸ºä¸åŒèŠ‚ç‚¹é…ç½®ä¸åŒçš„ Docker Hub å‡­è¯</li></ul></li><li class="lvl-2"><p>4.å‡å°‘ä¸å¿…è¦çš„æ‹‰å–:</p><ul class="lvl-2"><li class="lvl-4">ä½¿ç”¨ imagePullPolicy: IfNotPresent</li><li class="lvl-4">å°½é‡ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ ‡ç­¾è€Œé latest</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S é•œåƒæ‹‰å– çš„ &lt;code&gt;toomanyrequests&lt;/code&gt; çš„è§£å†³æ–¹æ³• ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ Job/CronJob</title>
    <link href="https://blog.hanqunfeng.com/2025/07/16/k8s-job-cornjob/"/>
    <id>https://blog.hanqunfeng.com/2025/07/16/k8s-job-cornjob/</id>
    <published>2025-07-16T14:30:05.000Z</published>
    <updated>2025-07-20T13:50:48.012Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ Job/CronJob ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/job/">k8s Job ä»‹ç»</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/cron-jobs/">k8s CronJob ä»‹ç»</a></p></li></ul><span id="more"></span><h2 id="Job-ä»‹ç»">Job ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>Job è¡¨ç¤ºä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œè¿è¡Œå®Œæˆåå°±ä¼šåœæ­¢ã€‚</p></li><li class="lvl-2"><p>Job ä¼šåˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ª Podï¼Œå¹¶å°†ç»§ç»­é‡è¯• Pod çš„æ‰§è¡Œï¼Œç›´åˆ°æŒ‡å®šæ•°é‡çš„ Pod æˆåŠŸç»ˆæ­¢ã€‚</p></li><li class="lvl-2"><p>éšç€ Pod æˆåŠŸç»“æŸï¼ŒJob è·Ÿè¸ªè®°å½•æˆåŠŸå®Œæˆçš„ Pod ä¸ªæ•°ã€‚ å½“æ•°é‡è¾¾åˆ°æŒ‡å®šçš„æˆåŠŸä¸ªæ•°é˜ˆå€¼æ—¶ï¼Œä»»åŠ¡ï¼ˆå³ Jobï¼‰ç»“æŸã€‚</p></li><li class="lvl-2"><p>åˆ é™¤ Job çš„æ“ä½œä¼šæ¸…é™¤æ‰€åˆ›å»ºçš„å…¨éƒ¨ Podã€‚ æŒ‚èµ· Job çš„æ“ä½œä¼šåˆ é™¤ Job çš„æ‰€æœ‰æ´»è·ƒ Podï¼Œç›´åˆ° Job è¢«å†æ¬¡æ¢å¤æ‰§è¡Œã€‚</p></li></ul><h3 id="Job-åˆ›å»º">Job åˆ›å»º</h3><ul class="lvl-0"><li class="lvl-2"><p>yaml æ–‡ä»¶: job.yaml</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span>                      <span class="comment"># API ç‰ˆæœ¬ï¼Œè¿™é‡Œä½¿ç”¨ batch/v1ï¼Œé€‚ç”¨äº Job èµ„æº</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span>                                 <span class="comment"># èµ„æºç±»å‹ï¼ŒJob ç”¨äºä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œå®Œæˆåè‡ªåŠ¨é€€å‡º</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pi</span>                                <span class="comment"># Job çš„åç§°ï¼Œè¿™é‡Œå‘½åä¸º pi</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ttlSecondsAfterFinished:</span> <span class="number">100</span>            <span class="comment"># Job å®Œæˆåï¼Œè‡ªåŠ¨åˆ é™¤jobçš„å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤ä¸åˆ é™¤</span></span><br><span class="line">  <span class="attr">parallelism:</span> <span class="number">1</span>                          <span class="comment"># Job çš„å¹¶å‘æ•°ï¼Œé»˜è®¤ä¸º1ï¼Œå³ä¸€æ¬¡åªèƒ½å¯åŠ¨ä¸€ä¸ª Pod</span></span><br><span class="line">  <span class="attr">template:</span>                               <span class="comment"># Pod æ¨¡æ¿ï¼Œå®šä¹‰ Job åˆ›å»ºçš„ Pod çš„è§„èŒƒ</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span>                         <span class="comment"># Pod å†…çš„å®¹å™¨åˆ—è¡¨</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pi</span>                          <span class="comment"># å®¹å™¨åç§°ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„åå­—</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">perl:5.34.0</span>                <span class="comment"># ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯ Perl 5.34.0 å®˜æ–¹é•œåƒ</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;perl&quot;</span>,  <span class="string">&quot;-Mbignum=bpi&quot;</span>, <span class="string">&quot;-wle&quot;</span>, <span class="string">&quot;print bpi(2000)&quot;</span>]  <span class="comment"># å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œè®¡ç®—å¹¶è¾“å‡ºåœ†å‘¨ç‡çš„ 2000 ä½å°æ•°</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Never</span>                <span class="comment"># é‡å¯ç­–ç•¥ï¼Œè®¾ç½®ä¸º Neverï¼Œè¡¨ç¤º Pod å¤±è´¥æ—¶ä¸ä¼šè‡ªåŠ¨é‡å¯</span></span><br><span class="line">  <span class="attr">backoffLimit:</span> <span class="number">4</span>                         <span class="comment"># Job é‡è¯•æ¬¡æ•°ä¸Šé™ï¼Œè‹¥å¤±è´¥è¶…è¿‡ 4 æ¬¡ï¼Œåˆ™ä¸å†é‡è¯•ï¼ŒJob çŠ¶æ€å°†æ ‡è®°ä¸º Failedã€‚é»˜è®¤ä¸º 6</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨Job</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f job.yaml</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ Job</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ Job</span></span><br><span class="line">kubectl get <span class="built_in">jobs</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¥å¿—ï¼Œæ­¤æ—¶ä¼šçœ‹åˆ°è¾“å‡º åœ†å‘¨ç‡å€¼</span></span><br><span class="line">kubectl logs <span class="built_in">jobs</span>/pi</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤ Job</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete <span class="built_in">jobs</span>/pi</span><br><span class="line"></span><br><span class="line"><span class="comment"># yaml åˆ é™¤</span></span><br><span class="line">kubectl delete -f job.yaml</span><br></pre></td></tr></table></figure><h2 id="CronJob-ä»‹ç»">CronJob ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>CronJob(ç¼©å†™ä¸º cj) é€šè¿‡é‡å¤è°ƒåº¦å¯åŠ¨ä¸€æ¬¡æ€§çš„ Jobã€‚</p></li><li class="lvl-2"><p>CronJob ç”¨äºæ‰§è¡Œæ’æœŸæ“ä½œï¼Œä¾‹å¦‚å¤‡ä»½ã€ç”ŸæˆæŠ¥å‘Šç­‰ã€‚</p></li><li class="lvl-2"><p>ä¸€ä¸ª CronJob å¯¹è±¡å°±åƒ Unix ç³»ç»Ÿä¸Šçš„ crontabï¼ˆcron tableï¼‰æ–‡ä»¶ä¸­çš„ä¸€è¡Œã€‚ å®ƒç”¨ Cron æ ¼å¼è¿›è¡Œç¼–å†™ï¼Œ å¹¶å‘¨æœŸæ€§åœ°åœ¨ç»™å®šçš„è°ƒåº¦æ—¶é—´æ‰§è¡Œ Jobã€‚</p></li></ul><h3 id="CronJob-ç¤ºä¾‹ï¼š">CronJob ç¤ºä¾‹ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: batch/v1</span><br><span class="line">kind: CronJob                               <span class="comment"># åˆ›å»ºCronJob</span></span><br><span class="line">metadata:</span><br><span class="line">  name: hello</span><br><span class="line">spec:</span><br><span class="line">  schedule: <span class="string">&quot;* * * * *&quot;</span>                     <span class="comment"># æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œä¸æ”¯æŒæ—¶åŒºè®¾ç½®</span></span><br><span class="line">  successfulJobsHistoryLimit: 3             <span class="comment"># æŒ‡å®šè¦ä¿ç•™å¤šå°‘æˆåŠŸå®Œæˆçš„ Jobã€‚é»˜è®¤å€¼ä¸º 3</span></span><br><span class="line">  failedJobsHistoryLimit: 1                 <span class="comment"># æŒ‡å®šè¦ä¿ç•™å¤šå°‘å¤±è´¥å®Œæˆçš„ Jobã€‚é»˜è®¤å€¼ä¸º 1</span></span><br><span class="line">  concurrencyPolicy: Allow                  <span class="comment"># é»˜è®¤å€¼ä¸º Allowï¼šå…è®¸å¤šä¸ª Job åŒæ—¶è¿è¡Œ</span></span><br><span class="line">                                            <span class="comment"># Forbidï¼šä¸å…è®¸å¤šä¸ª Job åŒæ—¶è¿è¡Œã€‚å¦‚æœæ–° Job çš„æ‰§è¡Œæ—¶é—´åˆ°äº†è€Œè€ Job æ²¡æœ‰æ‰§è¡Œå®Œï¼ŒCronJob ä¼šå¿½ç•¥æ–° Job çš„æ‰§è¡Œã€‚ å¦è¯·æ³¨æ„ï¼Œå½“è€ Job æ‰§è¡Œå®Œæˆæ—¶ï¼Œä»ç„¶ä¼šè€ƒè™‘ .spec.startingDeadlineSecondsï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–°çš„ Job æ‰§è¡Œã€‚</span></span><br><span class="line">                                            <span class="comment"># Replaceï¼šå¦‚æœæ–° Job çš„æ‰§è¡Œæ—¶é—´åˆ°äº†è€Œè€ Job æ²¡æœ‰æ‰§è¡Œå®Œï¼ŒCronJob ä¼šç”¨æ–° Job æ›¿æ¢å½“å‰æ­£åœ¨è¿è¡Œçš„ Jobã€‚</span></span><br><span class="line">  jobTemplate:</span><br><span class="line">    spec:</span><br><span class="line">      template:</span><br><span class="line">        spec:</span><br><span class="line">          containers:</span><br><span class="line">          - name: hello</span><br><span class="line">            image: busybox:1.28</span><br><span class="line">            imagePullPolicy: IfNotPresent</span><br><span class="line">            <span class="built_in">command</span>:</span><br><span class="line">            - /bin/sh</span><br><span class="line">            - -c</span><br><span class="line">            - <span class="built_in">date</span>; <span class="built_in">echo</span> Hello from the Kubernetes cluster</span><br><span class="line">          restartPolicy: OnFailure</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>.spec.schedule</code> å­—æ®µæ˜¯å¿…éœ€çš„ã€‚è¯¥å­—æ®µçš„å€¼éµå¾ª Cron è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0 - 59)</span></span><br><span class="line"><span class="comment"># â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0 - 23)</span></span><br><span class="line"><span class="comment"># â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆçš„æŸå¤© (1 - 31)</span></span><br><span class="line"><span class="comment"># â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆä»½ (1 - 12)</span></span><br><span class="line"><span class="comment"># â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å‘¨çš„æŸå¤© (0 - 6)ï¼ˆå‘¨æ—¥åˆ°å‘¨å…­ï¼‰</span></span><br><span class="line"><span class="comment"># â”‚ â”‚ â”‚ â”‚ â”‚                          æˆ–è€…æ˜¯ sunï¼Œmonï¼Œtueï¼Œwebï¼Œthuï¼Œfriï¼Œsat</span></span><br><span class="line"><span class="comment"># â”‚ â”‚ â”‚ â”‚ â”‚</span></span><br><span class="line"><span class="comment"># â”‚ â”‚ â”‚ â”‚ â”‚</span></span><br><span class="line"><span class="comment"># * * * * *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¶é—´è¡¨ä¸­çš„é—®å· (?) å’Œæ˜Ÿå· * å«ä¹‰ç›¸åŒï¼Œå®ƒä»¬ç”¨æ¥è¡¨ç¤ºç»™å®šå­—æ®µçš„ä»»ä½•å¯ç”¨å€¼ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é™¤äº†æ ‡å‡†è¯­æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›ç±»ä¼¼ @monthly çš„å®</p></li></ul><table><thead><tr><th><strong>è¾“å…¥</strong></th><th><strong>æè¿°</strong></th><th><strong>ç­‰ä»· Cron è¡¨è¾¾å¼</strong></th></tr></thead><tbody><tr><td><code>@yearly</code> æˆ– <code>@annually</code></td><td>æ¯å¹´ 1 æœˆ 1 æ—¥çš„åˆå¤œè¿è¡Œä¸€æ¬¡</td><td><code>0 0 1 1 *</code></td></tr><tr><td><code>@monthly</code></td><td>æ¯æœˆç¬¬ä¸€å¤©çš„åˆå¤œè¿è¡Œä¸€æ¬¡</td><td><code>0 0 1 * *</code></td></tr><tr><td><code>@weekly</code></td><td>æ¯å‘¨çš„å‘¨æ—¥åˆå¤œè¿è¡Œä¸€æ¬¡</td><td><code>0 0 * * 0</code></td></tr><tr><td><code>@daily</code> æˆ– <code>@midnight</code></td><td>æ¯å¤©åˆå¤œè¿è¡Œä¸€æ¬¡</td><td><code>0 0 * * *</code></td></tr><tr><td><code>@hourly</code></td><td>æ¯å°æ—¶çš„å¼€å§‹è¿è¡Œä¸€æ¬¡</td><td><code>0 * * * *</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç®¡ç†cronjob</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºcronjob</span></span><br><span class="line">kubectl create -f cronjob.yaml</span><br><span class="line"><span class="comment"># æŸ¥çœ‹cronjob</span></span><br><span class="line">kubectl get cronjob hello -o yaml</span><br><span class="line"><span class="comment"># åˆ é™¤cronjob</span></span><br><span class="line">kubectl delete cronjob hello</span><br><span class="line">k delete -f cronjob.yaml</span><br></pre></td></tr></table></figure><h2 id="ä»¥ä¸‹æ˜¯-Kubernetes-ä¸­-Job-å’Œ-CronJob-çš„å¯¹æ¯”è¡¨">ä»¥ä¸‹æ˜¯ Kubernetes ä¸­ Job å’Œ CronJob çš„å¯¹æ¯”è¡¨</h2><table><thead><tr><th>ç‰¹æ€§</th><th>Job</th><th>CronJob</th></tr></thead><tbody><tr><td><strong>ç”¨é€”</strong></td><td>ä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œå®Œæˆå³ç»“æŸ</td><td>å®šæ—¶å‘¨æœŸæ€§ä»»åŠ¡ï¼ŒæŒ‰ç…§æ—¶é—´è®¡åˆ’å®šæ—¶è¿è¡Œ</td></tr><tr><td><strong>è°ƒåº¦æ–¹å¼</strong></td><td>æ‰‹åŠ¨åˆ›å»ºæˆ–ç”±æ§åˆ¶å™¨è§¦å‘</td><td>æŒ‰ç…§ Cron è¡¨è¾¾å¼è‡ªåŠ¨å‘¨æœŸæ€§è°ƒåº¦</td></tr><tr><td><strong>å¸¸ç”¨åœºæ™¯</strong></td><td>æ•°æ®æ‰¹å¤„ç†ã€æ•°æ®åº“è¿ç§»ã€ä¸€æ¬¡æ€§ä»»åŠ¡</td><td>æ¯å¤©å¤‡ä»½ã€å®šæ—¶æŠ¥å‘Šç”Ÿæˆã€å‘¨æœŸæ€§æ£€æŸ¥</td></tr><tr><td><strong>é…ç½®å…³é”®å­—æ®µ</strong></td><td><code>spec.template</code></td><td><code>spec.schedule</code>ï¼ˆCron è¡¨è¾¾å¼ï¼‰ + <code>spec.jobTemplate</code></td></tr><tr><td><strong>å¯åŠ¨é¢‘ç‡</strong></td><td>åˆ›å»ºåç«‹åˆ»å¯åŠ¨ä¸€æ¬¡</td><td>æ ¹æ® <code>schedule</code> å®šæœŸå¯åŠ¨</td></tr><tr><td><strong>å¹¶å‘æ§åˆ¶</strong></td><td>ä¸æ”¯æŒå¹¶å‘ç­–ç•¥</td><td>æ”¯æŒ <code>concurrencyPolicy</code>ï¼ˆAllowã€Forbidã€Replaceï¼‰</td></tr><tr><td><strong>ä¿ç•™å†å²ä»»åŠ¡</strong></td><td>æ— ä¿ç•™ï¼Œä»»åŠ¡å®Œæˆåç›´æ¥ç»ˆç»“</td><td>å¯é…ç½®ä¿ç•™æˆåŠŸæˆ–å¤±è´¥ä»»åŠ¡æ•°ï¼š<code>successfulJobsHistoryLimit</code>ã€<code>failedJobsHistoryLimit</code></td></tr><tr><td><strong>å¤±è´¥é‡è¯•æœºåˆ¶</strong></td><td>æ”¯æŒ <code>backoffLimit</code>ã€<code>restartPolicy</code></td><td>åŒæ ·æ”¯æŒï¼Œä½œç”¨äºæ¯æ¬¡å‘¨æœŸæ€§è¿è¡Œäº§ç”Ÿçš„ Job ä¸Š</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ Job/CronJob ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/job/&quot;&gt;k8s Job ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/cron-jobs/&quot;&gt;k8s CronJob ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
</feed>
