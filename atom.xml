<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£˜é€¸å³°çš„åšå®¢</title>
  
  <subtitle>Spring--Javaç¨‹åºå‘˜çš„æ˜¥å¤©</subtitle>
  <link href="https://blog.hanqunfeng.com/atom.xml" rel="self"/>
  
  <link href="https://blog.hanqunfeng.com/"/>
  <updated>2026-01-09T10:21:18.096Z</updated>
  <id>https://blog.hanqunfeng.com/</id>
  
  <author>
    <name>é£˜é€¸å³°</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Redisson å®æˆ˜</title>
    <link href="https://blog.hanqunfeng.com/2026/01/09/redis-Redisson-02-datatype/"/>
    <id>https://blog.hanqunfeng.com/2026/01/09/redis-Redisson-02-datatype/</id>
    <published>2026-01-09T14:30:05.000Z</published>
    <updated>2026-01-09T10:21:18.096Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redisson çš„ä½¿ç”¨æ–¹æ³•</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2"><a href="https://redisson.pro/docs/getting-started/">Redisson å®˜æ–¹æ–‡æ¡£</a></li><li class="lvl-2">æœ¬æ–‡ä»¥Springbooté¡¹ç›®ä¸ºä¾‹ï¼Œä»‹ç»Redissonçš„ä½¿ç”¨æ–¹æ³•</li><li class="lvl-2">ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo">GitHub</a></li></ul><span id="more"></span><h2 id="ä¸Springbooté›†æˆ">ä¸Springbooté›†æˆ</h2><h3 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–</h3><ul class="lvl-0"><li class="lvl-2">Redissonæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯<code>Community Edition</code>ï¼Œä¸€ä¸ªæ˜¯<code>Redisson PRO</code>ï¼Œå‰è€…ç¤¾åŒºç‰ˆï¼Œåè€…ä»˜è´¹ç‰ˆï¼Œä¸¤ä¸ªç‰ˆæœ¬çš„åŒºåˆ«å‚è§<a href="https://redisson.pro/feature-comparison.html">Redisson PRO vs. Community Edition</a></li><li class="lvl-2">Springboot é›†æˆçš„æ˜¯ Redisson Community Edition</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.redisson&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;redisson-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.52.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><blockquote><p>PS: ç›®å‰<code>redisson-spring-boot-starte</code>æœ€æ–°ç‰ˆæ˜¯<code>4.1.0</code>ï¼Œå…¶å¯¹åº”çš„æ˜¯ Springboot 4.x ç‰ˆæœ¬ï¼Œæœ¬æ–‡åŸºäº<code>springboot-3.5.8</code>ï¼Œæ‰€ä»¥è¿™é‡Œç”¨çš„æ˜¯<code>3.52.0</code>è¿™ä¸ªç‰ˆæœ¬ã€‚</p></blockquote><h3 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®æ–‡ä»¶<code>application.properties</code> ç¤ºä¾‹</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis config</span></span><br><span class="line"><span class="attr">spring.data.redis.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.data.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="attr">spring.data.redis.username</span>=<span class="string">admin</span></span><br><span class="line"><span class="attr">spring.data.redis.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">spring.data.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="attr">spring.data.redis.timeout</span>=<span class="string">3s</span></span><br><span class="line"><span class="comment"># è¿æ¥æ± é…ç½®</span></span><br><span class="line"><span class="comment"># å¯ç”¨è¿æ¥æ± </span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.pool.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.pool.max-active</span>=<span class="string">8</span></span><br><span class="line"><span class="comment"># è·å–è¿æ¥æœ€å¤§ç­‰å¾…æ—¶é—´</span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.pool.max-wait</span>=<span class="string">2s</span></span><br><span class="line"><span class="comment"># æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.pool.max-idle</span>=<span class="string">8</span></span><br><span class="line"><span class="comment"># æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># å…³é—­è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="attr">spring.data.redis.lettuce.shutdown-timeout</span>=<span class="string">5s</span></span><br></pre></td></tr></table></figure><h3 id="è·å–RedissonClient">è·å–RedissonClient</h3><ul class="lvl-0"><li class="lvl-2"><p>Redisson æä¾›äº†3ä¸ª Clientï¼Œæœ¬è´¨ä¸Šæ˜¯åŒä¸€å¥—åº•å±‚è¿æ¥ä¸å‘½ä»¤èƒ½åŠ›çš„ä¸åŒç¼–ç¨‹æ¨¡å‹å°è£…ï¼Œä¸»è¦åŒºåˆ«åœ¨äºï¼š</p></li></ul><blockquote><p>è°ƒç”¨æ–¹å¼ï¼ˆåŒæ­¥ / å¼‚æ­¥ / Reactive / RxJavaï¼‰ã€çº¿ç¨‹æ¨¡å‹ã€èƒŒå‹èƒ½åŠ›ã€é€‚ç”¨åœºæ™¯ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sync and Async API</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">RedissonClient redisson;</span><br><span class="line"><span class="comment">// Reactive API</span></span><br><span class="line"><span class="type">RedissonReactiveClient</span> <span class="variable">redissonReactive</span> <span class="operator">=</span> redisson.reactive();</span><br><span class="line"><span class="comment">// RxJava3 API</span></span><br><span class="line"><span class="type">RedissonRxClient</span> <span class="variable">redissonRx</span> <span class="operator">=</span> redisson.rxJava();</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸‰ä¸ª Client çš„å®šä½æ¦‚è§ˆ</p></li></ul><table><thead><tr><th>Client</th><th>ç±»å‹</th><th>ç¼–ç¨‹æ¨¡å‹</th><th>è¿”å›å€¼</th><th>æ˜¯å¦é˜»å¡</th><th>èƒŒå‹æ”¯æŒ</th><th>å…¸å‹ç”¨é€”</th></tr></thead><tbody><tr><td><code>RedissonClient</code></td><td>åŒæ­¥ / å¼‚æ­¥</td><td>Imperative</td><td>T / RFuture<T></td><td>åŒæ­¥ä¼šé˜»å¡</td><td>âŒ</td><td>ä¼ ç»ŸæœåŠ¡ã€ç®€å•ä¸šåŠ¡</td></tr><tr><td><code>RedissonReactiveClient</code></td><td>Reactive Streams</td><td>Reactor / Flow</td><td>Mono / Flux</td><td>âŒ</td><td>âœ…</td><td>WebFluxã€é«˜å¹¶å‘</td></tr><tr><td><code>RedissonRxClient</code></td><td>RxJava3</td><td>RxJava3</td><td>Observable / Single / Flowable</td><td>âŒ</td><td>âœ…</td><td>RxJava é¡¹ç›®</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ğŸ“Š Redisson Client é€‰å‹å¯¹ç…§è¡¨</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>æŠ€æœ¯æ¶æ„ç‰¹å¾</th><th>æ¨è Client</th><th>ç¼–ç¨‹æ¨¡å‹</th><th>æ ¸å¿ƒç†ç”±</th><th>å…¸å‹åº”ç”¨</th></tr></thead><tbody><tr><td>æ™®é€š Spring Bootï¼ˆMVCï¼‰</td><td>åŒæ­¥è¯·æ±‚æ¨¡å‹<br>çº¿ç¨‹æ± å¯æ§<br>é˜»å¡ IO å¯æ¥å—</td><td><strong>RedissonClientï¼ˆåŒæ­¥ / Asyncï¼‰</strong></td><td>Imperative + Future</td><td>- ç¼–ç ç®€å•ï¼Œç»´æŠ¤æˆæœ¬ä½<br>- ä¸ JDBC / äº‹åŠ¡æ¨¡å‹ä¸€è‡´<br>- æ˜“äºçº¿ç¨‹ä¸è¿æ¥æ± æ²»ç†<br>- è°ƒè¯•ä¸æ’éšœæˆæœ¬ä½</td><td>ä¸šåŠ¡ç³»ç»Ÿã€ç®¡ç†åå°ã€å†…éƒ¨æœåŠ¡</td></tr><tr><td>é«˜å¹¶å‘ IO æœåŠ¡ï¼ˆWebFlux / ç½‘å…³ï¼‰</td><td>éé˜»å¡æ¶æ„<br>äº‹ä»¶é©±åŠ¨<br>é«˜å¹¶å‘è¿æ¥æ•°</td><td><strong>RedissonReactiveClient</strong></td><td>Reactive Streamsï¼ˆMono / Fluxï¼‰</td><td>- å…¨é“¾è·¯éé˜»å¡<br>- æ”¯æŒèƒŒå‹æ§åˆ¶<br>- ä¸ Reactor ç”Ÿæ€å¤©ç„¶å…¼å®¹<br>- æœ€å¤§åŒ–ååä¸èµ„æºåˆ©ç”¨ç‡</td><td>API ç½‘å…³ã€å®æ—¶æœåŠ¡ã€æ¨é€ç³»ç»Ÿ</td></tr><tr><td>å·²æœ‰ RxJava æŠ€æœ¯æ ˆ</td><td>å·²å¹¿æ³›ä½¿ç”¨ RxJava3<br>æˆç†Ÿæµå¼ç®¡é“</td><td><strong>RedissonRxClient</strong></td><td>RxJavaï¼ˆSingle / Flowableï¼‰</td><td>- æ— éœ€å¼•å…¥ Reactor ç”Ÿæ€<br>- ä¸ç°æœ‰æµå¼æ¨¡å‹æ— ç¼é›†æˆ<br>- æ”¯æŒèƒŒå‹ï¼ˆFlowableï¼‰<br>- æ”¹é€ æˆæœ¬æœ€ä½</td><td>Android åç«¯ã€å†å²ç³»ç»Ÿ</td></tr></tbody></table><h2 id="ğŸ“Š-Redis-æ•°æ®ç±»å‹-â†”-Redisson-å¯¹è±¡æ˜ å°„è¡¨">ğŸ“Š Redis æ•°æ®ç±»å‹ â†” Redisson å¯¹è±¡æ˜ å°„è¡¨</h2><h3 id="1ï¸âƒ£-String">1ï¸âƒ£ String</h3><table><thead><tr><th>Redis</th><th>Redisson å¯¹è±¡</th><th>Java è¯­ä¹‰</th><th>å¸¸ç”¨ API</th><th>åº•å±‚æ˜ å°„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>String</td><td><code>RBucket&lt;T&gt;</code></td><td>å•å€¼å¯¹è±¡</td><td>get / set / delete</td><td>GET / SET</td><td>æœ€å¸¸ç”¨</td></tr><tr><td>String</td><td><code>RAtomicLong</code></td><td>åŸå­è®¡æ•°å™¨</td><td>incrementAndGet</td><td>INCRBY</td><td>å¼ºè¯­ä¹‰</td></tr><tr><td>String</td><td><code>RAtomicDouble</code></td><td>åŸå­æµ®ç‚¹</td><td>addAndGet</td><td>è‡ªå®ç°</td><td>Lua</td></tr><tr><td>String</td><td><code>RLongAdder</code></td><td>é«˜å¹¶å‘è®¡æ•°</td><td>increment</td><td>Hash + Lua</td><td>åˆ†ç‰‡</td></tr><tr><td>String</td><td><code>RBitSet</code></td><td>ä½é›†åˆ</td><td>set / get</td><td>SETBIT / GETBIT</td><td>ä½å›¾</td></tr><tr><td>String</td><td><code>RBinaryStream</code></td><td>äºŒè¿›åˆ¶æµ</td><td>read / write</td><td>GETRANGE</td><td>å¤§å¯¹è±¡</td></tr></tbody></table><h3 id="2ï¸âƒ£-Hash">2ï¸âƒ£ Hash</h3><table><thead><tr><th>Redis</th><th>Redisson å¯¹è±¡</th><th>Java è¯­ä¹‰</th><th>å¸¸ç”¨ API</th><th>åº•å±‚æ˜ å°„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Hash</td><td><code>RMap&lt;K,V&gt;</code></td><td>Map</td><td>get / put / remove</td><td>HGET / HSET</td><td>æ ¸å¿ƒ</td></tr><tr><td>Hash</td><td><code>RMapCache&lt;K,V&gt;</code></td><td>å¸¦ TTL Map</td><td>put(key,val,ttl)</td><td>Hash + ZSet</td><td>è¿‡æœŸæ§åˆ¶</td></tr></tbody></table><h3 id="3ï¸âƒ£-List">3ï¸âƒ£ List</h3><table><thead><tr><th>Redis</th><th>Redisson å¯¹è±¡</th><th>Java è¯­ä¹‰</th><th>å¸¸ç”¨ API</th><th>åº•å±‚æ˜ å°„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>List</td><td><code>RList&lt;V&gt;</code></td><td>List</td><td>add / get / remove</td><td>LPUSH / LRANGE</td><td>é¡ºåº</td></tr><tr><td>List</td><td><code>RQueue&lt;V&gt;</code></td><td>Queue</td><td>offer / poll</td><td>RPUSH / LPOP</td><td>é˜Ÿåˆ—</td></tr><tr><td>List</td><td><code>RDeque&lt;V&gt;</code></td><td>Deque</td><td>addFirst / addLast</td><td>LPUSH / RPUSH</td><td>åŒç«¯</td></tr><tr><td>List</td><td><code>RBlockingQueue&lt;V&gt;</code></td><td>BlockingQueue</td><td>take</td><td>BLPOP</td><td>é˜»å¡æ¶ˆè´¹</td></tr></tbody></table><h3 id="4ï¸âƒ£-Set">4ï¸âƒ£ Set</h3><table><thead><tr><th>Redis</th><th>Redisson å¯¹è±¡</th><th>Java è¯­ä¹‰</th><th>å¸¸ç”¨ API</th><th>åº•å±‚æ˜ å°„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Set</td><td><code>RSet&lt;V&gt;</code></td><td>Set</td><td>add / contains</td><td>SADD / SISMEMBER</td><td>æ— åº</td></tr><tr><td>Set</td><td><code>RSetCache&lt;V&gt;</code></td><td>TTL Set</td><td>add(ttl)</td><td>Set + ZSet</td><td>è‡ªåŠ¨è¿‡æœŸ</td></tr><tr><td>Set</td><td><code>RSortedSet&lt;V&gt;</code></td><td>SortedSet</td><td>add / first</td><td>ZSet</td><td>æœ‰åº</td></tr></tbody></table><h3 id="5ï¸âƒ£-ZSet">5ï¸âƒ£ ZSet</h3><table><thead><tr><th>Redis</th><th>Redisson å¯¹è±¡</th><th>Java è¯­ä¹‰</th><th>å¸¸ç”¨ API</th><th>åº•å±‚æ˜ å°„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ZSet</td><td><code>RScoredSortedSet&lt;V&gt;</code></td><td>å¸¦ score é›†åˆ</td><td>add(score)</td><td>ZADD</td><td>æ’è¡Œæ¦œ</td></tr><tr><td>ZSet</td><td><code>RLexSortedSet</code></td><td>å­—å…¸æ’åºé›†åˆ</td><td>add</td><td>ZRANGEBYLEX</td><td>å­—å…¸åº</td></tr><tr><td>ZSet</td><td><code>RPriorityQueue&lt;V&gt;</code></td><td>ä¼˜å…ˆé˜Ÿåˆ—</td><td>poll</td><td>ZSet</td><td>å †è¯­ä¹‰</td></tr><tr><td>ZSet</td><td><code>RPriorityDeque&lt;V&gt;</code></td><td>åŒç«¯ä¼˜å…ˆé˜Ÿåˆ—</td><td>pollFirst</td><td>ZSet</td><td>æ‰©å±•</td></tr></tbody></table><h3 id="6ï¸âƒ£-Bitmap">6ï¸âƒ£ Bitmap</h3><table><thead><tr><th>Redis</th><th>Redisson å¯¹è±¡</th><th>Java è¯­ä¹‰</th><th>å¸¸ç”¨ API</th><th>åº•å±‚æ˜ å°„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Bitmap</td><td><code>RBitSet</code></td><td>BitSet</td><td>set / get</td><td>SETBIT</td><td>ä½å›¾</td></tr><tr><td>Bitmap</td><td><code>RLongAdder</code></td><td>è®¡æ•°ä½</td><td>increment</td><td>Bitmap åˆ†ç‰‡</td><td>é«˜å¹¶å‘</td></tr></tbody></table><h3 id="7ï¸âƒ£-HyperLogLog">7ï¸âƒ£ HyperLogLog</h3><table><thead><tr><th>Redis</th><th>Redisson å¯¹è±¡</th><th>Java è¯­ä¹‰</th><th>å¸¸ç”¨ API</th><th>åº•å±‚æ˜ å°„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>HyperLogLog</td><td><code>RHyperLogLog&lt;V&gt;</code></td><td>å»é‡è®¡æ•°</td><td>add / count</td><td>PFADD / PFCOUNT</td><td>UVç»Ÿè®¡</td></tr></tbody></table><h3 id="8ï¸âƒ£-Geo">8ï¸âƒ£ Geo</h3><table><thead><tr><th>Redis</th><th>Redisson å¯¹è±¡</th><th>Java è¯­ä¹‰</th><th>å¸¸ç”¨ API</th><th>åº•å±‚æ˜ å°„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Geo</td><td><code>RGeo&lt;V&gt;</code></td><td>åœ°ç†ç´¢å¼•</td><td>add / radius</td><td>GEOADD</td><td>LBS</td></tr></tbody></table><h3 id="9ï¸âƒ£-Stream">9ï¸âƒ£ Stream</h3><table><thead><tr><th>Redis</th><th>Redisson å¯¹è±¡</th><th>Java è¯­ä¹‰</th><th>å¸¸ç”¨ API</th><th>åº•å±‚æ˜ å°„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Stream</td><td><code>RStream&lt;K,V&gt;</code></td><td>æ¶ˆæ¯æµ</td><td>add / read</td><td>XADD / XREAD</td><td>æ¶ˆæ¯é˜Ÿåˆ—</td></tr><tr><td>Stream</td><td><code>RStreamReactive</code></td><td>Reactive Stream</td><td>subscribe</td><td>XREADGROUP</td><td>æµå¼</td></tr></tbody></table><h3 id="ğŸ”Ÿ-Pub-Sub">ğŸ”Ÿ Pub/Sub</h3><table><thead><tr><th>Redis</th><th>Redisson å¯¹è±¡</th><th>Java è¯­ä¹‰</th><th>å¸¸ç”¨ API</th><th>åº•å±‚æ˜ å°„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>PubSub</td><td><code>RTopic</code></td><td>Topic</td><td>publish / addListener</td><td>PUBLISH</td><td>å¹¿æ’­</td></tr><tr><td>PubSub</td><td><code>RPatternTopic</code></td><td>Pattern</td><td>subscribe</td><td>PSUBSCRIBE</td><td>æ¨¡å¼è®¢é˜…</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redisson çš„ä½¿ç”¨æ–¹æ³•&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;&lt;a href=&quot;https://redisson.pro/docs/getting-started/&quot;&gt;Redisson å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»¥Springbooté¡¹ç›®ä¸ºä¾‹ï¼Œä»‹ç»Redissonçš„ä½¿ç”¨æ–¹æ³•&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo&quot;&gt;GitHub&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redisson ç®€ä»‹</title>
    <link href="https://blog.hanqunfeng.com/2026/01/09/redis-Redisson-01-base/"/>
    <id>https://blog.hanqunfeng.com/2026/01/09/redis-Redisson-01-base/</id>
    <published>2026-01-09T13:30:05.000Z</published>
    <updated>2026-01-09T06:08:21.079Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redisson</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2"><a href="https://redisson.pro/docs/getting-started/">Redisson å®˜æ–¹æ–‡æ¡£</a></li></ul><span id="more"></span><h2 id="Redisson-çš„å®˜æ–¹å®šä½">Redisson çš„å®˜æ–¹å®šä½</h2><ul class="lvl-0"><li class="lvl-2"><p>âœ… é¢å‘ Valkey / Redis çš„ Java å®¢æˆ·ç«¯</p></li><li class="lvl-2"><p>âœ… åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª å®æ—¶æ•°æ®å¹³å°ï¼ˆReal-Time Data Platformï¼‰</p></li><li class="lvl-2"><p>âœ… æä¾› é«˜çº§æŠ½è±¡ + åˆ†å¸ƒå¼èƒ½åŠ›æ‰©å±•</p></li></ul><blockquote><p>å¯ä»¥ç†è§£ä¸ºï¼šRedisson = Redis Java Client + åˆ†å¸ƒå¼å¯¹è±¡å¹³å° + é«˜çº§å¹¶å‘è¯­ä¹‰</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å®ƒå¹¶ä¸æ˜¯ç®€å•æ›¿ä»£ Jedis / Lettuceï¼Œè€Œæ˜¯ï¼š</p><ul class="lvl-2"><li class="lvl-6">åœ¨ Redis ä¹‹ä¸Šæ„å»ºäº†ä¸€å±‚ é¢å‘å¯¹è±¡çš„åˆ†å¸ƒå¼æŠ½è±¡æ¨¡å‹</li><li class="lvl-6">æŠŠ Redis ä»â€œå‘½ä»¤å‹æ•°æ®åº“â€æå‡ä¸ºâ€œåˆ†å¸ƒå¼æ•°æ®ç»“æ„ä¸æœåŠ¡å¹³å°â€ã€‚</li></ul></li></ul><blockquote><p><a href="https://redisson.pro/blog/feature-comparison-redisson-vs-jedis.html">Redisson vs Jedis</a><br><a href="https://redisson.pro/blog/feature-comparison-redisson-vs-lettuce.html">Redisson vs Lettuce</a></p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>Redisson åœ¨ Java ä»£ç ä¸ Redis å‘½ä»¤ä¹‹é—´å¢åŠ äº†ä¸€å±‚æŠ½è±¡ï¼Œå…¶å¸¦æ¥çš„ä»·å€¼:</p></li></ul><table><thead><tr><th>ä»·å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å±è”½å‘½ä»¤ç»†èŠ‚</td><td>ä¸å†ç›´æ¥æ‹¼ Redis å‘½ä»¤</td></tr><tr><td>é¢å‘å¯¹è±¡å»ºæ¨¡</td><td>Map / Set / Lock / Queue</td></tr><tr><td>è¯­ä¹‰æ›´ç¨³å®š</td><td>ä¸ä¾èµ–å‘½ä»¤ç»†èŠ‚</td></tr><tr><td>é™ä½å­¦ä¹ æˆæœ¬</td><td>Java å¼€å‘è€…æ— éœ€æ·±åº¦ç†è§£ Redis åè®®</td></tr><tr><td>æå‡å¯ç»´æŠ¤æ€§</td><td>ä¸šåŠ¡ä»£ç æ›´æ¸…æ™°</td></tr></tbody></table><h2 id="Redisson-æ‰©å±•çš„èƒ½åŠ›">Redisson æ‰©å±•çš„èƒ½åŠ›</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ†å¸ƒå¼é›†åˆï¼ˆDistributed Collectionsï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç‰¹ç‚¹ï¼š</span><br><span class="line">    æ•°æ®å­˜å‚¨åœ¨ Redis</span><br><span class="line">    è¯­ä¹‰ä¸ Java é›†åˆä¸€è‡´</span><br><span class="line">    æ”¯æŒåˆ†å¸ƒå¼å¹¶å‘è®¿é—®</span><br></pre></td></tr></table></figure><table><thead><tr><th>Redisson å¯¹è±¡</th><th>ç±»æ¯” Java</th></tr></thead><tbody><tr><td>RMap</td><td>Map</td></tr><tr><td>RSet</td><td>Set</td></tr><tr><td>RList</td><td>List</td></tr><tr><td>RQueue</td><td>Queue</td></tr><tr><td>RDeque</td><td>Deque</td></tr><tr><td>RSortedSet</td><td>SortedSet</td></tr><tr><td>RBlockingQueue</td><td>BlockingQueue</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åˆ†å¸ƒå¼å¯¹è±¡ï¼ˆDistributed Objectsï¼‰</p></li></ul><table><thead><tr><th>å¯¹è±¡</th><th>è¯­ä¹‰</th></tr></thead><tbody><tr><td>RAtomicLong</td><td>åˆ†å¸ƒå¼åŸå­è®¡æ•°</td></tr><tr><td>RBucket</td><td>å•å€¼å¯¹è±¡ï¼Œå¦‚ï¼šRedissonBucketï¼ŒRedissonJsonBucket</td></tr><tr><td>RBitSet</td><td>ä½é›†åˆ</td></tr><tr><td>RBloomFilter</td><td>å¸ƒéš†è¿‡æ»¤å™¨</td></tr><tr><td>RHyperLogLog</td><td>åŸºæ•°ç»Ÿè®¡</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åˆ†å¸ƒå¼æœåŠ¡ï¼ˆDistributed Servicesï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¿™æ˜¯ Redisson çœŸæ­£çš„æ ¸å¿ƒç«äº‰åŠ›ã€‚</span><br><span class="line">è¿™äº›èƒ½åŠ›ï¼š</span><br><span class="line">    Redis åŸç”Ÿå¹¶ä¸ç›´æ¥æä¾›</span><br><span class="line">    Redisson é€šè¿‡ Lua + çŠ¶æ€æœº + Watchdog å®ç°</span><br></pre></td></tr></table></figure><table><thead><tr><th>æœåŠ¡</th><th>è§£å†³é—®é¢˜</th></tr></thead><tbody><tr><td>RLock</td><td>åˆ†å¸ƒå¼é”</td></tr><tr><td>RFairLock</td><td>å…¬å¹³é”</td></tr><tr><td>RReadWriteLock</td><td>è¯»å†™é”</td></tr><tr><td>RSemaphore</td><td>ä¿¡å·é‡</td></tr><tr><td>RCountDownLatch</td><td>é—­é”</td></tr><tr><td>RRateLimiter</td><td>é™æµ</td></tr><tr><td>RDelayedQueue</td><td>å»¶è¿Ÿé˜Ÿåˆ—</td></tr><tr><td>RExecutorService</td><td>åˆ†å¸ƒå¼çº¿ç¨‹æ± </td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤æ˜ å°„èƒ½åŠ›ï¼ˆCommand Mappingï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Redisson æä¾›ï¼š</span><br><span class="line">    Redis Command â†’ Redisson API æ˜ å°„è¡¨</span><br><span class="line"></span><br><span class="line">ç”¨é€”ï¼š</span><br><span class="line">    ä»å‘½ä»¤å¼æ€ç»´è¿‡æ¸¡åˆ°å¯¹è±¡å¼ API</span><br><span class="line">    å¿«é€Ÿå®šä½åŠŸèƒ½æ¥å£</span><br><span class="line">    éªŒè¯åº•å±‚å®ç°æœºåˆ¶</span><br></pre></td></tr></table></figure><table><thead><tr><th>Redis ç±»å‹</th><th>Redisson å¯¹è±¡</th></tr></thead><tbody><tr><td>String</td><td>RBucket, RAtomicLong, RBitSet</td></tr><tr><td>Hash</td><td>RMap, RMapCache</td></tr><tr><td>List</td><td>RList, RQueue, RBlockingQueue</td></tr><tr><td>Set</td><td>RSet, RSetCache</td></tr><tr><td>ZSet</td><td>RScoredSortedSet, RPriorityQueue</td></tr><tr><td>Bitmap</td><td>RBitSet</td></tr><tr><td>HyperLogLog</td><td>RHyperLogLog</td></tr><tr><td>Geo</td><td>RGeo</td></tr><tr><td>Stream</td><td>RStream</td></tr><tr><td>PubSub</td><td>RTopic</td></tr><tr><td>JSON</td><td>RJSONBucket</td></tr><tr><td>Vector<code>(Redis8+) </code></td><td>RVectorSet</td></tr></tbody></table><h2 id="RedisTemplate-VS-Redisson">RedisTemplate VS Redisson</h2><ul class="lvl-0"><li class="lvl-2"><p>ç»“è®ºå…ˆè¡Œï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ… å¦‚æœä½ åªæ˜¯æŠŠ Redis å½“ä½œ KV / Cache / ç®€å•æ•°æ®ç»“æ„å­˜å‚¨ â†’ ä¼˜å…ˆä½¿ç”¨ RedisTemplate</span><br><span class="line">âœ… å¦‚æœä½ éœ€è¦åˆ†å¸ƒå¼èƒ½åŠ›ï¼ˆé”ã€é™æµã€é˜Ÿåˆ—ã€åŒæ­¥å™¨ã€åŸå­å¯¹è±¡ï¼‰ â†’ ä¼˜å…ˆä½¿ç”¨ RedissonClient</span><br><span class="line">â—åœ¨å¤æ‚ç³»ç»Ÿä¸­ï¼Œä¸¤è€…å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œå„å¸å…¶èŒ</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ ¸å¿ƒå®šä½å·®å¼‚</p></li></ul><table><thead><tr><th>ç»´åº¦</th><th>RedisTemplate</th><th>RedissonClient</th></tr></thead><tbody><tr><td>æŠ½è±¡å±‚çº§</td><td>Redis åŸç”Ÿå‘½ä»¤å°è£…</td><td>åˆ†å¸ƒå¼å¯¹è±¡ä¸åŒæ­¥å™¨</td></tr><tr><td>ç¼–ç¨‹æ¨¡å‹</td><td>Command-oriented</td><td>Object-oriented</td></tr><tr><td>å…³æ³¨ç‚¹</td><td>æ•°æ®è®¿é—®</td><td>åˆ†å¸ƒå¼åè°ƒ</td></tr><tr><td>åŠŸèƒ½ç²’åº¦</td><td>String / Hash / List / ZSet</td><td>Map / Lock / Semaphore / Queue</td></tr><tr><td>ä¸€è‡´æ€§ä¿éšœ</td><td>éœ€è¦è‡ªå·±è®¾è®¡</td><td>å†…ç½®å®ç°</td></tr><tr><td>ä¸šåŠ¡è¯­ä¹‰</td><td>ååº•å±‚</td><td>åä¸šåŠ¡</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ€§èƒ½ä¸ç¨³å®šæ€§å¯¹æ¯”</p></li></ul><blockquote><p>åœ¨â€œçº¯ KV è®¿é—®â€åœºæ™¯ä¸‹ï¼ŒRedisTemplate çš„æ€§èƒ½é€šå¸¸ä¼˜äº Redissonã€‚</p></blockquote><table><thead><tr><th>ç»´åº¦</th><th>RedisTemplate</th><th>Redisson</th></tr></thead><tbody><tr><td>å»¶è¿Ÿ</td><td>æ›´ä½</td><td>ç•¥é«˜ï¼ˆå¯¹è±¡å°è£…ï¼‰</td></tr><tr><td>åå</td><td>æ›´é«˜</td><td>ç•¥ä½</td></tr><tr><td>å†…å­˜å¼€é”€</td><td>æœ€å°</td><td>è¾ƒé«˜</td></tr><tr><td>ç½‘ç»œè¯·æ±‚</td><td>ç²¾ç®€</td><td>å¯èƒ½å¤šæ¬¡äº¤äº’</td></tr><tr><td>ç¨³å®šæ€§</td><td>æé«˜</td><td>é«˜ï¼ˆä¾èµ–å†…éƒ¨çŠ¶æ€æœºï¼‰</td></tr><tr><td>æ’éšœå¤æ‚åº¦</td><td>ä½</td><td>ä¸­~é«˜</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>âœ… å®é™…ç”Ÿäº§ä¸­çš„æœ€ä½³å®è·µ: âœ”ï¸ ä¸¤è€…å…±å­˜ï¼Œè€Œä¸æ˜¯äºŒé€‰ä¸€ã€‚</p></li></ul><table><thead><tr><th>åŠŸèƒ½</th><th>æŠ€æœ¯</th></tr></thead><tbody><tr><td>ç¼“å­˜ / æŸ¥è¯¢</td><td>RedisTemplate</td></tr><tr><td>åˆ†å¸ƒå¼é”</td><td>Redisson</td></tr><tr><td>å»¶è¿Ÿé˜Ÿåˆ—</td><td>Redisson</td></tr><tr><td>åŸå­è®¡æ•°</td><td>RedisTemplate æˆ– Redisson Atomic</td></tr><tr><td>æœç´¢ / æ—¶åº</td><td>RedisTemplate</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redisson&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;&lt;a href=&quot;https://redisson.pro/docs/getting-started/&quot;&gt;Redisson å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- RoaringBitmap</title>
    <link href="https://blog.hanqunfeng.com/2026/01/08/redis7-datatype-19-RoaringBitmap/"/>
    <id>https://blog.hanqunfeng.com/2026/01/08/redis7-datatype-19-RoaringBitmap/</id>
    <published>2026-01-08T14:30:05.000Z</published>
    <updated>2026-01-08T09:36:30.364Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisRoaring ä¸­ RoaringBitmap æ•°æ®ç±»å‹</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2">RedisRoaring çš„å®‰è£…å‚è§ <a href="/2026/01/08/redis7-module-RedisRoaring/" title="Redis æ‰©å±•æ¨¡å— -- RedisRoaring çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisRoaring çš„å®‰è£…æ–¹æ³•</a></li></ul><span id="more"></span><h2 id="RoaringBitmap-å‘½ä»¤">RoaringBitmap å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥åœ¨ redis-cli ä¸­æ‰§è¡Œ <code>help @module</code>ï¼Œæ‰¾å‡ºæ‰€æœ‰ <code>R.*</code> å’Œ <code>R64.*</code> çš„å‘½ä»¤è¯´æ˜</p></li><li class="lvl-2"><p>R.*ï¼šæ“ä½œçš„æ˜¯ 32 ä½æ— ç¬¦å·æ•´æ•°ï¼ˆæœ€å¤§çº¦ 2^32-1ï¼‰</p></li><li class="lvl-2"><p>R64.*ï¼šæ“ä½œçš„æ˜¯ 64 ä½æ— ç¬¦å·æ•´æ•°ï¼ˆæœ€å¤§çº¦ 2^64-1ï¼‰ï¼Œé€‚åˆè¶…å¤§ ID ç©ºé—´ï¼Œå¦‚ Snowflake / æ—¶é—´æˆ³æ˜ å°„</p><blockquote><p>R64.* æ”¯æŒçš„æ•´æ•°ç†è®ºä¸Šæ˜¯ 0 ~ 2â¶â´-1ï¼ˆçº¦ 1.84e19ï¼‰ï¼Œä½†å·¥ç¨‹ä¸Šåº”è°¨æ…ä½¿ç”¨è¶…å¤§ offsetï¼Œé¿å…ç¨€ç–çˆ†ç‚¸å’Œæ€§èƒ½é€€åŒ–ã€‚</p></blockquote> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">high 32 bits  -&gt; container key å¤§æ¡¶</span><br><span class="line">low  32 bits  -&gt; container offset å°æ¡¶</span><br><span class="line"></span><br><span class="line">å½“ä½ å†™å…¥ä¸€ä¸ªéå¸¸å¤§çš„å€¼ï¼Œä¾‹å¦‚ 10^18</span><br><span class="line">   è™½ç„¶ Roaring åªä¸ºå­˜åœ¨æ•°æ®çš„ container åˆ†é…å†…å­˜ã€‚</span><br><span class="line">   ä½† container çš„ key æœ¬èº«æ˜¯ä¸€ä¸ª map / array ç´¢å¼•ç»“æ„ã€‚</span><br><span class="line">   æç«¯ç¨€ç–ã€è¶…å¤§ offset ä¼šå¢åŠ ç´¢å¼•ç®¡ç†æˆæœ¬ï¼Œä¼šå¯¼è‡´æŸäº›å‘½ä»¤æ“ä½œä¼šå˜å¾—å¾ˆæ…¢ã€‚</span><br><span class="line">   å¦å¤–ï¼Œä¸€ä¸ªå®¹å™¨è‡³å°‘è¦ å‡ åå­—èŠ‚ ~ å‡ ç™¾å­—èŠ‚çº§åˆ«ï¼Œå®¹å™¨çš„æ•°é‡è¿‡å¤šï¼Œå•æœºå†…å­˜ä¹Ÿæ— æ³•æ»¡è¶³</span><br><span class="line">   å¦‚æœä½ åˆ›å»º 10 äº¿ä¸ª containerï¼Œå‡è®¾æ¯ä¸ª container å ç”¨ 100 å­—èŠ‚ï¼Œé‚£ä¹ˆå†…å­˜å ç”¨ä¸ºï¼š</span><br><span class="line">   10^9 containers Ã— 100 bytes â‰ˆ 100 GB å†…å­˜</span><br></pre></td></tr></table></figure></li><li class="lvl-2"><p>ä¸¤è€…è¯­ä¹‰å®Œå…¨ä¸€è‡´ï¼Œä»…æ”¯æŒçš„ offset èŒƒå›´ä¸åŒï¼Œä»¥ä¸‹ç¤ºä¾‹ä»¥ R.* ä¸ºä¸»ã€‚</p></li><li class="lvl-2"><p>å¯¹æ¯” R ä¸ R64</p></li></ul><table><thead><tr><th>ç»´åº¦</th><th>R.*</th><th>R64.*</th></tr></thead><tbody><tr><td>Offset ç±»å‹</td><td>uint32</td><td>uint64</td></tr><tr><td>æœ€å¤§å€¼</td><td>4,294,967,295 (~4.29e9)</td><td>18,446,744,073,709,551,615 (~1.84e19)</td></tr><tr><td>å¯è¡¨è¾¾è§„æ¨¡</td><td>åäº¿çº§</td><td>ä¸‡äº¿äº¿çº§</td></tr><tr><td>å…¸å‹ç”¨é€”</td><td>ç”¨æˆ·IDã€ç´¢å¼•</td><td>æ—¶é—´æˆ³ã€é›ªèŠ±IDã€å…¨å±€å”¯ä¸€ID</td></tr></tbody></table><h3 id="ä¸€ã€æ•°æ®å†™å…¥-ä¿®æ”¹ç±»">ä¸€ã€æ•°æ®å†™å…¥ / ä¿®æ”¹ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>å…¸å‹ç”¨é€”</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>R.SETBIT</td><td>è®¾ç½®å•ä¸ª bitï¼ˆ0/1ï¼‰ï¼Œè¿”å›æ—§å€¼</td><td>å•ç‚¹æ ‡è®°</td><td><code>R.SETBIT users 1001 1</code></td></tr><tr><td>R.SETRANGE</td><td>æ‰¹é‡è®¾ç½®åŒºé—´ bit=1</td><td>è¿ç»­åŒºé—´æ‰“æ ‡</td><td><code>R.SETRANGE users 3000 3999</code>ï¼Œä¸åŒ…å«3999</td></tr><tr><td>R.APPENDINTARRAY</td><td>è¿½åŠ å¤šä¸ªæ•´æ•°ï¼ˆbit=1ï¼‰</td><td>æ‰¹é‡æ’å…¥ ID</td><td><code>R.APPENDINTARRAY users 1001 1002 1003</code></td></tr><tr><td>R.SETINTARRAY</td><td>ç”¨æ•´æ•°æ•°ç»„é‡å»º bitmap</td><td>åˆå§‹åŒ–æ•°æ®</td><td><code>R.SETINTARRAY users 1 3 5 7</code></td></tr><tr><td>R.SETBITARRAY</td><td>ç”¨ bit å­—ç¬¦ä¸²é‡å»º bitmap</td><td>å¤–éƒ¨å¯¼å…¥</td><td><code>R.SETBITARRAY users &quot;101001&quot;</code></td></tr><tr><td>R.DELETEINTARRAY</td><td>åˆ é™¤å¤šä¸ªæ•´æ•°ï¼ˆbit=0ï¼‰</td><td>æ‰¹é‡åˆ é™¤</td><td><code>R.DELETEINTARRAY users 1002 2000</code></td></tr><tr><td>R.CLEARBITS</td><td>æ¸…é™¤æŒ‡å®š offset</td><td>ç²¾ç¡®æ¸…ç†</td><td><code>R.CLEARBITS users 1001 1003</code></td></tr><tr><td>R.SETFULL</td><td>å¡«å……æ•´ä¸ª bitmap</td><td>å…¨é‡åˆå§‹åŒ–</td><td><code>R.SETFULL users</code></td></tr><tr><td>R.CLEAR</td><td>åˆ é™¤æ•´ä¸ª bitmap</td><td>é‡Šæ”¾èµ„æº</td><td><code>R.CLEAR users</code></td></tr></tbody></table><h3 id="äºŒã€æ•°æ®è¯»å–-æŸ¥è¯¢ç±»">äºŒã€æ•°æ®è¯»å– / æŸ¥è¯¢ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>å…¸å‹ç”¨é€”</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>R.GETBIT</td><td>è·å–å•ä¸ª bit</td><td>åˆ¤æ–­æ˜¯å¦å­˜åœ¨</td><td><code>R.GETBIT users 1001</code></td></tr><tr><td>R.GETBITS</td><td>æ‰¹é‡è·å– bit</td><td>å¤šç‚¹æŸ¥è¯¢</td><td><code>R.GETBITS users 1001 1002 1003</code></td></tr><tr><td>R.GETBITARRAY</td><td>è¿”å›å®Œæ•´ bit å­—ç¬¦ä¸²</td><td>è°ƒè¯• / å¯¼å‡º</td><td><code>R.GETBITARRAY users</code></td></tr><tr><td>R.GETINTARRAY</td><td>è¿”å›æ‰€æœ‰ä¸º 1 çš„æ•´æ•°</td><td>å…¨é‡éå†</td><td><code>R.GETINTARRAY users</code></td></tr><tr><td>R.RANGEINTARRAY</td><td>è¿”å›åŒºé—´å†…æ•´æ•°ï¼Œæ³¨æ„è¿™é‡Œå‚æ•°æ˜¯<code>ç´¢å¼•ä¸‹æ ‡</code>ï¼Œä¸æ˜¯<code>æ•°å€¼</code></td><td>åˆ†é¡µæ‰«æ</td><td><code>R.RANGEINTARRAY users 1 5</code></td></tr><tr><td>R.MIN</td><td>æœ€å° offset</td><td>æœ€å° ID æŸ¥è¯¢</td><td><code>R.MIN users</code></td></tr><tr><td>R.MAX</td><td>æœ€å¤§ offset</td><td>æœ€å¤§ ID æŸ¥è¯¢</td><td><code>R.MAX users</code></td></tr></tbody></table><h3 id="ä¸‰ã€ç»Ÿè®¡ç±»">ä¸‰ã€ç»Ÿè®¡ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>å…¸å‹ç”¨é€”</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>R.BITCOUNT</td><td>bit=1 æ•°é‡ç»Ÿè®¡</td><td>é›†åˆåŸºæ•°</td><td><code>R.BITCOUNT users</code></td></tr><tr><td>R.BITPOS</td><td>æŸ¥æ‰¾ç¬¬ä¸€ä¸ª 1 æˆ– 0</td><td>ç¨€ç–åˆ†æ</td><td><code>R.BITPOS users 1</code></td></tr><tr><td>R.MIN</td><td>æœ€å° bit ä½ç½®</td><td>è¾¹ç•Œæ£€æµ‹</td><td><code>R.MIN users</code></td></tr><tr><td>R.MAX</td><td>æœ€å¤§ bit ä½ç½®</td><td>è¾¹ç•Œæ£€æµ‹</td><td><code>R.MAX users</code></td></tr><tr><td>R.STAT</td><td>å®¹å™¨ / å†…å­˜ç»Ÿè®¡</td><td>æ€§èƒ½è°ƒä¼˜</td><td><code>R.STAT users TEXT</code></td></tr></tbody></table><h3 id="å››ã€é›†åˆè¿ç®—ç±»">å››ã€é›†åˆè¿ç®—ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>é›†åˆè¯­ä¹‰</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>R.BITOP AND</td><td>ä½å›¾äº¤é›†</td><td>A âˆ© B</td><td><code>R.BITOP AND res a b</code></td></tr><tr><td>R.BITOP OR</td><td>ä½å›¾å¹¶é›†</td><td>A âˆª B</td><td><code>R.BITOP OR res a b</code></td></tr><tr><td>R.BITOP XOR</td><td>å¯¹ç§°å·®é›†</td><td>A âŠ• B</td><td><code>R.BITOP XOR res a b</code></td></tr><tr><td>R.DIFF</td><td>å·®é›†</td><td>A - B</td><td><code>R.DIFF res a b</code></td></tr><tr><td>R.CONTAINS</td><td>åŒ…å«å…³ç³»åˆ¤æ–­</td><td>å­é›†æ£€æµ‹</td><td><code>R.CONTAINS a b ALL</code></td></tr><tr><td>R.JACCARD</td><td>ç›¸ä¼¼åº¦è®¡ç®—</td><td>J(A,B)</td><td><code>R.JACCARD a b</code></td></tr></tbody></table><h3 id="äº”ã€ç»´æŠ¤-ä¼˜åŒ–ç±»">äº”ã€ç»´æŠ¤ / ä¼˜åŒ–ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>å…¸å‹ç”¨é€”</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>R.OPTIMIZE</td><td>å®¹å™¨é‡æ•´ / å‹ç¼©</td><td>é™ä½å†…å­˜</td><td><code>R.OPTIMIZE users MEM</code></td></tr><tr><td>R.CLEAR</td><td>æ¸…ç† bitmap</td><td>å›æ”¶èµ„æº</td><td><code>R.CLEAR users</code></td></tr></tbody></table><h3 id="å…­ã€R-R64-å¯¹ç…§è¡¨ï¼ˆå«ç¤ºä¾‹ï¼‰">å…­ã€R / R64 å¯¹ç…§è¡¨ï¼ˆå«ç¤ºä¾‹ï¼‰</h3><table><thead><tr><th>åŠŸèƒ½</th><th>R (32bit)</th><th>R64 (64bit)</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>è®¾ç½® bit</td><td>R.SETBIT</td><td>R64.SETBIT</td><td><code>R64.SETBIT users64 90000000000 1</code></td></tr><tr><td>æ‰¹é‡æ’å…¥</td><td>R.APPENDINTARRAY</td><td>R64.APPENDINTARRAY</td><td><code>R64.APPENDINTARRAY users64 90000000001 90000000002</code></td></tr><tr><td>æŸ¥è¯¢ bit</td><td>R.GETBIT</td><td>R64.GETBIT</td><td><code>R64.GETBIT users64 90000000001</code></td></tr><tr><td>ç»Ÿè®¡</td><td>R.BITCOUNT</td><td>R64.BITCOUNT</td><td><code>R64.BITCOUNT users64</code></td></tr><tr><td>é›†åˆè¿ç®—</td><td>R.BITOP</td><td>R64.BITOP</td><td><code>R64.BITOP OR res64 a64 b64</code></td></tr><tr><td>ä¼˜åŒ–</td><td>R.OPTIMIZE</td><td>R64.OPTIMIZE</td><td><code>R64.OPTIMIZE users64 MEM</code></td></tr></tbody></table><h2 id="çœŸå®æ¡ˆä¾‹">çœŸå®æ¡ˆä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åœºæ™¯è¯´æ˜</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”µå•†å¹³å°ï¼Œéœ€è¦ç»Ÿè®¡ä»¥ä¸‹æŒ‡æ ‡ï¼š</span><br><span class="line">   VIP ç”¨æˆ·ï¼ˆè´­ä¹°é‡‘é¢è¶…è¿‡ 1000 çš„ç”¨æˆ·ï¼‰</span><br><span class="line">   ä»˜è´¹ç”¨æˆ·ï¼ˆè‡³å°‘è´­ä¹°ä¸€æ¬¡çš„ç”¨æˆ·ï¼‰</span><br><span class="line">   æœ€è¿‘æ´»è·ƒç”¨æˆ·ï¼ˆè¿‡å» 7 å¤©å†…ç™»å½•è¿‡çš„ç”¨æˆ·ï¼‰</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬æƒ³è¦è®¡ç®—ï¼š</span><br><span class="line">   VIP ç”¨æˆ·äººæ•°</span><br><span class="line">   VIP ä¸”æœ€è¿‘æ´»è·ƒçš„ç”¨æˆ·äººæ•°</span><br><span class="line">   VIP ä¸”ä»˜è´¹ç”¨æˆ·ä¸”æœ€è¿‘æ´»è·ƒçš„äººæ•°</span><br><span class="line">   ä»˜è´¹ç”¨æˆ·ä¸æœ€è¿‘æ´»è·ƒç”¨æˆ·çš„ Jaccard ç›¸ä¼¼åº¦</span><br><span class="line"></span><br><span class="line">å‡è®¾ç”¨æˆ· ID ä¸ºæ•´æ•°ï¼ˆæœ€å¤§å€¼ &lt; 2^32ï¼Œä½¿ç”¨ R.* å³å¯ï¼‰ã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol><li class="lvl-5">å†™å…¥æ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VIP ç”¨æˆ·</span></span><br><span class="line">R.APPENDINTARRAY vip_users 1001 1002 1003 1004 1005</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»˜è´¹ç”¨æˆ·</span></span><br><span class="line">R.APPENDINTARRAY paid_users 1002 1003 1005 1006 1007</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€è¿‘æ´»è·ƒç”¨æˆ·</span></span><br><span class="line">R.APPENDINTARRAY active_users 1001 1003 1005 1008</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ•°æ®ç±»å‹</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> active_users</span><br><span class="line">reroaring</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="2"><li class="lvl-5">æŸ¥è¯¢åŸºç¡€ç»Ÿè®¡</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VIP ç”¨æˆ·äººæ•°</span></span><br><span class="line">R.BITCOUNT vip_users</span><br><span class="line"><span class="comment"># è¿”å› 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€è¿‘æ´»è·ƒç”¨æˆ·äººæ•°</span></span><br><span class="line">R.BITCOUNT active_users</span><br><span class="line"><span class="comment"># è¿”å› 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»˜è´¹ç”¨æˆ·äººæ•°</span></span><br><span class="line">R.BITCOUNT paid_users</span><br><span class="line"><span class="comment"># è¿”å› 5</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="3"><li class="lvl-5">è®¡ç®—äº¤é›† / å­é›†</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.VIP ä¸”æœ€è¿‘æ´»è·ƒç”¨æˆ·</span></span><br><span class="line">R.BITOP AND vip_active vip_users active_users</span><br><span class="line">R.BITCOUNT vip_active</span><br><span class="line"><span class="comment"># è¿”å› 3</span></span><br><span class="line"><span class="comment"># è§£é‡Šï¼šç”¨æˆ· 1001, 1003, 1005 åŒæ—¶æ˜¯ VIP ä¸”æœ€è¿‘æ´»è·ƒã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.VIP ä¸”ä»˜è´¹ç”¨æˆ·ä¸”æœ€è¿‘æ´»è·ƒ</span></span><br><span class="line"><span class="comment"># å…ˆè®¡ç®— VIP ä¸ä»˜è´¹äº¤é›†</span></span><br><span class="line">R.BITOP AND vip_paid vip_users paid_users</span><br><span class="line"><span class="comment"># å†è®¡ç®— vip_paid ä¸æ´»è·ƒç”¨æˆ·äº¤é›†</span></span><br><span class="line">R.BITOP AND vip_paid_active vip_paid active_users</span><br><span class="line">R.BITCOUNT vip_paid_active</span><br><span class="line"><span class="comment"># è¿”å› 2</span></span><br><span class="line"><span class="comment"># è§£é‡Šï¼šç”¨æˆ· 1003, 1005 åŒæ—¶æ»¡è¶³ä¸‰æ¡ä»¶ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="4"><li class="lvl-5">è®¡ç®— Jaccard ç›¸ä¼¼åº¦</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®— ä»˜è´¹ç”¨æˆ· ä¸ æœ€è¿‘æ´»è·ƒç”¨æˆ· çš„ç›¸ä¼¼åº¦</span></span><br><span class="line">R.JACCARD paid_users active_users</span><br><span class="line"><span class="comment"># è¿”å› &quot;0.2857142857142857&quot;</span></span><br><span class="line"><span class="comment"># Jaccard ç›¸ä¼¼åº¦è®¡ç®—å…¬å¼ï¼š</span></span><br><span class="line">   J(A, B) = |A âˆ© B| / |A âˆª B| = äº¤é›† / å¹¶é›†</span><br><span class="line">   0.2857142857142857 = |1003, 1005| / |1001, 1002, 1003, 1005, 1006, 1007, 1008| = 2 / 7 = 0.2857142857142857</span><br></pre></td></tr></table></figure><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi mathvariant="normal">âˆ£</mi><mi>A</mi><mo>âˆ©</mo><mi>B</mi><mi mathvariant="normal">âˆ£</mi></mrow><mrow><mi mathvariant="normal">âˆ£</mi><mi>A</mi><mo>âˆª</mo><mi>B</mi><mi mathvariant="normal">âˆ£</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">J(A, B) = \frac{|A \cap B|}{|A \cup B|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆª</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord">âˆ£</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ©</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord">âˆ£</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><ul class="lvl-0"><li class="lvl-2"><ol start="5"><li class="lvl-5">èŒƒå›´ / ID æŸ¥è¯¢</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.è·å– VIP ç”¨æˆ· ID åˆ—è¡¨</span></span><br><span class="line">R.GETINTARRAY vip_users</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 1001  <span class="comment"># 1 æ˜¯ç´¢å¼•ï¼Œ1001 æ˜¯å€¼</span></span><br><span class="line">2) (<span class="built_in">integer</span>) 1002</span><br><span class="line">3) (<span class="built_in">integer</span>) 1003</span><br><span class="line">4) (<span class="built_in">integer</span>) 1004</span><br><span class="line">5) (<span class="built_in">integer</span>) 1005</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.è·å–æœ€è¿‘æ´»è·ƒç”¨æˆ· IDï¼Œç´¢å¼•èŒƒå›´ åœ¨ 1~3 èŒƒå›´ï¼Œæ³¨æ„è¿™é‡Œçš„ç´¢å¼•æ˜¯ R.GETINTARRAY è¿”å›çš„ç´¢å¼•ä¸‹æ ‡ï¼Œä¸æ˜¯å€¼ã€‚</span></span><br><span class="line">R.RANGEINTARRAY active_users 1 3</span><br><span class="line"><span class="comment"># è¿”å› 1003, 1005, 1008</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 1003</span><br><span class="line">2) (<span class="built_in">integer</span>) 1005</span><br><span class="line">3) (<span class="built_in">integer</span>) 1008</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="6"><li class="lvl-5">ä¼˜åŒ–å­˜å‚¨</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæ•°æ®é‡éå¸¸å¤§ï¼Œå¯ä»¥ä¼˜åŒ–å†…å­˜</span></span><br><span class="line">R.OPTIMIZE vip_users MEM</span><br><span class="line">R.OPTIMIZE paid_users MEM</span><br><span class="line">R.OPTIMIZE active_users MEM</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisRoaring ä¸­ RoaringBitmap æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æ“ä½œç³»ç»Ÿï¼š&lt;code&gt;Amazon Linux 2023(å†…æ ¸ 6.1)&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;RedisRoaring çš„å®‰è£…å‚è§ &lt;a href=&quot;/2026/01/08/redis7-module-RedisRoaring/&quot; title=&quot;Redis æ‰©å±•æ¨¡å— -- RedisRoaring çš„å®‰è£…æ–¹æ³•&quot;&gt;Redis æ‰©å±•æ¨¡å— -- RedisRoaring çš„å®‰è£…æ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis æ‰©å±•æ¨¡å— -- RedisRoaring çš„å®‰è£…æ–¹æ³•</title>
    <link href="https://blog.hanqunfeng.com/2026/01/08/redis7-module-RedisRoaring/"/>
    <id>https://blog.hanqunfeng.com/2026/01/08/redis7-module-RedisRoaring/</id>
    <published>2026-01-08T13:30:05.000Z</published>
    <updated>2026-01-08T09:44:21.470Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisRoaring çš„å®‰è£…æ–¹æ³•</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li></ul><span id="more"></span><h2 id="RedisRoaring-ç®€ä»‹">RedisRoaring ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/aviggiano/redis-roaring">RedisRoaring</a>æ˜¯ä¸€ä¸ªå¼€æºçš„ Redis æ¨¡å—ï¼ˆRedis Moduleï¼‰ï¼Œç”± Antonio Guilherme Ferreira Viggiano ç»´æŠ¤ï¼Œç›®çš„æ˜¯å°† Roaring Bitmap æ•°æ®ç»“æ„åŸç”Ÿé›†æˆåˆ° Redis ä¸­ä½œä¸ºæ–°çš„æ•°æ®ç±»å‹ä¸å‘½ä»¤é›†ã€‚</p></li><li class="lvl-2"><p>å®ƒåŸºäº CRoaring åº“å®ç°å‹ç¼©ä½å›¾ï¼ˆRoaring Bitmapï¼‰åŠŸèƒ½ï¼Œè¿™æ˜¯ä¸€ç§é«˜æ•ˆã€å‹ç¼©çš„ä½å›¾æ•°æ®ç»“æ„ï¼Œé€‚åˆå¤„ç†å¤§è§„æ¨¡æ•´æ•°é›†åˆã€‚</p></li><li class="lvl-2"><p>å…¼å®¹ Redis 6.0 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œåœ¨ä¸åŒç‰ˆæœ¬ä¸­å¯¹å‘½ä»¤å…ƒæ•°æ®ã€ACL åˆ†ç±»ç­‰åŠŸèƒ½æœ‰è‡ªåŠ¨é€‚é…æ”¯æŒã€‚</p></li></ul><h2 id="åŸç”Ÿçš„redis-bitmapæœ‰å“ªäº›é—®é¢˜">åŸç”Ÿçš„<code>redis bitmap</code>æœ‰å“ªäº›é—®é¢˜?</h2><ul class="lvl-0"><li class="lvl-2"><p>ç»“è®ºå…ˆè¡Œï¼šRedis åŸç”Ÿ Bitmap çš„æ ¸å¿ƒé—®é¢˜æ˜¯ã€Œç©ºé—´ä¸å¯æ§ + å¤§è§„æ¨¡ä½è¿ç®—æ€§èƒ½éšæœ€å¤§åç§»çº¿æ€§å¢é•¿ã€ï¼Œè€Œ redis-roaring é€šè¿‡ Roaring Bitmap è§£å†³äº†ç¨€ç–æ•°æ®å†…å­˜æµªè´¹å’Œå¤§èŒƒå›´æ‰«ææ•ˆç‡é—®é¢˜ã€‚</p></li><li class="lvl-2"><p>Bitmap æ˜¯è¿ç»­æ•°ç»„ï¼Œä¸æ”¯æŒç¨€ç–å‹ç¼©ï¼Œ å…¶å¿…é¡» ä» 0 åˆ°æœ€å¤§ bit offset å…¨éƒ¨è¿ç»­åˆ†é…å†…å­˜ã€‚ä½ åªè¦è®¾ç½®äº† bit=1 çš„æœ€å¤§ä¸‹æ ‡æ˜¯ Nï¼Œé‚£ä¹ˆ Redis è‡³å°‘è¦åˆ†é… N/8 å­—èŠ‚å†…å­˜ã€‚</p></li><li class="lvl-2"><p>å‡è®¾ä½ è¦å­˜å‚¨ç”¨æˆ·IDé›†åˆï¼Œä½†æ˜¯å­˜å‚¨çš„IDèŒƒå›´è¾ƒå¤§ï¼Œæ¯”å¦‚ 1-2000000000ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´Bitmapçš„bit offsetéå¸¸å¤§ï¼Œå¯¼è‡´Bitmapçš„å­˜å‚¨ç©ºé—´éå¸¸å¤§ã€‚</p></li><li class="lvl-2"><p>å¦å¤–å¦‚æœæ•°æ®æ¯”è¾ƒç¨€ç–ï¼Œæç«¯æƒ…å†µä¸‹åªå­˜å‚¨äº†2ä¸ªIDï¼ŒID1:1ï¼ŒID2:2000000000ï¼Œé‚£ä¹ˆBitmapå°±è¦æŒ‰ç…§æœ€å¤§çš„ offsetè¿›è¡Œåˆ†é…ç©ºé—´ï¼Œå¯¼è‡´Bitmapçš„å­˜å‚¨ç©ºé—´éå¸¸å¤§ï¼Œä½†æ˜¯ä¸­é—´çš„ç©ºé—´åˆè¢«æµªè´¹äº†ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SETBIT user:bitmap 1 1</span><br><span class="line">SETBIT user:bitmap 2000000000 1</span><br><span class="line"><span class="comment"># 2_000_000_000 bits â‰ˆ 250 MB</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Redis å†…éƒ¨å¿…é¡»æ‰«æï¼š0 ... max_offsetï¼Œå³ä½¿åªæœ‰ 2 ä¸ª bit ä¸º 1ï¼Œä¹Ÿå¿…é¡»æ‰«æ 250MB å†…å­˜ã€‚</span></span><br><span class="line">BITCOUNT user:bitmap</span><br></pre></td></tr></table></figure><h2 id="Roaring-Bitmapå®ç°æ€è·¯">Roaring Bitmapå®ç°æ€è·¯</h2><ul class="lvl-0"><li class="lvl-2"><p>å°†32ä½çš„intç±»å‹æ•°æ®è¿›è¡Œ<code>é«˜16ä½</code>ã€<code>ä½16ä½</code>åˆ’åˆ†ï¼Œé«˜16ä½å°±è¢«åˆ’åˆ†æˆ<code>2^16=65536ä¸ªå¤§æ¡¶ï¼ˆå®¹å™¨ï¼‰</code>ï¼Œä½16ä½æœ€å¤šè¢«åˆ’åˆ†æˆ<code>2^16=65536ä¸ªå°æ¡¶ï¼ˆå…ƒç´ ï¼‰</code></p></li><li class="lvl-2"><p>æŠŠè¦ç»Ÿè®¡çš„æ•°å­—æ‹†åˆ†ä½é«˜16ä½å’Œä½16ä½ï¼Œé«˜16ä½ç”¨ä½œå®¹å™¨çš„ç´¢å¼•ã€ç”¨äºå®šä½æ•°å­—åœ¨å“ªä¸ªå®¹å™¨ï¼›ä½16ä½ç”¨ä½œå®¹å™¨å†…å…ƒç´ çš„ç´¢å¼•ã€ç”¨ä½œå®šä½æ•°å­—åœ¨å®¹å™¨å†…çš„ä½ç½®ã€‚</p></li><li class="lvl-2"><p>é«˜16ä½å’Œä½16ä½çš„è®¡ç®—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">å…¬å¼ï¼šx = high * 2^16 + low</span><br><span class="line">å¯¹ä¸€ä¸ªæ•´æ•° xï¼š</span><br><span class="line">é«˜ 16 ä½ï¼ˆHighï¼‰ = x / 2^16ï¼ˆæ•´æ•°é™¤æ³•ï¼‰</span><br><span class="line">ä½ 16 ä½ï¼ˆLowï¼‰ = x % 2^16</span><br><span class="line"></span><br><span class="line">é«˜ 16 ä½ç”¨äºå®šä½â€œå®¹å™¨ï¼ˆcontainerï¼‰â€ï¼Œä½ 16 ä½ç”¨äºå®šä½å®¹å™¨å†…éƒ¨çš„ä½ç½®ã€‚</span><br><span class="line"></span><br><span class="line">å‡è®¾ä¸€ä¸ª 32 ä½æ•´æ•°ï¼šx = 305419896 = 0x12345678 ï¼ˆåå…­è¿›åˆ¶ï¼‰</span><br><span class="line">é«˜ 16 ä½ï¼ˆHighï¼‰ = x / 2^16 = 305419896 / 65536 = 4660</span><br><span class="line">ä½ 16 ä½ï¼ˆLowï¼‰ = x % 2^16  = 305419896 % 65536 = 22136</span><br><span class="line">å±äºï¼šcontainer 4660, offset 22136</span><br><span class="line"></span><br><span class="line">è½¬ä¸ºäºŒè¿›åˆ¶ï¼ˆ32 ä½ï¼‰è¿›è¡ŒéªŒè¯ï¼š</span><br><span class="line">0001 0010 0011 0100 | 0101 0110 0111 1000</span><br><span class="line">   â†‘ é«˜ 16 ä½       |    â†‘ ä½ 16 ä½</span><br><span class="line"></span><br><span class="line">| éƒ¨åˆ†   | äºŒè¿›åˆ¶              | åå…­è¿›åˆ¶   | åè¿›åˆ¶   |</span><br><span class="line">| ---- | ------------------- | ------ | ----- |</span><br><span class="line">| é«˜16ä½ | 0001 0010 0011 0100 | 0x1234 | 4660  |</span><br><span class="line">| ä½16ä½ | 0101 0110 0111 1000 | 0x5678 | 22136 |</span><br><span class="line"></span><br><span class="line">è¾¹ç•Œä¾‹å­ï¼ˆå®¹å™¨åˆ‡æ¢ç‚¹ï¼‰</span><br><span class="line">x = 65535</span><br><span class="line">high = 65535 / 65536 = 0</span><br><span class="line">low  = 65535 % 65536 = 65535</span><br><span class="line">å±äºï¼šcontainer 0, offset 65535 ï¼ˆå®¹å™¨0çš„æœ€åä¸€ä¸ªä½ç½®ï¼‰</span><br><span class="line"></span><br><span class="line">x = 65536</span><br><span class="line">high = 65536 / 65536 = 1</span><br><span class="line">low  = 65536 % 65536 = 0</span><br><span class="line">å±äºï¼šcontainer 1, offset 0 ï¼ˆå®¹å™¨1çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼‰</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®¹å™¨æœ‰ä¸‰ç§ä¸åŒç±»å‹: <code>ArrayContainer</code>ã€<code>BitmapContainer</code>å’Œ<code>RunContainer</code>ï¼Œæ ¹æ®è¦ç»Ÿè®¡çš„æ•°å­—çš„æ•°é‡å’Œæ•°å­—çš„è¿ç»­æ€§è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å®¹å™¨ã€‚</p></li></ul><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ArrayContainer</td><td>ç¨€ç–ï¼ˆå°‘é‡æ•´æ•°ï¼‰ï¼Œå…ƒç´ ä¸ºshortç±»å‹çš„æœ‰åºæ•°ç»„<br>æœ€å¤šå­˜å‚¨ 65536 ä¸ª short å…ƒç´ ï¼Œå ç”¨ 128 KB å†…å­˜</td></tr><tr><td>BitmapContainer</td><td>å¯†é›† ï¼Œä½¿ç”¨bitmapå­˜å‚¨æ•°æ®ï¼Œå›ºå®šå ç”¨ 8kB å†…å­˜</td></tr><tr><td>RunContainer</td><td>è¿ç»­åŒºé—´ï¼Œä½¿ç”¨Run-Length Encodingæ–¹å¼å‹ç¼©å­˜å‚¨çš„å…ƒç´ ï¼Œå¯¹è¿ç»­æ•°æ®çš„å‹ç¼©æ•ˆæœç‰¹åˆ«å¥½ã€‚<br>å®ƒçš„åŸç†æ˜¯ï¼Œå¯¹äºè¿ç»­å‡ºç°çš„æ•°å­—ï¼Œåªè®°å½•åˆå§‹æ•°å­—å’Œåç»­æ•°é‡ã€‚å³ï¼š<br>å¯¹äºæ•°æ®é›†ï¼š5ï¼Œä¼šå‹ç¼©ä¸º5, 0<br>å¯¹äºæ•°æ®é›†ï¼š5, 6, 7, 8, 9, 10ï¼Œä¼šå‹ç¼©ä¸º5, 5<br>å¯¹äºæ•°æ®é›†ï¼š5, 7, 9, 11, 12ï¼Œä¼šå‹ç¼©ä¸º5, 0, 7, 0, 9, 0, 11, 1 <br>æœ€å¥½æƒ…å†µï¼šå…¨éƒ¨æ˜¯è¿ç»­æ•°å­—ï¼Œåªä¼šå­˜å‚¨ 2 ä¸ª short ï¼Œå ç”¨ 4 bytes<br>æœ€åæƒ…å†µï¼š0~65535çš„èŒƒå›´å†…å¡«å……æ‰€æœ‰çš„å¥‡æ•°ä½æˆ–å¶æ•°ä½ï¼Œéœ€è¦ 65536 ä¸ªshortï¼Œå ç”¨ 128 KB</td></tr></tbody></table><h3 id="å®¹å™¨çš„ä½¿ç”¨åŠå®¹å™¨ä¹‹é—´çš„è½¬æ¢">å®¹å™¨çš„ä½¿ç”¨åŠå®¹å™¨ä¹‹é—´çš„è½¬æ¢</h3><ul class="lvl-0"><li class="lvl-2"><p>Roaring çš„ç›®æ ‡æ˜¯ï¼šåœ¨ä¿è¯æ“ä½œæ€§èƒ½çš„å‰æä¸‹ï¼Œä½¿å†…å­˜å ç”¨æœ€å°ã€‚</p></li><li class="lvl-2"><p>å› æ­¤ï¼šæ’å…¥ã€åˆ é™¤ã€åˆå¹¶ã€è¿ç®—åï¼Œä¼šè¯„ä¼°å½“å‰ container çš„â€œæœ€ä¼˜ç±»å‹â€ï¼Œå¿…è¦æ—¶è‡ªåŠ¨è½¬æ¢</p></li><li class="lvl-2"><p>âœ… Array â†’ Bitmapï¼Œè§¦å‘æ¡ä»¶ï¼šå®¹å™¨ä¸­å…ƒç´ æ•°é‡ &gt; 4096</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åŸå› ï¼š</span><br><span class="line">   Array æ¯ä¸ªå…ƒç´ å  2 bytes</span><br><span class="line">   4096 Ã— 2 = 8192 bytes</span><br><span class="line">   Bitmap å›ºå®š 8192 bytes</span><br><span class="line"></span><br><span class="line">è¶…è¿‡è¿™ä¸ªç‚¹ï¼ŒBitmap æ›´çœå†…å­˜ + æŸ¥è¯¢æ›´å¿«ã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>âœ… Bitmap â†’ Arrayï¼Œè§¦å‘æ¡ä»¶ï¼šå®¹å™¨ä¸­å…ƒç´ æ•°é‡ &lt;= 4096ï¼Œä¸€èˆ¬åœ¨å¤§é‡åˆ é™¤æˆ– AND è¿ç®—åè§¦å‘ã€‚</p></li><li class="lvl-2"><p>âœ… RunContainer â†” Array / Bitmapï¼ŒRun æ²¡æœ‰å›ºå®šé˜ˆå€¼ï¼Œè€Œæ˜¯ åŠ¨æ€è¯„ä¼°å†…å­˜æ¨¡å‹ï¼ŒåŸºäºå¦‚ä¸‹ä¸‰ä¸ªæŒ‡æ ‡ï¼š</p><ul class="lvl-2"><li class="lvl-5">run_count : å½“å‰ RunContainer ä¸­æœ‰å¤šå°‘ä¸ªè¿ç»­åŒºé—´</li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¾‹å¦‚é›†åˆï¼š&#123;1,2,3,4,5,  10,11,12,  100&#125;</span><br><span class="line">è¿ç»­åŒºé—´ï¼š[1..5], [10..12], [100..100]</span><br><span class="line">å› æ­¤ï¼šrun_count = 3</span><br></pre></td></tr></table></figure></li></ul><table><thead><tr><th>run_count</th><th>æ•°æ®å½¢æ€</th><th>é€‚åˆ Run å—</th></tr></thead><tbody><tr><td>å¾ˆå°ï¼ˆ1~å‡ åï¼‰</td><td>å¤§æ®µè¿ç»­</td><td>æå…¶é€‚åˆ</td></tr><tr><td>ä¸­ç­‰ï¼ˆå‡ ç™¾ï¼‰</td><td>ç¨ç¢</td><td>å¯èƒ½é€‚åˆ</td></tr><tr><td>å¾ˆå¤§ï¼ˆä¸Šåƒï¼‰</td><td>é«˜åº¦ç¢ç‰‡åŒ–</td><td>ä¸é€‚åˆ</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-5"><p>run_total_coverage : run è¦†ç›–çš„æ€»å…ƒç´ æ•°é‡(æœ¬è´¨å°±æ˜¯å…ƒç´ çš„æ•°é‡)</p></li></ul>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[1..5]  â†’ 5 ä¸ª</span><br><span class="line">[10..12] â†’ 3 ä¸ª</span><br><span class="line">[100..100] â†’ 1 ä¸ª</span><br><span class="line"></span><br><span class="line">run_total_coverage = 9</span><br><span class="line"></span><br><span class="line">å®é™…ä¸Šæ›´é‡è¦çš„æŒ‡æ ‡æ˜¯ å¹³å‡ run é•¿åº¦</span><br><span class="line">å¹³å‡ run é•¿åº¦ = run_total_coverage / run_count = 9 / 3 = 3</span><br></pre></td></tr></table></figure><table><thead><tr><th>run_count</th><th>coverage</th><th>å¹³å‡é•¿åº¦</th><th>å½¢æ€</th><th>é€‚åˆ Run å—</th></tr></thead><tbody><tr><td>1</td><td>60,000</td><td>60,000</td><td>è¶…é•¿è¿ç»­</td><td>æé€‚åˆ</td></tr><tr><td>10</td><td>50,000</td><td>5,000</td><td>å¤§æ®µè¿ç»­</td><td>é€‚åˆ</td></tr><tr><td>5,000</td><td>50,000</td><td>10</td><td>ç¢ç‰‡è¿ç»­</td><td>éå¸¸ä¸é€‚åˆ</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-5"><p>estimated_memory : ä¼°ç®—å†…å­˜å ç”¨ï¼Œè¿™æ˜¯æ ¸å¿ƒå†³ç­–æŒ‡æ ‡</p></li></ul>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">memory_run: å¦‚æœç”¨ RunContainerï¼Œéœ€è¦å¤šå°‘å†…å­˜ï¼Œ â‰ˆ run_count Ã— RUN_ENTRY_SIZE(4 bytes)</span><br><span class="line">memory_array: å¦‚æœç”¨ ArrayContainerï¼Œéœ€è¦å¤šå°‘å†…å­˜ï¼Œ â‰ˆ å…ƒç´ æ•°é‡ Ã— 2 bytes</span><br><span class="line">memory_bitmap: å¦‚æœç”¨ BitmapContainerï¼Œéœ€è¦å¤šå°‘å†…å­˜ï¼Œå›ºå®šå†…å­˜ = 8192 bytes</span><br><span class="line"></span><br><span class="line">â–¶ é€‰æ‹©é€»è¾‘ï¼ˆç®€åŒ–ï¼‰</span><br><span class="line"><span class="keyword">if</span> memory_run &lt; min(memory_array, memory_bitmap):</span><br><span class="line">   use RunContainer</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> memory_array &lt; memory_bitmap:</span><br><span class="line">   use ArrayContainer</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">   use BitmapContainer</span><br></pre></td></tr></table></figure><table><thead><tr><th>è½¬æ¢æ–¹å‘</th><th>è§¦å‘æ¡ä»¶</th></tr></thead><tbody><tr><td>Array â†’ Bitmap</td><td>å…ƒç´ æ•°é‡ &gt; 4096</td></tr><tr><td>Bitmap â†’ Array</td><td>å…ƒç´ æ•°é‡ â‰¤ 4096</td></tr><tr><td>ä»»æ„ â†’ Run</td><td>è¿ç»­åŒºé—´å‹ç¼©æ˜æ˜¾</td></tr><tr><td>Run â†’ Array / Bitmap</td><td>run ç¢ç‰‡åŒ–æˆ–å†…å­˜åŠ£åŒ–</td></tr><tr><td>æ‰¹é‡è¿ç®—</td><td>æ ¹æ®ç»“æœè‡ªåŠ¨é€‰æ‹©</td></tr><tr><td>optimize</td><td>å¼ºåˆ¶é‡æ–°è¯„ä¼°</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>âœ… åœ¨ Roaring çš„è‡ªåŠ¨é€‰æ‹©æœºåˆ¶ä¸‹ï¼Œæ­£å¸¸æƒ…å†µä¸‹å•ä¸ª container çš„å†…å­˜å ç”¨ä¼šè¢«æ§åˆ¶åœ¨ â‰ˆ 8KB å·¦å³æˆ–æ›´å°ï¼Œåœ¨â€œç†è®ºæé™å®Œå…¨å¡«æ»¡65535ä¸ª containerâ€æƒ…å†µä¸‹ï¼Œå¤§çº¦å  520 MB å†…å­˜(é™¤äº†æ•°æ®æœ¬èº«è¿˜æœ‰ä¸€äº›å…ƒæ•°æ®)</p></li></ul><table><thead><tr><th>é¡¹ç›®</th><th>ä¼°ç®—</th></tr></thead><tbody><tr><td>Bitmap æ•°æ®</td><td>~512 MB</td></tr><tr><td>Container å…ƒæ•°æ®</td><td>~4 MB</td></tr><tr><td>ç´¢å¼•ç»“æ„</td><td>~1 MB</td></tr><tr><td>Redis Key è‡ªèº«</td><td>~0.1 MB</td></tr><tr><td><strong>åˆè®¡</strong></td><td><strong>çº¦ 517 MB</strong></td></tr></tbody></table><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/Vw540M.png" alt="" width="1000" height="500"></p><ul class="lvl-0"><li class="lvl-2"><p>ç›´è§‚å¯¹æ¯”è¡¨</p></li></ul><table><thead><tr><th>ç»´åº¦</th><th>Redis Bitmap</th><th>redis-roaring</th></tr></thead><tbody><tr><td>å­˜å‚¨ç»“æ„</td><td>è¿ç»­ bit array</td><td>å‹ç¼© bitmapï¼ˆåˆ†å—ï¼‰</td></tr><tr><td>ç¨€ç–æ•°æ®å†…å­˜</td><td>æå·®</td><td>æä¼˜</td></tr><tr><td>æœ€å¤§ offset</td><td>è¶Šå¤§å†…å­˜è¶Šçˆ†</td><td>å‡ ä¹æ— å½±å“</td></tr><tr><td>BITCOUNT / BITOP</td><td>æ‰«ææ•´ä¸ª bitmap</td><td>åªæ‰«ææœ‰æ•ˆ container</td></tr><tr><td>æ‰©å®¹æˆæœ¬</td><td>å¯èƒ½å¤§è§„æ¨¡ realloc</td><td>å±€éƒ¨ container æ‰©å±•</td></tr><tr><td>å• bit è¯»å†™</td><td>æå¿«</td><td>ç•¥æ…¢ï¼ˆç»“æ„å±‚ï¼‰</td></tr><tr><td>æ¨¡å—ä¾èµ–</td><td>åŸç”Ÿ</td><td>Redis Module</td></tr><tr><td>è¿ç»´å¤æ‚åº¦</td><td>æœ€ä½</td><td>ç¨é«˜</td></tr></tbody></table><h2 id="RedisRoaringæ ¸å¿ƒä»·å€¼ä¸ä¼˜åŠ¿">RedisRoaringæ ¸å¿ƒä»·å€¼ä¸ä¼˜åŠ¿</h2><ul class="lvl-0"><li class="lvl-2"><ol><li class="lvl-5">å†…å­˜æ•ˆç‡æ›´é«˜</li></ol><ul class="lvl-2"><li class="lvl-5">Roaring Bitmap ä¼šæ ¹æ®æ•°æ®ç¨€ç–/å¯†é›†è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜è¡¨ç¤ºæ–¹å¼ï¼ˆæ•°ç»„ã€ä½å›¾æˆ–è¿è¡Œé•¿åº¦ç¼–ç ï¼‰ï¼Œæ˜¾è‘—å‡å°‘å†…å­˜å ç”¨ï¼Œç›¸æ¯”ä¼ ç»Ÿ Redis Bitmap åœ¨ç¨€ç–æ•°æ®ä¸Šèƒ½èŠ‚çœå¤§é‡ç©ºé—´ã€‚</li></ul></li><li class="lvl-2"><ol start="2"><li class="lvl-5">é«˜æ€§èƒ½ä½æ“ä½œ</li></ol><ul class="lvl-2"><li class="lvl-5">å¯¹å•ä¸ªä½çš„æ“ä½œä¿æŒ O(1) æ€§èƒ½ï¼Œä¸ Redis åŸç”Ÿä½å›¾æ“ä½œä¸€è‡´ã€‚</li><li class="lvl-5">å¯¹äºå¤§è§„æ¨¡æ“ä½œï¼ˆä¾‹å¦‚ BITOP AND/OR/XORï¼‰æ€§èƒ½æ˜¾è‘—ä¼˜äºåŸç”Ÿä½å›¾ï¼ŒæŸäº›æ“ä½œå¯è¾¾åˆ° 8 å€æ€§èƒ½æå‡ã€‚</li></ul></li><li class="lvl-2"><ol start="3"><li class="lvl-5">ç»“æ„ä¸°å¯Œçš„å‘½ä»¤é›†</li></ol><ul class="lvl-2"><li class="lvl-5">é™¤äº†ä¼ ç»Ÿä½å›¾å‘½ä»¤ä¹‹å¤–ï¼Œredis-roaring æä¾›æ›´ä¸°å¯Œçš„æ•°æ®æ“ä½œå‘½ä»¤ï¼Œæ”¯æŒæ‰¹é‡å’Œåˆ†æå‹ç”¨ä¾‹ã€‚</li></ul></li></ul><h2 id="å®‰è£…-RedisRoaring">å®‰è£… RedisRoaring</h2><blockquote><p>å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚<br>å¯ä»¥åœ¨æµ·å¤–çš„<code>ç›¸åŒé…ç½®</code>çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„<code>redistimeseries.so</code>ä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /usr/local/soft/modules/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/soft/modules</span><br><span class="line"><span class="comment"># clone ä»£ç </span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/aviggiano/redis-roaring.git</span><br><span class="line"><span class="built_in">cd</span> redis-roaring/</span><br><span class="line"><span class="comment"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class="line">git checkout v1.7.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘æ„å»ºï¼Œä½œè€…å°†ä¸‹è½½å­æ¨¡å—ã€ç¼–è¯‘å®‰è£…ç­‰å‘½ä»¤éƒ½å°è£…åˆ°ä¸€ä¸ªè„šæœ¬ä¸­ï¼Œè¿™é‡Œç›´æ¥æ‰§è¡Œè„šæœ¬å³å¯</span></span><br><span class="line">./configure.sh</span><br><span class="line"><span class="comment"># å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œè¾“å‡º: dist/libredis-roaring.so</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®é™…ä¸Š<code>redis-roaring</code>åœ¨æ„å»ºåä¼šåœ¨<code>dist</code>ç›®å½•ä¸‹ç”Ÿæˆå¥½ Redis ç›¸å…³å‘½ä»¤å’Œé…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…Redisåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚<code>v1.7.1</code>ç‰ˆæœ¬æä¾›çš„Redisçš„ç‰ˆæœ¬ä¸º<code>8.2.1</code>ï¼Œä½†æ­¤æ—¶æ˜¯ä¸å¸¦ Stack ç›¸å…³æ¨¡å—çš„ã€‚</p></li></ul><h2 id="Redis-å¯ç”¨æ¨¡å—">Redis å¯ç”¨æ¨¡å—</h2><ul class="lvl-0"><li class="lvl-2"><p>å°†ç”Ÿæˆçš„ <code>libredis-roaring.so</code> æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">cp</span> dist/libredis-roaring.so /usr/local/soft/redis-7.4.7/modules/libredis-roaring.so</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡é‡‡ç”¨ <code>loadmodule</code> åŠ è½½æ¨¡å—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°† libredis-roaring.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class="line">loadmodule /usr/local/soft/redis-7.4.7/modules/libredis-roaring.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨redis</span></span><br><span class="line">redis-server redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½•æµ‹è¯•</span></span><br><span class="line">redis-cli --user admin --pass 123456</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ¨¡å—</span></span><br><span class="line">127.0.0.1:6379&gt; MODULE LIST</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;ReJSON&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 20816</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 11209</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/redistimeseries.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">3) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;search&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 21025</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/redisearch.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">4) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;bf&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 20817</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">5) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;REDIS-ROARING&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 10700</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/libredis-roaring.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisRoaring çš„å®‰è£…æ–¹æ³•&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æ“ä½œç³»ç»Ÿï¼š&lt;code&gt;Amazon Linux 2023(å†…æ ¸ 6.1)&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TimeSeries</title>
    <link href="https://blog.hanqunfeng.com/2026/01/07/redis7-datatype-18-TimeSeries/"/>
    <id>https://blog.hanqunfeng.com/2026/01/07/redis7-datatype-18-TimeSeries/</id>
    <published>2026-01-07T14:30:05.000Z</published>
    <updated>2026-01-07T10:32:15.918Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisTimeSeries ä¸­ TimeSeries æ•°æ®ç±»å‹</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2">RedisTimeSeries çš„å®‰è£…å‚è§ <a href="/2026/01/07/redis7-module-RedisTimeSeries/" title="Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•</a></li></ul><span id="more"></span><h2 id="TimeSeries-ç®€ä»‹">TimeSeries ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>TimeSeries æ˜¯ Redis çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œç”¨äºå¤„ç†æ—¶é—´åºåˆ—æ•°æ®ï¼Œ<a href="https://redis.io/modules/redis-timeseries/?utm_source=chatgpt.com">RedisTimeSeries | A NoSQL Time Series Database</a></p></li><li class="lvl-2"><p>æ ¸å¿ƒè®¾è®¡ä¸æ•°æ®æ¨¡å‹</p></li></ul><blockquote><p>ä¸€ä¸ª Redis æ—¶é—´åºåˆ—ï¼ˆTime Seriesï¼‰ æ˜¯æœ‰åºçš„ä¸€ç³»åˆ—é‡‡æ ·æ•°æ®ç‚¹ï¼š</p></blockquote><table><thead><tr><th>ç»„æˆéƒ¨åˆ†</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ—¶é—´æˆ³ï¼ˆtimestampï¼‰</strong></td><td>æ¯«ç§’çº§æ—¶é—´æ ‡ç­¾ï¼Œå¯å®¢æˆ·ç«¯æŒ‡å®šæˆ–ç”±æœåŠ¡å™¨å¡«å……</td></tr><tr><td><strong>å€¼ï¼ˆvalueï¼‰</strong></td><td>64 ä½æµ®ç‚¹æ•°</td></tr><tr><td><strong>å…ƒæ•°æ®ï¼ˆlabelsï¼‰</strong></td><td>ä¸€ç»„é”®å€¼å¯¹ï¼Œå¯ç”¨äºè¿‡æ»¤ä¸èšåˆæŸ¥è¯¢</td></tr><tr><td><strong>ä¿ç•™ç­–ç•¥ï¼ˆretentionï¼‰</strong></td><td>æ•°æ®ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ï¼Œè¿‡æœŸè‡ªåŠ¨ä¸¢å¼ƒ</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ä¸»è¦åŠŸèƒ½ä¸ç‰¹æ€§</p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>é«˜ååå†™å…¥</strong></td><td>æ”¯æŒæ¯ç§’æ¥æ”¶å¤§é‡æ•°æ®ç‚¹ï¼Œå»¶è¿Ÿæä½</td></tr><tr><td><strong>åŒºé—´æŸ¥è¯¢</strong></td><td>å¯æŒ‰æ—¶é—´èŒƒå›´æ£€ç´¢æ•°æ®ï¼Œå¦‚ <code>TS.RANGE</code> / <code>TS.MRANGE</code></td></tr><tr><td><strong>èšåˆæŸ¥è¯¢</strong></td><td>å†…å»º minã€maxã€avgã€sumã€countã€firstã€last ç­‰èšåˆåŠŸèƒ½</td></tr><tr><td><strong>è‡ªåŠ¨ä¸‹é‡‡æ · &amp; ç´¯ç§¯è§„åˆ™</strong></td><td>é€šè¿‡ aggregation rules è‡ªåŠ¨ç”Ÿæˆæ›´ç²—ç²’åº¦æŒ‡æ ‡</td></tr><tr><td><strong>ä¿ç•™ç­–ç•¥ï¼ˆRetentionï¼‰</strong></td><td>è®¾ç½®æœ€å¤§ä¿å­˜æ—¶é—´æˆ–æ ·æœ¬æ•°é‡</td></tr><tr><td><strong>æ ‡ç­¾ç´¢å¼•ï¼ˆLabelsï¼‰</strong></td><td>æ”¯æŒåŸºäºæ ‡ç­¾çš„è·¨åºåˆ—æŸ¥è¯¢</td></tr><tr><td><strong>é«˜æ•ˆå­˜å‚¨</strong></td><td>ä½¿ç”¨å‹ç¼©ä¸å†…å­˜ç»“æ„ä¼˜åŒ–ç©ºé—´æˆæœ¬</td></tr><tr><td><strong>å·¥å…·æ•´åˆ</strong></td><td>æ”¯æŒ Grafanaã€Prometheusã€Telegraf ç­‰ç”Ÿæ€é›†æˆ</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åº”ç”¨åœºæ™¯</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>ç‰©è”ç½‘ï¼ˆIoTï¼‰ç›‘æ§</strong></td><td>æ¸©åº¦ã€æ¹¿åº¦ã€è®¾å¤‡çŠ¶æ€ç­‰</td></tr><tr><td><strong>ç³»ç»Ÿç›‘æ§ä¸æŒ‡æ ‡æ”¶é›†</strong></td><td>CPUã€å†…å­˜ã€ç½‘ç»œæŒ‡æ ‡çš„å®æ—¶å­˜å‚¨ä¸åˆ†æ</td></tr><tr><td><strong>ä¸šåŠ¡æŒ‡æ ‡åˆ†æ</strong></td><td>æ¯æ—¥/æ¯å°æ—¶æ´»è·ƒç”¨æˆ·æ•°é‡ã€è¯·æ±‚å»¶è¿Ÿç­‰</td></tr><tr><td><strong>é‡‘èæ—¶é—´åºåˆ—</strong></td><td>è‚¡ç¥¨ä»·æ ¼ã€äº¤æ˜“é‡çš„å¿«é€Ÿå†™å…¥å’Œåˆ†æ</td></tr><tr><td><strong>å®æ—¶å‘Šè­¦</strong></td><td>æ•°æ®è¶Šç•Œæ—¶è§¦å‘å‘Šè­¦é€»è¾‘</td></tr></tbody></table><h2 id="TimeSeries-å‘½ä»¤è¯´æ˜">TimeSeries å‘½ä»¤è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p>æŒ‰â€œç”Ÿå‘½å‘¨æœŸâ€è§†è§’çš„å¿«é€Ÿç´¢å¼•</p></li></ul><table><thead><tr><th>é˜¶æ®µ</th><th>å¯¹åº”å‘½ä»¤</th></tr></thead><tbody><tr><td>åˆ›å»º</td><td>TS.CREATE</td></tr><tr><td>ä¿®æ”¹ç»“æ„</td><td>TS.ALTER</td></tr><tr><td>å»ºç«‹èšåˆ</td><td>TS.CREATERULE / TS.DELETERULE</td></tr><tr><td>å†™å…¥</td><td>TS.ADD / TS.MADD / TS.INCRBY / TS.DECRBY</td></tr><tr><td>æŸ¥è¯¢å•åºåˆ—</td><td>TS.GET / TS.RANGE / TS.REVRANGE</td></tr><tr><td>æŸ¥è¯¢å¤šåºåˆ—</td><td>TS.MGET / TS.MRANGE / TS.MREVRANGE / TS.QUERYINDEX</td></tr><tr><td>æ¸…ç†æ•°æ®</td><td>TS.DEL</td></tr><tr><td>æŸ¥çœ‹çŠ¶æ€</td><td><a href="http://TS.INFO">TS.INFO</a></td></tr></tbody></table><h3 id="ä¸€ã€æ—¶é—´åºåˆ—åˆ›å»ºä¸ç»“æ„ç®¡ç†ç±»">ä¸€ã€æ—¶é—´åºåˆ—åˆ›å»ºä¸ç»“æ„ç®¡ç†ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>TS.CREATE</strong></td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¶é—´åºåˆ—ï¼ˆå¯æŒ‡å®šä¿ç•™ç­–ç•¥ã€æ ‡ç­¾ã€chunk å¤§å°ç­‰ï¼‰</td><td>åˆå§‹åŒ–æŒ‡æ ‡ï¼Œå¦‚åˆ›å»º CPUã€QPSã€å»¶è¿Ÿç­‰æŒ‡æ ‡åºåˆ—</td></tr><tr><td><strong>TS.ALTER</strong></td><td>ä¿®æ”¹å·²æœ‰æ—¶é—´åºåˆ—çš„é…ç½®ï¼ˆretentionã€chunk sizeã€duplicate policyã€labelsï¼‰</td><td>åŠ¨æ€è°ƒæ•´æ•°æ®ä¿ç•™å‘¨æœŸã€æ ‡ç­¾ä¿¡æ¯</td></tr><tr><td><strong>TS.CREATERULE</strong></td><td>åˆ›å»ºå‹ç¼© / èšåˆè§„åˆ™ï¼ˆä» source series è‡ªåŠ¨èšåˆåˆ° dest seriesï¼‰</td><td>åŸå§‹æ•°æ® â†’ æŒ‰åˆ†é’Ÿ / å°æ—¶èšåˆ</td></tr><tr><td><strong>TS.DELETERULE</strong></td><td>åˆ é™¤å·²æœ‰çš„å‹ç¼© / èšåˆè§„åˆ™</td><td>åœæ­¢æŸæ¡è‡ªåŠ¨èšåˆè§„åˆ™</td></tr></tbody></table><h4 id="1ï¸âƒ£-TS-CREATE-åˆ›å»ºæ—¶é—´åºåˆ—">1ï¸âƒ£ TS.CREATE : åˆ›å»ºæ—¶é—´åºåˆ—</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TS.CREATE key</span><br><span class="line">  [RETENTION retentionPeriod]</span><br><span class="line">  [ENCODING &lt;COMPRESSED|UNCOMPRESSED&gt;]</span><br><span class="line">  [CHUNK_SIZE size]</span><br><span class="line">  [DUPLICATE_POLICY policy]</span><br><span class="line">  [IGNORE ignoreMaxTimediff ignoreMaxValDiff]</span><br><span class="line">  [LABELS [label value ...]]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜ï¼š</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th><th>å¯é€‰å€¼ / çº¦æŸ</th><th>é»˜è®¤å€¼</th><th>å…¸å‹ä½¿ç”¨å»ºè®®</th></tr></thead><tbody><tr><td><strong>key</strong></td><td>æ—¶é—´åºåˆ—çš„ Redis Key</td><td>ä»»æ„åˆæ³• Redis key</td><td>æ— </td><td>å»ºè®®åŒ…å«ä¸šåŠ¡è¯­ä¹‰ï¼Œå¦‚ <code>ts:cpu:node1</code></td></tr><tr><td><strong>RETENTION</strong></td><td>æ•°æ®ä¿ç•™æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…è¿‡è‡ªåŠ¨åˆ é™¤</td><td>â‰¥ 0ï¼Œ0 è¡¨ç¤ºæ°¸ä¹…ä¿ç•™</td><td>0</td><td>é«˜é¢‘æŒ‡æ ‡å¿…é¡»è®¾ç½®ï¼Œé¿å…å†…å­˜æ— é™å¢é•¿</td></tr><tr><td><strong>ENCODING</strong></td><td>æ•°æ®å­˜å‚¨ç¼–ç æ–¹å¼</td><td><code>COMPRESSED</code>: å†…å­˜å ç”¨ä½ï¼ŒCPU æœ‰è½»å¾®å¼€é”€<br>  <code>UNCOMPRESSED</code>:æŸ¥è¯¢å¿«ï¼Œå ç”¨å†…å­˜é«˜</td><td><code>COMPRESSED</code></td><td>ç»å¤§å¤šæ•°åœºæ™¯ä¿æŒé»˜è®¤</td></tr><tr><td><strong>CHUNK_SIZE</strong></td><td>æ¯ä¸ªæ•°æ®å—çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œå½±å“å†…å­˜ç¢ç‰‡ä¸å‹ç¼©æ•ˆç‡</td><td>â‰¥ 128 bytesï¼ˆé€šå¸¸ 1KBâ€“64KBï¼‰</td><td>4096</td><td>å†™å…¥é¢‘ç¹æ—¶é€‚å½“è°ƒå¤§</td></tr><tr><td><strong>DUPLICATE_POLICY</strong></td><td>åŒä¸€ timestamp é‡å¤å†™å…¥æ—¶çš„å¤„ç†ç­–ç•¥</td><td>è§ä¸‹è¡¨</td><td>å…¨å±€é…ç½®</td><td>æ˜ç¡®æŒ‡å®šï¼Œé¿å…é»˜è®¤è¡Œä¸ºå˜åŒ–</td></tr><tr><td><strong>IGNORE</strong></td><td>å¿½ç•¥ä¸ä¸Šä¸€ç‚¹å·®å¼‚è¿‡å°çš„æ•°æ®</td><td><code>ignoreMaxTimediff</code>: æœ€å¤§å…è®¸æ—¶é—´å·®ï¼ˆæ¯«ç§’ï¼‰<br> <code>ignoreMaxValDiff</code>: æœ€å¤§å…è®¸çš„æ•°å€¼å·®</td><td>å…³é—­</td><td>ç”¨äºé™å™ªå’Œé™é‡‡æ · <br>ç¤ºä¾‹ï¼š<code>IGNORE 1000 0.01</code>ï¼š 1 ç§’å†…ï¼Œå˜åŒ–å°äº 0.01 çš„æ•°æ®å°†è¢«å¿½ç•¥</td></tr><tr><td><strong>LABELS</strong></td><td>æ ‡ç­¾é”®å€¼å¯¹ï¼Œç”¨äºç´¢å¼•å’Œè¿‡æ»¤</td><td>ä»»æ„å­—ç¬¦ä¸²å¯¹<br><code>LABELS key1 value1 key2 value2 ... </code></td><td>æ— </td><td>å¼ºçƒˆå»ºè®®ç”¨äºæŸ¥è¯¢</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>DUPLICATE_POLICYï¼ˆé‡å¤æ—¶é—´æˆ³ç­–ç•¥ï¼‰</p></li></ul><blockquote><p>å½“åŒä¸€ä¸ª timestamp è¢«å¤šæ¬¡å†™å…¥æ—¶ç”Ÿæ•ˆ</p></blockquote><table><thead><tr><th>ç­–ç•¥</th><th>å¤„ç†é€»è¾‘</th></tr></thead><tbody><tr><td><strong>BLOCK</strong></td><td>é»˜è®¤ï¼Œé‡å¤æ—¶é—´æˆ³ç›´æ¥å¤±è´¥</td></tr><tr><td><strong>FIRST</strong></td><td>ä¿ç•™å·²æœ‰å€¼ï¼Œå¿½ç•¥æ–°å€¼</td></tr><tr><td><strong>LAST</strong></td><td>è¦†ç›–å·²æœ‰å€¼ï¼Œç”¨æ–°å€¼æ›¿ä»£</td></tr><tr><td><strong>MIN</strong></td><td>ä»…å½“æ–°å€¼æ›´å°æ‰è¦†ç›–</td></tr><tr><td><strong>MAX</strong></td><td>ä»…å½“æ–°å€¼æ›´å¤§æ‰è¦†ç›–</td></tr><tr><td><strong>SUM</strong></td><td>ç´¯åŠ å€¼ï¼ˆå·²æœ‰å€¼ + æ–°å€¼ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹: åˆ›å»ºä¸€ä¸ª CPU æŒ‡æ ‡æ—¶é—´åºåˆ—ï¼Œè‡ªåŠ¨è¿‡æœŸ 1 å°æ—¶ä¹‹å‰çš„æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">TS.CREATE ts:cpu:server1</span><br><span class="line">  RETENTION 3600000</span><br><span class="line">  ENCODING COMPRESSED</span><br><span class="line">  CHUNK_SIZE 8192</span><br><span class="line">  DUPLICATE_POLICY LAST</span><br><span class="line">  IGNORE 1000 0.1</span><br><span class="line">  LABELS host server1 metric cpu</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ•°æ®ç±»å‹</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> ts:cpu:server1</span><br><span class="line">TSDB-TYPE</span><br></pre></td></tr></table></figure><h4 id="2ï¸âƒ£-TS-ALTER-ä¿®æ”¹æ—¶é—´åºåˆ—é…ç½®">2ï¸âƒ£ TS.ALTER : ä¿®æ”¹æ—¶é—´åºåˆ—é…ç½®</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TS.ALTER key</span><br><span class="line">  [RETENTION retentionPeriod]</span><br><span class="line">  [CHUNK_SIZE size]</span><br><span class="line">  [DUPLICATE_POLICY policy]</span><br><span class="line">  [LABELS [label value ...]]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ï¼šä¿®æ”¹ä¿ç•™å‘¨æœŸå’Œæ ‡ç­¾</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TS.ALTER ts:cpu:server1</span><br><span class="line">  RETENTION 7200000</span><br><span class="line">  LABELS host server1 metric cpu <span class="built_in">env</span> prod</span><br></pre></td></tr></table></figure><h4 id="3ï¸âƒ£-TS-CREATERULE-åˆ›å»ºè‡ªåŠ¨èšåˆè§„åˆ™">3ï¸âƒ£ TS.CREATERULE : åˆ›å»ºè‡ªåŠ¨èšåˆè§„åˆ™</h4><ul class="lvl-0"><li class="lvl-2"><p>åœºæ™¯è¯´æ˜</p><ul class="lvl-2"><li class="lvl-6">åŸå§‹åºåˆ—ï¼šts:cpu:server1ï¼ˆç§’çº§æ•°æ®ï¼‰</li><li class="lvl-6">èšåˆç›®æ ‡ï¼šts:cpu:server1:avg1mï¼ˆæŒ‰ 1 åˆ†é’Ÿå¹³å‡å€¼èšåˆï¼‰</li></ul></li><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TS.CREATERULE sourceKey destKey</span><br><span class="line">  AGGREGATION aggregator bucketDuration</span><br><span class="line">  [alignTimestamp]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th><th>å¯é€‰å€¼ / çº¦æŸ</th><th>æ˜¯å¦å¿…å¡«</th><th>è¡Œä¸ºè¯´æ˜</th><th>ä½¿ç”¨æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td><strong>sourceKey</strong></td><td>æºæ—¶é—´åºåˆ— Key</td><td>å¿…é¡»æ˜¯å·²å­˜åœ¨çš„ TS key</td><td>æ˜¯</td><td>æ–°å†™å…¥æ•°æ®ä»è¯¥åºåˆ—è§¦å‘èšåˆ</td><td>å¿…é¡»å…ˆåˆ›å»º</td></tr><tr><td><strong>destKey</strong></td><td>ç›®æ ‡èšåˆæ—¶é—´åºåˆ— Key</td><td>å¿…é¡»æ˜¯å·²å­˜åœ¨çš„ TS key</td><td>æ˜¯</td><td>èšåˆç»“æœå†™å…¥è¯¥åºåˆ—</td><td>é€šå¸¸ retention æ›´é•¿</td></tr><tr><td><strong>aggregator</strong></td><td>èšåˆå‡½æ•°</td><td>è§ä¸‹è¡¨</td><td>æ˜¯</td><td>å®šä¹‰æ¯ä¸ª bucket å†…å¦‚ä½•è®¡ç®—</td><td>ä¸åŒå‡½æ•°è®¡ç®—æˆæœ¬ä¸åŒ</td></tr><tr><td><strong>bucketDuration</strong></td><td>èšåˆæ—¶é—´æ¡¶å®½åº¦ï¼ˆæ¯«ç§’ï¼‰</td><td>&gt; 0</td><td>æ˜¯</td><td>æ§åˆ¶èšåˆç²’åº¦</td><td>å†³å®šæ•°æ®é™é‡‡æ ·ç¨‹åº¦</td></tr><tr><td><strong>alignTimestamp</strong></td><td>å¯¹é½æ—¶é—´æˆ³åŸºå‡†</td><td>æ¯«ç§’æ—¶é—´æˆ³</td><td>å¦</td><td>æ§åˆ¶ bucket èµ·å§‹å¯¹é½æ–¹å¼</td><td>è·¨ç³»ç»Ÿå¯¹é½æ—¶éå¸¸é‡è¦</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>aggregatorï¼ˆèšåˆå‡½æ•°ï¼‰</p></li></ul><table><thead><tr><th>èšåˆå™¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>AVG</strong></td><td>å¹³å‡å€¼</td></tr><tr><td><strong>SUM</strong></td><td>æ±‚å’Œ</td></tr><tr><td><strong>MIN</strong></td><td>æœ€å°å€¼</td></tr><tr><td><strong>MAX</strong></td><td>æœ€å¤§å€¼</td></tr><tr><td><strong>COUNT</strong></td><td>æ ·æœ¬æ•°é‡</td></tr><tr><td><strong>FIRST</strong></td><td>ç¬¬ä¸€ä¸ªæ ·æœ¬</td></tr><tr><td><strong>LAST</strong></td><td>æœ€åä¸€ä¸ªæ ·æœ¬</td></tr><tr><td><strong>RANGE</strong></td><td>MAX - MIN</td></tr><tr><td><strong>STD.P</strong></td><td>æ€»ä½“æ ‡å‡†å·®</td></tr><tr><td><strong>STD.S</strong></td><td>æ ·æœ¬æ ‡å‡†å·®</td></tr><tr><td><strong>VAR.P</strong></td><td>æ€»ä½“æ–¹å·®</td></tr><tr><td><strong>VAR.S</strong></td><td>æ ·æœ¬æ–¹å·®</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>alignTimestampï¼ˆå¯¹é½æ—¶é—´æˆ³åŸºå‡†ï¼‰</p></li></ul><table><thead><tr><th>ç±»å‹</th><th>ç¤ºä¾‹å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><strong>0ï¼ˆUnix Epochï¼‰</strong>ï¼ˆæ¨èåšæ³•ï¼‰</td><td><code>0</code></td><td>ä» 1970-01-01 00:00:00 UTC å¯¹é½</td></tr><tr><td><strong>ä»»æ„å›ºå®šæ—¶é—´æˆ³</strong></td><td><code>1700000000000</code></td><td>ä»æŒ‡å®šæ—¶é—´ç‚¹å¯¹é½</td></tr><tr><td><strong>å½“å‰æ—¶é—´æˆ³</strong></td><td><code>$(date +%s%3N)</code></td><td>ä»åˆ›å»ºè§„åˆ™æ—¶åˆ»å¯¹é½</td></tr><tr><td><strong>ä¸šåŠ¡æ—¶é—´è¾¹ç•Œ</strong></td><td>æŸå¤© 00:00 çš„æ¯«ç§’å€¼</td><td>å¯¹é½åˆ°ä¸šåŠ¡å‘¨æœŸ</td></tr><tr><td><strong>ä¸æŒ‡å®š</strong></td><td>ï¼ˆå‚æ•°çœç•¥ï¼‰</td><td>è‡ªåŠ¨ä½¿ç”¨é¦–æ¡å†™å…¥æ—¶é—´</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹: æ¯ 60,000msï¼ˆ1åˆ†é’Ÿï¼‰åšä¸€æ¬¡å¹³å‡èšåˆ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åˆ›å»ºç›®æ ‡èšåˆåºåˆ—</span></span><br><span class="line">TS.CREATE ts:cpu:server1:avg1m</span><br><span class="line">  RETENTION 86400000</span><br><span class="line">  LABELS host server1 metric cpu_1m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.åˆ›å»ºè‡ªåŠ¨èšåˆè§„åˆ™</span></span><br><span class="line">TS.CREATERULE ts:cpu:server1 ts:cpu:server1:avg1m</span><br><span class="line">  AGGREGATION AVG 60000</span><br><span class="line"><span class="comment">## å¦‚æœæœªè®¾ç½® alignTimestampï¼Œåˆ™ä»¥åˆ›å»ºçš„ç¬¬ä¸€æ¡è®°å½•çš„æ—¶é—´ä¸ºåŸºå‡†</span></span><br><span class="line"><span class="comment">## æ¯”å¦‚ç¬¬ä¸€æ¡è®°å½•çš„æ—¶é—´ä¸ºï¼š12:00:23</span></span><br><span class="line"><span class="comment">## bucket ä¼šå¯¹é½åˆ°:</span></span><br><span class="line">    <span class="comment"># 12:00:23 ~ 12:01:23</span></span><br><span class="line">    <span class="comment"># 12:01:23 ~ 12:02:23</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®š alignTimestamp å¯¹é½åˆ°æ•´åˆ†é’Ÿ</span></span><br><span class="line">TS.CREATERULE ts:cpu:server1 ts:cpu:server1:avg1m</span><br><span class="line">  AGGREGATION AVG 60000 0</span><br><span class="line"><span class="comment">## bucket ä¼šä¸¥æ ¼å¯¹é½:</span></span><br><span class="line">    <span class="comment"># 12:00:00 ~ 12:01:00</span></span><br><span class="line">    <span class="comment"># 12:01:00 ~ 12:02:00</span></span><br></pre></td></tr></table></figure><h4 id="4ï¸âƒ£-TS-DELETERULE-åˆ é™¤è‡ªåŠ¨èšåˆè§„åˆ™">4ï¸âƒ£ TS.DELETERULE : åˆ é™¤è‡ªåŠ¨èšåˆè§„åˆ™</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TS.DELETERULE sourceKey destKey</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ï¼šåˆ é™¤è‡ªåŠ¨èšåˆè§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TS.DELETERULE ts:cpu:server1 ts:cpu:server1:avg1m</span><br></pre></td></tr></table></figure><h3 id="äºŒã€æ•°æ®å†™å…¥ä¸æ›´æ–°ç±»">äºŒã€æ•°æ®å†™å…¥ä¸æ›´æ–°ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>TS.ADD</strong></td><td>å‘æ—¶é—´åºåˆ—è¿½åŠ ä¸€ä¸ªæ ·æœ¬ç‚¹ï¼ˆtimestamp, valueï¼‰</td><td>å®æ—¶å†™å…¥ç›‘æ§æ•°æ®</td></tr><tr><td><strong>TS.MADD</strong></td><td>æ‰¹é‡å‘å¤šä¸ªæ—¶é—´åºåˆ—è¿½åŠ æ ·æœ¬</td><td>é«˜åååœºæ™¯ï¼Œå‡å°‘ç½‘ç»œ RTT</td></tr><tr><td><strong>TS.INCRBY</strong></td><td>å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå¢ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰</td><td>è®¡æ•°å™¨ã€ç´¯è®¡æŒ‡æ ‡</td></tr><tr><td><strong>TS.DECRBY</strong></td><td>å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå‡ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰</td><td>åº“å­˜ã€ä½™é¢ç±»é€’å‡æŒ‡æ ‡</td></tr></tbody></table><h4 id="1ï¸âƒ£-TS-ADD-å‘æ—¶é—´åºåˆ—è¿½åŠ ä¸€ä¸ªæ ·æœ¬ç‚¹">1ï¸âƒ£ TS.ADD : å‘æ—¶é—´åºåˆ—è¿½åŠ ä¸€ä¸ªæ ·æœ¬ç‚¹</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TS.ADD key timestamp value</span><br><span class="line">  [RETENTION retentionPeriod]</span><br><span class="line">  [ENCODING &lt;COMPRESSED|UNCOMPRESSED&gt;]</span><br><span class="line">  [CHUNK_SIZE size]</span><br><span class="line">  [DUPLICATE_POLICY policy]</span><br><span class="line">  [ON_DUPLICATE policy_ovr]</span><br><span class="line">  [IGNORE ignoreMaxTimediff ignoreMaxValDiff]</span><br><span class="line">  [LABELS [label value ...]]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœ key ä¸å­˜åœ¨ï¼ŒTS.ADD ä¼š éšå¼åˆ›å»ºæ—¶é—´åºåˆ—ï¼ˆç±»ä¼¼ TS.CREATEï¼‰ã€‚</p></li><li class="lvl-2"><p>å‚æ•°è¯´æ˜</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th><th>å¯é€‰å€¼ / çº¦æŸ</th><th>æ˜¯å¦è¦†ç›–å·²æœ‰é…ç½®</th><th>ç”Ÿæ•ˆèŒƒå›´</th><th>ä½¿ç”¨æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td><strong>key</strong></td><td>æ—¶é—´åºåˆ— Key</td><td>åˆæ³• Redis key</td><td>â€”</td><td>â€”</td><td>ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º</td></tr><tr><td><strong>timestamp</strong></td><td>æ ·æœ¬æ—¶é—´æˆ³</td><td>æ¯«ç§’æ•´æ•° / <code>*</code></td><td>â€”</td><td>å½“å‰å†™å…¥</td><td><code>*</code> è¡¨ç¤ºæœåŠ¡å™¨å½“å‰æ—¶é—´</td></tr><tr><td><strong>value</strong></td><td>æ ·æœ¬å€¼</td><td>æµ®ç‚¹æ•°</td><td>â€”</td><td>å½“å‰å†™å…¥</td><td>NaN / Inf ä¸å…è®¸</td></tr><tr><td><strong>RETENTION</strong></td><td>è®¾ç½®ä¿ç•™å‘¨æœŸ</td><td>â‰¥ 0ï¼ˆæ¯«ç§’ï¼‰</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>å·²å­˜åœ¨ key ä¸ä¼šè¢«ä¿®æ”¹</td></tr><tr><td><strong>ENCODING</strong></td><td>å­˜å‚¨ç¼–ç </td><td>COMPRESSED / UNCOMPRESSED</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>ç”Ÿäº§æ¨è COMPRESSED</td></tr><tr><td><strong>CHUNK_SIZE</strong></td><td>æ•°æ®å—å¤§å°</td><td>â‰¥ 128 bytes</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>ä¸å½±å“å·²æœ‰ chunk</td></tr><tr><td><strong>DUPLICATE_POLICY</strong></td><td>è®¾ç½®é»˜è®¤é‡å¤ç­–ç•¥</td><td>BLOCK / FIRST / LAST / MIN / MAX / SUM</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>ä¸ ON_DUPLICATE æœ‰ä¼˜å…ˆçº§å…³ç³»</td></tr><tr><td><strong>ON_DUPLICATE</strong></td><td>æœ¬æ¬¡å†™å…¥çš„é‡å¤ç­–ç•¥</td><td>åŒä¸Š</td><td>è¦†ç›–åºåˆ—çº§ç­–ç•¥</td><td>å½“å‰å†™å…¥</td><td>æ¨èç”¨äºä¸´æ—¶è¦†ç›–</td></tr><tr><td><strong>IGNORE</strong></td><td>å¿½ç•¥å¾®å°å˜åŒ–å†™å…¥</td><td>ä¸¤ä¸ªé˜ˆå€¼</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>ç”¨äºé™å™ª</td></tr><tr><td><strong>LABELS</strong></td><td>è®¾ç½®æ ‡ç­¾</td><td>é”®å€¼å¯¹</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>å·²å­˜åœ¨ key ä¸ä¼šä¿®æ”¹</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ï¼šå†™å…¥ä¸€ä¸ªæ—¶é—´åºåˆ—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TS.ADD ts:cpu:server1 * 80.5</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">(<span class="built_in">integer</span>) 1767777655255 <span class="comment"># å½“å‰æ—¶é—´æˆ³</span></span><br></pre></td></tr></table></figure><h4 id="2ï¸âƒ£-TS-MADD-æ‰¹é‡å‘å¤šä¸ªæ—¶é—´åºåˆ—è¿½åŠ æ ·æœ¬">2ï¸âƒ£ TS.MADD : æ‰¹é‡å‘å¤šä¸ªæ—¶é—´åºåˆ—è¿½åŠ æ ·æœ¬</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TS.MADD key timestamp value [key timestamp value ...]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæ‰¹é‡å†™å…¥å¤šä¸ªæ—¶é—´åºåˆ—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰¹é‡å†™å…¥ä¸‰ä¸ªæ—¶é—´åºåˆ—ï¼Œæ—¶é—´åºåˆ—å¿…é¡»å­˜åœ¨</span></span><br><span class="line">TS.MADD ts:cpu:server1 * 80.5 ts:cpu:server2 * 90.5 ts:cpu:server3 * 70.5</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 1767777807933</span><br><span class="line">2) (<span class="built_in">integer</span>) 1767777807933</span><br><span class="line">3) (<span class="built_in">integer</span>) 1767777807933</span><br></pre></td></tr></table></figure><h4 id="3ï¸âƒ£-TS-INCRBY-å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå¢ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰">3ï¸âƒ£ TS.INCRBY : å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå¢ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TS.INCRBY key addend</span><br><span class="line">  [TIMESTAMP timestamp]</span><br><span class="line">  [RETENTION retentionPeriod]</span><br><span class="line">  [ENCODING &lt;COMPRESSED|UNCOMPRESSED&gt;]</span><br><span class="line">  [CHUNK_SIZE size]</span><br><span class="line">  [DUPLICATE_POLICY policy]</span><br><span class="line">  [IGNORE ignoreMaxTimediff ignoreMaxValDiff]</span><br><span class="line">  [LABELS [label value ...]]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th><th>å¯é€‰å€¼ / çº¦æŸ</th><th>æ˜¯å¦è¦†ç›–å·²æœ‰é…ç½®</th><th>ç”Ÿæ•ˆèŒƒå›´</th><th>ä½¿ç”¨æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td><strong>key</strong></td><td>æ—¶é—´åºåˆ— Key</td><td>åˆæ³• Redis key</td><td>â€”</td><td>â€”</td><td>ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</td></tr><tr><td><strong>addend</strong></td><td>å¢é‡å€¼</td><td>æµ®ç‚¹æ•°</td><td>â€”</td><td>å½“å‰å†™å…¥</td><td>æ”¯æŒè´Ÿæ•°ï¼ˆç­‰ä»· DECRï¼‰</td></tr><tr><td><strong>TIMESTAMP</strong></td><td>æŒ‡å®šå†™å…¥æ—¶é—´æˆ³</td><td>æ¯«ç§’æ•´æ•°</td><td>â€”</td><td>å½“å‰å†™å…¥</td><td>é»˜è®¤ä½¿ç”¨æœåŠ¡å™¨æ—¶é—´</td></tr><tr><td><strong>RETENTION</strong></td><td>è®¾ç½®ä¿ç•™å‘¨æœŸ</td><td>â‰¥ 0ï¼ˆæ¯«ç§’ï¼‰</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>å·²å­˜åœ¨ key ä¸ç”Ÿæ•ˆ</td></tr><tr><td><strong>ENCODING</strong></td><td>å­˜å‚¨ç¼–ç </td><td>COMPRESSED / UNCOMPRESSED</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>æ¨è COMPRESSED</td></tr><tr><td><strong>CHUNK_SIZE</strong></td><td>æ•°æ®å—å¤§å°</td><td>â‰¥ 128 bytes</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>é«˜é¢‘å†™å…¥å¯è°ƒå¤§</td></tr><tr><td><strong>DUPLICATE_POLICY</strong></td><td>é»˜è®¤é‡å¤æ—¶é—´æˆ³ç­–ç•¥</td><td>BLOCK / FIRST / LAST / MIN / MAX / SUM</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>å¯¹è®¡æ•°å™¨é€šå¸¸è®¾ SUM</td></tr><tr><td><strong>IGNORE</strong></td><td>å¿½ç•¥å¾®å°å˜åŒ–</td><td>ä¸¤ä¸ªé˜ˆå€¼</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>è®¡æ•°å™¨ä¸€èˆ¬ä¸ä½¿ç”¨</td></tr><tr><td><strong>LABELS</strong></td><td>æ ‡ç­¾</td><td>é”®å€¼å¯¹</td><td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td><td>åºåˆ—çº§</td><td>ç”¨äº MGET / MRANGE</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœ key ä¸å­˜åœ¨ï¼ŒTS.INCRBY ä¼š éšå¼åˆ›å»ºæ—¶é—´åºåˆ—ã€‚</p></li><li class="lvl-2"><p>å¦‚æœæ²¡æœ‰æŒ‡å®š TIMESTAMPï¼Œåˆ™è‡ªåŠ¨ä½¿ç”¨æœåŠ¡å™¨å½“å‰æ—¶é—´ã€‚</p></li><li class="lvl-2"><p>å†™å…¥é€»è¾‘ç­‰ä»·äºï¼šè¯»å–æœ€æ–°å€¼ + addend â†’ å†™å›ä¸€ä¸ªæ–°æ ·æœ¬ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå¢</span></span><br><span class="line">TS.INCRBY ts:cpu:server1 10</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">(<span class="built_in">integer</span>) 1767778308125</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæ—¶é—´æˆ³ï¼ŒTIMESTAMP å¿…é¡»å¤§äºæˆ–ç­‰äºå½“å‰æ—¶é—´åºåˆ—ä¸­æœ€å¤§çš„æ—¶é—´æˆ³</span></span><br><span class="line">TS.INCRBY ts:cpu:server1 5 TIMESTAMP 1767778308126</span><br></pre></td></tr></table></figure><h4 id="4ï¸âƒ£-TS-DECRBY-å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå‡ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰">4ï¸âƒ£ TS.DECRBY : å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå‡ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰</h4><ul class="lvl-0"><li class="lvl-2"><p>ä¸ <code>TS.INCRBY</code> ç›¸ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚</p></li><li class="lvl-2"><p>å®é™…ä¸Š <code>TS.INCRBY</code> ä¸­è®¾ç½® <code>addend</code> ä¸ºè´Ÿæ•° å°±æ˜¯ <code>TS.DECR</code></p></li></ul><h3 id="ä¸‰ã€æ•°æ®æŸ¥è¯¢ï¼ˆå•åºåˆ—ï¼‰ç±»">ä¸‰ã€æ•°æ®æŸ¥è¯¢ï¼ˆå•åºåˆ—ï¼‰ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>TS.GET</strong></td><td>è·å–æŸä¸ªæ—¶é—´åºåˆ—æœ€æ–°ï¼ˆæœ€å¤§ timestampï¼‰çš„æ ·æœ¬</td><td>è·å–å½“å‰æœ€æ–°æŒ‡æ ‡å€¼</td></tr><tr><td><strong>TS.RANGE</strong></td><td>æŒ‰æ—¶é—´æ­£åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</td><td>ç»˜å›¾ã€è¶‹åŠ¿åˆ†æ</td></tr><tr><td><strong>TS.REVRANGE</strong></td><td>æŒ‰æ—¶é—´é€†åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</td><td>è·å–æœ€è¿‘ N æ¡æ•°æ®</td></tr></tbody></table><h4 id="1ï¸âƒ£-TS-GET-è·å–æŸä¸ªæ—¶é—´åºåˆ—æœ€æ–°ï¼ˆæœ€å¤§-timestampï¼‰çš„æ ·æœ¬">1ï¸âƒ£ TS.GET : è·å–æŸä¸ªæ—¶é—´åºåˆ—æœ€æ–°ï¼ˆæœ€å¤§ timestampï¼‰çš„æ ·æœ¬</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TS.GET key [LATEST]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜ï¼š</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>key</strong></td><td>æ—¶é—´åºåˆ— Key</td></tr><tr><td><strong>LATEST</strong></td><td>è·å–æœ€æ–°æ ·æœ¬</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>LATEST è¯´æ˜</p><ul class="lvl-2"><li class="lvl-6">å½“ä¸€ä¸ªæ—¶é—´åºåˆ—æ˜¯ç»è¿‡èšåˆï¼ˆcompactionï¼‰å¤„ç†çš„æ—¶ï¼ŒLATEST å‚æ•°ä¼šç”Ÿæ•ˆã€‚ä½¿ç”¨ LATEST æ—¶ï¼ŒTS.GET ä¼šè¿”å›æœ€æ–°ï¼ˆå¯èƒ½æ˜¯éƒ¨åˆ†çš„ï¼‰æ¡¶çš„èšåˆå€¼ã€‚ä¸ä½¿ç”¨ LATEST æ—¶ï¼ŒTS.GET ä¸ä¼šè¿”å›æœ€æ–°ï¼ˆå¯èƒ½æ˜¯éƒ¨åˆ†çš„ï¼‰æ¡¶çš„å€¼ã€‚å½“æ—¶é—´åºåˆ—ä¸æ˜¯èšåˆçš„æ—¶ï¼ŒLATEST ä¼šè¢«å¿½ç•¥ã€‚</li><li class="lvl-6">æœ€æ–°æ¡¶ä¸­çš„æ•°æ®å¯èƒ½æ˜¯ä¸å®Œæ•´çš„ã€‚åªæœ‰å½“æœ‰æ–°çš„æ ·æœ¬åˆ°æ¥å¹¶å¼€å¯ä¸€ä¸ªæ–°çš„æœ€æ–°æ¡¶æ—¶ï¼ŒåŸæ¡¶æ‰ä¼šè¢«å…³é—­å¹¶è¿›è¡Œèšåˆã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿéœ€è¦è·å–æœ€æ–°ï¼ˆå¯èƒ½æ˜¯éƒ¨åˆ†çš„ï¼‰æ¡¶çš„èšåˆå€¼ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ LATESTã€‚</li></ul></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TS.GET ts:cpu:server1 LATEST</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 1767778308126</span><br><span class="line">2) 115.5</span><br></pre></td></tr></table></figure><h4 id="2ï¸âƒ£-TS-RANGE-æŒ‰æ—¶é—´æ­£åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®">2ï¸âƒ£ TS.RANGE : æŒ‰æ—¶é—´æ­£åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TS.RANGE key fromTimestamp toTimestamp</span><br><span class="line">  [LATEST]</span><br><span class="line">  [FILTER_BY_TS ts...]</span><br><span class="line">  [FILTER_BY_VALUE min max]</span><br><span class="line">  [COUNT count]</span><br><span class="line">  [[ALIGN align] AGGREGATION aggregator bucketDuration [BUCKETTIMESTAMP bt] [EMPTY]]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜ï¼š</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>è¯´æ˜</th><th>å¯é€‰å€¼ / è¯´æ˜</th></tr></thead><tbody><tr><td><code>key</code></td><td>string</td><td>æ—¶é—´åºåˆ—çš„é”®å</td><td>å¿…é€‰</td></tr><tr><td><code>fromTimestamp</code></td><td>integer</td><td>æŸ¥è¯¢èµ·å§‹æ—¶é—´æˆ³ï¼Œ<code>-</code>: æœ€å°å€¼</td><td>å¿…é€‰</td></tr><tr><td><code>toTimestamp</code></td><td>integer</td><td>æŸ¥è¯¢ç»“æŸæ—¶é—´æˆ³ ï¼Œ<code>+</code>: æœ€å¤§å€¼</td><td>å¿…é€‰</td></tr><tr><td><code>LATEST</code></td><td>flag</td><td>å½“æ—¶é—´åºåˆ—æ˜¯ compaction æ—¶ï¼Œè¿”å›æœ€æ–°ï¼ˆå¯èƒ½éƒ¨åˆ†ï¼‰çš„æ¡¶çš„èšåˆå€¼</td><td>å¯é€‰</td></tr><tr><td><code>FILTER_BY_TS ts...</code></td><td>list of integers</td><td>åªè¿”å›æŒ‡å®šæ—¶é—´æˆ³çš„æ ·æœ¬</td><td>å¯é€‰</td></tr><tr><td><code>FILTER_BY_VALUE min max</code></td><td>range</td><td>åªè¿”å›å€¼åœ¨ <code>[min, max]</code> åŒºé—´çš„æ ·æœ¬</td><td>å¯é€‰</td></tr><tr><td><code>COUNT count</code></td><td>integer</td><td>é™åˆ¶è¿”å›çš„æ ·æœ¬æ•°é‡ï¼ˆæœ€å¤š <code>count</code> ä¸ªï¼‰</td><td>å¯é€‰</td></tr><tr><td><code>ALIGN align</code></td><td>string</td><td>å¯¹é½èšåˆæ¡¶çš„æ—¶é—´æˆ³ï¼ˆå¦‚ <code>start</code>ã€<code>end</code>ã€è‡ªå®šä¹‰æ—¶é—´æˆ³ï¼‰</td><td>å¯é€‰ï¼Œéœ€ä¸ <code>AGGREGATION</code> ä¸€èµ·ä½¿ç”¨</td></tr><tr><td><code>AGGREGATION aggregator bucketDuration</code></td><td>aggregation</td><td>å¯¹æ•°æ®è¿›è¡Œèšåˆè®¡ç®—ï¼Œ<code>aggregator</code> ä¸ºèšåˆå‡½æ•°ï¼ˆå¦‚ <code>avg</code>, <code>sum</code>, <code>min</code>, <code>max</code> ç­‰ï¼‰ï¼Œ<code>bucketDuration</code> ä¸ºæ¡¶çš„æ—¶é•¿</td><td>å¯é€‰</td></tr><tr><td><code>BUCKETTIMESTAMP bt</code></td><td>string</td><td>èšåˆæ¡¶æ—¶é—´æˆ³é€‰æ‹©ï¼Œ<code>bt</code> å¯ä¸º <code>start</code> æˆ– <code>end</code></td><td>å¯é€‰</td></tr><tr><td><code>EMPTY</code></td><td>flag</td><td>å³ä½¿æ¡¶ä¸ºç©ºä¹Ÿè¿”å›ç»“æœ</td><td>å¯é€‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢æ—¶é—´åºåˆ— ts:cpu:server1 çš„åŒºé—´æ•°æ®</span></span><br><span class="line">TS.RANGE ts:cpu:server1 0 1767778308126</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) 1) (<span class="built_in">integer</span>) 1767777655255</span><br><span class="line">   2) 80.5</span><br><span class="line">2) 1) (<span class="built_in">integer</span>) 1767777807933</span><br><span class="line">   2) 70.5</span><br><span class="line">3) 1) (<span class="built_in">integer</span>) 1767777873866</span><br><span class="line">   2) 80.5</span><br><span class="line">4) 1) (<span class="built_in">integer</span>) 1767777965870</span><br><span class="line">   2) 80.5</span><br><span class="line">5) 1) (<span class="built_in">integer</span>) 1767778300909</span><br><span class="line">   2) 90.5</span><br><span class="line">6) 1) (<span class="built_in">integer</span>) 1767778308125</span><br><span class="line">   2) 105.5</span><br><span class="line">7) 1) (<span class="built_in">integer</span>) 1767778308126</span><br><span class="line">   2) 115.5</span><br><span class="line"><span class="comment"># æŸ¥è¯¢æ—¶é—´åºåˆ— ts:cpu:server1 çš„åŒºé—´æ•°æ®ï¼Œå¹¶è¿”å›èšåˆç»“æœï¼Œæ±‚1000mså†…å¹³å‡å€¼</span></span><br><span class="line">TS.RANGE ts:cpu:server1 - + AGGREGATION avg 1000</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) 1) (<span class="built_in">integer</span>) 1767777655000</span><br><span class="line">   2) 80.5</span><br><span class="line">2) 1) (<span class="built_in">integer</span>) 1767777807000</span><br><span class="line">   2) 70.5</span><br><span class="line">3) 1) (<span class="built_in">integer</span>) 1767777873000</span><br><span class="line">   2) 80.5</span><br><span class="line">4) 1) (<span class="built_in">integer</span>) 1767777965000</span><br><span class="line">   2) 80.5</span><br><span class="line">5) 1) (<span class="built_in">integer</span>) 1767778300000</span><br><span class="line">   2) 90.5</span><br><span class="line">6) 1) (<span class="built_in">integer</span>) 1767778308000</span><br><span class="line">   2) 110.5</span><br></pre></td></tr></table></figure><h4 id="3ï¸âƒ£-TS-REVRANGE-æŒ‰æ—¶é—´é€†åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®">3ï¸âƒ£ TS.REVRANGE : æŒ‰æ—¶é—´é€†åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</h4><ul class="lvl-0"><li class="lvl-2"><p>ä¸ TS.RANGE ç±»ä¼¼ï¼Œåªæ˜¯è¿”å›ç»“æœæ˜¯å€’åºçš„</p></li><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TS.REVRANGE ts:cpu:server1 0 1767778308126</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) 1) (<span class="built_in">integer</span>) 1767778308126</span><br><span class="line">   2) 115.5</span><br><span class="line">2) 1) (<span class="built_in">integer</span>) 1767778308125</span><br><span class="line">   2) 105.5</span><br><span class="line">3) 1) (<span class="built_in">integer</span>) 1767778300909</span><br><span class="line">   2) 90.5</span><br><span class="line">4) 1) (<span class="built_in">integer</span>) 1767777965870</span><br><span class="line">   2) 80.5</span><br><span class="line">5) 1) (<span class="built_in">integer</span>) 1767777873866</span><br><span class="line">   2) 80.5</span><br><span class="line">6) 1) (<span class="built_in">integer</span>) 1767777807933</span><br><span class="line">   2) 70.5</span><br><span class="line">7) 1) (<span class="built_in">integer</span>) 1767777655255</span><br><span class="line">   2) 80.5</span><br></pre></td></tr></table></figure><h3 id="å››ã€æ•°æ®æŸ¥è¯¢ï¼ˆå¤šåºåˆ—-èšåˆï¼‰ç±»">å››ã€æ•°æ®æŸ¥è¯¢ï¼ˆå¤šåºåˆ— / èšåˆï¼‰ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>TS.MGET</strong></td><td>æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè·å–å¤šä¸ªæ—¶é—´åºåˆ—çš„æœ€æ–°å€¼</td><td>æ‰¹é‡è·å–å¤šä¸ªå®ä¾‹çš„å½“å‰æŒ‡æ ‡</td></tr><tr><td><strong>TS.MRANGE</strong></td><td>æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œæ­£åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</td><td>å¤šç»´æŒ‡æ ‡åˆ†æã€èšåˆ</td></tr><tr><td><strong>TS.MREVRANGE</strong></td><td>æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œé€†åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</td><td>æœ€è¿‘æ•°æ®èšåˆåˆ†æ</td></tr><tr><td><strong>TS.QUERYINDEX</strong></td><td>æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè¿”å›åŒ¹é…çš„æ—¶é—´åºåˆ— key åˆ—è¡¨</td><td>å‘ç°æœ‰å“ªäº›æŒ‡æ ‡ç¬¦åˆæ¡ä»¶</td></tr></tbody></table><h4 id="1ï¸âƒ£-TS-MGET-æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè·å–å¤šä¸ªæ—¶é—´åºåˆ—çš„æœ€æ–°å€¼">1ï¸âƒ£ TS.MGET : æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè·å–å¤šä¸ªæ—¶é—´åºåˆ—çš„æœ€æ–°å€¼</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TS.MGET [LATEST] [WITHLABELS | &lt;SELECTED_LABELS label...&gt;] FILTER filterExpr...</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜ï¼š</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>è¯´æ˜</th><th>å¯é€‰å€¼ / è¯´æ˜</th></tr></thead><tbody><tr><td><code>LATEST</code></td><td>flag</td><td>å¯¹ compaction ç±»å‹çš„æ—¶é—´åºåˆ—ï¼Œè¿”å›æœ€æ–°ï¼ˆå¯èƒ½éƒ¨åˆ†ï¼‰çš„æ ·æœ¬å€¼</td><td>å¯é€‰</td></tr><tr><td><code>WITHLABELS</code></td><td>flag</td><td>è¿”å›æ ·æœ¬çš„åŒæ—¶é™„å¸¦æ—¶é—´åºåˆ—çš„æ‰€æœ‰æ ‡ç­¾</td><td>å¯é€‰</td></tr><tr><td><code>&lt;SELECTED_LABELS label...&gt;</code></td><td>list</td><td>è¿”å›æ ·æœ¬æ—¶åªé™„å¸¦æŒ‡å®šæ ‡ç­¾</td><td>å¯é€‰ï¼Œä¸èƒ½ä¸ <code>WITHLABELS</code> ä¸€èµ·ä½¿ç”¨</td></tr><tr><td><code>FILTER filterExpr...</code></td><td>list of expressions</td><td>è¿‡æ»¤æ—¶é—´åºåˆ—ï¼Œæ ¹æ®æ ‡ç­¾åŒ¹é…è§„åˆ™ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„åºåˆ—</td><td>å¿…é€‰ï¼Œæ”¯æŒæ ‡ç­¾åŒ¹é…è¡¨è¾¾å¼ï¼Œå¦‚ <code>sensor=temperature</code> æˆ– <code>region=*</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–æ‰€æœ‰æ—¶é—´åºåˆ—çš„æœ€æ–°å€¼ï¼Œæ ¹æ®æ ‡ç­¾è¿‡æ»¤</span></span><br><span class="line">TS.MGET WITHLABELS FILTER metric=cpu</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;ts:cpu:server1&quot;</span></span><br><span class="line">   2) 1) 1) <span class="string">&quot;host&quot;</span></span><br><span class="line">         2) <span class="string">&quot;server1&quot;</span></span><br><span class="line">      2) 1) <span class="string">&quot;metric&quot;</span></span><br><span class="line">         2) <span class="string">&quot;cpu&quot;</span></span><br><span class="line">      3) 1) <span class="string">&quot;env&quot;</span></span><br><span class="line">         2) <span class="string">&quot;prod&quot;</span></span><br><span class="line">   3) 1) (<span class="built_in">integer</span>) 1767778308126</span><br><span class="line">      2) 115.5</span><br><span class="line">2) 1) <span class="string">&quot;ts:cpu:server2&quot;</span></span><br><span class="line">   2) 1) 1) <span class="string">&quot;host&quot;</span></span><br><span class="line">         2) <span class="string">&quot;server1&quot;</span></span><br><span class="line">      2) 1) <span class="string">&quot;metric&quot;</span></span><br><span class="line">         2) <span class="string">&quot;cpu&quot;</span></span><br><span class="line">   3) 1) (<span class="built_in">integer</span>) 1767777965870</span><br><span class="line">      2) 90.5</span><br><span class="line">3) 1) <span class="string">&quot;ts:cpu:server3&quot;</span></span><br><span class="line">   2) 1) 1) <span class="string">&quot;host&quot;</span></span><br><span class="line">         2) <span class="string">&quot;server1&quot;</span></span><br><span class="line">      2) 1) <span class="string">&quot;metric&quot;</span></span><br><span class="line">         2) <span class="string">&quot;cpu&quot;</span></span><br><span class="line">   3) 1) (<span class="built_in">integer</span>) 1767777965870</span><br><span class="line">      2) 70.5</span><br></pre></td></tr></table></figure><h4 id="2ï¸âƒ£-TS-MRANGE-æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œæ­£åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®">2ï¸âƒ£ TS.MRANGE : æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œæ­£åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">TS.MRANGE fromTimestamp toTimestamp</span><br><span class="line">  [LATEST]</span><br><span class="line">  [FILTER_BY_TS ts...]</span><br><span class="line">  [FILTER_BY_VALUE min max]</span><br><span class="line">  [WITHLABELS | &lt;SELECTED_LABELS label...&gt;]</span><br><span class="line">  [COUNT count]</span><br><span class="line">  [[ALIGN align] AGGREGATION aggregator bucketDuration [BUCKETTIMESTAMP bt] [EMPTY]]</span><br><span class="line">  FILTER filterExpr...</span><br><span class="line">  [GROUPBY label REDUCE reducer]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜ï¼š</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>è¯´æ˜</th><th>å¯é€‰å€¼ / è¯´æ˜</th></tr></thead><tbody><tr><td><code>fromTimestamp</code></td><td>integer</td><td>æŸ¥è¯¢èµ·å§‹æ—¶é—´æˆ³ï¼Œ<code>-</code>: æœ€å°å€¼</td><td>å¿…é€‰</td></tr><tr><td><code>toTimestamp</code></td><td>integer</td><td>æŸ¥è¯¢ç»“æŸæ—¶é—´æˆ³ï¼Œ<code>+</code>: æœ€å¤§å€¼</td><td>å¿…é€‰</td></tr><tr><td><code>LATEST</code></td><td>flag</td><td>å¯¹ compaction ç±»å‹çš„æ—¶é—´åºåˆ—ï¼Œè¿”å›æœ€æ–°ï¼ˆå¯èƒ½éƒ¨åˆ†ï¼‰çš„æ¡¶çš„èšåˆå€¼</td><td>å¯é€‰</td></tr><tr><td><code>FILTER_BY_TS ts...</code></td><td>list of integers</td><td>åªè¿”å›æŒ‡å®šæ—¶é—´æˆ³çš„æ ·æœ¬</td><td>å¯é€‰</td></tr><tr><td><code>FILTER_BY_VALUE min max</code></td><td>range</td><td>åªè¿”å›å€¼åœ¨ <code>[min, max]</code> åŒºé—´çš„æ ·æœ¬</td><td>å¯é€‰</td></tr><tr><td><code>WITHLABELS</code></td><td>flag</td><td>è¿”å›æ ·æœ¬çš„åŒæ—¶é™„å¸¦æ—¶é—´åºåˆ—çš„æ‰€æœ‰æ ‡ç­¾</td><td>å¯é€‰</td></tr><tr><td><code>&lt;SELECTED_LABELS label...&gt;</code></td><td>list</td><td>è¿”å›æ ·æœ¬æ—¶åªé™„å¸¦æŒ‡å®šæ ‡ç­¾</td><td>å¯é€‰ï¼Œä¸èƒ½ä¸ <code>WITHLABELS</code> ä¸€èµ·ä½¿ç”¨</td></tr><tr><td><code>COUNT count</code></td><td>integer</td><td>é™åˆ¶è¿”å›çš„æ ·æœ¬æ•°é‡ï¼ˆæœ€å¤š <code>count</code> ä¸ªï¼‰</td><td>å¯é€‰</td></tr><tr><td><code>ALIGN align</code></td><td>string</td><td>å¯¹é½èšåˆæ¡¶çš„æ—¶é—´æˆ³ï¼ˆå¦‚ <code>start</code>ã€<code>end</code> æˆ–è‡ªå®šä¹‰æ—¶é—´æˆ³ï¼‰</td><td>å¯é€‰ï¼Œéœ€ä¸ <code>AGGREGATION</code> ä¸€èµ·ä½¿ç”¨</td></tr><tr><td><code>AGGREGATION aggregator bucketDuration</code></td><td>aggregation</td><td>å¯¹æ•°æ®è¿›è¡Œèšåˆè®¡ç®—ï¼Œ<code>aggregator</code> ä¸ºèšåˆå‡½æ•°ï¼ˆå¦‚ <code>avg</code>, <code>sum</code>, <code>min</code>, <code>max</code> ç­‰ï¼‰ï¼Œ<code>bucketDuration</code> ä¸ºæ¡¶çš„æ—¶é•¿</td><td>å¯é€‰</td></tr><tr><td><code>BUCKETTIMESTAMP bt</code></td><td>string</td><td>èšåˆæ¡¶æ—¶é—´æˆ³é€‰æ‹©ï¼Œ<code>bt</code> å¯ä¸º <code>start</code> æˆ– <code>end</code></td><td>å¯é€‰</td></tr><tr><td><code>EMPTY</code></td><td>flag</td><td>å³ä½¿æ¡¶ä¸ºç©ºä¹Ÿè¿”å›ç»“æœ</td><td>å¯é€‰</td></tr><tr><td><code>FILTER filterExpr...</code></td><td>list of expressions</td><td>è¿‡æ»¤æ—¶é—´åºåˆ—ï¼Œæ ¹æ®æ ‡ç­¾åŒ¹é…è§„åˆ™ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„åºåˆ—</td><td>å¿…é€‰</td></tr><tr><td><code>GROUPBY label REDUCE reducer</code></td><td>aggregation</td><td>å¯¹è¿”å›ç»“æœæŒ‰æŒ‡å®šæ ‡ç­¾åˆ†ç»„å¹¶åº”ç”¨ reducer èšåˆå‡½æ•°ï¼ˆå¦‚ <code>SUM</code>, <code>MIN</code>, <code>MAX</code> ç­‰ï¼‰</td><td>å¯é€‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">TS.MRANGE - + FILTER metric=cpu</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;ts:cpu:server1&quot;</span></span><br><span class="line">   2) (empty array)</span><br><span class="line">   3) 1) 1) (<span class="built_in">integer</span>) 1767777655255</span><br><span class="line">         2) 80.5</span><br><span class="line">      2) 1) (<span class="built_in">integer</span>) 1767777807933</span><br><span class="line">         2) 70.5</span><br><span class="line">      3) 1) (<span class="built_in">integer</span>) 1767777873866</span><br><span class="line">         2) 80.5</span><br><span class="line">      4) 1) (<span class="built_in">integer</span>) 1767777965870</span><br><span class="line">         2) 80.5</span><br><span class="line">      5) 1) (<span class="built_in">integer</span>) 1767778300909</span><br><span class="line">         2) 90.5</span><br><span class="line">      6) 1) (<span class="built_in">integer</span>) 1767778308125</span><br><span class="line">         2) 105.5</span><br><span class="line">      7) 1) (<span class="built_in">integer</span>) 1767778308126</span><br><span class="line">         2) 115.5</span><br><span class="line">2) 1) <span class="string">&quot;ts:cpu:server2&quot;</span></span><br><span class="line">   2) (empty array)</span><br><span class="line">   3) 1) 1) (<span class="built_in">integer</span>) 1767777965870</span><br><span class="line">         2) 90.5</span><br><span class="line">3) 1) <span class="string">&quot;ts:cpu:server3&quot;</span></span><br><span class="line">   2) (empty array)</span><br><span class="line">   3) 1) 1) (<span class="built_in">integer</span>) 1767777965870</span><br><span class="line">         2) 70.5</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰æ ‡ç­¾èšåˆ</span></span><br><span class="line">TS.MRANGE - +</span><br><span class="line">    AGGREGATION avg 1000</span><br><span class="line">    FILTER metric=cpu</span><br><span class="line">    GROUPBY host REDUCE avg</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;host=server1&quot;</span></span><br><span class="line">   2) (empty array)</span><br><span class="line">   3) 1) 1) (<span class="built_in">integer</span>) 1767777655000</span><br><span class="line">         2) 80.5</span><br><span class="line">      2) 1) (<span class="built_in">integer</span>) 1767777807000</span><br><span class="line">         2) 70.5</span><br><span class="line">      3) 1) (<span class="built_in">integer</span>) 1767777873000</span><br><span class="line">         2) 80.5</span><br><span class="line">      4) 1) (<span class="built_in">integer</span>) 1767777965000</span><br><span class="line">         2) 80.5</span><br><span class="line">      5) 1) (<span class="built_in">integer</span>) 1767778300000</span><br><span class="line">         2) 90.5</span><br><span class="line">      6) 1) (<span class="built_in">integer</span>) 1767778308000</span><br><span class="line">         2) 110.5</span><br></pre></td></tr></table></figure><h4 id="3ï¸âƒ£-TS-MREVRANGE-æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œé€†åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®">3ï¸âƒ£ TS.MREVRANGE : æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œé€†åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</h4><ul class="lvl-0"><li class="lvl-2"><p>ä¸ TS.MRANGE ç±»ä¼¼ï¼Œåªæ˜¯æŸ¥è¯¢ç»“æœæ˜¯é€†åºçš„</p></li></ul><h4 id="4ï¸âƒ£-TS-QUERYINDEX-æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè¿”å›åŒ¹é…çš„æ—¶é—´åºåˆ—-key-åˆ—è¡¨">4ï¸âƒ£ TS.QUERYINDEX : æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè¿”å›åŒ¹é…çš„æ—¶é—´åºåˆ— key åˆ—è¡¨</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S.QUERYINDEX filterExpr...</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TS.QUERYINDEX metric=cpu host=server1</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) <span class="string">&quot;ts:cpu:server1&quot;</span></span><br><span class="line">2) <span class="string">&quot;ts:cpu:server2&quot;</span></span><br><span class="line">3) <span class="string">&quot;ts:cpu:server3&quot;</span></span><br></pre></td></tr></table></figure><h3 id="äº”ã€æ•°æ®åˆ é™¤ä¸ç»´æŠ¤ç±»">äº”ã€æ•°æ®åˆ é™¤ä¸ç»´æŠ¤ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>TS.DEL</strong></td><td>åˆ é™¤æŸä¸ªæ—¶é—´åºåˆ—åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ ·æœ¬</td><td>æ¸…ç†å¼‚å¸¸æ•°æ®ã€å†å²æ•°æ®ä¿®æ­£</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TS.DEL key fromTimestamp toTimestamp</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TS.DEL ts:cpu:server1 0 1767777965870</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">(<span class="built_in">integer</span>) 4 <span class="comment"># åˆ é™¤äº† 4 ä¸ªæ ·æœ¬</span></span><br></pre></td></tr></table></figure><h3 id="å…­ã€å…ƒæ•°æ®ä¸çŠ¶æ€æŸ¥è¯¢ç±»">å…­ã€å…ƒæ•°æ®ä¸çŠ¶æ€æŸ¥è¯¢ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong><a href="http://TS.INFO">TS.INFO</a></strong></td><td>è¿”å›æ—¶é—´åºåˆ—çš„å…ƒä¿¡æ¯ä¸ç»Ÿè®¡ä¿¡æ¯</td><td>æ’æŸ¥é—®é¢˜ã€å®¹é‡è¯„ä¼°ã€ç›‘æ§çŠ¶æ€</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TS.INFO key [DEBUG]</span><br><span class="line"><span class="comment"># DEBUG: æ˜¾ç¤ºæ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">TS.INFO ts:cpu:server1</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) totalSamples</span><br><span class="line"> 2) (<span class="built_in">integer</span>) 3</span><br><span class="line"> 3) memoryUsage</span><br><span class="line"> 4) (<span class="built_in">integer</span>) 9184</span><br><span class="line"> 5) firstTimestamp</span><br><span class="line"> 6) (<span class="built_in">integer</span>) 1767778300909</span><br><span class="line"> 7) lastTimestamp</span><br><span class="line"> 8) (<span class="built_in">integer</span>) 1767778308126</span><br><span class="line"> 9) retentionTime</span><br><span class="line">10) (<span class="built_in">integer</span>) 7200000</span><br><span class="line">11) chunkCount</span><br><span class="line">12) (<span class="built_in">integer</span>) 1</span><br><span class="line">13) chunkSize</span><br><span class="line">14) (<span class="built_in">integer</span>) 8192</span><br><span class="line">15) chunkType</span><br><span class="line">16) compressed</span><br><span class="line">17) duplicatePolicy</span><br><span class="line">18) last</span><br><span class="line">19) labels</span><br><span class="line">20) 1) 1) <span class="string">&quot;host&quot;</span></span><br><span class="line">       2) <span class="string">&quot;server1&quot;</span></span><br><span class="line">    2) 1) <span class="string">&quot;metric&quot;</span></span><br><span class="line">       2) <span class="string">&quot;cpu&quot;</span></span><br><span class="line">    3) 1) <span class="string">&quot;env&quot;</span></span><br><span class="line">       2) <span class="string">&quot;prod&quot;</span></span><br><span class="line">21) sourceKey</span><br><span class="line">22) (nil)</span><br><span class="line">23) rules</span><br><span class="line">24) (empty array)</span><br><span class="line">25) ignoreMaxTimeDiff</span><br><span class="line">26) (<span class="built_in">integer</span>) 1000</span><br><span class="line">27) ignoreMaxValDiff</span><br><span class="line">28) <span class="string">&quot;0.1&quot;</span></span><br></pre></td></tr></table></figure><h2 id="çœŸå®æ¡ˆä¾‹">çœŸå®æ¡ˆä¾‹</h2><h3 id="åœºæ™¯è¯´æ˜">åœºæ™¯è¯´æ˜</h3><ul class="lvl-0"><li class="lvl-2"><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª IoT è®¾å¤‡ç›‘æ§ç³»ç»Ÿï¼Œæ¯å°è®¾å¤‡æ¯åˆ†é’Ÿä¼šä¸ŠæŠ¥ä¸€æ¬¡æ¸©åº¦å’Œæ¹¿åº¦æ•°æ®ã€‚æˆ‘ä»¬å¸Œæœ›ï¼š</p><ul class="lvl-2"><li class="lvl-6">å­˜å‚¨æ¯å°è®¾å¤‡çš„æ—¶é—´åºåˆ—æ•°æ®ã€‚</li><li class="lvl-6">æŸ¥è¯¢æœ€è¿‘ä¸€å°æ—¶çš„æ•°æ®ã€‚</li><li class="lvl-6">ç»Ÿè®¡æ¯ 5 åˆ†é’Ÿçš„å¹³å‡æ¸©åº¦å’Œæ¹¿åº¦ã€‚</li><li class="lvl-6">è·å–æœ€æ–°çš„æ¸©åº¦å€¼ã€‚</li></ul></li></ul><h3 id="æ­¥éª¤">æ­¥éª¤</h3><ul class="lvl-0"><li class="lvl-2"><ol><li class="lvl-5">åˆ›å»ºæ—¶é—´åºåˆ—</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè®¾å¤‡ device:1001 çš„æ¸©åº¦æ—¶é—´åºåˆ—</span></span><br><span class="line">TS.CREATE device:1001:temperature RETENTION 86400000 LABELS device_id 1001 <span class="built_in">type</span> temperature</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè®¾å¤‡ device:1001 çš„æ¹¿åº¦æ—¶é—´åºåˆ—</span></span><br><span class="line">TS.CREATE device:1001:humidity RETENTION 86400000 LABELS device_id 1001 <span class="built_in">type</span> humidity</span><br><span class="line"></span><br><span class="line"><span class="comment">## è¯´æ˜ï¼š</span></span><br><span class="line">    <span class="comment"># RETENTION 86400000ï¼šæ•°æ®ä¿ç•™ 24 å°æ—¶ï¼ˆå•ä½æ¯«ç§’ï¼‰ã€‚</span></span><br><span class="line">    <span class="comment"># LABELSï¼šæ–¹ä¾¿åç»­æŒ‰æ ‡ç­¾èšåˆæŸ¥è¯¢ã€‚</span></span><br><span class="line">    <span class="comment"># TS.CREATE ç”¨äºåˆ›å»ºæ—¶é—´åºåˆ— keyã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="2"><li class="lvl-5">æ’å…¥æ•°æ®</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾æ—¶é—´æˆ³ä¸ºå½“å‰æ¯«ç§’</span></span><br><span class="line">TS.ADD device:1001:temperature * 26.5</span><br><span class="line">TS.ADD device:1001:humidity * 60.2</span><br><span class="line"><span class="comment"># æ­¤å¤„å‡è®¾ä¼šæ¯åˆ†é’Ÿæ’å…¥ä¸€æ¬¡æ•°æ®</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="3"><li class="lvl-5">æŸ¥è¯¢æ—¶é—´èŒƒå›´æ•°æ®</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å– è¿‡å»ä¸€å°æ—¶çš„æ¸©åº¦æ•°æ®ï¼š</span></span><br><span class="line"><span class="comment"># è¿‡å»ä¸€å°æ—¶çš„æ—¶é—´æˆ³å¯ä»¥è¿™æ ·è·å¾—</span></span><br><span class="line">EVAL <span class="string">&quot;return redis.call(&#x27;TIME&#x27;)[1]*1000 - 3600000&quot;</span> 0</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">(<span class="built_in">integer</span>) 1767777794000</span><br><span class="line"></span><br><span class="line">TS.RANGE device:1001:temperature 1767777794000 +</span><br><span class="line"><span class="comment">## è¯´æ˜</span></span><br><span class="line">    <span class="comment"># -3600000 è¡¨ç¤ºä¸€å°æ—¶å‰ã€‚</span></span><br><span class="line">    <span class="comment"># + è¡¨ç¤ºåˆ°ç°åœ¨ã€‚</span></span><br><span class="line">    <span class="comment"># è¿”å›ç»“æœä¸º [timestamp, value] æ•°ç»„ã€‚</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) 1) (<span class="built_in">integer</span>) 1767781256846</span><br><span class="line">   2) 26.5</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="4"><li class="lvl-5">èšåˆæŸ¥è¯¢ï¼ˆDownsamplingï¼‰</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»Ÿè®¡ æ¯ 5 åˆ†é’Ÿå¹³å‡æ¸©åº¦ï¼š</span></span><br><span class="line">TS.RANGE device:1001:temperature 1767777794000 + AGGREGATION avg 300000</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line">    <span class="comment"># AGGREGATION avg 300000 è¡¨ç¤ºæ¯ 300,000 msï¼ˆ5 åˆ†é’Ÿï¼‰èšåˆä¸€æ¬¡ã€‚</span></span><br><span class="line">    <span class="comment"># RedisTimeSeries æ”¯æŒå¤šç§èšåˆå‡½æ•°ï¼šavg, sum, min, max, countã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="5"><li class="lvl-5">è·å–æœ€æ–°å€¼</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–æœ€æ–°çš„æ¸©åº¦å€¼ï¼š</span></span><br><span class="line">TS.GET device:1001:temperature</span><br><span class="line"><span class="comment"># è¯´æ˜</span></span><br><span class="line">    <span class="comment"># TS.GET ä¼šè¿”å›æœ€æ–°ä¸€ä¸ªæ•°æ®ç‚¹ [timestamp, value]ã€‚</span></span><br><span class="line">    <span class="comment"># å¦‚æœä½¿ç”¨äº†å‹ç¼©ç­–ç•¥ LATESTï¼Œè¿”å›çš„å€¼å¯èƒ½æ˜¯å½“å‰èšåˆæ¡¶çš„å€¼ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="6"><li class="lvl-5">æŒ‰æ ‡ç­¾æŸ¥è¯¢</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæˆ‘ä»¬æƒ³è·å– æ‰€æœ‰è®¾å¤‡çš„æ¸©åº¦å¹³å‡å€¼ï¼ˆå‡è®¾æœ‰å¾ˆå¤šè®¾å¤‡ï¼‰ï¼š</span></span><br><span class="line">TS.MRANGE - + AGGREGATION avg 300000 FILTER <span class="built_in">type</span>=temperature</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line">    <span class="comment"># TS.MRANGE æ”¯æŒå¤š key æŸ¥è¯¢ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰æ ‡ç­¾è¿‡æ»¤ã€‚</span></span><br><span class="line">    <span class="comment"># èšåˆå‡½æ•°å¯ä»¥å¯¹æ¯ä¸ªåŒ¹é… key å•ç‹¬è®¡ç®—ã€‚</span></span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;device:1001:temperature&quot;</span></span><br><span class="line">   2) (empty array)</span><br><span class="line">   3) 1) 1) (<span class="built_in">integer</span>) 1767781200000</span><br><span class="line">         2) 26.5</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisTimeSeries ä¸­ TimeSeries æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æ“ä½œç³»ç»Ÿï¼š&lt;code&gt;Amazon Linux 2023(å†…æ ¸ 6.1)&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;RedisTimeSeries çš„å®‰è£…å‚è§ &lt;a href=&quot;/2026/01/07/redis7-module-RedisTimeSeries/&quot; title=&quot;Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•&quot;&gt;Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•</title>
    <link href="https://blog.hanqunfeng.com/2026/01/07/redis7-module-RedisTimeSeries/"/>
    <id>https://blog.hanqunfeng.com/2026/01/07/redis7-module-RedisTimeSeries/</id>
    <published>2026-01-07T13:30:05.000Z</published>
    <updated>2026-01-07T06:46:17.065Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisTimeSeries çš„å®‰è£…æ–¹æ³•</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li></ul><span id="more"></span><h2 id="RedisTimeSeries-ç®€ä»‹">RedisTimeSeries ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/RedisTimeSeries/RedisTimeSeries">RedisTimeSeries</a> æ˜¯ Redis å®˜æ–¹æä¾›çš„ä¸€ä¸ª æ—¶åºæ•°æ®æ¨¡å—ï¼ˆTime Series Moduleï¼‰ï¼Œç”¨äºé«˜æ•ˆåœ°å­˜å‚¨ã€æŸ¥è¯¢å’Œåˆ†ææ—¶é—´åºåˆ—æ•°æ®ã€‚å®ƒå¯ä»¥ä½œä¸º Redis çš„ä¸€ä¸ªæ¨¡å—åŠ è½½ä½¿ç”¨ï¼ˆåœ¨ Redis Stack ä¸­å†…ç½®æ”¯æŒï¼‰ï¼Œå°†æ—¶åºæ•°æ®å»ºæ¨¡ã€å­˜å‚¨å’Œèšåˆèƒ½åŠ›æ‰©å±•åˆ° Redis ä¹‹å¤–ã€‚</p></li><li class="lvl-2"><p>è¯¥æ¨¡å—ä»¥ <code>Redis Module</code> æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚</p></li><li class="lvl-2"><p>Redis8+ï¼ŒRedisTimeSeries å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚</p></li></ul><h2 id="å®‰è£…-RedisTimeSeries">å®‰è£… RedisTimeSeries</h2><ul class="lvl-0"><li class="lvl-2"><p>è™½ç„¶<a href="https://cloud.redis.io">Redis Cloud</a>çš„<code>Download Center</code>ä¸­æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„<code>.so</code>æ–‡ä»¶ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚</p></li></ul><blockquote><p>å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚<br>å¯ä»¥åœ¨æµ·å¤–çš„<code>ç›¸åŒé…ç½®</code>çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„<code>redistimeseries.so</code>ä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…ä¾èµ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install -y \</span><br><span class="line">  gcc \</span><br><span class="line">  gcc-c++ \</span><br><span class="line">  make \</span><br><span class="line">  cmake \</span><br><span class="line">  autoconf \</span><br><span class="line">  automake \</span><br><span class="line">  libtool \</span><br><span class="line">  pkgconfig \</span><br><span class="line">  openssl-devel</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¼–è¯‘ RedisTimeSeries</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /usr/local/soft/modules/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/soft/modules</span><br><span class="line"><span class="comment"># clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—</span></span><br><span class="line">git <span class="built_in">clone</span> --recursive https://github.com/RedisTimeSeries/RedisTimeSeries.git</span><br><span class="line"><span class="built_in">cd</span> RedisTimeSeries</span><br><span class="line"><span class="comment"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class="line">git checkout v1.12.9</span><br><span class="line"><span class="comment"># æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥</span></span><br><span class="line">git submodule update --init --recursive</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å¹¶å®‰è£…éœ€è¦çš„ä¾èµ–</span></span><br><span class="line">./sbin/setup</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="comment"># readies version: af92230</span></span><br><span class="line">dnf install -q -y ca-certificates</span><br><span class="line">dnf install -q -y wget unzip</span><br><span class="line">dnf install -q -y git jq</span><br><span class="line">/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/enable-utf8</span><br><span class="line">dnf install -q -y autoconf libtool m4 automake</span><br><span class="line">dnf install -q -y openssl</span><br><span class="line">dnf install -q -y <span class="built_in">which</span></span><br><span class="line">/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getepel</span><br><span class="line">dnf install -q -y openssl-devel</span><br><span class="line">/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getgcc --modern</span><br><span class="line">dnf install -q -y valgrind</span><br><span class="line">/usr/bin/python3 /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getcmake --usr</span><br><span class="line">dnf install -q -y lcov</span><br><span class="line">/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getaws</span><br><span class="line">/usr/bin/python3 /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getrmpytools --reinstall --modern</span><br><span class="line">/usr/bin/python3 -m pip install --disable-pip-version-check --user  -r /usr/local/soft/modules/RedisTimeSeries/tests/flow/requirements.txt</span><br><span class="line">NO_PY2=1 /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getpudb</span><br><span class="line">amazon_linux_2023</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘ RedisTimeSeries</span></span><br><span class="line">make</span><br><span class="line"><span class="comment"># ç¼–è¯‘è¿‡ç¨‹æœªæŠ¥é”™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œç¼–è¯‘åçš„æ–‡ä»¶ä½äº `bin/linux-x64-release/redistimeseries.so`</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong><code>./sbin/setup</code> æŠ¥é”™</strong></em></p><ul class="lvl-1"><li class="lvl-2">æœ¬äººä½¿ç”¨çš„æ˜¯ Amazon Linux 2023(å†…æ ¸ 6.1)ï¼Œå³ <code>EL9</code>ï¼Œç±»ä¼¼äºCentOS 9ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œä¼šæŠ¥é”™ï¼Œå¤§è‡´æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">./sbin/setup</span><br><span class="line"><span class="comment">## é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">â€¦â€¦</span><br><span class="line">Status code: 403 <span class="keyword">for</span> https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 172.67.157.246)</span><br><span class="line"></span><br><span class="line">In /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getepel:</span><br><span class="line">346      <span class="comment"># xinstall --allowerasing https://dl.fedoraproject.org/pub/epel/epel-release-latest-$&#123;EPEL&#125;.noarch.rpm</span></span><br><span class="line">347      <span class="keyword">fi</span></span><br><span class="line">348</span><br><span class="line">349  &gt;&gt;&gt; install_raven</span><br><span class="line">350      install_remi</span><br><span class="line">351      <span class="comment"># install_centos_stream_repos</span></span><br><span class="line">352</span><br><span class="line"></span><br><span class="line"><span class="built_in">command</span> failed: /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getepel</span><br><span class="line"></span><br><span class="line">In /usr/local/soft/modules/RedisTimeSeries/sbin/setup:</span><br><span class="line">18       python3 -m pip list</span><br><span class="line">19       <span class="keyword">fi</span></span><br><span class="line">20</span><br><span class="line">21   &gt;&gt;&gt; <span class="variable">$ROOT</span>/sbin/system-setup.py <span class="variable">$SETUP_ARGS</span></span><br><span class="line">22       <span class="keyword">if</span> [[ <span class="variable">$VERBOSE</span> == 1 ]]; <span class="keyword">then</span></span><br><span class="line">23       python3 -m pip list</span><br><span class="line">24       <span class="keyword">fi</span></span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">é”™è¯¯åˆ†æä¸è§£å†³æ–¹æ³•ï¼š<ul class="lvl-3"><li class="lvl-6">è¿™ä¸ªé”™è¯¯ä¸å®‰è£… RedisBloom æ—¶ä¸€æ ·ï¼Œç¦ç”¨æ‰ <code>install_raven</code> å³å¯ï¼Œå…·ä½“å‚è§ <a href="/2025/12/21/redis7-module-RedisBloom/" title="Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a> è¿›è¡Œä¿®æ”¹ã€‚</li></ul></li></ul></div><h2 id="Redis-å¯ç”¨æ¨¡å—">Redis å¯ç”¨æ¨¡å—</h2><ul class="lvl-0"><li class="lvl-2"><p>å°†ç”Ÿæˆçš„ <code>redistimeseries.so</code> æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">cp</span> bin/linux-x64-release/redistimeseries.so /usr/local/soft/redis-7.4.7/modules/redistimeseries.so</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡é‡‡ç”¨ <code>loadmodule</code> åŠ è½½æ¨¡å—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°† redistimeseries.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class="line">loadmodule /usr/local/soft/redis-7.4.7/modules/redistimeseries.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨redis</span></span><br><span class="line">redis-server redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½•æµ‹è¯•</span></span><br><span class="line">redis-cli --user admin --pass 123456</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ¨¡å—</span></span><br><span class="line">127.0.0.1:6379&gt; MODULE LIST</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 11209</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/redistimeseries.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;ReJSON&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 20816</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">3) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;bf&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 20817</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">4) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;search&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 21025</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/redisearch.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisTimeSeries çš„å®‰è£…æ–¹æ³•&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æ“ä½œç³»ç»Ÿï¼š&lt;code&gt;Amazon Linux 2023(å†…æ ¸ 6.1)&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- AutoSuggest</title>
    <link href="https://blog.hanqunfeng.com/2026/01/06/redis7-datatype-17-AutoSuggest/"/>
    <id>https://blog.hanqunfeng.com/2026/01/06/redis7-datatype-17-AutoSuggest/</id>
    <published>2026-01-06T13:30:05.000Z</published>
    <updated>2026-01-07T07:42:03.485Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch ä¸­ AutoSuggest æ•°æ®ç±»å‹</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2">RediSearch çš„å®‰è£…å‚è§ <a href="/2025/12/26/redis7-module-RediSearch/" title="Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•</a></li><li class="lvl-2">ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo">GitHub</a></li></ul><span id="more"></span><h2 id="AutoSuggest-æœç´¢å»ºè®®ï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰">AutoSuggest æœç´¢å»ºè®®ï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰</h2><ul class="lvl-0"><li class="lvl-2"><p>Suggest æœ¬è´¨è§£å†³çš„é—®é¢˜ï¼šâ€œå½“ç”¨æˆ·åªè¾“å…¥éƒ¨åˆ†å‰ç¼€æ—¶ï¼Œå¦‚ä½•é«˜æ€§èƒ½åœ°ç»™å‡ºå€™é€‰è¯ï¼Œè€Œä¸æ˜¯å…¨æ–‡æœç´¢ç»“æœã€‚â€</p></li><li class="lvl-2"><p>Suggest èƒ½è§£å†³ä»€ä¹ˆä¸šåŠ¡é—®é¢˜?</p></li></ul><table><thead><tr><th>ä¸šåŠ¡ç—›ç‚¹</th><th>ä¼ ç»Ÿæ–¹æ¡ˆé—®é¢˜</th><th>Suggest çš„ä»·å€¼</th></tr></thead><tbody><tr><td>æœç´¢æ¡†è‡ªåŠ¨è¡¥å…¨</td><td>LIKE / æ¨¡ç³ŠæŸ¥è¯¢æ€§èƒ½å·®</td><td>O(logN) çº§å‰ç¼€åŒ¹é…</td></tr><tr><td>çƒ­é—¨è¯æ¨è</td><td>éœ€è¦é¢å¤–ç»Ÿè®¡ç³»ç»Ÿ</td><td>å†…ç½® score æ’åº</td></tr><tr><td>æ‹¼å†™ä¸å‡†ç¡®</td><td>æ™®é€šå‰ç¼€æ— æ³•å‘½ä¸­</td><td>FUZZY æ¨¡ç³ŠåŒ¹é…</td></tr><tr><td>è”æƒ³æç¤º</td><td>æœç´¢ç´¢å¼•è¿‡é‡</td><td>Suggest ç‹¬ç«‹ç»“æ„ï¼Œè½»é‡</td></tr><tr><td>é«˜å¹¶å‘æç¤º</td><td>æ•°æ®åº“å‹åŠ›å¤§</td><td>Redis å†…å­˜çº§åå</td></tr><tr><td>å®æ—¶æ›´æ–°</td><td>ç¦»çº¿è¯åº“å¤æ‚</td><td>åŠ¨æ€å¢åˆ </td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Suggest å‘½ä»¤ä¸ä½¿ç”¨åœºæ™¯å¯¹ç…§è¡¨</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th><th>æ˜¯å¦é«˜é¢‘</th></tr></thead><tbody><tr><td><strong>FT.SUGADD</strong></td><td>æ·»åŠ  / æ›´æ–°è¡¥å…¨è¯</td><td>æ„å»ºè¯åº“ã€åŠ¨æ€çƒ­è¯æ›´æ–°</td><td>â­â­â­â­</td></tr><tr><td><strong>FT.SUGGET</strong></td><td>æŸ¥è¯¢è¡¥å…¨å»ºè®®</td><td>ç”¨æˆ·è¾“å…¥è”æƒ³æç¤º</td><td>â­â­â­â­â­</td></tr><tr><td><strong>FT.SUGDEL</strong></td><td>åˆ é™¤è¡¥å…¨è¯</td><td>è¯ä¸‹æ¶ã€æ¸…ç†è„æ•°æ®</td><td>â­â­</td></tr><tr><td><strong>FT.SUGLEN</strong></td><td>ç»Ÿè®¡è¡¥å…¨è¯æ•°é‡</td><td>ç›‘æ§ã€å®¹é‡è¯„ä¼°</td><td>â­</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åœºæ™¯ â†’ å‘½ä»¤æ˜ å°„æ€»ç»“è¡¨ï¼ˆæ¨èæ”¶è—ï¼‰</p></li></ul><table><thead><tr><th>ä¸šåŠ¡ç›®æ ‡</th><th>æ¨èå‘½ä»¤ç»„åˆ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è‡ªåŠ¨è¡¥å…¨</td><td>SUGADD + SUGGET</td><td>åŸºç¡€èƒ½åŠ›</td></tr><tr><td>çƒ­è¯æ’è¡Œ</td><td>SUGADD(INCR) + SUGGET(WITHSCORES)</td><td>æƒé‡é©±åŠ¨</td></tr><tr><td>æ‹¼å†™çº é”™</td><td>SUGGET(FUZZY)</td><td>å®¹é”™</td></tr><tr><td>åˆ†ç±»æ¨è</td><td>SUGADD(PAYLOAD) + SUGGET(WITHPAYLOADS)</td><td>æºå¸¦ä¸šåŠ¡ä¿¡æ¯</td></tr><tr><td>è¯åº“æ²»ç†</td><td>SUGDEL + SUGLEN</td><td>è¿ç»´</td></tr><tr><td>å®¹é‡ç›‘æ§</td><td>SUGLEN</td><td>è§„æ¨¡è¯„ä¼°</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ğŸ‘‰ åŸåˆ™ï¼šè¾“å…¥æ¡†æç¤ºç”¨ Suggestï¼Œæœç´¢ç»“æœç”¨ FT.SEARCHã€‚</p></li></ul><h3 id="1ï¸âƒ£-FT-SUGADD-â€”â€”-æ·»åŠ -æ›´æ–°è¡¥å…¨è¯">1ï¸âƒ£ FT.SUGADD â€”â€” æ·»åŠ  / æ›´æ–°è¡¥å…¨è¯</h3><ul class="lvl-0"><li class="lvl-2"><p>å‘è¡¥å…¨è¯åº“ä¸­æ·»åŠ ä¸€ä¸ªå€™é€‰è¯</p></li><li class="lvl-2"><p>å¯è®¾ç½® æƒé‡ã€payload</p></li><li class="lvl-2"><p>å¯ç”¨äº çƒ­è¯æ’åº</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FT.SUGADD key string score</span><br><span class="line">  [INCR]</span><br><span class="line">  [PAYLOAD payload]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>key</code></td><td>Suggestion è¯åº“ Keyï¼Œç´¢å¼•åç§°</td></tr><tr><td><code>string</code></td><td>è¡¥å…¨æ–‡æœ¬</td></tr><tr><td><code>score</code></td><td>æƒé‡ï¼ˆè¶Šå¤§è¶Šé å‰ï¼‰</td></tr><tr><td><code>INCR</code></td><td>é€’å¢ï¼Œç´¯åŠ æƒé‡</td></tr><tr><td><code>PAYLOAD</code></td><td>é™„åŠ å…ƒæ•°æ®</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FT.SUGADD sug:search <span class="string">&quot;iphone&quot;</span> 100</span><br><span class="line">FT.SUGADD sug:search <span class="string">&quot;iphone 15&quot;</span> 200</span><br><span class="line">FT.SUGADD sug:search <span class="string">&quot;ipad&quot;</span> 50 PAYLOAD <span class="string">&quot;category=tablet&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç±»å‹</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> sug:search</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">trietype0</span><br></pre></td></tr></table></figure><h3 id="2ï¸âƒ£-FT-SUGGET-â€”â€”-è·å–è¡¥å…¨å»ºè®®">2ï¸âƒ£ FT.SUGGET â€”â€” è·å–è¡¥å…¨å»ºè®®</h3><ul class="lvl-0"><li class="lvl-2"><p>æ ¹æ® å‰ç¼€ è¿”å›æœ€ç›¸å…³çš„å€™é€‰è¯</p></li><li class="lvl-2"><p>æ”¯æŒæ¨¡ç³ŠåŒ¹é…</p></li><li class="lvl-2"><p>å¯è¿”å› payload / score</p></li><li class="lvl-2"><p>å¯ç”¨äº æœç´¢æ¡†è¾“å…¥è”æƒ³ã€æ‹¼å†™çº é”™</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FT.SUGGET key prefix</span><br><span class="line">  [FUZZY]</span><br><span class="line">  [WITHSCORES]</span><br><span class="line">  [WITHPAYLOADS]</span><br><span class="line">  [MAX num]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>prefix</code></td><td>ç”¨æˆ·è¾“å…¥å‰ç¼€</td></tr><tr><td><code>FUZZY</code></td><td>æ¨¡ç³ŠåŒ¹é…ï¼ˆå…è®¸æ‹¼å†™é”™è¯¯ï¼‰</td></tr><tr><td><code>WITHSCORES</code></td><td>è¿”å›æƒé‡</td></tr><tr><td><code>WITHPAYLOADS</code></td><td>è¿”å› payload</td></tr><tr><td><code>MAX</code></td><td>æœ€å¤§è¿”å›æ•°é‡</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">FT.SUGGET sug:search <span class="string">&quot;ip&quot;</span> MAX 5</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) <span class="string">&quot;iphone 15&quot;</span></span><br><span class="line">2) <span class="string">&quot;iphone&quot;</span></span><br><span class="line">3) <span class="string">&quot;ipad&quot;</span></span><br><span class="line"></span><br><span class="line">FT.SUGGET sug:search <span class="string">&quot;iphne&quot;</span> FUZZY</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) <span class="string">&quot;iphone 15&quot;</span></span><br><span class="line">2) <span class="string">&quot;iphone&quot;</span></span><br><span class="line"></span><br><span class="line">FT.SUGGET sug:search <span class="string">&quot;ip&quot;</span> WITHSCORES WITHPAYLOADS</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) <span class="string">&quot;iphone 15&quot;</span></span><br><span class="line">2) <span class="string">&quot;70.71067810058594&quot;</span></span><br><span class="line">3) (nil)</span><br><span class="line">4) <span class="string">&quot;iphone&quot;</span></span><br><span class="line">5) <span class="string">&quot;44.72135925292969&quot;</span></span><br><span class="line">6) (nil)</span><br><span class="line">7) <span class="string">&quot;ipad&quot;</span></span><br><span class="line">8) <span class="string">&quot;28.86751365661621&quot;</span></span><br><span class="line">9) <span class="string">&quot;category=tablet&quot;</span></span><br></pre></td></tr></table></figure><h3 id="3ï¸âƒ£-FT-SUGDEL-â€”â€”-åˆ é™¤è¡¥å…¨è¯">3ï¸âƒ£ FT.SUGDEL â€”â€” åˆ é™¤è¡¥å…¨è¯</h3><ul class="lvl-0"><li class="lvl-2"><p>ä»è¡¥å…¨è¯åº“ä¸­ç§»é™¤æŒ‡å®šè¯æ¡</p></li><li class="lvl-2"><p>å¯ç”¨äº å•†å“ä¸‹æ¶ã€æ•æ„Ÿè¯ç§»é™¤ã€è¿‡æœŸå…³é”®è¯æ¸…ç†</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FT.SUGDEL key string</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FT.SUGDEL sug:search <span class="string">&quot;iphone&quot;</span></span><br></pre></td></tr></table></figure><h3 id="4ï¸âƒ£-FT-SUGLEN-â€”â€”-æŸ¥çœ‹è¯åº“è§„æ¨¡">4ï¸âƒ£ FT.SUGLEN â€”â€” æŸ¥çœ‹è¯åº“è§„æ¨¡</h3><ul class="lvl-0"><li class="lvl-2"><p>è·å–å½“å‰è¯åº“çš„è¯æ¡æ•°é‡</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FT.SUGLEN key</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FT.SUGLEN sug:search</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </h2><ul class="lvl-0"><li class="lvl-2"><p>SpringBoot çš„ RedisTemplate ä¸­æ²¡æœ‰æä¾›å¯¹<code>AutoSuggest</code>çš„å°è£…ï¼Œéœ€è¦è‡ªå·±å°è£…ï¼Œæˆ‘è¿™é‡Œå°è£…äº†ä¸€ä¸ªç®€æ˜“çš„<code>RedisSuggestTool</code></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.redissug;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¡¥å…¨å»ºè®®å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisSuggestTool</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> &lt;T&gt; T <span class="title function_">executeLua</span><span class="params">(String script, List&lt;String&gt; keys, Object... args)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (T) stringRedisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, Object.class),</span><br><span class="line">                keys,</span><br><span class="line">                Arrays.stream(args)</span><br><span class="line">                        .map(String::valueOf)</span><br><span class="line">                        .toArray(String[]::<span class="keyword">new</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ  / æ›´æ–°è¡¥å…¨è¯</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * FT.SUGADD key string score</span></span><br><span class="line"><span class="comment">     * [INCR]</span></span><br><span class="line"><span class="comment">     * [PAYLOAD payload]</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key     ç´¢å¼•åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value   è¡¥å…¨æ–‡æœ¬</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> score   åˆ†æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> incr    æ˜¯å¦é€’å¢ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> payload è¡¥å…¨è¯çš„é™„åŠ ä¿¡æ¯ï¼Œé»˜è®¤ä¸ºç©º</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">sugAdd</span><span class="params">(String key,</span></span><br><span class="line"><span class="params">                       String value,</span></span><br><span class="line"><span class="params">                       <span class="type">double</span> score,</span></span><br><span class="line"><span class="params">                       <span class="type">boolean</span> incr,</span></span><br><span class="line"><span class="params">                       String payload)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lua</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                local args = &#123;&#x27;FT.SUGADD&#x27;, KEYS[1], ARGV[1], ARGV[2]&#125;</span></span><br><span class="line"><span class="string">                if ARGV[3] == &#x27;1&#x27; then table.insert(args, &#x27;INCR&#x27;) end</span></span><br><span class="line"><span class="string">                if ARGV[4] ~= &#x27;&#x27; then table.insert(args, &#x27;PAYLOAD&#x27;); table.insert(args, ARGV[4]) end</span></span><br><span class="line"><span class="string">                return redis.call(unpack(args))</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> executeLua(</span><br><span class="line">                lua,</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                value,</span><br><span class="line">                score,</span><br><span class="line">                incr ? <span class="string">&quot;1&quot;</span> : <span class="string">&quot;0&quot;</span>,</span><br><span class="line">                payload == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : payload</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">sugAdd</span><span class="params">(String key,</span></span><br><span class="line"><span class="params">                       String value,</span></span><br><span class="line"><span class="params">                       <span class="type">double</span> score)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sugAdd(key, value, score, <span class="literal">false</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢è¡¥å…¨å»ºè®®</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * FT.SUGGET key prefix</span></span><br><span class="line"><span class="comment">     * [FUZZY]</span></span><br><span class="line"><span class="comment">     * [WITHSCORES]</span></span><br><span class="line"><span class="comment">     * [WITHPAYLOADS]</span></span><br><span class="line"><span class="comment">     * [MAX num]</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key          ç´¢å¼•åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> prefix       å‰ç¼€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fuzzy        æ˜¯å¦æ¨¡ç³ŠåŒ¹é…ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> withScores   æ˜¯å¦è¿”å›åˆ†æ•°ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> withPayloads æ˜¯å¦è¿”å›é™„åŠ ä¿¡æ¯ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> max           æœ€å¤§è¿”å›æ•°é‡ï¼Œé»˜è®¤ä¸º5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Suggestion&gt; <span class="title function_">sugGet</span><span class="params">(String key,</span></span><br><span class="line"><span class="params">                                   String prefix,</span></span><br><span class="line"><span class="params">                                   <span class="type">boolean</span> fuzzy,</span></span><br><span class="line"><span class="params">                                   <span class="type">boolean</span> withScores,</span></span><br><span class="line"><span class="params">                                   <span class="type">boolean</span> withPayloads,</span></span><br><span class="line"><span class="params">                                   <span class="type">int</span> max)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lua</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                local args = &#123;&#x27;FT.SUGGET&#x27;, KEYS[1], ARGV[1]&#125;</span></span><br><span class="line"><span class="string">                if ARGV[2] == &#x27;1&#x27; then table.insert(args, &#x27;FUZZY&#x27;) end</span></span><br><span class="line"><span class="string">                if ARGV[3] == &#x27;1&#x27; then table.insert(args, &#x27;WITHSCORES&#x27;) end</span></span><br><span class="line"><span class="string">                if ARGV[4] == &#x27;1&#x27; then table.insert(args, &#x27;WITHPAYLOADS&#x27;) end</span></span><br><span class="line"><span class="string">                if tonumber(ARGV[5]) &gt; 0 then table.insert(args, &#x27;MAX&#x27;); table.insert(args, ARGV[5]) end</span></span><br><span class="line"><span class="string">                return redis.call(unpack(args))</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        List&lt;Object&gt; raw = executeLua(</span><br><span class="line">                lua,</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                prefix,</span><br><span class="line">                fuzzy ? <span class="string">&quot;1&quot;</span> : <span class="string">&quot;0&quot;</span>,</span><br><span class="line">                withScores ? <span class="string">&quot;1&quot;</span> : <span class="string">&quot;0&quot;</span>,</span><br><span class="line">                withPayloads ? <span class="string">&quot;1&quot;</span> : <span class="string">&quot;0&quot;</span>,</span><br><span class="line">                max</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> parseSuggestionResult(raw, withScores, withPayloads);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»“æœè§£æå™¨</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Suggestion&gt; <span class="title function_">parseSuggestionResult</span><span class="params">(List&lt;Object&gt; raw,</span></span><br><span class="line"><span class="params">                                                   <span class="type">boolean</span> withScores,</span></span><br><span class="line"><span class="params">                                                   <span class="type">boolean</span> withPayloads)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (raw == <span class="literal">null</span> || raw.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;Suggestion&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">step</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">                + (withScores ? <span class="number">1</span> : <span class="number">0</span>)</span><br><span class="line">                + (withPayloads ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; raw.size(); i += step) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> i;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> String.valueOf(raw.get(idx++));</span><br><span class="line">            <span class="type">Double</span> <span class="variable">score</span> <span class="operator">=</span> withScores ? Double.valueOf(String.valueOf(raw.get(idx++))) : <span class="literal">null</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> withPayloads ? String.valueOf(raw.get(idx++)) : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">Suggestion</span>(value, score, payload));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤è¡¥å…¨è¯</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * FT.SUGDEL key string</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   ç´¢å¼•åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value è¡¥å…¨è¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">sugDel</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lua</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;FT.SUGDEL&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> executeLua(</span><br><span class="line">                lua,</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                value</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Long.valueOf(<span class="number">1</span>).equals(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–è¡¥å…¨è¯æ•°é‡</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * FT.SUGLEN key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key ç´¢å¼•åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">sugLen</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lua</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;FT.SUGLEN&#x27;, KEYS[1])&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> executeLua(</span><br><span class="line">                lua,</span><br><span class="line">                Collections.singletonList(key)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Suggestion</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    <span class="keyword">private</span> Double score;</span><br><span class="line">    <span class="keyword">private</span> String payload;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch ä¸­ AutoSuggest æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æ“ä½œç³»ç»Ÿï¼š&lt;code&gt;Amazon Linux 2023(å†…æ ¸ 6.1)&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;RediSearch çš„å®‰è£…å‚è§ &lt;a href=&quot;/2025/12/26/redis7-module-RediSearch/&quot; title=&quot;Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•&quot;&gt;Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo&quot;&gt;GitHub&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>RediSearch å¼€å‘å®æˆ˜</title>
    <link href="https://blog.hanqunfeng.com/2026/01/05/redis7-module-RediSearch-study/"/>
    <id>https://blog.hanqunfeng.com/2026/01/05/redis7-module-RediSearch-study/</id>
    <published>2026-01-05T13:30:05.000Z</published>
    <updated>2026-01-07T07:30:53.062Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch çš„ä½¿ç”¨æ–¹æ³•</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2">RediSearch çš„å®‰è£…å‚è§ <a href="/2025/12/26/redis7-module-RediSearch/" title="Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•</a></li><li class="lvl-2">ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo">GitHub</a></li></ul><span id="more"></span><h2 id="RediSearch-å‘½ä»¤">RediSearch å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºäº†å±•ç¤ºå‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•ï¼Œè¿™é‡Œä»¥JSONæ–‡æ¡£è¿›è¡Œç´¢å¼•ï¼Œåˆå§‹åŒ–æ•°æ®å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">JSON.SET user:10001 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Alice Bob&quot;,&quot;age&quot;:28,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:199.99,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:59.9,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a phone&quot;,&quot;items&quot;:[&quot;SpringCloudæŠ€æœ¯æŒ‡å—&quot;,&quot;Shellè„šæœ¬åŸºç¡€&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10002 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Bob Frank&quot;,&quot;age&quot;:35,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:899.0,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a iphone&quot;,&quot;items&quot;:[&quot;Linuxå¿…çŸ¥å¿…ä¼š&quot;,&quot;Javaå¤šçº¿ç¨‹è¯¦è§£&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10003 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Carol&quot;,&quot;age&quot;:22,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:19.9,&quot;status&quot;:&quot;CANCELLED&quot;&#125;],&quot;comment&quot;: &quot;I have a mobile&quot;,&quot;items&quot;:[&quot;MySQLä»åˆ åº“åˆ°è·‘è·¯&quot;,&quot;Oracleå¼€å‘å®è·µ&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10004 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;David Bob&quot;,&quot;age&quot;:41,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:1200,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:300,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a car&quot;,&quot;items&quot;:[&quot;SpringæŠ€æœ¯æŒ‡å—&quot;,&quot;RocketMQç”±æµ…å…¥æ·±&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10005 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Eve&quot;,&quot;age&quot;:30,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:88.8,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a pencil&quot;,&quot;items&quot;:[&quot;Kafkaä»é›¶å¼€å§‹&quot;,&quot;Javaç”±æµ…å…¥æ·±&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10006 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Frank&quot;,&quot;age&quot;:27,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:499,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:129,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a phone&quot;,&quot;items&quot;:[&quot;Rediså¼€å‘å®æˆ˜&quot;,&quot;MongoDBä»å…¥é—¨åˆ°å®æˆ˜&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10007 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Grace&quot;,&quot;age&quot;:33,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:999.9,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a book&quot;,&quot;items&quot;:[&quot;Androidå¼€å‘æ‰‹å†Œ&quot;,&quot;Gradleä»é›¶å¼€å§‹&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10008 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Henry&quot;,&quot;age&quot;:45,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:59.9,&quot;status&quot;:&quot;CANCELLED&quot;&#125;],&quot;comment&quot;: &quot;I have a macbook&quot;,&quot;items&quot;:[&quot;SpringBootæŠ€æœ¯æŒ‡å—&quot;,&quot;Mavenç”±æµ…å…¥æ·±&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10009 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Ivy&quot;,&quot;age&quot;:26,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:299,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:199,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a watch&quot;,&quot;items&quot;:[&quot;Springèä¼šè´µé€š&quot;,&quot;JavaæŠ€æœ¯å¼€å‘æŒ‡å—&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10010 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Jack&quot;,&quot;age&quot;:38,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:150,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a apple&quot;,&quot;items&quot;:[&quot;SpringæŠ€æœ¯æŒ‡å—&quot;,&quot;Javaç”±æµ…å…¥æ·±&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>SpringBootæš‚æ—¶æ²¡æœ‰æ”¯æŒ RediSearch ï¼Œä½ å¯ä»¥ç¼–å†™Luaè„šæœ¬æ¥å®ç°ç›¸åº”çš„åŠŸèƒ½ï¼Œå¦å¤– <a href="https://redisson.pro/docs/data-and-services/services/#redisearch-service">Redisson</a>å·²ç»æä¾›äº†å¯¹ RediSearch çš„æ”¯æŒï¼Œä¸‹é¢ç»“åˆå‘½ä»¤ç»™å‡ºä»£ç ç¤ºä¾‹ã€‚</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥ Redisson ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œç°åœ¨æœ€æ–°ç‰ˆæ˜¯ 4.0.0ï¼Œéœ€è¦ springboot 4.x --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.52.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é€šç”¨ä»£ç </p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line"><span class="type">RSearch</span> <span class="variable">rSearch</span> <span class="operator">=</span> redissonClient.getSearch(StringCodec.INSTANCE);</span><br></pre></td></tr></table></figure><h3 id="ä¸€ã€ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ç±»">ä¸€ã€ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>æ ¸å¿ƒå‚æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>FT.CREATE</code></td><td>åˆ›å»ºç´¢å¼•</td><td>ç´¢å¼•åã€ONã€PREFIXã€SCHEMA</td><td>è§ä¸‹</td></tr><tr><td><code>FT.ALTER</code></td><td>ç»™å·²æœ‰ç´¢å¼•æ–°å¢å­—æ®µ</td><td>ç´¢å¼•åã€SCHEMA ADD</td><td>è§ä¸‹</td></tr><tr><td><code>FT.DROPINDEX</code></td><td>åˆ é™¤ç´¢å¼•</td><td>ç´¢å¼•åã€DD</td><td>è§ä¸‹</td></tr><tr><td><code>FT.INFO</code></td><td>æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</td><td>ç´¢å¼•å</td><td>è§ä¸‹</td></tr><tr><td><code>FT._LIST</code></td><td>åˆ—å‡ºæ‰€æœ‰ç´¢å¼•</td><td>æ— </td><td>è§ä¸‹</td></tr></tbody></table><h4 id="1ï¸âƒ£-FT-CREATE">1ï¸âƒ£ FT.CREATE</h4><ul class="lvl-0"><li class="lvl-2"><p>FT.CREATE åŸºæœ¬è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FT.CREATE index_name</span><br><span class="line">[ON HASH | JSON]</span><br><span class="line">[PREFIX count prefix ...]</span><br><span class="line">[FILTER filter]</span><br><span class="line">[LANGUAGE default_lang]</span><br><span class="line">[LANGUAGE_FIELD lang_attribute]</span><br><span class="line">[SCORE default_score]</span><br><span class="line">[SCORE_FIELD score_attribute]</span><br><span class="line">[PAYLOAD_FIELD payload_attribute]</span><br><span class="line">[MAXTEXTFIELDS]</span><br><span class="line">[TEMPORARY seconds]</span><br><span class="line">[NOOFFSETS] [NOHL] [NOFIELDS] [NOFREQS]</span><br><span class="line">[STOPWORDS count stopword ...]</span><br><span class="line">[SKIPINITIALSCAN]</span><br><span class="line">SCHEMA</span><br><span class="line">  field_name [AS <span class="built_in">alias</span>] TEXT | TAG | NUMERIC | GEO | VECTOR</span><br><span class="line">  [SORTABLE [UNF]]</span><br><span class="line">  [NOINDEX]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>FT.CREATE å‚æ•°è¯´æ˜è¡¨</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><code>index_name</code></td><td>ç´¢å¼•åç§°</td></tr><tr><td><code>ON HASH | JSON</code></td><td>æŒ‡å®šç´¢å¼•æ•°æ®æ¥æºç±»å‹ï¼Œé»˜è®¤ <code>HASH</code></td></tr><tr><td><code>PREFIX count prefix...</code></td><td>æŒ‡å®šç´¢å¼• Key å‰ç¼€</td></tr><tr><td><code>FILTER filter</code></td><td>å¯¹ç´¢å¼•æ•°æ®è®¾ç½®è¿‡æ»¤è¡¨è¾¾å¼</td></tr><tr><td><code>LANGUAGE</code></td><td>æŒ‡å®šé»˜è®¤åˆ†è¯è¯­è¨€ï¼ˆé»˜è®¤ englishï¼Œä¸­æ–‡æ˜¯ chineseï¼‰</td></tr><tr><td><code>LANGUAGE_FIELD</code></td><td>æŒ‡å®šæ–‡æ¡£ä¸­çš„è¯­è¨€å­—æ®µ</td></tr><tr><td><code>SCORE</code></td><td>è®¾ç½®æ–‡æ¡£é»˜è®¤è¯„åˆ†</td></tr><tr><td><code>SCORE_FIELD</code></td><td>ä»å­—æ®µä¸­è¯»å–è¯„åˆ†</td></tr><tr><td><code>PAYLOAD_FIELD</code></td><td>æŒ‡å®šå­˜å‚¨çš„äºŒè¿›åˆ¶è´Ÿè½½å­—æ®µ</td></tr><tr><td><code>MAXTEXTFIELDS</code></td><td>å…è®¸æ›´å¤š TEXT å­—æ®µï¼ˆæ¶ˆè€—æ›´å¤šå†…å­˜ï¼‰</td></tr><tr><td><code>TEMPORARY seconds</code></td><td>åˆ›å»ºä¸´æ—¶ç´¢å¼•ï¼Œè¶…æ—¶åè‡ªåŠ¨åˆ é™¤</td></tr><tr><td><code>NOOFFSETS</code></td><td>ä¸å­˜å‚¨æ–‡æœ¬åç§»é‡ï¼ˆèŠ‚çœå†…å­˜ï¼‰</td></tr><tr><td><code>NOHL</code></td><td>ç¦ç”¨é«˜äº®</td></tr><tr><td><code>NOFIELDS</code></td><td>ä¸ä¿å­˜å­—æ®µå†…å®¹</td></tr><tr><td><code>NOFREQS</code></td><td>ä¸ä¿å­˜è¯é¢‘ä¿¡æ¯</td></tr><tr><td><code>STOPWORDS count ...</code></td><td>æŒ‡å®šåœç”¨è¯</td></tr><tr><td><code>SKIPINITIALSCAN</code></td><td>åˆ›å»ºç´¢å¼•æ—¶ä¸æ‰«æå·²æœ‰æ•°æ®</td></tr><tr><td><code>SCHEMA</code></td><td>ç´¢å¼•å­—æ®µå®šä¹‰èµ·å§‹</td></tr><tr><td><code>AS alias</code></td><td>å­—æ®µåˆ«å</td></tr><tr><td><code>TEXT</code></td><td>å…¨æ–‡ç´¢å¼•å­—æ®µ</td></tr><tr><td><code>TAG</code></td><td>ç²¾ç¡®åŒ¹é…å­—æ®µ</td></tr><tr><td><code>NUMERIC</code></td><td>æ•°å€¼å­—æ®µ</td></tr><tr><td><code>GEO</code></td><td>åœ°ç†ä½ç½®å­—æ®µ</td></tr><tr><td><code>VECTOR</code></td><td>å‘é‡å­—æ®µ</td></tr><tr><td><code>SORTABLE</code></td><td>å…è®¸æ’åº</td></tr><tr><td><code>UNF</code></td><td>ä¸è§„èŒƒåŒ–æ’åº</td></tr><tr><td><code>NOINDEX</code></td><td>å­—æ®µä¸å‚ä¸ç´¢å¼•</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>FT.CREATE çš„æ ¸å¿ƒè¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FT.CREATE &lt;index&gt;</span><br><span class="line">[ON HASH | JSON]</span><br><span class="line">[PREFIX count prefix ...]</span><br><span class="line">[LANGUAGE default_lang]</span><br><span class="line">SCHEMA</span><br><span class="line">  field_name [AS <span class="built_in">alias</span>] TEXT | TAG | NUMERIC | GEO | VECTOR</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºç´¢å¼•ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">FT.CREATE idx:user</span><br><span class="line">  ON JSON</span><br><span class="line">  PREFIX 1 user:</span><br><span class="line">  LANGUAGE chinese</span><br><span class="line">  SCHEMA</span><br><span class="line">    $.name AS name TEXT</span><br><span class="line">    $.age AS age NUMERIC SORTABLE</span><br><span class="line">    $.orders[*].amount AS amount NUMERIC</span><br><span class="line">    $.orders[*].status AS status TAG</span><br><span class="line">    $.comment AS comment TEXT</span><br><span class="line">    $.items[*] AS items TEXT</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line">  <span class="comment"># idx:userï¼šç´¢å¼•å</span></span><br><span class="line">  <span class="comment"># ON JSONï¼šç´¢å¼• JSON æ–‡æ¡£ï¼ŒRediSearch ä»…æ”¯æŒå¯¹ HASH å’Œ JSON è¿›è¡Œç´¢å¼•</span></span><br><span class="line">  <span class="comment"># PREFIX 1 user: ï¼šç´¢å¼•æŒ‡å®š key å‰ç¼€ï¼Œ1 è¡¨ç¤ºç´¢å¼•ä¸€ä¸ªï¼Œuser: è¡¨ç¤ºç´¢å¼•çš„ key å‰ç¼€ï¼Œå¦‚æœç´¢å¼•ä¸¤ä¸ªï¼šPREFIX 2 user: order:</span></span><br><span class="line">  <span class="comment"># LANGUAGE chineseï¼šæŒ‡å®šé»˜è®¤åˆ†è¯è¯­è¨€ï¼Œé»˜è®¤æ˜¯è‹±æ–‡ englishï¼Œä¸­æ–‡æ˜¯ chineseï¼Œå¦‚æœç´¢å¼•ä¸­æœ‰ä¸­æ–‡ï¼Œåˆ™å¿…é¡»æŒ‡å®š LANGUAGE ä¸º chinese</span></span><br><span class="line">  <span class="comment"># SCHEMAï¼šç´¢å¼•å­—æ®µ</span></span><br><span class="line">  <span class="comment"># $.name AS name TEXTï¼šç´¢å¼•å­—æ®µ $.name(æ³¨æ„ï¼šJSONç±»å‹ä»¥ $. å¼€å¤´ï¼ŒHashç±»å‹å°±ä¸éœ€è¦äº†)ï¼Œå­—æ®µåˆ«åä¸º nameï¼Œå­—æ®µç±»å‹ä¸º TEXT</span></span><br><span class="line">  <span class="comment"># ASï¼šå­—æ®µåˆ«åï¼ˆæŸ¥è¯¢æ—¶ä½¿ç”¨ï¼‰</span></span><br><span class="line">  <span class="comment"># TEXT / NUMERIC / TAGï¼šå­—æ®µç±»å‹ï¼Œè¿™å‡ ä¸ªæ˜¯æœ€å¸¸ç”¨çš„</span></span><br><span class="line">  <span class="comment"># SORTABLEï¼šNUMERICã€TAGã€TEXT æˆ– GEO ç±»å‹çš„å­—æ®µå¯ä»¥å¸¦æœ‰ä¸€ä¸ªå¯é€‰çš„ SORTABLE å‚æ•°ï¼Œè¡¨ç¤ºä¸ºå­—æ®µå»ºç«‹ä¸“é—¨çš„æ’åºæ•°æ®ç»“æ„ï¼ˆç±»ä¼¼åˆ—å¼å­˜å‚¨ï¼‰ï¼Œä»è€Œé¿å…åœ¨æŸ¥è¯¢é˜¶æ®µå¯¹å¤§é‡ç»“æœè¿›è¡Œä¸´æ—¶æ’åºã€‚</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rSearch.createIndex(</span><br><span class="line">    <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">    IndexOptions.defaults()</span><br><span class="line">            .on(IndexType.JSON)</span><br><span class="line">            .prefix(List.of(<span class="string">&quot;user:&quot;</span>))</span><br><span class="line">            .language(<span class="string">&quot;chinese&quot;</span>),</span><br><span class="line">    FieldIndex.text(<span class="string">&quot;$.name&quot;</span>).as(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">    FieldIndex.numeric(<span class="string">&quot;$.age&quot;</span>).as(<span class="string">&quot;age&quot;</span>),</span><br><span class="line">    FieldIndex.numeric(<span class="string">&quot;$.orders[*].amount&quot;</span>).as(<span class="string">&quot;amount&quot;</span>),</span><br><span class="line">    FieldIndex.tag(<span class="string">&quot;$.orders[*].status&quot;</span>).as(<span class="string">&quot;status&quot;</span>),</span><br><span class="line">    FieldIndex.text(<span class="string">&quot;$.comment&quot;</span>).as(<span class="string">&quot;comment&quot;</span>),</span><br><span class="line">    FieldIndex.text(<span class="string">&quot;$.items[*]&quot;</span>).as(<span class="string">&quot;items&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç´¢å¼•å­—æ®µçš„ç±»å‹</p></li></ul><table><thead><tr><th>å­—æ®µç±»å‹</th><th>ä¸­æ–‡åç§°</th><th>åŠŸèƒ½è¯´æ˜</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th><th>å¤‡æ³¨ / é™åˆ¶</th></tr></thead><tbody><tr><td><strong>TEXT</strong></td><td>å…¨æ–‡æ–‡æœ¬å­—æ®µ</td><td>æ”¯æŒå¯¹å­—æ®µå€¼è¿›è¡Œå…¨æ–‡æ£€ç´¢ï¼ˆåˆ†è¯ã€ç›¸å…³åº¦è®¡ç®—ã€æ¨¡ç³ŠåŒ¹é…ç­‰ï¼‰</td><td>æ–‡ç« å†…å®¹ã€ç”¨æˆ·åã€æè¿°ä¿¡æ¯</td><td>æ”¯æŒæƒé‡ï¼ˆWEIGHTï¼‰ã€æ’åºï¼ˆSORTABLEï¼‰ç­‰é€‰é¡¹</td></tr><tr><td><strong>TAG</strong></td><td>æ ‡ç­¾å­—æ®µ / ç²¾ç¡®åŒ¹é…å­—æ®µ</td><td>æ”¯æŒç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼Œé€‚ç”¨äºæšä¸¾å€¼æˆ–ç¦»æ•£åˆ†ç±»</td><td>åˆ†ç±»ã€çŠ¶æ€ã€ä¸»é”®ã€ç±»å‹å­—æ®µ</td><td>ä¸åˆ†è¯ï¼›å¯è‡ªå®šä¹‰åˆ†éš”ç¬¦</td></tr><tr><td><strong>NUMERIC</strong></td><td>æ•°å€¼å­—æ®µ</td><td>æ”¯æŒæ•°å€¼èŒƒå›´æŸ¥è¯¢</td><td>å¹´é¾„ã€ä»·æ ¼ã€åˆ†æ•°ã€æ—¶é—´æˆ³</td><td>æ”¯æŒåŒºé—´æŸ¥è¯¢ï¼ˆ<code>[min max]</code>ï¼‰</td></tr><tr><td><strong>GEO</strong></td><td>åœ°ç†ä½ç½®å­—æ®µï¼ˆç‚¹ï¼‰</td><td>æ”¯æŒä»¥â€œç‚¹â€ä¸ºä¸­å¿ƒçš„åŠå¾„èŒƒå›´æŸ¥è¯¢</td><td>é—¨åº—ä½ç½®ã€ç”¨æˆ·ä½ç½®</td><td>å€¼æ ¼å¼å¿…é¡»ä¸º <code>&quot;ç»åº¦,çº¬åº¦&quot;</code></td></tr><tr><td><strong>VECTOR</strong></td><td>å‘é‡å­—æ®µ</td><td>æ”¯æŒå‘é‡ç›¸ä¼¼åº¦æœç´¢ï¼ˆKNN ç­‰ï¼‰</td><td>è¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿã€Embedding å‘é‡</td><td>éœ€è¦ <strong>Query Dialect â‰¥ 2</strong>ï¼ˆRediSearch â‰¥ 2.4ï¼‰</td></tr><tr><td><strong>GEOSHAPE</strong></td><td>åœ°ç†å½¢çŠ¶å­—æ®µï¼ˆå¤šè¾¹å½¢ï¼‰</td><td>æ”¯æŒå¤šè¾¹å½¢ç©ºé—´æŸ¥è¯¢</td><td>è¡Œæ”¿åŒºã€å•†åœˆã€åœ°å›¾åŒºåŸŸ</td><td>ä½¿ç”¨ WKT æ ¼å¼ï¼›ä¸æ”¯æŒ JSON å¤šå€¼å’Œ SORTABLE</td></tr></tbody></table><blockquote><p>GEOSHAPE å­—æ®µè¡¥å……è¯´æ˜</p></blockquote><table><thead><tr><th>é¡¹ç›®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ•°æ®æ ¼å¼</td><td>WKTï¼ˆWell-Known Textï¼‰æ ¼å¼ï¼Œå¦‚ï¼š<code>POLYGON((x1 y1, x2 y2, ...))</code></td></tr><tr><td>åæ ‡ç³»ç»Ÿ</td><td><code>SPHERICAL</code>ï¼ˆçƒé¢åæ ‡ï¼Œç»çº¬åº¦ï¼‰<br><code>FLAT</code>ï¼ˆå¹³é¢åæ ‡ï¼Œç¬›å¡å°” X/Yï¼‰</td></tr><tr><td>é»˜è®¤åæ ‡ç³»ç»Ÿ</td><td><code>SPHERICAL</code></td></tr><tr><td>å½“å‰é™åˆ¶</td><td>âŒ ä¸æ”¯æŒ JSON å¤šå€¼<br>âŒ ä¸æ”¯æŒ <code>SORTABLE</code> é€‰é¡¹</td></tr></tbody></table><blockquote><p>ç´¢å¼•å­—æ®µç±»å‹é€‰å‹å»ºè®®</p></blockquote><table><thead><tr><th>ä½¿ç”¨åœºæ™¯</th><th>æ¨èå­—æ®µç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å…¨æ–‡æ£€ç´¢</td><td><strong>TEXT</strong></td><td>æ”¯æŒåˆ†è¯ã€ç›¸å…³åº¦è®¡ç®—ã€æ¨¡ç³ŠåŒ¹é…ç­‰å…¨æ–‡æœç´¢èƒ½åŠ›</td></tr><tr><td>ç²¾ç¡®è¿‡æ»¤ / åˆ†ç±»</td><td><strong>TAG</strong></td><td>ç²¾ç¡®åŒ¹é…ï¼Œä¸åˆ†è¯ï¼Œé€‚åˆæšä¸¾å€¼ã€çŠ¶æ€ã€ç±»å‹ç­‰å­—æ®µ</td></tr><tr><td>åŒºé—´ç­›é€‰ / æ’åº</td><td><strong>NUMERIC</strong></td><td>æ”¯æŒæ•°å€¼åŒºé—´æŸ¥è¯¢ä¸æ’åºï¼Œé€‚åˆä»·æ ¼ã€æ—¶é—´ã€åˆ†æ•°ç­‰</td></tr><tr><td>é™„è¿‘çš„äºº / é—¨åº—</td><td><strong>GEO</strong></td><td>åŸºäºç»çº¬åº¦ç‚¹è¿›è¡ŒåŠå¾„èŒƒå›´æŸ¥è¯¢</td></tr><tr><td>è¯­ä¹‰æœç´¢ / å‘é‡å¬å›</td><td><strong>VECTOR</strong></td><td>åŸºäºå‘é‡ç›¸ä¼¼åº¦ï¼ˆKNNï¼‰çš„è¯­ä¹‰æœç´¢ï¼Œéœ€è¦ Dialect â‰¥ 2</td></tr><tr><td>å¤æ‚åœ°ç†åŒºåŸŸåˆ¤æ–­</td><td><strong>GEOSHAPE</strong></td><td>æ”¯æŒå¤šè¾¹å½¢ï¼ˆPolygonï¼‰åŒºåŸŸæŸ¥è¯¢ï¼Œé€‚åˆè¡Œæ”¿åŒºã€å•†åœˆç­‰</td></tr></tbody></table><blockquote><p>å“ªäº›å­—æ®µé€‚åˆä½¿ç”¨ SORTABLE</p></blockquote><table><thead><tr><th>å­—æ®µç±»å‹</th><th>æ˜¯å¦é€‚åˆ SORTABLE</th><th>åŸå› </th></tr></thead><tbody><tr><td>NUMERIC</td><td>âœ… å¼ºçƒˆæ¨è</td><td>æ•°å€¼æ’åºæœ€å¸¸è§ï¼Œå¦‚ä»·æ ¼ã€æ—¶é—´ã€è¯„åˆ†</td></tr><tr><td>TAG</td><td>âš ï¸ è§†æƒ…å†µ</td><td>ä¸€èˆ¬ç”¨äºè¿‡æ»¤ï¼Œæ’åºæ„ä¹‰ä¸å¤§</td></tr><tr><td>TEXT</td><td>âš ï¸ è°¨æ…</td><td>æ–‡æœ¬å¯èƒ½å¾ˆå¤§ï¼Œå†…å­˜å¼€é”€é«˜</td></tr><tr><td>GEO</td><td>âš ï¸ ç‰¹æ®Šåœºæ™¯</td><td>é€šå¸¸æŒ‰è·ç¦»æ’åºï¼Œæ›´å¤šä¾èµ– <code>GEOFILTER</code></td></tr></tbody></table><div class="tips"><p><em><strong>å°è´´å£«ï¼šå¦‚ä½•åœ¨redisç»ˆç«¯è¾“å…¥å¤šè¡Œçš„å‘½ä»¤ï¼Ÿ</strong></em></p><ul class="lvl-1"><li class="lvl-2">å…ˆè¯´ç»“è®ºï¼šredisç»ˆç«¯ ä¸æ”¯æŒå¤šè¡Œè¾“å…¥ï¼Œä½†å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¾“å…¥å¤šè¡Œå‘½ä»¤ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis-cli &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">HSET user:1 \</span></span><br><span class="line"><span class="string">name Tom \</span></span><br><span class="line"><span class="string">age 18 \</span></span><br><span class="line"><span class="string">city Beijing</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">è¿™ç§æ–¹æ³•æ˜¯åˆ©ç”¨äº† Bash çš„èƒ½åŠ›ï¼Œå³ <code>&lt;&lt;EOF</code> åé¢çš„å†…å®¹ä¼šä½œä¸ºæ ‡å‡†è¾“å…¥ï¼Œç›´åˆ° <code>EOF</code> ä¸ºæ­¢ï¼Œå¹¶é€šè¿‡ <code>\</code> ç¬¦æ¢è¡Œã€‚</li><li class="lvl-2">å¦‚æœåœ¨VSCodeä¸­ï¼Œå¯ä»¥é€‰ä¸­è¦åˆå¹¶çš„å¤šè¡Œå†…å®¹ï¼Œç„¶åé€šè¿‡ <code>Ctrl + Shift + J</code> å¿«æ·é”®å°†å¤šè¡Œåˆå¹¶åˆ°ä¸€è¡Œã€‚</li></ul></div><h4 id="2ï¸âƒ£-FT-ALTER">2ï¸âƒ£ FT.ALTER</h4><blockquote><p>âš ï¸ åªèƒ½ æ–°å¢å­—æ®µï¼Œä¸èƒ½ä¿®æ”¹æˆ–åˆ é™¤å·²æœ‰å­—æ®µ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FT.ALTER idx:user SCHEMA ADD $.vip AS vip TAG</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rSearch.alter(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        FieldIndex.tag(<span class="string">&quot;$.vip&quot;</span>).as(<span class="string">&quot;vip&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="3ï¸âƒ£-FT-DROPINDEX">3ï¸âƒ£ FT.DROPINDEX</h4><blockquote><p>âš ï¸ åˆ é™¤ç´¢å¼•</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FT.DROPINDEX idx:user</span><br><span class="line"><span class="comment"># âš ï¸ DDï¼šåˆ é™¤ç´¢å¼•çš„åŒæ—¶åˆ é™¤è¢«ç´¢å¼•æ•°æ®ï¼Œè°¨æ…ä½¿ç”¨</span></span><br><span class="line">FT.DROPINDEX idx:user DD</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rSearch.dropIndex(<span class="string">&quot;idx:user&quot;</span>);</span><br><span class="line">rSearch.dropIndexAndDocuments(<span class="string">&quot;idx:user&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="4ï¸âƒ£-FT-INFO">4ï¸âƒ£ <a href="http://FT.INFO">FT.INFO</a></h4><blockquote><p>æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FT.INFO idx:user</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">IndexInfo</span> <span class="variable">info</span> <span class="operator">=</span> rSearch.info(<span class="string">&quot;idx:user&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>é‡ç‚¹å…³æ³¨å­—æ®µ</p></blockquote><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><code>num_docs</code></td><td><strong>å½“å‰è¢«ç´¢å¼•ã€å¯è¢«æœç´¢çš„æ–‡æ¡£æ•°é‡</strong></td><td>user:10001 ~ user:10010ï¼Œ10æ¡æ–‡æ¡£</td></tr><tr><td><code>num_terms</code></td><td><strong>è¯å…¸ä¸­å”¯ä¸€è¯é¡¹ term çš„æ•°é‡</strong><br><strong>ä¸»è¦æ¥æºäº TEXTï¼ˆnameï¼‰ å’Œ TAGï¼ˆvip, statusï¼‰ å­—æ®µå»é‡ä¹‹åçš„æ•°é‡</strong></td><td>name: alice, bob, carol, â€¦<br>vip: yes, no<br>status: PAID, CREATED, CANCELLED<br></td></tr><tr><td><code>num_records</code></td><td><strong>å€’æ’ç´¢å¼•ä¸­çš„è®°å½•æ¡ç›®æ€»æ•°</strong><br><strong>æ‰€æœ‰ term åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­çš„å‡ºç°æ¬¡æ•°ä¹‹å’Œ</strong></td><td>JSON æ•°ç»„å­—æ®µ orders[],æ¯ä¸ª order éƒ½ä¼šç”Ÿæˆç‹¬ç«‹çš„ç´¢å¼• entry<br>å¤šå€¼å­—æ®µ Ã— å¤šæ–‡æ¡£ = record çˆ†ç‚¸å¼å¢é•¿<br><br>num_records çœŸæ­£å½±å“ï¼šå†…å­˜ã€æŸ¥è¯¢é€Ÿåº¦ã€èšåˆæˆæœ¬</td></tr></tbody></table><h4 id="5ï¸âƒ£-FT-LIST">5ï¸âƒ£ FT._LIST</h4><blockquote><p>åˆ—å‡ºæ‰€æœ‰ç´¢å¼•</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FT._LIST</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; indexes = rSearch.getIndexes();</span><br></pre></td></tr></table></figure><h3 id="äºŒã€æŸ¥è¯¢ç±»ï¼ˆæ ¸å¿ƒï¼‰">äºŒã€æŸ¥è¯¢ç±»ï¼ˆæ ¸å¿ƒï¼‰</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>FT.SEARCH</code></td><td>æ ‡å‡†æœç´¢</td><td>90% åœºæ™¯</td></tr><tr><td><code>FT.AGGREGATE</code></td><td>åˆ†ç»„ / ç»Ÿè®¡ / èšåˆ</td><td>æŠ¥è¡¨ã€åˆ†æ</td></tr><tr><td><code>FT.HYBRID</code></td><td>æ–‡æœ¬ + å‘é‡æ··åˆ</td><td>å‘é‡æœç´¢</td></tr><tr><td><code>FT.EXPLAIN</code></td><td>æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’</td><td>è°ƒä¼˜</td></tr><tr><td><code>FT.EXPLAINCLI</code></td><td>CLI å¯è¯»æ‰§è¡Œè®¡åˆ’</td><td>è°ƒè¯•</td></tr><tr><td><code>FT.PROFILE</code></td><td>æ€§èƒ½åˆ†æ</td><td>æ…¢æŸ¥è¯¢</td></tr></tbody></table><h4 id="1ï¸âƒ£-FT-SEARCH">1ï¸âƒ£ FT.SEARCH</h4><ul class="lvl-0"><li class="lvl-2"><p>FT.SEARCH åŸºæœ¬è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">FT.SEARCH index query</span><br><span class="line">[NOCOENTENT] [VERBATIM] [NOSTOPWORDS]</span><br><span class="line">[WITHSCORES] [WITHPAYLOADS] [WITHSORTKEYS]</span><br><span class="line">[FILTER numeric_field min max ...]</span><br><span class="line">[GEOFILTER geo_field lon lat radius m|km|mi|ft]</span><br><span class="line">[INKEYS count key ...]</span><br><span class="line">[INFIELDS count field ...]</span><br><span class="line">[RETURN count identifier [AS property] ...]</span><br><span class="line">[SUMMARIZE FIELDS count field ... FRAGS num LEN fragsize SEPARATOR sep]</span><br><span class="line">[HIGHLIGHT FIELDS count field ... TAGS open close]</span><br><span class="line">[SLOP slop] [TIMEOUT <span class="built_in">timeout</span>] [INORDER]</span><br><span class="line">[LANGUAGE language]</span><br><span class="line">[EXPANDER expander]</span><br><span class="line">[SCORER scorer]</span><br><span class="line">[EXPLAINSCORE]</span><br><span class="line">[PAYLOAD payload]</span><br><span class="line">[SORTBY sortby ASC|DESC]</span><br><span class="line">[LIMIT offset num]</span><br><span class="line">[PARAMS nargs name value ...]</span><br><span class="line">[DIALECT dialect]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>FT.SEARCH å‚æ•°è¯´æ˜è¡¨</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><code>index</code></td><td>ç´¢å¼•åç§°</td></tr><tr><td><code>query</code></td><td>æŸ¥è¯¢æ¡ä»¶ï¼ˆç±»ä¼¼ SQL WHEREï¼‰</td></tr><tr><td><code>NOCONTENT</code></td><td>ä»…è¿”å›æ–‡æ¡£ IDï¼Œä¸è¿”å›å†…å®¹</td></tr><tr><td><code>VERBATIM</code></td><td>ç¦ç”¨æŸ¥è¯¢ä¼˜åŒ–ï¼Œå®Œå…¨æŒ‰åŸæŸ¥è¯¢æ‰§è¡Œ</td></tr><tr><td><code>NOSTOPWORDS</code></td><td>æŸ¥è¯¢æ—¶ä¸å¿½ç•¥åœç”¨è¯</td></tr><tr><td><code>WITHSCORES</code></td><td>è¿”å›åŒ¹é…æ–‡æ¡£çš„ç›¸å…³æ€§è¯„åˆ†</td></tr><tr><td><code>WITHPAYLOADS</code></td><td>è¿”å›æ–‡æ¡£çš„ payload æ•°æ®</td></tr><tr><td><code>WITHSORTKEYS</code></td><td>è¿”å›æ’åºä½¿ç”¨çš„ key</td></tr><tr><td><code>FILTER</code></td><td>æ•°å€¼å­—æ®µè¿‡æ»¤ï¼ˆèŒƒå›´æŸ¥è¯¢ï¼‰</td></tr><tr><td><code>GEOFILTER</code></td><td>åœ°ç†ä½ç½®èŒƒå›´æŸ¥è¯¢</td></tr><tr><td><code>INKEYS</code></td><td>ä»…åœ¨æŒ‡å®šçš„ key é›†åˆä¸­æœç´¢</td></tr><tr><td><code>INFIELDS</code></td><td>ä»…åœ¨æŒ‡å®šå­—æ®µä¸­æœç´¢</td></tr><tr><td><code>RETURN</code></td><td>æŒ‡å®šè¿”å›çš„å­—æ®µ</td></tr><tr><td><code>SUMMARIZE</code></td><td>è¿”å›å­—æ®µå†…å®¹æ‘˜è¦</td></tr><tr><td><code>HIGHLIGHT</code></td><td>é«˜äº®åŒ¹é…çš„å…³é”®è¯</td></tr><tr><td><code>SLOP</code></td><td>è®¾ç½®çŸ­è¯­æŸ¥è¯¢ä¸­å…è®¸çš„è¯è·</td></tr><tr><td><code>TIMEOUT</code></td><td>è®¾ç½®æŸ¥è¯¢è¶…æ—¶æ—¶é—´</td></tr><tr><td><code>INORDER</code></td><td>çŸ­è¯­å¿…é¡»æŒ‰é¡ºåºåŒ¹é…</td></tr><tr><td><code>LANGUAGE</code></td><td>æŒ‡å®šæŸ¥è¯¢è¯­è¨€</td></tr><tr><td><code>EXPANDER</code></td><td>ä½¿ç”¨è‡ªå®šä¹‰æŸ¥è¯¢æ‰©å±•å™¨</td></tr><tr><td><code>SCORER</code></td><td>ä½¿ç”¨è‡ªå®šä¹‰è¯„åˆ†å‡½æ•°</td></tr><tr><td><code>EXPLAINSCORE</code></td><td>è¿”å›è¯„åˆ†è®¡ç®—è¯¦æƒ…</td></tr><tr><td><code>PAYLOAD</code></td><td>ç»™è¯„åˆ†å‡½æ•°ä¼ å…¥è‡ªå®šä¹‰å‚æ•°</td></tr><tr><td><code>SORTBY</code></td><td>æŒ‰æŒ‡å®šå­—æ®µæ’åº</td></tr><tr><td><code>ASC / DESC</code></td><td>æ’åºæ–¹å‘</td></tr><tr><td><code>LIMIT</code></td><td>åˆ†é¡µæ§åˆ¶</td></tr><tr><td><code>PARAMS</code></td><td>å‚æ•°åŒ–æŸ¥è¯¢</td></tr><tr><td><code>DIALECT</code></td><td>æŒ‡å®šæŸ¥è¯¢è¯­æ³•ç‰ˆæœ¬</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>FT.SEARCH æ ¸å¿ƒè¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FT.SEARCH index</span><br><span class="line">query</span><br><span class="line">[RETURN count identifier [AS property] ...]</span><br><span class="line">[SORTBY sortby ASC|DESC]</span><br><span class="line">[LIMIT offset num]</span><br></pre></td></tr></table></figure><blockquote><p>æ ‡å‡†æœç´¢</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">FT.SEARCH idx:user</span><br><span class="line">  <span class="string">&#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27;</span></span><br><span class="line">  RETURN 3 name status amount</span><br><span class="line">  SORTBY amount DESC</span><br><span class="line">  LIMIT 0 10</span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line">  <span class="comment"># æŸ¥è¯¢æ¡ä»¶ï¼š&#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27;</span></span><br><span class="line">  <span class="comment"># æŸ¥è¯¢æ¡ä»¶è¯­æ³•ï¼š</span></span><br><span class="line">  <span class="comment"># &#x27;xxx&#x27;: å…¨æ–‡æ£€ç´¢åŒ…å« xxx çš„æ•°æ®ï¼Œä¼šä» TEXT å­—æ®µä¸­åŒ¹é…</span></span><br><span class="line">  <span class="comment"># &#x27;@field:value&#x27;: åŒ¹é…å­—æ®µ field çš„å€¼æ˜¯ valueï¼Œè¦æ±‚ field çš„ç±»å‹ä¸º TEXTï¼Œå…¨æ–‡æ£€ç´¢</span></span><br><span class="line">  <span class="comment"># &#x27;@field:&#123;xxx&#125;&#x27;:ç²¾ç¡®åŒ¹é…ï¼Œ&#123;xxx*&#125;:åŒ¹é…å‰ç¼€ï¼Œ&#123;xxx|yyy&#125;:åŒ¹é…ä»»æ„ä¸€ä¸ªï¼Œè¦æ±‚ field çš„ç±»å‹ä¸º TAG</span></span><br><span class="line">  <span class="comment"># &#x27;@field:[min max]&#x27;: èŒƒå›´åŒ¹é…ï¼Œè¿™é‡Œ +inf è¡¨ç¤ºæ­£æ— ç©·å¤§ï¼Œè¦æ±‚ field çš„ç±»å‹ä¸º NUMERIC</span></span><br><span class="line">  <span class="comment"># å¤šä¸ªæ¡ä»¶ç©ºæ ¼åˆ†éš”</span></span><br><span class="line">  <span class="comment"># æ¨¡ç³ŠåŒ¹é…ï¼š* è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œå³åŒ¹é…æ‰€æœ‰</span></span><br><span class="line"><span class="comment"># RETURN 3 name status amount è¿”å›å­—æ®µï¼Œ3:è¡¨ç¤ºè¿”å› 3 ä¸ªå­—æ®µ</span></span><br><span class="line"><span class="comment"># LIMIT 0 10 åˆ†é¡µï¼Œ0:è¡¨ç¤ºä»ç¬¬ 0 æ¡å¼€å§‹ï¼Œ10:è¡¨ç¤ºè¿”å› 10 æ¡æ•°æ®</span></span><br><span class="line"><span class="comment"># SORTBY amount DESC æ’åºï¼Œamount:è¡¨ç¤ºæ’åºå­—æ®µï¼ŒDESC:è¡¨ç¤ºé™åº</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SearchResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.search(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@status:&#123;PAID&#125; @amount:[50 +inf]&quot;</span>,</span><br><span class="line">        QueryOptions.defaults()</span><br><span class="line">        .returnAttributes(<span class="keyword">new</span> <span class="title class_">ReturnAttribute</span>(<span class="string">&quot;name&quot;</span>), <span class="keyword">new</span> <span class="title class_">ReturnAttribute</span>(<span class="string">&quot;status&quot;</span>),<span class="keyword">new</span> <span class="title class_">ReturnAttribute</span>(<span class="string">&quot;amount&quot;</span>))</span><br><span class="line">                .sortBy(<span class="string">&quot;amount&quot;</span>)</span><br><span class="line">                .sortOrder(SortOrder.DESC)</span><br><span class="line">                .limit(<span class="number">0</span>, <span class="number">10</span>));</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> result.getTotal();</span><br><span class="line">System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line">List&lt;Document&gt; docs = result.getDocuments();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Document doc: docs) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> doc.getId();</span><br><span class="line">    Map&lt;String, Object&gt; attrs = doc.getAttributes();</span><br><span class="line">    System.out.println(<span class="string">&quot;id = &quot;</span> + id + <span class="string">&quot; attrs = &quot;</span> + attrs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¨æ–‡æ£€ç´¢ï¼Œä» æ‰€æœ‰ TEXT å­—æ®µä¸­åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œå³ phone/Phone/PHONE éƒ½åŒ¹é…</span></span><br><span class="line">FT.SEARCH idx:user <span class="string">&#x27;phone&#x27;</span></span><br><span class="line"><span class="comment">## ç¤ºä¾‹ç»“æœ</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 2</span><br><span class="line">2) <span class="string">&quot;user:10006&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Frank\&quot;,\&quot;age\&quot;:27,\&quot;vip\&quot;:\&quot;no\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:499,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;,&#123;\&quot;amount\&quot;:129,\&quot;status\&quot;:\&quot;CREATED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a phone\&quot;,\&quot;items\&quot;:[\&quot;Redis\xe5\xbc\x80\xe5\x8f\x91\xe5\xae\x9e\xe6\x88\x98\&quot;,\&quot;MongoDB\xe4\xbb\x8e\xe5\x85\xa5\xe9\x97\xa8\xe5\x88\xb0\xe5\xae\x9e\xe6\x88\x98\&quot;]&#125;&quot;</span></span><br><span class="line">4) <span class="string">&quot;user:10001&quot;</span></span><br><span class="line">5) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Alice Bob\&quot;,\&quot;age\&quot;:28,\&quot;vip\&quot;:\&quot;yes\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:199.99,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;,&#123;\&quot;amount\&quot;:59.9,\&quot;status\&quot;:\&quot;CREATED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a phone\&quot;,\&quot;items\&quot;:[\&quot;SpringCloud\xe6\x8a\x80\xe6\x9c\xaf\xe6\x8c\x87\xe5\x8d\x97\&quot;,\&quot;Shell\xe8\x84\x9a\xe6\x9c\xac\xe5\x9f\xba\xe7\xa1\x80\&quot;]&#125;&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SearchResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.search(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;phone&quot;</span>,</span><br><span class="line">        QueryOptions.defaults()</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸­æ–‡æ£€ç´¢</span></span><br><span class="line">FT.SEARCH idx:user <span class="string">&#x27;å¼€å§‹&#x27;</span></span><br><span class="line"><span class="comment">## ç¤ºä¾‹ç»“æœ</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 2</span><br><span class="line">2) <span class="string">&quot;user:10005&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Eve\&quot;,\&quot;age\&quot;:30,\&quot;vip\&quot;:\&quot;no\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:88.8,\&quot;status\&quot;:\&quot;CREATED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a pencil\&quot;,\&quot;items\&quot;:[\&quot;Kafka\xe4\xbb\x8e\xe9\x9b\xb6\xe5\xbc\x80\xe5\xa7\x8b\&quot;,\&quot;Java\xe7\x94\xb1\xe6\xb5\x85\xe5\x85\xa5\xe6\xb7\xb1\&quot;]&#125;&quot;</span></span><br><span class="line">4) <span class="string">&quot;user:10007&quot;</span></span><br><span class="line">5) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Grace\&quot;,\&quot;age\&quot;:33,\&quot;vip\&quot;:\&quot;yes\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:999.9,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a book\&quot;,\&quot;items\&quot;:[\&quot;Android\xe5\xbc\x80\xe5\x8f\x91\xe6\x89\x8b\xe5\x86\x8c\&quot;,\&quot;Gradle\xe4\xbb\x8e\xe9\x9b\xb6\xe5\xbc\x80\xe5\xa7\x8b\&quot;]&#125;&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SearchResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.search(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;å¼€å§‹&quot;</span>,</span><br><span class="line">        QueryOptions.defaults()</span><br><span class="line">);</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">çœ‹åˆ°ä¸­æ–‡è¾“å‡ºæ˜¯ä¹±ç ï¼Œå¯ä»¥åœ¨ç™»å½•å®¢æˆ·ç«¯æ—¶åŠ ä¸Š --raw</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --user admin -a 123456 --raw</span><br><span class="line">127.0.0.1:6379&gt; FT.SEARCH idx:user <span class="string">&#x27;å¼€å§‹&#x27;</span></span><br><span class="line">2</span><br><span class="line">user:10005</span><br><span class="line">$</span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Eve&quot;</span>,<span class="string">&quot;age&quot;</span>:30,<span class="string">&quot;vip&quot;</span>:<span class="string">&quot;no&quot;</span>,<span class="string">&quot;orders&quot;</span>:[&#123;<span class="string">&quot;amount&quot;</span>:88.8,<span class="string">&quot;status&quot;</span>:<span class="string">&quot;CREATED&quot;</span>&#125;],<span class="string">&quot;comment&quot;</span>:<span class="string">&quot;I have a pencil&quot;</span>,<span class="string">&quot;items&quot;</span>:[<span class="string">&quot;Kafkaä»é›¶å¼€å§‹&quot;</span>,<span class="string">&quot;Javaç”±æµ…å…¥æ·±&quot;</span>]&#125;</span><br><span class="line">user:10007</span><br><span class="line">$</span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Grace&quot;</span>,<span class="string">&quot;age&quot;</span>:33,<span class="string">&quot;vip&quot;</span>:<span class="string">&quot;yes&quot;</span>,<span class="string">&quot;orders&quot;</span>:[&#123;<span class="string">&quot;amount&quot;</span>:999.9,<span class="string">&quot;status&quot;</span>:<span class="string">&quot;PAID&quot;</span>&#125;],<span class="string">&quot;comment&quot;</span>:<span class="string">&quot;I have a book&quot;</span>,<span class="string">&quot;items&quot;</span>:[<span class="string">&quot;Androidå¼€å‘æ‰‹å†Œ&quot;</span>,<span class="string">&quot;Gradleä»é›¶å¼€å§‹&quot;</span>]&#125;</span><br></pre></td></tr></table></figure></div><h5 id="SQL-WHERE-ä¸-RediSearch-æŸ¥è¯¢è¯­æ³•å¯¹ç…§è¡¨">SQL WHERE ä¸ RediSearch æŸ¥è¯¢è¯­æ³•å¯¹ç…§è¡¨</h5><ul class="lvl-0"><li class="lvl-2"><p><code>x/y/name</code> â†’ <code>TEXT/TAG(è¦åŠ ä¸Š&#123;&#125;)</code> å­—æ®µï¼Œ<code>num</code>â†’<code>NUMERIC</code> å­—æ®µï¼ŒæŸ¥è¯¢è¯­æ³•ç”¨äº <code>FT.SEARCH</code>/<code>FT.AGGREGATE</code> çš„æŸ¥è¯¢å­—ç¬¦ä¸²éƒ¨åˆ†</p></li></ul><table><thead><tr><th>ID</th><th>SQL æ¡ä»¶</th><th>RediSearch å¯¹ç­‰å†™æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>1</td><td><code>WHERE x = 'book' AND y = 'phone'</code></td><td><code>@x:book @y:phone</code></td><td>AND ä¸ºé»˜è®¤å…³ç³»ï¼ˆç©ºæ ¼ï¼‰</td></tr><tr><td>2</td><td><code>WHERE x = 'book' AND y != 'phone'</code></td><td><code>@x:book -@y:phone</code></td><td><code>-</code> è¡¨ç¤º NOT</td></tr><tr><td>3</td><td><code>WHERE x = 'book' OR y = 'phone'</code></td><td><code>(@x:book) | (@y:phone)</code></td><td>OR å¿…é¡»æ˜¾å¼å†™ <code>|</code></td></tr><tr><td>4</td><td><code>WHERE x IN ('book','phone','hello world')</code></td><td><code>@x:(book|phone|&quot;hello world&quot;)</code></td><td>å¤šå€¼ ORï¼ŒçŸ­è¯­éœ€åŠ å¼•å·</td></tr><tr><td>5</td><td><code>WHERE y='book' AND x NOT IN ('book','phone')</code></td><td><code>@y:book -(@x:book|@x:phone)</code></td><td>NOT IN = NOT + OR</td></tr><tr><td>6</td><td><code>WHERE x NOT IN ('book','phone')</code></td><td><code>-@x:(book|phone)</code></td><td>æ•´ä½“å¦å®š</td></tr><tr><td>7</td><td><code>WHERE num BETWEEN 10 AND 20</code></td><td><code>@num:[10 20]</code></td><td>æ•°å€¼åŒºé—´ï¼ˆé—­åŒºé—´ï¼‰</td></tr><tr><td>8</td><td><code>WHERE num &gt;= 10</code></td><td><code>@num:[10 +inf]</code></td><td><code>+inf</code> è¡¨ç¤ºæ­£æ— ç©·</td></tr><tr><td>9</td><td><code>WHERE num &gt; 10</code></td><td><code>@num:[(10 +inf]</code></td><td><code>(</code> è¡¨ç¤ºä¸åŒ…å«</td></tr><tr><td>10</td><td><code>WHERE num &lt; 10</code></td><td><code>@num:[-inf (10]</code></td><td>å°äºï¼ˆä¸å« 10ï¼‰</td></tr><tr><td>11</td><td><code>WHERE num &lt;= 10</code></td><td><code>@num:[-inf 10]</code></td><td>å°äºç­‰äº</td></tr><tr><td>12</td><td><code>WHERE num &lt; 10 OR num &gt; 20</code></td><td><code>@num:[-inf (10] | @num:[(20 +inf]</code></td><td>æ•°å€¼ OR</td></tr><tr><td>13</td><td><code>WHERE name LIKE 'Li%'</code></td><td><code>@name:Li*</code></td><td>å‰ç¼€åŒ¹é…</td></tr></tbody></table><h4 id="2ï¸âƒ£-FT-AGGREGATE">2ï¸âƒ£ FT.AGGREGATE</h4><blockquote><p>åˆ†ç»„ / ç»Ÿè®¡ / èšåˆï¼Œè¯­æ³•</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>FT.AGGREGATE åŸºæœ¬è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE index query</span><br><span class="line">[VERBATIM]</span><br><span class="line">[LOAD count field ... | LOAD *]</span><br><span class="line">[TIMEOUT <span class="built_in">timeout</span>]</span><br><span class="line">[GROUPBY nargs property ...</span><br><span class="line">   REDUCE <span class="keyword">function</span> nargs arg ... [AS name] ...]</span><br><span class="line">[SORTBY nargs property ASC|DESC ... [MAX num]]</span><br><span class="line">[APPLY expression AS name]</span><br><span class="line">[LIMIT offset num]</span><br><span class="line">[FILTER filter]</span><br><span class="line">[WITHCURSOR [COUNT read_size]]</span><br><span class="line">[MAXIDLE idle_time]</span><br><span class="line">[PARAMS nargs name value ...]</span><br><span class="line">[DIALECT dialect]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>FT.AGGREGATE å‚æ•°è¯´æ˜è¡¨</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><code>index</code></td><td>ç´¢å¼•åç§°</td></tr><tr><td><code>query</code></td><td>æŸ¥è¯¢æ¡ä»¶ï¼ˆç±»ä¼¼ WHEREï¼‰</td></tr><tr><td><code>VERBATIM</code></td><td>ç¦ç”¨æŸ¥è¯¢ä¼˜åŒ–</td></tr><tr><td><code>LOAD</code></td><td>åŠ è½½åŸå§‹å­—æ®µ</td></tr><tr><td><code>TIMEOUT</code></td><td>æŸ¥è¯¢è¶…æ—¶æ—¶é—´</td></tr><tr><td><code>GROUPBY</code></td><td>åˆ†ç»„å­—æ®µï¼ˆç±»ä¼¼ SQL GROUP BYï¼‰</td></tr><tr><td><code>REDUCE</code></td><td>èšåˆå‡½æ•°ï¼ˆCOUNT / SUM / AVG / MIN / MAX ç­‰ï¼‰</td></tr><tr><td><code>AS</code></td><td>èšåˆç»“æœåˆ«å</td></tr><tr><td><code>SORTBY</code></td><td>å¯¹èšåˆç»“æœæ’åº</td></tr><tr><td><code>ASC / DESC</code></td><td>æ’åºæ–¹å‘</td></tr><tr><td><code>MAX</code></td><td>æœ€å¤§è¿”å›æ¡æ•°</td></tr><tr><td><code>APPLY</code></td><td>å¯¹ç»“æœå­—æ®µè¿›è¡Œè¡¨è¾¾å¼è®¡ç®—</td></tr><tr><td><code>LIMIT</code></td><td>åˆ†é¡µæ§åˆ¶</td></tr><tr><td><code>FILTER</code></td><td>ç»“æœè¿‡æ»¤ï¼ˆWHERE / HAVINGï¼‰</td></tr><tr><td><code>WITHCURSOR</code></td><td>ä½¿ç”¨æ¸¸æ ‡ï¼ˆå¤§ç»“æœé›†ï¼‰</td></tr><tr><td><code>COUNT</code></td><td>æ¯æ¬¡è¯»å–æ•°é‡</td></tr><tr><td><code>MAXIDLE</code></td><td>æ¸¸æ ‡æœ€å¤§ç©ºé—²æ—¶é—´</td></tr><tr><td><code>PARAMS</code></td><td>å‚æ•°åŒ–æŸ¥è¯¢</td></tr><tr><td><code>DIALECT</code></td><td>æŸ¥è¯¢è¯­æ³•ç‰ˆæœ¬</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>FT.AGGREGATE çš„æ ¸å¿ƒè¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE &lt;index&gt; &lt;query&gt;</span><br><span class="line">  [GROUPBY ...]</span><br><span class="line">  [REDUCE ...]</span><br><span class="line">  [SORTBY ...]</span><br><span class="line">  [LIMIT ...]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ 1ï¼šæŒ‰ status åˆ†ç»„ç»Ÿè®¡æ•°é‡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE idx:user</span><br><span class="line">  <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE COUNT 0 AS cnt</span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># *: æŸ¥è¯¢æ¡ä»¶ï¼Œ* è¡¨ç¤ºåŒ¹é…ç´¢å¼•ä¸­çš„ æ‰€æœ‰æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥æ˜¯ FT.SEARCH ä¸­çš„æŸ¥è¯¢æ¡ä»¶ï¼Œæ¯”å¦‚ï¼š&#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27;</span></span><br><span class="line"><span class="comment"># GROUPBY 1 @status: åˆ†ç»„å­—æ®µ</span></span><br><span class="line">  <span class="comment"># 1:è¡¨ç¤ºåˆ†ç»„å­—æ®µæ•°é‡</span></span><br><span class="line">  <span class="comment"># @status:è¡¨ç¤ºåˆ†ç»„å­—æ®µ</span></span><br><span class="line"><span class="comment"># REDUCE COUNT 0 AS cnt: èšåˆå­—æ®µ</span></span><br><span class="line">  <span class="comment"># COUNT:èšåˆå‡½æ•°ï¼šè®¡æ•°</span></span><br><span class="line">  <span class="comment"># 0:å‚æ•°ä¸ªæ•°ï¼ˆCOUNT ä¸éœ€è¦å‚æ•°ï¼‰</span></span><br><span class="line">  <span class="comment"># AS cnt:è¡¨ç¤ºèšåˆå­—æ®µåˆ«å</span></span><br><span class="line"><span class="comment">## è¿”å›ç»“æœç¤ºä¾‹</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 3</span><br><span class="line">2) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CANCELLED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;2&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;PAID&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;6&quot;</span></span><br><span class="line">4) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CREATED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹åº”SQL è¯­å¥ï¼š</span></span><br><span class="line">SELECT status, COUNT(*) AS cnt</span><br><span class="line">  FROM user</span><br><span class="line">  GROUP BY status;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AggregationResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.aggregate(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        AggregationOptions.defaults()</span><br><span class="line">                .groupBy(GroupBy.fieldNames(<span class="string">&quot;@status&quot;</span>).reducers(Reducer.count().as(<span class="string">&quot;cnt&quot;</span>)))</span><br><span class="line">);</span><br><span class="line"><span class="keyword">final</span> <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> result.getTotal();</span><br><span class="line">System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line"><span class="keyword">final</span> List&lt;Map&lt;String, Object&gt;&gt; attributes = result.getAttributes();</span><br><span class="line"><span class="keyword">for</span> (Map&lt;String, Object&gt; attribute : attributes) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;attribute = &quot;</span> + attribute);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ 2ï¼šæŒ‰ status åˆ†ç»„ç»Ÿè®¡é‡‘é¢æ€»å’Œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE idx:user <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE SUM 1 @amount AS total_amount</span><br><span class="line">  SORTBY 2 @total_amount DESC</span><br><span class="line">  LIMIT 0 3</span><br><span class="line"></span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># SUM:èšåˆå‡½æ•°ï¼šæ±‚å’Œ</span></span><br><span class="line"><span class="comment"># 1:å‚æ•°ä¸ªæ•°</span></span><br><span class="line"><span class="comment"># @amount:è¦å‚ä¸æ±‚å’Œçš„å­—æ®µ</span></span><br><span class="line"><span class="comment"># total_amount:è¡¨ç¤ºèšåˆå­—æ®µåˆ«å</span></span><br><span class="line"><span class="comment"># SORTBY 2 @total_amount DESC: æ’åº</span></span><br><span class="line">  <span class="comment"># 2: è¡¨ç¤ºåé¢è·Ÿ 2 ä¸ªå‚æ•°ï¼ˆå­—æ®µ + æ’åºæ–¹å‘ï¼‰</span></span><br><span class="line">  <span class="comment"># @total_amount: è¡¨ç¤ºæ’åºå­—æ®µï¼ˆREDUCE äº§ç”Ÿçš„åˆ«åï¼‰ï¼ŒDESC:è¡¨ç¤ºé™åº</span></span><br><span class="line"><span class="comment"># LIMIT 0 3: åˆ†é¡µï¼Œ0:è¡¨ç¤ºä»ç¬¬ 0 æ¡å¼€å§‹ï¼Œ3:è¡¨ç¤ºè¿”å› 3 æ¡æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ç¤ºä¾‹ç»“æœ</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 3</span><br><span class="line">2) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;PAID&quot;</span></span><br><span class="line">   3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   4) <span class="string">&quot;4096.89&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CREATED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   4) <span class="string">&quot;238.8&quot;</span></span><br><span class="line">4) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CANCELLED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   4) <span class="string">&quot;79.8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹åº”SQL è¯­å¥ï¼š</span></span><br><span class="line">SELECT status, SUM(amount) AS total_amount</span><br><span class="line">  FROM user</span><br><span class="line">  GROUP BY status</span><br><span class="line">  ORDER BY total_amount DESC</span><br><span class="line">  LIMIT 0 3;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AggregationResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.aggregate(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        AggregationOptions.defaults()</span><br><span class="line">                .groupBy(GroupBy.fieldNames(<span class="string">&quot;@status&quot;</span>)</span><br><span class="line">                        .reducers(</span><br><span class="line">                                Reducer.sum(<span class="string">&quot;@amount&quot;</span>).as(<span class="string">&quot;total_amount&quot;</span>)</span><br><span class="line">                        )</span><br><span class="line">                )</span><br><span class="line">                .sortBy(<span class="keyword">new</span> <span class="title class_">SortedField</span>(<span class="string">&quot;@total_amount&quot;</span>, SortOrder.DESC))</span><br><span class="line">                .limit(<span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ 3ï¼šåŒæ—¶è¾“å‡ºæ•°é‡ + é‡‘é¢ï¼Œå¹¶æŒ‰é‡‘é¢é™åºï¼Œæ•°é‡å‡åº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE idx:user <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE COUNT 0 AS cnt</span><br><span class="line">  REDUCE SUM 1 @amount AS total_amount</span><br><span class="line">  SORTBY 4 @total_amount DESC @cnt ASC</span><br><span class="line"></span><br><span class="line"><span class="comment">## ç¤ºä¾‹ç»“æœ</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 3</span><br><span class="line">2) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;PAID&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;6&quot;</span></span><br><span class="line">   5) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   6) <span class="string">&quot;4096.89&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CREATED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;2&quot;</span></span><br><span class="line">   5) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   6) <span class="string">&quot;238.8&quot;</span></span><br><span class="line">4) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CANCELLED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;2&quot;</span></span><br><span class="line">   5) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   6) <span class="string">&quot;79.8&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AggregationResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.aggregate(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        AggregationOptions.defaults()</span><br><span class="line">                .groupBy(GroupBy.fieldNames(<span class="string">&quot;@status&quot;</span>)</span><br><span class="line">                        .reducers(</span><br><span class="line">                                Reducer.count().as(<span class="string">&quot;cnt&quot;</span>),</span><br><span class="line">                                Reducer.sum(<span class="string">&quot;@amount&quot;</span>).as(<span class="string">&quot;total_amount&quot;</span>)</span><br><span class="line">                        )</span><br><span class="line">                )</span><br><span class="line">                .sortBy(<span class="keyword">new</span> <span class="title class_">SortedField</span>(<span class="string">&quot;@total_amount&quot;</span>, SortOrder.DESC))</span><br><span class="line">                .sortBy(<span class="keyword">new</span> <span class="title class_">SortedField</span>(<span class="string">&quot;@cnt&quot;</span>, SortOrder.ASC))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹ 4ï¼šæŒ‰çŠ¶æ€åˆ†ç»„ï¼Œç­›é€‰æ€»é‡‘é¢ &gt; 200</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE idx:user <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE SUM 1 @amount AS total_amount</span><br><span class="line">  FILTER @total_amount &gt; 200</span><br><span class="line">  SORTBY 2 @total_amount DESC</span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># FILTER: è¿‡æ»¤å™¨ï¼Œä½œç”¨åœ¨ GROUPBY + REDUCE ä¹‹åï¼Œè¯­ä¹‰ç­‰ä»·äº SQL çš„ï¼šHAVING SUM(amount) &gt; 1000</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AggregationResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.aggregate(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        AggregationOptions.defaults()</span><br><span class="line">                .groupBy(GroupBy.fieldNames(<span class="string">&quot;@status&quot;</span>)</span><br><span class="line">                        .reducers(</span><br><span class="line">                                Reducer.sum(<span class="string">&quot;@amount&quot;</span>).as(<span class="string">&quot;total_amount&quot;</span>)</span><br><span class="line">                        )</span><br><span class="line">                )</span><br><span class="line">                .filter(<span class="string">&quot;@total_amount &gt; 200&quot;</span>)</span><br><span class="line">                .sortBy(<span class="keyword">new</span> <span class="title class_">SortedField</span>(<span class="string">&quot;@total_amount&quot;</span>, SortOrder.DESC))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><blockquote><p>è¯­ä¹‰æ‰§è¡Œé¡ºåºï¼š SCAN â†’ GROUPBY â†’ REDUCE â†’ FILTER (HAVING) â†’ SORTBY â†’ LIMIT</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å¸¸è§å¯ç”¨ REDUCE å‡½æ•°</p></li></ul><table><thead><tr><th>å‡½æ•°</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>COUNT</td><td>è¡Œæ•°</td></tr><tr><td>SUM</td><td>æ±‚å’Œ</td></tr><tr><td>AVG</td><td>å¹³å‡</td></tr><tr><td>MIN / MAX</td><td>æå€¼</td></tr><tr><td>TO_LIST</td><td>æ”¶é›†å­—æ®µ</td></tr></tbody></table><h4 id="3ï¸âƒ£-FT-EXPLAIN-FT-EXPLAINCLI">3ï¸âƒ£ FT.EXPLAIN/FT.EXPLAINCLI</h4><blockquote><p>æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œ ä¸ä¼šè€ƒè™‘åˆ†ç»„èšåˆï¼Œåªçœ‹æŸ¥è¯¢æ¡ä»¶ï¼Œå®ƒçš„å®šä½æ˜¯ï¼šçœ‹â€œä¼šä¸ä¼šç”¨ç´¢å¼•ã€æ€ä¹ˆç”¨ç´¢å¼•â€ï¼Œè€Œä¸æ˜¯çœ‹â€œè·‘å¾—æ…¢ä¸æ…¢â€ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FT.EXPLAINCLI idx:user <span class="string">&#x27;@status:&#123;PAID&#125;  @amount:[100 +inf]&#x27;</span></span><br><span class="line"><span class="comment">## ç¤ºä¾‹ç»“æœ</span></span><br><span class="line">1) INTERSECT &#123;</span><br><span class="line">2)   TAG:@status &#123;</span><br><span class="line">3)     paid</span><br><span class="line">4)   &#125;</span><br><span class="line">5)   NUMERIC &#123;100.000000 &lt;= @amount &lt;= inf&#125;</span><br><span class="line">6) &#125;</span><br><span class="line">7)</span><br></pre></td></tr></table></figure><h4 id="4ï¸âƒ£-FT-PROFILE">4ï¸âƒ£ FT.PROFILE</h4><blockquote><p>æ€§èƒ½åˆ†æï¼Œçœ‹â€œè·‘å¾—æ…¢ä¸æ…¢â€ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FT.PROFILE idx:user</span><br><span class="line">  SEARCH</span><br><span class="line">  QUERY <span class="string">&#x27;@status:&#123;PAID&#125;  @amount:[100 +inf]&#x27;</span></span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># SEARCH: æ ‡å‡†æŸ¥è¯¢ï¼ŒAGGREGATE: èšåˆæŸ¥è¯¢</span></span><br><span class="line"><span class="comment"># QUERY: æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line"></span><br><span class="line">FT.PROFILE idx:user</span><br><span class="line">  AGGREGATE</span><br><span class="line">  QUERY <span class="string">&quot;@status:&#123;PAID&#125; @amount:[100 +inf]&quot;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE SUM 1 @amount AS total_amount</span><br></pre></td></tr></table></figure><h5 id="å…³æ³¨æŒ‡æ ‡">å…³æ³¨æŒ‡æ ‡</h5><ul class="lvl-0"><li class="lvl-2"><p>ç¬¬ä¸€ä¼˜å…ˆçº§æŒ‡æ ‡ï¼ˆç›´æ¥å†³å®šæŸ¥è¯¢æ˜¯å¦æ…¢ï¼‰</p></li></ul><table><thead><tr><th>æŒ‡æ ‡</th><th>æ‰€åœ¨ä½ç½®</th><th>å«ä¹‰</th><th>å¥åº·é˜ˆå€¼</th><th>éœ€è¦è­¦æƒ•</th><th>å¸¸è§ä¼˜åŒ–æ‰‹æ®µ</th></tr></thead><tbody><tr><td><strong>Total profile time</strong></td><td>Shards â†’ Total profile time</td><td>æŸ¥è¯¢åœ¨æœç´¢å¼•æ“å±‚é¢çš„æ€»è€—æ—¶ï¼ˆä¸å«ç½‘ç»œï¼‰</td><td><strong>&lt; 1 msï¼šä¼˜ç§€</strong><br>1â€“10 msï¼šå¯æ¥å—</td><td>&gt; 20 msï¼šéœ€è¦ä¼˜åŒ–<br>&gt; 50 msï¼šç»“æ„æ€§é—®é¢˜</td><td>å‡å°‘ç»“æœé›†ã€æ‹†åˆ†æŸ¥è¯¢ã€ä¼˜åŒ–ç´¢å¼•å­—æ®µ</td></tr><tr><td><strong>Iterator Type</strong></td><td>Iterators profile â†’ Type</td><td>æŸ¥è¯¢æ‰§è¡Œç­–ç•¥</td><td><strong>INTERSECT / UNION</strong></td><td><strong>SCAN / WILDCARD</strong></td><td>å¢åŠ å¯ç´¢å¼•å­—æ®µã€é¿å…æ¨¡ç³Šå‰ç¼€</td></tr><tr><td><strong>Estimated number of matches</strong></td><td>Child iterators</td><td>ç´¢å¼•å±‚ä¼°ç®—çš„å€™é€‰æ–‡æ¡£æ•°</td><td><strong>&lt; 1kï¼šç†æƒ³</strong><br>1kâ€“10kï¼šå¯æ¥å—</td><td>&gt; 50kï¼šè¿‡æ»¤æ¡ä»¶è¿‡å®½</td><td>æ”¹ç”¨ TAG / NUMERIC / å†—ä½™å­—æ®µ</td></tr><tr><td><strong>Loader Time</strong></td><td>Result processors â†’ Loader</td><td>ä» Redis åŠ è½½å¹¶ååºåˆ—åŒ–æ–‡æ¡£</td><td>&lt; 30% Total time</td><td>&gt; 40% Total time</td><td>RETURN ç²¾ç®€å­—æ®µã€NOCONTENTã€ç¼©å° JSON</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¬¬äºŒä¼˜å…ˆçº§æŒ‡æ ‡ï¼ˆåˆ¤æ–­ç´¢å¼•æˆ–æ¨¡å‹æ˜¯å¦åˆç†ï¼‰</p></li></ul><table><thead><tr><th>æŒ‡æ ‡</th><th>æ‰€åœ¨ä½ç½®</th><th>å«ä¹‰</th><th>å¥åº·é˜ˆå€¼</th><th>éœ€è¦è­¦æƒ•</th><th>å¸¸è§ä¼˜åŒ–æ‰‹æ®µ</th></tr></thead><tbody><tr><td><strong>Number of reading operations</strong></td><td>Iterators profile</td><td>å®é™…æ‰«æçš„å€’æ’è¡¨æ¡ç›®æ•°</td><td>â‰ˆ Estimated matches</td><td>æ˜æ˜¾å¤§äºç»“æœæ•°</td><td>æé«˜å­—æ®µé€‰æ‹©æ€§ã€æ‹†åˆ†æ¡ä»¶</td></tr><tr><td><strong>Estimated matches vs å®é™…ç»“æœæ•°</strong></td><td>Iterator + Result</td><td>ç´¢å¼•ä¼°ç®—ç²¾åº¦</td><td>ä¼°ç®—å€¼ç•¥å¤§äºå®é™…</td><td>ä¼°ç®— &gt;&gt; å®é™…ï¼ˆ10x+ï¼‰</td><td>è°ƒæ•´ schemaï¼Œé¿å…ä½åŸºæ•°å­—æ®µ</td></tr><tr><td><strong>Parsing time</strong></td><td>Shards â†’ Parsing time</td><td>æŸ¥è¯¢è¯­æ³•è§£æè€—æ—¶</td><td>&lt; 0.1 ms</td><td>&gt; 1 ms</td><td>å‡å°‘åŠ¨æ€æ‹¼æ¥ã€ç®€åŒ–è¯­æ³•</td></tr><tr><td><strong>Pipeline creation time</strong></td><td>Shards â†’ Pipeline creation</td><td>æ‰§è¡Œè®¡åˆ’æ„å»ºæ—¶é—´</td><td>&lt; 0.05 ms</td><td>&gt; 0.5 ms</td><td>å‡å°‘å­å¥ã€é¿å…å¤æ‚åµŒå¥—</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç»éªŒå‹â€œçº¢çº¿åˆ¤æ–­â€é€ŸæŸ¥è¡¨ï¼ˆéå¸¸å®ç”¨ï¼‰</p></li></ul><table><thead><tr><th>ç°è±¡</th><th>å«ä¹‰</th><th>æ˜¯å¦å¿…é¡»å¤„ç†</th></tr></thead><tbody><tr><td>Estimated matches &gt; 100k</td><td>ç´¢å¼•å­—æ®µé€‰æ‹©é”™è¯¯</td><td>å¿…é¡»</td></tr><tr><td>Iterator Type = SCAN</td><td>å…¨è¡¨æ‰«æ</td><td>å¿…é¡»</td></tr><tr><td>Loader &gt; 50% æ€»è€—æ—¶</td><td>è¿”å›æ•°æ®è¿‡é‡</td><td>å¼ºçƒˆå»ºè®®</td></tr><tr><td>reading ops â‰« results</td><td>å€’æ’æ•ˆç‡ä½</td><td>å»ºè®®</td></tr><tr><td>Total time &gt; 20 ms</td><td>åœ¨çº¿æŸ¥è¯¢é£é™©</td><td>å¿…é¡»</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ ¸å¿ƒæ‰§è¡Œç­–ç•¥å‹ Iteratorï¼ˆæœ€é‡è¦ï¼‰</p></li></ul><table><thead><tr><th>Type</th><th>è¯­ä¹‰</th><th>å…¸å‹è§¦å‘åœºæ™¯</th><th>æ€§èƒ½ç‰¹å¾</th><th>è°ƒä¼˜ç»“è®º</th></tr></thead><tbody><tr><td><strong>INTERSECT</strong></td><td>å¤šæ¡ä»¶å–äº¤é›†ï¼ˆANDï¼‰</td><td><code>@a:&#123;x&#125; @b:[1 10]</code></td><td>åŸºäºæœ€å°å€’æ’è¡¨ï¼Œæ•ˆç‡æœ€é«˜</td><td><strong>ç†æƒ³çŠ¶æ€ï¼Œä¼˜å…ˆä½¿ç”¨</strong></td></tr><tr><td><strong>UNION</strong></td><td>å¤šæ¡ä»¶å–å¹¶é›†ï¼ˆORï¼‰</td><td><code>@a:&#123;x|y&#125;</code></td><td>å€™é€‰é›†æ‰©å¤§ï¼Œéš OR æ•°é‡çº¿æ€§å¢é•¿</td><td>å¯æ¥å—ï¼Œé¿å…è¿‡å¤š OR</td></tr><tr><td><strong>SCAN</strong></td><td>å…¨é‡æ‰«æ</td><td>å­—æ®µæœªç´¢å¼• / JSON Path ä¸å¯ç´¢å¼•</td><td>O(N)ï¼Œæ–‡æ¡£è¶Šå¤šè¶Šæ…¢</td><td><strong>å¿…é¡»æ¶ˆç­</strong></td></tr><tr><td><strong>WILDCARD</strong></td><td>æ— è¿‡æ»¤æ¡ä»¶</td><td><code>&quot;*&quot;</code>ã€<code>@field:*</code></td><td>å€™é€‰é›†=å…¨éƒ¨æ–‡æ¡£</td><td>ä»…é™åˆ†æï¼Œçº¿ä¸Šæ…ç”¨</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç´¢å¼•è®¿é—®å‹ Iteratorï¼ˆINTERSECT / UNION çš„å­èŠ‚ç‚¹ï¼‰</p></li></ul><table><thead><tr><th>Type</th><th>å¯¹åº”å­—æ®µç±»å‹</th><th>ç¤ºä¾‹æŸ¥è¯¢</th><th>æ€§èƒ½ç‰¹å¾</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>TAG</strong></td><td>TAG</td><td><code>@status:&#123;PAID&#125;</code></td><td>å“ˆå¸Œå€’æ’ï¼Œæœ€å¿«</td><td>å¼ºçƒˆæ¨è</td></tr><tr><td><strong>NUMERIC</strong></td><td>NUMERIC</td><td><code>@amount:[100 +inf]</code></td><td>è·³è¡¨èŒƒå›´æ‰«æ</td><td>èŒƒå›´è¶Šçª„è¶Šå¿«</td></tr><tr><td><strong>TEXT</strong></td><td>TEXT</td><td><code>@name:alice</code></td><td>åˆ†è¯åŒ¹é…</td><td>åˆ†è¯æ•°å½±å“æ€§èƒ½</td></tr><tr><td><strong>GEO</strong></td><td>GEO</td><td><code>@loc:[13.4 52.5 10 km]</code></td><td>ç©ºé—´ç´¢å¼•</td><td>åŠå¾„å½±å“ç»“æœæ•°</td></tr><tr><td><strong>VECTOR</strong></td><td>VECTOR</td><td><code>=&gt;[KNN 10 @v $q]</code></td><td>å‘é‡æœç´¢</td><td>å¸¸ä¸ FILTER è”ç”¨</td></tr><tr><td><strong>IDLIST</strong></td><td>å†…éƒ¨</td><td>å°ç»“æœé›†</td><td>æšä¸¾ ID</td><td>è‡ªåŠ¨ä¼˜åŒ–</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>é€»è¾‘ / ç»“æ„å‹ Iterator</p></li></ul><table><thead><tr><th>Type</th><th>å«ä¹‰</th><th>è§¦å‘ç¤ºä¾‹</th><th>æ€§èƒ½å½±å“</th><th>æ˜¯å¦å¸¸è§</th></tr></thead><tbody><tr><td><strong>NOT</strong></td><td>å–å</td><td><code>-@status:&#123;PAID&#125;</code></td><td>ä¾èµ–å…¨é›†</td><td>è¾ƒå°‘</td></tr><tr><td><strong>OPTIONAL</strong></td><td>å¯é€‰å­å¥</td><td><code>( @a:&#123;x&#125; )?</code></td><td>å¢åŠ å€™é€‰é›†</td><td>å°‘è§</td></tr><tr><td><strong>EMPTY</strong></td><td>æ— åŒ¹é…</td><td>æ¡ä»¶ä¸å¯èƒ½æ»¡è¶³</td><td>æå¿«</td><td>å¶å‘</td></tr><tr><td><strong>PHRASE</strong></td><td>çŸ­è¯­åŒ¹é…</td><td><code>&quot;hello world&quot;</code></td><td>æ¯” TEXT æ…¢</td><td>ä½é¢‘</td></tr><tr><td><strong>PREFIX</strong></td><td>å‰ç¼€åŒ¹é…</td><td><code>abc*</code></td><td>å¯èƒ½é€€åŒ–</td><td>éœ€è°¨æ…</td></tr></tbody></table><h3 id="ä¸‰ã€åˆ«åç®¡ç†ï¼ˆç”Ÿäº§å¿…å¤‡ï¼‰">ä¸‰ã€åˆ«åç®¡ç†ï¼ˆç”Ÿäº§å¿…å¤‡ï¼‰</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>FT.ALIASADD</code></td><td>æ·»åŠ åˆ«å</td></tr><tr><td><code>FT.ALIASDEL</code></td><td>åˆ é™¤åˆ«å</td></tr><tr><td><code>FT.ALIASUPDATE</code></td><td>æ›´æ–°åˆ«åæŒ‡å‘</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ªç´¢å¼•å¯ä»¥æœ‰å¤šä¸ªåˆ«åï¼Œä¸€æ—¦åˆ›å»ºåˆ«åï¼Œæ‰€æœ‰ FT.SEARCH / FT.AGGREGATE / <a href="http://FT.INFO">FT.INFO</a> ç­‰å‘½ä»¤éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ alias</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ åˆ«å: FT.ALIASADD alias index</span></span><br><span class="line">FT.ALIASADD <span class="built_in">alias</span>:user idx:user</span><br><span class="line"><span class="comment"># æ›´æ–°åˆ«åæŒ‡å‘: FT.ALIASUPDATE alias index</span></span><br><span class="line">FT.ALIASUPDATE <span class="built_in">alias</span>:user idx:user:v2</span><br><span class="line"><span class="comment"># åˆ é™¤åˆ«å: FT.ALIASDEL alias</span></span><br><span class="line">FT.ALIASDEL <span class="built_in">alias</span>:user</span><br><span class="line"><span class="comment"># åˆ¤æ–­ç´¢å¼•åç§°æ˜¯å¦ä¸ºåˆ«å</span></span><br><span class="line">FT.INFO <span class="built_in">alias</span>:user</span><br><span class="line"> 1) index_name</span><br><span class="line"> 2) idx:user  <span class="comment"># çœŸå®ç´¢å¼•åç§°</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rSearch.addAlias(<span class="string">&quot;alias:user&quot;</span>, <span class="string">&quot;idx:user&quot;</span>);</span><br><span class="line">rSearch.updateAlias(<span class="string">&quot;alias:user&quot;</span>, <span class="string">&quot;idx:user:v2&quot;</span>);</span><br><span class="line">rSearch.delAlias(<span class="string">&quot;alias:user&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="ç´¢å¼•åˆ«åçš„æ ¸å¿ƒä»·å€¼">ç´¢å¼•åˆ«åçš„æ ¸å¿ƒä»·å€¼</h4><ul class="lvl-0"><li class="lvl-2"><ol><li class="lvl-5">ç´¢å¼•æ— æŸé‡å»ºï¼ˆæœ€å…¸å‹åœºæ™¯ï¼‰</li></ol><ul class="lvl-2"><li class="lvl-4">RediSearch ä¸æ”¯æŒåœ¨çº¿ä¿®æ”¹ schemaï¼Œå­—æ®µå˜æ›´é€šå¸¸éœ€è¦é‡å»ºç´¢å¼•ï¼Œç´¢å¼•é‡å»ºæ—¶ä¸šåŠ¡å°†ä¸å¯ç”¨ã€‚</li><li class="lvl-4">æœ‰äº†åˆ«åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼Œåˆ›å»ºå¥½åå°†åˆ«åæŒ‡å‘æ–°çš„ç´¢å¼•ï¼Œæ—§ç´¢å¼•ä¸å†ä½¿ç”¨ï¼Œä¸šåŠ¡æ— å½±å“ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. æ—§ç´¢å¼•</span><br><span class="line"> FT.ALIASADD user_idx user_idx_v1</span><br><span class="line"></span><br><span class="line">2. æ–°å»ºç´¢å¼•</span><br><span class="line">  FT.CREATE user_idx_v2 ...</span><br><span class="line"></span><br><span class="line">3. æ•°æ®å›å¡«å®Œæˆåï¼ŒåŸå­åˆ‡æ¢</span><br><span class="line">  FT.ALIASUPDATE user_idx user_idx_v2</span><br><span class="line"></span><br><span class="line">4. åˆ é™¤æ—§ç´¢å¼•ï¼ˆå¯é€‰ï¼‰</span><br><span class="line">  FT.DROPINDEX user_idx_v1</span><br></pre></td></tr></table></figure></li><li class="lvl-2"><ol start="2"><li class="lvl-5">ç°åº¦ / å¤šç‰ˆæœ¬å¹¶å­˜</li></ol><ul class="lvl-2"><li class="lvl-4">ä¸åŒç¯å¢ƒï¼ˆdev / staging / prodï¼‰</li><li class="lvl-4">ä¸åŒ schema ç‰ˆæœ¬</li></ul></li><li class="lvl-2"><ol start="3"><li class="lvl-5">è¿ç»´ä¸å‘å¸ƒè§„èŒƒåŒ–ï¼ˆå¼ºçƒˆæ¨èï¼‰</li></ol><ul class="lvl-2"><li class="lvl-4">åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼šæ°¸è¿œä¸è¦è®©ä¸šåŠ¡ä»£ç ç›´æ¥ä½¿ç”¨ç‰©ç†ç´¢å¼•å</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç´¢å¼•çœŸå®å: ä¸šåŠ¡å_ç‰ˆæœ¬_æ—¶é—´æˆ³</span><br><span class="line">ç´¢å¼•åˆ«å : ä¸šåŠ¡å</span><br></pre></td></tr></table></figure></li></ul><h3 id="å››ã€æ¸¸æ ‡ï¼ˆå¤§ç»“æœé›†ï¼‰">å››ã€æ¸¸æ ‡ï¼ˆå¤§ç»“æœé›†ï¼‰</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>FT.CURSOR READ</code></td><td>åˆ†æ‰¹è¯»å–</td></tr><tr><td><code>FT.CURSOR DEL</code></td><td>åˆ é™¤æ¸¸æ ‡</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ¸¸æ ‡ç”¨äºèšåˆæŸ¥è¯¢ï¼ˆAGGREGATEï¼‰çš„å¤§ç»“æœé›†åˆ†é¡µ/åˆ†æ‰¹æ‹‰å–ï¼Œå…¸å‹åœºæ™¯åŒ…æ‹¬ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GROUPBY / REDUCE åç»“æœé›†å¾ˆå¤§</span><br><span class="line">éœ€è¦æµå¼å¤„ç†èšåˆç»“æœï¼Œé¿å…ä¸€æ¬¡æ€§è¿”å›å ç”¨å¤§é‡å†…å­˜</span><br><span class="line">å®¢æˆ·ç«¯æŒ‰æ‰¹æ¶ˆè´¹ç»“æœï¼ˆç±»ä¼¼æ•°æ®åº“çš„ server-side cursorï¼‰</span><br><span class="line">æ³¨æ„ï¼šæ¸¸æ ‡ä¸»è¦ç”¨äº FT.AGGREGATEï¼Œæ™®é€š FT.SEARCH ä¸æ”¯æŒæ¸¸æ ‡åˆ†é¡µã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡ <code>FT.AGGREGATE ... WITHCURSOR</code> åˆ›å»ºæ¸¸æ ‡ï¼Œé€šè¿‡ <code>FT.CURSOR READ</code> è·å–ç»“æœã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE idx:user <span class="string">&quot;*&quot;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE SUM 1 @amount AS total_amount</span><br><span class="line">  WITHCURSOR COUNT 2 MAXIDLE 60000</span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># WITHCURSOR : å¯ç”¨æ¸¸æ ‡</span></span><br><span class="line"><span class="comment"># COUNT 2 : æ¯æ¬¡ä»æ¸¸æ ‡ä¸­è¿”å›çš„è¡Œæ•°ï¼ˆæ‰¹å¤§å°ï¼‰</span></span><br><span class="line"><span class="comment"># MAXIDLE 60000 : æ¸¸æ ‡æœ€å¤§ç©ºé—²æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶åè‡ªåŠ¨é”€æ¯</span></span><br><span class="line"><span class="comment">## è¿”å›ç»“æœ</span></span><br><span class="line">1) 1) (<span class="built_in">integer</span>) 3   <span class="comment"># GROUP BY åï¼Œä¸€å…±ä¼šäº§ç”Ÿ 3 è¡Œèšåˆç»“æœï¼Œè¿™é‡Œè¿”å›çš„æ˜¯å®é™…æŸ¥è¯¢çš„æ€»è¡Œæ•°ï¼Œä¸å—COUNT å‚æ•°é™åˆ¶</span></span><br><span class="line">   2) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">      2) <span class="string">&quot;CANCELLED&quot;</span></span><br><span class="line">      3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">      4) <span class="string">&quot;79.8&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">      2) <span class="string">&quot;PAID&quot;</span></span><br><span class="line">      3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">      4) <span class="string">&quot;4096.89&quot;</span></span><br><span class="line">2) (<span class="built_in">integer</span>) 116452546  <span class="comment"># æ¸¸æ ‡ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–æ¸¸æ ‡</span></span><br><span class="line">FT.CURSOR READ idx:user 116452546 COUNT 2</span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># 116452546 : æ¸¸æ ‡ID</span></span><br><span class="line"><span class="comment"># COUNT 2 : æ¯æ¬¡ä»æ¸¸æ ‡ä¸­è¿”å›çš„è¡Œæ•°(å¯è¦†ç›–åˆå§‹æ¸¸æ ‡ä¸­çš„ COUNTï¼‰</span></span><br><span class="line"><span class="comment">## è¿”å›ç»“æœ</span></span><br><span class="line">1) 1) (<span class="built_in">integer</span>) 0   <span class="comment"># å½“å‰æ¸¸æ ‡ä¸­â€œå‰©ä½™å¯è¯»çš„è¡Œæ•°â€ä¸º 0</span></span><br><span class="line">   2) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">      2) <span class="string">&quot;CREATED&quot;</span></span><br><span class="line">      3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">      4) <span class="string">&quot;238.8&quot;</span></span><br><span class="line">2) (<span class="built_in">integer</span>) 0 <span class="comment"># 0 è¡¨ç¤ºæ²¡æœ‰æ›´å¤šç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”€æ¯æ¸¸æ ‡ï¼Œå¦‚æœè®¾ç½®äº† MAXIDLE å‚æ•°ï¼Œåˆ™è¯¥æ¸¸æ ‡åœ¨ MAXIDLE æ—¶é—´å†…è‡ªåŠ¨é”€æ¯ï¼Œæ‰€ä»¥æ— éœ€æ‰‹å·¥é”€æ¯</span></span><br><span class="line">FT.CURSOR DEL idx:user 116452546</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AggregationResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.aggregate(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        AggregationOptions.defaults()</span><br><span class="line">                .groupBy(GroupBy.fieldNames(<span class="string">&quot;@status&quot;</span>)</span><br><span class="line">                        .reducers(</span><br><span class="line">                                Reducer.sum(<span class="string">&quot;@amount&quot;</span>).as(<span class="string">&quot;total_amount&quot;</span>)</span><br><span class="line">                        )</span><br><span class="line">                )</span><br><span class="line">                .withCursor(<span class="number">2</span>, <span class="number">60000</span>)</span><br><span class="line">);</span><br><span class="line"><span class="type">long</span> total;</span><br><span class="line"><span class="type">long</span> cursorId;</span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; attributes;</span><br><span class="line"></span><br><span class="line">total = result.getTotal();</span><br><span class="line">cursorId = result.getCursorId();</span><br><span class="line">System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line">System.out.println(<span class="string">&quot;cursorId = &quot;</span> + cursorId);</span><br><span class="line">attributes = result.getAttributes();</span><br><span class="line"><span class="keyword">for</span> (Map&lt;String, Object&gt; attribute : attributes) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;attribute = &quot;</span> + attribute);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (cursorId != <span class="number">0</span>) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">    <span class="comment">// æ¸¸æ ‡è¯»å–ï¼ŒRedissonçš„readCursoræ–¹æ³•æœ‰bugï¼Œæ— æ³•ç»§ç»­è¯»å–æ¸¸æ ‡æ•°æ®</span></span><br><span class="line">    <span class="comment">// result = rSearch.readCursor(&quot;idx:user&quot;, cursorId, 2);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œæ¸¸æ ‡è¯»å–å¯ä»¥è‡ªå·±ç¼–å†™ä¸€ä¸ªåŸºäºLua çš„å®ç°</span></span><br><span class="line">    result = readCursor(<span class="string">&quot;idx:user&quot;</span>, cursorId, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    total = result.getTotal();</span><br><span class="line">    cursorId = result.getCursorId();</span><br><span class="line">    System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line">    System.out.println(<span class="string">&quot;cursorId = &quot;</span> + cursorId);</span><br><span class="line">    attributes = result.getAttributes();</span><br><span class="line">    <span class="keyword">for</span> (Map&lt;String, Object&gt; attribute : attributes) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;attribute = &quot;</span> + attribute);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cursorId=0 æˆ– åˆ°æœŸ æ—¶ä¼šè‡ªåŠ¨åˆ é™¤æ¸¸æ ‡ï¼Œæ­¤å¤„æ— éœ€åˆ é™¤</span></span><br><span class="line"><span class="comment">// rSearch.delCursor(&quot;idx:user&quot;, cursorId);</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AggregationResult <span class="title function_">readCursor</span><span class="params">(String indexName, <span class="type">long</span> cursorId, <span class="type">int</span> count)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;FT.CURSOR&#x27;, &#x27;READ&#x27;, KEYS[1], ARGV[1], &#x27;COUNT&#x27;, ARGV[2])&quot;</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Object&gt; results = stringRedisTemplate.execute(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class="line">            Collections.singletonList(indexName),</span><br><span class="line">            String.valueOf(cursorId),</span><br><span class="line">            String.valueOf(count)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    cursorId = (<span class="type">long</span>) results.get(<span class="number">1</span>);</span><br><span class="line">    List&lt;Object&gt; lo = (List) results.get(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AggregationResult</span>(</span><br><span class="line">            (<span class="type">long</span>) lo.get(<span class="number">0</span>),</span><br><span class="line">            toListOfMap(lo),</span><br><span class="line">            cursorId</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">toListOfMap</span><span class="params">(List&lt;Object&gt; lo)</span> &#123;</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lo == <span class="literal">null</span> || lo.size() &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»ç´¢å¼• 1 å¼€å§‹ï¼Œè·³è¿‡èšåˆæ€»æ•°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; lo.size(); i++) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">rowObj</span> <span class="operator">=</span> lo.get(i);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!(rowObj <span class="keyword">instanceof</span> List&lt;?&gt; row)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; row.size() - <span class="number">1</span>; j += <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> String.valueOf(row.get(j));</span><br><span class="line">            <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> row.get(j + <span class="number">1</span>);</span><br><span class="line">            map.put(key, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result.add(map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®Œæ•´ç”Ÿå‘½å‘¨æœŸæ€»ç»“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE ... WITHCURSOR      <span class="comment"># åˆ›å»ºæ¸¸æ ‡ï¼ˆå¹¶è¿”å›ç¬¬ä¸€æ‰¹ + cursorIdï¼‰</span></span><br><span class="line">        â†“</span><br><span class="line">FT.CURSOR READ                  <span class="comment"># è¯»å–ç¬¬ N æ‰¹</span></span><br><span class="line">        â†“</span><br><span class="line">FT.CURSOR READ                  <span class="comment"># ç»§ç»­è¯»å–</span></span><br><span class="line">        â†“</span><br><span class="line">FT.CURSOR DELï¼ˆå¯é€‰ï¼‰           <span class="comment"># æå‰é‡Šæ”¾èµ„æº</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ¸¸æ ‡ä¸ OFFSET/LIMIT çš„åŒºåˆ«</p></li></ul><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>æ¸¸æ ‡</th><th>OFFSET / LIMIT</th></tr></thead><tbody><tr><td>æ€§èƒ½</td><td>é«˜ï¼ˆæµå¼ï¼‰</td><td>å¤§ OFFSET æ€§èƒ½å·®</td></tr><tr><td>é€‚åˆå¤§ç»“æœé›†</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>æœåŠ¡å™¨çŠ¶æ€</td><td>æœ‰</td><td>æ— </td></tr><tr><td>é€‚ç”¨å‘½ä»¤</td><td>FT.AGGREGATE</td><td>FT.SEARCH</td></tr></tbody></table><h3 id="äº”ã€è¯å…¸-åŒä¹‰è¯ï¼ˆæœç´¢å¢å¼ºï¼‰">äº”ã€è¯å…¸ &amp; åŒä¹‰è¯ï¼ˆæœç´¢å¢å¼ºï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>è¯å…¸ï¼ˆDICTï¼‰å’ŒåŒä¹‰è¯ï¼ˆSYNONYMï¼‰åªå¯¹ TEXT / TAG æœç´¢ç”Ÿæ•ˆ</p></li><li class="lvl-2"><p>ä¸ <code>FT.AGGREGATE</code> æ— å…³ï¼Œä½†ä¸ <code>FT.SEARCH</code> å¼ºç›¸å…³ã€‚</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>FT.DICTADD</code></td><td>æ·»åŠ è¯</td></tr><tr><td><code>FT.DICTDEL</code></td><td>åˆ é™¤è¯</td></tr><tr><td><code>FT.DICTDUMP</code></td><td>æŸ¥çœ‹è¯å…¸</td></tr><tr><td><code>FT.SYNUPDATE</code></td><td>æ›´æ–°åŒä¹‰è¯</td></tr><tr><td><code>FT.SYNDUMP</code></td><td>æŸ¥çœ‹åŒä¹‰è¯</td></tr></tbody></table><h4 id="è¯å…¸">è¯å…¸</h4><ul class="lvl-0"><li class="lvl-2"><p>è¯å…¸ä½œç”¨ï¼šæ§åˆ¶â€œåˆæ³•æœç´¢è¯â€ï¼Œæ¯”å¦‚å°†è¯å…¸çš„å†…å®¹å‘é€ç»™ç”¨æˆ·ï¼Œè®©ç”¨æˆ·åªèƒ½æœç´¢è¿™äº›è¯ã€‚</p><ul class="lvl-2"><li class="lvl-4">âš ï¸ è¯å…¸æœ¬èº«ä¸å‚ä¸æœç´¢åŒ¹é…</li><li class="lvl-4">âš ï¸ åªæ˜¯ä¸ºæœç´¢å¢å¼ºæä¾›æ•°æ®æ¥æº</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šæ·»åŠ å•†å“ç›¸å…³è¯</span></span><br><span class="line">FT.DICTADD product_dict iphone mobile phone android huawei</span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¯å…¸å†…å®¹ï¼ˆFT.DICTDUMPï¼‰</span></span><br><span class="line">FT.DICTDUMP product_dict</span><br><span class="line"><span class="comment"># åˆ é™¤è¯å…¸ä¸­çš„è¯ï¼ˆFT.DICTDELï¼‰</span></span><br><span class="line">FT.DICTDEL product_dict iphone</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rSearch.addDict(<span class="string">&quot;product_dict&quot;</span>, <span class="string">&quot;iphone&quot;</span>, <span class="string">&quot;mobile&quot;</span>,<span class="string">&quot;phone&quot;</span>,<span class="string">&quot;android&quot;</span>,<span class="string">&quot;huawei&quot;</span>);</span><br><span class="line">List&lt;String&gt; productDict = rSearch.dumpDict(<span class="string">&quot;product_dict&quot;</span>);</span><br><span class="line">rSearch.delDict(<span class="string">&quot;product_dict&quot;</span>, <span class="string">&quot;iphone&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="åŒä¹‰è¯">åŒä¹‰è¯</h4><ul class="lvl-0"><li class="lvl-2"><p>åŒä¹‰è¯çš„ä½œç”¨: è®©ä¸åŒçš„æœç´¢è¯ å‘½ä¸­åŒä¸€æ‰¹æ–‡æ¡£</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">  æœ iphone</span><br><span class="line">  æœ mobile</span><br><span class="line">  æœ phone</span><br><span class="line"></span><br><span class="line">  ğŸ‘‰ å‘½ä¸­åŒä¸€æ‰¹è®¢å•</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ  / æ›´æ–°åŒä¹‰è¯ï¼ˆFT.SYNUPDATEï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰â€œæ‰‹æœºâ€çš„åŒä¹‰è¯é›†åˆï¼Œæ³¨æ„åŒä¹‰è¯æ˜¯ç»‘å®šåˆ° ç´¢å¼• çš„</span></span><br><span class="line">FT.SYNUPDATE idx:user</span><br><span class="line">  phone_group</span><br><span class="line">  iphone mobile phone</span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># phone_group: åŒä¹‰è¯é›†åˆåç§°ï¼ˆä½ è‡ªå·±å®šä¹‰ï¼‰</span></span><br><span class="line"><span class="comment"># iphone mobile phone: æ·»åŠ åŒä¹‰è¯ï¼Œå¤šä¸ªè¯ç”¨ç©ºæ ¼éš”å¼€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹åŒä¹‰è¯é›†åˆ</span></span><br><span class="line">FT.SYNDUMP idx:user</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) <span class="string">&quot;phone&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;phone_group&quot;</span></span><br><span class="line">3) <span class="string">&quot;iphone&quot;</span></span><br><span class="line">4) 1) <span class="string">&quot;phone_group&quot;</span></span><br><span class="line">5) <span class="string">&quot;mobile&quot;</span></span><br><span class="line">6) 1) <span class="string">&quot;phone_group&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rSearch.updateSynonyms(<span class="string">&quot;idx:user&quot;</span>, <span class="string">&quot;phone_group&quot;</span>, <span class="string">&quot;iphone&quot;</span>, <span class="string">&quot;mobile&quot;</span>, <span class="string">&quot;phone&quot;</span>);</span><br><span class="line">Map&lt;String, List&lt;String&gt;&gt; synonyms = rSearch.dumpSynonyms(<span class="string">&quot;idx:user&quot;</span>);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶æˆ‘ä»¬å†è¿›è¡Œæœç´¢ï¼Œå°±ä¼šå‘½ä¸­æ‰€æœ‰åŒä¹‰è¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FT.SEARCH idx:user <span class="string">&#x27;phone&#x27;</span></span><br><span class="line"><span class="comment"># æœç´¢ç»“æœ</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 4</span><br><span class="line">2) <span class="string">&quot;user:10001&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Alice Bob\&quot;,\&quot;age\&quot;:28,\&quot;vip\&quot;:\&quot;yes\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:199.99,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;,&#123;\&quot;amount\&quot;:59.9,\&quot;status\&quot;:\&quot;CREATED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a phone\&quot;,\&quot;items\&quot;:[\&quot;SpringCloud\xe6\x8a\x80\xe6\x9c\xaf\xe6\x8c\x87\xe5\x8d\x97\&quot;,\&quot;Shell\xe8\x84\x9a\xe6\x9c\xac\xe5\x9f\xba\xe7\xa1\x80\&quot;]&#125;&quot;</span></span><br><span class="line">4) <span class="string">&quot;user:10006&quot;</span></span><br><span class="line">5) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Frank\&quot;,\&quot;age\&quot;:27,\&quot;vip\&quot;:\&quot;no\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:499,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;,&#123;\&quot;amount\&quot;:129,\&quot;status\&quot;:\&quot;CREATED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a phone\&quot;,\&quot;items\&quot;:[\&quot;Redis\xe5\xbc\x80\xe5\x8f\x91\xe5\xae\x9e\xe6\x88\x98\&quot;,\&quot;MongoDB\xe4\xbb\x8e\xe5\x85\xa5\xe9\x97\xa8\xe5\x88\xb0\xe5\xae\x9e\xe6\x88\x98\&quot;]&#125;&quot;</span></span><br><span class="line">6) <span class="string">&quot;user:10002&quot;</span></span><br><span class="line">7) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Bob Frank\&quot;,\&quot;age\&quot;:35,\&quot;vip\&quot;:\&quot;no\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:899.0,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a iphone\&quot;,\&quot;items\&quot;:[\&quot;Linux\xe5\xbf\x85\xe7\x9f\xa5\xe5\xbf\x85\xe4\xbc\x9a\&quot;,\&quot;Java\xe5\xa4\x9a\xe7\xba\xbf\xe7\xa8\x8b\xe8\xaf\xa6\xe8\xa7\xa3\&quot;]&#125;&quot;</span></span><br><span class="line">8) <span class="string">&quot;user:10003&quot;</span></span><br><span class="line">9) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Carol\&quot;,\&quot;age\&quot;:22,\&quot;vip\&quot;:\&quot;no\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:19.9,\&quot;status\&quot;:\&quot;CANCELLED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a mobile\&quot;,\&quot;items\&quot;:[\&quot;MySQL\xe4\xbb\x8e\xe5\x88\xa0\xe5\xba\x93\xe5\x88\xb0\xe8\xb7\x91\xe8\xb7\xaf\&quot;,\&quot;Oracle\xe5\xbc\x80\xe5\x8f\x91\xe5\xae\x9e\xe8\xb7\xb5\&quot;]&#125;&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¯å…¸ + åŒä¹‰è¯çš„ç»„åˆä½¿ç”¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. ç”¨æˆ·è¾“å…¥: æ‰‹æœº</span><br><span class="line">2. å‰ç«¯ / æœåŠ¡ç«¯ â†’ ä» product_dict ç»™æç¤º</span><br><span class="line">3. æœç´¢è¯·æ±‚ â†’ FT.SEARCH</span><br><span class="line">4. RediSearch â†’ åŒä¹‰è¯æ‰©å±•</span><br><span class="line">5. è¿”å›ç»Ÿä¸€ç»“æœ</span><br></pre></td></tr></table></figure><h3 id="å…­ã€FT-SPELLCHECKï¼ˆæ‹¼å†™çº é”™ï¼‰">å…­ã€FT.SPELLCHECKï¼ˆæ‹¼å†™çº é”™ï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>FT.SPELLCHECK ç”¨äºå¯¹ç”¨æˆ·è¾“å…¥çš„æœç´¢è¯è¿›è¡Œæ‹¼å†™çº é”™ä¸ç›¸ä¼¼è¯æ¨è</p></li><li class="lvl-2"><p>å®ƒå¹¶ä¸ä¼šçœŸæ­£æ‰§è¡Œæœç´¢ï¼Œè€Œæ˜¯ï¼š<br>âœ… åˆ†æè¾“å…¥è¯æ˜¯å¦å­˜åœ¨äºç´¢å¼•è¯å…¸<br>âœ… å¦‚æœä¸å­˜åœ¨ï¼ŒåŸºäºç¼–è¾‘è·ç¦»ï¼ˆLevenshteinï¼‰ç»™å‡ºå€™é€‰çº é”™è¯<br>âœ… æ”¯æŒè‡ªå®šä¹‰è¯å…¸ï¼ˆDictionaryï¼‰å¢å¼ºæ•ˆæœ</p></li><li class="lvl-2"><p>ğŸ¯ æ ¸å¿ƒç›®æ ‡</p></li></ul><table><thead><tr><th>èƒ½åŠ›</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ‹¼å†™çº é”™</td><td>iphone â†’ ipohne</td></tr><tr><td>æ¨¡ç³Šæ¨è</td><td>ç”¨æˆ·æ‹¼é”™å…³é”®è¯</td></tr><tr><td>æœç´¢å‰ç½®çº é”™</td><td>æå‡å¬å›ç‡</td></tr><tr><td>è‡ªåŠ¨å­¦ä¹ ç´¢å¼•è¯</td><td>è‡ªåŠ¨ä»ç´¢å¼•è¯åº“æ„å»ºè¯å…¸</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åŸºæœ¬è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FT.SPELLCHECK index query</span><br><span class="line">  [DISTANCE maxDistance]</span><br><span class="line">  [TERMS &#123;INCLUDE | EXCLUDE&#125; dictionary ...]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜è¡¨</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>index</td><td>ç´¢å¼•åç§°</td><td>å¿…å¡«</td></tr><tr><td>query</td><td>ç”¨æˆ·è¾“å…¥è¯</td><td>å¿…å¡«</td></tr><tr><td>DISTANCE</td><td>æœ€å¤§ç¼–è¾‘è·ç¦»ï¼ˆ1~4ï¼‰</td><td>1</td></tr><tr><td>TERMS INCLUDE</td><td>ä»…ä½¿ç”¨æŒ‡å®šè¯å…¸</td><td>å…¨éƒ¨</td></tr><tr><td>TERMS EXCLUDE</td><td>æ’é™¤æŒ‡å®šè¯å…¸</td><td>æ— </td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">FT.SPELLCHECK idx:user <span class="string">&#x27;iphnoe&#x27;</span> DISTANCE 2</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) 1) TERM         <span class="comment"># å›ºå®šæ ‡è¯†ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¢«åˆ†æçš„è¯</span></span><br><span class="line">   2) <span class="string">&quot;iphnoe&quot;</span>     <span class="comment"># ç”¨æˆ·è¾“å…¥è¯</span></span><br><span class="line">   3) 1) 1) <span class="string">&quot;0.4&quot;</span>  <span class="comment"># ç›¸ä¼¼åº¦è¯„åˆ†ï¼Œè¶Šå°è¶Šç›¸ä¼¼</span></span><br><span class="line">         2) <span class="string">&quot;iphone&quot;</span> <span class="comment"># æ¨èè¯ï¼Œå»ºè®®æ›¿æ¢è¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢å¤šä¸ªè¯</span></span><br><span class="line">FT.SPELLCHECK idx:user <span class="string">&#x27;iphnoe linu&#x27;</span> DISTANCE 2</span><br><span class="line">1) 1) TERM</span><br><span class="line">   2) <span class="string">&quot;iphnoe&quot;</span></span><br><span class="line">   3) 1) 1) <span class="string">&quot;0.4&quot;</span></span><br><span class="line">         2) <span class="string">&quot;iphone&quot;</span></span><br><span class="line">2) 1) TERM</span><br><span class="line">   2) <span class="string">&quot;linu&quot;</span></span><br><span class="line">   3) 1) 1) <span class="string">&quot;0.4&quot;</span></span><br><span class="line">         2) <span class="string">&quot;linux&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ ç¼–è¾‘è·ç¦»ä¼šæ˜¾ç¤ºæ›´å¤šçš„å€™é€‰è¯</span></span><br><span class="line">FT.SPELLCHECK idx:user <span class="string">&#x27;phnoe&#x27;</span> DISTANCE 3</span><br><span class="line">1) 1) TERM</span><br><span class="line">   2) <span class="string">&quot;phnoe&quot;</span></span><br><span class="line">   3) 1) 1) <span class="string">&quot;4&quot;</span></span><br><span class="line">         2) <span class="string">&quot;have&quot;</span></span><br><span class="line">      2) 1) <span class="string">&quot;0.8&quot;</span></span><br><span class="line">         2) <span class="string">&quot;phone&quot;</span></span><br><span class="line">      3) 1) <span class="string">&quot;0.4&quot;</span></span><br><span class="line">         2) <span class="string">&quot;iphone&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Map&lt;String, Double&gt;&gt; spellcheck = rSearch.spellcheck(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iphnoe linu&quot;</span>,</span><br><span class="line">        SpellcheckOptions.defaults().distance(<span class="number">2</span>));</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>score = ç¼–è¾‘è·ç¦» / max(len(ç”¨æˆ·è¾“å…¥è¯), len(å€™é€‰è¯))ï¼Œä½†å¹¶ä¸æ˜¯æ€»æ˜¯è¿™æ ·</p></li></ul><table><thead><tr><th>è¾“å…¥</th><th>å€™é€‰</th><th>ç¼–è¾‘è·ç¦»</th><th>maxLen</th><th>score</th></tr></thead><tbody><tr><td>phnoe</td><td>iphone</td><td>2</td><td>6</td><td>2/6 = 0.333 â‰ˆ 0.4</td></tr><tr><td>phnoe</td><td>phone</td><td>1</td><td>5</td><td>0.2 â†’ ~0.8ï¼ˆå†…éƒ¨æƒé‡å¯èƒ½åè½¬æˆ–è°ƒæ•´ï¼‰</td></tr><tr><td>phnoe</td><td>have</td><td></td><td></td><td>â€œ4â€ â†’ è¡¨ç¤º phnoe ä¸ have çš„ç¼–è¾‘è·ç¦»æ˜¯ 4</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">phnoe â†’ have</span><br><span class="line">p â†’ h (1)</span><br><span class="line">h â†’ a (2)</span><br><span class="line">n â†’ v (3)</span><br><span class="line">o â†’ e (4)</span><br><span class="line">e â†’ (åˆ é™¤) (5)   ï¼ˆä¸åŒç®—æ³•å¯èƒ½è®¡ä¸º 4 æˆ– 5ï¼‰</span><br><span class="line">è¯¥è¯æ˜æ˜¾æ˜¯ä½è´¨é‡å€™é€‰ï¼Œåªæ˜¯ DISTANCE=3/4 æ—¶è¢«å‹‰å¼ºæ”¶å½•ã€‚</span><br><span class="line"></span><br><span class="line">ä¸šåŠ¡ä¾§åšåˆç†è¿‡æ»¤</span><br><span class="line">å¦‚æœ score &gt;= 2     â†’ ç›´æ¥ä¸¢å¼ƒï¼ˆæ˜æ˜¾å™ªå£°ï¼‰</span><br><span class="line">å¦‚æœ score &lt;= 1.0   â†’ å¯ä¿¡å€™é€‰</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å»ºè®®ç­–ç•¥</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>å»ºè®®</th></tr></thead><tbody><tr><td>æœç´¢æ¡†å®æ—¶æç¤º</td><td>1</td></tr><tr><td>æœç´¢æäº¤åçº é”™</td><td>2</td></tr><tr><td>æ¨¡ç³Šå®¹é”™ç³»ç»Ÿ</td><td>2~3</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è¯å…¸å¢å¼ºï¼ˆDictionary Integrationï¼‰</p></li></ul><blockquote><p>é€šè¿‡ FT.DICTADD / FT.DICTDEL äººå·¥ç»´æŠ¤ä¸€ä¸ªæˆ–å¤šä¸ªè¯å…¸ï¼ŒæŠŠâ€œä¸šåŠ¡è¯æ±‡â€ä¸»åŠ¨æ³¨å…¥åˆ° SpellCheck çš„å€™é€‰è¯ç©ºé—´ä¸­ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">é»˜è®¤æƒ…å†µä¸‹ï¼š</span><br><span class="line">SpellCheck åªèƒ½ä» ç´¢å¼•å€’æ’è¯å…¸ï¼ˆInverted Index Termsï¼‰ ä¸­ç”Ÿæˆå€™é€‰è¯ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœæŸäº›è¯ï¼š</span><br><span class="line">  ä¸åœ¨ç´¢å¼•é‡Œ</span><br><span class="line">  å‡ºç°é¢‘ç‡æä½</span><br><span class="line">  å±äºä¸“æœ‰åè¯</span><br><span class="line">  æ–°è¯ã€å“ç‰Œè¯</span><br><span class="line">é‚£ä¹ˆ SpellCheck å¾ˆå¯èƒ½æ— æ³•æ­£ç¡®çº é”™ã€‚</span><br><span class="line"></span><br><span class="line">è¯å…¸å¢å¼ºè§£å†³çš„æ­£æ˜¯è¿™ä¸ªé—®é¢˜ã€‚</span><br><span class="line"></span><br><span class="line">ç”¨æˆ·è¾“å…¥ â†’ Tokenizer â†’ æ‹†è¯ â†’</span><br><span class="line">  â†“</span><br><span class="line">å€™é€‰æºåˆå¹¶ï¼š</span><br><span class="line">  - å€’æ’ç´¢å¼•è¯å…¸</span><br><span class="line">  - è‡ªå®šä¹‰è¯å…¸ï¼ˆFT.DICTADDï¼‰</span><br><span class="line">  â†“</span><br><span class="line">ç¼–è¾‘è·ç¦»è®¡ç®—</span><br><span class="line">  â†“</span><br><span class="line">å€™é€‰æ’åº</span><br><span class="line">  â†“</span><br><span class="line">è¿”å›çº é”™è¯</span><br><span class="line"></span><br><span class="line">âœ… SpellCheck çš„å€™é€‰ç©ºé—´è¢«äººä¸ºæ‰©å¤§ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FT.DICTADD dict:tech iphone ipad macbook airpods</span><br><span class="line"><span class="comment"># ä½¿ç”¨æŒ‡å®šè¯å…¸çº é”™ï¼Œç™½åå•</span></span><br><span class="line">FT.SPELLCHECK idx:user <span class="string">&quot;macboo&quot;</span> TERMS INCLUDE dict:tech</span><br><span class="line">1) 1) TERM</span><br><span class="line">   2) <span class="string">&quot;macboo&quot;</span></span><br><span class="line">   3) 1) 1) <span class="string">&quot;0.4&quot;</span></span><br><span class="line">         2) <span class="string">&quot;macbook&quot;</span></span><br><span class="line"><span class="comment"># æ’é™¤è¯å…¸ï¼Œé»‘åå•</span></span><br><span class="line">FT.SPELLCHECK idx:user <span class="string">&quot;iphnoe&quot;</span> TERMS EXCLUDE dict:noise</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Map&lt;String, Double&gt;&gt; spellcheck = rSearch.spellcheck(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;macboo&quot;</span>,</span><br><span class="line">        SpellcheckOptions.defaults()</span><br><span class="line">                .distance(<span class="number">2</span>)</span><br><span class="line">                .includedTerms(<span class="string">&quot;dict:tech&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>FT.SPELLCHECK ä¸ Suggest çš„å·®å¼‚å¯¹æ¯”ï¼ˆå…³é”®ï¼‰</p></li></ul><table><thead><tr><th>ç»´åº¦</th><th>FT.SPELLCHECK</th><th>FT.SUGGET</th></tr></thead><tbody><tr><td>ç›®æ ‡</td><td>æ‹¼å†™çº é”™</td><td>å‰ç¼€è”æƒ³</td></tr><tr><td>è¾“å…¥</td><td>å®Œæ•´è¯</td><td>å‰ç¼€</td></tr><tr><td>è¿”å›</td><td>ç›¸ä¼¼è¯</td><td>è¡¥å…¨è¯</td></tr><tr><td>æ•°æ®æ¥æº</td><td>ç´¢å¼•è¯å…¸</td><td>ç‹¬ç«‹ Trie</td></tr><tr><td>æ˜¯å¦æ’åº</td><td>å¦ï¼ˆè·ç¦»ä¼˜å…ˆï¼‰</td><td>æ˜¯ï¼ˆscoreï¼‰</td></tr><tr><td>æ˜¯å¦æ¨¡ç³Š</td><td>ç¼–è¾‘è·ç¦»</td><td>å‰ç¼€ + FUZZY</td></tr><tr><td>ä½¿ç”¨é˜¶æ®µ</td><td>æœç´¢å‰ä¿®æ­£</td><td>è¾“å…¥è¿‡ç¨‹ä¸­</td></tr></tbody></table><h3 id="å·²åºŸå¼ƒå‘½ä»¤ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰">å·²åºŸå¼ƒå‘½ä»¤ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰</h3><table><thead><tr><th>å‘½ä»¤</th><th>çŠ¶æ€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>FT.CONFIG GET</code></td><td>Reids8 å°†å…¶æ ‡è®°ä¸º Deprecated</td><td>ä½¿ç”¨ <code>CONFIG GET search-*</code></td></tr><tr><td><code>FT.CONFIG SET</code></td><td>Reids8 å°†å…¶æ ‡è®°ä¸º Deprecated</td><td>åŒä¸Š</td></tr><tr><td><code>FT.TAGVALS</code></td><td>å·²ç»æ ‡è®°ä¸º Deprecated</td><td>æ”¹ç”¨ AGGREGATE</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>âš ï¸ è¿™é‡Œè¦æ³¨æ„ï¼Œåªæœ‰ <code>Redis 8.0.0</code> ä»¥ä¸Šç‰ˆæœ¬æ”¯æŒ <code>CONFIG GET search-*</code>ã€‚</p></li></ul><h4 id="FT-CONFIG-GET-å’Œ-CONFIG-GET-search-å¯¹åº”å‚æ•°æ•´ç†"><code>FT.CONFIG GET *</code> å’Œ <code>CONFIG GET search-*</code> å¯¹åº”å‚æ•°æ•´ç†</h4><ul class="lvl-0"><li class="lvl-2"><p>1ï¸âƒ£ ç´¢å¼•åŸºæœ¬ / æ–‡æ¡£è¡¨é…ç½®</p></li></ul><table><thead><tr><th>FT.CONFIG å‚æ•°</th><th>FT.CONFIG å€¼</th><th>CONFIG search-* å‚æ•°</th><th>CONFIG å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>MINPREFIX</td><td>2</td><td>search-min-prefix</td><td>2</td><td>è‡ªåŠ¨è¡¥å…¨æœ€å°å‰ç¼€é•¿åº¦</td></tr><tr><td>MINSTEMLEN</td><td>4</td><td>search-min-stem-len</td><td>4</td><td>æœ€å°è¯å¹²é•¿åº¦</td></tr><tr><td>MAXDOCTABLESIZE</td><td>1000000</td><td>search-max-doctablesize</td><td>1000000</td><td>æœ€å¤§æ–‡æ¡£è¡¨å¤§å°</td></tr><tr><td>MAXSEARCHRESULTS</td><td>1000000</td><td>search-max-search-results</td><td>1000000</td><td>æœç´¢ç»“æœé™åˆ¶</td></tr><tr><td>MAXAGGREGATERESULTS</td><td>unlimited</td><td>search-max-aggregate-results</td><td>2147483648</td><td>èšåˆç»“æœé™åˆ¶</td></tr><tr><td>MAXEXPANSIONS</td><td>200</td><td>search-max-prefix-expansions</td><td>200</td><td>å‰ç¼€æ‰©å±•é™åˆ¶</td></tr><tr><td>MAXPREFIXEXPANSIONS</td><td>200</td><td>search-max-prefix-expansions</td><td>200</td><td>å‰ç¼€æ‰©å±•é™åˆ¶ï¼ˆå…¼å®¹ï¼‰</td></tr><tr><td>RAW_DOCID_ENCODING</td><td>false</td><td>search-raw-docid-encoding</td><td>no</td><td>æ–‡æ¡£IDæ˜¯å¦åŸå§‹ç¼–ç </td></tr><tr><td>UPGRADE_INDEX</td><td>Upgrade config for upgrading</td><td>N/A</td><td>N/A</td><td>å‡çº§ç´¢å¼•é…ç½®æç¤º</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>2ï¸âƒ£ æŸ¥è¯¢ / è¯„åˆ†ç›¸å…³é…ç½®</p></li></ul><table><thead><tr><th>FT.CONFIG å‚æ•°</th><th>FT.CONFIG å€¼</th><th>CONFIG search-* å‚æ•°</th><th>CONFIG å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>TIMEOUT</td><td>500</td><td>search-timeout</td><td>500</td><td>æŸ¥è¯¢è¶…æ—¶ï¼ˆmsï¼‰</td></tr><tr><td>ON_TIMEOUT</td><td>return</td><td>search-on-timeout</td><td>return</td><td>è¶…æ—¶ç­–ç•¥</td></tr><tr><td>DEFAULT_SCORER</td><td>TFIDF</td><td>search-default-scorer</td><td>BM25STD</td><td>é»˜è®¤è¯„åˆ†ç®—æ³•</td></tr><tr><td>BM25STD_TANH_FACTOR</td><td>4</td><td>search-bm25std-tanh-factor</td><td>4</td><td>BM25 è°ƒæ•´å› å­</td></tr><tr><td>MULTI_TEXT_SLOP</td><td>100</td><td>search-multi-text-slop</td><td>100</td><td>å¤šå­—æ®µæŸ¥è¯¢ slop</td></tr><tr><td>DEFAULT_DIALECT</td><td>1</td><td>search-default-dialect</td><td>1</td><td>æŸ¥è¯¢æ–¹è¨€</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>3ï¸âƒ£ GC / åå°ç´¢å¼•é…ç½®</p></li></ul><table><thead><tr><th>FT.CONFIG å‚æ•°</th><th>FT.CONFIG å€¼</th><th>CONFIG search-* å‚æ•°</th><th>CONFIG å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>NOGC</td><td>false</td><td>search-no-gc</td><td>no</td><td>ç¦ç”¨ GC</td></tr><tr><td>GC_POLICY</td><td>fork</td><td>search-fork-gc-policy (implicit)</td><td>fork</td><td>GC ç­–ç•¥</td></tr><tr><td>FORKGC_SLEEP_BEFORE_EXIT</td><td>0</td><td>search-fork-gc-sleep-before-exit</td><td>0</td><td>fork GC é€€å‡ºå‰ç¡çœ </td></tr><tr><td>FORK_GC_RUN_INTERVAL</td><td>30</td><td>search-fork-gc-run-interval</td><td>30</td><td>fork GC æ‰§è¡Œé—´éš”ï¼ˆç§’ï¼‰</td></tr><tr><td>FORK_GC_CLEAN_THRESHOLD</td><td>100</td><td>search-fork-gc-clean-threshold</td><td>100</td><td>fork GC æ¸…ç†é˜ˆå€¼</td></tr><tr><td>FORK_GC_RETRY_INTERVAL</td><td>5</td><td>search-fork-gc-retry-interval</td><td>5</td><td>fork GC é‡è¯•é—´éš”</td></tr><tr><td>FORK_GC_CLEAN_NUMERIC_EMPTY_NODES</td><td>true</td><td>search-_numeric-compress</td><td>no</td><td>æ¸…ç†ç©ºæ•°å€¼èŠ‚ç‚¹</td></tr><tr><td>GCSCANSIZE</td><td>100</td><td>search-gc-scan-size</td><td>100</td><td>GC æ¯æ¬¡æ‰«æå¤§å°</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>4ï¸âƒ£ æ¸¸æ ‡ / çº¿ç¨‹ / å¹¶å‘é…ç½®</p></li></ul><table><thead><tr><th>FT.CONFIG å‚æ•°</th><th>FT.CONFIG å€¼</th><th>CONFIG search-* å‚æ•°</th><th>CONFIG å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>CURSOR_MAX_IDLE</td><td>300000</td><td>search-cursor-max-idle</td><td>300000</td><td>æ¸¸æ ‡æœ€å¤§ç©ºé—²æ—¶é—´</td></tr><tr><td>INDEX_CURSOR_LIMIT</td><td>128</td><td>search-index-cursor-limit</td><td>128</td><td>å•ç´¢å¼•æ¸¸æ ‡é™åˆ¶</td></tr><tr><td>UNION_ITERATOR_HEAP</td><td>20</td><td>search-union-iterator-heap</td><td>20</td><td>UNION æŸ¥è¯¢å †å¤§å°</td></tr><tr><td>NO_MEM_POOLS</td><td>false</td><td>search-no-mem-pools</td><td>no</td><td>ç¦ç”¨å†…å­˜æ± </td></tr><tr><td>_FREE_RESOURCE_ON_THREAD</td><td>true</td><td>search-_free-resource-on-thread</td><td>yes</td><td>çº¿ç¨‹é‡Šæ”¾èµ„æº</td></tr><tr><td>search_min_operation_workers</td><td>N/A</td><td>search-min-operation-workers</td><td>4</td><td>æœ€å°æ“ä½œçº¿ç¨‹æ•°</td></tr><tr><td>search-workers</td><td>N/A</td><td>search-workers</td><td>0</td><td>å·¥ä½œçº¿ç¨‹æ•°</td></tr><tr><td>search-workers-priority-bias-threshold</td><td>N/A</td><td>search-workers-priority-bias-threshold</td><td>1</td><td>çº¿ç¨‹ä¼˜å…ˆçº§åç½®</td></tr><tr><td>INDEXER_YIELD_EVERY_OPS</td><td>1000</td><td>search-indexer-yield-every-ops</td><td>1000</td><td>ç´¢å¼•å™¨ yield æ¯æ“ä½œæ•°</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>5ï¸âƒ£ å®éªŒ / å†…éƒ¨ /å…¶ä»–</p></li></ul><table><thead><tr><th>FT.CONFIG å‚æ•°</th><th>FT.CONFIG å€¼</th><th>CONFIG search-* å‚æ•°</th><th>CONFIG å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>EXTLOAD</td><td>nil</td><td>search-ext-load</td><td>â€œâ€</td><td>å¤–éƒ¨åŠ è½½æ¨¡å—</td></tr><tr><td>FRISOINI</td><td>nil</td><td>search-friso-ini</td><td>â€œâ€</td><td>ä¸­æ–‡åˆ†è¯åˆå§‹åŒ–</td></tr><tr><td>ENABLE_UNSTABLE_FEATURES</td><td>false</td><td>search-enable-unstable-features</td><td>no</td><td>å¯ç”¨å®éªŒç‰¹æ€§</td></tr><tr><td>_PRINT_PROFILE_CLOCK</td><td>true</td><td>search-_print-profile-clock</td><td>yes</td><td>Profiling å¼€å…³</td></tr><tr><td>_NUMERIC_RANGES_PARENTS</td><td>0</td><td>search-_numeric-ranges-parents</td><td>0</td><td>æ•°å€¼èŒƒå›´çˆ¶èŠ‚ç‚¹æ•°</td></tr><tr><td>VSS_MAX_RESIZE</td><td>0</td><td>search-vss-max-resize</td><td>1024</td><td>å‘é‡ç´¢å¼•æœ€å¤§é‡åˆ†é…</td></tr><tr><td>PARTIAL_INDEXED_DOCS</td><td>false</td><td>search-partial-indexed-docs</td><td>no</td><td>éƒ¨åˆ†ç´¢å¼•æ–‡æ¡£æ ‡è®°</td></tr><tr><td>_PRIORITIZE_INTERSECT_UNION_CHILDREN</td><td>false</td><td>search-_prioritize-intersect-union-children</td><td>no</td><td>ä¼˜å…ˆå¤„ç† INTERSECT/UNION å­èŠ‚ç‚¹</td></tr><tr><td>_BG_INDEX_MEM_PCT_THR</td><td>100</td><td>search-_bg-index-mem-pct-thr</td><td>100</td><td>åå°ç´¢å¼•å†…å­˜é˜ˆå€¼</td></tr><tr><td>_NUMERIC_COMPRESS</td><td>false</td><td>search-_numeric-compress</td><td>no</td><td>æ•°å€¼å‹ç¼©</td></tr><tr><td>_BG_INDEX_OOM_PAUSE_TIME</td><td>0</td><td>search-_bg-index-oom-pause-time</td><td>0</td><td>åå°ç´¢å¼• OOM æš‚åœæ—¶é—´</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch çš„ä½¿ç”¨æ–¹æ³•&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æ“ä½œç³»ç»Ÿï¼š&lt;code&gt;Amazon Linux 2023(å†…æ ¸ 6.1)&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;RediSearch çš„å®‰è£…å‚è§ &lt;a href=&quot;/2025/12/26/redis7-module-RediSearch/&quot; title=&quot;Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•&quot;&gt;Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo&quot;&gt;GitHub&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•</title>
    <link href="https://blog.hanqunfeng.com/2025/12/26/redis7-module-RediSearch/"/>
    <id>https://blog.hanqunfeng.com/2025/12/26/redis7-module-RediSearch/</id>
    <published>2025-12-26T13:30:05.000Z</published>
    <updated>2026-01-07T07:22:09.326Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch çš„å®‰è£…æ–¹æ³•</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li></ul><span id="more"></span><h2 id="RediSearch-ç®€ä»‹">RediSearch ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/RediSearch/RediSearch">RediSearch</a> æ˜¯ Redis å®˜æ–¹æ¨å‡ºçš„ <code>å…¨æ–‡æœç´¢</code>ä¸<code>äºŒçº§ç´¢å¼•</code>æ¨¡å—ï¼Œç”¨äºåœ¨ Redis ä¹‹ä¸Šæä¾›ç±»ä¼¼<code>æœç´¢å¼•æ“</code>çš„èƒ½åŠ›ï¼Œè§£å†³â€œåªèƒ½æŒ‰ key æŸ¥ã€æ— æ³•é«˜æ•ˆæŒ‰å­—æ®µæŸ¥è¯¢â€çš„é—®é¢˜ã€‚å®ƒæ˜¯ Redis Stack çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œå¸¸ç”¨äºæœç´¢ã€è¿‡æ»¤ã€æ’åºå’Œèšåˆåœºæ™¯ã€‚ä»…æ”¯æŒå¯¹ Hash å’Œ RedisJSON ç±»å‹è¿›è¡Œç´¢å¼•ã€‚</p></li><li class="lvl-2"><p>è¯¥æ¨¡å—ä»¥ <code>Redis Module</code> æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚</p></li><li class="lvl-2"><p>Redis8+ï¼ŒRediSearch å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚</p></li><li class="lvl-2"><p>RediSearch é€šè¿‡ <code>ç´¢å¼•ç»“æ„</code> + <code>æŸ¥è¯¢è¯­è¨€</code>ï¼Œæä¾›ï¼š</p><ul class="lvl-2"><li class="lvl-4">å…¨æ–‡æœç´¢ï¼ˆText Searchï¼‰</li><li class="lvl-4">äºŒçº§ç´¢å¼•ï¼ˆæŒ‰å­—æ®µæŸ¥è¯¢ï¼‰</li><li class="lvl-4">å¤šæ¡ä»¶è¿‡æ»¤ / æ’åº</li><li class="lvl-4">èšåˆåˆ†æï¼ˆGROUP BYã€COUNTã€SUM ç­‰ï¼‰</li></ul></li><li class="lvl-2"><p>æ€§èƒ½ä¸è®¾è®¡ç‰¹ç‚¹</p><ul class="lvl-2"><li class="lvl-4">ç´¢å¼•åœ¨å†…å­˜ä¸­ï¼ŒæŸ¥è¯¢å»¶è¿Ÿä½ï¼ˆæ¯«ç§’çº§ï¼‰</li><li class="lvl-4">å†™å…¥æ—¶åŒæ­¥æ›´æ–°ç´¢å¼•ï¼ˆå†™å…¥æˆæœ¬ç•¥é«˜ï¼‰</li><li class="lvl-4">é€‚åˆ è¯»å¤šå†™å°‘ / æŸ¥è¯¢å¤æ‚ çš„ä¸šåŠ¡</li><li class="lvl-4">éäº‹åŠ¡å‹æœç´¢å¼•æ“ï¼ˆä¸æ›¿ä»£ ESï¼Œè€Œæ˜¯äº’è¡¥ï¼‰</li></ul></li><li class="lvl-2"><p>ä¸åŸç”Ÿ Redis çš„å¯¹æ¯”</p></li></ul><table><thead><tr><th>ç»´åº¦</th><th>Redis åŸç”Ÿ</th><th>RediSearch</th></tr></thead><tbody><tr><td>æŸ¥è¯¢æ–¹å¼</td><td>key ç²¾ç¡®</td><td>å¤šå­—æ®µæŸ¥è¯¢</td></tr><tr><td>å…¨æ–‡æœç´¢</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>èŒƒå›´æŸ¥è¯¢</td><td>æœ‰é™</td><td>å¼º</td></tr><tr><td>èšåˆç»Ÿè®¡</td><td>åŸºæœ¬æ²¡æœ‰</td><td>ç±» SQL</td></tr><tr><td>æ€§èƒ½</td><td>æå¿«</td><td>è¿‘å®æ—¶ï¼Œå†…å­˜æ¢æ€§èƒ½</td></tr></tbody></table><h2 id="RediSearch-vs-Elasticsearch">RediSearch vs Elasticsearch</h2><table><thead><tr><th>å¯¹æ¯”ç‚¹</th><th>RediSearch</th><th>Elasticsearch</th></tr></thead><tbody><tr><td>éƒ¨ç½²å¤æ‚åº¦</td><td>ä½</td><td>é«˜</td></tr><tr><td>å»¶è¿Ÿ</td><td>æä½</td><td>è¾ƒé«˜</td></tr><tr><td>æ•°æ®è§„æ¨¡</td><td>ä¸­å°è§„æ¨¡</td><td>è¶…å¤§è§„æ¨¡</td></tr><tr><td>å®æ—¶æ€§</td><td>å¼º</td><td>è¿‘å®æ—¶</td></tr><tr><td>åœºæ™¯</td><td>ä¸šåŠ¡å†…æœç´¢</td><td>æœç´¢å¹³å°</td></tr></tbody></table><h2 id="å®‰è£…-RediSearch">å®‰è£… RediSearch</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä»<a href="https://cloud.redis.io">Redis Cloud</a>çš„<code>Download Center</code>ä¸­è¿›è¡Œä¸‹è½½ï¼Œå…¶æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„<code>.so</code>æ–‡ä»¶ï¼Œå¯ä»¥ä¼˜å…ˆè¿›è¡Œå°è¯•ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/rguEIA.png" alt=""></p></li><li class="lvl-2"><p>æºç ç¼–è¯‘</p></li></ul><blockquote><p>å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚<br>å¯ä»¥åœ¨æµ·å¤–çš„<code>ç›¸åŒé…ç½®</code>çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„<code>redisearch.so</code>ä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…ä¾èµ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install -y \</span><br><span class="line">  gcc \</span><br><span class="line">  gcc-c++ \</span><br><span class="line">  make \</span><br><span class="line">  cmake \</span><br><span class="line">  autoconf \</span><br><span class="line">  automake \</span><br><span class="line">  libtool \</span><br><span class="line">  pkgconfig \</span><br><span class="line">  openssl-devel \</span><br><span class="line">  libstdc++ \</span><br><span class="line">  libstdc++-devel</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>RediSearch æœ€æ–°ç‰ˆæœ¬ ä¾èµ– CMake 3.25+ï¼Œdnfæºä¸­çš„ç‰ˆæœ¬è¾ƒä½ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ‰‹åŠ¨å®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CMAKE_VERSION=3.25.1</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/local/src</span><br><span class="line">wget https://github.com/Kitware/CMake/releases/download/v<span class="variable">$&#123;CMAKE_VERSION&#125;</span>/cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span>.tar.gz</span><br><span class="line">tar -xf cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span></span><br><span class="line"></span><br><span class="line">./bootstrap --prefix=/usr/local</span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯ç‰ˆæœ¬ /usr/local/bin/cmake</span></span><br><span class="line">/usr/local/bin/cmake --version</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¼–è¯‘RediSearch</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /usr/local/soft/modules/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/soft/modules</span><br><span class="line"><span class="comment"># clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—</span></span><br><span class="line">git <span class="built_in">clone</span> --recursive https://github.com/RediSearch/RediSearch.git</span><br><span class="line"><span class="built_in">cd</span> RediSearch</span><br><span class="line"><span class="comment"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class="line">git checkout v2.10.25</span><br><span class="line"><span class="comment"># æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥</span></span><br><span class="line">git submodule update --init --recursive</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º build_dir ç›®å½•ï¼Œç¼–è¯‘å¤±è´¥è¦å…ˆåˆ é™¤è¯¥ç›®å½•åœ¨é‡æ–°åˆ›å»º</span></span><br><span class="line"><span class="built_in">mkdir</span> build_dir &amp;&amp; <span class="built_in">cd</span> build_dir</span><br><span class="line"><span class="comment"># ç”Ÿæˆ Makefile</span></span><br><span class="line">/usr/local/bin/cmake .. \</span><br><span class="line">  -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">  -DCMAKE_C_COMPILER=gcc \</span><br><span class="line">  -DCMAKE_CXX_COMPILER=g++</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘ RediSearch</span></span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="comment"># ç¼–è¯‘è¿‡ç¨‹ä¼šæŠ¥é”™ï¼ŒåŒæ ·åœ¨ Rocky9 ä¸Šä¹Ÿä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜</span></span><br><span class="line">[100%] Linking CXX shared library redisearch.so</span><br><span class="line">/usr/bin/ld: cannot find -lstdc++: No such file or directory</span><br><span class="line">collect2: error: ld returned 1 <span class="built_in">exit</span> status</span><br><span class="line">make[2]: *** [CMakeFiles/redisearch.dir/build.make:557: redisearch.so] Error 1</span><br><span class="line">make[1]: *** [CMakeFiles/Makefile2:2958: CMakeFiles/redisearch.dir/all] Error 2</span><br><span class="line">make: *** [Makefile:136: all] Error 2</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¼–è¯‘é”™è¯¯åŸå› åˆ†æ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RediSearch 2.10.x åœ¨é“¾æ¥ redisearch.so æ—¶ å¼ºåˆ¶ ä½¿ç”¨ -static-libstdc++ï¼Œè€Œ libstdc++.a é™æ€æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯¼è‡´ç¼–è¯‘å¤±è´¥</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è§£å†³æ–¹æ³•æ˜¯å®‰è£…é™æ€åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install -y libstdc++-static</span><br><span class="line"><span class="comment"># éªŒè¯é™æ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="built_in">ls</span> /usr/lib/gcc/x86_64-amazon-linux/*/libstdc++.a</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">/usr/lib/gcc/x86_64-amazon-linux/11/libstdc++.a</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…åé‡æ–°ç¼–è¯‘RediSearch</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/soft/modules</span><br><span class="line"><span class="comment"># åˆ é™¤ build_dir ç›®å½•</span></span><br><span class="line"><span class="built_in">rm</span> -rf build_dir</span><br><span class="line"><span class="comment"># åˆ›å»º build_dir ç›®å½•ï¼Œç¼–è¯‘å¤±è´¥è¦å…ˆåˆ é™¤è¯¥ç›®å½•å†é‡æ–°åˆ›å»º</span></span><br><span class="line"><span class="built_in">mkdir</span> build_dir &amp;&amp; <span class="built_in">cd</span> build_dir</span><br><span class="line"><span class="comment"># ç”Ÿæˆ Makefile</span></span><br><span class="line">/usr/local/bin/cmake .. \</span><br><span class="line">  -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">  -DCMAKE_C_COMPILER=gcc \</span><br><span class="line">  -DCMAKE_CXX_COMPILER=g++</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘ RediSearchï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œè¾“å‡º: build_dir/redisearch.so</span></span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br></pre></td></tr></table></figure><h2 id="Redis-å¯ç”¨æ¨¡å—">Redis å¯ç”¨æ¨¡å—</h2><ul class="lvl-0"><li class="lvl-2"><p>å°†ç”Ÿæˆçš„ <code>redisearch.so</code> æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">cp</span> build_dir/redisearch.so /usr/local/soft/redis-7.4.7/modules/redisearch.so</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡é‡‡ç”¨ <code>loadmodule</code> åŠ è½½æ¨¡å—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°† redisearch.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class="line">loadmodule /usr/local/soft/redis-7.4.7/modules/redisearch.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨redis</span></span><br><span class="line">redis-server redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½•æµ‹è¯•</span></span><br><span class="line">redis-cli --user admin --pass 123456</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ¨¡å—</span></span><br><span class="line">127.0.0.1:6379&gt; MODULE LIST</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;ReJSON&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 20816</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;bf&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 20817</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">3) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;search&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 21025</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/redisearch.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br></pre></td></tr></table></figure><h2 id="Rocky9-ç¼–è¯‘å®‰è£…-RediSearch">Rocky9 ç¼–è¯‘å®‰è£… RediSearch</h2><blockquote><p>ç³»ç»Ÿç‰ˆæœ¬ï¼š<code>Rocky Linux release 9.4 (Blue Onyx)</code></p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…ä¾èµ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install -y \</span><br><span class="line">  gcc \</span><br><span class="line">  gcc-c++ \</span><br><span class="line">  make \</span><br><span class="line">  cmake \</span><br><span class="line">  autoconf \</span><br><span class="line">  automake \</span><br><span class="line">  libtool \</span><br><span class="line">  pkgconfig \</span><br><span class="line">  openssl-devel \</span><br><span class="line">  libstdc++ \</span><br><span class="line">  libstdc++-devel</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ç”¨ CRB</p></li></ul><blockquote><p>åœ¨ Rocky Linux 9 ä¸­ï¼Œ<code>libstdc++-static</code> ä¸åœ¨é»˜è®¤ä»“åº“é‡Œï¼Œå®ƒä½äº CRBï¼ˆCodeReady Builderï¼‰ä»“åº“ï¼Œé»˜è®¤æ˜¯ å…³é—­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå¯ç”¨å®ƒ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœä½ ç³»ç»Ÿé‡Œæ²¡æœ‰ config-managerï¼Œéœ€è¦å…ˆå…ˆè£…</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install -y dnf-plugins-core</span><br><span class="line"><span class="comment"># å¯ç”¨ CRB</span></span><br><span class="line"><span class="built_in">sudo</span> dnf config-manager --set-enabled crb</span><br><span class="line"><span class="comment"># åˆ·æ–°ç¼“å­˜</span></span><br><span class="line"><span class="built_in">sudo</span> dnf makecache</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…é™æ€åº“ï¼Œè§£å†³<code>/usr/bin/ld: cannot find -lstdc++: No such file or directory</code>çš„é—®é¢˜</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install -y libstdc++-static</span><br><span class="line"><span class="comment"># éªŒè¯é™æ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="built_in">ls</span> /usr/lib/gcc/x86_64-redhat-linux/*/libstdc++.a</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¼–è¯‘RediSearch</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /usr/local/soft/modules/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/soft/modules</span><br><span class="line"><span class="comment"># clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—</span></span><br><span class="line">git <span class="built_in">clone</span> --recursive https://github.com/RediSearch/RediSearch.git</span><br><span class="line"><span class="built_in">cd</span> RediSearch</span><br><span class="line"><span class="comment"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class="line">git checkout v2.10.25</span><br><span class="line"><span class="comment"># æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥</span></span><br><span class="line">git submodule update --init --recursive</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º build_dir ç›®å½•ï¼Œç¼–è¯‘å¤±è´¥è¦å…ˆåˆ é™¤è¯¥ç›®å½•å†é‡æ–°åˆ›å»º</span></span><br><span class="line"><span class="built_in">mkdir</span> build_dir &amp;&amp; <span class="built_in">cd</span> build_dir</span><br><span class="line"><span class="comment"># ç”Ÿæˆ Makefile</span></span><br><span class="line">cmake .. \</span><br><span class="line">  -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">  -DCMAKE_C_COMPILER=gcc \</span><br><span class="line">  -DCMAKE_CXX_COMPILER=g++</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘ RediSearchï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œè¾“å‡º: build_dir/redisearch.so</span></span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch çš„å®‰è£…æ–¹æ³•&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æ“ä½œç³»ç»Ÿï¼š&lt;code&gt;Amazon Linux 2023(å†…æ ¸ 6.1)&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Amazon Linux 2023(å†…æ ¸ 6.1) å®‰è£… Redis8</title>
    <link href="https://blog.hanqunfeng.com/2025/12/25/redis8-install-amazon-linux-2023/"/>
    <id>https://blog.hanqunfeng.com/2025/12/25/redis8-install-amazon-linux-2023/</id>
    <published>2025-12-25T13:30:05.000Z</published>
    <updated>2026-01-07T10:32:31.441Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Linux å®‰è£… Redis8 çš„æ–¹æ³•</li><li class="lvl-2">Linux ç‰ˆæœ¬ï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code>ã€‚</li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2"><a href="https://redis.io/docs/latest/operate/oss_and_stack/install/install-stack/rpm/">Rediså®˜ç½‘å®‰è£…æ‰‹å†Œ</a></li></ul><span id="more"></span><h2 id="Yum-å®‰è£…">Yum å®‰è£…</h2><blockquote><p>æœ€çœäº‹ï¼Œå›½å†…ç¯å¢ƒä¹Ÿå¯ä»¥é¡ºåˆ©å®Œæˆå®‰è£…ã€‚<br><code>Amazon Linux 2023(å†…æ ¸ 6.1)</code> å’Œ <code>Rocky Linux release 9.4 (Blue Onyx)</code> å‡æˆåŠŸå®‰è£…ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>1.æ·»åŠ ä»“åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/yum.repos.d/redis.repo &gt; /dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Redis]</span></span><br><span class="line"><span class="string">name=Redis</span></span><br><span class="line"><span class="string">baseurl=http://packages.redis.io/rpm/rockylinux9</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>2.å®‰è£… Redis</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://packages.redis.io/gpg &gt; /tmp/redis.key</span><br><span class="line"><span class="built_in">sudo</span> rpm --import /tmp/redis.key</span><br><span class="line"><span class="built_in">sudo</span> yum install redis -y</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>3.æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å·²å®‰è£…çš„redisç‰ˆæœ¬</span></span><br><span class="line">$ rpm -qa | grep redis</span><br><span class="line">redis-8.4.0-1.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯</span></span><br><span class="line">$ rpm -qi redis-8.4.0-1.x86_64</span><br><span class="line">Name        : redis</span><br><span class="line">Version     : 8.4.0</span><br><span class="line">Release     : 1</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: Wed 24 Dec 2025 06:05:22 AM UTC</span><br><span class="line">Group       : Applications/Databases</span><br><span class="line">Size        : 83034075</span><br><span class="line">License     :</span><br><span class="line">Signature   : RSA/SHA512, Mon 01 Dec 2025 12:05:10 PM UTC, Key ID 5f4349d6bf53aa0c</span><br><span class="line">Source RPM  : redis-8.4.0-1.src.rpm</span><br><span class="line">Build Date  : Tue 18 Nov 2025 04:41:58 PM UTC</span><br><span class="line">Build Host  : 331d5099e900</span><br><span class="line">Packager    : Redis Labs &lt;redis@redis.io&gt;</span><br><span class="line">URL         : https://redis.io/</span><br><span class="line">Summary     : Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.</span><br><span class="line">Description :</span><br><span class="line">Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹rediså®‰è£…çš„æ–‡ä»¶</span></span><br><span class="line">$ rpm -ql redis-8.4.0-1.x86_64</span><br><span class="line">/etc/redis</span><br><span class="line">/etc/redis/redis.conf</span><br><span class="line">/etc/redis/sentinel</span><br><span class="line">/etc/redis/sentinel/sentinel.conf</span><br><span class="line">/run/redis</span><br><span class="line">/run/redis/redis-server.pid</span><br><span class="line">/usr/bin/redis-benchmark</span><br><span class="line">/usr/bin/redis-check-aof</span><br><span class="line">/usr/bin/redis-check-rdb</span><br><span class="line">/usr/bin/redis-cli</span><br><span class="line">/usr/bin/redis-sentinel</span><br><span class="line">/usr/bin/redis-server</span><br><span class="line">/usr/lib/redis</span><br><span class="line">/usr/lib/redis/modules</span><br><span class="line">/usr/lib/redis/modules/redisbloom.so</span><br><span class="line">/usr/lib/redis/modules/redisearch.so</span><br><span class="line">/usr/lib/redis/modules/redistimeseries.so</span><br><span class="line">/usr/lib/redis/modules/rejson.so</span><br><span class="line">/usr/lib/redis/redisbloom.so</span><br><span class="line">/usr/lib/redis/redisearch.so</span><br><span class="line">/usr/lib/redis/redistimeseries.so</span><br><span class="line">/usr/lib/redis/rejson.so</span><br><span class="line">/usr/lib/systemd/system/redis-sentinel.service</span><br><span class="line">/usr/lib/systemd/system/redis.service</span><br><span class="line">/usr/share/selinux/packages/redis-ce.fc</span><br><span class="line">/usr/share/selinux/packages/redis-ce.te</span><br><span class="line">/var/lib/redis</span><br><span class="line">/var/log/redis</span><br><span class="line">/var/log/redis/redis-sentinel.log</span><br><span class="line">/var/log/redis/redis-server.log</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>4.å¯åŠ¨redis</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> redis</span><br><span class="line"><span class="built_in">sudo</span> systemctl start redis</span><br><span class="line"><span class="built_in">sudo</span> systemctl status redis</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>5.ç™»å½•redis</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; MODULE LIST</span><br><span class="line">1) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;bf&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80400</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/lib/redis/modules/redisbloom.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80400</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/lib/redis/modules/redistimeseries.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">3) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;ReJSON&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80400</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/lib/redis/modules/rejson.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">4) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;vectorset&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 1</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">5) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;search&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80402</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/lib/redis/modules/redisearch.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br></pre></td></tr></table></figure><h2 id="æºç å®‰è£…">æºç å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>1.æ›´æ–°ç¯å¢ƒ(éå¿…é¡»)</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf update -y</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>2.å®‰è£…ä¾èµ–åŒ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install -y --nobest --skip-broken \</span><br><span class="line">    pkg-config \</span><br><span class="line">    xz \</span><br><span class="line">    wget \</span><br><span class="line">    <span class="built_in">which</span> \</span><br><span class="line">    git \</span><br><span class="line">    make \</span><br><span class="line">    openssl \</span><br><span class="line">    openssl-devel \</span><br><span class="line">    python3 \</span><br><span class="line">    python3-pip \</span><br><span class="line">    python3-devel \</span><br><span class="line">    unzip \</span><br><span class="line">    rsync \</span><br><span class="line">    clang \</span><br><span class="line">    llvm \</span><br><span class="line">    curl \</span><br><span class="line">    libtool \</span><br><span class="line">    automake \</span><br><span class="line">    autoconf \</span><br><span class="line">    jq \</span><br><span class="line">    systemd-devel</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>3.ä¸‹è½½å¹¶æå–Redisæºä»£ç </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/src</span><br><span class="line"><span class="built_in">sudo</span> wget -O redis-8.4.0.tar.gz https://github.com/redis/redis/archive/refs/tags/8.4.0.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> tar -xzf redis-8.4.0.tar.gz</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>4.ç¼–è¯‘Redis</p></li></ul><blockquote><p>è¿™é‡Œè¦æ³¨æ„ï¼Œä¸ä¼šè‡ªåŠ¨å®‰è£…æ¨¡å—ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ç”¨GCCå·¥å…·é›†</span></span><br><span class="line"><span class="built_in">cd</span> /usr/src/redis-8.4.0</span><br><span class="line"><span class="comment"># æ„å»ºTLS</span></span><br><span class="line"><span class="built_in">export</span> BUILD_TLS=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># æ„å»ºRedisæ¨¡å—ï¼Œé…ä¸é…éƒ½ä¸ä¼šè‡ªåŠ¨å®‰è£…æ¨¡å—</span></span><br><span class="line"><span class="built_in">export</span> BUILD_WITH_MODULES=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># å®‰è£…Rustå·¥å…·é“¾</span></span><br><span class="line"><span class="built_in">export</span> INSTALL_RUST_TOOLCHAIN=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># å…³é—­è­¦å‘Š</span></span><br><span class="line"><span class="built_in">export</span> DISABLE_WERRORS=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># å¼€å§‹ç¼–è¯‘</span></span><br><span class="line"><span class="built_in">sudo</span> make -j <span class="string">&quot;<span class="subst">$(nproc)</span>&quot;</span> all</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯</span></span><br><span class="line">./src/redis-server --version</span><br><span class="line">./src/redis-cli --version</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>5.å¯åŠ¨Redis</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ./src/redis-server redis.conf</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>6.ç™»å½•Redis</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ./src/redis-cli</span><br><span class="line">127.0.0.1:6379&gt; MODULE LIST</span><br><span class="line">1) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;vectorset&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 1</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>7.å®‰è£…æ¨¡å—ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–‡ç« ä¸­çš„ä»‹ç»</p><ul class="lvl-2"><li class="lvl-5"><a href="/2025/12/24/redis7-module-RedisJSON/" title="Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•</a></li><li class="lvl-5"><a href="/2025/12/21/redis7-module-RedisBloom/" title="Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li><li class="lvl-5"><a href="/2025/12/26/redis7-module-RediSearch/" title="Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•</a></li><li class="lvl-5"><a href="/2026/01/07/redis7-module-RedisTimeSeries/" title="Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•</a></li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Linux å®‰è£… Redis8 çš„æ–¹æ³•&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Linux ç‰ˆæœ¬ï¼š&lt;code&gt;Amazon Linux 2023(å†…æ ¸ 6.1)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;&lt;a href=&quot;https://redis.io/docs/latest/operate/oss_and_stack/install/install-stack/rpm/&quot;&gt;Rediså®˜ç½‘å®‰è£…æ‰‹å†Œ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Rcoky9 å®‰è£… Redis8</title>
    <link href="https://blog.hanqunfeng.com/2025/12/25/redis8-install-rocky9/"/>
    <id>https://blog.hanqunfeng.com/2025/12/25/redis8-install-rocky9/</id>
    <published>2025-12-25T13:30:05.000Z</published>
    <updated>2025-12-24T10:06:24.246Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Linux å®‰è£… Redis8 çš„æ–¹æ³•</li><li class="lvl-2">Linux ç‰ˆæœ¬ï¼š<code>Rocky Linux release 9.4 (Blue Onyx)</code>ã€‚</li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2"><a href="https://redis.io/docs/latest/operate/oss_and_stack/install/install-stack/rpm/">Rediså®˜ç½‘å®‰è£…æ‰‹å†Œ</a></li></ul><span id="more"></span><h2 id="Yum-å®‰è£…">Yum å®‰è£…</h2><blockquote><p>æœ€çœäº‹ï¼Œå›½å†…ç¯å¢ƒä¹Ÿå¯ä»¥é¡ºåˆ©å®Œæˆå®‰è£…ã€‚<br><code>Amazon Linux 2023(å†…æ ¸ 6.1)</code> å’Œ <code>Rocky Linux release 9.4 (Blue Onyx)</code> å‡æˆåŠŸå®‰è£…ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>1.æ·»åŠ ä»“åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/yum.repos.d/redis.repo &gt; /dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Redis]</span></span><br><span class="line"><span class="string">name=Redis</span></span><br><span class="line"><span class="string">baseurl=http://packages.redis.io/rpm/rockylinux9</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>2.å®‰è£… Redis</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://packages.redis.io/gpg &gt; /tmp/redis.key</span><br><span class="line"><span class="built_in">sudo</span> rpm --import /tmp/redis.key</span><br><span class="line"><span class="built_in">sudo</span> yum install redis -y</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>3.æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å·²å®‰è£…çš„redisç‰ˆæœ¬</span></span><br><span class="line">$ rpm -qa | grep redis</span><br><span class="line">redis-8.4.0-1.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯</span></span><br><span class="line">$ rpm -qi redis-8.4.0-1.x86_64</span><br><span class="line">Name        : redis</span><br><span class="line">Version     : 8.4.0</span><br><span class="line">Release     : 1</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: Wed 24 Dec 2025 06:05:22 AM UTC</span><br><span class="line">Group       : Applications/Databases</span><br><span class="line">Size        : 83034075</span><br><span class="line">License     :</span><br><span class="line">Signature   : RSA/SHA512, Mon 01 Dec 2025 12:05:10 PM UTC, Key ID 5f4349d6bf53aa0c</span><br><span class="line">Source RPM  : redis-8.4.0-1.src.rpm</span><br><span class="line">Build Date  : Tue 18 Nov 2025 04:41:58 PM UTC</span><br><span class="line">Build Host  : 331d5099e900</span><br><span class="line">Packager    : Redis Labs &lt;redis@redis.io&gt;</span><br><span class="line">URL         : https://redis.io/</span><br><span class="line">Summary     : Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.</span><br><span class="line">Description :</span><br><span class="line">Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹rediså®‰è£…çš„æ–‡ä»¶</span></span><br><span class="line">$ rpm -ql redis-8.4.0-1.x86_64</span><br><span class="line">/etc/redis</span><br><span class="line">/etc/redis/redis.conf</span><br><span class="line">/etc/redis/sentinel</span><br><span class="line">/etc/redis/sentinel/sentinel.conf</span><br><span class="line">/run/redis</span><br><span class="line">/run/redis/redis-server.pid</span><br><span class="line">/usr/bin/redis-benchmark</span><br><span class="line">/usr/bin/redis-check-aof</span><br><span class="line">/usr/bin/redis-check-rdb</span><br><span class="line">/usr/bin/redis-cli</span><br><span class="line">/usr/bin/redis-sentinel</span><br><span class="line">/usr/bin/redis-server</span><br><span class="line">/usr/lib/redis</span><br><span class="line">/usr/lib/redis/modules</span><br><span class="line">/usr/lib/redis/modules/redisbloom.so</span><br><span class="line">/usr/lib/redis/modules/redisearch.so</span><br><span class="line">/usr/lib/redis/modules/redistimeseries.so</span><br><span class="line">/usr/lib/redis/modules/rejson.so</span><br><span class="line">/usr/lib/redis/redisbloom.so</span><br><span class="line">/usr/lib/redis/redisearch.so</span><br><span class="line">/usr/lib/redis/redistimeseries.so</span><br><span class="line">/usr/lib/redis/rejson.so</span><br><span class="line">/usr/lib/systemd/system/redis-sentinel.service</span><br><span class="line">/usr/lib/systemd/system/redis.service</span><br><span class="line">/usr/share/selinux/packages/redis-ce.fc</span><br><span class="line">/usr/share/selinux/packages/redis-ce.te</span><br><span class="line">/var/lib/redis</span><br><span class="line">/var/log/redis</span><br><span class="line">/var/log/redis/redis-sentinel.log</span><br><span class="line">/var/log/redis/redis-server.log</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>4.å¯åŠ¨redis</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> redis</span><br><span class="line"><span class="built_in">sudo</span> systemctl start redis</span><br><span class="line"><span class="built_in">sudo</span> systemctl status redis</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>5.ç™»å½•redis</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; MODULE LIST</span><br><span class="line">1) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;bf&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80400</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/lib/redis/modules/redisbloom.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80400</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/lib/redis/modules/redistimeseries.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">3) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;ReJSON&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80400</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/lib/redis/modules/rejson.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">4) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;vectorset&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 1</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">5) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;search&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80402</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/lib/redis/modules/redisearch.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br></pre></td></tr></table></figure><h2 id="æºç å®‰è£…">æºç å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>1.æ·»åŠ ä»“åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/yum.repos.d/goreleaser.repo &gt; /dev/null &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[goreleaser]</span></span><br><span class="line"><span class="string">name=GoReleaser</span></span><br><span class="line"><span class="string">baseurl=https://repo.goreleaser.com/yum/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> dnf clean all</span><br><span class="line"><span class="built_in">sudo</span> dnf makecache</span><br><span class="line"><span class="built_in">sudo</span> dnf update -y</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>2.å®‰è£…ä¾èµ–åŒ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install -y --nobest --skip-broken \</span><br><span class="line">    pkg-config \</span><br><span class="line">    xz \</span><br><span class="line">    wget \</span><br><span class="line">    <span class="built_in">which</span> \</span><br><span class="line">    gcc-toolset-13-gcc \</span><br><span class="line">    gcc-toolset-13-gcc-c++ \</span><br><span class="line">    git \</span><br><span class="line">    make \</span><br><span class="line">    openssl \</span><br><span class="line">    openssl-devel \</span><br><span class="line">    python3 \</span><br><span class="line">    python3-pip \</span><br><span class="line">    python3-devel \</span><br><span class="line">    unzip \</span><br><span class="line">    rsync \</span><br><span class="line">    clang \</span><br><span class="line">    curl \</span><br><span class="line">    libtool \</span><br><span class="line">    automake \</span><br><span class="line">    autoconf \</span><br><span class="line">    jq \</span><br><span class="line">    systemd-devel</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>3.åˆ›å»ºä¸€ä¸ªPythonè™šæ‹Ÿç¯å¢ƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> python3 -m venv /opt/venv</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>4.å¯ç”¨GCCå·¥å…·é›†</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /opt/rh/gcc-toolset-13/enable /etc/profile.d/gcc-toolset-13.sh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;source /etc/profile.d/gcc-toolset-13.sh&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> -a /etc/bashrc</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>5.å®‰è£…CMake</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CMAKE_VERSION=3.25.1</span><br><span class="line">ARCH=$(<span class="built_in">uname</span> -m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ARCH</span>&quot;</span> = <span class="string">&quot;x86_64&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  CMAKE_FILE=cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span>-linux-x86_64.sh</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  CMAKE_FILE=cmake-<span class="variable">$&#123;CMAKE_VERSION&#125;</span>-linux-aarch64.sh</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> wget https://github.com/Kitware/CMake/releases/download/v<span class="variable">$&#123;CMAKE_VERSION&#125;</span>/<span class="variable">$&#123;CMAKE_FILE&#125;</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x <span class="variable">$&#123;CMAKE_FILE&#125;</span></span><br><span class="line"><span class="built_in">sudo</span> ./<span class="variable">$&#123;CMAKE_FILE&#125;</span> --skip-license --prefix=/usr/local --exclude-subdir</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> <span class="variable">$&#123;CMAKE_FILE&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/local/bin</span><br><span class="line">cmake --version</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>6.ä¸‹è½½å¹¶æå–Redisæºä»£ç </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/src</span><br><span class="line"><span class="built_in">sudo</span> wget -O redis-8.4.0.tar.gz https://github.com/redis/redis/archive/refs/tags/8.4.0.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> tar -xzf redis-8.4.0.tar.gz</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>7.ç¼–è¯‘Redis</p></li></ul><blockquote><p>å›½å†…ç¯å¢ƒå®‰è£…æ—¶å› ä¸ºéœ€è¦ä»GitHubä¸‹è½½æ¨¡å—ï¼Œé€Ÿåº¦å¾ˆæ…¢ï¼Œè€Œä¸”ç»å¸¸å¤±è´¥ï¼Œå»ºè®®å®‰è£…æ—¶å…ˆä¸è¦å®‰è£…æ¨¡å—ï¼Œå®‰è£…å¥½redisåå†æŒ‰éœ€å®‰è£…æ¨¡å—ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ç”¨GCCå·¥å…·é›†</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile.d/gcc-toolset-13.sh</span><br><span class="line"><span class="built_in">cd</span> /usr/src/redis-8.4.0</span><br><span class="line"><span class="comment"># æ„å»ºTLS</span></span><br><span class="line"><span class="built_in">export</span> BUILD_TLS=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># æ„å»ºRedisæ¨¡å—ï¼Œå¦‚æœä¸å®‰è£…æ¨¡å—ï¼Œåˆ™ä¸éœ€è¦æ­¤å‚æ•°</span></span><br><span class="line"><span class="built_in">export</span> BUILD_WITH_MODULES=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># å®‰è£…Rustå·¥å…·é“¾</span></span><br><span class="line"><span class="built_in">export</span> INSTALL_RUST_TOOLCHAIN=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># å…³é—­è­¦å‘Š</span></span><br><span class="line"><span class="built_in">export</span> DISABLE_WERRORS=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># å¼€å§‹ç¼–è¯‘</span></span><br><span class="line"><span class="built_in">sudo</span> make -j <span class="string">&quot;<span class="subst">$(nproc)</span>&quot;</span> all</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯</span></span><br><span class="line">./src/redis-server --version</span><br><span class="line">./src/redis-cli --version</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>8.å¯åŠ¨Redis</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ./src/redis-server redis-full.conf</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>9.ç™»å½•Redis</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$ ./src/redis-cli</span><br><span class="line">127.0.0.1:6379&gt; MODULE LIST</span><br><span class="line">1) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;search&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80402</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;./modules/redisearch/redisearch.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;vectorset&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 1</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">3) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;ReJSON&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80400</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;./modules/redisjson/rejson.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">4) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;bf&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80400</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;./modules/redisbloom/redisbloom.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">5) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 80400</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;./modules/redistimeseries/redistimeseries.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>10.å®‰è£…æ¨¡å—ï¼Œå¦‚æœå®‰è£…æ—¶æ²¡æœ‰å®‰è£…æ¨¡å—ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–‡ç« ä¸­çš„ä»‹ç»</p><ul class="lvl-2"><li class="lvl-5"><a href="/2025/12/24/redis7-module-RedisJSON/" title="Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•</a></li><li class="lvl-5"><a href="/2025/12/21/redis7-module-RedisBloom/" title="Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Linux å®‰è£… Redis8 çš„æ–¹æ³•&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Linux ç‰ˆæœ¬ï¼š&lt;code&gt;Rocky Linux release 9.4 (Blue Onyx)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;&lt;a href=&quot;https://redis.io/docs/latest/operate/oss_and_stack/install/install-stack/rpm/&quot;&gt;Rediså®˜ç½‘å®‰è£…æ‰‹å†Œ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- JSON</title>
    <link href="https://blog.hanqunfeng.com/2025/12/24/redis7-datatype-16-JSON/"/>
    <id>https://blog.hanqunfeng.com/2025/12/24/redis7-datatype-16-JSON/</id>
    <published>2025-12-24T13:40:05.000Z</published>
    <updated>2026-01-07T02:44:09.582Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisJSON ä¸­çš„ JSON æ•°æ®ç±»å‹</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2">RedisJSON çš„å®‰è£…å‚è§ <a href="/2025/12/24/redis7-module-RedisJSON/" title="Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•</a></li><li class="lvl-2">ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo">GitHub</a></li></ul><span id="more"></span><h2 id="JSON-vs-String">JSON vs String</h2><ul class="lvl-0"><li class="lvl-2"><p>Redis JSONå­˜å‚¨æ•°æ®çš„æ€§èƒ½æ›´é«˜ã€‚</p><ul class="lvl-2"><li class="lvl-6">Redis JSON åº•å±‚å…¶å®æ˜¯ä»¥ä¸€ç§é«˜æ•ˆçš„äºŒè¿›åˆ¶çš„æ ¼å¼å­˜å‚¨ã€‚</li><li class="lvl-6">ç›¸æ¯”ç®€å•çš„æ–‡æœ¬æ ¼å¼ï¼ŒäºŒè¿›åˆ¶æ ¼å¼è¿›è¡Œ JOSN æ ¼å¼è¯»å†™çš„æ€§èƒ½æ›´é«˜ï¼Œä¹Ÿæ›´èŠ‚çœå†…å­˜ã€‚</li><li class="lvl-6">æ ¹æ®å®˜ç½‘çš„æ€§èƒ½æµ‹è¯•æŠ¥å‘Šï¼Œä½¿ç”¨ Redis JSON è¯»å†™ JSONæ•°æ®ï¼Œæ€§èƒ½å·²ç»èƒ½å¤Ÿåª²ç¾ MongoDB ä»¥åŠ ElasticSearch ç­‰ä¼ ç»Ÿ NoSQL æ•°æ®åº“ã€‚</li></ul></li><li class="lvl-2"><p>Redis JSON ä½¿ç”¨æ ‘çŠ¶ç»“æ„æ¥å­˜å‚¨JSONã€‚</p><ul class="lvl-2"><li class="lvl-6">è¿™ç§å­˜å‚¨æ–¹å¼å¯ä»¥å¿«é€Ÿè®¿é—®å­å…ƒç´ ã€‚</li><li class="lvl-6">ä¸ä¼ ç»Ÿçš„æ–‡æœ¬å­˜å‚¨æ–¹æ¡ˆç›¸æ¯”ï¼Œæ ‘çŠ¶å­˜å‚¨ç»“æ„èƒ½å¤Ÿæ›´é«˜æ•ˆçš„æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚</li></ul></li><li class="lvl-2"><p>ä¸Redisç”Ÿæ€é›†æˆåº¦é«˜ã€‚</p><ul class="lvl-2"><li class="lvl-6">ä½œä¸ºRedisçš„æ‰©å±•æ¨¡å—ï¼ŒRedis JSON å’ŒRedisçš„å…¶ä»–åŠŸèƒ½å’Œå·¥å…·æ— ç¼é›†æˆã€‚</li><li class="lvl-6">è¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥ç»§ç»­ä½¿ç”¨TTLã€Redisäº‹åŠ¡ã€å‘å¸ƒ/è®¢é˜…ã€Luaè„šæœ¬ç­‰åŠŸèƒ½ã€‚</li></ul></li></ul><h2 id="JSONPath">JSONPath</h2><ul class="lvl-0"><li class="lvl-2"><p>JSONPath æ˜¯ä¸€ç§ç”¨äºæŸ¥è¯¢å’Œä¿®æ”¹ JSON æ•°æ®çš„è¯­æ³•ã€‚</p></li><li class="lvl-2"><p>JSONPath è¯­æ³•</p></li></ul><table><thead><tr><th>è¯­æ³•å…ƒç´ </th><th>ä¸­æ–‡è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>$</code></td><td>æ ¹èŠ‚ç‚¹ï¼ˆæœ€å¤–å±‚ JSON å…ƒç´ ï¼‰ï¼ŒJSONPath çš„èµ·ç‚¹</td><td><code>$</code>ã€<code>$.user.name</code></td></tr><tr><td><code>.</code></td><td>è®¿é—®å­å­—æ®µï¼ˆå¯¹è±¡å±æ€§è®¿é—®ï¼‰</td><td><code>$.user.age</code></td></tr><tr><td><code>[]</code></td><td>å­å…ƒç´ é€‰æ‹©å™¨ï¼ˆå­—æ®µåæˆ–æ•°ç»„ç´¢å¼•ï¼‰</td><td><code>$['user']['name']</code></td></tr><tr><td><code>..</code></td><td>é€’å½’ä¸‹é™ï¼Œéå†æ‰€æœ‰å±‚çº§çš„èŠ‚ç‚¹</td><td><code>$..id</code></td></tr><tr><td><code>*</code></td><td>é€šé…ç¬¦ï¼ŒåŒ¹é…å½“å‰å±‚çº§çš„æ‰€æœ‰å…ƒç´ </td><td><code>$.users[*]</code></td></tr><tr><td><code>[index]</code></td><td>æ•°ç»„ä¸‹æ ‡è®¿é—®ï¼ˆæ”¯æŒè´Ÿç´¢å¼•ï¼‰</td><td><code>$.scores[0]</code></td></tr><tr><td><code>[a,b,c]</code></td><td>è”åˆé€‰æ‹©ï¼Œè¿”å›å¤šä¸ªæŒ‡å®šå…ƒç´ </td><td><code>$.scores[0,2,4]</code></td></tr><tr><td><code>[start:end:step]</code></td><td>æ•°ç»„åˆ‡ç‰‡ï¼ˆèµ·å§‹ç´¢å¼• : ç»“æŸç´¢å¼• : æ­¥é•¿ï¼‰</td><td><code>$.scores[1:5:2]</code></td></tr><tr><td><code>[*]</code></td><td>é€‰æ‹©æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ </td><td><code>$.items[*]</code></td></tr><tr><td><code>[:]</code></td><td>é€‰æ‹©æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆåˆ‡ç‰‡å†™æ³•ï¼‰</td><td><code>$.items[:]</code></td></tr><tr><td><code>?()</code></td><td>è¿‡æ»¤è¡¨è¾¾å¼ï¼Œç”¨äºæ•°ç»„æˆ–å¯¹è±¡çš„æ¡ä»¶ç­›é€‰</td><td><code>$.users[?(@.age&gt;=18)]</code></td></tr><tr><td><code>()</code></td><td>è„šæœ¬è¡¨è¾¾å¼ï¼Œç”¨äºè®¡ç®—æˆ–å¤æ‚é€»è¾‘åˆ¤æ–­</td><td><code>$.items[?((@.a+@.b)&gt;10)]</code></td></tr><tr><td><code>@</code></td><td>å½“å‰å…ƒç´ å¼•ç”¨ï¼Œå¸¸ç”¨äºè¿‡æ»¤æˆ–è„šæœ¬è¡¨è¾¾å¼ä¸­</td><td><code>@.price&lt;100</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ•°ç»„åˆ‡ç‰‡ <code>[start:end:step]</code> è¯¦è§£</p></li></ul><table><thead><tr><th>å†™æ³•</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>[3:]</code></td><td>ä»ç´¢å¼• 3 åˆ°æœ«å°¾</td></tr><tr><td><code>[:8]</code></td><td>ä»å¤´åˆ°ç´¢å¼• 7</td></tr><tr><td><code>[:8:2]</code></td><td>ä»å¤´åˆ° 7ï¼Œæ¯éš” 2 ä¸ªå–ä¸€ä¸ª</td></tr><tr><td><code>[::]</code></td><td>ç­‰ä»·äº <code>[:]</code>ï¼Œå–å…¨éƒ¨</td></tr><tr><td><code>[*]</code></td><td>æ¨èå†™æ³•ï¼Œå–å…¨éƒ¨</td></tr></tbody></table><blockquote><p>é»˜è®¤å€¼è§„åˆ™ï¼š<br>start é»˜è®¤ 0<br>end é»˜è®¤æ•°ç»„æœ«å°¾<br>step é»˜è®¤ 1</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>è¿‡æ»¤è¡¨è¾¾å¼ <code>?()</code> æ”¯æŒçš„è¿ç®—ç¬¦</p></li></ul><blockquote><p>æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå®æµ‹ä¸­ä»…æ”¯æŒæ•°å­—æ¯”è¾ƒï¼Œä¸”æ³¨æ„ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼</p></blockquote><table><thead><tr><th>è¿ç®—ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>==</code></td><td>ç­‰äº</td></tr><tr><td><code>!=</code></td><td>ä¸ç­‰äº</td></tr><tr><td><code>&lt;</code></td><td>å°äº</td></tr><tr><td><code>&lt;=</code></td><td>å°äºç­‰äº</td></tr><tr><td><code>&gt;</code></td><td>å¤§äº</td></tr><tr><td><code>&gt;=</code></td><td>å¤§äºç­‰äº</td></tr><tr><td><code>=~</code></td><td>æ­£åˆ™åŒ¹é…</td></tr></tbody></table><blockquote><p>é€»è¾‘è¿ç®—ç¬¦</p></blockquote><table><thead><tr><th>è¿ç®—ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>&amp;&amp;</code></td><td>ä¸</td></tr><tr><td><code>||</code></td><td>æˆ–</td></tr><tr><td><code>()</code></td><td>åˆ†ç»„ä¼˜å…ˆçº§</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Redis çš„ RedisJSON æ¨¡å—ï¼ˆæä¾› JSON æ“ä½œåŠŸèƒ½ï¼‰æ”¯æŒçš„ JSONPath è¯­æ³•æ˜¯å—é™çš„å­é›†ï¼Œå°¤å…¶æ˜¯ï¼š</p><ul class="lvl-2"><li class="lvl-6">âŒ ä¸æ”¯æŒå¤æ‚è¡¨è¾¾å¼</li><li class="lvl-6">âŒ ä¸æ”¯æŒåµŒå¥—æ•°ç»„æ¡ä»¶ï¼ˆ@.items[*].xxxï¼‰</li><li class="lvl-6">âš ï¸ å¯¹ ?() çš„æ”¯æŒéå¸¸æœ‰é™</li></ul></li><li class="lvl-2"><p>å¦‚æœéœ€è¦å¤æ‚çš„æŸ¥è¯¢æ¨èä½¿ç”¨ <code>RediSearch</code> æ¨¡å—ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢çš„ç« èŠ‚ä¼šä»‹ç»ã€‚</p></li></ul><h2 id="JSON-å‘½ä»¤">JSON å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p>JSON å‘½ä»¤ æ±‡æ€»</p></li></ul><table><thead><tr><th>åˆ†ç±»</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>åŸºç¡€è¯»å†™</td><td>SET / MSET / GET / MGET</td></tr><tr><td>æ•°ç»„æ“ä½œ</td><td>ARRAPPEND / ARRINSERT / ARRPOP / ARRLEN / ARRINDEX / ARRTRIM</td></tr><tr><td>å¯¹è±¡æ“ä½œ</td><td>OBJKEYS / OBJLEN / TYPE</td></tr><tr><td>æ•°å€¼è¿ç®—</td><td>NUMINCRBY / NUMMULTBY / TOGGLE</td></tr><tr><td>å­—ç¬¦ä¸²</td><td>STRAPPEND / STRLEN</td></tr><tr><td>åˆ é™¤æ¸…ç©º</td><td>DEL / FORGET / CLEAR</td></tr><tr><td>åˆå¹¶è¾“å‡º</td><td>MERGE / RESP</td></tr><tr><td>è°ƒè¯•è¯Šæ–­</td><td>DEBUG / DEBUG MEMORY</td></tr></tbody></table><h3 id="ä¸€ã€åŸºç¡€è¯»å†™ç±»ï¼ˆCRUDï¼‰">ä¸€ã€åŸºç¡€è¯»å†™ç±»ï¼ˆCRUDï¼‰</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å…³é”®å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>JSON.SET</td><td>è®¾ç½®æˆ–æ›´æ–°æŸä¸ª path çš„å€¼</td><td><code>key</code>ï¼šé”®å<br><code>path</code>ï¼šJSONPathï¼ˆå¦‚ <code>$</code>ã€<code>$.a.b</code>ï¼‰<br><code>value</code>ï¼šJSON å€¼</td><td><code>JSON.SET user:1 $ '&#123;&quot;name&quot;:&quot;Tom&quot;,&quot;age&quot;:18&#125;'</code></td></tr><tr><td>JSON.MSET</td><td>æ‰¹é‡è®¾ç½®å¤šä¸ª key</td><td><code>(key path value)...</code></td><td><code>JSON.MSET k1 $ '&#123;&quot;a&quot;:1&#125;' k2 $.b 2</code></td></tr><tr><td>JSON.GET</td><td>è·å–ä¸€ä¸ª key çš„ JSON å€¼</td><td><code>key</code><br><code>path...</code>ï¼šå¯å¤šä¸ª</td><td><code>JSON.GET user:1 $.name $.age</code></td></tr><tr><td>JSON.MGET</td><td>ä»å¤šä¸ª key è·å–åŒä¸€è·¯å¾„</td><td><code>key... path</code></td><td><code>JSON.MGET k1 k2 $.a</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜ï¼š</p><ul class="lvl-2"><li class="lvl-6">JSON.GET è¿”å› å­—ç¬¦ä¸²åŒ– JSON</li><li class="lvl-6">JSON.MGET è¿”å›æ•°ç»„ï¼Œå¯¹åº”å¤šä¸ª key</li></ul></li></ul><h3 id="äºŒã€æ•°ç»„æ“ä½œç±»ï¼ˆArrayï¼‰">äºŒã€æ•°ç»„æ“ä½œç±»ï¼ˆArrayï¼‰</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°å«ä¹‰</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>JSON.ARRAPPEND</td><td>å‘æ•°ç»„æœ«å°¾è¿½åŠ å…ƒç´ </td><td><code>key path value...</code></td><td><code>JSON.ARRAPPEND k $.tags &quot;redis&quot; &quot;json&quot;</code></td></tr><tr><td>JSON.ARRINSERT</td><td>åœ¨æŒ‡å®šç´¢å¼•æ’å…¥å…ƒç´ </td><td><code>key path index value...</code></td><td><code>JSON.ARRINSERT k $.tags 1 &quot;nosql&quot;</code></td></tr><tr><td>JSON.ARRPOP</td><td>åˆ é™¤å¹¶è¿”å›æŒ‡å®šç´¢å¼•å…ƒç´ </td><td><code>key path [index]</code></td><td><code>JSON.ARRPOP k $.tags -1</code></td></tr><tr><td>JSON.ARRLEN</td><td>è·å–æ•°ç»„é•¿åº¦</td><td><code>key path</code></td><td><code>JSON.ARRLEN k $.tags</code></td></tr><tr><td>JSON.ARRINDEX</td><td>æŸ¥æ‰¾å…ƒç´ ç´¢å¼•</td><td><code>key path value</code></td><td><code>JSON.ARRINDEX k $.tags &quot;redis&quot;</code></td></tr><tr><td>JSON.ARRTRIM</td><td>æˆªå–æ•°ç»„åŒºé—´</td><td><code>key path start stop</code></td><td><code>JSON.ARRTRIM k $.scores 0 9</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜ï¼š</p><ul class="lvl-2"><li class="lvl-6">ç´¢å¼•æ”¯æŒè´Ÿæ•°ï¼ˆ-1 è¡¨ç¤ºæœ€åä¸€ä¸ªï¼‰</li><li class="lvl-6">ARRTRIM ç±»ä¼¼ LTRIM</li></ul></li></ul><h3 id="ä¸‰ã€å¯¹è±¡æ“ä½œç±»ï¼ˆObjectï¼‰">ä¸‰ã€å¯¹è±¡æ“ä½œç±»ï¼ˆObjectï¼‰</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>JSON.OBJKEYS</td><td>è·å–å¯¹è±¡çš„æ‰€æœ‰ key</td><td><code>key path</code></td><td><code>JSON.OBJKEYS k $.user</code></td></tr><tr><td>JSON.OBJLEN</td><td>è·å–å¯¹è±¡å­—æ®µæ•°é‡</td><td><code>key path</code></td><td><code>JSON.OBJLEN k $.user</code></td></tr><tr><td>JSON.TYPE</td><td>è¿”å› path å¯¹åº”å€¼ç±»å‹</td><td><code>key path</code></td><td><code>JSON.TYPE k $.user.name</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>JSON.TYPE è¿”å›ç±»å‹åŒ…æ‹¬ï¼šobject / array / string / number / boolean / null</p></li></ul><h3 id="å››ã€æ•°å€¼è¿ç®—ç±»ï¼ˆNumericï¼‰">å››ã€æ•°å€¼è¿ç®—ç±»ï¼ˆNumericï¼‰</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>JSON.NUMINCRBY</td><td>æ•°å€¼è‡ªå¢</td><td><code>key path number</code></td><td><code>JSON.NUMINCRBY k $.count 1</code></td></tr><tr><td>JSON.NUMMULTBY</td><td>æ•°å€¼ä¹˜æ³•</td><td><code>key path number</code></td><td><code>JSON.NUMMULTBY k $.price 0.8</code></td></tr><tr><td>JSON.TOGGLE</td><td>å¸ƒå°”å€¼å–å</td><td><code>key path</code></td><td><code>JSON.TOGGLE k $.enabled</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜ï¼š</p><ul class="lvl-2"><li class="lvl-6">ä¿è¯ åŸå­æ€§</li><li class="lvl-6">å¸¸ç”¨äºè®¡æ•°ã€å¼€å…³çŠ¶æ€</li></ul></li></ul><h3 id="äº”ã€å­—ç¬¦ä¸²æ“ä½œç±»ï¼ˆStringï¼‰">äº”ã€å­—ç¬¦ä¸²æ“ä½œç±»ï¼ˆStringï¼‰</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>JSON.STRAPPEND</td><td>è¿½åŠ å­—ç¬¦ä¸²</td><td><code>key path value</code></td><td><code>JSON.STRAPPEND k $.msg &quot; world&quot;</code></td></tr><tr><td>JSON.STRLEN</td><td>å­—ç¬¦ä¸²é•¿åº¦</td><td><code>key path</code></td><td><code>JSON.STRLEN k $.msg</code></td></tr></tbody></table><h3 id="å…­ã€åˆ é™¤-æ¸…ç©ºç±»">å…­ã€åˆ é™¤ / æ¸…ç©ºç±»</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>JSON.DEL</td><td>åˆ é™¤æŒ‡å®š path</td><td><code>key path</code></td><td><code>JSON.DEL k $.user.age</code></td></tr><tr><td>JSON.FORGET</td><td>ç­‰ä»· JSON.DEL</td><td>åŒä¸Š</td><td><code>JSON.FORGET k $.tmp</code></td></tr><tr><td>JSON.CLEAR</td><td>æ¸…ç©ºå€¼</td><td><code>key path</code></td><td><code>JSON.CLEAR k $.list</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>JSON.CLEAR è¡Œä¸ºè¯´æ˜ï¼š</p><ul class="lvl-2"><li class="lvl-6">æ•°ç»„ â†’ []</li><li class="lvl-6">å¯¹è±¡ â†’ {}</li><li class="lvl-6">æ•°å€¼ â†’ 0</li></ul></li></ul><h3 id="ä¸ƒã€åˆå¹¶ä¸é«˜çº§æ“ä½œ">ä¸ƒã€åˆå¹¶ä¸é«˜çº§æ“ä½œ</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>JSON.MERGE</td><td>åˆå¹¶ JSONï¼ˆRFC7396ï¼‰</td><td><code>key path value</code></td><td><code>JSON.MERGE k $ '&#123;&quot;a&quot;:2,&quot;b&quot;:3&#125;'</code></td></tr><tr><td>JSON.RESP</td><td>RESP æ ¼å¼è¿”å›</td><td><code>key path</code></td><td><code>JSON.RESP k $.user</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜ï¼š</p><ul class="lvl-2"><li class="lvl-6">MERGE æ”¯æŒå­—æ®µè¦†ç›–ã€åˆ é™¤ã€æ‰©å±•</li><li class="lvl-6">RESP é€‚åˆå®¢æˆ·ç«¯ç›´æ¥è§£æ</li></ul></li></ul><h3 id="å…«ã€è°ƒè¯•ä¸è¯Šæ–­ç±»ï¼ˆDebugï¼‰">å…«ã€è°ƒè¯•ä¸è¯Šæ–­ç±»ï¼ˆDebugï¼‰</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>JSON.DEBUG</td><td>è°ƒè¯•å‘½ä»¤å®¹å™¨</td><td>å­å‘½ä»¤</td><td><code>JSON.DEBUG MEMORY k</code></td></tr><tr><td>JSON.DEBUG MEMORY</td><td>æŸ¥çœ‹ JSON å ç”¨å†…å­˜</td><td><code>key</code></td><td><code>JSON.DEBUG MEMORY user:1</code></td></tr></tbody></table><h2 id="åº”ç”¨ç¤ºä¾‹">åº”ç”¨ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åœºæ™¯é€‰ç”¨ï¼šç”µå•†ç”¨æˆ·ç”»åƒ + è®¢å•ç³»ç»Ÿï¼ˆç»“æ„å¤æ‚ã€å­—æ®µå¤šã€éå¸¸é€‚åˆ JSONPathï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘ä»¬è¦å­˜å‚¨ä¸€ä¸ªç”¨æˆ·çš„å®Œæ•´ç”»åƒï¼š</span><br><span class="line">    åŸºæœ¬ä¿¡æ¯</span><br><span class="line">    åœ°å€åˆ—è¡¨</span><br><span class="line">    è®¢å•åˆ—è¡¨ï¼ˆåŒ…å«å•†å“ã€ä»·æ ¼ã€æ•°é‡ï¼‰</span><br><span class="line">    æ ‡ç­¾(åå¥½)</span><br><span class="line">    è´¦æˆ·çŠ¶æ€</span><br><span class="line">    ç»Ÿè®¡ä¿¡æ¯</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>SpringBootæš‚æ—¶æ²¡æœ‰æ”¯æŒRedisJSONï¼Œä½ å¯ä»¥ç¼–å†™Luaè„šæœ¬æ¥å®ç°ç›¸åº”çš„åŠŸèƒ½ï¼Œå¦å¤– <a href="https://redisson.pro/docs/data-and-services/objects/#json-object-holder">Redisson</a>å·²ç»æä¾›äº†å¯¹JSONçš„æ”¯æŒï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å‘ç°è¿˜æœ‰ä¸€äº›Bugï¼Œä¸‹é¢ç»“åˆå‘½ä»¤ç»™å‡ºä»£ç ç¤ºä¾‹ã€‚</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥ Redisson ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œç°åœ¨æœ€æ–°ç‰ˆæ˜¯ 4.0.0ï¼Œéœ€è¦ springboot 4.x --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.52.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºå®Œæ•´ JSON æ–‡æ¡£ï¼ˆJSON.SETï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º JSON æ–‡æ¡£ï¼Œå®é™…æ‰§è¡Œä¸­ä¸æ”¯æŒå¤šè¡Œï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†çœ‹ç€æ¸…æ¥šäº›ï¼Œå®é™…è¿è¡Œæ—¶è¦å°†å…¶æ”¹æˆä¸€è¡Œ</span></span><br><span class="line">JSON.SET user:10001 $ <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;profile&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;name&quot;: &quot;Alice&quot;,</span></span><br><span class="line"><span class="string">    &quot;age&quot;: 28,</span></span><br><span class="line"><span class="string">    &quot;vip&quot;: true</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;tags&quot;: [&quot;vip&quot;, &quot;electronics&quot;, &quot;promotion&quot;],</span></span><br><span class="line"><span class="string">  &quot;addresses&quot;: [</span></span><br><span class="line"><span class="string">    &#123; &quot;city&quot;: &quot;Beijing&quot;, &quot;zip&quot;: &quot;100000&quot; &#125;,</span></span><br><span class="line"><span class="string">    &#123; &quot;city&quot;: &quot;Shanghai&quot;, &quot;zip&quot;: &quot;200000&quot; &#125;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  &quot;orders&quot;: [</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;orderId&quot;: &quot;O1001&quot;,</span></span><br><span class="line"><span class="string">      &quot;amount&quot;: 199.99,</span></span><br><span class="line"><span class="string">      &quot;status&quot;: &quot;PAID&quot;,</span></span><br><span class="line"><span class="string">      &quot;items&quot;: [</span></span><br><span class="line"><span class="string">        &#123; &quot;sku&quot;: &quot;SKU-1&quot;, &quot;price&quot;: 99.99, &quot;qty&quot;: 1 &#125;,</span></span><br><span class="line"><span class="string">        &#123; &quot;sku&quot;: &quot;SKU-2&quot;, &quot;price&quot;: 100.00, &quot;qty&quot;: 1 &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;orderId&quot;: &quot;O1002&quot;,</span></span><br><span class="line"><span class="string">      &quot;amount&quot;: 59.90,</span></span><br><span class="line"><span class="string">      &quot;status&quot;: &quot;CREATED&quot;,</span></span><br><span class="line"><span class="string">      &quot;items&quot;: [</span></span><br><span class="line"><span class="string">        &#123; &quot;sku&quot;: &quot;SKU-3&quot;, &quot;price&quot;: 59.90, &quot;qty&quot;: 1 &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  &quot;stats&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;loginCount&quot;: 10,</span></span><br><span class="line"><span class="string">    &quot;balance&quot;: 300.5</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨å•è¡Œæ¨¡å¼ä¸€ç‚¹ç‚¹ç»„è£…</span></span><br><span class="line">JSON.SET user:10001 $ <span class="string">&#x27;&#123;&#125;&#x27;</span></span><br><span class="line">JSON.SET user:10001 $.profile <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Alice&quot;,&quot;age&quot;:28,&quot;vip&quot;:true&#125;&#x27;</span></span><br><span class="line">JSON.SET user:10001 $.tags <span class="string">&#x27;[&quot;vip&quot;,&quot;electronics&quot;,&quot;promotion&quot;]&#x27;</span></span><br><span class="line">JSON.SET user:10001 $.addresses <span class="string">&#x27;[&#123;&quot;city&quot;:&quot;Beijing&quot;,&quot;zip&quot;:&quot;100000&quot;&#125;,&#123;&quot;city&quot;:&quot;Shanghai&quot;,&quot;zip&quot;:&quot;200000&quot;&#125;]&#x27;</span></span><br><span class="line">JSON.SET user:10001 $.orders <span class="string">&#x27;[&#123;&quot;orderId&quot;:&quot;O1001&quot;,&quot;amount&quot;:199.99,&quot;status&quot;:&quot;PAID&quot;,&quot;items&quot;:[&#123;&quot;sku&quot;:&quot;SKU-1&quot;,&quot;price&quot;:99.99,&quot;qty&quot;:1&#125;,&#123;&quot;sku&quot;:&quot;SKU-2&quot;,&quot;price&quot;:100,&quot;qty&quot;:1&#125;]&#125;,&#123;&quot;orderId&quot;:&quot;O1002&quot;,&quot;amount&quot;:59.90,&quot;status&quot;:&quot;CREATED&quot;,&quot;items&quot;:[&#123;&quot;sku&quot;:&quot;SKU-3&quot;,&quot;price&quot;:59.90,&quot;qty&quot;:1&#125;]&#125;]&#x27;</span></span><br><span class="line">JSON.SET user:10001 $.stats <span class="string">&#x27;&#123;&quot;loginCount&quot;:10,&quot;balance&quot;:300.5&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç±»å‹</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> user:10001</span><br><span class="line">ReJSON-RL</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é€šç”¨ä»£ç </p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">userStr</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;profile&quot;: &#123;</span></span><br><span class="line"><span class="string">                &quot;name&quot;: &quot;Alice&quot;,</span></span><br><span class="line"><span class="string">                &quot;age&quot;: 28,</span></span><br><span class="line"><span class="string">                &quot;vip&quot;: true</span></span><br><span class="line"><span class="string">              &#125;,</span></span><br><span class="line"><span class="string">              &quot;tags&quot;: [&quot;vip&quot;, &quot;electronics&quot;, &quot;promotion&quot;],</span></span><br><span class="line"><span class="string">              &quot;addresses&quot;: [</span></span><br><span class="line"><span class="string">                &#123; &quot;city&quot;: &quot;Beijing&quot;, &quot;zip&quot;: &quot;100000&quot; &#125;,</span></span><br><span class="line"><span class="string">                &#123; &quot;city&quot;: &quot;Shanghai&quot;, &quot;zip&quot;: &quot;200000&quot; &#125;</span></span><br><span class="line"><span class="string">              ],</span></span><br><span class="line"><span class="string">              &quot;orders&quot;: [</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                  &quot;orderId&quot;: &quot;O1001&quot;,</span></span><br><span class="line"><span class="string">                  &quot;amount&quot;: 199.99,</span></span><br><span class="line"><span class="string">                  &quot;status&quot;: &quot;PAID&quot;,</span></span><br><span class="line"><span class="string">                  &quot;items&quot;: [</span></span><br><span class="line"><span class="string">                    &#123; &quot;sku&quot;: &quot;SKU-1&quot;, &quot;price&quot;: 99.99, &quot;qty&quot;: 1 &#125;,</span></span><br><span class="line"><span class="string">                    &#123; &quot;sku&quot;: &quot;SKU-2&quot;, &quot;price&quot;: 100.00, &quot;qty&quot;: 1 &#125;</span></span><br><span class="line"><span class="string">                  ]</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                  &quot;orderId&quot;: &quot;O1002&quot;,</span></span><br><span class="line"><span class="string">                  &quot;amount&quot;: 59.90,</span></span><br><span class="line"><span class="string">                  &quot;status&quot;: &quot;CREATED&quot;,</span></span><br><span class="line"><span class="string">                  &quot;items&quot;: [</span></span><br><span class="line"><span class="string">                    &#123; &quot;sku&quot;: &quot;SKU-3&quot;, &quot;price&quot;: 59.90, &quot;qty&quot;: 1 &#125;</span></span><br><span class="line"><span class="string">                  ]</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">              ],</span></span><br><span class="line"><span class="string">              &quot;stats&quot;: &#123;</span></span><br><span class="line"><span class="string">                &quot;loginCount&quot;: 10,</span></span><br><span class="line"><span class="string">                &quot;balance&quot;: 300.5</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line"><span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">RJsonBucket&lt;User&gt; bucket = redissonClient.getJsonBucket(<span class="string">&quot;user:10001&quot;</span>, <span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(User.class));</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> objectMapper.readValue(userStr, User.class);</span><br><span class="line">bucket.set(user);</span><br></pre></td></tr></table></figure><h3 id="JSONPath-æŸ¥è¯¢ç¤ºä¾‹">JSONPath æŸ¥è¯¢ç¤ºä¾‹</h3><ul class="lvl-0"><li class="lvl-2"><p>1ï¸âƒ£ åŸºç¡€è·¯å¾„è®¿é—®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–å…¨éƒ¨æ•°æ®</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $.profile</span><br><span class="line"><span class="string">&quot;[&#123;\&quot;name\&quot;:\&quot;Alice\&quot;,\&quot;age\&quot;:28,\&quot;vip\&quot;:true&#125;]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç”¨æˆ·å</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $.profile.name</span><br><span class="line"><span class="string">&quot;[\&quot;Alice\&quot;]&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;User&gt;() &#123;&#125;));</span><br><span class="line"></span><br><span class="line">User.<span class="type">ProfileBean</span> <span class="variable">profile</span> <span class="operator">=</span> bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;User.ProfileBean&gt;() &#123;&#125;),<span class="string">&quot;profile&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;String&gt;() &#123;&#125;),<span class="string">&quot;profile.name&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ ä¸Š $. å‰ç¼€ï¼Œè¿”å›å€¼å¿…é¡»æ˜¯ List&lt;T&gt;</span></span><br><span class="line">List&lt;String&gt; names = bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;String&gt;&gt;() &#123;&#125;),<span class="string">&quot;$.profile.name&quot;</span>);</span><br><span class="line">System.out.println(names.get(<span class="number">0</span>));</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>2ï¸âƒ£ æ•°ç»„è®¿é—® &amp; é€šé…ç¬¦</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–æ‰€æœ‰è®¢å•ID</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[*].orderId</span><br><span class="line"><span class="string">&quot;[\&quot;O1001\&quot;,\&quot;O1002\&quot;]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰åœ°å€çš„åŸå¸‚</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $.addresses[*].city</span><br><span class="line"><span class="string">&quot;[\&quot;Beijing\&quot;,\&quot;Shanghai\&quot;]&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; orderIds = bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;String&gt;&gt;() &#123;&#125;),<span class="string">&quot;$.orders[*].orderId&quot;</span>);</span><br><span class="line"></span><br><span class="line">List&lt;String&gt; citys = bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;String&gt;&gt;() &#123;&#125;),<span class="string">&quot;$.addresses[*].city&quot;</span>);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>3ï¸âƒ£ æ•°ç»„ä¸‹æ ‡ä¸åˆ‡ç‰‡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–ç¬¬ä¸€ä¸ªè®¢å•</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[0]</span><br><span class="line"><span class="string">&quot;[&#123;\&quot;orderId\&quot;:\&quot;O1001\&quot;,\&quot;amount\&quot;:199.99,\&quot;status\&quot;:\&quot;PAID\&quot;,\&quot;items\&quot;:[&#123;\&quot;sku\&quot;:\&quot;SKU-1\&quot;,\&quot;price\&quot;:99.99,\&quot;qty\&quot;:1&#125;,&#123;\&quot;sku\&quot;:\&quot;SKU-2\&quot;,\&quot;price\&quot;:100,\&quot;qty\&quot;:1&#125;]&#125;]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªè®¢å•ï¼Œåˆ‡ç‰‡é€»è¾‘æ˜¯ [start:end]ï¼Œ start &lt;= x &lt; end ï¼Œendä¸å†™é»˜è®¤ä¸ºæ•°ç»„æœ«å°¾</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[0:2]</span><br><span class="line"><span class="string">&quot;[&#123;\&quot;orderId\&quot;:\&quot;O1001\&quot;,\&quot;amount\&quot;:199.99,\&quot;status\&quot;:\&quot;PAID\&quot;,\&quot;items\&quot;:[&#123;\&quot;sku\&quot;:\&quot;SKU-1\&quot;,\&quot;price\&quot;:99.99,\&quot;qty\&quot;:1&#125;,&#123;\&quot;sku\&quot;:\&quot;SKU-2\&quot;,\&quot;price\&quot;:100,\&quot;qty\&quot;:1&#125;]&#125;,&#123;\&quot;orderId\&quot;:\&quot;O1002\&quot;,\&quot;amount\&quot;:59.9,\&quot;status\&quot;:\&quot;CREATED\&quot;,\&quot;items\&quot;:[&#123;\&quot;sku\&quot;:\&quot;SKU-3\&quot;,\&quot;price\&quot;:59.9,\&quot;qty\&quot;:1&#125;]&#125;]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰è®¢å•ï¼Œè¿™é‡Œç­‰åŒäº $.orders[*]</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[:]</span><br><span class="line"><span class="string">&quot;[&#123;\&quot;orderId\&quot;:\&quot;O1001\&quot;,\&quot;amount\&quot;:199.99,\&quot;status\&quot;:\&quot;PAID\&quot;,\&quot;items\&quot;:[&#123;\&quot;sku\&quot;:\&quot;SKU-1\&quot;,\&quot;price\&quot;:99.99,\&quot;qty\&quot;:1&#125;,&#123;\&quot;sku\&quot;:\&quot;SKU-2\&quot;,\&quot;price\&quot;:100,\&quot;qty\&quot;:1&#125;]&#125;,&#123;\&quot;orderId\&quot;:\&quot;O1002\&quot;,\&quot;amount\&quot;:59.9,\&quot;status\&quot;:\&quot;CREATED\&quot;,\&quot;items\&quot;:[&#123;\&quot;sku\&quot;:\&quot;SKU-3\&quot;,\&quot;price\&quot;:59.9,\&quot;qty\&quot;:1&#125;]&#125;]&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;OrdersBean&gt; orders = bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class="string">&quot;$.orders[0]&quot;</span>);</span><br><span class="line"></span><br><span class="line">orders = bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class="string">&quot;$.orders[0:2]&quot;</span>);</span><br><span class="line"></span><br><span class="line">orders = bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class="string">&quot;$.orders[:]&quot;</span>);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>4ï¸âƒ£ é€’å½’æŸ¥è¯¢ï¼ˆâ€¦ï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰å•†å“ä»·æ ¼ï¼ˆä¸ç®¡åœ¨å“ªä¸€å±‚ï¼‰</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $..price</span><br><span class="line"><span class="string">&quot;[99.99,100,59.9]&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Double&gt; prices = bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;Double&gt;&gt;() &#123;&#125;),<span class="string">&quot;$..price&quot;</span>);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>5ï¸âƒ£ æ¡ä»¶è¿‡æ»¤ï¼ˆJSONPath æ ¸å¿ƒèƒ½åŠ›ï¼‰</p></li></ul><blockquote><p>âœ… æ”¯æŒçš„æŸ¥è¯¢</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•é‡‘é¢å¤§äº100çš„è®¢å•ï¼Œâœ… æ•°å­—æ¯”è¾ƒ</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.amount&gt;100)]</span><br><span class="line"><span class="string">&quot;[&#123;\&quot;orderId\&quot;:\&quot;O1001\&quot;,\&quot;amount\&quot;:199.99,\&quot;status\&quot;:\&quot;PAID\&quot;,\&quot;items\&quot;:[&#123;\&quot;sku\&quot;:\&quot;SKU-1\&quot;,\&quot;price\&quot;:99.99,\&quot;qty\&quot;:1&#125;,&#123;\&quot;sku\&quot;:\&quot;SKU-2\&quot;,\&quot;price\&quot;:100,\&quot;qty\&quot;:1&#125;]&#125;]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•ä¸­ç¬¬ä¸€ä¸ªå•†å“ä»·æ ¼å¤§äº50çš„è®¢å•ï¼Œâœ… æ•°ç»„æ¡ä»¶</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.items[0].price&gt;50)]</span><br><span class="line"><span class="string">&quot;[&#123;\&quot;orderId\&quot;:\&quot;O1001\&quot;,\&quot;amount\&quot;:199.99,\&quot;status\&quot;:\&quot;PAID\&quot;,\&quot;items\&quot;:[&#123;\&quot;sku\&quot;:\&quot;SKU-1\&quot;,\&quot;price\&quot;:99.99,\&quot;qty\&quot;:1&#125;,&#123;\&quot;sku\&quot;:\&quot;SKU-2\&quot;,\&quot;price\&quot;:100,\&quot;qty\&quot;:1&#125;]&#125;,&#123;\&quot;orderId\&quot;:\&quot;O1002\&quot;,\&quot;amount\&quot;:59.9,\&quot;status\&quot;:\&quot;CREATED\&quot;,\&quot;items\&quot;:[&#123;\&quot;sku\&quot;:\&quot;SKU-3\&quot;,\&quot;price\&quot;:59.9,\&quot;qty\&quot;:1&#125;]&#125;]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•é‡‘é¢å¤§äº100å¹¶ä¸”è®¢å•ä¸­ç¬¬ä¸€ä¸ªå•†å“ä»·æ ¼å¤§äº50çš„è®¢å•ï¼Œâœ… é€»è¾‘è¿ç®—ç¬¦</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.amount&gt;100)&amp;&amp;(@.items[0].price&gt;50)]</span><br><span class="line"><span class="string">&quot;[&#123;\&quot;orderId\&quot;:\&quot;O1001\&quot;,\&quot;amount\&quot;:199.99,\&quot;status\&quot;:\&quot;PAID\&quot;,\&quot;items\&quot;:[&#123;\&quot;sku\&quot;:\&quot;SKU-1\&quot;,\&quot;price\&quot;:99.99,\&quot;qty\&quot;:1&#125;,&#123;\&quot;sku\&quot;:\&quot;SKU-2\&quot;,\&quot;price\&quot;:100,\&quot;qty\&quot;:1&#125;]&#125;]&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;OrdersBean&gt; orders = bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class="string">&quot;$.orders[?(@.amount&gt;100)]&quot;</span>);</span><br><span class="line"></span><br><span class="line">orders = bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class="string">&quot;$.orders[?(@.items[0].price&gt;50)]&quot;</span>);</span><br><span class="line"></span><br><span class="line">orders = bucket.get(<span class="keyword">new</span> <span class="title class_">JacksonCodec</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class="string">&quot;$.orders[?(@.amount&gt;100)&amp;&amp;(@.items[0].price&gt;50)]&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>âŒ ä¸æ”¯æŒçš„æŸ¥è¯¢</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰å·²æ”¯ä»˜è®¢å•ï¼ŒâŒ ä¸æ”¯æŒå­—ç¬¦ä¸²çš„æ¯”è¾ƒ</span><br><span class="line">JSON.GET user:10001 $.orders[?(@.status==&quot;PAID&quot;)]</span><br><span class="line"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰å·²æ”¯ä»˜è®¢å•ï¼ŒâŒ ä¸æ”¯æŒæ­£åˆ™åŒ¹é…</span><br><span class="line">JSON.GET user:10001 $.orders[?(@.status=~&quot;PAID&quot;)]</span><br><span class="line"></span><br><span class="line"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•ä¸­å•†å“ä»·æ ¼å¤§äº50çš„è®¢å•ï¼Œè¿™ä¸ªå°±ä¸å‡†ï¼ŒâŒ ä¸æ”¯æŒåµŒå¥—æ•°ç»„æ¡ä»¶ï¼ˆ@.items[*].xxxï¼‰</span><br><span class="line">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.items[*].price&gt;50)]</span><br><span class="line">&quot;[&#123;\&quot;orderId\&quot;:\&quot;O1002\&quot;,\&quot;amount\&quot;:59.9,\&quot;status\&quot;:\&quot;CREATED\&quot;,\&quot;items\&quot;:[&#123;\&quot;sku\&quot;:\&quot;SKU-3\&quot;,\&quot;price\&quot;:59.9,\&quot;qty\&quot;:1&#125;]&#125;]&quot;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>6ï¸âƒ£ ä¿®æ”¹æ•°æ®ï¼ˆJSON.SET / JSON.NUMINCRBYï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ğŸ‘‰ ä¿®æ”¹ç”¨æˆ·å</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.SET user:10001 $.profile.name <span class="string">&#x27;&quot;Alice Zhang&quot;&#x27;</span></span><br><span class="line">OK</span><br><span class="line"><span class="comment"># ğŸ‘‰ ç”¨æˆ·ç™»å½•æ¬¡æ•° +1</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.NUMINCRBY user:10001 $.stats.loginCount 1</span><br><span class="line"><span class="string">&quot;[11]&quot;</span> <span class="comment"># è¿”å›ä¿®æ”¹åçš„å€¼</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bucket.set(<span class="string">&quot;$.profile.name&quot;</span>, <span class="string">&quot;Alice Zhang&quot;</span>);</span><br><span class="line"><span class="comment">// æ³¨æ„å¦‚ä¸‹æ–¹æ³•ä¼šå¢åŠ æˆåŠŸï¼Œä½†æ˜¯ä¼šæŠ›å¼‚å¸¸ï¼Œåº”è¯¥æ˜¯Redissonçš„bug</span></span><br><span class="line"><span class="comment">// Caused by: java.lang.NumberFormatException: For input string: &quot;[11]&quot;</span></span><br><span class="line">bucket.incrementAndGet(<span class="string">&quot;$.stats.loginCount&quot;</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>7ï¸âƒ£ æ•°ç»„æ“ä½œï¼ˆARRAPPEND / ARRINSERTï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ğŸ‘‰ æ·»åŠ ä¸€ä¸ªè®¢å•</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.ARRAPPEND user:10001 $.orders <span class="string">&#x27;&#123;&quot;orderId&quot;: &quot;O1003&quot;,&quot;amount&quot;: 399,&quot;status&quot;: &quot;PAID&quot;,&quot;items&quot;: [&#123; &quot;sku&quot;: &quot;SKU-9&quot;, &quot;price&quot;: 399, &quot;qty&quot;: 1 &#125;]&#125;&#x27;</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 3 <span class="comment"># è¿”å›æ·»åŠ åçš„é•¿åº¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ğŸ‘‰ åœ¨ tags çš„æœ€åæ·»åŠ ä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.ARRAPPEND user:10001 $.tags <span class="string">&#x27;&quot;newTag&quot;&#x27;</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 4 <span class="comment"># æ·»åŠ åçš„é•¿åº¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ğŸ‘‰ åœ¨ tags ä¸­çš„æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.ARRINSERT user:10001 $.tags 1 <span class="string">&#x27;&quot;newTag2&quot;&#x27;</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 5 <span class="comment"># æ’å…¥åçš„é•¿åº¦</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">OrdersBean</span> <span class="variable">ordersBean</span> <span class="operator">=</span> OrdersBean.builder()</span><br><span class="line">                .orderId(<span class="string">&quot;O1003&quot;</span>)</span><br><span class="line">                .amount(<span class="number">399</span>)</span><br><span class="line">                .status(<span class="string">&quot;CREATED&quot;</span>)</span><br><span class="line">                .items(List.of(</span><br><span class="line">                        OrdersBean.ItemsBean.builder()</span><br><span class="line">                                .sku(<span class="string">&quot;SKU-9&quot;</span>)</span><br><span class="line">                                .qty(<span class="number">1</span>)</span><br><span class="line">                                .price(<span class="number">399</span>).build()</span><br><span class="line">                )).build();</span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªè®¢å•ï¼Œè¿”å›æ·»åŠ åçš„é•¿åº¦</span></span><br><span class="line"><span class="type">long</span> <span class="variable">num</span> <span class="operator">=</span> bucket.arrayAppend(<span class="string">&quot;$.orders&quot;</span>, ordersBean);</span><br><span class="line"></span><br><span class="line">num = bucket.arrayAppend(<span class="string">&quot;$.tags&quot;</span>, <span class="string">&quot;newTag&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥æˆåŠŸï¼Œä½†æ˜¯ä¼šæŠ›å¼‚å¸¸ï¼Œåº”è¯¥æ˜¯Redissonçš„bug</span></span><br><span class="line">num = bucket.arrayInsert(<span class="string">&quot;$.tags&quot;</span>, <span class="number">1</span>, <span class="string">&quot;newTag2&quot;</span>);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>8ï¸âƒ£ åˆ é™¤ &amp; æ¸…ç†æ“ä½œï¼ˆJSON.DEL &amp; JSON.CLEARï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ğŸ‘‰ åˆ é™¤ç”¨æˆ·å¹´é¾„ï¼Œ$.profile.age ä¸å­˜åœ¨äº†</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.DEL user:10001 $.profile.age</span><br><span class="line">(<span class="built_in">integer</span>) 1 <span class="comment"># åˆ é™¤æˆåŠŸï¼Œè¿”å›0ï¼Œè¡¨ç¤ºè·¯å¾„ä¸å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ğŸ‘‰ æ¸…ç©ºç”¨æˆ·æ‰€æœ‰æ ‡ç­¾ï¼Œ$.tags ä¿ç•™ï¼Œåªæ˜¯å˜æˆäº† [] ç©ºæ•°ç»„</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.CLEAR user:10001 $.tags</span><br><span class="line">(<span class="built_in">integer</span>) 1 <span class="comment"># æ¸…ç©ºæˆåŠŸï¼Œè¿”å›0ï¼Œè¡¨ç¤ºè·¯å¾„ä¸å­˜åœ¨æˆ–å·²ç»æ¸…ç©º</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">delete</span> <span class="operator">=</span> bucket.delete(<span class="string">&quot;$.profile.age&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">clear</span> <span class="operator">=</span> bucket.clear(<span class="string">&quot;$.tags&quot;</span>);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>9ï¸âƒ£ ç»Ÿè®¡æ•°ç»„é•¿åº¦</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ğŸ‘‰ ç»Ÿè®¡ç”¨æˆ·è®¢å•çš„é•¿åº¦</span></span><br><span class="line">127.0.0.1:6379&gt; JSON.ARRLEN user:10001 $.orders</span><br><span class="line">1) (<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼šæŠ›å¼‚å¸¸ï¼Œåº”è¯¥æ˜¯Redissonçš„bug</span></span><br><span class="line"><span class="type">long</span> <span class="variable">length</span> <span class="operator">=</span> bucket.arraySize(<span class="string">&quot;$.orders&quot;</span>);</span><br></pre></td></tr></table></figure><p>ğŸ”Ÿ æŸ¥çœ‹ JSON å ç”¨å†…å­˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; JSON.DEBUG MEMORY user:10001</span><br><span class="line">(<span class="built_in">integer</span>) 1896 <span class="comment"># å ç”¨å†…å­˜å¤§å°ï¼Œå•ä½å­—èŠ‚</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">sizeInMemory</span> <span class="operator">=</span> bucket.sizeInMemory();</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisJSON ä¸­çš„ JSON æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;RedisJSON çš„å®‰è£…å‚è§ &lt;a href=&quot;/2025/12/24/redis7-module-RedisJSON/&quot; title=&quot;Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•&quot;&gt;Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo&quot;&gt;GitHub&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•</title>
    <link href="https://blog.hanqunfeng.com/2025/12/24/redis7-module-RedisJSON/"/>
    <id>https://blog.hanqunfeng.com/2025/12/24/redis7-module-RedisJSON/</id>
    <published>2025-12-24T13:30:05.000Z</published>
    <updated>2026-01-05T02:21:23.571Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisJSON çš„å®‰è£…æ–¹æ³•</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li></ul><span id="more"></span><h2 id="RedisJSON-ç®€ä»‹">RedisJSON ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/RedisJSON/RedisJSON">RedisJSON</a> æ˜¯ Redis å®˜æ–¹ç»´æŠ¤çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œéš¶å±äº <code>Redis Stack</code>ï¼Œä¸“é—¨ç”¨äºå¯¹JSONæ•°æ®è¿›è¡Œæ“ä½œã€‚</p></li><li class="lvl-2"><p>è¯¥æ¨¡å—ä»¥ <code>Redis Module</code> æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚</p></li><li class="lvl-2"><p>Redis8+ï¼ŒRedisJSON å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚</p></li></ul><h2 id="å®‰è£…-RedisJSON">å®‰è£… RedisJSON</h2><ul class="lvl-0"><li class="lvl-2"><p>è™½ç„¶<a href="https://cloud.redis.io">Redis Cloud</a>çš„<code>Download Center</code>ä¸­æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„<code>.so</code>æ–‡ä»¶ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚</p></li></ul><blockquote><p>å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚<br>å¯ä»¥åœ¨æµ·å¤–çš„<code>ç›¸åŒé…ç½®</code>çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„<code>rejson.so</code>ä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…ä¾èµ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install -y \</span><br><span class="line">  gcc \</span><br><span class="line">  gcc-c++ \</span><br><span class="line">  make \</span><br><span class="line">  cmake \</span><br><span class="line">  autoconf \</span><br><span class="line">  automake \</span><br><span class="line">  libtool \</span><br><span class="line">  pkgconfig \</span><br><span class="line">  openssl-devel</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¼–è¯‘RedisJSON</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /usr/local/soft/modules/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/soft/modules</span><br><span class="line"><span class="comment"># clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—</span></span><br><span class="line">git <span class="built_in">clone</span> --recursive https://github.com/RedisJSON/RedisJSON.git</span><br><span class="line"><span class="built_in">cd</span> RedisJSON</span><br><span class="line"><span class="comment"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class="line">git checkout v2.8.16</span><br><span class="line"><span class="comment"># æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥</span></span><br><span class="line">git submodule update --init --recursive</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å¹¶å®‰è£…éœ€è¦çš„ä¾èµ–</span></span><br><span class="line">./sbin/setup</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="comment"># readies version: 7fc8e62</span></span><br><span class="line">dnf install -q -y ca-certificates</span><br><span class="line">dnf install -q -y wget unzip</span><br><span class="line">/usr/local/soft/modules/RedisJSON/deps/readies/bin/enable-utf8</span><br><span class="line">dnf install -q -y git unzip rsync</span><br><span class="line">/usr/local/soft/modules/RedisJSON/deps/readies/bin/getclang --modern</span><br><span class="line">/usr/local/soft/modules/RedisJSON/deps/readies/bin/getrust</span><br><span class="line">/usr/local/soft/modules/RedisJSON/deps/readies/bin/getcmake --usr</span><br><span class="line">dnf install -q -y <span class="built_in">which</span></span><br><span class="line">/usr/local/soft/modules/RedisJSON/deps/readies/bin/getgcc --modern</span><br><span class="line"><span class="built_in">dir</span>=$(<span class="built_in">mktemp</span> -d /tmp/tar.XXXXXX); (<span class="built_in">cd</span> <span class="variable">$dir</span>; wget --no-verbose -O tar.tgz http://redismodules.s3.amazonaws.com/readies/gnu/gnu-tar-1.32-x64-centos7.tgz; tar -xzf tar.tgz -C /; ); <span class="built_in">rm</span> -rf <span class="variable">$dir</span></span><br><span class="line">dnf install -q -y lcov</span><br><span class="line">/usr/bin/python3 /usr/local/soft/modules/RedisJSON/deps/readies/bin/getrmpytools --reinstall --modern</span><br><span class="line">/usr/bin/python3 -m pip install --disable-pip-version-check --user  -r /usr/local/soft/modules/RedisJSON/tests/pytest/requirements.txt</span><br><span class="line">/usr/local/soft/modules/RedisJSON/deps/readies/bin/getaws</span><br><span class="line">NO_PY2=1 /usr/local/soft/modules/RedisJSON/deps/readies/bin/getpudb</span><br><span class="line"></span><br><span class="line"><span class="comment"># RedisJSON çš„ç¼–è¯‘ä¾èµ– Rust å·¥å…·é“¾ï¼Œæ‰€ä»¥ç¼–è¯‘å‰éœ€è¦å®‰è£…rustï¼Œè‹¥å·²ç»å®‰è£…åˆ™å¿½ç•¥</span></span><br><span class="line"><span class="comment"># å®‰è£… rustup</span></span><br><span class="line">curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰æç¤ºé€‰æ‹©é»˜è®¤å®‰è£…ï¼ˆé€šå¸¸é€‰æ‹© 1ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®© Rust ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> <span class="variable">$HOME</span>/.cargo/env</span><br><span class="line"><span class="comment"># æ£€æŸ¥ rust ç‰ˆæœ¬</span></span><br><span class="line">rustc --version <span class="comment"># rustc 1.92.0 (ded5c06cf 2025-12-08)</span></span><br><span class="line">cargo --version <span class="comment"># cargo 1.92.0 (344c4567c 2025-10-21)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘ RedisJSON</span></span><br><span class="line">make</span><br><span class="line"><span class="comment"># ç¼–è¯‘è¿‡ç¨‹æœªæŠ¥é”™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œç¼–è¯‘åçš„æ–‡ä»¶ä½äº `bin/linux-x64-release/rejson.so`</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong><code>./sbin/setup</code> æŠ¥é”™</strong></em></p><ul class="lvl-1"><li class="lvl-2">æœ¬äººä½¿ç”¨çš„æ˜¯ Amazon Linux 2023(å†…æ ¸ 6.1)ï¼Œå³ <code>EL9</code>ï¼Œç±»ä¼¼äºCentOS 9ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œä¼šæŠ¥é”™ï¼Œå¤§è‡´æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">./sbin/setup</span><br><span class="line"><span class="comment">## é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">â€¦â€¦</span><br><span class="line">[FAILED] raven-release.el9.noarch.rpm: Status code: 403 <span class="keyword">for</span> https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)</span><br><span class="line">Status code: 403 <span class="keyword">for</span> https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)</span><br><span class="line"></span><br><span class="line">In /usr/local/soft/modules/RedisJSON/deps/readies/bin/getepel:</span><br><span class="line">346      <span class="comment"># xinstall --allowerasing https://dl.fedoraproject.org/pub/epel/epel-release-latest-$&#123;EPEL&#125;.noarch.rpm</span></span><br><span class="line">347      <span class="keyword">fi</span></span><br><span class="line">348</span><br><span class="line">349  &gt;&gt;&gt; install_raven</span><br><span class="line">350      install_remi</span><br><span class="line">351      <span class="comment"># install_centos_stream_repos</span></span><br><span class="line">352</span><br><span class="line"></span><br><span class="line"><span class="built_in">command</span> failed: /usr/local/soft/modules/RedisJSON/deps/readies/bin/getepel</span><br><span class="line"><span class="built_in">command</span> failed: /usr/local/soft/modules/RedisJSON/deps/readies/bin/getclang --modern</span><br><span class="line"></span><br><span class="line">In /usr/local/soft/modules/RedisJSON/sbin/setup:</span><br><span class="line">18       python3 -m pip list</span><br><span class="line">19       <span class="keyword">fi</span></span><br><span class="line">20</span><br><span class="line">21   &gt;&gt;&gt; <span class="variable">$ROOT</span>/sbin/system-setup.py</span><br><span class="line">22       <span class="keyword">if</span> [[ <span class="variable">$VERBOSE</span> == 1 ]]; <span class="keyword">then</span></span><br><span class="line">23       python3 -m pip list</span><br><span class="line">24       <span class="keyword">fi</span></span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2"><p>é”™è¯¯åˆ†æä¸è§£å†³æ–¹æ³•ï¼š</p><ul class="lvl-3"><li class="lvl-6"><p>è¿™é‡Œå®é™…ä¸Šæ˜¯ä¸¤ä¸ªé”™è¯¯ï¼Œç¬¬ä¸€ä¸ªé”™è¯¯ä¸å®‰è£… RedisBloom æ—¶ä¸€æ ·ï¼Œç¦ç”¨æ‰ <code>install_raven</code> å³å¯ï¼Œå…·ä½“å‚è§ <a href="/2025/12/21/redis7-module-RedisBloom/" title="Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a> è¿›è¡Œä¿®æ”¹ã€‚</p></li><li class="lvl-6"><p>ç¬¬äºŒä¸ªé”™è¯¯è¿˜æ˜¯æ“ä½œç³»ç»Ÿçš„äº‹ï¼Œåœ¨ <code>deps/readies/bin/getclang</code>ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå…¶å®ä¸€çœ‹å°±æ˜ç™½äº†</p></li></ul>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">redhat_compat</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.modern:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="variable language_">self</span>.run(<span class="string">&quot;%s/bin/getepel&quot;</span> % READIES, sudo=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>.dist <span class="keyword">in</span> [<span class="string">&#x27;centos&#x27;</span>, <span class="string">&#x27;ol&#x27;</span>] <span class="keyword">and</span> <span class="variable language_">self</span>.os_version[<span class="number">0</span>] &gt;= <span class="number">8</span>:</span><br><span class="line">        <span class="variable language_">self</span>.install(<span class="string">&quot;clang&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.install(<span class="string">&quot;llvm-toolset&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="variable language_">self</span>.install(<span class="string">&quot;llvm-toolset-7.0&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.cp_to_profile_d(<span class="string">&quot;/opt/rh/llvm-toolset-7.0/enable&quot;</span>, <span class="string">&quot;llvm-toolset-7.0.sh&quot;</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä½¿ç”¨çš„æœºå™¨ä¸æ˜¯ centosï¼Œæ‰€ä»¥å°±èµ°<code>else</code>çš„é€»è¾‘äº†ï¼Œå¦å¤–è¿™é‡Œå³ä¾¿èµ°äº† centos é€»è¾‘ï¼Œä¹Ÿæœ‰é—®é¢˜ï¼Œå°±æ˜¯el9ä¸­å·²ç»æ²¡æœ‰ <code>llvm-toolset</code> äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ <code>llvm</code>ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹è¯¥æ–¹æ³•</p><ul class="lvl-3"><li class="lvl-6">ä¿®æ”¹æ–¹æ³•å¦‚ä¸‹ï¼š</li></ul>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">redhat_compat</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.modern:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="variable language_">self</span>.run(<span class="string">&quot;%s/bin/getepel&quot;</span> % READIES, sudo=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># å»æ‰åˆ¤æ–­ï¼Œç›´æ¥å®‰è£…ï¼Œå‰ææ˜¯ el9ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ä»€ä¹ˆéƒ½ä¸å†™ï¼Œè€Œæ˜¯é€šè¿‡å‘½ä»¤è¡Œå®‰è£…ï¼šdnf install -y clang llvm llvm-devel</span></span><br><span class="line">    <span class="variable language_">self</span>.install(<span class="string">&quot;clang&quot;</span>)</span><br><span class="line">    <span class="variable language_">self</span>.install(<span class="string">&quot;llvm&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></div><h2 id="Redis-å¯ç”¨æ¨¡å—">Redis å¯ç”¨æ¨¡å—</h2><ul class="lvl-0"><li class="lvl-2"><p>å°†ç”Ÿæˆçš„ <code>rejson.so</code> æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">cp</span> bin/linux-x64-release/rejson.so /usr/local/soft/redis-7.4.7/modules/rejson.so</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡é‡‡ç”¨ <code>loadmodule</code> åŠ è½½æ¨¡å—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°† rejson.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class="line">loadmodule /usr/local/soft/redis-7.4.7/modules/rejson.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨redis</span></span><br><span class="line">redis-server redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½•æµ‹è¯•</span></span><br><span class="line">redis-cli --user admin --pass 123456</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ¨¡å—</span></span><br><span class="line">127.0.0.1:6379&gt; info Modules</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="comment"># Modules</span></span><br><span class="line">module:name=ReJSON,ver=20816,api=1,filters=0,usedby=[],using=[],options=[handle-io-errors]</span><br><span class="line">module:name=bf,ver=20817,api=1,filters=0,usedby=[],using=[],options=[handle-io-errors]</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; MODULE LIST</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;ReJSON&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 20816</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line">2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;bf&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 20817</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisJSON çš„å®‰è£…æ–¹æ³•&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æ“ä½œç³»ç»Ÿï¼š&lt;code&gt;Amazon Linux 2023(å†…æ ¸ 6.1)&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TDigest</title>
    <link href="https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-15-TDigest/"/>
    <id>https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-15-TDigest/</id>
    <published>2025-12-23T07:40:05.000Z</published>
    <updated>2025-12-23T09:53:35.193Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ TDigest æ•°æ®ç±»å‹</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2">RedisBloom çš„å®‰è£…å‚è§ <a href="/2025/12/21/redis7-module-RedisBloom/" title="Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li></ul><span id="more"></span><h2 id="T-Digest-åˆ†ä½æ•°ä¼°è®¡ç®—æ³•">T-Digest(åˆ†ä½æ•°ä¼°è®¡ç®—æ³•)</h2><ul class="lvl-0"><li class="lvl-2"><p>T-Digestï¼ˆTDigestï¼‰è§£å†³çš„é—®é¢˜ä¸ CMSã€TopK å®Œå…¨ä¸åŒï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ åˆ†ä½æ•°ï¼ˆquantileï¼‰ç»Ÿè®¡ã€‚</p></li><li class="lvl-2"><p>T-Digest ç”± Ted Dunning æå‡ºï¼Œä¸“é—¨ä¸º <code>é«˜ç²¾åº¦å°¾éƒ¨åˆ†ä½æ•°</code> è®¾è®¡ã€‚</p></li><li class="lvl-2"><p>TDigest å¯ä»¥åœ¨æä½å†…å­˜å ç”¨ä¸‹ï¼Œè¿‘ä¼¼è®¡ç®—åˆ†ä½æ•°ï¼ˆP50 / P90 / P99 / Median ç­‰ï¼‰ã€‚</p></li><li class="lvl-2"><p>åˆ†ä½æ•°ï¼ˆPercentileï¼‰æŒ‡æ ‡å¯¹ç…§è¡¨</p></li></ul><table><thead><tr><th>æŒ‡æ ‡</th><th>è‹±æ–‡å…¨ç§°</th><th>æ•°å­¦å«ä¹‰</th><th>é€šä¿—è§£é‡Š</th><th>å…¸å‹ä¸šåŠ¡è§£è¯»</th><th>å¸¸è§ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>Median</td><td>Median</td><td>æ’åºåä½äºä¸­é—´ä½ç½®çš„å€¼</td><td>ä¸€åŠæ•°æ®åœ¨å®ƒå·¦å³</td><td>â€œä¸€èˆ¬ç”¨æˆ·çš„ä½“éªŒâ€</td><td>åŸºç¡€ä½“éªŒè¯„ä¼°</td></tr><tr><td>P50</td><td>50th Percentile</td><td>50% çš„æ•°æ® â‰¤ è¯¥å€¼</td><td>å’Œ Median å®Œå…¨ç›¸åŒ</td><td>â€œå…¸å‹è¯·æ±‚è€—æ—¶â€</td><td>å¸¸è§„æ€§èƒ½ç›‘æ§</td></tr><tr><td>P90</td><td>90th Percentile</td><td>90% çš„æ•°æ® â‰¤ è¯¥å€¼</td><td>10% çš„è¯·æ±‚æ›´æ…¢</td><td>â€œå¤§å¤šæ•°ç”¨æˆ·çš„ä½“éªŒâ€</td><td>ä¸šåŠ¡ä½“éªŒç›‘æ§</td></tr><tr><td>P95</td><td>95th Percentile</td><td>95% çš„æ•°æ® â‰¤ è¯¥å€¼</td><td>5% çš„è¯·æ±‚æ›´æ…¢</td><td>â€œå°¾éƒ¨å¼€å§‹æ¶åŒ–â€</td><td>SLA è¾¹ç•Œç›‘æ§</td></tr><tr><td>P99</td><td>99th Percentile</td><td>99% çš„æ•°æ® â‰¤ è¯¥å€¼</td><td>1% çš„è¯·æ±‚æœ€æ…¢</td><td>â€œæç«¯ä½†çœŸå®çš„ç”¨æˆ·ä½“éªŒâ€</td><td>æ ¸å¿ƒ SLA / SLO</td></tr><tr><td>P99.9</td><td>99.9th Percentile</td><td>99.9% çš„æ•°æ® â‰¤ è¯¥å€¼</td><td>åƒåˆ†ä¹‹ä¸€æœ€æ…¢è¯·æ±‚</td><td>â€œæç«¯å°¾å»¶è¿Ÿâ€</td><td>é‡‘è / æ ¸å¿ƒé“¾è·¯</td></tr><tr><td>Max</td><td>Maximum</td><td>æ•°æ®ä¸­çš„æœ€å¤§å€¼</td><td>æœ€æ…¢çš„é‚£ä¸€æ¬¡</td><td>å™ªéŸ³æå¤§</td><td>å‡ ä¹ä¸ç”¨</td></tr></tbody></table><blockquote><p>ä¸€ä¸ªå¿«é€Ÿç†è§£ç¤ºä¾‹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å‡è®¾ 100 æ¬¡è¯·æ±‚ï¼š</span><br><span class="line">    99 æ¬¡è€—æ—¶ï¼š10 ms</span><br><span class="line">    1 æ¬¡è€—æ—¶ï¼š3000 ms</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥ï¼š</span><br><span class="line">    P99 = 3000 ms</span><br><span class="line">    P90 = 10 ms</span><br><span class="line">    P50/Median = 10 ms</span><br><span class="line">    å¹³å‡å€¼ = ï¼ˆ99*10 + 1*3000ï¼‰/ 100 = 39.9 ms</span><br><span class="line"></span><br><span class="line">ğŸ‘‰ åªæœ‰ P99 çœŸå®æš´éœ²äº†é—®é¢˜ã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å·¥ç¨‹å®è·µä¸­çš„â€œæ ‡å‡†æ­é…â€</p></li></ul><table><thead><tr><th>åº”ç”¨åœºæ™¯</th><th>å¸¸çœ‹æŒ‡æ ‡</th></tr></thead><tbody><tr><td>Web / API æœåŠ¡</td><td>P90 / P99</td></tr><tr><td>å¾®æœåŠ¡é“¾è·¯</td><td>P99 / P99.9</td></tr><tr><td>æ•°æ®åº“ / å­˜å‚¨</td><td>P95 / P99</td></tr><tr><td>å‰ç«¯ä½“éªŒ</td><td>P50 / P90</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ä¸€å¥è¯ï¼šTDigest ç”¨äºç»Ÿè®¡æ•°å­—çš„åˆ†å¸ƒï¼ŒP50 çœ‹ä¸­é—´ï¼ŒP90 çœ‹å¤§å¤šæ•°ï¼ŒP99 çœ‹æœ€å·®é‚£ 1%</p></li></ul><h2 id="RedisBloom-ä¸­-TDigest-çš„æ ¸å¿ƒå‘½ä»¤">RedisBloom ä¸­ TDigest çš„æ ¸å¿ƒå‘½ä»¤</h2><h3 id="åˆ›å»º-TDigest">åˆ›å»º TDigest</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TDIGEST.CREATE key [COMPRESSION compression]</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># keyï¼š TDigest çš„åç§°</span></span><br><span class="line"><span class="comment"># compressionï¼š å‹ç¼©çº§åˆ«ï¼Œé»˜è®¤ä¸º 100ï¼Œè¶Šå¤§ â†’ ç²¾åº¦è¶Šé«˜ â†’ å†…å­˜è¶Šå¤§</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.CREATE latency:td COMPRESSION 200</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å– TDigest çš„ç±»å‹</span></span><br><span class="line"><span class="built_in">type</span> latency:td</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">TDIS-TYPE</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ æ ·æœ¬">æ·»åŠ æ ·æœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TDIGEST.ADD key value [value ...]</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.ADD latency:td 12.3 15.7 100.4</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æœ€å¤§-æœ€å°å€¼">æŸ¥çœ‹æœ€å¤§/æœ€å°å€¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–æœ€å¤§å€¼</span></span><br><span class="line"><span class="comment"># TDIGEST.MAX key</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.MAX latency:td</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line"><span class="string">&quot;100.4&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å–æœ€å°å€¼</span></span><br><span class="line"><span class="comment"># TDIGEST.MIN key</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.MIN latency:td</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line"><span class="string">&quot;12.3&quot;</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢åˆ†ä½æ•°">æŸ¥è¯¢åˆ†ä½æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TDIGEST.QUANTILE key quantile [quantile ...]</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># keyï¼š TDigest çš„åç§°</span></span><br><span class="line"><span class="comment"># quantileï¼š æŸ¥è¯¢çš„åˆ†ä½æ•°ï¼Œ0.5=&gt;P50 / 0.9=&gt;P90 / 0.99=&gt;P99</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.QUANTILE latency:td 0.5 0.9 0.99</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">1) <span class="string">&quot;15.7&quot;</span></span><br><span class="line">2) <span class="string">&quot;100.4&quot;</span></span><br><span class="line">3) <span class="string">&quot;100.4&quot;</span></span><br></pre></td></tr></table></figure><h3 id="åå‘æŸ¥è¯¢ï¼ˆå€¼-â†’-ç™¾åˆ†ä½ï¼‰">åå‘æŸ¥è¯¢ï¼ˆå€¼ â†’ ç™¾åˆ†ä½ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TDIGEST.CDF key value [value ...]</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.CDF latency:td 12.3 15.7 100.4 20</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">1) <span class="string">&quot;0.16666666666666666&quot;</span></span><br><span class="line">2) <span class="string">&quot;0.5&quot;</span></span><br><span class="line">3) <span class="string">&quot;0.8333333333333334&quot;</span></span><br><span class="line">4) <span class="string">&quot;0.6666666666666666&quot;</span>  <span class="comment"># è¿™é‡Œæ³¨æ„ value ä¸å¿…é¡»åœ¨ TDIGEST ä¸­ï¼Œè¿™é‡Œçš„å«ä¹‰æ˜¯ P66=20ï¼Œå³ 66% çš„å€¼éƒ½ â‰¤ 20</span></span><br></pre></td></tr></table></figure><h3 id="åˆå¹¶-TDigest">åˆå¹¶ TDigest</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TDIGEST.MERGE destination-key numkeys source-key [source-key ...] [COMPRESSION compression] [OVERRIDE]</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># destination-keyï¼š ç›®æ ‡ TDigest çš„åç§°</span></span><br><span class="line"><span class="comment"># numkeysï¼š æº TDigest çš„æ•°é‡</span></span><br><span class="line"><span class="comment"># source-keyï¼š æº TDigest çš„åç§°</span></span><br><span class="line"><span class="comment"># compressionï¼š å‹ç¼©çº§åˆ«ï¼Œé»˜è®¤ä¸º 100ï¼Œè¶Šå¤§ â†’ ç²¾åº¦è¶Šé«˜ â†’ å†…å­˜è¶Šå¤§</span></span><br><span class="line"><span class="comment"># OVERRIDEï¼š æ˜¯å¦è¦†ç›–ç›®æ ‡ TDigestï¼Œé»˜è®¤ä¸º false</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.MERGE latency:td 2 latency:td:1 latency:td:2 COMPRESSION 200 OVERRIDE</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h3 id="è·å–è¿‘ä¼¼æ’å">è·å–è¿‘ä¼¼æ’å</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­£å‘æ’å</span></span><br><span class="line"><span class="comment"># TDIGEST.RANK key value [value ...]</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># TDIGEST.ADD latency:td 12.3 15.7 100.4 # å‡è®¾è¿™äº›æ•°æ®å·²ç»å†™å…¥äº† TDigest</span></span><br><span class="line"><span class="comment"># å¦‚æœæŠŠ value æ”¾å…¥å½“å‰åˆ†å¸ƒä¸­ï¼Œå®ƒçš„ rankï¼ˆå°äºè¯¥å€¼çš„æ ·æœ¬æ•°é‡ï¼‰æ˜¯å¤šå°‘</span></span><br><span class="line">TDIGEST.RANK latency:td 0 12.3 15.7 20 100.4 200</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">1) (<span class="built_in">integer</span>) -1   <span class="comment"># 0: å°äºæœ€å°å€¼ 12.3 â†’ è¿”å› -1</span></span><br><span class="line">2) (<span class="built_in">integer</span>) 0    <span class="comment"># 12.3: ç¬¬ 0 ä½ â†’ è¿”å› 0ï¼ŒçœŸå®å­˜åœ¨çš„ä½æ•°</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1    <span class="comment"># 15.7: æ’åœ¨ 12.3 å â†’ è¿”å› 1ï¼ŒçœŸå®å­˜åœ¨çš„ä½æ•°</span></span><br><span class="line">4) (<span class="built_in">integer</span>) 2    <span class="comment"># 20: ä»‹äº 15.7 ä¸ 100.4 ä¹‹é—´ â†’ è¿”å› 2</span></span><br><span class="line">5) (<span class="built_in">integer</span>) 2    <span class="comment"># 100.4: ç¬¬ 2 ä½ â†’ 20ï¼ŒçœŸå®å­˜åœ¨çš„ä½æ•°</span></span><br><span class="line">6) (<span class="built_in">integer</span>) 3    <span class="comment"># 200: å¤§äº 100.4 â†’ è¿”å› 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åå‘æ’å</span></span><br><span class="line"><span class="comment"># TDIGEST.REVRANK key value [value ...]</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.REVRANK latency:td 0 12.3 15.7 20 100.4 200</span><br></pre></td></tr></table></figure><h2 id="æ ¹æ®æ’åè·å–å…ƒç´ ">æ ¹æ®æ’åè·å–å…ƒç´ </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­£å‘æ’å</span></span><br><span class="line"><span class="comment"># TDIGEST.BYRANK key rank [rank ...]</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.BYRANK latency:td 0 1 2 3</span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">1) <span class="string">&quot;12.3&quot;</span></span><br><span class="line">2) <span class="string">&quot;15.7&quot;</span></span><br><span class="line">3) <span class="string">&quot;100.4&quot;</span></span><br><span class="line">4) <span class="string">&quot;inf&quot;</span>  <span class="comment"># ä¸å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åå‘æ’å</span></span><br><span class="line"><span class="comment"># TDIGEST.BYREVRANK key rank [rank ...]</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.BYREVRANK latency:td 0 1 2 3</span><br></pre></td></tr></table></figure><h3 id="è®¡ç®—-TDigest-å†…éƒ¨æ ·æœ¬-å»æ‰å°¾éƒ¨æå€¼åçš„å¹³å‡è¿‘ä¼¼å€¼ï¼ˆTrimmed-Meanï¼Œæˆªæ–­å‡å€¼ï¼‰">è®¡ç®— TDigest å†…éƒ¨æ ·æœ¬ å»æ‰å°¾éƒ¨æå€¼åçš„å¹³å‡è¿‘ä¼¼å€¼ï¼ˆTrimmed Meanï¼Œæˆªæ–­å‡å€¼ï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>å»æ‰æ•°æ®åˆ†å¸ƒçš„æç«¯å°¾éƒ¨ï¼Œåªç®—ä¸»è¦é›†ä¸­åŒºåŸŸçš„å¹³å‡å€¼ï¼Œè¿™æ ·æ›´èƒ½ä»£è¡¨â€œç»å¤§å¤šæ•°ç”¨æˆ·çš„ä½“éªŒâ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TDIGEST.TRIMMED_MEAN key low_cut_quantile high_cut_quantile</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># keyï¼š TDigest çš„åç§°</span></span><br><span class="line"><span class="comment"># low_cut_quantileï¼š å»æ‰çš„å·¦ä¾§ç™¾åˆ†æ¯”</span></span><br><span class="line"><span class="comment"># high_cut_quantileï¼š å»æ‰çš„å³ä¾§ç™¾åˆ†æ¯”</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.TRIMMED_MEAN latency:td 0.05 0.95</span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="string">&quot;42.800000000000004&quot;</span></span><br></pre></td></tr></table></figure><h3 id="è·å–-TDigest-çš„ä¿¡æ¯">è·å– TDigest çš„ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TDIGEST.INFO key</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.INFO latency:td</span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line"> 1) Compression     <span class="comment"># å‹ç¼©çº§åˆ«ï¼Œæ§åˆ¶è´¨å¿ƒçš„æ•°é‡ä¸ç²¾åº¦ã€‚å€¼è¶Šå¤§ â†’ ç²¾åº¦è¶Šé«˜ï¼Œå†…å­˜ç¨å¤§ã€‚</span></span><br><span class="line"> 2) (<span class="built_in">integer</span>) 200</span><br><span class="line"> 3) Capacity       <span class="comment"># è´¨å¿ƒæœ€å¤§å®¹é‡ã€‚è¡¨ç¤ºå†…éƒ¨èƒ½å®¹çº³çš„æœ€å¤§èŠ‚ç‚¹æ•°ï¼Œå®é™…ä½¿ç”¨ä¸­ TDigest ä¼šåŠ¨æ€åˆå¹¶è´¨å¿ƒä»¥æ§åˆ¶å†…å­˜ã€‚</span></span><br><span class="line"> 4) (<span class="built_in">integer</span>) 1210</span><br><span class="line"> 5) Merged nodes   <span class="comment"># å·²åˆå¹¶çš„è´¨å¿ƒæ•°é‡ã€‚è¿™äº›æ˜¯ TDigest å½“å‰å‹ç¼©åçš„èŠ‚ç‚¹ï¼Œç”¨äºè®¡ç®— rank / quantileã€‚</span></span><br><span class="line"> 6) (<span class="built_in">integer</span>) 3</span><br><span class="line"> 7) Unmerged nodes <span class="comment"># æœªåˆå¹¶çš„èŠ‚ç‚¹æ•°é‡ã€‚è¡¨ç¤ºæ–°åŠ å…¥ä½†å°šæœªå‹ç¼©åˆ°è´¨å¿ƒçš„æ ·æœ¬ã€‚</span></span><br><span class="line"> 8) (<span class="built_in">integer</span>) 0</span><br><span class="line"> 9) Merged weight  <span class="comment"># å·²åˆå¹¶è´¨å¿ƒçš„æ€»æƒé‡ã€‚æ¯ä¸ªæ ·æœ¬æƒé‡é»˜è®¤ä¸º 1ï¼Œ3 è¡¨ç¤ºç›®å‰æ€»å…±æœ‰ 3 ä¸ªæ ·æœ¬è¢«åˆå¹¶è¿›è´¨å¿ƒã€‚</span></span><br><span class="line">10) (<span class="built_in">integer</span>) 3</span><br><span class="line">11) Unmerged weight <span class="comment"># æœªåˆå¹¶èŠ‚ç‚¹çš„æƒé‡æ€»å’Œã€‚0 è¡¨ç¤ºæ²¡æœ‰æœªå‹ç¼©çš„æ ·æœ¬</span></span><br><span class="line">12) (<span class="built_in">integer</span>) 0</span><br><span class="line">13) Observations    <span class="comment"># è§‚æµ‹åˆ°çš„æ ·æœ¬æ€»æ•°ã€‚ä½  TDIGEST.ADD çš„ 3 ä¸ªæ ·æœ¬æ­£å¥½å¯¹åº”è¿™ä¸ªå€¼ã€‚</span></span><br><span class="line">14) (<span class="built_in">integer</span>) 3</span><br><span class="line">15) Total compressions <span class="comment"># å·²ç»æ‰§è¡Œçš„å‹ç¼©æ¬¡æ•°ã€‚æ¯æ¬¡ TDigest å†…éƒ¨è´¨å¿ƒåˆå¹¶ç§°ä¸ºä¸€æ¬¡å‹ç¼©ã€‚</span></span><br><span class="line">16) (<span class="built_in">integer</span>) 1</span><br><span class="line">17) Memory usage     <span class="comment"># Redis ä¸ºè¿™ä¸ª TDigest åˆ†é…çš„å†…å­˜ï¼ˆå­—èŠ‚ï¼‰ã€‚åŒ…å«è´¨å¿ƒã€ç´¢å¼•ã€ç»“æ„å¼€é”€ã€‚TDigest å†…å­˜ä½¿ç”¨æ˜¯å›ºå®šçš„ã€ä¸æ ·æœ¬æ•°é‡æ— å…³ï¼ˆä¸»è¦ç”± Compression å†³å®šï¼‰</span></span><br><span class="line">18) (<span class="built_in">integer</span>) 19368</span><br></pre></td></tr></table></figure><h3 id="æ¸…ç©ºå…ƒç´ ">æ¸…ç©ºå…ƒç´ </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TDIGEST.RESET key</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line">TDIGEST.RESET latency:td</span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h2 id="TDigest-çš„å†…å­˜ä¸ç²¾åº¦">TDigest çš„å†…å­˜ä¸ç²¾åº¦</h2><table><thead><tr><th>ç»´åº¦</th><th>ç‰¹æ€§</th></tr></thead><tbody><tr><td>å†…å­˜å ç”¨</td><td>ä¸ COMPRESSION æˆæ­£æ¯”ï¼ˆé€šå¸¸ KB çº§ï¼‰</td></tr><tr><td>ç²¾åº¦</td><td>å°¾éƒ¨åˆ†ä½æ•°ï¼ˆP95/P99ï¼‰æé«˜</td></tr><tr><td>å†™å…¥å¤æ‚åº¦</td><td>è¿‘ä¼¼ O(log n)</td></tr><tr><td>æŸ¥è¯¢å¤æ‚åº¦</td><td>O(log n)</td></tr></tbody></table><blockquote><p>ä¸æ ·æœ¬æ•°é‡æ— å…³ã€‚</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ TDigest æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;RedisBloom çš„å®‰è£…å‚è§ &lt;a href=&quot;/2025/12/21/redis7-module-RedisBloom/&quot; title=&quot;Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•&quot;&gt;Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TopK</title>
    <link href="https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-14-TopK/"/>
    <id>https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-14-TopK/</id>
    <published>2025-12-23T06:50:05.000Z</published>
    <updated>2025-12-24T03:37:03.539Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ TopK æ•°æ®ç±»å‹</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2">RedisBloom çš„å®‰è£…å‚è§ <a href="/2025/12/21/redis7-module-RedisBloom/" title="Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li></ul><span id="more"></span><h2 id="TopK">TopK</h2><ul class="lvl-0"><li class="lvl-2"><p>TopKï¼Œä¸“é—¨ç”¨äºè§£å†³ â€œåœ¨æµ·é‡æ•°æ®æµä¸­ï¼Œå®æ—¶æ‰¾å‡ºæœ€çƒ­é—¨çš„ N ä¸ªå…ƒç´ â€ è¿™ä¸€ç±»é—®é¢˜</p></li><li class="lvl-2"><p>Top-K å±äºæµå¼é‡é¢‘ï¼ˆHeavy Hittersï¼‰ç®—æ³•å®¶æ—ï¼Œå…¶ç›®æ ‡ä¸æ˜¯è®°å½•æ‰€æœ‰å…ƒç´ ï¼Œè€Œæ˜¯ï¼š</p><ul class="lvl-2"><li class="lvl-6">åœ¨å—é™å†…å­˜ä¸‹ï¼ŒæŒç»­ç»´æŠ¤å‡ºç°é¢‘ç‡æœ€é«˜çš„ K ä¸ªå…ƒç´ </li></ul></li><li class="lvl-3"><p>TopK çš„æ ¸å¿ƒç‰¹æ€§</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å›ºå®šå®¹é‡ï¼šåªç»´æŠ¤ K ä¸ªå…ƒç´ </span><br><span class="line">è¿‘ä¼¼ç»Ÿè®¡ï¼šè®¡æ•°å¯èƒ½ç•¥æœ‰è¯¯å·®</span><br><span class="line">è‡ªåŠ¨æ·˜æ±°ï¼šä½é¢‘å…ƒç´ ä¼šè¢«è¸¢å‡º</span><br><span class="line">å†™å…¥æå¿«ï¼šé€‚åˆé«˜ QPS</span><br><span class="line">å†…å­˜ç¨³å®šï¼šä¸æ•°æ®è§„æ¨¡æ— å…³</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>RedisBloom çš„ TopK å†…éƒ¨ä½¿ç”¨ CMS ä½œä¸ºé¢‘æ¬¡ä¼°ç®—åŸºç¡€ï¼Œå¹¶ç»“åˆ<code>å †+æ·˜æ±°ç­–ç•¥</code>æ¥ç»´æŠ¤çƒ­ç‚¹é›†åˆã€‚</p><ul class="lvl-2"><li class="lvl-6">CMS: å‚è€ƒ <a href="/2025/12/23/redis7-datatype-13-CMS/" title="Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch)">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch)</a></li><li class="lvl-6">å †+æ·˜æ±°ç­–ç•¥: TopK åœ¨å†…éƒ¨å¦‚ä½•å†³å®šè°èƒ½è¿›å…¥ TopKã€è°å¿…é¡»è¢«è¸¢å‡º TopK çš„ä¸€æ•´å¥—æœºåˆ¶ã€‚<ul class="lvl-4"><li class="lvl-10">å †ï¼šTopK ä½¿ç”¨ä¸€ä¸ªæœ€å°å †æ¥ç»´æŠ¤ TopK å…ƒç´ ï¼ŒTopK ç»´æŠ¤ K ä¸ªå€™é€‰å…ƒç´ ï¼Œå †é¡¶æ°¸è¿œæ˜¯ å½“å‰ TopK ä¸­é¢‘æ¬¡æœ€ä½çš„é‚£ä¸ª</li><li class="lvl-10">æ·˜æ±°ç­–ç•¥ï¼šTopK ä½¿ç”¨ä¸€ä¸ª LRU ç¼“å­˜æ¥è®°å½•æœ€è¿‘è®¿é—®çš„å…ƒç´ ï¼Œå½“ TopK å…ƒç´ æ•°é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå°† LRU ç¼“å­˜ä¸­çš„å…ƒç´ é€ä¸ªåŠ å…¥ TopKï¼Œå¹¶æ›´æ–° TopK å…ƒç´ çš„é¢‘ç‡ã€‚</li><li class="lvl-10">ä¸€å¥è¯ï¼šå½“æ–°å…ƒç´ çš„ä¼°ç®—é¢‘æ¬¡è¶…è¿‡å½“å‰æœ€å¼±çš„é‚£ä¸ªæ—¶ï¼Œå°±æŠŠå¼±è€…æ·˜æ±°æ‰ï¼Œè®©æ–°å…ƒç´ è¿›æ¦œã€‚</li></ul></li></ul></li></ul><h3 id="å½“ä¸€ä¸ªæ–°å…ƒç´ åˆ°æ¥æ—¶ï¼Œæˆ‘è¯¥ä¸è¯¥è®©å®ƒè¿›å…¥-TopKï¼Ÿ">å½“ä¸€ä¸ªæ–°å…ƒç´ åˆ°æ¥æ—¶ï¼Œæˆ‘è¯¥ä¸è¯¥è®©å®ƒè¿›å…¥ TopKï¼Ÿ</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹é¢æ˜¯ TopK åœ¨ TOPK.ADD æ—¶çš„çœŸå®é€»è¾‘æŠ½è±¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Step 1ï¼šæ›´æ–° CMSï¼ˆä¸å­˜ itemï¼Œåªæ›´æ–°è®¡æ•°å™¨ï¼‰</span></span><br><span class="line">CMS.increment(item)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 2ï¼šitem æ˜¯å¦åœ¨ TopK æ˜¾å¼é›†åˆä¸­ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span> item <span class="keyword">in</span> TopK:</span><br><span class="line">    <span class="comment"># é‡æ–°å¹³è¡¡å †ä½ç½®</span></span><br><span class="line">    update_heap(item)</span><br><span class="line">    <span class="built_in">return</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 3ï¼šTopK æ˜¯å¦æœªæ»¡ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span> TopK.size &lt; K:</span><br><span class="line">    TopK.insert(item)</span><br><span class="line">    <span class="built_in">return</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 4ï¼šæ¯”è¾ƒ CMS ä¼°ç®—å€¼</span></span><br><span class="line">freq_new = CMS.query(item)</span><br><span class="line">freq_min = CMS.query(TopK.min_item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> freq_new &gt; freq_min:</span><br><span class="line">    TopK.evict_min()</span><br><span class="line">    TopK.insert(item)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># ä»€ä¹ˆéƒ½ä¸åš</span></span><br><span class="line">    pass</span><br></pre></td></tr></table></figure><h2 id="TopK-çš„åº”ç”¨åœºæ™¯">TopK çš„åº”ç”¨åœºæ™¯</h2><table><thead><tr><th>é—®é¢˜</th><th>TopK æ˜¯å¦é€‚åˆ</th></tr></thead><tbody><tr><td>å½“å‰è®¿é—®é‡æœ€é«˜çš„ URL</td><td>âœ…</td></tr><tr><td>æœç´¢çƒ­è¯ Top 10</td><td>âœ…</td></tr><tr><td>å•†å“ç‚¹å‡»æ¦œ</td><td>âœ…</td></tr><tr><td>æ‰€æœ‰å•†å“çš„ç‚¹å‡»æ¬¡æ•°</td><td>âŒ</td></tr><tr><td>ç²¾ç¡®è®¡æ•°</td><td>âŒ</td></tr></tbody></table><h2 id="RedisBloom-TopK-çš„æ ¸å¿ƒå‘½ä»¤">RedisBloom TopK çš„æ ¸å¿ƒå‘½ä»¤</h2><h3 id="åˆ›å»º-TopK">åˆ›å»º TopK</h3><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨ TopK å‰å¿…é¡»å…ˆåˆ›å»º TopK</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TOPK.RESERVE key topk [width depth decay]</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># key: é”®å</span></span><br><span class="line"><span class="comment"># topk: å­˜å‚¨çš„å…ƒç´ æ•°é‡ï¼Œå³ç»Ÿè®¡çš„å‰ K ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment"># width: å†…éƒ¨CMS çš„å®½åº¦ï¼Œé»˜è®¤ 8</span></span><br><span class="line"><span class="comment"># depth: å†…éƒ¨CMS çš„æ·±åº¦ï¼Œé»˜è®¤ 7</span></span><br><span class="line"><span class="comment"># decay: è¡°å‡å› å­ï¼ˆ0 ~ 1ï¼‰ï¼Œé»˜è®¤ 0.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># å«ä¹‰ï¼šç»´æŠ¤è®¿é—®é‡æœ€é«˜çš„ 100 ä¸ª URLï¼Œå…è®¸å†å²çƒ­åº¦é€æ¸è¡°å‡ã€‚</span></span><br><span class="line">TOPK.RESERVE topk:urls 100 2000 7 0.9</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯ç±»å‹</span></span><br><span class="line"><span class="built_in">type</span> topk:urls</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">TopK-TYPE</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å…ƒç´ ">æ·»åŠ å…ƒç´ </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TOPK.ADD key items [items ...]</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># å«ä¹‰ï¼šæ·»åŠ å…ƒç´  &quot;a&quot; å’Œ &quot;b&quot; åˆ° TopK ä¸­</span></span><br><span class="line">TOPK.ADD topk:urls a b</span><br><span class="line"><span class="comment"># è¿”å›å€¼ï¼Œè¢«æŒ¤å‡º TopK çš„å…ƒç´ ï¼ˆå¦‚æœæœ‰ï¼‰</span></span><br><span class="line">1) (nil)</span><br><span class="line">2) (nil)</span><br></pre></td></tr></table></figure><h3 id="å¢åŠ å…ƒç´ çš„é¢‘ç‡">å¢åŠ å…ƒç´ çš„é¢‘ç‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TOPK.INCRBY key item increment [item increment ...]</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># å«ä¹‰ï¼šå°†å…ƒç´  &quot;a&quot; çš„é¢‘ç‡å¢åŠ  1</span></span><br><span class="line">TOPK.INCRBY topk:urls a 1</span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">1) (nil)</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢å…ƒç´ æ˜¯å¦åœ¨-TopK-ä¸­">æŸ¥è¯¢å…ƒç´ æ˜¯å¦åœ¨ TopK ä¸­</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TOPK.QUERY key item [item ...]</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># å«ä¹‰ï¼šæŸ¥è¯¢å…ƒç´  &quot;a&quot; æ˜¯å¦åœ¨ TopK ä¸­</span></span><br><span class="line">TOPK.QUERY topk:urls a</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 1 <span class="comment"># 1 è¡¨ç¤ºå…ƒç´  &quot;a&quot; åœ¨ TopK ä¸­ï¼Œ0 è¡¨ç¤ºå…ƒç´  &quot;a&quot; ä¸åœ¨ TopK ä¸­</span></span><br></pre></td></tr></table></figure><h3 id="è·å–-TopK-ä¸­çš„å…ƒç´ ">è·å– TopK ä¸­çš„å…ƒç´ </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TOPK.LIST key [WITHCOUNT]</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># WITHCOUNT: æ˜¯å¦è¿”å›æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸è¿”å›</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># å«ä¹‰ï¼šè·å– TopK ä¸­çš„å…ƒç´ ï¼Œå¹¶è¿”å›æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">TOPK.LIST topk:urls WITHCOUNT</span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">1) <span class="string">&quot;a&quot;</span></span><br><span class="line">2) (<span class="built_in">integer</span>) 2</span><br><span class="line">3) <span class="string">&quot;b&quot;</span></span><br><span class="line">4) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><h3 id="è·å–è¿‘ä¼¼è®¡æ•°">è·å–è¿‘ä¼¼è®¡æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TOPK.COUNT key item [item ...]</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># å«ä¹‰ï¼šè·å–å…ƒç´  &quot;a&quot; çš„è¿‘ä¼¼è®¡æ•°</span></span><br><span class="line">TOPK.COUNT topk:urls a</span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹TopK-çš„çŠ¶æ€">æŸ¥çœ‹TopK çš„çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TOPK.INFO key</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># å«ä¹‰ï¼šæŸ¥çœ‹ TopK çš„çŠ¶æ€</span></span><br><span class="line">TOPK.INFO topk:urls</span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">1) k                    <span class="comment"># topk çš„å¤§å°</span></span><br><span class="line">2) (<span class="built_in">integer</span>) 100</span><br><span class="line">3) width                <span class="comment"># å†…éƒ¨ CMS çš„å®½åº¦</span></span><br><span class="line">4) (<span class="built_in">integer</span>) 2000</span><br><span class="line">5) depth                <span class="comment"># å†…éƒ¨ CMS çš„æ·±åº¦</span></span><br><span class="line">6) (<span class="built_in">integer</span>) 7</span><br><span class="line">7) decay                <span class="comment"># è¡°å‡å› å­</span></span><br><span class="line">8) <span class="string">&quot;0.9&quot;</span></span><br></pre></td></tr></table></figure><h2 id="TopK-çš„è¡°å‡ï¼ˆdecayï¼‰å‚æ•°æ€ä¹ˆç†è§£">TopK çš„è¡°å‡ï¼ˆdecayï¼‰å‚æ•°æ€ä¹ˆç†è§£</h2><ul class="lvl-0"><li class="lvl-2"><p>decay ç”¨äºè§£å†³ä¸€ä¸ªé—®é¢˜ï¼šâ€œè€çƒ­ç‚¹æ°¸è¿œéœ¸æ¦œï¼Œæ–°çƒ­ç‚¹ä¸Šä¸æ¥â€</p></li></ul><table><thead><tr><th>decay</th><th>è¡Œä¸º</th></tr></thead><tbody><tr><td>1.0</td><td>æ°¸ä¸è¡°å‡ï¼ˆå…¨å†å²ç»Ÿè®¡ï¼‰</td></tr><tr><td>0.9</td><td>è¶Šè€çš„æ•°æ®æƒé‡è¶Šä½</td></tr><tr><td>0.5</td><td>çƒ­ç‚¹æ›´æ–°éå¸¸å¿«</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç»éªŒå€¼ï¼š</p><ul class="lvl-2"><li class="lvl-6">å®æ—¶çƒ­ç‚¹ï¼š0.8 ~ 0.9</li><li class="lvl-6">é•¿å‘¨æœŸæ¦œå•ï¼š0.95 ~ 1.0</li></ul></li></ul><h2 id="CMS-å’Œ-TopK-ç»„åˆä½¿ç”¨åœºæ™¯">CMS å’Œ TopK ç»„åˆä½¿ç”¨åœºæ™¯</h2><h3 id="ğŸ“Œåœºæ™¯1ï¼š-å®æ—¶çƒ­æœæ¦œï¼ˆæœ€ç»å…¸ç»„åˆï¼‰">ğŸ“Œåœºæ™¯1ï¼š å®æ—¶çƒ­æœæ¦œï¼ˆæœ€ç»å…¸ç»„åˆï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>éœ€æ±‚ï¼šç»Ÿè®¡æ‰€æœ‰æœç´¢è¯é¢‘æ¬¡ï¼ˆCMSï¼‰ï¼ŒåŒæ—¶å®æ—¶å‡ºTOP10çƒ­æœï¼ˆTOPKï¼‰ï¼Œæ—¢çŸ¥çƒ­åº¦åˆèƒ½æ’åº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. åˆå§‹åŒ–CMSï¼ˆç»Ÿè®¡å…¨é‡æœç´¢è¯è®¡æ•°ï¼Œè¯¯å·®0.001ï¼‰</span></span><br><span class="line">cms.initbyprob search_count 0.001 0.01</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. åˆå§‹åŒ–TOPKï¼ˆå–TOP10çƒ­æœï¼‰</span></span><br><span class="line">topk.reserve search_top10 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ç”¨æˆ·æœç´¢æ ¸å¿ƒæ“ä½œï¼ˆ2å‘½ä»¤å¿…ä¸€èµ·æ‰§è¡Œï¼‰</span></span><br><span class="line"><span class="comment"># æœç´¢&quot;å‘¨æ°ä¼¦&quot;ï¼ŒCMSè®¡æ•°+1ï¼ŒåŒæ—¶å½•å…¥TOPKï¼ˆè‡ªåŠ¨ç´¯åŠ çƒ­åº¦ï¼‰</span></span><br><span class="line">cms.incrby search_count å‘¨æ°ä¼¦ 1</span><br><span class="line">topk.incrby search_top10 å‘¨æ°ä¼¦ 1</span><br><span class="line"></span><br><span class="line">cms.incrby search_count åŸç¥ 1</span><br><span class="line">topk.incrby search_top10 åŸç¥ 1</span><br><span class="line">cms.incrby search_count å‘¨æ°ä¼¦ 1  <span class="comment"># é‡å¤æœç´¢ï¼ŒåŒç«¯åŒæ­¥+1</span></span><br><span class="line">topk.incrby search_top10 å‘¨æ°ä¼¦ 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. æ ¸å¿ƒæŸ¥è¯¢ï¼šå…ˆå–TOP10ï¼Œå†æŸ¥ç²¾å‡†è®¡æ•°ï¼ˆç»„åˆæ ¸å¿ƒï¼‰</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€æ­¥ï¼šå–TOP10çƒ­æœåˆ—è¡¨</span></span><br><span class="line">topk.list search_top10  <span class="comment"># è¿”å›ï¼šå‘¨æ°ä¼¦ã€åŸç¥...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒæ­¥ï¼šæŸ¥çƒ­æœè¯ç²¾å‡†è¿‘ä¼¼è®¡æ•°ï¼ˆCMSæ¯”TOPK.countæ›´å‡†ï¼‰</span></span><br><span class="line">cms.query search_count å‘¨æ°ä¼¦  <span class="comment"># è¿”å›2ï¼ˆç²¾å‡†ï¼‰</span></span><br><span class="line">topk.count search_top10 å‘¨æ°ä¼¦  <span class="comment"># å‚è€ƒå€¼ï¼Œä¼˜å…ˆç”¨CMSç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. è¾…åŠ©æŸ¥è¯¢ï¼šåˆ¤æ–­è¯æ˜¯å¦åœ¨çƒ­æœæ¦œ</span></span><br><span class="line">topk.query search_top10 å‘¨æ°ä¼¦  <span class="comment"># 1=åœ¨ï¼Œ0=ä¸åœ¨</span></span><br></pre></td></tr></table></figure><h2 id="TopK-vs-ZSET">TopK vs ZSET</h2><ul class="lvl-0"><li class="lvl-2"><p>èƒ½åŠ›è¾¹ç•Œå¯¹æ¯”</p></li></ul><table><thead><tr><th>èƒ½åŠ›</th><th>TopK</th><th>ZSet</th></tr></thead><tbody><tr><td>æ˜¯å¦è¿‘ä¼¼</td><td>âœ”ï¸ æ˜¯</td><td>âŒ å¦</td></tr><tr><td>æ˜¯å¦ä¿å­˜å…¨éƒ¨å…ƒç´ </td><td>âŒ åªä¿å­˜ Top K</td><td>âœ”ï¸ ä¿å­˜å…¨éƒ¨</td></tr><tr><td>é¢‘æ¬¡æ˜¯å¦ç²¾ç¡®</td><td>âŒ ä¼°è®¡</td><td>âœ”ï¸ ç²¾ç¡®</td></tr><tr><td>æ˜¯å¦æ”¯æŒæ’åº</td><td>âš ï¸ ä»… Top K</td><td>âœ”ï¸ å…¨é‡æ’åº</td></tr><tr><td>æ˜¯å¦å¯éå†</td><td>âŒ ä»… K ä¸ª</td><td>âœ”ï¸ å…¨é‡</td></tr><tr><td>æ˜¯å¦æ”¯æŒåˆ é™¤</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ”ï¸ æ”¯æŒ</td></tr><tr><td>æ˜¯å¦æ”¯æŒèŒƒå›´æŸ¥è¯¢</td><td>âŒ</td><td>âœ”ï¸</td></tr><tr><td>Top N æŸ¥è¯¢</td><td>âœ”ï¸ åŸç”Ÿ</td><td>âœ”ï¸</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ€§èƒ½ä¸ååé‡å¯¹æ¯”</p></li></ul><table><thead><tr><th>ç»´åº¦</th><th>TopK</th><th>ZSet</th></tr></thead><tbody><tr><td>å†™å…¥å¤æ‚åº¦</td><td>O(d)</td><td>O(log N)</td></tr><tr><td>é«˜å¹¶å‘å†™å…¥</td><td>æä¼˜</td><td>ä¸€èˆ¬</td></tr><tr><td>æŸ¥è¯¢ TopK</td><td>O(K)</td><td>O(K)</td></tr><tr><td>æŸ¥è¯¢å•å…ƒç´ é¢‘æ¬¡</td><td>O(d)</td><td>O(1)</td></tr><tr><td>æ‰¹é‡å†™å…¥</td><td>æå¿«</td><td>è¾ƒæ…¢</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ TopK æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;RedisBloom çš„å®‰è£…å‚è§ &lt;a href=&quot;/2025/12/21/redis7-module-RedisBloom/&quot; title=&quot;Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•&quot;&gt;Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch)</title>
    <link href="https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-13-CMS/"/>
    <id>https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-13-CMS/</id>
    <published>2025-12-23T06:40:05.000Z</published>
    <updated>2025-12-24T03:38:33.098Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Count-Min Sketch æ•°æ®ç±»å‹</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2">RedisBloom çš„å®‰è£…å‚è§ <a href="/2025/12/21/redis7-module-RedisBloom/" title="Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li></ul><span id="more"></span><h2 id="Count-Min-Sketch">Count-Min Sketch</h2><ul class="lvl-0"><li class="lvl-2"><p>Count-Min Sketchï¼ˆCMSï¼‰ ç”¨äºåœ¨æä½å†…å­˜å ç”¨ä¸‹ï¼Œå¯¹é«˜é¢‘å†™å…¥çš„è®¡æ•°å‹æ•°æ®è¿›è¡Œè¿‘ä¼¼ç»Ÿè®¡ï¼Œéå¸¸é€‚åˆæµé‡ã€äº‹ä»¶ã€å…³é”®è¯ç­‰â€œåªå…³å¿ƒé¢‘æ¬¡è§„æ¨¡ã€ä¸è¦æ±‚ç²¾ç¡®å€¼â€çš„åœºæ™¯ã€‚</p></li><li class="lvl-2"><p>Count-Min Sketch æ˜¯ä¸€ç§åŸºäºå“ˆå¸Œçš„æ¦‚ç‡å‹è®¡æ•°ç»“æ„ï¼Œç”¨äºä¼°ç®—å…ƒç´ å‡ºç°æ¬¡æ•°ï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹å¾ï¼š</p><ul class="lvl-2"><li class="lvl-6">åªä¼šé«˜ä¼°ï¼Œä¸ä¼šä½ä¼°ï¼ˆover-estimationï¼‰</li><li class="lvl-6">å›ºå®šå†…å­˜ï¼Œä¸å…ƒç´ ç§ç±»æ•°æ— å…³</li><li class="lvl-6">O(1) çš„æ›´æ–°ä¸æŸ¥è¯¢å¤æ‚åº¦</li><li class="lvl-6">ä¸æ”¯æŒåˆ é™¤ï¼ˆæˆ–åªèƒ½è¿‘ä¼¼åˆ é™¤ï¼‰</li><li class="lvl-6">åªèƒ½è¿”å›ç»™å®šå…ƒç´ è¿‘ä¼¼ç»Ÿè®¡å…¶é¢‘æ¬¡ï¼Œè€Œæ— æ³•è¿”å›å…¨éƒ¨å…ƒç´ çš„ç»Ÿè®¡é¢‘æ¬¡</li></ul></li><li class="lvl-2"><p>åŸºæœ¬å·¥ä½œåŸç†ï¼ˆç®€åŒ–ç‰ˆï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.åˆå§‹åŒ–ä¸€ä¸ªäºŒç»´æ•°ç»„ counter[d][w]</span><br><span class="line">2.å¯¹æ¯ä¸ªå…ƒç´  xï¼š</span><br><span class="line">    a. é€šè¿‡ d ä¸ªå“ˆå¸Œå‡½æ•°æ˜ å°„åˆ° d è¡Œä¸­çš„ w ä¸ªä½ç½®</span><br><span class="line">    b. å¯¹å¯¹åº”çš„ d ä¸ªè®¡æ•°å™¨å…¨éƒ¨ +1</span><br><span class="line">3.æŸ¥è¯¢å…ƒç´  x çš„é¢‘æ¬¡ï¼š</span><br><span class="line">    a.å–è¿™ d ä¸ªè®¡æ•°å™¨çš„ æœ€å°å€¼(å–æœ€å°å€¼æ˜¯ä¸ºäº†å°½é‡æŠµæ¶ˆå“ˆå¸Œå†²çªå¸¦æ¥çš„â€œå¤šåŠ â€)</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ä¸‹å›¾ä¸­çš„æ•°ç»„ä¸æ˜¯äºŒè¿›åˆ¶çš„ï¼Œæ¯æ¬¡æ˜ å°„éƒ½ä¼š+1<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/Ybl5tj.png" alt=""></p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>è¯¯å·®ä¸ç©ºé—´å¤æ‚åº¦</p></li></ul><table><thead><tr><th>ç»´åº¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è¯¯å·®ä¸Šç•Œ</td><td>â‰¤ Îµ Ã— æ€»æ’å…¥æ¬¡æ•°</td></tr><tr><td>é”™è¯¯æ¦‚ç‡</td><td>â‰¤ Î´</td></tr><tr><td>ç©ºé—´å¤æ‚åº¦</td><td>O(1 / Îµ Ã— log(1 / Î´))</td></tr><tr><td>æŸ¥è¯¢å¤æ‚åº¦</td><td>O(d)</td></tr><tr><td>æ›´æ–°å¤æ‚åº¦</td><td>O(d)</td></tr></tbody></table><blockquote><p>ç»“è®ºï¼šæ•°æ®é‡å†å¤§ï¼Œå†…å­˜ä¸å¢é•¿ï¼Œä»£ä»·æ˜¯â€œç²¾åº¦æ¢ç©ºé—´â€</p></blockquote><h2 id="RedisBloom-ä¸­-CMS-çš„æ ¸å¿ƒå‘½ä»¤">RedisBloom ä¸­ CMS çš„æ ¸å¿ƒå‘½ä»¤</h2><h3 id="åˆ›å»º-CMS">åˆ›å»º CMS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‰åº•å±‚ç»´åº¦åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"># CMS.INITBYDIM key width depth</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># width (w)ï¼šæ¯ä¸€è¡Œçš„æ¡¶æ•°ï¼ˆå½±å“è¯¯å·®ï¼‰</span></span><br><span class="line"><span class="comment"># depth (d)ï¼šå“ˆå¸Œå‡½æ•°æ•°é‡ï¼ˆå½±å“å†²çªæ¦‚ç‡ï¼‰</span></span><br><span class="line"><span class="comment"># æ¯”å¦‚ï¼š</span></span><br><span class="line">CMS.INITBYDIM page:view 1000 10</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯ç±»å‹</span></span><br><span class="line"><span class="built_in">type</span> page:view</span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">CMSk-TYPE</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰è¯¯å·®+å®¹é‡åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"># CMS.INITBYPROB page:view error probability</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># error (Îµ)ï¼šè¯¯å·®ä¸Šç•Œ</span></span><br><span class="line"><span class="comment"># probability (Î´)ï¼šè¶…è¿‡è¯¯å·®ä¸Šç•Œçš„æ¦‚ç‡ï¼Œè¿™ä¸ªæ•°å­—è¶Šæ¥è¿‘é›¶ï¼Œæ¯ä¸ªé¡¹ç›®çš„å†…å­˜æ¶ˆè€—å°±è¶Šå¤§ï¼Œæ¯æ¬¡æ“ä½œçš„CPUä½¿ç”¨å°±è¶Šå¤šã€‚</span></span><br><span class="line"><span class="comment"># RedisBloom ä¼šè‡ªåŠ¨æ¢ç®— w å’Œ d</span></span><br><span class="line"><span class="comment"># æ¯”å¦‚ï¼š</span></span><br><span class="line">CMS.INITBYPROB key 0.001 0.01</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>æ•°å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>error</code></td><td><code>0.001</code></td><td>æœ€å¤§ç›¸å¯¹è¯¯å·® Îµ = 0.1%</td></tr><tr><td><code>probability</code></td><td><code>0.01</code></td><td>åªæœ‰ 1% çš„æ¦‚ç‡è¶…è¿‡è¯¥è¯¯å·®</td></tr></tbody></table><h3 id="å¢åŠ è®¡æ•°">å¢åŠ è®¡æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMS.INCRBY key item1 count1 item2 count2 ...</span></span><br><span class="line">CMS.INCRBY page:view home 1 about 1 home 1</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 1</span><br><span class="line">2) (<span class="built_in">integer</span>) 1</span><br><span class="line">3) (<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢è®¡æ•°">æŸ¥è¯¢è®¡æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMS.QUERY key item1 item2 ...</span></span><br><span class="line">CMS.QUERY page:view home about</span><br><span class="line"><span class="comment"># è¿”å›çš„æ˜¯ ä¼°ç®—å€¼ï¼ˆå¯èƒ½åå¤§ï¼‰</span></span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 2</span><br><span class="line">2) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><h3 id="åˆå¹¶-CMS">åˆå¹¶ CMS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMS.MERGE dest numkeys src1 src2 ... WEIGHTS w1 w2 ...</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># destï¼šç›®æ ‡ CMSï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class="line"><span class="comment"># numkeysï¼šæº CMS æ•°é‡</span></span><br><span class="line"><span class="comment"># src1 src2 ...ï¼šæº CMSï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class="line"><span class="comment"># WEIGHTS w1 w2 ...ï¼šæº CMS æƒé‡</span></span><br><span class="line">CMS.MERGE page:view 2 page:view:1 page:view:2 WEIGHTS 1 1</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h3 id="è·å–-CMS-çš„ä¿¡æ¯">è·å– CMS çš„ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMS.INFO key</span></span><br><span class="line">CMS.INFO page:view</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) width            <span class="comment"># æ¯ä¸€è¡Œæ¡¶æ•° w</span></span><br><span class="line">2) (<span class="built_in">integer</span>) 1000</span><br><span class="line">3) depth            <span class="comment"># å“ˆå¸Œå‡½æ•°æ•°é‡ d</span></span><br><span class="line">4) (<span class="built_in">integer</span>) 10</span><br><span class="line">5) count            <span class="comment"># å½“å‰å·²æ’å…¥çš„å…ƒç´ æ•°é‡</span></span><br><span class="line">6) (<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure><h2 id="CMS-çš„ä½¿ç”¨åœºæ™¯">CMS çš„ä½¿ç”¨åœºæ™¯</h2><h3 id="åœºæ™¯1ï¼šç½‘ç«™PVç»Ÿè®¡">åœºæ™¯1ï¼šç½‘ç«™PVç»Ÿè®¡</h3><ul class="lvl-0"><li class="lvl-2"><p>éœ€æ±‚ï¼šç»Ÿè®¡ç½‘ç«™ PVï¼Œå³é¡µé¢è¢«è®¿é—®çš„æ¬¡æ•°ï¼Œå…è®¸0.1%çš„è¯¯å·®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ– CMS</span></span><br><span class="line">CMS.INITBYPROB page:pv 0.001 0.01</span><br><span class="line"><span class="comment"># æ·»åŠ è®¡æ•°</span></span><br><span class="line">CMS.INCRBY page:pv /home 1 /about 1</span><br><span class="line">CMS.INCRBY page:pv /home 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢è®¡æ•°</span></span><br><span class="line">CMS.QUERY page:pv /home</span><br></pre></td></tr></table></figure><h3 id="åœºæ™¯2ï¼šæ¥å£è°ƒç”¨é¢‘æ¬¡é™æµå‰ç½®ç»Ÿè®¡">åœºæ™¯2ï¼šæ¥å£è°ƒç”¨é¢‘æ¬¡é™æµå‰ç½®ç»Ÿè®¡</h3><ul class="lvl-0"><li class="lvl-2"><p>éœ€æ±‚ï¼šç»Ÿè®¡æ¥å£è°ƒç”¨æ¬¡æ•°ï¼Œä¸ºé™æµæä¾›å·²ç»ï¼Œä¸éœ€è¦ç²¾å‡†è®¡æ•°ï¼Œå…è®¸0.1%çš„è¯¯å·®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º CMS</span></span><br><span class="line">CMS.INITBYPROB api:<span class="built_in">limit</span> 0.001 0.01</span><br><span class="line"><span class="comment"># æ·»åŠ è®¡æ•°</span></span><br><span class="line">CMS.INCRBY api:<span class="built_in">limit</span> /api/user/list 1</span><br><span class="line"><span class="comment"># è·å–è®¡æ•°</span></span><br><span class="line">CMS.QUERY api:<span class="built_in">limit</span> /api/user/list</span><br></pre></td></tr></table></figure><h2 id="CMS-vs-ZSET">CMS vs ZSET</h2><ul class="lvl-0"><li class="lvl-2"><p>èƒ½åŠ›è¾¹ç•Œå¯¹æ¯”</p></li></ul><table><thead><tr><th>èƒ½åŠ›</th><th>CMS</th><th>ZSet</th></tr></thead><tbody><tr><td>é¢‘æ¬¡ç»Ÿè®¡</td><td>âœ”ï¸ è¿‘ä¼¼</td><td>âœ”ï¸ ç²¾ç¡®</td></tr><tr><td>æ˜¯å¦å­˜å…ƒç´ </td><td>âŒ ä¸å­˜</td><td>âœ”ï¸ å­˜</td></tr><tr><td>æ˜¯å¦å¯éå†å…ƒç´ </td><td>âŒ ä¸å¯</td><td>âœ”ï¸ å¯</td></tr><tr><td>TopK / æ’è¡Œ</td><td>âŒï¼ˆéœ€é…åˆ TopKï¼‰</td><td>âœ”ï¸ å¤©ç„¶æ”¯æŒ</td></tr><tr><td>åˆ é™¤å…ƒç´ </td><td>âŒ ä¸æ”¯æŒ</td><td>âœ”ï¸ æ”¯æŒ</td></tr><tr><td>è¯¯åˆ¤ / è¯¯å·®</td><td>âœ”ï¸ å­˜åœ¨</td><td>âŒ æ— </td></tr><tr><td>æ˜¯å¦å¯é€†ï¼ˆæŸ¥æˆå‘˜ï¼‰</td><td>âŒ ä¸å¯é€†</td><td>âœ”ï¸ å¯é€†</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ€§èƒ½ç‰¹å¾å¯¹æ¯”</p></li></ul><table><thead><tr><th>æ“ä½œ</th><th>CMS</th><th>ZSet</th></tr></thead><tbody><tr><td>æ’å…¥ / è®¡æ•°</td><td>O(d)ï¼ˆå¸¸æ•°çº§ï¼‰</td><td>O(log N)</td></tr><tr><td>æŸ¥è¯¢é¢‘æ¬¡</td><td>O(d)</td><td>O(1)</td></tr><tr><td>æ’åæŸ¥è¯¢</td><td>âŒ</td><td>O(log N)</td></tr><tr><td>æ‰¹é‡å†™å…¥</td><td>æå¿«</td><td>ä¸­ç­‰</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Count-Min Sketch æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;RedisBloom çš„å®‰è£…å‚è§ &lt;a href=&quot;/2025/12/21/redis7-module-RedisBloom/&quot; title=&quot;Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•&quot;&gt;Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CF(Cuckoo Filter)</title>
    <link href="https://blog.hanqunfeng.com/2025/12/22/redis7-datatype-12-CF/"/>
    <id>https://blog.hanqunfeng.com/2025/12/22/redis7-datatype-12-CF/</id>
    <published>2025-12-22T06:40:05.000Z</published>
    <updated>2026-01-06T10:10:32.852Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Cuckoo Filter æ•°æ®ç±»å‹</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2">RedisBloom çš„å®‰è£…å‚è§ <a href="/2025/12/21/redis7-module-RedisBloom/" title="Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li><li class="lvl-2">ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/data-type-demo">GitHub</a></li></ul><span id="more"></span><h2 id="Cuckoo-Filterï¼ˆå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼‰">Cuckoo Filterï¼ˆå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼‰</h2><ul class="lvl-0"><li class="lvl-2"><p>Cuckoo Filter æ˜¯ Bloom Filter çš„æ”¹è¿›ç‰ˆï¼Œæ”¯æŒ åŠ¨æ€æ·»åŠ å’Œåˆ é™¤å…ƒç´ ï¼Œä»èƒ½æä¾›æ¯”å¸ƒéš†è¿‡æ»¤å™¨æ›´é«˜çš„æŸ¥è¯¢æ€§èƒ½ã€‚</p></li><li class="lvl-2"><p><a href="https://en.wikipedia.org/wiki/Cuckoo_filter">ç»´åŸºç™¾ç§‘å¯¹ Cuckoo Filter çš„æè¿°</a></p></li><li class="lvl-2"><p>åœ¨é«˜ QPS æŸ¥è¯¢åœºæ™¯ä¸‹ï¼ŒCuckoo Filter é€šå¸¸ä¼˜äº Bloom Filterã€‚</p></li><li class="lvl-2"><p>ä¼˜ç‚¹ï¼šä½è¯¯åˆ¤ç‡ + é«˜è´Ÿè½½ç‡ï¼ŒåŸºäºç›¸åŒçš„é›†åˆå’Œè¯¯æŠ¥ç‡ï¼ŒCuckoo Filteré€šå¸¸å ç”¨ç©ºé—´æ›´å°‘ã€‚ç›¸å¯¹çš„ï¼Œç®—æ³•å®ç°ä¹Ÿå°±æ›´å¤æ‚ã€‚</p></li><li class="lvl-2"><p>ç¼ºç‚¹ï¼šä¸Bloom Filterä¸€æ ·ï¼Œæœ‰å¯èƒ½å°†ä¸€ä¸ªä¸åœ¨é›†åˆä¸­çš„å…ƒç´ é”™è¯¯çš„åˆ¤æ–­æˆåœ¨é›†åˆä¸­</p></li><li class="lvl-2"><p>Bloom Filter çš„è¯¯æŠ¥ç‡é€šè¿‡è°ƒæ•´<code>ä½æ•°ç»„çš„å¤§å°</code>å’Œ<code>å“ˆå¸Œå‡½æ•°æ•°é‡</code>æ¥æ§åˆ¶ï¼Œè€Œ Cuckoo Filter çš„è¯¯æŠ¥ç‡å—<code>æŒ‡çº¹å¤§å°</code>å’Œ<code>æ¡¶å¤§å°</code>æ§åˆ¶ã€‚</p></li></ul><h3 id="å¸ƒè°·å“ˆå¸Œç®—æ³•">å¸ƒè°·å“ˆå¸Œç®—æ³•</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://baike.baidu.com/item/Cockoo%20hash/3022855">ç™¾åº¦ç™¾ç§‘å¯¹å¸ƒè°·å“ˆå¸Œç®—æ³•çš„æè¿°</a>]</p></li><li class="lvl-2"><p>ç®—æ³•ä½¿ç”¨ä¸¤ä¸ªä¸åŒå“ˆå¸Œå‡½æ•°è®¡ç®—å¯¹åº” key çš„ä½ç½®ã€‚</p><ul class="lvl-2"><li class="lvl-6"><ol><li class="lvl-9">å½“ä¸¤ä¸ªå“ˆå¸Œä»»æ„ä½ç½®ä¸ºç©ºï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªä½ç½®æ’å…¥</li></ol></li><li class="lvl-6"><ol start="2"><li class="lvl-9">å½“ä¸¤ä¸ªå“ˆå¸Œæœ‰ä½ç½®ä¸ºç©ºæ—¶ï¼Œåˆ™æ’å…¥åˆ°ç©ºä½ç½®</li></ol></li><li class="lvl-6"><ol start="3"><li class="lvl-9">å½“ä¸¤ä¸ªå“ˆå¸Œä½ç½®å‡ä¸ä¸ºç©ºæ—¶ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªä½ç½®æ’å…¥å¹¶è¸¢å‡ºåŸkeyï¼ŒåŸkeyä¼šå†æ¬¡ç»è¿‡è®¡ç®—è·å¾—æ–°çš„ä½ç½®ï¼Œè½¬è‡³1æ‰§è¡Œï¼Œåå¤ç›´åˆ°æˆåŠŸæˆ–è€…è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚</li></ol></li></ul></li></ul><h3 id="Cuckoo-Filter-çš„å®ç°åŸç†">Cuckoo Filter çš„å®ç°åŸç†</h3><ul class="lvl-0"><li class="lvl-2"><p>å¸ƒè°·è¿‡æ»¤å™¨ æ˜¯åœ¨<code>å¸ƒè°·å“ˆå¸Œç®—æ³•</code>çš„ç®—æ³•åŸºç¡€ä¸Šæ‰©å……æ¥çš„ï¼Œä½†æ˜¯å®ƒæ‰€æä¾›çš„æ¦‚å¿µä¸æ˜¯è¡¨ï¼Œè€Œæ˜¯æä¾›äº†å¤šä¸ªæ•°æ®æ¡¶(Bucket)</p></li><li class="lvl-2"><p>æ¯ä¸€ä¸ªæ•°æ®æ¡¶éƒ½æ˜¯ä¸ª<code>ä¸€ç»´æ•°ç»„</code>ï¼Œæ¯ä¸ªæ•°ç»„çš„ä¿å­˜å†…å®¹ä¸º<code>æ¡ç›®(Entry)</code>ï¼Œæ¯ä¸€ä¸ªæ¡ç›®é‡Œé¢å¯ä»¥ä¿å­˜ä¸€ä¸ª<code>æŒ‡çº¹æ•°æ®</code>(æŒ‡çº¹æ•°æ®å°±æ˜¯åŸå§‹æ•°æ®ç»è¿‡å“ˆå¸Œè®¡ç®—å¾—åˆ°çš„ä¸€ä¸ªnä½çš„æ•°æ®æ ‡è®°)ï¼Œé™¤äº†æŒ‡çº¹æ•°æ®ä¹‹å¤–ï¼Œè¿˜ä¼šåŒæ—¶å¾—å‡ºä¸€ä¸ª<code>ä¿å­˜ä½ç½®P1æ ‡è®°</code>ã€‚</p></li><li class="lvl-2"><p>å½“ä¸¤ä¸ªæ•°æ®è®¡ç®—å¾—åˆ°çš„æŒ‡çº¹æ•°æ®ç›¸åŒæ—¶ï¼Œå°±ä¼šå‘ç”Ÿå†²çªï¼Œå†²çªæ“ä½œçš„è§£å†³æ€è·¯æ˜¯ä½¿ç”¨<code>å¸ƒè°·å“ˆå¸Œç®—æ³•</code>ï¼Œç®€å•è¯´å°±æ˜¯æ–°çš„æ•°æ®ä¼šå°†åŸæœ‰æ•°æ®<code>è¸¢å‡º</code>ï¼Œè€Œè¢«è¸¢å‡ºçš„æ•°æ®ä¼šè¢«é‡æ–°è®¡ç®—å¾—åˆ°æ–°çš„æŒ‡çº¹æ•°æ®å’Œä¿å­˜ä½ç½®æ ‡è®°ã€‚</p></li><li class="lvl-2"><p>å¸ƒè°·è¿‡æ»¤å™¨é‡Œé¢éœ€è¦è¿›è¡Œå„ç§æ•°æ®çš„<code>è¸¢å‡º</code>æ“ä½œï¼Œè¿™ä¸ªè¸¢å‡ºçš„æ–¹å¼å°±æ˜¯ä½¿ç”¨<code>P1æ ‡å¿—ä½</code>å’Œ<code>æŒ‡çº¹æ•°æ®</code>è¿›è¡Œ<code>å¼‚æˆ–è®¡ç®—</code>å¾—å‡ºæ¥çš„<code>P2æ ‡å¿—ä½</code>ï¼ŒæŒ‰ç…§åŒæ ·çš„æ€è·¯(å‰æ:ä¸€ç›´éƒ½æœ‰å†²çªæ“ä½œ)ä¸€ç›´è®¡ç®—æ–°çš„P2ä½ï¼Œç›´åˆ°å†²çªè§£å†³æˆ–è€…è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œå°±ä¼šå¤±è´¥ã€‚</p></li><li class="lvl-2"><p>æŒ‡çº¹æ•°æ®é‡Œé¢åŒ…å«æœ‰<code>å”¯ä¸€æ€§</code>ï¼Œæ‰€ä»¥å¯ä»¥å®ç°æ•°æ®çš„åˆ é™¤ï¼Œå½“ç„¶ï¼Œä¸åŒçš„æ•°æ®è®¡ç®—æ˜¯æœ‰å¯èƒ½å¾—åˆ°ç›¸åŒæŒ‡çº¹çš„ï¼Œé‚£ä¹ˆä¸€æ—¦åˆ é™¤æ•°æ®ä¹‹åï¼Œæœ‰å¯èƒ½é€ æˆæ•°æ®çš„&quot;å‡åˆ é™¤&quot;ï¼Œæ‰€ä»¥å¸ƒè°·è¿‡æ»¤å™¨æœ¬èº«ä¹Ÿæ˜¯å­˜åœ¨æœ‰è¯¯å·®çš„ã€‚</p></li><li class="lvl-2"><p>Cuckoo Filter ä¸­çš„ <code>BUSKETSIZE</code></p><ul class="lvl-2"><li class="lvl-6">BUSKETSIZEï¼Œè¡¨ç¤ºæ¯ä¸ªæ¡¶(Busket)ä¸­å­˜æ”¾çš„å…ƒç´ ä¸ªæ•°ï¼Œå³æ¡¶å¤§å°ã€‚</li><li class="lvl-6">Cuckoo Filterçš„æ•°ç»„é‡Œå­˜çš„ä¸æ˜¯ä½ï¼Œè€Œæ˜¯æ¡¶(busket)ï¼Œæ¯ä¸ªæ¡¶é‡Œå¯ä»¥å­˜æ”¾å¤šä¸ªæ•°æ®ã€‚</li><li class="lvl-6">åŒä¸€ä¸ªæ¡¶ä¸­å­˜æ”¾çš„æ•°æ®è¶Šå¤šï¼Œç©ºé—´åˆ©ç”¨ç‡æ›´é«˜ï¼Œç›¸åº”çš„è¯¯åˆ¤ç‡ä¹Ÿå°±è¶Šé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´æ…¢ã€‚</li><li class="lvl-6">Redisçš„CuckooFilterå®ç°ä¸­ï¼ŒBUSKETSIZEåº”è¯¥æ˜¯ä¸€ä¸ªåœ¨1åˆ°255ä¹‹é—´çš„æ•´æ•°ï¼Œé»˜è®¤çš„ BUSKETSIZE æ˜¯ <code>2</code>ã€‚</li><li class="lvl-6">æ¡¶(Busket)ä¸­å¹¶ä¸å®é™…ä¿å­˜æ•°æ®æœ¬èº«ï¼Œè€Œæ˜¯ä¿å­˜æ•°æ®çš„æŒ‡çº¹(fingerprint)ã€‚æŒ‡çº¹è¶Šå°ï¼ŒHASHå†²çªé€ æˆè¯¯åˆ¤çš„å‡ ç‡å°±è¶Šå°ã€‚è¿™ä¸ªå‚æ•°çš„è°ƒæ•´æ¯”è¾ƒå¤æ‚ï¼ŒRedisçš„CuckooFilterä¸­ä¸æ”¯æŒè°ƒæ•´è¿™ä¸ªå‚æ•°ã€‚</li></ul></li></ul><h2 id="CF-å‘½ä»¤è¯´æ˜">CF å‘½ä»¤è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p>å¯¹åº”Rediså‘½ä»¤ï¼š <code>CF.xxx</code></p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th><th>æ˜¯å¦åˆ›å»º Filter</th><th>å…³é”®å‚æ•°å«ä¹‰</th><th>è¿”å›å€¼</th><th>ç¤ºä¾‹</th><th>ä½¿ç”¨è¦ç‚¹ / å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>CF.RESERVE</strong></td><td>æ˜¾å¼åˆ›å»º Cuckoo Filter</td><td>æ˜¯</td><td><code>capacity</code>ï¼šå®¹é‡(å¿…å¡«)<br><code>BUCKETSIZE</code>ï¼šæ¯ä¸ªæ¡¶é‡Œæœ€å¤šèƒ½æ”¾å¤šå°‘ä¸ª fingerprintï¼ˆæŒ‡çº¹ï¼‰ï¼Œé»˜è®¤ 2(å¤§å¤šæ•°æƒ…å†µä¸‹çš„æœ€ä¼˜è§£)<br><code>MAXITERATIONS</code>ï¼šé‡æ’æ¬¡æ•°ï¼Œè¶Šå¤§æˆåŠŸç‡è¶Šé«˜<br><code>EXPANSION</code>ï¼šæ‰©å®¹å€æ•°ï¼Œé»˜è®¤ 1ï¼ˆä¸æ‰©å®¹ï¼‰</td><td>OK</td><td><code>CF.RESERVE user:cf 100000</code></td><td>âœ… <strong>ç”Ÿäº§æ¨è</strong><br>æ”¯æŒåˆ é™¤ä¸è®¡æ•°</td></tr><tr><td><strong>CF.ADD</strong></td><td>æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œä¸å»é‡</td><td>æ˜¯ ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</td><td><code>item</code>ï¼šå…ƒç´ </td><td>OK</td><td><code>CF.ADD user:cf user_1</code></td><td>è‹¥æ»¡å¯èƒ½å¤±è´¥</td></tr><tr><td><strong>CF.ADDNX</strong></td><td>å…ƒç´ ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ ï¼Œå»é‡</td><td>æ˜¯ ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</td><td><code>item</code></td><td><code>1</code> æ–°å¢<br><code>0</code> å·²å­˜åœ¨</td><td><code>CF.ADDNX user:cf user_1</code></td><td>å¹‚ç­‰å†™å…¥é¦–é€‰</td></tr><tr><td><strong>CF.INSERT</strong></td><td>æ‰¹é‡æ’å…¥</td><td>æ˜¯ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</td><td><code>ITEMS</code>ï¼šå…ƒç´ åˆ—è¡¨</td><td>OK</td><td><code>CF.INSERT user:cf ITEMS u1 u2</code></td><td>é»˜è®¤é…ç½®</td></tr><tr><td><strong>CF.INSERTNX</strong></td><td>æ‰¹é‡æ’å…¥ï¼ˆä¸å­˜åœ¨æ‰åŠ ï¼‰</td><td>æ˜¯</td><td><code>ITEMS</code></td><td><code>0/1</code> åˆ—è¡¨</td><td><code>CF.INSERTNX user:cf ITEMS u1 u2</code></td><td>å¹‚ç­‰ + æ‰¹é‡</td></tr><tr><td><strong>CF.EXISTS</strong></td><td>åˆ¤æ–­å•ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</td><td>å¦</td><td><code>item</code></td><td><code>1</code> å¯èƒ½å­˜åœ¨<br><code>0</code> ä¸å­˜åœ¨</td><td><code>CF.EXISTS user:cf user_1</code></td><td>ä»æœ‰è¯¯åˆ¤</td></tr><tr><td><strong>CF.MEXISTS</strong></td><td>æ‰¹é‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨</td><td>å¦</td><td><code>item...</code></td><td><code>0/1</code> åˆ—è¡¨</td><td><code>CF.MEXISTS user:cf u1 u9</code></td><td>é«˜å¹¶å‘æ¨è</td></tr><tr><td><strong>CF.COUNT</strong></td><td>è¿”å›å…ƒç´ å‡ºç°æ¬¡æ•°</td><td>å¦</td><td><code>item</code></td><td>æ•´æ•°</td><td><code>CF.COUNT user:cf user_1</code></td><td>â­ Bloom æ²¡æœ‰çš„èƒ½åŠ›</td></tr><tr><td><strong>CF.DEL</strong></td><td>åˆ é™¤ä¸€ä¸ªå…ƒç´ </td><td>å¦</td><td><code>item</code></td><td><code>1</code> åˆ é™¤æˆåŠŸ<br><code>0</code> ä¸å­˜åœ¨</td><td><code>CF.DEL user:cf user_1</code></td><td>â­ Bloom ä¸æ”¯æŒ</td></tr><tr><td><strong><a href="http://CF.INFO">CF.INFO</a></strong></td><td>æŸ¥çœ‹ Filter å…ƒä¿¡æ¯</td><td>å¦</td><td>æ— </td><td>KV åˆ—è¡¨</td><td><code>CF.INFO user:cf</code></td><td>è¿ç»´åˆ†æ</td></tr><tr><td><strong>CF.SCANDUMP</strong></td><td>åˆ†å—å¯¼å‡º Filter</td><td>å¦</td><td><code>iterator</code></td><td><code>iterator + data</code></td><td><code>CF.SCANDUMP user:cf 0</code></td><td>è¿ç§» / å¤‡ä»½</td></tr><tr><td><strong>CF.LOADCHUNK</strong></td><td>ä» dump æ¢å¤ Filter</td><td>æ˜¯</td><td><code>iterator + data</code></td><td>OK</td><td><code>CF.LOADCHUNK user:cf 1 &quot;xxx&quot;</code></td><td>ä¸ SCANDUMP é…åˆ</td></tr></tbody></table><h2 id="Bloom-vs-Cuckoo">Bloom vs Cuckoo</h2><table><thead><tr><th>ç»´åº¦</th><th>Bloom Filter</th><th>Cuckoo Filter</th></tr></thead><tbody><tr><td>æŸ¥è¯¢å¤æ‚åº¦</td><td>O(k)ï¼ˆk ä¸ªå“ˆå¸Œå‡½æ•°ï¼‰</td><td>O(1)ï¼ˆ2â€“4 æ¬¡ bucket è®¿é—®ï¼‰</td></tr><tr><td>æ’å…¥å¤æ‚åº¦</td><td>O(k)</td><td>å¹³å‡ O(1)ï¼Œæœ€åå¯èƒ½è§¦å‘é‡æ’</td></tr><tr><td>åˆ é™¤æ”¯æŒ</td><td>âŒ åŸç”Ÿä¸æ”¯æŒ</td><td>âœ… åŸç”Ÿæ”¯æŒ</td></tr><tr><td>è¯¯åˆ¤ç‡ï¼ˆFalse Positiveï¼‰</td><td>å¯é…ç½®ï¼Œç¨³å®š</td><td>å¯é…ç½®ï¼Œé€šå¸¸æ›´ä½</td></tr><tr><td>æ¼åˆ¤ï¼ˆFalse Negativeï¼‰</td><td>âŒ ç†è®ºä¸Šä¸ä¼š</td><td>âŒ ç†è®ºä¸Šä¸ä¼š</td></tr><tr><td>ç©ºé—´åˆ©ç”¨ç‡</td><td>é«˜ï¼ˆä½†å— k å½±å“ï¼‰</td><td>é€šå¸¸æ›´é«˜ï¼ˆç‰¹åˆ«æ˜¯ä½è¯¯åˆ¤ç‡ï¼‰</td></tr><tr><td>æ‰©å®¹æˆæœ¬</td><td>é«˜ï¼ˆéœ€é‡å»ºï¼‰</td><td>ä¸­ç­‰ï¼ˆæ”¯æŒæ‰©å±•ç­–ç•¥ï¼‰</td></tr><tr><td>å®ç°å¤æ‚åº¦</td><td>ä½</td><td>è¾ƒé«˜</td></tr></tbody></table><blockquote><p>RedisBloom Cuckoo Filter ä¸æ”¯æŒè®¾ç½® <code>è¯¯åˆ¤ç‡</code>ï¼Œé€šå¸¸ å®¹é‡ è¶Šå¤§ï¼Œè¯¯åˆ¤ç‡è¶Šä½ã€‚</p></blockquote><h2 id="CF-å‘½ä»¤ç¤ºä¾‹">CF å‘½ä»¤ç¤ºä¾‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º Cuckoo Filter</span></span><br><span class="line"><span class="comment">## å®¹é‡1000ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«å‚æ•°ã€‚åé¢å‡ ä¸ªéƒ½æ˜¯å¯é€‰å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">## BUSKETSIZEè¶Šå¤§ï¼Œç©ºé—´åˆ©ç”¨ç‡æ›´é«˜ï¼Œä½†æ˜¯è¯¯åˆ¤ç‡ä¹Ÿæ›´é«˜ï¼Œæ€§èƒ½æ›´å·®ï¼Œé»˜è®¤2</span></span><br><span class="line"><span class="comment">## MAXITARATIONSè¶Šå°ï¼Œæ€§èƒ½è¶Šå¥½ã€‚å¦‚æœè®¾ç½®è¶Šå¤§ï¼Œç©ºé—´åˆ©ç”¨ç‡å°±è¶Šå¥½ã€‚é»˜è®¤20</span></span><br><span class="line"><span class="comment">## EXPANSION æ˜¯æŒ‡ç©ºé—´æ‰©å®¹çš„æ¯”ä¾‹ã€‚é»˜è®¤1ï¼Œä¸æ‰©å®¹</span></span><br><span class="line">127.0.0.1:6379&gt; CF.RESERVE user:cf 1000 BUCKETSIZE 2 MAXITERATIONS 500 EXPANSION 2</span><br><span class="line">OK</span><br><span class="line"><span class="comment"># æ·»åŠ å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; CF.ADD user:cf user_1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; CF.ADD user:cf user_2</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># å¯ä»¥é‡å¤æ·»åŠ å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; CF.ADD user:cf user_1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># è¿”å›å…ƒç´ å‡ºç°æ¬¡æ•°</span></span><br><span class="line">127.0.0.1:6379&gt; CF.COUNT user:cf user_1</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"><span class="comment"># åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">127.0.0.1:6379&gt; CF.EXISTS user:cf user_1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># æ‰¹é‡åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">127.0.0.1:6379&gt; CF.MEXISTS user:cf user_1 user_2 user_100</span><br><span class="line">1) (<span class="built_in">integer</span>) 1</span><br><span class="line">2) (<span class="built_in">integer</span>) 1</span><br><span class="line">3) (<span class="built_in">integer</span>) 0</span><br><span class="line"><span class="comment"># åˆ é™¤å…ƒç´ ï¼Œä¸€æ¬¡åªåˆ é™¤ä¸€ä¸ª</span></span><br><span class="line">127.0.0.1:6379&gt; CF.DEL user:cf user_1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># å› ä¸ºuser_1æœ‰ä¸¤ä¸ªï¼Œæ‰€ä»¥æ‰æ˜¯è¿˜æ˜¯èƒ½æŸ¥è¯¢å‡º user_1</span></span><br><span class="line">127.0.0.1:6379&gt; CF.COUNT user:cf user_1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># å†æ¬¡åˆ é™¤</span></span><br><span class="line">127.0.0.1:6379&gt; CF.DEL user:cf user_1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># åŒåå…ƒç´ å·²å…¨éƒ¨åˆ é™¤ï¼ŒæŸ¥è¯¢ä¸åˆ°</span></span><br><span class="line">127.0.0.1:6379&gt; CF.COUNT user:cf user_1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ƒç´ ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ ï¼Œå¹‚ç­‰</span></span><br><span class="line">127.0.0.1:6379&gt; CF.ADDNX user:cf user_2</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; CF.ADDNX user:cf user_3</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ Filter å…ƒä¿¡æ¯</span></span><br><span class="line">127.0.0.1:6379&gt; CF.INFO user:cf</span><br><span class="line"> 1) Size                      <span class="comment"># å½“å‰ Cuckoo Filter å®é™…å ç”¨çš„å†…å­˜å¤§å°ï¼ˆå­—èŠ‚ï¼‰</span></span><br><span class="line"> 2) (<span class="built_in">integer</span>) 1080</span><br><span class="line"> 3) Number of buckets         <span class="comment"># å½“å‰è¿‡æ»¤å™¨ä¸­ bucketï¼ˆæ¡¶ï¼‰çš„æ€»æ•°é‡ï¼ŒSize = Number of buckets * Bucket size(é»˜è®¤ä¸º2)</span></span><br><span class="line"> 4) (<span class="built_in">integer</span>) 512</span><br><span class="line"> 5) Number of filters         <span class="comment"># å†…éƒ¨ å­ Cuckoo Filter çš„æ•°é‡</span></span><br><span class="line"> 6) (<span class="built_in">integer</span>) 1</span><br><span class="line"> 7) Number of items inserted  <span class="comment"># æˆåŠŸæ’å…¥çš„å…ƒç´ æ€»æ•°ï¼ˆè¿‘ä¼¼ï¼‰</span></span><br><span class="line"> 8) (<span class="built_in">integer</span>) 2</span><br><span class="line"> 9) Number of items deleted   <span class="comment"># å·²åˆ é™¤å…ƒç´ çš„ç´¯è®¡æ¬¡æ•°</span></span><br><span class="line">10) (<span class="built_in">integer</span>) 2</span><br><span class="line">11) Bucket size               <span class="comment"># æ¯ä¸ª bucket å¯å®¹çº³çš„ fingerprint æ•°ï¼Œé»˜è®¤ä¸º 2</span></span><br><span class="line">12) (<span class="built_in">integer</span>) 2</span><br><span class="line">13) Expansion rate            <span class="comment"># è¿‡æ»¤å™¨è‡ªåŠ¨æ‰©å®¹å€ç‡ï¼Œé»˜è®¤ä¸º1ï¼Œ0 æˆ– 1 è¡¨ç¤ºä¸æ‰©å®¹ï¼ˆæ»¡åˆ™å¤±è´¥ï¼‰</span></span><br><span class="line">14) (<span class="built_in">integer</span>) 2</span><br><span class="line">15) Max iterations            <span class="comment"># Cuckoo Kick-out çš„æœ€å¤§é‡æ’æ¬¡æ•°ï¼Œå€¼è¶Šå¤§ï¼Œæ’å…¥æˆåŠŸç‡è¶Šé«˜ï¼Œä½†å†™å…¥å»¶è¿Ÿå¯èƒ½ä¸Šå‡</span></span><br><span class="line">16) (<span class="built_in">integer</span>) 500</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡æ·»åŠ ï¼Œkeyä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">127.0.0.1:6379&gt; CF.INSERT order:cf CAPACITY 100 ITEMS order1 order2</span><br><span class="line">1) (<span class="built_in">integer</span>) 1</span><br><span class="line">2) (<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># å¹‚ç­‰ï¼Œå…ƒç´ ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ </span></span><br><span class="line">127.0.0.1:6379&gt; CF.INSERTNX order:cf CAPACITY 100 ITEMS order1 order2 order100</span><br><span class="line">1) (<span class="built_in">integer</span>) 0</span><br><span class="line">2) (<span class="built_in">integer</span>) 0</span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç±»å‹</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> order:cf</span><br><span class="line">MBbloomCF</span><br></pre></td></tr></table></figure><h2 id="SpringBoot-é›†æˆ">SpringBoot é›†æˆ</h2><ul class="lvl-0"><li class="lvl-2"><p>SpringBoot çš„ RedisTemplate ä¸­æ²¡æœ‰æä¾›å¯¹<code>RedisBloom</code>çš„å°è£…ï¼Œéœ€è¦è‡ªå·±å°è£…ï¼Œæˆ‘è¿™é‡Œå°è£…äº†ä¸€ä¸ªç®€æ˜“çš„<code>RedisCuckooFilterTool</code></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.redisbloom;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºäº RedisBloom æ’ä»¶çš„ CuckooFilter å®ç°</span></span><br><span class="line"><span class="comment"> * https://github.com/RedisBloom/RedisBloom/releases</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCuckooFilterTool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisCuckooFilterTool</span><span class="params">(StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ– Cuckoo Filter</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * ä¸èƒ½é‡å¤åˆ›å»º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key      Filter åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> capacity é¢„è®¡å®¹é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">reserve</span><span class="params">(String key, <span class="type">long</span> capacity)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;CF.RESERVE&#x27;, KEYS[1], &quot;</span> + capacity + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            redisTemplate.execute(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, String.class),</span><br><span class="line">                    Collections.singletonList(key)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;RedisCuckooFilterTool reserve error:&quot;</span>,e);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ– Cuckoo Filterï¼ˆé«˜çº§å‚æ•°ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ä¸èƒ½é‡å¤åˆ›å»º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key           Filter åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> capacity      é¢„è®¡å®¹é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bucketSize    æ¯ä¸ªæ¡¶é‡Œæœ€å¤šèƒ½æ”¾å¤šå°‘ä¸ª fingerprintï¼ˆæŒ‡çº¹ï¼‰ï¼Œé»˜è®¤ 2(å¤§å¤šæ•°æƒ…å†µä¸‹çš„æœ€ä¼˜è§£)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> maxIterations é‡æ’æ¬¡æ•°ï¼Œè¶Šå¤§æˆåŠŸç‡è¶Šé«˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expansion     æ‰©å®¹å€æ•°ï¼Œé»˜è®¤ 1ï¼ˆä¸æ‰©å®¹ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">reserve</span><span class="params">(String key, <span class="type">long</span> capacity, <span class="type">int</span> bucketSize, <span class="type">int</span> maxIterations, <span class="type">int</span> expansion)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> String.format(</span><br><span class="line">                <span class="string">&quot;return redis.call(&#x27;CF.RESERVE&#x27;, KEYS[1], %d, &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&#x27;BUCKETSIZE&#x27;, %d, &#x27;MAXITERATIONS&#x27;, %d, &#x27;EXPANSION&#x27;, %d)&quot;</span>,</span><br><span class="line">                capacity, bucketSize, maxIterations, expansion</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            redisTemplate.execute(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, String.class),</span><br><span class="line">                    Collections.singletonList(key)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;RedisCuckooFilterTool reserve error:&quot;</span>,e);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ å…ƒç´ ï¼ˆä¸å»é‡ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;CF.ADD&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Boolean</span> <span class="variable">execute</span> <span class="operator">=</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, Boolean.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                value</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> Boolean.TRUE.equals(execute);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ å…ƒç´ ï¼ˆä»…å½“ä¸å­˜åœ¨æ—¶ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true è¡¨ç¤ºæˆåŠŸæ’å…¥ï¼Œfalse è¡¨ç¤ºå·²å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">addNx</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;CF.ADDNX&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Boolean</span> <span class="variable">execute</span> <span class="operator">=</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, Boolean.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                value</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> Boolean.TRUE.equals(execute);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">exists</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;CF.EXISTS&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Boolean</span> <span class="variable">execute</span> <span class="operator">=</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, Boolean.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                value</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> Boolean.TRUE.equals(execute);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ¯ä¸ªå…ƒç´ å¯¹åº”çš„ç»“æœï¼Œ1 è¡¨ç¤ºå­˜åœ¨ï¼Œ0 è¡¨ç¤ºä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Long&gt; <span class="title function_">mexists</span><span class="params">(String key, String... items)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;CF.MEXISTS&#x27;, KEYS[1], unpack(ARGV))&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (items == <span class="literal">null</span> || items.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                items</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å…ƒç´ å‡ºç°æ¬¡æ•°ï¼ˆè¿‘ä¼¼ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">count</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;CF.COUNT&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, Long.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                value</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true åˆ é™¤æˆåŠŸï¼Œfalse è¡¨ç¤ºä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">delete</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;CF.DEL&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Long</span> <span class="variable">execute</span> <span class="operator">=</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, Long.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                value</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> Boolean.TRUE.equals(execute);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ’å…¥ï¼Œä¸å»é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ¯ä¸ªå…ƒç´ å¯¹åº”æ’å…¥ç»“æœï¼Œ1 æ’å…¥æˆåŠŸï¼Œ0 æ’å…¥å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Long&gt; <span class="title function_">insert</span><span class="params">(String key, String... items)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;CF.INSERT&#x27;, KEYS[1], &#x27;ITEMS&#x27;, unpack(ARGV))&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (items == <span class="literal">null</span> || items.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                items</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ’å…¥ï¼Œå»é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ¯ä¸ªå…ƒç´ å¯¹åº”æ’å…¥ç»“æœï¼Œ1 æ’å…¥æˆåŠŸï¼Œ0 æ’å…¥å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Boolean&gt; <span class="title function_">insertNx</span><span class="params">(String key, String... items)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;CF.INSERTNX&#x27;, KEYS[1], &#x27;ITEMS&#x27;, unpack(ARGV))&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (items == <span class="literal">null</span> || items.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                items</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å– Cuckoo Filter å…ƒä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Long&gt; <span class="title function_">info</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;CF.INFO&#x27;, KEYS[1])&quot;</span>;</span><br><span class="line">        List&lt;Object&gt; result = redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class="line">                Collections.singletonList(key)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="literal">null</span> || result.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyMap();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Long&gt; infoMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; result.size(); i += <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">field</span> <span class="operator">=</span> toString(result.get(i));</span><br><span class="line">            <span class="type">Long</span> <span class="variable">value</span> <span class="operator">=</span> (Long) result.get(i + <span class="number">1</span>);</span><br><span class="line">            infoMap.put(field, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> infoMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­—èŠ‚æ•°ç»„è½¬å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * info è¿”å›çš„ List</span></span><br><span class="line"><span class="comment">     * [</span></span><br><span class="line"><span class="comment">     * byte[](&quot;Size&quot;),                  Long(1080),</span></span><br><span class="line"><span class="comment">     * byte[](&quot;Number of buckets&quot;),     Long(512),</span></span><br><span class="line"><span class="comment">     * byte[](&quot;Number of filters&quot;),     Long(1),</span></span><br><span class="line"><span class="comment">     * ...</span></span><br><span class="line"><span class="comment">     * ]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">toString</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="type">byte</span>[]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>((<span class="type">byte</span>[]) obj);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Cuckoo Filter æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;RedisBloom çš„å®‰è£…å‚è§ &lt;a href=&quot;/2025/12/21/redis7-module-RedisBloom/&quot; title=&quot;Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•&quot;&gt;Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/data-type-demo&quot;&gt;GitHub&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- BF(Bloom Filter)</title>
    <link href="https://blog.hanqunfeng.com/2025/12/22/redis7-datatype-11-BF/"/>
    <id>https://blog.hanqunfeng.com/2025/12/22/redis7-datatype-11-BF/</id>
    <published>2025-12-22T05:40:05.000Z</published>
    <updated>2026-01-06T10:10:11.963Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Bloom Filter æ•°æ®ç±»å‹</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li><li class="lvl-2">RedisBloom çš„å®‰è£…å‚è§ <a href="/2025/12/21/redis7-module-RedisBloom/" title="Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li><li class="lvl-2">ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/data-type-demo">GitHub</a></li></ul><span id="more"></span><h2 id="Bloom-Filter-å¸ƒéš†è¿‡æ»¤å™¨">Bloom Filter(å¸ƒéš†è¿‡æ»¤å™¨)</h2><ul class="lvl-0"><li class="lvl-2"><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§ç”¨äºå¿«é€Ÿåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨çš„ probabilistic data structureï¼ˆæ¦‚ç‡æ•°æ®ç»“æ„ï¼‰ï¼Œéå¸¸é€‚åˆæµ·é‡æ•°æ®ä¸”ä¸è¦æ±‚ç»å¯¹ç²¾ç¡®çš„åœºæ™¯ã€‚</p></li><li class="lvl-2"><p><a href="https://en.wikipedia.org/wiki/Bloom_filter">ç»´åŸºç™¾ç§‘å¯¹ Bloom Filter çš„æè¿°</a></p></li><li class="lvl-2"><p>ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ <a href="https://redisson.pro/docs/data-and-services/objects/#bloom-filter">Redissonçš„å¸ƒéš†è¿‡æ»¤å™¨</a></p></li><li class="lvl-2"><p>å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶ä½æ•°ç»„å’Œä¸€ç³»åˆ—å“ˆå¸Œå‡½æ•°æ¥ä¿å­˜å…ƒç´ ã€‚</p><ul class="lvl-2"><li class="lvl-6">ä¼˜ç‚¹: éå¸¸èŠ‚çœç©ºé—´ã€æŸ¥è¯¢å¿«</li><li class="lvl-6">ç¼ºç‚¹: æœ‰ä¸€å®šçš„è¯¯åˆ¤æ¦‚ç‡ã€æ— æ³•åˆ é™¤å…ƒç´ ã€æ— æ³•ç»™å…ƒç´ è®¡æ•°</li></ul></li><li class="lvl-2"><p>å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ä¸€ä¸ªå…ƒç´ ä¸åœ¨é›†åˆä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ è‚¯å®šä¸åœ¨é›†åˆä¸­ã€‚ä½†æ˜¯ï¼Œå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ä¸€ä¸ªå…ƒç´ åœ¨é›†åˆä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ æœ‰å¯èƒ½ä¸åœ¨é›†åˆä¸­ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/l7rGDM.png" alt=""></p></li><li class="lvl-2"><p>ä½æ•°ç»„ï¼ˆBit Arrayï¼‰ï¼šå¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨ä¸€ä¸ªé•¿åº¦å›ºå®šçš„ä½æ•°ç»„æ¥å­˜å‚¨æ•°æ®ã€‚æ¯ä¸ªä½ç½®åªå ç”¨ä¸€ä¸ªæ¯”ç‰¹ï¼ˆ0æˆ–1ï¼‰ï¼Œåˆå§‹æ—¶æ‰€æœ‰ä½éƒ½è®¾ç½®ä¸º0ã€‚ä½æ•°ç»„çš„é•¿åº¦å’Œå“ˆå¸Œå‡½æ•°çš„æ•°é‡å†³å®šäº†è¿‡æ»¤å™¨çš„è¯¯æŠ¥ç‡å’Œå®¹é‡ã€‚</p></li><li class="lvl-2"><p>å“ˆå¸Œå‡½æ•°é›†åˆï¼šå¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°éƒ½ä¼šå°†è¾“å…¥æ•°æ®æ˜ å°„åˆ°ä½æ•°ç»„çš„ä¸€ä¸ªä¸åŒä½ç½®ã€‚å“ˆå¸Œå‡½æ•°çš„é€‰æ‹©å¯¹è¿‡æ»¤å™¨çš„æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼Œç†æƒ³çš„å“ˆå¸Œå‡½æ•°åº”è¯¥å…·æœ‰è‰¯å¥½çš„æ•£åˆ—æ€§ï¼Œä½¿å¾—ä¸åŒçš„è¾“å…¥å°½å¯èƒ½å‡åŒ€åœ°æ˜ å°„åˆ°ä½æ•°ç»„çš„ä¸åŒä½ç½®ã€‚</p></li><li class="lvl-2"><p>å¦‚ä½•é™ä½è¯¯åˆ¤ç‡ï¼Ÿ</p><ul class="lvl-2"><li class="lvl-6">æ›´å¤§çš„ä½æ•°ç»„</li><li class="lvl-6">æ›´å¤šçš„å“ˆå¸Œå‡½æ•°</li></ul></li><li class="lvl-2"><p>å¾ˆå¤šäººéƒ½æ˜¯ç”¨è¿‡Googleå¼€æºçš„Guavaçš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä½†å…¶æ˜¯JVMå±‚çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œè‹¥éœ€è¦åˆ†å¸ƒå¼å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°±å¯ä»¥ä½¿ç”¨RedisBloomæä¾›çš„BF(Bloom Filter)ã€‚</p></li></ul><h2 id="BF-å‘½ä»¤è¯´æ˜">BF å‘½ä»¤è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p>å¯¹åº”Rediså‘½ä»¤ï¼š <code>BF.xxx</code></p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th><th>æ˜¯å¦åˆ›å»º Filter</th><th>å…³é”®å‚æ•°å«ä¹‰</th><th>è¿”å›å€¼</th><th>ç¤ºä¾‹</th><th>ä½¿ç”¨è¦ç‚¹ / å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>BF.RESERVE</strong></td><td>æ˜¾å¼åˆ›å»º Bloom Filter</td><td>æ˜¯ï¼ˆå·²å­˜åœ¨åˆ™æŠ¥é”™ï¼‰</td><td><code>error_rate</code>ï¼šè¯¯åˆ¤ç‡<br><code>capacity</code>ï¼šé¢„è®¡å…ƒç´ æ•°<br><code>EXPANSION</code>ï¼šæ‰©å®¹å€ç‡</td><td>OK</td><td><code>BF.RESERVE user:bf 0.001 1000000</code></td><td>âœ… <strong>ç”Ÿäº§æ¨è</strong><br>æ˜¾å¼è§„åˆ’å®¹é‡ä¸è¯¯åˆ¤ç‡ï¼Œé¿å…éšå¼åˆ›å»º</td></tr><tr><td><strong>BF.ADD</strong></td><td>æ·»åŠ å•ä¸ªå…ƒç´ </td><td>æ˜¯ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</td><td>æ— </td><td><code>1</code> æ–°å¢<br><code>0</code> å¯èƒ½å·²å­˜åœ¨</td><td><code>BF.ADD user:bf user_1</code></td><td>Key å¿…é¡»å·²å­˜åœ¨ï¼Œå¦åˆ™æŠ¥é”™</td></tr><tr><td><strong>BF.MADD</strong></td><td>æ‰¹é‡æ·»åŠ å…ƒç´ </td><td>æ˜¯ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</td><td><code>item...</code>ï¼šå¤šä¸ªå…ƒç´ </td><td><code>0/1</code> åˆ—è¡¨</td><td><code>BF.MADD user:bf u1 u2 u3</code></td><td>âš  ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œä¸å»ºè®®ç”Ÿäº§</td></tr><tr><td><strong>BF.INSERT</strong></td><td>æ‰¹é‡æ’å…¥ï¼ˆå¯æ§å‚æ•°ï¼‰</td><td>æ˜¯</td><td><code>CAPACITY</code>ï¼šå®¹é‡<br><code>ERROR</code>ï¼šè¯¯åˆ¤ç‡<br><code>NOCREATE</code>:ä¸è‡ªåŠ¨åˆ›å»ºè¿‡æ»¤å™¨<br><code>NONSCALING</code>: ä¸æ‰©å®¹ï¼Œè¾¾åˆ°capacityæ—¶ï¼Œè¿‡æ»¤å™¨è¿”å›é”™è¯¯<br><code>EXPANSION expansion</code>:æ‰©å®¹æ—¶ï¼Œæ–°å»ºå­è¿‡æ»¤å™¨çš„å®¹é‡å¢é•¿å€ç‡ï¼Œé»˜è®¤2 <br><code>ITEMS</code>ï¼šå…ƒç´ åˆ—è¡¨</td><td><code>0/1</code> åˆ—è¡¨</td><td><code>BF.INSERT user:bf CAPACITY 10000 ERROR 0.001 ITEMS u1 u2</code></td><td>âœ… <strong>æœ€æ¨èçš„å†™å…¥æ–¹å¼</strong><br>æ”¯æŒåˆå§‹åŒ– + æ’å…¥</td></tr><tr><td><strong>BF.EXISTS</strong></td><td>åˆ¤æ–­å•ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</td><td>å¦</td><td><code>item</code>ï¼šå¾…åˆ¤æ–­å…ƒç´ </td><td><code>1</code> å¯èƒ½å­˜åœ¨<br><code>0</code> ä¸€å®šä¸å­˜åœ¨</td><td><code>BF.EXISTS user:bf user_1</code></td><td>ä¸å­˜åœ¨ç»“æœ <strong>ç»å¯¹å¯é </strong></td></tr><tr><td><strong>BF.MEXISTS</strong></td><td>æ‰¹é‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨</td><td>å¦</td><td><code>item...</code>ï¼šå¤šä¸ªå…ƒç´ </td><td><code>0/1</code> åˆ—è¡¨</td><td><code>BF.MEXISTS user:bf u1 u9</code></td><td>é«˜å¹¶å‘æ‰¹é‡æŸ¥è¯¢é¦–é€‰</td></tr><tr><td><strong>BF.CARD</strong></td><td>è¿”å›æ’å…¥å…ƒç´ æ•°é‡ï¼ˆè¿‘ä¼¼ï¼‰</td><td>å¦</td><td>æ— </td><td>æ•´æ•°</td><td><code>BF.CARD user:bf</code></td><td>ç”¨äºå®¹é‡ç›‘æ§ï¼Œéç²¾ç¡®</td></tr><tr><td><strong><a href="http://BF.INFO">BF.INFO</a></strong></td><td>è¿”å› Bloom Filter å…ƒä¿¡æ¯</td><td>å¦</td><td>æ— </td><td>KV åˆ—è¡¨</td><td><code>BF.INFO user:bf</code></td><td>è¿ç»´ã€å®¹é‡ä¸å†…å­˜åˆ†æå¿…å¤‡</td></tr><tr><td><strong>BF.SCANDUMP</strong></td><td>åˆ†å—å¯¼å‡º Bloom Filter</td><td>å¦</td><td><code>iterator</code>ï¼šæ¸¸æ ‡</td><td><code>iterator + data</code></td><td><code>BF.SCANDUMP user:bf 0</code></td><td>ç”¨äºè¿ç§»ã€å¤‡ä»½</td></tr><tr><td><strong>BF.LOADCHUNK</strong></td><td>ä» dump æ•°æ®æ¢å¤ Filter</td><td>æ˜¯</td><td><code>iterator</code><br><code>data</code></td><td>OK</td><td><code>BF.LOADCHUNK user:bf 1 &quot;xxx&quot;</code></td><td>å¿…é¡»ä¸ SCANDUMP é…åˆä½¿ç”¨</td></tr></tbody></table><h2 id="BF-å‘½ä»¤ç¤ºä¾‹">BF å‘½ä»¤ç¤ºä¾‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªBloomFilterï¼Œé”™è¯¯ç‡0.01ï¼Œå…ƒç´ æ•°é‡1000</span></span><br><span class="line">127.0.0.1:6379&gt; BF.RESERVE <span class="built_in">test</span> 0.01 1000</span><br><span class="line">OK</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç±»å‹</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> <span class="built_in">test</span></span><br><span class="line">MBbloom--</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; BF.ADD <span class="built_in">test</span> user1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; BF.ADD <span class="built_in">test</span> user2</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># æ‰¹é‡æ·»åŠ å…ƒç´ </span></span><br><span class="line">127.0.0.1:6379&gt; BF.MADD <span class="built_in">test</span> user3 user4 user5</span><br><span class="line">1) (<span class="built_in">integer</span>) 1</span><br><span class="line">2) (<span class="built_in">integer</span>) 1</span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># è¿”å›Bloomè¿‡æ»¤å™¨çš„åŸºæ•°ï¼Œå³æ·»åŠ çš„å…ƒç´ æ•°é‡(å­˜åœ¨è¯¯å·®)</span></span><br><span class="line">127.0.0.1:6379&gt; BF.CARD <span class="built_in">test</span></span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line"><span class="comment"># æŸ¥è¯¢å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">127.0.0.1:6379&gt; BF.EXISTS <span class="built_in">test</span> user2</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; BF.EXISTS <span class="built_in">test</span> user6</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"><span class="comment"># æ‰¹é‡æŸ¥è¯¢å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">127.0.0.1:6379&gt; BF.MEXISTS <span class="built_in">test</span> user1 user2 user6</span><br><span class="line">1) (<span class="built_in">integer</span>) 1</span><br><span class="line">2) (<span class="built_in">integer</span>) 1</span><br><span class="line">3) (<span class="built_in">integer</span>) 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ä¿¡æ¯</span></span><br><span class="line">127.0.0.1:6379&gt; BF.INFO <span class="built_in">test</span></span><br><span class="line"> 1) Capacity       <span class="comment"># åˆå§‹åŒ–æ—¶çš„å®¹é‡ï¼Œè¶…è¿‡è¯¥å€¼åï¼Œä¼šè§¦å‘ æ‰©å®¹ï¼ˆæ–°å»ºä¸€ä¸ªå­ Bloom Filterï¼‰</span></span><br><span class="line"> 2) (<span class="built_in">integer</span>) 1000</span><br><span class="line"> 3) Size           <span class="comment"># å½“å‰ Bloom Filter å®é™…ä½¿ç”¨çš„ bit array å¤§å°ï¼ˆå­—èŠ‚)ï¼Œç”± capacity + error_rate è®¡ç®—å¾—å‡ºï¼Œå€¼ä¸€æ—¦åˆ›å»º ä¸ä¼šéšå…ƒç´ å‡å°‘</span></span><br><span class="line"> 4) (<span class="built_in">integer</span>) 1480</span><br><span class="line"> 5) Number of filters <span class="comment"># å½“å‰ key å†…éƒ¨åŒ…å«çš„ Bloom Filter æ•°é‡</span></span><br><span class="line"> 6) (<span class="built_in">integer</span>) 1</span><br><span class="line"> 7) Number of items inserted  <span class="comment"># å·²è°ƒç”¨ BF.ADD / BF.MADD æ’å…¥çš„å…ƒç´ æ€»æ•°</span></span><br><span class="line"> 8) (<span class="built_in">integer</span>) 5</span><br><span class="line"> 9) Expansion rate     <span class="comment"># Bloom Filter æ‰©å®¹æ—¶ï¼Œæ–°å»ºå­è¿‡æ»¤å™¨çš„å®¹é‡å¢é•¿å€ç‡</span></span><br><span class="line">10) (<span class="built_in">integer</span>) 2</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="SpringBoot-é›†æˆ">SpringBoot é›†æˆ</h2><ul class="lvl-0"><li class="lvl-2"><p>SpringBoot çš„ RedisTemplate ä¸­æ²¡æœ‰æä¾›å¯¹<code>RedisBloom</code>çš„å°è£…ï¼Œéœ€è¦è‡ªå·±å°è£…ï¼Œæˆ‘è¿™é‡Œå°è£…äº†ä¸€ä¸ªç®€æ˜“çš„<code>RedisBloomFilterTool</code></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.redisbloom;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºäº RedisBloom æ’ä»¶çš„ BloomFilter å®ç°</span></span><br><span class="line"><span class="comment"> * https://github.com/RedisBloom/RedisBloom/releases</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ä¸æƒ³å®‰è£…æ’ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ Redission çš„ BloomFilter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisBloomFilterTool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisBloomFilterTool</span><span class="params">(StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ– BloomFilter</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * ä¸èƒ½é‡å¤åˆ›å»º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key       BloomFilter åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> errorRate é”™è¯¯ç‡ï¼Œæ¯”å¦‚ä¸º0.01ï¼Œå³ 1%</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> capacity  å®¹é‡ï¼Œæ¯”å¦‚ä¸º1000</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">reserve</span><span class="params">(String key, <span class="type">double</span> errorRate, <span class="type">long</span> capacity)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;BF.RESERVE&#x27;, KEYS[1], &quot;</span> + errorRate + <span class="string">&quot;, &quot;</span> + capacity + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.execute(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, String.class),</span><br><span class="line">                    Collections.singletonList(key)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;RedisBloomFilterTool reserve error:&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ å…ƒç´ åˆ° BloomFilterï¼ŒBloomFilter ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ RedisModule æä¾›çš„ BF.ADD å‘½ä»¤</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;BF.ADD&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Boolean</span> <span class="variable">execute</span> <span class="operator">=</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, Boolean.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                value</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> Boolean.TRUE.equals(execute);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">exists</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;BF.EXISTS&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Boolean</span> <span class="variable">execute</span> <span class="operator">=</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, Boolean.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                value</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> Boolean.TRUE.equals(execute);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ·»åŠ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ·»åŠ ç»“æœåˆ—è¡¨ï¼ŒæˆåŠŸ 1ï¼Œå¤±è´¥ 0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Long&gt; <span class="title function_">addBatch</span><span class="params">(String key, String... items)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;BF.MADD&#x27;, KEYS[1], unpack(ARGV))&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (items == <span class="literal">null</span> || items.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ BF.MADD å‘½ä»¤</span></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                items</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ·»åŠ ï¼Œå¦‚æœBloomFilterä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ®å‚æ•°åˆ›å»º BloomFilterï¼Œè‹¥å·²å­˜åœ¨ï¼Œåˆ™å¿½ç•¥ capacity å’Œ errorRate</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key       BloomFilter åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> capacity  å®¹é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> errorRate é”™è¯¯ç‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> items     è¦æ·»åŠ çš„å…ƒç´ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ·»åŠ ç»“æœåˆ—è¡¨ï¼ŒæˆåŠŸ 1ï¼Œå¤±è´¥ 0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Long&gt; <span class="title function_">insert</span><span class="params">(String key, <span class="type">long</span> capacity, <span class="type">double</span> errorRate, String... items)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;BF.INSERT&#x27;, KEYS[1], &#x27;CAPACITY&#x27;, ARGV[1], &#x27;ERROR&#x27;, ARGV[2], &#x27;ITEMS&#x27;, unpack(ARGV, 3))&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (items == <span class="literal">null</span> || items.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;Object&gt; args = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        args.add(String.valueOf(capacity));</span><br><span class="line">        args.add(String.valueOf(errorRate));</span><br><span class="line">        Collections.addAll(args, items);   <span class="comment">// âœ… å…³é”®ç‚¹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨ BF.INSERT å‘½ä»¤</span></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                args.toArray()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å­˜åœ¨ 1ï¼Œä¸å­˜åœ¨ 0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Long&gt; <span class="title function_">mexists</span><span class="params">(String key, String... items)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;BF.MEXISTS&#x27;, KEYS[1], unpack(ARGV))&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (items == <span class="literal">null</span> || items.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨ BF.MADD å‘½ä»¤</span></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class="line">                Collections.singletonList(key),</span><br><span class="line">                items</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å…ƒç´ æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">card</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;BF.CARD&#x27;, KEYS[1])&quot;</span>;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ RedisModule æä¾›çš„ BF.CARD å‘½ä»¤</span></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, Long.class),</span><br><span class="line">                Collections.singletonList(key)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å– Bloom Filter å…ƒä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Long&gt; <span class="title function_">info</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;BF.INFO&#x27;, KEYS[1])&quot;</span>;</span><br><span class="line"></span><br><span class="line">        List&lt;Object&gt; result = redisTemplate.execute(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class="line">                Collections.singletonList(key)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="literal">null</span> || result.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyMap();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Long&gt; infoMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; result.size(); i += <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">field</span> <span class="operator">=</span> toString(result.get(i));</span><br><span class="line">            <span class="type">Long</span> <span class="variable">value</span> <span class="operator">=</span> (Long) result.get(i + <span class="number">1</span>);</span><br><span class="line">            infoMap.put(field, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> infoMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">toString</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="type">byte</span>[]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>((<span class="type">byte</span>[]) obj);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SpringBoot-ä¸-Redisson-é›†æˆä¹‹-BloomFilter-çš„ä½¿ç”¨æ–¹æ³•">SpringBoot ä¸ Redisson é›†æˆä¹‹ BloomFilter çš„ä½¿ç”¨æ–¹æ³•</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.52.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">RBloomFilter&lt;Object&gt; bloomFilter = redissonClient.getBloomFilter(<span class="string">&quot;bloomFilter&quot;</span>);</span><br><span class="line">bloomFilter.tryInit(<span class="number">1000000</span>, <span class="number">0.01</span>); <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">bloomFilter.add(<span class="string">&quot;test&quot;</span>); <span class="comment">// æ·»åŠ å…ƒç´ </span></span><br><span class="line">System.out.println(bloomFilter.contains(<span class="string">&quot;test&quot;</span>)); <span class="comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">System.out.println(bloomFilter.count()); <span class="comment">// è·å–å½“å‰å¸ƒéš†è¿‡æ»¤å™¨ä¸­å·²æ·»åŠ çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">System.out.println(bloomFilter.getSize()); <span class="comment">// è·å–å½“å‰å¸ƒéš†è¿‡æ»¤å™¨å ç”¨å†…å­˜çš„å¤§å°ï¼Œå•ä½bit</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Bloom Filter æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;RedisBloom çš„å®‰è£…å‚è§ &lt;a href=&quot;/2025/12/21/redis7-module-RedisBloom/&quot; title=&quot;Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•&quot;&gt;Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;ç¤ºä¾‹ä»£ç ï¼š&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/data-type-demo&quot;&gt;GitHub&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</title>
    <link href="https://blog.hanqunfeng.com/2025/12/21/redis7-module-RedisBloom/"/>
    <id>https://blog.hanqunfeng.com/2025/12/21/redis7-module-RedisBloom/</id>
    <published>2025-12-21T13:30:05.000Z</published>
    <updated>2026-01-05T02:00:34.824Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisBloom çš„å®‰è£…æ–¹æ³•</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li></ul><span id="more"></span><h2 id="RedisBloom-ç®€ä»‹">RedisBloom ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/RedisBloom/RedisBloom">RedisBloom</a> æ˜¯ Redis å®˜æ–¹ç»´æŠ¤çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œéš¶å±äº <code>Redis Stack</code>ï¼Œä¸“é—¨ç”¨äºæä¾›æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼ˆProbabilistic Data Structuresï¼‰çš„é«˜æ€§èƒ½å®ç°ã€‚</p></li><li class="lvl-2"><p>å®ƒé€šè¿‡ç‰ºç‰²ä¸€å®šçš„ç²¾ç¡®æ€§ï¼Œæ¢å–æä½çš„å†…å­˜å ç”¨å’Œæé«˜çš„ååèƒ½åŠ›ï¼Œéå¸¸é€‚åˆæµ·é‡æ•°æ®åœºæ™¯ä¸‹çš„â€œå­˜åœ¨æ€§åˆ¤æ–­â€å’Œâ€œè¿‘ä¼¼ç»Ÿè®¡â€ã€‚</p></li><li class="lvl-2"><p>è¯¥æ¨¡å—ä»¥ <code>Redis Module</code> æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚</p></li><li class="lvl-2"><p>Redis8+ï¼ŒRedisBloom å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚</p></li></ul><h2 id="RedisBloom-æä¾›çš„æ ¸å¿ƒæ•°æ®ç»“æ„">RedisBloom æä¾›çš„æ ¸å¿ƒæ•°æ®ç»“æ„</h2><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…å¥½RedisBloomåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æŸ¥çœ‹RedisBloom æ”¯æŒçš„å‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®é™…ä¸Šæ‰€æœ‰ Stack Module Commandséƒ½æ˜¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼Œå› ä¸ºæˆ‘ä»¬è¿™é‡Œåªå®‰è£…äº† RedisBloomï¼Œæ‰€ä»¥æ­¤æ—¶ä»…å¯ä»¥çœ‹åˆ° RedisBloom æ¨¡å—çš„å‘½ä»¤</span></span><br><span class="line">&gt; <span class="built_in">help</span> @module</span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡è¾“å‡ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°-RedisBloom-æ¨¡å—æ”¯æŒçš„å‘½ä»¤å¤§è‡´åˆ†ä¸º-5-ç±»">é€šè¿‡è¾“å‡ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ° RedisBloom æ¨¡å—æ”¯æŒçš„å‘½ä»¤å¤§è‡´åˆ†ä¸º 5 ç±»</h3><ul class="lvl-0"><li class="lvl-2"><p>1ï¸âƒ£ Bloom Filterï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰</p><ul class="lvl-2"><li class="lvl-6">åˆ¤æ–­æŸä¸ªå…ƒç´ â€œå¯èƒ½å­˜åœ¨ / ä¸€å®šä¸å­˜åœ¨â€ï¼Œä½†ä¸å­˜å‚¨å…ƒç´ æœ¬èº«ï¼Œä¹Ÿä¸æ”¯æŒåˆ é™¤</li><li class="lvl-6"><a href="https://en.wikipedia.org/wiki/Bloom_filter">ç»´åŸºç™¾ç§‘å¯¹ Bloom Filter çš„æè¿°</a></li><li class="lvl-6">ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ <a href="https://redisson.pro/docs/data-and-services/objects/#bloom-filter">Redissonçš„å¸ƒéš†è¿‡æ»¤å™¨</a></li><li class="lvl-6">å¯¹åº”Rediså‘½ä»¤ï¼š <code>BF.xxx</code>ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ <a href="/2025/12/22/redis7-datatype-11-BF/" title="Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- BF(Bloom Filter)">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- BF(Bloom Filter)</a></li></ul></li><li class="lvl-2"><p>2ï¸âƒ£ Cuckoo Filterï¼ˆå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼‰</p><ul class="lvl-2"><li class="lvl-6">Bloom Filter çš„å¢å¼ºç‰ˆï¼Œæ”¯æŒ åˆ é™¤å…ƒç´ </li><li class="lvl-6"><a href="https://en.wikipedia.org/wiki/Cuckoo_filter">ç»´åŸºç™¾ç§‘å¯¹ Cuckoo Filter çš„æè¿°</a></li><li class="lvl-6">åœ¨é«˜ QPS æŸ¥è¯¢åœºæ™¯ä¸‹ï¼ŒCuckoo Filter é€šå¸¸ä¼˜äº Bloom Filterã€‚</li><li class="lvl-6">ä½è¯¯åˆ¤ç‡ + é«˜è´Ÿè½½ç‡åœºæ™¯ï¼ŒCuckoo Filter æ›´çœå†…å­˜ã€‚</li><li class="lvl-6">å¯¹åº”Rediså‘½ä»¤ï¼š <code>CF.xxx</code>ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ <a href="/2025/12/22/redis7-datatype-12-CF/" title="Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CF(Cuckoo Filter)">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CF(Cuckoo Filter)</a></li></ul></li><li class="lvl-2"><p>3ï¸âƒ£ Count-Min Sketchï¼ˆCMSï¼‰</p><ul class="lvl-2"><li class="lvl-6">è¿‘ä¼¼ç»Ÿè®¡å…ƒç´ å‡ºç°é¢‘ç‡</li><li class="lvl-6">å¯¹åº”Rediså‘½ä»¤ï¼š <code>CMS.xxx</code>ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ <a href="/2025/12/23/redis7-datatype-13-CMS/" title="Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch)">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch)</a></li></ul></li><li class="lvl-2"><p>4ï¸âƒ£ Top-K</p><ul class="lvl-2"><li class="lvl-6">ç»Ÿè®¡è®¿é—®é¢‘ç‡æœ€é«˜çš„ K ä¸ªå…ƒç´ </li><li class="lvl-6">å¯¹åº”Rediså‘½ä»¤ï¼š <code>TOPK.xxx</code>ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ <a href="/2025/12/23/redis7-datatype-14-TopK/" title="Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TopK">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TopK</a></li></ul></li><li class="lvl-2"><p>5ï¸âƒ£ TDigest</p><ul class="lvl-2"><li class="lvl-6">ç»Ÿè®¡æ•°å­—çš„åˆ†å¸ƒ</li><li class="lvl-6">å¯¹åº”Rediså‘½ä»¤ï¼š <code>TDIGEST.xxx</code>ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ <a href="/2025/12/23/redis7-datatype-15-TDigest/" title="Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TDigest">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TDigest</a></li></ul></li></ul><h2 id="å®‰è£…-RedisBloom">å®‰è£… RedisBloom</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä»<a href="https://cloud.redis.io">Redis Cloud</a>çš„<code>Download Center</code>ä¸­è¿›è¡Œä¸‹è½½ï¼Œå…¶æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„<code>.so</code>æ–‡ä»¶ï¼Œå¯ä»¥ä¼˜å…ˆè¿›è¡Œå°è¯•ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/rguEIA.png" alt=""></p></li><li class="lvl-2"><p>æºç ç¼–è¯‘</p></li></ul><blockquote><p>å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚<br>å¯ä»¥åœ¨æµ·å¤–çš„<code>ç›¸åŒé…ç½®</code>çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„<code>redisbloom.so</code>ä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…ä¾èµ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install -y \</span><br><span class="line">  gcc \</span><br><span class="line">  gcc-c++ \</span><br><span class="line">  make \</span><br><span class="line">  cmake \</span><br><span class="line">  autoconf \</span><br><span class="line">  automake \</span><br><span class="line">  libtool \</span><br><span class="line">  pkgconfig \</span><br><span class="line">  openssl-devel</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¼–è¯‘RedisBloom</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /usr/local/soft/modules/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/soft/modules</span><br><span class="line"><span class="comment"># clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—</span></span><br><span class="line">git <span class="built_in">clone</span> --recursive https://github.com/RedisBloom/RedisBloom.git</span><br><span class="line"><span class="built_in">cd</span> RedisBloom</span><br><span class="line"><span class="comment"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class="line">git checkout v2.8.17</span><br><span class="line"><span class="comment"># æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥</span></span><br><span class="line">git submodule update --init --recursive</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å¹¶å®‰è£…éœ€è¦çš„ä¾èµ–</span></span><br><span class="line">./sbin/setup</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="comment"># readies version: 7fc8e62</span></span><br><span class="line">dnf install -q -y ca-certificates</span><br><span class="line">dnf install -q -y wget unzip</span><br><span class="line">/usr/local/soft/modules/RedisBloom/deps/readies/bin/enable-utf8</span><br><span class="line">dnf install -q -y git jq</span><br><span class="line">dnf install -q -y <span class="built_in">which</span></span><br><span class="line">/usr/local/soft/modules/RedisBloom/deps/readies/bin/getepel</span><br><span class="line">/usr/local/soft/modules/RedisBloom/deps/readies/bin/getgcc --modern</span><br><span class="line">dnf install -q -y valgrind</span><br><span class="line">/usr/local/soft/modules/RedisBloom/sbin/get-fbinfer</span><br><span class="line">dnf install -q -y lcov</span><br><span class="line">/usr/bin/python3 /usr/local/soft/modules/RedisBloom/deps/readies/bin/getrmpytools --reinstall --modern</span><br><span class="line">/usr/bin/python3 /usr/local/soft/modules/RedisBloom/deps/readies/bin/getcmake --usr</span><br><span class="line">/usr/bin/python3 -m pip install --disable-pip-version-check --user  -r tests/flow/requirements.txt</span><br><span class="line">/usr/local/soft/modules/RedisBloom/deps/readies/bin/getaws</span><br><span class="line">/usr/bin/python3 -m pip install --disable-pip-version-check --user  pudb</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘</span></span><br><span class="line">make</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">Building /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-c/src/libtdigest_static.a ...</span><br><span class="line"></span><br><span class="line">Generating /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-c/Makefile ...</span><br><span class="line">-- The C compiler identification is GNU 11.5.0</span><br><span class="line">-- The CXX compiler identification is GNU 11.5.0</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - <span class="keyword">done</span></span><br><span class="line">-- Check <span class="keyword">for</span> working C compiler: /usr/bin/gcc - skipped</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - <span class="keyword">done</span></span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - <span class="keyword">done</span></span><br><span class="line">-- Check <span class="keyword">for</span> working CXX compiler: /usr/bin/g++ - skipped</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - <span class="keyword">done</span></span><br><span class="line">-- Setting build <span class="built_in">type</span> to <span class="string">&#x27;Release&#x27;</span> as none was specified.</span><br><span class="line">-- Configuring <span class="keyword">done</span></span><br><span class="line">-- Generating <span class="keyword">done</span></span><br><span class="line">-- Build files have been written to: /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-c</span><br><span class="line"></span><br><span class="line">Building /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-c/libtdigest_static.a ...</span><br><span class="line">[ 50%] Building C object src/CMakeFiles/tdigest_static.dir/tdigest.c.o</span><br><span class="line">[100%] Linking C static library libtdigest_static.a</span><br><span class="line">[100%] Built target tdigest_static</span><br><span class="line">Compiling deps/bloom/bloom.c...</span><br><span class="line">Compiling deps/murmur2/MurmurHash2.c...</span><br><span class="line">Compiling deps/rmutil/util.c...</span><br><span class="line">Compiling src/rebloom.c...</span><br><span class="line">Compiling src/sb.c...</span><br><span class="line">Compiling src/cf.c...</span><br><span class="line">Compiling src/rm_topk.c...</span><br><span class="line">Compiling src/rm_tdigest.c...</span><br><span class="line">Compiling src/topk.c...</span><br><span class="line">Compiling src/rm_cms.c...</span><br><span class="line">Compiling src/cms.c...</span><br><span class="line">Linking /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/redisbloom.so...</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong><code>./sbin/setup</code> æŠ¥é”™</strong></em></p><ul class="lvl-1"><li class="lvl-2">æœ¬äººä½¿ç”¨çš„æ˜¯ Amazon Linux 2023(å†…æ ¸ 6.1)ï¼Œå³ <code>EL9</code>ï¼Œç±»ä¼¼äºCentOS 9ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œä¼šæŠ¥é”™ï¼Œå¤§è‡´æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">./sbin/setup</span><br><span class="line"><span class="comment">## é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">â€¦â€¦</span><br><span class="line">[FAILED] raven-release.el9.noarch.rpm: Status code: 403 <span class="keyword">for</span> https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)</span><br><span class="line">Status code: 403 <span class="keyword">for</span> https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)</span><br><span class="line"></span><br><span class="line">In /usr/local/soft/modules/RedisBloom/deps/readies/bin/getepel:</span><br><span class="line">346      <span class="comment"># xinstall --allowerasing https://dl.fedoraproject.org/pub/epel/epel-release-latest-$&#123;EPEL&#125;.noarch.rpm</span></span><br><span class="line">347      <span class="keyword">fi</span></span><br><span class="line">348</span><br><span class="line">349  &gt;&gt;&gt; install_raven</span><br><span class="line">350      install_remi</span><br><span class="line">351      <span class="comment"># install_centos_stream_repos</span></span><br><span class="line">352</span><br><span class="line"></span><br><span class="line"><span class="built_in">command</span> failed: /usr/local/soft/modules/RedisBloom/deps/readies/bin/getepel</span><br><span class="line"></span><br><span class="line">In /usr/local/soft/modules/RedisBloom/sbin/setup:</span><br><span class="line">16       python3 -m pip list</span><br><span class="line">17       <span class="keyword">fi</span></span><br><span class="line">18</span><br><span class="line">19   &gt;&gt;&gt; <span class="variable">$ROOT</span>/sbin/system-setup.py</span><br><span class="line">20       <span class="keyword">if</span> [[ <span class="variable">$VERBOSE</span> == 1 ]]; <span class="keyword">then</span></span><br><span class="line">21       python3 -m pip list</span><br><span class="line">22       <span class="keyword">fi</span> ç¼–è¯‘å®‰è£…æ—¶æŠ¥é”™</span><br><span class="line"></span><br><span class="line"><span class="comment">## é”™è¯¯åˆ†æä¸è§£å†³æ–¹æ³•</span></span><br><span class="line">é—®é¢˜åŸå› ï¼š</span><br><span class="line">    ä½ è¿™ä¸ªé”™è¯¯ä¸æ˜¯ RedisBloom æœ¬èº«çš„ç¼–è¯‘é—®é¢˜ï¼Œè€Œæ˜¯ ä¾èµ–ç¯å¢ƒåˆå§‹åŒ–ï¼ˆreadies / getepelï¼‰é˜¶æ®µå¤±è´¥ï¼Œå¤±è´¥ç‚¹éå¸¸æ˜ç¡®ã€‚</span><br><span class="line">readies/bin/getepel è„šæœ¬åœ¨ RHEL 9 / Rocky 9 / AlmaLinux 9 ç³»ç»Ÿä¸Šå°è¯•å®‰è£… Raven Repoï¼Œä½†è¯¥ä»“åº“åœ°å€ https://dyn.su/el9/... å·²è¢« 403 Forbidden æ‹’ç»ï¼Œå¯¼è‡´è„šæœ¬ç›´æ¥å¤±è´¥å¹¶ä¸­æ–­ setupã€‚</span><br><span class="line">    è¿™ä¸æ˜¯ä½ æœºå™¨çš„é—®é¢˜ï¼Œè€Œæ˜¯ RedisBloom ä¾èµ–å·¥å…·é“¾å¯¹ EL9 çš„å…¼å®¹æ€§æ»åã€‚</span><br><span class="line">    RedisBloom çš„ ./sbin/setup ä¼šè°ƒç”¨ deps/readies/bin/getepel</span><br><span class="line">    è¿™ä¸ªè„šæœ¬ç”¨äºï¼š</span><br><span class="line">        å®‰è£… EPEL</span><br><span class="line">        å®‰è£… Raven Repoï¼ˆEL9 ç‰¹æœ‰ï¼‰</span><br><span class="line">        å®‰è£… Remi Repo</span><br><span class="line">    ä½† Raven Repo ç›®å‰å·²ä¸ç¨³å®š / ä¸å†å…¬å¼€æä¾› rpm ä¸‹è½½ï¼Œè€Œ readies ä»£ç ä»ç„¶åœ¨å¼ºåˆ¶å®‰è£…ã€‚</span><br><span class="line">    ä½ çš„ç³»ç»Ÿæ˜¯ EL9 ç³»åˆ—ï¼Œæ—¥å¿—ä¸­æ˜ç¡®ï¼šraven-release.el9.noarch.rpm</span><br><span class="line">    è¯´æ˜ä½ ä½¿ç”¨çš„å¯èƒ½æ˜¯å¦‚ä¸‹ç³»ç»Ÿä¸­çš„ä¸€ä¸ªï¼š</span><br><span class="line">        RHEL 9</span><br><span class="line">        Rocky Linux 9</span><br><span class="line">        AlmaLinux 9</span><br><span class="line">        CentOS Stream 9</span><br><span class="line"></span><br><span class="line">æ¨èè§£å†³æ–¹æ¡ˆ:</span><br><span class="line">   Raven Repo å¹¶éæ˜¯ ReidsBloom çš„å¿…è¦ä¾èµ–ï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹ getepel è„šæœ¬ï¼Œç¦ç”¨ install_raven</span><br><span class="line">   vi deps/readies/bin/getepelï¼Œæ‰¾åˆ°æ‰€æœ‰ install_ravenï¼Œå¹¶å°†å…¶æ³¨é‡Šæ‰å³å¯</span><br></pre></td></tr></table></figure></div><h2 id="Redis-å¯ç”¨æ¨¡å—">Redis å¯ç”¨æ¨¡å—</h2><ul class="lvl-0"><li class="lvl-2"><p>å°†ç”Ÿæˆçš„ <code>redisbloom.so</code> æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ .so æ–‡ä»¶éœ€è¦å…·æœ‰å¯æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">cp</span> bin/linux-x64-release/redisbloom.so /usr/local/soft/redis-7.4.7/modules/redisbloom.so</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Redis å¯ç”¨æ¨¡å—æœ‰ä¸‰ç§æ–¹æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å°† redisbloom.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class="line">loadmodule /usr/local/soft/redis-7.4.7/modules/redisbloom.so</span><br><span class="line"><span class="comment"># 2.ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼åŠ è½½æ¨¡å—</span></span><br><span class="line">redis-server --loadmodule /usr/local/soft/redis-7.4.7/modules/redisbloom.so</span><br><span class="line"><span class="comment"># 3.ä¸éœ€è¦é‡å¯redis</span></span><br><span class="line">redis-cli MODULE LOAD /usr/local/soft/redis-7.4.7/modules/redisbloom.so</span><br></pre></td></tr></table></figure><table><thead><tr><th>åŠ è½½æ–¹å¼</th><th>æ˜¯å¦æŒä¹…</th></tr></thead><tbody><tr><td><code>MODULE LOAD</code>ï¼ˆredis-cliï¼‰</td><td>âŒ ä»…å½“å‰è¿›ç¨‹</td></tr><tr><td>å‘½ä»¤è¡Œ <code>redis-server --loadmodule</code></td><td>âŒ ä»…æœ¬æ¬¡å¯åŠ¨</td></tr><tr><td><code>redis.conf</code> ä¸­ <code>loadmodule</code></td><td>âœ… <strong>æ°¸ä¹…ç”Ÿæ•ˆ</strong> ï¼ˆæ¨è/ç”Ÿäº§ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡é‡‡ç”¨ <code>loadmodule</code> åŠ è½½æ¨¡å—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°† redisbloom.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class="line">loadmodule /usr/local/soft/redis-7.4.7/modules/redisbloom.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨redis</span></span><br><span class="line">redis-server redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½•æµ‹è¯•</span></span><br><span class="line">redis-cli --user admin --pass 123456</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ¨¡å—</span></span><br><span class="line">127.0.0.1:6379&gt; info Modules</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="comment"># Modules</span></span><br><span class="line">module:name=bf,ver=20817,api=1,filters=0,usedby=[],using=[],options=[handle-io-errors]</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; MODULE LIST</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;bf&quot;</span></span><br><span class="line">   3) <span class="string">&quot;ver&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 20817</span><br><span class="line">   5) <span class="string">&quot;path&quot;</span></span><br><span class="line">   6) <span class="string">&quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot;</span></span><br><span class="line">   7) <span class="string">&quot;args&quot;</span></span><br><span class="line">   8) (empty array)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisBloom çš„å®‰è£…æ–¹æ³•&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æ“ä½œç³»ç»Ÿï¼š&lt;code&gt;Amazon Linux 2023(å†…æ ¸ 6.1)&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- Stream</title>
    <link href="https://blog.hanqunfeng.com/2025/12/20/redis7-datatype-10-stream/"/>
    <id>https://blog.hanqunfeng.com/2025/12/20/redis7-datatype-10-stream/</id>
    <published>2025-12-20T05:40:05.000Z</published>
    <updated>2025-12-20T08:35:36.054Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æœ¬æ–‡ä»‹ç» Redis Stream æ•°æ®ç±»å‹</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li><li class="lvl-2">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li></ul><span id="more"></span><h2 id="Stream-æ ¸å¿ƒè¯¦è§£">Stream æ ¸å¿ƒè¯¦è§£</h2><ul class="lvl-0"><li class="lvl-2"><p>Redis Stream æ˜¯ Redis 5.0 æ–°å¢çš„æœ‰åºã€å¯æŒä¹…åŒ–ã€æ”¯æŒå¤šæ’­çš„<code>æ¶ˆæ¯é˜Ÿåˆ—</code>ï¼Œåº•å±‚ç”¨<code>åŸºæ•°æ ‘+é“¾è¡¨</code>å®ç°ï¼Œå…¼é¡¾äº†é«˜æ•ˆæŸ¥è¯¢ä¸æœ‰åºå†™å…¥ï¼Œå®Œç¾è§£å†³äº† List é˜Ÿåˆ—ï¼ˆæ— æ³•å¤šæ’­ã€æ— æŒä¹…åŒ–ä¿éšœï¼‰ã€Pub/Subï¼ˆæ— æŒä¹…åŒ–ã€ä¸¢æ¶ˆæ¯ï¼‰çš„ç—›ç‚¹ï¼Œæ˜¯ç”Ÿäº§ç¯å¢ƒé¦–é€‰çš„ Redis æ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆã€‚</p></li><li class="lvl-2"><p>å»ºè®®ç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„ MQ æ–¹æ¡ˆï¼Œå¦‚æœä»…æ˜¯å†…éƒ¨ç³»ç»Ÿä½¿ç”¨çš„è½»é‡MQï¼Œå·²ç»æœ‰äº†redisï¼Œä½†æ˜¯ä¸æƒ³å¼•å…¥å…¶å®ƒä¸­é—´ä»¶ï¼Œä¹Ÿå¯ä»¥å°è¯•ã€‚</p></li><li class="lvl-2"><p>Stream ä¸ä¼ ç»Ÿçš„MQ çš„å¯¹æ¯”</p></li></ul><table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>Redis Stream</th><th>RabbitMQ</th><th>Kafka</th></tr></thead><tbody><tr><td><strong>æ•°æ®æ¨¡å‹</strong></td><td>ç±»ä¼¼æ—¥å¿—çš„æœ‰åº KV æ¶ˆæ¯æµï¼ˆID â†’ field/valueï¼‰</td><td>é˜Ÿåˆ—ï¼ˆFIFOï¼‰</td><td>æ—¥å¿—åˆ†åŒºï¼ˆPartitioned Append-Only Logï¼‰</td></tr><tr><td><strong>æ¶ˆæ¯æŒä¹…åŒ–</strong></td><td>å¯é€‰æŒä¹…åŒ–ï¼ˆAOF / RDBï¼‰ï¼Œé»˜è®¤å†…å­˜ä¼˜å…ˆ</td><td>å¯æŒä¹…åŒ–åˆ°ç£ç›˜</td><td>æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œé¡ºåºå†™å…¥ï¼Œæ•ˆç‡é«˜</td></tr><tr><td><strong>æ¶ˆæ¯ç¡®è®¤</strong></td><td>XACK å¯¹å•æ¡æ¶ˆæ¯ç¡®è®¤ï¼Œæ”¯æŒ Pending æ¶ˆæ¯ç®¡ç†</td><td>ACK / NACK</td><td>Offset æ§åˆ¶ï¼ŒConsumer è‡ªè¡Œæäº¤</td></tr><tr><td><strong>æ¶ˆè´¹æ¨¡å¼</strong></td><td>æ”¯æŒ Consumer Groupï¼Œå¤šæ¶ˆè´¹è€…å…±äº« Pending æ¶ˆæ¯</td><td>Queue ç»‘å®š Consumerï¼Œå¤šæ¶ˆè´¹è€…æŠ¢å </td><td>Consumer Groupï¼Œå¤šæ¶ˆè´¹è€…å¹³è¡Œæ¶ˆè´¹</td></tr><tr><td><strong>é‡å¤æ¶ˆè´¹</strong></td><td>é»˜è®¤å¯èƒ½é‡å¤ï¼Œéœ€è¦åº”ç”¨ç«¯å¹‚ç­‰</td><td>å¯é€šè¿‡ ACK/NACK æ§åˆ¶</td><td>é»˜è®¤å¯èƒ½é‡å¤ï¼ŒConsumer éœ€å¹‚ç­‰å¤„ç†</td></tr><tr><td><strong>æ¶ˆæ¯é¡ºåº</strong></td><td>æŒ‰ Stream ID é¡ºåºï¼Œå¯ä¿è¯åˆ†ç»„å†…é¡ºåº</td><td>é˜Ÿåˆ—é¡ºåºä¿è¯</td><td>Partition å†…é¡ºåºä¿è¯</td></tr><tr><td><strong>æ¶ˆæ¯ä¿ç•™ç­–ç•¥</strong></td><td>å¯é…ç½® maxlen / minidï¼ŒæŒ‰æ—¶é—´æˆ–é•¿åº¦è£å‰ª</td><td>é˜Ÿåˆ—é•¿åº¦ / TTL æ§åˆ¶</td><td>åŸºäºæ—¶é—´æˆ–å¤§å°ä¿ç•™ï¼ˆRetention Policyï¼‰</td></tr><tr><td><strong>å»¶æ—¶/å®šæ—¶æ¶ˆè´¹</strong></td><td>åŸç”Ÿä¸æ”¯æŒå»¶æ—¶é˜Ÿåˆ—ï¼Œéœ€è¦åº”ç”¨ç«¯å¤„ç†</td><td>æ”¯æŒæ’ä»¶æˆ– TTL</td><td>åŸç”Ÿä¸æ”¯æŒï¼Œéœ€è¦åº”ç”¨ç«¯å¤„ç†æˆ– Kafka Streams</td></tr><tr><td><strong>äº‹åŠ¡ä¸åŸå­æ“ä½œ</strong></td><td>äº‹åŠ¡å¯ç”¨ MULTI/EXECï¼ŒXADD æ”¯æŒ NOMKSTREAM ç­‰é€‰é¡¹</td><td>åŸç”Ÿäº‹åŠ¡æ”¯æŒï¼ˆäº‹åŠ¡ / confirm æ¨¡å¼ï¼‰</td><td>ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¾èµ–å¹‚ç­‰ç”Ÿäº§è€…</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>å†…å­˜çº§é«˜ååï¼ŒæŒä¹…åŒ–ä¼šæœ‰å¼€é”€</td><td>ä¸­ç­‰ï¼Œå—ç£ç›˜å’Œç½‘ç»œé™åˆ¶</td><td>é«˜ååï¼Œé¡ºåºå†™å…¥ç£ç›˜æ•ˆç‡æé«˜</td></tr><tr><td><strong>å…¸å‹ä½¿ç”¨åœºæ™¯</strong></td><td>äº‹ä»¶æ—¥å¿—ã€è½»é‡ MQã€å†…éƒ¨å¼‚æ­¥æµæ°´çº¿</td><td>ä¼ä¸šçº§æ¶ˆæ¯ã€ä»»åŠ¡è°ƒåº¦ã€RPC</td><td>å¤§æ•°æ®ç®¡é“ã€æ—¥å¿—æ”¶é›†ã€æµå¤„ç†</td></tr><tr><td><strong>å¤šè¯­è¨€æ”¯æŒ</strong></td><td>å®¢æˆ·ç«¯æ”¯æŒå¤šç§è¯­è¨€ï¼ˆJavaã€Pythonã€Go ç­‰ï¼‰</td><td>å®¢æˆ·ç«¯ä¸°å¯Œ</td><td>å®¢æˆ·ç«¯ä¸°å¯Œ</td></tr><tr><td><strong>æ˜“è¿ç»´æ€§</strong></td><td>å•èŠ‚ç‚¹å³å¯ä½¿ç”¨ï¼Œä½†æŒä¹…åŒ–éœ€å…³æ³¨å†…å­˜</td><td>é›†ç¾¤è¾ƒå¤æ‚ï¼Œéœ€è¦ RabbitMQ é›†ç¾¤</td><td>é›†ç¾¤å¤æ‚åº¦é«˜ï¼Œéœ€è¦ ZooKeeper æˆ– KRaft</td></tr></tbody></table><h3 id="åº•å±‚æ ¸å¿ƒå®ç°">åº•å±‚æ ¸å¿ƒå®ç°</h3><ol><li class="lvl-3"><p>å­˜å‚¨ç»“æ„ï¼šæ ¸å¿ƒæ˜¯åŸºæ•°æ ‘ï¼ˆRadix Treeï¼‰+ åŒå‘é“¾è¡¨ï¼ŒåŸºæ•°æ ‘å­˜ã€Œæ¶ˆæ¯IDâ†’æ¶ˆæ¯å†…å®¹ã€çš„æ˜ å°„ï¼ŒåŒå‘é“¾è¡¨æŒ‰æ¶ˆæ¯IDæœ‰åºä¸²è”æ‰€æœ‰æ¶ˆæ¯ï¼Œä¿è¯å†™å…¥å’ŒæŒ‰IDæŸ¥è¯¢çš„é«˜æ•ˆæ€§ï¼ˆO(logN)ï¼‰ã€‚</p></li><li class="lvl-3"><p>æ¶ˆæ¯IDï¼šé»˜è®¤è‡ªåŠ¨ç”Ÿæˆï¼Œæ ¼å¼ä¸ºæ—¶é—´æˆ³-åºåˆ—å·ï¼ˆå¦‚1734567890000-0ï¼‰ï¼Œæ—¶é—´æˆ³æ˜¯æ¯«ç§’çº§ï¼Œåºåˆ—å·è§£å†³åŒä¸€æ¯«ç§’å¤šæ¶ˆæ¯çš„æœ‰åºé—®é¢˜ï¼›ä¹Ÿæ”¯æŒæ‰‹åŠ¨æŒ‡å®šï¼Œéœ€æ»¡è¶³ä¸¥æ ¼é€’å¢ï¼Œå¦åˆ™å†™å…¥å¤±è´¥ã€‚</p></li><li class="lvl-3"><p>æŒä¹…åŒ–ï¼šå’Œ Redis å…¶ä»–æ•°æ®ç»“æ„ä¸€è‡´ï¼Œä¾èµ– RDB/AOF æŒä¹…åŒ–ï¼Œæ¶ˆæ¯å†™å…¥åä¼šè½ç›˜ï¼Œé‡å¯åä¸ä¸¢å¤±ï¼Œè¿™æ˜¯ Pub/Sub ä¸å…·å¤‡çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚</p></li><li class="lvl-3"><p>æ ¸å¿ƒå…ƒæ•°æ®ï¼šæ¯ä¸ª Stream ä¼šç»´æŠ¤last-idï¼ˆæœ€æ–°æ¶ˆæ¯IDï¼‰ã€groupsï¼ˆæ¶ˆè´¹ç»„åˆ—è¡¨ï¼‰ã€entriesï¼ˆæ¶ˆæ¯å®ä½“ï¼‰ä¸‰ç±»å…ƒæ•°æ®ï¼Œæ¶ˆè´¹ç»„çš„å…ƒæ•°æ®ç‹¬ç«‹å­˜å‚¨ï¼Œäº’ä¸å¹²æ‰°ã€‚</p></li></ol><h2 id="Stream-æ ¸å¿ƒåŸºç¡€æ“ä½œï¼ˆå¿…ç”¨ï¼‰">Stream æ ¸å¿ƒåŸºç¡€æ“ä½œï¼ˆå¿…ç”¨ï¼‰</h2><h3 id="1-ç”Ÿäº§æ¶ˆæ¯ï¼ˆXADDï¼‰ï¼šå†™å…¥é˜Ÿåˆ—">1. ç”Ÿäº§æ¶ˆæ¯ï¼ˆXADDï¼‰ï¼šå†™å…¥é˜Ÿåˆ—</h3><p>â€¢ æ ¸å¿ƒå‘½ä»¤ï¼š<code>XADD key ID å­—æ®µ1 å€¼1 å­—æ®µ2 å€¼2 ...</code>ï¼ŒID å†™*è¡¨ç¤ºè‡ªåŠ¨ç”Ÿæˆï¼ˆç”Ÿäº§é¦–é€‰ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">XADD key</span><br><span class="line">     [NOMKSTREAM]</span><br><span class="line">     [MAXLEN | MINID [= | ~] threshold [LIMIT count]]</span><br><span class="line">     * | <span class="built_in">id</span></span><br><span class="line">     field value [field value ...]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°è§£é‡Š</span></span><br><span class="line"><span class="comment"># key: Stream åç§°</span></span><br><span class="line"><span class="comment"># NOMKSTREAM: ä¸è‡ªåŠ¨åˆ›å»º Streamï¼Œè‹¥ key ä¸å­˜åœ¨ â†’ å‘½ä»¤ç›´æ¥å¤±è´¥</span></span><br><span class="line"><span class="comment"># MAXLEN threshold â€”â€” æŒ‰é•¿åº¦è£å‰ª</span></span><br><span class="line"><span class="comment">#   MAXLEN 1000: Stream æœ€å¤šä¿ç•™ 1000 æ¡æ¶ˆæ¯ï¼Œè¶…å‡ºéƒ¨åˆ†ä¼šè¢«åˆ é™¤ï¼ˆä»æœ€æ—§å¼€å§‹ï¼‰</span></span><br><span class="line"><span class="comment">#   MAXLEN = 1000: ç²¾ç¡®è£å‰ªï¼Œä¸¥æ ¼ä¿è¯é•¿åº¦ â‰¤ 1000ï¼Œæ¯æ¬¡å†™å…¥éƒ½ä¼šæ£€æŸ¥å¹¶è£å‰ªï¼Œæ€§èƒ½å¼€é”€è¾ƒå¤§</span></span><br><span class="line"><span class="comment">#   MAXLEN ~ 1000ï¼ˆæ¨èï¼‰: è¿‘ä¼¼è£å‰ªï¼Œå…è®¸ Stream é•¿åº¦ ç•¥å¾®è¶…è¿‡é˜ˆå€¼ï¼ŒRedis åœ¨å†…éƒ¨æ‰¹é‡è£å‰ªï¼Œå†™å…¥æ€§èƒ½æ›´é«˜</span></span><br><span class="line"><span class="comment"># LIMIT count â€”â€” æ¯æ¬¡æœ€å¤šè£å‰ªå¤šå°‘æ¡</span></span><br><span class="line"><span class="comment">#   MAXLEN ~ 1000 LIMIT 100: å•æ¬¡å†™å…¥ æœ€å¤šåˆ é™¤ 100 æ¡æ—§æ¶ˆæ¯ï¼Œé˜²æ­¢ä¸€æ¬¡è£å‰ªé˜»å¡ Redis ä¸»çº¿ç¨‹</span></span><br><span class="line"><span class="comment"># MINID threshold â€”â€” æŒ‰ ID è£å‰ªï¼ˆRedis â‰¥ 6.2ï¼‰</span></span><br><span class="line"><span class="comment">#   MINID ~ 1670000000000-0: åˆ é™¤ ID å°äº threshold çš„æ¶ˆæ¯ï¼Œæ›´é€‚åˆ æ—¶é—´çª—å£å‹ä¿ç•™ç­–ç•¥</span></span><br><span class="line"><span class="comment"># * | id â€”â€” æ¶ˆæ¯ ID</span></span><br><span class="line"><span class="comment">#   *: è‡ªåŠ¨ç”Ÿæˆ IDï¼ˆ99% åœºæ™¯ï¼‰ï¼Œæ ¼å¼ï¼š&lt;æ¯«ç§’æ—¶é—´æˆ³&gt;-&lt;åºå·&gt;ï¼Œå•è°ƒé€’å¢ï¼Œå…¨å±€æœ‰åºï¼Œæ¶ˆè´¹è€…ç»„ä¾èµ–å®ƒè¿›è¡Œ offset ç®¡ç†</span></span><br><span class="line"><span class="comment">#   id: æŒ‡å®šIDï¼ˆä¸å¸¸ç”¨ï¼‰ï¼ŒID å¿…é¡»ä¸¥æ ¼å¤§äº Stream ä¸­æœ€å¤§ IDï¼Œå¦åˆ™å†™å…¥å¤±è´¥</span></span><br><span class="line"><span class="comment"># field value â€”â€” æ¶ˆæ¯ä½“ï¼ˆPayloadï¼‰</span></span><br><span class="line"><span class="comment">#   è‡³å°‘ä¸€å¯¹ field-valueï¼Œfield / value éƒ½æ˜¯ Binary Safeï¼Œæœ¬è´¨ç±»ä¼¼ Hashï¼Œä½†ä¸å¯ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><p>â€¢ ç¤ºä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘è®¢å•é˜Ÿåˆ—å†™å…¥1æ¡æ¶ˆæ¯ï¼Œè‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯ID</span></span><br><span class="line">XADD order_stream * uid 1001 order_no ORD20251220 price 299</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="string">&quot;1766215406540-0&quot;</span> <span class="comment"># æ¶ˆæ¯ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿ç•™æŸä¸ªæ—¶é—´ç‚¹ä¹‹åçš„æ—¥å¿—</span></span><br><span class="line">XADD <span class="built_in">log</span> MINID ~ 1689900000000-0 * level INFO msg <span class="string">&quot;startup&quot;</span></span><br></pre></td></tr></table></figure><h3 id="2-æ¶ˆè´¹æ¶ˆæ¯ï¼ˆ2ç§æ ¸å¿ƒæ¨¡å¼ï¼‰">2. æ¶ˆè´¹æ¶ˆæ¯ï¼ˆ2ç§æ ¸å¿ƒæ¨¡å¼ï¼‰</h3><h4 id="ï¼ˆ1ï¼‰-ç‹¬ç«‹æ¶ˆè´¹ï¼ˆæ— æ¶ˆè´¹ç»„ï¼‰ï¼šä¸€å¯¹ä¸€æ¶ˆè´¹ï¼Œé€‚åˆç®€å•åœºæ™¯">ï¼ˆ1ï¼‰ ç‹¬ç«‹æ¶ˆè´¹ï¼ˆæ— æ¶ˆè´¹ç»„ï¼‰ï¼šä¸€å¯¹ä¸€æ¶ˆè´¹ï¼Œé€‚åˆç®€å•åœºæ™¯</h4><p>â€¢ XREADï¼šä¸»åŠ¨æ‹‰å–æ¶ˆæ¯ï¼Œæ”¯æŒé˜»å¡/éé˜»å¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">XREAD</span><br><span class="line">  [COUNT count]</span><br><span class="line">  [BLOCK milliseconds]</span><br><span class="line">  STREAMS key [key ...]</span><br><span class="line">          <span class="built_in">id</span>  [<span class="built_in">id</span>  ...]</span><br><span class="line"><span class="comment"># å‚æ•°è§£é‡Š</span></span><br><span class="line"><span class="comment"># COUNT count â€”â€” å•æ¬¡æœ€å¤šè¯»å–å¤šå°‘æ¡ï¼Œæ˜¯â€œä¸Šé™â€ï¼Œä¸æ˜¯ä¿è¯å€¼</span></span><br><span class="line"><span class="comment"># BLOCK milliseconds â€”â€” é˜»å¡ç­‰å¾…æ–°æ¶ˆæ¯ï¼Œé˜»å¡æœŸé—´ ä¸ä¼šå ç”¨ CPUï¼Œè¶…æ—¶è¿”å› nil</span></span><br><span class="line"><span class="comment">#   BLOCK 0: æ— é™é˜»å¡ï¼Œç›´åˆ°æœ‰æ–°æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"># STREAMS key [key ...] â€”â€” æŒ‡å®šè¯»å–çš„ Streamï¼Œkey ä¸ id ä¸€ä¸€å¯¹åº”</span></span><br><span class="line"><span class="comment"># id [id ...] â€”â€” ä»å“ªä¸ªä½ç½®å¼€å§‹è¯»ï¼Œè¯»å– ID å¤§äºè¯¥å€¼çš„æ¶ˆæ¯ï¼Œä¸åŒ…å« è¯¥ ID æœ¬èº«</span></span><br><span class="line"><span class="comment">#   æ™®é€š IDï¼ˆæ¸¸æ ‡è¯­ä¹‰ï¼‰: XREAD STREAMS mystream 1689999999999-0</span></span><br><span class="line"><span class="comment">#   $: åªå…³å¿ƒâ€œå°†æ¥â€çš„æ¶ˆæ¯ï¼Œä» å½“å‰ Stream çš„æœ«å°¾ä¹‹å å¼€å§‹è¯»ï¼Œå†å²æ¶ˆæ¯å…¨éƒ¨å¿½ç•¥: XREAD BLOCK 0 STREAMS mystream $</span></span><br></pre></td></tr></table></figure><p>â€¢ ç¤ºä¾‹1ï¼ˆéé˜»å¡ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»å¼€å¤´æ‹‰5æ¡æ¶ˆæ¯</span></span><br><span class="line">XREAD COUNT 5 STREAMS order_stream 0-0</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;order_stream&quot;</span>          <span class="comment"># Streamåç§°</span></span><br><span class="line">   2) 1) 1) <span class="string">&quot;1766215406540-0&quot;</span> <span class="comment"># æ¶ˆæ¯ID</span></span><br><span class="line">         2) 1) <span class="string">&quot;uid&quot;</span>          <span class="comment"># æ¶ˆæ¯ä½“ é”®å€¼å¯¹</span></span><br><span class="line">            2) <span class="string">&quot;1001&quot;</span></span><br><span class="line">            3) <span class="string">&quot;order_no&quot;</span></span><br><span class="line">            4) <span class="string">&quot;ORD20251220&quot;</span></span><br><span class="line">            5) <span class="string">&quot;price&quot;</span></span><br><span class="line">            6) <span class="string">&quot;299&quot;</span></span><br></pre></td></tr></table></figure><p>â€¢ ç¤ºä¾‹2ï¼ˆé˜»å¡ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $è¡¨ç¤ºä»æœ€æ–°æ¶ˆæ¯å¼€å§‹æ‹‰ï¼Œé˜»å¡3ç§’ï¼Œæœ‰æ–°æ¶ˆæ¯ç«‹å³è¿”å›ï¼Œæ— åˆ™3ç§’åè¶…æ—¶ï¼Œæ˜¯ç”Ÿäº§å¸¸ç”¨å†™æ³•ã€‚</span></span><br><span class="line">XREAD COUNT 5 BLOCK 3000 STREAMS order_stream $</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰-æ¶ˆè´¹ç»„æ¶ˆè´¹ï¼ˆXGROUPï¼‰ï¼šä¸€å¯¹å¤šæ¶ˆè´¹ï¼Œæ ¸å¿ƒç”Ÿäº§æ¨¡å¼">ï¼ˆ2ï¼‰ æ¶ˆè´¹ç»„æ¶ˆè´¹ï¼ˆXGROUPï¼‰ï¼šä¸€å¯¹å¤šæ¶ˆè´¹ï¼Œæ ¸å¿ƒç”Ÿäº§æ¨¡å¼</h4><ul class="lvl-0"><li class="lvl-2"><p>Stream æœ€æ ¸å¿ƒçš„ä»·å€¼å°±æ˜¯æ¶ˆè´¹ç»„ï¼Œæ”¯æŒå¤šæ¶ˆè´¹è€…ååŒæ¶ˆè´¹ã€æ¶ˆæ¯ç¡®è®¤ã€æœªæ¶ˆè´¹æ¶ˆæ¯è¿½æº¯ï¼Œè§£å†³äº†åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„æ¶ˆæ¯åˆ†ç‰‡ä¸è´Ÿè½½å‡è¡¡é—®é¢˜ã€‚</p></li><li class="lvl-2"><ol><li class="lvl-5">å…ˆåˆ›å»ºæ¶ˆè´¹ç»„<code>XGROUP CREATE</code></li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">XGROUP CREATE key group <span class="built_in">id</span>|$</span><br><span class="line">       [MKSTREAM]</span><br><span class="line">       [ENTRIESREAD entries-read]</span><br><span class="line"><span class="comment"># å‚æ•°è§£é‡Š</span></span><br><span class="line"><span class="comment"># keyï¼šStream åç§°ï¼Œä¸ºæŒ‡å®šçš„Streamåˆ›å»ºæ¶ˆè´¹ç»„</span></span><br><span class="line"><span class="comment"># group: æ¶ˆè´¹ç»„åç§°ï¼Œæ¶ˆè´¹è€…ç»„çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸€ä¸ª Stream å¯ä»¥æœ‰ å¤šä¸ª consumer group</span></span><br><span class="line"><span class="comment"># id | $ â€”â€” å…³é”®å‚æ•°ï¼šæ¶ˆè´¹èµ·å§‹ä½ç‚¹ï¼ˆoffsetï¼‰ï¼Œ$è¡¨ç¤ºä»å½“å‰æœ€æ–°æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ï¼Œç”¨0-0è¡¨ç¤ºä»é˜Ÿåˆ—å¼€å¤´æ¶ˆè´¹ã€‚</span></span><br><span class="line"><span class="comment"># [MKSTREAM] â€”â€” è‡ªåŠ¨åˆ›å»º Streamï¼Œå¦‚æœæŒ‡å®šçš„keyä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºï¼Œæ¨èåœ¨è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># [ENTRIESREAD entries-read] â€”â€” è®¾ç½®â€œå·²è¯»å–æ¡æ•°â€ï¼ˆé«˜çº§å‚æ•°ï¼‰ï¼Œä¸€èˆ¬ä¸šåŠ¡ä¸éœ€è¦ä½¿ç”¨ï¼Œä¸»è¦ç”¨äºæ‰‹åŠ¨æ¢å¤groupã€æ•°æ®è¿ç§»ç­‰åœºæ™¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šåˆ›å»ºgroup1æ¶ˆè´¹ç»„ï¼Œä»æœ€æ–°è®¢å•æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹</span></span><br><span class="line">XGROUP CREATE order_stream group1 $ MKSTREAM</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯<code>XREADGROUP</code></p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP GROUP group consumer</span><br><span class="line">           [COUNT count]</span><br><span class="line">           [BLOCK milliseconds]</span><br><span class="line">           [NOACK]</span><br><span class="line">           STREAMS key [key ...]</span><br><span class="line">                   <span class="built_in">id</span>  [<span class="built_in">id</span>  ...]</span><br><span class="line"><span class="comment"># å‚æ•°è§£é‡Š</span></span><br><span class="line"><span class="comment"># GROUP group consumer: æŒ‡å®šæ¶ˆè´¹è€…ç»„åï¼šgroupï¼Œæ¶ˆè´¹è€…åï¼šconsumer</span></span><br><span class="line"><span class="comment">#    åŒä¸€ä¸ª group ä¸‹ï¼Œä¸åŒ consumer ä¸ä¼šæ”¶åˆ°é‡å¤æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"># [COUNT count] â€”â€” å•æ¬¡æœ€å¤šè¿”å›æ¡æ•°ï¼Œæ˜¯è½¯é™åˆ¶ï¼Œä¸æ˜¯ä¸¥æ ¼ä¿è¯</span></span><br><span class="line"><span class="comment"># [BLOCK milliseconds] â€”â€” é˜»å¡ç­‰å¾…æ–°æ¶ˆæ¯ï¼Œæœ€å¤šé˜»å¡ milliseconds æ¯«ç§’</span></span><br><span class="line"><span class="comment">#    BLOCK 0 â†’ æ°¸ä¹…é˜»å¡</span></span><br><span class="line"><span class="comment"># [NOACK] â€”â€” ä¸è¿›å…¥ Pendingï¼ˆâš ï¸ è°¨æ…ï¼‰</span></span><br><span class="line"><span class="comment">#    æ¶ˆæ¯ ä¸ä¼šè¿›å…¥ Pendingï¼Œä¸éœ€è¦ XACKï¼Œæ¶ˆè´¹åå³è®¤ä¸ºå®Œæˆ</span></span><br><span class="line"><span class="comment">#    é£é™©ï¼šæ¶ˆè´¹è€…å´©æºƒ â†’ æ¶ˆæ¯ç›´æ¥ä¸¢å¤±ï¼Œä¸å¯é‡æŠ•é€’</span></span><br><span class="line"><span class="comment"># STREAMS key [key ...]: æŒ‡å®šè¦è¯»å–çš„ Streamï¼ˆæ”¯æŒå¤šä¸ªï¼‰ï¼Œkey é¡ºåºéœ€ä¸åç»­ id é¡ºåºä¸€è‡´</span></span><br><span class="line"><span class="comment"># id [id ...] â€”â€” å†³å®šâ€œè¯»ä»€ä¹ˆâ€çš„å…³é”®</span></span><br><span class="line"><span class="comment">#    ä½¿ç”¨ &gt; â€”â€” è¯»å–â€œæ–°æ¶ˆæ¯â€ï¼ˆâœ… ç”Ÿäº§ç¯å¢ƒ 99% ä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰ï¼Œä»æœªæŠ•é€’ç»™ä»»ä½• consumer çš„æ–°æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">#    ä½¿ç”¨ 0/å…·ä½“ID â€”â€” é‡è¯» Pendingï¼ˆè¡¥å¿ï¼‰ï¼Œè¯»å– å·²æŠ•é€’ä½†æœª ACK çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">#    å¤š Stream åœºæ™¯: STREAMS stream1 stream2 &gt; &gt;ï¼Œæ¯ä¸ª stream å¿…é¡»æœ‰ä¸€ä¸ªå¯¹åº” id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šconsumerA ä»group1æ‹‰3æ¡æœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œé˜»å¡5ç§’ã€‚</span></span><br><span class="line">XREADGROUP GROUP group1 consumerA COUNT 3 BLOCK 5000 STREAMS order_stream &gt;</span><br><span class="line"><span class="comment">## æ­¤æ—¶åœ¨5ç§’å†…åˆ›å»ºæ–°çš„æ¶ˆæ¯ï¼Œå°±ä¼šæœ‰ç±»ä¼¼å¦‚ä¸‹è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;order_stream&quot;</span></span><br><span class="line">   2) 1) 1) <span class="string">&quot;1766215642763-0&quot;</span></span><br><span class="line">         2) 1) <span class="string">&quot;uid&quot;</span></span><br><span class="line">            2) <span class="string">&quot;1001&quot;</span></span><br><span class="line">            3) <span class="string">&quot;order_no&quot;</span></span><br><span class="line">            4) <span class="string">&quot;ORD20251220&quot;</span></span><br><span class="line">            5) <span class="string">&quot;price&quot;</span></span><br><span class="line">            6) <span class="string">&quot;299&quot;</span></span><br><span class="line">(1.50s)</span><br></pre></td></tr></table></figure><h3 id="3-æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰">3. æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>æ¶ˆè´¹å®Œæˆåå¿…é¡»ç¡®è®¤ï¼Œå¦åˆ™ä¼šè¢«æ ‡è®°ä¸ºã€Œæœªç¡®è®¤æ¶ˆæ¯ã€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># XACK key æ¶ˆè´¹ç»„å æ¶ˆæ¯ID1 æ¶ˆæ¯ID2 ...ã€‚</span></span><br><span class="line">XACK key group <span class="built_in">id</span> [<span class="built_in">id</span> ...]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹: ç¡®è®¤2æ¡æ¶ˆæ¯æ¶ˆè´¹å®Œæˆï¼ŒStream ä¼šåˆ é™¤è¯¥æ¶ˆæ¯çš„æœªç¡®è®¤æ ‡è®°</span></span><br><span class="line">XACK order_stream group1 1734567890000-0 1734567890001-0</span><br></pre></td></tr></table></figure><h3 id="4-æ¶ˆæ¯é‡è¯•">4. æ¶ˆæ¯é‡è¯•</h3><ul class="lvl-0"><li class="lvl-2"><p>æœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œä¼šè¢«å­˜å…¥æ¶ˆè´¹ç»„çš„<code>ã€ŒPELï¼ˆPending Entries Listï¼‰ã€</code>ï¼Œå¯é€šè¿‡<code>XPENDING key æ¶ˆè´¹ç»„å</code>æŸ¥çœ‹ï¼Œæ”¯æŒ<code>XCLAIM</code>å°†<code>PEL</code>ä¸­çš„æ¶ˆæ¯è½¬ç§»ç»™å…¶ä»–æ¶ˆè´¹è€…å¤„ç†ï¼Œé¿å…å•ç‚¹æ•…éšœå¯¼è‡´æ¶ˆæ¯å †ç§¯ã€‚</p></li><li class="lvl-2"><p>XPENDINGï¼šæŸ¥çœ‹æœªè¢«ç¡®è®¤çš„æ¶ˆæ¯æƒ…å†µ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">XPENDING key group</span><br><span class="line">        [[IDLE min-idle-time]</span><br><span class="line">         start end count</span><br><span class="line">         [consumer]]</span><br><span class="line"><span class="comment"># å‚æ•°è§£é‡Š</span></span><br><span class="line"><span class="comment"># key: Stream åç§°ï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class="line"><span class="comment"># group: æ¶ˆè´¹è€…ç»„åç§°ï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class="line"><span class="comment"># [IDLE min-idle-time]ï¼ˆRedis â‰¥ 6.2ï¼‰: ä»…è¿”å› ç©ºé—²æ—¶é—´ â‰¥ min-idle-timeï¼ˆæ¯«ç§’ï¼‰ çš„ Pending æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">#    min-idle-time(ç©ºé—²æ—¶é—´) = ä»ä¸Šæ¬¡æŠ•é€’ / claimåˆ°ç°åœ¨</span></span><br><span class="line"><span class="comment"># start end â€”â€” ID èŒƒå›´</span></span><br><span class="line"><span class="comment">#    -: æœ€å°ID</span></span><br><span class="line"><span class="comment">#    +: æœ€å¤§ID</span></span><br><span class="line"><span class="comment"># count â€”â€” è¿”å›æ¡æ•°ä¸Šé™</span></span><br><span class="line"><span class="comment"># [consumer]ï¼ˆå¯é€‰ï¼‰: åªæŸ¥çœ‹æŸä¸€ä¸ª consumer çš„ Pendingï¼Œä¸æŒ‡å®šåˆ™æŸ¥çœ‹ group å†…å…¨éƒ¨</span></span><br><span class="line"><span class="comment"># åªè¿”å› å…ƒæ•°æ®ï¼Œä¸è¿”å›æ¶ˆæ¯å†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹1: æŸ¥çœ‹æ˜¯å¦æœ‰æ¶ˆæ¯ç§¯å‹</span></span><br><span class="line">XPENDING order_stream group1</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 1      <span class="comment"># ç§¯å‹æ¶ˆæ¯æ•°ï¼Œæœªç¡®è®¤æ¶ˆæ¯æ•°é‡</span></span><br><span class="line">2) <span class="string">&quot;1766215642763-0&quot;</span> <span class="comment"># Pending ä¸­æœ€å° ID</span></span><br><span class="line">3) <span class="string">&quot;1766215642763-0&quot;</span> <span class="comment"># Pending ä¸­æœ€å¤§ ID</span></span><br><span class="line">4) 1) 1) <span class="string">&quot;consumerA&quot;</span> <span class="comment"># æŒ‰ consumer ç»Ÿè®¡çš„ Pending æ•°é‡</span></span><br><span class="line">      2) <span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2: æŸ¥æ‰¾ idle è¶…è¿‡ 1 åˆ†é’Ÿçš„æ¶ˆæ¯ï¼Œæœ€å¤šè¿”å›10æ¡</span></span><br><span class="line">XPENDING order_stream group1 IDLE 60000 - + 10</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;1766215642763-0&quot;</span> <span class="comment"># æ¶ˆæ¯ ID</span></span><br><span class="line">   2) <span class="string">&quot;consumerA&quot;</span>       <span class="comment"># å½“å‰æŒæœ‰è¯¥æ¶ˆæ¯çš„ consumer</span></span><br><span class="line">   3) (<span class="built_in">integer</span>) 255581  <span class="comment"># idle æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 2       <span class="comment"># delivery countï¼ˆæŠ•é€’æ¬¡æ•°ï¼‰,è¯¥æ¶ˆæ¯è‡³å°‘è¢«æŠ•é€’è¿‡ 2 æ¬¡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3: åªæŸ¥çœ‹ consumerA çš„ Pendingï¼Œæœ€å¤šè¿”å›20æ¡</span></span><br><span class="line">XPENDING order_stream group1 - + 20 consumerA</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>XCLAIM: è½¬ç§»æŠ•é€’</p></li></ul><blockquote><p>å°†å·²ç»æŠ•é€’ä½†æœª ACKã€ä¸” idle è¶…è¿‡é˜ˆå€¼çš„ Pending æ¶ˆæ¯ï¼Œä»åŸ consumer æ‰‹ä¸­â€œæŠ¢å â€ç»™æ–°çš„ consumerï¼Œå¹¶é‡æ–°æŠ•é€’ã€‚<br>ä¸€æ—¦æŠ¢å æˆåŠŸï¼ŒåŸ consumer å°±ä¸åœ¨æ‹¥æœ‰è¯¥æ¶ˆæ¯çš„ Pending è®°å½•</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">XCLAIM key group consumer min-idle-time <span class="built_in">id</span> [<span class="built_in">id</span> ...]</span><br><span class="line">       [IDLE ms]</span><br><span class="line">       [TIME unix-time-milliseconds]</span><br><span class="line">       [RETRYCOUNT count]</span><br><span class="line">       [FORCE]</span><br><span class="line">       [JUSTID]</span><br><span class="line">       [LASTID lastid]</span><br><span class="line"><span class="comment"># å‚æ•°è§£é‡Š</span></span><br><span class="line"><span class="comment"># key: Stream Keyï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class="line"><span class="comment"># group: æ¶ˆè´¹è€…ç»„åç§°ï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class="line"><span class="comment"># consumer: æ–°çš„æ¶ˆè´¹è€…ï¼ŒæŠ¢å åçš„ Pending æ¶ˆæ¯å°†å½’å±è¯¥ consumer</span></span><br><span class="line"><span class="comment"># min-idle-time: ç©ºé—²æ—¶é—´ï¼Œåªæœ‰ idle â‰¥ min-idle-time çš„ Pending æ¶ˆæ¯æ‰å…è®¸è¢« claim</span></span><br><span class="line"><span class="comment"># id [id ...]: æŒ‡å®šè¦ claim çš„æ¶ˆæ¯ IDï¼ŒIDå¿…é¡»å­˜åœ¨</span></span><br><span class="line"><span class="comment"># [IDLE ms]: äººä¸ºè®¾ç½® idle æ—¶é—´ï¼Œè¦†ç›– Redis å†…éƒ¨è®¡ç®—çš„ idleï¼Œæ¯”å¦‚å¼ºåˆ¶åˆ¶é€ â€œå·²è¶…æ—¶â€çŠ¶æ€</span></span><br><span class="line"><span class="comment"># [TIME unix-time-milliseconds]: æ‰‹åŠ¨æŒ‡å®šâ€œæœ€åæŠ•é€’æ—¶é—´â€ï¼Œä¸ IDLE äºŒé€‰ä¸€ä½¿ç”¨ï¼Œæå°‘è§äºä¸šåŠ¡ä»£ç </span></span><br><span class="line"><span class="comment"># [RETRYCOUNT count]: æ‰‹åŠ¨è®¾ç½® delivery countï¼Œå®ç°â€œæœ€å¤šé‡è¯• N æ¬¡ï¼Œè¶…è¿‡è¿›æ­»ä¿¡é˜Ÿåˆ—â€</span></span><br><span class="line"><span class="comment"># [FORCE]: å¼ºåˆ¶ claim ä¸å­˜åœ¨äº Pending çš„æ¶ˆæ¯ï¼Œâš ï¸ é«˜é£é™©</span></span><br><span class="line"><span class="comment"># [JUSTID]: åªè¿”å› æ¶ˆæ¯ IDï¼Œä¸è¿”å›æ¶ˆæ¯ä½“ï¼ˆfield/valueï¼‰ï¼Œå‡å°‘ç½‘ç»œå¼€é”€</span></span><br><span class="line"><span class="comment"># [LASTID lastid]ï¼ˆRedis â‰¥ 7.0ï¼‰: æ›´æ–° consumer group çš„ last-delivered-idï¼Œå½±å“åç»­ XREADGROUP &gt; çš„è¡Œä¸º</span></span><br><span class="line"><span class="comment">#    âš ï¸ é«˜çº§ç‰¹æ€§ï¼Œä¸€èˆ¬ä¸å»ºè®®ä¸šåŠ¡ä»£ç ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment"># 1ï¸âƒ£ æŠ¢å  idle è¶…è¿‡ 60s çš„æ¶ˆæ¯</span></span><br><span class="line">XCLAIM order_stream group1 consumerB 60000 1766215642763-0</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1) 1) <span class="string">&quot;1766215642763-0&quot;</span></span><br><span class="line">   2) 1) <span class="string">&quot;uid&quot;</span></span><br><span class="line">      2) <span class="string">&quot;1001&quot;</span></span><br><span class="line">      3) <span class="string">&quot;order_no&quot;</span></span><br><span class="line">      4) <span class="string">&quot;ORD20251220&quot;</span></span><br><span class="line">      5) <span class="string">&quot;price&quot;</span></span><br><span class="line">      6) <span class="string">&quot;299&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ï¸âƒ£ æŠ¢å å¹¶æ ‡è®°ä¸ºç¬¬ 3 æ¬¡é‡è¯•</span></span><br><span class="line">XCLAIM orders order-group consumerB 60000 1766215642763-0 RETRYCOUNT 3</span><br><span class="line"><span class="comment"># 3ï¸âƒ£ åªè¿”å› IDï¼ˆé…åˆæ‰¹å¤„ç†ï¼‰</span></span><br><span class="line">XCLAIM orders order-group consumerB 60000 1766215642763-0 JUSTID</span><br></pre></td></tr></table></figure><h2 id="é«˜çº§ç‰¹æ€§ï¼ˆç”Ÿäº§å¿…å¤‡ï¼‰">é«˜çº§ç‰¹æ€§ï¼ˆç”Ÿäº§å¿…å¤‡ï¼‰</h2><ol><li class="lvl-3"><p>æ¶ˆæ¯å›æº¯ä¸éå†</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># XRANGE key èµ·å§‹ID ç»“æŸID [COUNT æ¡æ•°]ï¼ˆæ­£å‘éå†ï¼‰</span></span><br><span class="line">XRANGE key start end [COUNT count]</span><br><span class="line"><span class="comment"># XREVRANGE key ç»“æŸID èµ·å§‹ID [COUNT æ¡æ•°]ï¼ˆåå‘éå†ï¼‰</span></span><br><span class="line">XREVRANGE key end start [COUNT count]</span><br><span class="line"><span class="comment"># ç¤ºä¾‹: 0-0:æœ€å°çš„æ¶ˆæ¯IDï¼Œç­‰åŒäº -ï¼Œ+:è¡¨ç¤ºæœ€æ–°æ¶ˆæ¯ï¼Œé€‚åˆæ•°æ®å¯¹è´¦ã€å†å²æ¶ˆæ¯æŸ¥è¯¢ã€‚</span></span><br><span class="line">XRANGE order_stream 0-0 + COUNT 10</span><br><span class="line">XRANGE order_stream - + COUNT 10</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>é˜Ÿåˆ—ä¿¡æ¯æŸ¥è¯¢</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥æ¶ˆæ¯æ€»æ•°</span></span><br><span class="line">XLEN key</span><br><span class="line"><span class="comment"># æŸ¥Streamå®Œæ•´å…ƒæ•°æ®ï¼ˆæœ€æ–°IDã€æ¶ˆè´¹ç»„æ•°é‡ã€æ¶ˆæ¯æ€»æ•°ç­‰ï¼‰</span></span><br><span class="line"></span><br><span class="line">XINFO STREAM key [FULL [COUNT count]]</span><br><span class="line"><span class="comment">## FULL: å®Œæ•´æ¨¡å¼</span></span><br><span class="line">    <span class="comment"># ğŸ‘‰ è¿”å›ï¼š</span></span><br><span class="line">    <span class="comment">#     Stream å…ƒä¿¡æ¯</span></span><br><span class="line">    <span class="comment">#     æ‰€æœ‰ Consumer Group</span></span><br><span class="line">    <span class="comment">#     æ¯ä¸ª Group çš„ Consumer</span></span><br><span class="line">    <span class="comment">#     Pending Entries Listï¼ˆPELï¼‰</span></span><br><span class="line">    <span class="comment">#     éƒ¨åˆ†å†å² entries</span></span><br><span class="line">    <span class="comment"># âš ï¸ å¼€é”€å¾ˆå¤§ï¼Œæ…ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚</span></span><br><span class="line"><span class="comment">## COUNT countï¼ˆFULL æ¨¡å¼çš„é™åˆ¶å‚æ•°ï¼‰</span></span><br><span class="line">    <span class="comment">#   XINFO STREAM key FULL COUNT 10: é™åˆ¶è¿”å›çš„entries æ•°é‡ä»¥åŠæ¯ä¸ª group / consumer çš„ PEL è®°å½•æ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰€æœ‰æ¶ˆè´¹ç»„ä¿¡æ¯</span></span><br><span class="line">XINFO GROUPS key</span><br><span class="line"><span class="comment"># æŸ¥è¯¥ç»„ä¸‹æ‰€æœ‰æ¶ˆè´¹è€…</span></span><br><span class="line">XINFO CONSUMERS key æ¶ˆè´¹ç»„å</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>æ¶ˆè´¹ç»„ç®¡ç†</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ¶ˆè´¹ç»„</span></span><br><span class="line">XGROUP DESTROY key æ¶ˆè´¹ç»„å</span><br><span class="line"><span class="comment"># åˆ é™¤æ¶ˆè´¹è€…</span></span><br><span class="line">XGROUP DELCONSUMER key æ¶ˆè´¹ç»„å æ¶ˆè´¹è€…å</span><br><span class="line"><span class="comment"># é‡ç½®æ¶ˆè´¹ç»„èµ·å§‹ID</span></span><br><span class="line">XGROUP SETID key æ¶ˆè´¹ç»„å æ–°ID</span><br></pre></td></tr></table></figure><ol start="4"><li class="lvl-3"><p>æƒ°æ€§åˆ é™¤ï¼šStream ä¸ä¼šä¸»åŠ¨åˆ é™¤å·²ç¡®è®¤çš„æ¶ˆæ¯ï¼Œä»…é MAXLENæ·˜æ±°ï¼Œè‹¥éœ€ä¸»åŠ¨æ¸…ç†å†å²æ¶ˆæ¯ï¼Œç›´æ¥ç”¨XADDçš„MAXLENå‚æ•°å³å¯ï¼Œæ— éœ€é¢å¤–å‘½ä»¤ã€‚</p></li></ol><h2 id="ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒç—›ç‚¹ä¸è§£å†³æ–¹æ¡ˆ">ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒç—›ç‚¹ä¸è§£å†³æ–¹æ¡ˆ</h2><ol><li class="lvl-3"><p>æ¶ˆæ¯ä¸¢å¤±ï¼š3é‡ä¿éšœ</p><ul class="lvl-2"><li class="lvl-6">å¼€å¯ Redis AOF æŒä¹…åŒ–ï¼ˆè®¾ä¸ºeverysecï¼Œå…¼é¡¾æ€§èƒ½ä¸å¯é æ€§ï¼‰</li><li class="lvl-6">ç”Ÿäº§è€…å†™å…¥åç¡®è®¤è¿”å›å€¼ï¼ˆç¡®ä¿å†™å…¥æˆåŠŸï¼‰</li><li class="lvl-6">æ¶ˆè´¹è€…æ¶ˆè´¹åå¿…é¡»<code>XACK</code>ç¡®è®¤ã€‚</li></ul></li><li class="lvl-3"><p>æ¶ˆæ¯å †ç§¯ï¼š2ç§å¤„ç†</p><ul class="lvl-2"><li class="lvl-6">â‘  å†™å…¥æ—¶ç”¨<code>MAXLEN</code>è®¾ç½®ä¸Šé™ï¼Œæ·˜æ±°æ—§æ¶ˆæ¯ï¼›</li><li class="lvl-6">â‘¡ æ¶ˆè´¹ç«¯æ‰©å®¹æ¶ˆè´¹è€…å®ä¾‹ï¼Œæ¶ˆè´¹ç»„ä¼šè‡ªåŠ¨å°†æœªæ¶ˆè´¹æ¶ˆæ¯åˆ†ç‰‡ç»™å¤šä¸ªæ¶ˆè´¹è€…ï¼Œå®ç°å¹¶è¡Œæ¶ˆè´¹ã€‚</li></ul></li><li class="lvl-3"><p>é‡å¤æ¶ˆè´¹</p><ul class="lvl-2"><li class="lvl-6">æ ¹æº: ç½‘ç»œæŠ–åŠ¨ï¼ˆæ¶ˆè´¹è€…ç¡®è®¤æ¶ˆæ¯å‰æ–­å¼€è¿æ¥ï¼Œæ¶ˆæ¯é‡å›PELï¼‰</li><li class="lvl-6">è§£å†³æ–¹æ¡ˆ: æ¶ˆæ¯å¹‚ç­‰æ€§ï¼ˆç”Ÿäº§è€…ç»™æ¶ˆæ¯åŠ å”¯ä¸€æ ‡è¯†ï¼Œæ¶ˆè´¹è€…æ ¹æ®å”¯ä¸€æ ‡è¯†å»é‡ï¼‰ã€‚</li></ul></li><li class="lvl-3"><p>é˜»å¡è¶…æ—¶ï¼šæ¶ˆè´¹ç«¯ç”¨BLOCKé˜»å¡æ‹‰å–ï¼Œè¶…æ—¶æ—¶é—´å»ºè®®è®¾ä¸º3-5ç§’ï¼Œé¿å…é¢‘ç¹ç©ºè½®è¯¢å ç”¨CPUï¼ŒåŒæ—¶ä¿è¯æ–°æ¶ˆæ¯çš„å“åº”é€Ÿåº¦ã€‚</p></li></ol><h2 id="å…¸å‹åº”ç”¨åœºæ™¯">å…¸å‹åº”ç”¨åœºæ™¯</h2><h3 id="åˆ†å¸ƒå¼ä¸šåŠ¡è§£è€¦ï¼ˆè®¢å•-åº“å­˜-æ”¯ä»˜-ç‰©æµè§£è€¦ï¼‰">åˆ†å¸ƒå¼ä¸šåŠ¡è§£è€¦ï¼ˆè®¢å•-åº“å­˜-æ”¯ä»˜-ç‰©æµè§£è€¦ï¼‰</h3><blockquote><p>æ ¸å¿ƒæ€è·¯ï¼šå• Stream å¯¹åº”æ ¸å¿ƒä¸šåŠ¡ï¼ˆè®¢å•ï¼‰ï¼Œåº“å­˜ã€æ”¯ä»˜ã€ç‰©æµå„åˆ›å»ºç‹¬ç«‹æ¶ˆè´¹ç»„ï¼Œå„è‡ªæ¶ˆè´¹äº’ä¸å¹²æ‰°ï¼Œå®ç°ä¸šåŠ¡è§£è€¦ã€‚</p></blockquote><ol><li class="lvl-3"><p>ç”Ÿäº§è€…ï¼ˆè®¢å•æœåŠ¡ï¼‰ï¼šå†™å…¥è®¢å•å®Œæˆæ¶ˆæ¯</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯IDï¼Œå†™å…¥è®¢å•æ ¸å¿ƒä¿¡æ¯ï¼Œè®¾ç½®é˜Ÿåˆ—æœ€å¤§1ä¸‡æ¡æ¶ˆæ¯ï¼ˆè¿‘ä¼¼æ·˜æ±°ï¼‰</span></span><br><span class="line">XADD order_core_stream * MAXLEN ~ 10000 order_no ORD20251220001 uid 1001 amount 299 status created create_time 1734567890</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>åˆ›å»º3ä¸ªç‹¬ç«‹æ¶ˆè´¹ç»„ï¼ˆåº“å­˜/æ”¯ä»˜/ç‰©æµï¼‰</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº“å­˜æ¶ˆè´¹ç»„ï¼šä»æœ€æ–°æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ï¼Œé˜Ÿåˆ—ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º</span></span><br><span class="line">XGROUP CREATE order_core_stream group_stock $ MKSTREAM</span><br><span class="line"><span class="comment"># æ”¯ä»˜æ¶ˆè´¹ç»„</span></span><br><span class="line">XGROUP CREATE order_core_stream group_pay $ MKSTREAM</span><br><span class="line"><span class="comment"># ç‰©æµæ¶ˆè´¹ç»„</span></span><br><span class="line">XGROUP CREATE order_core_stream group_logistics $ MKSTREAM</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>å„æ¶ˆè´¹ç»„æ¶ˆè´¹è€…æ‹‰å–+ç¡®è®¤æ¶ˆæ¯</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº“å­˜æœåŠ¡æ¶ˆè´¹è€…ï¼ˆconsumer_stock1ï¼‰æ‹‰å–3æ¡æœªæ¶ˆè´¹æ¶ˆæ¯ï¼Œé˜»å¡5ç§’</span></span><br><span class="line">XREADGROUP GROUP group_stock consumer_stock1 COUNT 3 BLOCK 5000 STREAMS order_core_stream &gt;</span><br><span class="line"><span class="comment"># åº“å­˜å¤„ç†å®Œæˆåç¡®è®¤æ¶ˆæ¯ï¼ˆæ›¿æ¢ä¸ºå®é™…æ‹‰å–åˆ°çš„æ¶ˆæ¯IDï¼‰</span></span><br><span class="line">XACK order_core_stream group_stock 1734567890000-0 1734567890001-0</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”¯ä»˜æœåŠ¡æ¶ˆè´¹è€…ï¼ˆconsumer_pay1ï¼‰åŒç†</span></span><br><span class="line">XREADGROUP GROUP group_pay consumer_pay1 COUNT 3 BLOCK 5000 STREAMS order_core_stream &gt;</span><br><span class="line">XACK order_core_stream group_pay 1734567890000-0 1734567890001-0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‰©æµæœåŠ¡æ¶ˆè´¹è€…ï¼ˆconsumer_log1ï¼‰åŒç†</span></span><br><span class="line">XREADGROUP GROUP group_logistics consumer_log1 COUNT 3 BLOCK 5000 STREAMS order_core_stream &gt;</span><br><span class="line">XACK order_core_stream group_logistics 1734567890000-0 1734567890001-0</span><br></pre></td></tr></table></figure><h3 id="å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆç”¨æˆ·æ³¨å†Œ-é‚®ä»¶-çŸ­ä¿¡-ç§¯åˆ†å¼‚æ­¥æ‰§è¡Œï¼‰">å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆç”¨æˆ·æ³¨å†Œ-é‚®ä»¶/çŸ­ä¿¡/ç§¯åˆ†å¼‚æ­¥æ‰§è¡Œï¼‰</h3><blockquote><p>æ ¸å¿ƒæ€è·¯ï¼šæ³¨å†Œæ¥å£åªè´Ÿè´£å†™å…¥ Stream æ¶ˆæ¯ï¼Œæ— éœ€ç­‰å¾…åç»­ä»»åŠ¡å®Œæˆï¼Œå•æ¶ˆè´¹ç»„å¤šæ¶ˆè´¹è€…æå‡å¼‚æ­¥ä»»åŠ¡å¤„ç†æ•ˆç‡ï¼Œæ ¸å¿ƒæ˜¯å¿«é€Ÿå“åº”å‰ç«¯ã€‚</p></blockquote><ol><li class="lvl-3"><p>ç”Ÿäº§è€…ï¼ˆæ³¨å†ŒæœåŠ¡ï¼‰ï¼šç”¨æˆ·æ³¨å†ŒæˆåŠŸåå†™å…¥æ¶ˆæ¯</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†™å…¥ç”¨æˆ·æ³¨å†Œä¿¡æ¯ï¼ŒMAXLENé™åˆ¶5000æ¡ï¼Œé¿å…ç§¯å‹è¿‡å¤šæ— æ•ˆæ³¨å†Œæ¶ˆæ¯</span></span><br><span class="line">XADD user_register_stream * MAXLEN ~ 5000 uid 1001 username zhangsan phone 13800138000 email zs@xxx.com reg_time 1734567900</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>åˆ›å»ºå•ä¸ªæ¶ˆè´¹ç»„ï¼ˆç»Ÿä¸€å¤„ç†æ³¨å†Œåç»­ä»»åŠ¡ï¼‰</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP CREATE user_register_stream group_reg_task $ MKSTREAM</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>å¤šæ¶ˆè´¹è€…å¹¶è¡Œæ‹‰å–ï¼ˆé‚®ä»¶/çŸ­ä¿¡/ç§¯åˆ†å„1ä¸ªæ¶ˆè´¹è€…ï¼Œæˆ–å¤šå®ä¾‹æ‰©å®¹ï¼‰</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># çŸ­ä¿¡å‘é€æ¶ˆè´¹è€…ï¼ˆconsumer_smsï¼‰</span></span><br><span class="line">XREADGROUP GROUP group_reg_task consumer_sms COUNT 5 BLOCK 3000 STREAMS user_register_stream &gt;</span><br><span class="line">XACK user_register_stream group_reg_task æ¶ˆæ¯ID1 æ¶ˆæ¯ID2</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‚®ä»¶å‘é€æ¶ˆè´¹è€…ï¼ˆconsumer_emailï¼‰</span></span><br><span class="line">XREADGROUP GROUP group_reg_task consumer_email COUNT 5 BLOCK 3000 STREAMS user_register_stream &gt;</span><br><span class="line">XACK user_register_stream group_reg_task æ¶ˆæ¯ID1 æ¶ˆæ¯ID2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§¯åˆ†å‘æ”¾æ¶ˆè´¹è€…ï¼ˆconsumer_scoreï¼‰</span></span><br><span class="line">XREADGROUP GROUP group_reg_task consumer_score COUNT 5 BLOCK 3000 STREAMS user_register_stream &gt;</span><br><span class="line">XACK user_register_stream group_reg_task æ¶ˆæ¯ID1 æ¶ˆæ¯ID2</span><br></pre></td></tr></table></figure><h3 id="æ—¥å¿—æ”¶é›†ï¼ˆç³»ç»Ÿå®æ—¶æ—¥å¿—-åˆ†æ-å‘Šè­¦ï¼‰">æ—¥å¿—æ”¶é›†ï¼ˆç³»ç»Ÿå®æ—¶æ—¥å¿—-åˆ†æ/å‘Šè­¦ï¼‰</h3><blockquote><p>æ ¸å¿ƒæ€è·¯ï¼šå„ä¸šåŠ¡ç³»ç»Ÿå®æ—¶å†™å…¥æ—¥å¿—åˆ° Streamï¼Œå¤šæ¶ˆè´¹ç»„åˆ†åˆ«åšæ—¥å¿—åˆ†æã€å®æ—¶å‘Šè­¦ï¼Œå…¼é¡¾å®æ—¶æ€§ä¸æ•°æ®ç•™å­˜ï¼Œæ”¯æŒå†å²æ—¥å¿—å›æº¯ã€‚</p></blockquote><ol><li class="lvl-3"><p>ç”Ÿäº§è€…ï¼ˆå„ä¸šåŠ¡ç³»ç»Ÿï¼‰ï¼šå®æ—¶å†™å…¥ç³»ç»Ÿæ—¥å¿—ï¼ˆæŒ‰çº§åˆ«/ä¸šåŠ¡åˆ†ç±»ï¼Œè¿™é‡Œç»Ÿä¸€å†™å…¥æ€»æ—¥å¿—æµï¼‰</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†™å…¥æ—¥å¿—ï¼šåŒ…å«ä¸šåŠ¡æ¨¡å—ã€æ—¥å¿—çº§åˆ«ã€å†…å®¹ã€æ—¶é—´ï¼Œæ— æ¶ˆæ¯æ•°é‡ä¸Šé™ï¼ˆæŒ‰å®é™…æœåŠ¡å™¨å†…å­˜è°ƒæ•´MAXLENï¼‰</span></span><br><span class="line">XADD sys_log_stream * module order_service level ERROR content <span class="string">&quot;åº“å­˜æ‰£å‡å¤±è´¥ï¼Œè®¢å•å·ORD20251220001&quot;</span> log_time 1734567910</span><br><span class="line">XADD sys_log_stream * module pay_service level INFO content <span class="string">&quot;æ”¯ä»˜æˆåŠŸï¼Œuid1001ï¼Œé‡‘é¢299&quot;</span> log_time 1734567912</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>åˆ›å»º2ä¸ªæ¶ˆè´¹ç»„ï¼ˆæ—¥å¿—åˆ†æ+å®æ—¶å‘Šè­¦ï¼‰</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¥å¿—åˆ†ææ¶ˆè´¹ç»„ï¼ˆç”¨äºç¦»çº¿ç»Ÿè®¡ã€æ•°æ®å½’æ¡£ï¼‰ï¼Œä»é˜Ÿåˆ—å¼€å¤´æ¶ˆè´¹ï¼ˆ0-0ï¼‰ï¼Œå…œåº•æ‰€æœ‰å†å²æ—¥å¿—</span></span><br><span class="line">XGROUP CREATE sys_log_stream group_log_analysis 0-0 MKSTREAM</span><br><span class="line"><span class="comment"># å®æ—¶å‘Šè­¦æ¶ˆè´¹ç»„ï¼ˆç”¨äºå®æ—¶æ•è·ERRORæ—¥å¿—å‘Šè­¦ï¼‰ï¼Œä»æœ€æ–°æ¶ˆæ¯æ¶ˆè´¹</span></span><br><span class="line">XGROUP CREATE sys_log_stream group_log_alert $ MKSTREAM</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>å¯¹åº”æ¶ˆè´¹è€…æ‹‰å–å¤„ç†</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¥å¿—åˆ†ææ¶ˆè´¹è€…ï¼ˆæ‰¹é‡æ‹‰å–ï¼Œéé˜»å¡ï¼Œé€‚åˆç¦»çº¿å¤„ç†ï¼‰</span></span><br><span class="line">XREADGROUP GROUP group_log_analysis consumer_analysis COUNT 100 STREAMS sys_log_stream &gt;</span><br><span class="line">XACK sys_log_stream group_log_analysis æ‰¹é‡æ¶ˆæ¯ID...</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘Šè­¦æ¶ˆè´¹è€…ï¼ˆé˜»å¡æ‹‰å–ï¼Œå¿«é€Ÿå“åº”ï¼Œåªå¤„ç†ERRORçº§åˆ«æ—¥å¿—ï¼‰</span></span><br><span class="line">XREADGROUP GROUP group_log_alert consumer_alert BLOCK 0 STREAMS sys_log_stream &gt;  <span class="comment"># BLOCK 0 æ°¸ä¹…é˜»å¡ï¼Œæœ‰æ¶ˆæ¯ç«‹å³è¿”å›</span></span><br><span class="line">XACK sys_log_stream group_log_alert å‘Šè­¦æ¶ˆæ¯ID</span><br></pre></td></tr></table></figure><h3 id="é™æµå‰Šå³°ï¼ˆç§’æ€åœºæ™¯-è¯·æ±‚å‰Šå³°å¡«è°·ï¼‰">é™æµå‰Šå³°ï¼ˆç§’æ€åœºæ™¯-è¯·æ±‚å‰Šå³°å¡«è°·ï¼‰</h3><blockquote><p>æ ¸å¿ƒæ€è·¯ï¼šç§’æ€è¯·æ±‚é«˜å³°æ—¶ï¼Œå…ˆå†™å…¥ Stream åšç¼“å†²ï¼Œæ¶ˆè´¹ç«¯åŒ€é€Ÿæ‹‰å–ï¼ˆæ§åˆ¶æ¯ç§’å¤„ç†é‡ï¼‰ï¼Œé¿å…ä¸‹æ¸¸æ•°æ®åº“/ä¸šåŠ¡æœåŠ¡è¢«å‹å®ï¼Œæ ¸å¿ƒæ˜¯â€œæ…¢æ¶ˆè´¹ã€ç¨³å¤„ç†â€ã€‚</p></blockquote><ol><li class="lvl-3"><p>ç”Ÿäº§è€…ï¼ˆç§’æ€å…¥å£æœåŠ¡ï¼‰ï¼šæ¥æ”¶ç§’æ€è¯·æ±‚ï¼Œç›´æ¥å†™å…¥ Streamï¼Œå¿«é€Ÿè¿”å›â€œæ’é˜Ÿä¸­â€</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†™å…¥ç§’æ€è¯·æ±‚ï¼Œè®¾ç½®MAXLEN 10000ï¼ˆé™åˆ¶æœ€å¤§æ’é˜Ÿæ•°ï¼Œè¶…è¿‡åˆ™æ‹’ç»ï¼Œé¿å…OOMï¼‰</span></span><br><span class="line">XADD seckill_stream * MAXLEN ~ 10000 seckill_id 101 uid 1001 request_time 1734568000</span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>åˆ›å»ºæ¶ˆè´¹ç»„ï¼ˆå•æ¶ˆè´¹ç»„+å¤šæ¶ˆè´¹è€…ï¼Œæ§åˆ¶æ€»å¤„ç†é€Ÿç‡ï¼‰</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP CREATE seckill_stream group_seckill $ MKSTREAM</span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>æ¶ˆè´¹ç«¯ï¼ˆåŒ€é€Ÿæ‹‰å–ï¼Œæ ¸å¿ƒæ˜¯æ§åˆ¶COUNTå’Œæ¶ˆè´¹é¢‘ç‡ï¼Œæ¯”å¦‚æ¯ç§’å¤„ç†100æ¡ï¼‰</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¶ˆè´¹è€…ï¼ˆå¤šå®ä¾‹éƒ¨ç½²ï¼Œæ€»å¤„ç†é‡=å•å®ä¾‹COUNTÃ—å®ä¾‹æ•°ï¼Œè¿™é‡Œå•å®ä¾‹æ¯æ¬¡æ‹‰10æ¡ï¼Œæ¯ç§’æ‹‰10æ¬¡ï¼Œå•å®ä¾‹æ¯ç§’å¤„ç†100æ¡ï¼‰</span></span><br><span class="line">XREADGROUP GROUP group_seckill consumer_seckill1 COUNT 10 BLOCK 100 STREAMS seckill_stream &gt;</span><br><span class="line"><span class="comment"># ä¸šåŠ¡å¤„ç†ï¼šæ‰£åº“å­˜ã€ç”Ÿæˆè®¢å•ï¼ˆæ ¸å¿ƒæ˜¯å¤„ç†é€»è¾‘åŒæ­¥æ‰§è¡Œï¼Œæ§åˆ¶é€Ÿç‡ï¼‰</span></span><br><span class="line">XACK seckill_stream group_seckill ç§’æ€è¯·æ±‚æ¶ˆæ¯ID...</span><br></pre></td></tr></table></figure><blockquote><p>å…³é”®ä¼˜åŒ–ï¼šæ¶ˆè´¹ç«¯é€šè¿‡å®šæ—¶ä»»åŠ¡+å›ºå®šCOUNTæ‹‰å–ï¼Œè€Œéæ— é™æ‹‰å–ï¼Œç²¾å‡†æ§åˆ¶å¤„ç†é€Ÿç‡ï¼Œå®ç°å‰Šå³°å¡«è°·ã€‚</p></blockquote><h2 id="ä¸å…¶ä»–-Redis-é˜Ÿåˆ—æ–¹æ¡ˆå¯¹æ¯”ï¼ˆæ ¸å¿ƒä¼˜åŠ¿ï¼‰">ä¸å…¶ä»– Redis é˜Ÿåˆ—æ–¹æ¡ˆå¯¹æ¯”ï¼ˆæ ¸å¿ƒä¼˜åŠ¿ï¼‰</h2><p>â€¢ å¯¹æ¯” List<br>- List æ˜¯ç®€å•çš„å…ˆè¿›å…ˆå‡ºï¼Œä¸æ”¯æŒå¤šæ’­ï¼ˆå¤šä¸ªæ¶ˆè´¹è€…ä¼šæŠ¢æ¶ˆæ¯ï¼‰ã€æ— æ¶ˆè´¹ç»„ã€æ— æ¶ˆæ¯ç¡®è®¤ï¼Œä»…é€‚åˆç®€å•ä¸€å¯¹ä¸€é˜Ÿåˆ—ï¼›<br>- Stream æ”¯æŒå¤šæ’­+æ¶ˆè´¹ç»„+ç¡®è®¤æœºåˆ¶ï¼Œé€‚åˆå¤æ‚åˆ†å¸ƒå¼åœºæ™¯ã€‚</p><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>Stream</th><th>List</th></tr></thead><tbody><tr><td>æ¶ˆè´¹è€…ç»„</td><td>âœ…</td><td>âŒ</td></tr><tr><td>ACK</td><td>âœ…</td><td>âŒ</td></tr><tr><td>é‡è¯•</td><td>âœ…</td><td>âŒ</td></tr><tr><td>é˜»å¡</td><td>âœ…</td><td>âœ…</td></tr><tr><td>é¡ºåºæ€§</td><td>å¼º</td><td>å¼º</td></tr></tbody></table><p>â€¢ å¯¹æ¯” Pub/Sub<br>- Pub/Sub æ— æŒä¹…åŒ–ï¼ŒRedis é‡å¯æˆ–æ¶ˆè´¹è€…ç¦»çº¿ä¼šä¸¢æ¶ˆæ¯ï¼›<br>- Pub/Sub æ— æ¶ˆè´¹ç»„ï¼Œæ¶ˆæ¯å‘å®Œå³ä¸¢ï¼Œä»…é€‚åˆå®æ—¶å¹¿æ’­ï¼ˆå¦‚èŠå¤©å®¤ï¼‰ï¼Œä¸é€‚åˆé‡è¦ä¸šåŠ¡ã€‚</p><h2 id="Stream-å‘½ä»¤">Stream å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p>SpringBoot çš„ <code>StringRedisTemplate.opsForStream()</code> ä¸­ Stream æ•°æ®ç±»å‹ çš„æ“ä½œæ–¹æ³•ä¸ Redis åŸç”Ÿå‘½ä»¤çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p></li></ul><blockquote><p>æ³¨æ„è¿™é‡Œä¸ä¸€å®šè¦ç”¨ <code>StringRedisTemplate</code> æ¥æ“ä½œ Streamï¼Œä½†æ˜¯ç”¨ <code>StringRedisTemplate</code> å¯ä»¥ä¿è¯å¯è¯»æ€§ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>æ ¸å¿ƒèƒ½åŠ›åˆ’åˆ†ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æ¶ˆæ¯å†™å…¥ï¼ˆXADDï¼‰</span><br><span class="line">æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰</span><br><span class="line">æ¶ˆæ¯è¯»å–ï¼ˆXRANGE / XREAD / XREADGROUPï¼‰</span><br><span class="line">Pending æ¶ˆæ¯ç®¡ç†ï¼ˆXPENDING / XCLAIMï¼‰</span><br><span class="line">æ¶ˆè´¹è€…ç»„ç®¡ç†ï¼ˆXGROUPï¼‰</span><br><span class="line">Stream å…ƒä¿¡æ¯ï¼ˆXINFOï¼‰</span><br><span class="line">Stream è£å‰ªä¸åˆ é™¤ï¼ˆXTRIM / XDELï¼‰</span><br><span class="line">å¯¹è±¡æ˜ å°„ï¼ˆMapRecord / ObjectRecordï¼‰</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯å†™å…¥ï¼ˆXADDï¼‰">æ¶ˆæ¯å†™å…¥ï¼ˆXADDï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>1ï¸âƒ£ åŸºç¡€å†™å…¥</p></li></ul><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³• <code>opsForStream().xxx()</code></th><th>Redis åŸå§‹å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å†™å…¥ Map</td><td><code>add(K key, Map&lt;HK,HV&gt;)</code></td><td><code>XADD key * field value</code></td><td>è‡ªåŠ¨ç”Ÿæˆ ID</td></tr><tr><td>å†™å…¥ Record</td><td><code>add(Record&lt;K, ?&gt; record)</code></td><td><code>XADD</code></td><td>æ”¯æŒ ObjectRecord</td></tr><tr><td>å†™å…¥ MapRecord</td><td><code>add(MapRecord&lt;K,HK,HV&gt;)</code></td><td><code>XADD</code></td><td>Map å½¢å¼</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>2ï¸âƒ£ å¸¦å‚æ•°å†™å…¥ï¼ˆæ¨èï¼‰</p></li></ul><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³•</th><th>Redis åŸå§‹å‘½ä»¤</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>å†™å…¥ + é€‰é¡¹</td><td><code>add(record, XAddOptions)</code></td><td><code>XADD ...</code></td><td>æ”¯æŒ MAXLEN / NOMKSTREAM</td></tr><tr><td>Map + é€‰é¡¹</td><td><code>add(key, map, XAddOptions)</code></td><td><code>XADD</code></td><td>Redis â‰¥ 6</td></tr></tbody></table><h3 id="æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰">æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰</h3><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³•</th><th>Redis åŸå§‹å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ç¡®è®¤æ¶ˆæ¯</td><td><code>acknowledge(key, group, recordIdsâ€¦)</code></td><td><code>XACK</code></td><td>æ ‡è®°å·²æ¶ˆè´¹</td></tr><tr><td>Record ç¡®è®¤</td><td><code>acknowledge(group, record)</code></td><td><code>XACK</code></td><td>å¸¸ç”¨</td></tr></tbody></table><blockquote><p>âš ï¸ åªå¯¹ Consumer Group ç”Ÿæ•ˆ</p></blockquote><h3 id="æ¶ˆæ¯è¯»å–ï¼ˆæ— æ¶ˆè´¹è€…ç»„ï¼‰">æ¶ˆæ¯è¯»å–ï¼ˆæ— æ¶ˆè´¹è€…ç»„ï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>1ï¸âƒ£ æŒ‰ Range è¯»å–ï¼ˆå†å²æ•°æ®ï¼‰</p></li></ul><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³•</th><th>Redis åŸå§‹å‘½ä»¤</th></tr></thead><tbody><tr><td>æ­£åºè¯»å–</td><td><code>range(key, range)</code></td><td><code>XRANGE</code></td></tr><tr><td>é™åˆ¶æ¡æ•°</td><td><code>range(key, range, limit)</code></td><td><code>XRANGE</code></td></tr><tr><td>ååºè¯»å–</td><td><code>reverseRange(key, range)</code></td><td><code>XREVRANGE</code></td></tr><tr><td>ååº + limit</td><td><code>reverseRange(key, range, limit)</code></td><td><code>XREVRANGE</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>2ï¸âƒ£ å®æ—¶è¯»å–ï¼ˆXREADï¼‰</p></li></ul><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³•</th><th>Redis åŸå§‹å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è¯»å–</td><td><code>read(StreamOffsetâ€¦)</code></td><td><code>XREAD</code></td><td>ä¸æ”¯æŒ ACK</td></tr><tr><td>å¸¦å‚æ•°</td><td><code>read(options, offsetsâ€¦)</code></td><td><code>XREAD</code></td><td>BLOCK / COUNT</td></tr><tr><td>æ˜ å°„å¯¹è±¡</td><td><code>read(Class&lt;T&gt;, â€¦)</code></td><td><code>XREAD</code></td><td>è‡ªåŠ¨ååºåˆ—åŒ–</td></tr></tbody></table><h3 id="æ¶ˆè´¹è€…ç»„è¯»å–ï¼ˆXREADGROUPï¼‰">æ¶ˆè´¹è€…ç»„è¯»å–ï¼ˆXREADGROUPï¼‰</h3><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³•</th><th>Redis åŸå§‹å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ç»„å†…è¯»å–</td><td><code>read(Consumer, offsetsâ€¦)</code></td><td><code>XREADGROUP</code></td><td>MQ æ ¸å¿ƒ</td></tr><tr><td>å¸¦å‚æ•°</td><td><code>read(Consumer, options, offsetsâ€¦)</code></td><td><code>XREADGROUP</code></td><td>BLOCK</td></tr><tr><td>æ˜ å°„å¯¹è±¡</td><td><code>read(Class&lt;T&gt;, Consumer, â€¦)</code></td><td><code>XREADGROUP</code></td><td>â€”</td></tr></tbody></table><h3 id="Pending-æ¶ˆæ¯ç®¡ç†ï¼ˆXPENDING-XCLAIMï¼‰">Pending æ¶ˆæ¯ç®¡ç†ï¼ˆXPENDING / XCLAIMï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>1ï¸âƒ£ Pending æŸ¥è¯¢</p></li></ul><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³•</th><th>Redis åŸå§‹å‘½ä»¤</th></tr></thead><tbody><tr><td>Pending æ±‡æ€»</td><td><code>pending(key, group)</code></td><td><code>XPENDING</code></td></tr><tr><td>æŒ‡å®šæ¶ˆè´¹è€…</td><td><code>pending(key, consumer)</code></td><td><code>XPENDING</code></td></tr><tr><td>èŒƒå›´æŸ¥è¯¢</td><td><code>pending(key, group, range, count)</code></td><td><code>XPENDING</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>2ï¸âƒ£ æ¶ˆæ¯é‡æ–°åˆ†é…ï¼ˆXCLAIMï¼‰</p></li></ul><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³•</th><th>Redis åŸå§‹å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>é‡æ–°åˆ†é…</td><td><code>claim(key, group, newOwner, minIdle, idsâ€¦)</code></td><td><code>XCLAIM</code></td><td>è¶…æ—¶æ¥ç®¡</td></tr><tr><td>é«˜çº§é…ç½®</td><td><code>claim(key, group, newOwner, XClaimOptions)</code></td><td><code>XCLAIM</code></td><td>force / retry</td></tr></tbody></table><h3 id="æ¶ˆè´¹è€…ç»„ç®¡ç†ï¼ˆXGROUPï¼‰">æ¶ˆè´¹è€…ç»„ç®¡ç†ï¼ˆXGROUPï¼‰</h3><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³•</th><th>Redis åŸå§‹å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åˆ›å»ºç»„</td><td><code>createGroup(key, group)</code></td><td><code>XGROUP CREATE</code></td><td>ä» <code>$</code> å¼€å§‹</td></tr><tr><td>æŒ‡å®š offset</td><td><code>createGroup(key, offset, group)</code></td><td><code>XGROUP CREATE</code></td><td>å¸¸ç”¨ <code>0-0</code></td></tr><tr><td>åˆ é™¤æ¶ˆè´¹è€…</td><td><code>deleteConsumer(key, consumer)</code></td><td><code>XGROUP DELCONSUMER</code></td><td></td></tr><tr><td>é”€æ¯ç»„</td><td><code>destroyGroup(key, group)</code></td><td><code>XGROUP DESTROY</code></td><td></td></tr></tbody></table><h3 id="Stream-å…ƒä¿¡æ¯ï¼ˆXINFOï¼‰">Stream å…ƒä¿¡æ¯ï¼ˆXINFOï¼‰</h3><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³•</th><th>Redis åŸå§‹å‘½ä»¤</th></tr></thead><tbody><tr><td>Stream ä¿¡æ¯</td><td><code>info(key)</code></td><td><code>XINFO STREAM</code></td></tr><tr><td>ç»„ä¿¡æ¯</td><td><code>groups(key)</code></td><td><code>XINFO GROUPS</code></td></tr><tr><td>æ¶ˆè´¹è€…ä¿¡æ¯</td><td><code>consumers(key, group)</code></td><td><code>XINFO CONSUMERS</code></td></tr></tbody></table><h3 id="Stream-åˆ é™¤-è£å‰ª">Stream åˆ é™¤ / è£å‰ª</h3><ul class="lvl-0"><li class="lvl-2"><p>1ï¸âƒ£ åˆ é™¤æ¶ˆæ¯</p></li></ul><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³•</th><th>Redis åŸå§‹å‘½ä»¤</th></tr></thead><tbody><tr><td>åˆ é™¤æ¶ˆæ¯</td><td><code>delete(key, recordIdsâ€¦)</code></td><td><code>XDEL</code></td></tr><tr><td>åˆ é™¤ Record</td><td><code>delete(record)</code></td><td><code>XDEL</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>2ï¸âƒ£ è£å‰ª Streamï¼ˆXTRIMï¼‰</p></li></ul><table><thead><tr><th>æ–¹æ³•åŠŸèƒ½</th><th>æ–¹æ³•</th><th>Redis åŸå§‹å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ç²¾ç¡®è£å‰ª</td><td><code>trim(key, count)</code></td><td><code>XTRIM</code></td><td></td></tr><tr><td>è¿‘ä¼¼è£å‰ª</td><td><code>trim(key, count, true)</code></td><td><code>XTRIM ~</code></td><td>æ€§èƒ½æ›´å¥½</td></tr></tbody></table><h3 id="å¯¹è±¡æ˜ å°„èƒ½åŠ›ï¼ˆéå¸¸é‡è¦ï¼‰">å¯¹è±¡æ˜ å°„èƒ½åŠ›ï¼ˆéå¸¸é‡è¦ï¼‰</h3><table><thead><tr><th>èƒ½åŠ›</th><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Map â†’ Object</td><td><code>map(MapRecord, Class&lt;T&gt;)</code></td><td>è‡ªåŠ¨ååºåˆ—åŒ–</td></tr><tr><td>List æ˜ å°„</td><td><code>map(List&lt;MapRecord&gt;, Class&lt;T&gt;)</code></td><td></td></tr><tr><td>HashMapper</td><td><code>getHashMapper(Class&lt;T&gt;)</code></td><td>è‡ªå®šä¹‰æ˜ å°„</td></tr><tr><td>ååºåˆ—åŒ–</td><td><code>deserializeRecord(ByteRecord)</code></td><td>åº•å±‚èƒ½åŠ›</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡ä»‹ç» Redis Stream æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;ï¼Œ&lt;code&gt;springboot-3.5.8&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis å‘½ä»¤æ–‡æ¡£ï¼š&lt;a href=&quot;https://redis.io/docs/latest/commands/&quot;&gt;https://redis.io/docs/latest/commands/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
</feed>
