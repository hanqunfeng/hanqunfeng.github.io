<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£˜é€¸å³°çš„åšå®¢</title>
  
  <subtitle>Spring--Javaç¨‹åºå‘˜çš„æ˜¥å¤©</subtitle>
  <link href="https://blog.hanqunfeng.com/atom.xml" rel="self"/>
  
  <link href="https://blog.hanqunfeng.com/"/>
  <updated>2025-10-17T10:37:19.074Z</updated>
  <id>https://blog.hanqunfeng.com/</id>
  
  <author>
    <name>é£˜é€¸å³°</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Kafka ä» Zookeeper è¿ç§»åˆ° KRaft</title>
    <link href="https://blog.hanqunfeng.com/2025/10/16/kafka-06-zk-to-kraft/"/>
    <id>https://blog.hanqunfeng.com/2025/10/16/kafka-06-zk-to-kraft/</id>
    <published>2025-10-16T14:30:05.000Z</published>
    <updated>2025-10-17T10:37:19.074Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» å¦‚ä½•å°† Kafka é›†ç¾¤ä» Zookeeper æ¨¡å¼è¿ç§»åˆ° KRaft æ¨¡å¼</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org">Kafkaå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p></li></ul><span id="more"></span><h2 id="ä»-Zookeeper-æ¨¡å¼è¿ç§»åˆ°-KRaft-æ¨¡å¼ï¼ˆå¹³æ»‘è¿ç§»ï¼‰">ä» Zookeeper æ¨¡å¼è¿ç§»åˆ° KRaft æ¨¡å¼ï¼ˆå¹³æ»‘è¿ç§»ï¼‰</h2><ul class="lvl-0"><li class="lvl-2"><p>Kafka å®˜æ–¹åœ¨ 3.4+ å¼•å…¥äº†å®Œæ•´çš„ Zookeeper â†’ KRaft å¹³æ»‘è¿ç§»æœºåˆ¶ï¼Œç§°ä¸º <code>ZK to KRaft (ZkMigration)</code>ã€‚</p></li><li class="lvl-2"><p>è¿ç§»èƒŒæ™¯ä¸å‰æ</p></li></ul><table><thead><tr><th style="text-align:left">é¡¹ç›®</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">æ”¯æŒç‰ˆæœ¬</td><td style="text-align:left">Kafka <strong>3.4.0+</strong>ï¼ˆå»ºè®®è‡³å°‘ä½¿ç”¨ <strong>3.6.x ï¼Œç›®å‰æœ€æ–°ç‰ˆä¸º 3.9.x</strong>ï¼‰</td></tr><tr><td style="text-align:left">è¿ç§»ç›®çš„</td><td style="text-align:left">æ‘†è„± ZooKeeperï¼Œå®Œå…¨åˆ‡æ¢ä¸º KRaft è‡ªç®¡ç†æ¨¡å¼</td></tr><tr><td style="text-align:left">è¿ç§»æ¨¡å¼</td><td style="text-align:left"><strong>åœ¨çº¿è¿ç§»</strong>ï¼ˆæ— åœæœºæˆ–æœ€å°åœæœºï¼‰</td></tr><tr><td style="text-align:left">æœ€ç»ˆç›®æ ‡</td><td style="text-align:left">Kafka çš„æ§åˆ¶å™¨ä¸å…ƒæ•°æ®å®Œå…¨ç”± KRaft ç®¡ç†ï¼Œä¸å†ä¾èµ– ZooKeeperã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ•´ä½“è¿ç§»æµç¨‹æ¦‚è§ˆ</p></li></ul><table><thead><tr><th>é˜¶æ®µ</th><th>æ§åˆ¶å™¨ç±»å‹</th><th>Broker æ¨¡å¼</th><th>ZooKeeper è§’è‰²</th><th>KRaft è§’è‰²</th><th>ç‰¹å¾è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åˆå§‹é˜¶æ®µ</strong></td><td>ZooKeeper æ§åˆ¶å™¨</td><td>å…¨éƒ¨ä¸º ZK æ¨¡å¼</td><td>ç®¡ç†æ‰€æœ‰å…ƒæ•°æ®</td><td>å°šæœªå¯ç”¨</td><td>æ‰€æœ‰ Broker éƒ½è¿è¡Œåœ¨ ZK æ¨¡å¼ä¸‹ï¼Œç”± ZK æ§åˆ¶å™¨ç®¡ç†é›†ç¾¤ã€‚</td></tr><tr><td><strong>åˆå§‹å…ƒæ•°æ®åŠ è½½é˜¶æ®µ</strong></td><td>KRaft æ§åˆ¶å™¨å¼€å§‹åŠ è½½</td><td>éƒ¨åˆ†ï¼ˆæˆ–å…¨éƒ¨ï¼‰ä»ä¸º ZK æ¨¡å¼</td><td>æä¾›å…ƒæ•°æ®æº</td><td>ä» ZK åŠ è½½å…ƒæ•°æ®</td><td>KRaft æ³•å®šèŠ‚ç‚¹ï¼ˆcontroller.quorum.votersï¼‰ä» ZK ä¸­è¯»å–å¹¶åŒæ­¥å½“å‰é›†ç¾¤å…ƒæ•°æ®ã€‚</td></tr><tr><td><strong>æ··åˆé˜¶æ®µ</strong></td><td>KRaft æ§åˆ¶å™¨</td><td>éƒ¨åˆ† ZK æ¨¡å¼ï¼Œéƒ¨åˆ† KRaft æ¨¡å¼</td><td>ä¿ç•™åªè¯»å…ƒæ•°æ®</td><td>ç®¡ç†å¹¶æ›´æ–°å…ƒæ•°æ®</td><td>KRaft æ§åˆ¶å™¨æˆä¸ºä¸»æ§ï¼ŒZK ä»å­˜åœ¨ä½†åªæä¾›è¯»å–ï¼ŒBroker å¯å¤„äºä¸åŒæ¨¡å¼ï¼ˆæ··åˆçŠ¶æ€ï¼‰ã€‚</td></tr><tr><td><strong>åŒå†™é˜¶æ®µ</strong></td><td>KRaft æ§åˆ¶å™¨</td><td>å…¨éƒ¨ä¸º KRaft æ¨¡å¼</td><td>æ¥æ”¶ KRaft åŒæ­¥å†™å…¥</td><td>ç®¡ç†å…ƒæ•°æ®å¹¶å†™å…¥ ZK</td><td>æ‰€æœ‰ Broker éƒ½è¿è¡Œåœ¨ KRaft æ¨¡å¼ï¼Œæ§åˆ¶å™¨å°†å…ƒæ•°æ®åŒæ—¶å†™å…¥ ZK å’Œ KRaft æ—¥å¿—ã€‚</td></tr><tr><td><strong>è¿ç§»å®Œæˆé˜¶æ®µ</strong></td><td>KRaft æ§åˆ¶å™¨</td><td>å…¨éƒ¨ä¸º KRaft æ¨¡å¼</td><td>ä¸å†ä½¿ç”¨</td><td>ç‹¬ç«‹è¿è¡Œ</td><td>åœæ­¢å‘ ZK å†™å…¥å…ƒæ•°æ®ï¼ŒZK å¯å®‰å…¨å…³é—­ï¼ŒKafka å®Œå…¨è¿è¡Œåœ¨æ—  Zookeeper çš„ KRaft æ¨¡å¼ä¸‹ã€‚</td></tr></tbody></table><h2 id="å¼€å§‹è¿ç§»">å¼€å§‹è¿ç§»</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œä»¥å‰æ–‡ <a href="/2025/10/13/kafka-01-install-zookeeper/" title="Kafka çš„å®‰è£…ï¼šåŸºäº Zookeeper">Kafka çš„å®‰è£…ï¼šåŸºäº Zookeeper</a> ä¸­çš„3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸ºä¾‹ã€‚</p></li></ul><h3 id="å¯åŠ¨ä¸€ä¸ª-Controller-èŠ‚ç‚¹">å¯åŠ¨ä¸€ä¸ª Controller èŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨ä¸€ä¸ª Controller èŠ‚ç‚¹ï¼Œè¿™é‡Œå‡è®¾ä¸º worker1</p></li><li class="lvl-2"><p>å¯åŠ¨å‰éœ€è¦å…ˆè·å–å½“å‰ Kafka é›†ç¾¤çš„ Cluster ID</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ zookeeper-shell.sh localhost:2181 get /cluster/id</span><br><span class="line">Connecting to localhost:2181</span><br><span class="line"></span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected <span class="built_in">type</span>:None path:null</span><br><span class="line">&#123;<span class="string">&quot;version&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;id&quot;</span>:<span class="string">&quot;hp_Q0pihQ0ORcIvXlfHobQ&quot;</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‡†å¤‡å¥½ Controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œå¯ä»¥ç”¨ <code>config/kraft/controller.properties</code> ä¸ºæ¨¡æ¿è¿›è¡Œä¿®æ”¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ï¼Œè¿™é‡Œåªèƒ½æ˜¯controller</span></span><br><span class="line">process.roles=controller</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹IDï¼Œä¸èƒ½ä¸ç°æœ‰BrokerèŠ‚ç‚¹çš„IDä¸€è‡´</span></span><br><span class="line">node.id=3000</span><br><span class="line"><span class="comment"># é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å½“å‰åªå¯åŠ¨äº†ä¸€ä¸ªcontrollerèŠ‚ç‚¹ï¼Œæ‰€ä»¥åªèƒ½é…ç½®ä¸€ä¸ªæŠ•ç¥¨èŠ‚ç‚¹</span></span><br><span class="line">controller.quorum.bootstrap.servers=worker1:9098</span><br><span class="line"><span class="comment"># é…ç½®ç›‘å¬å™¨ï¼Œæ³¨æ„ç«¯å£ä¸èƒ½é‡å¤</span></span><br><span class="line">listeners=CONTROLLER://:9098</span><br><span class="line">advertised.listeners=CONTROLLER://worker1:9098</span><br><span class="line">controller.listener.names=CONTROLLER</span><br><span class="line"><span class="comment"># æ—¥å¿—å­˜æ”¾ç›®å½•ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯å…ƒæ•°æ®</span></span><br><span class="line">log.dirs=/usr/local/kafka/dataDir/kraft-meta</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹</span></span><br><span class="line">zookeeper.metadata.migration.enable=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ZooKeeper client è¿æ¥</span></span><br><span class="line">zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®š Kafka é›†ç¾¤å†…éƒ¨ï¼ˆbroker ä¸ brokerã€KRaft æ§åˆ¶å™¨ä¸ brokerï¼‰é€šä¿¡æ‰€ä½¿ç”¨çš„ç›‘å¬å™¨ï¼ˆlistenerï¼‰åç§°ã€‚</span></span><br><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œè¦ä¸åŸå…ˆçš„ server.properties ä¸­é…ç½®çš„ç›‘å¬å™¨åç§°ä¸€è‡´</span></span><br><span class="line">inter.broker.listener.name=PLAINTEXT</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¶å®ƒå‚æ•°å°½é‡ä¿æŒä¸æ—§é›†ç¾¤çš„é…ç½®ä¸€è‡´</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ Controller èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -t å‚æ•°æŒ‡å®šé›†ç¾¤çš„ Cluster IDï¼Œå°±æ˜¯å‰é¢è·å–çš„ Cluster ID</span></span><br><span class="line">kafka-storage.sh format --standalone -t hp_Q0pihQ0ORcIvXlfHobQ -c /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">kafka-server-start.sh /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure><h3 id="å°†åŸå…ˆçš„ä¸‰ä¸ªèŠ‚ç‚¹ä½œä¸º-Broker-èŠ‚ç‚¹é‡æ–°å¯åŠ¨">å°†åŸå…ˆçš„ä¸‰ä¸ªèŠ‚ç‚¹ä½œä¸º Broker èŠ‚ç‚¹é‡æ–°å¯åŠ¨</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹åŸå…ˆçš„é…ç½®æ–‡ä»¶ <code>server.properties</code>ï¼Œåªéœ€è¦ä¿®æ”¹å¦‚ä¸‹å†…å®¹å³å¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨æœ€ååŠ å…¥ CONTROLLER:PLAINTEXT</span></span><br><span class="line">listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL,CONTROLLER:PLAINTEXT</span><br><span class="line"></span><br><span class="line"><span class="comment">## ä»¥ä¸‹æ˜¯æ–°åŠ å…¥çš„ é…ç½®é¡¹</span></span><br><span class="line"><span class="comment"># Set the IBP</span></span><br><span class="line">inter.broker.protocol.version=3.9</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹</span></span><br><span class="line">zookeeper.metadata.migration.enable=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># KRaft controller quorum configurationï¼Œå› ä¸ºç›®å‰åªå¯åŠ¨äº†ä¸€ä¸ª controller èŠ‚ç‚¹ï¼Œæ‰€ä»¥åªèƒ½é…ç½®ä¸€ä¸ªæŠ•ç¥¨èŠ‚ç‚¹</span></span><br><span class="line">controller.quorum.bootstrap.servers=worker1:9098</span><br><span class="line"><span class="comment"># æ§åˆ¶å™¨ç›‘å¬å™¨åç§°ï¼Œè¦ä¸ contreller èŠ‚ç‚¹é…ç½®æ–‡ä»¶ controller.properties ä¸­çš„é…ç½®ä¸€è‡´</span></span><br><span class="line">controller.listener.names=CONTROLLER</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«é‡æ–°å¯åŠ¨ä¸‰ä¸ªèŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­ kafka</span></span><br><span class="line">kafka-server-stop.sh</span><br><span class="line"><span class="comment"># è¿™é‡Œè¦æ³¨æ„ worker1 ä¸Šä¸è¦ä½¿ç”¨ kafka-server-stop.sh è¿›è¡Œå…³é—­ï¼Œå› ä¸º worker1 ä¸Šçš„ controller èŠ‚ç‚¹ ä¹Ÿåœ¨è¿è¡Œï¼Œä¼šæœ‰ä¸¤ä¸ª kafka è¿›ç¨‹è¿è¡Œï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå…³é—­ï¼›å› ä¸º controller èŠ‚ç‚¹ å¯åŠ¨ä½¿ç”¨çš„æ˜¯ controller.properties</span></span><br><span class="line">ps -ef | grep kafka | grep  <span class="string">&quot;server\.properties&quot;</span> | grep -v grep | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="built_in">kill</span> -9</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°å¯åŠ¨ kafka</span></span><br><span class="line">kafka-server-start.sh /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å½“ä¸‰ä¸ªèŠ‚ç‚¹éƒ½ä»¥å¿…è¦çš„é…ç½®é‡æ–°å¯åŠ¨åï¼Œè¿ç§»å°†è‡ªåŠ¨å¼€å§‹ã€‚è¿ç§»å®Œæˆåï¼Œå¯ä»¥åœ¨ Controller(worker1)èŠ‚ç‚¹ ä¸Šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹æ—¥å¿—ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># âœ… æ„å‘³ï¼šä» ZooKeeper åˆ° KRaft çš„åˆå§‹å…ƒæ•°æ®è¿ç§»å·²æˆåŠŸï¼Œå…±å†™å…¥ 62 æ¡è®°å½•ï¼Œå½“å‰ KRaft metadata offset ä¸º 3179ã€‚è¿™æ˜¯è¿ç§»æˆåŠŸçš„æ˜ç¡®è¯æ®ã€‚</span></span><br><span class="line">Completed migration of metadata from ZooKeeper to KRaft. 62 records were generated <span class="keyword">in</span> 300 ms across 1 batches. The average time spent waiting on a batch was 97.00 ms. The record types were &#123;TOPIC_RECORD=3, PARTITION_RECORD=56, CONFIG_RECORD=3&#125;. The current metadata offset is now 3179 with an epoch of 2. Saw 3 brokers <span class="keyword">in</span> the migrated metadata [1, 2, 3]. (org.apache.kafka.metadata.migration.KRaftMigrationDriver)</span><br><span class="line"></span><br><span class="line"><span class="comment"># âœ… æ„å‘³ï¼šæ§åˆ¶å™¨å·²åŠ è½½å¹¶ç”Ÿæ•ˆæ–°å…ƒæ•°æ®ä¸ feature setï¼ˆä¸ offset 3179 å¯¹åº”ï¼‰ã€‚</span></span><br><span class="line">Loaded new metadata Features(metadataVersion=3.9-IV0, finalizedFeatures=&#123;metadata.version=21&#125;, finalizedFeaturesEpoch=3179). (org.apache.kafka.metadata.publisher.FeaturesPublisher)</span><br><span class="line"></span><br><span class="line"><span class="comment"># âœ… æ„å‘³ï¼šå†…éƒ¨è¿ç§»çŠ¶æ€å·²æ›´æ–°ï¼ŒKRaft ä¸Šæœ‰äº†å†™å…¥ä½ç½®è®°å½•ã€‚</span></span><br><span class="line">Finished initial migration of ZK metadata to KRaft <span class="keyword">in</span> 3486479 ns. Transitioned migration state from ZkMigrationLeadershipState&#123;kraftControllerId=3000, kraftControllerEpoch=2, kraftMetadataOffset=-1, kraftMetadataEpoch=-1, lastUpdatedTimeMs=1760682050169, migrationZkVersion=1, controllerZkEpoch=3, controllerZkVersion=3&#125; to ZkMigrationLeadershipState&#123;kraftControllerId=3000, kraftControllerEpoch=2, kraftMetadataOffset=3179, kraftMetadataEpoch=2, lastUpdatedTimeMs=1760682050169, migrationZkVersion=2, controllerZkEpoch=3, controllerZkVersion=3&#125; (org.apache.kafka.metadata.migration.KRaftMigrationDriver)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># âœ… æ„å‘³ï¼šè¿ç§»æµç¨‹æŒ‰é¢„æœŸæ¨è¿›ï¼šå…ˆæŠŠ KRaft çš„å…ƒæ•°æ®ä¸ ZK å¯¹é½ï¼ˆsyncï¼‰ï¼Œç„¶åä¸ brokers å»ºç«‹é€šä¿¡ï¼Œæœ€ç»ˆè¿›å…¥ DUAL_WRITEï¼ˆåŒå†™ï¼‰ã€‚DUAL_WRITE é˜¶æ®µè¡¨ç¤ºæ§åˆ¶å™¨åœ¨å†™å…¥ KRaft metadata log çš„åŒæ—¶ï¼Œä»ç„¶ä¼šæŠŠå¿…è¦çš„å†™æ“ä½œä¹Ÿå†™å› ZooKeeperï¼ˆåŒå†™ï¼‰â€”â€”ç›´åˆ°è¿ç§»å®Œå…¨å®Œæˆå¹¶ç¡®è®¤å¯ä»¥åœæ­¢å†™ ZK ä¸ºæ­¢ã€‚</span></span><br><span class="line">3000 transitioning from ZK_MIGRATION to SYNC_KRAFT_TO_ZK state</span><br><span class="line">...</span><br><span class="line">Performing a full metadata <span class="built_in">sync</span> from KRaft to ZK.</span><br><span class="line">Did not make any ZK writes when reconciling with KRaft state.</span><br><span class="line">3000 transitioning ... to KRAFT_CONTROLLER_TO_BROKER_COMM</span><br><span class="line">...</span><br><span class="line">Sending RPCs to broker before moving to dual-write mode using at offset and epoch OffsetAndEpoch(offset=3179, epoch=2)</span><br><span class="line">...</span><br><span class="line">3000 transitioning ... to DUAL_WRITE state</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢çš„æ—¥å¿—æ€»ä½“ä¸Šè¡¨æ˜ï¼Œå…ƒæ•°æ®è¿ç§»å·²æˆåŠŸå®Œæˆå¹¶ä¸”æ§åˆ¶å™¨è¿›å…¥äº†åŒå†™ï¼ˆDUAL_WRITEï¼‰é˜¶æ®µã€‚</p></li></ul><h3 id="å°†ä¸‰ä¸ªBrokerèŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º-KRaft-æ¨¡å¼çš„-broker-èŠ‚ç‚¹">å°†ä¸‰ä¸ªBrokerèŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º KRaft æ¨¡å¼çš„ broker èŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¿®ä¸ªä¸‰ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ <code>server.properties</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ process.roles=broker</span></span><br><span class="line">process.roles=broker</span><br><span class="line"><span class="comment"># ç”¨ node.id æ›¿æ¢ broker.idï¼Œæ³¨æ„ï¼Œnode.id éœ€è¦ä¸ broker.id ä¸€è‡´</span></span><br><span class="line"><span class="comment"># broker.id=1</span></span><br><span class="line">node.id=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»æ‰ zookeeper ç›¸å…³é…ç½®</span></span><br><span class="line"><span class="comment"># Don&#x27;t set the IBP, KRaft uses &quot;metadata.version&quot; feature flag</span></span><br><span class="line"><span class="comment"># inter.broker.protocol.version=3.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove the migration enabled flag</span></span><br><span class="line"><span class="comment"># zookeeper.metadata.migration.enable=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove ZooKeeper client configuration</span></span><br><span class="line"><span class="comment"># zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«é‡æ–°å¯åŠ¨ä¸‰ä¸ªèŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­ kafka</span></span><br><span class="line">kafka-server-stop.sh</span><br><span class="line"><span class="comment"># è¿™é‡Œè¦æ³¨æ„ worker1 ä¸Šä¸è¦ä½¿ç”¨ kafka-server-stop.sh è¿›è¡Œå…³é—­ï¼Œå› ä¸º worker1 ä¸Šçš„ controller èŠ‚ç‚¹ ä¹Ÿåœ¨è¿è¡Œï¼Œä¼šæœ‰ä¸¤ä¸ª kafka è¿›ç¨‹è¿è¡Œï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå…³é—­ï¼›å› ä¸º controller èŠ‚ç‚¹ å¯åŠ¨ä½¿ç”¨çš„æ˜¯ controller.properties</span></span><br><span class="line">ps -ef | grep kafka | grep  <span class="string">&quot;server\.properties&quot;</span> | grep -v grep | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="built_in">kill</span> -9</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°å¯åŠ¨ kafka</span></span><br><span class="line">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure><h3 id="å°†-Controller-èŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º-KRaft-æ¨¡å¼çš„-controller-èŠ‚ç‚¹">å°† Controller èŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º KRaft æ¨¡å¼çš„ controller èŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹ controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ <code>controller.properties</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å»æ‰å»ä¸‹å†…å®¹</span></span><br><span class="line"><span class="comment"># æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹</span></span><br><span class="line"><span class="comment"># zookeeper.metadata.migration.enable=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ZooKeeper client è¿æ¥</span></span><br><span class="line"><span class="comment"># zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡å¯å¯åŠ¨ controller èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­åé‡æ–°å¯åŠ¨</span></span><br><span class="line">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶ä½ å¯ä»¥å…³é—­ zookeeper é›†ç¾¤äº†ï¼Œæ–°çš„ kafka é›†ç¾¤å°†ä¸å†ä½¿ç”¨ ZooKeeperï¼Œä¹Ÿæ— æ³•åœ¨æ¢å¤åˆ° ZooKeeper æ¨¡å¼ã€‚</p></li></ul><h3 id="åŠ å…¥æ–°çš„-Controller-èŠ‚ç‚¹">åŠ å…¥æ–°çš„ Controller èŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¹‹å‰å·²ç»åœ¨ <code>worker1</code> èŠ‚ç‚¹ä¸Šå¯åŠ¨äº† controller ï¼Œç°åœ¨ <code>worker2</code> å’Œ <code>worker3</code> ä¸Šä¹Ÿå¯åŠ¨äº† controller èŠ‚ç‚¹ï¼Œå¹¶å°†å®ƒä»¬åŠ å…¥åˆ° kafka é›†ç¾¤ä¸­ã€‚</p></li><li class="lvl-2"><p>åœ¨å¼€å§‹é…ç½®å‰ï¼Œå…ˆå°†ä¸Šé¢çš„ controller èŠ‚ç‚¹ å’Œ ä¸‰ä¸ª broker èŠ‚ç‚¹ çš„å¦‚ä¸‹é…ç½®è¿›è¡Œä¿®æ”¹ï¼Œå¹¶é‡å¯å¯åŠ¨ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°† controller.quorum.bootstrap.servers æ›¿æ¢ä¸º controller.quorum.voters</span></span><br><span class="line">controller.quorum.voters=3000@worker1:9098,3001@worker2:9098,3002@worker3:9098</span><br><span class="line"><span class="comment"># controller.quorum.bootstrap.servers=worker1:9098</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚è€ƒ worker1 ä¸Šçš„ controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ <code>controller.properties</code>ï¼Œé…ç½® woker2 çš„ controller èŠ‚ç‚¹é…ç½®æ–‡ä»¶<code>controller.properties</code> ï¼Œworker3 ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ï¼Œè¿™é‡Œåªèƒ½æ˜¯controller</span></span><br><span class="line">process.roles=controller</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹IDï¼Œä¸èƒ½ä¸ç°æœ‰BrokerèŠ‚ç‚¹çš„IDä¸€è‡´</span></span><br><span class="line">node.id=3001</span><br><span class="line"><span class="comment"># é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹</span></span><br><span class="line">controller.quorum.voters=3000@worker1:9098,3001@worker2:9098,3002@worker3:9098</span><br><span class="line"><span class="comment"># é…ç½®ç›‘å¬å™¨ï¼Œæ³¨æ„ç«¯å£ä¸èƒ½é‡å¤</span></span><br><span class="line">listeners=CONTROLLER://:9098</span><br><span class="line">advertised.listeners=CONTROLLER://worker2:9098</span><br><span class="line">controller.listener.names=CONTROLLER</span><br><span class="line"><span class="comment"># æ—¥å¿—å­˜æ”¾ç›®å½•ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯å…ƒæ•°æ®</span></span><br><span class="line">log.dirs=/usr/local/kafka/dataDir/kraft-meta</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®š Kafka é›†ç¾¤å†…éƒ¨ï¼ˆbroker ä¸ brokerã€KRaft æ§åˆ¶å™¨ä¸ brokerï¼‰é€šä¿¡æ‰€ä½¿ç”¨çš„ç›‘å¬å™¨ï¼ˆlistenerï¼‰åç§°ã€‚</span></span><br><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œè¦ä¸åŸå…ˆçš„ server.properties ä¸­é…ç½®çš„ç›‘å¬å™¨åç§°ä¸€è‡´</span></span><br><span class="line">inter.broker.listener.name=PLAINTEXT</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆå§‹åŒ–æ—¥å¿—ç›®å½•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -t å‚æ•°æŒ‡å®šé›†ç¾¤çš„ Cluster IDï¼Œå°±æ˜¯å‰é¢è·å–çš„ Cluster ID</span></span><br><span class="line">kafka-storage.sh format -t hp_Q0pihQ0ORcIvXlfHobQ -c /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«å¯åŠ¨ worker2 å’Œ worker3 ä¸Šçš„ controller èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶æ–°çš„ controller èŠ‚ç‚¹ä¸ä¼šç«‹åˆ»åŠ å…¥é€‰ä¸¾é˜Ÿåˆ—ï¼Œéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†èŠ‚ç‚¹åŠ å…¥é€‰ä¸¾é˜Ÿåˆ—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†åˆ«åœ¨ worker2 å’Œ worker3 ä¸Šæ‰§è¡Œ</span></span><br><span class="line">kafka-metadata-quorum.sh --bootstrap-server localhost:9092 --command-config /usr/local/kafka/kafka3/config/kraft/controller.properties add-controller</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ kafka-metadata-quorum.sh --bootstrap-server worker1:9092 describe --replication</span><br><span class="line">NodeIdDirectoryId           LogEndOffsetLagLastFetchTimestampLastCaughtUpTimestampStatus</span><br><span class="line">3000  RJ4oOPGgTw-KxHFNn4SmiQ27820       0  1760696136345     1760696136345        Leader</span><br><span class="line">3001  zGnWA7zYmRHG6bcTlFV2qA27820       0  1760696136259     1760696136259        Follower</span><br><span class="line">3002  gIDkhOQJEHqg-GJBdezU1Q27820       0  1760696136257     1760696136257        Follower</span><br><span class="line">2     9KeeAYKEQHT92DxqNSwYuA27820       0  1760696136257     1760696136257        Observer</span><br><span class="line">1     Q8lr8JQ2vrDS35_DrI1MxA27820       0  1760696136257     1760696136257        Observer</span><br><span class="line">3     rgQR5wd_i5hLgU97dCKIvA27820       0  1760696136257     1760696136257        Observer</span><br><span class="line"></span><br><span class="line">$ kafka-metadata-quorum.sh --bootstrap-server localhost:9092 describe --status</span><br><span class="line">ClusterId:              hp_Q0pihQ0ORcIvXlfHobQ</span><br><span class="line">LeaderId:               3000</span><br><span class="line">LeaderEpoch:            5</span><br><span class="line">HighWatermark:          30094</span><br><span class="line">MaxFollowerLag:         0</span><br><span class="line">MaxFollowerLagTimeMs:   0</span><br><span class="line">CurrentVoters:          [&#123;<span class="string">&quot;id&quot;</span>: 3000, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;RJ4oOPGgTw-KxHFNn4SmiQ&quot;</span>, <span class="string">&quot;endpoints&quot;</span>: [<span class="string">&quot;CONTROLLER://worker1:9098&quot;</span>]&#125;, &#123;<span class="string">&quot;id&quot;</span>: 3001, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;zGnWA7zYmRHG6bcTlFV2qA&quot;</span>, <span class="string">&quot;endpoints&quot;</span>: [<span class="string">&quot;CONTROLLER://worker2:9098&quot;</span>]&#125;, &#123;<span class="string">&quot;id&quot;</span>: 3002, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;gIDkhOQJEHqg-GJBdezU1Q&quot;</span>, <span class="string">&quot;endpoints&quot;</span>: [<span class="string">&quot;CONTROLLER://worker3:9098&quot;</span>]&#125;]</span><br><span class="line">CurrentObservers:       [&#123;<span class="string">&quot;id&quot;</span>: 2, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;9KeeAYKEQHT92DxqNSwYuA&quot;</span>&#125;, &#123;<span class="string">&quot;id&quot;</span>: 1, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;Q8lr8JQ2vrDS35_DrI1MxA&quot;</span>&#125;, &#123;<span class="string">&quot;id&quot;</span>: 3, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;rgQR5wd_i5hLgU97dCKIvA&quot;</span>&#125;]</span><br></pre></td></tr></table></figure><h2 id="è¿ç§»åæ³¨æ„äº‹é¡¹">è¿ç§»åæ³¨æ„äº‹é¡¹</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿ç§»å®Œæˆåï¼ŒKafka å®¢æˆ·ç«¯ï¼ˆProducer / Consumer / AdminClientï¼‰ä¾ç„¶è¿æ¥çš„æ˜¯ Broker èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ Controller èŠ‚ç‚¹ã€‚</p></li><li class="lvl-2"><p>Kafka åœ¨ ZooKeeper æ¨¡å¼ä¸ KRaft æ¨¡å¼ä¸‹çš„åŒºåˆ«ä¸»è¦åœ¨äºï¼š</p><ul class="lvl-2"><li class="lvl-4">æ§åˆ¶å¹³é¢ï¼ˆControl Planeï¼‰ï¼šZK æ¨¡å¼ä¸‹ç”± ZooKeeper + Controller Broker å…±åŒç®¡ç†ï¼›KRaft æ¨¡å¼ä¸‹ç”± ç‹¬ç«‹çš„ Controller è¿›ç¨‹æˆ–è§’è‰² ç®¡ç†ï¼ˆé€šè¿‡ Raft åè®®åŒæ­¥å…ƒæ•°æ®ï¼‰ã€‚</li><li class="lvl-4">æ•°æ®å¹³é¢ï¼ˆData Planeï¼‰ï¼šæ— è®ºæ˜¯å“ªä¸ªæ¨¡å¼ï¼Œå®¢æˆ·ç«¯å‘é€ã€æ¶ˆè´¹æ¶ˆæ¯ä»ç„¶æ˜¯é€šè¿‡ Broker èŠ‚ç‚¹ å®Œæˆçš„ã€‚</li><li class="lvl-4">ä¹Ÿå°±æ˜¯è¯´ï¼ŒController ç®¡ç†é›†ç¾¤å…ƒæ•°æ®ï¼ˆä¸»é¢˜ã€åˆ†åŒºã€å‰¯æœ¬ã€Leader é€‰ä¸¾ç­‰ï¼‰ï¼Œè€Œ Broker èŠ‚ç‚¹å¤„ç†å®é™…çš„æ¶ˆæ¯æµã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» å¦‚ä½•å°† Kafka é›†ç¾¤ä» Zookeeper æ¨¡å¼è¿ç§»åˆ° KRaft æ¨¡å¼&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org&quot;&gt;Kafkaå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafka çš„å®‰è£…ï¼šåŸºäº KRaft æ¨¡å¼</title>
    <link href="https://blog.hanqunfeng.com/2025/10/16/kafka-05-install-kraft/"/>
    <id>https://blog.hanqunfeng.com/2025/10/16/kafka-05-install-kraft/</id>
    <published>2025-10-16T13:30:05.000Z</published>
    <updated>2025-10-16T10:03:13.338Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº KRaft æ¨¡å¼ã€‚</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org">Kafkaå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org/39/documentation.html#kraft_zk_migration">å®˜æ–¹æ–‡æ¡£ï¼šZooKeeperåˆ°KRaftè¿ç§»</a></p></li></ul><span id="more"></span><h2 id="KRaft-ç®€ä»‹">KRaft ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Kraft æ˜¯ Kafka ä» 2.8.0 ç‰ˆæœ¬ å¼€å§‹â½€æŒçš„â¼€ç§æ–°çš„é›†ç¾¤æ¶æ„â½…å¼ã€‚å…¶â½¬çš„ä¸»è¦æ˜¯ä¸ºäº†æ‘†è„±Kafkaå¯¹Zookeeperçš„ä¾èµ–ã€‚å› ä¸ºä»¥å¾€åŸºäºZookeeperæ­å»ºçš„é›†ç¾¤ï¼Œå¢åŠ äº†Kafkaæ¼”è¿›ä¸è¿ç»´çš„éš¾åº¦ï¼Œé€æ¸å¼€å§‹æˆä¸ºKakfaæ‹¥æŠ±äº‘åŸâ½£çš„â¼€ç§éšœç¢ã€‚ä½¿â½¤Krafté›†ç¾¤åï¼ŒKafkaé›†ç¾¤å°±ä¸å†éœ€è¦ä¾èµ–Zookeeperï¼Œå°†ä¹‹å‰åŸºäºZookeeperç®¡ç†çš„é›†ç¾¤æ•°æ®ï¼Œè½¬ä¸ºç”±Kafkaé›†ç¾¤â¾ƒâ¼°ç®¡ç†ã€‚</p></li><li class="lvl-2"><p>ä¼ ç»Ÿçš„Kafkaé›†ç¾¤ï¼Œä¼šå°†æ¯ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ç»Ÿä¸€ä¿å­˜åœ¨Zookeeperä¸­ï¼Œå¹¶é€šè¿‡ZookeeperåŠ¨æ€é€‰ä¸¾äº§ç”Ÿä¸€ä¸ªControllerèŠ‚ç‚¹ï¼Œé€šè¿‡ControllerèŠ‚ç‚¹æ¥ç®¡ç†Kafkaé›†ç¾¤ï¼Œæ¯”å¦‚è§¦å‘Partitionçš„é€‰ä¸¾ã€‚è€Œåœ¨Krafté›†ç¾¤ä¸­ï¼Œä¼šå›ºå®šé…ç½®å‡ å°BrokerèŠ‚ç‚¹æ¥å…±åŒæ‹…ä»»Controllerçš„è§’è‰²ï¼Œå„ç»„Partitionçš„LeaderèŠ‚ç‚¹å°±ä¼šç”±è¿™äº›Controlleré€‰ä¸¾äº§ç”Ÿã€‚åŸæœ¬ä¿å­˜åœ¨Zookeeperä¸­çš„å…ƒæ•°æ®ä¹Ÿè½¬è€Œä¿å­˜åˆ°ControllerèŠ‚ç‚¹ä¸­ã€‚</p></li><li class="lvl-2"><p>ğŸ§­ Kafka KRaft æ¨¡å¼ vs Zookeeper æ¨¡å¼ å¯¹æ¯”è¡¨</p></li></ul><table><thead><tr><th style="text-align:left">å¯¹æ¯”é¡¹</th><th style="text-align:left"><strong>KRaft æ¨¡å¼ï¼ˆKafka Raft æ¨¡å¼ï¼‰</strong></th><th style="text-align:left"><strong>Zookeeper æ¨¡å¼ï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰</strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong>æ¶æ„ç»“æ„</strong></td><td style="text-align:left">å»ä¸­å¿ƒåŒ–æ¶æ„ï¼ŒKafka è‡ªèº«å†…ç½®æ§åˆ¶å¹³é¢ï¼Œä¸ä¾èµ–å¤–éƒ¨ Zookeeperã€‚</td><td style="text-align:left">æ§åˆ¶å¹³é¢ä¾èµ–å¤–éƒ¨ Zookeeper é›†ç¾¤ï¼ŒKafka Broker åªè´Ÿè´£æ•°æ®å¹³é¢ã€‚</td></tr><tr><td style="text-align:left"><strong>ç»„ä»¶æ•°é‡</strong></td><td style="text-align:left">æ— éœ€éƒ¨ç½² Zookeeperï¼Œåªæœ‰ Kafka Broker èŠ‚ç‚¹ã€‚</td><td style="text-align:left">éœ€è¦å•ç‹¬ç»´æŠ¤ Zookeeper é›†ç¾¤ã€‚</td></tr><tr><td style="text-align:left"><strong>å…ƒæ•°æ®å­˜å‚¨</strong></td><td style="text-align:left">å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka è‡ªèº«çš„å†…ç½®æ—¥å¿—ä¸­ï¼ˆ<code>__cluster_metadata</code> topicï¼‰ã€‚</td><td style="text-align:left">å…ƒæ•°æ®å­˜å‚¨åœ¨ Zookeeper çš„ znode æ ‘ç»“æ„ä¸­ã€‚</td></tr><tr><td style="text-align:left"><strong>ä¸€è‡´æ€§åè®®</strong></td><td style="text-align:left">ä½¿ç”¨ Kafka è‡ªå·±å®ç°çš„ Raft åè®®ï¼ˆKRaftï¼‰æ¥ä¿è¯å…ƒæ•°æ®ä¸€è‡´æ€§ã€‚</td><td style="text-align:left">ä½¿ç”¨ ZABï¼ˆZookeeper Atomic Broadcastï¼‰åè®®ä¿è¯ä¸€è‡´æ€§ã€‚</td></tr><tr><td style="text-align:left"><strong>å¯åŠ¨é€Ÿåº¦</strong></td><td style="text-align:left">æ›´å¿«ï¼Œæ§åˆ¶å™¨å†…åµŒäº Broker ä¸­ï¼Œä¸éœ€è¦ç­‰å¾…å¤–éƒ¨ Zookeeper å¯åŠ¨ã€‚</td><td style="text-align:left">å¯åŠ¨ä¾èµ– Zookeeperï¼Œå¯åŠ¨é¡ºåºå’Œè¿é€šæ€§è¦æ±‚æ›´ä¸¥æ ¼ã€‚</td></tr><tr><td style="text-align:left"><strong>å®¹é”™æ€§</strong></td><td style="text-align:left">Raft æ§åˆ¶å™¨å…·å¤‡æ—¥å¿—å¤åˆ¶æœºåˆ¶ï¼Œå®¹é”™æ€§ä¸ Kafka æ•°æ®å‰¯æœ¬ä¸€è‡´ã€‚</td><td style="text-align:left">å®¹é”™æ€§ç”± Zookeeper å†³å®šï¼ŒZookeeper æŒ‚æ‰å¯èƒ½å¯¼è‡´ Kafka æ§åˆ¶é¢ä¸å¯ç”¨ã€‚</td></tr><tr><td style="text-align:left"><strong>æ‰©å±•æ€§</strong></td><td style="text-align:left">å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka ä¸»é¢˜ä¸­ï¼Œæ°´å¹³æ‰©å±•èƒ½åŠ›æ›´å¼ºã€‚</td><td style="text-align:left">Zookeeper åœ¨é«˜åˆ†åŒºæ•°åœºæ™¯ä¸‹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</td></tr><tr><td style="text-align:left"><strong>è¿ç»´å¤æ‚åº¦</strong></td><td style="text-align:left">æ— éœ€ç»´æŠ¤ Zookeeper é›†ç¾¤ï¼Œç»Ÿä¸€è¿ç»´ Kafka å³å¯ã€‚</td><td style="text-align:left">éœ€è¦é¢å¤–ç»´æŠ¤ Zookeeper é›†ç¾¤ï¼ˆç›‘æ§ã€æ‰©å®¹ã€å‡çº§ï¼‰ã€‚</td></tr><tr><td style="text-align:left"><strong>æ•°æ®æ¢å¤</strong></td><td style="text-align:left">å…ƒæ•°æ®æ¢å¤ä¸ Kafka ä¸»é¢˜ä¸€è‡´ï¼Œå¯é€šè¿‡æ—¥å¿—å›æ”¾æ¢å¤ã€‚</td><td style="text-align:left">Zookeeper æ•°æ®æ¢å¤ç›¸å¯¹å¤æ‚ï¼Œä¾èµ–å¿«ç…§å’Œäº‹åŠ¡æ—¥å¿—ã€‚</td></tr><tr><td style="text-align:left"><strong>å®‰å…¨æœºåˆ¶</strong></td><td style="text-align:left">ç»Ÿä¸€ Kafka çš„å®‰å…¨æœºåˆ¶ï¼ˆSASLã€SSLã€ACL ç­‰ï¼‰ã€‚</td><td style="text-align:left">Zookeeper æœ‰ç‹¬ç«‹çš„å®‰å…¨é…ç½®ä½“ç³»ï¼Œéœ€å•ç‹¬ç®¡ç†ã€‚</td></tr><tr><td style="text-align:left"><strong>æ€§èƒ½è¡¨ç°</strong></td><td style="text-align:left">å…ƒæ•°æ®æ“ä½œå»¶è¿Ÿæ›´ä½ï¼ˆæ§åˆ¶å™¨ä¸ Broker æœ¬åœ°é€šä¿¡ï¼‰ã€‚</td><td style="text-align:left">å…ƒæ•°æ®æ“ä½œéœ€è¦è·¨è¿›ç¨‹ç½‘ç»œé€šä¿¡ï¼Œå»¶è¿Ÿæ›´é«˜ã€‚</td></tr><tr><td style="text-align:left"><strong>æ§åˆ¶å™¨è§’è‰²</strong></td><td style="text-align:left">ç”± Broker ä¸­çš„æ§åˆ¶å™¨ quorum é€‰ä¸¾äº§ç”Ÿï¼ˆæ”¯æŒå¤šæ§åˆ¶å™¨å€™é€‰ï¼‰ã€‚</td><td style="text-align:left">ç”± Zookeeper é€‰ä¸¾æ§åˆ¶å™¨ï¼ˆå•ç‚¹æ§åˆ¶å™¨ï¼‰ã€‚</td></tr><tr><td style="text-align:left"><strong>åˆ†åŒºä¸å‰¯æœ¬ç®¡ç†</strong></td><td style="text-align:left">å…¨éƒ¨å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka è‡ªèº«ï¼Œå¯å®ç°æ›´å¿«çš„åˆ†åŒºå˜æ›´å’Œæ‰©å®¹ã€‚</td><td style="text-align:left">åˆ†åŒºã€å‰¯æœ¬å…ƒæ•°æ®åŒæ­¥ä¾èµ– Zookeeperï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒä½ã€‚</td></tr><tr><td style="text-align:left"><strong>ç‰ˆæœ¬æ”¯æŒ</strong></td><td style="text-align:left">ä» Kafka 2.8 å¼€å§‹å¼•å…¥ï¼ŒKafka 3.3+ å·²ç»éå¸¸ç¨³å®šï¼ŒKafka 3.5+ é»˜è®¤æ¨èã€‚</td><td style="text-align:left">Kafka 3.5 å¼€å§‹æ ‡è®°ä¸ºâ€œLegacyâ€ï¼Œæœªæ¥ç‰ˆæœ¬è®¡åˆ’ç§»é™¤æ”¯æŒã€‚</td></tr><tr><td style="text-align:left"><strong>å…¼å®¹æ€§</strong></td><td style="text-align:left">å¯é€šè¿‡å…ƒæ•°æ®è¿ç§»å·¥å…·ä» Zookeeper æ¨¡å¼å¹³æ»‘è¿ç§»ã€‚</td><td style="text-align:left">ä¸èƒ½ç›´æ¥è¿ç§»åˆ° KRaftï¼Œéœ€è¦å·¥å…·è¾…åŠ©ã€‚</td></tr><tr><td style="text-align:left"><strong>è¿ç»´ç›‘æ§</strong></td><td style="text-align:left">å•ä¸€ç³»ç»Ÿå¯ç›‘æ§ï¼ˆKafka è‡ªå¸¦çš„ JMXã€Prometheus ç­‰ï¼‰ã€‚</td><td style="text-align:left">Kafka ä¸ Zookeeper å„è‡ªéœ€è¦ç‹¬ç«‹ç›‘æ§ä½“ç³»ã€‚</td></tr><tr><td style="text-align:left"><strong>æœªæ¥å‘å±•æ–¹å‘</strong></td><td style="text-align:left">å®˜æ–¹æ¨èå’Œé»˜è®¤æ¨¡å¼ï¼ˆZookeeper æ¨¡å¼å°†é€æ­¥æ·˜æ±°ï¼‰ã€‚</td><td style="text-align:left">å®˜æ–¹å·²ä¸å†å»ºè®®æ–°é›†ç¾¤ä½¿ç”¨ã€‚</td></tr></tbody></table><h2 id="Kafka-çš„-KRaft-é›†ç¾¤é…ç½®">Kafka çš„ KRaft é›†ç¾¤é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨Kafkaçš„configç›®å½•ä¸‹ï¼Œæä¾›äº†ä¸€ä¸ªkraftçš„æ–‡ä»¶å¤¹ï¼Œåœ¨è¿™é‡Œé¢æä¾›äº†ä¸‰ä¸ªKraftåè®®çš„å‚è€ƒé…ç½®æ–‡ä»¶</p><ul class="lvl-2"><li class="lvl-4">broker.properties: æ•°æ®èŠ‚ç‚¹</li><li class="lvl-4">controller.properties: Controlleræ§åˆ¶èŠ‚ç‚¹</li><li class="lvl-4">server.properties: å³å¯ä»¥æ˜¯æ•°æ®èŠ‚ç‚¹ï¼Œåˆå¯ä»¥æ˜¯Controlleræ§åˆ¶èŠ‚ç‚¹ã€‚</li></ul></li><li class="lvl-2"><p>å®é™…ä¸Šè¿™äº›é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹åŸºæœ¬ä¸ serrver.properties ä¸€è‡´ï¼Œåªæ˜¯å»é™¤äº†ä¸ zookeeper ç›¸å…³çš„é…ç½®é¡¹ï¼ŒåŒæ—¶å¢åŠ äº†ä¸€äº› Kraft æ¨¡å¼ä¸‹çš„é…ç½®é¡¹ã€‚å…³äº server.properties çš„é…ç½®é¡¹ï¼Œè¯·å‚è€ƒ <a href="https://kafka.apache.org/39/documentation/#brokerconfigs">Kafka å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p>è¿™é‡Œä»¥ <code>kraft/serrver.properties</code> ä¸ºä¾‹è¿›è¡Œä¿®æ”¹ï¼Œé…ç½®ä¸‰ä¸ªèŠ‚ç‚¹çš„Kafkaé›†ç¾¤ï¼Œæ¯ä¸ªèŠ‚ç‚¹å³æ˜¯ controller èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯ broker èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹é¢è¿™å››ä¸ªé…ç½®é¡¹æ˜¯ kraft æ¨¡å¼ä¸‹æ–°å¢åŠ çš„</span></span><br><span class="line"><span class="comment"># é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ã€‚Controllerç›¸å½“äºZookeeperçš„åŠŸèƒ½ï¼Œè´Ÿè´£é›†ç¾¤ç®¡ç†ã€‚Brokeræä¾›å…·ä½“çš„æ¶ˆæ¯è½¬å‘æœåŠ¡ã€‚</span></span><br><span class="line"><span class="comment"># ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å³æ˜¯ Controller åˆæ˜¯ Brokerï¼Œä¹Ÿå¯ä»¥åªæ˜¯ Controller æˆ– Brokerã€‚</span></span><br><span class="line">process.roles=broker,controller</span><br><span class="line"><span class="comment"># é…ç½®å½“å‰èŠ‚ç‚¹çš„idã€‚ä¸æ™®é€šé›†ç¾¤ä¸€æ ·ï¼Œè¦æ±‚é›†ç¾¤å†…æ¯ä¸ªèŠ‚ç‚¹çš„IDä¸èƒ½é‡å¤ã€‚</span></span><br><span class="line">node.id=1</span><br><span class="line"><span class="comment"># é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹ã€‚å…¶ä¸­@å‰é¢çš„æ˜¯èŠ‚ç‚¹çš„idï¼Œåé¢æ˜¯èŠ‚ç‚¹çš„åœ°å€å’Œç«¯å£ï¼Œè¿™ä¸ªç«¯å£è·Ÿå®¢æˆ·ç«¯è®¿é—®çš„ç«¯å£æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¦ä¸ CONTROLLER åè®®å¯¹åº”çš„ç«¯å£ä¸€è‡´ï¼Œè¿™é‡Œé…ç½®ä¸º 9098</span></span><br><span class="line"><span class="comment"># é€šå¸¸å°†é›†ç¾¤å†…çš„æ‰€æœ‰ControllorèŠ‚ç‚¹éƒ½é…ç½®è¿›å»ã€‚</span></span><br><span class="line">controller.quorum.voters=1@worker1:9098,2@worker2:9098,3@worker3:9098</span><br><span class="line"><span class="comment"># ControlleræœåŠ¡åè®®çš„åˆ«åã€‚é»˜è®¤å°±æ˜¯CONTROLLER</span></span><br><span class="line">controller.listener.names=CONTROLLER</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹é…ç½®é¡¹ä¸ä¹‹å‰ä¸€æ ·ï¼ŒæŒ‰éœ€è¿›è¡Œé…ç½®å³å¯</span></span><br><span class="line"><span class="comment"># é›†ç¾¤é—´é€šä¿¡ä»ä½¿ç”¨å†…ç½‘</span></span><br><span class="line">inter.broker.listener.name=PLAINTEXT</span><br><span class="line"><span class="comment"># é…ç½®ç›‘å¬æœåŠ¡ã€‚ä¸åŒçš„æœåŠ¡å¯ä»¥ç»‘å®šä¸åŒçš„æ¥å£ã€‚è¿™ç§é…ç½®æ–¹å¼åœ¨ç«¯å£å‰é¢æ˜¯çœç•¥äº†ä¸€ä¸ªä¸»æœºIPçš„ï¼Œä¸»æœºIPé»˜è®¤æ˜¯ä½¿ç”¨çš„java.net.InetAddress.getCanonicalHostName()ï¼Œè¿™é‡ŒåŒæ—¶å¼€å¯å¤–ç½‘è®¿é—®ï¼Œå…³äº sasl_plaintext ã€sasl_sslåè®® çš„é…ç½®æ–¹å¼å‚è€ƒå‰æ–‡ kafka é€šä¿¡åè®®</span></span><br><span class="line">listeners=PLAINTEXT://:9092,CONTROLLER://:9098,EXTERNAL://0.0.0.0:9093</span><br><span class="line"><span class="comment"># Brokerå¯¹å®¢æˆ·ç«¯æš´éœ²çš„æœåŠ¡åœ°å€ã€‚åŸºäºPLAINTEXTåè®®ã€‚è¿™é‡Œè¦æ›¿æ¢ä¸ºå„ä¸ªèŠ‚ç‚¹çš„IPåœ°å€</span></span><br><span class="line">advertised.listeners=PLAINTEXT://worker1:9092,CONTROLLER://worker1:9098,EXTERNAL://161.189.227.200:9093</span><br><span class="line"><span class="comment"># å°†ç›‘å¬å™¨åç§°æ˜ å°„åˆ°å®‰å…¨åè®®ç±»å‹ï¼Œè¿™é‡Œ CONTROLLER åè®®å¯¹åº”çš„å®‰å…¨åè®®ç±»å‹ä¸º PLAINTEXT</span></span><br><span class="line">listener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL,EXTERNAL:PLAINTEXT</span><br><span class="line"><span class="comment"># æ•°æ®æ–‡ä»¶åœ°å€ã€‚é»˜è®¤é…ç½®åœ¨/tmpç›®å½•ä¸‹ã€‚</span></span><br><span class="line">log.dirs=/usr/local/kafka/dataDir/kraft-logs</span><br><span class="line"><span class="comment"># topicé»˜è®¤çš„partitionåˆ†åŒºæ•°ã€‚</span></span><br><span class="line">num.partitions=2</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨Kafkaé›†ç¾¤">å¯åŠ¨Kafkaé›†ç¾¤</h2><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨å‰è¦å¯¹æ—¥å¿—ç›®å½•è¿›è¡Œæ ¼å¼åŒ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨worker1èŠ‚ç‚¹ä¸Šç”Ÿæˆé›†ç¾¤ID</span></span><br><span class="line">$ kafka-storage.sh random-uuid</span><br><span class="line">oGwJsVANRDKYwE7Lhn2zIA</span><br><span class="line"><span class="comment"># ç„¶ååœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ ¼å¼åŒ–æ—¥å¿—ç›®å½•ï¼Œæ³¨æ„ --cluster-id å¿…é¡»ä¸€è‡´</span></span><br><span class="line"><span class="comment"># å¿…é¡»åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨å‰æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># ä¸å¯ä»¥é‡å¤æ‰§è¡Œï¼Œå¦åˆ™ä¼šæ¸…ç©ºæ•°æ®ç›®å½•å¹¶ç ´åå·²æœ‰å…ƒæ•°æ®</span></span><br><span class="line">$ kafka-storage.sh format --cluster-id oGwJsVANRDKYwE7Lhn2zIA --config /usr/local/kafka/kafka3/config/kraft/server.properties</span><br><span class="line"><span class="comment">## æ ¼å¼åŒ–åä¼šåœ¨æ—¥å¿—ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># bootstrap.checkpoint # å­˜å‚¨å…ƒæ•°æ®æ—¥å¿—ï¼ˆMetadata Logï¼‰å¯¹åº”çš„åˆå§‹å¿«ç…§åç§»é‡ï¼ˆsnapshot offsetï¼‰ã€‚ç”¨äºæ§åˆ¶å™¨åœ¨å¯åŠ¨æ—¶æ¢å¤çŠ¶æ€çš„èµ·ç‚¹ã€‚</span></span><br><span class="line"><span class="comment"># meta.properties # å­˜å‚¨èŠ‚ç‚¹å…ƒä¿¡æ¯ï¼šcluster.idã€node.idã€version ç­‰</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨é›†ç¾¤ï¼Œæ‰€ä»¥èŠ‚ç‚¹å¯åŠ¨ kafka æœåŠ¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/server.properties</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº KRaft æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org&quot;&gt;Kafkaå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org/39/documentation.html#kraft_zk_migration&quot;&gt;å®˜æ–¹æ–‡æ¡£ï¼šZooKeeperåˆ°KRaftè¿ç§»&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafka çš„ å¸¸ç”¨å‘½ä»¤</title>
    <link href="https://blog.hanqunfeng.com/2025/10/15/kafka-04-command/"/>
    <id>https://blog.hanqunfeng.com/2025/10/15/kafka-04-command/</id>
    <published>2025-10-15T12:30:05.000Z</published>
    <updated>2025-10-16T06:05:44.574Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Kafka çš„ å¸¸ç”¨å‘½ä»¤</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org">Kafkaå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p></li><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/kafka-3-demo">Java-Client ä»£ç ç¤ºä¾‹</a></p></li></ul><span id="more"></span><h2 id="topic">topic</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º topic</span></span><br><span class="line">kafka-topics.sh --create --bootstrap-server localhost:9092 --topic <span class="built_in">test</span> --partitions 3 --replication-factor 2</span><br><span class="line"><span class="comment"># --bootstrap-server æŒ‡å®š kafka é›†ç¾¤åœ°å€</span></span><br><span class="line"><span class="comment"># --topic åˆ›å»ºçš„ topic åç§°</span></span><br><span class="line"><span class="comment"># --partitions æŒ‡å®šåˆ†åŒºæ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼</span></span><br><span class="line"><span class="comment"># --replication-factor æŒ‡å®šå‰¯æœ¬æ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡º topic</span></span><br><span class="line">kafka-topics.sh --list --bootstrap-server localhost:9092</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ topic è¯¦æƒ…</span></span><br><span class="line">kafka-topics.sh --describe --bootstrap-server localhost:9092 --topic <span class="built_in">test</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Topic: <span class="built_in">test</span>TopicId: Ru0tWQJ4RMWcjjGsKAdWQgPartitionCount: 3ReplicationFactor: 3Configs:</span><br><span class="line">Topic: <span class="built_in">test</span>Partition: 0Leader: 3Replicas: 3,1,2Isr: 3,2,1Elr: N/ALastKnownElr: N/A</span><br><span class="line">Topic: <span class="built_in">test</span>Partition: 1Leader: 1Replicas: 1,2,3Isr: 3,2,1Elr: N/ALastKnownElr: N/A</span><br><span class="line">Topic: <span class="built_in">test</span>Partition: 2Leader: 2Replicas: 2,3,1Isr: 3,2,1Elr: N/ALastKnownElr: N/A</span><br><span class="line"><span class="comment">## è¾“å‡ºè¯´æ˜</span></span><br><span class="line"><span class="comment"># æ€»ä½“ä¿¡æ¯ï¼ˆTopic æ¦‚è§ˆï¼‰Topic: testTopicId: Ru0tWQJ4RMWcjjGsKAdWQgPartitionCount: 3ReplicationFactor: 3Configs:</span></span><br><span class="line">| å­—æ®µ                                  | å«ä¹‰                                                            |</span><br><span class="line">| ----------------------------------- | ------------------------------------------------------------- |</span><br><span class="line">| **Topic: disTopic**                 | Topic åç§°ï¼Œå³å½“å‰æè¿°çš„ä¸»é¢˜ã€‚                                            |</span><br><span class="line">| **TopicId: VUK7Mc9oQdS1mjGG7OhQzQ** | Kafka å†…éƒ¨è‡ªåŠ¨ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUUIDï¼‰ï¼ŒKafka 3.x ä¹‹åå¼•å…¥ï¼Œç”¨äºåŒºåˆ†åŒåä½†ä¸åŒç”Ÿå‘½å‘¨æœŸçš„ topicã€‚ |</span><br><span class="line">| **PartitionCount: 3**               | è¯¥ä¸»é¢˜æœ‰ 3 ä¸ªåˆ†åŒºï¼ˆpartitionï¼‰ã€‚æ¯ä¸ªåˆ†åŒºå­˜å‚¨ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚                            |</span><br><span class="line">| **ReplicationFactor:**              | å‰¯æœ¬å› å­ã€‚è¿™é‡Œè™½ç„¶è¾“å‡ºä¸­æ²¡æ˜¾ç¤ºå…·ä½“å€¼ï¼Œä½†å¯ä»æ¯è¡Œåˆ†åŒºé…ç½®æ¨æ–­æ˜¯ **3**ï¼ˆæ¯ä¸ªåˆ†åŒºæœ‰ 3 ä¸ªå‰¯æœ¬ï¼‰ã€‚           |</span><br><span class="line">| **Configs:**                        | topic çš„é…ç½®é¡¹ï¼ˆä¾‹å¦‚æ¸…ç†ç­–ç•¥ã€å‹ç¼©ç±»å‹ç­‰ï¼‰ï¼Œå¦‚æœä¸ºç©ºï¼Œè¯´æ˜ä½¿ç”¨é»˜è®¤é…ç½®ã€‚                       |</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†åŒºè¯¦æƒ…ï¼ˆæ¯ä¸ª Partition ä¸€è¡Œï¼‰</span></span><br><span class="line"></span><br><span class="line">| å­—æ®µ                                | å«ä¹‰                                                          |</span><br><span class="line">| --------------------------------- | ----------------------------------------------------------- |</span><br><span class="line">| **Partition: 0**                  | ç¬¬ 0 å·åˆ†åŒºã€‚                                                    |</span><br><span class="line">| **Leader: 2**                     | è¯¥åˆ†åŒºå½“å‰çš„ **Leader Broker æ˜¯ broker ID = 2**ï¼Œåªæœ‰ Leader æ‰å¤„ç†è¯»å†™è¯·æ±‚ã€‚ |</span><br><span class="line">| **Replicas: 2,3,1**               | è¯¥åˆ†åŒºçš„æ‰€æœ‰å‰¯æœ¬å­˜æ”¾åœ¨å“ªäº› Broker ä¸Šï¼ˆå³å‰¯æœ¬åˆ†å¸ƒ,ARï¼‰ï¼Œåˆ†åˆ«æ˜¯ broker 2ã€3ã€1ã€‚             |</span><br><span class="line">| **Isr (In-Sync Replicas): 2,3,1** | å½“å‰ä¸ Leader ä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆã€‚è¿™é‡Œæ‰€æœ‰å‰¯æœ¬éƒ½åœ¨åŒæ­¥ä¸­ï¼ˆå¥åº·çŠ¶æ€ ğŸ‘ï¼‰ã€‚                  |</span><br><span class="line">| **Elr / LastKnownElr**            | Kafka æ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„ <span class="string">&quot;Enhanced Leader Replica&quot;</span> çŠ¶æ€ï¼Œç›®å‰æœªå¯ç”¨ï¼ˆN/Aï¼‰ã€‚      |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ topic</span></span><br><span class="line">kafka-topics.sh --delete --bootstrap-server localhost:9092 --topic <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h2 id="consumer">consumer</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º consumer</span></span><br><span class="line">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class="built_in">test</span> --group <span class="built_in">test</span></span><br><span class="line"><span class="comment"># --topic æŒ‡å®š topic</span></span><br><span class="line"><span class="comment"># --group æŒ‡å®š consumer ç»„</span></span><br><span class="line"></span><br><span class="line">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class="built_in">test</span>  --from-beginning</span><br><span class="line"><span class="comment"># --from-beginning ä» topic çš„æœ€å¼€å§‹æ¶ˆè´¹</span></span><br></pre></td></tr></table></figure><h2 id="consumer-group">consumer-group</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡º consumer ç»„</span></span><br><span class="line">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list</span><br><span class="line"><span class="comment"># --bootstrap-server é›†ç¾¤åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ consumer ç»„è¯¦æƒ…</span></span><br><span class="line">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group <span class="built_in">test</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">GROUP  TOPIC  PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG  CONSUMER-ID                                             HOST         CLIENT-ID</span><br><span class="line"><span class="built_in">test</span>   <span class="built_in">test</span>   0          2               2               0    console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1  /10.250.0.7   console-consumer</span><br><span class="line"><span class="built_in">test</span>   <span class="built_in">test</span>   1          2               2               0    console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1  /10.250.0.7   console-consumer</span><br><span class="line"><span class="built_in">test</span>   <span class="built_in">test</span>   2          1               1               0    console-consumer-9ac45b29-d8f3-4649-ab09-7b567aa2ba53  /10.250.0.108 console-consumer</span><br><span class="line"></span><br><span class="line"><span class="comment">## è¾“å‡ºè¯´æ˜</span></span><br><span class="line"><span class="comment"># GROUP       æ¶ˆè´¹ç»„åç§°</span></span><br><span class="line"><span class="comment"># TOPIC       topic åç§°</span></span><br><span class="line"><span class="comment"># PARTITION   åˆ†åŒºç¼–å·</span></span><br><span class="line"><span class="comment"># CURRENT-OFFSET  å½“å‰æ¶ˆè´¹çš„ offset</span></span><br><span class="line"><span class="comment"># LOG-END-OFFSET   topic ä¸­æœ€å¤§çš„ offset</span></span><br><span class="line"><span class="comment"># LAG         å½“å‰æ¶ˆè´¹çš„ offset ä¸ topic ä¸­æœ€å¤§çš„ offset çš„å·®å€¼ï¼Œå³å‰©ä½™æœªæ¶ˆè´¹çš„ æ¶ˆæ¯æ•°é‡</span></span><br><span class="line"><span class="comment"># CONSUMER-ID  å½“å‰æ¶ˆè´¹çš„ consumer çš„ id</span></span><br><span class="line"><span class="comment"># HOST        å½“å‰æ¶ˆè´¹çš„ consumer çš„ä¸»æœºå</span></span><br><span class="line"><span class="comment"># CLIENT-ID   å½“å‰æ¶ˆè´¹çš„ consumer çš„å®¢æˆ·ç«¯åç§°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ consumer ç»„</span></span><br><span class="line">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --delete --group <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h2 id="producer">producer</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º producer</span></span><br><span class="line">kafka-console-producer.sh --bootstrap-server localhost:9092 --topic <span class="built_in">test</span></span><br><span class="line"><span class="comment"># --topic æŒ‡å®š topic</span></span><br></pre></td></tr></table></figure><h2 id="æ‰‹åŠ¨è§¦å‘-Kafka-Partitoin-çš„-Leader-é€‰ä¸¾-è‡ªå¹³è¡¡">æ‰‹åŠ¨è§¦å‘ Kafka Partitoin çš„ Leader é€‰ä¸¾(è‡ªå¹³è¡¡)</h2><ul class="lvl-0"><li class="lvl-2"><p>kafkaçš„è‡ªå¹³è¡¡é»˜è®¤å¼€å¯ï¼Œæ¯éš” 300ç§’æ‰«æä¸€æ¬¡ï¼Œå¦‚æœéœ€è¦å¹³è¡¡çš„æ¯”ä¾‹é«˜äº 10%ï¼Œåˆ™ä¼šè§¦å‘ä¸€æ¬¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯è‡ªåŠ¨å¹³è¡¡</span></span><br><span class="line">auto.leader.rebalance.enable=<span class="literal">true</span></span><br><span class="line"><span class="comment"># é—´éš”æ‰«ææ—¶é—´ é»˜è®¤ 300 ç§’</span></span><br><span class="line">eader.imbalance.check.interval.seconds=300</span><br><span class="line"><span class="comment"># è§¦å‘æ¯”ä¾‹ï¼Œå³æ‰«æçš„ broker ä¸Šéœ€è¦å¹³è¡¡çš„ partition å å½“å‰ broker å…¨éƒ¨ partition çš„æ¯”ä¾‹ï¼Œé»˜è®¤ 10%</span></span><br><span class="line">leader.imbalance.per.broker.percentage=10</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å»ºè®®å…³é—­ï¼Œæ”¹ä¸ºä¸šåŠ¡ä½å³°æ—¶æ‰‹åŠ¨è§¦å‘</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªåŠ¨å¹³è¡¡</span></span><br><span class="line">kafka-leader-election.sh --bootstrap-server localhost:9092  --election-type preferred --topic <span class="built_in">test</span> --partition 0</span><br><span class="line"><span class="comment"># --topic æŒ‡å®šè¦è§¦å‘çš„ topic</span></span><br><span class="line"><span class="comment"># --partition 0 è§¦å‘ partition 0 çš„ leader é€‰ä¸¾</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ğŸ§© å‚æ•°è¯´æ˜ï¼šâ€“election-type</p></li></ul><table><thead><tr><th>å‚æ•°å€¼</th><th>å«ä¹‰</th><th>è§¦å‘æ¡ä»¶</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong><code>preferred</code></strong></td><td><strong>é¦–é€‰ Leader é€‰ä¸¾</strong>ï¼ˆPreferred Leader Electionï¼‰<br>Kafka ä¼šå°è¯•å°†åˆ†åŒºçš„ leader é‡æ–°åˆ‡æ¢ä¸ºã€Œé¦–é€‰å‰¯æœ¬ã€ï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªå‰¯æœ¬ï¼‰ã€‚</td><td>åªæœ‰å½“å‰ leader <strong>ä¸æ˜¯</strong> é¦–é€‰å‰¯æœ¬æ—¶æ‰æ‰§è¡Œã€‚</td><td>æŸäº›å‰¯æœ¬è¢«è‡ªåŠ¨é€‰ä¸¾æˆ leader åï¼Œå¸Œæœ›æ¢å¤åŸæœ‰ã€Œé¦–é€‰ leaderã€ç»“æ„ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</td></tr><tr><td><strong><code>unclean</code></strong></td><td><strong>éå¹²å‡€ Leader é€‰ä¸¾</strong>ï¼ˆUnclean Leader Electionï¼‰<br>å…è®¸ä»ä¸åŒæ­¥çš„å‰¯æœ¬ä¸­é€‰ä¸¾æ–°çš„ leaderã€‚</td><td>ä»…åœ¨åˆ†åŒº <strong>æ²¡æœ‰å¯ç”¨ leader</strong> æ—¶æ‰§è¡Œã€‚</td><td>åœ¨ç´§æ€¥æ¢å¤åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚æ‰€æœ‰ ISR å‰¯æœ¬éƒ½ä¸‹çº¿ï¼‰ï¼Œä¸ºäº†æ¢å¤æœåŠ¡å¯ç”¨æ€§ï¼Œå³ä½¿ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Leader Partitionâ¾ƒåŠ¨å¹³è¡¡æœºåˆ¶</p><ul class="lvl-2"><li class="lvl-6">Leader Partitoiné€‰ä¸¾æœºåˆ¶èƒ½å¤Ÿä¿è¯æ¯â¼€ä¸ªPartitionåŒâ¼€æ—¶åˆ»æœ‰ä¸”ä»…æœ‰â¼€ä¸ªLeader Partitionã€‚ä½†æ˜¯ï¼Œæ˜¯ä¸æ˜¯åªè¦åˆ†é…å¥½äº†Leader Partitionå°±å¤Ÿäº†å‘¢ï¼Ÿ</li><li class="lvl-6">åœ¨â¼€ç»„Partitonä¸­ï¼ŒLeader Partitioné€šå¸¸æ˜¯â½è¾ƒç¹å¿™çš„èŠ‚ç‚¹ï¼Œå› ä¸ºä»–è¦è´Ÿè´£ä¸å®¢æˆ·ç«¯çš„æ•°æ®äº¤äº’ï¼Œä»¥åŠå‘FolloweråŒæ­¥æ•°æ®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKafkaä¼šå°½é‡å°†Leader Partitionåˆ†é…åˆ°ä¸åŒçš„BrokerèŠ‚ç‚¹ä¸Šï¼Œâ½¤ä»¥ä¿è¯æ•´ä¸ªé›†ç¾¤çš„æ€§èƒ½å‹â¼’èƒ½å¤Ÿâ½è¾ƒå¹³å‡ã€‚</li><li class="lvl-6">ä½†æ˜¯ï¼Œç»è¿‡Leader Partitioné€‰ä¸¾åï¼Œè¿™ç§å¹³è¡¡å°±æœ‰å¯èƒ½ä¼šè¢«æ‰“ç ´ï¼Œè®©Leader Partitionè¿‡å¤šçš„é›†ä¸­åˆ°åŒâ¼€ä¸ªBrokerä¸Šã€‚è¿™æ ·ï¼Œè¿™ä¸ªBrokerçš„å‹â¼’å°±ä¼šæ˜æ˜¾â¾¼äºå…¶ä»–Brokerï¼Œä»â½½å½±å“åˆ°é›†ç¾¤çš„æ•´ä½“æ€§èƒ½ã€‚</li><li class="lvl-6">ä¸ºæ­¤ï¼ŒKafkaè®¾è®¡äº†Leader Partitionâ¾ƒåŠ¨å¹³è¡¡æœºåˆ¶ï¼Œå½“å‘ç°Leaderåˆ†é…ä¸å‡è¡¡æ—¶ï¼Œâ¾ƒåŠ¨è¿›â¾Leader Partitionè°ƒæ•´ã€‚</li><li class="lvl-6">Kafkaåœ¨è¿›â¾Leader Partitionâ¾ƒå¹³è¡¡æ—¶çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼šä»–ä¼šè®¤ä¸ºAR(Replicaså‰¯æœ¬é›†)å½“ä¸­çš„ç¬¬â¼€ä¸ªèŠ‚ç‚¹å°±åº”è¯¥æ˜¯LeaderèŠ‚ç‚¹ã€‚è¿™ç§é€‰ä¸¾ç»“æœæˆä¸ºpreferred election ç†æƒ³é€‰ä¸¾ç»“æœã€‚</li><li class="lvl-6">Controllerä¼šå®šæœŸæ£€æµ‹é›†ç¾¤çš„Partitionå¹³è¡¡æƒ…å†µï¼Œåœ¨å¼€å§‹æ£€æµ‹æ—¶ï¼ŒControllerä¼šä¾æ¬¡æ£€æŸ¥æ‰€æœ‰çš„Brokerã€‚å½“å‘ç°è¿™ä¸ªBrokerä¸Šçš„ä¸å¹³è¡¡çš„Partitionâ½ä¾‹â¾¼äº<code>leader.imbalance.per.broker.percentage</code>é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè§¦å‘â¼€æ¬¡Leader Partitonçš„â¾ƒå¹³è¡¡ã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Kafka çš„ å¸¸ç”¨å‘½ä»¤&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org&quot;&gt;Kafkaå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/kafka-3-demo&quot;&gt;Java-Client ä»£ç ç¤ºä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafka çš„ server.properties é…ç½®é¡¹</title>
    <link href="https://blog.hanqunfeng.com/2025/10/14/kafka-01-server-config/"/>
    <id>https://blog.hanqunfeng.com/2025/10/14/kafka-01-server-config/</id>
    <published>2025-10-14T13:30:05.000Z</published>
    <updated>2025-10-14T03:13:41.481Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„ server.properties çš„é…ç½®é¡¹ï¼ŒåŸºäº Zookeeperã€‚</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org">Kafkaå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p></li></ul><span id="more"></span><h2 id="Kafka-3-x-server-properties-ä¸»è¦é…ç½®é¡¹æ¸…å•">Kafka 3.x server.properties ä¸»è¦é…ç½®é¡¹æ¸…å•</h2><table><thead><tr><th>åˆ†ç±»</th><th>å‚æ•°å</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th><th>æ¨è/å¤‡æ³¨</th></tr></thead><tbody><tr><td>ğŸ—‚ï¸ <strong>åŸºæœ¬ä¿¡æ¯</strong></td><td><code>broker.id</code></td><td>0</td><td>Broker å”¯ä¸€æ ‡è¯†</td><td>é›†ç¾¤ä¸­å¿…é¡»å”¯ä¸€</td></tr><tr><td></td><td><code>node.id</code></td><td>-</td><td>Raft æ¨¡å¼ï¼ˆKRaftï¼‰ä¸‹ä½¿ç”¨</td><td>ZK æ¨¡å¼å¿½ç•¥</td></tr><tr><td></td><td><code>process.roles</code></td><td>-</td><td>KRaft æ¨¡å¼è§’è‰²ï¼ˆcontroller, brokerï¼‰</td><td>ZK æ¨¡å¼ä¸é…ç½®</td></tr><tr><td>ğŸ”Œ <strong>ç½‘ç»œä¸ç›‘å¬é…ç½®</strong></td><td><code>listeners</code></td><td>PLAINTEXT://:9092</td><td>Broker ç›‘å¬åœ°å€</td><td>å¯ç”¨å¤šä¸ªåè®®ï¼Œå¦‚ SASL_PLAINTEXT, SSL</td></tr><tr><td></td><td><code>advertised.listeners</code></td><td>-</td><td>å®¢æˆ·ç«¯è¿æ¥æ—¶çœ‹åˆ°çš„åœ°å€</td><td>å¤–ç½‘è®¿é—®éœ€é…ç½®</td></tr><tr><td></td><td><code>listener.security.protocol.map</code></td><td>PLAINTEXT:PLAINTEXT</td><td>æ˜ å°„ç›‘å¬å™¨åè®®</td><td>å¤šåè®®æ—¶é…ç½®</td></tr><tr><td></td><td><code>inter.broker.listener.name</code></td><td>-ï¼ˆKafka 2.4+ é»˜è®¤ç¬¬ä¸€ä¸ª listenerï¼‰</td><td>æŒ‡å®š broker é—´é€šä¿¡ä½¿ç”¨å“ªä¸ª listenerï¼ˆå¦‚ INTERNALï¼‰</td><td>é›†ç¾¤å†…éƒ¨é€šä¿¡å¿…é¡»ä¸€è‡´ï¼›å¸¸é…åˆå¤š listener ä½¿ç”¨</td></tr><tr><td></td><td><code>num.network.threads</code></td><td>3</td><td>ç½‘ç»œçº¿ç¨‹æ•°</td><td>ä¸€èˆ¬ä¸éœ€ä¿®æ”¹</td></tr><tr><td></td><td><code>num.io.threads</code></td><td>8</td><td>å¤„ç†è¯·æ±‚çš„ IO çº¿ç¨‹æ•°</td><td>æ ¹æ® CPU è°ƒæ•´</td></tr><tr><td></td><td><code>socket.send.buffer.bytes</code></td><td>102400</td><td>å‘é€ç¼“å†²åŒºå¤§å°</td><td>ç½‘ç»œä¼˜åŒ–å‚æ•°</td></tr><tr><td></td><td><code>socket.receive.buffer.bytes</code></td><td>102400</td><td>æ¥æ”¶ç¼“å†²åŒºå¤§å°</td><td>ç½‘ç»œä¼˜åŒ–å‚æ•°</td></tr><tr><td></td><td><code>socket.request.max.bytes</code></td><td>104857600</td><td>å•è¯·æ±‚æœ€å¤§å¤§å° (100MB)</td><td>å¤§æ¶ˆæ¯éœ€è°ƒå¤§</td></tr><tr><td>âš™ï¸ <strong>é›†ç¾¤ä¸å…ƒæ•°æ®</strong></td><td><code>log.dirs</code></td><td>/tmp/kafka-logs</td><td>æ•°æ®å­˜å‚¨è·¯å¾„</td><td>å¤šç›®å½•å¯æå‡æ€§èƒ½</td></tr><tr><td></td><td><code>num.recovery.threads.per.data.dir</code></td><td>1</td><td>æ¯ä¸ªæ•°æ®ç›®å½•çš„æ¢å¤çº¿ç¨‹æ•°</td><td>å¤šç£ç›˜æ—¶å¯å¢åŠ </td></tr><tr><td></td><td><code>auto.create.topics.enable</code></td><td>true</td><td>æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topic</td><td>ç”Ÿäº§å»ºè®®ç¦ç”¨</td></tr><tr><td></td><td><code>controlled.shutdown.enable</code></td><td>true</td><td>ä¼˜é›…å…³é—­ Broker</td><td>å»ºè®®å¼€å¯</td></tr><tr><td></td><td><code>delete.topic.enable</code></td><td>true</td><td>æ˜¯å¦å…è®¸åˆ é™¤ Topic</td><td>ç”Ÿäº§æ…ç”¨</td></tr><tr><td></td><td><code>auto.leader.rebalance.enable</code></td><td>true</td><td>æ˜¯å¦è‡ªåŠ¨å‡è¡¡ Leader</td><td>å»ºè®®å¼€å¯</td></tr><tr><td></td><td><code>leader.imbalance.check.interval.seconds</code></td><td>300</td><td>æ£€æŸ¥ leader å¤±è¡¡é—´éš”</td><td>ä¸ä¸Šé…åˆä½¿ç”¨</td></tr><tr><td></td><td><code>leader.imbalance.per.broker.percentage</code></td><td>10</td><td>è§¦å‘ leader é‡å¹³è¡¡çš„é˜ˆå€¼</td><td>é»˜è®¤å³å¯</td></tr><tr><td>ğŸ§± <strong>å‰¯æœ¬ä¸å¤åˆ¶æœºåˆ¶</strong></td><td><code>default.replication.factor</code></td><td>1</td><td>æ–° Topic é»˜è®¤å‰¯æœ¬æ•°</td><td>ç”Ÿäº§å»ºè®® 3</td></tr><tr><td></td><td><code>offsets.topic.replication.factor</code></td><td>1</td><td>æ¶ˆè´¹ç»„åç§»ä¸»é¢˜å‰¯æœ¬æ•°</td><td>å»ºè®® 3</td></tr><tr><td></td><td><code>transaction.state.log.replication.factor</code></td><td>1</td><td>äº‹åŠ¡çŠ¶æ€ä¸»é¢˜å‰¯æœ¬æ•°</td><td>å»ºè®® 3</td></tr><tr><td></td><td><code>transaction.state.log.min.isr</code></td><td>1</td><td>äº‹åŠ¡çŠ¶æ€æ—¥å¿—æœ€å° ISR æ•°</td><td>å»ºè®® 2</td></tr><tr><td></td><td><code>min.insync.replicas</code></td><td>1</td><td>Leader å†™å…¥æ—¶è¦æ±‚çš„æœ€å° ISR å‰¯æœ¬æ•°</td><td>å»ºè®® <code>replication.factor - 1</code></td></tr><tr><td></td><td><code>unclean.leader.election.enable</code></td><td>false</td><td>æ˜¯å¦å…è®¸éåŒæ­¥å‰¯æœ¬é€‰ä¸º leader</td><td>ç”Ÿäº§å»ºè®® false</td></tr><tr><td></td><td><code>num.replica.fetchers</code></td><td>1</td><td>follower æ‹‰å–çº¿ç¨‹æ•°</td><td>å¯æå‡å¤åˆ¶æ€§èƒ½</td></tr><tr><td></td><td><code>replica.fetch.max.bytes</code></td><td>1048576 (1MB)</td><td>follower æ‹‰å–å•åˆ†åŒºæœ€å¤§æ•°æ®é‡</td><td>å¢å¤§å¯æé€Ÿ</td></tr><tr><td></td><td><code>replica.fetch.response.max.bytes</code></td><td>10485760 (10MB)</td><td>follower ä¸€æ¬¡æ‹‰å–å“åº”æ€»é‡</td><td>å¯è°ƒå¤§</td></tr><tr><td></td><td><code>replica.fetch.wait.max.ms</code></td><td>500</td><td>follower ç­‰å¾…æ–°æ•°æ®çš„æœ€å¤§æ—¶é•¿</td><td>å»¶è¿Ÿä¸ååæŠ˜ä¸­</td></tr><tr><td></td><td><code>replica.fetch.backoff.ms</code></td><td>1000</td><td>æ‹‰å–å¤±è´¥åé€€é¿æ—¶é—´</td><td>ç½‘ç»œä¸ç¨³æ—¶è°ƒæ•´</td></tr><tr><td></td><td><code>replica.socket.timeout.ms</code></td><td>30000</td><td>follower ä¸ leader é€šä¿¡è¶…æ—¶</td><td>â‰¥ <a href="http://fetch.wait.ms">fetch.wait.ms</a></td></tr><tr><td></td><td><code>replica.socket.receive.buffer.bytes</code></td><td>65536</td><td>æ‹‰å– socket ç¼“å†²åŒº</td><td>è°ƒå¤§å¯æé€Ÿ</td></tr><tr><td></td><td><code>replica.lag.time.max.ms</code></td><td>10000</td><td>follower è½å leader çš„æœ€å¤§æ—¶é—´</td><td>å½±å“ ISR</td></tr><tr><td></td><td><code>replica.high.watermark.checkpoint.interval.ms</code></td><td>5000</td><td>é«˜æ°´ä½å†™å…¥ checkpoint å‘¨æœŸ</td><td>å½±å“æ¢å¤é€Ÿåº¦</td></tr><tr><td></td><td><code>replica.selector.class</code></td><td>-</td><td>è‡ªå®šä¹‰å‰¯æœ¬é€‰æ‹©ç±»</td><td>ä¸€èˆ¬ä¿æŒé»˜è®¤</td></tr><tr><td>ğŸ§® <strong>æ—¥å¿—ä¸æ®µæ–‡ä»¶</strong></td><td><code>log.segment.bytes</code></td><td>1073741824 (1GB)</td><td>å•æ—¥å¿—æ®µæ–‡ä»¶å¤§å°</td><td>è°ƒå°ä¾¿äºåˆ é™¤</td></tr><tr><td></td><td><code>log.segment.ms</code></td><td>604800000 (7å¤©)</td><td>å¼ºåˆ¶æ»šåŠ¨æ—¥å¿—çš„æ—¶é—´</td><td>é€‚ç”¨äºæ—¶é—´æ§åˆ¶</td></tr><tr><td></td><td><code>log.retention.hours</code></td><td>168</td><td>æ—¥å¿—ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰</td><td>ä¸ç£ç›˜ç©ºé—´ç›¸å…³</td></tr><tr><td></td><td><code>log.retention.bytes</code></td><td>-1</td><td>æ—¥å¿—æ€»å¤§å°é™åˆ¶</td><td>-1 è¡¨ç¤ºä¸é™åˆ¶</td></tr><tr><td></td><td><code>log.retention.check.interval.ms</code></td><td>300000</td><td>æ£€æŸ¥æ—¥å¿—ä¿ç•™ç­–ç•¥é—´éš”</td><td>é»˜è®¤å³å¯</td></tr><tr><td></td><td><code>log.cleaner.enable</code></td><td>true</td><td>æ˜¯å¦å¯ç”¨æ—¥å¿—å‹ç¼©</td><td>compact ä¸»é¢˜éœ€å¯ç”¨</td></tr><tr><td></td><td><code>log.cleaner.threads</code></td><td>1</td><td>æ¸…ç†çº¿ç¨‹æ•°</td><td>å¤§é›†ç¾¤å¯å¢åŠ </td></tr><tr><td></td><td><code>log.cleaner.io.max.bytes.per.second</code></td><td>None</td><td>é™åˆ¶æ¸…ç† IO å¸¦å®½</td><td>æ§åˆ¶ç£ç›˜è´Ÿè½½</td></tr><tr><td></td><td><code>log.flush.interval.messages</code></td><td>Long.MAX_VALUE</td><td>ç´¯è®¡æ¶ˆæ¯æ•°è¾¾åˆ°åå¼ºåˆ¶ flush</td><td>é€šå¸¸ä¿æŒé»˜è®¤</td></tr><tr><td></td><td><code>log.flush.interval.ms</code></td><td>None</td><td>æ¯éš”å¤šä¹…å¼ºåˆ¶ flush</td><td>SSD å¯è°ƒå¤§</td></tr><tr><td></td><td><code>num.partitions</code></td><td>1</td><td>æ–° Topic é»˜è®¤åˆ†åŒºæ•°</td><td>é€šå¸¸ 3~6 èµ·æ­¥</td></tr><tr><td>ğŸ§µ <strong>ç”Ÿäº§ä¸æ¶ˆè´¹ç›¸å…³</strong></td><td><code>message.max.bytes</code></td><td>1048576</td><td>å…è®¸çš„æœ€å¤§æ¶ˆæ¯å¤§å°</td><td>ä¸ Producer <code>max.request.size</code> å¯¹é½</td></tr><tr><td></td><td><code>replica.fetch.max.bytes</code></td><td>1048576</td><td>ä¸ Producer/Consumer å¯¹åº”çš„é™åˆ¶</td><td>é˜²æ­¢å¤§æ¶ˆæ¯å¡æ­»</td></tr><tr><td></td><td><code>compression.type</code></td><td>producer</td><td>å‹ç¼©ç®—æ³•ï¼ˆnone, gzip, snappy, lz4, zstdï¼‰</td><td>å»ºè®® zstd</td></tr><tr><td></td><td><code>queued.max.requests</code></td><td>500</td><td>Broker æœ€å¤§æ’é˜Ÿè¯·æ±‚æ•°</td><td>é»˜è®¤å³å¯</td></tr><tr><td>ğŸ› ï¸ <strong>æ§åˆ¶å™¨ä¸åè°ƒå™¨</strong></td><td><code>controller.socket.timeout.ms</code></td><td>30000</td><td>æ§åˆ¶å™¨é€šä¿¡è¶…æ—¶</td><td>é»˜è®¤å³å¯</td></tr><tr><td></td><td><code>controller.quorum.voters</code></td><td>-</td><td>KRaft æ¨¡å¼é€‰ä¸¾æˆå‘˜</td><td>ZK æ¨¡å¼ä¸éœ€</td></tr><tr><td></td><td><code>controller.listener.names</code></td><td>-</td><td>æ§åˆ¶å™¨ç›‘å¬å</td><td>ZK æ¨¡å¼å¿½ç•¥</td></tr><tr><td>ğŸ“ˆ <strong>ç›‘æ§ä¸æŒ‡æ ‡</strong></td><td><code>metric.reporters</code></td><td>ç©º</td><td>æŒ‡æ ‡ä¸ŠæŠ¥ç±»</td><td>å¯æ¥ Prometheus</td></tr><tr><td></td><td><code>metrics.num.samples</code></td><td>2</td><td>æŒ‡æ ‡é‡‡æ ·æ•°</td><td>é»˜è®¤å³å¯</td></tr><tr><td></td><td><code>metrics.sample.window.ms</code></td><td>30000</td><td>æŒ‡æ ‡é‡‡æ ·çª—å£</td><td>é»˜è®¤å³å¯</td></tr><tr><td></td><td><code>replica.fetchers.metrics.enabled</code></td><td>true</td><td>æ˜¯å¦å¯ç”¨å‰¯æœ¬æ‹‰å–æŒ‡æ ‡</td><td>Kafka 3.x æ–°å¢</td></tr><tr><td>ğŸ”’ <strong>å®‰å…¨</strong></td><td><code>authorizer.class.name</code></td><td>ç©º</td><td>æˆæƒç±»å®ç°</td><td>å¼€å¯ ACL æ—¶é…ç½®</td></tr><tr><td></td><td><code>super.users</code></td><td>ç©º</td><td>è¶…çº§ç”¨æˆ·åˆ—è¡¨</td><td>ACL æ¨¡å¼ä¸‹é…ç½®</td></tr><tr><td></td><td><code>ssl.keystore.location</code></td><td>-</td><td>SSL è¯ä¹¦è·¯å¾„</td><td>å¯ç”¨ SSL æ—¶ä½¿ç”¨</td></tr><tr><td></td><td><code>ssl.truststore.location</code></td><td>-</td><td>ä¿¡ä»»è¯ä¹¦è·¯å¾„</td><td>å¯ç”¨ SSL æ—¶ä½¿ç”¨</td></tr></tbody></table><h2 id="å‚æ•°ä½¿ç”¨å»ºè®®æ€»ç»“">å‚æ•°ä½¿ç”¨å»ºè®®æ€»ç»“</h2><table><thead><tr><th>åœºæ™¯</th><th>æ¨èé…ç½®</th></tr></thead><tbody><tr><td><strong>é«˜å¯é æ€§é›†ç¾¤</strong></td><td><code>default.replication.factor=3</code>, <code>min.insync.replicas=2</code>, <code>unclean.leader.election.enable=false</code></td></tr><tr><td><strong>ååä¼˜å…ˆ</strong></td><td>æé«˜ <code>num.replica.fetchers</code>ã€<code>replica.fetch.max.bytes</code></td></tr><tr><td><strong>å¿«é€Ÿæ¢å¤</strong></td><td>å‡å°‘ <code>replica.high.watermark.checkpoint.interval.ms</code></td></tr><tr><td><strong>èŠ‚çœç£ç›˜</strong></td><td>å¯ç”¨ <code>log.cleaner.enable</code> å¹¶è®¾ç½® <code>log.retention.hours</code></td></tr><tr><td><strong>äº‹åŠ¡æˆ–ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰</strong></td><td>è®¾ç½® <code>transaction.state.log.replication.factor=3</code>ã€<code>transaction.state.log.min.isr=2</code></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„ server.properties çš„é…ç½®é¡¹ï¼ŒåŸºäº Zookeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org&quot;&gt;Kafkaå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafka çš„ Web UI ä¹‹ Kafbat UI</title>
    <link href="https://blog.hanqunfeng.com/2025/10/13/kafka-03-webui/"/>
    <id>https://blog.hanqunfeng.com/2025/10/13/kafka-03-webui/</id>
    <published>2025-10-13T15:30:05.000Z</published>
    <updated>2025-10-16T06:08:20.857Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Kafka çš„ Web UI ä¹‹ Kafbat UI</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org">Kafkaå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p></li><li class="lvl-2"><p><a href="https://kafbat.io">Kafbat UI å®˜ç½‘</a>,<a href="https://github.com/kafbat/kafka-ui">Kafbat UI Github</a>,<a href="https://ui.docs.kafbat.io">Kafbat UI æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="Kafbat-UI-ç®€ä»‹">Kafbat UI ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Kafbat UI æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æº Web ç”¨æˆ·ç•Œé¢ï¼Œç”¨äºç›‘æ§å’Œç®¡ç† Apache Kafka é›†ç¾¤ã€‚</p></li><li class="lvl-2"><p>Kafbat UI æ˜¯ä¸€ä¸ªç®€å•çš„å·¥å…·ï¼Œä½¿æ‚¨çš„æ•°æ®æµå˜å¾—å¯è§‚å¯Ÿï¼Œå¸®åŠ©æ›´å¿«åœ°å‘ç°å’Œæ’é™¤é—®é¢˜ï¼Œå¹¶æä¾›æœ€ä½³æ€§èƒ½ã€‚å…¶è½»é‡çº§çš„ä»ªè¡¨ç›˜ä½¿æ‚¨èƒ½å¤Ÿè½»æ¾è·Ÿè¸ª Kafka é›†ç¾¤çš„å…³é”®æŒ‡æ ‡: åŒ…æ‹¬ Brokersã€Topicsã€Partitionsã€ç”Ÿäº§å’Œæ¶ˆè´¹æƒ…å†µã€‚</p></li></ul><h2 id="è¿è¡Œ-Kafbat-UI">è¿è¡Œ Kafbat UI</h2><h3 id="Docker-è¿è¡Œ">Docker è¿è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 8080:8080 \</span><br><span class="line">    --name kafka-ui \</span><br><span class="line">    -e KAFKA_CLUSTERS_0_NAME=kafka_c01 \</span><br><span class="line">    -e KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=localhost:9092 \</span><br><span class="line">    -e TZ=Asia/Shanghai \</span><br><span class="line">    -d ghcr.io/kafbat/kafka-ui:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Jar-è¿è¡Œ">Jar è¿è¡Œ</h3><ul class="lvl-0"><li class="lvl-2"><p>ä»<a href="https://github.com/kafbat/kafka-ui/releases">Github</a>ä¸Šä¸‹è½½æœ€æ–°ç‰ˆjaråŒ…ï¼Œè¦æ±‚ <code>jdk 21+</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /Users/hanqf/myservice_dir/kafka_webui</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®kafkaé›†ç¾¤ï¼Œå¯ä»¥åŒæ—¶é…ç½®å¤šä¸ªï¼Œåºå·ä»0å¼€å§‹ä¾æ¬¡é€’å¢</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_CLUSTERS_0_NAME=kafka_c01</span><br><span class="line"><span class="comment"># =============================================================================================================</span></span><br><span class="line"><span class="comment"># å¤–ç½‘PLAINTEXTè®¿é—®</span></span><br><span class="line"><span class="comment"># export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9093,68.79.13.235:9093,43.192.84.195:9093</span></span><br><span class="line"><span class="comment"># =============================================================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================================================================</span></span><br><span class="line"><span class="comment"># å¤–ç½‘SASL_PLAINTEXTè®¿é—®</span></span><br><span class="line"><span class="comment"># export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9094,68.79.13.235:9094,43.192.84.195:9094</span></span><br><span class="line"><span class="comment"># # SASL_PLAINTEXTè®¤è¯é…ç½®</span></span><br><span class="line"><span class="comment"># export KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL=SASL_PLAINTEXT</span></span><br><span class="line"><span class="comment"># export KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM=PLAIN</span></span><br><span class="line"><span class="comment"># export KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG=&#x27;org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;alice&quot; password=&quot;alice-secret&quot;;&#x27;</span></span><br><span class="line"><span class="comment"># =============================================================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================================================================</span></span><br><span class="line"><span class="comment"># å¤–ç½‘SASL_SSLè®¿é—®</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9095,68.79.13.235:9095,43.192.84.195:9095</span><br><span class="line"><span class="built_in">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL=SASL_SSL</span><br><span class="line"><span class="built_in">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM=PLAIN</span><br><span class="line"><span class="built_in">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG=<span class="string">&#x27;org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;alice&quot; password=&quot;alice-secret&quot;;&#x27;</span></span><br><span class="line"><span class="comment"># SSLé…ç½®</span></span><br><span class="line"><span class="comment"># JKS æ ¼å¼è¯ä¹¦</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_LOCATION=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/kafka.truststore.jks</span><br><span class="line"><span class="built_in">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_PASSWORD=123456</span><br><span class="line"></span><br><span class="line"><span class="comment"># PEM æ ¼å¼è¯ä¹¦</span></span><br><span class="line"><span class="comment"># export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_LOCATION=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/server.crt</span></span><br><span class="line"><span class="comment"># export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_TYPE=PEM</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦ç”¨ä¸»æœºåéªŒè¯</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># ============================================================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒä¸ªé›†ç¾¤é…ç½®ç¤ºä¾‹</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_CLUSTERS_1_NAME=kafka_c02</span><br><span class="line"><span class="built_in">export</span> KAFKA_CLUSTERS_1_BOOTSTRAPSERVERS=161.189.227.200:9093,68.79.13.235:9093,43.192.84.195:9093</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¶åŒº</span></span><br><span class="line"><span class="built_in">export</span> TZ=Asia/Shanghai</span><br><span class="line"><span class="comment"># è¯­è¨€</span></span><br><span class="line"><span class="built_in">export</span> LANG=zh_CN.UTF-8</span><br><span class="line"></span><br><span class="line"><span class="comment"># webuiè®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> SERVER_SERVLET_CONTEXT_PATH=/</span><br><span class="line"><span class="comment"># è®¤è¯æ–¹å¼ï¼Œæ”¯æŒNONE(æ— è®¤è¯)ï¼ŒLOGIN_FORM(ç™»å½•è¡¨å•è®¤è¯)</span></span><br><span class="line"><span class="built_in">export</span> AUTH_TYPE=LOGIN_FORM</span><br><span class="line"><span class="comment"># webuiè®¤è¯ç”¨æˆ·åå¯†ç </span></span><br><span class="line"><span class="built_in">export</span> SPRING_SECURITY_USER_NAME=admin</span><br><span class="line"><span class="built_in">export</span> SPRING_SECURITY_USER_PASSWORD=admin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">JAVA_OPTS=<span class="string">&quot;-Xms512m -Xmx1024m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m&quot;</span></span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">/Users/hanqf/develop_soft/jdk21/bin/java --add-opens java.rmi/javax.rmi.ssl=ALL-UNNAMED  <span class="variable">$JAVA_OPTS</span> -jar api-v1.3.0.jar</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®-Kafbat-UI">è®¿é—® Kafbat UI</h2><ul class="lvl-0"><li class="lvl-2"><p>è®¿é—® <a href="http://localhost:8080">http://localhost:8080</a><br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/ykd6F4.png" alt=""></p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Kafka çš„ Web UI ä¹‹ Kafbat UI&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org&quot;&gt;Kafkaå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafbat.io&quot;&gt;Kafbat UI å®˜ç½‘&lt;/a&gt;,&lt;a href=&quot;https://github.com/kafbat/kafka-ui&quot;&gt;Kafbat UI Github&lt;/a&gt;,&lt;a href=&quot;https://ui.docs.kafbat.io&quot;&gt;Kafbat UI æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafka é€šä¿¡åè®®ã€SSLåŠ å¯†å’Œèº«ä»½éªŒè¯</title>
    <link href="https://blog.hanqunfeng.com/2025/10/13/kafka-02-protocol/"/>
    <id>https://blog.hanqunfeng.com/2025/10/13/kafka-02-protocol/</id>
    <published>2025-10-13T14:30:05.000Z</published>
    <updated>2025-10-16T08:58:11.618Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Kafka çš„ é€šä¿¡åè®®ï¼Œä»¥åŠå¦‚ä½•å¼€å¯å¤–ç½‘è®¿é—®ã€‚</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org">Kafkaå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p></li></ul><span id="more"></span><h2 id="Kafka-çš„-é€šä¿¡åè®®">Kafka çš„ é€šä¿¡åè®®</h2><ul class="lvl-0"><li class="lvl-2"><p>Kafka ä¸»è¦æ”¯æŒå››ç§å®‰å…¨åè®®</p></li></ul><table><thead><tr><th>åè®®åç§°</th><th>åŠ å¯†</th><th>è®¤è¯</th><th>è¯´æ˜</th><th>æ¨èåœºæ™¯</th><th>ç†ç”±</th></tr></thead><tbody><tr><td><strong>PLAINTEXT</strong></td><td>âŒ å¦</td><td>âŒ å¦</td><td>æ— åŠ å¯†ã€æ— è®¤è¯ï¼ˆé»˜è®¤æœ€ç®€å•ï¼‰</td><td>å¼€å‘ / æµ‹è¯•ç¯å¢ƒã€å†…ç½‘é›†ç¾¤é€šä¿¡</td><td>ç®€å•ã€æ˜“è°ƒè¯•ï¼›ç½‘ç»œå¯ä¿¡ï¼Œæ€§èƒ½ä¼˜å…ˆ</td></tr><tr><td><strong>SSL</strong></td><td>âœ… æ˜¯</td><td>âœ… å¯é€‰</td><td>ä½¿ç”¨ TLS/SSL åŠ å¯†é€šä¿¡ï¼Œå¯é…ç½®å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯</td><td>å¤–ç½‘å®¢æˆ·ç«¯è®¿é—®</td><td>æ”¯æŒæ•°æ®åŠ å¯†ï¼Œå¯é€‰è®¤è¯ï¼Œä¿è¯å®‰å…¨</td></tr><tr><td><strong>SASL_PLAINTEXT</strong></td><td>âŒ å¦</td><td>âœ… æ˜¯</td><td>ä½¿ç”¨ SASLï¼ˆç”¨æˆ·åå¯†ç ï¼‰è®¤è¯ï¼Œä½†ä¸åŠ å¯†æ•°æ®</td><td>éœ€è¦ç”¨æˆ·è®¤è¯ä½†å±€åŸŸç½‘ç¯å¢ƒ</td><td>æœ‰è®¤è¯ï¼Œä½†ä¸åŠ å¯†ï¼Œæ€§èƒ½å¼€é”€ä½</td></tr><tr><td><strong>SASL_SSL</strong></td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td>åŒæ—¶æ”¯æŒ SASL è®¤è¯å’Œ SSL åŠ å¯†ï¼ˆæœ€å®‰å…¨ï¼‰</td><td>å¤–ç½‘å®¢æˆ·ç«¯è®¿é—®</td><td>æ—¢æœ‰è®¤è¯åˆåŠ å¯†ï¼Œå®‰å…¨æ€§æœ€é«˜</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ <code>config/server.properties</code> æ–‡ä»¶ä¸­ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¥—æ¥å­—æœåŠ¡å™¨ç›‘å¬çš„åœ°å€ã€‚</span></span><br><span class="line"><span class="comment"># å¦‚æœæœªé…ç½®ï¼Œåˆ™ä¸»æœºåé»˜è®¤ç­‰äº `java.net.InetAddress.getCanonicalHostName()` çš„è¿”å›å€¼ï¼Œ</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç›‘å¬å™¨åç§° `PLAINTEXT`ï¼Œç«¯å£å·ä¸º 9092ã€‚</span></span><br><span class="line"><span class="comment">#   æ ¼å¼ï¼š</span></span><br><span class="line"><span class="comment">#     listeners = listener_name://host_name:port</span></span><br><span class="line"><span class="comment">#   ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment">#     listeners = PLAINTEXT://your.host.name:9092</span></span><br><span class="line"><span class="comment">#listeners=PLAINTEXT://:9092</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Broker å‘å®¢æˆ·ç«¯â€œé€šå‘Šâ€çš„ç›‘å¬å™¨åç§°ã€ä¸»æœºåå’Œç«¯å£ã€‚</span></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯å®é™…ä¼šè¿æ¥è¿™ä¸ªåœ°å€ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ listeners çš„åœ°å€ã€‚</span></span><br><span class="line"><span class="comment"># å¦‚æœæœªè®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ `listeners` çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">#advertised.listeners=PLAINTEXT://your.host.name:9092</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ç›‘å¬å™¨åç§°æ˜ å°„åˆ°å®‰å…¨åè®®ç±»å‹ã€‚</span></span><br><span class="line"><span class="comment"># é»˜è®¤æƒ…å†µä¸‹ï¼Œç›‘å¬å™¨åç§°ä¸å®‰å…¨åè®®åŒåã€‚</span></span><br><span class="line"><span class="comment"># ä¾‹å¦‚ï¼šPLAINTEXTâ†’PLAINTEXTã€SSLâ†’SSLã€SASL_PLAINTEXTâ†’SASL_PLAINTEXTã€SASL_SSLâ†’SASL_SSLã€‚</span></span><br><span class="line"><span class="comment"># æ›´å¤šç»†èŠ‚å¯å‚è€ƒ Kafka å®˜æ–¹é…ç½®æ–‡æ¡£ã€‚</span></span><br><span class="line"><span class="comment">#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>é…ç½®é¡¹</th><th>ä½œç”¨</th><th>è¯´æ˜å€¼</th></tr></thead><tbody><tr><td><code>listeners</code></td><td>Kafka å®é™…ç›‘å¬çš„åœ°å€ï¼ˆBroker å¯¹å¤–å¼€æ”¾çš„ç«¯å£ï¼‰</td><td><code>PLAINTEXT://:9092</code>è¿™é‡Œ PLAINTEXT æ˜¯ç›‘å¬å™¨åç§°ï¼Œå¹¶ä¸æ˜¯åè®®åç§°ï¼Œå®é™…ä¸Šå¯ä»¥é…ç½®ä¸ºä»»ä½•å€¼ï¼Œå…·ä½“åè®®æ˜¯é€šè¿‡ <code>listener.security.protocol.map</code> é…ç½®çš„æ˜ å°„å…³ç³»æ¥ç¡®å®šã€‚</td></tr><tr><td><code>advertised.listeners</code></td><td>Kafka å‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç”¨å“ªä¸ªåœ°å€è¿æ¥ï¼ˆå®¢æˆ·ç«¯æœ€ç»ˆè¿çš„ï¼‰</td><td>é»˜è®¤ä½¿ç”¨ <code>listeners</code> çš„å€¼</td></tr><tr><td><code>listener.security.protocol.map</code></td><td>æ˜ å°„ç›‘å¬å™¨åç§°åˆ°é€šä¿¡å®‰å…¨åè®®ï¼ˆå¦‚æ˜æ–‡ã€SSLã€SASL ç­‰ï¼‰</td><td><code>PLAINTEXT:PLAINTEXT</code>ï¼Œå‰é¢æ˜¯ç›‘å¬å™¨åç§°ï¼Œåé¢æ˜¯åè®®åç§°</td></tr></tbody></table><h2 id="ä»…éœ€å†…ç½‘è®¿é—®">ä»…éœ€å†…ç½‘è®¿é—®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">listeners=PLAINTEXT://0.0.0.0:9092</span><br><span class="line">advertised.listeners=PLAINTEXT://worker1:9092 <span class="comment"># è¿™é‡Œæ˜¯å†…ç½‘ip</span></span><br></pre></td></tr></table></figure><h2 id="å…è®¸å¤–ç½‘è®¿é—®">å…è®¸å¤–ç½‘è®¿é—®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">listeners=PLAINTEXT://0.0.0.0:9092</span><br><span class="line">advertised.listeners=PLAINTEXT://161.189.227.200:9092 <span class="comment"># è¿™é‡Œæ˜¯å¤–ç½‘ip</span></span><br></pre></td></tr></table></figure><h2 id="å†…å¤–ç½‘éƒ½è¦è®¿é—®ï¼ˆæ¨èåŒé€šé“æ–¹å¼ï¼‰">å†…å¤–ç½‘éƒ½è¦è®¿é—®ï¼ˆæ¨èåŒé€šé“æ–¹å¼ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œ INTERNAL å’Œ EXTERNAL åˆ†åˆ«æ˜¯è‡ªå®šä¹‰çš„ç›‘å¬å™¨åç§°ï¼Œæ­¤æ—¶å†…ç½‘ç«¯å£ä¸º 9092ï¼Œå¤–ç½‘ç«¯å£ä¸º 9093</span></span><br><span class="line">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9093</span><br><span class="line"><span class="comment"># å‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç”¨å“ªä¸ªåœ°å€è¿æ¥</span></span><br><span class="line">advertised.listeners=INTERNAL://worker1:9092,EXTERNAL://161.189.227.200:9093</span><br><span class="line"><span class="comment"># æ˜ å°„ç›‘å¬å™¨åç§°åˆ°é€šä¿¡å®‰å…¨åè®®çš„æ˜ å°„å…³ç³»</span></span><br><span class="line">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT</span><br><span class="line"><span class="comment"># é›†ç¾¤é—´é€šä¿¡ä»ä½¿ç”¨å†…ç½‘</span></span><br><span class="line">inter.broker.listener.name=INTERNAL</span><br></pre></td></tr></table></figure><h2 id="å¼€å¯-SASL-PLAINTEXT">å¼€å¯ SASL_PLAINTEXT</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œè®¾ç½®å¤–ç½‘è®¿é—®æ—¶å¼€å¯ SASL_PLAINTEXT</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®</span></span><br><span class="line">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9094</span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€</span></span><br><span class="line">advertised.listeners=INTERNAL://worker1:9092,EXTERNAL://161.189.227.200:9094</span><br><span class="line">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_PLAINTEXT</span><br><span class="line"><span class="comment"># é›†ç¾¤é—´é€šä¿¡ still use INTERNAL</span></span><br><span class="line">inter.broker.listener.name=INTERNAL</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512ï¼‰</span></span><br><span class="line"><span class="comment"># client è¿æ¥æ—¶</span></span><br><span class="line">sasl.enabled.mechanisms=PLAIN</span><br><span class="line"><span class="comment"># broker ä¹‹é—´è¿æ¥æ—¶ï¼Œå› ä¸º inter.broker.listener.name=INTERNALï¼Œæ‰€ä»¥ INTERNAL:SASL_PLAINTEXT æ‰æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">#sasl.mechanism.inter.broker.protocol=PLAIN</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º kafka_jaas.conf</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############################</span></span><br><span class="line"><span class="comment"># Kafka Broker (æœåŠ¡ç«¯)</span></span><br><span class="line"><span class="comment">############################</span></span><br><span class="line">KafkaServer &#123;</span><br><span class="line">    <span class="comment"># å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule required</span></span><br><span class="line">    org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class="line">    <span class="comment"># Broker è‡ªå·±çš„èº«ä»½ï¼ˆç”¨äº broker ä¹‹é—´é€šä¿¡ï¼Œæœ¬ç¤ºä¾‹ä¸­æ²¡æœ‰ä½¿ç”¨ï¼‰</span></span><br><span class="line">    username=<span class="string">&quot;admin&quot;</span></span><br><span class="line">    password=<span class="string">&quot;admin-secret&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®¢æˆ·ç«¯å¯ç”¨è´¦å·ï¼Œå³ user_xxxï¼Œè¿™é‡Œ xxx ä¸ºç”¨æˆ·åï¼Œ= å³è¾¹çš„ä¸ºå¯†ç </span></span><br><span class="line">    user_admin=<span class="string">&quot;admin-secret&quot;</span></span><br><span class="line">    user_alice=<span class="string">&quot;alice-secret&quot;</span></span><br><span class="line">    user_bob=<span class="string">&quot;bob-secret&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ kafka</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å¯åŠ¨ Kafka Broker å‰ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡æŒ‡å‘ JAAS æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_OPTS=<span class="string">&quot;-Djava.security.auth.login.config=/usr/local/kafka/kafka3/config/kafka_jaas.conf&quot;</span></span><br><span class="line">kafka-server-start.sh config/server.properties</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯è®¿é—®">å®¢æˆ·ç«¯è®¿é—®</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º client.conf</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">security.protocol=SASL_PLAINTEXT</span><br><span class="line"><span class="comment"># è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒ PLAINã€SCRAM-SHA-256ã€SCRAM-SHA-512ï¼Œè¦ä¸ æœåŠ¡ç«¯ä¸€è‡´</span></span><br><span class="line">sasl.mechanism=PLAIN</span><br><span class="line"><span class="comment"># å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule required</span></span><br><span class="line">sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=<span class="string">&quot;admin&quot;</span> password=<span class="string">&quot;admin-secret&quot;</span>;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œè®¿é—®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºtopic</span></span><br><span class="line">kafka-topics.sh --create --topic test-topic --bootstrap-server=161.189.227.200:9094 --command-config=client.conf</span><br><span class="line"><span class="comment"># æŸ¥çœ‹topic</span></span><br><span class="line">kafka-topics.sh --list --bootstrap-server=161.189.227.200:9094 --command-config=client.conf</span><br><span class="line"><span class="comment"># åˆ›å»ºæ¶ˆè´¹è€…ï¼Œ--group æŒ‡å®šæ¶ˆè´¹è€…ç»„åç§°</span></span><br><span class="line">kafka-console-consumer.sh --bootstrap-server=161.189.227.200:9094 --topic test-topic --consumer.config=client.conf --group=test-group</span><br><span class="line"><span class="comment"># åˆ›å»ºç”Ÿäº§è€…</span></span><br><span class="line">kafka-console-producer.sh --bootstrap-server=161.189.227.200:9094 --topic test-topic --producer.config=client.conf</span><br></pre></td></tr></table></figure><h2 id="å¼€å¯-SASL-SSL">å¼€å¯ SASL_SSL</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œè®¾ç½®å¤–ç½‘è®¿é—®æ—¶å¼€å¯ SASL_SSL</p></li></ul><h3 id="åˆ›å»ºè¯ä¹¦">åˆ›å»ºè¯ä¹¦</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://kafka.apache.org/39/documentation.html#security_ssl">å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p>ç”Ÿæˆ Broker keystoreï¼Œç”¨äº å­˜å‚¨ broker çš„ç§é’¥å’Œè¯ä¹¦ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">keytool -keystore kafka.server.keystore.jks \</span><br><span class="line">  -<span class="built_in">alias</span> broker -validity 3650 \</span><br><span class="line">  -genkey -keyalg RSA \</span><br><span class="line">  -dname <span class="string">&quot;CN=broker, OU=Kafka, O=YourOrg, L=City, ST=State, C=CN&quot;</span> \</span><br><span class="line">  -storepass 123456 \</span><br><span class="line">  -keypass 123456</span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># -keystoreï¼šç”Ÿæˆçš„ keystore æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"># -alias brokerï¼šè¯ä¹¦åˆ«å</span></span><br><span class="line"><span class="comment"># -validity 3650ï¼šæœ‰æ•ˆæœŸ 3650 å¤©</span></span><br><span class="line"><span class="comment"># -keyalg RSAï¼šå¯†é’¥ç®—æ³•</span></span><br><span class="line"><span class="comment"># -dnameï¼šè¯ä¹¦ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># -storepassï¼škeystore å¯†ç </span></span><br><span class="line"><span class="comment"># -keypassï¼šå¯†é’¥å¯†ç </span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯¼å‡º Broker è¯ä¹¦ï¼ˆç”¨äºå®¢æˆ·ç«¯ truststoreï¼‰,ç”Ÿæˆ kafka.server.crtï¼Œå®¢æˆ·ç«¯ä¼šç”¨å®ƒæ¥éªŒè¯ brokerã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">keytool -keystore kafka.server.keystore.jks \</span><br><span class="line">  -<span class="built_in">alias</span> broker -<span class="built_in">export</span> -file kafka.server.crt \</span><br><span class="line">  -storepass 123456</span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># -keystoreï¼škeystore æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"># -alias brokerï¼šè¯ä¹¦åˆ«å</span></span><br><span class="line"><span class="comment"># -file kafka.server.crtï¼šå¯¼å‡ºçš„è¯ä¹¦æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"># -storepassï¼škeystore å¯†ç </span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç”Ÿæˆ Broker truststoreï¼Œtruststore ç”¨äº å­˜å‚¨ä¿¡ä»»çš„è¯ä¹¦ï¼ˆè¿™é‡ŒæŠŠè‡ªå·±ç”Ÿæˆçš„è¯ä¹¦å¯¼å…¥è¿›å»å³å¯ï¼‰,ç”Ÿæˆ kafka.truststore.jks</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ï¼šè¿™é‡Œ server ç«¯ å’Œ client ç«¯ å¯ä»¥å…±ç”¨ä¸€ä¸ª truststoreï¼Œä¹Ÿå¯ä»¥åˆ†åˆ«åˆ›å»º</span></span><br><span class="line">keytool -keystore kafka.truststore.jks \</span><br><span class="line">  -<span class="built_in">alias</span> broker -import -file kafka.server.crt \</span><br><span class="line">  -storepass 123456 -noprompt</span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># -keystoreï¼šç”Ÿæˆçš„ truststore æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"># -alias brokerï¼šè¯ä¹¦åˆ«å</span></span><br><span class="line"><span class="comment"># -file kafka.server.crtï¼šå¯¼å…¥çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"># -storepassï¼štruststore å¯†ç </span></span><br><span class="line"><span class="comment"># -nopromptï¼šä¸æç¤º</span></span><br></pre></td></tr></table></figure><h3 id="server-properties-é…ç½®-SASL-SSL">server.properties é…ç½® SASL_SSL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®</span></span><br><span class="line">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9095</span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€</span></span><br><span class="line">advertised.listeners=INTERNAL://worker2:9092,EXTERNAL://161.189.227.200:9095</span><br><span class="line">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_SSL</span><br><span class="line">inter.broker.listener.name=INTERNAL</span><br><span class="line"></span><br><span class="line"><span class="comment"># SASL</span></span><br><span class="line"><span class="comment"># è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512ï¼‰</span></span><br><span class="line"><span class="comment"># client è¿æ¥æ—¶</span></span><br><span class="line">sasl.enabled.mechanisms=PLAIN</span><br><span class="line"><span class="comment"># broker ä¹‹é—´è¿æ¥æ—¶ï¼Œéœ€è¦ inter.broker.listener.name=SASL_PLAINTEXT æ‰æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">#sasl.mechanism.inter.broker.protocol=PLAIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># SSL</span></span><br><span class="line">ssl.keystore.location=/usr/local/kafka/kafka3/config/ssl/kafka.server.keystore.jks</span><br><span class="line">ssl.keystore.password=123456</span><br><span class="line">ssl.key.password=123456</span><br><span class="line">ssl.truststore.location=/usr/local/kafka/kafka3/config/ssl/kafka.truststore.jks</span><br><span class="line">ssl.truststore.password=123456</span><br><span class="line"><span class="comment"># å¦‚æœä¸è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¯ä»¥è®¾ç½® none ï¼Œè¦æ±‚åˆ™è®¾ç½®ä¸º required</span></span><br><span class="line">ssl.client.auth=none</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ kafka å‰åŒæ ·éœ€è¦å…ˆåˆ›å»ºå¥½ kafka_jaas.confï¼Œä¸ SASL_PLAINTEXT ä¸€æ ·ã€‚</p></li></ul><h3 id="å®¢æˆ·ç«¯è®¿é—®-2">å®¢æˆ·ç«¯è®¿é—®</h3><ul class="lvl-0"><li class="lvl-2"><p>å°† <code>kafka.truststore.jks</code> æ‹·è´åˆ°å®¢æˆ·ç«¯</p></li><li class="lvl-2"><p>ä¸ SASL_PLAINTEXT ä¸€æ ·ï¼Œåˆ›å»º client.confï¼Œå¹¶æ·»åŠ å¦‚ä¸‹ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">security.protocol=SASL_SSL</span><br><span class="line"><span class="comment"># è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒ PLAINã€SCRAM-SHA-256ã€SCRAM-SHA-512ï¼Œè¦ä¸ æœåŠ¡ç«¯ä¸€è‡´</span></span><br><span class="line">sasl.mechanism=PLAIN</span><br><span class="line"><span class="comment"># å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule required</span></span><br><span class="line">sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=<span class="string">&quot;admin&quot;</span> password=<span class="string">&quot;admin-secret&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSL é…ç½®</span></span><br><span class="line">ssl.truststore.location=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/kafka.truststore.jks</span><br><span class="line">ssl.truststore.password=123456</span><br><span class="line"><span class="comment"># ç¦ç”¨ä¸»æœºåéªŒè¯ï¼Œå¦åˆ™ä¼šæ ¡éªŒè¯ä¹¦çš„ SANï¼Œè¯ä¹¦åŸŸåæ ¡éªŒå¼€å…³ï¼Œä¸ºç©ºåˆ™è¡¨ç¤ºå…³é—­ï¼Œè¿™é‡Œéœ€è¦ä¿æŒå…³é—­çŠ¶æ€ï¼Œå¿…é¡»è®¾ç½®ä¸ºç©º</span></span><br><span class="line">ssl.endpoint.identification.algorithm=</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œè®¿é—® ä¸ SASL_PLAINTEXT ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿°</p></li><li class="lvl-2"><p>å…³äº Kafka JKSæ ¼å¼çš„SSLè¯ä¹¦çš„åˆ›å»ºåŠé…ç½®å¯ä»¥å‚è€ƒ<a href="https://support.huaweicloud.com/usermanual-kafka/kafka-ug-0008.html">åˆ¶ä½œå’Œæ›¿æ¢Kafka JKSæ ¼å¼çš„SSLè¯ä¹¦</a></p></li></ul><h4 id="PEM-è¯ä¹¦">PEM è¯ä¹¦</h4><ul class="lvl-0"><li class="lvl-2"><p>Kafka çš„ è¯ä¹¦ é»˜è®¤ä½¿ç”¨ JKS æ ¼å¼ï¼Œä½†ä» 2.7.0 å¼€å§‹æ”¯æŒ PEM æ ¼å¼</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®</span></span><br><span class="line">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9095</span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€</span></span><br><span class="line">advertised.listeners=INTERNAL://worker2:9092,EXTERNAL://161.189.227.200:9095</span><br><span class="line">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_SSL</span><br><span class="line">inter.broker.listener.name=INTERNAL</span><br><span class="line"></span><br><span class="line"><span class="comment"># SASL</span></span><br><span class="line"><span class="comment"># è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ CRAM-SHA-256ã€SCRAM-SHA-512ï¼‰</span></span><br><span class="line"><span class="comment"># client è¿æ¥æ—¶</span></span><br><span class="line">sasl.enabled.mechanisms=PLAIN</span><br><span class="line"><span class="comment"># broker ä¹‹é—´è¿æ¥æ—¶ï¼Œéœ€è¦ inter.broker.listener.name=SASL_PLAINTEXT æ‰æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">#sasl.mechanism.inter.broker.protocol=PLAIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># SSL-PEM</span></span><br><span class="line">ssl.keystore.type=PEM <span class="comment"># æŒ‡å®šè¯ä¹¦ç±»å‹æ˜¯PEMï¼Œæ”¯æŒçš„ç±»å‹ PEMã€JKS</span></span><br><span class="line">ssl.keystore.location=/usr/local/kafka/kafka3/config/ssl/fullchain.pem <span class="comment"># åŒ…å«ç§é’¥å’Œå…¬é’¥</span></span><br><span class="line"><span class="comment"># æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨çš„è¯ä¹¦ç±»å‹æ˜¯PEM</span></span><br><span class="line">ssl.truststore.type=PEM</span><br><span class="line">ssl.truststore.location=/usr/local/kafka/kafka3/config/ssl/server.crt <span class="comment"># å…¬é’¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœä¸è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¯ä»¥è®¾ç½® none ï¼Œè¦æ±‚åˆ™è®¾ç½®ä¸º required</span></span><br><span class="line">ssl.client.auth=none</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>client.conf é…ç½®å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">security.protocol=SASL_SSL</span><br><span class="line"><span class="comment"># è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒ PLAINã€SCRAM-SHA-256ã€SCRAM-SHA-512ï¼Œè¦ä¸ æœåŠ¡ç«¯ä¸€è‡´</span></span><br><span class="line">sasl.mechanism=PLAIN</span><br><span class="line"><span class="comment"># å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule required</span></span><br><span class="line">sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=<span class="string">&quot;admin&quot;</span> password=<span class="string">&quot;admin-secret&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSL é…ç½®ï¼Œå°† server ç«¯çš„ server.crt æ‹·è´åˆ° client ç«¯</span></span><br><span class="line">ssl.truststore.location=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/server.crt</span><br><span class="line">ssl.truststore.type=PEM</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦ç”¨ä¸»æœºåéªŒè¯</span></span><br><span class="line">ssl.endpoint.identification.algorithm=</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>jks è¯ä¹¦è½¬æ¢ä¸º pem æ ¼å¼</strong></em></p><ul class="lvl-1"><li class="lvl-2">ä» JKS å¯¼å‡ºä¸º PKCS#12 (.p12)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">keytool -importkeystore \</span><br><span class="line">  -srckeystore kafka.server.keystore.jks \</span><br><span class="line">  -srcstoretype JKS \</span><br><span class="line">  -destkeystore kafka.server.p12 \</span><br><span class="line">  -deststoretype PKCS12 \</span><br><span class="line">  -srcstorepass 123456 \</span><br><span class="line">  -deststorepass 123456 \</span><br><span class="line">  -J<span class="string">&quot;-Djdk.tls.disabledAlgorithms=&quot;</span> \</span><br><span class="line">  -J<span class="string">&quot;-Dkeystore.pkcs12.legacy=false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## è¯´æ˜ï¼š</span></span><br><span class="line">  <span class="comment"># -srcstoretype JKSï¼šåŸå§‹æ ¼å¼ï¼›</span></span><br><span class="line">  <span class="comment"># -deststoretype PKCS12ï¼šè½¬æ¢ä¸ºé€šç”¨æ ¼å¼ï¼›</span></span><br><span class="line">  <span class="comment"># .p12 æ˜¯ PEM çš„â€œä¸­é—´æ ¼å¼â€ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">å¯¼å‡ºè¯ä¹¦[å…¬é’¥] (.crtï¼Œè¿™é‡Œæ˜¯ PEM æ ¼å¼)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -<span class="keyword">in</span> kafka.server.p12 -clcerts -nokeys -out server.crt -password pass:123456 -provider legacy -provider default</span><br><span class="line"><span class="comment">## è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># -clcertsï¼šåªå¯¼å‡ºè¯ä¹¦ï¼›</span></span><br><span class="line"><span class="comment"># -nokeysï¼šä¸å¯¼å‡ºå¯†é’¥ï¼›</span></span><br><span class="line"><span class="comment"># -out server.crtï¼šå¯¼å‡ºæ–‡ä»¶åï¼›</span></span><br><span class="line"><span class="comment"># -passwordï¼škafka.server.p12çš„å¯†é’¥å¯†ç ï¼Œæ³¨æ„å¯†ç å‰é¢åŠ ä¸Š pass:</span></span><br><span class="line"><span class="comment"># -provider legacyï¼šå¯ç”¨æ—§ç®—æ³•æ”¯æŒæ¨¡å—ï¼Œåœ¨ OpenSSL 3.0ï¼ˆåŠæ›´é«˜ç‰ˆæœ¬ï¼‰ä¸­ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°æœºåˆ¶ â€”â€” Providerï¼ˆç®—æ³•æä¾›è€…ï¼‰,é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenSSL åªåŠ è½½ modern providerï¼ˆdefault providerï¼‰ï¼Œè€Œè®¸å¤šè€æ—§ç®—æ³•ï¼ˆä¾‹å¦‚ RC2ã€MD5ã€DESã€SHA1ï¼‰è¢«ç§»åˆ°äº†ä¸€ä¸ªå•ç‹¬çš„ legacy provider æ¨¡å—ä¸­ã€‚</span></span><br><span class="line"><span class="comment"># -provider defaultï¼šåŒæ—¶å¯ç”¨é»˜è®¤ providerï¼Œå› ä¸ºæœ‰äº›å‘½ä»¤ï¼ˆæ¯”å¦‚æ¶‰åŠç°ä»£åŠ å¯†ç®—æ³•æˆ–è¯ä¹¦ç­¾åï¼‰è¿˜ä¾èµ–é»˜è®¤ providerï¼Œæ‰€ä»¥ä¸¤è€…ä¸€èµ·ä½¿ç”¨æœ€å®‰å…¨ã€æœ€å…¼å®¹</span></span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">å¯¼å‡ºç§é’¥ (.keyï¼Œè¿™é‡Œæ˜¯ PEM æ ¼å¼)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -<span class="keyword">in</span> kafka.server.p12 -nocerts -out server.key -nodes -password pass:123456 -provider legacy -provider default</span><br><span class="line"><span class="comment">## è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># -nocertsï¼šåªå¯¼å‡ºå¯†é’¥ï¼›</span></span><br><span class="line"><span class="comment"># -out server.keyï¼šå¯¼å‡ºæ–‡ä»¶åï¼›</span></span><br><span class="line"><span class="comment"># -nodesï¼šä¸åŠ å¯†å¯¼å‡ºçš„å¯†é’¥æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># -passwordï¼škafka.server.p12çš„å¯†é’¥å¯†ç ï¼Œæ³¨æ„å¯†ç å‰é¢åŠ ä¸Š pass:</span></span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">fullchain.pem</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -<span class="keyword">in</span> kafka.server.p12 -out fullchain.pem -nodes -password pass:123456 -provider legacy -provider default</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Kafka çš„ é€šä¿¡åè®®ï¼Œä»¥åŠå¦‚ä½•å¼€å¯å¤–ç½‘è®¿é—®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org&quot;&gt;Kafkaå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafka çš„å®‰è£…ï¼šåŸºäº Zookeeper</title>
    <link href="https://blog.hanqunfeng.com/2025/10/13/kafka-01-install-zookeeper/"/>
    <id>https://blog.hanqunfeng.com/2025/10/13/kafka-01-install-zookeeper/</id>
    <published>2025-10-13T13:30:05.000Z</published>
    <updated>2025-10-15T08:07:30.774Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº Zookeeperã€‚</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org">Kafkaå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p></li></ul><span id="more"></span><h2 id="Kafka-ç®€ä»‹">Kafka ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Apache Kafka æ˜¯ä¸€ä¸ª <code>åˆ†å¸ƒå¼çš„æµå¤„ç†/äº‹ä»¶æµå¹³å°</code>ï¼Œæ—¢å¯ä»¥ä½œä¸º<code>æ¶ˆæ¯ç³»ç»Ÿ</code>ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæŒä¹…åŒ–çš„ <code>æ—¥å¿—/è®°å½•å­˜å‚¨ä¸æµå¤„ç†å¹³å°</code>ã€‚</p></li><li class="lvl-2"><p>å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯é«˜ååã€ä½å»¶è¿Ÿã€å¯æ°´å¹³æ‰©å±•ã€å®¹é”™ï¼Œä»¥åŠå¯æŒä¹…åŒ–æ•°æ®ã€‚</p></li><li class="lvl-2"><p>åœ¨ Kafka ä¸­ï¼Œæ¶ˆæ¯è¢«å½’ç±»ä¸º <code>ä¸»é¢˜ï¼ˆTopicï¼‰</code>ï¼Œæ¯ä¸ªä¸»é¢˜å¯ä»¥æ ¹æ®é…ç½®è¢«æ‹†åˆ†ä¸ºå¤šä¸ª <code>åˆ†åŒºï¼ˆPartitionï¼‰</code>ï¼Œæ¯ä¸ªåˆ†åŒºå†…éƒ¨æ¶ˆæ¯æ˜¯<code>ä¸¥æ ¼æœ‰åº</code>çš„ï¼Œå¹¶ä»¥<code>è¿½åŠ </code>æ–¹å¼å†™å…¥ã€‚æ¶ˆè´¹è€…å¯ä»¥æŒ‰<code>åç§»é‡ï¼ˆoffsetï¼‰</code>è¯»å–æ¶ˆæ¯ã€‚</p></li><li class="lvl-2"><p>Kafka æä¾›å¤šä¸ª APIï¼šProducerã€Consumerã€Streamsï¼ˆæµå¤„ç†ï¼‰ã€Connectï¼ˆä¸å¤–éƒ¨ç³»ç»Ÿæ•´åˆï¼‰ç­‰ã€‚</p></li><li class="lvl-2"><p>Kafka çš„æ ¸å¿ƒæ¶æ„è¦ç´ ä¸å·¥ä½œæœºåˆ¶</p></li></ul><table><thead><tr><th>ç»„ä»¶ / æ¦‚å¿µ</th><th>ä½œç”¨ / æè¿°</th></tr></thead><tbody><tr><td>Brokerï¼ˆèŠ‚ç‚¹ / æœåŠ¡å™¨ï¼‰</td><td>Kafka é›†ç¾¤ä¸­çš„æœåŠ¡å™¨å®ä¾‹ï¼Œè´Ÿè´£æ¥æ”¶ã€å­˜å‚¨ã€åˆ†å‘æ¶ˆæ¯</td></tr><tr><td>Topic</td><td>æ¶ˆæ¯çš„â€œåˆ†ç±»â€é€»è¾‘å•å…ƒï¼ŒProducer å†™å…¥ã€Consumer è¯»å–</td></tr><tr><td>Partition</td><td>ä¸€ä¸ª Topic è¢«åˆ’åˆ†çš„å­å•å…ƒã€‚åˆ†åŒºä½¿å¾—ä¸»é¢˜å¯ä»¥æ¨ªå‘æ‰©å±•ï¼Œå¹¶æ”¯æŒå¹¶è¡Œè¯»å†™</td></tr><tr><td>Offset</td><td>æ¯æ¡æ¶ˆæ¯åœ¨æŸä¸ªåˆ†åŒºä¸­çš„å”¯ä¸€ä½ç½®æ ‡è¯†ï¼Œæ¶ˆè´¹è€…æ ¹æ® offset æ¥å†³å®šä¸‹ä¸€æ¡è¯»å–</td></tr><tr><td>Replicationï¼ˆå‰¯æœ¬ï¼‰</td><td>ä¸ºäº†å®¹é”™æ€§ï¼Œæ¯ä¸ªåˆ†åŒºå¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆå‰¯æœ¬åˆ†å¸ƒåœ¨ä¸åŒ Broker ä¸Šï¼‰</td></tr><tr><td>Leader / Follower</td><td>åœ¨å‰¯æœ¬ä¸­ï¼Œä¸€ä¸ªå‰¯æœ¬ä¸º Leaderï¼Œæ¥å—è¯»å†™è¯·æ±‚ï¼›å…¶ä»–ä¸º Followerï¼Œä» Leader åŒæ­¥æ•°æ®</td></tr><tr><td>Consumer Group</td><td>ä¸€ç»„æ¶ˆè´¹è€…å…±åŒæ¶ˆè´¹ä¸€ä¸ª Topicã€‚æ¯ä¸ªåˆ†åŒºåœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­é€šå¸¸åªè¢«ä¸€ä¸ªæ¶ˆè´¹è€… â€œæ‹¥æœ‰â€</td></tr><tr><td>ZooKeeper / KRaft</td><td>ç”¨äºå…ƒæ•°æ®ç®¡ç†ã€é›†ç¾¤åè°ƒï¼ˆåœ¨è¾ƒè€ç‰ˆæœ¬ä¸­æ˜¯ ZooKeeperï¼›æ–°ç‰ˆæœ¬æ¨å‘ KRaftï¼‰</td></tr></tbody></table><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/Xe43JY.png" alt="" width="900" height="600"></p><ul class="lvl-0"><li class="lvl-2"><p>æ¶ˆæ¯å†™å…¥æµç¨‹ï¼ˆç®€åŒ–ï¼‰ï¼š</p><ul class="lvl-2"><li class="lvl-4">Producer å°†æ¶ˆæ¯å‘é€ç»™æŸä¸ª Topic çš„ Leader åˆ†åŒºèŠ‚ç‚¹</li><li class="lvl-4">Leader æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†å…¶è¿½åŠ å†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œå¹¶è¿”å›ç¡®è®¤ï¼ˆACKï¼‰</li><li class="lvl-4">Follower å‰¯æœ¬ä» Leader æ‹‰å–æ•°æ®è¿›è¡ŒåŒæ­¥</li><li class="lvl-4">æ¶ˆè´¹è€…æ ¹æ®è‡ªå·±çš„ offset ä»å¯¹åº” Partition ä¸­è¯»å–æ¶ˆæ¯</li></ul></li><li class="lvl-2"><p>æ¶ˆè´¹æ§åˆ¶ä¸å®¹é”™ï¼š</p><ul class="lvl-2"><li class="lvl-4">æ¶ˆè´¹è€…ç»´æŠ¤è‡ªå·±çš„ offsetï¼ˆå¯ä»¥è‡ªåŠ¨æäº¤ï¼Œä¹Ÿå¯æ‰‹åŠ¨æ§åˆ¶ï¼‰ï¼Œè¿™æ ·å³ä½¿æ¶ˆè´¹è€…é‡å¯ï¼Œä¹Ÿå¯ä»¥ä»ä¸Šæ¬¡åœæ­¢çš„ä½ç½®ç»§ç»­ã€‚</li><li class="lvl-4">å¦‚æœæŸä¸ª Broker å®•æœºï¼Œå‰¯æœ¬å¯ä»¥åˆ‡æ¢ï¼ˆLeader é€‰ä¸¾ï¼‰ï¼Œä¿è¯æœåŠ¡ç»§ç»­ã€‚</li><li class="lvl-4">åˆ†åŒºä¸å‰¯æœ¬æœºåˆ¶ä½¿å¾— Kafka èƒ½å¤Ÿæ‰©å±•å®¹é‡ &amp; æé«˜å¯é æ€§ã€‚</li></ul></li><li class="lvl-2"><p>Kafka çš„å…¸å‹ä½¿ç”¨åœºæ™¯</p></li></ul><table><thead><tr><th>åœºæ™¯ç±»åˆ«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å®æ—¶æ•°æ®ç®¡é“ / æ•°æ®é›†æˆ</strong></td><td>ç”¨äºå°†å„ç§æ•°æ®æºï¼ˆå¦‚æ—¥å¿—ã€æ•°æ®åº“å˜æ›´ã€ä¼ æ„Ÿå™¨ã€ç”¨æˆ·äº‹ä»¶ç­‰ï¼‰å®æ—¶é‡‡é›†ã€ä¼ è¾“ã€åˆ†å‘åˆ°ä¸‹æ¸¸ç³»ç»Ÿï¼ˆå¦‚ OLAPã€æœç´¢å¼•æ“ã€ç›‘æ§å¹³å°ç­‰ï¼‰ï¼Œæ„å»ºé«˜æ•ˆçš„æ•°æ®é€šé“ã€‚</td></tr><tr><td><strong>äº‹ä»¶é©±åŠ¨ / äº‹ä»¶æº¯æº</strong></td><td>è®°å½•ç³»ç»Ÿå†…éƒ¨æˆ–è·¨ç³»ç»Ÿçš„äº‹ä»¶ï¼ˆçŠ¶æ€å˜åŒ–ï¼‰ï¼Œå®ç°äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰æˆ–äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰ï¼Œå¯ç”¨äºå®¡è®¡ã€å›æ”¾ã€çŠ¶æ€é‡å»ºç­‰ã€‚</td></tr><tr><td><strong>æ—¥å¿—èšåˆ / åˆ†æ</strong></td><td>å°†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨æ—¥å¿—ã€ç›‘æ§æŒ‡æ ‡ã€æ“ä½œæ—¥å¿—ç­‰ç»Ÿä¸€æ”¶é›†åˆ° Kafka ä¸­ï¼Œé›†ä¸­å­˜å‚¨ä¸åˆ†æï¼Œå¸¸ä¸ ELKã€ClickHouse ç­‰ç»“åˆã€‚</td></tr><tr><td><strong>æµå¤„ç†</strong></td><td>ä¸ Kafka Streamsã€Apache Flinkã€Spark Streaming ç­‰æµå¤„ç†æ¡†æ¶é…åˆï¼Œå¯¹æµç» Kafka çš„æ•°æ®è¿›è¡Œå®æ—¶è®¡ç®—ã€èšåˆã€è¿‡æ»¤ã€çª—å£ç»Ÿè®¡ç­‰æ“ä½œã€‚</td></tr><tr><td><strong>ç³»ç»Ÿè§£è€¦ / å¼‚æ­¥é€šä¿¡</strong></td><td>ä½œä¸ºç³»ç»Ÿé—´çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œå‡å°‘ç³»ç»Ÿé—´è€¦åˆï¼Œæ”¯æŒå¼‚æ­¥é€šä¿¡ã€æµé‡å‰Šå³°ã€ç¼“å†²ç­‰ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ä¸æ‰©å±•æ€§ã€‚</td></tr></tbody></table><h2 id="Kafka-å®‰è£…">Kafka å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œå…ˆä»‹ç»åŸºäº Zookeeper çš„å®‰è£…æ–¹å¼ï¼Œä¸‹æ–‡ä¼šä»‹ç»åŸºäº KRaft çš„å®‰è£…æ–¹å¼ã€‚</p></li><li class="lvl-2"><p>Kafka 3.9.1 çš„å®‰è£…ä¸è¿è¡Œéœ€è¦ JDK 8+ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦æå‰å®‰è£… JDK 8+ã€‚å¯ä»¥é€‰æ‹©OpenJDKï¼Œ<a href="https://mirrors.tuna.tsinghua.edu.cn/Adoptium/">æ¸…åå¤§å­¦é•œåƒç«™</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root ç”¨æˆ·</span></span><br><span class="line"><span class="comment"># åˆ›å»ºå®‰è£…ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> /usr/local/jdk</span><br><span class="line"><span class="built_in">cd</span> /usr/local/jdk</span><br><span class="line"><span class="comment"># ä¸‹è½½JDK</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/8/jdk/x64/linux/OpenJDK8U-jdk_x64_linux_hotspot_8u462b08.tar.gz</span><br><span class="line">tar -zxvf OpenJDK8U-jdk_x64_linux_hotspot_8u462b08.tar.gz</span><br><span class="line"><span class="built_in">ln</span> -s jdk8u462-b08 jdk8</span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export JAVA_HOME=/usr/local/jdk/jdk8&#x27;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œæ˜¯ å•å¼•å·ï¼ŒåŒå¼•å·ä¼šè§£æå˜é‡ï¼Œå¯¼è‡´é…ç½®å¤±è´¥</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PATH=$JAVA_HOME/bin:$PATH&#x27;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># æ£€æŸ¥JDKå®‰è£…</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…è¿‡ç¨‹å‚è€ƒå®˜ç½‘æ–‡æ¡£<a href="https://kafka.apache.org/39/documentation.html#quickstart">Kafka Quick Start</a>ã€‚</p></li></ul><h3 id="å•æœºå®‰è£…">å•æœºå®‰è£…</h3><ul class="lvl-0"><li class="lvl-2"><p>éƒ¨ç½²kafkaéƒ½ä¼šä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼Œå•æœºæ¨¡å¼åªä½œä¸ºå­¦ä¹ è¯•ç”¨ã€‚</p></li><li class="lvl-2"><p>ä¸‹è½½Kafkaï¼Œ<a href="https://kafka.apache.org/downloads">ä¸‹è½½é¡µé¢</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root ç”¨æˆ·</span></span><br><span class="line"><span class="comment"># åˆ›å»ºå®‰è£…ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> /usr/local/kafka</span><br><span class="line"><span class="built_in">cd</span> /usr/local/kafka</span><br><span class="line"><span class="comment"># ä¸‹è½½Kafka</span></span><br><span class="line">wget https://dlcdn.apache.org/kafka/3.9.1/kafka_2.13-3.9.1.tgz</span><br><span class="line">tar -zxvf kafka_2.13-3.9.1.tgz</span><br><span class="line"><span class="built_in">ln</span> -s kafka_2.13-3.9.1 kafka3</span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export KAFKA_HOME=/usr/local/kafka/kafka3&#x27;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PATH=$KAFKA_HOME/bin:$PATH&#x27;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># æŸ¥çœ‹Kafkaç‰ˆæœ¬</span></span><br><span class="line">kafka-topics.sh --version</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ Zookeeperï¼Œkafkaå†…ç½®äº†zookeeperï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬å®‰è£…ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰å°è¿è¡Œ</span></span><br><span class="line">zookeeper-server-start.sh /usr/local/kafka/kafka3/config/zookeeper.properties</span><br><span class="line"><span class="comment"># åå°è¿è¡Œ</span></span><br><span class="line"><span class="built_in">nohup</span> zookeeper-server-start.sh /usr/local/kafka/kafka3/config/zookeeper.properties &gt; zookeeper.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ kafka</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -daemon åå°è¿è¡Œ</span></span><br><span class="line">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥kafkaæ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class="line">jps -l | grep kafka</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ å¯åŠ¨ kafka éœ€è¦çš„å†…å­˜å¤§å°ä¸º 1Gï¼Œè¿™ä¸€ç‚¹å¯ä»¥åœ¨ <a href="http://kafka-server-start.sh">kafka-server-start.sh</a> è„šæœ¬ä¸­æŸ¥çœ‹åˆ°</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;x<span class="variable">$KAFKA_HEAP_OPTS</span>&quot;</span> = <span class="string">&quot;x&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">export</span> KAFKA_HEAP_OPTS=<span class="string">&quot;-Xmx1G -Xms1G&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">æ‰€ä»¥å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡åå†å¯åŠ¨kafka</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> KAFKA_HEAP_OPTS=<span class="string">&quot;-Xmx512M -Xms512M&quot;</span></span><br><span class="line">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure></div><ul class="lvl-0"><li class="lvl-2"><p>æµ‹è¯•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º topic</span></span><br><span class="line">kafka-topics.sh --create --bootstrap-server localhost:9092 --topic <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æ¶ˆè´¹è€…</span></span><br><span class="line">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class="built_in">test</span> --from-beginning</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ç”Ÿäº§è€…</span></span><br><span class="line">kafka-console-producer.sh --bootstrap-server localhost:9092 --topic <span class="built_in">test</span></span><br><span class="line">&gt; hello world <span class="comment"># è¾“å…¥å†…å®¹ï¼Œæ¶ˆè´¹è€…ä¼šæ”¶åˆ°</span></span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤å®‰è£…">é›†ç¾¤å®‰è£…</h3><ul class="lvl-0"><li class="lvl-2"><p>é›†ç¾¤å®‰è£…éœ€è¦å‡†å¤‡å¤šä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘å‡†å¤‡ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.7</span><br><span class="line">10.250.0.174</span><br><span class="line">10.250.0.108</span><br></pre></td></tr></table></figure><h4 id="æ­å»º-Zookeeper-é›†ç¾¤">æ­å»º Zookeeper é›†ç¾¤</h4><ul class="lvl-0"><li class="lvl-2"><p>å…³äºå¦‚ä½•æ­å»º Zookeeper é›†ç¾¤ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  <a href="/2025/09/15/zookeeper-study/" title="Zookeeper çš„å®‰è£…åŠä½¿ç”¨">Zookeeper çš„å®‰è£…åŠä½¿ç”¨</a></p></li><li class="lvl-2"><p>å¦‚æœå›¾çœäº‹ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Kafka è‡ªå¸¦çš„ zookeeperï¼Œç¼–è¾‘å…¶é…ç½®æ–‡ä»¶ <code>config/zookeeper.properties</code>å¦‚ä¸‹ï¼Œæ³¨æ„è¦åœ¨ <code>dataDir</code> ç›®å½•ä¸‹åˆ›å»º<code>myid</code>æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/usr/local/kafka/dataDir/zookeeper</span><br><span class="line"><span class="comment"># the port at which the clients will connect</span></span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></span><br><span class="line">maxClientCnxns=0</span><br><span class="line"><span class="comment"># Disable the adminserver by default to avoid port conflicts.</span></span><br><span class="line"><span class="comment"># Set the port to something non-conflicting if choosing to enable this</span></span><br><span class="line">admin.enableServer=<span class="literal">false</span></span><br><span class="line"><span class="comment"># admin.serverPort=8080</span></span><br><span class="line"></span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line"></span><br><span class="line">server.1=10.250.0.7:2888:3888</span><br><span class="line">server.2=10.250.0.174:2888:3888</span><br><span class="line">server.3=10.250.0.108:2888:3888</span><br></pre></td></tr></table></figure><h4 id="é…ç½®-Kafka-é›†ç¾¤">é…ç½® Kafka é›†ç¾¤</h4><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹ä¸»æœºçš„ä¸»æœºå</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl hostname worker1</span><br><span class="line"><span class="comment"># hostnamectl hostname worker2</span></span><br><span class="line"><span class="comment"># hostnamectl hostname worker3</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºäº†åç»­æ–¹ä¾¿ç»´æŠ¤ï¼Œå°†ipåœ°å€æ˜ å°„åˆ° hosts æ–‡ä»¶ä¸­</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.7 worker1</span><br><span class="line">10.250.0.174 worker2</span><br><span class="line">10.250.0.108 worker3</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¼–è¾‘ <code>config/server.properties</code> æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹å¦‚ä¸‹é…ç½®é¡¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#broker çš„å…¨å±€å”¯â¼€ç¼–å·ï¼Œä¸èƒ½é‡å¤ï¼Œåªèƒ½æ˜¯æ•°å­—ã€‚</span></span><br><span class="line">broker.id=1 <span class="comment"># è¿™é‡Œåˆ†åˆ«è®¾ç½®ä¸º1ã€2ã€3</span></span><br><span class="line"><span class="comment">#æœåŠ¡ç›‘å¬åœ°å€</span></span><br><span class="line">listeners=PLAINTEXT://worker1:9092</span><br><span class="line"><span class="comment">#æ•°æ®â½‚ä»¶åœ°å€ã€‚åŒæ ·é»˜è®¤æ˜¯ç»™çš„/tmpâ½¬å½•ã€‚</span></span><br><span class="line">log.dirs=/usr/local/kafka/dataDir/kafka-logs</span><br><span class="line"><span class="comment">#é»˜è®¤çš„æ¯ä¸ªTopicçš„åˆ†åŒºæ•°ï¼Œåˆ›å»ºTopicæ—¶ï¼Œå¦‚æœæœªæŒ‡å®šåˆ†åŒºæ•°ï¼Œåˆ™é»˜è®¤ä¸º1ä¸ªåˆ†åŒºã€‚</span></span><br><span class="line">num.partitions=1</span><br><span class="line"><span class="comment"># æ¯ä¸ªâ½‡å¿—â½‚ä»¶åˆ é™¤ä¹‹å‰ä¿å­˜çš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯168å°æ—¶ï¼Œå³7å¤©ã€‚</span></span><br><span class="line">log.retention.hours=168</span><br><span class="line"><span class="comment">#zookeeperçš„æœåŠ¡åœ°å€ï¼Œå¦‚æœæ˜¯è‡ªå»ºçš„ Zookeeper é›†ç¾¤ï¼Œåˆ™è¿™é‡Œéœ€è¦å¡«å†™é›†ç¾¤çš„è¿æ¥åœ°å€</span></span><br><span class="line">zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨ Kafka</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµ‹è¯•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º topic</span></span><br><span class="line">kafka-topics.sh --bootstrap-server worker1:9092 --create --replication-factor 3 --partitions 3 --topic disTopic</span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># --replication-factor 3 è¡¨ç¤ºåˆ›å»ºçš„å‰¯æœ¬æ•°</span></span><br><span class="line"><span class="comment"># --partitions 3 è¡¨ç¤ºåˆ›å»ºçš„åˆ†åŒºæ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ topic è¯¦æƒ…</span></span><br><span class="line">kafka-topics.sh --bootstrap-server worker1:9092 --describe --topic disTopic</span><br><span class="line">Topic: disTopicTopicId: VUK7Mc9oQdS1mjGG7OhQzQPartitionCount: 3ReplicationFactor: Configs:</span><br><span class="line">Topic: disTopicPartition: 0Leader: 2Replicas: 2,3,1Isr: 2,3,1Elr: N/ALastKnownElr: N/A</span><br><span class="line">Topic: disTopicPartition: 1Leader: 3Replicas: 3,1,2Isr: 3,1,2Elr: N/ALastKnownElr: N/A</span><br><span class="line">Topic: disTopicPartition: 2Leader: 1Replicas: 1,2,3Isr: 1,2,3Elr: N/ALastKnownElr: N/A</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº Zookeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org&quot;&gt;Kafkaå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ ä¹‹ Cluster</title>
    <link href="https://blog.hanqunfeng.com/2025/09/25/rabbitmq-cluster/"/>
    <id>https://blog.hanqunfeng.com/2025/09/25/rabbitmq-cluster/</id>
    <published>2025-09-25T14:30:05.000Z</published>
    <updated>2025-09-28T02:31:18.783Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Cluster çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p></li><li class="lvl-2"><p><a href="https://www.rabbitmq.com">Zookeeperå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p></li><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo">Java Client ç¤ºä¾‹</a></p></li></ul><span id="more"></span><h2 id="RabbitMQ-Cluster-é›†ç¾¤-ç®€ä»‹">RabbitMQ Cluster(é›†ç¾¤) ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ RabbitMQ ä¸­ï¼Œ<a href="https://www.rabbitmq.com/docs/clustering">Clusterï¼ˆé›†ç¾¤ï¼‰</a> æ˜¯å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œç”¨äºå®ç°é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡ã€‚</p></li><li class="lvl-2"><p>RabbitMQ é›†ç¾¤æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆä¸‰ä¸ªã€äº”ä¸ªã€ä¸ƒä¸ªæˆ–æ›´å¤šï¼‰èŠ‚ç‚¹çš„é€»è¾‘åˆ†ç»„ï¼Œ æ¯ä¸ªèŠ‚ç‚¹å…±äº« ç”¨æˆ·ã€è™šæ‹Ÿä¸»æœºã€é˜Ÿåˆ—ã€æµã€äº¤æ¢ã€ç»‘å®šã€è¿è¡Œæ—¶å‚æ•°å’Œå…¶ä»–åˆ†å¸ƒå¼çŠ¶æ€ã€‚</p></li><li class="lvl-2"><p>åœ¨ RabbitMQ ä¸­ï¼ŒClusterï¼ˆé›†ç¾¤ï¼‰çš„èŠ‚ç‚¹åˆ†ä¸ºä¸¤ç§ï¼š</p><ul class="lvl-2"><li class="lvl-4">ç£ç›˜èŠ‚ç‚¹(disk)ï¼šä¼šæŠŠé›†ç¾¤çš„æ‰€æœ‰å…ƒæ•°æ®ä¿¡æ¯ï¼ˆæ¯”å¦‚äº¤æ¢æœºã€ç»‘å®šã€é˜Ÿåˆ—ã€è™šæ‹Ÿä¸»æœºç­‰ä¿¡æ¯ï¼‰æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚Master èŠ‚ç‚¹å¿…é¡»æ˜¯ç£ç›˜èŠ‚ç‚¹ã€‚</li><li class="lvl-4">å†…å­˜èŠ‚ç‚¹(ram)ï¼šåªä¼šå°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹å®•æœºæˆ–é‡å¯ï¼Œå†…å­˜èŠ‚ç‚¹çš„æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±ï¼Œè€Œç£ç›˜èŠ‚ç‚¹çš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚Slave èŠ‚ç‚¹å¯ä»¥æ˜¯å†…å­˜èŠ‚ç‚¹ã€‚</li></ul></li><li class="lvl-2"><p>RabbitMQ 4.0 å¼€å§‹ï¼Œ é›†ç¾¤ä¸å†åŒºåˆ† <code>æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆClassic Clusterï¼‰</code> ä¸ <code>é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆMirrored Queue Clusterï¼‰</code> ï¼Œé›†ç¾¤åˆ›å»ºå¥½åï¼Œä¼šæ ¹æ®é˜Ÿåˆ—çš„<code>åˆå§‹å¤åˆ¶å› å­å‚æ•°</code>å†³å®šä¸ºè¯¥é˜Ÿåˆ—åˆ›å»ºå¤šå°‘ä¸ªå‰¯æœ¬ï¼Œæ¯”å¦‚ <code>Quroum Queue</code> çš„å‚æ•°æ˜¯ <code>x-quorum-initial-group-size</code>ï¼Œé»˜è®¤ä¸º3ã€‚</p></li><li class="lvl-2"><p>RabbitMQ 4.0 å¼€å§‹ï¼Œ<code>Quroum Queue</code> å’Œ <code>Stream Queue</code> é»˜è®¤å¼€å¯èŠ‚ç‚¹é—´<code>æ¶ˆæ¯å¤åˆ¶</code>ï¼Œä½†æ˜¯ <code>Classic Queue</code> é˜Ÿåˆ—ä¸æ”¯æŒèŠ‚ç‚¹é—´çš„<code>æ¶ˆæ¯å¤åˆ¶</code>;</p></li></ul><div class="tips"><p><em><strong>RabbitMQ 4.0ä»¥å‰çš„ é›†ç¾¤åˆ†ä¸ºä¸¤ç§æ¨¡å¼</strong></em></p><ul class="lvl-1"><li class="lvl-2"><ol><li class="lvl-5">æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆClassic Clusterï¼‰</li></ol><ul class="lvl-3"><li class="lvl-4">åœ¨ æ™®é€šé›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒRabbitMQ èŠ‚ç‚¹é€šè¿‡ Erlang åˆ†å¸ƒå¼ç³»ç»Ÿå®ç°äº’è”ï¼Œé›†ç¾¤å†…çš„å„ä¸ªèŠ‚ç‚¹å…±äº« æ¶ˆæ¯é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šç­‰å…ƒç´ ã€‚</li><li class="lvl-4">æ™®é€šé›†ç¾¤çš„ç‰¹ç‚¹ï¼š<ul class="lvl-5"><li class="lvl-6">å…±äº«é˜Ÿåˆ—ï¼šé˜Ÿåˆ—æ•°æ®ä»…å­˜å‚¨åœ¨å•ä¸€èŠ‚ç‚¹ä¸Šï¼Œåªæœ‰è¯¥èŠ‚ç‚¹å¯ä»¥å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li><li class="lvl-6">ä¸è‡ªåŠ¨å¤åˆ¶æ•°æ®ï¼šåœ¨æ™®é€šé›†ç¾¤ä¸­ï¼Œæ¶ˆæ¯å¹¶ä¸ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼Œé˜Ÿåˆ—ä¸Šçš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±ï¼Œæ— æ³•æ¢å¤ã€‚</li><li class="lvl-6">è´Ÿè½½å‡è¡¡ï¼šäº¤æ¢æœºï¼ˆExchangeï¼‰ä¼šæŠŠæ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—ï¼Œä½†é˜Ÿåˆ—æ•°æ®ä»ç„¶åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚å› æ­¤ï¼Œæ™®é€šé›†ç¾¤é€‚åˆä¸è¦æ±‚æé«˜å¯ç”¨æ€§çš„åœºæ™¯ã€‚</li><li class="lvl-6">ä¸å…·å¤‡é«˜å¯ç”¨æ€§ï¼šç”±äºæ•°æ®ä¸ä¼šåœ¨é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ä¸­å¤åˆ¶ï¼Œæ™®é€šé›†ç¾¤åœ¨æŸä¸ªèŠ‚ç‚¹å®•æœºæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±å’Œç³»ç»Ÿä¸å¯ç”¨ã€‚</li></ul></li></ul></li><li class="lvl-2"><ol start="2"><li class="lvl-5">é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆMirrored Queue Clusterï¼‰</li></ol><ul class="lvl-3"><li class="lvl-4">é•œåƒé›†ç¾¤æ¨¡å¼ æ˜¯ä¸ºäº† é«˜å¯ç”¨æ€§ è®¾è®¡çš„ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œé˜Ÿåˆ—çš„æ•°æ®ä¼šåœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œ å¤åˆ¶ï¼ˆé•œåƒï¼‰ï¼Œä»è€Œä¿è¯å³ä½¿æŸä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li><li class="lvl-4">é•œåƒé›†ç¾¤çš„ç‰¹ç‚¹ï¼š<ul class="lvl-5"><li class="lvl-6">é˜Ÿåˆ—é•œåƒï¼šåœ¨é•œåƒé›†ç¾¤æ¨¡å¼ä¸­ï¼Œé˜Ÿåˆ—æ•°æ®ä¼šåœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šå¤åˆ¶ã€‚æ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œå¤šä¸ªé•œåƒèŠ‚ç‚¹ã€‚</li><li class="lvl-6">é«˜å¯ç”¨æ€§ï¼šæ¶ˆæ¯ä¼šè¢«å¤åˆ¶åˆ°é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œä»è€Œä¿è¯å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œç³»ç»Ÿèƒ½è¿…é€Ÿæ¢å¤ã€‚</li><li class="lvl-6">èŠ‚ç‚¹æ•…éšœæ¢å¤ï¼šå½“ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šç»§ç»­å¤„ç†è¯¥é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä¿è¯ä¸šåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚</li><li class="lvl-6">ç½‘ç»œè´Ÿæ‹…è¾ƒé‡ï¼šç”±äºéœ€è¦åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥å’Œå¤åˆ¶ï¼Œæ‰€ä»¥é•œåƒé˜Ÿåˆ—æ¨¡å¼ä¼šå¢åŠ é›†ç¾¤çš„ç½‘ç»œè´Ÿæ‹…å’Œç£ç›˜ I/Oã€‚</li><li class="lvl-6">æ€§èƒ½å½±å“ï¼šé•œåƒé˜Ÿåˆ—æ¨¡å¼ä¼šç¨å¾®å½±å“æ€§èƒ½ï¼Œå› ä¸ºæ¯æ¬¡æ¶ˆæ¯å¤„ç†åï¼Œéƒ½éœ€è¦å°†æ•°æ®åŒæ­¥åˆ°å…¶ä»–é•œåƒèŠ‚ç‚¹ï¼Œå¢åŠ äº†å»¶è¿Ÿã€‚</li></ul></li></ul></li></ul></div><h2 id="é›†ç¾¤æ­å»º">é›†ç¾¤æ­å»º</h2><ul class="lvl-0"><li class="lvl-2"><p>å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«å®‰è£… RabbitMQ ï¼Œå®‰è£…æ–¹æ³•å‚çœ‹ <a href="/2025/09/18/rabbitmq-install-01/" title="RabbitMQ çš„å®‰è£…åŠä½¿ç”¨">RabbitMQ çš„å®‰è£…åŠä½¿ç”¨</a></p></li><li class="lvl-2"><p>å¼€æ”¾ç«¯å£</p></li></ul><table><thead><tr><th><strong>ç«¯å£èŒƒå›´</strong></th><th><strong>ç”¨é€”</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td><strong>4369</strong></td><td>epmdï¼ˆErlang Port Mapper Daemonï¼‰</td><td>RabbitMQ èŠ‚ç‚¹å’Œ CLI å·¥å…·ä½¿ç”¨çš„å¸®åŠ©ç¨‹åºå‘ç°å®ˆæŠ¤è¿›ç¨‹ã€‚</td></tr><tr><td><strong>6000-6500</strong></td><td>RabbitMQ Stream å¤åˆ¶ä½¿ç”¨</td><td>ç”¨äº RabbitMQ Stream çš„æ•°æ®å¤åˆ¶ã€‚</td></tr><tr><td><strong>25672</strong></td><td>Erlang åˆ†å‘æœåŠ¡å™¨ç«¯å£</td><td>ç”¨äºèŠ‚ç‚¹é—´å’Œ CLI å·¥å…·é€šä¿¡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»…é™äºå•ä¸ªç«¯å£ï¼ˆAMQPç«¯å£ + 20000ï¼‰ã€‚</td></tr><tr><td><strong>35672-35682</strong></td><td>Erlang åˆ†å‘å®¢æˆ·ç«¯ç«¯å£</td><td>ç”¨äº CLI å·¥å…·ä¸èŠ‚ç‚¹é€šä¿¡ï¼Œè®¡ç®—ä¸ºæœåŠ¡å™¨åˆ†å‘ç«¯å£ + 10000 åˆ° æœåŠ¡å™¨åˆ†å‘ç«¯å£ + 10010ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«ä¿®æ”¹ä¸‰å°æœåŠ¡å™¨çš„ <code>hostname</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl hostname rabbitmq01</span><br><span class="line"><span class="comment"># hostnamectl hostname rabbitmq02</span></span><br><span class="line"><span class="comment"># hostnamectl hostname rabbitmq03</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«ä¿®æ”¹ä¸‰å°æœåŠ¡å™¨çš„ <code>/etc/hosts</code> æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.56  rabbitmq01</span><br><span class="line">10.250.0.232 rabbitmq02</span><br><span class="line">10.250.0.97  rabbitmq03</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŒæ­¥é›†ç¾¤èŠ‚ç‚¹ä¸­çš„cookie</p><ul class="lvl-2"><li class="lvl-4">é»˜è®¤ä¼šåœ¨ <code>/var/lib/rabbitmq/</code>ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code>.erlang.cookie</code>ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li><li class="lvl-4">æˆ‘ä»¬ä½¿ç”¨ <code>rabbitmq01</code> èŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„ä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„æˆå‘˜èŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯ä¿è¯é›†ç¾¤ä¸­ä¸‰ä¸ªèŠ‚ç‚¹çš„è¿™ä¸ª<code>cookieå­—ç¬¦ä¸²ä¸€è‡´</code>ã€‚</li><li class="lvl-4">å°† <code>rabbitmq01</code> çš„ <code>/var/lib/rabbitmq/.erlang.cookie</code> æ–‡ä»¶ä¸­çš„<code>cookieå­—ç¬¦ä¸²</code>å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„ <code>/var/lib/rabbitmq/.erlang.cookie</code> æ–‡ä»¶ä¸­ã€‚</li></ul></li><li class="lvl-2"><p>åˆ†åˆ«å¯åŠ¨ä¸‰å°æœåŠ¡å™¨çš„ RabbitMQ æœåŠ¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start rabbitmq-server</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«ç™»å½• <code>rabbitmq02</code> å’Œ <code>rabbitmq03</code> èŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ‰rabbitmqåº”ç”¨</span></span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡ç½®rabbitmqã€äº¤æ¢æœºã€é˜Ÿåˆ—</span></span><br><span class="line">rabbitmqctl reset</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å…¥é›†ç¾¤ï¼Œæ³¨æ„æ­¤æ—¶ rabbitmq01 æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå¿…é¡»å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œ</span></span><br><span class="line"><span class="comment"># --ram è¡¨ç¤ºä»¥ ram å†…å­˜èŠ‚ç‚¹ åŠ å…¥é›†ç¾¤ã€‚å¦‚æœä¸å¸¦å‚æ•°é»˜è®¤ä¸º disk ç£ç›˜èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"># RabbitMQçš„é›†ç¾¤èŠ‚ç‚¹åˆ†ä¸º disk å’Œ ramï¼ŒdiskèŠ‚ç‚¹ä¼šå°†å…ƒæ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜å½“ä¸­ï¼Œè€ŒramèŠ‚ç‚¹åªæ˜¯åœ¨å†…å­˜ä¸­ä¿å­˜å…ƒæ•°æ®ã€‚</span></span><br><span class="line">rabbitmqctl join_cluster rabbit@rabbitmq01 --ram</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨rabbitmqåº”ç”¨</span></span><br><span class="line">rabbitmqctl start_app</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç™»å½• ä»»æ„ èŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl cluster_status</span><br><span class="line"><span class="comment">## è¾“å‡ºç±»ä¼¼</span></span><br><span class="line">Cluster status of node rabbit@rabbitmq01 ...</span><br><span class="line">Basics</span><br><span class="line"></span><br><span class="line">Cluster name: rabbit@rabbitmq01</span><br><span class="line">Total CPU cores available cluster-wide: 6</span><br><span class="line"></span><br><span class="line">Cluster Tags</span><br><span class="line"></span><br><span class="line">(none)</span><br><span class="line"></span><br><span class="line">Disk Nodes</span><br><span class="line"></span><br><span class="line">rabbit@rabbitmq01</span><br><span class="line"></span><br><span class="line">RAM Nodes</span><br><span class="line"></span><br><span class="line">rabbit@rabbitmq02</span><br><span class="line">rabbit@rabbitmq03</span><br><span class="line"></span><br><span class="line">Running Nodes</span><br><span class="line"></span><br><span class="line">rabbit@rabbitmq01</span><br><span class="line">rabbit@rabbitmq02</span><br><span class="line">rabbit@rabbitmq03</span><br></pre></td></tr></table></figure><blockquote><p>PS: ç”±äºramèŠ‚ç‚¹å‡å°‘äº†å¾ˆå¤šä¸ç¡¬ç›˜çš„äº¤äº’ï¼Œæ‰€ä»¥ï¼ŒramèŠ‚ç‚¹çš„å…ƒæ•°æ®ä½¿ç”¨æ€§èƒ½ä¼šæ¯”è¾ƒé«˜ã€‚ä½†æ˜¯ï¼ŒåŒæ—¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€å…ƒæ•°æ®çš„å®‰å…¨æ€§æ˜¯ä¸å¦‚diskèŠ‚ç‚¹çš„ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªé›†ç¾¤ä¸­ï¼Œ rabbitmq02 å’Œ rabbitmq03 éƒ½ä»¥ ramèŠ‚ç‚¹ çš„èº«ä»½åŠ å…¥åˆ° rabbitmq01 é›†ç¾¤é‡Œï¼Œå› æ­¤ï¼Œæ˜¯å­˜åœ¨å•ç‚¹æ•…éšœçš„ã€‚å¦‚æœ rabbitmq01 èŠ‚ç‚¹æœåŠ¡å´©æºƒï¼Œé‚£ä¹ˆå…ƒæ•°æ®å°±æœ‰å¯èƒ½ä¸¢å¤±ã€‚åœ¨ä¼ä¸šè¿›è¡Œéƒ¨ç½²æ—¶ï¼Œæ€§èƒ½ä¸å®‰å…¨æ€§éœ€è¦è‡ªå·±è¿›è¡Œå¹³è¡¡ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>ç™»å½•ä»»æ„èŠ‚ç‚¹çš„ç®¡ç†é¡µé¢ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/R195gJ.png" alt=""></p></li><li class="lvl-2"><p>æ­¤æ—¶æˆ‘ä»¬åœ¨ä»»æ„èŠ‚ç‚¹ä¸­åˆ›å»ºè™šæ‹Ÿä¸»æœºã€é˜Ÿåˆ—ã€äº¤æ¢æœºå’Œç»‘å®šå…³ç³» ç­‰å…ƒæ•°æ®ï¼Œéƒ½ä¼šè‡ªåŠ¨åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ä¸­ã€‚</p></li><li class="lvl-2"><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ ç®¡ç†æ§åˆ¶å° ä¸­æŸ¥çœ‹é˜Ÿåˆ—æ—¶çœ‹åˆ°ï¼Œæ­¤æ—¶å¤šä¸ªä¸€åˆ—ï¼Œ<code>Node</code>åˆ—ï¼Œæ˜¾ç¤ºè¯¥é˜Ÿåˆ—åœ¨å“ªäº›èŠ‚ç‚¹ä¸­å­˜åœ¨ã€‚åªæœ‰ <code>Quorum é˜Ÿåˆ—</code> å’Œ <code>Stream é˜Ÿåˆ—</code> æ‰ä¼šæ˜¾ç¤ºå¤šä¸ªèŠ‚ç‚¹ï¼Œå› ä¸º <code>Classic é˜Ÿåˆ—</code> ä¸æ”¯æŒå¤šèŠ‚ç‚¹å¤åˆ¶ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/GjHcLN.png" alt=""></p></li><li class="lvl-2"><p>æŸ¥çœ‹æŸä¸ªå…·ä½“çš„ <code>Quorum é˜Ÿåˆ—</code> æˆ– <code>Stream é˜Ÿåˆ—</code>ï¼Œå¯ä»¥çœ‹åˆ°æ›´è¯¦ç»†çš„è¯´æ˜<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/XtIkpp.png" alt=""></p></li><li class="lvl-2"><p>æ­¤æ—¶æ–°å»ºé˜Ÿåˆ—ï¼Œä¼šè¦æ±‚æˆ‘ä»¬æŒ‡å®šä¸»èŠ‚ç‚¹(Leader)ï¼Œå³è´Ÿè´£å­˜å‚¨æ¶ˆæ¯çš„çš„èŠ‚ç‚¹ï¼Œè€Œ <code>Quorum é˜Ÿåˆ—</code> æˆ– <code>Stream é˜Ÿåˆ—</code>ï¼Œä¼šè‡ªåŠ¨å°†æ¶ˆæ¯å¤åˆ¶åˆ°å…¶å®ƒèŠ‚ç‚¹(Members)ã€‚</p><ul class="lvl-2"><li class="lvl-4">Leader: é˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€‚</li><li class="lvl-4">Members: é˜Ÿåˆ—çš„æˆå‘˜èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯çš„å‰¯æœ¬ã€‚</li></ul></li></ul><h2 id="æ¼”ç¤ºé˜Ÿåˆ—å¤åˆ¶">æ¼”ç¤ºé˜Ÿåˆ—å¤åˆ¶</h2><ul class="lvl-0"><li class="lvl-2"><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Quorum é˜Ÿåˆ—</code> å’Œ <code>Stream é˜Ÿåˆ—</code> çš„ å¤åˆ¶æ•° éƒ½ä¸º 3ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘åœ¨å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ <code>rabbitmq04</code>ï¼Œè¯·è‡ªè¡ŒæŒ‰ä¸Šé¢çš„æ–¹æ³•æ·»åŠ ã€‚</p></li></ul><h3 id="Quorum-é˜Ÿåˆ—">Quorum é˜Ÿåˆ—</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨é¡µé¢ä¸Šåˆ›å»ºä¸€ä¸ª <code>Quorum é˜Ÿåˆ—</code>ï¼Œä¸å•èŠ‚ç‚¹ä¸Šåˆ›å»ºé˜Ÿåˆ—çš„åŒºåˆ«å°±æ˜¯éœ€è¦æˆ‘ä»¬é€‰æ‹©ä¸»èŠ‚ç‚¹ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/JYfKgg.png" alt=""></p></li><li class="lvl-2"><p>é€šè¿‡ å®¢æˆ·ç«¯ åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿æ¥å“ªä¸ªèŠ‚ç‚¹ï¼Œå“ªä¸ªèŠ‚ç‚¹å°±æ˜¯Leaderï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°<code>x-queue-leader-locator</code>æŒ‡å®šä¸»èŠ‚ç‚¹çš„é€‰æ‹©ç­–ç•¥ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqadmin queues <span class="built_in">declare</span> --vhost <span class="string">&quot;/vtest&quot;</span> --name <span class="string">&quot;target.quorum.queue.name&quot;</span> --<span class="built_in">type</span> <span class="string">&quot;quorum&quot;</span> --durable <span class="literal">true</span> --arguments <span class="string">&#x27;&#123;&quot;x-queue-leader-locator&quot;:&quot;balanced&quot;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># x-queue-leader-locator æœ‰ä¸¤ç§é€‰æ‹©ç­–ç•¥</span></span><br><span class="line"><span class="comment">## client-localï¼šé€‰æ‹©å£°æ˜é˜Ÿåˆ—çš„å®¢æˆ·ç«¯æ‰€è¿æ¥çš„èŠ‚ç‚¹ã€‚è¿™æ˜¯é»˜è®¤å€¼ã€‚</span></span><br><span class="line"><span class="comment">## balancedï¼šå¦‚æœé˜Ÿåˆ—æ€»æ•°å°‘äº 1000 ä¸ªï¼ˆç»å…¸é˜Ÿåˆ—ã€ä»²è£é˜Ÿåˆ—å’Œæµï¼‰ï¼Œ é€‰æ‹©æ‰˜ç®¡æœ€å°æ•°é‡çš„ä»²è£é˜Ÿåˆ—é¢†å¯¼è€…çš„èŠ‚ç‚¹ã€‚ å¦‚æœé˜Ÿåˆ—æ€»ä½“è¶…è¿‡ 1000 ä¸ªï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ° <code>Quorum é˜Ÿåˆ—</code> çš„ä¸»èŠ‚ç‚¹å’Œæˆå‘˜èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæˆå‘˜èŠ‚ç‚¹æœ‰ä¸‰ä¸ªï¼Œé™¤äº†ä¸»èŠ‚ç‚¹å¤–ï¼Œå…¶ä½™èŠ‚ç‚¹ç”±é›†ç¾¤è‡ªåŠ¨é€‰æ‹©ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/qBfNNh.png" alt=""></p></li><li class="lvl-2"><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Quorum é˜Ÿåˆ—</code> çš„å¤åˆ¶æ•°æ˜¯ <code>3</code>ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æ”¹å˜å¤åˆ¶æ•°ï¼Œå¯ä»¥åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶æŒ‡å®šå‚æ•° <code>x-quorum-initial-group-size</code>ï¼Œå…¶å€¼ä¸º <code>å¤§äº 0 çš„æ•´æ•°</code>ï¼Œè‹¥è®¾ç½®å€¼å¤§äºå®é™…æˆå‘˜èŠ‚ç‚¹æ•°ï¼Œåˆ™ä»¥å®é™…æˆå‘˜èŠ‚ç‚¹æ•°ä¸ºå‡†ã€‚<code>x-quorum-initial-group-size</code> è®¾ç½®ä¸º <code>1</code> æ—¶ä¾¿ä¸è¿›è¡Œå¤åˆ¶äº†ã€‚</p></li><li class="lvl-2"><p>å¦‚æœé›†ç¾¤ä¸­å¢åŠ äº†æ–°çš„èŠ‚ç‚¹ï¼Œå¸Œæœ›é˜Ÿåˆ—ä¹Ÿè¢«å¤åˆ¶åˆ°æ–°çš„èŠ‚ç‚¹ä¸­ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œå°†æ–°çš„èŠ‚ç‚¹åŠ å…¥æˆå‘˜èŠ‚ç‚¹ä¸­:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmq-queues add_member [-p &lt;vhost&gt;] &lt;queue-name&gt; &lt;node&gt;</span></span><br><span class="line">rabbitmq-queues add_member -p /vtest q_4 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœå¸Œæœ›å°†èŠ‚ç‚¹ä»æˆå‘˜èŠ‚ç‚¹ä¸­ç§»é™¤ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmq-queues delete_member [-p &lt;vhost&gt;] &lt;queue-name&gt; &lt;node&gt;</span></span><br><span class="line">rabbitmq-queues delete_member -p /vtest q_4 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦å¤–ï¼Œå½“é€šè¿‡ <code>forget_cluster_node</code> å‘½ä»¤ä»é›†ç¾¤ä¸­æ°¸ä¹…åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œä¼šè‡ªåŠ¨å°†é˜Ÿåˆ—å…³è”çš„èŠ‚ç‚¹ä»æˆå‘˜èŠ‚ç‚¹ä¸­ç§»é™¤ã€‚</p></li><li class="lvl-2"><p>åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å› ä¸ºè¦åˆ é™¤ rabbitmq04 èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä»¥ä¸‹å‘½ä»¤ä¸èƒ½åœ¨ rabbitmq04 èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># åˆ é™¤å‰éœ€è¦å…ˆå…³é—­åº”ç”¨</span></span><br><span class="line">rabbitmqctl -n rabbit@rabbitmq04 stop_app</span><br><span class="line"><span class="comment"># åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"># rabbitmqctl forget_cluster_node &lt;node&gt;</span></span><br><span class="line">rabbitmqctl forget_cluster_node rabbit@rabbitmq04</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ–°å¢èŠ‚ç‚¹åï¼Œä¸€ä¸ªä¸ªçš„å¯¹åŸæœ‰çš„é˜Ÿåˆ—è¿›è¡Œå¤åˆ¶æ‰©å±•éå¸¸éº»çƒ¦ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¿«é€Ÿå¯¹ç¬¦åˆæ¡ä»¶çš„é˜Ÿåˆ—è¿›è¡Œå¤åˆ¶æ‰©å±•:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmq-queues grow &lt;node&gt; &lt;all | even&gt; [--vhost-pattern &lt;pattern&gt;] [--queue-pattern &lt;pattern&gt;]</span></span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># &lt;node&gt;: è¿™ä¸ªå‚æ•°æŒ‡å®šäº† RabbitMQ èŠ‚ç‚¹çš„åç§°ï¼Œé€šå¸¸æ˜¯ rabbit@&lt;hostname&gt;ã€‚å®ƒè¡¨ç¤ºåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¢é•¿æ“ä½œã€‚</span></span><br><span class="line"><span class="comment"># &lt;all | even&gt;: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦æ‰©å±•çš„é˜Ÿåˆ—ç±»å‹ã€‚all è¡¨ç¤ºæ‰©å±•æ‰€æœ‰é˜Ÿåˆ—ï¼Œeven è¡¨ç¤ºæ‰©å±•å¶æ•°ç¼–å·çš„é˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="comment"># --vhost-pattern &lt;pattern&gt; ï¼ˆå¯é€‰ï¼‰: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦åŒ¹é…çš„è™šæ‹Ÿä¸»æœºåç§°ã€‚</span></span><br><span class="line"><span class="comment"># --queue-pattern &lt;pattern&gt; ï¼ˆå¯é€‰ï¼‰: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦åŒ¹é…çš„é˜Ÿåˆ—åç§°ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># æ‰©å±•æ‰€æœ‰è™šæ‹Ÿä¸»æœºä¸‹çš„æ‰€æœ‰é˜Ÿåˆ—çš„å‰¯æœ¬ï¼š</span></span><br><span class="line">rabbitmq-queues grow rabbit@rabbitmq04 all</span><br><span class="line"><span class="comment"># æ‰©å±•æ‰€æœ‰è™šæ‹Ÿä¸»æœºä¸‹çš„å¶æ•°ç¼–å·çš„é˜Ÿåˆ—çš„å‰¯æœ¬ï¼š</span></span><br><span class="line">rabbitmq-queues grow rabbit@rabbitmq04 even</span><br><span class="line"><span class="comment"># æ‰©å±•ç‰¹å®šè™šæ‹Ÿä¸»æœºå’Œé˜Ÿåˆ—åç§°çš„é˜Ÿåˆ—</span></span><br><span class="line">rabbitmq-queues grow rabbit@rabbitmq04 all --vhost-pattern /vtest --queue-pattern <span class="string">&quot;^q_&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Stream-é˜Ÿåˆ—">Stream é˜Ÿåˆ—</h3><ul class="lvl-0"><li class="lvl-2"><p>Stream é˜Ÿåˆ— ä¸ Quorum é˜Ÿåˆ— ç±»ä¼¼ï¼Œé€šè¿‡å“ªä¸ªèŠ‚ç‚¹åˆ›å»ºé˜Ÿåˆ—ï¼Œå“ªä¸ªèŠ‚ç‚¹å°±æ˜¯ Leaderï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡å‚æ•° <code>x-queue-leader-locator</code> æŒ‡å®šä¸»èŠ‚ç‚¹çš„é€‰æ‹©ç­–ç•¥ã€‚</p></li><li class="lvl-2"><p>åˆ›å»º Stream é˜Ÿåˆ—æ—¶ï¼Œé»˜è®¤å¤åˆ¶æ•°å°±æ˜¯å½“å‰é›†ç¾¤çš„èŠ‚ç‚¹æ•°ï¼ˆQuorum é˜Ÿåˆ— é»˜è®¤æ˜¯ 3ï¼‰ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šå‚æ•° <code>x-initial-cluster-size</code> è¿›è¡Œåˆå§‹è®¾ç½®ã€‚</p></li><li class="lvl-2"><p>æ·»åŠ æ–°çš„èŠ‚ç‚¹æ—¶ï¼Œä¸ Quorum é˜Ÿåˆ— ç±»ä¼¼ï¼ŒStream é˜Ÿåˆ— ä¹Ÿä¸ä¼šè‡ªåŠ¨è¿›è¡Œå¤åˆ¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ‰‹åŠ¨å¤åˆ¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmq-streams add_replica [-p &lt;vhost&gt;] &lt;stream-name&gt; &lt;node&gt;</span></span><br><span class="line">rabbitmq-streams add_replica -p /vtest sq_2 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤æˆå‘˜èŠ‚ç‚¹æ—¶ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmq-streams delete_replica [-p &lt;vhost&gt;] &lt;stream-name&gt; &lt;node&gt;</span></span><br><span class="line">rabbitmq-streams delete_replica -p /vtest sq_2 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹èŠ‚ç‚¹å¤åˆ¶çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmq-streams stream_status [-p &lt;vhost&gt;] &lt;stream-name&gt;</span></span><br><span class="line">rabbitmq-streams stream_status -p /vtest sq_2</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å½“æµå‡ºç°å¼‚å¸¸çŠ¶æ€ï¼ˆå¦‚å‰¯æœ¬åˆ†å¸ƒå¼‚å¸¸ã€é¢†å¯¼èŠ‚ç‚¹æŒ‚æ‰ï¼‰æ—¶ï¼Œä¸ºäº†æ¢å¤å¯ç”¨æ€§ï¼Œå¯ä»¥é‡å¯æµ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmq-streams restart_stream [-p &lt;vhost&gt;] &lt;stream-name&gt;</span></span><br><span class="line">rabbitmq-streams restart_stream -p /vtest sq_2</span><br><span class="line"><span class="comment">## é‡å¯æ“ä½œ</span></span><br><span class="line"><span class="comment"># 1.åœæ­¢æµçš„å½“å‰å‰¯æœ¬/åˆ†åŒºã€‚</span></span><br><span class="line"><span class="comment"># 2.é‡æ–°åˆå§‹åŒ–æµçš„å­˜å‚¨å’Œå…ƒæ•°æ®ã€‚</span></span><br><span class="line"><span class="comment"># 3.è®©æµåœ¨é›†ç¾¤ä¸­æ¢å¤ä¸ºå¯ç”¨çŠ¶æ€ã€‚</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Cluster çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.rabbitmq.com&quot;&gt;Zookeeperå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo&quot;&gt;Java Client ç¤ºä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rabbitmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rabbitmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rabbitmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rabbitmq" scheme="https://blog.hanqunfeng.com/tags/rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ ä¹‹ Message</title>
    <link href="https://blog.hanqunfeng.com/2025/09/21/rabbitmq-message/"/>
    <id>https://blog.hanqunfeng.com/2025/09/21/rabbitmq-message/</id>
    <published>2025-09-21T14:30:05.000Z</published>
    <updated>2025-09-22T13:15:32.412Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Message çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p></li><li class="lvl-2"><p><a href="https://www.rabbitmq.com">Zookeeperå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p></li><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo">Java Client ç¤ºä¾‹</a></p></li></ul><span id="more"></span><h2 id="Message-æ¶ˆæ¯-æ˜¯ä»€ä¹ˆï¼Ÿ">Message(æ¶ˆæ¯) æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ RabbitMQ ä¸­ï¼ŒMessageï¼ˆæ¶ˆæ¯ï¼‰æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®å•å…ƒã€‚æ¶ˆæ¯åŒ…å«æ¶ˆæ¯å†…å®¹ã€æ¶ˆæ¯å±æ€§ç­‰ä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>Message ç»„æˆï¼š</p><ul class="lvl-2"><li class="lvl-4"><ol><li class="lvl-7">æ¶ˆæ¯å†…å®¹ï¼šæ¶ˆæ¯çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä»»æ„æ•°æ®ã€‚</li></ol></li><li class="lvl-4"><ol start="2"><li class="lvl-7">æ¶ˆæ¯å±æ€§ï¼šæ¶ˆæ¯çš„å±æ€§ï¼Œå¦‚æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ã€æ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€æ¶ˆæ¯çš„æ ‡ç­¾ç­‰ã€‚</li></ol></li></ul></li></ul><h2 id="Web-æ§åˆ¶å°-ä¸­-Message-çš„ä½¿ç”¨">Web æ§åˆ¶å° ä¸­ Message çš„ä½¿ç”¨</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ Exchange å’Œ Queue çš„ç®¡ç†ç•Œé¢ä¸­ï¼Œéƒ½å¯ä»¥åœ¨å…¶è¯¦æƒ…é¡µé¢æµ‹è¯• Message çš„ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p>å…³äºå¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨ Messageï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­è¯¦ç»†ä»‹ç»ã€‚</p></li></ul><h3 id="Publish-message">Publish message</h3><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/dHsDyt.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>Payloadï¼šæ¶ˆæ¯çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä»»æ„æ•°æ®ã€‚</p></li><li class="lvl-2"><p>Payload encodingï¼šæ¶ˆæ¯å†…å®¹çš„ç¼–ç æ–¹å¼ï¼Œ<code>String</code> æˆ–è€… <code>Base64</code>ï¼Œé»˜è®¤ä¸º <code>String</code>ã€‚</p></li><li class="lvl-2"><p>Delivery modeï¼šæ¶ˆæ¯çš„æŒä¹…åŒ–æ¨¡å¼ï¼Œ1-Non-persistent è¡¨ç¤ºéæŒä¹…åŒ–ï¼Œ2-Persistent è¡¨ç¤ºæŒä¹…åŒ–ã€‚</p></li><li class="lvl-2"><p>Headersï¼šæ¶ˆæ¯çš„å¤´ä¿¡æ¯ï¼Œç”¨äºä¸ <code>Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰</code>ä¸­çš„é…ç½®è¿›è¡ŒåŒ¹é…ã€‚</p></li><li class="lvl-2"><p>Propertiesï¼šæ¶ˆæ¯çš„å±æ€§ï¼Œå¦‚æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ã€æ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€æ¶ˆæ¯çš„æ ‡ç­¾ç­‰ã€‚</p></li></ul><table><thead><tr><th>å±æ€§å</th><th>ä¸­æ–‡å«ä¹‰</th><th>æ•°æ®ç±»å‹</th><th>é»˜è®¤å€¼</th><th>å…¸å‹ç”¨é€”</th></tr></thead><tbody><tr><td>content_type</td><td>å†…å®¹ç±»å‹</td><td>String</td><td>null</td><td>æŒ‡å®šæ¶ˆæ¯çš„ MIME ç±»å‹ï¼Œå¦‚ <code>&quot;text/plain&quot;</code>ã€<code>&quot;application/json&quot;</code></td></tr><tr><td>content_encoding</td><td>å†…å®¹ç¼–ç </td><td>String</td><td>null</td><td>æŒ‡å®šæ¶ˆæ¯å†…å®¹çš„ç¼–ç æ–¹å¼ï¼Œå¦‚ <code>&quot;gzip&quot;</code></td></tr><tr><td>priority</td><td>æ¶ˆæ¯ä¼˜å…ˆçº§</td><td>Integer (0-255)</td><td>0</td><td>ç»“åˆ <code>x-max-priority</code> æ§åˆ¶æ¶ˆæ¯å¤„ç†é¡ºåºï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜</td></tr><tr><td>correlation_id</td><td>å…³è” ID</td><td>String</td><td>null</td><td>RPC æ¨¡å¼ä¸­å…³è”è¯·æ±‚ä¸å“åº”</td></tr><tr><td>reply_to</td><td>å›å¤é˜Ÿåˆ—å</td><td>String</td><td>null</td><td>RPC æ¨¡å¼ä¸­æŒ‡å®šå“åº”æ¶ˆæ¯çš„è¿”å›é˜Ÿåˆ—</td></tr><tr><td>expiration</td><td>æ¶ˆæ¯è¿‡æœŸæ—¶é—´</td><td>String (ms)</td><td>null</td><td>æ¶ˆæ¯çš„ TTLï¼Œæ¯«ç§’ä¸ºå•ä½ï¼Œè¿‡æœŸåå°†è¢«ä¸¢å¼ƒæˆ–è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</td></tr><tr><td>message_id</td><td>æ¶ˆæ¯ ID</td><td>String</td><td>null</td><td>å”¯ä¸€æ ‡è¯†ä¸€æ¡æ¶ˆæ¯ï¼Œé€šå¸¸ç”±ç”Ÿäº§è€…æŒ‡å®š</td></tr><tr><td>timestamp</td><td>æ—¶é—´æˆ³</td><td>Date / Long</td><td>null</td><td>æ¶ˆæ¯å‘é€æ—¶é—´ï¼Œé€šå¸¸æ˜¯ Unix æ—¶é—´æˆ³</td></tr><tr><td>type</td><td>æ¶ˆæ¯ç±»å‹</td><td>String</td><td>null</td><td>æè¿°æ¶ˆæ¯ç±»å‹ï¼Œå¦‚ <code>&quot;order&quot;</code> æˆ– <code>&quot;event&quot;</code></td></tr><tr><td>user_id</td><td>ç”¨æˆ· ID</td><td>String</td><td>null</td><td>æ ‡è¯†å‘é€æ¶ˆæ¯çš„ç”¨æˆ·ï¼Œé€šå¸¸ç”¨äºå®‰å…¨æˆ–å®¡è®¡</td></tr><tr><td>app_id</td><td>åº”ç”¨ ID</td><td>String</td><td>null</td><td>æ ‡è¯†å‘é€æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº</td></tr><tr><td>cluster_id</td><td>é›†ç¾¤ ID</td><td>String</td><td>null</td><td>RabbitMQ é›†ç¾¤ IDï¼Œå®é™…ä¸­å¾ˆå°‘ä½¿ç”¨</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ä¸é˜Ÿåˆ—é‡å çš„å±æ€§ï¼š</p></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>é˜Ÿåˆ—å‚æ•°ï¼ˆQueue Argumentsï¼‰</th><th>æ¶ˆæ¯å±æ€§ï¼ˆMessage Propertiesï¼‰</th><th>è°çš„ä¼˜å…ˆçº§æ›´é«˜ / ç”Ÿæ•ˆæ–¹å¼</th></tr></thead><tbody><tr><td><strong>priority / x-max-priority</strong></td><td><code>x-max-priority</code>: å®šä¹‰é˜Ÿåˆ—æ”¯æŒçš„<strong>æœ€å¤§ä¼˜å…ˆçº§å€¼</strong></td><td><code>priority</code>: ä¸ºå•ä¸ªæ¶ˆæ¯è®¾ç½®ä¼˜å…ˆçº§</td><td>é˜Ÿåˆ—å…ˆå®šä¹‰èŒƒå›´ï¼Œæ¶ˆæ¯åªèƒ½åœ¨è¿™ä¸ªèŒƒå›´å†…å–å€¼ <br> è‹¥ <code>priority &gt; x-max-priority</code>ï¼Œåˆ™ä»¥<code>x-max-priority</code>ä¸ºå‡†</td></tr><tr><td><strong>expiration / x-message-ttl</strong></td><td><code>x-message-ttl</code>: é˜Ÿåˆ—çº§åˆ«çš„æ¶ˆæ¯<strong>ç»Ÿä¸€ TTL</strong></td><td><code>expiration</code>: ä¸ºå•ä¸ªæ¶ˆæ¯è®¾ç½® TTLï¼ˆæ¯«ç§’ï¼‰</td><td>å¦‚æœåŒæ—¶è®¾ç½®ï¼Œ<strong>è¾ƒçŸ­çš„ TTL</strong> ä¼šç”Ÿæ•ˆ</td></tr></tbody></table><h3 id="Get-message">Get message</h3><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/Ar9qob.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>Ack Modeï¼šæ¶ˆæ¯ç¡®è®¤æ¨¡å¼</p><ul class="lvl-2"><li class="lvl-4">Nack message requeue true: ç¡®è®¤å¤±è´¥ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿï¼Œè¿™æ˜¯é»˜è®¤é€‰æ‹©ï¼Œä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•åæ¶ˆæ¯ä¾æ—§å­˜åœ¨ã€‚</li><li class="lvl-4">Automatic ack: è‡ªåŠ¨ç¡®è®¤</li><li class="lvl-4">Reject requeue true: æ‹’ç»ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ</li><li class="lvl-4">Reject requeue false: æ‹’ç»ï¼Œæ¶ˆæ¯ä¸é‡æ–°å…¥é˜Ÿ</li></ul></li><li class="lvl-2"><p>Encodingï¼šæ¶ˆæ¯å†…å®¹ç¼–ç æ–¹å¼</p><ul class="lvl-2"><li class="lvl-4"><code>Auto String / Base64</code>ï¼Œé»˜è®¤ã€‚å¦‚æœæ¶ˆæ¯è½½è·å¯ä»¥è§£é‡Šä¸ºUTF-8ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå°±æ˜¯ <code>String</code>ï¼Œå¦åˆ™å°±æ˜¯ <code>Base64</code>ã€‚</li><li class="lvl-4"><code>Base64</code>ã€‚</li></ul></li><li class="lvl-2"><p>Messages: ä¸€æ¬¡è·å–æ¶ˆæ¯æ•°é‡ï¼Œé»˜è®¤ä¸º 1ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Message çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.rabbitmq.com&quot;&gt;Zookeeperå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo&quot;&gt;Java Client ç¤ºä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rabbitmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rabbitmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rabbitmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rabbitmq" scheme="https://blog.hanqunfeng.com/tags/rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ ä¹‹ Exchange</title>
    <link href="https://blog.hanqunfeng.com/2025/09/21/rabbitmq-exchange/"/>
    <id>https://blog.hanqunfeng.com/2025/09/21/rabbitmq-exchange/</id>
    <published>2025-09-21T13:30:05.000Z</published>
    <updated>2025-09-22T13:17:07.914Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Exchange çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p></li><li class="lvl-2"><p><a href="https://www.rabbitmq.com">Zookeeperå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p></li><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo">Java Client ç¤ºä¾‹</a></p></li></ul><span id="more"></span><h2 id="Exchange-äº¤æ¢æœº-æ˜¯ä»€ä¹ˆï¼Ÿ">Exchange(äº¤æ¢æœº) æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ RabbitMQ ä¸­ï¼Œ<a href="https://www.rabbitmq.com/docs/exchanges">Exchangeï¼ˆäº¤æ¢æœºï¼‰</a> æ˜¯æ¶ˆæ¯è·¯ç”±çš„æ ¸å¿ƒç»„ä»¶ã€‚å®ƒè´Ÿè´£æ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®é¢„å®šä¹‰çš„è·¯ç”±è§„åˆ™å°†æ¶ˆæ¯è½¬å‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚</p></li><li class="lvl-2"><p>Exchange ç±»å‹å†³å®šäº†æ¶ˆæ¯çš„è·¯ç”±æ–¹å¼ã€‚RabbitMQ æ”¯æŒçš„ Exchange ç±»å‹</p></li></ul><table><thead><tr><th>Exchange ç±»å‹</th><th>å£°æ˜ç±»å‹</th><th>è·¯ç”±è§„åˆ™æè¿°</th><th>å…¸å‹ç”¨é€”</th></tr></thead><tbody><tr><td><strong>Direct</strong></td><td><code>direct</code></td><td>æ¶ˆæ¯æ ¹æ® <strong>è·¯ç”±é”®ï¼ˆrouting keyï¼‰</strong> ç²¾ç¡®åŒ¹é…ç»‘å®šé”®ï¼ˆbinding keyï¼‰è¿›è¡Œè·¯ç”±ã€‚</td><td>ç²¾ç¡®æ¶ˆæ¯ä¼ é€’ï¼Œå¦‚æ—¥å¿—åˆ†ç±»ã€ä»»åŠ¡åˆ†å‘ç­‰ã€‚</td></tr><tr><td><strong>Fanout</strong></td><td><code>fanout</code></td><td>æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼Œ<strong>å¿½ç•¥è·¯ç”±é”®</strong>ã€‚</td><td>å¹¿æ’­æ¶ˆæ¯ï¼Œå¦‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€å®æ—¶é€šçŸ¥ç­‰ã€‚</td></tr><tr><td><strong>Topic</strong></td><td><code>topic</code></td><td>æ¶ˆæ¯æ ¹æ®è·¯ç”±é”®ä¸ç»‘å®šé”®æ¨¡å¼çš„åŒ¹é…è¿›è¡Œè·¯ç”±ï¼Œæ”¯æŒé€šé…ç¬¦ <code>*</code>ï¼ˆåŒ¹é…ä¸€ä¸ªè¯ï¼‰å’Œ <code>#</code>ï¼ˆåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯ï¼‰ã€‚</td><td>æ¨¡å—åŒ–è·¯ç”±ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚</td></tr><tr><td><strong>Headers</strong></td><td><code>headers</code></td><td>æ¶ˆæ¯æ ¹æ® <strong>æ¶ˆæ¯å¤´éƒ¨ï¼ˆheadersï¼‰</strong> ä¸ç»‘å®šæ—¶æŒ‡å®šçš„å¤´éƒ¨åŒ¹é…è¿›è¡Œè·¯ç”±ï¼Œæ”¯æŒ <code>x-match</code> å‚æ•°ï¼ˆ<code>any</code> æˆ– <code>all</code>ï¼‰ã€‚</td><td>å¤šæ¡ä»¶è·¯ç”±ï¼Œå¦‚å¤æ‚è¿‡æ»¤ã€åŠ¨æ€è·¯ç”±ç­‰ã€‚</td></tr><tr><td><strong>Local Random Exchange</strong></td><td><code>x-local-random</code></td><td>æ¶ˆæ¯å§‹ç»ˆè¢«è·¯ç”±åˆ°æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å¤šä¸ªæœ¬åœ°é˜Ÿåˆ—ç»‘å®šï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡ŒæŠ•é€’ã€‚</td><td>è¯·æ±‚-å“åº”ï¼ˆRPCï¼‰æ¨¡å¼ï¼Œä½å»¶è¿Ÿé€šä¿¡</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>RabbitMQ é»˜è®¤ä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹çš„äº¤æ¢æœº<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/SKlqQK.png" alt=""></p></li><li class="lvl-2"><p>æ¯æ–°åˆ›å»ºä¸€ä¸ª Vhostï¼ŒRabbitMQ å°±ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹äº¤æ¢æœºï¼Œæ¯”å¦‚ <code>/vtest</code><br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/oGJ1oj.png" alt=""></p></li><li class="lvl-2"><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæ–°çš„äº¤æ¢æœº<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/QjnZin.png" alt=""></p></li><li class="lvl-2"><p>é…ç½®è¯´æ˜</p><ul class="lvl-2"><li class="lvl-4">Durability: æŒ‡å®š Exchange æ˜¯å¦æŒä¹…åŒ–ã€‚<ul class="lvl-4"><li class="lvl-6">Durable: æŒä¹…åŒ–çš„ Exchange ä¼šè¢«ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œé‡å¯ RabbitMQ æ—¶ä¼šè‡ªåŠ¨æ¢å¤ã€‚</li><li class="lvl-6">Transient: éæŒä¹…åŒ–çš„ Exchange ä¼šè¢«ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé‡å¯ RabbitMQ æ—¶ä¼šä¸¢å¤±ã€‚</li></ul></li><li class="lvl-4">Auto-delete: æŒ‡å®š Exchange æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚<ul class="lvl-4"><li class="lvl-6">yes: å¦‚æœæ²¡æœ‰é˜Ÿåˆ—æˆ–äº¤æ¢æœºç»‘å®šè¯¥ Exchangeï¼Œåˆ™è¯¥ Exchange ä¼šè‡ªåŠ¨åˆ é™¤ã€‚</li><li class="lvl-6">no: è¯¥ Exchange ä¸ä¼šè‡ªåŠ¨åˆ é™¤ã€‚</li></ul></li><li class="lvl-4">Internal: ç”¨äºæ§åˆ¶äº¤æ¢æœºæ˜¯å¦å¯ä»¥è¢«ç”Ÿäº§è€…ç›´æ¥å‘å¸ƒæ¶ˆæ¯<ul class="lvl-4"><li class="lvl-6">yes: ä¸èƒ½è¢«ç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯ï¼Œè¯¥äº¤æ¢æœºåªèƒ½ç”¨äº å°†æ¶ˆæ¯ä»å…¶ä»–äº¤æ¢æœºè½¬å‘åˆ°è¯¥äº¤æ¢æœºã€‚</li><li class="lvl-6">no: å¯ä»¥è¢«ç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯ã€‚</li></ul></li><li class="lvl-4">Arguments: ç”¨äºè®¾ç½® Exchange çš„å…¶ä»–å‚æ•°ï¼Œç›®å‰ä»…æ”¯æŒä¸€ä¸ªå‚æ•°<ul class="lvl-4"><li class="lvl-6">Alternate exchange(alternate-exchange): æŒ‡å®šè¯¥ Exchange çš„å¤‡ç”¨äº¤æ¢æœºï¼Œå¦‚æœæ— æ³•ä»¥å…¶ä»–æ–¹å¼å°†å‘å¾€æ­¤äº¤æ¢æœºçš„æ¶ˆæ¯è·¯ç”±å‡ºå»ï¼Œåˆ™å°†å®ƒä»¬å‘é€è‡³æ­¤å¤„æŒ‡å®šçš„å¤‡ç”¨äº¤æ¢æœºã€‚</li></ul></li></ul></li></ul><h2 id="Direct-Exchangeï¼ˆç›´æ¥äº¤æ¢æœºï¼‰">Direct Exchangeï¼ˆç›´æ¥äº¤æ¢æœºï¼‰</h2><ul class="lvl-0"><li class="lvl-2"><p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®å®Œå…¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šé”®ä¸º errorï¼Œåˆ™åªæœ‰è·¯ç”±é”®ä¸º error çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p></li><li class="lvl-2"><p>é€‚ç”¨åœºæ™¯ï¼šéœ€è¦ç²¾ç¡®åŒ¹é…çš„åœºæ™¯ï¼Œå¦‚æ—¥å¿—åˆ†ç±»ã€ä»»åŠ¡åˆ†å‘ç­‰ã€‚</p></li></ul><h2 id="Fanout-Exchangeï¼ˆæ‰‡å‡ºäº¤æ¢æœºï¼‰">Fanout Exchangeï¼ˆæ‰‡å‡ºäº¤æ¢æœºï¼‰</h2><ul class="lvl-0"><li class="lvl-2"><p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå¿½ç•¥è·¯ç”±é”®ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæ— è®ºæ¶ˆæ¯çš„è·¯ç”±é”®æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šè¢«è·¯ç”±åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ã€‚</p></li><li class="lvl-2"><p>é€‚ç”¨åœºæ™¯ï¼šå¹¿æ’­æ¶ˆæ¯ï¼Œå¦‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€å®æ—¶é€šçŸ¥ç­‰ã€‚</p></li></ul><h2 id="Topic-Exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰">Topic Exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰</h2><ul class="lvl-0"><li class="lvl-2"><p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®æ¨¡å¼åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚æ”¯æŒé€šé…ç¬¦ *ï¼ˆåŒ¹é…ä¸€ä¸ªè¯ï¼‰å’Œ #ï¼ˆåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯ï¼‰ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šé”®ä¸º <em>.orange.</em>ï¼Œåˆ™è·¯ç”±é”®ä¸º quick.orange.rabbit çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p></li><li class="lvl-2"><p>é€‚ç”¨åœºæ™¯ï¼šæ¨¡å—åŒ–è·¯ç”±ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚</p></li></ul><h2 id="Headers-Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰">Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰</h2><ul class="lvl-0"><li class="lvl-2"><p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„å¤´éƒ¨ä¸é˜Ÿåˆ—çš„ç»‘å®šå¤´éƒ¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚æ”¯æŒ x-match å‚æ•°ï¼ˆany æˆ– allï¼‰ã€‚å³ä½¿é…ç½®äº†è·¯ç”±é”®ä¹Ÿä¼šå¿½ç•¥ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šå¤´éƒ¨ä¸º { â€œx-matchâ€: â€œallâ€, â€œformatâ€: â€œpdfâ€, â€œpriorityâ€: â€œhighâ€ }ï¼Œåˆ™åªæœ‰åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p></li><li class="lvl-2"><p>é€‚ç”¨åœºæ™¯ï¼šå¤šæ¡ä»¶è·¯ç”±ï¼Œå¦‚å¤æ‚è¿‡æ»¤ã€åŠ¨æ€è·¯ç”±ç­‰ã€‚</p></li></ul><h2 id="Local-Random-Exchangeï¼ˆæœ¬åœ°éšæœºäº¤æ¢æœºï¼‰">Local Random Exchangeï¼ˆæœ¬åœ°éšæœºäº¤æ¢æœºï¼‰</h2><ul class="lvl-0"><li class="lvl-2"><p>Local Random Exchange æ˜¯ RabbitMQ 4.0 å¼•å…¥çš„äº¤æ¢æœºç±»å‹ï¼Œæ—¨åœ¨ä¼˜åŒ–<code>è¯·æ±‚-å“åº”</code>æ¨¡å¼ä¸‹çš„æ¶ˆæ¯è·¯ç”±ï¼Œç‰¹åˆ«é€‚ç”¨äºä½å»¶è¿Ÿå’Œé«˜ååé‡çš„åœºæ™¯ã€‚é€šè¿‡ç»“åˆç‹¬å é˜Ÿåˆ—ä½¿ç”¨ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯å¿«é€Ÿä¼ é€’åˆ°æœ¬åœ°æ¶ˆè´¹è€…ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚</p></li><li class="lvl-2"><p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯å§‹ç»ˆè¢«è·¯ç”±åˆ°æœ¬åœ°é˜Ÿåˆ—ï¼ˆä½äºåŒä¸€èŠ‚ç‚¹ä¸Šï¼‰ï¼Œå¦‚æœæœ‰å¤šä¸ªæœ¬åœ°é˜Ÿåˆ—ç»‘å®šï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡ŒæŠ•é€’ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šå‡è®¾èŠ‚ç‚¹ A ä¸Šæœ‰ä¸¤ä¸ªç»‘å®šäº† x-local-random äº¤æ¢æœºçš„é˜Ÿåˆ— Q1 å’Œ Q2ï¼Œå‘å¸ƒçš„æ¶ˆæ¯ä¼šéšæœºè·¯ç”±åˆ° Q1 æˆ– Q2ï¼Œä½†ä¸ä¼šè·¯ç”±åˆ°å…¶ä»–èŠ‚ç‚¹çš„é˜Ÿåˆ—ã€‚</p></li><li class="lvl-2"><p>é€‚ç”¨åœºæ™¯ï¼šè¯·æ±‚-å“åº”ï¼ˆRPCï¼‰æ¨¡å¼ä¸‹çš„ä½å»¶è¿Ÿé€šä¿¡ï¼Œé€‚åˆå¾®æœåŠ¡æ¶æ„ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰æ¶ˆè´¹è€…çš„åœºæ™¯ã€‚</p></li><li class="lvl-2"><p>åœ¨ä½¿ç”¨ Local Random Exchange æ—¶ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul class="lvl-2"><li class="lvl-4">ç‹¬å é˜Ÿåˆ—ï¼šæ¶ˆè´¹è€…åº”å£°æ˜ç‹¬å é˜Ÿåˆ—ï¼Œä»¥ç¡®ä¿é˜Ÿåˆ—ä»…ç»‘å®šåˆ°å½“å‰èŠ‚ç‚¹ã€‚</li><li class="lvl-4">æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘ä¸€ä¸ªæ¶ˆè´¹è€…ï¼šæ¯ä¸ª RabbitMQ èŠ‚ç‚¹ä¸Šåº”è‡³å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¦åˆ™åœ¨è¯¥èŠ‚ç‚¹ä¸Šå‘å¸ƒçš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒã€‚</li><li class="lvl-4">äº¤æ¢æœºç±»å‹å£°æ˜ï¼šä½¿ç”¨ <code>x-local-random</code> ç±»å‹å£°æ˜äº¤æ¢æœºã€‚</li></ul></li></ul><h2 id="Exchange-ä¸-Queue-ç»‘å®š-Binding">Exchange ä¸ Queue ç»‘å®š(Binding)</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºå¥½ Exchange ä¹‹åï¼Œéœ€è¦å°† Exchange ä¸ Queue ç»‘å®šï¼Œæ‰èƒ½å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚</p></li><li class="lvl-2"><p>Exchange ä¸ Queue çš„ç»‘å®šå…³ç³»ï¼Œå³ Exchange å‘é€çš„æ¶ˆæ¯ï¼Œä¼šæ ¹æ®è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚</p></li><li class="lvl-2"><p>åœ¨ Exchange é¡µé¢ç‚¹å‡» Exchange çš„åç§°ï¼Œè¿›å…¥ Exchange è¯¦æƒ…é¡µé¢ï¼Œæ­¤å¤„å¯ä»¥è¿›è¡Œ Exchange ä¸ Queue ç»‘å®šé…ç½®<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/taKUjm.png" alt=""></p><blockquote><p>è¿™é‡Œçš„<code>Arguments</code>ç”¨äºè®¾ç½® ç»‘å®š çš„å…¶ä»–å‚æ•°ï¼Œæ¯”å¦‚ <code>Headers Exchange</code> éœ€è¦è®¾ç½® <code>x-match</code> å‚æ•°ç­‰ã€‚</p></blockquote></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Exchange çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.rabbitmq.com&quot;&gt;Zookeeperå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo&quot;&gt;Java Client ç¤ºä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rabbitmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rabbitmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rabbitmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rabbitmq" scheme="https://blog.hanqunfeng.com/tags/rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ ä¹‹ Queue</title>
    <link href="https://blog.hanqunfeng.com/2025/09/20/rabbitmq-queue/"/>
    <id>https://blog.hanqunfeng.com/2025/09/20/rabbitmq-queue/</id>
    <published>2025-09-20T13:30:05.000Z</published>
    <updated>2025-09-28T07:30:09.100Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Queue çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p></li><li class="lvl-2"><p><a href="https://www.rabbitmq.com">Zookeeperå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p></li><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo">Java Client ç¤ºä¾‹</a></p></li></ul><span id="more"></span><h2 id="Queue-é˜Ÿåˆ—-æ˜¯ä»€ä¹ˆï¼Ÿ">Queue(é˜Ÿåˆ—) æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ RabbitMQ ä¸­ï¼Œ<a href="https://www.rabbitmq.com/docs/queues">é˜Ÿåˆ—ï¼ˆQueueï¼‰</a> æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨æ¶ˆæ¯çš„ æ•°æ®ç»“æ„ï¼Œæ¶ˆæ¯ä¼šä¸€ç›´ä¿å­˜åœ¨é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°è¢«åº”ç”¨ç¨‹åºæˆ–æœåŠ¡æ¶ˆè´¹ä¸ºæ­¢ã€‚</p></li><li class="lvl-2"><p>ç”Ÿäº§è€…ï¼ˆPublisherï¼‰ æŠŠæ¶ˆæ¯æ”¾è¿›é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ã€‚é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šæŒ‰ç…§ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„é¡ºåºè¿›è¡Œæ¶ˆè´¹ã€‚</p></li><li class="lvl-2"><p>é˜Ÿåˆ—åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´èµ·åˆ°ç¼“å†²åŒºçš„ä½œç”¨ã€‚ç”Ÿäº§è€…ä¸éœ€è¦çŸ¥é“æ¶ˆè´¹è€…çš„å­˜åœ¨ï¼Œå®ƒä»¬åªéœ€æŠŠæ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ã€‚æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®è‡ªèº«å¤„ç†é€Ÿåº¦ï¼ŒæŒ‰éœ€æ¶ˆè´¹æ¶ˆæ¯ã€‚</p></li><li class="lvl-2"><p>RabbitMQ ç›®å‰ æ”¯æŒä¸‰ç§é˜Ÿåˆ—ç±»å‹ï¼š</p></li></ul><table><thead><tr><th>é˜Ÿåˆ—ç±»å‹</th><th>æè¿°</th><th>ç‰¹ç‚¹</th><th>å…¸å‹ç”¨é€”</th></tr></thead><tbody><tr><td><strong>Classic Queueï¼ˆç»å…¸é˜Ÿåˆ—ï¼‰</strong></td><td>æœ€å¸¸ç”¨çš„é˜Ÿåˆ—ç±»å‹ï¼Œæ¶ˆæ¯æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰é¡ºåºå­˜å‚¨å’Œæ¶ˆè´¹</td><td>æ”¯æŒæŒä¹…åŒ–ã€ä¼˜å…ˆçº§ã€TTLã€æ­»ä¿¡ç­‰</td><td>å¤§å¤šæ•°å¸¸è§„æ¶ˆæ¯åœºæ™¯</td></tr><tr><td><strong>Quorum Queueï¼ˆä»²è£é˜Ÿåˆ—ï¼‰</strong></td><td>åŸºäº Raft åè®®çš„é˜Ÿåˆ—ï¼Œç¡®ä¿é«˜å¯ç”¨å’Œæ•°æ®ä¸€è‡´æ€§</td><td>å†…ç½®å¤åˆ¶ï¼ˆå‰¯æœ¬æ•°é‡å¯é…ç½®ï¼‰ã€é€‚åˆé«˜å¯é æ€§åœºæ™¯ï¼Œä½†ååé‡ç•¥ä½äºç»å…¸é˜Ÿåˆ—</td><td>å…³é”®ä»»åŠ¡æ¶ˆæ¯ã€é«˜å¯é æ€§åœºæ™¯</td></tr><tr><td><strong>Stream Queueï¼ˆæµå¼é˜Ÿåˆ—ï¼‰</strong></td><td>é¢å‘å¤§é‡æ¶ˆæ¯çš„é«˜ååé˜Ÿåˆ—ï¼Œæ”¯æŒæ¶ˆæ¯æŒ‰åç§»é‡è¯»å–</td><td>ç±»ä¼¼ Kafkaï¼Œå¯éšæœºè®¿é—®å†å²æ¶ˆæ¯ã€é¡ºåºè¯»å–ã€å¯æŒä¹…åŒ–å¤§é‡æ¶ˆæ¯</td><td>å¤§æ•°æ®æµã€æ—¥å¿—å¤„ç†ã€äº‹ä»¶æº¯æº</td></tr></tbody></table><h2 id="Classic-Queue-ç»å…¸é˜Ÿåˆ—">Classic Queue(ç»å…¸é˜Ÿåˆ—)</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://www.rabbitmq.com/docs/classic-queues">RabbitMQ ç»å…¸é˜Ÿåˆ—ï¼ˆåŸå§‹é˜Ÿåˆ—ç±»å‹ï¼‰</a>æ˜¯ä¸€ç§é€šç”¨é˜Ÿåˆ—ç±»å‹ã€‚å®é™…ä¸Šå®ƒæ˜¯åœ¨ 3.8.x ç‰ˆæœ¬ä¹‹å‰å”¯ä¸€çš„é˜Ÿåˆ—ç±»å‹ã€‚</p></li><li class="lvl-2"><p>ç»å…¸é˜Ÿåˆ—é€‚ç”¨äºæ•°æ®å®‰å…¨ä¸æ˜¯ä¼˜å…ˆäº‹é¡¹çš„ç”¨ä¾‹ï¼Œå› ä¸ºå­˜å‚¨åœ¨ç»å…¸é˜Ÿåˆ—ä¸­çš„æ•°æ®ä¸ä¼šè¢«å¤åˆ¶ã€‚ ç»å…¸é˜Ÿåˆ—ä½¿ç”¨éå¤åˆ¶çš„ FIFO é˜Ÿåˆ—å®ç°ã€‚</p></li><li class="lvl-2"><p>ç»å…¸é˜Ÿåˆ—ä¸é€‚åˆç§¯ç´¯å¤ªå¤šçš„æ¶ˆæ¯ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­ç§¯ç´¯çš„æ¶ˆæ¯å¤ªå¤šäº†ï¼Œä¼šä¸¥é‡å½±å“å®¢æˆ·ç«¯ç”Ÿäº§æ¶ˆæ¯ä»¥åŠæ¶ˆè´¹æ¶ˆæ¯çš„æ€§èƒ½ã€‚å› æ­¤ï¼Œç»å…¸é˜Ÿåˆ—ä¸»è¦ç”¨åœ¨æ•°æ®é‡æ¯”è¾ƒå°ï¼Œå¹¶ä¸”ç”Ÿäº§æ¶ˆæ¯å’Œæ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦æ¯”è¾ƒç¨³å®šçš„ä¸šåŠ¡åœºæ™¯ã€‚æ¯”å¦‚å†…éƒ¨ç³»ç»Ÿä¹‹é—´çš„æœåŠ¡è°ƒç”¨ã€‚</p></li><li class="lvl-2"><p>RabbitMQ 4.0 åˆ é™¤äº†å¯¹ç»å…¸é˜Ÿåˆ— <code>version1</code> çš„æ”¯æŒï¼ŒåŒæ—¶ä¹Ÿä¸å†æ”¯æŒå°† ç»å…¸é˜Ÿåˆ— çš„æ¶ˆæ¯åœ¨èŠ‚ç‚¹é—´å¤åˆ¶ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/MAdpRV.png" alt=""></p></li><li class="lvl-2"><p>å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†)</p></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>é…ç½®å‚æ•°å</th><th>æ•°æ®ç±»å‹</th><th>ä½œç”¨è¯´æ˜</th><th>å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Auto expire</strong></td><td><code>x-expires</code></td><td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td><td>é˜Ÿåˆ—åœ¨ <strong>æŒ‡å®šæ—¶é—´å†…æ— äººä½¿ç”¨ï¼ˆæ— æ¶ˆè´¹è€…ã€æ— å‘å¸ƒã€æ— è®¿é—®ï¼‰</strong> æ—¶è‡ªåŠ¨åˆ é™¤</td><td>ç±»ä¼¼â€œé˜Ÿåˆ—ç©ºé—²è¿‡æœŸæ—¶é—´â€ï¼ŒèŠ‚çœèµ„æº</td></tr><tr><td><strong>Message TTL</strong></td><td><code>x-message-ttl</code></td><td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td><td>æ¶ˆæ¯çš„ <strong>å­˜æ´»æ—¶é—´</strong>ï¼Œè¶…è¿‡æ—¶é—´åæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—</td><td>ç”¨äºé™åˆ¶æ¶ˆæ¯æ—¶æ•ˆæ€§ï¼Œå¦‚å»¶è¿Ÿæ¶ˆæ¯æˆ–çŸ­æœŸç¼“å­˜</td></tr><tr><td><strong>Overflow behaviour</strong></td><td><code>x-overflow</code></td><td>å­—ç¬¦ä¸²ï¼ˆ<code>drop-head</code> æˆ– <code>reject-publish</code>ï¼‰</td><td>å½“é˜Ÿåˆ—è¾¾åˆ° <strong>æœ€å¤§é•¿åº¦</strong> æˆ– <strong>æœ€å¤§å­—èŠ‚æ•°</strong> æ—¶çš„è¡Œä¸º</td><td>- <code>drop-head</code>ï¼šä¸¢å¼ƒæœ€æ—©çš„æ¶ˆæ¯ <br> - <code>reject-publish</code>ï¼šæ‹’ç»æ–°çš„æ¶ˆæ¯</td></tr><tr><td><strong>Single active consumer</strong></td><td><code>x-single-active-consumer</code></td><td>å¸ƒå°”å€¼ï¼ˆtrue/falseï¼‰</td><td>æ˜¯å¦å¯ç”¨ <strong>å•æ´»æ¶ˆè´¹è€…æ¨¡å¼</strong>ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ—</td><td>ç”¨äºä¸¥æ ¼é¡ºåºæ¶ˆè´¹ï¼Œä¿è¯æŸä¸ªæ¶ˆæ¯ä¸ä¼šè¢«å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶å¤„ç†</td></tr><tr><td><strong>Dead letter exchange (DLX)</strong></td><td><code>x-dead-letter-exchange</code></td><td>å­—ç¬¦ä¸²</td><td>æŒ‡å®šé˜Ÿåˆ—çš„ <strong>æ­»ä¿¡äº¤æ¢æœº</strong>ï¼Œç”¨äºæ¥æ”¶æ— æ³•æ¶ˆè´¹æˆ–è¿‡æœŸçš„æ¶ˆæ¯</td><td>å¸¸ç”¨äºå¤±è´¥é‡è¯•ã€æ¶ˆæ¯è¡¥å¿åœºæ™¯</td></tr><tr><td><strong>Dead letter routing key</strong></td><td><code>x-dead-letter-routing-key</code></td><td>å­—ç¬¦ä¸²</td><td>æ¶ˆæ¯è½¬å‘åˆ° DLX æ—¶çš„ <strong>è·¯ç”±é”®</strong></td><td>å¯ä»¥çµæ´»è½¬å‘åˆ°ä¸åŒé˜Ÿåˆ—</td></tr><tr><td><strong>Max length</strong></td><td><code>x-max-length</code></td><td>æ•´æ•°</td><td>é˜Ÿåˆ—ä¸­ <strong>æœ€å¤§æ¶ˆæ¯æ¡æ•°</strong></td><td>è¶…è¿‡æ—¶æŒ‰ç…§ Overflow behaviour å¤„ç†</td></tr><tr><td><strong>Max length bytes</strong></td><td><code>x-max-length-bytes</code></td><td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td><td>é˜Ÿåˆ—ä¸­ <strong>æ¶ˆæ¯æ€»å­—èŠ‚æ•°ä¸Šé™</strong></td><td>è¶…è¿‡æ—¶æŒ‰ç…§ Overflow behaviour å¤„ç†ï¼Œé€‚åˆå¤§æ¶ˆæ¯åœºæ™¯</td></tr><tr><td><strong>Maximum priority</strong></td><td><code>x-max-priority</code></td><td>æ•´æ•°</td><td>å¯ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—å¯è®¾ç½®çš„ <strong>æœ€å¤§ä¼˜å…ˆçº§å€¼</strong></td><td>æ¶ˆæ¯ä¼˜å…ˆçº§èŒƒå›´æ˜¯ 0 åˆ°è¿™ä¸ªå€¼ï¼Œä¼˜å…ˆçº§é«˜çš„æ¶ˆæ¯å…ˆè¢«æ¶ˆè´¹</td></tr><tr><td><strong>Leader locator</strong></td><td><code>x-queue-leader-locator</code></td><td>å­—ç¬¦ä¸²ï¼ˆ<code>client-local</code>ã€<code>balanced</code>ï¼‰</td><td>è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—ä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™</td><td><code>client-local</code>ï¼ˆé»˜è®¤ï¼‰ï¼šé€‰æ‹©å®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸ºLeader <br> <code>balanced</code>ï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡Leaderåˆ†å¸ƒï¼Œç”¨äº HA é˜Ÿåˆ—ä¼˜åŒ–</td></tr></tbody></table><h2 id="Quorum-Queue-ä»²è£é˜Ÿåˆ—">Quorum Queue(ä»²è£é˜Ÿåˆ—)</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://www.rabbitmq.com/docs/quorum-queues">ä»²è£é˜Ÿåˆ—ï¼ˆQuorum Queueï¼‰</a> æ˜¯ RabbitMQ ä»3.8.0ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„ä¸€ç§ç°ä»£é˜Ÿåˆ—ç±»å‹ï¼Œä¹Ÿæ˜¯ç›®å‰å®˜æ–¹æ¯”è¾ƒæ¨èçš„ä¸€ç§å¯¹åˆ—ç±»å‹ã€‚æœªæ¥æœ‰å¯èƒ½å–ä»£ ç»å…¸é˜Ÿåˆ— æˆä¸ºé»˜è®¤é˜Ÿåˆ—ç±»å‹ã€‚</p></li><li class="lvl-2"><p>å…¶åŸºäº Raft å…±è¯†ç®—æ³• å®ç° æŒä¹…åŒ–ã€å¤åˆ¶å’Œé«˜å¯ç”¨ã€‚å®ƒä¿è¯ æ•°æ®å®‰å…¨æ€§ã€å¯é çš„ä¸»èŠ‚ç‚¹é€‰ä¸¾ï¼Œå³ä½¿åœ¨å‡çº§æˆ–é›†ç¾¤æ³¢åŠ¨æœŸé—´ä¹Ÿèƒ½ä¿æŒé«˜å¯ç”¨æ€§ã€‚</p></li><li class="lvl-2"><p>ä»²è£é˜Ÿåˆ—æ”¯æŒ æ¯’æ¶ˆæ¯å¤„ç†ã€è‡³å°‘ä¸€æ¬¡æ­»ä¿¡æŠ•é€’ ä»¥åŠ AMQP ä¿®æ”¹ï¼ˆAMQP.modifiedï¼‰çš„å¤„ç†ç»“æœã€‚</p></li><li class="lvl-2"><p>å®ƒé€‚åˆ ä»¥æ•°æ®å®‰å…¨ä¸ºé¦–è¦ç›®æ ‡ çš„åœºæ™¯ã€‚ä¸ç»å…¸é˜Ÿåˆ—ç›¸æ¯”ï¼ŒQuorumæ˜¯ä»¥ç‰ºç‰²å¾ˆå¤šé«˜çº§é˜Ÿåˆ—ç‰¹æ€§ä¸ºä»£ä»·ï¼Œæ¥è¿›ä¸€æ­¥ä¿è¯æ¶ˆæ¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é«˜å¯é ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/oQ8YiT.png" alt=""></p></li><li class="lvl-2"><p>ä»²è£é˜Ÿåˆ—ï¼ˆQuorum Queueï¼‰çš„ <code>Durability</code> åªèƒ½è®¾ç½®ä¸º Durable(true)ã€‚<code>Auto delete</code> åªèƒ½ä¸º No(false)ã€‚</p></li><li class="lvl-2"><p>å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†)</p></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>é…ç½®å‚æ•°å</th><th>æ•°æ®ç±»å‹</th><th>ä½œç”¨è¯´æ˜</th><th>å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Auto expire</strong></td><td><code>x-expires</code></td><td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td><td>é˜Ÿåˆ—åœ¨æŒ‡å®šæ—¶é—´å†…æ— äººä½¿ç”¨ï¼ˆæ— æ¶ˆè´¹è€…ã€æ— å‘å¸ƒã€æ— è®¿é—®ï¼‰æ—¶è‡ªåŠ¨åˆ é™¤</td><td>èŠ‚çœèµ„æºï¼Œé˜Ÿåˆ—ç©ºé—²è¿‡æœŸæ—¶é—´</td></tr><tr><td><strong>Message TTL</strong></td><td><code>x-message-ttl</code></td><td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td><td>é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„ç”Ÿå­˜æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´åæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–è½¬å…¥æ­»ä¿¡é˜Ÿåˆ—</td><td>æ§åˆ¶æ¶ˆæ¯æ—¶æ•ˆæ€§</td></tr><tr><td><strong>Overflow behaviour</strong></td><td><code>x-overflow</code></td><td>å­—ç¬¦ä¸²ï¼ˆ<code>drop-head</code> æˆ– <code>reject-publish</code>ï¼‰</td><td>å½“é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦æ—¶çš„å¤„ç†æ–¹å¼</td><td><code>drop-head</code>ï¼šä¸¢å¼ƒæœ€æ—©æ¶ˆæ¯ï¼Œ<code>reject-publish</code>ï¼šæ‹’ç»æ–°æ¶ˆæ¯</td></tr><tr><td><strong>Single active consumer</strong></td><td><code>x-single-active-consumer</code></td><td>å¸ƒå°”å€¼ï¼ˆtrue/falseï¼‰</td><td>æ˜¯å¦å¯ç”¨å•æ´»æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ—</td><td>ä¿è¯ä¸¥æ ¼é¡ºåºæ¶ˆè´¹</td></tr><tr><td><strong>Dead letter exchange (DLX)</strong></td><td><code>x-dead-letter-exchange</code></td><td>å­—ç¬¦ä¸²</td><td>æŒ‡å®šé˜Ÿåˆ—çš„æ­»ä¿¡äº¤æ¢æœºï¼Œç”¨äºæ¥æ”¶æ— æ³•æ¶ˆè´¹æˆ–è¿‡æœŸçš„æ¶ˆæ¯</td><td>ä¸ DLX é…åˆä½¿ç”¨å¤„ç†å¤±è´¥æ¶ˆæ¯</td></tr><tr><td><strong>Dead letter routing key</strong></td><td><code>x-dead-letter-routing-key</code></td><td>å­—ç¬¦ä¸²</td><td>æ¶ˆæ¯è½¬å‘åˆ° DLX æ—¶çš„è·¯ç”±é”®</td><td>çµæ´»è·¯ç”±æ­»ä¿¡æ¶ˆæ¯</td></tr><tr><td><strong>Max length</strong></td><td><code>x-max-length</code></td><td>æ•´æ•°</td><td>é˜Ÿåˆ—ä¸­æœ€å¤§æ¶ˆæ¯æ¡æ•°</td><td>è¶…è¿‡æ—¶æŒ‰ Overflow behaviour å¤„ç†</td></tr><tr><td><strong>Max length bytes</strong></td><td><code>x-max-length-bytes</code></td><td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td><td>é˜Ÿåˆ—æ¶ˆæ¯æ€»å­—èŠ‚æ•°ä¸Šé™</td><td>è¶…è¿‡æ—¶æŒ‰ Overflow behaviour å¤„ç†</td></tr><tr><td><strong>Delivery limit</strong></td><td><code>x-delivery-limit</code></td><td>æ•´æ•°</td><td>æ¶ˆæ¯å…è®¸æŠ•é€’çš„æœ€å¤§æ¬¡æ•°ï¼Œè¶…è¿‡åå˜ä¸ºæ­»ä¿¡</td><td>æ§åˆ¶æ¶ˆæ¯é‡è¯•æ¬¡æ•°</td></tr><tr><td><strong>Initial cluster size</strong></td><td><code>x-quorum-initial-group-size</code></td><td>æ•´æ•°</td><td>é˜Ÿåˆ—åœ¨åˆ›å»ºæ—¶éœ€è¦çš„æœ€å°èŠ‚ç‚¹æ•°</td><td>ç”¨äºä¿è¯ä»²è£é˜Ÿåˆ—çš„é«˜å¯ç”¨æ€§</td></tr><tr><td><strong>Target cluster size</strong></td><td><code>x-quorum-target-group-size</code></td><td>æ•´æ•°</td><td>é˜Ÿåˆ—è¿è¡Œæ—¶çš„ç›®æ ‡èŠ‚ç‚¹æ•°</td><td>å½“é›†ç¾¤èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œä»²è£é˜Ÿåˆ—ä¼šå°è¯•è°ƒæ•´å‰¯æœ¬æ•°é‡</td></tr><tr><td><strong>Dead letter strategy</strong></td><td><code>x-dead-letter-strategy</code></td><td>å­—ç¬¦ä¸²ï¼ˆ<code>at-most-once</code>ã€<code>at-least-once</code>ï¼‰</td><td>è®¾ç½®ä»²è£é˜Ÿåˆ—çš„æ­»ä¿¡å¤„ç†ç­–ç•¥</td><td>ä»…é€‚ç”¨äº Quorum Queueã€‚<br><code>at-most-once</code>ï¼ˆé»˜è®¤ï¼‰ï¼šæ¶ˆæ¯æœ€å¤šæŠ•é€’ä¸€æ¬¡ï¼Œå¯èƒ½ä¸¢å¤±ã€‚<br><code>at-least-once</code>ï¼šç¡®ä¿æ¶ˆæ¯è‡³å°‘æŠ•é€’ä¸€æ¬¡ï¼Œå¿…é¡»å°† Overflow behaviour è®¾ç½®ä¸º <code>reject-publish</code>ï¼Œå¦åˆ™å›é€€åˆ° <code>at-most-once</code>ã€‚</td></tr><tr><td><strong>Leader locator</strong></td><td><code>x-queue-leader-locator</code></td><td>å­—ç¬¦ä¸²ï¼ˆ<code>client-local</code>ã€<code>balanced</code>ï¼‰</td><td>è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—ä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™</td><td><code>client-local</code>ï¼šé€‰æ‹©å®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸º Leader <br> <code>balanced</code>ï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡ Leader åˆ†å¸ƒ</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Quorum Queues å’Œ Classic Queues çš„åŠŸèƒ½å¯¹æ¯”å¦‚ä¸‹ï¼š</p></li></ul><table><thead><tr><th>Feature</th><th>ä¸­æ–‡å«ä¹‰</th><th>Classic queues</th><th>Quorum queues</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Non-durable queues</td><td>éæŒä¹…åŒ–é˜Ÿåˆ—</td><td>yes</td><td>no</td><td>Quorum queues æ€»æ˜¯æŒä¹…åŒ–ï¼Œä¸æ”¯æŒéæŒä¹…åŒ–</td></tr><tr><td>Message replication</td><td>æ¶ˆæ¯å¤åˆ¶</td><td>no</td><td>yes</td><td>Quorum queues å†…ç½®æ¶ˆæ¯å¤åˆ¶ï¼ŒClassic queues éœ€é•œåƒç­–ç•¥</td></tr><tr><td>Exclusivity</td><td>ç‹¬å é˜Ÿåˆ—</td><td>yes</td><td>no</td><td>Classic queues æ”¯æŒç‹¬å é˜Ÿåˆ—ï¼ŒQuorum queues ä¸æ”¯æŒç‹¬å </td></tr><tr><td>Per message persistence</td><td>æ¶ˆæ¯çº§æŒä¹…åŒ–</td><td>per message</td><td>always</td><td>Quorum queues æ¶ˆæ¯æ€»æ˜¯æŒä¹…åŒ–</td></tr><tr><td>Membership changes</td><td>èŠ‚ç‚¹æˆå‘˜å˜æ›´</td><td>no</td><td>semi-automatic</td><td>Quorum queues èŠ‚ç‚¹å˜åŒ–æ—¶åŠè‡ªåŠ¨å¤„ç†å¤åˆ¶</td></tr><tr><td>Message TTL (Time-To-Live)</td><td>æ¶ˆæ¯å­˜æ´»æ—¶é—´</td><td>yes</td><td>yes</td><td>ä¸¤è€…éƒ½æ”¯æŒæ¶ˆæ¯è¿‡æœŸæ—¶é—´</td></tr><tr><td>Queue TTL</td><td>é˜Ÿåˆ—å­˜æ´»æ—¶é—´</td><td>yes</td><td>partially</td><td>Quorum queues çš„ lease ä¸ä¼šå› é‡æ–°å£°æ˜è€Œç»­æœŸ</td></tr><tr><td>Queue length limits</td><td>é˜Ÿåˆ—é•¿åº¦é™åˆ¶</td><td>yes</td><td>yes</td><td>Quorum queues æ”¯æŒé•¿åº¦é™åˆ¶ï¼Œä½† <code>x-overflow=reject-publish-dlx</code> ä¸æ”¯æŒ</td></tr><tr><td>Keeps messages in memory</td><td>æ¶ˆæ¯å†…å­˜ä¿å­˜</td><td>see Classic Queues</td><td>never</td><td>Quorum queues æ¶ˆæ¯æ€»æ˜¯å†™å…¥ç£ç›˜ï¼Œä¸ä¿ç•™åœ¨å†…å­˜</td></tr><tr><td>Message priority</td><td>æ¶ˆæ¯ä¼˜å…ˆçº§</td><td>yes</td><td>yes</td><td>æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§</td></tr><tr><td>Single Active Consumer</td><td>å•æ´»æ¶ˆè´¹è€…</td><td>yes</td><td>yes</td><td>æ”¯æŒå•æ´»æ¶ˆè´¹è€…</td></tr><tr><td>Consumer exclusivity</td><td>ç‹¬å æ¶ˆè´¹è€…</td><td>yes</td><td>no</td><td>Quorum queues ä¸æ”¯æŒç‹¬å æ¶ˆè´¹è€…ï¼Œéœ€ä½¿ç”¨ Single Active Consumer</td></tr><tr><td>Consumer priority</td><td>æ¶ˆè´¹è€…ä¼˜å…ˆçº§</td><td>yes</td><td>yes</td><td>æ”¯æŒæ¶ˆè´¹è€…ä¼˜å…ˆçº§</td></tr><tr><td>Dead letter exchanges</td><td>æ­»ä¿¡äº¤æ¢æœº</td><td>yes</td><td>yes</td><td>æ”¯æŒæ­»ä¿¡äº¤æ¢æœº</td></tr><tr><td>Adheres to policies</td><td>éµå¾ªç­–ç•¥</td><td>yes</td><td>yes</td><td>æ”¯æŒç­–ç•¥ï¼Œä½† Quorum queues çš„éƒ¨åˆ†ç­–ç•¥è¡Œä¸ºä¸åŒ</td></tr><tr><td>Poison message handling</td><td>æ¯’æ¶ˆæ¯å¤„ç†</td><td>no</td><td>yes</td><td>Quorum queues æ”¯æŒæ¯’æ¶ˆæ¯å¤„ç†</td></tr><tr><td>Server-named queues</td><td>æœåŠ¡å™¨è‡ªåŠ¨å‘½åé˜Ÿåˆ—</td><td>yes</td><td>no</td><td>Quorum queues ä¸æ”¯æŒæœåŠ¡å™¨è‡ªåŠ¨å‘½åé˜Ÿåˆ—</td></tr></tbody></table><h2 id="Stream-æµ">Stream(æµ)</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://www.rabbitmq.com/docs/streams">Stream</a> æ˜¯RabbitMQè‡ª 3.9.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ç§æ–°çš„æ•°æ®é˜Ÿåˆ—ç±»å‹ã€‚è¿™ç§é˜Ÿåˆ—ç±»å‹çš„æ¶ˆæ¯æ˜¯æŒä¹…åŒ–åˆ°ç£ç›˜å¹¶ä¸”å…·å¤‡åˆ†å¸ƒå¼å¤‡ä»½çš„ï¼Œæ›´é€‚åˆäºæ¶ˆè´¹è€…å¤šï¼Œè¯»æ¶ˆæ¯éå¸¸é¢‘ç¹çš„åœºæ™¯ã€‚</p></li><li class="lvl-2"><p>Stream çš„æ ¸å¿ƒæ˜¯ä»¥append-onlyåªæ·»åŠ çš„æ—¥å¿—æ¥è®°å½•æ¶ˆæ¯ï¼Œæ•´ä½“æ¥è¯´ï¼Œå°±æ˜¯æ¶ˆæ¯å°†ä»¥append-onlyçš„æ–¹å¼æŒä¹…åŒ–åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡è°ƒæ•´æ¯ä¸ªæ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦offsetï¼Œæ¥å®ç°æ¶ˆæ¯çš„å¤šæ¬¡åˆ†å‘ã€‚</p></li><li class="lvl-2"><p>Stream ä¸æ”¯æŒæ­»ä¿¡äº¤æ¢æœºï¼Œä¸æ”¯æŒå¤„ç†æ¯’æ¶ˆæ¯ã€‚</p></li><li class="lvl-2"><p>å®é™…ä¸Š Stream ä¸å±äºé˜Ÿåˆ—ï¼Œæµï¼ˆStreamsï¼‰ æ˜¯ä¸€ç§ æŒä¹…åŒ–ã€å¯å¤åˆ¶çš„æ•°æ®ç»“æ„ï¼ŒåŠŸèƒ½ä¸Šç±»ä¼¼é˜Ÿåˆ—ï¼šä»ç”Ÿäº§è€…ç¼“å†²æ¶ˆæ¯ä¾›æ¶ˆè´¹è€…è¯»å–ã€‚ä½†å®ƒä¸é˜Ÿåˆ—æœ‰ä¸¤ä¸ªé‡è¦åŒºåˆ«ï¼š</p><ul class="lvl-2"><li class="lvl-4">å­˜å‚¨æ¨¡å‹ â€“ æµæ˜¯ è¿½åŠ æ—¥å¿—ï¼ˆappend-only logï¼‰ï¼Œæ¶ˆæ¯å¯ä»¥ é‡å¤è¯»å–ç›´åˆ°è¿‡æœŸã€‚</li><li class="lvl-4">æ¶ˆè´¹æ¨¡å‹ â€“ æµæä¾› éç ´åæ€§æ¶ˆè´¹è¯­ä¹‰ï¼ˆnon-destructive consumer semanticsï¼‰ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å¤šæ¬¡è¯»å–åŒä¸€æ¡æ¶ˆæ¯è€Œä¸ä¼šåˆ é™¤å®ƒã€‚</li></ul></li><li class="lvl-2"><p>Stream å§‹ç»ˆæ˜¯æŒä¹…åŒ–å’Œå¤åˆ¶çš„ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚æ¶ˆè´¹è€…å¯ä»¥é€šè¿‡ RabbitMQ å®¢æˆ·ç«¯åº“ æˆ– ä¸“ç”¨äºŒè¿›åˆ¶åè®®æ’ä»¶ è¯»å–æµï¼Œå…¶ä¸­æ’ä»¶æ–¹å¼å¯ä»¥ è®¿é—®æ‰€æœ‰æµç‰¹æ€§ å¹¶æä¾› æœ€ä½³æ€§èƒ½ã€‚åˆç†çš„å®¢æˆ·ç«¯è¿æ¥ç­–ç•¥æœ‰åŠ©äºæå‡ ååé‡å’Œæ•ˆç‡ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/8KqZY9.png" alt=""></p></li><li class="lvl-2"><p>å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†)</p></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>é…ç½®å‚æ•°å</th><th>æ•°æ®ç±»å‹</th><th>ä½œç”¨è¯´æ˜</th><th>å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Max length bytes</strong></td><td><code>x-max-length-bytes</code></td><td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td><td>æµä¸­å…è®¸å­˜å‚¨çš„ <strong>æœ€å¤§æ•°æ®æ€»å­—èŠ‚æ•°</strong></td><td>è¶…è¿‡æ—¶æµå°†åœæ­¢æ¥æ”¶æ–°æ¶ˆæ¯ï¼Œé€‚åˆæ§åˆ¶å­˜å‚¨å®¹é‡</td></tr><tr><td><strong>Max time retention</strong></td><td><code>x-max-age</code></td><td>å­—ç¬¦ä¸²ï¼ˆæ—¶é—´å•ä½ï¼Œä¾‹å¦‚ <code>1h</code>, <code>30m</code>, <code>1d</code>ï¼‰</td><td>è®¾ç½®æµé˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„ <strong>æœ€å¤§ä¿ç•™æ—¶é—´</strong>ï¼Œè¶…è¿‡æ—¶é—´çš„æ¶ˆæ¯ä¼šè¢«åˆ é™¤</td><td>æ”¯æŒæ—¶é—´å•ä½ï¼šY=å¹´, M=æœˆ, D=å¤©, h=å°æ—¶, m=åˆ†é’Ÿ, s=ç§’ã€‚ä¾‹å¦‚ <code>&quot;1h&quot;</code> è¡¨ç¤ºåªä¿ç•™æœ€è¿‘ 1 å°æ—¶çš„æ¶ˆæ¯ï¼Œç”¨äºæ§åˆ¶æ•°æ®é‡å’Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ¶ˆæ¯</td></tr><tr><td><strong>Max segment size in bytes</strong></td><td><code>x-stream-max-segment-size</code></td><td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td><td>æµåˆ†æ®µå­˜å‚¨æ—¶çš„ <strong>æ¯ä¸ªæ®µçš„æœ€å¤§å­—èŠ‚æ•°</strong></td><td>æ§åˆ¶å•ä¸ªæ–‡ä»¶æ®µå¤§å°ï¼Œæœ‰åˆ©äº I/O æ€§èƒ½å’Œç®¡ç†</td></tr><tr><td><strong>Filter size (per chunk) in bytes</strong></td><td><code>x-stream-filter-size-bytes</code></td><td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td><td>æµå†…éƒ¨ <strong>è¿‡æ»¤ç´¢å¼•æ¯å—çš„å¤§å°</strong></td><td>ç”¨äºåŠ é€Ÿæ¶ˆæ¯å®šä½å’Œè¯»å–ï¼Œå½±å“å†…å­˜ä½¿ç”¨å’Œæ£€ç´¢æ•ˆç‡</td></tr><tr><td><strong>Initial cluster size</strong></td><td><code>x-initial-cluster-size</code></td><td>æ•´æ•°</td><td>æµåœ¨åˆ›å»ºæ—¶çš„ <strong>æœ€å°èŠ‚ç‚¹æ•°</strong></td><td>ä¿è¯æµçš„å¤åˆ¶å’Œé«˜å¯ç”¨æ€§</td></tr><tr><td><strong>Leader locator</strong></td><td><code>x-queue-leader-locator</code></td><td>å­—ç¬¦ä¸²ï¼ˆ<code>client-local</code>ã€<code>balanced</code>ï¼‰</td><td>è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜æµæ—¶ï¼Œä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™</td><td><code>client-local</code>ï¼šå®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸º Leaderï¼ˆé»˜è®¤ï¼‰<br><code>balanced</code>ï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡ Leader åˆ†å¸ƒï¼Œç”¨äºä¼˜åŒ– HA</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Classic Queue vs Stream Queue Feature Matrix</p></li></ul><table><thead><tr><th>Feature</th><th>ä¸­æ–‡å«ä¹‰</th><th>Classic queues</th><th>Stream queues</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Non-durable queues</td><td>éæŒä¹…åŒ–é˜Ÿåˆ—</td><td>yes</td><td>no</td><td>Stream é˜Ÿåˆ—æ€»æ˜¯æŒä¹…åŒ–ï¼Œä¸æ”¯æŒéæŒä¹…åŒ–</td></tr><tr><td>Exclusivity</td><td>ç‹¬å é˜Ÿåˆ—</td><td>yes</td><td>no</td><td>Classic é˜Ÿåˆ—æ”¯æŒç‹¬å ï¼ŒStream é˜Ÿåˆ—ä¸æ”¯æŒç‹¬å </td></tr><tr><td>Per message persistence</td><td>æ¶ˆæ¯çº§æŒä¹…åŒ–</td><td>per message</td><td>always</td><td>Stream é˜Ÿåˆ—çš„æ¶ˆæ¯æ€»æ˜¯æŒä¹…åŒ–</td></tr><tr><td>Membership changes</td><td>èŠ‚ç‚¹æˆå‘˜å˜æ›´</td><td>no</td><td>manual</td><td>Stream é˜Ÿåˆ—èŠ‚ç‚¹å˜æ›´éœ€è¦æ‰‹åŠ¨ç®¡ç†</td></tr><tr><td>TTL</td><td>æ¶ˆæ¯å­˜æ´»æ—¶é—´</td><td>yes</td><td>no (but see Retention)</td><td>Stream é˜Ÿåˆ—æ²¡æœ‰æ¶ˆæ¯ TTLï¼Œä½†å¯é€šè¿‡ Retention æ§åˆ¶è¿‡æœŸ</td></tr><tr><td>Queue length limits</td><td>é˜Ÿåˆ—é•¿åº¦é™åˆ¶</td><td>yes</td><td>no (but see Retention)</td><td>Stream é˜Ÿåˆ—æ²¡æœ‰å›ºå®šé•¿åº¦é™åˆ¶ï¼Œé€šè¿‡ Retention æ§åˆ¶æ•°æ®é‡</td></tr><tr><td>Keeps messages in memory</td><td>æ¶ˆæ¯å†…å­˜ä¿å­˜</td><td>see Classic Queues</td><td>never</td><td>Stream é˜Ÿåˆ—æ¶ˆæ¯ä¸ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œåªå†™å…¥ç£ç›˜</td></tr><tr><td>Message priority</td><td>æ¶ˆæ¯ä¼˜å…ˆçº§</td><td>yes</td><td>no</td><td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§</td></tr><tr><td>Consumer priority</td><td>æ¶ˆè´¹è€…ä¼˜å…ˆçº§</td><td>yes</td><td>no</td><td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¶ˆè´¹è€…ä¼˜å…ˆçº§</td></tr><tr><td>Dead letter exchanges</td><td>æ­»ä¿¡äº¤æ¢æœº</td><td>yes</td><td>no</td><td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ­»ä¿¡äº¤æ¢æœº</td></tr><tr><td>Adheres to policies</td><td>éµå¾ªç­–ç•¥</td><td>yes</td><td>yes (see Retention)</td><td>Stream é˜Ÿåˆ—æ”¯æŒç­–ç•¥ï¼Œä½†ä¸»è¦é€šè¿‡ Retention æ§åˆ¶è¡Œä¸º</td></tr><tr><td>Reacts to memory alarms</td><td>å†…å­˜å‘Šè­¦å“åº”</td><td>yes</td><td>no (uses minimal RAM)</td><td>Stream é˜Ÿåˆ—ä½¿ç”¨æœ€å°å†…å­˜ï¼Œä¸è§¦å‘å†…å­˜å‘Šè­¦</td></tr><tr><td>Poison message handling</td><td>æ¯’æ¶ˆæ¯å¤„ç†</td><td>no</td><td>no</td><td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¯’æ¶ˆæ¯å¤„ç†</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æˆ‘ä»¬å¯ä»¥æ¿€æ´»<code>æµæ’ä»¶</code>æ¥ä½¿ç”¨æµçš„ç‰¹æœ‰åŠŸèƒ½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_stream rabbitmq_stream_management</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ¿€æ´»<code>æµæ’ä»¶</code>åï¼ŒStreamé˜Ÿåˆ—çš„æ“ä½œæ–¹å¼å¯ä»¥æ›´é«˜çº§ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://www.rabbitmq.com/tutorials/tutorial-two-java-stream">å®˜æ–¹æ–‡æ¡£</a>ï¼Œä½œè€…åœ¨<a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo/rabbitmq-stream">Java Client ç¤ºä¾‹</a>ä¸­ä¹Ÿç»™å‡ºäº†ç¤ºä¾‹ä»£ç ã€‚</p></li></ul><h3 id="è¶…çº§æµ-Super-Streams">è¶…çº§æµ(Super Streams)</h3><ul class="lvl-0"><li class="lvl-2"><p>è¶…çº§æµï¼ˆSuper streamsï¼‰ æ˜¯ä¸€ç§é€šè¿‡å°†ä¸€ä¸ªå¤§çš„æµåˆ†åŒºæˆæ›´å°çš„æµæ¥å®ç°æ‰©å±•çš„æ–¹å¼ã€‚å®ƒä»¬ä¸ å•ä¸ªæ¶ˆè´¹è€…ï¼ˆSingle Active Consumerï¼‰ é›†æˆï¼Œä»¥åœ¨åˆ†åŒºå†…ä¿æŒæ¶ˆæ¯é¡ºåºã€‚è¶…çº§æµä» RabbitMQ 3.11 å¼€å§‹å¯ç”¨ã€‚</p></li><li class="lvl-2"><p>ä¸€ä¸ªè¶…çº§æµæ˜¯ç”±å¤šä¸ªæ™®é€šæµç»„æˆçš„é€»è¾‘æµã€‚å®ƒæ˜¯ä¸€ç§é€šè¿‡ RabbitMQ Streams æ¥æ‰©å±•å‘å¸ƒå’Œæ¶ˆè´¹çš„æ–¹æ³•ï¼šä¸€ä¸ªå¤§å‹é€»è¾‘æµè¢«åˆ’åˆ†æˆå¤šä¸ªåˆ†åŒºæµï¼Œå°†å­˜å‚¨å’Œæµé‡åˆ†æ•£åˆ°å¤šä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šã€‚</p></li><li class="lvl-2"><p>è¶…çº§æµä¾ç„¶æ˜¯ä¸€ä¸ªé€»è¾‘å®ä½“ï¼šç”±äºå®¢æˆ·ç«¯åº“çš„æ™ºèƒ½åŒ–å¤„ç†ï¼Œåº”ç”¨ç¨‹åºä¼šæŠŠå®ƒè§†ä¸ºä¸€ä¸ªâ€œå¤§å‹â€æµã€‚è¶…çº§æµçš„æ‹“æ‰‘ç»“æ„åŸºäº AMQP 0.9.1 æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯äº¤æ¢æœºï¼ˆexchangeï¼‰ã€é˜Ÿåˆ—ï¼ˆqueueï¼‰å’Œå®ƒä»¬ä¹‹é—´çš„ç»‘å®šï¼ˆbindingï¼‰ã€‚</p></li><li class="lvl-2"><p>å¯ä»¥ä½¿ç”¨ä»»ä½• AMQP 0.9.1 åº“æˆ–ç®¡ç†æ’ä»¶åˆ›å»ºè¶…çº§æµçš„æ‹“æ‰‘ã€‚å®ƒéœ€è¦åˆ›å»ºä¸€ä¸ªç›´è¿äº¤æ¢æœºï¼ˆdirect exchangeï¼‰ã€åˆ†åŒºæµï¼ˆpartition streamsï¼‰ï¼Œå¹¶å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ã€‚</p></li><li class="lvl-2"><p>é€šè¿‡ç®¡ç†æ§åˆ¶å°åˆ›å»ºè¶…çº§æµ<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/j2G1HC.png" alt=""></p></li><li class="lvl-2"><p>ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤åˆ›å»ºè¶…çº§æµï¼Œä»¥ä¸‹æ˜¯å¦‚ä½•ç”¨å‘½ä»¤åˆ›å»ºä¸€ä¸ªåŒ…å« 3 ä¸ªåˆ†åŒºçš„è¶…çº§æµï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmq-streams add_super_stream [-p &lt;vhost&gt;] &lt;stream-name&gt; [--partitions &lt;number&gt;]</span></span><br><span class="line">rabbitmq-streams add_super_stream -p /vtest sq_3 --partitions 3</span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºçš„Stream<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/4py5OE.png" alt=""><br>åˆ›å»ºçš„ Exchangeï¼Œåç§° sq_3<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/EwfTRM.png" alt=""><br>ç»‘å®šå…³ç³»<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/NErhQX.png" alt=""></p></blockquote><h2 id="é˜Ÿåˆ—ç±»å‹æ‰©å±•">é˜Ÿåˆ—ç±»å‹æ‰©å±•</h2><h3 id="æ‡’é˜Ÿåˆ—">æ‡’é˜Ÿåˆ—</h3><ul class="lvl-0"><li class="lvl-2"><p>ä»3.6.xç‰ˆæœ¬åˆ°3.12.xç‰ˆæœ¬ï¼ŒRabbitMQæä¾›äº†ä¸€ç§é’ˆå¯¹Classic Queueçš„ä¼˜åŒ–é…ç½®ï¼Œ<code>lazy-mode</code>ï¼Œ<a href="https://www.rabbitmq.com/docs/lazy-queues">æ‡’å¯¹åˆ—</a>ã€‚æ‡’é˜Ÿåˆ—ä¼šå°½å¯èƒ½æ—©çš„å°†æ¶ˆæ¯å†…å®¹ä¿å­˜åˆ°ç¡¬ç›˜å½“ä¸­ï¼Œå¹¶ä¸”åªæœ‰åœ¨ç”¨æˆ·è¯·æ±‚åˆ°æ—¶ï¼Œæ‰ä¸´æ—¶ä»ç¡¬ç›˜åŠ è½½åˆ°RAMå†…å­˜å½“ä¸­ã€‚</p></li><li class="lvl-2"><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQæ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œä¼šä¿å­˜åˆ°å†…å­˜ä»¥ä¾¿ä½¿ç”¨ï¼ŒåŒæ—¶æŠŠæ¶ˆæ¯å†™åˆ°ç¡¬ç›˜ã€‚ä½†æ˜¯ï¼Œæ¶ˆæ¯å†™å…¥ç¡¬ç›˜çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¼šé˜»å¡é˜Ÿåˆ—çš„ã€‚RabbitMQè™½ç„¶é’ˆå¯¹å†™å…¥ç¡¬ç›˜é€Ÿåº¦åšäº†å¾ˆå¤šç®—æ³•ä¼˜åŒ–ï¼Œä½†æ˜¯åœ¨é•¿é˜Ÿåˆ—ä¸­ï¼Œä¾ç„¶è¡¨ç°ä¸æ˜¯å¾ˆç†æƒ³ï¼Œæ‰€ä»¥å°±æœ‰äº†æ‡’é˜Ÿåˆ—çš„å‡ºç°ã€‚</p></li><li class="lvl-2"><p>æ‡’é˜Ÿåˆ—ä¼šå°è¯•å°½å¯èƒ½æ—©çš„æŠŠæ¶ˆæ¯å†™åˆ°ç¡¬ç›˜ä¸­ã€‚è¿™æ„å‘³ç€åœ¨æ­£å¸¸æ“ä½œçš„å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒRAMä¸­è¦ä¿å­˜çš„æ¶ˆæ¯è¦å°‘å¾—å¤šã€‚å½“ç„¶ï¼Œè¿™æ˜¯ä»¥å¢åŠ ç£ç›˜IOä¸ºä»£ä»·çš„ã€‚</p></li><li class="lvl-2"><p>æ‡’é˜Ÿåˆ—é€‚åˆæ¶ˆæ¯é‡å¤§ä¸”é•¿æœŸæœ‰å †ç§¯çš„é˜Ÿåˆ—ï¼Œå¯ä»¥å‡å°‘å†…å­˜ä½¿ç”¨ï¼ŒåŠ å¿«æ¶ˆè´¹é€Ÿåº¦ã€‚ä½†æ˜¯è¿™æ˜¯ä»¥å¤§é‡æ¶ˆè€—é›†ç¾¤çš„ç½‘ç»œåŠç£ç›˜IOä¸ºä»£ä»·çš„ã€‚</p></li><li class="lvl-2"><p>ä»3.12å¾€åçš„ç‰ˆæœ¬ä¸­ï¼ŒRabbitMQ ä¸å†æ”¯æŒâ€œæƒ°æ€§â€æ¨¡å¼ï¼Œå› ä¸º ç»å…¸é˜Ÿåˆ— å½“å‰çš„ç‰¹æ€§å°±ç±»ä¼¼äºä»¥å‰çš„ æ‡’é˜Ÿåˆ—ã€‚</p></li></ul><h3 id="æ­»ä¿¡é˜Ÿåˆ—">æ­»ä¿¡é˜Ÿåˆ—</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://www.rabbitmq.com/docs/dlx">æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead Letter Queueï¼‰</a>ï¼Œæ–°ç‰ˆä¸­å«åš æ­»ä¿¡äº¤æ¢æœºï¼ˆDead Letter Exchange, DLXï¼‰ï¼Œæ˜¯RabbitMQå¯¹äºæœªèƒ½æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯è¿›è¡Œçš„ä¸€ç§è¡¥æ•‘æœºåˆ¶ï¼Œç”¨äºä¿å­˜æ— æ³•è¢«æ­£å¸¸å¤„ç†çš„æ¶ˆæ¯ã€‚å½“æ¶ˆæ¯è¢«æ¶ˆè´¹è€…å¤„ç†å¤±è´¥æ—¶ï¼ŒRabbitMQä¼šå°†æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†ã€‚</p></li><li class="lvl-2"><p>æ­»ä¿¡é˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„é˜Ÿåˆ—ï¼ŒåŒæ ·å¯ä»¥åœ¨é˜Ÿåˆ—ä¸Šå£°æ˜æ¶ˆè´¹è€…ï¼Œç»§ç»­å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹å¤„ç†ã€‚</p></li><li class="lvl-2"><p>æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼ŒRabbitMQä¼šå°†ä¸€ä¸ªæ­£å¸¸æ¶ˆæ¯è½¬æˆæ­»ä¿¡</p><ul class="lvl-2"><li class="lvl-4">æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆMessage rejectionï¼‰<ul class="lvl-4"><li class="lvl-6">ç”± AMQP 1.0 æ¥æ”¶ç«¯ä½¿ç”¨ rejected ç»“æœæ‹’ç»</li><li class="lvl-6">ç”± AMQP 0.9.1 æ¶ˆè´¹è€…ä½¿ç”¨ basic.reject æˆ– basic.nackï¼Œå¹¶ä¸”å‚æ•° requeue=false</li></ul></li><li class="lvl-4">æ¶ˆæ¯è¿‡æœŸï¼ˆMessage expirationï¼‰<ul class="lvl-4"><li class="lvl-6">æ¶ˆæ¯è¶…è¿‡å…¶é…ç½®çš„ TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰ åè¿‡æœŸã€‚</li></ul></li><li class="lvl-4">é˜Ÿåˆ—é•¿åº¦è¶…é™ï¼ˆQueue length exceededï¼‰<ul class="lvl-4"><li class="lvl-6">é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ•°é‡æˆ–æ€»å­—èŠ‚æ•°è¾¾åˆ°é…ç½®çš„æœ€å¤§é™åˆ¶åï¼Œè¢«ä¸¢å¼ƒçš„æ¶ˆæ¯ä¼šæ­»ä¿¡åŒ–ã€‚</li></ul></li><li class="lvl-4">æŠ•é€’æ¬¡æ•°è¶…é™ï¼ˆä»…é€‚ç”¨äºä»²è£é˜Ÿåˆ— Quorum Queueï¼‰<ul class="lvl-4"><li class="lvl-6">æ¶ˆæ¯çš„æŠ•é€’æ¬¡æ•°è¶…è¿‡äº†ä»²è£é˜Ÿåˆ—ä¸­é…ç½®çš„ delivery-limitã€‚</li></ul></li></ul></li><li class="lvl-2"><p>ä½¿ç”¨åœºæ™¯</p><ul class="lvl-2"><li class="lvl-4">ä½ å¯ä»¥åœ¨é˜Ÿåˆ—ä¸Šé…ç½® æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰ å’Œ æ­»ä¿¡è·¯ç”±é”®ï¼ˆDead Letter Routing Keyï¼‰ã€‚</li><li class="lvl-4">å½“æ¶ˆæ¯æˆä¸ºæ­»ä¿¡æ—¶ï¼Œä¼šè¢« é‡æ–°å‘å¸ƒåˆ° DLXï¼Œè¿™æ ·ä½ å¯ä»¥ï¼š<ul class="lvl-4"><li class="lvl-6">åšé”™è¯¯æ—¥å¿—è®°å½•</li><li class="lvl-6">è¿›è¡Œå¤±è´¥æ¶ˆæ¯é‡è¯•</li><li class="lvl-6">ç”¨äºç›‘æ§å’Œå‘Šè­¦</li></ul></li></ul></li><li class="lvl-2"><p>æ­»ä¿¡äº¤æ¢æœºçš„é…ç½®æ–¹æ³•ï¼ˆHow Dead Lettering is Configuredï¼‰</p><ul class="lvl-2"><li class="lvl-4">åœ¨ RabbitMQ ä¸­ï¼Œä»»ä½•é˜Ÿåˆ—éƒ½å¯ä»¥é€šè¿‡ å®¢æˆ·ç«¯ æˆ–è€… ç­–ç•¥ï¼ˆpoliciesï¼‰ æ¥é…ç½® æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰ã€‚</li><li class="lvl-4">é…ç½®æ—¶ä¸»è¦æ¶‰åŠä¸¤ä¸ªæ ¸å¿ƒå‚æ•°ï¼š</li></ul></li></ul><table><thead><tr><th>é…ç½®å‚æ•°å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>dead-letter-exchange</strong></td><td>æŒ‡å®šç”¨äºæ¥æ”¶æ­»ä¿¡æ¶ˆæ¯çš„ <strong>æ­»ä¿¡äº¤æ¢æœºåç§°</strong></td></tr><tr><td><strong>dead-letter-routing-key</strong></td><td>æŒ‡å®šæ­»ä¿¡æ¶ˆæ¯é‡æ–°å‘å¸ƒæ—¶ä½¿ç”¨çš„ <strong>è·¯ç”±é”®ï¼ˆRouting Keyï¼‰</strong></td></tr></tbody></table><blockquote><p>æ­»ä¿¡åœ¨è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—æ—¶ï¼Œä»–çš„ routingkey ä¹Ÿä¼šä¿å­˜ä¸‹æ¥ã€‚ä½†æ˜¯å¦‚æœé…ç½®äº† <code>x-dead-letter-routing-key</code> è¿™ä¸ªå‚æ•°çš„è¯ï¼Œroutingkey å°±ä¼šè¢«æ›¿æ¢ä¸ºé…ç½®çš„è¿™ä¸ªå€¼ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºé˜Ÿåˆ—æ·»åŠ  <code>x-dead-letter-exchange</code> å’Œ <code>x-dead-letter-routing-key</code> å‚æ•°ï¼Œæ¥æŒ‡å®š æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰å’Œ æ­»ä¿¡è·¯ç”±é”®ï¼ˆDead Letter Routing Keyï¼‰ã€‚ä½†æ˜¯è¿™æ ·åšå¾ˆéº»çƒ¦ï¼Œæ¯ä¸ªé˜Ÿåˆ—éƒ½è¦å•ç‹¬é…ç½®ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ç­–ç•¥ï¼ˆpoliciesï¼‰ æ¥ç»Ÿä¸€é…ç½®ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»…æŒ‡å®šæ­»ä¿¡äº¤æ¢æœºï¼Œè¿™é‡Œäº¤æ¢æœºçš„åç§°æ˜¯ my-dlxï¼Œäº¤æ¢æœºè¦æå‰åˆ›å»ºå¥½</span></span><br><span class="line">rabbitmqctl set_policy DLX <span class="string">&quot;.*&quot;</span> <span class="string">&#x27;&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;&#125;&#x27;</span> --apply-to queues --priority 7</span><br><span class="line"><span class="comment"># åŒæ—¶æŒ‡å®š æ­»ä¿¡äº¤æ¢æœº å’Œ è·¯ç”±é”®</span></span><br><span class="line">rabbitmqctl set_policy DLX <span class="string">&quot;.*&quot;</span> <span class="string">&#x27;&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;, &quot;dead-letter-routing-key&quot;:&quot;my-routing-key&quot;&#125;&#x27;</span> --apply-to queues --priority 7</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜ï¼š</p></li></ul><table><thead><tr><th>éƒ¨åˆ†</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>rabbitmqctl</code></td><td>RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·</td></tr><tr><td><code>set_policy</code></td><td>è®¾ç½®ä¸€ä¸ªç­–ç•¥ï¼ˆPolicyï¼‰ï¼Œç”¨äºåŠ¨æ€é…ç½®äº¤æ¢æœºã€é˜Ÿåˆ—æˆ–ç»‘å®šçš„å‚æ•°</td></tr><tr><td><code>DLX</code></td><td>ç­–ç•¥çš„åç§°ï¼Œç”¨æˆ·è‡ªå®šä¹‰ï¼Œä¾‹å¦‚è¿™é‡Œå« <code>DLX</code></td></tr><tr><td><code>&quot;.*&quot;</code></td><td>æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å¯¹è±¡çš„åç§°ã€‚<code>.*</code> è¡¨ç¤ºåŒ¹é… <strong>æ‰€æœ‰é˜Ÿåˆ—</strong>ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“é˜Ÿåˆ—åï¼Œæ¯”å¦‚ <code>^my-queue$</code></td></tr><tr><td><code>&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;, &quot;dead-letter-routing-key&quot;:&quot;my-routing-key&quot;&#125;</code></td><td>ç­–ç•¥å†…å®¹ï¼Œè¿™é‡Œè®¾ç½®äº†æ­»ä¿¡äº¤æ¢æœºåç§°å’Œè·¯ç”±é”®ï¼š<br> - <code>dead-letter-exchange</code>: è®¾ç½®æ­»ä¿¡äº¤æ¢æœºåç§°ä¸º <code>my-dlx</code><br> - <code>dead-letter-routing-key</code>: è®¾ç½®è·¯ç”±é”®ä¸º <code>my-routing-key</code></td></tr><tr><td><code>--apply-to queues</code></td><td>æŒ‡å®šç­–ç•¥ä½œç”¨å¯¹è±¡ä¸º <strong>é˜Ÿåˆ—ï¼ˆqueuesï¼‰</strong>ï¼Œè€Œä¸æ˜¯äº¤æ¢æœºï¼ˆexchangesï¼‰æˆ–ç»‘å®šï¼ˆbindingsï¼‰</td></tr><tr><td><code>--priority 7</code></td><td>ç­–ç•¥çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ã€‚å¤šä¸ªç­–ç•¥ä½œç”¨åœ¨åŒä¸€å¯¹è±¡æ—¶ï¼Œä¼˜å…ˆçº§é«˜çš„ä¼šè¦†ç›–ä½çš„</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ‰§è¡Œè¿™æ¡å‘½ä»¤åï¼š</p><ul class="lvl-2"><li class="lvl-4">æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Š <code>x-dead-letter-exchange=my-dlx</code> å’Œ <code>x-dead-letter-routing-key=my-routing-key</code> é…ç½®ã€‚</li><li class="lvl-4">é˜Ÿåˆ—ä¸­è¢«æ‹’ç»ã€è¿‡æœŸã€è¶…é•¿æˆ–è¶…è¿‡æŠ•é€’æ¬¡æ•°çš„æ¶ˆæ¯ä¼šè¢«é‡æ–°å‘å¸ƒåˆ° <code>my-dlx</code> äº¤æ¢æœºï¼Œå¹¶ä½¿ç”¨ <code>my-routing-key</code> ä½œä¸ºè·¯ç”±é”®ã€‚</li></ul></li><li class="lvl-2"><p>æ¶ˆæ¯è¢«ä½œä¸ºæ­»ä¿¡è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—åï¼Œä¼šåœ¨Headerå½“ä¸­å¢åŠ â¼€äº›æ¶ˆæ¯ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x-first-death-queueï¼šè¯¥æ¶ˆæ¯é¦–æ¬¡æˆä¸ºæ­»ä¿¡æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—åç§°</span><br><span class="line">x-first-death-reasonï¼šè¯¥æ¶ˆæ¯é¦–æ¬¡è¢«åˆ¤å®šä¸ºæ­»ä¿¡çš„åŸå› </span><br><span class="line">x-first-death-exchangeï¼šè¯¥æ¶ˆæ¯åœ¨é¦–æ¬¡æˆä¸ºæ­»ä¿¡å‰è¢«å‘å¸ƒåˆ°çš„äº¤æ¢æœºåç§°</span><br><span class="line">x-last-death-queueï¼šè¯¥æ¶ˆæ¯æœ€è¿‘ä¸€æ¬¡æˆä¸ºæ­»ä¿¡æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—åç§°</span><br><span class="line">x-last-death-reasonï¼šè¯¥æ¶ˆæ¯æœ€è¿‘ä¸€æ¬¡è¢«åˆ¤å®šä¸ºæ­»ä¿¡çš„åŸå› </span><br><span class="line">x-last-death-exchangeï¼šè¯¥æ¶ˆæ¯åœ¨æœ€è¿‘ä¸€æ¬¡æˆä¸ºæ­»ä¿¡å‰è¢«å‘å¸ƒåˆ°çš„äº¤æ¢æœºåç§°</span><br></pre></td></tr></table></figure><h3 id="å»¶è¿Ÿé˜Ÿåˆ—">å»¶è¿Ÿé˜Ÿåˆ—</h3><ul class="lvl-0"><li class="lvl-2"><p>å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆDelayed Message Queueï¼‰: å»¶è¿Ÿé˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„é˜Ÿåˆ—ï¼Œç”¨äºå»¶è¿Ÿæ¶ˆæ¯çš„æŠ•é€’ã€‚</p></li><li class="lvl-2"><p>RabbitMQä¸­ï¼Œæ˜¯ä¸å­˜åœ¨å»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½çš„ï¼Œè€Œé€šå¸¸å¦‚æœè¦ç”¨åˆ°å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå°±ä¼šé‡‡ç”¨ <code>TTL</code> + <code>æ­»ä¿¡é˜Ÿåˆ—</code> çš„æ–¹å¼æ¥å®ç°ã€‚</p></li><li class="lvl-2"><p>å»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°åŸç†ï¼š</p><ul class="lvl-2"><li class="lvl-4">åˆ›å»ºä¸€ä¸ªæ™®é€šé˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®é˜Ÿåˆ—çš„ TTLï¼ˆx-message-ttlï¼‰å‚æ•°ï¼Œä»¥åŠæŒ‡å®šä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—(x-dead-letter-exchange)</li><li class="lvl-4">å½“æ¶ˆæ¯çš„ TTL åˆ°æœŸæ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨ä»å½“å‰é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œå¹¶è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚</li><li class="lvl-4">ä¸ºæ­»ä¿¡é˜Ÿåˆ—åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¤„ç†å»¶è¿Ÿæ¶ˆæ¯ã€‚</li></ul></li></ul><h3 id="ä¼˜å…ˆçº§é˜Ÿåˆ—">ä¼˜å…ˆçº§é˜Ÿåˆ—</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆPriority Queueï¼‰: RabbitMQ æ”¯æŒä¸ºç»å…¸é˜Ÿåˆ—ï¼ˆclassic queuesï¼‰æ·»åŠ â€œä¼˜å…ˆçº§â€åŠŸèƒ½ã€‚å¯ç”¨â€œä¼˜å…ˆçº§â€åŠŸèƒ½çš„ç»å…¸é˜Ÿåˆ—é€šå¸¸è¢«ç§°ä¸ºâ€œä¼˜å…ˆçº§é˜Ÿåˆ—â€ï¼ˆpriority queuesï¼‰ã€‚</p></li><li class="lvl-2"><p>RabbitMQ æ”¯æŒ 1 åˆ° 255 ä¹‹é—´çš„ä¼˜å…ˆçº§å€¼ï¼Œä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨ 1 åˆ° 5 ä¹‹é—´çš„å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼˜å…ˆçº§å€¼è¶Šé«˜ï¼Œä¼šæ¶ˆè€—æ›´å¤šçš„ CPU å’Œå†…å­˜èµ„æºï¼Œå› ä¸º RabbitMQ åœ¨å†…éƒ¨éœ€è¦ä¸ºæ¯ä¸ªä¼˜å…ˆçº§ï¼ˆä» 1 åˆ°æœ€å¤§é…ç½®å€¼ï¼‰ç»´æŠ¤ä¸€ä¸ªå­é˜Ÿåˆ—ã€‚</p></li><li class="lvl-2"><p>åªæœ‰ç»å…¸é˜Ÿåˆ—æ”¯æŒé€šè¿‡å‚æ•°<code>x-max-priority</code>æŒ‡å®šé˜Ÿåˆ—æ”¯æŒçš„æœ€å¤§ä¼˜å…ˆçº§ï¼Œä¸”ä¸æ”¯æŒ é€šè¿‡ ç­–ç•¥ï¼ˆpoliciesï¼‰ å°†ç»å…¸é˜Ÿåˆ—å£°æ˜ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p></li><li class="lvl-2"><p>å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€šè¿‡å‚æ•° <code>priority</code> æŒ‡å®šæ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€‚æ˜¯çš„ï¼Œæ¶ˆæ¯ä¹Ÿæ˜¯å¯ä»¥è®¾ç½®å‚æ•°çš„ã€‚</p></li><li class="lvl-2"><p>ä¼˜å…ˆçº§é˜Ÿåˆ—å¦‚ä½•ä¸æ¶ˆè´¹è€…ååŒå·¥ä½œ</p><ul class="lvl-2"><li class="lvl-4">è‹¥æ¶ˆè´¹è€…è¿æ¥åˆ°ä¸€ä¸ª ç©ºé˜Ÿåˆ—ï¼Œç„¶åæ¶ˆæ¯é™†ç»­è¢«å‘å¸ƒï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆæ¯å¯èƒ½ ä¸ä¼š åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼ˆå³åˆšå‘å¸ƒå°±è¢«æ¶ˆè´¹è€…æ¥æ”¶ï¼‰ï¼Œæ­¤æ—¶ä¼˜å…ˆçº§åŠŸèƒ½æ²¡æœ‰æœºä¼šä¸Šåœºã€‚ä¼˜å…ˆçº§æ˜¯åœ¨æ¶ˆæ¯æ’é˜Ÿï¼ˆready æ¶ˆæ¯ï¼‰çŠ¶æ€æ—¶æ‰èƒ½ä½“ç°å…¶ä½œç”¨ã€‚</li><li class="lvl-4">æ¨èåœ¨æ¶ˆè´¹è€…ç«¯ä½¿ç”¨ basic.qos(prefetch) è®¾ç½®ï¼ˆåœ¨ manual ack æ¨¡å¼ä¸‹ï¼‰ï¼Œä»¥é™åˆ¶æ¶ˆè´¹è€…åŒæ—¶å¤„ç†çš„æœªç¡®è®¤æ¶ˆæ¯æ•°ã€‚è¿™æ ·èƒ½è®©ä¼˜å…ˆçº§çš„åˆ†çº§æ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œå› ä¸ºå¦‚æœ prefetch æ•°é‡æœªæ»¡ï¼Œé«˜ä¼˜å…ˆçº§æ¶ˆæ¯å¯ä»¥å…ˆè¢«å–å‡ºã€‚</li></ul></li><li class="lvl-2"><p>æ³¨æ„äº‹é¡¹</p><ul class="lvl-2"><li class="lvl-4">æœªè®¾ç½® <code>priority</code> çš„æ¶ˆæ¯ ä¼šè¢«å½“ä½œä¼˜å…ˆçº§ 0 å¤„ç†ã€‚è‹¥æ¶ˆæ¯æŒ‡å®šçš„ä¼˜å…ˆçº§å¤§äºé˜Ÿåˆ—çš„æœ€å¤§å€¼ï¼ˆx-max-priorityï¼‰ï¼Œåˆ™è¯¥æ¶ˆæ¯çš„ä¼˜å…ˆçº§å°±æ˜¯<code>x-max-priority</code>ã€‚</li><li class="lvl-4">TTL / æ¶ˆæ¯è¿‡æœŸ (message expiration)ï¼šå³ä½¿è®¾ç½®äº† TTLï¼Œè¿‡æœŸçš„æ¶ˆæ¯åªä¼šåœ¨é˜Ÿåˆ—å¤´è¢«æ£€æŸ¥ã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªä½ä¼˜å…ˆçº§çš„æ¶ˆæ¯åœ¨å‰é¢ä½†è¿˜æ²¡è¿‡æœŸï¼Œè€Œé«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯åœ¨åé¢ï¼Œä½ä¼˜å…ˆçº§çš„æ¶ˆæ¯å¯èƒ½ä¼šé˜»å¡é˜Ÿåˆ—å¤´ï¼Œå¯¼è‡´é«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯è¢«å»¶è¿Ÿã€‚</li><li class="lvl-4">é˜Ÿåˆ—æœ€å¤§é•¿åº¦é™åˆ¶ (max-length)ï¼šå¦‚æœé˜Ÿåˆ—è®¾ç½®äº†æœ€å¤§é•¿åº¦ï¼Œé˜Ÿåˆ—ä¼šä»å¤´éƒ¨ (head) ä¸¢å¼ƒæ¶ˆæ¯ä»¥ç»´æŒé•¿åº¦é™åˆ¶ã€‚è¿™å¯èƒ½å¯¼è‡´é«˜ä¼˜å…ˆçº§æ¶ˆæ¯ä¹Ÿè¢«ä¸¢å¼ƒï¼Œä»è€Œè¿èƒŒç›´è§‰ã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Queue çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.rabbitmq.com&quot;&gt;Zookeeperå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo&quot;&gt;Java Client ç¤ºä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rabbitmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rabbitmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rabbitmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rabbitmq" scheme="https://blog.hanqunfeng.com/tags/rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ çš„å®‰è£…åŠä½¿ç”¨</title>
    <link href="https://blog.hanqunfeng.com/2025/09/18/rabbitmq-install-01/"/>
    <id>https://blog.hanqunfeng.com/2025/09/18/rabbitmq-install-01/</id>
    <published>2025-09-18T13:30:05.000Z</published>
    <updated>2025-09-28T02:30:21.901Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RabbitMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://www.rabbitmq.com">Zookeeperå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p></li><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo">Java Client ç¤ºä¾‹</a></p></li></ul><span id="more"></span><h2 id="RabbitMQ-ç®€ä»‹">RabbitMQ ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>RabbitMQ æ˜¯ä¸€ä¸ªå¼€æºçš„ æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼ŒåŸºäº AMQPï¼ˆAdvanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰ å®ç°ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ è§£è€¦ã€ç¼“å†²å’Œå¼‚æ­¥å¤„ç†æ¶ˆæ¯ã€‚</p></li><li class="lvl-2"><p>å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯è®© <code>ä¸åŒç³»ç»Ÿ</code> æˆ– <code>åº”ç”¨</code> ä¹‹é—´å¯é åœ°ä¼ é€’æ¶ˆæ¯ï¼Œå³ä½¿å‘é€æ–¹æˆ–æ¥æ”¶æ–¹æš‚æ—¶ä¸å¯ç”¨ï¼Œä¹Ÿèƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚</p></li><li class="lvl-2"><p>RabbitMQ çš„æ ¸å¿ƒç‰¹ç‚¹</p></li></ul><table><thead><tr><th>æ ¸å¿ƒç‰¹ç‚¹</th><th>å…·ä½“è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å¯é æ€§</strong></td><td>- æ”¯æŒæ¶ˆæ¯ç¡®è®¤ï¼ˆACKï¼‰æœºåˆ¶<br>- æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜<br>- æ”¯æŒäº‹åŠ¡æˆ–ç¡®è®¤æ¨¡å¼ï¼Œä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±</td></tr><tr><td><strong>çµæ´»çš„è·¯ç”±</strong></td><td>- é€šè¿‡ <strong>äº¤æ¢æœºï¼ˆExchangeï¼‰</strong> å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„ <strong>é˜Ÿåˆ—ï¼ˆQueueï¼‰</strong><br>- æ”¯æŒå¤šç§è·¯ç”±ç­–ç•¥ï¼š<br>  â€¢ directï¼šç›´è¿ï¼ŒæŒ‰é˜Ÿåˆ—åè·¯ç”±<br>  â€¢ fanoutï¼šå¹¿æ’­ï¼Œæ‰€æœ‰é˜Ÿåˆ—éƒ½æ”¶åˆ°<br>  â€¢ topicï¼šä¸»é¢˜åŒ¹é…ï¼Œç±»ä¼¼è®¢é˜…æ¨¡å¼<br>  â€¢ headersï¼šæŒ‰æ¶ˆæ¯å¤´åŒ¹é…</td></tr><tr><td><strong>é«˜æ€§èƒ½</strong></td><td>- å†…å­˜é˜Ÿåˆ—å¿«é€Ÿå¤„ç†æ¶ˆæ¯<br>- æ”¯æŒå¼‚æ­¥ IO å’Œ Erlang çš„å¹¶å‘æ¨¡å‹</td></tr><tr><td><strong>å¤šè¯­è¨€æ”¯æŒ</strong></td><td>- å®¢æˆ·ç«¯åº“ä¸°å¯Œï¼šJavaã€Pythonã€Goã€C#ã€Node.js ç­‰<br>- å¯åœ¨å¤šç§å¹³å°å’Œæ¡†æ¶ä¸­ä½¿ç”¨</td></tr><tr><td><strong>é›†ç¾¤ä¸é«˜å¯ç”¨</strong></td><td>- æ”¯æŒé›†ç¾¤æ¨¡å¼<br>- é˜Ÿåˆ—å¯ä»¥é•œåƒåˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä¿è¯é«˜å¯ç”¨</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>RabbitMQ çš„æ ¸å¿ƒæ¦‚å¿µ</p></li></ul><table><thead><tr><th>æ¦‚å¿µ</th><th>å«ä¹‰</th><th>ä½œç”¨èŒƒå›´</th><th>ç±»æ¯”</th></tr></thead><tbody><tr><td><strong>Broker</strong></td><td>ä¸€ä¸ª <strong>RabbitMQ æœåŠ¡å®ä¾‹</strong>ï¼ŒåŒ…å«æ•´ä¸ª AMQP æœåŠ¡ã€ç®¡ç†æ’ä»¶ã€é˜Ÿåˆ—ã€äº¤æ¢æœºç­‰èµ„æº</td><td>è¿è¡Œåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œæˆ–é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹</td><td>ç±»ä¼¼äºæ•°æ®åº“çš„ <strong>å®ä¾‹</strong></td></tr><tr><td><strong>Vhost</strong></td><td>Broker å†…éƒ¨çš„ <strong>é€»è¾‘åˆ†åŒº</strong>ï¼Œç”¨äºéš”ç¦»ä¸åŒçš„é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šç­‰èµ„æº</td><td>ä¸€ä¸ª Broker å¯ä»¥æœ‰å¤šä¸ª vhostï¼Œæ¯ä¸ª vhost å½¼æ­¤éš”ç¦»</td><td>ç±»ä¼¼äºæ•°æ®åº“å®ä¾‹é‡Œçš„ <strong>schema</strong>ï¼Œå®é™…ä½¿ç”¨ä¸­å»ºè®®ä¸ºæ¯ä¸ªä¸šåŠ¡é…ç½®ä¸€ä¸ªç‹¬ç«‹çš„ vhostï¼Œå¹¶ä¸ºæ¯ä¸ªvhostå•ç‹¬é…ç½®ä¸€ä¸ªç®¡ç†ç”¨æˆ·</td></tr></tbody></table><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Producer</strong></td><td>æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå‘é€æ¶ˆæ¯åˆ° RabbitMQ</td></tr><tr><td><strong>Queue</strong></td><td>é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯çš„åœ°æ–¹</td></tr><tr><td><strong>Consumer</strong></td><td>æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œä»é˜Ÿåˆ—è·å–æ¶ˆæ¯</td></tr><tr><td><strong>Exchange</strong></td><td>äº¤æ¢æœºï¼Œæ¥æ”¶ Producer çš„æ¶ˆæ¯å¹¶æ ¹æ®è§„åˆ™è·¯ç”±åˆ°é˜Ÿåˆ—</td></tr><tr><td><strong>Binding</strong></td><td>ç»‘å®šï¼Œå®šä¹‰ Exchange ä¸ Queue çš„è·¯ç”±è§„åˆ™</td></tr><tr><td><strong>Message</strong></td><td>æ¶ˆæ¯ï¼ŒRabbitMQ ä¼ é€’çš„æ•°æ®å•å…ƒ</td></tr><tr><td><strong>Connection</strong></td><td>è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¸ RabbitMQ Broker ä¹‹é—´çš„ <strong>TCP è¿æ¥</strong>ï¼Œæ˜¯é€šä¿¡çš„ç‰©ç†é€šé“</td></tr><tr><td><strong>Channel</strong></td><td>é€šé“ï¼ŒConnection å†…éƒ¨çš„ <strong>é€»è¾‘è¿æ¥</strong>ï¼Œè½»é‡çº§ä¸”å¤šè·¯å¤ç”¨ï¼Œä¸€ä¸ªè¿æ¥å¯å¼€å¤šä¸ªé€šé“</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                        â”Œâ”€ Broker (RabbitMQ å®ä¾‹)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                        â”‚                                 â”‚</span><br><span class="line">                        â”‚    â”Œâ”€â”€â”€â”€â”€ Virtual Host â”€â”€â”€â”€â”€â”   â”‚</span><br><span class="line">        Producer â”€â”€â”€ TCP â”€â”€â”€â”€â”€â”€&gt; Exchange â”€â”€&gt; Queue â”€â”€â”€â”€â”€â”€â”€â”€&gt; TCP â”€â”€ Consumer</span><br><span class="line">(Connection â”€â”€&gt; Channel)â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span><br><span class="line">                        â”‚                                 â”‚</span><br><span class="line">                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/qgdFHL.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>RabbitMQ çš„å…¸å‹åº”ç”¨åœºæ™¯</p></li></ul><table><thead><tr><th>åº”ç”¨åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å¼‚æ­¥å¤„ç†</strong></td><td>ç”¨æˆ·è¯·æ±‚ä¸ç›´æ¥å¤„ç†ï¼Œæ¶ˆæ¯å…¥é˜Ÿåç”±åå°å¼‚æ­¥æ¶ˆè´¹ï¼Œä¾‹å¦‚é‚®ä»¶å‘é€ã€å›¾ç‰‡å¤„ç†</td></tr><tr><td><strong>å‰Šå³°å¡«è°·</strong></td><td>ç¼“å†²é«˜å³°æµé‡ï¼Œå¹³æ»‘ç³»ç»Ÿå‹åŠ›</td></tr><tr><td><strong>ç³»ç»Ÿè§£è€¦</strong></td><td>ä¸åŒæœåŠ¡ä¹‹é—´ä¸ç›´æ¥è°ƒç”¨ï¼Œé™ä½è€¦åˆ</td></tr><tr><td><strong>å¹¿æ’­/é€šçŸ¥</strong></td><td>å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œå®ç°å¤šæœåŠ¡åŒæ—¶æ”¶åˆ°æ¶ˆæ¯</td></tr><tr><td><strong>æ—¥å¿—æ”¶é›†</strong></td><td>ç»Ÿä¸€æ¥æ”¶ã€åˆ†å‘æ—¥å¿—åˆ°ä¸åŒå¤„ç†ç³»ç»Ÿ</td></tr></tbody></table><h2 id="RabbitMQ-4-0-æœ‰å“ªäº›å‡çº§">RabbitMQ 4.0+ æœ‰å“ªäº›å‡çº§</h2><ul class="lvl-0"><li class="lvl-2"><p>ç‰¹æ€§æ ‡å¿—ï¼ˆFeature Flagsï¼‰çš„ä¼˜åŒ–ä¸å¼ºåˆ¶æ€§è¦æ±‚</p></li></ul><ul class="lvl-0"><li class="lvl-3"><p>åœ¨å‡çº§åˆ° 4.0 ä¹‹å‰ï¼Œç”¨æˆ·å¿…é¡»å…ˆå‡çº§åˆ° 3.13.x ç‰ˆæœ¬å¹¶æ‰‹åŠ¨å¯ç”¨æ‰€æœ‰ç¨³å®šçš„ç‰¹æ€§æ ‡å¿—ã€‚</p></li><li class="lvl-3"><p>ä» 4.0+ å¼€å§‹ï¼Œå¦‚æœé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ”¯æŒæŸä¸ªå¿…éœ€çš„ç‰¹æ€§æ ‡å¿—ï¼Œç³»ç»Ÿä¼šåœ¨èŠ‚ç‚¹å¯åŠ¨æ—¶è‡ªåŠ¨å¯ç”¨è¯¥æ ‡å¿—ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚</p></li></ul><ul class="lvl-0"><li class="lvl-2"><p>AMQP åè®®çš„å¢å¼º</p></li></ul><ul class="lvl-0"><li class="lvl-3"><p>æ–°å¢äº†å¯¹ AMQP è¿‡æ»¤è¡¨è¾¾å¼ï¼ˆAMQP Filter Expressionsï¼‰Version 1.0 Working Draft 09 çš„æ”¯æŒã€‚</p></li></ul><ul class="lvl-0"><li class="lvl-2"><p>MQTT åè®®çš„æ”¹è¿›</p></li></ul><ul class="lvl-0"><li class="lvl-3"><p>é»˜è®¤çš„ MQTT æœ€å¤§åŒ…å¤§å°ä»ä¹‹å‰çš„ 256 MiB é™ä½åˆ° 16 MiBï¼ŒåŒæ—¶ä»å…è®¸ç”¨æˆ·é€šè¿‡é…ç½®é¡¹Â mqtt.max_packet_size_authenticatedÂ è‡ªå®šä¹‰è¯¥å€¼</p></li></ul><ul class="lvl-0"><li class="lvl-2"><p>Classicé˜Ÿåˆ—çš„å˜åŒ–</p></li></ul><ul class="lvl-0"><li class="lvl-3"><p>åˆ é™¤äº†å¯¹ Classicé˜Ÿåˆ— <code>version1</code> çš„æ”¯æŒï¼Œé»˜è®¤å°±æ˜¯ <code>version2</code></p></li><li class="lvl-3"><p>ä¸å†æ”¯æŒ Classicé˜Ÿåˆ— çš„é•œåƒåŠŸèƒ½ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Quorum é˜Ÿåˆ— ï¼Œæœªæ¥ä¼šå°† Quorum é˜Ÿåˆ— ä½œä¸ºé»˜è®¤é˜Ÿåˆ—ã€‚</p></li></ul><ul class="lvl-0"><li class="lvl-2"><p>é›†ç¾¤çŠ¶æ€ä¸‹åˆ›å»º Quorum é˜Ÿåˆ— å’Œ Stream é˜Ÿåˆ— ä¼šè‡ªåŠ¨å‡çº§ä¸º å¤åˆ¶é˜Ÿåˆ—ï¼ˆé•œåƒï¼‰</p></li></ul><h2 id="RabbitMQ-å•æœºå®‰è£…">RabbitMQ å•æœºå®‰è£…</h2><h3 id="å®‰è£…Erlang">å®‰è£…Erlang</h3><ul class="lvl-0"><li class="lvl-2"><p>RabbitMQæ˜¯åŸºäºErlangè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥å®‰è£…RabbitMQä¹‹å‰éœ€è¦å®‰è£…Erlangè¯­è¨€ç¯å¢ƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯RabbitMQä¸Erlangè¯­è¨€ä¹‹é—´æ˜¯æœ‰ç‰ˆæœ¬å¯¹åº”å…³ç³»çš„ã€‚å‚è€ƒå®˜æ–¹æ–‡æ¡£<a href="https://www.rabbitmq.com/docs/which-erlang">Erlang Version Requirements</a></p></li><li class="lvl-2"><p>ç›®å‰RabbitMQæœ€æ–°ç‰ˆæœ¬æ˜¯<code>4.1.4</code>ï¼ŒErlangç‰ˆæœ¬å¯ä»¥é€‰æ‹© <code>27.x</code>ï¼Œ<a href="https://github.com/rabbitmq/erlang-rpm/releases">GitHubä¸‹è½½åœ°å€</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ el9 çš„ç‰ˆæœ¬ï¼Œå¯¹åº” CentOS 9</span></span><br><span class="line">wget https://github.com/rabbitmq/erlang-rpm/releases/download/v27.3.4.3/erlang-27.3.4.3-1.el9.x86_64.rpm</span><br><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line"><span class="built_in">sudo</span> rpm -ivh erlang-27.3.4.3-1.el9.x86_64.rpm</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®‰è£…çš„ç‰ˆæœ¬</span></span><br><span class="line">erl</span><br><span class="line"><span class="comment"># è¾“å‡ºç±»ä¼¼äºï¼Œè¿™é‡Œ Erlang/OTP 27 å°±è¡¨ç¤ºå®‰è£…çš„æ˜¯ 27.x ç‰ˆæœ¬</span></span><br><span class="line">Erlang/OTP 27 [erts-15.2.7.2] [<span class="built_in">source</span>] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:1] [jit:ns]</span><br><span class="line"></span><br><span class="line">Eshell V15.2.7.2 (press Ctrl+G to abort, <span class="built_in">type</span> <span class="built_in">help</span>(). <span class="keyword">for</span> <span class="built_in">help</span>)</span><br><span class="line">1&gt; q().  <span class="comment"># é€€å‡ºå‘½ä»¤ï¼Œæ³¨æ„æ˜¯æ‹¬å·åé¢è¿˜æœ‰ä¸€ä¸ªç‚¹ã€‚è¾“å…¥ help(). æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span></span><br><span class="line">ok</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-RabbitMQ">å®‰è£… RabbitMQ</h3><ul class="lvl-0"><li class="lvl-2"><p>ç›®å‰RabbitMQæœ€æ–°ç‰ˆæœ¬æ˜¯<code>4.1.4</code>ï¼Œ<a href="https://github.com/rabbitmq/rabbitmq-server/releases">GitHubä¸‹è½½åœ°å€</a>]</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ï¼Œnoarch è¡¨ç¤ºæ¶æ„æ— å…³ï¼Œå³ X86_64 å’Œ ARM64 éƒ½å¯ä»¥</span></span><br><span class="line"><span class="comment"># å› ä¸ºæ²¡æœ‰å¯¹åº”çš„ el9 çš„åŒ…ï¼Œæ‰€ä»¥åªèƒ½ç”¨ el8 çš„åŒ…äº†ï¼Œå®é™…ä½¿ç”¨ä¸­æ²¡æœ‰é—®é¢˜ã€‚</span></span><br><span class="line">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v4.1.4/rabbitmq-server-4.1.4-1.el8.noarch.rpm</span><br><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line"><span class="built_in">sudo</span> rpm -ivh rabbitmq-server-4.1.4-1.el8.noarch.rpm</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line">rabbitmq-diagnostics version <span class="comment"># æ— éœ€å¯åŠ¨æœåŠ¡</span></span><br><span class="line"><span class="comment"># RabbitMQ æœåŠ¡å¯åŠ¨åæ–¹å¯æ­£ç¡®è¾“å‡º</span></span><br><span class="line">rabbitmqctl version</span><br></pre></td></tr></table></figure><h3 id="RabbitMQ-å¯åŠ¨ä¸åœæ­¢å‘½ä»¤">RabbitMQ å¯åŠ¨ä¸åœæ­¢å‘½ä»¤</h3><ul class="lvl-0"><li class="lvl-2"><p>Erlang VM æ˜¯ Erlang è¯­è¨€è¿è¡Œç¯å¢ƒï¼ŒRabbitMQ åº”ç”¨è¿è¡Œåœ¨ Erlang VM ä¸‹ã€‚</p></li><li class="lvl-2"><p>å¯åŠ¨ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start rabbitmq-server</span><br><span class="line"><span class="comment"># æˆ–è€…ï¼Œ--detached åå°è¿è¡Œï¼Œä¸åŠ å°±æ˜¯å‰å°è¿è¡Œ</span></span><br><span class="line"><span class="built_in">sudo</span> rabbitmq-server -detached</span><br><span class="line"></span><br><span class="line"><span class="comment"># å•ç‹¬å¯åŠ¨ åº”ç”¨ï¼Œæ­¤æ—¶éœ€è¦ä¿è¯ RabbitMQ æœåŠ¡(Erlang VM) æ­£åœ¨è¿è¡Œï¼Œä¸€èˆ¬é‡å¯ åº”ç”¨ æ—¶ä½¿ç”¨è¯¥å‘½ä»¤</span></span><br><span class="line"><span class="built_in">sudo</span> rabbitmqctl start_app</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœæ­¢ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop rabbitmq-server</span><br><span class="line"><span class="comment"># æˆ–è€…ï¼Œå•æœºæ¨¡å¼ stopï¼Œé›†ç¾¤æ¨¡å¼ shutdown</span></span><br><span class="line"><span class="built_in">sudo</span> rabbitmqctl stop / shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment"># å•ç‹¬åœæ­¢ RabbitMQ åº”ç”¨ï¼Œæ­¤æ—¶éœ€è¦ä¿è¯ RabbitMQ æœåŠ¡(Erlang VM) æ­£åœ¨è¿è¡Œï¼Œä¸€èˆ¬é‡å¯ åº”ç”¨ æ—¶ä½¿ç”¨è¯¥å‘½ä»¤</span></span><br><span class="line"><span class="built_in">sudo</span> rabbitmqctl stop_app</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹RabbitMQ æœåŠ¡çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl status rabbitmq-server</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line"><span class="built_in">sudo</span> rabbitmqctl status</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>RabbitMQ åœ¨ CentOS 9 (RPM å®‰è£…) çš„ç›®å½•ç»“æ„</p></li></ul><table><thead><tr><th>ç±»å‹</th><th>ç›®å½•è·¯å¾„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>é…ç½®æ–‡ä»¶</td><td><code>/etc/rabbitmq</code></td><td><code>rabbitmq.conf</code>ã€<code>advanced.config</code> ç­‰é…ç½®</td></tr><tr><td>æ—¥å¿—æ–‡ä»¶</td><td><code>/var/log/rabbitmq</code></td><td>RabbitMQ è¿è¡Œæ—¥å¿—ï¼Œé»˜è®¤å­˜æ”¾åœ¨è¿™é‡Œ</td></tr><tr><td>æ•°æ®ç›®å½•</td><td><code>/var/lib/rabbitmq/mnesia</code></td><td>æ¶ˆæ¯é˜Ÿåˆ—ã€å…ƒæ•°æ®å­˜å‚¨ç›®å½•</td></tr><tr><td>Erlang Cookie</td><td><code>/var/lib/rabbitmq/.erlang.cookie</code></td><td>Erlang èŠ‚ç‚¹é—´é€šä¿¡çš„ cookie æ–‡ä»¶</td></tr><tr><td>å¯æ‰§è¡Œæ–‡ä»¶</td><td><code>/usr/lib/rabbitmq/bin</code></td><td><code>rabbitmq-server</code>ã€<code>rabbitmqctl</code> ç­‰å‘½ä»¤</td></tr><tr><td>å¯åŠ¨è„šæœ¬</td><td><code>/usr/lib/systemd/system/rabbitmq-server.service</code></td><td>systemd ç®¡ç† RabbitMQ çš„å¯åŠ¨è„šæœ¬</td></tr><tr><td>æ’ä»¶ç›®å½•</td><td><code>/usr/lib/rabbitmq/lib/rabbitmq_server-&lt;version&gt;/plugins</code></td><td>æ‰€æœ‰æ’ä»¶æ–‡ä»¶å­˜æ”¾è·¯å¾„</td></tr></tbody></table><h3 id="æ¿€æ´»Webç®¡ç†æ§åˆ¶å°æ’ä»¶">æ¿€æ´»Webç®¡ç†æ§åˆ¶å°æ’ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>å¯¹äº RabbitMQ æ‰€æœ‰çš„æ“ä½œåŸºæœ¬éƒ½å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå®Œæˆï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥å¹¶ä¸æ–¹ä¾¿ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥æ¿€æ´» <code>rabbitmq_management</code> æ’ä»¶ï¼Œè¯¥æ’ä»¶æä¾›äº† Web ç®¡ç†æ§åˆ¶å°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Web ç®¡ç†æ§åˆ¶å°æ¥ç®¡ç† RabbitMQ</p></li><li class="lvl-2"><p><a href="https://www.rabbitmq.com/docs/management">rabbitmq_management</a> æ’ä»¶ä¸º å®˜æ–¹æ’ä»¶ï¼Œé»˜è®¤å·²ç»å®‰è£…ï¼Œä¸éœ€è¦ä¸‹è½½ï¼Œç›´æ¥æ¿€æ´»å³å¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¿€æ´»æ’ä»¶</span></span><br><span class="line"><span class="built_in">sudo</span> rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¯¥æ’ä»¶é™¤äº†æä¾›äº† <code>Web ç®¡ç†æ§åˆ¶å°</code> ï¼Œè¿˜æä¾› <code>åŸºäº HTTP çš„ API</code> ç”¨äºç®¡ç†å’Œç›‘æ§ RabbitMQ èŠ‚ç‚¹å’Œé›†ç¾¤ï¼Œä»¥åŠ <code>å‘½ä»¤è¡Œå·¥å…· rabbitmqadmin</code>ï¼Œè¿™ä¸ªåé¢ä¼šä»‹ç»ã€‚</p></li></ul><h4 id="è®¾ç½®è¿œç¨‹è®¿é—®å¸å·">è®¾ç½®è¿œç¨‹è®¿é—®å¸å·</h4><ul class="lvl-0"><li class="lvl-2"><p>æ’ä»¶æ¿€æ´»åå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://&lt;ip&gt;:15672</code>ï¼Œrabbitmq_management æ’ä»¶é»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ <code>guest</code>ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹å…¶åªèƒ½é€šè¿‡ <code>127.0.0.1</code> è®¿é—®ï¼Œæ­¤æ—¶æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³</p></li></ul><h5 id="1-å…è®¸-guest-è´¦å·è¿œç¨‹è®¿é—®">1. å…è®¸ <code>guest</code> è´¦å·è¿œç¨‹è®¿é—®</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ /etc/rabbitmq/rabbitmq.conf æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># å…è®¸guestç”¨æˆ·è¿œç¨‹è®¿é—®ï¼Œ`å®˜æ–¹ä¸æ¨è` ä¸€ç›´å¼€å¯ï¼Œå»ºè®®å¼€å¯ååœ¨ web æ§åˆ¶å°ä¸­åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ï¼Œç„¶åç«‹åˆ»å…³é—­è¯¥é…ç½®</span></span><br><span class="line">loopback_users.guest = <span class="literal">false</span></span><br><span class="line"><span class="comment"># é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ³¨æ„è¿™é‡Œ user å¦‚æœæ”¹æˆ adminï¼Œåˆ™ä¸Šé¢çš„å¼€å¯è¿œç¨‹è®¿é—®ä¸­çš„ guest ä¹Ÿè¦æ”¹æˆ admin</span></span><br><span class="line">default_user = guest</span><br><span class="line">default_pass = guest</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹å®Œæˆåï¼Œé‡å¯ RabbitMQ æœåŠ¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure><h5 id="2-æ–°åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿œç¨‹è®¿é—®çš„ç®¡ç†å‘˜è´¦å·">2. æ–°åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿œç¨‹è®¿é—®çš„ç®¡ç†å‘˜è´¦å·</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œæ¯”å¦‚è¿™é‡Œ ç”¨æˆ·åä¸º <code>admin</code>ï¼Œå¯†ç ä¸º <code>rabbitmq</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> rabbitmqctl add_user admin rabbitmq</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç»™ç®¡ç†å‘˜è´¦å·æ·»åŠ èµ„æºç®¡ç†æƒé™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> rabbitmqctl set_permissions -p / admin <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>éƒ¨åˆ†</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><code>rabbitmqctl</code></td><td>RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†ç”¨æˆ·ã€æƒé™ã€é˜Ÿåˆ—ã€äº¤æ¢æœºç­‰ã€‚</td></tr><tr><td><code>set_permissions</code></td><td>è®¾ç½®æŒ‡å®šç”¨æˆ·åœ¨æŸä¸ªè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ä¸‹çš„æƒé™ã€‚</td></tr><tr><td><code>-p /</code></td><td>æŒ‡å®šè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ã€‚è¿™é‡Œçš„ <code>/</code> æ˜¯é»˜è®¤è™šæ‹Ÿä¸»æœºã€‚</td></tr><tr><td><code>admin</code></td><td>ç”¨æˆ·åï¼Œè¿™é‡Œæ˜¯ä¸º <code>admin</code> ç”¨æˆ·è®¾ç½®æƒé™ã€‚</td></tr><tr><td><code>&quot;.*&quot;</code>ï¼ˆé…ç½®æƒé™ï¼‰</td><td>ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·å¯¹èµ„æºé…ç½®çš„æƒé™ï¼Œæ¯”å¦‚åˆ›å»ºäº¤æ¢æœºã€é˜Ÿåˆ—ã€ç»‘å®šç­‰ã€‚<code>&quot;.*&quot;</code> è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚</td></tr><tr><td><code>&quot;.*&quot;</code>ï¼ˆå†™æƒé™ï¼‰</td><td>ç¬¬äºŒä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·å‘å“ªäº›èµ„æºå‘é€æ¶ˆæ¯ã€‚<code>&quot;.*&quot;</code> è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚</td></tr><tr><td><code>&quot;.*&quot;</code>ï¼ˆè¯»æƒé™ï¼‰</td><td>ç¬¬ä¸‰ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·ä»å“ªäº›èµ„æºæ¶ˆè´¹æ¶ˆæ¯ã€‚<code>&quot;.*&quot;</code> è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è®¾ç½®adminè´¦å·ä¸ºæ§åˆ¶å°ç®¡ç†å‘˜</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> rabbitmqctl set_user_tags admin administrator</span><br></pre></td></tr></table></figure><table><thead><tr><th>éƒ¨åˆ†</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><code>rabbitmqctl</code></td><td>RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ã€‚</td></tr><tr><td><code>set_user_tags</code></td><td>ç”¨æ¥ä¸ºç”¨æˆ·è®¾ç½®æ ‡ç­¾ï¼ˆtagï¼‰ï¼Œæ ‡ç­¾å†³å®šäº†ç”¨æˆ·åœ¨ç®¡ç†ç•Œé¢æˆ– API ä¸­çš„æƒé™çº§åˆ«ã€‚</td></tr><tr><td><code>admin</code></td><td>ç”¨æˆ·åï¼Œè¿™é‡Œæ˜¯ä¸º <code>admin</code> ç”¨æˆ·è®¾ç½®æ ‡ç­¾ã€‚</td></tr><tr><td><code>administrator</code></td><td>æ ‡ç­¾åï¼Œè¡¨ç¤ºç»™è¯¥ç”¨æˆ·èµ‹äºˆç®¡ç†å‘˜æƒé™ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¸¸è§çš„ç”¨æˆ·æ ‡ç­¾</p></li></ul><table><thead><tr><th>æ ‡ç­¾</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>administrator</code></td><td>ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æœ€é«˜æƒé™ï¼Œå¯é€šè¿‡ Web ç®¡ç†ç•Œé¢ã€CLIã€API ç®¡ç† RabbitMQ æ‰€æœ‰å†…å®¹</td></tr><tr><td><code>monitoring</code></td><td>ç›‘æ§ç”¨æˆ·ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰ç›‘æ§ä¿¡æ¯ï¼Œä½†ä¸èƒ½ä¿®æ”¹é…ç½®</td></tr><tr><td><code>management</code></td><td>æ™®é€šç®¡ç†ç”¨æˆ·ï¼Œå¯ä»¥ç™»å½•ç®¡ç†ç•Œé¢ï¼Œä½†æƒé™å—é™</td></tr><tr><td><code>policymaker</code></td><td>ç­–ç•¥ç®¡ç†ç”¨æˆ·ï¼Œå¯ä»¥ç®¡ç†ç­–ç•¥å’Œå‚æ•°ï¼Œä½†ä¸èƒ½ç®¡ç†å…¶ä»–ç”¨æˆ·</td></tr><tr><td>æ— æ ‡ç­¾</td><td>æ™®é€šç”¨æˆ·ï¼Œåªèƒ½æ”¶å‘æ¶ˆæ¯ï¼Œä¸èƒ½ç™»å½•ç®¡ç†ç•Œé¢</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p><code>set_permissions</code> ä¸ <code>set_user_tags</code> æ€»ç»“å¯¹æ¯”</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>æ§åˆ¶èŒƒå›´</th><th>ä¸»è¦ä½œç”¨</th></tr></thead><tbody><tr><td><code>set_permissions</code></td><td>vhost å†…çš„èµ„æº</td><td>å‘æ¶ˆæ¯ã€æ”¶æ¶ˆæ¯ã€åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœº</td></tr><tr><td><code>set_user_tags</code></td><td>ç®¡ç†ç•Œé¢ã€ç®¡ç† API</td><td>ç”¨æˆ·ç®¡ç†ã€ç­–ç•¥ç®¡ç†ã€é›†ç¾¤ç®¡ç†</td></tr></tbody></table><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/4lP2cD.png" alt=""></p><h3 id="å¯ç”¨æ‰€æœ‰ç¨³å®šçš„-Feature-Flags">å¯ç”¨æ‰€æœ‰ç¨³å®šçš„ Feature Flags</h3><ul class="lvl-0"><li class="lvl-2"><p>ç™»å½•æ§åˆ¶å°åæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€æ¡å‘Šè­¦ä¿¡æ¯ï¼Œå‚è€ƒï¼š<a href="https://www.rabbitmq.com/docs/feature-flags">Feature Flags</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âš  All stable feature flags must be enabled after completing an upgrade.</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®ƒçš„æ„æ€æ˜¯ï¼šRabbitMQ åœ¨æ–°ç‰ˆæœ¬ä¸­å¼•å…¥äº†ä¸€äº› Feature Flagsï¼ˆç‰¹æ€§æ ‡å¿—ï¼‰ï¼Œè¿™äº›ç‰¹æ€§æ ‡å¿—ç”¨äºæ§åˆ¶ä¸€äº›æ–°çš„åŠŸèƒ½æˆ–è¡Œä¸ºæ˜¯å¦å¯ç”¨ã€‚å‡çº§ RabbitMQ åï¼Œæœ‰äº›åŠŸèƒ½ä¼šå¤„äº <code>æœªå¯ç”¨çŠ¶æ€</code>ï¼Œéœ€è¦ä½ æ‰‹åŠ¨å¼€å¯ï¼Œç¡®ä¿é›†ç¾¤å®Œå…¨è¿è¡Œåœ¨æœ€æ–°çš„åŠŸèƒ½æ¨¡å¼ä¸‹ã€‚</p></li><li class="lvl-2"><p>èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆæœ‰ Feature Flagsï¼Ÿ</p><ul class="lvl-2"><li class="lvl-4">å‘åå…¼å®¹ï¼šRabbitMQ å‡çº§æ—¶ï¼Œå¯èƒ½å¼•å…¥äº†æ–°çš„æ•°æ®æ ¼å¼æˆ–å†…éƒ¨æœºåˆ¶ï¼Œå¦‚æœç«‹å³å¯ç”¨ï¼Œæ—§ç‰ˆæœ¬èŠ‚ç‚¹å¯èƒ½æ— æ³•ç†è§£ã€‚</li><li class="lvl-4">æ»šåŠ¨å‡çº§æ”¯æŒï¼šå‡çº§é›†ç¾¤æ—¶ï¼Œå¯ä»¥å…ˆå‡çº§èŠ‚ç‚¹ï¼Œå†ç»Ÿä¸€å¯ç”¨åŠŸèƒ½ï¼Œé¿å…ä¸­é€”å‡ºé—®é¢˜ã€‚</li><li class="lvl-4">å¯æ§æ€§ï¼šä½ å¯ä»¥é€‰æ‹©åœ¨ç¡®è®¤é›†ç¾¤ç¨³å®šåå†å¯ç”¨æ–°åŠŸèƒ½ã€‚</li></ul></li><li class="lvl-2"><p>æŸ¥çœ‹å½“å‰ Feature Flags çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl -q --formatter pretty_table list_feature_flags</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºä¼šç±»ä¼¼è¿™æ ·ï¼š</span></span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ name                                 â”‚ state    â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ classic_mirrored_queue_version       â”‚ enabled  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ classic_queue_type_delivery_support  â”‚ enabled  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ detailed_queues_endpoint             â”‚ disabled â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ direct_exchange_routing_v2           â”‚ enabled  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line"></span><br><span class="line">&gt; enabledï¼šç‰¹æ€§å·²å¯ç”¨</span><br><span class="line">&gt; disabledï¼šç‰¹æ€§æœªå¯ç”¨</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥è¾“å‡º å…¶å®ƒ æ ¼å¼ï¼Œæ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># json</span></span><br><span class="line">rabbitmqctl -q --formatter json list_feature_flags name state provided_by desc doc_url | jq</span><br><span class="line"><span class="comment"># table</span></span><br><span class="line">rabbitmqctl -q --formatter pretty_table list_feature_flags name state provided_by desc doc_url</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ç”¨æ‰€æœ‰å·²æ ‡è®°ä¸º stable çš„ç‰¹æ€§ï¼Œå»ºè®®å‡çº§ä¸‹ä¸€ä¸ª RabbitMQ ç‰ˆæœ¬ å‰ä¸€å®šè¦ç¡®ä¿å½“å‰ç‰ˆæœ¬çš„ Feature Flags éƒ½æ˜¯å¯ç”¨çš„ï¼Œé¿å…å‡çº§åæ— æ³•é¡ºåˆ©å¯åŠ¨æœåŠ¡ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl enable_feature_flag all</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨æ§åˆ¶å°ä¸­ä¹Ÿå¯ä»¥æŸ¥çœ‹å’Œå¼€å¯è¿™äº› Feature Flags çš„çŠ¶æ€<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/VqNm1y.png" alt=""></p></li><li class="lvl-2"><p>è¿™é‡Œè¦æ³¨æ„ï¼Œ<strong>Feature Flags ä¸€æ—¦å¼€å¯å°±æ— æ³•å…³é—­ã€‚</strong></p></li></ul><h2 id="RabbitMQ-é…ç½®æ–‡ä»¶">RabbitMQ é…ç½®æ–‡ä»¶</h2><ul class="lvl-0"><li class="lvl-2"><p>å¯¹äº RPM/YUM/DNF å®‰è£…çš„ RabbitMQï¼Œé…ç½®æ–‡ä»¶é»˜è®¤è·¯å¾„æ˜¯</p></li></ul><table><thead><tr><th>æ–‡ä»¶ç±»å‹</th><th>é»˜è®¤ä½ç½®</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>ä¸»é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰</td><td><code>/etc/rabbitmq/rabbitmq.conf</code></td><td>ä½¿ç”¨ <strong>INI æ ¼å¼</strong>ï¼Œä¸»è¦é…ç½®éƒ½åœ¨è¿™é‡Œ</td></tr><tr><td>ç¯å¢ƒå˜é‡é…ç½®</td><td><code>/etc/rabbitmq/rabbitmq-env.conf</code></td><td>å®šä¹‰èŠ‚ç‚¹åã€Cookie ä½ç½®ã€æ•°æ®/æ—¥å¿—ç›®å½•ç­‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…å <code>/etc/rabbitmq/</code> ç›®å½•å¯èƒ½æ˜¯ç©ºçš„ï¼Œä½ éœ€è¦æ‰‹åŠ¨åˆ›å»º <code>rabbitmq.conf</code>ï¼Œè¯¦ç»†çš„å‚æ•°è¯´æ˜å¯ä»¥å‚çœ‹<a href="https://rabbitmq.com/configure.html">å®˜ç½‘æŒ‡å—</a>ï¼Œ<a href="https://github.com/rabbitmq/rabbitmq-server/blob/main/deps/rabbit/docs/rabbitmq.conf.example">rabbitmq.conf ç¤ºä¾‹</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/rabbitmq/rabbitmq.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›‘å¬ç«¯å£</span></span><br><span class="line">listeners.tcp.default = 5672</span><br><span class="line"><span class="comment"># ç®¡ç†ç•Œé¢ç«¯å£</span></span><br><span class="line">management.tcp.port = 15672</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>rabbitmq-env.conf</code> ç”¨æ¥ å®šä¹‰èŠ‚ç‚¹åã€Cookie ã€æ•°æ®/æ—¥å¿—ç›®å½•ç­‰çš„ç¯å¢ƒå˜é‡ï¼ŒRabbitMQ å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¯»å–è¯¥æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯é€šè¿‡ RPM å®‰è£…çš„ RabbitMQ çš„é»˜è®¤å€¼</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/rabbitmq/rabbitmq-env.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤ä½¿ç”¨ä¸»æœºçŸ­å(hostname -s)ï¼Œä¾‹å¦‚ rabbit@myhost</span></span><br><span class="line">NODENAME=rabbit@&lt;hostname&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»‘å®šçš„ IP åœ°å€ï¼Œç•™ç©ºè¡¨ç¤ºç›‘å¬æ‰€æœ‰åœ°å€ï¼Œç­‰ä»·äº 0.0.0.0</span></span><br><span class="line">NODE_IP_ADDRESS=</span><br><span class="line"></span><br><span class="line"><span class="comment"># AMQP åè®®ç«¯å£ï¼Œé»˜è®¤ 5672</span></span><br><span class="line">NODE_PORT=5672</span><br><span class="line"></span><br><span class="line"><span class="comment"># RabbitMQ æ•°æ®åº“å­˜å‚¨ç›®å½•</span></span><br><span class="line">MNESIA_BASE=/var/lib/rabbitmq/mnesia</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—å­˜æ”¾ç›®å½•</span></span><br><span class="line">LOG_BASE=/var/log/rabbitmq</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œä¸å¸¦ .conf åç¼€</span></span><br><span class="line">CONFIG_FILE=/etc/rabbitmq/rabbitmq</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¯å¦ä½¿ç”¨é•¿ä¸»æœºåï¼Œtrue/false (é•¿ä¸»æœºå hostname -f)</span></span><br><span class="line">USE_LONGNAME=<span class="literal">false</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸¤ä¸ªæ–‡ä»¶çš„ä½œç”¨</p></li></ul><table><thead><tr><th>æ–‡ä»¶</th><th>ä½œç”¨èŒƒå›´</th><th>å…¸å‹å‚æ•°</th><th>ä½•æ—¶åŠ è½½</th></tr></thead><tbody><tr><td><strong>rabbitmq-env.conf</strong></td><td>è®¾ç½® RabbitMQ å¯åŠ¨æ—¶çš„ <strong>ç¯å¢ƒå˜é‡</strong></td><td>NODENAME, NODE_IP_ADDRESS, NODE_PORT, LOG_BASE, MNESIA_BASE</td><td>åœ¨å¯åŠ¨ RabbitMQ æœåŠ¡å‰ç”± <code>rabbitmq-env</code> è„šæœ¬è¯»å–</td></tr><tr><td><strong>rabbitmq.conf</strong></td><td>RabbitMQ <strong>è¿è¡Œæ—¶é…ç½®</strong>ï¼ˆå†…éƒ¨å‚æ•°ã€æ’ä»¶é…ç½®ç­‰ï¼‰</td><td>listeners.tcp.default, log, cluster_formation ç­‰</td><td>RabbitMQ å¯åŠ¨åç”± Erlang VM å†…éƒ¨è¯»å–</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-4"><p><code>rabbitmq-env.conf</code> å†³å®š RabbitMQ å¯åŠ¨æ—¶çš„åŸºæœ¬ç¯å¢ƒï¼Œæ¯”å¦‚èŠ‚ç‚¹åã€æ•°æ®ç›®å½•ã€ç›‘å¬ IP ç­‰ï¼Œå¿…é¡»åœ¨å¯åŠ¨å‰å°±ç¡®å®šã€‚</p></li><li class="lvl-4"><p><code>rabbitmq.conf</code> å†³å®šè¿è¡Œæ—¶çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç«¯å£ç›‘å¬ã€æ—¥å¿—ç­‰çº§ã€é›†ç¾¤é…ç½®ç­‰ï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œé‡å¯åº”ç”¨åç”Ÿæ•ˆã€‚</p></li></ul><table><thead><tr><th><code>rabbitmq-env.conf</code> å˜é‡</th><th><code>rabbitmq.conf</code> å¯¹åº”é…ç½®</th><th>ä¼˜å…ˆçº§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>NODE_IP_ADDRESS</td><td><code>listeners.tcp.default = &lt;IP&gt;</code></td><td><code>rabbitmq.conf</code></td><td>åªè¦åœ¨ <code>rabbitmq.conf</code> é‡Œé…ç½®ï¼Œå°±è¦†ç›–ç¯å¢ƒå˜é‡</td></tr><tr><td>NODE_PORT</td><td><code>listeners.tcp.default = &lt;Port&gt;</code></td><td><code>rabbitmq.conf</code></td><td>åŒä¸Šï¼ŒIP å’Œç«¯å£å¯ä»¥ä¸€èµ·é…ç½®</td></tr><tr><td>NODENAME</td><td><strong>æ— ç›´æ¥å¯¹åº”</strong></td><td><code>rabbitmq-env.conf</code></td><td>èŠ‚ç‚¹ååªèƒ½é€šè¿‡ <code>rabbitmq-env.conf</code> æˆ–ç¯å¢ƒå˜é‡è®¾å®š</td></tr><tr><td>MNESIA_BASE</td><td><strong>æ— ç›´æ¥å¯¹åº”</strong></td><td><code>rabbitmq-env.conf</code></td><td>æ•°æ®ç›®å½•åªèƒ½åœ¨å¯åŠ¨å‰è®¾å®š</td></tr><tr><td>LOG_BASE</td><td><code>log.dir = &lt;path&gt;</code></td><td><code>rabbitmq.conf</code></td><td>è¿è¡Œæ—¶é…ç½®è¦†ç›–ç¯å¢ƒå˜é‡</td></tr><tr><td>CONFIG_FILE</td><td><strong>æ— ç›´æ¥å¯¹åº”</strong></td><td><code>rabbitmq-env.conf</code></td><td>è¿™ä¸ªåªå†³å®šåŠ è½½å“ªä¸ª <code>rabbitmq.conf</code> æ–‡ä»¶</td></tr><tr><td>USE_LONGNAME</td><td><strong>æ— ç›´æ¥å¯¹åº”</strong></td><td><code>rabbitmq-env.conf</code></td><td>èŠ‚ç‚¹åæ˜¯å¦ä½¿ç”¨é•¿ä¸»æœºååªèƒ½å¯åŠ¨å‰å†³å®š</td></tr></tbody></table><h2 id="RabbitMQ-ç¯å¢ƒå˜é‡">RabbitMQ ç¯å¢ƒå˜é‡</h2><ul class="lvl-0"><li class="lvl-2"><p><code>rabbitmq-env.conf</code> æ–‡ä»¶å°±æ˜¯ç”¨æ¥å®šä¹‰ç¯å¢ƒå˜é‡çš„ï¼Œä½†è¦æ³¨æ„ï¼Œ<code>rabbitmq-env.conf</code> æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ å»æ‰äº† <code>RABBITMQ_</code> å‰ç¼€ï¼Œä¾‹å¦‚åœ¨ç¯å¢ƒä¸­è®¾ç½®çš„å˜é‡åé€šå¸¸æ˜¯ <code>RABBITMQ_NODENAME</code>ï¼Œä½†åœ¨ <code>rabbitmq-env.conf</code> ä¸­ï¼Œè®¾ç½®å˜é‡æ—¶ä¼šå»æ‰ <code>RABBITMQ_</code> å‰ç¼€ï¼Œç›´æ¥ä½¿ç”¨ <code>NODENAME</code>ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ rabbitmq-env.conf ä¸­é…ç½®</span></span><br><span class="line">NODENAME=rabbit@localhost</span><br><span class="line">NODE_PORT=5672</span><br><span class="line">LOG_BASE=/var/log/rabbitmq</span><br><span class="line"></span><br><span class="line"><span class="comment"># è€Œåœ¨ç¯å¢ƒä¸­ï¼Œä½ å®é™…è®¾ç½®çš„å˜é‡æ˜¯</span></span><br><span class="line"><span class="built_in">export</span> RABBITMQ_NODENAME=rabbit@localhost</span><br><span class="line"><span class="built_in">export</span> RABBITMQ_NODE_PORT=5672</span><br><span class="line"><span class="built_in">export</span> RABBITMQ_LOG_BASE=/var/log/rabbitmq</span><br></pre></td></tr></table></figure><table><thead><tr><th>ç¯å¢ƒå˜é‡åç§°</th><th>æè¿°</th><th>Linux RPM å®‰è£…çš„é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><strong>RABBITMQ_BASE</strong></td><td>åªé’ˆå¯¹ Windows ç³»ç»Ÿã€‚è¯¥åŸºç›®å½•åŒ…å« RabbitMQ æœåŠ¡å™¨çš„æ•°æ®åº“å’Œæ—¥å¿—æ–‡ä»¶çš„å­ç›®å½•ã€‚</td><td>æ— ï¼ˆä»…é€‚ç”¨äº Windowsï¼‰</td></tr><tr><td><strong>RABBITMQ_CONFIG_FILE</strong></td><td>é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œæ²¡æœ‰ <code>.config</code> æ‰©å±•åã€‚RabbitMQ æœåŠ¡å™¨ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶æ¥é…ç½®ç»„ä»¶ã€‚</td><td>é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ï¼š<code>/etc/rabbitmq/rabbitmq.conf</code></td></tr><tr><td><strong>RABBITMQ_GENERATED_CONFIG_DIR</strong></td><td>RabbitMQ å†™å…¥å…¶ç”Ÿæˆçš„é…ç½®æ–‡ä»¶çš„ç›®å½•ã€‚</td><td>é»˜è®¤ç”Ÿæˆè·¯å¾„ï¼š<code>/var/lib/rabbitmq/mnesia</code></td></tr><tr><td><strong>RABBITMQ_MNESIA_BASE</strong></td><td>RabbitMQ æœåŠ¡å™¨èŠ‚ç‚¹æ•°æ®åº“ã€æ¶ˆæ¯å­˜å‚¨å’Œé›†ç¾¤çŠ¶æ€æ–‡ä»¶çš„åŸºç›®å½•ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªã€‚é€šå¸¸ä¼šè¦†ç›– <code>RABBITMQ_MNESIA_DIR</code>ã€‚</td><td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/mnesia</code></td></tr><tr><td><strong>RABBITMQ_MNESIA_DIR</strong></td><td>å­˜å‚¨ RabbitMQ èŠ‚ç‚¹æ•°æ®çš„ç›®å½•ï¼ŒåŒ…å«æ¨¡å¼æ•°æ®åº“ã€æ¶ˆæ¯å­˜å‚¨ã€é›†ç¾¤æˆå‘˜ä¿¡æ¯å’Œå…¶ä»–æŒä¹…èŠ‚ç‚¹çŠ¶æ€ã€‚</td><td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/mnesia/rabbit@&lt;hostname&gt;</code></td></tr><tr><td><strong>RABBITMQ_SCHEMA_DIR</strong></td><td>RabbitMQ ä¿å­˜æ–°æ ¼å¼é…ç½®æ–‡ä»¶ä½¿ç”¨çš„é…ç½®æ¨¡å¼çš„ç›®å½•ã€‚</td><td>é»˜è®¤å€¼ï¼š<code>/etc/rabbitmq</code></td></tr><tr><td><strong>RABBITMQ_LOG_BASE</strong></td><td>è¯¥åŸºç›®å½•åŒ…å« RabbitMQ æœåŠ¡å™¨çš„æ—¥å¿—æ–‡ä»¶ã€‚</td><td>é»˜è®¤å€¼ï¼š<code>/var/log/rabbitmq</code></td></tr><tr><td><strong>RABBITMQ_LOGS</strong></td><td>RabbitMQ æœåŠ¡å™¨çš„ Erlang æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚</td><td>é»˜è®¤å€¼ï¼š<code>/var/log/rabbitmq/rabbitmq.log</code></td></tr><tr><td><strong>RABBITMQ_PLUGINS_DIR</strong></td><td>RabbitMQ çš„æ’ä»¶ç›®å½•ã€‚è·¯å¾„ç”±ç‰¹å®šæ“ä½œç³»ç»Ÿçš„åˆ†éš”ç¬¦å®šä¹‰ï¼ˆUnix ä½¿ç”¨ <code>:</code>ï¼ŒWindows ä½¿ç”¨ <code>;</code>ï¼‰ã€‚</td><td>é»˜è®¤å€¼ï¼š<code>/usr/lib/rabbitmq/plugins</code></td></tr><tr><td><strong>RABBITMQ_PLUGINS_EXPAND_DIR</strong></td><td>ç”¨äºå±•å¼€å¯ç”¨çš„æ’ä»¶çš„å·¥ä½œç›®å½•ã€‚ç¡®ä¿æœ‰æ•ˆçš„ RabbitMQ ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™è¯»å–å’Œåˆ›å»ºè¯¥ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚</td><td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/mnesia</code></td></tr><tr><td><strong>RABBITMQ_ENABLED_PLUGINS_FILE</strong></td><td>æ˜¾å¼è®°å½•å¯ç”¨çš„æ’ä»¶çš„æ–‡ä»¶ï¼Œå¯ç”¨æˆ–ç¦ç”¨æ’ä»¶æ—¶ä¼šé‡æ–°åˆ›å»ºè¯¥æ–‡ä»¶ã€‚ç¡®ä¿æœ‰æ•ˆçš„ RabbitMQ ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™éšæ—¶è¯»å–ã€å†™å…¥å’Œåˆ›å»ºè¯¥æ–‡ä»¶ã€‚</td><td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/.enabled_plugins</code></td></tr><tr><td><strong>RABBITMQ_PID_FILE</strong></td><td>ç”¨äº <code>rabbitmqctl</code> çš„è¿›ç¨‹ ID æ–‡ä»¶ã€‚</td><td>é»˜è®¤å€¼ï¼š<code>/var/run/rabbitmq/rabbitmq.pid</code></td></tr></tbody></table><div class="warning"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">å®‰è£…å¥½ RabbitMQ åï¼Œä¸è¦éšä¾¿ä¿®æ”¹ <code>hostname</code>ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQ çš„æ•°æ®ç›®å½•æ˜¯åŸºäº <code>hostname</code> åˆ›å»ºçš„ï¼Œå¦‚æœä¿®æ”¹äº† <code>hostname</code>ï¼ŒRabbitMQ å°±ä¼šæŒ‡å‘æ–°çš„æ•°æ®ç›®å½•</li><li class="lvl-2">æ•°æ®ç›®å½•é»˜è®¤æ˜¯ <code>/var/lib/rabbitmq/mnesia/rabbit@&lt;hostname&gt;</code></li><li class="lvl-2">å¦‚æœä¿®æ”¹äº† <code>hostname</code>ï¼Œä½†ä»è¦ä½¿ç”¨åŸæ¥çš„æ•°æ®ç›®å½•ï¼Œå¯ä»¥è®¾ç½® <code>RABBITMQ_MNESIA_DIR</code> ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å‘åŸæ¥çš„æ•°æ®ç›®å½•</li></ul></div><h2 id="RabbitMQ-ç›¸å…³å‘½ä»¤">RabbitMQ ç›¸å…³å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p>æ—¥å¸¸ä½¿ç”¨ä¸­ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ Web ç®¡ç†ç•Œé¢æ“ä½œï¼Œè¿™é‡Œä»…å¯¹å‘½ä»¤è¿›è¡Œç®€è¦ä»‹ç»ã€‚</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨ï¼ˆç®€è¦ï¼‰</th><th>å¸¸ç”¨ç¤ºä¾‹ï¼ˆå…¸å‹ç”¨æ³• + ä¸­æ–‡è¯´æ˜ï¼‰</th></tr></thead><tbody><tr><td><code>rabbitmq-defaults</code></td><td>å®šä¹‰/æ˜¾ç¤º RabbitMQ å®‰è£…é»˜è®¤ç›®å½•å’Œè¿è¡Œæ—¶å‰ç¼€</td><td><code>ç¼–è¾‘ sbin/rabbitmq-defaults ä¸­ PREFIX/SYS_PREFIX</code>ï¼ˆä¿®æ”¹é»˜è®¤ç›®å½•åˆ°ç³»ç»Ÿç›®å½•ï¼‰</td></tr><tr><td><code>rabbitmq-diagnostics</code></td><td>å¥åº·æ£€æŸ¥ / è¯Šæ–­å·¥å…·ï¼Œå¯ç”¨äºç›‘æ§</td><td><code>rabbitmq-diagnostics -q ping</code>ï¼ˆæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ï¼‰<br><code>rabbitmq-diagnostics -q status</code>ï¼ˆæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼‰<br><code>rabbitmq-diagnostics -q check_running</code>ï¼ˆç¡®è®¤èŠ‚ç‚¹è¿è¡Œä¸­ï¼‰</td></tr><tr><td><code>rabbitmq-env</code></td><td><code>rabbitmq-env</code> å…¶å®ä¸æ˜¯ä¸€ä¸ªç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œå•ç‹¬ä½¿ç”¨çš„å·¥å…·ï¼Œè€Œæ˜¯ RabbitMQ æœåŠ¡å¯åŠ¨è„šæœ¬ ä¸­ç”¨æ¥åŠ è½½ RabbitMQ ç¯å¢ƒå˜é‡çš„è„šæœ¬ã€‚</td><td>åœ¨ <code>/etc/rabbitmq/rabbitmq-env.conf</code> ä¸­è®¾ç½®ï¼š<br><code>RABBITMQ_NODENAME=myrabbit</code>ï¼ˆè®¾ç½®èŠ‚ç‚¹åï¼‰<br>æˆ–ç”¨ <code>rabbitmq-env</code> è¾“å‡ºæŸ¥çœ‹å®é™…ç¯å¢ƒ</td></tr><tr><td><code>rabbitmq-plugins</code></td><td>æ’ä»¶ç®¡ç†ï¼šåˆ—å‡º/å¯ç”¨/ç¦ç”¨æ’ä»¶</td><td><code>rabbitmq-plugins list</code>ï¼ˆåˆ—å‡ºæ‰€æœ‰æ’ä»¶ï¼‰<br><code>rabbitmq-plugins enable rabbitmq_management</code>ï¼ˆå¯ç”¨ Web ç®¡ç†æ’ä»¶ï¼‰<br><code>rabbitmq-plugins disable --offline plugin</code>ï¼ˆç¦»çº¿ç¦ç”¨æ’ä»¶ï¼‰</td></tr><tr><td><code>rabbitmq-queues</code></td><td>é˜Ÿåˆ—å‰¯æœ¬ç®¡ç†ï¼šrebalance/grow/shrink</td><td><code>rabbitmq-queues rebalance all --vhost-pattern &quot;.*&quot; --queue-pattern &quot;.*&quot;</code>ï¼ˆé‡å¹³è¡¡æ‰€æœ‰é˜Ÿåˆ—å‰¯æœ¬ï¼‰<br><code>rabbitmq-queues add_member --vhost / qname rabbit@node</code>ï¼ˆä¸ºé˜Ÿåˆ—å¢åŠ èŠ‚ç‚¹å‰¯æœ¬ï¼‰</td></tr><tr><td><code>rabbitmq-server</code></td><td>å¯åŠ¨ RabbitMQ èŠ‚ç‚¹ï¼ˆå‰å°/åå°ï¼‰</td><td><code>rabbitmq-server</code>ï¼ˆå‰å°å¯åŠ¨ï¼‰<br><code>rabbitmq-server -detached</code>ï¼ˆåå°å¯åŠ¨ï¼‰</td></tr><tr><td><code>rabbitmq-upgrade</code></td><td>å‡çº§ç›¸å…³æ“ä½œï¼šdrain/æ¢å¤ç­‰</td><td><code>rabbitmq-upgrade drain</code>ï¼ˆè®©èŠ‚ç‚¹è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œåœæ­¢æ¥æ”¶æ–°è¿æ¥ï¼‰<br><code>rabbitmq-upgrade post_upgrade</code>ï¼ˆæ‰§è¡Œå‡çº§åæ”¶å°¾æ“ä½œï¼‰<br><code>rabbitmq-upgrade revive</code>ï¼ˆæ¢å¤ç»´æŠ¤æ¨¡å¼ä¸­çš„èŠ‚ç‚¹ï¼‰</td></tr><tr><td><code>rabbitmqctl</code></td><td>æœ€å¸¸ç”¨ç®¡ç†å‘½ä»¤ï¼šç”¨æˆ·ã€é˜Ÿåˆ—ã€é›†ç¾¤ç®¡ç†</td><td><code>rabbitmqctl status</code>ï¼ˆæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼‰<br><code>rabbitmqctl list_queues</code>ï¼ˆåˆ—å‡ºæ‰€æœ‰é˜Ÿåˆ—ï¼‰<br><code>rabbitmqctl add_user bob s3cr3t</code>ï¼ˆæ·»åŠ ç”¨æˆ· bobï¼Œå¯†ç  s3cr3tï¼‰</td></tr><tr><td><code>rabbitmq-streams</code></td><td>ç®¡ç† Streamsï¼ˆæµå¼é˜Ÿåˆ—ï¼‰</td><td><code>rabbitmq-streams stream_status --vhost / my-stream</code>ï¼ˆæŸ¥çœ‹ my-stream çŠ¶æ€ï¼‰<br><code>rabbitmq-streams add_replica --vhost / my-stream rabbit@node</code>ï¼ˆä¸º my-stream å¢åŠ å‰¯æœ¬èŠ‚ç‚¹ï¼‰</td></tr></tbody></table><h3 id="æœ€å¸¸ç”¨çš„å‘½ä»¤-rabbitmqctl">æœ€å¸¸ç”¨çš„å‘½ä»¤ <code>rabbitmqctl</code></h3><h4 id="å‘½ä»¤è‡ªåŠ¨è¡¥å…¨">å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</h4><ul class="lvl-0"><li class="lvl-2"><p><code>rabbitmqctl</code> æœ‰ä¸€ä¸ª <code>autocomplete</code> å‚æ•°ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆå‘½ä»¤å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‘½ä»¤æ¥å®ç°å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</p></li><li class="lvl-2"><p><code>vim ~/.bashrc</code> æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">_rabbitmqctl_completion</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> cur opts</span><br><span class="line">    cur=<span class="string">&quot;<span class="variable">$&#123;COMP_WORDS[COMP_CWORD]&#125;</span>&quot;</span>           <span class="comment"># å½“å‰å…‰æ ‡æ‰€åœ¨å•è¯</span></span><br><span class="line">    opts=$(rabbitmqctl autocomplete <span class="string">&quot;<span class="variable">$cur</span>&quot;</span>)   <span class="comment"># åªä¼ å½“å‰å•è¯ä½œä¸ºå‰ç¼€</span></span><br><span class="line">    COMPREPLY=( $(compgen -W <span class="string">&quot;<span class="variable">$&#123;opts&#125;</span>&quot;</span> -- <span class="string">&quot;<span class="variable">$cur</span>&quot;</span>) )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">complete -F _rabbitmqctl_completion rabbitmqctl</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®é™…ä¸Š RabbitMQ çš„å¤§éƒ¨åˆ†å‘½ä»¤éƒ½æœ‰ <code>autocomplete</code> å‚æ•°ï¼Œéƒ½å¯ä»¥è‡ªåŠ¨å®Œæˆå‘½ä»¤å‚æ•°</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰é€šç”¨è¡¥å…¨å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="title">_rabbitmq_completion</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> cur opts</span><br><span class="line">    cur=<span class="string">&quot;<span class="variable">$&#123;COMP_WORDS[COMP_CWORD]&#125;</span>&quot;</span></span><br><span class="line">    <span class="comment"># å½“å‰å‘½ä»¤åï¼Œè‡ªåŠ¨åˆ¤æ–­</span></span><br><span class="line">    <span class="built_in">local</span> cmd=<span class="string">&quot;<span class="variable">$&#123;COMP_WORDS[0]&#125;</span>&quot;</span></span><br><span class="line">    <span class="comment"># ç»™å¯¹åº”å‘½ä»¤ä¼ å½“å‰å‰ç¼€</span></span><br><span class="line">    opts=$(<span class="variable">$cmd</span> autocomplete <span class="string">&quot;<span class="variable">$cur</span>&quot;</span> 2&gt;/dev/null)</span><br><span class="line">    COMPREPLY=( $(compgen -W <span class="string">&quot;<span class="variable">$&#123;opts&#125;</span>&quot;</span> -- <span class="string">&quot;<span class="variable">$cur</span>&quot;</span>) )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€æ¬¡æ€§ç»‘å®šå¤šä¸ªå‘½ä»¤</span></span><br><span class="line">complete -F _rabbitmq_completion rabbitmqctl rabbitmq-plugins rabbitmq-diagnostics rabbitmq-queues rabbitmq-upgrade</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµ‹è¯•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿è¡¥å…¨ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="comment"># tab è¡¥å…¨</span></span><br><span class="line">rabbitmqctl st&lt;TAB&gt;</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">start_app  status     stop       stop_app</span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨å‘½ä»¤å‚æ•°">å¸¸ç”¨å‘½ä»¤å‚æ•°</h4><ul class="lvl-0"><li class="lvl-2"><p><code>rabbitmqctl help</code> è·å–æ‰€æœ‰å‘½ä»¤å‚æ•°çš„ç®€ä»‹</p></li><li class="lvl-2"><p><code>rabbitmqctl help &lt;command&gt;</code> è·å–æŒ‡å®šå‘½ä»¤çš„å¸®åŠ©</p></li><li class="lvl-2"><p>æ—¥å¸¸ä½¿ç”¨ä¸­åŸºæœ¬éƒ½æ˜¯é€šè¿‡ <code>web æ§åˆ¶å°</code> å®Œæˆï¼Œè¿™é‡Œåªåšäº†è§£ã€‚</p></li></ul><h5 id="1-èŠ‚ç‚¹ç®¡ç†">1.èŠ‚ç‚¹ç®¡ç†</h5><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>status</code></td><td>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼ŒåŒ…æ‹¬è¿è¡ŒçŠ¶æ€ã€ç‰ˆæœ¬ã€å†…å­˜ã€é˜Ÿåˆ—æ•°é‡ç­‰</td><td><code>rabbitmqctl status</code></td></tr><tr><td><code>stop</code></td><td>åœæ­¢ RabbitMQ èŠ‚ç‚¹</td><td><code>rabbitmqctl stop</code></td></tr><tr><td><code>stop_app</code></td><td>åœæ­¢ RabbitMQ åº”ç”¨ï¼ˆä¿ç•™èŠ‚ç‚¹è¿è¡Œï¼‰</td><td><code>rabbitmqctl stop_app</code></td></tr><tr><td><code>start_app</code></td><td>å¯åŠ¨ RabbitMQ åº”ç”¨</td><td><code>rabbitmqctl start_app</code></td></tr><tr><td><code>reset</code></td><td>é‡ç½® RabbitMQ èŠ‚ç‚¹ï¼Œåˆ é™¤æ‰€æœ‰é˜Ÿåˆ—å’Œæ•°æ®ï¼ˆæ…ç”¨ï¼‰</td><td><code>rabbitmqctl reset</code></td></tr><tr><td><code>force_reset</code></td><td>å¼ºåˆ¶é‡ç½®èŠ‚ç‚¹ï¼ˆå³ä½¿åœ¨é›†ç¾¤ä¸­ä¹Ÿä¼šé‡ç½®ï¼‰</td><td><code>rabbitmqctl force_reset</code></td></tr></tbody></table><h5 id="2-ç”¨æˆ·å’Œæƒé™ç®¡ç†">2. ç”¨æˆ·å’Œæƒé™ç®¡ç†</h5><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>list_users</code></td><td>åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·</td><td><code>rabbitmqctl list_users</code></td></tr><tr><td><code>add_user &lt;user&gt; &lt;password&gt;</code></td><td>æ·»åŠ æ–°ç”¨æˆ·</td><td><code>rabbitmqctl add_user alice mypassword</code></td></tr><tr><td><code>delete_user &lt;user&gt;</code></td><td>åˆ é™¤ç”¨æˆ·</td><td><code>rabbitmqctl delete_user alice</code></td></tr><tr><td><code>change_password &lt;user&gt; &lt;password&gt;</code></td><td>ä¿®æ”¹ç”¨æˆ·å¯†ç </td><td><code>rabbitmqctl change_password alice newpass</code></td></tr><tr><td><code>list_permissions &lt;user&gt;</code></td><td>æŸ¥çœ‹æŸç”¨æˆ·çš„æƒé™</td><td><code>rabbitmqctl list_permissions alice</code></td></tr><tr><td><code>set_permissions -p &lt;vhost&gt; &lt;user&gt; &quot;&lt;conf&gt;&quot; &quot;&lt;write&gt;&quot; &quot;&lt;read&gt;&quot;</code></td><td>è®¾ç½®ç”¨æˆ·åœ¨è™šæ‹Ÿä¸»æœºçš„æƒé™</td><td><code>rabbitmqctl set_permissions -p / alice &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code></td></tr></tbody></table><h5 id="3-è™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ç®¡ç†">3. è™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ç®¡ç†</h5><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>list_vhosts</code></td><td>åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿä¸»æœº</td><td><code>rabbitmqctl list_vhosts</code></td></tr><tr><td><code>add_vhost &lt;vhost&gt;</code></td><td>æ·»åŠ è™šæ‹Ÿä¸»æœº</td><td><code>rabbitmqctl add_vhost my_vhost</code></td></tr><tr><td><code>delete_vhost &lt;vhost&gt;</code></td><td>åˆ é™¤è™šæ‹Ÿä¸»æœº</td><td><code>rabbitmqctl delete_vhost my_vhost</code></td></tr></tbody></table><h5 id="4-é˜Ÿåˆ—ç®¡ç†">4. é˜Ÿåˆ—ç®¡ç†</h5><ul class="lvl-0"><li class="lvl-2"><p>é˜Ÿåˆ—å¯ä»¥é€šè¿‡ <code>web æ§åˆ¶å°</code> åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ <code>å®¢æˆ·ç«¯(æ¯”å¦‚Java)</code> åˆ›å»ºï¼Œ<code>rabbitmqctl</code> åªèƒ½æŸ¥çœ‹å’Œåˆ é™¤é˜Ÿåˆ—</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>list_queues</code></td><td>åˆ—å‡ºé˜Ÿåˆ—</td><td><code>rabbitmqctl list_queues</code></td></tr><tr><td><code>list_queues name messages consumers</code></td><td>åˆ—å‡ºé˜Ÿåˆ—åŠæ¶ˆæ¯æ•°ã€æ¶ˆè´¹è€…æ•°</td><td><code>rabbitmqctl list_queues name messages consumers</code></td></tr><tr><td><code>purge_queue &lt;queue&gt;</code></td><td>æ¸…ç©ºé˜Ÿåˆ—æ¶ˆæ¯</td><td><code>rabbitmqctl purge_queue my_queue</code></td></tr><tr><td><code>delete_queue &lt;queue&gt;</code></td><td>åˆ é™¤é˜Ÿåˆ—</td><td><code>rabbitmqctl delete_queue my_queue</code></td></tr></tbody></table><h5 id="5-äº¤æ¢æœºå’Œç»‘å®š">5. äº¤æ¢æœºå’Œç»‘å®š</h5><ul class="lvl-0"><li class="lvl-2"><p>äº¤æ¢æœºå¯ä»¥é€šè¿‡ <code>web æ§åˆ¶å°</code> åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ <code>å®¢æˆ·ç«¯(æ¯”å¦‚Java)</code> åˆ›å»ºï¼Œ<code>rabbitmqctl</code> åªèƒ½æŸ¥çœ‹</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>list_exchanges</code></td><td>åˆ—å‡ºäº¤æ¢æœº</td><td><code>rabbitmqctl list_exchanges</code></td></tr><tr><td><code>list_bindings</code></td><td>åˆ—å‡ºç»‘å®šå…³ç³»</td><td><code>rabbitmqctl list_bindings</code></td></tr></tbody></table><h5 id="6-é›†ç¾¤ç®¡ç†">6. é›†ç¾¤ç®¡ç†</h5><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>cluster_status</code></td><td>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</td><td><code>rabbitmqctl cluster_status</code></td></tr><tr><td><code>join_cluster &lt;node&gt;</code></td><td>èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</td><td><code>rabbitmqctl join_cluster rabbit@node1</code></td></tr><tr><td><code>forget_cluster_node &lt;node&gt;</code></td><td>å°†èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤</td><td><code>rabbitmqctl forget_cluster_node rabbit@node2</code></td></tr></tbody></table><h5 id="7-æ—¥å¿—å’Œè°ƒè¯•">7. æ—¥å¿—å’Œè°ƒè¯•</h5><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>report</code></td><td>è¾“å‡ºèŠ‚ç‚¹è¯Šæ–­æŠ¥å‘Š</td><td><code>rabbitmqctl report</code></td></tr><tr><td><code>eval &lt;expression&gt;</code></td><td>æ‰§è¡Œ Erlang è¡¨è¾¾å¼</td><td><code>rabbitmqctl eval 'rabbit_mnesia:info().'</code></td></tr></tbody></table><h5 id="8-å…¶ä»–å‘½ä»¤">8. å…¶ä»–å‘½ä»¤</h5><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>help</code></td><td>æŸ¥çœ‹å¸®åŠ©å‘½ä»¤</td><td><code>rabbitmqctl help</code></td></tr><tr><td><code>version</code></td><td>æŸ¥çœ‹ RabbitMQ ç‰ˆæœ¬</td><td><code>rabbitmqctl version</code></td></tr><tr><td><code>authenticate_user &lt;user&gt; &lt;password&gt;</code></td><td>éªŒè¯ç”¨æˆ·å¯†ç </td><td><code>rabbitmqctl authenticate_user alice mypassword</code></td></tr></tbody></table><h2 id="RabbitMQ-HTTP-API">RabbitMQ HTTP API</h2><ul class="lvl-0"><li class="lvl-2"><p>RabbitMQ çš„ HTTP API æ˜¯ä¸€ä¸ª åŸºäº REST çš„ç®¡ç†æ¥å£ï¼Œä¸»è¦ç”¨äºå¯¹ RabbitMQ çš„ èµ„æºç®¡ç†å’Œç›‘æ§ï¼Œå®ƒæ˜¯ ç®¡ç†æ’ä»¶ <code>rabbitmq_management</code> æä¾›çš„åŠŸèƒ½ã€‚é€šè¿‡ HTTP APIï¼Œä½ å¯ä»¥ä¸ç”¨ <code>rabbitmqctl</code> å°±èƒ½æ“ä½œ RabbitMQã€‚</p></li><li class="lvl-2"><p>è¦ä½¿ç”¨ HTTP APIï¼Œä½ éœ€è¦åœ¨ RabbitMQ èŠ‚ç‚¹ä¸Šç¡®ä¿ <code>rabbitmq_management</code> æ’ä»¶å·²ç»å¯åŠ¨ã€‚å‰é¢æˆ‘ä»¬ä»‹ç»<code>web ç®¡ç†æ§åˆ¶å°</code>æ—¶å·²ç»å¯åŠ¨äº†è¯¥æ’ä»¶ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p>å®é™…ä¸Š <code>Webç®¡ç†æ§åˆ¶å°</code> å°±æ˜¯é€šè¿‡å‘é€ AJAX è¯·æ±‚åˆ° <code>/api/â€¦</code> æ¥å£æ¥è·å–æ•°æ®å’Œæ‰§è¡Œæ“ä½œã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/980Wwu.png" alt=""></p></li><li class="lvl-2"><p>è¿™é‡Œæœ‰ HTTP API çš„è¯¦ç»†è¯´æ˜ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚</p></li></ul><h2 id="rabbitmqadmin">rabbitmqadmin</h2><ul class="lvl-0"><li class="lvl-2"><p><code>rabbitmqadmin</code> æ˜¯ ç®¡ç†æ’ä»¶ <code>rabbitmq_management</code> æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† RabbitMQ çš„èµ„æºï¼Œå¦‚åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»ã€æŸ¥çœ‹é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»ç­‰ã€‚</p></li><li class="lvl-2"><p><code>rabbitmqadmin</code> æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>HTTP API</code> çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ‰€ä»¥åº•å±‚å®é™…ä¸Šæ˜¯è°ƒç”¨äº† <code>HTTP API</code> ã€‚</p></li><li class="lvl-2"><p><a href="https://github.com/rabbitmq/rabbitmqadmin-ng/releases">ä¸‹è½½åœ°å€</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½</span></span><br><span class="line"><span class="built_in">sudo</span> wget -O /usr/local/bin/rabbitmqadmin https://github.com/rabbitmq/rabbitmqadmin-ng/releases/download/v2.10.0/rabbitmqadmin-2.10.0-x86_64-unknown-linux-gnu</span><br><span class="line"><span class="comment"># è®¾ç½®æƒé™</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /usr/local/bin/rabbitmqadmin</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line">rabbitmqadmin <span class="built_in">help</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å­å‘½ä»¤å¸®åŠ©</span></span><br><span class="line">rabbitmqadmin <span class="built_in">help</span> &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"><span class="comment">## ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ é˜Ÿåˆ— å¸®åŠ©</span></span><br><span class="line">rabbitmqadmin <span class="built_in">help</span> queues</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ é˜Ÿåˆ—å£°æ˜ å¸®åŠ©ï¼Œå­å­å‘½ä»¤</span></span><br><span class="line">rabbitmqadmin <span class="built_in">help</span> queues <span class="built_in">declare</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>rabbitmqadmin</code> çš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯å› ä¸º<code>HTTP API</code>æ•…æ„æ²¡æœ‰å…¬å¼€æŸäº›æ“ä½œï¼Œæ‰€ä»¥å…¶ä¸èƒ½æ›¿ä»£ <code>rabbitmqctl</code> æˆ– <code>rabbitmq-plugins</code>ç­‰å‘½ä»¤ã€‚</p></li><li class="lvl-2"><p>å› ä¸ºå®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œï¼Œæ‰€ä»¥è¿™é‡Œåªåšç®€å•ä»‹ç»ã€‚ä¸Šæ–‡æåˆ°äº† <code>rabbitmqctl</code> ä¸æ”¯æŒå£°æ˜(åˆ›å»º) äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼Œè¿™ä¸ªé€šè¿‡ <code>rabbitmqadmin</code> å®ç°</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè™šæ‹Ÿä¸»æœº</span></span><br><span class="line">rabbitmqadmin vhosts <span class="built_in">declare</span> --name <span class="string">&quot;my-vhost&quot;</span> --default-queue-type <span class="string">&quot;quorum&quot;</span> --description <span class="string">&quot;Used to test&quot;</span></span><br><span class="line"><span class="comment"># å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">rabbitmqadmin queues <span class="built_in">declare</span> --vhost <span class="string">&quot;my-vhost&quot;</span> --name <span class="string">&quot;target.classic.queue.name&quot;</span> --<span class="built_in">type</span> <span class="string">&quot;classic&quot;</span> --durable <span class="literal">true</span> --auto-delete <span class="literal">false</span></span><br><span class="line"><span class="comment"># å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">rabbitmqadmin exchanges <span class="built_in">declare</span> --vhost <span class="string">&quot;my-vhost&quot;</span> --name <span class="string">&quot;target.direct.exchange.name&quot;</span> --<span class="built_in">type</span> <span class="string">&quot;direct&quot;</span> --durable <span class="literal">true</span> --auto-delete <span class="literal">false</span></span><br><span class="line"><span class="comment"># ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line">rabbitmqadmin bindings <span class="built_in">declare</span> --vhost <span class="string">&quot;my-vhost&quot;</span> --<span class="built_in">source</span> <span class="string">&quot;target.direct.exchange.name&quot;</span> --destination <span class="string">&quot;target.classic.queue.name&quot;</span> --destination-type <span class="string">&quot;queue&quot;</span> --routing-key <span class="string">&quot;target.routing.key&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿˜æœ‰å°±æ˜¯å®šæœŸå¤‡ä»½ RabbitMQ çš„ç»“æ„æ•°æ®(ä¸åŒ…æ‹¬æ¶ˆæ¯)</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å‡º</span></span><br><span class="line">abbitmqadmin definitions <span class="built_in">export</span> --file backup.json</span><br><span class="line"><span class="comment"># å¯¼å…¥</span></span><br><span class="line">rabbitmqadmin definitions import --file backup.json</span><br></pre></td></tr></table></figure><h2 id="RabbitMQ-éœ€è¦å¼€æ”¾å“ªäº›ç«¯å£">RabbitMQ éœ€è¦å¼€æ”¾å“ªäº›ç«¯å£</h2><table><thead><tr><th>ç«¯å£å·</th><th>åè®®</th><th>ç”¨é€”è¯´æ˜</th><th>é»˜è®¤çŠ¶æ€</th><th>å®‰å…¨å»ºè®®</th></tr></thead><tbody><tr><td>5672</td><td>AMQP</td><td>ä¸»å®¢æˆ·ç«¯è¿æ¥ç«¯å£</td><td>å¼€æ”¾</td><td>å¿…é¡»å¼€æ”¾ï¼Œé™åˆ¶IP</td></tr><tr><td>5671</td><td>AMQP/SSL</td><td>TLSåŠ å¯†è¿æ¥ç«¯å£</td><td>å…³é—­</td><td>å¦‚ä½¿ç”¨TLSåˆ™å¼€æ”¾</td></tr><tr><td>15672</td><td>HTTP</td><td>ç®¡ç†ç•Œé¢ç«¯å£</td><td>å…³é—­</td><td>å»ºè®®å†…ç½‘è®¿é—®</td></tr><tr><td>15671</td><td>HTTPS</td><td>TLSç®¡ç†ç•Œé¢ç«¯å£</td><td>å…³é—­</td><td>å¦‚ä½¿ç”¨HTTPSåˆ™å¼€æ”¾</td></tr><tr><td>25672</td><td>Erlang Distribution</td><td>é›†ç¾¤èŠ‚ç‚¹é€šä¿¡</td><td>å¼€æ”¾</td><td>é›†ç¾¤å†…éƒ¨ä½¿ç”¨</td></tr><tr><td>35672-35682</td><td>Erlang Distribution</td><td>é›†ç¾¤èŠ‚ç‚¹å‘ç°</td><td>å¼€æ”¾</td><td>é›†ç¾¤å†…éƒ¨ä½¿ç”¨</td></tr><tr><td>5552</td><td>Stream Protocol</td><td>æµåè®®ç«¯å£,RabbitMQ 3.9+</td><td>å…³é—­</td><td>ä½¿ç”¨æµåŠŸèƒ½æ—¶å¼€æ”¾</td></tr><tr><td>5551</td><td>Stream Protocol/SSL</td><td>æµåè®®TLSç«¯å£,RabbitMQ 3.9+</td><td>å…³é—­</td><td>å¦‚ä½¿ç”¨TLSåˆ™å¼€æ”¾</td></tr><tr><td>61613</td><td>STOMP</td><td>STOMPåè®®æ”¯æŒç«¯å£</td><td>å…³é—­</td><td>å¦‚ä½¿ç”¨STOMPåè®®åˆ™å¼€æ”¾</td></tr><tr><td>61614</td><td>STOMP/SSL</td><td>STOMP TLSåŠ å¯†ç«¯å£</td><td>å…³é—­</td><td>å¦‚ä½¿ç”¨STOMP over TLSåˆ™å¼€æ”¾</td></tr><tr><td>1883</td><td>MQTT</td><td>MQTTåè®®æ”¯æŒç«¯å£</td><td>å…³é—­</td><td>å¦‚ä½¿ç”¨MQTTåè®®åˆ™å¼€æ”¾</td></tr><tr><td>8883</td><td>MQTT/SSL</td><td>MQTT TLSåŠ å¯†ç«¯å£</td><td>å…³é—­</td><td>å¦‚ä½¿ç”¨MQTT over TLSåˆ™å¼€æ”¾</td></tr><tr><td>15674</td><td>Web STOMP</td><td>WebSocket STOMPæ”¯æŒç«¯å£</td><td>å…³é—­</td><td>å¦‚ä½¿ç”¨Web STOMPåˆ™å¼€æ”¾</td></tr><tr><td>15675</td><td>Web MQTT</td><td>WebSocket MQTTæ”¯æŒç«¯å£</td><td>å…³é—­</td><td>å¦‚ä½¿ç”¨Web MQTTåˆ™å¼€æ”¾</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RabbitMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.rabbitmq.com&quot;&gt;Zookeeperå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo&quot;&gt;Java Client ç¤ºä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rabbitmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rabbitmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rabbitmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rabbitmq" scheme="https://blog.hanqunfeng.com/tags/rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>Zookeeper çš„å®‰è£…åŠä½¿ç”¨</title>
    <link href="https://blog.hanqunfeng.com/2025/09/15/zookeeper-study/"/>
    <id>https://blog.hanqunfeng.com/2025/09/15/zookeeper-study/</id>
    <published>2025-09-15T13:30:05.000Z</published>
    <updated>2025-10-11T06:39:24.904Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://zookeeper.apache.org">Zookeeperå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Zookeeper ç‰ˆæœ¬ä¸º 3.8.4ã€‚</p></li></ul><span id="more"></span><h2 id="Zookeeper-ç®€ä»‹">Zookeeper ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ZooKeeper æ˜¯ä¸€ä¸ªé›†ä¸­å¼æœåŠ¡ï¼Œç”¨äºï¼š</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>ZooKeeper å®˜æ–¹åŠŸèƒ½</th><th>ä¸»è¦èŠ‚ç‚¹ç±»å‹</th><th>å…·ä½“åœºæ™¯ç¤ºä¾‹</th></tr></thead><tbody><tr><td>é…ç½®ä¸­å¿ƒ (Config Center)</td><td>ç»´æŠ¤é…ç½®ä¿¡æ¯ (Configuration Management)</td><td>æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰</td><td>æŠŠæ•°æ®åº“è¿æ¥ä¿¡æ¯ã€ç³»ç»Ÿå‚æ•°ç­‰æ”¾åœ¨ ZooKeeper é‡Œï¼ŒåŠ¨æ€æ›´æ–°ï¼Œåƒ Apolloã€Spring Cloud Config ä¸€æ ·ã€‚</td></tr><tr><td>æ³¨å†Œä¸­å¿ƒ (Service Registry)</td><td>æä¾›å‘½åæœåŠ¡ (Naming Service)</td><td>ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEphemeralï¼‰</td><td>æœåŠ¡å®ä¾‹å¯åŠ¨æ—¶åœ¨ ZooKeeper é‡Œæ³¨å†Œè‡ªå·±çš„åœ°å€ï¼Œå®¢æˆ·ç«¯ä» ZooKeeper è·å–æœåŠ¡åˆ—è¡¨ï¼Œç±»ä¼¼äº Nacosã€Eurekaã€‚</td></tr><tr><td>åˆ†å¸ƒå¼é” (Distributed Lock)</td><td>åˆ†å¸ƒå¼åŒæ­¥ (Distributed Synchronization)</td><td>ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEphemeral Sequentialï¼‰</td><td>ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨æ‰§è¡Œå…³é”®ä»»åŠ¡ï¼Œå…¸å‹åº”ç”¨æ˜¯åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚</td></tr><tr><td>æ¶ˆæ¯é˜Ÿåˆ— (Message Queue)</td><td>é›†ç¾¤ç®¡ç†æœåŠ¡ (Cluster Management)</td><td>æŒä¹…/ä¸´æ—¶èŠ‚ç‚¹ + Watch æœºåˆ¶</td><td>é€šè¿‡ Watch æœºåˆ¶ç›‘å¬ ZNode å˜åŒ–ï¼ŒèŠ‚ç‚¹é—´ç”¨æ•°æ®å˜æ›´å½“â€œä¿¡å·â€ä¼ é€’æ¶ˆæ¯ï¼Œæ—©æœŸ Kafka ç”¨è¿‡è¿™ç§æ–¹å¼ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ª ZNodeã€‚</p></li><li class="lvl-2"><p>ä¸åŒäºæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä¿å­˜æ•°æ®ï¼Œæ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ 1MB çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬(version)ï¼Œç‰ˆæœ¬ä»0å¼€å§‹è®¡æ•°ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/QgdBSR.png" alt=""></p></li></ul><h2 id="Zookeeper-å®‰è£…">Zookeeper å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œ Zookeeper éœ€è¦å®‰è£… JDK1.8+ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ <a href="https://mirrors.tuna.tsinghua.edu.cn/Adoptium/">OpenJDK11</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /usr/local/jdk</span><br><span class="line"><span class="built_in">cd</span> /usr/local/jdk</span><br><span class="line"><span class="built_in">sudo</span> wget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s jdk-11.0.28+6 jdk11</span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">vim /etc/profile <span class="comment"># æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class="line">  <span class="built_in">export</span> JAVA_HOME=/usr/local/jdk/jdk11</span><br><span class="line">  <span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># æŸ¥çœ‹javaç‰ˆæœ¬</span></span><br><span class="line">java -version</span><br><span class="line">openjdk version <span class="string">&quot;11.0.28&quot;</span> 2025-07-15</span><br><span class="line">OpenJDK Runtime Environment Temurin-11.0.28+6 (build 11.0.28+6)</span><br><span class="line">OpenJDK 64-Bit Server VM Temurin-11.0.28+6 (build 11.0.28+6, mixed mode)</span><br></pre></td></tr></table></figure><h3 id="å•æœºå®‰è£…">å•æœºå®‰è£…</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://zookeeper.apache.org/releases.html">ä¸‹è½½ Zookeeper</a>ï¼Œç›®å‰æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ä¸º <code>3.8.4</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½</span></span><br><span class="line">wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz</span><br><span class="line"><span class="comment"># è§£å‹</span></span><br><span class="line">tar -zxvf apache-zookeeper-3.8.4-bin.tar.gz</span><br><span class="line"><span class="comment"># é…ç½®ä¸ªè½¯è¿æ¥ï¼Œæ–¹ä¾¿ä»¥åå‡çº§</span></span><br><span class="line"><span class="built_in">ln</span> -s apache-zookeeper-3.8.4-bin zookeeper</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> zookeeper/conf</span><br><span class="line"><span class="built_in">cp</span> zoo_sample.cfg zoo.cfg</span><br><span class="line"><span class="comment"># å»ºè®®ä¿®æ”¹ zoo.cfg é…ç½®æ–‡ä»¶ï¼Œå°† dataDir=/tmp/zookeeper ä¿®æ”¹ä¸ºæŒ‡å®šçš„dataç›®å½•</span></span><br><span class="line">vim zoo.cfg</span><br></pre></td></tr></table></figure><blockquote><p>zoo.cfg å‚æ•°è¯´æ˜</p></blockquote><table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th><th>å•ä½ / å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>tickTime</strong></td><td>ZooKeeper æ—¶é—´é…ç½®ä¸­çš„åŸºæœ¬å•ä½</td><td>2000</td><td>æ¯«ç§’</td></tr><tr><td><strong>initLimit</strong></td><td>follower åˆå§‹åŒ–è¿æ¥åˆ° leader çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•°</td><td>10</td><td>10 Ã— tickTime = 20000 ms</td></tr><tr><td><strong>syncLimit</strong></td><td>follower ä¸ leader æ•°æ®åŒæ­¥çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•°</td><td>5</td><td>5 Ã— tickTime = 10000 ms</td></tr><tr><td><strong>dataDir</strong></td><td>æ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•ï¼ˆæœªæŒ‡å®š dataLogDir æ—¶ï¼Œæ—¥å¿—ä¹Ÿä¼šä¿å­˜åœ¨æ­¤ç›®å½•ï¼‰</td><td>/tmp/zookeeper</td><td>ç›®å½•è·¯å¾„</td></tr><tr><td><strong>clientPort</strong></td><td>å®¢æˆ·ç«¯è¿æ¥ ZooKeeper çš„ç«¯å£å·</td><td>2181</td><td>é»˜è®¤ 2181</td></tr><tr><td><strong>maxClientCnxns</strong></td><td>å•ä¸ªå®¢æˆ·ç«¯æœ€å¤§å¹¶å‘è¿æ¥æ•°</td><td>60</td><td>è¶…è¿‡é™åˆ¶åæ–°è¿æ¥ä¼šè¢«æ‹’ç»</td></tr><tr><td><strong>autopurge.snapRetainCount</strong></td><td>å¿«ç…§æ–‡ä»¶ä¿ç•™ä¸ªæ•°ï¼Œè¶…è¿‡æ•°é‡çš„å°†ä¼šè¢«æ¸…ç†</td><td>3</td><td>é»˜è®¤ 3</td></tr><tr><td><strong>autopurge.purgeInterval</strong></td><td>æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš”æ—¶é—´ï¼Œå•ä½å°æ—¶ï¼Œ0 è¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†</td><td>1</td><td>1 å°æ—¶</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ zookeeper</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> zookeeper</span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">bin/zkServer.sh start</span><br><span class="line"><span class="comment"># æŒ‡å®šé…ç½®æ–‡ä»¶</span></span><br><span class="line">bin/zkServer.sh start conf/zoo.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">bin/zkServer.sh stop</span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">bin/zkServer.sh status</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line">./bin/zkServer.sh version</span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤å®‰è£…">é›†ç¾¤å®‰è£…</h3><h4 id="ZooKeeper-é›†ç¾¤è§’è‰²">ZooKeeper é›†ç¾¤è§’è‰²</h4><h5 id="1-Leaderï¼ˆé¢†å¯¼è€…ï¼‰">1. Leaderï¼ˆé¢†å¯¼è€…ï¼‰</h5><ul class="lvl-0"><li class="lvl-2"><p><strong>èŒè´£ï¼š</strong></p><ul class="lvl-2"><li class="lvl-4">äº‹åŠ¡è¯·æ±‚ï¼ˆå†™æ“ä½œï¼‰çš„å”¯ä¸€è°ƒåº¦è€…å’Œå¤„ç†è€…ï¼Œä¿è¯é›†ç¾¤äº‹åŠ¡å¤„ç†çš„é¡ºåºæ€§ï¼›</li><li class="lvl-4">é›†ç¾¤å†…éƒ¨å„ä¸ªæœåŠ¡å™¨çš„è°ƒåº¦è€…ï¼›</li><li class="lvl-4">å¯¹äº <code>create</code>ã€<code>setData</code>ã€<code>delete</code> ç­‰å†™æ“ä½œè¯·æ±‚ï¼Œç»Ÿä¸€è½¬å‘ç»™ Leader å¤„ç†ï¼›</li><li class="lvl-4">Leader è´Ÿè´£å†³å®šç¼–å·ã€æ‰§è¡Œæ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º <strong>äº‹åŠ¡</strong>ã€‚</li></ul></li></ul><ul class="lvl-0"><li class="lvl-2"><p>ä¸‰å°è™šæ‹Ÿæœº zoo.cfg æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é€‰ä¸¾å‡º Leader è§’è‰²ï¼Œåˆ™å…¶ä½™å°±æ˜¯ Follower è§’è‰²ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.1=10.250.0.229:2888:3888</span><br><span class="line">server.2=10.250.0.152:2888:3888</span><br><span class="line">server.3=10.250.0.36:2888:3888</span><br></pre></td></tr></table></figure><h5 id="2-Followerï¼ˆè·Ÿéšè€…ï¼‰">2. Followerï¼ˆè·Ÿéšè€…ï¼‰</h5><ul class="lvl-0"><li class="lvl-2"><p><strong>èŒè´£ï¼š</strong></p><ul class="lvl-2"><li class="lvl-4">å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡ï¼ˆè¯»æ“ä½œï¼‰è¯·æ±‚ï¼ˆå¯ä»¥ç›´æ¥å“åº”ï¼‰ï¼›</li><li class="lvl-4">è½¬å‘äº‹åŠ¡è¯·æ±‚ç»™ Leaderï¼›</li><li class="lvl-4">å‚ä¸é›†ç¾¤ Leader é€‰ä¸¾æŠ•ç¥¨ã€‚</li></ul></li></ul><blockquote><p>leaderèŠ‚ç‚¹å¯ä»¥å¤„ç†è¯»å†™è¯·æ±‚ï¼Œfolloweråªå¯ä»¥å¤„ç†è¯»è¯·æ±‚ã€‚followeråœ¨æ¥åˆ°å†™è¯·æ±‚æ—¶ä¼šæŠŠå†™è¯·æ±‚è½¬å‘ç»™leaderæ¥å¤„ç†ã€‚</p></blockquote><h5 id="3-Observerï¼ˆè§‚å¯Ÿè€…ï¼‰">3. Observerï¼ˆè§‚å¯Ÿè€…ï¼‰</h5><ul class="lvl-0"><li class="lvl-2"><p><strong>èŒè´£ï¼š</strong></p><ul class="lvl-2"><li class="lvl-4">å¯¹äºéäº‹åŠ¡è¯·æ±‚ï¼ˆè¯»æ“ä½œï¼‰å¯ä»¥ç‹¬ç«‹å¤„ç†ï¼›</li><li class="lvl-4">å¯¹äºäº‹åŠ¡è¯·æ±‚ä¼šè½¬å‘ç»™ Leader å¤„ç†ï¼›</li><li class="lvl-4">æ¥æ”¶æ¥è‡ª Leader çš„ <code>inform</code> ä¿¡æ¯ï¼Œæ›´æ–°æœ¬åœ°å­˜å‚¨ï¼›</li><li class="lvl-4">ä¸å‚ä¸æäº¤å’Œé€‰ä¸¾æŠ•ç¥¨ï¼›</li><li class="lvl-4">é€šå¸¸ç”¨äº <strong>æå‡é›†ç¾¤éäº‹åŠ¡å¤„ç†èƒ½åŠ›</strong>ï¼Œä¸å½±å“é›†ç¾¤äº‹åŠ¡å¤„ç†æ€§èƒ½ã€‚</li></ul></li></ul><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®ä¸€ä¸ª ID ä¸º 4 çš„è§‚å¯Ÿè€…èŠ‚ç‚¹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.4=10.250.0.56:2888:3888:observer</span><br></pre></td></tr></table></figure><h4 id="é›†ç¾¤æ­å»º">é›†ç¾¤æ­å»º</h4><ul class="lvl-0"><li class="lvl-2"><p>ç¯å¢ƒå‡†å¤‡ï¼š4å°æœåŠ¡å™¨ï¼ŒæŒ‰ç…§ <code>å•æœºå®‰è£…</code> çš„æ–¹å¼å‡†å¤‡å¥½ Zookeeper ç¯å¢ƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.229</span><br><span class="line">10.250.0.152</span><br><span class="line">10.250.0.36</span><br><span class="line">10.250.0.56</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>zoo.cfg</code> æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server.1=10.250.0.229:2888:3888</span><br><span class="line">server.2=10.250.0.152:2888:3888</span><br><span class="line">server.3=10.250.0.36:2888:3888</span><br><span class="line">server.4=10.250.0.56:2888:3888:observer</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«åœ¨ <code>dataDir</code> ç›®å½•ä¸‹åˆ›å»º <code>myid</code> æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸ server å¯¹åº”çš„ç¼–å·ï¼ˆæ³¨æ„ï¼šä¸Šä¸‹ä¸è¦æœ‰ç©ºè¡Œï¼Œå·¦å³ä¸è¦æœ‰ç©ºæ ¼ï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ èŠ‚ç‚¹ç¼–å·ä¸èƒ½é‡å¤ï¼Œè€Œä¸”è¦ä¸ zoo.cfg æ–‡ä»¶ä¸­çš„ server.id ä¸€è‡´</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; myid</span><br><span class="line"><span class="comment"># echo 2 &gt; myid</span></span><br><span class="line"><span class="comment"># echo 3 &gt; myid</span></span><br><span class="line"><span class="comment"># echo 4 &gt; myid</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«å¯åŠ¨ Zookeeper æœåŠ¡å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†åˆ«å¯åŠ¨4ä¸ªèŠ‚ç‚¹çš„zookeeper server</span></span><br><span class="line">bin/zkServer.sh start</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°èŠ‚ç‚¹è§’è‰²ç±»å‹</span></span><br><span class="line">bin/zkServer.sh status</span><br></pre></td></tr></table></figure><h4 id="é›†ç¾¤æœ€å°‘èŠ‚ç‚¹è¦æ±‚å’Œæ‰©å®¹è§„åˆ™">é›†ç¾¤æœ€å°‘èŠ‚ç‚¹è¦æ±‚å’Œæ‰©å®¹è§„åˆ™</h4><ul class="lvl-0"><li class="lvl-2"><p>ZooKeeper ä½¿ç”¨ å¤šæ•°æ´¾ï¼ˆquorumï¼‰æœºåˆ¶ æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.é›†ç¾¤æ€»èŠ‚ç‚¹æ•° N</span><br><span class="line">2.å®¹å¿çš„å®•æœºèŠ‚ç‚¹æ•° F = (N-1)/2ï¼ˆå‘ä¸‹å–æ•´ï¼‰</span><br><span class="line">3.è¦ä¿è¯é›†ç¾¤å¯ç”¨ï¼Œéœ€è¦ å¤§äº N/2 çš„èŠ‚ç‚¹å­˜æ´»</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é›†ç¾¤æ‰©å®¹è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.èŠ‚ç‚¹æ€»æ•°å¿…é¡»æ˜¯å¥‡æ•°</span><br><span class="line">  å¥‡æ•°èŠ‚ç‚¹å¯ä»¥ä¿è¯å¤šæ•°æ´¾æŠ•ç¥¨æœºåˆ¶æ­£å¸¸</span><br><span class="line">  å¶æ•°èŠ‚ç‚¹ä¸æ¨èï¼Œå®¹é”™èƒ½åŠ›ä¸å¢åŠ ï¼ˆæ¯”å¦‚ 4 å°ï¼Œä»ç„¶åªå®¹å¿ 1 å°å®•æœºï¼‰</span><br><span class="line"></span><br><span class="line">2.æ¯æ¬¡æ‰©å®¹å»ºè®® +2 èŠ‚ç‚¹</span><br><span class="line">  è¿™æ ·æ—¢ä¿æŒå¥‡æ•°ï¼Œåˆå¢åŠ  quorum å®¹é”™èƒ½åŠ›</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æœ€å°‘èŠ‚ç‚¹ä¸å®¹é”™èƒ½åŠ›è¡¨æ ¼</p></li></ul><table><thead><tr><th>é›†ç¾¤æ€»èŠ‚ç‚¹æ•° N</th><th>å®¹å¿å®•æœºæ•° F</th><th>å¯ç”¨ quorum èŠ‚ç‚¹æ•°</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>1</td><td>0</td><td>1</td><td>ä¸æ¨èï¼Œæ— æ³•å®¹å¿æ•…éšœ</td></tr><tr><td>2</td><td>0</td><td>2</td><td>ä¸æ¨èï¼Œ1 å°å®•æœºå°±ä¸å¯ç”¨</td></tr><tr><td>3</td><td>1</td><td>2</td><td>æœ€å°å¯ç”¨ç”Ÿäº§é›†ç¾¤</td></tr><tr><td>5</td><td>2</td><td>3</td><td>æ¨èç”Ÿäº§é›†ç¾¤è§„æ¨¡</td></tr><tr><td>7</td><td>3</td><td>4</td><td>é«˜å¯ç”¨å¤§é›†ç¾¤</td></tr><tr><td>9</td><td>4</td><td>5</td><td>æ›´å¤§é›†ç¾¤ï¼Œé«˜å®¹é”™</td></tr><tr><td>11</td><td>5</td><td>6</td><td>æé«˜å¯ç”¨åœºæ™¯</td></tr></tbody></table><h2 id="ZooKeeper-é»˜è®¤ç«¯å£è¯´æ˜">ZooKeeper é»˜è®¤ç«¯å£è¯´æ˜</h2><table><thead><tr><th>ç«¯å£</th><th>ç”¨é€”</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>2181</td><td>å®¢æˆ·ç«¯è¿æ¥ç«¯å£</td><td>å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªç«¯å£è®¿é—® ZooKeeper</td></tr><tr><td>2888</td><td>é›†ç¾¤å†…éƒ¨é€šä¿¡</td><td>follower ä¸ leader ä¹‹é—´åŒæ­¥æ•°æ®</td></tr><tr><td>3888</td><td>leader é€‰ä¸¾ç«¯å£</td><td>é›†ç¾¤é€‰ä¸¾ leader ä½¿ç”¨</td></tr><tr><td>8080 (å¯é€‰)</td><td>admin/metrics webç«¯å£</td><td>å¦‚æœå¼€å¯äº† adminServer</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ°¸ä¹…å¼€å¯ç«¯å£</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=2181/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=2888/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=3888/tcp</span><br><span class="line"><span class="comment"># å¦‚æœä½¿ç”¨ adminServer</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=8080/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½®</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦å¼€æ”¾æˆåŠŸ</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --list-all</span><br></pre></td></tr></table></figure><h2 id="å®¢æˆ·ç«¯è¿æ¥">å®¢æˆ·ç«¯è¿æ¥</h2><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤è¿æ¥ 127.0.0.1:2181</span></span><br><span class="line">bin/zkCli.sh</span><br><span class="line"><span class="comment"># æŒ‡å®š -server ip:portï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œåˆ™è¿æ¥ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒZooKeeper ä¼šè‡ªåŠ¨å¤„ç†ä¸ Leader/Follower çš„äº¤äº’</span></span><br><span class="line">bin/zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure><blockquote><p>å®¢æˆ·ç«¯å‘½ä»¤ç®€ä»‹ï¼š<a href="https://zookeeper.apache.org/doc/r3.8.4/zookeeperCLI.html">å‚è€ƒå®˜ç½‘</a></p></blockquote><table><thead><tr><th>å‘½ä»¤</th><th>è¯­æ³•ç¤ºä¾‹</th><th>åŠŸèƒ½æè¿°</th><th>å¸¸ç”¨å‚æ•°åŠè¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>help</strong></td><td><code>help</code></td><td>æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤</td><td>æ— </td><td><code>help</code></td></tr><tr><td><strong>version</strong></td><td><code>version</code></td><td>æŸ¥çœ‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯</td><td>æ— </td><td><code>version</code></td></tr><tr><td><strong>connect</strong></td><td><code>connect host:port</code></td><td>è¿æ¥åˆ°æŒ‡å®š ZooKeeper æœåŠ¡å™¨</td><td><code>host:port</code>: æœåŠ¡å™¨åœ°å€</td><td><code>connect 127.0.0.1:2181</code></td></tr><tr><td><strong>close</strong></td><td><code>close</code></td><td>å…³é—­å½“å‰ä¼šè¯ ,é€šè¿‡ <code>connect</code> å¯é‡è¿</td><td>æ— </td><td><code>close</code></td></tr><tr><td><strong>quit</strong></td><td><code>quit</code></td><td>é€€å‡ºå®¢æˆ·ç«¯</td><td>æ— </td><td><code>quit</code></td></tr><tr><td><strong>ls</strong></td><td><code>ls [-s] [-w] [-R] path</code></td><td>æŸ¥çœ‹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</td><td>- <code>-w</code>: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–<br>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-R</code>: é€’å½’æŸ¥çœ‹</td><td><code>ls -s -w /zk_test</code></td></tr><tr><td><strong>getAllChildrenNumber</strong></td><td><code>getAllChildrenNumber path</code></td><td>è·å–æŸèŠ‚ç‚¹æ‰€æœ‰å­èŠ‚ç‚¹çš„æ€»æ•°</td><td>æ— </td><td><code>getAllChildrenNumber /zk_test</code></td></tr><tr><td><strong>getEphemerals</strong></td><td><code>getEphemerals path</code></td><td>è·å–æŸè·¯å¾„ä¸‹æ‰€æœ‰ä¸´æ—¶èŠ‚ç‚¹</td><td>æ— </td><td><code>getEphemerals /zk_test</code></td></tr><tr><td><strong>create</strong></td><td><code>create [-s] [-e] [-c] [-t ttl] path [data] [acl]</code></td><td>åˆ›å»ºèŠ‚ç‚¹</td><td>- <code>-s</code>: é¡ºåºèŠ‚ç‚¹<br>- <code>-e</code>: ä¸´æ—¶èŠ‚ç‚¹<br>- <code>-c</code>: å®¹å™¨èŠ‚ç‚¹<br>- <code>-t ttl</code>: TTLèŠ‚ç‚¹ï¼Œå•ä½æ¯«ç§’</td><td><code>create -e /zk_test_ephemeral &quot;temp_data&quot;</code></td></tr><tr><td><strong>get</strong></td><td><code>get [-s] [-w] path</code></td><td>è·å–èŠ‚ç‚¹æ•°æ®ä¿¡æ¯</td><td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-w</code>: ç›‘å¬èŠ‚ç‚¹å˜åŒ–</td><td><code>get -s -w /zk_test</code></td></tr><tr><td><strong>set</strong></td><td><code>set [-s] [-v version] path data</code></td><td>è®¾ç½®èŠ‚ç‚¹æ•°æ®</td><td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-v</code>: æŒ‡å®šç‰ˆæœ¬å·</td><td><code>set /zk_test &quot;new_data&quot;</code></td></tr><tr><td><strong>stat</strong></td><td><code>stat [-w] path</code></td><td>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</td><td>- <code>-w</code>: ç›‘å¬èŠ‚ç‚¹å˜åŒ–</td><td><code>stat -w /zk_test</code></td></tr><tr><td><strong>sync</strong></td><td><code>sync path</code></td><td>åŒæ­¥æŒ‡å®šèŠ‚ç‚¹æ•°æ®</td><td>æ— </td><td><code>sync /zk_test</code></td></tr><tr><td><strong>delete</strong></td><td><code>delete [-v version] path</code></td><td>åˆ é™¤æŸä¸€èŠ‚ç‚¹ï¼ˆæ— å­èŠ‚ç‚¹ï¼‰</td><td>- <code>-v</code>: èŠ‚ç‚¹ç‰ˆæœ¬å·</td><td><code>delete /zk_test</code></td></tr><tr><td><strong>deleteall</strong></td><td><code>deleteall path</code></td><td>é€’å½’åˆ é™¤æŸä¸€èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹</td><td>æ— </td><td><code>deleteall /zk_test</code></td></tr><tr><td><strong>getAcl</strong></td><td><code>getAcl [-s] path</code></td><td>è·å–èŠ‚ç‚¹è®¿é—®æ§åˆ¶ä¿¡æ¯</td><td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</td><td><code>getAcl /zk_test</code></td></tr><tr><td><strong>setAcl</strong></td><td><code>setAcl [-s] [-v version] [-R] path acl</code></td><td>è®¾ç½®èŠ‚ç‚¹è®¿é—®æ§åˆ¶åˆ—è¡¨</td><td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-v</code>: æŒ‡å®šç‰ˆæœ¬å·<br>- <code>-R</code>: é€’å½’è®¾ç½®</td><td><code>setAcl /zk_test world:anyone:r</code></td></tr><tr><td><strong>listquota</strong></td><td><code>listquota path</code></td><td>æŸ¥çœ‹èŠ‚ç‚¹é…é¢ä¿¡æ¯</td><td>æ— </td><td><code>listquota /zk_test</code></td></tr><tr><td><strong>setquota</strong></td><td><code>setquota [-n] [-b] val path</code></td><td>å¯¹èŠ‚ç‚¹å¢åŠ é™åˆ¶</td><td>- <code>-n</code>: å­èŠ‚ç‚¹æœ€å¤§ä¸ªæ•°<br>- <code>-b</code>: æ•°æ®å€¼æœ€å¤§é•¿åº¦ï¼Œ-1 è¡¨ç¤ºæ— é™åˆ¶</td><td><code>setquota -n 5 /zk_test</code></td></tr><tr><td><strong>delquota</strong></td><td><code>delquota [-n                                    | -b] path</code></td><td>åˆ é™¤èŠ‚ç‚¹é…é¢é™åˆ¶</td><td>- <code>-n</code>: åˆ é™¤å­èŠ‚ç‚¹æ•°é™åˆ¶<br>- <code>-b</code>: åˆ é™¤æ•°æ®å€¼å¤§å°é™åˆ¶</td><td><code>delquota -n /zk_test</code></td></tr><tr><td><strong>config</strong></td><td><code>config</code></td><td>æŸ¥çœ‹æœåŠ¡å™¨é…ç½®</td><td>æ— </td><td><code>config</code></td></tr><tr><td><strong>whoami</strong></td><td><code>whoami</code></td><td>æŸ¥çœ‹å½“å‰ä¼šè¯èº«ä»½</td><td>æ— </td><td><code>whoami</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>GUI å·¥å…·</p></li></ul><table><thead><tr><th>åç§°</th><th>ç±»å‹ / è¿è¡Œæ–¹å¼</th><th>ä¼˜ç‚¹</th><th>æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td><strong>PrettyZoo</strong></td><td>æ¡Œé¢åº”ç”¨ï¼ˆJavaFXï¼‰(<a href="https://github.com/vran-dev/PrettyZoo" title="vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...">GitHub</a>)</td><td>æ”¯æŒ Mac/Windows/Linuxï¼Œç•Œé¢å‹å¥½ï¼›æ”¯æŒèŠ‚ç‚¹åˆ›å»º/åˆ é™¤/æ›´æ–°/æŸ¥è¯¢ï¼ŒACL ç®¡ç†ï¼Œå¤š ZK å®ä¾‹ç®¡ç†ï¼ŒSSH éš§é“ç­‰åŠŸèƒ½ã€‚(<a href="https://github.com/vran-dev/PrettyZoo" title="vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...">GitHub</a>)</td><td>é¡¹ç›®å·²ç» archivedï¼Œç»´æŠ¤å¯èƒ½ä¸æ´»è·ƒã€‚æœ€æ–°ç‰ˆå¯èƒ½åœ¨å…¼å®¹æ€§æˆ– Bug ä¿®å¤æ–¹é¢ä¸å¦‚æ´»è·ƒé¡¹ç›®ã€‚ä¹Ÿå¯èƒ½éœ€è¦è‡ªå·±æ„å»ºæˆ–è°ƒè¯•ã€‚(<a href="https://github.com/vran-dev/PrettyZoo" title="vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...">GitHub</a>)</td></tr><tr><td><strong>ZooNavigator</strong></td><td>Web ç•Œé¢ + å¯ Docker éƒ¨ç½²æˆ–æœ¬åœ°å¯åŠ¨(<a href="https://github.com/elkozmon/zoonavigator" title="elkozmon/zoonavigator: Web-based ZooKeeper UI">GitHub</a>)</td><td>åŠŸèƒ½ä¸°å¯Œï¼›æ”¯æŒå¤šä¸ª Zookeeper ç‰ˆæœ¬ï¼ˆå¦‚ 3.5.x ï½ 3.9.xï¼‰ï¼›æµè§ˆ / ç¼–è¾‘ /æœç´¢èŠ‚ç‚¹ï¼›å¯¼å…¥å¯¼å‡ºé…ç½®ï¼›æ”¯æŒæµè§ˆå™¨è®¿é—®ï¼Œæ— éœ€æœ¬åœ° heavy GUIã€‚(<a href="https://github.com/elkozmon/zoonavigator" title="elkozmon/zoonavigator: Web-based ZooKeeper UI">GitHub</a>)</td><td>å› ä¸º Web åº”ç”¨ï¼Œå¯èƒ½å¯¹æµè§ˆå™¨å®‰å…¨ç­–ç•¥ä¸ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿï¼›éœ€è¦éƒ¨ç½²è‡ªå·±ç‰ˆæœ¬æˆ– Dockerï¼›å¦‚æœè¦æ±‚æœ¬åœ°è„±æœºæ“ä½œæ—¶ï¼Œæœ‰äº›åŠŸèƒ½å¯èƒ½ç¨ä¸å¦‚æ¡Œé¢åº”ç”¨ã€‚</td></tr><tr><td><strong>ZooKeeper Assistant</strong></td><td>æ¡Œé¢ï¼ç®¡ç†å‘˜é¢æ¿ç±»å‹ï¼ˆæ”¯æŒç›‘æ§ç•Œé¢ç­‰ï¼‰(<a href="https://dev.to/redisant/an-exciting-apache-zookeeper-desktop-gui-1fdo" title="An exciting Apache ZooKeeper Desktop GUI">DEV Community</a>)</td><td>é™¤äº†æµè§ˆèŠ‚ç‚¹æ ‘ä»¥å¤–ï¼Œè¿˜æä¾›å¥åº·çŠ¶æ€ç›‘æ§ï¼ˆå»¶è¿Ÿã€è¯·æ±‚æ•°ç­‰ï¼‰ã€ä¸åŒæ•°æ®æ ¼å¼æ”¯æŒï¼ˆJSON/XML ç­‰ï¼‰ã€å¯¼å…¥/å¯¼å‡ºèŠ‚ç‚¹æ•°æ®ã€å‘½ä»¤è¡Œæ“ä½œé›†æˆã€‚(<a href="https://dev.to/redisant/an-exciting-apache-zookeeper-desktop-gui-1fdo" title="An exciting Apache ZooKeeper Desktop GUI">DEV Community</a>)</td><td>æœ‰äº›åŠŸèƒ½å¯èƒ½åœ¨ Mac ä¸Šå…¼å®¹æ€§æˆ–è§†è§‰ä½“éªŒéœ€è¦è°ƒè¯•ï¼›å…·ä½“ç‰ˆæœ¬æ”¯æŒæƒ…å†µè¦çœ‹æœ€è¿‘æ›´æ–°ã€‚æŸäº›ç›‘æ§ç•Œé¢å¯èƒ½ä¾èµ–äº ZK çš„æŒ‡æ ‡æˆ–æ’ä»¶ã€‚</td></tr></tbody></table><h2 id="Zookeeper-èŠ‚ç‚¹ç±»å‹">Zookeeper èŠ‚ç‚¹ç±»å‹</h2><table><thead><tr><th>èŠ‚ç‚¹ç±»å‹</th><th>ç”Ÿå‘½å‘¨æœŸè¯´æ˜</th><th>åˆ›å»ºå‘½ä»¤ç¤ºä¾‹</th><th>ç‰¹ç‚¹è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æŒä¹…èŠ‚ç‚¹</strong> (Persistent)</td><td>èŠ‚ç‚¹ä¸€ç›´å­˜åœ¨ï¼Œé™¤éæ‰‹åŠ¨åˆ é™¤ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ŒèŠ‚ç‚¹ä¹Ÿä¸ä¼šæ¶ˆå¤±</td><td><code>create /locks</code></td><td>é€‚åˆå­˜å‚¨é…ç½®ä¿¡æ¯ã€å…ƒæ•°æ®ç­‰æŒä¹…æ•°æ®</td></tr><tr><td><strong>ä¸´æ—¶èŠ‚ç‚¹</strong> (Ephemeral)</td><td>å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ˆå¼‚å¸¸æˆ–è¶…æ—¶ï¼‰æ—¶ï¼ŒèŠ‚ç‚¹è‡ªåŠ¨è¢«åˆ é™¤</td><td><code>create -e /locks/DBLock</code></td><td>å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€ä¸´æ—¶ä¼šè¯æ•°æ®</td></tr><tr><td><strong>æœ‰åºèŠ‚ç‚¹</strong> (Sequential)</td><td>åœ¨æŒä¹…æˆ–ä¸´æ—¶èŠ‚ç‚¹åŸºç¡€ä¸Šï¼Œå¢åŠ æœ‰åºç¼–å·ï¼ŒZooKeeper è‡ªåŠ¨åœ¨èŠ‚ç‚¹åååŠ é€’å¢åºå·</td><td><code>create -e -s /jobs/job</code></td><td>å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€é˜Ÿåˆ—ç­‰éœ€è¦é¡ºåºçš„åœºæ™¯</td></tr><tr><td><strong>å®¹å™¨èŠ‚ç‚¹</strong> (Container)</td><td>V3.5.3+ï¼Œå½“å®¹å™¨èŠ‚ç‚¹ä¸‹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œå®¹å™¨èŠ‚ç‚¹ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤</td><td><code>create -c /work</code></td><td>é€‚åˆåˆ†å¸ƒå¼ä»»åŠ¡ä¸´æ—¶ç›®å½•ã€åŠ¨æ€æ•°æ®ç›®å½•</td></tr><tr><td><strong>TTL èŠ‚ç‚¹</strong> (TTL)</td><td>åœ¨æŒ‡å®š TTL æ—¶é—´å†…æœªä¿®æ”¹ä¸”æ— å­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆéœ€å¼€å¯ <code>extendedTypesEnabled=true</code> é…ç½®ï¼‰</td><td><code>create -t 3000 /ttl_node</code></td><td>é€‚åˆä¸´æ—¶ç¼“å­˜ã€ä¸´æ—¶çŠ¶æ€æ•°æ®ï¼Œè¿‡æœŸè‡ªåŠ¨æ¸…ç†</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ³¨æ„</p><ul class="lvl-2"><li class="lvl-4">åŒä¸€çº§èŠ‚ç‚¹ key åç§°æ˜¯å”¯ä¸€çš„</li><li class="lvl-4">åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå¿…é¡»è¦å¸¦ä¸Šå…¨è·¯å¾„</li></ul></li><li class="lvl-2"><p>èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 16] <span class="built_in">stat</span> /test</span><br><span class="line">cZxid = 0x100000002                   <span class="comment"># Znodeåˆ›å»ºçš„äº‹åŠ¡id</span></span><br><span class="line">ctime = Mon Sep 15 09:44:51 UTC 2025  <span class="comment"># åˆ›å»ºæ—¶é—´</span></span><br><span class="line">mZxid = 0x100000004                   <span class="comment"># æœ€åä¸€æ¬¡ä¿®æ”¹äº‹åŠ¡id</span></span><br><span class="line">mtime = Mon Sep 15 09:47:12 UTC 2025  <span class="comment"># æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´</span></span><br><span class="line">pZxid = 0x400000004                   <span class="comment"># è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡ä¿®æ”¹çš„äº‹åŠ¡IDï¼Œæ·»åŠ å­èŠ‚ç‚¹æˆ–åˆ é™¤å­èŠ‚ç‚¹å°±ä¼šå½±å“å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œä½†æ˜¯ä¿®æ”¹å­èŠ‚ç‚¹çš„æ•°æ®å†…å®¹åˆ™ä¸å½±å“è¯¥IDï¼ˆæ³¨æ„: åªæœ‰å­èŠ‚ç‚¹åˆ—è¡¨å˜æ›´äº†æ‰ä¼šå˜æ›´pzxidï¼Œå­èŠ‚ç‚¹å†…å®¹å˜æ›´ä¸ä¼šå½±å“pzxidï¼‰</span></span><br><span class="line">cversion = 1                          <span class="comment"># å­èŠ‚ç‚¹çš„ç‰ˆæœ¬å·ã€‚å½“znodeçš„å­èŠ‚ç‚¹æœ‰å˜åŒ–æ—¶ï¼Œcversion çš„å€¼å°±ä¼šå¢åŠ 1ã€‚</span></span><br><span class="line">dataVersion = 1                       <span class="comment"># znodeçš„æ•°æ®ç‰ˆæœ¬å·ã€‚æ¯æ¬¡å¯¹èŠ‚ç‚¹è¿›è¡Œsetæ“ä½œï¼ŒdataVersionçš„å€¼éƒ½ä¼šå¢åŠ 1ï¼ˆå³ä½¿è®¾ç½®çš„æ˜¯ç›¸åŒçš„æ•°æ®ï¼‰ï¼Œå¯æœ‰æ•ˆé¿å…äº†æ•°æ®æ›´æ–°æ—¶å‡ºç°çš„å…ˆåé¡ºåºé—®é¢˜</span></span><br><span class="line">aclVersion = 0                        <span class="comment"># znodeçš„ACLç‰ˆæœ¬å·ã€‚æ¯æ¬¡å¯¹èŠ‚ç‚¹è¿›è¡ŒACLè®¾ç½®ï¼ŒaclVersionçš„å€¼éƒ½ä¼šå¢åŠ 1</span></span><br><span class="line">ephemeralOwner = 0x0                  <span class="comment"># å¦‚æœè¯¥èŠ‚ç‚¹ä¸ºä¸´æ—¶èŠ‚ç‚¹, ephemeralOwnerå€¼è¡¨ç¤ºä¸è¯¥èŠ‚ç‚¹ç»‘å®šçš„session idã€‚å¦‚æœä¸æ˜¯, ephemeralOwnerå€¼ä¸º0(æŒä¹…èŠ‚ç‚¹)ã€‚</span></span><br><span class="line">dataLength = 3                        <span class="comment"># znodeçš„æ•°æ®é•¿åº¦</span></span><br><span class="line">numChildren = 1                       <span class="comment"># znodeçš„å­èŠ‚ç‚¹æ•°é‡ï¼ˆåªç»Ÿè®¡ç›´æ¥å­èŠ‚ç‚¹çš„æ•°é‡ï¼‰</span></span><br></pre></td></tr></table></figure><h2 id="Zookeeper-ç›‘å¬æœºåˆ¶">Zookeeper ç›‘å¬æœºåˆ¶</h2><ul class="lvl-0"><li class="lvl-2"><p>watchæœºåˆ¶ï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªç›‘å¬æœºåˆ¶ã€‚Zookeeperä¸­çš„watchæœºåˆ¶ï¼Œå¿…é¡»å®¢æˆ·ç«¯å…ˆå»æœåŠ¡ç«¯æ³¨å†Œç›‘å¬ï¼Œè¿™æ ·äº‹ä»¶å‘ç”Ÿæ—¶æ‰ä¼šè§¦å‘ç›‘å¬ï¼Œé€šçŸ¥ç»™å®¢æˆ·ç«¯ã€‚</p></li><li class="lvl-2"><p>ç›‘å¬çš„å¯¹è±¡æ˜¯äº‹ä»¶ï¼Œæ”¯æŒçš„äº‹ä»¶ç±»å‹å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- None: è¿æ¥å»ºç«‹äº‹ä»¶</span><br><span class="line">- NodeCreatedï¼š èŠ‚ç‚¹åˆ›å»º</span><br><span class="line">- NodeDeletedï¼š èŠ‚ç‚¹åˆ é™¤</span><br><span class="line">- NodeDataChangedï¼šèŠ‚ç‚¹æ•°æ®å˜åŒ–</span><br><span class="line">- NodeChildrenChangedï¼šå­èŠ‚ç‚¹åˆ—è¡¨å˜åŒ–</span><br><span class="line">- DataWatchRemovedï¼šèŠ‚ç‚¹ç›‘å¬è¢«ç§»é™¤</span><br><span class="line">- ChildWatchRemovedï¼šå­èŠ‚ç‚¹ç›‘å¬è¢«ç§»é™¤</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç›‘å¬ç‰¹æ€§</p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ä¸€æ¬¡æ€§è§¦å‘</strong></td><td>Watch æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸€æ—¦è¢«è§¦å‘å°±ä¼šè¢«ç§»é™¤ã€‚å†æ¬¡ä½¿ç”¨æ—¶éœ€è¦é‡æ–°æ³¨å†Œã€‚</td></tr><tr><td><strong>å®¢æˆ·ç«¯é¡ºåºå›è°ƒ</strong></td><td>Watch å›è°ƒæ˜¯é¡ºåºä¸²è¡Œæ‰§è¡Œçš„ï¼Œå®¢æˆ·ç«¯åªæœ‰åœ¨å›è°ƒå®Œæˆåæ‰èƒ½çœ‹åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚</td></tr><tr><td><strong>è½»é‡çº§</strong></td><td>Watcher å›è°ƒé€»è¾‘ä¸åº”è¿‡å¤šï¼Œä»¥å…é˜»å¡æˆ–å½±å“å…¶ä»– Watch çš„æ‰§è¡Œã€‚</td></tr><tr><td><strong>æœ€å°é€šä¿¡å•ä½</strong></td><td><code>WatchEvent</code> æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼ŒåªåŒ…å«é€šçŸ¥çŠ¶æ€ã€äº‹ä»¶ç±»å‹å’ŒèŠ‚ç‚¹è·¯å¾„ï¼Œä¸åŒ…å«èŠ‚ç‚¹æ•°æ®å˜åŒ–å‰åçš„å…·ä½“å†…å®¹ã€‚</td></tr><tr><td><strong>æ—¶æ•ˆæ€§</strong></td><td>Watcher ä»…åœ¨å½“å‰ Session å®Œå…¨å¤±æ•ˆæ—¶æ‰æ— æ•ˆã€‚å¦‚æœ Session å¿«é€Ÿé‡è¿æˆåŠŸï¼ŒWatcher ä¾ç„¶æœ‰æ•ˆï¼Œå¯ç»§ç»­æ¥æ”¶é€šçŸ¥ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥å¼€å¯ç›‘å¬çš„å‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç›‘å¬èŠ‚ç‚¹æ•°æ®çš„å˜åŒ–</span></span><br><span class="line">get -w path</span><br><span class="line"><span class="built_in">stat</span> -w path</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç›‘å¬å­èŠ‚ç‚¹å¢å‡çš„å˜åŒ–</span></span><br><span class="line"><span class="built_in">ls</span> -w path</span><br></pre></td></tr></table></figure><h3 id="æ°¸ä¹…æ€§-Watch">æ°¸ä¹…æ€§ Watch</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨è¢«è§¦å‘ä¹‹åï¼Œä»ç„¶ä¿ç•™ï¼Œå¯ä»¥ç»§ç»­ç›‘å¬ZNodeä¸Šçš„å˜æ›´ï¼Œæ˜¯Zookeeper 3.6.0ç‰ˆæœ¬æ–°å¢çš„åŠŸèƒ½</p></li><li class="lvl-2"><p>åˆ›å»ºç›‘å¬</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">addWatch [-m mode] path</span><br><span class="line"></span><br><span class="line"><span class="comment"># mode:</span></span><br><span class="line"><span class="comment"># - PERSISTENT: æŒä¹…åŒ–è®¢é˜…ï¼Œé’ˆå¯¹å½“å‰èŠ‚ç‚¹çš„ä¿®æ”¹å’Œåˆ é™¤äº‹ä»¶ï¼Œä»¥åŠå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„åˆ é™¤å’Œæ–°å¢äº‹ä»¶ã€‚</span></span><br><span class="line"><span class="comment"># - PERSISTENT_RECURSIVE: æŒä¹…åŒ–é€’å½’è®¢é˜…(è¿™ä¸ªæ˜¯é»˜è®¤å€¼)ï¼Œåœ¨PERSISTENTçš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†å­èŠ‚ç‚¹ä¿®æ”¹çš„äº‹ä»¶è§¦å‘ï¼Œä»¥åŠå­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„æ•°æ®å˜åŒ–éƒ½ä¼šè§¦å‘ç›¸å…³äº‹ä»¶ï¼ˆæ»¡è¶³é€’å½’è®¢é˜…ç‰¹æ€§ï¼‰</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤ç›‘å¬</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ™®é€šä¸€æ¬¡æ€§ Watch ä¸éœ€è¦æ‰‹åŠ¨åˆ é™¤ï¼Œè§¦å‘åä¼šè‡ªåŠ¨ç§»é™¤ï¼›removewatches ä¸»è¦ç”¨äºæŒä¹… Watchï¼ˆpersistent watchï¼‰ã€‚</span></span><br><span class="line">removewatches path [-c|-d|-a] [-l]</span><br><span class="line"><span class="comment"># -c: ä»…åˆ é™¤å½“å‰å®¢æˆ·ç«¯çš„ Watch</span></span><br><span class="line"><span class="comment"># -d: åˆ é™¤æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰ Watch(åŒ…æ‹¬å…¶ä»–å®¢æˆ·ç«¯æ³¨å†Œçš„)</span></span><br><span class="line"><span class="comment"># -a: åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹çš„æ‰€æœ‰ Watchï¼ˆåŒ…æ‹¬å…¶ä»–å®¢æˆ·ç«¯çš„ Watchï¼‰ï¼Œæ…ç”¨ï¼ï¼ï¼</span></span><br><span class="line"><span class="comment"># -l: æ˜¾ç¤ºè¢«åˆ é™¤çš„ Watch åˆ—è¡¨</span></span><br></pre></td></tr></table></figure><h3 id="ç›‘å¬å™¨åº”ç”¨åœºæ™¯">ç›‘å¬å™¨åº”ç”¨åœºæ™¯</h3><table><thead><tr><th>ç±»å‹</th><th>ç‰¹ç‚¹</th><th>åº”ç”¨åœºæ™¯ä¸¾ä¾‹</th><th>é€‚åˆçš„èŠ‚ç‚¹ç±»å‹</th></tr></thead><tbody><tr><td><strong>ä¸´æ—¶ç›‘å¬</strong>ï¼ˆä¸€æ¬¡æ€§ Watchï¼‰</td><td>- è§¦å‘ä¸€æ¬¡åè‡ªåŠ¨ç§»é™¤<br>- å®¢æˆ·ç«¯éœ€æ‰‹åŠ¨é‡æ–°æ³¨å†Œ<br>- è½»é‡çº§ï¼Œé€‚åˆå•æ¬¡é€šçŸ¥</td><td>1. <strong>é…ç½®ä¸­å¿ƒ</strong>ï¼šé…ç½®å˜åŒ–æ—¶é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥åé‡æ–°æ‹‰å–æœ€æ–°é…ç½® <br> 2. <strong>åˆ†å¸ƒå¼é”</strong>ï¼šèŠ‚ç‚¹åˆ é™¤ï¼ˆé”é‡Šæ”¾ï¼‰åé€šçŸ¥ç­‰å¾…çš„å®¢æˆ·ç«¯é‡æ–°ç«äº‰é” <br> 3. <strong>ä¸»ä»é€‰ä¸¾</strong>ï¼šä¸»èŠ‚ç‚¹å®•æœºåï¼Œå…¶ä»–èŠ‚ç‚¹æ”¶åˆ°é€šçŸ¥é‡æ–°é€‰ä¸»</td><td><strong>æŒä¹…èŠ‚ç‚¹</strong>ï¼ˆPersistentï¼‰ <br><strong>ä¸´æ—¶èŠ‚ç‚¹</strong>ï¼ˆEphemeralï¼Œç”¨äºé”å’Œé€‰ä¸»ï¼‰</td></tr><tr><td><strong>æ°¸ä¹…ç›‘å¬</strong>ï¼ˆPersistent Watchï¼‰</td><td>- æ³¨å†ŒåæŒç»­æœ‰æ•ˆï¼Œç›´åˆ°å®¢æˆ·ç«¯ä¸»åŠ¨ç§»é™¤<br>- æ”¯æŒå­èŠ‚ç‚¹å˜åŒ–ã€æ•°æ®å˜åŒ–çš„é•¿æœŸç›‘å¬</td><td>1. <strong>æœåŠ¡å‘ç°</strong>ï¼šå®¢æˆ·ç«¯é•¿æœŸç›‘å¬æœåŠ¡èŠ‚ç‚¹å˜åŒ–ï¼ŒèŠ‚ç‚¹ä¸Šçº¿/ä¸‹çº¿æ—¶è‡ªåŠ¨æ›´æ–°æœ¬åœ°æœåŠ¡åˆ—è¡¨ <br> 2. <strong>ç›‘æ§å‘Šè­¦</strong>ï¼šç›‘æ§é‡è¦èŠ‚ç‚¹çŠ¶æ€ï¼ŒèŠ‚ç‚¹æ•°æ®å˜åŒ–æˆ–è¢«åˆ é™¤æ—¶è‡ªåŠ¨è§¦å‘å‘Šè­¦ <br> 3. <strong>åˆ†å¸ƒå¼ç¼“å­˜</strong>ï¼šç¼“å­˜èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œé€šçŸ¥å®¢æˆ·ç«¯åˆ·æ–°ç¼“å­˜</td><td><strong>æŒä¹…èŠ‚ç‚¹</strong>ï¼ˆPersistentï¼‰</td></tr></tbody></table><h2 id="ACLæƒé™æ§åˆ¶">ACLæƒé™æ§åˆ¶</h2><ul class="lvl-0"><li class="lvl-2"><p>ZooKeeper é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æƒé™éƒ½æ˜¯ <code>OPEN_ACL_UNSAFE</code> ï¼Œä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¯»å†™ä»»æ„èŠ‚ç‚¹æ•°æ®ã€‚</p></li><li class="lvl-2"><p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸éœ€è¦é™åˆ¶å¯¹èŠ‚ç‚¹çš„è®¿é—®æƒé™ï¼Œå³ <code>ACL</code> æƒé™æ§åˆ¶ã€‚</p></li><li class="lvl-2"><p>ZooKeeper é‡Œçš„ ACLï¼ˆAccess Control Listï¼Œè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ ä¸»è¦ç”¨äºæ§åˆ¶ è°å¯ä»¥å¯¹æŸä¸ªèŠ‚ç‚¹åšä»€ä¹ˆæ“ä½œï¼Œå®ƒæ˜¯ ZooKeeper æä¾›çš„å®‰å…¨æœºåˆ¶ä¹‹ä¸€ã€‚</p></li></ul><h3 id="ACL-çš„ä½œç”¨">ACL çš„ä½œç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>é™åˆ¶è®¿é—®ï¼šåªå…è®¸æˆæƒç”¨æˆ·æˆ–å®¢æˆ·ç«¯å¯¹æŒ‡å®šèŠ‚ç‚¹è¿›è¡Œè¯»ã€å†™ã€åˆ é™¤ç­‰æ“ä½œã€‚</p></li><li class="lvl-2"><p>é˜²æ­¢è¯¯æ“ä½œï¼šä¿æŠ¤é‡è¦èŠ‚ç‚¹ä¸è¢«æœªæˆæƒçš„å®¢æˆ·ç«¯ä¿®æ”¹æˆ–åˆ é™¤ã€‚</p></li><li class="lvl-2"><p>å®‰å…¨éš”ç¦»ï¼šä¸åŒçš„åº”ç”¨æˆ–å›¢é˜Ÿå¯ä»¥åœ¨åŒä¸€ ZooKeeper é›†ç¾¤é‡Œå®‰å…¨å…±å­˜ã€‚</p></li></ul><h3 id="ACL-çš„ç»„æˆ">ACL çš„ç»„æˆ</h3><ul class="lvl-0"><li class="lvl-2"><p>zookeeper çš„ acl é€šè¿‡ <code>scheme:id:permissions</code> æ¥æ„æˆæƒé™åˆ—è¡¨ã€‚</p><ul class="lvl-2"><li class="lvl-4">schemeï¼šæˆæƒçš„æ¨¡å¼ï¼Œä»£è¡¨é‡‡ç”¨çš„æŸç§æƒé™æœºåˆ¶ï¼ŒåŒ…æ‹¬ worldã€authã€digestã€ipã€super å‡ ç§ã€‚</li><li class="lvl-4">idï¼šæˆæƒå¯¹è±¡ï¼Œä»£è¡¨å…è®¸è®¿é—®çš„ç”¨æˆ·ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹©é‡‡ç”¨ IP æ–¹å¼ï¼Œä½¿ç”¨çš„æˆæƒå¯¹è±¡å¯ä»¥æ˜¯ä¸€ä¸ª IP åœ°å€æˆ– IP åœ°å€æ®µï¼›è€Œå¦‚æœä½¿ç”¨ Digest æˆ– Super æ–¹å¼ï¼Œåˆ™å¯¹åº”äºä¸€ä¸ªç”¨æˆ·åã€‚å¦‚æœæ˜¯ World æ¨¡å¼ï¼Œæ˜¯æˆæƒç³»ç»Ÿä¸­æ‰€æœ‰çš„ç”¨æˆ·ã€‚</li><li class="lvl-4">permissionsï¼šæˆæƒçš„æƒé™ï¼Œæƒé™ç»„åˆå­—ç¬¦ä¸²ï¼Œç”± cdrwa ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªå­—æ¯ä»£è¡¨æ”¯æŒä¸åŒæƒé™ï¼Œ åˆ›å»ºæƒé™ createÂ©ã€åˆ é™¤æƒé™ delete(d)ã€è¯»æƒé™ readÂ®ã€å†™æƒé™ write(w)ã€ç®¡ç†æƒé™admin(a)ã€‚</li></ul></li></ul><h3 id="å¸¸è§çš„-scheme-ç±»å‹">å¸¸è§çš„ scheme ç±»å‹</h3><table><thead><tr><th>Scheme</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>world</code></td><td>å¼€æ”¾ç»™æ‰€æœ‰ç”¨æˆ·ï¼Œä»…å¯è®¾ç½®ä¸º <code>anyone</code> ä»£è¡¨æ‰€æœ‰å®¢æˆ·ç«¯</td><td><code>world:anyone:r</code></td></tr><tr><td><code>auth</code></td><td>å·²é€šè¿‡ <code>addauth</code> æ·»åŠ è®¤è¯çš„å®¢æˆ·ç«¯</td><td><code>auth:user1:rw</code></td></tr><tr><td><code>digest</code></td><td>ç”¨æˆ·å+å¯†ç è®¤è¯ï¼ˆå¸¸ç”¨ï¼‰ï¼Œ<code>user:pwd</code> éœ€è¦åŠ å¯†å­˜å‚¨</td><td><code>digest:user1:password:rw</code></td></tr><tr><td><code>ip</code></td><td>åŸºäº IP åœ°å€æ§åˆ¶è®¿é—®</td><td><code>ip:192.168.1.10:r</code></td></tr><tr><td><code>super</code></td><td>è¶…çº§ç”¨æˆ·ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™</td><td><code>super:admin:secret</code></td></tr></tbody></table><h3 id="æƒé™ç±»å‹">æƒé™ç±»å‹</h3><table><thead><tr><th>æƒé™å­—ç¬¦</th><th>æƒé™åç§°</th><th>å…è®¸çš„æ“ä½œ/å‘½ä»¤ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong><code>r</code></strong></td><td>è¯»å–(Read)</td><td><code>get /node</code> <br> <code>ls /node</code> <br> <code>getAcl /node</code></td><td>å…è®¸è¯»å–èŠ‚ç‚¹æ•°æ®å’Œå­èŠ‚ç‚¹åˆ—è¡¨</td></tr><tr><td><strong><code>w</code></strong></td><td>å†™å…¥(Write)</td><td><code>set /node data</code></td><td>å…è®¸ä¿®æ”¹èŠ‚ç‚¹æ•°æ®</td></tr><tr><td><strong><code>c</code></strong></td><td>åˆ›å»º(Create)</td><td><code>create /node/sub &quot;data&quot;</code></td><td>å…è®¸åœ¨å½“å‰èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹</td></tr><tr><td><strong><code>d</code></strong></td><td>åˆ é™¤(Delete)</td><td><code>delete /node/sub</code></td><td>å…è®¸åˆ é™¤å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</td></tr><tr><td><strong><code>a</code></strong></td><td>ç®¡ç†(Admin)</td><td><code>setAcl /node acl</code></td><td>å…è®¸ä¿®æ”¹ ACL æƒé™</td></tr></tbody></table><h3 id="å…¸å‹åº”ç”¨åœºæ™¯">å…¸å‹åº”ç”¨åœºæ™¯</h3><table><thead><tr><th>è®¤è¯æ–¹å¼ï¼ˆschemeï¼‰</th><th>æƒé™ç±»å‹ï¼ˆpermissionsï¼‰</th><th>å…¸å‹ ACL é…ç½®ç¤ºä¾‹</th><th>åº”ç”¨åœºæ™¯</th><th>ç‰¹ç‚¹è¯´æ˜</th></tr></thead><tbody><tr><td><strong>world</strong></td><td><code>r</code>ï¼ˆåªè¯»ï¼‰</td><td><code>world:anyone:r</code></td><td>å…¬å…±é…ç½®èŠ‚ç‚¹ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½å¯è¯»å–</td><td>ç®€å•ã€æ— è®¤è¯ï¼Œé€‚åˆå¯¹å®‰å…¨æ€§è¦æ±‚ä¸é«˜çš„åªè¯»åœºæ™¯</td></tr><tr><td><strong>auth</strong></td><td><code>r,w,c,d,a</code>ï¼ˆå¯ç»„åˆï¼‰</td><td><code>auth:user:rwcd</code></td><td>å†…éƒ¨åº”ç”¨å…±äº«èŠ‚ç‚¹ï¼Œéœ€å®¢æˆ·ç«¯è®¤è¯</td><td>éœ€å…ˆ <code>addauth digest user1:password</code> æ·»åŠ è®¤è¯ï¼Œé€‚åˆå¤šå®¢æˆ·ç«¯å…±äº«</td></tr><tr><td><strong>digest</strong>ï¼ˆå¸¸ç”¨ï¼‰</td><td><code>r,w,c,d,a</code>ï¼ˆå¯ç»„åˆï¼‰</td><td><code>digest:user:secret:crwda</code></td><td>é«˜å®‰å…¨èŠ‚ç‚¹ï¼Œé…ç½®ä¸­å¿ƒï¼Œåˆ†å¸ƒå¼é”</td><td>ç”¨æˆ·å+å¯†ç è®¤è¯ï¼Œéœ€åŠ å¯†å­˜å‚¨å¯†ç ï¼Œçµæ´»å®‰å…¨</td></tr><tr><td><strong>ip</strong></td><td><code>r,w,c,d,a</code>ï¼ˆå¯ç»„åˆï¼‰</td><td><code>ip:192.168.1.100:r</code></td><td>åŸºäº IP é™åˆ¶è®¿é—®çš„åœºæ™¯</td><td>å¿«é€Ÿæ§åˆ¶æŸäº›å›ºå®š IP å¯è®¿é—®ï¼Œé€‚åˆå†…éƒ¨ç½‘ç»œåº”ç”¨</td></tr></tbody></table><h3 id="ACL-ç›¸å…³å‘½ä»¤">ACL ç›¸å…³å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯­æ³•</th><th>åŠŸèƒ½è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>getAcl</strong></td><td><code>getAcl path</code></td><td>è¯»å–æŒ‡å®šèŠ‚ç‚¹çš„ ACL</td><td><code>getAcl /my_node</code></td></tr><tr><td><strong>setAcl</strong></td><td><code>setAcl path acl</code></td><td>è®¾ç½®æŒ‡å®šèŠ‚ç‚¹çš„ ACL</td><td><code>setAcl /my_node world:anyone:crdwa</code></td></tr><tr><td><strong>create</strong></td><td><code>create path data [acl]</code></td><td>åˆ›å»ºèŠ‚ç‚¹æ—¶æŒ‡å®š ACL</td><td><code>create /secure_node &quot;secret_data&quot; digest:user1:pwd:crwa</code></td></tr><tr><td><strong>addAuth</strong></td><td><code>addauth scheme auth</code></td><td>æ·»åŠ è®¤è¯ç”¨æˆ·ï¼ˆç±»ä¼¼ç™»å½•ï¼‰</td><td><code>addauth digest user1:password</code></td></tr><tr><td><strong>deleteAcl(ä¸å­˜åœ¨)</strong></td><td><code>setAcl path world:anyone:</code></td><td>åˆ é™¤èŠ‚ç‚¹ ACLï¼ˆè®¾ä¸ºç©ºæˆ–å…¨å¼€æ”¾ï¼‰</td><td><code>setAcl /my_node world:anyone:</code></td></tr></tbody></table><h3 id="auth-ä¸-digest-çš„åŒºåˆ«"><code>auth</code> ä¸ <code>digest</code> çš„åŒºåˆ«</h3><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨ <code>auth</code> æ—¶ï¼Œéœ€å…ˆ <code>addauth digest user1:password</code> æ·»åŠ è®¤è¯ï¼Œ<code>setAcl</code> æ—¶ï¼Œä½¿ç”¨ <code>auth:user1:rw</code>ï¼Œè¿™é‡Œæ˜¯ä¸ºå·²ç»ç™»å½•çš„ç”¨æˆ·è®¾ç½®èŠ‚ç‚¹æƒé™ï¼Œæ‰€ä»¥ä¸éœ€è¦è®¾ç½®å¯†ç </p></li><li class="lvl-2"><p>ä½¿ç”¨ <code>digest</code> æ—¶ï¼Œæ— éœ€è¿›è¡Œç™»å½•è®¤è¯ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šå¯†ç ï¼Œå³<code>setAcl</code> æ—¶ï¼Œä½¿ç”¨ <code>digest:user1:password:rw</code></p></li><li class="lvl-2"><p><code>digest</code> çš„å¯†ç æ˜¯ç»è¿‡åŠ å¯†çš„ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨æ˜æ–‡å¯†ç </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ å¯†å¯†ç </span></span><br><span class="line"><span class="built_in">echo</span> -n user:123456 | openssl dgst -binary -sha1 | openssl <span class="built_in">base64</span></span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">6DY5WhzOfGsWQ1XFuIyzxkpwdPo=</span><br><span class="line"></span><br><span class="line"><span class="comment"># zookeeperå®¢æˆ·ç«¯ä¸­è®¾ç½®æƒé™</span></span><br><span class="line">setAcl /name digest:user:6DY5WhzOfGsWQ1XFuIyzxkpwdPo=:cdrwa</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½•æ—¶å¯†ç æ˜¯æ˜æ–‡</span></span><br><span class="line">addauth digest user:123456</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ— è®ºä½¿ç”¨ <code>digest</code> è¿˜æ˜¯ <code>auth</code>ï¼Œåœ¨éœ€è¦è®¿é—®èŠ‚ç‚¹å‰ï¼Œéƒ½éœ€è¦å…ˆç™»å½•ã€‚</p></li></ul><h3 id="super-è¶…çº§ç®¡ç†å‘˜"><code>super</code> è¶…çº§ç®¡ç†å‘˜</h3><ul class="lvl-0"><li class="lvl-2"><p>æ‹¥æœ‰å…¨éƒ¨èŠ‚ç‚¹çš„æ‰€æœ‰æƒé™: <code>crwda</code></p></li><li class="lvl-2"><p>è®¾ç½®è¶…çº§ç®¡ç†å‘˜</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ å¯†å¯†ç ï¼Œç”¨æˆ·å’Œå¯†ç å¯ä»¥éšæ„è®¾ç½®</span></span><br><span class="line"><span class="built_in">echo</span> -n admin:123456 | openssl dgst -binary -sha1 | openssl <span class="built_in">base64</span></span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">0uek/hZ/V9fgiM35b0Z2226acMQ=</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€ conf/zoo.cfg æ–‡ä»¶å¹¶ç¼–è¾‘ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢å†…å®¹</span></span><br><span class="line">DigestAuthenticationProvider.superDigest=admin:0uek/hZ/V9fgiM35b0Z2226acMQ=</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡æ–°å¯åŠ¨æœåŠ¡åç™»å½•å®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºèŠ‚ç‚¹å¹¶è®¾ç½®æƒé™ï¼Œè¿™é‡Œå°†èŠ‚ç‚¹æˆæƒç»™ç”¨æˆ·user</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 10] create /testNode 666 digest:user:6DY5WhzOfGsWQ1XFuIyzxkpwdPo=:rw</span><br><span class="line">Created /testNode</span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹è¢«æ‹’ç»</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 11] get /testNode</span><br><span class="line">Insufficient permission : /testNode</span><br><span class="line"><span class="comment"># ç™»å½•superç”¨æˆ·ï¼ŒéªŒè¯è¶…çº§ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®èŠ‚ç‚¹</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 12] addauth digest admin:123456</span><br><span class="line"><span class="comment"># æ­¤æ—¶æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹å°±å¯ä»¥äº†</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 13] get /testNode</span><br><span class="line">666</span><br></pre></td></tr></table></figure><h2 id="4å­—æ¯å‘½ä»¤">4å­—æ¯å‘½ä»¤</h2><h3 id="ä»€ä¹ˆæ˜¯-4-å­—æ¯å‘½ä»¤">ä»€ä¹ˆæ˜¯ <code>4 å­—æ¯å‘½ä»¤</code>?</h3><ul class="lvl-0"><li class="lvl-2"><p>ZooKeeper æä¾›äº†ä¸€ç»„ç®€çŸ­çš„ <code>4ä¸ªå­—æ¯çš„ç®¡ç†å‘½ä»¤</code>(Four Letter Words Commands, 4lw)ï¼Œå¯ä»¥é€šè¿‡ TCP è¿æ¥ ZooKeeper ç«¯å£ï¼ˆé»˜è®¤ 2181ï¼‰å‘é€è¿™äº›å‘½ä»¤ï¼Œå¿«é€ŸæŸ¥çœ‹æˆ–ç®¡ç† ZooKeeper çŠ¶æ€ã€‚</p></li><li class="lvl-2"><p>å¸¸ç”¨çš„ <code>4å­—æ¯å‘½ä»¤</code></p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>å¼•å…¥ç‰ˆæœ¬</th><th>åŠŸèƒ½æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>conf</code></td><td>3.3.0</td><td>æ‰“å°æœåŠ¡ç›¸å…³é…ç½®çš„è¯¦ç»†ä¿¡æ¯</td><td><code>echo conf | nc 127.0.0.1 2181</code></td></tr><tr><td><code>cons</code></td><td>3.3.0</td><td>åˆ—å‡ºæ‰€æœ‰è¿æ¥åˆ°è¯¥æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥/ä¼šè¯è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥æ”¶/å‘é€çš„åŒ…æ•°é‡ã€ä¼šè¯IDã€æ“ä½œå»¶è¿Ÿã€æœ€åæ“ä½œæ‰§è¡Œæ—¶é—´ç­‰</td><td><code>echo cons | nc 127.0.0.1 2181</code></td></tr><tr><td><code>crst</code></td><td>3.3.0</td><td>é‡ç½®æ‰€æœ‰è¿æ¥çš„è¿æ¥å’Œä¼šè¯ç»Ÿè®¡ä¿¡æ¯</td><td><code>echo crst | nc 127.0.0.1 2181</code></td></tr><tr><td><code>dump</code></td><td>-</td><td>åˆ—å‡ºé‡è¦çš„ä¼šè¯å’Œä¸´æ—¶èŠ‚ç‚¹ä¿¡æ¯ï¼Œä»…åœ¨ Leader èŠ‚ç‚¹ä¸Šæœ‰æ•ˆ</td><td><code>echo dump | nc 127.0.0.1 2181</code></td></tr><tr><td><code>envi</code></td><td>-</td><td>æ‰“å°æœåŠ¡ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯</td><td><code>echo envi | nc 127.0.0.1 2181</code></td></tr><tr><td><code>reqs</code></td><td>-</td><td>åˆ—å‡ºæœªç»å¤„ç†çš„è¯·æ±‚</td><td><code>echo reqs | nc 127.0.0.1 2181</code></td></tr><tr><td><code>ruok</code></td><td>-</td><td>æµ‹è¯•æœåŠ¡æ˜¯å¦å¤„äºæ­£å¸¸çŠ¶æ€ï¼›æ­£å¸¸è¿”å› <code>imok</code></td><td><code>echo ruok | nc 127.0.0.1 2181</code></td></tr><tr><td><code>stat</code></td><td>-</td><td>è¾“å‡ºå…³äºæ€§èƒ½å’Œå®¢æˆ·ç«¯è¿æ¥çš„åˆ—è¡¨ä¿¡æ¯</td><td><code>echo stat | nc 127.0.0.1 2181</code></td></tr><tr><td><code>srst</code></td><td>-</td><td>é‡ç½®æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯</td><td><code>echo srst | nc 127.0.0.1 2181</code></td></tr><tr><td><code>srvr</code></td><td>3.3.0</td><td>åˆ—å‡ºè¿æ¥æœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯</td><td><code>echo srvr | nc 127.0.0.1 2181</code></td></tr><tr><td><code>wchs</code></td><td>3.3.0</td><td>åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯</td><td><code>echo wchs | nc 127.0.0.1 2181</code></td></tr><tr><td><code>wchc</code></td><td>3.3.0</td><td>é€šè¿‡ä¼šè¯åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ Watch ç›¸å…³çš„ä¼šè¯åˆ—è¡¨</td><td><code>echo wchc | nc 127.0.0.1 2181</code></td></tr><tr><td><code>wchp</code></td><td>3.3.0</td><td>é€šè¿‡è·¯å¾„åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ä¼šè¯ç›¸å…³çš„è·¯å¾„</td><td><code>echo wchp | nc 127.0.0.1 2181</code></td></tr><tr><td><code>mntr</code></td><td>3.4.0</td><td>è¾“å‡ºå¯ç”¨äºæ£€æµ‹é›†ç¾¤å¥åº·çŠ¶æ€çš„å…³é”®æŒ‡æ ‡å˜é‡åˆ—è¡¨</td><td><code>echo mntr | nc 127.0.0.1 2181</code></td></tr></tbody></table><h3 id="å¼€å¯-4å­—æ¯å‘½ä»¤">å¼€å¯ <code>4å­—æ¯å‘½ä»¤</code></h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ ZooKeeper 3.5.0 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œ4lw å‘½ä»¤é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå¿…é¡»åœ¨é…ç½®æ–‡ä»¶(zoo.cfg)ä¸­æ˜¾å¼å¼€å¯ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¡¨ç¤ºå…è®¸æ‰€æœ‰ 4lw å‘½ä»¤éƒ½èƒ½ç”¨ï¼ˆé£é™©æœ€å¤§ï¼‰</span></span><br><span class="line">4lw.commands.whitelist=*</span><br><span class="line"><span class="comment"># è¿™æ ·åªå…è®¸æ‰§è¡Œ statã€confã€ruok è¿™å‡ ä¸ªå‘½ä»¤ã€‚</span></span><br><span class="line">4lw.commands.whitelist=<span class="built_in">stat</span>,conf,ruok</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨æ–¹æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæ²¡æœ‰å®‰è£… ncï¼Œå¯ä»¥ä½¿ç”¨ yum å®‰è£…</span></span><br><span class="line">yum install nc -y</span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">stat</span> | nc 127.0.0.1 2181</span><br></pre></td></tr></table></figure><h2 id="Zookeeper-Java-Client">Zookeeper Java Client</h2><ul class="lvl-0"><li class="lvl-2"><p>é¡¹ç›®ç¤ºä¾‹ï¼š<a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/zookeeper-demo/">Githubåœ°å€</a>ï¼Œå•å…ƒæµ‹è¯•ã€‚</p></li></ul><h3 id="Zookeeper-å®˜æ–¹Javaå®¢æˆ·ç«¯">Zookeeper å®˜æ–¹Javaå®¢æˆ·ç«¯</h3><ul class="lvl-0"><li class="lvl-2"><p>ZooKeeperå®˜æ–¹çš„å®¢æˆ·ç«¯APIæä¾›äº†åŸºæœ¬çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¼šè¯ã€åˆ›å»ºèŠ‚ç‚¹ã€è¯»å–èŠ‚ç‚¹ã€æ›´æ–°æ•°æ®ã€åˆ é™¤èŠ‚ç‚¹å’Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ç­‰ã€‚ä¸è¿‡ï¼Œå¯¹äºå®é™…å¼€å‘æ¥è¯´ï¼ŒZooKeeperå®˜æ–¹APIæœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul class="lvl-2"><li class="lvl-4">ZooKeeperçš„Watcherç›‘æµ‹æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ¯æ¬¡è§¦å‘ä¹‹åéƒ½éœ€è¦é‡æ–°è¿›è¡Œæ³¨å†Œã€‚</li><li class="lvl-4">ä¼šè¯è¶…æ—¶ä¹‹åæ²¡æœ‰å®ç°é‡è¿æœºåˆ¶ã€‚</li><li class="lvl-4">å¼‚å¸¸å¤„ç†çƒ¦çï¼ŒZooKeeperæä¾›äº†å¾ˆå¤šå¼‚å¸¸ï¼Œå¯¹äºå¼€å‘äººå‘˜æ¥è¯´å¯èƒ½æ ¹æœ¬ä¸çŸ¥é“åº”è¯¥å¦‚ä½•å¤„ç†è¿™äº›æŠ›å‡ºçš„å¼‚å¸¸ã€‚</li><li class="lvl-4">ä»…æä¾›äº†ç®€å•çš„byte[]æ•°ç»„ç±»å‹çš„æ¥å£ï¼Œæ²¡æœ‰æä¾›Java POJOçº§åˆ«çš„åºåˆ—åŒ–æ•°æ®å¤„ç†æ¥å£ã€‚</li><li class="lvl-4">åˆ›å»ºèŠ‚ç‚¹æ—¶å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦è‡ªè¡Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ã€‚</li><li class="lvl-4">æ— æ³•å®ç°çº§è”åˆ é™¤ã€‚</li><li class="lvl-4">æ€»ä¹‹ï¼ŒZooKeeperå®˜æ–¹APIåŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­æ¯”è¾ƒç¬¨é‡ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚</li></ul></li><li class="lvl-2"><p>é¡¹ç›®å¼•å…¥ä¾èµ–æ—¶ï¼Œæœ€å¥½ä¿æŒä¸æœåŠ¡ç«¯ç‰ˆæœ¬ä¸€è‡´ï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰ä¸€äº›å…¼å®¹æ€§çš„é—®é¢˜</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- zookeeper client --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Zookeeper-ç¬¬ä¸‰æ–¹Javaå®¢æˆ·ç«¯-Curator">Zookeeper ç¬¬ä¸‰æ–¹Javaå®¢æˆ·ç«¯ Curator</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://curator.apache.org/docs/about">Curator</a>æ˜¯Netflixå…¬å¸å¼€æºçš„ä¸€å¥—ZooKeeperå®¢æˆ·ç«¯æ¡†æ¶ï¼Œå’ŒZkClientä¸€æ ·å®ƒè§£å†³äº†éå¸¸åº•å±‚çš„ç»†èŠ‚å¼€å‘å·¥ä½œï¼ŒåŒ…æ‹¬è¿æ¥ã€é‡è¿ã€åå¤æ³¨å†ŒWatcherçš„é—®é¢˜ä»¥åŠNodeExistsExceptionå¼‚å¸¸ç­‰ã€‚</p></li><li class="lvl-2"><p>Curatoræ˜¯ApacheåŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ä¹‹ä¸€ï¼ŒCuratorå…·æœ‰æ›´åŠ å®Œå–„çš„æ–‡æ¡£ï¼Œå¦å¤–è¿˜æä¾›äº†ä¸€å¥—æ˜“ç”¨æ€§å’Œå¯è¯»æ€§æ›´å¼ºçš„Fluenté£æ ¼çš„å®¢æˆ·ç«¯APIæ¡†æ¶ã€‚</p></li><li class="lvl-2"><p>Curatorè¿˜ä¸ºZooKeeperå®¢æˆ·ç«¯æ¡†æ¶æä¾›äº†ä¸€äº›æ¯”è¾ƒæ™®éçš„ã€å¼€ç®±å³ç”¨çš„ã€åˆ†å¸ƒå¼å¼€å‘ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚Recipeã€å…±äº«é”æœåŠ¡ã€Masteré€‰ä¸¾æœºåˆ¶å’Œåˆ†å¸ƒå¼è®¡ç®—å™¨ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…é¿å…äº†â€œé‡å¤é€ è½®å­â€çš„æ— æ•ˆå¼€å‘å·¥ä½œã€‚</p></li><li class="lvl-2"><p>åœ¨å®é™…çš„å¼€å‘åœºæ™¯ä¸­ï¼Œä½¿ç”¨Curatorå®¢æˆ·ç«¯å°±è¶³ä»¥åº”ä»˜æ—¥å¸¸çš„ZooKeeperé›†ç¾¤æ“ä½œçš„éœ€æ±‚ã€‚</p></li><li class="lvl-2"><p>å¼•å…¥ä¾èµ–è¯´æ˜ï¼š</p></li></ul><table><thead><tr><th>æ¨¡å—</th><th>ä¾èµ–å…³ç³»</th><th>åŠŸèƒ½å®šä½</th><th>å…¸å‹åŠŸèƒ½ä¸¾ä¾‹</th><th>å¸¸ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>curator-client</strong></td><td>ä¾èµ– zookeeper</td><td>è¿æ¥ç®¡ç†ã€é‡è¯•ç­–ç•¥ã€åº•å±‚ API</td><td>è¿æ¥ä¼šè¯ç®¡ç†ã€RetryPolicy</td><td>éœ€è¦æœ€è½»é‡çš„ ZooKeeper å®¢æˆ·ç«¯</td></tr><tr><td><strong>curator-framework</strong></td><td>ä¾èµ– curator-client</td><td>é«˜å±‚ API å°è£…ï¼Œç®€åŒ– ZK æ“ä½œ</td><td>åˆ›å»ºèŠ‚ç‚¹ã€Watcher ç®¡ç†ã€è‡ªåŠ¨é‡è¿</td><td>é€šç”¨ ZooKeeper å®¢æˆ·ç«¯å¼€å‘</td></tr><tr><td><strong>curator-recipes</strong></td><td>ä¾èµ– curator-framework â†’ curator-client</td><td>åˆ†å¸ƒå¼æ¨¡å¼ç°æˆå®ç°</td><td>åˆ†å¸ƒå¼é”ã€Leader é€‰ä¸¾ã€é˜Ÿåˆ—ã€Barrier</td><td>ç›´æ¥ç”¨åˆ†å¸ƒå¼å·¥å…·ï¼Œæ— éœ€è‡ªå·±å®ç°</td></tr></tbody></table><blockquote><p>ä½¿ç”¨å»ºè®®</p></blockquote><ul class="lvl-0"><li class="lvl-4"><p>å¦‚æœä½ åªæƒ³è½»é‡è®¿é—® ZooKeeper â†’ <code>curator-client</code> å°±å¤Ÿäº†ï¼Œä½†å‡ ä¹æ²¡äººå•ç‹¬ç”¨ã€‚</p></li><li class="lvl-4"><p>å¦‚æœä½ æƒ³æ–¹ä¾¿æ“ä½œ ZooKeeper API â†’ <code>curator-framework</code>ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½é€‚ç”¨ã€‚</p></li><li class="lvl-4"><p>å¦‚æœä½ æƒ³ç”¨åˆ†å¸ƒå¼é”ã€é€‰ä¸¾ã€Barrier â†’ <code>curator-recipes</code>ï¼ˆå®ƒä¼šè‡ªåŠ¨å¼•å…¥å‰ä¸¤ä¸ªï¼‰ã€‚</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- zookeeper client --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--curator--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://zookeeper.apache.org&quot;&gt;Zookeeperå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Zookeeper ç‰ˆæœ¬ä¸º 3.8.4ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="zookeeper" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/zookeeper/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/zookeeper/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="zookeeper" scheme="https://blog.hanqunfeng.com/tags/zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>ShardingSphere-Proxy5.5.2 DistSQL</title>
    <link href="https://blog.hanqunfeng.com/2025/09/11/springboot3-shardingsphere-proxy-distsql/"/>
    <id>https://blog.hanqunfeng.com/2025/09/11/springboot3-shardingsphere-proxy-distsql/</id>
    <published>2025-09-11T13:30:05.000Z</published>
    <updated>2025-09-15T02:14:23.413Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» ShardingSphere-Proxy5.5.2 DistSQL çš„ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/index_zh.html">ShardingSphereå®˜ç½‘</a></p></li></ul><span id="more"></span><h2 id="DistSQL">DistSQL</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/">DistSQL</a>ï¼ˆDistributed SQLï¼‰æ˜¯ Apache ShardingSphere ç‰¹æœ‰çš„æ“ä½œè¯­è¨€ã€‚ å®ƒä¸æ ‡å‡† SQL çš„ä½¿ç”¨æ–¹å¼å®Œå…¨ä¸€è‡´ï¼Œç”¨äºæä¾›å¢é‡åŠŸèƒ½çš„ SQL çº§åˆ«æ“ä½œèƒ½åŠ›ã€‚</p></li><li class="lvl-2"><p>çµæ´»çš„è§„åˆ™é…ç½®å’Œèµ„æºç®¡æ§èƒ½åŠ›æ˜¯ Apache ShardingSphere çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚</p></li><li class="lvl-2"><p>åœ¨ä½¿ç”¨ 4.x åŠå…¶ä¹‹å‰ç‰ˆæœ¬æ—¶ï¼Œå¼€å‘è€…è™½ç„¶å¯ä»¥åƒä½¿ç”¨åŸç”Ÿæ•°æ®åº“ä¸€æ ·æ“ä½œæ•°æ®ï¼Œä½†å´éœ€è¦é€šè¿‡æœ¬åœ°æ–‡ä»¶æˆ–æ³¨å†Œä¸­å¿ƒé…ç½®èµ„æºå’Œè§„åˆ™ã€‚ç„¶è€Œï¼Œæ“ä½œä¹ æƒ¯å˜æ›´ï¼Œå¯¹äºè¿ç»´å·¥ç¨‹å¸ˆå¹¶ä¸å‹å¥½ã€‚</p></li><li class="lvl-2"><p>ä» 5.x ç‰ˆæœ¬å¼€å§‹ï¼ŒDistSQLï¼ˆDistributed SQLï¼‰è®©ç”¨æˆ·å¯ä»¥åƒæ“ä½œæ•°æ®åº“ä¸€æ ·æ“ä½œ Apache ShardingSphereï¼Œä½¿å…¶ä»é¢å‘å¼€å‘äººå‘˜çš„æ¡†æ¶å’Œä¸­é—´ä»¶è½¬å˜ä¸ºé¢å‘è¿ç»´äººå‘˜çš„æ•°æ®åº“äº§å“ã€‚</p></li><li class="lvl-2"><p>DistSQL ç»†åˆ†ä¸º RDLã€RQLã€RAL å’Œ RUL å››ç§ç±»å‹ã€‚</p><ul class="lvl-2"><li class="lvl-4">RDL: Resource &amp; Rule Definition Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤ã€‚</li><li class="lvl-4">RQL: Resource &amp; Rule Query Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„æŸ¥è¯¢å’Œå±•ç°ã€‚</li><li class="lvl-4">RAL: Resource &amp; Rule Administration Languageï¼Œè´Ÿè´£å¼ºåˆ¶è·¯ç”±ã€ç†”æ–­ã€é…ç½®å¯¼å…¥å¯¼å‡ºã€æ•°æ®è¿ç§»æ§åˆ¶ç­‰ç®¡ç†åŠŸèƒ½ã€‚</li><li class="lvl-4">RUL: Resource &amp; Rule Utility Languageï¼Œè´Ÿè´£ SQL è§£æã€SQL æ ¼å¼åŒ–ã€æ‰§è¡Œè®¡åˆ’é¢„è§ˆç­‰åŠŸèƒ½ã€‚</li></ul></li><li class="lvl-2"><p>DistSQL ä»…å¯ä»¥åœ¨ ShardingSphere-Proxy ä¸­ä½¿ç”¨ï¼Œä¸èƒ½åœ¨ ShardingSphere-JDBC ä¸­ä½¿ç”¨ã€‚</p></li></ul><h2 id="ç¤ºä¾‹å‡†å¤‡">ç¤ºä¾‹å‡†å¤‡</h2><ul class="lvl-0"><li class="lvl-2"><p>å…·ä½“çš„è¯­æ³•ï¼Œå®˜ç½‘ä»‹ç»çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡ŒåŸºäº <a href="/2025/09/04/springboot3-shardingsphere-proxy/" title="SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨">SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨</a> ä¸­çš„é…ç½®è¿›è¡Œç¤ºä¾‹è¯´æ˜ã€‚</p></li><li class="lvl-2"><p>ä¸ºäº†å°½å¯èƒ½å¤šçš„ä½¿ç”¨ DistSQL è¯­æ³•ï¼Œè¿™é‡Œä»…åœ¨ <code>global.yaml</code> ä¸­é…ç½®å¦‚ä¸‹å†…å®¹:</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®ä¸ºåŸºäº zookeeper é›†ç¾¤æ¨¡å¼ï¼Œä¸ºäº†æ¼”ç¤º DistSQL è¯­æ³•ï¼Œè¿™é‡Œéœ€è¦å°†é…ç½®æŒä¹…åŒ–ï¼Œä½¿ç”¨ JDBC çš„å•æœºæ¨¡å¼ä¹Ÿå¯ä»¥</span></span><br><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Cluster</span>                 <span class="comment"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ZooKeeper</span>             <span class="comment"># æ³¨å†Œä¸­å¿ƒç±»å‹</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">governance_ds</span>  <span class="comment"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class="line">      <span class="attr">server-lists:</span> <span class="string">localhost:2181</span> <span class="comment"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class="line">      <span class="attr">retryIntervalMilliseconds:</span> <span class="number">500</span> <span class="comment"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class="line">      <span class="attr">timeToLiveSeconds:</span> <span class="number">60</span>     <span class="comment"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class="line">      <span class="attr">maxRetries:</span> <span class="number">3</span>             <span class="comment"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class="line">      <span class="attr">operationTimeoutMilliseconds:</span> <span class="number">500</span>  <span class="comment"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç”¨æˆ·å’Œæƒé™ï¼Œå› ä¸º DistSQL æš‚ä¸æ”¯æŒ ç”¨æˆ·å’Œæƒé™ç®¡ç†ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å…ˆé…ç½®ç”¨æˆ·å’Œæƒé™</span></span><br><span class="line"><span class="attr">authority:</span></span><br><span class="line">  <span class="attr">users:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">user:</span> <span class="string">root@127.0.0.1</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">admin:</span> <span class="literal">true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">user:</span> <span class="string">sharding@%</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">sharding</span></span><br><span class="line">  <span class="attr">privilege:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DATABASE_PERMITTED</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">user-database-mappings:</span> <span class="string">root@127.0.0.1=*,sharding@%=sharding_db</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ ShardingSphere-Proxy æœåŠ¡ï¼Œå¹¶ç™»å½•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ ShardingSphere-Proxy</span></span><br><span class="line">./shardingsphere-proxy-bin/bin/start.sh</span><br><span class="line"><span class="comment"># ä½¿ç”¨ç®¡ç†å‘˜ç™»å½•</span></span><br><span class="line">mysql -h127.0.0.1 -uroot -proot -P3307</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™</span></span><br><span class="line">mysql&gt; SHOW AUTHORITY RULE;</span><br><span class="line">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class="line">| <span class="built_in">users</span>                      | provider           | props                                                                |</span><br><span class="line">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class="line">| root@127.0.0.1; sharding@% | DATABASE_PERMITTED | &#123;<span class="string">&quot;user-database-mappings&quot;</span>:<span class="string">&quot;root@127.0.0.1=*,sharding@%=sharding_db&quot;</span>&#125; |</span><br><span class="line">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.49 sec)</span><br></pre></td></tr></table></figure><h2 id="å…¨å±€é…ç½®ï¼Œå³global-yamlä¸­çš„é…ç½®">å…¨å±€é…ç½®ï¼Œå³<code>global.yaml</code>ä¸­çš„é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>å…¨å±€é…ç½®å¯¹æ‰€æœ‰é€»è¾‘æ•°æ®åº“æœ‰æ•ˆ</p></li></ul><h3 id="å±æ€§é…ç½®">å±æ€§é…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span> <span class="comment"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure><h4 id="DistSQL-è¯­æ³•">DistSQL è¯­æ³•</h4><ul class="lvl-0"><li class="lvl-2"><p>è®¾ç½®å±æ€§ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/set-dist-vairable/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œè¦æ³¨æ„ï¼Œå±æ€§åéœ€è¦ä½¿ç”¨ä¸‹åˆ’çº¿æ ¼å¼</span></span><br><span class="line">SET DIST VARIABLE sql_show = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å±æ€§ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/show-dist-variable/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW DIST VARIABLES;</span><br><span class="line">+-----------------------------------------+-----------------+</span><br><span class="line">| variable_name                           | variable_value  |</span><br><span class="line">+-----------------------------------------+-----------------+</span><br><span class="line">| agent_plugins_enabled                   | <span class="literal">true</span>            |</span><br><span class="line">| cached_connections                      | 0               |</span><br><span class="line">| cdc_server_port                         | 33071           |</span><br><span class="line">| check_table_metadata_enabled            | <span class="literal">false</span>           |</span><br><span class="line">| kernel_executor_size                    | 0               |</span><br><span class="line">| load_table_metadata_batch_size          | 1000            |</span><br><span class="line">| max_connections_size_per_query          | 1               |</span><br><span class="line">| proxy_backend_query_fetch_size          | -1              |</span><br><span class="line">| proxy_default_port                      | 3307            |</span><br><span class="line">| proxy_frontend_database_protocol_type   |                 |</span><br><span class="line">| proxy_frontend_executor_size            | 0               |</span><br><span class="line">| proxy_frontend_flush_threshold          | 128             |</span><br><span class="line">| proxy_frontend_max_connections          | 0               |</span><br><span class="line">| proxy_frontend_ssl_cipher               |                 |</span><br><span class="line">| proxy_frontend_ssl_enabled              | <span class="literal">false</span>           |</span><br><span class="line">| proxy_frontend_ssl_version              | TLSv1.2,TLSv1.3 |</span><br><span class="line">| proxy_meta_data_collector_enabled       | <span class="literal">false</span>           |</span><br><span class="line">| proxy_netty_backlog                     | 1024            |</span><br><span class="line">| sql_show                                | <span class="literal">true</span>            |</span><br><span class="line">| sql_simple                              | <span class="literal">false</span>           |</span><br><span class="line">| system_log_level                        | INFO            |</span><br><span class="line">| system_schema_metadata_assembly_enabled | <span class="literal">true</span>            |</span><br><span class="line">+-----------------------------------------+-----------------+</span><br></pre></td></tr></table></figure><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡é…ç½®">åˆ†å¸ƒå¼äº‹åŠ¡é…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">transaction:</span></span><br><span class="line">  <span class="attr">defaultType:</span> <span class="string">XA</span></span><br><span class="line">  <span class="attr">providerType:</span> <span class="string">Atomikos</span></span><br></pre></td></tr></table></figure><h4 id="DistSQL-è¯­æ³•-2">DistSQL è¯­æ³•</h4><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹äº‹åŠ¡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/global-rule/show-transaction-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW TRANSACTION RULE;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹äº‹åŠ¡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/global-rule/alter-transaction-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TRANSACTION RULE(</span><br><span class="line">  DEFAULT=<span class="string">&quot;XA&quot;</span>, TYPE(NAME=<span class="string">&quot;Atomikos&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="è§„åˆ™é…ç½®ï¼Œå³database-xxx-yamlä¸­çš„é…ç½®">è§„åˆ™é…ç½®ï¼Œå³<code>database-xxx.yaml</code>ä¸­çš„é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>ä»¥ä¸‹ DistSQL ä»…å¯ä»¥åœ¨é€»è¾‘åº“ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªé€»è¾‘æ•°æ®åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE sharding_db;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use sharding_db;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®æºé…ç½®">æ•°æ®æºé…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ DistSQLä¸­ï¼Œå®˜æ–¹å°†æ•°æ®æºå«åš<code>å­˜å‚¨å•å…ƒ(STORAGE UNIT)</code></p></li><li class="lvl-2"><p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_0:</span> <span class="comment"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>  <span class="comment"># æ³¨æ„è¿™é‡Œå±æ€§ä¸º url</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ds_1:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br></pre></td></tr></table></figure><h4 id="DistSQL-è¯­æ³•-3">DistSQL è¯­æ³•</h4><ul class="lvl-0"><li class="lvl-2"><p>æ³¨å†Œå­˜å‚¨å•å…ƒï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/register-storage-unit/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">REGISTER STORAGE UNIT ds_0 (</span><br><span class="line">    URL=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class="line">    USER=<span class="string">&quot;root&quot;</span>,</span><br><span class="line">    PASSWORD=<span class="string">&quot;newpwd&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">REGISTER STORAGE UNIT ds_1 (</span><br><span class="line">    URL=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class="line">    USER=<span class="string">&quot;root&quot;</span>,</span><br><span class="line">    PASSWORD=<span class="string">&quot;newpwd&quot;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢å­˜å‚¨å•å…ƒï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/storage-unit-query/show-storage-units/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW STORAGE UNITS FROM sharding_db \G;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹å­˜å‚¨å•å…ƒï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/alter-storage-unit/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ALTER STORAGE UNIT ds_1 (</span><br><span class="line">    URL=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class="line">    USER=<span class="string">&quot;root&quot;</span>,</span><br><span class="line">    PASSWORD=<span class="string">&quot;newpwd&quot;</span>,</span><br><span class="line">    PROPERTIES(<span class="string">&quot;maximumPoolSize&quot;</span>=10,<span class="string">&quot;idleTimeout&quot;</span>=30000)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å–æ¶ˆæ³¨å†Œå­˜å‚¨å•å…ƒï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/unregister-storage-unit/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ— æ³•ç§»é™¤å·²ç»è¢«è§„åˆ™ä½¿ç”¨çš„å­˜å‚¨å•å…ƒ</span></span><br><span class="line">UNREGISTER STORAGE UNIT ds_0;</span><br></pre></td></tr></table></figure><h3 id="å•è¡¨é…ç½®">å•è¡¨é…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SINGLE</span> <span class="comment"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="comment"># MySQL é£æ ¼</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ds_0.t_address</span> <span class="comment"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br></pre></td></tr></table></figure><h4 id="DistSQL-è¯­æ³•-4">DistSQL è¯­æ³•</h4><ul class="lvl-0"><li class="lvl-2"><p>åŠ è½½å•è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/single-table/load-single-table/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD SINGLE TABLE ds_0.t_address;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢å•è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/single-table/show-single-table/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW SINGLE TABLES;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¸è½½å•è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/single-table/unload-single-table/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNLOAD SINGLE TABLE ds_0.t_address;</span><br></pre></td></tr></table></figure><h3 id="å¹¿æ’­è¡¨é…ç½®">å¹¿æ’­è¡¨é…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!BROADCAST</span>  <span class="comment"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dict</span>    <span class="comment"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure><h4 id="DistSQL-è¯­æ³•-5">DistSQL è¯­æ³•</h4><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºå¹¿æ’­è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/broadcast-table/create-broadcast-table-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE BROADCAST TABLE RULE dict;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤å¹¿æ’­è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/broadcast-table/drop-broadcast-table-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP BROADCAST TABLE RULE dict;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢å¹¿æ’­è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/broadcast-table/show-broadcast-table-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨</span></span><br><span class="line">SHOW BROADCAST TABLE RULES;</span><br><span class="line"><span class="comment"># æŸ¥è¯¢æŒ‡å®šæ•°æ®åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨</span></span><br><span class="line">SHOW BROADCAST TABLE RULES FROM sharding_db;</span><br></pre></td></tr></table></figure><h3 id="åˆ†åº“åˆ†è¡¨é…ç½®">åˆ†åº“åˆ†è¡¨é…ç½®</h3><h4 id="å•åˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹">å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">course:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">cid</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_inline</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">cid</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">course_inline:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># å±æ€§</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">course_$&#123;cid</span> <span class="string">%</span> <span class="number">2</span> <span class="string">+</span> <span class="number">1</span><span class="string">&#125;</span> <span class="comment"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class="line">          <span class="attr">allow-range-query-with-inline-sharding:</span> <span class="literal">true</span> <span class="comment"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">      <span class="attr">course_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span> <span class="comment"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-6">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/create-sharding-table-rule/#1%E6%A0%87%E5%87%86%E5%88%86%E7%89%87%E8%A7%84%E5%88%99">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE SHARDING TABLE RULE course (</span><br><span class="line">  DATANODES(<span class="string">&quot;ds_<span class="variable">$&#123;0..1&#125;</span>.course_<span class="variable">$&#123;1..2&#125;</span>&quot;</span>),</span><br><span class="line">  DATABASE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;ds_<span class="variable">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class="line">  TABLE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=cid,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;course_<span class="variable">$&#123;cid % 2 + 1&#125;</span>&quot;</span>,<span class="string">&quot;allow-range-query-with-inline-sharding&quot;</span>=<span class="literal">true</span> )))),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=cid,TYPE(NAME=<span class="string">&quot;snowflake&quot;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="å•åˆ†ç‰‡é”®ï¼ŒString-ç±»å‹">å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_user:</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">id</span> <span class="comment"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line"><span class="comment">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">custom_snowflake_string</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_user_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span> <span class="comment"># åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®—</span></span><br><span class="line">      <span class="attr">t_user_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span> <span class="comment"># åˆ†è¡¨ï¼Œt_user_0, t_user_1</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</span></span><br><span class="line">      <span class="attr">uuid:</span>    <span class="comment"># å®šä¹‰åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">UUID</span> <span class="comment"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class="line">      <span class="attr">custom_snowflake_string:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CUSTOM_SNOWFLAKE_STRING</span> <span class="comment"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">workerId:</span> <span class="number">2</span></span><br><span class="line">          <span class="attr">datacenterId:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-7">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE SHARDING TABLE RULE t_user (</span><br><span class="line">  DATANODES(<span class="string">&quot;ds_<span class="variable">$&#123;0..1&#125;</span>.t_user_<span class="variable">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class="line">  DATABASE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=<span class="built_in">id</span>,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;ds_<span class="variable">$&#123;Math.abs(id.hashCode()%2)&#125;</span>&quot;</span>)))),</span><br><span class="line">  TABLE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=<span class="built_in">id</span>,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;t_user_<span class="variable">$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span>&quot;</span>)))),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=<span class="built_in">id</span>,TYPE(NAME=<span class="string">&quot;CUSTOM_SNOWFLAKE_STRING&quot;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="å¤šåˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹">å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order-complex-algorithm</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class="line"><span class="comment">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_item-class-based-algorithm_spi</span> <span class="comment"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_order_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order-complex-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">COMPLEX_INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_order_complex_$&#123;(user_id</span> <span class="string">+</span> <span class="string">order_id</span> <span class="string">+</span> <span class="number">1</span><span class="string">)</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm_spi:</span> <span class="comment"># SPI</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">T_ORDER_ITEM_COMPLEX</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-8">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE SHARDING TABLE RULE t_order_complex (</span><br><span class="line">  DATANODES(<span class="string">&quot;ds_<span class="variable">$&#123;0..1&#125;</span>.t_order_complex_<span class="variable">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class="line">  DATABASE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;ds_<span class="variable">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class="line">  TABLE_STRATEGY(TYPE=<span class="string">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;complex_inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;t_order_complex_<span class="variable">$&#123;(user_id + order_id + 1) % 2&#125;</span>&quot;</span>)))),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=<span class="string">&quot;snowflake&quot;</span>))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE SHARDING TABLE RULE t_order_item_complex (</span><br><span class="line">  DATANODES(<span class="string">&quot;ds_<span class="variable">$&#123;0..1&#125;</span>.t_order_item_complex_<span class="variable">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class="line">  DATABASE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;ds_<span class="variable">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class="line">  TABLE_STRATEGY(TYPE=<span class="string">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;T_ORDER_ITEM_COMPLEX&quot;</span>))),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class="string">&quot;SNOWFLAKE&quot;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™">è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</h4><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">   <span class="comment"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class="line">    <span class="attr">bindingTables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t_order,t_order_item</span></span><br><span class="line">    <span class="attr">autoTables:</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">mod_2:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MOD</span> <span class="comment"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">sharding-count:</span> <span class="number">2</span> <span class="comment"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-9">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE SHARDING TABLE RULE t_order (</span><br><span class="line">  STORAGE_UNITS(ds_0,ds_1),</span><br><span class="line">  SHARDING_COLUMN=user_id,TYPE(NAME=<span class="string">&quot;mod&quot;</span>,PROPERTIES(<span class="string">&quot;sharding-count&quot;</span>=<span class="string">&quot;2&quot;</span>)),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=<span class="string">&quot;snowflake&quot;</span>))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE SHARDING TABLE RULE t_order_item (</span><br><span class="line">  STORAGE_UNITS(ds_0,ds_1),</span><br><span class="line">  SHARDING_COLUMN=user_id,TYPE(NAME=<span class="string">&quot;mod&quot;</span>,PROPERTIES(<span class="string">&quot;sharding-count&quot;</span>=<span class="string">&quot;2&quot;</span>)),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class="string">&quot;snowflake&quot;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="å…¶å®ƒåˆ†ç‰‡æ“ä½œè¯­å¥">å…¶å®ƒåˆ†ç‰‡æ“ä½œè¯­å¥</h4><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢åˆ†ç‰‡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/sharding/show-sharding-table-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰é€»è¾‘åº“ä¸‹çš„æ‰€æœ‰åˆ†ç‰‡è§„åˆ™</span></span><br><span class="line">SHOW SHARDING TABLE RULES \G;</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šé€»è¾‘åº“ä¸‹çš„åˆ†ç‰‡è§„åˆ™</span></span><br><span class="line">SHOW SHARDING TABLE RULES FROM sharding_db; \G;</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šåˆ†ç‰‡è§„åˆ™</span></span><br><span class="line">SHOW SHARDING TABLE RULE t_user \G;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹åˆ†ç‰‡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/alter-sharding-table-rule/">å®˜ç½‘æ–‡æ¡£</a>ï¼Œä¸åˆ›å»ºåˆ†ç‰‡è§„åˆ™ç±»ä¼¼ï¼Œå°†<code>CREATE</code>æ”¹ä¸º<code>ALTER</code>å³å¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ALTER SHARDING TABLE RULE t_order_item_complex (</span><br><span class="line">  DATANODES(<span class="string">&quot;ds_<span class="variable">$&#123;0..1&#125;</span>.t_order_item_complex_<span class="variable">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class="line">  DATABASE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;ds_<span class="variable">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class="line">  TABLE_STRATEGY(TYPE=<span class="string">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;T_ORDER_ITEM_COMPLEX&quot;</span>))),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class="string">&quot;SNOWFLAKE&quot;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤åˆ†ç‰‡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/drop-sharding-table-rule/">å®˜ç½‘æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DROP SHARDING TABLE RULE t_order;</span><br><span class="line"><span class="comment"># åˆ é™¤å¤šä¸ªè¡¨</span></span><br><span class="line">DROP SHARDING TABLE RULE t_order,t_order_item;</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åŠ å¯†è§„åˆ™">æ•°æ®åŠ å¯†è§„åˆ™</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!ENCRYPT</span>    <span class="comment"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># åŠ å¯†è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># åŠ å¯†åˆ—åç§°</span></span><br><span class="line">            <span class="attr">cipher:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">password</span> <span class="comment"># å¯†æ–‡åˆ—åç§°</span></span><br><span class="line">              <span class="attr">encryptorName:</span> <span class="string">aes_encryptor</span> <span class="comment"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class="line">    <span class="comment"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class="line">    <span class="attr">encryptors:</span></span><br><span class="line">      <span class="attr">aes_encryptor:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">AES</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line">          <span class="attr">aes-key-value:</span> <span class="string">123456abc</span>     <span class="comment"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class="line">          <span class="attr">digest-algorithm-name:</span> <span class="string">SHA-1</span> <span class="comment"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-10">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåŠ å¯†è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/encrypt/create-encrypt-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE ENCRYPT RULE t_user (</span><br><span class="line">COLUMNS(</span><br><span class="line">  (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=<span class="string">&#x27;AES&#x27;</span>,PROPERTIES(<span class="string">&#x27;aes-key-value&#x27;</span>=<span class="string">&#x27;123456abc&#x27;</span>, <span class="string">&#x27;digest-algorithm-name&#x27;</span>=<span class="string">&#x27;SHA-1&#x27;</span>))))</span><br><span class="line">));</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹åŠ å¯†è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER ENCRYPT RULE t_user (</span><br><span class="line">COLUMNS(</span><br><span class="line">  (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=<span class="string">&#x27;AES&#x27;</span>,PROPERTIES(<span class="string">&#x27;aes-key-value&#x27;</span>=<span class="string">&#x27;123456abc&#x27;</span>, <span class="string">&#x27;digest-algorithm-name&#x27;</span>=<span class="string">&#x27;SHA-1&#x27;</span>))))</span><br><span class="line">));</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤åŠ å¯†è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP ENCRYPT RULE t_user;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢åŠ å¯†è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/encrypt/show-encrypt-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰åŠ å¯†è§„åˆ™</span></span><br><span class="line">SHOW ENCRYPT RULES \G;</span><br><span class="line"><span class="comment"># è·å–æŒ‡å®šé€»è¾‘åº“ä¸­çš„åŠ å¯†è§„åˆ™</span></span><br><span class="line">SHOW ENCRYPT RULES FROM sharding_db \G;</span><br><span class="line"><span class="comment"># è·å–æŒ‡å®šé€»è¾‘è¡¨ä¸­çš„åŠ å¯†è§„åˆ™</span></span><br><span class="line">SHOW ENCRYPT RULE t_user \G;</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®è„±æ•è§„åˆ™">æ•°æ®è„±æ•è§„åˆ™</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!MASK</span>  <span class="comment"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># è„±æ•è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span>  <span class="comment"># è„±æ•åˆ—é…ç½®</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># è„±æ•åˆ—åç§°</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">md5_mask</span> <span class="comment"># è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">email:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">mask_before_special_chars_mask</span></span><br><span class="line">          <span class="attr">telephone:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">keep_first_n_last_m_mask</span></span><br><span class="line">          <span class="attr">name:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">my_mask</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">maskAlgorithms:</span> <span class="comment"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class="line">      <span class="attr">md5_mask:</span> <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span>  <span class="comment"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class="line">      <span class="attr">mask_before_special_chars_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MASK_BEFORE_SPECIAL_CHARS</span> <span class="comment"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">special-chars:</span> <span class="string">&#x27;@&#x27;</span>  <span class="comment"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span>   <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">keep_first_n_last_m_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">KEEP_FIRST_N_LAST_M</span> <span class="comment"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">first-n:</span> <span class="number">3</span>     <span class="comment"># ä¿ç•™å‰ 3 ä½</span></span><br><span class="line">          <span class="attr">last-m:</span> <span class="number">4</span>      <span class="comment"># ä¿ç•™å 4 ä½</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">my_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MY_CUSTOM_MASK</span>  <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&quot;#&quot;</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-11">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºè„±æ•è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/mask/create-mask-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE MASK RULE t_user (</span><br><span class="line">  COLUMNS(</span><br><span class="line">    (NAME=password, TYPE(NAME=<span class="string">&#x27;MD5&#x27;</span>)),</span><br><span class="line">    (NAME=email, TYPE(NAME=<span class="string">&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;</span>, PROPERTIES(<span class="string">&quot;special-chars&quot;</span>=<span class="string">&quot;@&quot;</span>,  <span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;*&quot;</span>))),</span><br><span class="line">    (NAME=telephone, TYPE(NAME=<span class="string">&#x27;KEEP_FIRST_N_LAST_M&#x27;</span>, PROPERTIES(<span class="string">&quot;first-n&quot;</span>=3, <span class="string">&quot;last-m&quot;</span>=4, <span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;*&quot;</span>))),</span><br><span class="line">    (NAME=`name`, TYPE(NAME=<span class="string">&#x27;MY_CUSTOM_MASK&#x27;</span>, PROPERTIES(<span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;#&quot;</span>)))</span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"><span class="comment"># è¿™é‡Œæ³¨æ„ name æ˜¯å…³é”®å­—ï¼Œæ‰€ä»¥éœ€è¦ç”¨ `` åŒ…èµ·æ¥</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹è„±æ•è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ALTER MASK RULE t_user (</span><br><span class="line">  COLUMNS(</span><br><span class="line">    (NAME=password, TYPE(NAME=<span class="string">&#x27;MD5&#x27;</span>)),</span><br><span class="line">    (NAME=email, TYPE(NAME=<span class="string">&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;</span>, PROPERTIES(<span class="string">&quot;special-chars&quot;</span>=<span class="string">&quot;@&quot;</span>,  <span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;*&quot;</span>))),</span><br><span class="line">    (NAME=telephone, TYPE(NAME=<span class="string">&#x27;KEEP_FIRST_N_LAST_M&#x27;</span>, PROPERTIES(<span class="string">&quot;first-n&quot;</span>=3, <span class="string">&quot;last-m&quot;</span>=4, <span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;*&quot;</span>))),</span><br><span class="line">    (NAME=`name`, TYPE(NAME=<span class="string">&#x27;MY_CUSTOM_MASK&#x27;</span>, PROPERTIES(<span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;#&quot;</span>)))</span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤è„±æ•è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP MASK RULE t_user;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢è„±æ•è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/mask/show-mask-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰è„±æ•è§„åˆ™</span></span><br><span class="line">SHOW MASK RULES;</span><br><span class="line"><span class="comment"># ä»…æŸ¥è¯¢æŒ‡å®šé€»è¾‘åº“ä¸­çš„è„±æ•è§„åˆ™</span></span><br><span class="line">SHOW MASK RULES FROM sharding_db;</span><br><span class="line"><span class="comment"># æŸ¥è¯¢æŒ‡å®šè§„åˆ™</span></span><br><span class="line">mysql&gt; SHOW MASK RULE t_user;</span><br><span class="line">+--------+-----------+---------------------------+-------------------------------------------------+</span><br><span class="line">| table  | column    | algorithm_type            | algorithm_props                                 |</span><br><span class="line">+--------+-----------+---------------------------+-------------------------------------------------+</span><br><span class="line">| t_user | password  | MD5                       |                                                 |</span><br><span class="line">| t_user | email     | MASK_BEFORE_SPECIAL_CHARS | &#123;<span class="string">&quot;replace-char&quot;</span>:<span class="string">&quot;*&quot;</span>,<span class="string">&quot;special-chars&quot;</span>:<span class="string">&quot;@&quot;</span>&#125;        |</span><br><span class="line">| t_user | telephone | KEEP_FIRST_N_LAST_M       | &#123;<span class="string">&quot;first-n&quot;</span>:<span class="string">&quot;3&quot;</span>,<span class="string">&quot;last-m&quot;</span>:<span class="string">&quot;4&quot;</span>,<span class="string">&quot;replace-char&quot;</span>:<span class="string">&quot;*&quot;</span>&#125; |</span><br><span class="line">| t_user | name      | MY_CUSTOM_MASK            | &#123;<span class="string">&quot;replace-char&quot;</span>:<span class="string">&quot;#&quot;</span>&#125;                            |</span><br><span class="line">+--------+-----------+---------------------------+-------------------------------------------------+</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» ShardingSphere-Proxy5.5.2 DistSQL çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://shardingsphere.apache.org/index_zh.html&quot;&gt;ShardingSphereå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/sharding-sphere/"/>
    
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/tags/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/tags/sharding-sphere/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot3 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼</title>
    <link href="https://blog.hanqunfeng.com/2025/09/10/springboot3-shardingsphere-proxy-mode/"/>
    <id>https://blog.hanqunfeng.com/2025/09/10/springboot3-shardingsphere-proxy-mode/</id>
    <published>2025-09-10T13:30:05.000Z</published>
    <updated>2025-09-15T06:26:28.238Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/index_zh.html">ShardingSphereå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡åœ¨ <a href="/2025/09/04/springboot3-shardingsphere-proxy/" title="SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨">SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨</a> çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚</p></li></ul><span id="more"></span><h2 id="è¿è¡Œæ¨¡å¼è¯´æ˜">è¿è¡Œæ¨¡å¼è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/document/5.5.2/cn/dev-manual/mode/">è¿è¡Œæ¨¡å¼</a></p></li><li class="lvl-2"><p>ShardingSphere-Proxy è¿è¡Œæ¨¡å¼åˆ†ä¸ºä¸¤ç§ï¼šå•æœºæ¨¡å¼(Standalone) å’Œ é›†ç¾¤æ¨¡å¼(Cluster)ã€‚</p></li><li class="lvl-2"><p>è¿è¡Œæ¨¡å¼å°±æ˜¯æŒ‡å®šå°†<code>å…ƒæ•°æ®</code>(è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ç­‰)æŒä¹…åŒ–çš„å­˜å‚¨æ–¹å¼ã€‚</p></li><li class="lvl-2"><p>é»˜è®¤è¿è¡Œæ¨¡å¼ä¸ºå•æœºæ¨¡å¼ï¼Œä½¿ç”¨<code>H2</code>çš„å†…å­˜æ–¹å¼ã€‚</p></li></ul><h2 id="å•æœºæ¨¡å¼-Standalone">å•æœºæ¨¡å¼(Standalone)</h2><ul class="lvl-0"><li class="lvl-2"><p>å•æœºæ¨¡å¼èƒ½å¤Ÿå°†æ•°æ®æºå’Œè§„åˆ™ç­‰å…ƒæ•°æ®ä¿¡æ¯æŒä¹…åŒ–ï¼Œä½†æ— æ³•å°†å…ƒæ•°æ®åŒæ­¥è‡³å¤šä¸ª Apache ShardingSphere å®ä¾‹ï¼Œæ— æ³•åœ¨é›†ç¾¤ç¯å¢ƒä¸­ç›¸äº’æ„ŸçŸ¥ã€‚ é€šè¿‡æŸä¸€å®ä¾‹æ›´æ–°å…ƒæ•°æ®ä¹‹åï¼Œä¼šå¯¼è‡´å…¶ä»–å®ä¾‹ç”±äºè·å–ä¸åˆ°æœ€æ–°çš„å…ƒæ•°æ®è€Œäº§ç”Ÿä¸ä¸€è‡´çš„é”™è¯¯ã€‚</p></li><li class="lvl-2"><p>é€‚ç”¨äºå·¥ç¨‹å¸ˆåœ¨æœ¬åœ°æ­å»º Apache ShardingSphere ç¯å¢ƒã€‚</p></li><li class="lvl-2"><p>å•æœºæ¨¡å¼ç›®å‰ä»…æ”¯æŒä¸€ç§ï¼šJDBCï¼Œå³æ•°æ®åº“æŒä¹…åŒ–ã€‚ä»¥ä¸‹ä¸ºé»˜è®¤å€¼(<code>JDBCRepositoryPropertyKey</code>)ã€‚</p></li></ul><table><thead><tr><th>åç§°</th><th>æ•°æ®ç±»å‹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>provider</td><td>String</td><td>å…ƒæ•°æ®å­˜å‚¨ç±»å‹ï¼Œå¯é€‰å€¼ä¸º <code>H2</code>ã€<code>MySQL</code> ã€<code>EmbeddedDerby</code>ã€<code>DerbyNetworkServer</code>ã€<code>HSQLDB</code></td><td>H2</td></tr><tr><td>jdbc_url</td><td>String</td><td>JDBC URL</td><td><code>jdbc:h2:mem:config;DB_CLOSE_DELAY=0;DATABASE_TO_UPPER=false;MODE=MYSQL</code></td></tr><tr><td>username</td><td>String</td><td>è´¦å·</td><td>sa</td></tr><tr><td>password</td><td>String</td><td>å¯†ç </td><td>ç©ºï¼ˆæ— é»˜è®¤å€¼ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œä»¥ Mysql å­˜å‚¨å…ƒæ•°æ®ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/common-config/builtin-algorithm/metadata-repository/#jdbc-%E6%8C%81%E4%B9%85%E5%8C%96">å®˜ç½‘è¯´æ˜</a></p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">JDBC</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">provider:</span> <span class="string">MySQL</span></span><br><span class="line">      <span class="attr">jdbc_url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">newpwd</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶éœ€è¦å°† mysql çš„é©±åŠ¨ jar åŒ… æ·»åŠ åˆ° <code>ext-lib</code> ç›®å½•ä¸‹</p></li><li class="lvl-2"><p>å¯åŠ¨ ShardingSphere Proxy æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ä¸Šé¢çš„æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¼ è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„ä¸­çš„å…ƒæ•°æ®å­˜å‚¨è¿›å»</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `repository` (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">COLLATE</span> utf8mb4_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `key` text <span class="keyword">COLLATE</span> utf8mb4_bin,</span><br><span class="line">  `<span class="keyword">value</span>` text <span class="keyword">COLLATE</span> utf8mb4_bin,</span><br><span class="line">  `parent` text <span class="keyword">COLLATE</span> utf8mb4_bin,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_bin;</span><br></pre></td></tr></table></figure><h3 id="é‡ç‚¹è¯´æ˜">é‡ç‚¹è¯´æ˜</h3><ul class="lvl-0"><li class="lvl-2"><p>å½“æ•°æ®åº“ä¸­ä¸å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¯¥è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„å…ƒæ•°æ®æ’å…¥è¯¥è¡¨ä¸­ã€‚</p></li><li class="lvl-2"><p>å½“æ•°æ®åº“ä¸­å·²å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè¯»å–è¯¥è¡¨ä¸­çš„æ•°æ®å¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ï¼Œè€Œä¸ä¼šè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚å³æ­¤æ—¶é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ä¸ä¼šç”Ÿæ•ˆã€‚</p></li><li class="lvl-2"><p>è‹¥æ­¤æ—¶æƒ³ä¿®æ”¹é…ç½®è§„åˆ™ï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š</p><ul class="lvl-2"><li class="lvl-4">1.åˆ é™¤è¯¥è¡¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åé‡æ–°å¯åŠ¨Proxyï¼Œæ­¤æ—¶ä¼šé‡æ–°åˆ›å»ºè¯¥è¡¨å¹¶åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚</li><li class="lvl-4">2.æ‰‹å·¥ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„å…ƒæ•°æ®ï¼Œä½†ä¿®æ”¹åéœ€è¦é‡æ–°å¯åŠ¨Proxyæ‰ä¼šåŠ è½½æ–°çš„å…ƒæ•°æ®ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚</li><li class="lvl-4">3.<code>[æ¨è]</code>ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ <a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/">DistSQL</a> åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œä¿®æ”¹åçš„é…ç½®ä¼šè¢«ä¿å­˜åœ¨è¯¥è¡¨ä¸­ï¼Œå¹¶ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯Proxyã€‚</li></ul></li><li class="lvl-2"><p>å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒå¯ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤çš„ H2 å†…å­˜æ•°æ®åº“ï¼Œç”Ÿäº§ç¯å¢ƒå¯ä»¥ä½¿ç”¨ MySQLç­‰æ•°æ®åº“å¯¹å…ƒæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„é›†ç¾¤æ¨¡å¼ã€‚</p></li></ul><h2 id="é›†ç¾¤æ¨¡å¼-Cluster">é›†ç¾¤æ¨¡å¼(Cluster)</h2><ul class="lvl-0"><li class="lvl-2"><p>é›†ç¾¤æ¨¡å¼æä¾›äº†å¤šä¸ª Apache ShardingSphere å®ä¾‹ä¹‹é—´çš„å…ƒæ•°æ®å…±äº«å’Œåˆ†å¸ƒå¼åœºæ™¯ä¸‹çŠ¶æ€åè°ƒçš„èƒ½åŠ›ã€‚ å®ƒèƒ½å¤Ÿæä¾›è®¡ç®—èƒ½åŠ›æ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨ç­‰åˆ†å¸ƒå¼ç³»ç»Ÿå¿…å¤‡çš„èƒ½åŠ›ï¼Œé›†ç¾¤ç¯å¢ƒéœ€è¦é€šè¿‡ç‹¬ç«‹éƒ¨ç½²çš„æ³¨å†Œä¸­å¿ƒæ¥å­˜å‚¨å…ƒæ•°æ®å’Œåè°ƒèŠ‚ç‚¹çŠ¶æ€ã€‚</p></li><li class="lvl-2"><p>åœ¨ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨é›†ç¾¤æ¨¡å¼ã€‚</p></li><li class="lvl-2"><p>è¿™é‡Œä»¥ zookeeper é›†ç¾¤æ¨¡å¼ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/common-config/builtin-algorithm/metadata-repository/#zookeeper-%E6%8C%81%E4%B9%85%E5%8C%96">å®˜ç½‘è¯´æ˜</a></p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Cluster</span>                 <span class="comment"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ZooKeeper</span>             <span class="comment"># æ³¨å†Œä¸­å¿ƒç±»å‹ï¼Œå½“å‰ç‰ˆæœ¬ä»…æ”¯æŒ ZooKeeper å’Œ etcd</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">governance_ds</span>  <span class="comment"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class="line">      <span class="attr">server-lists:</span> <span class="string">localhost:2181</span> <span class="comment"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class="line">      <span class="attr">retryIntervalMilliseconds:</span> <span class="number">500</span> <span class="comment"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class="line">      <span class="attr">timeToLiveSeconds:</span> <span class="number">60</span>     <span class="comment"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class="line">      <span class="attr">maxRetries:</span> <span class="number">3</span>             <span class="comment"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class="line">      <span class="attr">operationTimeoutMilliseconds:</span> <span class="number">500</span>  <span class="comment"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="é‡ç‚¹è¯´æ˜-2">é‡ç‚¹è¯´æ˜</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸è¦æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­çš„ namespace ä¸‹çš„é…ç½®ä¿¡æ¯!</p></li><li class="lvl-2"><p>æ—¢ç„¶æ˜¯é›†ç¾¤ï¼Œå°±éœ€è¦å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ã€‚ å½“ç¬¬ä¸€ä¸ª ShardingSphere-Proxy å®ä¾‹ å¯åŠ¨åï¼Œå…¶å®ƒç›¸åŒé…ç½®çš„ ShardingSphere-Proxy å®ä¾‹ä»…éœ€è¦ä¸€ä¸ª <code>global.yaml</code> å…¨å±€é…ç½®æ–‡ä»¶å³å¯ï¼Œå¹¶ä»…éœ€åœ¨å…¶ä¸­é…ç½®ä¸Šé¢çš„<code>è¿è¡Œæ¨¡å¼</code>ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å†é…ç½®å…¶å®ƒé…ç½®ï¼Œæ¯”å¦‚è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šé€šè¿‡ Zookeeper é›†ç¾¤ä¸­çš„ namespace è·å–å¹¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ä¸­ã€‚</p></li><li class="lvl-2"><p>æ¯ä¸ª ShardingSphere-Proxy å®ä¾‹å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨å°†è‡ªå·±æ³¨å†Œåˆ° Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹ï¼Œå¹¶è‡ªåŠ¨è·å–è¯¥ namespace ä¸‹çš„é…ç½®ä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>å½“ Zookeeper é›†ç¾¤ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶ç¬¬ä¸€æ¬¡å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨åœ¨ Zookeeper ä¸­åˆ›å»º namespaceï¼Œå¹¶å†™å…¥é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯åˆ° Zookeeper ä¸­ã€‚</p></li><li class="lvl-2"><p>å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶å†å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨ä» Zookeeper ä¸­è¯»å– namespace ä¸‹çš„é…ç½®ä¿¡æ¯ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä¸ä¼šå†è¯»å–æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ ¹æ®ä¸Šé¢çš„è§„åˆ™ï¼Œæ­¤æ—¶ä¿®æ”¹æœ¬åœ°çš„é…ç½®æ–‡ä»¶ä¸­çš„åˆ†ç‰‡è§„åˆ™åé‡å¯ShardingSphere-Proxy å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚</p><ul class="lvl-2"><li class="lvl-4">æ­¤æ—¶æœ‰ä¸‰ç§æ–¹æ³•ï¼š<ul class="lvl-4"><li class="lvl-6"><ol><li class="lvl-9">åˆ é™¤ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespaceï¼Œç„¶åé‡å¯ ShardingSphere-Proxyã€‚è¿™ç§æ–¹æ³•æœ‰ä¸ªå¼Šç«¯ï¼Œå³ä¼šå¯¼è‡´è¿æ¥åˆ°ç›¸åŒ ZooKeeper é›†ç¾¤çš„ namespace çš„å…¶å®ƒ ShardingSphere-Proxy å®ä¾‹æ•°æ®ä¸¢å¤±(å®Œå…¨ä¸å¯ç”¨)ï¼Œä¹Ÿéœ€è¦é‡å¯æ‰èƒ½é‡æ–°è·å–åˆ°æ•°æ®ã€‚</li></ol></li><li class="lvl-6"><ol start="2"><li class="lvl-9">æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹çš„åˆ†ç‰‡è§„åˆ™ï¼Œä¿®æ”¹åä¼šç«‹å³åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚</li></ol></li><li class="lvl-6"><ol start="3"><li class="lvl-9"><code>[æ¨è]</code>ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ <a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/">DistSQL</a> åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚æ‰€ä»¥ï¼Œçµæ´»æŒæ¡ <code>DistSQL</code> æ˜¯ç»´æŠ¤ ShardingSphere-Proxy é›†ç¾¤çš„å…³é”®ã€‚</li></ol></li></ul></li></ul></li><li class="lvl-2"><p>å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ å¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡å™¨ï¼Œæ¯”å¦‚ Nginxï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„ ShardingSphere-Proxy å®ä¾‹ã€‚æ¯”å¦‚ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">stream&#123;</span><br><span class="line">    upstream shardingsphere_proxy&#123;</span><br><span class="line">        server  10.10.21.35:3307;</span><br><span class="line">        server  10.10.21.36:3307;</span><br><span class="line">    &#125;</span><br><span class="line">    server&#123;</span><br><span class="line">        listen 3310;</span><br><span class="line">        proxy_connect_timeout 20s;</span><br><span class="line">        proxy_timeout 5m;</span><br><span class="line">        proxy_pass shardingsphere_proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸-Spring-Boot3-æ•´åˆ">ä¸ Spring Boot3 æ•´åˆ</h2><ul class="lvl-0"><li class="lvl-2"><p>æ— è®ºæ˜¯ <code>å•æœºæ¨¡å¼</code> è¿˜æ˜¯ <code>é›†ç¾¤æ¨¡å¼</code>ï¼Œå…¶ç›®çš„éƒ½æ˜¯å°† <code>é…ç½®</code> ä¿å­˜åˆ°ç‹¬ç«‹çš„ <code>é…ç½®ä¸­å¿ƒ(æ•°æ®åº“ æˆ– Zookeeper)</code>ä¸­ï¼Œå¹¶è®©å…¶å®ƒ <code>ShardingSphere-Proxy</code> å®ä¾‹ä»è¯¥é…ç½®ä¸­å¿ƒä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>å‰æ–‡æˆ‘ä»¬ä»‹ç»è¿‡ <code>Spring Boot3</code> + <code>ShardingSphere-Proxy</code> å°±ç›¸å½“äºæ˜¯é›†æˆæ™®é€šçš„MySqlæ•°æ®åº“ï¼Œè€Œ <code>Spring Boot3</code> + <code>ShardingSphere-JDBC</code> å°±éœ€è¦å•ç‹¬åœ¨æœ¬åœ°é…ç½®å„ç§è§„åˆ™ã€‚</p></li><li class="lvl-2"><p>å®é™…ä¸Š <code>ShardingSphere-JDBC</code> ä¹Ÿå¯ä»¥ä» <code>é…ç½®ä¸­å¿ƒ</code> ä¸­è¯»å–é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦åœ¨æœ¬åœ°é…ç½®ä»»ä½•è§„åˆ™äº†ï¼Œæˆ‘ä»¬ä»…éœ€è¦åœ¨ <code>sharding.yaml</code> ä¸­é…ç½®å¥½<code>è¿è¡Œæ¨¡å¼</code>ï¼Œå¹¶é…ç½®å¥½ <code>databaseName</code> çš„åç§°å³å¯ã€‚æ³¨æ„ï¼Œæ­¤æ—¶é…ç½®ä¸­å¿ƒçš„çš„äº‹åŠ¡ä¸èƒ½æ˜¯ <code>XA</code>ï¼Œå› ä¸º<code>Spring Boot3</code> + <code>ShardingSphere-JDBC</code>ç›®å‰ä¸æ”¯æŒ <code>XA</code> äº‹åŠ¡ã€‚</p></li><li class="lvl-2"><p>æ­¤æ—¶ï¼Œspringbooté¡¹ç›®å¯åŠ¨åä¼šæ‹‰å–<code>é…ç½®ä¸­å¿ƒ</code>ä¸­çš„é…ç½®ä¿¡æ¯å¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„å…¶å®ƒé…ç½®ä¿¡æ¯ä¼šè¢«å¿½ç•¥ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/G3kESF.png" alt=""></p></li></ul><h3 id="å•æœºæ¨¡å¼">å•æœºæ¨¡å¼</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-03">ä»£ç ç¤ºä¾‹</a></p></li><li class="lvl-2"><p>é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œå¿…é¡»é‡å¯åº”ç”¨æ‰èƒ½ç”Ÿæ•ˆ</p></li><li class="lvl-2"><p>sharding.yaml</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">JDBC</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">provider:</span> <span class="string">MySQL</span></span><br><span class="line">      <span class="attr">jdbc_url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"><span class="comment"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class="line"><span class="attr">databaseName:</span> <span class="string">sharding_db</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Maven ä¾èµ–</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MySQL Connector/J --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hanqf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>algorithm-swapper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤æ¨¡å¼">é›†ç¾¤æ¨¡å¼</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-04">ä»£ç ç¤ºä¾‹</a></p></li><li class="lvl-2"><p>é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œç«‹å³æ¨é€åˆ°æ‰€æœ‰å®ä¾‹ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚</p></li><li class="lvl-2"><p>sharding.yamlï¼Œæ³¨æ„è¿™é‡Œä¸€å®šè¦é…ç½® <code>databaseName</code></p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # å¼€å¯é›†ç¾¤æ¨¡å¼</span></span><br><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Cluster</span>                 <span class="comment"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ZooKeeper</span>             <span class="comment"># æ³¨å†Œä¸­å¿ƒç±»å‹</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">governance_ds</span>  <span class="comment"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class="line">      <span class="attr">server-lists:</span> <span class="string">localhost:2181</span> <span class="comment"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class="line">      <span class="attr">retryIntervalMilliseconds:</span> <span class="number">500</span> <span class="comment"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class="line">      <span class="attr">timeToLiveSeconds:</span> <span class="number">60</span>     <span class="comment"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class="line">      <span class="attr">maxRetries:</span> <span class="number">3</span>             <span class="comment"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class="line">      <span class="attr">operationTimeoutMilliseconds:</span> <span class="number">500</span>  <span class="comment"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class="line"><span class="attr">databaseName:</span> <span class="string">sharding_db</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Maven ä¾èµ–ï¼Œæ³¨æ„è¦åŠ ä¸Š <code>shardingsphere-cluster-mode-repository-zookeeper</code> çš„ä¾èµ–</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MySQL Connector/J --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hanqf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>algorithm-swapper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- shardingsphere-cluster-mode-repository-zookeeper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-cluster-mode-repository-zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•é€‰æ‹©">å¦‚ä½•é€‰æ‹©</h3><ul class="lvl-0"><li class="lvl-2"><p>å½“æˆ‘ä½¿ç”¨<code>springboot3+shardingSphere-JDBC5.5.2</code>æ—¶ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨æœ¬åœ°<code>é…ç½®æ–‡ä»¶</code>çš„æ–¹å¼è¿˜æ˜¯ä½¿ç”¨<code>é…ç½®ä¸­å¿ƒ</code>ï¼ˆæ¯”å¦‚ï¼šzookeeperï¼‰çš„æ–¹å¼å‘¢ï¼Ÿ</p></li></ul><table><thead><tr><th>æ–¹å¼</th><th>éƒ¨ç½²å¤æ‚åº¦</th><th>é…ç½®åŠ¨æ€æ›´æ–°</th><th>å¤šå®ä¾‹å…±äº«é…ç½®</th><th>çƒ­æ›´æ–°æ”¯æŒ</th><th>é€‚ç”¨ç¯å¢ƒ</th></tr></thead><tbody><tr><td>æœ¬åœ°é…ç½®æ–‡ä»¶</td><td>ç®€å•</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>å¦</td><td>å¼€å‘/æµ‹è¯•/å°å‹é¡¹ç›®</td></tr><tr><td>é…ç½®ä¸­å¿ƒï¼ˆZooKeeper/etcdï¼‰</td><td>ç•¥é«˜</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ˜¯</td><td>ç”Ÿäº§/åˆ†å¸ƒå¼ç¯å¢ƒ</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ³¨æ„</p><ul class="lvl-2"><li class="lvl-4">DistSQL ç›®å‰ç¡®å®åªæ”¯æŒåœ¨ ShardingSphere-Proxy ä¸Šæ‰§è¡Œï¼Œå¹¶ä¸” Proxy åªæ”¯æŒ MySQL å’Œ PostgreSQL åè®®ã€‚</li><li class="lvl-4">å¦‚æœä½ åœ¨ Spring Boot + ShardingSphere-JDBC é‡Œç”¨ å…¶å®ƒæ•°æ®åº“ï¼ˆæ¯”å¦‚ SQL Serverã€Oracleã€DB2 ç­‰ï¼‰ï¼Œå°±æ— æ³•ç›´æ¥é€šè¿‡ DistSQL å»åŠ¨æ€æ”¹é…ç½®ã€‚</li><li class="lvl-4">æ­¤æ—¶ä½ å¯ä»¥é€‰æ‹©é€šè¿‡ Zookeeper çš„å®¢æˆ·ç«¯ç›´æ¥ä¿®æ”¹æˆ–é…ç½®è§„åˆ™ï¼Œä¹Ÿå¯ä»¥ä¸é€‰æ‹© <code>é…ç½®ä¸­å¿ƒ</code> çš„æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨ <code>æœ¬åœ°é…ç½®æ–‡ä»¶</code>ã€‚</li></ul></li></ul><h2 id="ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†åº“åˆ†è¡¨">ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†åº“åˆ†è¡¨</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åº“åˆ†è¡¨çš„ä¸»è¦ç›®çš„æ˜¯ <strong>è§£å†³æ•°æ®é‡å¤§å¸¦æ¥çš„æ€§èƒ½ã€å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§é—®é¢˜</strong>ã€‚é€šå¸¸éœ€è¦è€ƒè™‘çš„å‡ ä¸ªå…³é”®æŒ‡æ ‡ï¼š</p></li></ul><h3 id="1-æ•°æ®é‡æŒ‡æ ‡">1. æ•°æ®é‡æŒ‡æ ‡</h3><ul class="lvl-0"><li class="lvl-2"><p><strong>å•è¡¨æ•°æ®é‡è¿‡å¤§</strong>ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå•è¡¨æ•°æ®é‡åœ¨ <strong>åƒä¸‡çº§</strong> ä»¥ä¸Šæ—¶ï¼ŒæŸ¥è¯¢ã€å†™å…¥å’Œç´¢å¼•çš„æ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ã€‚</p></li><li class="lvl-2"><p>ä¾‹å¦‚ï¼šä¸€ä¸ªè®¢å•è¡¨ä¸€å¤©æœ‰ä¸Šç™¾ä¸‡æ¡æ•°æ®ï¼Œä¸€å¹´ä¸‹æ¥å¯èƒ½æœ‰ä¸Šäº¿æ¡ï¼Œå•è¡¨æ€§èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚</p></li></ul><h3 id="2-è®¿é—®é‡æŒ‡æ ‡">2. è®¿é—®é‡æŒ‡æ ‡</h3><ul class="lvl-0"><li class="lvl-2"><p><strong>é«˜å¹¶å‘å†™å…¥æˆ–æŸ¥è¯¢</strong>ï¼šæ•°æ®åº“è¿æ¥ã€äº‹åŠ¡é”ã€IO ç­‰èµ„æºä¼šæˆä¸ºç“¶é¢ˆã€‚</p></li><li class="lvl-2"><p>å¦‚æœä½ çš„ç³»ç»Ÿæ¯å¤©æœ‰ä¸Šåƒä¸‡çš„è¯·æ±‚ï¼Œæ•°æ®åº“å¯èƒ½æ— æ³•æ‰¿å—ã€‚</p></li></ul><h3 id="3-ä¸šåŠ¡éš”ç¦»éœ€æ±‚">3. ä¸šåŠ¡éš”ç¦»éœ€æ±‚</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸åŒä¸šåŠ¡çš„æ•°æ®åˆ†ç¦»ï¼Œé¿å…å•ä¸ªä¸šåŠ¡å½±å“æ•´ä¸ªæ•°æ®åº“çš„ç¨³å®šæ€§ã€‚</p></li><li class="lvl-2"><p>ä¾‹å¦‚ï¼šç”µå•†ç³»ç»Ÿä¸­çš„è®¢å•å’Œæ—¥å¿—æ•°æ®ï¼Œæ—¥å¿—é‡éå¸¸å¤§ï¼Œå’Œè®¢å•åˆ†å¼€å­˜å‚¨æ›´åˆç†ã€‚</p></li></ul><h3 id="4-è¿è¥ä¸æˆæœ¬å› ç´ ">4. è¿è¥ä¸æˆæœ¬å› ç´ </h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åº“åˆ†è¡¨åï¼Œå¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸Šï¼Œæ”¯æŒ <strong>æ°´å¹³æ‰©å±•</strong>ï¼Œè€Œä¸å¿…ä¾èµ–æ˜‚è´µçš„å•æœºæ•°æ®åº“ã€‚</p></li></ul><h2 id="ä½¿ç”¨-ShardingSphere-å¯èƒ½å¸¦æ¥çš„é—®é¢˜">ä½¿ç”¨ ShardingSphere å¯èƒ½å¸¦æ¥çš„é—®é¢˜</h2><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨ <strong>ShardingSphere</strong> å¯ä»¥æ–¹ä¾¿åœ°è§£å†³åˆ†åº“åˆ†è¡¨é—®é¢˜ï¼Œä½†åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œå®ƒä¼šå¸¦æ¥ä¸€äº›æ–°çš„å¤æ‚æ€§å’Œæ½œåœ¨é—®é¢˜ï¼Œä¸»è¦ä½“ç°åœ¨æ€§èƒ½ã€è¿ç»´ã€åŠŸèƒ½é™åˆ¶ç­‰æ–¹é¢ã€‚</p></li></ul><h3 id="1-æ€§èƒ½ä¸å»¶è¿Ÿ">1. æ€§èƒ½ä¸å»¶è¿Ÿ</h3><ul class="lvl-0"><li class="lvl-2"><p><strong>è·¨åº“ JOIN æ€§èƒ½å·®</strong><br>åˆ†åº“åˆ†è¡¨åï¼Œè·¨åº“çš„ <code>JOIN</code> æŸ¥è¯¢ä¼šåœ¨å„ä¸ªåˆ†ç‰‡ä¸Šåˆ†åˆ«æ‰§è¡Œï¼Œç„¶ååœ¨ ShardingSphere å±‚åˆå¹¶ç»“æœï¼Œæ€§èƒ½æ˜æ˜¾ä¸‹é™ã€‚</p><ul class="lvl-2"><li class="lvl-4">ä¾‹å¦‚ï¼šè®¢å•è¡¨åœ¨å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢è®¢å• + ç”¨æˆ·ä¿¡æ¯æ—¶å¿…é¡»è·¨åº“ JOINï¼Œæ‰§è¡Œæ•ˆç‡æ¯”å•åº“ä½å¾ˆå¤šã€‚</li></ul></li><li class="lvl-2"><p><strong>åˆ†é¡µæŸ¥è¯¢æ…¢</strong><br>åˆ†åº“åˆ†è¡¨åï¼Œå¦‚æœè¦å…¨å±€æ’åº + åˆ†é¡µï¼Œéœ€è¦æ‰€æœ‰åˆ†ç‰‡æŸ¥å‡ºæ•°æ®å†åˆå¹¶ï¼Œä»£ä»·éå¸¸å¤§ã€‚</p><ul class="lvl-2"><li class="lvl-4">è§£å†³æ–¹å¼ï¼šä½¿ç”¨åˆ†ç‰‡é”®èŒƒå›´åˆ†é¡µï¼Œæˆ–å¼•å…¥ ElasticSearch/ClickHouse åšæœç´¢å’Œç»Ÿè®¡ã€‚</li></ul></li><li class="lvl-2"><p><strong>å¹¿æ’­è¡¨å‹åŠ›</strong><br>é…ç½®äº†å¹¿æ’­è¡¨ï¼ˆæ¯ä¸ªåº“ä¸€ä»½å®Œæ•´æ•°æ®ï¼‰åï¼Œæ›´æ–°éœ€è¦åŒæ­¥æ‰€æœ‰åº“ï¼Œå†™å…¥æ€§èƒ½ä¸‹é™ã€‚</p></li></ul><h3 id="2-SQL-å…¼å®¹æ€§é™åˆ¶">2. SQL å…¼å®¹æ€§é™åˆ¶</h3><ul class="lvl-0"><li class="lvl-2"><p><strong>å¤æ‚ SQL æ”¯æŒä¸å®Œæ•´</strong><br>ShardingSphere å¯¹æŸäº›å¤æ‚ SQLï¼ˆå¦‚å­æŸ¥è¯¢ã€çª—å£å‡½æ•°ï¼‰æ”¯æŒæœ‰é™ï¼Œå¯èƒ½æŠ¥é”™æˆ–æ€§èƒ½æå·®ã€‚</p></li><li class="lvl-2"><p><strong>å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨å—é™</strong><br>åˆ†åº“åˆ†è¡¨åï¼Œå­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨åœ¨åˆ†ç‰‡æ•°æ®åº“æ‰§è¡Œå¯èƒ½ä¸ä¸€è‡´ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚</p></li></ul><h3 id="3-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜">3. åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h3><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere æ”¯æŒ <strong>XA åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼Œä½†æ€§èƒ½ä¸å¦‚å•æœºäº‹åŠ¡ï¼Œå‡ºç°ç½‘ç»œæŠ–åŠ¨æ—¶å¯èƒ½ä¼šå¡ä½ã€‚</p></li><li class="lvl-2"><p>å¦‚æœä¸šåŠ¡éœ€è¦å¼ºä¸€è‡´æ€§ï¼Œå¿…é¡»ç»“åˆå¯é æ¶ˆæ¯æˆ– TCCã€SAGA ç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼ï¼Œæ¶æ„ä¼šæ›´å¤æ‚ã€‚</p></li></ul><h3 id="4-è¿ç»´ä¸ç®¡ç†å¤æ‚åº¦">4. è¿ç»´ä¸ç®¡ç†å¤æ‚åº¦</h3><ul class="lvl-0"><li class="lvl-2"><p><strong>åˆ†ç‰‡è§„åˆ™å˜æ›´å›°éš¾</strong><br>ä¾‹å¦‚ï¼Œæœ€åˆæŒ‰ <code>user_id % 2</code> åˆ†æˆä¸¤ä¸ªåº“ï¼Œåç»­æƒ³å¢åŠ åˆ° 4 ä¸ªåº“ï¼Œéœ€è¦è¿ç§»æ•°æ®ï¼Œéå¸¸éº»çƒ¦ã€‚</p></li><li class="lvl-2"><p><strong>ç›‘æ§ä¸è°ƒä¼˜</strong><br>ShardingSphere å¢åŠ äº†ä¸­é—´å±‚ï¼ŒSQL è·¯ç”±ã€æ‰§è¡Œè®¡åˆ’ã€æ•°æ®èŠ‚ç‚¹çŠ¶æ€éƒ½éœ€è¦é¢å¤–çš„ç›‘æ§å·¥å…·æ”¯æŒã€‚</p></li></ul><h3 id="5-æˆæœ¬ä¸å­¦ä¹ æ›²çº¿">5. æˆæœ¬ä¸å­¦ä¹ æ›²çº¿</h3><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®ç›¸å¯¹å¤æ‚ï¼šåˆ†ç‰‡è§„åˆ™ã€è¯»å†™åˆ†ç¦»ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€å¼¹æ€§æ‰©å®¹éƒ½éœ€è¦ä»”ç»†è®¾è®¡ã€‚</p></li><li class="lvl-2"><p>å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼šå¼€å‘å’Œè¿ç»´äººå‘˜å¿…é¡»äº†è§£ ShardingSphere çš„å·¥ä½œæœºåˆ¶ï¼Œå¦åˆ™å®šä½é—®é¢˜å¾ˆå›°éš¾ã€‚</p></li></ul><h3 id="6-é«˜å¯ç”¨ä¸æ‰©å±•é—®é¢˜">6. é«˜å¯ç”¨ä¸æ‰©å±•é—®é¢˜</h3><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere-JDBC æ˜¯åº”ç”¨å†…åº“ï¼Œæ— æ³•ç‹¬ç«‹æ‰©å±•ï¼Œéœ€è¦ä¾èµ–åº”ç”¨æ‰©å®¹ã€‚</p></li><li class="lvl-2"><p>ShardingSphere-Proxy æ”¯æŒé›†ç¾¤ï¼Œä½†éœ€è¦è‡ªå·±æ­å»ºé«˜å¯ç”¨æ¶æ„ï¼Œæ¶‰åŠè´Ÿè½½å‡è¡¡ã€æ•…éšœåˆ‡æ¢ç­‰é—®é¢˜ã€‚</p></li></ul><h2 id="å…¶å®ƒæŠ€æœ¯æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼æ•°æ®åº“">å…¶å®ƒæŠ€æœ¯æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼æ•°æ®åº“</h2><ul class="lvl-0"><li class="lvl-2"><p>å¼€æºäº§å“: æ ¸å¿ƒåŠŸèƒ½å®Œå…¨å¼€æºï¼Œä¼ä¸šç‰ˆæä¾›é¢å¤–å•†ä¸šç‰¹æ€§</p></li></ul><table><thead><tr><th>æ•°æ®åº“</th><th>æ¶æ„ç±»å‹</th><th>SQL å…¼å®¹æ€§</th><th>åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ</th><th>æ•°æ®å­˜å‚¨æ¨¡å‹</th><th>ä¸»è¦ç‰¹ç‚¹</th><th>å…¸å‹åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong><a href="https://www.pingcap.com/">TiDB</a></strong></td><td>åˆ†å¸ƒå¼ HTAP</td><td>MySQL åè®®å…¼å®¹</td><td>æ”¯æŒï¼ˆPercolator æ¨¡å‹ï¼‰</td><td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td><td>å¼€æºã€äº‘åŸç”Ÿã€å¼ºä¸€è‡´æ€§ã€å¼¹æ€§æ‰©å±•</td><td>åœ¨çº¿äº‹åŠ¡å¤„ç† + å®æ—¶åˆ†æ</td></tr><tr><td><strong><a href="https://en.oceanbase.com/">OceanBase</a></strong></td><td>åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td><td>MySQL/Oracle å…¼å®¹</td><td>æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</td><td>è¡Œå­˜</td><td>é«˜æ€§èƒ½ã€é‡‘èçº§äº‹åŠ¡ã€é˜¿é‡Œèš‚èšé‡‘æœæ ¸å¿ƒç³»ç»Ÿä½¿ç”¨</td><td>é‡‘èã€ç”µå•†ã€æ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿ</td></tr><tr><td><strong><a href="https://www.cockroachlabs.com/">CockroachDB</a></strong></td><td>åˆ†å¸ƒå¼ NewSQL</td><td>PostgreSQL å…¼å®¹</td><td>æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td><td>è¡Œå­˜</td><td>ç±» Spanner æ¶æ„ï¼Œå…¨çƒåˆ†å¸ƒï¼Œå¼ºä¸€è‡´æ€§</td><td>å…¨çƒåŒ–åˆ†å¸ƒå¼åº”ç”¨</td></tr><tr><td><strong><a href="https://www.citusdata.com/">Citus</a> (PostgreSQL)</strong></td><td>PostgreSQL æ‰©å±•</td><td>PostgreSQL å…¼å®¹</td><td>éƒ¨åˆ†æ”¯æŒï¼ˆåŸºäºé€»è¾‘åˆ†ç‰‡ï¼‰</td><td>è¡Œå­˜</td><td>åŸºäº PostgreSQL çš„åˆ†å¸ƒå¼æ‰©å±•ï¼Œæ”¯æŒå¤§è§„æ¨¡ OLAP</td><td>å¤§æ•°æ®å®æ—¶åˆ†æã€BI åœºæ™¯</td></tr><tr><td><strong><a href="https://vitess.io/">Vitess</a></strong></td><td>åˆ†å¸ƒå¼ä¸­é—´ä»¶ + å­˜å‚¨</td><td>MySQL åè®®å…¼å®¹</td><td>å¼±äº‹åŠ¡ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</td><td>è¡Œå­˜</td><td>YouTube å¼€æºï¼ŒK8s å‹å¥½ï¼Œåˆ†åº“åˆ†è¡¨è‡ªåŠ¨åŒ–</td><td>å¤§è§„æ¨¡ Web åº”ç”¨ï¼Œåœ¨çº¿æœåŠ¡</td></tr><tr><td><strong><a href="https://www.yugabyte.com/">YugabyteDB</a></strong></td><td>åˆ†å¸ƒå¼ SQL + NoSQL</td><td>PostgreSQL å…¼å®¹</td><td>æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</td><td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td><td>èåˆ NewSQL å’Œ NoSQLï¼Œå¼ºä¸€è‡´æ€§ï¼Œè·¨åŒºåŸŸéƒ¨ç½²</td><td>é‡‘èçº§äº‹åŠ¡ + åˆ†ææ··åˆåœºæ™¯</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å•†ä¸šäº§å“</p></li></ul><table><thead><tr><th>æ•°æ®åº“</th><th>æ¶æ„ç±»å‹</th><th>SQL å…¼å®¹æ€§</th><th>åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ</th><th>æ•°æ®å­˜å‚¨æ¨¡å‹</th><th>ä¸»è¦ç‰¹ç‚¹</th><th>å…¸å‹åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong><a href="https://www.alibabacloud.com/product/polardb">PolarDB</a></strong></td><td>äº‘åŸç”Ÿåˆ†å¸ƒå¼æ•°æ®åº“</td><td>MySQL/PostgreSQL å…¼å®¹</td><td>æ”¯æŒï¼ˆäº‘ç«¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td><td>è¡Œå­˜</td><td>é˜¿é‡Œäº‘äº§å“ï¼Œå¼¹æ€§æ‰©å®¹ï¼Œå­˜å‚¨è®¡ç®—åˆ†ç¦»</td><td>äº‘ä¸Šä¼ä¸šæ•°æ®åº“è§£å†³æ–¹æ¡ˆ</td></tr><tr><td><strong><a href="https://www.huaweicloud.com/product/gaussdb.html">GaussDB</a></strong></td><td>åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td><td>MySQL/Oracle å…¼å®¹</td><td>æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td><td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td><td>åä¸ºæ¨å‡ºï¼Œåˆ†å¸ƒå¼ HTAPï¼Œäº‘åŸç”Ÿæ¶æ„</td><td>ä¼ä¸šçº§ OLTP + OLAP æ··åˆè´Ÿè½½</td></tr><tr><td><strong><a href="https://cloud.google.com/spanner">Spanner</a></strong></td><td>å…¨çƒåˆ†å¸ƒå¼æ•°æ®åº“</td><td>ç±» SQL</td><td>æ”¯æŒï¼ˆTrueTime åè®®ï¼‰</td><td>è¡Œå­˜</td><td>Google äº‘äº§å“ï¼Œå…¨çƒåˆ†å¸ƒå¼å¼ºä¸€è‡´äº‹åŠ¡</td><td>å…¨çƒåŒ–åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé‡‘èåœºæ™¯</td></tr><tr><td><strong><a href="https://aws.amazon.com/rds/aurora/">Amazon Aurora</a></strong></td><td>äº‘åŸç”Ÿåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td><td>MySQL/PostgreSQL å…¼å®¹</td><td>æ”¯æŒï¼ˆå•å®ä¾‹äº‹åŠ¡ï¼Œå¤š AZ é«˜å¯ç”¨ï¼‰</td><td>è¡Œå­˜</td><td>AWS æ‰˜ç®¡ï¼Œè‡ªåŠ¨æ‰©å±•å­˜å‚¨ï¼Œå¤šå¯ç”¨åŒºé«˜å¯ç”¨</td><td>OLTPã€ä¼ä¸šçº§ä¸šåŠ¡</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://shardingsphere.apache.org/index_zh.html&quot;&gt;ShardingSphereå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åœ¨ &lt;a href=&quot;/2025/09/04/springboot3-shardingsphere-proxy/&quot; title=&quot;SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨&quot;&gt;SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨&lt;/a&gt; çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/sharding-sphere/"/>
    
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/tags/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/tags/sharding-sphere/"/>
    
  </entry>
  
  <entry>
    <title>Maven ç§æœ Nexus å‡çº§å®å½•</title>
    <link href="https://blog.hanqunfeng.com/2025/09/08/maven-nexus-upgrade/"/>
    <id>https://blog.hanqunfeng.com/2025/09/08/maven-nexus-upgrade/</id>
    <published>2025-09-08T13:30:05.000Z</published>
    <updated>2025-09-15T06:26:27.872Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Mavne ç§æœ Nexus å‡çº§çš„å…¨è¿‡ç¨‹ï¼Œä» <code>3.29.2-02</code> å‡çº§åˆ° <code>3.83.2-01</code></p></li><li class="lvl-2"><p><a href="https://help.sonatype.com/en/sonatype-nexus-repository.html">Nexuså®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://mirrors.tuna.tsinghua.edu.cn/Adoptium/">OpenJdkä¸‹è½½åœ°å€</a></p></li><li class="lvl-2"><p><a href="https://help.sonatype.com/en/sonatype-nexus-repository-system-requirements.html">Nexusç³»ç»Ÿé…ç½®è¦æ±‚</a></p></li></ul><span id="more"></span><h2 id="å‡çº§è¿‡ç¨‹è¯´æ˜">å‡çº§è¿‡ç¨‹è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p>Nexus ä» <code>3.71.x</code> å¼€å§‹ï¼Œä¸å†æ”¯æŒ <code>OrientDB</code>ï¼Œåç»­ç‰ˆæœ¬ä»…æ”¯æŒ <code>H2</code> å’Œ <code>PostgreSQL</code> ï¼Œæ ¹æ®<a href="https://help.sonatype.com/en/upgrading-to-nexus-repository-3-71-0-and-beyond.html">å®˜ç½‘è¯´æ˜</a>ï¼Œ<code>3.70.x</code> ä»¥ä¸‹çš„ç‰ˆæœ¬éœ€è¦å°† Nexus å…ˆå‡çº§åˆ° <code>3.70.x</code> çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç„¶åä½¿ç”¨å®˜æ–¹æä¾›çš„æ•°æ®åº“è¿ç§»å·¥å…·ï¼Œå°†æ•°æ®åº“è¿ç§»åˆ° <code>H2</code> åï¼Œå†å‡çº§åˆ° <code>3.71.x</code> ä»¥åçš„ç‰ˆæœ¬</p></li></ul><h2 id="ä»-3-29-2-02-å‡çº§åˆ°-nexus-3-70-4-02">ä» <code>3.29.2-02</code> å‡çº§åˆ° <code>nexus-3.70.4-02</code></h2><h3 id="å®‰è£…-OpenJDK">å®‰è£… <code>OpenJDK</code></h3><ul class="lvl-0"><li class="lvl-2"><p>éœ€è¦å…ˆå®‰è£…å¥½ <code>OpenJDK</code>ï¼ŒåŸå› æ˜¯<code>Nexusçš„æ•°æ®åº“è¿ç§»å·¥å…·</code>ä»…æ”¯æŒ <code>OpenJDK</code>ï¼Œä¸æ”¯æŒ <code>Oracle JDK</code>ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©å®‰è£… <code>OpenJDK11</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local</span><br><span class="line">curl -O https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class="line">tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/jdk-11.0.28+6/bin/java /usr/bin/java</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk-11.0.28+6</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-nexus-3-70-x">å®‰è£… <code>nexus-3.70.x</code></h3><ul class="lvl-0"><li class="lvl-2"><p>ç›®å‰å®˜ç½‘å‘å¸ƒçš„<code>nexus-3.70.x</code>çš„æœ€æ–°ç‰ˆæœ¬ä¸º <code>nexus-3.70.4-02</code>ï¼Œ<a href="https://help.sonatype.com/en/orientdb-downloads.html">ä¸‹è½½é¡µé¢</a>ï¼Œå…¶å¯¹åº”çš„æ•°æ®åº“è¿ç§»å·¥å…·ä¹Ÿå¯ä»¥ä»è¯¥é¡µé¢ä¸‹è½½ã€‚</p></li><li class="lvl-2"><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹© <a href="https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gz">Java 11 çš„ç‰ˆæœ¬</a>ï¼Œå‡çº§å®‰è£…ä¸ç¬¬ä¸€æ¬¡å®‰è£…æ–¹å¼ä¸€æ ·ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ° nexus ç”¨æˆ·ï¼ŒåŸ nexus-3.29.2-02 å°±å®‰è£…åœ¨ è¯¥ç”¨æˆ·çš„ `home` ç›®å½•ä¸‹</span></span><br><span class="line">su - nexus</span><br><span class="line"><span class="comment"># å…³é—­ åŸ nexus æœåŠ¡ï¼Œå…³äºå¦‚ä½•å°† Nexus é…ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://help.sonatype.com/en/run-as-a-service.html</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop nexus</span><br><span class="line"><span class="comment">#~/nexus3/bin/nexus stop</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éœ€è¦ç§‘å­¦ä¸Šç½‘</span></span><br><span class="line">curl -O https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gz</span><br><span class="line">tar -zxvf nexus-3.70.4-02-java11-unix.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -f ~/nexus3</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/nexus-3.70.4-02 ~/nexus3</span><br><span class="line"><span class="comment"># å¯åŠ¨ nexus</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start nexus</span><br><span class="line"><span class="comment"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure><h3 id="è¿ç§»æ•°æ®åˆ°-H2">è¿ç§»æ•°æ®åˆ° H2</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹è½½æ•°æ®åº“è¿ç§»å·¥å…·</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/backup</span><br><span class="line"><span class="built_in">cd</span> ~/backup</span><br><span class="line"><span class="comment"># ä¸ nexus ç‰ˆæœ¬ä¸€è‡´</span></span><br><span class="line">curl -O https://download.sonatype.com/nexus/nxrm3-migrator/nexus-db-migrator-3.70.4-02.jar</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç™»å½• Nexus å¯¼å‡ºæ•°æ®: è®¾ç½® -&gt; System -&gt; Tasks -&gt; Create task -&gt; Admin - Export databases for backup<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/MS26e5.png" alt=""></p></li><li class="lvl-2"><p>ä»»åŠ¡åˆ›å»ºåç‚¹å‡»<code>Run</code>ï¼Œå³å¯åœ¨ <code>/home/nexus/backup</code> ç›®å½•ä¸‹çœ‹åˆ°å¤‡ä»½æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ll /home/nexus/backup</span><br><span class="line">-rw-rw-r-- 1 nexus nexus   121066 Sep  8 07:25 analytics-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class="line">-rw-rw-r-- 1 nexus nexus 19349428 Sep  8 07:25 component-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class="line">-rw-rw-r-- 1 nexus nexus   266208 Sep  8 07:25 config-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class="line">-rw-r--r-- 1 nexus nexus 56809625 Sep  8 06:41 nexus-db-migrator-3.70.4-02.jar</span><br><span class="line">-rw-rw-r-- 1 nexus nexus   132802 Sep  8 07:25 security-2025-09-08-07-25-57-3.70.4-02.bak</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨è¿ç§»å·¥å…·ç”ŸæˆH2æ•°æ®åº“æ–‡ä»¶ï¼Œå®˜ç½‘å‚è€ƒèµ„æ–™: <a href="https://help.sonatype.com/en/migrating-to-a-new-database.html#migrating-from-orientdb-to-h2">Migrating From OrientDB to H2</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å§‹è¿ç§»å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop nexus</span><br><span class="line"><span class="comment"># ~/nexus3/bin/nexus stop</span></span><br><span class="line"><span class="comment"># è¿›å…¥å¤‡ä»½ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /home/nexus/backup</span><br><span class="line"><span class="comment"># è¿™é‡Œè¦ä½¿ç”¨ OpenJDK 11 è¿è¡Œï¼Œæ ¹æ®éœ€è¦é€‚å½“è°ƒæ•´å†…å­˜å‚æ•°</span></span><br><span class="line">java -Xmx2G -Xms2G -XX:+UseG1GC -jar nexus-db-migrator-3.70.4-02.jar --migration_type=h2</span><br><span class="line"><span class="comment"># è¿è¡Œåä¼šæç¤ºä½ è¿ç§»æ•°æ®åº“å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡ï¼Œæˆ‘ä»¬è¾“å…¥ y ç»§ç»­</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡ŒæˆåŠŸåä¼šç”Ÿæˆ <code>nexus.mv.db</code>ï¼Œå°†å…¶ç§»åŠ¨åˆ° <code>/home/nexus/sonatype-work/nexus3/db/</code> ç›®å½•ä¸‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> nexus.mv.db /home/nexus/sonatype-work/nexus3/db/</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¼–è¾‘<code>/home/nexus/sonatype-work/nexus3/etc/nexus.properties</code> æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># enable db h2</span></span><br><span class="line">nexus.datastore.enabled=<span class="literal">true</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ nexusï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å®Œæˆäº† ä» <code>3.29.2-02</code> åˆ° <code>nexus-3.70.4-02</code> çš„å‡çº§</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start nexus</span><br><span class="line"><span class="comment"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure><h2 id="ä»-nexus-3-70-4-02-å‡çº§åˆ°-nexus-3-83-2-01">ä» <code>nexus-3.70.4-02</code> å‡çº§åˆ° <code>nexus-3.83.2-01</code></h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™ä¸ªå‡çº§å°±æ¯”è¾ƒç®€å•äº†ï¼Œå’Œæˆ‘ä»¬æ­¤å‰çš„å‡çº§æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œä¸‹è½½è§£å‹åæ›¿æ¢å®‰è£…ç›®å½•å³å¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œä»<code>nexus-3.71.0+</code>å¼€å§‹ä»…æ”¯æŒ<code>jdk17</code>ï¼Œæ‰€ä»¥éœ€è¦æå‰å®‰è£…å¥½<code>jdk17</code>ï¼Œå¦å¤–ä»<code>nexus-3.78.0</code>å¼€å§‹ï¼ŒNexus å†…ç½®äº†<code>openjdk17</code>ï¼Œæ‰€ä»¥ä¸éœ€è¦å†é¢å¤–å®‰è£…jdkã€‚</p></li><li class="lvl-2"><p><code>nexus-3.83.2-01</code> æ˜¯ç›®å‰çš„æœ€æ–°ç‰ˆï¼Œ<a href="https://help.sonatype.com/en/download.html">æœ€æ–°ç‰ˆä¸‹è½½é¡µé¢</a>ï¼Œ<a href="https://help.sonatype.com/en/download-archives---repository-manager-3.html">å†å²ç‰ˆæœ¬ä¸‹è½½é¡µé¢åœ°å€</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­ Nexus æœåŠ¡</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop nexus</span><br><span class="line"><span class="comment"># ~/nexus3/bin/nexus stop</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">curl -O https://download.sonatype.com/nexus/3/nexus-3.83.2-01-linux-x86_64.tar.gz</span><br><span class="line">tar -zxvf nexus-3.83.2-01-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -f nexus3</span><br><span class="line"><span class="built_in">ln</span> -s nexus-3.83.2-01 nexus3</span><br><span class="line"><span class="comment"># å¯åŠ¨ Nexusï¼Œnexus-3.83.2-01 è‡ªå¸¦ openjdk17ï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬å®‰è£… openjdk</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start nexus</span><br><span class="line"><span class="comment"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/rgLwWf.png" alt=""><br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/mdWh22.png" alt="" width="1400" height="1000"><br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/56aOWz.png" alt=""></p>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Mavne ç§æœ Nexus å‡çº§çš„å…¨è¿‡ç¨‹ï¼Œä» &lt;code&gt;3.29.2-02&lt;/code&gt; å‡çº§åˆ° &lt;code&gt;3.83.2-01&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://help.sonatype.com/en/sonatype-nexus-repository.html&quot;&gt;Nexuså®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://mirrors.tuna.tsinghua.edu.cn/Adoptium/&quot;&gt;OpenJdkä¸‹è½½åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://help.sonatype.com/en/sonatype-nexus-repository-system-requirements.html&quot;&gt;Nexusç³»ç»Ÿé…ç½®è¦æ±‚&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="maven" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/maven/"/>
    
    <category term="nexus" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/maven/nexus/"/>
    
    
    <category term="mavne" scheme="https://blog.hanqunfeng.com/tags/mavne/"/>
    
    <category term="nexus" scheme="https://blog.hanqunfeng.com/tags/nexus/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨</title>
    <link href="https://blog.hanqunfeng.com/2025/09/04/springboot3-shardingsphere-proxy/"/>
    <id>https://blog.hanqunfeng.com/2025/09/04/springboot3-shardingsphere-proxy/</id>
    <published>2025-09-04T13:30:05.000Z</published>
    <updated>2025-09-15T06:26:28.249Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/index_zh.html">ShardingSphereå®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy">æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€</a></p></li><li class="lvl-2"><p>æœ¬æ–‡å°† <a href="/2025/09/01/springboot3-shardingsphere/" title="SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨">SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨</a> ä¿®æ”¹ä¸º <code>ShardingSphere-Proxy</code> çš„æ¨¡å¼</p></li></ul><span id="more"></span><h2 id="ShardingSphere-Proxy-ç®€ä»‹">ShardingSphere-Proxy ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere-Proxy å®šä½ä¸ºé€æ˜åŒ–çš„æ•°æ®åº“ä»£ç†ç«¯ï¼Œé€šè¿‡å®ç°æ•°æ®åº“äºŒè¿›åˆ¶åè®®ï¼Œå¯¹å¼‚æ„è¯­è¨€æä¾›æ”¯æŒã€‚ ç›®å‰æä¾› MySQL å’Œ PostgreSQL åè®®ï¼Œé€æ˜åŒ–æ•°æ®åº“æ“ä½œï¼Œå¯¹ DBA æ›´åŠ å‹å¥½ã€‚</p><ul class="lvl-2"><li class="lvl-4">å‘åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ï¼Œå¯ç›´æ¥å½“åš MySQL/PostgreSQL ä½¿ç”¨ï¼›</li><li class="lvl-4">å…¼å®¹ MariaDB ç­‰åŸºäº MySQL åè®®çš„æ•°æ®åº“ï¼Œä»¥åŠ openGauss ç­‰åŸºäº PostgreSQL åè®®çš„æ•°æ®åº“ï¼›</li><li class="lvl-4">é€‚ç”¨äºä»»ä½•å…¼å®¹ MySQL/PostgreSQL åè®®çš„çš„å®¢æˆ·ç«¯ï¼Œå¦‚ï¼šMySQL Command Client, MySQL Workbench, Navicat ç­‰ã€‚</li></ul></li><li class="lvl-2"><p>ShardingSphere-Proxy ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/AMn2pu.png" alt=""></p></li><li class="lvl-2"><p>ShardingSphere-Proxy ä¸ ShardingSphere-JDBC çš„ç‰¹æ€§æ¯”è¾ƒ</p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>ShardingSphere-JDBC</th><th>ShardingSphere-Proxy</th></tr></thead><tbody><tr><td><strong>æ•°æ®åº“æ”¯æŒ</strong></td><td>ä»»æ„æ•°æ®åº“</td><td>MySQL / PostgreSQL</td></tr><tr><td><strong>è¿æ¥æ¶ˆè€—æ•°</strong></td><td>é«˜</td><td>ä½</td></tr><tr><td><strong>å¼‚æ„è¯­è¨€æ”¯æŒ</strong></td><td>ä»…æ”¯æŒ Java</td><td>æ”¯æŒä»»æ„è¯­è¨€</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>æŸè€—ä½</td><td>æŸè€—ç•¥é«˜</td></tr><tr><td><strong>æ— ä¸­å¿ƒåŒ–</strong></td><td>æ˜¯</td><td>å¦</td></tr><tr><td><strong>é™æ€å…¥å£</strong></td><td>æ— </td><td>æœ‰</td></tr></tbody></table><h2 id="éƒ¨ç½²-ShardingSphere-Proxy">éƒ¨ç½² ShardingSphere-Proxy</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œ ShardingSphere-Proxy è¦æ±‚ JDK 1.8+</p></li><li class="lvl-2"><p>ä¸‹è½½ <a href="https://shardingsphere.apache.org/document/current/cn/downloads/">ShardingSphere-Proxy5.5.2</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.apache.org/dyn/closer.lua/shardingsphere/5.5.2/apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxvf apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gz</span><br><span class="line"><span class="built_in">cd</span> apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-ShardingSphere-Proxy">é…ç½® ShardingSphere-Proxy</h2><ul class="lvl-0"><li class="lvl-2"><p><code>conf/global.yaml</code>: å…¨å±€é…ç½®ï¼Œæ‰€è°“å…¨å±€ï¼Œå°±æ˜¯å¯¹æ‰€æœ‰é€»è¾‘åº“éƒ½ç”Ÿæ•ˆçš„é…ç½®</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/authority/</span></span><br><span class="line"><span class="attr">authority:</span></span><br><span class="line"> <span class="attr">users:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">user:</span> <span class="string">root@127.0.0.1</span> <span class="comment"># æ ¼å¼ï¼šç”¨æˆ·å@IP</span></span><br><span class="line">     <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">     <span class="attr">admin:</span> <span class="literal">true</span>          <span class="comment"># æ˜¯å¦æ˜¯ç®¡ç†å‘˜</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">user:</span> <span class="string">sharding@%</span>     <span class="comment"># æ‰€æœ‰IPéƒ½å¯ä»¥è®¿é—®</span></span><br><span class="line">     <span class="attr">password:</span> <span class="string">sharding</span></span><br><span class="line"> <span class="attr">privilege:</span></span><br><span class="line">   <span class="attr">type:</span> <span class="string">DATABASE_PERMITTED</span> <span class="comment"># æƒé™ç±»å‹</span></span><br><span class="line">   <span class="attr">props:</span></span><br><span class="line">      <span class="attr">user-database-mappings:</span> <span class="string">root@127.0.0.1=*,sharding@%=sharding_db</span> <span class="comment"># ç”¨æˆ·æƒé™æ˜ å°„ï¼Œ*è¡¨ç¤ºæ‰€æœ‰æ•°æ®åº“</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯XAäº‹åŠ¡ï¼Œå¦‚æœæ˜¯ springbooté¡¹ç›®ï¼Œåªéœ€è¦åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Š @Transactional æ³¨è§£å³å¯å¼€å¯äº‹åŠ¡(ä» MySQL 5.7 å¼€å§‹å°±å…¨é¢æ”¯æŒ XA åˆ†å¸ƒå¼äº‹åŠ¡)</span></span><br><span class="line"><span class="comment"># https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/</span></span><br><span class="line"><span class="attr">transaction:</span>  <span class="comment"># é…ç½®äº‹åŠ¡</span></span><br><span class="line">  <span class="attr">defaultType:</span> <span class="string">XA</span>        <span class="comment"># äº‹åŠ¡ç±»å‹ï¼Œé»˜è®¤ LOCAL</span></span><br><span class="line">  <span class="attr">providerType:</span> <span class="string">Atomikos</span> <span class="comment"># äº‹åŠ¡ç®¡ç†å™¨å…·ä½“å®ç°ï¼Œé»˜è®¤å°±æ˜¯ Atomikos</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/props/</span></span><br><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span> <span class="comment"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class="line">  <span class="attr">check-table-metadata-enabled:</span> <span class="literal">false</span> <span class="comment"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>conf/database-my.yaml</code>: è‡ªå®šä¹‰åˆ†é…è§„åˆ™é…ç½®</p></li></ul><blockquote><p>æ³¨æ„:<br>1.åç§°å¿…é¡»ä»¥ <code>database-</code>å¼€å¤´ï¼Œå®é™…ä¸Š<code>conf</code>ç›®å½•ä¸‹æœ‰å¾ˆå¤šç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®<br>2.<code>global.yaml</code>ä¸­çš„é…ç½®é¡¹ä¸èƒ½é…ç½®åˆ° <code>database-my.yaml</code>ä¸­</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class="line"><span class="attr">databaseName:</span> <span class="string">sharding_db</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/</span></span><br><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_0:</span> <span class="comment"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class="line">    <span class="comment"># dataSourceClassName: com.zaxxer.hikari.HikariDataSource # ä¸è¦æŒ‡å®š</span></span><br><span class="line">    <span class="comment"># driverClassName: com.mysql.cj.jdbc.Driver               # ä¸è¦æŒ‡å®š</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>  <span class="comment"># æ³¨æ„è¿™é‡Œå±æ€§ä¸º url</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ds_1:</span></span><br><span class="line">    <span class="comment"># dataSourceClassName: com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="comment"># driverClassName: com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹è§„åˆ™ä¸å‰æ–‡ä¸­çš„ shardingsphere-jdbc ä¸­çš„ rules ç›¸åŒ</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="comment"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class="line">    <span class="attr">bindingTables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t_order,t_order_item</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">course:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">cid</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_inline</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">cid</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order-complex-algorithm</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_item-class-based-algorithm_spi</span> <span class="comment"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">t_user:</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">id</span> <span class="comment"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">          <span class="comment">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">custom_snowflake_string</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#       t_address:      # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜</span></span><br><span class="line">    <span class="comment">#         actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">autoTables:</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/</span></span><br><span class="line">      <span class="attr">course_inline:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># å±æ€§</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">course_$&#123;cid</span> <span class="string">%</span> <span class="number">2</span> <span class="string">+</span> <span class="number">1</span><span class="string">&#125;</span> <span class="comment"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class="line">          <span class="attr">allow-range-query-with-inline-sharding:</span> <span class="literal">true</span> <span class="comment"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">      <span class="attr">course_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span> <span class="comment"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class="line">      <span class="attr">mod_2:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MOD</span> <span class="comment"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">sharding-count:</span> <span class="number">2</span> <span class="comment"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class="line">      <span class="attr">t_order_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order-complex-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">COMPLEX_INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_order_complex_$&#123;(user_id</span> <span class="string">+</span> <span class="string">order_id</span> <span class="string">+</span> <span class="number">1</span><span class="string">)</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm_spi:</span> <span class="comment"># SPI</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">T_ORDER_ITEM_COMPLEX</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_user_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span></span><br><span class="line">      <span class="attr">t_user_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br><span class="line">      <span class="attr">uuid:</span> <span class="comment"># å®šä¹‰åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">UUID</span> <span class="comment"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class="line">      <span class="attr">custom_snowflake_string:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CUSTOM_SNOWFLAKE_STRING</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">workerId:</span> <span class="number">2</span></span><br><span class="line">          <span class="attr">datacenterId:</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!BROADCAST</span>  <span class="comment"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dict</span>    <span class="comment"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!ENCRYPT</span>    <span class="comment"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span> <span class="comment"># åŠ å¯†è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># åŠ å¯†åˆ—åç§°</span></span><br><span class="line">            <span class="attr">cipher:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">password</span> <span class="comment"># å¯†æ–‡åˆ—åç§°</span></span><br><span class="line">              <span class="attr">encryptorName:</span> <span class="string">aes_encryptor</span> <span class="comment"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class="line">    <span class="comment"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class="line">    <span class="attr">encryptors:</span></span><br><span class="line">      <span class="attr">aes_encryptor:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">AES</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line">          <span class="attr">aes-key-value:</span> <span class="string">123456abc</span>     <span class="comment"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class="line">          <span class="attr">digest-algorithm-name:</span> <span class="string">SHA-1</span> <span class="comment"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class="line">      <span class="attr">md5_encryptor:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">salt:</span> <span class="number">123456</span>  <span class="comment"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!MASK</span>  <span class="comment"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span> <span class="comment"># è„±æ•è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span> <span class="comment"># è„±æ•åˆ—é…ç½®</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># è„±æ•åˆ—åç§°</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">md5_mask</span> <span class="comment"># è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">email:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">mask_before_special_chars_mask</span></span><br><span class="line">          <span class="attr">telephone:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">keep_first_n_last_m_mask</span></span><br><span class="line">          <span class="attr">name:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">my_mask</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">maskAlgorithms:</span> <span class="comment"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class="line">      <span class="attr">md5_mask:</span> <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span>  <span class="comment"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class="line">      <span class="attr">mask_before_special_chars_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MASK_BEFORE_SPECIAL_CHARS</span> <span class="comment"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">special-chars:</span> <span class="string">&#x27;@&#x27;</span>  <span class="comment"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span>   <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">keep_first_n_last_m_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">KEEP_FIRST_N_LAST_M</span> <span class="comment"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">first-n:</span> <span class="number">3</span>     <span class="comment"># ä¿ç•™å‰ 3 ä½</span></span><br><span class="line">          <span class="attr">last-m:</span> <span class="number">4</span>      <span class="comment"># ä¿ç•™å 4 ä½</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">my_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MY_CUSTOM_MASK</span>  <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&quot;#&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SINGLE</span> <span class="comment"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="comment"># MySQL é£æ ¼</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ds_0.t_address</span> <span class="comment"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br><span class="line"><span class="comment">#       - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨</span></span><br><span class="line"><span class="comment">#       - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢çš„<code>rules</code>ä¸­ä½¿ç”¨çš„æ˜¯<code>mysql</code>æ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥<code>mysql</code>æ•°æ®åº“çš„ä¾èµ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/</span><br><span class="line"><span class="built_in">mkdir</span> ext-lib</span><br><span class="line"><span class="built_in">cd</span> ext-lib</span><br><span class="line">wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŒæ—¶<code>rules</code>ä¸­åŒ…å«ä¸€äº›è‡ªå®šä¹‰çš„ç®—æ³•ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†è¿™äº›ç®—æ³•ä½œä¸ºä¾èµ–è¿›è¡Œå¼•å…¥ï¼Œå°†è¿™äº›ç®—æ³•ç±»æ‰“æˆ<code>jar</code>ï¼Œç„¶åä¹Ÿæ‹·è´åˆ°<code>ext-lib</code>ç›®å½•ä¸‹ï¼Œæˆ‘å·²ç»å°†å…¶å‘å¸ƒåˆ°äº†githubä¸Šï¼Œå®é™…ä¸Šå’Œå‰æ–‡ä¸­çš„ <code>shardingsphere-jdbc</code> é¡¹ç›®ä¸­å°†ç®—æ³•é…ç½®ä¸º <code>spi</code> çš„æ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. åªå…‹éš†ä»“åº“çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¸ä¸‹è½½æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">git <span class="built_in">clone</span> --filter=blob:none --sparse https://github.com/hanqunfeng/springbootchapter.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è¿›å…¥ä»“åº“ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> springbootchapter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è®¾ç½®åªæ£€å‡ºä½ éœ€è¦çš„ç›®å½•</span></span><br><span class="line">git sparse-checkout <span class="built_in">set</span> springboot3-demo/shardingsphere-demo/algorithm-swapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. ç¼–è¯‘æ‰“åŒ…</span></span><br><span class="line"><span class="built_in">cd</span> springboot3-demo/shardingsphere-demo/algorithm-swapper</span><br><span class="line">mvn clean package -DskipTests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. å°†æ‰“å¥½çš„åŒ…å¤åˆ¶åˆ° shardingsphere-proxy çš„ ext-lib ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">cp</span> target/algorithm-swapper-1.0.0.jar <span class="variable">$shardingsphere</span>-proxy$/ext-lib</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨ä¸å…³é—­-ShardingSphere-Proxy">å¯åŠ¨ä¸å…³é—­ ShardingSphere Proxy</h2><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere Proxy è¦æ±‚ JDK 1.8 æˆ–ä»¥ä¸Šç‰ˆæœ¬</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$shardingsphere</span>-proxy$/bin</span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">./start.sh</span><br><span class="line"><span class="comment"># å…³é—­</span></span><br><span class="line">./stop.sh</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>-a</code></td><td>ç»‘å®šåœ°å€ï¼Œå¯ä»¥æ˜¯ IPv4ã€IPv6 æˆ–ä¸»æœºåï¼Œå¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”ã€‚</td><td><code>0.0.0.0</code></td></tr><tr><td><code>-p</code></td><td>ç»‘å®šç«¯å£å·ï¼Œå¯ä»¥åœ¨ <code>global.yaml</code> ä¸­ä¿®æ”¹ã€‚<code>-p</code> ä¼˜å…ˆçº§æ›´é«˜</td><td><code>3307</code></td></tr><tr><td><code>-c</code></td><td>ShardingSphere-Proxy é…ç½®ç›®å½•è·¯å¾„ã€‚</td><td><code>conf</code></td></tr><tr><td><code>-f</code></td><td>å¼ºåˆ¶å¯åŠ¨ ShardingSphere-Proxyã€‚</td><td>æ— </td></tr><tr><td><code>-g</code></td><td>å¦‚æœåœ¨ <code>agent</code> ç›®å½•ä¸‹éƒ¨ç½²äº† <code>shardingsphere-agent</code>ï¼Œå¯ç”¨ agent åŠŸèƒ½ã€‚</td><td>æ— </td></tr><tr><td><code>-s</code></td><td>æŒ‡å®šç”¨äºè¿æ¥çš„ socket æ–‡ä»¶è·¯å¾„ã€‚</td><td>æ— </td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere-Proxy å¯åŠ¨å‘½ä»¤é€ŸæŸ¥è¡¨</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>å‘½ä»¤ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>é»˜è®¤å¯åŠ¨</strong></td><td><code>./start.sh</code></td><td>é»˜è®¤ç«¯å£ <code>3307</code>ï¼Œé…ç½®ç›®å½• <code>conf</code></td></tr><tr><td><strong>æŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½•</strong></td><td><code>./start.sh 3308 /opt/shardingsphere-proxy/conf</code></td><td>ç®€å†™æ¨¡å¼ï¼ŒæŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½•</td></tr><tr><td><strong>å‚æ•°å½¢å¼å¯åŠ¨</strong></td><td><code>./start.sh -p 3308 -c /opt/shardingsphere-proxy/conf</code></td><td>ä¸ä¸Šé¢ç­‰æ•ˆï¼Œä½†æ›´æ˜ç¡®</td></tr><tr><td><strong>æŒ‡å®šç›‘å¬åœ°å€</strong></td><td><code>./start.sh -a 192.168.1.100 -p 3307 -c conf</code></td><td>æŒ‡å®šå•ä¸ª IP åœ°å€</td></tr><tr><td><strong>æŒ‡å®šå¤šä¸ªç›‘å¬åœ°å€</strong></td><td><code>./start.sh -a 192.168.1.100,127.0.0.1 -p 3307 -c conf</code></td><td>å¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”</td></tr><tr><td><strong>å¼ºåˆ¶å¯åŠ¨</strong></td><td><code>./start.sh -p 3307 -c conf -f</code></td><td>é‡åˆ°æ®‹ç•™ PID æ–‡ä»¶æ—¶ä½¿ç”¨</td></tr><tr><td><strong>å¯ç”¨ agent</strong></td><td><code>./start.sh -p 3307 -c conf -g</code></td><td>å¯åŠ¨ ShardingSphere-Agent</td></tr><tr><td><strong>ä½¿ç”¨ Unix Socket</strong></td><td><code>./start.sh -p 3307 -c conf -s /tmp/sharding-proxy.sock</code></td><td>é€šè¿‡ Socket æ–‡ä»¶è¿›è¡Œè¿æ¥</td></tr><tr><td><strong>å¤šé€‰é¡¹ç»„åˆ</strong></td><td><code>./start.sh -a 127.0.0.1 -p 3310 -c /opt/proxy/conf -f -g -s /tmp/proxy.sock</code></td><td>ä¸€æ¬¡æ€§æŒ‡å®šå¤šä¸ªé€‰é¡¹</td></tr></tbody></table><h2 id="é¡¹ç›®è¿æ¥-ShardingSphere-Proxy-æ—¶ï¼Œå°±åƒè¿æ¥æ™®é€šçš„-mysql-æœåŠ¡ä¸€æ ·">é¡¹ç›®è¿æ¥ ShardingSphere-Proxy æ—¶ï¼Œå°±åƒè¿æ¥æ™®é€šçš„ mysql æœåŠ¡ä¸€æ ·</h2><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹é¡¹ç›®ï¼š<a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy">https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy</a></p></li></ul><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ <code>ShardingSphere-JDBC</code> å’Œ <code>ShardingSphere-Proxy</code> ä¸­ï¼Œå­˜åœ¨éƒ¨åˆ† MySQL(å…¶å®ƒæ•°æ®åº“ä¹Ÿç±»ä¼¼) çš„ SQL è¯­æ³•æˆ–åŠŸèƒ½ç›®å‰è¿˜ä¸å®Œå…¨æ”¯æŒçš„æƒ…å†µã€‚<code>ShardingSphere</code> åœ¨åš SQL è·¯ç”±ã€æ”¹å†™ã€æ‰§è¡Œæ—¶ï¼Œå¿…é¡»èƒ½è§£æ SQL å¹¶ç†è§£å…¶è¯­ä¹‰ï¼Œä½†å¹¶ä¸æ˜¯ MySQL çš„ 100% å®Œå…¨ä»£ç†ã€‚å› æ­¤ï¼Œæœ‰äº›å¤æ‚æˆ–ç‰¹å®šåœºæ™¯ä¸‹çš„ SQL å¯èƒ½æ— æ³•è¢«æ­£ç¡®è§£ææˆ–æ‰§è¡Œã€‚</p></li><li class="lvl-2"><p>æ”¯æŒè‰¯å¥½çš„ SQL è¯­æ³•</p><ul class="lvl-2"><li class="lvl-4">åŸºç¡€ DML<br>SELECTã€INSERTã€UPDATEã€DELETE<br>åŸºæœ¬çš„æ¡ä»¶æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µã€åˆ†ç»„ã€èšåˆå‡½æ•°ï¼ˆå¦‚ COUNTã€SUMã€AVGï¼‰</li><li class="lvl-4">DCL<br>åŸºæœ¬çš„äº‹åŠ¡è¯­å¥ï¼šBEGINã€COMMITã€ROLLBACK</li><li class="lvl-4">DDL<br>éƒ¨åˆ†è¡¨ç»“æ„ç®¡ç†è¯­å¥ï¼šCREATE TABLEã€ALTER TABLEã€DROP TABLE</li><li class="lvl-4">å‡½æ•°æ”¯æŒ<br>å¤§éƒ¨åˆ†å¸¸ç”¨çš„ MySQL å†…ç½®å‡½æ•°ï¼Œå¦‚å­—ç¬¦ä¸²ã€æ•°å­¦ã€æ—¥æœŸå‡½æ•°</li></ul></li></ul><h3 id="åœ¨-ShardingSphere-MySQL-ä¸‹å»ºè®®é¿å…æˆ–è°¨æ…ä½¿ç”¨çš„-SQL-æ¸…å•">åœ¨ ShardingSphere + MySQL ä¸‹å»ºè®®é¿å…æˆ–è°¨æ…ä½¿ç”¨çš„ SQL æ¸…å•</h3><ul class="lvl-0"><li class="lvl-2"><ol><li class="lvl-5">è·¨åˆ†ç‰‡å¤æ‚æŸ¥è¯¢</li></ol></li></ul><table><thead><tr><th>SQL åœºæ™¯</th><th>åŸå› </th><th>å»ºè®®å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td>å¤šè¡¨å¤æ‚ JOINï¼ˆç‰¹åˆ«æ˜¯è·¨åˆ†ç‰‡ï¼‰</td><td>éœ€è¦è·¨åº“æ•°æ®èšåˆï¼Œæ€§èƒ½å·®ï¼Œå¯èƒ½æŠ¥é”™</td><td>ä½¿ç”¨å¹¿æ’­è¡¨/ç»‘å®šè¡¨ï¼Œæˆ–åœ¨åº”ç”¨å±‚å®Œæˆ</td></tr><tr><td>è·¨åˆ†ç‰‡å­æŸ¥è¯¢</td><td>SQL è·¯ç”±å›°éš¾ï¼Œå¯èƒ½ä¸æ”¯æŒ</td><td>å°½é‡æ”¹æˆå•è¡¨æŸ¥è¯¢æˆ–åˆ†æ­¥æŸ¥è¯¢</td></tr><tr><td>è·¨åˆ†ç‰‡çš„ GROUP BY / ORDER BY</td><td>åœ¨ Proxy å±‚èšåˆï¼Œæ€§èƒ½å¾ˆå·®</td><td>å°½é‡é¿å…ï¼Œæˆ–æ§åˆ¶æ•°æ®é‡</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><ol start="2"><li class="lvl-5">DDL ç›¸å…³</li></ol></li></ul><table><thead><tr><th>SQL åœºæ™¯</th><th>åŸå› </th><th>å»ºè®®å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td><code>ALTER TABLE</code> å¤æ‚å˜æ›´</td><td>éœ€åœ¨æ‰€æœ‰åˆ†ç‰‡æ‰§è¡Œï¼Œå¯èƒ½æ‰§è¡Œå¤±è´¥</td><td>æ‰‹åŠ¨åœ¨æ¯ä¸ªåˆ†ç‰‡åº“æ‰§è¡Œ</td></tr><tr><td><code>CREATE TRIGGER</code>ã€<code>PROCEDURE</code></td><td>Proxy ä¸è§£æè¿™äº›è¯­æ³•ï¼Œç›´æ¥é€ä¼ ä¸å®‰å…¨</td><td>å°½é‡åœ¨å•åº“æ‰‹åŠ¨åˆ›å»º</td></tr><tr><td><code>CREATE FUNCTION</code></td><td>åŒä¸Š</td><td>å•åº“æ‰§è¡Œæˆ–åº”ç”¨å±‚æ›¿ä»£</td></tr><tr><td><code>FULLTEXT INDEX</code>ã€<code>SPATIAL INDEX</code></td><td>åˆ†ç‰‡ç¯å¢ƒä¸‹æ— æ³•è‡ªåŠ¨ç»´æŠ¤ç´¢å¼•</td><td>å•åº“æ‰‹åŠ¨ç»´æŠ¤æˆ–é¿å…ä½¿ç”¨</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><ol start="3"><li class="lvl-5">æ–‡ä»¶å¯¼å…¥å¯¼å‡º</li></ol></li></ul><table><thead><tr><th>SQL åœºæ™¯</th><th>åŸå› </th><th>å»ºè®®å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td><code>LOAD DATA INFILE</code></td><td>Proxy ä¸æ”¯æŒæ–‡ä»¶ç³»ç»Ÿç›´æ¥è®¿é—®</td><td>åœ¨åˆ†ç‰‡åº“æ‰‹åŠ¨æ‰§è¡Œæˆ–é€šè¿‡åº”ç”¨å¯¼å…¥</td></tr><tr><td><code>SELECT ... INTO OUTFILE</code></td><td>åŒä¸Š</td><td>åº”ç”¨å±‚å¤„ç†å¯¼å‡º</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><ol start="4"><li class="lvl-5">MySQL ç‰¹æœ‰åŠŸèƒ½</li></ol></li></ul><table><thead><tr><th>åŠŸèƒ½</th><th>æ”¯æŒæƒ…å†µ</th><th>å»ºè®®</th></tr></thead><tbody><tr><td>MySQL 8.0 å…¬å…±è¡¨è¡¨è¾¾å¼ï¼ˆCTEï¼‰</td><td>éƒ¨åˆ†æ”¯æŒ</td><td>é¿å…è·¨åˆ†ç‰‡ä½¿ç”¨</td></tr><tr><td>çª—å£å‡½æ•°ï¼ˆ<code>OVER() PARTITION BY</code>ï¼‰</td><td>éƒ¨åˆ†æ”¯æŒ</td><td>é¿å…è·¨åˆ†ç‰‡å¤§æ•°æ®é‡ä½¿ç”¨</td></tr><tr><td>JSON å‡½æ•°</td><td>åŸºæœ¬æ”¯æŒ</td><td>å•è¡¨åœºæ™¯å¯ç”¨ï¼Œè·¨åˆ†ç‰‡éœ€è°¨æ…</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åˆ†å¸ƒå¼äº‹åŠ¡</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>é—®é¢˜åŸå› </th><th>å»ºè®®å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td>è·¨åˆ†ç‰‡åŸç”Ÿäº‹åŠ¡</td><td>MySQL åŸç”Ÿäº‹åŠ¡ä¸æ”¯æŒè·¨åº“</td><td>ä½¿ç”¨ ShardingSphere XA / BASE</td></tr><tr><td>å¤§äº‹åŠ¡ + åˆ†å¸ƒå¼äº‹åŠ¡</td><td>æ€§èƒ½å¼€é”€å¤§</td><td>å°½é‡æ§åˆ¶äº‹åŠ¡èŒƒå›´</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://shardingsphere.apache.org/index_zh.html&quot;&gt;ShardingSphereå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy&quot;&gt;æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡å°† &lt;a href=&quot;/2025/09/01/springboot3-shardingsphere/&quot; title=&quot;SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨&quot;&gt;SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨&lt;/a&gt; ä¿®æ”¹ä¸º &lt;code&gt;ShardingSphere-Proxy&lt;/code&gt; çš„æ¨¡å¼&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/sharding-sphere/"/>
    
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/tags/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/tags/sharding-sphere/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨</title>
    <link href="https://blog.hanqunfeng.com/2025/09/01/springboot3-shardingsphere/"/>
    <id>https://blog.hanqunfeng.com/2025/09/01/springboot3-shardingsphere/</id>
    <published>2025-09-01T13:30:05.000Z</published>
    <updated>2025-09-15T06:26:28.263Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/index_zh.html">ShardingSphereå®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-01">æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€</a></p></li></ul><span id="more"></span><h2 id="ShardingSphere-JDBC-ç®€ä»‹">ShardingSphere-JDBC ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere-JDBC å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p><ul class="lvl-2"><li class="lvl-4">é€‚ç”¨äºä»»ä½•åŸºäº JDBC çš„ ORM æ¡†æ¶ï¼Œå¦‚ï¼šJPA, Hibernate, Mybatis, Spring JDBC Template æˆ–ç›´æ¥ä½¿ç”¨ JDBCï¼›</li><li class="lvl-4">æ”¯æŒä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, HikariCP ç­‰ï¼›</li><li class="lvl-4">æ”¯æŒä»»æ„å®ç° JDBC è§„èŒƒçš„æ•°æ®åº“ï¼Œç›®å‰æ”¯æŒ MySQLï¼ŒPostgreSQLï¼ŒOracleï¼ŒSQLServer ä»¥åŠä»»ä½•å¯ä½¿ç”¨ JDBC è®¿é—®çš„æ•°æ®åº“ã€‚</li></ul></li><li class="lvl-2"><p>ShardingSphere-JDBC ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/RgXClY.png" alt=""></p></li></ul><h2 id="mavenä¾èµ–">mavenä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æœ¬é¡¹ç›® åŸºäº mysql --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="application-yml">application.yml</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">org.apache.shardingsphere.driver.ShardingSphereDriver</span></span><br><span class="line">    <span class="comment"># æŒ‡å‘ç±»è·¯å¾„ä¸‹çš„ sharding.yamlï¼ˆä¹Ÿå¯ absolute path / file: / http: ç­‰ï¼Œè§å®˜æ–¹è¯´æ˜ï¼‰</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:shardingsphere:classpath:sharding.yaml</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¹Ÿå¯ä»¥ä¸åœ¨ <code>application.yml</code> ä¸­é…ç½®ï¼Œè€Œæ˜¯é€šè¿‡ <code>@Configuration</code> åˆ›å»º <code>@Bean</code>ï¼Œè¿™æ ·å°±å¯ä»¥é…ç½®å¤šæ•°æ®æºäº†ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;shardingDataSource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">shardingDataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, IOException &#123;</span><br><span class="line">        <span class="comment">// ShardingSphere æä¾›çš„å·¥å‚æ–¹æ³•ï¼Œæ ¹æ®é…ç½®æ„å»º DataSource</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;sharding.yaml&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputStream == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Cannot find sharding.yaml in classpath&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">byte</span>[] yamlBytes = inputStream.readAllBytes();</span><br><span class="line">            <span class="keyword">return</span> YamlShardingSphereDataSourceFactory.createDataSource(yamlBytes);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="sharding-yaml">sharding.yaml</h2><ul class="lvl-0"><li class="lvl-2"><p>å®Œæ•´é…ç½®ï¼Œä¸‹æ–‡ä¼šä»‹ç»éƒ¨åˆ†é…ç½®</p></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/</span></span><br><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_0:</span> <span class="comment"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ds_1:</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="comment"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class="line">    <span class="attr">bindingTables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t_order,t_order_item</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">course:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">cid</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_inline</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">cid</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order-complex-algorithm</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class="line"><span class="comment">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_item-class-based-algorithm_spi</span> <span class="comment"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">t_user:</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">id</span> <span class="comment"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line"><span class="comment">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">custom_snowflake_string</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#       t_address:      # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜</span></span><br><span class="line"><span class="comment">#         actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">autoTables:</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/</span></span><br><span class="line">      <span class="attr">course_inline:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># å±æ€§</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">course_$&#123;cid</span> <span class="string">%</span> <span class="number">2</span> <span class="string">+</span> <span class="number">1</span><span class="string">&#125;</span> <span class="comment"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class="line">          <span class="attr">allow-range-query-with-inline-sharding:</span> <span class="literal">true</span> <span class="comment"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">      <span class="attr">course_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span> <span class="comment"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class="line">      <span class="attr">mod_2:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MOD</span> <span class="comment"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">sharding-count:</span> <span class="number">2</span> <span class="comment"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class="line">      <span class="attr">t_order_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order-complex-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">COMPLEX_INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_order_complex_$&#123;(user_id</span> <span class="string">+</span> <span class="string">order_id</span> <span class="string">+</span> <span class="number">1</span><span class="string">)</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CLASS_BASED</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">strategy:</span> <span class="string">COMPLEX</span> <span class="comment"># æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥</span></span><br><span class="line">          <span class="attr">algorithmClassName:</span> <span class="string">com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm</span> <span class="comment"># æŒ‡å®šç®—æ³•ç±»</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm_spi:</span> <span class="comment"># SPI</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">T_ORDER_ITEM_COMPLEX</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_user_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span></span><br><span class="line">      <span class="attr">t_user_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br><span class="line">      <span class="attr">uuid:</span>    <span class="comment"># å®šä¹‰åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">UUID</span> <span class="comment"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class="line">      <span class="attr">custom_snowflake_string:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CUSTOM_SNOWFLAKE_STRING</span>  <span class="comment"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒString</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">workerId:</span> <span class="number">2</span></span><br><span class="line">          <span class="attr">datacenterId:</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!BROADCAST</span>  <span class="comment"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dict</span>    <span class="comment"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!ENCRYPT</span>    <span class="comment"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># åŠ å¯†è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># åŠ å¯†åˆ—åç§°</span></span><br><span class="line">            <span class="attr">cipher:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">password</span> <span class="comment"># å¯†æ–‡åˆ—åç§°</span></span><br><span class="line">              <span class="attr">encryptorName:</span> <span class="string">aes_encryptor</span> <span class="comment"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class="line">    <span class="comment"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class="line">    <span class="attr">encryptors:</span></span><br><span class="line">      <span class="attr">aes_encryptor:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">AES</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line">          <span class="attr">aes-key-value:</span> <span class="string">123456abc</span>     <span class="comment"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class="line">          <span class="attr">digest-algorithm-name:</span> <span class="string">SHA-1</span> <span class="comment"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class="line">      <span class="attr">md5_encryptor:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">salt:</span> <span class="number">123456</span>  <span class="comment"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!MASK</span>  <span class="comment"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># è„±æ•è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span>  <span class="comment"># è„±æ•åˆ—é…ç½®</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># è„±æ•åˆ—åç§°</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">md5_mask</span> <span class="comment"># è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">email:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">mask_before_special_chars_mask</span></span><br><span class="line">          <span class="attr">telephone:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">keep_first_n_last_m_mask</span></span><br><span class="line">          <span class="attr">name:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">my_mask</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">maskAlgorithms:</span> <span class="comment"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class="line">      <span class="attr">md5_mask:</span> <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span>  <span class="comment"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class="line">      <span class="attr">mask_before_special_chars_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MASK_BEFORE_SPECIAL_CHARS</span> <span class="comment"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">special-chars:</span> <span class="string">&#x27;@&#x27;</span>  <span class="comment"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span>   <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">keep_first_n_last_m_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">KEEP_FIRST_N_LAST_M</span> <span class="comment"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">first-n:</span> <span class="number">3</span>     <span class="comment"># ä¿ç•™å‰ 3 ä½</span></span><br><span class="line">          <span class="attr">last-m:</span> <span class="number">4</span>      <span class="comment"># ä¿ç•™å 4 ä½</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">my_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MY_CUSTOM_MASK</span>  <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&quot;#&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SINGLE</span> <span class="comment"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="comment"># MySQL é£æ ¼</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ds_0.t_address</span> <span class="comment"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br><span class="line"><span class="comment">#       - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨</span></span><br><span class="line"><span class="comment">#       - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/</span></span><br><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span> <span class="comment"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class="line">  <span class="attr">check-table-metadata-enabled:</span> <span class="literal">false</span> <span class="comment"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure><h3 id="æ•°æ®æºé…ç½®">æ•°æ®æºé…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>hikari + mysql</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_0:</span> <span class="comment"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ds_1:</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>druid + mysql</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_1:</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line">    <span class="comment"># Druid ç‰¹æœ‰é…ç½®</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>druid + mysql + p6spy</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_0:</span> <span class="comment"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.p6spy.engine.spy.P6SpyDriver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:p6spy:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line">    <span class="comment"># Druid ç‰¹æœ‰é…ç½®</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br></pre></td></tr></table></figure><h3 id="åˆ†åº“åˆ†è¡¨é…ç½®">åˆ†åº“åˆ†è¡¨é…ç½®</h3><h4 id="å•åˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹">å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">course:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">cid</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_inline</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">cid</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">course_inline:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># å±æ€§</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">course_$&#123;cid</span> <span class="string">%</span> <span class="number">2</span> <span class="string">+</span> <span class="number">1</span><span class="string">&#125;</span> <span class="comment"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class="line">          <span class="attr">allow-range-query-with-inline-sharding:</span> <span class="literal">true</span> <span class="comment"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">      <span class="attr">course_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span> <span class="comment"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ä¸åŒçš„å­—æ®µï¼Œåˆ†åº“ä½¿ç”¨ user_idï¼Œåˆ†è¡¨ä½¿ç”¨ cid</p></li><li class="lvl-2"><p>allow-range-query-with-inline-sharding: true ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå…è®¸èŒƒå›´æŸ¥è¯¢ï¼Œé»˜è®¤å€¼æ˜¯ falseï¼Œä¸å…è®¸ between æŸ¥è¯¢</p></li></ul><h4 id="å•åˆ†ç‰‡é”®ï¼ŒString-ç±»å‹">å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_user:</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">id</span> <span class="comment"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line"><span class="comment">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">custom_snowflake_string</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_user_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span> <span class="comment"># åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®—</span></span><br><span class="line">      <span class="attr">t_user_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span> <span class="comment"># åˆ†è¡¨ï¼Œt_user_0, t_user_1</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</span></span><br><span class="line">      <span class="attr">uuid:</span>    <span class="comment"># å®šä¹‰åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">UUID</span> <span class="comment"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class="line">      <span class="attr">custom_snowflake_string:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CUSTOM_SNOWFLAKE_STRING</span> <span class="comment"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">workerId:</span> <span class="number">2</span></span><br><span class="line">          <span class="attr">datacenterId:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ç›¸åŒçš„å­—æ®µï¼Œå³ä¸»é”®idï¼Œå› å…¶ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ hashCode() è·å–æ•°å­—ï¼Œå†è¿›è¡Œè¿ç®—</p></li><li class="lvl-2"><p>ä¸»é”®è·å–è§„åˆ™ä½¿ç”¨çš„è‡ªå®šä¹‰çš„é›ªèŠ±ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.infra.algorithm.keygen.core.KeyGenerateAlgorithm</code>ï¼Œè¿™é‡Œæ³¨æ„ï¼Œä» <code>5.5.3</code> å¼€å§‹ä¼šæ›´æ¢ä¸º <code>org.apache.shardingsphere.infra.algorithm.keygen.spi.KeyGenerateAlgorithm</code></p></li></ul><h4 id="å¤šåˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹">å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order-complex-algorithm</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class="line"><span class="comment">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_item-class-based-algorithm_spi</span> <span class="comment"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_order_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order-complex-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">COMPLEX_INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_order_complex_$&#123;(user_id</span> <span class="string">+</span> <span class="string">order_id</span> <span class="string">+</span> <span class="number">1</span><span class="string">)</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CLASS_BASED</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">strategy:</span> <span class="string">COMPLEX</span> <span class="comment"># æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥</span></span><br><span class="line">          <span class="attr">algorithmClassName:</span> <span class="string">com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm</span> <span class="comment"># æŒ‡å®šç®—æ³•ç±»</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm_spi:</span> <span class="comment"># SPI</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">T_ORDER_ITEM_COMPLEX</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¤šä¸ªåˆ†ç‰‡é”®ï¼Œ<code>t_order_complex</code>è¡¨ä½¿ç”¨äº†å†…ç½®çš„<code>COMPLEX_INLINE</code>ç®—æ³•ï¼Œè€Œ<code>t_order_item_complex</code>è¡¨ä½¿ç”¨äº†è‡ªå®šä¹‰çš„çš„åˆ†ç‰‡ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.sharding.spi.ShardingAlgorithm</code></p></li></ul><h4 id="è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™">è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</h4><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">   <span class="comment"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class="line">    <span class="attr">bindingTables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t_order,t_order_item</span></span><br><span class="line">    <span class="attr">autoTables:</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">mod_2:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MOD</span> <span class="comment"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">sharding-count:</span> <span class="number">2</span> <span class="comment"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™éœ€è¦å£°æ˜æ•°æ®åº“ï¼Œä½†ä¸éœ€è¦å£°æ˜è¡¨åˆ†é…è§„åˆ™ï¼Œå…¶æ ¹æ®åˆ†ç‰‡ç®—æ³•è‡ªåŠ¨ç¡®å®šå…·ä½“çš„æ•°æ®è¡¨ã€‚</p></li><li class="lvl-2"><p>åŒæ—¶è¿™é‡Œè¿˜é…ç½®äº†<code>bindingTables</code>ï¼Œç”¨æ¥æŒ‡å®šå…¶åˆ†ç‰‡è·¯ç”±ä¸€è‡´ã€‚</p></li></ul><h3 id="å¹¿æ’­è¡¨é…ç½®">å¹¿æ’­è¡¨é…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!BROADCAST</span>  <span class="comment"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dict</span>    <span class="comment"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åŠ å¯†è§„åˆ™">æ•°æ®åŠ å¯†è§„åˆ™</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!ENCRYPT</span>    <span class="comment"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># åŠ å¯†è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># åŠ å¯†åˆ—åç§°</span></span><br><span class="line">            <span class="attr">cipher:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">password</span> <span class="comment"># å¯†æ–‡åˆ—åç§°</span></span><br><span class="line">              <span class="attr">encryptorName:</span> <span class="string">aes_encryptor</span> <span class="comment"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class="line">    <span class="comment"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class="line">    <span class="attr">encryptors:</span></span><br><span class="line">      <span class="attr">aes_encryptor:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">AES</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line">          <span class="attr">aes-key-value:</span> <span class="string">123456abc</span>     <span class="comment"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class="line">          <span class="attr">digest-algorithm-name:</span> <span class="string">SHA-1</span> <span class="comment"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class="line">      <span class="attr">md5_encryptor:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">salt:</span> <span class="number">123456</span>  <span class="comment"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®åŠ å¯†å­—æ®µè§„åˆ™åï¼Œæ–°å¢æ•°æ®æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¹åŠ å¯†å­—æ®µåŠ å¯†åå­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶ä¹Ÿä¼šåŠ å¯†åè¿›è¡Œæ¯”è¾ƒæŸ¥è¯¢ã€‚</p></li></ul><h3 id="æ•°æ®è„±æ•è§„åˆ™">æ•°æ®è„±æ•è§„åˆ™</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!MASK</span>  <span class="comment"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># è„±æ•è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span>  <span class="comment"># è„±æ•åˆ—é…ç½®</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># è„±æ•åˆ—åç§°</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">md5_mask</span> <span class="comment"># è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">email:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">mask_before_special_chars_mask</span></span><br><span class="line">          <span class="attr">telephone:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">keep_first_n_last_m_mask</span></span><br><span class="line">          <span class="attr">name:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">my_mask</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">maskAlgorithms:</span> <span class="comment"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class="line">      <span class="attr">md5_mask:</span> <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span>  <span class="comment"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class="line">      <span class="attr">mask_before_special_chars_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MASK_BEFORE_SPECIAL_CHARS</span> <span class="comment"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">special-chars:</span> <span class="string">&#x27;@&#x27;</span>  <span class="comment"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span>   <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">keep_first_n_last_m_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">KEEP_FIRST_N_LAST_M</span> <span class="comment"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">first-n:</span> <span class="number">3</span>     <span class="comment"># ä¿ç•™å‰ 3 ä½</span></span><br><span class="line">          <span class="attr">last-m:</span> <span class="number">4</span>      <span class="comment"># ä¿ç•™å 4 ä½</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">my_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MY_CUSTOM_MASK</span>  <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&quot;#&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¢«è„±æ•çš„å­—æ®µåœ¨æŸ¥è¯¢æ—¶ä¼šè¿›è¡Œè„±æ•å±•ç¤ºã€‚</p></li><li class="lvl-2"><p>è¿™é‡Œè¿˜è‡ªå®šä¹‰äº†è„±æ•ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.mask.spi.MaskAlgorithm</code></p></li></ul><h3 id="å•è¡¨è§„åˆ™">å•è¡¨è§„åˆ™</h3><ul class="lvl-0"><li class="lvl-2"><p>å³ä¸éœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨çš„è¡¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SINGLE</span> <span class="comment"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="comment"># MySQL é£æ ¼</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ds_0.t_address</span> <span class="comment"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br></pre></td></tr></table></figure><h3 id="å±æ€§é…ç½®">å±æ€§é…ç½®</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/</span></span><br><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span> <span class="comment"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class="line">  <span class="attr">check-table-metadata-enabled:</span> <span class="literal">false</span> <span class="comment"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure><h3 id="äº‹åŠ¡é…ç½®">äº‹åŠ¡é…ç½®</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/</span></span><br><span class="line"><span class="attr">transaction:</span></span><br><span class="line">  <span class="attr">defaultType:</span> <span class="string">LOCAL</span> <span class="comment"># é»˜è®¤äº‹åŠ¡ç±»å‹å°±æ˜¯ LOCAL</span></span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ä¸ springboot2 ä¸åŒï¼Œä¸å†æä¾› <code>springboot-starter-shardingsphere</code>ï¼Œç›¸å…³é…ç½®ä¹Ÿé‡‡ç”¨äº†ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ã€‚</p></li><li class="lvl-2"><p>ä»£ç ä¸­åŒ…å«ä¸¤ä¸ªåº“ä¸­ä½¿ç”¨åˆ°çš„æ•°æ®åº“è„šæœ¬ï¼Œ<code>shardingsphere-demo/shardingsphere-demo-01/sql</code></p></li><li class="lvl-2"><p>å…·ä½“ä½¿ç”¨æ•ˆæœå¯ä»¥é€šè¿‡é¡¹ç›®ä¸­æä¾›çš„å•å…ƒæµ‹è¯•ç±»è¿›è¡ŒéªŒè¯ã€‚</p></li><li class="lvl-2"><p>springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ç›®å‰<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/jdbc-driver/spring-boot/">å°šä¸æ”¯æŒ <code>XA</code> åˆ†å¸ƒå¼äº‹åŠ¡</a>ï¼Œè¿™æ˜¯å› ä¸ºä» <code>Spring Boot 3.x</code> å¼€å§‹ï¼Œå°±å…¨é¢è¿ç§»åˆ°äº† <code>Jakarta EE 9+</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ <code>javax.*</code> çš„ç±»éƒ½è¿ç§»åˆ° <code>jakarta.*</code> å‘½åç©ºé—´(äº‹åŠ¡ã€JPAã€Servlet ç­‰ API éƒ½å—å½±å“)ï¼Œè€Œ <code>ShardingSphere 5.5</code> ä¸­çš„ XA äº‹åŠ¡ä¸»è¦ä¾èµ– <code>Atomikos</code> æˆ– <code>Narayana</code> ç­‰ç¬¬ä¸‰æ–¹åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†å™¨ï¼Œè¿™äº›åº“ç›®å‰å¤§éƒ¨åˆ†è¿˜æ˜¯åŸºäº <code>javax.transaction.*</code> çš„ APIã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://shardingsphere.apache.org/index_zh.html&quot;&gt;ShardingSphereå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-01&quot;&gt;æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/sharding-sphere/"/>
    
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/tags/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/tags/sharding-sphere/"/>
    
  </entry>
  
  <entry>
    <title>K8S UI ä¹‹ Rancher</title>
    <link href="https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/"/>
    <id>https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/</id>
    <published>2025-07-25T14:33:05.000Z</published>
    <updated>2025-09-15T06:26:27.684Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://ranchermanager.docs.rancher.com/zh/">Rancher å®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/rancher/rancher">Rancher Github</a></p></li></ul><span id="more"></span><h2 id="Rancher-ç®€ä»‹">Rancher ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Rancher æ˜¯ä¸€ä¸ª å¼€æºçš„ Kubernetes ç®¡ç†å¹³å°ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·éƒ¨ç½²ã€ç®¡ç†å’Œè¿ç»´å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œå…·æœ‰æ˜“ç”¨çš„ Web UIã€æƒé™æ§åˆ¶ã€é›†ç¾¤ç›‘æ§ã€åº”ç”¨ç®¡ç†ç­‰åŠŸèƒ½ï¼Œå¹¿æ³›åº”ç”¨äºä¼ä¸šçš„äº‘åŸç”Ÿå¹³å°å»ºè®¾ä¸­ã€‚</p></li></ul><h2 id="éƒ¨ç½²-Rancher">éƒ¨ç½² Rancher</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://ranchermanager.docs.rancher.com/zh/getting-started/quick-start-guides/deploy-rancher-manager/helm-cli#%E4%BD%BF%E7%94%A8-helm-%E6%9D%A5%E5%AE%89%E8%A3%85-rancher">ä½¿ç”¨ Helm å®‰è£… Rancher</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  rancher çš„ Helm ä»“åº“</span></span><br><span class="line">helm repo add rancher-latest https://releases.rancher.com/server-charts/latest</span><br><span class="line"><span class="comment"># æ›´æ–° rancher çš„ Helm ä»“åº“</span></span><br><span class="line">helm repo update</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ rancher çš„ç‰ˆæœ¬</span></span><br><span class="line">$ helm search repo rancher -l | <span class="built_in">head</span></span><br><span class="line">NAME                  CHART VERSIONAPP VERSIONDESCRIPTION</span><br><span class="line">rancher-latest/rancher2.11.3       v2.11.3    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.11.2       v2.11.2    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.11.1       v2.11.1    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.11.0       v2.11.0    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.3       v2.10.3    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.2       v2.10.2    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.1       v2.10.1    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.0       v2.10.0    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.9.3        v2.9.3     Install Rancher Server to manage Kubernetes clu...</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">kubectl create namespace cattle-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¯ä¹¦ï¼Œè¯ä¹¦æ˜¯æœºæ„é¢å‘çš„</span></span><br><span class="line">kubectl create secret tls tls-rancher-ingress \</span><br><span class="line">  --key=nginx_ssl/nginx.hanqunfeng.com.key \</span><br><span class="line">  --cert=nginx_ssl/nginx.hanqunfeng.com.pem \</span><br><span class="line">  -n cattle-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Rancher  --version v2.11.3 å¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼Œé»˜è®¤æœ€æ–°ç‰ˆ</span></span><br><span class="line">helm install rancher rancher-latest/rancher \</span><br><span class="line">  --namespace cattle-system \</span><br><span class="line">  --create-namespace \</span><br><span class="line">  --<span class="built_in">set</span> hostname=rancher.hanqunfeng.com \</span><br><span class="line">  --<span class="built_in">set</span> ingress.tls.source=secret \</span><br><span class="line">  --<span class="built_in">set</span> replicas=3 \</span><br><span class="line">  --<span class="built_in">set</span> bootstrapPassword=rancher#2025</span><br><span class="line"></span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># --set hostname=rancher.hanqunfeng.com è®¾ç½® rancher çš„åŸŸå</span></span><br><span class="line"><span class="comment"># --set ingress.tls.source=secret é…ç½® rancher çš„è¯ä¹¦ï¼Œåç§°ä¸º tls-rancher-ingress</span></span><br><span class="line"><span class="comment"># --set replicas=3 è®¾ç½® rancher çš„å‰¯æœ¬æ•°</span></span><br><span class="line"><span class="comment"># --set bootstrapPassword=rancher#2025 è®¾ç½® rancher çš„åˆå§‹å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ä¸è¿‡æ‰§è¡Œä¸Šé¢çš„å®‰è£…å‘½ä»¤ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯å½“å‰çš„ rancher ç‰ˆæœ¬ä¸æ”¯æŒ Kubernetes v1.33.2</span></span><br><span class="line">Error: INSTALLATION FAILED: chart requires kubeVersion: &lt; 1.33.0-0 <span class="built_in">which</span> is incompatible with Kubernetes v1.33.2</span><br><span class="line"></span><br><span class="line"><span class="comment">## è§£å†³åŠæ³•</span></span><br><span class="line"><span class="comment"># ä¸‹è½½å¹¶è§£å‹ rancher å®‰è£…åŒ…</span></span><br><span class="line">helm pull rancher-latest/rancher --untar --untardir ./</span><br><span class="line"><span class="comment"># ä¿®æ”¹å…¶ä¸­çš„ Chart.yaml æ–‡ä»¶</span></span><br><span class="line">kubeVersion: &lt; 1.33.0-0 ==&gt; kubeVersion: &lt; 1.34.0-0</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… rancher</span></span><br><span class="line">helm install rancher rancher \</span><br><span class="line">  --namespace cattle-system \</span><br><span class="line">  --create-namespace \</span><br><span class="line">  --<span class="built_in">set</span> hostname=rancher.hanqunfeng.com \</span><br><span class="line">  --<span class="built_in">set</span> ingress.tls.source=secret \</span><br><span class="line">  --<span class="built_in">set</span> replicas=3 \</span><br><span class="line">  --<span class="built_in">set</span> bootstrapPassword=rancher#2025</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">NAME: rancher</span><br><span class="line">LAST DEPLOYED: Thu Jul 24 23:55:24 2025</span><br><span class="line">NAMESPACE: cattle-system</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">Rancher Server has been installed.</span><br><span class="line"></span><br><span class="line">NOTE: Rancher may take several minutes to fully initialize. Please standby <span class="keyword">while</span> Certificates are being issued, Containers are started and the Ingress rule comes up.</span><br><span class="line"></span><br><span class="line">Check out our docs at https://rancher.com/docs/</span><br><span class="line"></span><br><span class="line">If you provided your own bootstrap password during installation, browse to https://rancher.hanqunfeng.com to get started.</span><br><span class="line"></span><br><span class="line">If this is the first time you installed Rancher, get started by running this <span class="built_in">command</span> and clicking the URL it generates:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> https://rancher.hanqunfeng.com/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class="string">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">To get just the bootstrap password on its own, run:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class="string">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123; &quot;\n&quot; &#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Happy Containering!</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹åˆ›å»ºçš„èµ„æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ k get all,ing -n cattle-system</span><br><span class="line">NAME                                   READY   STATUS      RESTARTS   AGE</span><br><span class="line">pod/helm-operation-8257k               0/2     Completed   0          11m</span><br><span class="line">pod/helm-operation-g8blp               0/2     Completed   0          12m</span><br><span class="line">pod/helm-operation-hwpbp               0/2     Completed   0          10m</span><br><span class="line">pod/helm-operation-qbs5n               0/2     Completed   0          10m</span><br><span class="line">pod/helm-operation-wlptb               0/2     Completed   0          13m</span><br><span class="line">pod/rancher-56689b7d8c-v7hpd           1/1     Running     0          21m</span><br><span class="line">pod/rancher-56689b7d8c-xnrbf           1/1     Running     0          21m</span><br><span class="line">pod/rancher-56689b7d8c-xvqgs           1/1     Running     0          21m</span><br><span class="line">pod/rancher-webhook-5fd5fc44f9-8xwjk   1/1     Running     0          11m</span><br><span class="line"></span><br><span class="line">NAME                               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">service/imperative-api-extension   ClusterIP   10.96.188.28   &lt;none&gt;        6666/TCP         15m</span><br><span class="line">service/rancher                    ClusterIP   10.96.21.41    &lt;none&gt;        80/TCP,443/TCP   21m</span><br><span class="line">service/rancher-webhook            ClusterIP   10.96.85.153   &lt;none&gt;        443/TCP          11m</span><br><span class="line"></span><br><span class="line">NAME                              READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/rancher           3/3     3            3           21m</span><br><span class="line">deployment.apps/rancher-webhook   1/1     1            1           11m</span><br><span class="line"></span><br><span class="line">NAME                                         DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/rancher-56689b7d8c           3         3         3       21m</span><br><span class="line">replicaset.apps/rancher-webhook-5fd5fc44f9   1         1         1       11m</span><br><span class="line"></span><br><span class="line">NAME                                CLASS   HOSTS                    ADDRESS         PORTS     AGE</span><br><span class="line">ingress.networking.k8s.io/rancher   nginx   rancher.hanqunfeng.com   10.211.55.201   80, 443   21m</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµè§ˆå™¨è®¿é—®ï¼š<a href="https://rancher.hanqunfeng.com">https://rancher.hanqunfeng.com</a>ï¼Œè¾“å…¥ä¸Šé¢è®¾ç½®çš„å¯†ç å³å¯ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœå¿˜è®°åˆå§‹å¯†ç å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯†ç </span></span><br><span class="line">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class="string">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123;&quot;\n&quot;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/rHDDMN.png" alt=""></p><h2 id="å¸è½½-Rancher">å¸è½½ Rancher</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸è½½ Rancher</span></span><br><span class="line">helm uninstall rancher -n cattle-system</span><br><span class="line"><span class="comment"># åˆ é™¤ cattle-system å‘½åç©ºé—´</span></span><br><span class="line">kubectl delete namespace cattle-system</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://ranchermanager.docs.rancher.com/zh/&quot;&gt;Rancher å®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/rancher/rancher&quot;&gt;Rancher Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S UI ä¹‹ Kubesphere</title>
    <link href="https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/"/>
    <id>https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/</id>
    <published>2025-07-24T14:33:05.000Z</published>
    <updated>2025-07-24T13:38:25.076Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubesphere.io/zh/">Kubesphere å®˜ç½‘</a></p></li></ul><span id="more"></span><h2 id="Kubesphere-ç®€ä»‹">Kubesphere ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>KubeSphere æ˜¯ä¸€ä¸ªåŸºäº Kubernetes æ„å»ºçš„ ä¼ä¸šçº§å¤šç§Ÿæˆ·å®¹å™¨ç®¡ç†å¹³å°ï¼Œæä¾›äº†ä¸€å¥—å®Œæ•´çš„å®¹å™¨å¹³å°è§£å†³æ–¹æ¡ˆï¼Œè®©ç”¨æˆ·ä»¥å›¾å½¢åŒ–æ–¹å¼è½»æ¾ä½¿ç”¨ Kubernetes å’Œ DevOps èƒ½åŠ›ï¼Œä¸éœ€è¦æ·±å…¥ç†è§£å¤æ‚çš„åº•å±‚æ¶æ„ã€‚</p></li><li class="lvl-2"><p>ä¸ K8S çš„ Dashboard ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p></li></ul><table><thead><tr><th>åŠŸèƒ½ / ç‰¹æ€§</th><th>Kubernetes Dashboard</th><th><strong>KubeSphere</strong></th></tr></thead><tbody><tr><td>âœ… åŸºç¡€èµ„æºç®¡ç†</td><td>âœ… æ”¯æŒ</td><td>âœ… æ›´ä¸°å¯Œï¼Œæ”¯æŒæ›´å¤šç»†ç²’åº¦æ§åˆ¶</td></tr><tr><td>ğŸ‘¥ å¤šç§Ÿæˆ·æ”¯æŒ</td><td>âŒ æ— </td><td>âœ… å†…å»ºä¼ä¸šçº§å¤šç§Ÿæˆ·ã€ç©ºé—´ï¼ˆWorkspaceï¼‰éš”ç¦»</td></tr><tr><td>ğŸ” èº«ä»½è®¤è¯ä¸æƒé™æ§åˆ¶</td><td>âš ï¸ éœ€æ‰‹åŠ¨æ•´åˆ RBAC</td><td>âœ… å†…å»ºç”¨æˆ·ç®¡ç†ã€è§’è‰²ã€å›¢é˜Ÿã€ä¼ä¸šç»„ç»‡æ¶æ„</td></tr><tr><td>ğŸŒ å¤šé›†ç¾¤æ”¯æŒ</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒè·¨åŒºåŸŸå¤šé›†ç¾¤ç»Ÿä¸€ç®¡ç†</td></tr><tr><td>ğŸš€ DevOpsï¼ˆCI/CD æµæ°´çº¿ï¼‰</td><td>âŒ æ— </td><td>âœ… å†…ç½®å›¾å½¢åŒ–æµæ°´çº¿ï¼ˆJenkins é©±åŠ¨ï¼‰</td></tr><tr><td>ğŸ“Š ç›‘æ§ä¸æŒ‡æ ‡ï¼ˆPrometheusï¼‰</td><td>âŒ æ‰‹åŠ¨å®‰è£…</td><td>âœ… å†…ç½®ï¼Œå›¾å½¢åŒ–å±•ç¤º Pod/Node/æœåŠ¡ç­‰ç›‘æ§æ•°æ®</td></tr><tr><td>ğŸ“ æ—¥å¿—æŸ¥è¯¢ä¸åˆ†æï¼ˆEFKï¼‰</td><td>âŒ æ— </td><td>âœ… å†…å»º Fluent Bit + Elasticsearch + Kibana</td></tr><tr><td>ğŸ’¡ å¾®æœåŠ¡æ²»ç†ï¼ˆIstioï¼‰</td><td>âŒ æ— </td><td>âœ… å¯é€‰å¯ç”¨ï¼Œæ”¯æŒæœåŠ¡æ‹“æ‰‘ã€ç°åº¦å‘å¸ƒã€æµé‡æ²»ç†ç­‰</td></tr><tr><td>ğŸ§° åº”ç”¨å•†åº—ï¼ˆHelm å¯è§†åŒ–éƒ¨ç½²ï¼‰</td><td>âŒ æ— </td><td>âœ… æ”¯æŒ Helm åº”ç”¨å¸‚åœºï¼Œç‚¹å‡»å³å¯å®‰è£…å¸¸è§ä¸­é—´ä»¶</td></tr><tr><td>ğŸ”Œ æ’ä»¶æ¶æ„</td><td>âŒ æ— </td><td>âœ… æ”¯æŒæ¨¡å—æŒ‰éœ€å¯ç”¨/å…³é—­</td></tr><tr><td>ğŸ§ª å®¹å™¨é•œåƒä»“åº“ï¼ˆHarborï¼‰</td><td>âŒ æ— </td><td>âœ… å¯é›†æˆæˆ–å†…å»º Harbor å®¹å™¨ä»“åº“</td></tr><tr><td>ğŸ“¦ å®‰è£…å¤æ‚åº¦</td><td>âœ… ç®€å•</td><td>âš ï¸ ç•¥å¤æ‚ï¼Œä½†å¯æŒ‰éœ€å¯ç”¨æ¨¡å—</td></tr></tbody></table><h2 id="éƒ¨ç½²-Kubesphere">éƒ¨ç½² Kubesphere</h2><ul class="lvl-0"><li class="lvl-2"><p>Kubesphere å¯¹ç³»ç»Ÿèµ„æºæœ‰æœ€ä½è¦æ±‚ï¼Œå…·ä½“å‚è€ƒ<a href="https://kubesphere.io/zh/docs/v4.1/03-installation-and-upgrade/01-preparations/01-supported-k8s/">å®˜ç½‘:ç¯å¢ƒè¦æ±‚</a></p></li><li class="lvl-2"><p>éƒ¨ç½²</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæ— æ³•è®¿é—® charts.kubesphere.io, å¯å°† charts.kubesphere.io æ›¿æ¢ä¸º charts.kubesphere.com.cn</span></span><br><span class="line">helm upgrade --install -n kubesphere-system --create-namespace ks-core https://charts.kubesphere.io/main/ks-core-1.1.4.tgz --debug --<span class="built_in">wait</span></span><br><span class="line"><span class="comment">## å®‰è£…æˆåŠŸåä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</span></span><br><span class="line">NOTES:</span><br><span class="line">Thank you <span class="keyword">for</span> choosing KubeSphere Helm Chart.</span><br><span class="line"></span><br><span class="line">Please be patient and <span class="built_in">wait</span> <span class="keyword">for</span> several seconds <span class="keyword">for</span> the KubeSphere deployment to complete.</span><br><span class="line"></span><br><span class="line">1. Wait <span class="keyword">for</span> Deployment Completion</span><br><span class="line"></span><br><span class="line">    Confirm that all KubeSphere components are running by executing the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    kubectl get pods -n kubesphere-system</span><br><span class="line">2. Access the KubeSphere Console</span><br><span class="line"></span><br><span class="line">    Once the deployment is complete, you can access the KubeSphere console using the following URL:</span><br><span class="line"></span><br><span class="line">    http://10.211.55.11:30880</span><br><span class="line"></span><br><span class="line">3. Login to KubeSphere Console</span><br><span class="line"></span><br><span class="line">    Use the following credentials to <span class="built_in">log</span> <span class="keyword">in</span>:</span><br><span class="line"></span><br><span class="line">    Account: admin</span><br><span class="line">    Password: P@88w0rd</span><br><span class="line"></span><br><span class="line">NOTE: It is highly recommended to change the default password immediately after the first login.</span><br><span class="line">For additional information and details, please visit https://kubesphere.io.</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶</span></span><br><span class="line">$ kubectl get pod,deploy,svc -n kubesphere-system</span><br><span class="line">NAME                                         READY   STATUS    RESTARTS       AGE</span><br><span class="line">pod/extensions-museum-ffd8bd9d8-fvcw4        1/1     Running   1 (28m ago)    5h5m</span><br><span class="line">pod/ks-apiserver-7b4479d5f5-2k4c9            1/1     Running   2 (27m ago)    5h5m</span><br><span class="line">pod/ks-console-6bd9b9f5d9-xqlzs              1/1     Running   0              26m</span><br><span class="line">pod/ks-controller-manager-547f9fc8c9-5b88z   1/1     Running   10 (27m ago)   5h5m</span><br><span class="line"></span><br><span class="line">NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/extensions-museum       1/1     1            1           5h14m</span><br><span class="line">deployment.apps/ks-apiserver            1/1     1            1           5h14m</span><br><span class="line">deployment.apps/ks-console              1/1     1            1           5h14m</span><br><span class="line">deployment.apps/ks-controller-manager   1/1     1            1           5h14m</span><br><span class="line"></span><br><span class="line">NAME                            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">service/extensions-museum       ClusterIP   10.96.95.71    &lt;none&gt;        443/TCP        5h14m</span><br><span class="line">service/ks-apiserver            ClusterIP   10.96.12.106   &lt;none&gt;        80/TCP         5h14m</span><br><span class="line">service/ks-console              NodePort    10.96.55.165   &lt;none&gt;        80:30880/TCP   5h14m</span><br><span class="line">service/ks-controller-manager   ClusterIP   10.96.13.243   &lt;none&gt;        443/TCP        5h14m</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµè§ˆå™¨è®¿é—®ï¼š<a href="http://10.211.55.11:30880">http://10.211.55.11:30880</a>ï¼Œè¾“å…¥è´¦å·å¯†ç ï¼šadmin/P@88w0rdï¼Œé¦–æ¬¡ç™»å½•éœ€è¦ä¿®æ”¹å¯†ç ã€‚</p></li></ul><h2 id="é…ç½®-ingress">é…ç½® ingress</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºè¯ä¹¦</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret tls nginx-tls \</span><br><span class="line">    --key=nginx_ssl/nginx.hanqunfeng.com.key \</span><br><span class="line">    --cert=nginx_ssl/nginx.hanqunfeng.com.pem \</span><br><span class="line">    -n kubesphere-system</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º ingress</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubesphere-ingress.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubesphere-nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubesphere-system</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kubesphere.hanqunfeng.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">nginx-tls</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">kubesphere.hanqunfeng.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">ks-console</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h2 id="å¸è½½-Kubesphere">å¸è½½ Kubesphere</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm uninstall ks-core -n kubesphere-system</span><br><span class="line">kubectl delete namespace kubesphere-system</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubesphere.io/zh/&quot;&gt;Kubesphere å®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
</feed>
