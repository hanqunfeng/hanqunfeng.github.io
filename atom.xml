<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£˜é€¸å³°çš„åšå®¢</title>
  
  <subtitle>Spring--Javaç¨‹åºå‘˜çš„æ˜¥å¤©</subtitle>
  <link href="https://blog.hanqunfeng.com/atom.xml" rel="self"/>
  
  <link href="https://blog.hanqunfeng.com/"/>
  <updated>2025-05-13T13:20:58.449Z</updated>
  <id>https://blog.hanqunfeng.com/</id>
  
  <author>
    <name>é£˜é€¸å³°</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>JVM ä¹‹ å‘½ä»¤è¡Œå·¥å…·</title>
    <link href="https://blog.hanqunfeng.com/2025/05/13/jvm-tools-01/"/>
    <id>https://blog.hanqunfeng.com/2025/05/13/jvm-tools-01/</id>
    <published>2025-05-13T13:30:05.000Z</published>
    <updated>2025-05-13T13:20:58.449Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»JVMçš„å‘½ä»¤è¡Œå·¥å…·</p></li><li class="lvl-2"><p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/index.html">The JavaÂ® Virtual Machine Specification</a> ç‰ˆæœ¬jdk1.8</p></li></ul><span id="more"></span><h2 id="jps-æŸ¥çœ‹å½“å‰jvmä¸­çš„è¿›ç¨‹">jps: æŸ¥çœ‹å½“å‰jvmä¸­çš„è¿›ç¨‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹javaè¿›ç¨‹ID</span></span><br><span class="line">jps</span><br><span class="line"><span class="comment"># æŸ¥çœ‹javaè¿›ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬IDå’Œå¯åŠ¨ç±»æˆ–jarçš„åç§°</span></span><br><span class="line">jps -l</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯åŠ¨javaè¿›ç¨‹æ—¶ä¼ é€’ç»™jvmçš„å‚æ•°è®¾ç½®</span></span><br><span class="line">jps -v</span><br><span class="line"><span class="comment"># æŸ¥çœ‹javaè¿›ç¨‹ä¿¡æ¯ï¼ŒåŒæ—¶æ˜¾ç¤ºå¯åŠ¨javaè¿›ç¨‹æ—¶ä¼ é€’ç»™jvmçš„å‚æ•°è®¾ç½®</span></span><br><span class="line">jps -lv</span><br></pre></td></tr></table></figure><h2 id="jinfo-æŸ¥çœ‹JVMå‚æ•°">jinfo: æŸ¥çœ‹JVMå‚æ•°</h2><ul class="lvl-0"><li class="lvl-2"><p>jinfo æ˜¯ JDK è‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·ä¹‹ä¸€ï¼Œç”¨äº æŸ¥çœ‹å’Œä¿®æ”¹æ­£åœ¨è¿è¡Œä¸­çš„ Java è¿›ç¨‹çš„é…ç½®ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬ JVM å‚æ•°ã€ç³»ç»Ÿå±æ€§ç­‰ä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>åœ¨ Java 9+ ä¹‹åè¢«æ ‡è®°ä¸º deprecatedï¼Œå»ºè®®æ”¹ç”¨ jcmd æ›¿ä»£</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ JVM å‚æ•°</span></span><br><span class="line">jinfo &lt;PID&gt;</span><br><span class="line"><span class="comment"># jcmd å‘½ä»¤ï¼Œåˆ†æˆä¸‰ä¸ª</span></span><br><span class="line">jcmd &lt;pid&gt; VM.flags <span class="comment"># VM Flags</span></span><br><span class="line">jcmd &lt;pid&gt; VM.system_properties <span class="comment"># System Properties</span></span><br><span class="line">jcmd &lt;pid&gt; VM.command_line <span class="comment"># Command Line</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„ç³»ç»Ÿå±æ€§ï¼ˆ-syspropsï¼‰</span></span><br><span class="line">jinfo -sysprops &lt;PID&gt;</span><br><span class="line"><span class="comment"># jcmd å‘½ä»¤</span></span><br><span class="line">jcmd &lt;pid&gt; VM.system_properties</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ¨æ€ä¿®æ”¹ JVM å‚æ•°ï¼ˆä»…æ”¯æŒéƒ¨åˆ†å‚æ•°ï¼‰</span></span><br><span class="line">jinfo -flag [+|-]&lt;flagname&gt; &lt;pid&gt;</span><br><span class="line"><span class="comment">## ä¾‹ï¼šæ‰“å¼€ GC æ—¥å¿—</span></span><br><span class="line">jinfo -flag +PrintGC &lt;pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦å¼€å¯äº†æŸä¸ª JVM ç‰¹æ€§ï¼ˆå¦‚ UseG1GCï¼‰</span></span><br><span class="line">jinfo -flag UseG1GC &lt;pid&gt;</span><br></pre></td></tr></table></figure><h2 id="jstat-æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€">jstat: æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</span></span><br><span class="line">jstat -gc &lt;PID&gt;</span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼Œæ¯éš”5000æ¯«ç§’è¾“å‡ºä¸€æ¬¡ï¼Œå…±è¾“å‡º20æ¬¡</span></span><br><span class="line">jstat -gc &lt;PID&gt; 5000 20</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">512.0  512.0   0.0   224.0  29696.0  27138.2   105984.0   96531.8   122368.0 114450.4 15360.0 14018.9    733    5.099   4      0.833    5.931</span><br><span class="line">512.0  512.0   0.0   224.0  29696.0  27203.9   105984.0   96531.8   122368.0 114450.4 15360.0 14018.9    733    5.099   4      0.833    5.931</span><br><span class="line">512.0  512.0   0.0   224.0  29696.0  27220.4   105984.0   96531.8   122368.0 114450.4 15360.0 14018.9    733    5.099   4      0.833    5.931</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å†…å­˜åŒºç»Ÿè®¡ï¼ˆå•ä½ï¼šKBï¼‰</p></li></ul><table><thead><tr><th>åˆ—å</th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td><strong>S0C</strong></td><td>Survivor 0 åŒºçš„å®¹é‡ï¼ˆKBï¼‰</td></tr><tr><td><strong>S1C</strong></td><td>Survivor 1 åŒºçš„å®¹é‡ï¼ˆKBï¼‰</td></tr><tr><td><strong>S0U</strong></td><td>Survivor 0 åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td></tr><tr><td><strong>S1U</strong></td><td>Survivor 1 åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td></tr><tr><td><strong>EC</strong></td><td>Eden åŒºçš„å®¹é‡ï¼ˆKBï¼‰</td></tr><tr><td><strong>EU</strong></td><td>Eden åŒºå·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td></tr><tr><td><strong>OC</strong></td><td>Old Generationï¼ˆè€å¹´ä»£ï¼‰çš„å®¹é‡ï¼ˆKBï¼‰</td></tr><tr><td><strong>OU</strong></td><td>Old Generation å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td></tr><tr><td><strong>MC</strong></td><td>Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰çš„å®¹é‡ï¼ˆKBï¼‰</td></tr><tr><td><strong>MU</strong></td><td>Metaspace å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td></tr><tr><td><strong>CCSC</strong></td><td>Compressed Class Space çš„å®¹é‡ï¼ˆKBï¼‰</td></tr><tr><td><strong>CCSU</strong></td><td>Compressed Class Space å·²ä½¿ç”¨å†…å­˜ï¼ˆKBï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>GC æ¬¡æ•°ä¸è€—æ—¶(ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶)</p></li></ul><table><thead><tr><th>åˆ—å</th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td><strong>YGC</strong></td><td>Young GCï¼ˆMinor GCï¼‰ çš„ç´¯è®¡æ¬¡æ•°</td></tr><tr><td><strong>YGCT</strong></td><td>Young GC ç´¯è®¡è€—æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰</td></tr><tr><td><strong>FGC</strong></td><td>Full GC çš„ç´¯è®¡æ¬¡æ•°</td></tr><tr><td><strong>FGCT</strong></td><td>Full GC ç´¯è®¡è€—æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰</td></tr><tr><td><strong>GCT</strong></td><td>GC æ€»è€—æ—¶ï¼ˆYGCT + FGCTï¼Œæ€»å’Œï¼‰</td></tr></tbody></table><h2 id="jstack-æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹ä¸­å„çº¿ç¨‹çš„è°ƒç”¨å †æ ˆ">jstack: æŸ¥çœ‹æŒ‡å®šJAVAè¿›ç¨‹ä¸­å„çº¿ç¨‹çš„è°ƒç”¨å †æ ˆ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰“å°çº¿ç¨‹çš„æ ‡å‡†æ ˆä¿¡æ¯ï¼ˆæ ˆå¸§ + çº¿ç¨‹çŠ¶æ€ï¼‰</span></span><br><span class="line">jstack &lt;PID&gt;</span><br><span class="line"><span class="comment"># åœ¨æ ‡å‡†è¾“å‡ºåŸºç¡€ä¸Šï¼Œé¢å¤–æ‰“å°çº¿ç¨‹æ‹¥æœ‰çš„é”ï¼ˆmonitorï¼‰å’Œ waited on é”å¯¹è±¡ä¿¡æ¯</span></span><br><span class="line">jstack -l &lt;PID&gt;</span><br><span class="line"><span class="comment"># è¾“å‡ºåˆ°æ–‡ä»¶</span></span><br><span class="line">jstack -l &lt;PID&gt; &gt; jstack.tdump <span class="comment"># è¿™ä¸ªæ–‡ä»¶ååç¼€åªæ˜¯ä¸ºäº†æ–¹ä¾¿ jvisualvm æŸ¥çœ‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line"><span class="string">&quot;idle-connection-reaper&quot;</span> <span class="comment">#68 daemon prio=5 os_prio=0 tid=0x00007f38b6ae2800 nid=0x62e9 waiting on condition [0x00007f385b0f5000]</span></span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br><span class="line">at java.lang.Thread.<span class="built_in">sleep</span>(Native Method)</span><br><span class="line">at software.amazon.awssdk.http.apache.internal.conn.IdleConnectionReaper<span class="variable">$ReaperTask</span>.run(IdleConnectionReaper.java:151)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:624)</span><br><span class="line">at java.lang.Thread.run(Thread.java:750)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">- &lt;0x00000000c561cfd8&gt; (a java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>jstackè¾“å‡ºå†…å®¹å«ä¹‰</p></li></ul><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>&quot;idle-connection-reaper&quot;</code></td><td>çº¿ç¨‹åç§°ã€‚è¿™ä¸ªçº¿ç¨‹æ˜¯ AWS SDK ä¸­ç”¨äºæ¸…ç†ç©ºé—²è¿æ¥çš„åå°çº¿ç¨‹ã€‚</td></tr><tr><td><code>#68</code></td><td>çº¿ç¨‹ IDï¼ˆJava å±‚åˆ†é…çš„ç¼–å·ï¼‰ã€‚</td></tr><tr><td><code>daemon</code></td><td>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª <strong>å®ˆæŠ¤çº¿ç¨‹</strong>ã€‚JVM é€€å‡ºæ—¶ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹è¿è¡Œç»“æŸã€‚</td></tr><tr><td><code>prio=5</code></td><td>Java å±‚çš„çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆé»˜è®¤ 1â€“10ï¼Œ5 æ˜¯é»˜è®¤ï¼‰ã€‚</td></tr><tr><td><code>os_prio=0</code></td><td>æ“ä½œç³»ç»Ÿå±‚çº¿ç¨‹ä¼˜å…ˆçº§ï¼ˆå–å†³äºæ“ä½œç³»ç»Ÿå’Œ JVM çš„å®ç°ï¼‰ã€‚</td></tr><tr><td><code>tid=0x00007f38b6ae2800</code></td><td>çº¿ç¨‹ IDï¼ˆJava å±‚ä½¿ç”¨çš„åœ°å€æ ‡è¯†ï¼‰ã€‚</td></tr><tr><td><code>nid=0x62e9</code></td><td>Native IDï¼Œæ“ä½œç³»ç»Ÿåˆ†é…çš„çº¿ç¨‹ IDï¼ˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼‰ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤<code>printf &quot;%d\n&quot; 0x62e9</code>è½¬æ¢ä¸º10è¿›åˆ¶ã€‚<br>  <code>ps -Lp &lt;PID&gt;</code> å’Œ <code>top -Hp &lt;PID&gt;</code> å±•ç¤ºçš„çº¿ç¨‹idæ˜¯10è¿›åˆ¶</td></tr><tr><td><code>waiting on condition</code></td><td>çº¿ç¨‹çŠ¶æ€è¯´æ˜ï¼šæ­£åœ¨ç­‰å¾…æŸç§æ¡ä»¶ï¼Œä¸€èˆ¬æŒ‡ <code>sleep()</code> æˆ– <code>wait()</code> ç­‰ã€‚</td></tr><tr><td><code>[0x00007f385b0f5000]</code></td><td>æ ˆå¸§çš„å†…å­˜åœ°å€ã€‚</td></tr><tr><td><code>java.lang.Thread.State: TIMED_WAITING (sleeping)</code></td><td>çº¿ç¨‹çŠ¶æ€ã€‚</td></tr><tr><td><code>at java.lang.Thread.sleep(Native Method)</code> <br> â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</td><td>çº¿ç¨‹è°ƒç”¨æ ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬è°ƒç”¨æ–¹æ³•ã€è°ƒç”¨å‚æ•°ã€è°ƒç”¨æ ˆå¸§ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¦å¤–è¿˜æœ‰å¦‚ä¸‹ä¿¡æ¯ï¼Œè¡¨ç¤ºæ­¤çº¿ç¨‹æŒæœ‰çš„å¯æ‹¥æœ‰åŒæ­¥å™¨ï¼ˆä¾‹å¦‚ ReentrantLockï¼‰ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Locked ownable synchronizers:</span><br><span class="line">- &lt;0x00000000c561cfd8&gt; (a java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>)</span><br></pre></td></tr></table></figure><table><thead><tr><th>å†…å®¹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>&lt;0x00000000c561cfd8&gt;</code></td><td>æŒæœ‰é”çš„å¯¹è±¡åœ°å€ã€‚å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­æŸ¥æ‰¾è¿™ä¸ªåœ°å€ï¼Œä»¥åˆ¤æ–­æ­»é”ç­‰é—®é¢˜ã€‚</td></tr><tr><td><code>(a ThreadPoolExecutor$Worker)</code></td><td>è¡¨ç¤ºè¯¥é”å±äº <code>ThreadPoolExecutor</code> çš„æŸä¸ª <code>Worker</code> çº¿ç¨‹ï¼ˆè¿™æ˜¯çº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹ï¼‰ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>çº¿ç¨‹çŠ¶æ€</p></li></ul><table><thead><tr><th>çŠ¶æ€</th><th>å«ä¹‰</th><th>å¸¸è§åŸå›  / ç¤ºä¾‹æ–¹æ³•</th><th>ç¤ºä¾‹ jstack è¾“å‡º</th></tr></thead><tbody><tr><td><code>RUNNABLE</code></td><td>çº¿ç¨‹æ­£åœ¨è¿è¡Œæˆ–å‡†å¤‡è¿è¡Œï¼Œç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚</td><td>çº¿ç¨‹æ´»è·ƒè¿è¡Œä¸­</td><td><code>&quot;Thread-0&quot; #1 prio=5 os_prio=0 tid=0x00007f8d9c001000 nid=0x1a runnable [0x00007f8dbf7fe000]</code></td></tr><tr><td><code>BLOCKED (on object monitor)</code></td><td>ç­‰å¾…è·å–å¯¹è±¡çš„ç›‘è§†å™¨é”ï¼ˆåŒæ­¥é”ï¼‰ï¼Œå³ç­‰å¾…è¿›å…¥åŒæ­¥å—æˆ–æ–¹æ³•ã€‚</td><td><code>synchronized</code> åŒæ­¥å—æˆ–æ–¹æ³•</td><td><code>&quot;Thread-1&quot; #2 prio=5 os_prio=0 tid=0x00007f8d9c002000 nid=0x1b waiting for monitor entry [0x00007f8dbeaff000]</code></td></tr><tr><td><code>WAITING (on object monitor)</code></td><td>æ— é™æœŸç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡ŒæŸæ“ä½œã€‚</td><td><code>Object.wait()</code><br><code>Thread.join()</code><br><code>LockSupport.park()</code><br><code>Condition.await()</code></td><td><code>&quot;Thread-2&quot; #3 prio=5 os_prio=0 tid=0x00007f8d9c003000 nid=0x1c waiting on condition [0x00007f8dbebff000]</code></td></tr><tr><td><code>TIMED_WAITING (on object monitor)</code></td><td>ç­‰å¾…å›ºå®šæ—¶é—´ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³æˆ–è¶…æ—¶ã€‚</td><td><code>Object.wait(long)</code><br><code>Thread.sleep(long)</code><br><code>Condition.awaitNanos(long)</code><br><code>DelayQueue.take()</code></td><td><code>&quot;Thread-3&quot; #4 prio=5 os_prio=0 tid=0x00007f8d9c004000 nid=0x1d timed_waiting [0x00007f8dbebff000]</code></td></tr><tr><td><code>TERMINATED</code></td><td>çº¿ç¨‹å·²è¿è¡Œå®Œæ¯•å¹¶é€€å‡ºï¼ˆé€šå¸¸ä¸åœ¨ jstack ä¸­æ˜¾ç¤ºï¼‰ã€‚</td><td>-</td><td>-</td></tr></tbody></table><h3 id="ä½¿ç”¨jstackæ£€æŸ¥æ­»é”">ä½¿ç”¨jstackæ£€æŸ¥æ­»é”</h3><ul class="lvl-0"><li class="lvl-2"><p>æ­»é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œå¯¼è‡´æ— æ³•ç»§ç»­è¿è¡Œçš„æƒ…å†µã€‚</p></li></ul><h4 id="ç›´æ¥æŸ¥æ‰¾-Found-one-Java-level-deadlock-æç¤º">ç›´æ¥æŸ¥æ‰¾ <code>Found one Java-level deadlock</code> æç¤º</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Found one Java-level deadlock:</span><br><span class="line">=============================</span><br><span class="line"><span class="string">&quot;Thread-1&quot;</span>:</span><br><span class="line">  waiting to lock monitor 0x0000000005c0a098 (object 0x00000000d5c10a70, a java.lang.Object),</span><br><span class="line">  <span class="built_in">which</span> is held by <span class="string">&quot;Thread-2&quot;</span></span><br><span class="line"><span class="string">&quot;Thread-2&quot;</span>:</span><br><span class="line">  waiting to lock monitor 0x0000000005c0a128 (object 0x00000000d5c10aa0, a java.lang.Object),</span><br><span class="line">  <span class="built_in">which</span> is held by <span class="string">&quot;Thread-1&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¡¨ç¤ºä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œé€ æˆæ­»é”ã€‚</p></li><li class="lvl-2"><p>ç›®å‰åªæ”¯æŒæ‰¾å‡º <code>synchronized</code> å…³é”®å­—é˜»å¡ä½çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ <code>java.util.concurrent.Lock</code> ç›®å‰è¿˜ä¸æ”¯æŒã€‚</p></li></ul><h4 id="æ‰‹åŠ¨åˆ¤æ–­æ­»é”çš„ç‰¹å¾ï¼ˆå¦‚æœæ²¡æœ‰ä¸Šé¢çš„æç¤ºï¼‰">æ‰‹åŠ¨åˆ¤æ–­æ­»é”çš„ç‰¹å¾ï¼ˆå¦‚æœæ²¡æœ‰ä¸Šé¢çš„æç¤ºï¼‰</h4><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœ JVM æ²¡æœ‰æ˜¾å¼æç¤ºï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­»é”ç‰¹å¾è¿›è¡Œæ‰‹åŠ¨è¯†åˆ«ï¼š</p></li></ul><table><thead><tr><th>ç‰¹å¾</th><th>æè¿°</th></tr></thead><tbody><tr><td>çº¿ç¨‹å¤„äº <code>BLOCKED</code> çŠ¶æ€</td><td>çº¿ç¨‹è¢«é”é˜»å¡åœ¨ <code>monitor</code> ä¸Šã€‚</td></tr><tr><td><code>waiting to lock</code> å’Œ <code>locked</code> å‡ºç°äº¤å‰</td><td>ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„é”ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿåœ¨ç­‰å¾…å½“å‰çº¿ç¨‹çš„é”ã€‚</td></tr><tr><td>æ²¡æœ‰èƒ½ç»§ç»­æ‰§è¡Œçš„çº¿ç¨‹</td><td>å¤šä¸ªçº¿ç¨‹éƒ½å¤„äº <code>BLOCKED</code> çŠ¶æ€ï¼Œä¸”ç›¸äº’ä¾èµ–ã€‚</td></tr></tbody></table><h2 id="jmap-åˆ†æè¿è¡Œä¸­-Java-è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ">jmap: åˆ†æè¿è¡Œä¸­ Java è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</h2><ul class="lvl-0"><li class="lvl-2"><p>jmap æ¯”è¾ƒæ¶ˆè€—å†…å­˜ï¼Œæ‰€ä»¥ä¸æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚</p></li></ul><h3 id="jmap-histo-pid-æŸ¥çœ‹ç±»å®ä¾‹æ•°é‡åŠå ç”¨å†…å­˜"><code>jmap -histo &lt;pid&gt;</code>: æŸ¥çœ‹ç±»å®ä¾‹æ•°é‡åŠå ç”¨å†…å­˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -histo 25238</span><br><span class="line">25238:</span><br><span class="line"></span><br><span class="line"> num     <span class="comment">#instances         #bytes  class name</span></span><br><span class="line">----------------------------------------------</span><br><span class="line">   1:        106175       10838440  [C</span><br><span class="line">   2:         94344        3019008  java.util.concurrent.ConcurrentHashMap<span class="variable">$Node</span></span><br><span class="line">   3:        105529        2532696  java.lang.String</span><br><span class="line">   4:         11203        2496608  [B</span><br><span class="line">   5:         20178        2430136  [Ljava.lang.Object;</span><br><span class="line">   6:         21642        2399904  java.lang.Class</span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">Total        857252       51328200</span><br><span class="line"></span><br><span class="line"><span class="comment"># num: åºå·</span></span><br><span class="line"><span class="comment"># instances: å®ä¾‹æ•°é‡</span></span><br><span class="line"><span class="comment"># bytes: å®ä¾‹å­—èŠ‚æ•°</span></span><br><span class="line"><span class="comment"># class name: ç±»å, [C is a char[]ï¼Œ[S is a short[]ï¼Œ[I is a int[]ï¼Œ[B is a byte[]ï¼Œ[L is a List</span></span><br><span class="line"><span class="comment"># Total: æ€»æ•°</span></span><br></pre></td></tr></table></figure><h3 id="jmap-heap-pid-æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ"><code>jmap -heap &lt;pid&gt;</code>: æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -heap 25238</span><br><span class="line">Attaching to process ID 25238, please <span class="built_in">wait</span>...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.371-b11</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Parallel GC with 2 thread(s)</span><br><span class="line"></span><br><span class="line">Heap Configuration:    <span class="comment"># å †é…ç½®</span></span><br><span class="line">   MinHeapFreeRatio         = 0                     <span class="comment"># æœ€å°ç©ºé—²ç™¾åˆ†æ¯”</span></span><br><span class="line">   MaxHeapFreeRatio         = 100                     <span class="comment"># æœ€å¤§ç©ºé—²ç™¾åˆ†æ¯”</span></span><br><span class="line">   MaxHeapSize              = 1010827264 (964.0MB)    <span class="comment"># æœ€å¤§å †å¤§å°</span></span><br><span class="line">   NewSize                  = 21495808 (20.5MB)       <span class="comment"># æ–°ç”Ÿä»£å¤§å°</span></span><br><span class="line">   MaxNewSize               = 336592896 (321.0MB)     <span class="comment"># æ–°ç”Ÿä»£æœ€å¤§å¤§å°</span></span><br><span class="line">   OldSize                  = 43515904 (41.5MB)       <span class="comment"># è€å¹´ä»£å¤§å°</span></span><br><span class="line">   NewRatio                 = 2                       <span class="comment"># æ–°ç”Ÿä»£ä¸è€å¹´ä»£æ¯”ä¾‹</span></span><br><span class="line">   SurvivorRatio            = 8                       <span class="comment"># å¹¸å­˜è€…æ¯”ä¾‹</span></span><br><span class="line">   MetaspaceSize            = 21807104 (20.796875MB)   <span class="comment"># å…ƒç©ºé—´å¤§å°</span></span><br><span class="line">   CompressedClassSpaceSize = 1073741824 (1024.0MB)   <span class="comment"># å‹ç¼©ç±»ç©ºé—´å¤§å°ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰ ç±»æŒ‡é’ˆï¼ˆKlass pointerï¼‰</span></span><br><span class="line">   MaxMetaspaceSize         = 17592186044415 MB       <span class="comment"># å…ƒç©ºé—´æœ€å¤§å¤§å°</span></span><br><span class="line">   G1HeapRegionSize         = 0 (0.0MB)               <span class="comment"># G1å †å¤§å°</span></span><br><span class="line"></span><br><span class="line">Heap Usage:       <span class="comment"># å †ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">PS Young Generation <span class="comment"># å¹´è½»ç”Ÿä»£</span></span><br><span class="line">Eden Space:         <span class="comment"># Eden åŒº</span></span><br><span class="line">   capacity = 30932992 (29.5MB)    <span class="comment">#  Eden åŒºå¤§å°</span></span><br><span class="line">   used     = 16705104 (15.931228637695312MB) <span class="comment">#  Eden åŒºä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">   free     = 14227888 (13.568771362304688MB) <span class="comment">#  Eden åŒºå‰©ä½™æƒ…å†µ</span></span><br><span class="line">   54.00416487354343% used                    <span class="comment">#  Eden åŒºä½¿ç”¨ç™¾åˆ†æ¯”</span></span><br><span class="line">From Space:                      <span class="comment"># å¹¸å­˜è€…åŒº survivor0</span></span><br><span class="line">   capacity = 524288 (0.5MB)</span><br><span class="line">   used     = 0 (0.0MB)</span><br><span class="line">   free     = 524288 (0.5MB)</span><br><span class="line">   0.0% used</span><br><span class="line">To Space:                       <span class="comment"># å¹¸å­˜è€…åŒº survivor1</span></span><br><span class="line">   capacity = 524288 (0.5MB)</span><br><span class="line">   used     = 0 (0.0MB)</span><br><span class="line">   free     = 524288 (0.5MB)</span><br><span class="line">   0.0% used</span><br><span class="line">PS Old Generation                <span class="comment"># è€å¹´ä»£</span></span><br><span class="line">   capacity = 193462272 (184.5MB)</span><br><span class="line">   used     = 43292112 (41.28657531738281MB)</span><br><span class="line">   free     = 150170160 (143.2134246826172MB)</span><br><span class="line">   22.377547597497458% used</span><br><span class="line"></span><br><span class="line">38722 interned Strings occupying 4184168 bytes. <span class="comment"># å †ä¸­å­—ç¬¦ä¸²æ•°é‡åŠå ç”¨å†…å­˜</span></span><br></pre></td></tr></table></figure><h3 id="jmap-dump-live-format-b-file-file-pid-åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­"><code>jmap -dump:live,format=b,file=&lt;file&gt; &lt;pid&gt;</code>: åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°å½“å‰ç›®å½•ä¸‹</span></span><br><span class="line">$ jmap -dump:live,format=b,file=test.hprof 25238</span><br><span class="line">Dumping heap to /tmp/test.hprof ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure><h2 id="jcmd-å¯ä»¥æ›¿ä»£jmapå‘½ä»¤ï¼Œjdk1-8-æ¨èä½¿ç”¨">jcmd: å¯ä»¥æ›¿ä»£<code>jmap</code>å‘½ä»¤ï¼Œ<code>jdk1.8+</code>æ¨èä½¿ç”¨</h2><ul class="lvl-0"><li class="lvl-2"><p><code>jcmd</code> æ˜¯ <code>JDK</code> çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† <code>JVM</code>ï¼Œ<code>jcmd</code> å¯ä»¥æŸ¥çœ‹ <code>JVM</code> çš„è¿è¡ŒçŠ¶æ€ã€æŸ¥çœ‹å †å†…å­˜ä¿¡æ¯ã€è§¦å‘ GCã€æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ã€æŸ¥çœ‹ç±»ä¿¡æ¯ç­‰ç­‰ã€‚</p></li><li class="lvl-2"><p>ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨<code>jmap</code>ï¼Œå› å…¶ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œæ¨èä½¿ç”¨ <code>jcmd</code>ã€‚</p></li></ul><h3 id="jcmd-pid-GC-heap-info-æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ"><code>jcmd &lt;pid&gt; GC.heap_info</code>: æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ</h3><ul class="lvl-0"><li class="lvl-2"><p>ç±»ä¼¼ <code>jmap -heap &lt;pid&gt;</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ jcmd 25238 GC.heap_info</span><br><span class="line">25238:</span><br><span class="line"> PSYoungGen      total 30208K, used 23593K [0x00000000ebf00000, 0x00000000edd80000, 0x0000000100000000)</span><br><span class="line">  eden space 29696K, 78% used [0x00000000ebf00000,0x00000000ed5d2560,0x00000000edc00000)</span><br><span class="line">  from space 512K, 43% used [0x00000000edd00000,0x00000000edd38000,0x00000000edd80000)</span><br><span class="line">  to   space 512K, 0% used [0x00000000edc80000,0x00000000edc80000,0x00000000edd00000)</span><br><span class="line"> ParOldGen       total 105984K, used 96547K [0x00000000c3c00000, 0x00000000ca380000, 0x00000000ebf00000)</span><br><span class="line">  object space 105984K, 91% used [0x00000000c3c00000,0x00000000c9a48f10,0x00000000ca380000)</span><br><span class="line"> Metaspace       used 114450K, capacity 122262K, committed 122368K, reserved 1157120K</span><br><span class="line">  class space    used 14018K, capacity 15294K, committed 15360K, reserved 1048576K</span><br></pre></td></tr></table></figure><h3 id="jcmd-pid-GC-class-histogram-æŸ¥çœ‹ç±»åŠ è½½æƒ…å†µ"><code>jcmd &lt;pid&gt; GC.class_histogram</code>: æŸ¥çœ‹ç±»åŠ è½½æƒ…å†µ</h3><ul class="lvl-0"><li class="lvl-2"><p>ç±»ä¼¼ <code>jmap -histo &lt;pid&gt;</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ jcmd 25238 GC.class_histogram</span><br><span class="line">25238:</span><br><span class="line"></span><br><span class="line"> num     <span class="comment">#instances         #bytes  class name</span></span><br><span class="line">----------------------------------------------</span><br><span class="line">   1:        106175       10838440  [C</span><br><span class="line">   2:         94344        3019008  java.util.concurrent.ConcurrentHashMap<span class="variable">$Node</span></span><br><span class="line">   3:        105529        2532696  java.lang.String</span><br><span class="line">   4:         11203        2496608  [B</span><br><span class="line">   5:         20178        2430136  [Ljava.lang.Object;</span><br><span class="line">   6:         21642        2399904  java.lang.Class</span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">Total        857252       51328200</span><br><span class="line"></span><br><span class="line"><span class="comment"># num: åºå·</span></span><br><span class="line"><span class="comment"># instances: å®ä¾‹æ•°é‡</span></span><br><span class="line"><span class="comment"># bytes: å®ä¾‹å­—èŠ‚æ•°</span></span><br><span class="line"><span class="comment"># class name: ç±»å, [C is a char[]ï¼Œ[S is a short[]ï¼Œ[I is a int[]ï¼Œ[B is a byte[]ï¼Œ[L is a List</span></span><br><span class="line"><span class="comment"># Total: æ€»æ•°</span></span><br></pre></td></tr></table></figure><h3 id="jcmd-pid-GC-heap-dump-path-to-heap-hprof-å¯¼å‡º-heap-dump"><code>jcmd &lt;pid&gt; GC.heap_dump /path/to/heap.hprof</code>: å¯¼å‡º heap dump</h3><ul class="lvl-0"><li class="lvl-2"><p>æ›¿ä»£ <code>jmap -dump:format=b,file=heap.hprof &lt;pid&gt;</code>ï¼Œä½†ä»ä¼šæœ‰åœé¡¿ï¼ˆè§¦å‘FullGCï¼‰ï¼Œdump è¿‡ç¨‹æ…¢ï¼Œç”Ÿäº§ç¯å¢ƒæ…é‡ä½¿ç”¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ jcmd 25238 GC.heap_dump ./heap.hprof</span><br><span class="line">25238:</span><br><span class="line">Heap dump file created</span><br><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯ç›¸å¯¹ç›®å½•ï¼Œ./heap.hprofï¼Œä½†æ­¤æ—¶ &quot;./&quot; å¹¶ä¸æ˜¯è¿è¡Œå‘½ä»¤æ—¶æ‰€åœ¨çš„ç›®å½•ï¼Œè€Œæ˜¯æŒ‡ Java è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œå¦‚æœä½ ä¸çŸ¥é“å·¥ä½œç›®å½•ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</span></span><br><span class="line">jcmd &lt;pid&gt; VM.system_properties | grep <span class="string">&quot;user.dir&quot;</span></span><br><span class="line"><span class="comment"># linuxä¸‹ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</span></span><br><span class="line"><span class="built_in">ls</span> -l /proc/&lt;pid&gt;/cwd</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å› ä¸ºç”Ÿäº§ç¯å¢ƒä¸æ¨èä½¿ç”¨ <code>jmap</code> æˆ– <code>jcmd</code> å¯¼å‡º heap dumpï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®å¦‚ä¸‹jvmå‚æ•°</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:+HeadDumpOnOutOfMemoryError <span class="comment"># å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰æ—¶ä¼šè‡ªåŠ¨ä¿å­˜å †å†…å­˜å¿«ç…§æ–‡ä»¶</span></span><br><span class="line">-XX:HeapDumpPath=/path/to/dump.hprof <span class="comment"># æŒ‡å®šå †å†…å­˜å¿«ç…§æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œå¦‚æœä¸é…ç½®ï¼Œåˆ™é»˜è®¤ä¿å­˜åœ¨ Java è¿›ç¨‹çš„å·¥ä½œç›®å½•ä¸‹ï¼Œæ–‡ä»¶åç§°é»˜è®¤ä¸º java_&lt;pid&gt;.hprof</span></span><br></pre></td></tr></table></figure><h2 id="jhat-åˆ†æ-Java-Heap-Dump-æ–‡ä»¶ï¼ˆ-hprofï¼‰çš„å·¥å…·">jhat: åˆ†æ Java Heap Dump æ–‡ä»¶ï¼ˆ.hprofï¼‰çš„å·¥å…·</h2><ul class="lvl-0"><li class="lvl-2"><p>jhatï¼ˆJava Heap Analysis Toolï¼‰æ˜¯ JDK é™„å¸¦çš„ä¸€ä¸ªç”¨äº**åˆ†æ Java Heap Dump æ–‡ä»¶ï¼ˆ.hprofï¼‰**çš„å·¥å…·ã€‚å®ƒå¯ä»¥å°†å †å¿«ç…§ä½œä¸º HTTP æœåŠ¡åŠ è½½ï¼Œå¹¶å…è®¸ä½ é€šè¿‡æµè§ˆå™¨äº¤äº’å¼åœ°æŸ¥çœ‹å’ŒæŸ¥è¯¢å¯¹è±¡ä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br>ğŸ”º ä» JDK 9 èµ·ï¼Œjhat å·²è¢«å®˜æ–¹åºŸå¼ƒï¼Œæ¨èä½¿ç”¨æ›´å¼ºå¤§çš„å·¥å…·å¦‚ <code>VisualVM</code>ã€<code>Eclipse MAT</code> æˆ– <code>jcmd + å¤–éƒ¨å·¥å…·</code>ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£7000</span></span><br><span class="line">jhat &lt;heap dump file&gt;</span><br><span class="line"><span class="comment"># æŒ‡å®šç«¯å£</span></span><br><span class="line">jhat -port 8000 &lt;heap dump file&gt;</span><br></pre></td></tr></table></figure><h2 id="jvisualvm-å›¾å½¢åŒ–çš„-JVM-ç›‘æ§ä¸åˆ†æå·¥å…·">jvisualvm: å›¾å½¢åŒ–çš„ JVM ç›‘æ§ä¸åˆ†æå·¥å…·</h2><ul class="lvl-0"><li class="lvl-2"><p>jvisualvmï¼ˆå…¨ç§°ï¼šJava VisualVMï¼‰æ˜¯ Java å®˜æ–¹æä¾›çš„ä¸€æ¬¾ å›¾å½¢åŒ–çš„ JVM ç›‘æ§ä¸åˆ†æå·¥å…·ï¼Œç”¨äºè§‚å¯Ÿã€åˆ†æå’Œè°ƒè¯•æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºã€‚å®ƒéå¸¸é€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œå†…å­˜åˆ†æã€çº¿ç¨‹åˆ†æã€GC è¡Œä¸ºè§‚å¯Ÿç­‰ä»»åŠ¡ã€‚</p></li><li class="lvl-2"><p>åŠŸèƒ½æ¦‚è§ˆ</p></li></ul><table><thead><tr><th>åŠŸèƒ½</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>è¿›ç¨‹ç›‘æ§</strong></td><td>æŸ¥çœ‹æœ¬åœ°æˆ–è¿œç¨‹ JVM è¿›ç¨‹çš„å†…å­˜ã€CPUã€çº¿ç¨‹ç­‰è¿è¡ŒçŠ¶æ€</td></tr><tr><td><strong>å†…å­˜ä½¿ç”¨åˆ†æ</strong></td><td>æŸ¥çœ‹å †å†…å­˜ä½¿ç”¨æƒ…å†µã€GC æ¬¡æ•°å’Œæ—¶é—´ã€ç±»å®ä¾‹åˆ†å¸ƒç­‰</td></tr><tr><td><strong>çº¿ç¨‹åˆ†æ</strong></td><td>æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ã€çº¿ç¨‹æ ˆã€æ˜¯å¦å­˜åœ¨æ­»é”</td></tr><tr><td><strong>GC åˆ†æ</strong></td><td>å›¾å½¢åŒ–å±•ç¤º GC æ´»åŠ¨ã€é¢‘ç‡ä¸è€—æ—¶</td></tr><tr><td><strong>å †è½¬å‚¨åˆ†æ</strong></td><td>å¯¼å…¥ <code>.hprof</code> æ–‡ä»¶è¿›è¡Œå¯¹è±¡å®ä¾‹ã€ç±»ã€å¼•ç”¨å…³ç³»åˆ†æ</td></tr><tr><td><strong>CPU åˆ†æ</strong></td><td>åˆ†ææ–¹æ³•è°ƒç”¨è·¯å¾„ã€è€—æ—¶ã€çƒ­ç‚¹ä»£ç ï¼ˆéœ€æ‰‹åŠ¨å¯ç”¨ CPU profilerï¼‰</td></tr><tr><td><strong>æ’ä»¶æ”¯æŒ</strong></td><td>å¯ä»¥é€šè¿‡æ’ä»¶å®‰è£…æ›´å¤šåŠŸèƒ½ï¼ˆå¦‚ Visual GCï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ jvisualvm</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå¦‚æœæ˜¯åˆ†ææœåŠ¡ç«¯ .hprof æ–‡ä»¶ï¼Œå¯ä»¥å¯¼å‡ºåˆ°æœ¬åœ°ååœ¨æœ¬åœ°å¯åŠ¨</span></span><br><span class="line">$ jvisualvm</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>âš ï¸ æ³¨æ„äº‹é¡¹</p></li></ul><table><thead><tr><th>æ³¨æ„ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ä¸é€‚ç”¨äºå¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒç›‘æ§</td><td>å› ä¸ºå…¶åˆ†æè¿‡ç¨‹å¯èƒ½ä¼šå¯¹ JVM æœ‰è½»å¾®å½±å“</td></tr><tr><td><code>.hprof</code> æ–‡ä»¶è¿‡å¤§æ—¶åŠ è½½ç¼“æ…¢</td><td>å¯é…åˆ Eclipse MAT ä½¿ç”¨</td></tr><tr><td>CPU/Memory Profiler ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹…</td><td>ä½¿ç”¨æ—¶è°¨æ…ï¼Œå»ºè®®åªåœ¨æµ‹è¯•ç¯å¢ƒå¯ç”¨</td></tr></tbody></table><h2 id="Eclipse-MAT-Java-Heap-Dump-åˆ†æå·¥å…·">Eclipse MAT: Java Heap Dump åˆ†æå·¥å…·</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://eclipse.dev/mat">Eclipse MAT</a>ï¼ˆEclipse Memory Analyzer Toolï¼‰æ˜¯ä¸€ä¸ªç”¨äºåˆ†æ Java å †å¿«ç…§çš„å·¥å…·ï¼Œå®ƒæä¾›äº†è®¸å¤šåŠŸèƒ½æ¥å¸®åŠ©å¼€å‘äººå‘˜ç†è§£ Java åº”ç”¨ç¨‹åºä¸­çš„å†…å­˜é—®é¢˜ã€‚</p></li></ul><div class="tips"><p><em><strong>MaxOSç³»ç»Ÿå®‰è£…Eclipse MATåï¼Œå¯åŠ¨æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸ºï¼šThe JVM shared library â€œ/Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/â€¦/lib/server/libjvm.dylibâ€ does not contain the JNI_CreateJavaVM symbol.</strong></em></p><ul class="lvl-1"><li class="lvl-2">è§£å†³æ–¹æ³•ï¼š<br>1.åœ¨åº”ç”¨åˆ—è¡¨ï¼Œæ‰¾åˆ°<code>MemoryAnalyzer.app</code>ï¼Œç„¶åå³é”®å•å‡»åï¼Œé€‰æ‹©<code>æ˜¾ç¤ºåŒ…å†…å®¹</code>,è¿›å…¥Contentsç›®å½•ï¼Œæ‰¾åˆ°<code>Info.plist</code>æ–‡ä»¶<br>2.æ‰“å¼€<code>Info.plist</code>æ–‡ä»¶åï¼Œå¯ä»¥çœ‹åˆ°æ³¨é‡Š<code>&lt;string&gt;-vm&lt;/string&gt;</code>é…ç½®é¡¹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ‰“å¼€è¿™ä¸ªé…ç½®é¡¹ï¼Œå¹¶ä¸”å°†å…¶è®¾ç½®ä¸ºæˆ‘ä»¬ç³»ç»Ÿçš„Javaè·¯å¾„ï¼Œæœ€æ–°ç‰ˆéœ€è¦<code>jdk17+</code></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>-vm<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>/Users/hanqf/develop_soft/jdk17/bin/java<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="Arthas-æ¨è">Arthas : æ¨è</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://arthas.aliyun.com">Arthas</a> æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾ Java è¯Šæ–­å·¥å…·ï¼Œä¸“ä¸ºçº¿ä¸Šè¯Šæ–­è€Œè®¾è®¡ã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨ä¸é‡å¯ã€ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ’æŸ¥ç”Ÿäº§ç¯å¢ƒä¸­ Java åº”ç”¨çš„é—®é¢˜ã€‚æ–‡æ¡£éå¸¸è¯¦ç»†ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p></li></ul><h3 id="Arthas-æ ¸å¿ƒç‰¹ç‚¹">Arthas æ ¸å¿ƒç‰¹ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>æ— éœ€é‡å¯ã€ä¾µå…¥æ€§ä½<br>Arthas å¯ä»¥ attach åˆ°æ­£åœ¨è¿è¡Œçš„ JVM ä¸Šï¼Œä¸éœ€è¦é‡å¯æœåŠ¡æˆ–ä¿®æ”¹æºä»£ç ã€‚</p></li><li class="lvl-2"><p>å‘½ä»¤å¼äº¤äº’ä½“éªŒ<br>ç±»ä¼¼ Linux shell çš„æ“ä½œæ–¹å¼ï¼Œæ”¯æŒ tab è¡¥å…¨ã€ä¸Šä¸‹é”®å†å²å‘½ä»¤ç­‰ï¼Œéå¸¸ç›´è§‚ã€‚</p></li><li class="lvl-2"><p>å®æ—¶æŸ¥çœ‹å’Œç›‘æ§<br>å¯æŸ¥çœ‹æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€è°ƒç”¨æ ˆã€æ‰§è¡Œè€—æ—¶ã€JVM çº¿ç¨‹ã€å†…å­˜ç­‰å®æ—¶æ•°æ®ã€‚</p></li><li class="lvl-2"><p>å¤šç§è¿æ¥æ–¹å¼<br>æ”¯æŒå‘½ä»¤è¡Œç»ˆç«¯ã€æœ¬åœ° shellã€Web é¡µé¢ã€telnet ç­‰å¤šç§è¿æ¥æ–¹å¼ã€‚</p></li><li class="lvl-2"><p>æ”¯æŒå¤šç§ JVM ç‰ˆæœ¬<br>æ”¯æŒ Java 6+ï¼ŒåŒ…æ‹¬ OpenJDKã€Oracle JDKã€Alibaba Dragonwell ç­‰ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»JVMçš„å‘½ä»¤è¡Œå·¥å…·&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/specs/jvms/se8/html/index.html&quot;&gt;The JavaÂ® Virtual Machine Specification&lt;/a&gt; ç‰ˆæœ¬jdk1.8&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="jvm" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/jvm/"/>
    
    
    <category term="jvm" scheme="https://blog.hanqunfeng.com/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>JVM ä¹‹ å†…å­˜æ¨¡å‹ä¸åƒåœ¾å›æ”¶æœºåˆ¶(GC)</title>
    <link href="https://blog.hanqunfeng.com/2025/05/12/jvm-gc-01/"/>
    <id>https://blog.hanqunfeng.com/2025/05/12/jvm-gc-01/</id>
    <published>2025-05-12T14:30:05.000Z</published>
    <updated>2025-05-13T03:35:52.361Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»JVMçš„å†…å­˜æ¨¡å‹ä¸åƒåœ¾å›æ”¶æœºåˆ¶</p></li><li class="lvl-2"><p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/index.html">The JavaÂ® Virtual Machine Specification</a> ç‰ˆæœ¬jdk1.8</p></li></ul><span id="more"></span><h2 id="JVM-çš„å‚æ•°-ä¸‰ç±»">JVM çš„å‚æ•°(ä¸‰ç±»)</h2><ul class="lvl-0"><li class="lvl-2"><p>æ ‡å‡†å‚æ•°: ä»¥<code>-</code>å¼€å¤´ï¼Œæ‰€æœ‰ HotSpot éƒ½â½€æŒã€‚ä¾‹å¦‚<code>java -version</code>ã€‚è¿™ç±»å‚æ•°å¯ä»¥ä½¿â½¤<code>java -help</code> æˆ–è€…<code>java -?</code>å…¨éƒ¨æ‰“å°å‡ºæ¥</p></li><li class="lvl-2"><p>â¾®æ ‡å‡†å‚æ•°: ä»¥<code>-X</code>å¼€å¤´ï¼Œæ˜¯ç‰¹å®š HotSpotç‰ˆæœ¬â½€æŒçš„æŒ‡ä»¤ã€‚ä¾‹å¦‚<code>java -Xms200M -Xmx200M</code>ã€‚è¿™ç±»æŒ‡ä»¤å¯ä»¥â½¤<code>java -X</code> å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚</p></li><li class="lvl-2"><p>ä¸ç¨³å®šå‚æ•°: è¿™ä¹Ÿæ˜¯ JVMè°ƒä¼˜çš„å™©æ¢¦ã€‚ä»¥<code>-XX</code> å¼€å¤´ï¼Œè¿™äº›å‚æ•°æ˜¯è·Ÿç‰¹å®šHotSpotç‰ˆæœ¬å¯¹åº”çš„ï¼Œå¾ˆæœ‰å¯èƒ½æ¢ä¸ªç‰ˆæœ¬å°±æ²¡æœ‰äº†ã€‚è¯¦ç»†çš„â½‚æ¡£èµ„æ–™ä¹Ÿç‰¹åˆ«å°‘ã€‚JDK8 ä¸­çš„ä»¥ä¸‹â¼ä¸ªæŒ‡ä»¤å¯ä»¥å¸®åŠ©å¼€å‘è€…äº†è§£ JDK8 ä¸­çš„è¿™â¼€ç±»ä¸ç¨³å®šå‚æ•°ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+PrintFlagsFinal -version      <span class="comment"># æ‰€æœ‰å‚æ•°æœ€ç»ˆâ½£æ•ˆçš„å€¼ã€‚</span></span><br><span class="line">java -XX:+PrintFlagsInitial -version   <span class="comment"># æ‰€æœ‰å‚æ•°çš„é»˜è®¤å€¼</span></span><br><span class="line">java -XX:+PrintCommandLineFlags -version <span class="comment"># å½“å‰å‘½ä»¤ç”Ÿæ•ˆçš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯â½¤çš„å“ªç§GCã€‚ JDK1.8é»˜è®¤â½¤çš„ParallelGC</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œ <code>java -XX:+PrintFlagsFinal -version</code> æœ€åä¸€åˆ—çš„æ ‡è®°è¯´æ˜</p></li></ul><table><thead><tr><th>æ ‡è®°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>&#123;product&#125;</code></td><td>æ­£å¼äº§å“å‚æ•°ï¼ˆç”¨æˆ·å¯ç”¨ï¼Œå¯é€šè¿‡ <code>-XX:</code> è¿›è¡Œè®¾ç½®ï¼‰</td></tr><tr><td><code>&#123;pd product&#125;</code></td><td>å¹³å°ç›¸å…³çš„æ­£å¼å‚æ•°ï¼ˆplatform-dependentï¼‰ï¼Œåœ¨æŸäº›æ“ä½œç³»ç»Ÿ/CPU ä¸Šå¯ç”¨</td></tr><tr><td><code>&#123;C2 product&#125;</code></td><td>ä»…åœ¨ä½¿ç”¨ <strong>C2 ç¼–è¯‘å™¨ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</strong> æ—¶æœ‰æ•ˆçš„å‚æ•°</td></tr><tr><td><code>&#123;diagnostic&#125;</code></td><td>è¯Šæ–­å‚æ•°ï¼Œé»˜è®¤ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œéœ€åŠ  <code>-XX:+UnlockDiagnosticVMOptions</code> å¯ç”¨</td></tr><tr><td><code>&#123;experimental&#125;</code></td><td>å®éªŒæ€§å‚æ•°ï¼Œéœ€åŠ  <code>-XX:+UnlockExperimentalVMOptions</code> æ‰èƒ½ä½¿ç”¨</td></tr><tr><td><code>&#123;manageable&#125;</code></td><td>å¯é€šè¿‡ JMX åŠ¨æ€ç®¡ç†çš„å‚æ•°ï¼ˆè¿è¡Œæ—¶å¯è°ƒæ•´ï¼‰</td></tr><tr><td><code>&#123;notproduct&#125;</code></td><td>éäº§å“å‚æ•°ï¼Œä»…ç”¨äº JVM å¼€å‘å’Œæµ‹è¯•ï¼ˆæ™®é€šç”¨æˆ·æ— æ³•ä½¿ç”¨ï¼‰</td></tr><tr><td><code>&#123;ARCH product&#125;</code></td><td>ä¸ CPU æ¶æ„ç›¸å…³çš„äº§å“å‚æ•°ï¼ˆå¦‚ x86ã€ARM ç­‰ï¼‰</td></tr><tr><td><code>&#123;JVMCI&#125;</code></td><td>ä¸ JVM Compiler Interface ç›¸å…³çš„å‚æ•°</td></tr><tr><td><code>&#123;lp64_product&#125;</code></td><td>ä»…åœ¨ 64 ä½ JVM ä¸Šæ‰æœ‰æ•ˆçš„äº§å“å‚æ•°</td></tr><tr><td><code>&#123;develop&#125;</code></td><td>å¼€å‘ç”¨å‚æ•°ï¼Œä»…ç”¨äº HotSpot å†…éƒ¨å¼€å‘ï¼ˆæ„å»ºæ—¶å¯ç”¨ï¼‰</td></tr><tr><td><code>&#123;commercial&#125;</code></td><td>å•†ä¸šç‰¹æ€§å‚æ•°ï¼Œä»…åœ¨ Oracle JDK çš„å•†ä¸šç‰ˆä¸­å¯ç”¨ï¼ˆå·²åºŸå¼ƒï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æˆ‘ä»¬åªéœ€è¦å…³æ³¨ <code>&#123;product&#125;</code> å‚æ•°ï¼Œå¸¸ç”¨ product å‚æ•°ï¼ˆå¯ç›´æ¥ä½¿ç”¨ï¼‰</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç¤ºä¾‹å€¼</th></tr></thead><tbody><tr><td><code>-Xms</code> / <code>-Xmx</code></td><td>åˆå§‹/æœ€å¤§å †å¤§å°</td><td><code>-Xms2g -Xmx2g</code></td></tr><tr><td><code>-Xmn</code></td><td>æ–°ç”Ÿä»£å¤§å°</td><td><code>-Xmn512m</code></td></tr><tr><td><code>-Xss</code></td><td>æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°</td><td><code>-Xss512k</code></td></tr><tr><td><code>-XX:SurvivorRatio</code></td><td>Eden:S0:S1 æ¯”ä¾‹</td><td><code>-XX:SurvivorRatio=8</code></td></tr><tr><td><code>-XX:MaxTenuringThreshold</code></td><td>æœ€å¤§æ™‹å‡å¹´é¾„é˜ˆå€¼</td><td><code>-XX:MaxTenuringThreshold=15</code></td></tr><tr><td><code>-XX:+UseG1GC</code> / <code>-XX:+UseParallelGC</code> ç­‰</td><td>é€‰æ‹© GC ç±»å‹</td><td><code>-XX:+UseG1GC</code></td></tr><tr><td><code>-XX:MaxGCPauseMillis</code></td><td>æœ€å¤§ GC æš‚åœç›®æ ‡/æœ€å¤§å…è®¸æš‚åœæ—¶é—´(æ¯«ç§’)<br>è¿™æ˜¯ä¸€ä¸ªâ€œç›®æ ‡å€¼â€ï¼Œä¸æ˜¯ç¡¬é™åˆ¶ï¼ŒJVM ä¼šå°½é‡æ»¡è¶³ï¼Œä½†å¯èƒ½è¾¾ä¸åˆ°</td><td><code>-XX:MaxGCPauseMillis=200</code></td></tr><tr><td><code>-XX:GCTimeRatio</code></td><td>æ§åˆ¶ GC æ—¶é—´ä¸åº”ç”¨è¿è¡Œæ—¶é—´çš„æ¯”ç‡ï¼Œç”¨äºä¼˜åŒ–ååé‡</td><td><code>-XX:GCTimeRatio=9</code> è¡¨ç¤º GC æ—¶é—´å æ€»è¿è¡Œæ—¶é—´çš„ä¸Šé™æ˜¯ 1 / (1 + 9) = 10%ï¼Œå³ååé‡ä¸º 90% <br> <code>-XX:GCTimeRatio=99</code> GC å  1%ï¼Œåº”ç”¨è¿è¡Œå  99%ï¼Œæœ€å¤§åŒ–åå</td></tr><tr><td><code>-XX:MetaspaceSize</code> / <code>-XX:MaxMetaspaceSize</code></td><td>è®¾ç½®å…ƒç©ºé—´å¤§å°</td><td><code>-XX:MetaspaceSize=128m</code></td></tr><tr><td><code>-XX:+AlwaysPreTouch</code></td><td>å¯åŠ¨æ—¶é¢„åˆ†é…æ‰€æœ‰å†…å­˜é¡µï¼Œé¿å…è¿è¡ŒæœŸå»¶è¿Ÿ</td><td><code>-XX:+AlwaysPreTouch</code></td></tr><tr><td><code>-XX:+PrintGCDetails</code></td><td>æ‰“å° GC è¯¦æƒ…</td><td>-</td></tr><tr><td><code>-XX:+PrintGCDateStamps</code></td><td>æ‰“å°å¸¦æ—¶é—´æˆ³çš„ GC æ—¥å¿—</td><td>-</td></tr></tbody></table><h2 id="JVMè™šæ‹Ÿæœºç»“æ„-HotSpot">JVMè™šæ‹Ÿæœºç»“æ„(HotSpot)</h2><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/cGMyEe.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>è®¾ç½®å†…å­˜åˆ†é…ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jdk1.8+</span></span><br><span class="line">java â€Xms2048M â€Xmx2048M â€Xmn1024M â€Xss512K â€XX:MetaspaceSize=256M â€XX:MaxMetaspaceSize=256M â€jar server.jar</span><br><span class="line"><span class="comment"># jdk1.6/1.7</span></span><br><span class="line">java â€Xms2048M â€Xmx2048M â€Xmn1024M â€Xss512K â€XX:PermSize=256M â€XX:MaxPermSize=256M â€jar server.jar</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å„å‚æ•°å«ä¹‰ä¸é»˜è®¤å€¼ï¼ˆé’ˆå¯¹ JDK 1.8ï¼‰</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰è¯´æ˜</th><th>é»˜è®¤å€¼ï¼ˆJDK 1.8ï¼‰</th></tr></thead><tbody><tr><td><code>-Xms2048M</code></td><td><strong>åˆå§‹å †å¤§å°</strong>ï¼Œå³ JVM å¯åŠ¨æ—¶åˆ†é…çš„å †å†…å­˜å¤§å°ï¼ˆè¿™é‡Œæ˜¯ 2GBï¼‰</td><td>ç‰©ç†å†…å­˜çš„ 1/64ï¼ˆæœ€å° 1MBï¼‰ï¼Œæ¨èé…ç½®ä¸ºä¸ -Xmx ä¸€è‡´</td></tr><tr><td><code>-Xmx2048M</code></td><td><strong>æœ€å¤§å †å†…å­˜å¤§å°</strong>ï¼ŒJVM å…è®¸åˆ†é…çš„æœ€å¤§å †å†…å­˜</td><td>ç‰©ç†å†…å­˜çš„ 1/4ï¼ˆå—é™äº 32ä½/64ä½ï¼‰</td></tr><tr><td><code>-Xmn1024M</code></td><td><strong>æ–°ç”Ÿä»£å¤§å°</strong>ï¼ˆEden + Survivorï¼‰ä¸º 1GB</td><td>æœªæ˜¾å¼æŒ‡å®šæ—¶ï¼Œé€šå¸¸å å †çš„ 1/3 å·¦å³</td></tr><tr><td><code>-Xss512K</code></td><td><strong>æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°</strong>ï¼ˆThread Stack Sizeï¼‰ï¼Œè¿™é‡Œè®¾ç½®ä¸º 512KB</td><td>1MBï¼ˆ64ä½ç³»ç»Ÿï¼‰æˆ– 512KBï¼ˆ32ä½ç³»ç»Ÿï¼‰</td></tr><tr><td><code>-XX:MetaspaceSize=256M</code></td><td><strong>å…ƒç©ºé—´åˆå§‹å¤§å°</strong>ï¼ˆç”¨äºåŠ è½½ç±»çš„å…ƒæ•°æ®ï¼Œä¸å†ä½¿ç”¨ PermGenï¼‰</td><td>21MBï¼ˆå®¢æˆ·ç«¯ï¼‰æˆ– 16MBï¼ˆæœåŠ¡å™¨ç«¯ï¼‰,æ¨èé…ç½®ä¸ºä¸  MaxMetaspaceSize ä¸€è‡´</td></tr><tr><td><code>-XX:MaxMetaspaceSize=256M</code></td><td><strong>å…ƒç©ºé—´æœ€å¤§å¤§å°</strong>ï¼Œè¶…è¿‡åè§¦å‘ Full GC</td><td>æ— é™åˆ¶ï¼ˆé»˜è®¤åªå—ç‰©ç†å†…å­˜çº¦æŸï¼‰ ï¼Œæ¨èé…ç½®ä¸€ä¸ªåˆé€‚çš„æ•°å€¼ï¼Œæ¯”å¦‚8Gçš„å†…å­˜å¯ä»¥é…ç½®ä¸º256M</td></tr></tbody></table><h3 id="ç±»è£…è½½å­ç³»ç»Ÿï¼ˆClass-Loading-Subsystemï¼‰">ç±»è£…è½½å­ç³»ç»Ÿï¼ˆClass Loading Subsystemï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>ç±»è£…è½½å­ç³»ç»Ÿè´Ÿè´£å°† <code>.class</code> æ–‡ä»¶åŠ è½½åˆ° JVM ä¸­ï¼Œå¹¶è¿›è¡Œè§£æã€éªŒè¯ã€åˆå§‹åŒ–ç­‰è¿‡ç¨‹ã€‚</p></li><li class="lvl-2"><p>åŠ è½½è¿‡ç¨‹çš„å‡ ä¸ªé˜¶æ®µï¼š</p></li></ul><table><thead><tr><th>é˜¶æ®µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åŠ è½½ï¼ˆLoadingï¼‰</strong></td><td>å°† <code>.class</code> æ–‡ä»¶è¯»å–ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼Œæ„é€  <code>Class</code> å¯¹è±¡</td></tr><tr><td><strong>éªŒè¯ï¼ˆVerificationï¼‰</strong></td><td>ç¡®ä¿å­—èŠ‚ç æ–‡ä»¶æ ¼å¼æ­£ç¡®ã€å®‰å…¨åˆæ³•ï¼ˆé˜²æ­¢æ¶æ„ä»£ç ï¼‰</td></tr><tr><td><strong>å‡†å¤‡ï¼ˆPreparationï¼‰</strong></td><td>ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤åˆå§‹å€¼</td></tr><tr><td><strong>è§£æï¼ˆResolutionï¼‰</strong></td><td>å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼ˆæ–¹æ³•ã€å­—æ®µç­‰ï¼‰</td></tr><tr><td><strong>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</strong></td><td>æ‰§è¡Œ <code>&lt;clinit&gt;</code> é™æ€åˆå§‹åŒ–æ–¹æ³•ï¼Œå¯¹é™æ€å˜é‡èµ‹åˆå§‹å€¼</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ä½“ç³»ç»“æ„ï¼šè¯¦ç»†å‚è€ƒ <a href="/2025/05/08/jvm-classloader-01/" title="JVM ä¹‹ ç±»åŠ è½½å™¨">JVM ä¹‹ ç±»åŠ è½½å™¨</a></p></li></ul><table><thead><tr><th>ç±»åŠ è½½å™¨åç§°</th><th>åŠ è½½å†…å®¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰</strong></td><td>Java æ ¸å¿ƒç±»åº“ï¼ˆå¦‚ <code>java.lang.*</code>ï¼‰</td><td>ç”± JVM è‡ªèº«å®ç°ï¼Œç”¨æœ¬åœ°ä»£ç å®ç°ï¼Œæ— æ³•ç›´æ¥è®¿é—®</td></tr><tr><td><strong>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰</strong></td><td><code>JAVA_HOME/jre/lib/ext</code> ç›®å½•ä¸‹çš„ç±»</td><td>åŠ è½½æ ‡å‡†æ‰©å±•ç±»åº“</td></tr><tr><td><strong>åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰</strong></td><td>ç”¨æˆ·åº”ç”¨ç±»è·¯å¾„ï¼ˆCLASSPATH æŒ‡å®šçš„ç›®å½•ï¼‰</td><td>æœ€å¸¸ç”¨ï¼ŒåŠ è½½å¤§å¤šæ•°åº”ç”¨ä»£ç </td></tr><tr><td><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆCustom ClassLoaderï¼‰</strong></td><td>ç”¨æˆ·æ‰‹åŠ¨å®ç°çš„ç±»åŠ è½½å™¨</td><td>å¯ä»¥æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå®ç°çƒ­åŠ è½½ã€åŠ å¯†ç±»åŠ è½½ç­‰</td></tr></tbody></table><blockquote><p>ç±»åŠ è½½é‡‡ç”¨ åŒäº²å§”æ´¾æ¨¡å‹ï¼šè¯·æ±‚ä¼šå…ˆå‘çˆ¶åŠ è½½å™¨å§”æ‰˜ï¼Œåªæœ‰åœ¨çˆ¶åŠ è½½å™¨åŠ è½½å¤±è´¥æ—¶æ‰å°è¯•è‡ªèº«åŠ è½½ã€‚</p></blockquote><h3 id="å­—èŠ‚ç æ‰§è¡Œå¼•æ“ï¼ˆExecution-Engineï¼‰">å­—èŠ‚ç æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>å­—èŠ‚ç æ‰§è¡Œå¼•æ“è´Ÿè´£å°† Java å­—èŠ‚ç è§£é‡Šæˆ–ç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œå¹¶åœ¨åº•å±‚å¹³å°ä¸Šæ‰§è¡Œã€‚</p></li><li class="lvl-2"><p>æ‰§è¡Œå¼•æ“çš„æ ¸å¿ƒæ¨¡å—</p></li></ul><table><thead><tr><th>ç»„ä»¶åç§°</th><th>ä½œç”¨è¯´æ˜</th><th>å…³é”®ç‰¹æ€§</th></tr></thead><tbody><tr><td><strong>è§£é‡Šå™¨ï¼ˆInterpreterï¼‰</strong></td><td>å°†å­—èŠ‚ç é€æ¡è§£é‡Šæ‰§è¡Œ</td><td>å¯åŠ¨å¿«ï¼Œé€‚åˆå†·ä»£ç ï¼ˆéçƒ­ç‚¹ä»£ç ï¼‰ï¼Œæ‰§è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½</td></tr><tr><td><strong>å³æ—¶ç¼–è¯‘å™¨ï¼ˆJIT Compilerï¼‰</strong></td><td>å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡</td><td>åŒ…å« C1ï¼ˆClientï¼‰å’Œ C2ï¼ˆServerï¼‰ä¸¤ç§ï¼Œæ”¯æŒä¼˜åŒ–å¦‚ï¼šæ–¹æ³•å†…è”ã€é€ƒé€¸åˆ†æã€å¾ªç¯å±•å¼€ç­‰</td></tr><tr><td><strong>åƒåœ¾æ”¶é›†å™¨ï¼ˆGarbage Collector, GCï¼‰</strong></td><td>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œè´Ÿè´£å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„å›æ”¶</td><td>å¸¸è§ç®—æ³•åŒ…æ‹¬ï¼šSerialã€Parallelã€CMSã€G1ã€ZGCï¼ˆä½å»¶è¿Ÿï¼‰ç­‰ï¼Œæ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹©</td></tr><tr><td><strong>æœ¬åœ°æ¥å£ï¼ˆNative Interfaceï¼‰</strong></td><td>æ”¯æŒ Java ä¸æœ¬åœ°è¯­è¨€ï¼ˆå¦‚ C/C++ï¼‰çš„äº’æ“ä½œ</td><td>é€šè¿‡ JNIï¼ˆJava Native Interfaceï¼‰å®ç°ï¼Œè°ƒç”¨åº•å±‚æ“ä½œç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹åº“åŠŸèƒ½</td></tr></tbody></table><h3 id="JVM-å†…å­˜æ¨¡å‹ï¼ˆJava-Memory-Modelï¼ŒJMMï¼‰">JVM å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>JMM æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„ä¸€ç§ æŠ½è±¡å†…å­˜æ¨¡å‹ï¼Œå®ƒå†³å®šäº†å¤šçº¿ç¨‹ç¨‹åºä¸­å˜é‡çš„è¯»å†™å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§ã€‚åŒæ—¶ï¼ŒJVM åœ¨ç‰©ç†å±‚ä¹Ÿæœ‰ä¸€ä¸ªå®é™…çš„å†…å­˜ç»“æ„ï¼Œç§°ä¸ºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼ˆRuntime Data Areasï¼‰ï¼Œè¿™ä¸¤ä¸ªå¯ä»¥ç»“åˆç†è§£ã€‚</p></li><li class="lvl-2"><p>JMM çš„ä¸»è¦ç›®æ ‡</p><ul class="lvl-2"><li class="lvl-6">ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®ä¸€è‡´æ€§</li><li class="lvl-6">æŒ‡å¯¼ JVM å’Œ CPU çš„å†…å­˜äº¤äº’è¡Œä¸ºï¼ˆå¦‚é‡æ’åºã€ç¼“å­˜ï¼‰</li></ul></li><li class="lvl-2"><p>å®é™…è¿è¡Œæ—¶å†…å­˜ç»“æ„å¦‚ä¸‹ï¼š</p></li></ul><table><thead><tr><th>å†…å­˜åŒºåŸŸ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ğŸ“Œ <strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰</strong></td><td>æ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼Œè®°å½•å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€</td></tr><tr><td>ğŸ“Œ <strong>Java çº¿ç¨‹æ ˆ</strong></td><td>æ¯ä¸ªçº¿ç¨‹ç§æœ‰ï¼Œæ–¹æ³•è°ƒç”¨æ—¶ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆç­‰</td></tr><tr><td>ğŸ“Œ <strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong></td><td>ä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œç”¨äº native æ–¹æ³•</td></tr><tr><td>ğŸ“Œ <strong>å †ï¼ˆHeapï¼‰</strong></td><td>æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå­˜å‚¨å¯¹è±¡å®ä¾‹ã€æ•°ç»„ç­‰ï¼ŒGC çš„ä¸»è¦åŒºåŸŸ</td></tr><tr><td>ğŸ“Œ <strong>æ–¹æ³•åŒºï¼ˆæˆ–å…ƒç©ºé—´ï¼‰</strong></td><td>æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå­˜å‚¨ç±»ä¿¡æ¯ã€é™æ€å˜é‡ã€å¸¸é‡æ± ç­‰ï¼ˆJDK8 åç§°ä¸º Metaspaceï¼‰</td></tr></tbody></table><h2 id="åƒåœ¾å›æ”¶å™¨">åƒåœ¾å›æ”¶å™¨</h2><ul class="lvl-0"><li class="lvl-2"><p>åƒåœ¾å›æ”¶å™¨è´Ÿè´£è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼å’Œæº¢å‡ºã€‚</p></li></ul><h3 id="ä»€ä¹ˆæ˜¯åƒåœ¾">ä»€ä¹ˆæ˜¯åƒåœ¾</h3><ul class="lvl-0"><li class="lvl-2"><p>å†…å­˜ä¸­æ²¡æœ‰è¢«ï¼ˆçº¿ç¨‹æ ˆå˜é‡ï¼Œé™æ€å˜é‡ï¼Œå¸¸é‡æ± ï¼ŒJNIæŒ‡é’ˆï¼‰å¼•ç”¨çš„åœ°å€å°±æ˜¯åƒåœ¾</p></li><li class="lvl-2"><p>å¯è¾¾æ€§åˆ†æç®—æ³•ï¼šæ˜¯ç°ä»£ JVM åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦â€œè¿˜æ´»ç€â€çš„ä¸»è¦ç®—æ³•ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬æ€æƒ³ï¼š</span><br><span class="line">ä»ä¸€ç»„ç§°ä¸º â€œGC Rootsâ€ çš„å¯¹è±¡å‡ºå‘ï¼Œæ²¿ç€å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨é“¾å‘ä¸‹æœç´¢ã€‚</span><br><span class="line">å¦‚æœæŸä¸ªå¯¹è±¡ å¯ä»¥ä» GC Roots è¿½è¸ªåˆ°ï¼Œå°±è®¤ä¸ºå®ƒæ˜¯ â€œå¯è¾¾â€ çš„ï¼ˆAliveï¼‰ã€‚</span><br><span class="line">å¦åˆ™å°±è®¤ä¸ºæ˜¯ â€œä¸å¯è¾¾â€ çš„ï¼ˆGarbageï¼‰ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚</span><br></pre></td></tr></table></figure><div class="tips"><ul class="lvl-1"><li class="lvl-2"><p>åœ¨ JVM ä¸­ï¼Œ<code>GC Roots</code> æ˜¯ä¸€äº› å§‹ç»ˆå¯ç”¨çš„ã€ä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¼•ç”¨èµ·ç‚¹ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p></li></ul><table><thead><tr><th>GC Roots æ¥æº</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å½“å‰çº¿ç¨‹æ ˆä¸­çš„å¼•ç”¨ï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼‰</td><td>å„ä¸ªçº¿ç¨‹æ­£åœ¨è°ƒç”¨çš„æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰</td></tr><tr><td>é™æ€å­—æ®µå¼•ç”¨</td><td>ç±»çš„é™æ€å­—æ®µå¼•ç”¨çš„å¯¹è±¡</td></tr><tr><td>JNI å¼•ç”¨ï¼ˆNative æ–¹æ³•å¼•ç”¨ï¼‰</td><td>Java æœ¬åœ°æ–¹æ³•ä¸­å¼•ç”¨çš„å¯¹è±¡</td></tr><tr><td>å¸¸é‡å¼•ç”¨æ± ä¸­çš„å¯¹è±¡</td><td>å­—ç¬¦ä¸²å¸¸é‡ç­‰å¯èƒ½æŒæœ‰å¯¹è±¡å¼•ç”¨</td></tr><tr><td>æ´»åŠ¨çº¿ç¨‹å¯¹è±¡</td><td>çº¿ç¨‹è‡ªèº«åœ¨ GC æ—¶ä¸ä¼šè¢«å›æ”¶</td></tr><tr><td>JVM å†…éƒ¨ç»“æ„ï¼ˆå¦‚ç³»ç»Ÿç±»åŠ è½½å™¨ç­‰ï¼‰</td><td>JVM å…³é”®ç³»ç»Ÿå¯¹è±¡</td></tr></tbody></table></div><h3 id="åƒåœ¾å›æ”¶å™¨ç§ç±»ï¼š">åƒåœ¾å›æ”¶å™¨ç§ç±»ï¼š</h3><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/TEILZ9.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>å·¦è¾¹6ç§å«åˆ†ä»£æ¨¡å‹ï¼Œå³è¾¹çš„4ç§å«åˆ†åŒºæ¨¡å‹</p></li></ul><div class="tips"><p><em><strong>åˆ†ä»£æ¨¡å‹ï¼ˆGenerational Modelï¼‰</strong></em><br>å †å†…å­˜åˆ’åˆ†ä¸ºï¼š<br>å¹´è½»ä»£ï¼ˆYoung Generationï¼‰ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œåˆ†ä¸º Eden å’Œ Survivor åŒºã€‚<br>è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼šå­˜æ”¾ç»è¿‡å¤šæ¬¡ GC åä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚</p><p><em><strong>åˆ†åŒºæ¨¡å‹ï¼ˆRegion-based Modelï¼‰</strong></em><br>åˆ†åŒºæ¨¡å‹ï¼ˆå¦‚ G1ã€ZGCã€Shenandoahï¼‰ä¸å†ä¸¥æ ¼æŒ‰ç…§ä»£åˆ’åˆ†å†…å­˜ï¼Œè€Œæ˜¯æŠŠå †åˆ’åˆ†ä¸ºå¤šä¸ª å¤§å°ç›¸åŒçš„ Regionã€‚æ¯ä¸ª Region å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€æ ‡è®°ä¸º Edenã€Survivor æˆ– Oldã€‚</p></div><ul class="lvl-0"><li class="lvl-2"><p>åˆ†ä»£æ¨¡å‹ä¸­ï¼Œä¸Šé¢3ä¸ªæ˜¯æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¸‹é¢3ä¸ªæ˜¯è€å¹´ä»£åƒåœ¾å›æ”¶å™¨ï¼Œå¯ä»¥äº¤å‰é…å¯¹ï¼ˆè§ä¸Šå›¾è™šçº¿ï¼‰ï¼Œä½†æœ€å¸¸ç”¨æ˜¯ä¸Šä¸‹ä¸¤ä¸¤é…å¯¹ã€‚</p></li><li class="lvl-2"><p>CMSå³å¯ä»¥ä½œä¸ºæ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè€å¹´ä»£åƒåœ¾å›æ”¶å™¨ã€‚</p></li><li class="lvl-2"><p>EpsilonGCï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åƒåœ¾å›æ”¶å™¨ï¼Œå®ƒä¸å›æ”¶ä»»ä½•å¯¹è±¡ï¼Œåªè´Ÿè´£æœ€ç»ˆè®°å½•ï¼Œåšæµ‹è¯•ç”¨çš„ã€‚</p></li><li class="lvl-2"><p>ç›®å‰æœ€å…ˆè¿›çš„æ¨¡å‹æ˜¯ <code>ZGC</code>ï¼Œjkd11å¼€å§‹æ”¯æŒï¼Œä½†ç›´åˆ°JDK16æ‰æ¯”è¾ƒå®Œå–„ï¼Œç›®å‰éé»˜è®¤é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ã€‚å…¶ä¸Redhatå‡ºå“çš„ <code>Shenandoah</code> æ˜¯ç«äº‰å…³ç³»ã€‚</p></li><li class="lvl-2"><p>å¸¸è§åƒåœ¾å›æ”¶å™¨åŠå…¶åˆ†ç±»ã€JDKç‰ˆæœ¬</p></li></ul><table><thead><tr><th>åƒåœ¾å›æ”¶å™¨</th><th>æ‰€å±æ¨¡å‹</th><th>è¯´æ˜</th><th>é¦–æ¬¡å‡ºç° JDK ç‰ˆæœ¬</th><th>å¯ç”¨å‘½ä»¤ï¼ˆJVM å‚æ•°ï¼‰</th><th>é€‚åˆçš„å †å†…å­˜å¤§å°</th></tr></thead><tbody><tr><td><strong>Serial</strong></td><td>åˆ†ä»£æ¨¡å‹</td><td>å•çº¿ç¨‹ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨ Serialï¼Œé€‚ç”¨äºå°å †å†…å­˜</td><td>JDK 1.2</td><td><code>-XX:+UseSerialGC</code></td><td>ğŸ’¾ å°äº 1GB</td></tr><tr><td><strong>ParNew</strong></td><td>åˆ†ä»£æ¨¡å‹</td><td>Serial çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œ<strong>ä»…ç”¨äº CMS æ–°ç”Ÿä»£</strong></td><td>JDK 1.4</td><td><code>-XX:+UseParNewGC -XX:+UseConcMarkSweepGC</code></td><td>ğŸ’¾ 1GB ~ 4GB</td></tr><tr><td><strong>Parallelï¼ˆååé‡ GCï¼‰</strong></td><td>åˆ†ä»£æ¨¡å‹</td><td>å¤šçº¿ç¨‹ GCï¼Œé€‚åˆååé‡ä¼˜å…ˆçš„åº”ç”¨åœºæ™¯</td><td>JDK 1.4</td><td><code>-XX:+UseParallelGC</code>ï¼ˆæ–°ç”Ÿä»£ï¼‰<br><code>-XX:+UseParallelOldGC</code>ï¼ˆè€å¹´ä»£ï¼‰</td><td>ğŸ’¾ 2GB ~ 8GB</td></tr><tr><td><strong>CMSï¼ˆConcurrent Mark Sweepï¼‰</strong></td><td>åˆ†ä»£æ¨¡å‹</td><td>è€å¹´ä»£å¹¶å‘æ ‡è®°-æ¸…é™¤ï¼Œä½å»¶è¿Ÿï¼Œä½†å­˜åœ¨ç¢ç‰‡ï¼Œ<strong>å·²å¼ƒç”¨</strong></td><td>JDK 1.4</td><td><code>-XX:+UseConcMarkSweepGC</code></td><td>ğŸ’¾ 2GB ~ 8GBï¼ˆå·²è¿‡æ—¶ï¼‰</td></tr><tr><td><strong>G1ï¼ˆGarbage Firstï¼‰</strong></td><td>åˆ†åŒºæ¨¡å‹</td><td>å°†å †åˆ’åˆ†ä¸º Regionï¼Œé€»è¾‘åˆ†ä»£ï¼Œæ”¯æŒå¹¶å‘å‹ç¼©ï¼Œå¹³è¡¡å»¶è¿Ÿä¸åå</td><td>JDK 7u4ï¼ˆæ­£å¼ï¼‰</td><td><code>-XX:+UseG1GC</code></td><td>ğŸ’¾ 4GB ~ æ•°å GB</td></tr><tr><td><strong>ZGCï¼ˆZ Garbage Collectorï¼‰</strong></td><td>åˆ†åŒºæ¨¡å‹</td><td>Region å¼¹æ€§å¤§å°ï¼Œæ”¯æŒè¶…å¤§å †ï¼Œä½å»¶è¿Ÿï¼ˆ&lt;10ms åœé¡¿ï¼‰</td><td>JDK 11ï¼ˆå®éªŒï¼‰ï¼ŒJDK 15ï¼ˆæ­£å¼ï¼‰</td><td><code>-XX:+UseZGC</code></td><td>ğŸ’¾ 8GB ~ æ•° TBï¼ˆè¶…å¤§å †ï¼‰</td></tr><tr><td><strong>Shenandoah</strong></td><td>åˆ†åŒºæ¨¡å‹</td><td>çº¢å¸½ä¸»å¯¼ï¼Œä½å»¶è¿Ÿï¼Œå¹¶å‘å›æ”¶ä¸å¹¶å‘å‹ç¼©</td><td>JDK 12ï¼ˆå®éªŒï¼‰ï¼ŒJDK 15ï¼ˆæ­£å¼ï¼‰</td><td><code>-XX:+UseShenandoahGC</code></td><td>ğŸ’¾ 2GB ~ æ•°å GB</td></tr></tbody></table><blockquote><p>å¯¹äº CMSï¼Œå¯ç”¨åä¼šè‡ªåŠ¨ä½¿ç”¨ ParNew ä½œä¸ºæ–°ç”Ÿä»£å›æ”¶å™¨ï¼ˆé™¤éæ˜¾å¼ç¦æ­¢ï¼‰ã€‚<br>CMS å·²åœ¨ JDK 9 å¼€å§‹æ ‡è®°ä¸ºå¼ƒç”¨ï¼ŒJDK 14 å®Œå…¨ç§»é™¤ï¼Œä¸æ¨èå†ä½¿ç”¨ã€‚<br>å¯¹äº Parallel GC å¯ç”¨ <code>-XX:+UseParallelGC</code>ï¼ˆæ–°ç”Ÿä»£ï¼‰ä¼šè‡ªåŠ¨å¯ç”¨ <code>-XX:+UseParallelOldGC</code>ï¼ˆè€å¹´ä»£ï¼‰ã€‚<br>å¯¹äºZGCï¼Œjdk13ä»¥å‰æœ€å¤§æ”¯æŒ4Tå†…å­˜ï¼Œä¹‹åæœ€å¤§æ”¯æŒ16Tå†…å­˜ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å„ç‰ˆæœ¬é»˜è®¤åƒåœ¾å›æ”¶å™¨åŠæ¨èé…ç½®ï¼ˆJDK 1.6 èµ·ï¼‰</p></li></ul><table><thead><tr><th>JDK ç‰ˆæœ¬</th><th>é»˜è®¤ GC</th><th>å»ºè®®ä½¿ç”¨ GCï¼ˆæŒ‰åœºæ™¯åˆ†ç±»ï¼‰</th></tr></thead><tbody><tr><td><strong>JDK 1.6</strong></td><td>Serial / Parallel</td><td>- å°å‹åº”ç”¨ï¼ˆå¦‚æ¡Œé¢ç¨‹åºï¼‰ï¼š<code>-XX:+UseSerialGC</code>  <br> - ä¸­å¤§å‹åº”ç”¨ï¼ˆååé‡ä¼˜å…ˆï¼‰ï¼š<code>-XX:+UseParallelGC</code></td></tr><tr><td><strong>JDK 1.7</strong></td><td>åŒä¸Š</td><td>åŒ JDK 1.6</td></tr><tr><td><strong>JDK 1.8</strong></td><td>Parallel</td><td>- ååä¼˜å…ˆï¼šé»˜è®¤ <code>-XX:+UseParallelGC</code> <br> - å“åº”ä¼˜å…ˆï¼š<code>-XX:+UseConcMarkSweepGC</code>ï¼ˆCMSï¼‰<br> - å¤§å † + æœªæ¥å‡çº§è€ƒè™‘ï¼š<code>-XX:+UseG1GC</code>ï¼ˆæ¨èï¼‰</td></tr><tr><td><strong>JDK 9-14</strong></td><td>G1 GC</td><td>- ä¸€èˆ¬é»˜è®¤å³å¯ï¼š<code>-XX:+UseG1GC</code>ï¼ˆå»¶è¿Ÿä¸ååå¹³è¡¡ï¼‰<br> - æç«¯ä½å»¶è¿Ÿè¦æ±‚ï¼šå‡çº§åˆ° JDK 11+ ä½¿ç”¨ ZGC/Shenandoah</td></tr><tr><td><strong>JDK 15+</strong></td><td>G1 GCï¼ˆé»˜è®¤ï¼‰ï¼ŒZGC / Shenandoah å¯é€‰</td><td>- å»¶è¿Ÿæ•æ„Ÿï¼ˆåœ¨çº¿æœåŠ¡ã€RTç³»ç»Ÿï¼‰ï¼š<code>-XX:+UseZGC</code> æˆ– <code>-XX:+UseShenandoahGC</code><br> - ååä¸ºä¸»ï¼š<code>-XX:+UseParallelGC</code><br> - ç»¼åˆå¹³è¡¡ï¼š<code>-XX:+UseG1GC</code>ï¼ˆé»˜è®¤ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åˆ¤æ–­é»˜è®¤ GC çš„æ–¹å¼</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+PrintCommandLineFlags -version</span><br></pre></td></tr></table></figure><h3 id="åƒåœ¾å›æ”¶ç®—æ³•">åƒåœ¾å›æ”¶ç®—æ³•</h3><ul class="lvl-0"><li class="lvl-2"><p>JVM ä¸­å¸¸è§åƒåœ¾å›æ”¶ç®—æ³•æ±‡æ€»</p></li></ul><table><thead><tr><th>ç®—æ³•åç§°</th><th>æ ¸å¿ƒæ€æƒ³</th><th>é€‚ç”¨é˜¶æ®µ/åŒºåŸŸ</th><th>ä¼˜ç¼ºç‚¹ç®€è¿°</th></tr></thead><tbody><tr><td><strong>æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰</strong></td><td>æ ‡è®°å‡ºå­˜æ´»å¯¹è±¡ï¼Œæ¸…é™¤æœªæ ‡è®°å¯¹è±¡</td><td>è€å¹´ä»£</td><td>ç®€å•é«˜æ•ˆï¼Œä½†ä¼šäº§ç”Ÿå¤§é‡ç¢ç‰‡ï¼Œä¸é€‚åˆè¿ç»­å†…å­˜åˆ†é…</td></tr><tr><td><strong>æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰</strong></td><td>æ ‡è®°åç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ•´ç†ç¢ç‰‡</td><td>è€å¹´ä»£</td><td>æ¶ˆé™¤ç¢ç‰‡ï¼Œä»£ä»·æ˜¯ç§»åŠ¨å¯¹è±¡ï¼Œé€‚ç”¨äºè€å¹´ä»£å‹ç¼©</td></tr><tr><td><strong>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰</strong></td><td>å°†å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜ï¼ˆå¦‚ Eden â†’ Survivorï¼‰</td><td>æ–°ç”Ÿä»£</td><td>é«˜æ•ˆç‡ï¼Œé€‚åˆå›æ”¶å¤§å¤šæ•°å¯¹è±¡çŸ­å‘½çš„æ–°ç”Ÿä»£ï¼Œä½†éœ€è¦é¢å¤–ç©ºé—´</td></tr><tr><td><strong>åˆ†ä»£å›æ”¶ï¼ˆGenerationalï¼‰</strong></td><td>å°†å¯¹è±¡æŒ‰ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ï¼ˆæ–°ç”Ÿä»£/è€å¹´ä»£ï¼‰</td><td>æ•´ä¸ªå †ç»“æ„</td><td>å®ç”¨æ€§å¼ºï¼Œç»“åˆä¸åŒç®—æ³•åº”ç”¨äºä¸åŒä»£ï¼Œç°ä»£ GC åŸºç¡€</td></tr><tr><td><strong>åˆ†åŒºå›æ”¶ï¼ˆRegion-basedï¼‰</strong></td><td>å°†å †åˆ’åˆ†ä¸ºè‹¥å¹²ç­‰å¤§å°çš„ Region åŠ¨æ€åˆ†é…</td><td>æ•´ä¸ªå †ï¼ˆå¦‚ G1ã€ZGCï¼‰</td><td>æ›´çµæ´»ï¼Œæ”¯æŒå¹¶å‘å¹¶è¡Œï¼Œå‡å°‘ STW åœé¡¿ï¼Œé€‚ç”¨äºå¤§å †ã€ä½å»¶è¿Ÿåœºæ™¯</td></tr><tr><td><strong>å¢é‡å›æ”¶ï¼ˆIncrementalï¼‰</strong></td><td>åˆ†é˜¶æ®µå°æ­¥æ‰§è¡Œ GC ä»¥å‡å°‘å•æ¬¡åœé¡¿</td><td>æŸäº›å¹¶å‘/ä½å»¶è¿Ÿ GC</td><td>å‡å°‘æš‚åœæ—¶é—´ï¼Œä½†æ•´ä½“æ•ˆç‡å¯èƒ½é™ä½</td></tr><tr><td><strong>å¹¶å‘å›æ”¶ï¼ˆConcurrentï¼‰</strong></td><td>æ ‡è®°ã€æ¸…ç†ç­‰æ­¥éª¤ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œ</td><td>CMSã€G1ã€ZGC ç­‰</td><td>åœé¡¿æ—¶é—´çŸ­ï¼Œå¯¹å“åº”æ—¶é—´è¦æ±‚é«˜çš„ç³»ç»Ÿå‹å¥½</td></tr><tr><td><strong>ä¸‰è‰²æ ‡è®°ï¼ˆTri-color Markingï¼‰</strong></td><td>å¹¶å‘æ ‡è®°ç®—æ³•çš„ä¸€ç§å®ç°æ€æƒ³</td><td>CMSã€G1ã€ZGC ç­‰</td><td>ç™½ï¼ˆå¾…å›æ”¶ï¼‰ã€ç°ï¼ˆå·²æ ‡è®°æœªæ‰«æï¼‰ã€é»‘ï¼ˆå·²æ ‡è®°å·²æ‰«æï¼‰ï¼Œé¿å…â€œæ¼æ ‡â€é—®é¢˜</td></tr><tr><td><strong>SATBï¼ˆSnapshot-At-The-Beginningï¼‰</strong></td><td>å¹¶å‘æ ‡è®°çš„å¿«ç…§ç­–ç•¥</td><td>G1ã€ZGC</td><td>ä¿è¯åœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ä¸é—æ¼æ–°å¼•ç”¨ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯</td></tr><tr><td><strong>Lazy Compactionï¼ˆå»¶è¿Ÿå‹ç¼©ï¼‰</strong></td><td>ä¸æ¯æ¬¡ GC éƒ½å‹ç¼©ï¼Œè§†æƒ…å†µè€Œå®š</td><td>G1 ç­‰</td><td>é™ä½ä¸å¿…è¦çš„ç§»åŠ¨æˆæœ¬</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¯¹åº”å…³ç³»ï¼šGC å›æ”¶å™¨å’Œåº•å±‚ç®—æ³•</p></li></ul><table><thead><tr><th>å›æ”¶å™¨</th><th>ä½¿ç”¨çš„ç®—æ³•ç»„åˆ</th></tr></thead><tbody><tr><td><strong>Serial</strong></td><td>æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•<br>è€å¹´ä»£ï¼šæ ‡è®°-æ•´ç†</td></tr><tr><td><strong>ParNew</strong></td><td>æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•ï¼ˆå¤šçº¿ç¨‹ï¼‰</td></tr><tr><td><strong>Parallel</strong></td><td>æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•<br>è€å¹´ä»£ï¼šæ ‡è®°-æ•´ç†</td></tr><tr><td><strong>CMS</strong></td><td>æ–°ç”Ÿä»£ï¼šParNewï¼ˆå¤åˆ¶ï¼‰<br>è€å¹´ä»£ï¼šæ ‡è®°-æ¸…é™¤ + ä¸‰è‰²æ ‡è®° + å¹¶å‘</td></tr><tr><td><strong>G1</strong></td><td>åˆ†åŒºå›æ”¶ + ä¸‰è‰²æ ‡è®° + SATB + Lazy Compaction</td></tr><tr><td><strong>ZGC</strong></td><td>åˆ†åŒºå›æ”¶ + å¹¶å‘æ ‡è®° + SATB + Region Remapping</td></tr><tr><td><strong>Shenandoah</strong></td><td>åˆ†åŒºå›æ”¶ + å¹¶å‘æ ‡è®° + å¹¶å‘å‹ç¼© + ä¸‰è‰²æ ‡è®°</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">       â”‚   å¸¸è§ GC ç®—æ³•åˆ†ç±»       â”‚</span><br><span class="line">       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                 â”‚</span><br><span class="line">   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">   â”‚                            â”‚</span><br><span class="line">åˆ†ä»£æ¨¡å‹                      åˆ†åŒºæ¨¡å‹</span><br><span class="line">   â”‚                            â”‚</span><br><span class="line"> â”Œâ”€â”´â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”</span><br><span class="line">å¤åˆ¶   æ ‡è®°-æ¸…é™¤         Region-based å¹¶å‘</span><br><span class="line">      æ ‡è®°-æ•´ç†             SATB / ä¸‰è‰²æ ‡è®°</span><br></pre></td></tr></table></figure><h4 id="ä»€ä¹ˆæ˜¯-STWï¼ˆStop-The-Worldï¼‰">ä»€ä¹ˆæ˜¯ STWï¼ˆStop-The-Worldï¼‰</h4><ul class="lvl-0"><li class="lvl-2"><p>STWï¼ˆStop-The-Worldï¼‰ æŒ‡çš„æ˜¯ï¼šåœ¨æŸäº›åƒåœ¾å›æ”¶é˜¶æ®µï¼ŒJVM ä¼šæš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ï¼ˆä¹Ÿå«ç”¨æˆ·çº¿ç¨‹ï¼‰ï¼Œè®©åƒåœ¾å›æ”¶çº¿ç¨‹ç‹¬å  CPU æ‰§è¡Œ GC é€»è¾‘ã€‚</p></li><li class="lvl-2"><p>ä½ å¯ä»¥è¿™æ ·ç†è§£ STW</p><ul class="lvl-2"><li class="lvl-6">JVM ä¼šâ€œæŒ‰ä¸‹æš‚åœé”®â€æš‚åœæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Java ç¨‹åºä»£ç ï¼›</li><li class="lvl-6">ç„¶å ä¸“å¿ƒè¿›è¡Œ GC çš„æŸäº›é˜¶æ®µï¼ˆå¦‚æ ‡è®°ã€æ•´ç†ã€å¤åˆ¶ç­‰ï¼‰ï¼›</li><li class="lvl-6">GC å®Œæˆåï¼Œæ‰ä¼šâ€œæ¢å¤è¿è¡Œâ€åº”ç”¨çº¿ç¨‹ã€‚</li></ul></li><li class="lvl-2"><p>å„ GC ä¸­ STW çš„å­˜åœ¨æƒ…å†µ</p></li></ul><table><thead><tr><th>å›æ”¶å™¨</th><th>æ˜¯å¦å­˜åœ¨ STWï¼Ÿ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Serial</td><td>âœ… æ˜¯ï¼Œå…¨åœé¡¿ï¼Œå…¨é˜¶æ®µå•çº¿ç¨‹</td><td>å †è¶Šå¤§ STW è¶Šé•¿</td></tr><tr><td>Parallel</td><td>âœ… æ˜¯ï¼Œå…¨åœé¡¿ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œ GC</td><td>æé«˜æ•ˆç‡ä½†ä»ä¼šæš‚åœ</td></tr><tr><td>CMS</td><td>âœ… æœ‰ï¼Œåˆå§‹æ ‡è®°å’Œæœ€ç»ˆé‡æ–°æ ‡è®°æ˜¯ STW</td><td>å¤§éƒ¨åˆ†é˜¶æ®µå¹¶å‘æ‰§è¡Œ</td></tr><tr><td>G1</td><td>âœ… æœ‰ï¼Œä½†è®¾è®¡ä¸ºå°½å¯èƒ½ç¼©çŸ­ STW</td><td>åˆ†é˜¶æ®µå¹¶å‘ + å¹¶è¡Œå¤„ç†</td></tr><tr><td>ZGC</td><td>âœ… æçŸ­ï¼ˆ&lt;10msï¼‰</td><td>ä»…ä¸ªåˆ«é˜¶æ®µæ˜¯ STWï¼Œå‡ ä¹æ„ŸçŸ¥ä¸åˆ°</td></tr><tr><td>Shenandoah</td><td>âœ… æçŸ­</td><td>é«˜åº¦å¹¶å‘ï¼ŒSTW æ—¶é—´ä¹ŸæçŸ­</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºä»€ä¹ˆè¦å…³æ³¨ STWï¼Ÿ</p><ul class="lvl-2"><li class="lvl-6">åœ¨å“åº”æ—¶é—´æ•æ„Ÿå‹ç³»ç»Ÿï¼ˆå¦‚åœ¨çº¿äº¤æ˜“ç³»ç»Ÿã€æ¸¸æˆæœåŠ¡å™¨ã€API ç½‘å…³ï¼‰ä¸­ï¼Œé•¿æ—¶é—´çš„ STW ä¼šé€ æˆç”¨æˆ·è¯·æ±‚å¡é¡¿ã€è¶…æ—¶ã€‚</li><li class="lvl-6">å› æ­¤ï¼Œé€‰æ‹© ä½ STW çš„ GCï¼ˆå¦‚ G1ã€ZGCã€Shenandoahï¼‰ å¯¹è¿™ç±»ç³»ç»Ÿè‡³å…³é‡è¦ã€‚</li></ul></li></ul><h2 id="å †å†…å­˜ç»“æ„">å †å†…å­˜ç»“æ„</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸åŒçš„åƒåœ¾å›æ”¶å™¨å†³å®šäº†å †å†…å­˜çš„ç»“æ„ä¸åŒï¼Œä½†æ€»ä½“ä¸Šåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šåˆ†ä»£æ¨¡å‹å’Œåˆ†åŒºæ¨¡å‹ã€‚</p></li></ul><h3 id="åˆ†ä»£æ¨¡å‹">åˆ†ä»£æ¨¡å‹</h3><h4 id="Parallel-åƒåœ¾å›æ”¶å™¨">Parallel åƒåœ¾å›æ”¶å™¨</h4><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/Apr5aY.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>å †ç»“æ„è¢«åˆ’åˆ†ä¸º <code>Old Generationï¼ˆè€å¹´ä»£ï¼‰</code> å’Œ <code>Young Generationï¼ˆæ–°ç”Ÿä»£ï¼‰</code> ä¸¤éƒ¨åˆ†ã€‚</p></li><li class="lvl-2"><p><code>Young Generation</code> ç”± <code>Eden</code> å’Œ ä¸¤ä¸ª <code>Survivor</code> ç»„æˆï¼Œå…¶ä¸­ <code>Eden</code> æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œ<code>Survivor</code> æ˜¯ä¸€ä¸ªéè¿ç»­çš„å†…å­˜åŒºåŸŸã€‚</p></li><li class="lvl-2"><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Young Generation</code>å å †å†…å­˜çš„ <code>1/3</code>,  <code>Old Generation</code> å å †å†…å­˜çš„ <code>2/3</code>ã€‚</p></li><li class="lvl-2"><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Eden:S0:S1 = 8:1:1</code> ,å¦‚æœå¸Œæœ›ä¸º 4:1:1ï¼Œä½¿ç”¨ <code>-XX:SurvivorRatio=4</code>ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªæ¯”ä¾‹å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯ç”±jvmåŸºäºæƒ…å†µè‡ªåŠ¨å˜åŒ–çš„ï¼Œå› ä¸ºJVMé»˜è®¤å¼€å¯äº†è¿™ä¸ªå‚æ•°<code>-XX:+UseAdaptiveSizePolicy</code>ï¼Œå¦‚æœå¸Œæœ›å›ºå®šè¿™ä¸ªæ¯”ä¾‹ï¼Œå¯ä»¥è®¾ç½®ä¸º <code>-XX:-UseAdaptiveSizePolicy</code>æ¥å…³é—­è¿™ä¸ªé…ç½®ã€‚</p></li><li class="lvl-2"><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹è±¡æœ€å¤šç»å†<code>15æ¬¡</code>Minor GCåè¿›å…¥è€å¹´ä»£ï¼Œå¯ä»¥é€šè¿‡ <code>-XX:MaxTenuringThreshold=n</code> è®¾ç½®ã€‚</p></li></ul><table><thead><tr><th>åŒºåŸŸ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Eden</strong></td><td>å¯¹è±¡é¦–æ¬¡åˆ›å»ºçš„åŒºåŸŸï¼Œå¤§éƒ¨åˆ†å¯¹è±¡åœ¨è¿™é‡Œåˆ›å»ºå¹¶å¾ˆå¿«è¢«å›æ”¶</td></tr><tr><td><strong>S0/S1</strong></td><td>Survivor åŒºåŸŸï¼šä¸¤ä¸ªäº¤æ›¿ä½¿ç”¨çš„ç¼“å†²åŒºï¼ˆFrom å’Œ Toï¼‰ï¼Œç”¨äºæ‹·è´å­˜æ´»å¯¹è±¡</td></tr><tr><td><strong>Old</strong></td><td>è€å¹´ä»£ï¼šå­˜æ´»æ¬¡æ•°å¤šã€ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡ä¼šä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå›æ”¶é¢‘ç‡ä½</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¯¹è±¡å†…å­˜åˆ†é…å›¾è§£(ç®€åŒ–)</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºå¯¹è±¡</span><br><span class="line">   â†“</span><br><span class="line">è¿›å…¥ Eden åŒºï¼ˆæ–°ç”Ÿä»£ï¼‰</span><br><span class="line">   â†“ Eden åŒºæ»¡</span><br><span class="line">ç¬¬ä¸€æ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Eden]å¤åˆ¶åˆ° S0ï¼‰</span><br><span class="line">   â†“ Eden åŒºæ»¡ æˆ– S0 åŒºæ»¡</span><br><span class="line">ç¬¬äºŒæ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Edenå’ŒS0]å¤åˆ¶åˆ° S1ï¼Œå¹´é¾„ +1ï¼‰</span><br><span class="line">   â†“ Eden åŒºæ»¡ æˆ– S1 åŒºæ»¡</span><br><span class="line">ç¬¬ä¸‰æ¬¡ Minor GCï¼ˆå­˜æ´»å¯¹è±¡[Edenå’ŒS1]å¤åˆ¶åˆ° S0ï¼Œå¹´é¾„ +1ï¼‰</span><br><span class="line">   â†“</span><br><span class="line">â€¦â€¦  S0/S1 äº¤æ›¿ï¼Œå¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆå¦‚ 15ï¼‰</span><br><span class="line">   â†“ è¿˜æ²¡æœ‰è¢«å›æ”¶</span><br><span class="line">æ™‹å‡åˆ° Old åŒºï¼ˆè€å¹´ä»£ï¼‰ï¼Œç­‰å¾…OldåŒºæ»¡ è§¦å‘ Full GC</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</p></li></ul><blockquote><p>å¤§å¯¹è±¡å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ï¼Œå¦‚æœå¯¹è±¡å¾ˆå¤§ï¼ˆå¦‚è¶…è¿‡ Eden åŒºå¤§å°ï¼Œæˆ–æ˜¯è¶…è¿‡ Survivor åŒºå¤§å°ï¼‰ï¼Œå¯èƒ½ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£<br>ä¹Ÿå¯ä»¥é€šè¿‡ <code>-XX:PretenureSizeThreshold=&lt;å¤§å°ï¼Œå•ä½å­—èŠ‚&gt;</code> æ§åˆ¶è¶…è¿‡ä¸€å®šå¤§å°çš„å¯¹è±¡æ˜¯å¦ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼Œè·³è¿‡æ–°ç”Ÿä»£ï¼ˆEdenï¼‰ï¼Œä»¥é¿å…å¤§å¯¹è±¡é¢‘ç¹åœ¨å¹´è½»ä»£é€ æˆ GC å‹åŠ›ã€‚è¿™ä¸ªå‚æ•°åªåœ¨ Serial å’ŒParNewä¸¤ä¸ªæ”¶é›†å™¨ä¸‹æœ‰æ•ˆã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­</p></li></ul><blockquote><p>å¯¹è±¡åœ¨SurvivoråŒºæ¥å›ç§»åŠ¨æ—¶ï¼Œå¦‚æœè¿™æ‰¹å¯¹è±¡çš„æ€»å¤§å°å¤§äºè¿™å—SurvivoråŒºåŸŸå†…å­˜å¤§å°çš„50%(-XX:TargetSurvivorRatioå¯ä»¥æŒ‡å®š)ï¼Œé‚£ä¹ˆæ­¤æ—¶å¤§äºç­‰äºè¿™æ‰¹å¯¹è±¡å¹´é¾„æœ€å¤§å€¼çš„å¯¹è±¡ï¼Œå°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£äº†ï¼Œ<br>ä¾‹å¦‚SurvivoråŒºåŸŸé‡Œç°åœ¨æœ‰ä¸€æ‰¹å¯¹è±¡ï¼Œå¹´é¾„1+å¹´é¾„2+å¹´é¾„nçš„å¤šä¸ªå¹´é¾„å¯¹è±¡æ€»å’Œè¶…è¿‡äº†SurvivoråŒºåŸŸçš„50%ï¼Œæ­¤æ—¶å°±ä¼šæŠŠå¹´é¾„n(å«)ä»¥ä¸Šçš„å¯¹è±¡éƒ½æ”¾å…¥è€å¹´ä»£ã€‚è¿™ä¸ªè§„åˆ™å…¶å®æ˜¯å¸Œæœ›é‚£äº›å¯èƒ½æ˜¯é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œå°½æ—©è¿›å…¥è€å¹´ä»£ã€‚<br>å¯¹è±¡åŠ¨æ€å¹´é¾„åˆ¤æ–­æœºåˆ¶ä¸€èˆ¬æ˜¯åœ¨minor gcä¹‹åè§¦å‘çš„ã€‚</p></blockquote><div class="tips"><ul class="lvl-1"><li class="lvl-2"><p>å¯¹è±¡é€ƒé€¸åˆ†æ</p></li></ul><blockquote><p>å¦‚æœå¯¹è±¡å¾ˆå°ï¼Œä¸”åªåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰è¢«å¤–éƒ¨å¼•ç”¨ï¼Œåˆ™å…¶æœ‰å¯èƒ½ç›´æ¥åˆ†é…åˆ°æ ˆå†…å­˜ï¼Œè€Œä¸è¿›å…¥å †å†…å­˜<br>JVMå¯¹äºè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å¼€å¯é€ƒé€¸åˆ†æå‚æ•°(-XX:+DoEscapeAnalysis)æ¥ä¼˜åŒ–å¯¹è±¡å†…å­˜åˆ†é…ä½ç½®ï¼Œä½¿å…¶é€šè¿‡<code>æ ‡é‡æ›¿æ¢</code>ä¼˜å…ˆåˆ†é…åœ¨æ ˆä¸Š(æ ˆä¸Šåˆ†é…)ï¼ŒJDK7ä¹‹åé»˜è®¤å¼€å¯é€ƒé€¸åˆ†æï¼Œå¦‚æœè¦å…³é—­ä½¿ç”¨å‚æ•°(-XX:-DoEscapeAnalysis)</p></blockquote><ul class="lvl-1"><li class="lvl-2">æ ‡é‡æ›¿æ¢</li></ul><blockquote><p>é€šè¿‡é€ƒé€¸åˆ†æç¡®å®šè¯¥å¯¹è±¡ä¸ä¼šè¢«å¤–éƒ¨è®¿é—®ï¼Œå¹¶ä¸”å¯¹è±¡å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æ—¶ï¼ŒJVMä¸ä¼šåˆ›å»ºè¯¥å¯¹è±¡ï¼Œè€Œæ˜¯å°†è¯¥å¯¹è±¡æˆå‘˜å˜é‡åˆ†è§£è‹¥å¹²ä¸ªè¢«è¿™ä¸ªæ–¹æ³•ä½¿ç”¨çš„æˆå‘˜å˜é‡æ‰€ä»£æ›¿ï¼Œè¿™äº›ä»£æ›¿çš„æˆå‘˜å˜é‡åœ¨æ ˆå¸§æˆ–å¯„å­˜å™¨ä¸Šåˆ†é…ç©ºé—´ï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºæ²¡æœ‰ä¸€å¤§å—è¿ç»­ç©ºé—´å¯¼è‡´å¯¹è±¡å†…å­˜ä¸å¤Ÿåˆ†é…ã€‚<br>å¼€å¯æ ‡é‡æ›¿æ¢å‚æ•°(-XX:+EliminateAllocations)ï¼ŒJDK7ä¹‹åé»˜è®¤å¼€å¯ã€‚</p></blockquote><ul class="lvl-1"><li class="lvl-2">æ ‡é‡ä¸èšåˆé‡</li></ul><blockquote><p>æ ‡é‡å³ä¸å¯è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€ŒJAVAçš„åŸºæœ¬æ•°æ®ç±»å‹å°±æ˜¯æ ‡é‡ï¼ˆå¦‚ï¼šintï¼Œlongç­‰åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠreferenceç±»å‹ç­‰ï¼‰ï¼Œ<br>æ ‡é‡çš„å¯¹ç«‹å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡ï¼Œè€Œè¿™ç§é‡ç§°ä¹‹ä¸ºèšåˆé‡ã€‚è€Œåœ¨JAVAä¸­å¯¹è±¡å°±æ˜¯å¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£çš„èšåˆé‡ã€‚</p></blockquote></div><h4 id="Parallel-GC-å‚æ•°é…ç½®è¡¨ï¼ˆååé‡ä¼˜å…ˆ-GCï¼‰">Parallel GC å‚æ•°é…ç½®è¡¨ï¼ˆååé‡ä¼˜å…ˆ GCï¼‰</h4><table><thead><tr><th>å‚æ•°å</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼ï¼ˆå¦‚æœªç‰¹åˆ«è¯´æ˜ï¼‰</th></tr></thead><tbody><tr><td><code>-XX:+UseParallelGC</code></td><td>å¼€å¯ Parallel GCï¼Œç”¨äºæ–°ç”Ÿä»£æ”¶é›†</td><td>-</td></tr><tr><td><code>-XX:+UseParallelOldGC</code></td><td>å¼€å¯è€å¹´ä»£å¹¶è¡Œæ”¶é›†ï¼ˆParallel Oldï¼‰</td><td>-</td></tr><tr><td><code>-XX:ParallelGCThreads</code></td><td>åƒåœ¾å›æ”¶æ—¶çš„å¹¶è¡Œçº¿ç¨‹æ•°ï¼ˆä¸ CPU æ•°é‡ç›¸å…³ï¼‰</td><td>æ ¹æ®ç¡¬ä»¶è‡ªåŠ¨é…ç½®</td></tr><tr><td><code>-XX:MaxGCPauseMillis</code></td><td>è®¾ç½® GC æœ€å¤§æš‚åœæ—¶é—´ç›®æ ‡ï¼ˆå½±å“å†…å­˜åˆ†é…ç­–ç•¥ï¼‰</td><td>æ— é»˜è®¤é™åˆ¶ï¼ˆå»ºè®®æŒ‰éœ€è®¾ç½®ï¼‰</td></tr><tr><td><code>-XX:GCTimeRatio</code></td><td>è®¾ç½® GC æ—¶é—´ä¸åº”ç”¨è¿è¡Œæ—¶é—´çš„æ¯”å€¼ï¼ˆ0~100ï¼‰<br>å€¼è¶Šå°ï¼ŒGC è¶Šé¢‘ç¹ï¼Œå€¼è¶Šå¤§ GC è¶Šå°‘</td><td>99ï¼ˆè¡¨ç¤º 1% ç”¨äº GCï¼Œ99% ç”¨äºåº”ç”¨ï¼‰</td></tr><tr><td><code>-XX:+UseAdaptiveSizePolicy</code></td><td>å¯ç”¨è‡ªé€‚åº” GC ç­–ç•¥ï¼ˆæ ¹æ®è¿è¡ŒçŠ¶å†µè‡ªåŠ¨è°ƒæ•´å„åŒºåŸŸå¤§å°ï¼‰</td><td>é»˜è®¤å¼€å¯</td></tr><tr><td><code>-XX:SurvivorRatio</code></td><td>Eden ä¸ Survivor çš„å†…å­˜æ¯”ä¾‹ï¼ˆå¦‚ 8 è¡¨ç¤º Eden:S0:S1 = 8:1:1ï¼‰</td><td>8</td></tr><tr><td><code>-XX:InitialTenuringThreshold</code></td><td>å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„åˆå§‹å¹´é¾„ï¼ˆä¼šéšè¿è¡ŒåŠ¨æ€è°ƒæ•´ï¼‰</td><td>7</td></tr><tr><td><code>-XX:MaxTenuringThreshold</code></td><td>æ™‹å‡åˆ°è€å¹´ä»£çš„æœ€å¤§å¹´é¾„ï¼ˆå¯¹è±¡åœ¨ Survivor åŒºç»å†å‡ æ¬¡ GCï¼‰</td><td>15</td></tr><tr><td><code>-XX:PretenureSizeThreshold</code></td><td>è®¾ç½®å¤§å¯¹è±¡é˜ˆå€¼ï¼Œè¶…è¿‡è¯¥å¤§å°çš„å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£</td><td>0ï¼ˆå³ç¦ç”¨ï¼‰</td></tr><tr><td><code>-XX:+ScavengeBeforeFullGC</code></td><td>åœ¨ Full GC ä¹‹å‰æ˜¯å¦å…ˆæ‰§è¡Œä¸€æ¬¡ Minor GC</td><td>å¼€å¯</td></tr><tr><td><code>-XX:+UseFastAccessorMethods</code></td><td>ä¼˜åŒ–åŸå§‹ç±»å‹çš„ get/set æ–¹æ³•æ€§èƒ½</td><td>å¼€å¯</td></tr><tr><td><code>-XX:+AlwaysPreTouch</code></td><td>JVM å¯åŠ¨æ—¶ç«‹å³åˆ†é…å¹¶åˆå§‹åŒ–æ‰€æœ‰å†…å­˜é¡µï¼Œé¿å…è¿è¡Œæ—¶é¦–æ¬¡åˆ†é…å¸¦æ¥çš„åœé¡¿</td><td>å…³é—­</td></tr></tbody></table><h3 id="åˆ†åŒºæ¨¡å‹">åˆ†åŒºæ¨¡å‹</h3><h4 id="G1-åƒåœ¾å›æ”¶å™¨">G1 åƒåœ¾å›æ”¶å™¨</h4><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/AaqBxm.png" alt="" width="900" height="300"></p><ul class="lvl-0"><li class="lvl-2"><p>G1(Garbage-First) å±äº ç‰©ç†ä¸Šåˆ†åŒºï¼Œé€»è¾‘ä¸Šåˆ†ä»£ï¼ŒçœŸæ­£çš„åˆ†åŒºæ¨¡å‹æ˜¯ <code>ZGC</code>ï¼ˆjdk21åä¹Ÿæ”¯æŒåˆ†ä»£ï¼‰</p></li><li class="lvl-2"><p>G1å°†Javaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼ŒJVMæœ€å¤šå¯ä»¥æœ‰<code>2048</code>ä¸ªRegionã€‚</p></li><li class="lvl-2"><p>ä¸€èˆ¬Regionå¤§å°ç­‰äºå †å¤§å°é™¤ä»¥2048ï¼Œæ¯”å¦‚å †å¤§å°ä¸º4096Mï¼Œåˆ™Regionå¤§å°ä¸º2Mï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å‚æ•°<code>-XX:G1HeapRegionSize</code>æ‰‹åŠ¨æŒ‡å®šRegionå¤§å°ï¼Œä½†æ˜¯æ¨èé»˜è®¤çš„è®¡ç®—æ–¹å¼ã€‚</p></li><li class="lvl-2"><p>G1ä¿ç•™äº†å¹´è½»ä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†ä¸å†æ˜¯ç‰©ç†éš”é˜‚äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ï¼ˆå¯ä»¥ä¸è¿ç»­ï¼‰Regionçš„é›†åˆã€‚</p></li><li class="lvl-2"><p>é»˜è®¤å¹´è½»ä»£å¯¹å †å†…å­˜çš„å æ¯”æ˜¯<code>5%</code>ï¼Œå¦‚æœå †å¤§å°ä¸º4096Mï¼Œé‚£ä¹ˆå¹´è½»ä»£å æ®200MBå·¦å³çš„å†…å­˜ï¼Œå¯¹åº”å¤§æ¦‚æ˜¯100ä¸ªRegionï¼Œå¯ä»¥é€šè¿‡   <code>-XX:G1NewSizePercent</code>è®¾ç½®æ–°ç”Ÿä»£åˆå§‹å æ¯”</p></li><li class="lvl-2"><p>åœ¨ç³»ç»Ÿè¿è¡Œä¸­ï¼ŒJVMä¼šä¸åœçš„ç»™å¹´è½»ä»£å¢åŠ æ›´å¤šçš„Regionï¼Œä½†æ˜¯æœ€å¤šæ–°ç”Ÿä»£çš„å æ¯”ä¸ä¼šè¶…è¿‡<code>60%</code>ï¼Œå¯ä»¥é€šè¿‡<code>-XX:G1MaxNewSizePercent</code>è°ƒæ•´ã€‚</p></li><li class="lvl-2"><p>å¹´è½»ä»£ä¸­çš„Edenå’ŒSurvivorå¯¹åº”çš„regionä¹Ÿè·Ÿä¹‹å‰ä¸€æ ·ï¼Œé»˜è®¤<code>8:1:1</code>ï¼Œå‡è®¾å¹´è½»ä»£ç°åœ¨æœ‰1000ä¸ªregionï¼ŒedenåŒºå¯¹åº”800ä¸ªï¼Œs0å¯¹åº”100ä¸ªï¼Œs1å¯¹åº”100ä¸ªã€‚</p></li><li class="lvl-2"><p>ä¸€ä¸ªRegionå¯èƒ½ä¹‹å‰æ˜¯å¹´è½»ä»£ï¼Œå¦‚æœRegionè¿›è¡Œäº†åƒåœ¾å›æ”¶ï¼Œä¹‹åå¯èƒ½åˆä¼šå˜æˆè€å¹´ä»£ï¼Œä¹Ÿå°±æ˜¯è¯´Regionçš„åŒºåŸŸåŠŸèƒ½å¯èƒ½ä¼šåŠ¨æ€å˜åŒ–ã€‚</p></li><li class="lvl-2"><p>G1åƒåœ¾æ”¶é›†å™¨å¯¹äºå¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè½¬ç§»åˆ°è€å¹´ä»£è·Ÿä¹‹å‰è®²è¿‡çš„åŸåˆ™ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å¯¹å¤§å¯¹è±¡çš„å¤„ç†ï¼ŒG1æœ‰ä¸“é—¨åˆ†é…å¤§å¯¹è±¡çš„Regionå«<code>Humongous</code>åŒºï¼Œè€Œä¸æ˜¯è®©å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„Regionä¸­ã€‚</p></li><li class="lvl-2"><p>åœ¨G1ä¸­ï¼Œå¤§å¯¹è±¡çš„åˆ¤å®šè§„åˆ™å°±æ˜¯ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†ä¸€ä¸ªRegionå¤§å°çš„<code>50%</code>ï¼Œæ¯”å¦‚æŒ‰ç…§ä¸Šé¢ç®—çš„ï¼Œæ¯ä¸ªRegionæ˜¯2Mï¼Œåªè¦ä¸€ä¸ªå¤§å¯¹è±¡è¶…è¿‡äº†1Mï¼Œå°±ä¼šè¢«æ”¾å…¥Humongousä¸­ï¼Œè€Œä¸”ä¸€ä¸ªå¤§å¯¹è±¡å¦‚æœå¤ªå¤§ï¼Œå¯èƒ½ä¼šæ¨ªè·¨å¤šä¸ªRegionæ¥å­˜æ”¾ã€‚</p></li><li class="lvl-2"><p>HumongousåŒºä¸“é—¨å­˜æ”¾çŸ­æœŸå·¨å‹å¯¹è±¡ï¼Œä¸ç”¨ç›´æ¥è¿›è€å¹´ä»£ï¼Œå¯ä»¥èŠ‚çº¦è€å¹´ä»£çš„ç©ºé—´ï¼Œé¿å…å› ä¸ºè€å¹´ä»£ç©ºé—´ä¸å¤Ÿçš„GCå¼€é”€ã€‚</p></li><li class="lvl-2"><p>Full GCçš„æ—¶å€™é™¤äº†æ”¶é›†å¹´è½»ä»£å’Œè€å¹´ä»£ä¹‹å¤–ï¼Œä¹Ÿä¼šå°†HumongousåŒºä¸€å¹¶å›æ”¶ã€‚</p></li></ul><h5 id="G1åƒåœ¾æ”¶é›†åˆ†ç±»">G1åƒåœ¾æ”¶é›†åˆ†ç±»</h5><ul class="lvl-0"><li class="lvl-2"><p>YoungGC<br>YoungGCå¹¶ä¸æ˜¯è¯´ç°æœ‰çš„EdenåŒºæ”¾æ»¡äº†å°±ä¼šé©¬ä¸Šè§¦å‘ï¼ŒG1ä¼šè®¡ç®—ä¸‹ç°åœ¨EdenåŒºå›æ”¶å¤§æ¦‚è¦å¤šä¹…æ—¶é—´ï¼Œå¦‚æœå›æ”¶æ—¶é—´è¿œè¿œå°äºå‚æ•° <code>-XX:MaxGCPauseMills</code> è®¾å®šçš„å€¼ï¼Œé‚£ä¹ˆå¢åŠ å¹´è½»ä»£çš„regionï¼Œç»§ç»­ç»™æ–°å¯¹è±¡å­˜æ”¾ï¼Œä¸ä¼šé©¬ä¸ŠåšYoungGCï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡EdenåŒºæ”¾æ»¡ï¼ŒG1è®¡ç®—å›æ”¶æ—¶é—´æ¥è¿‘å‚æ•° <code>-XX:MaxGCPauseMills</code> è®¾å®šçš„å€¼ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘Young GC</p></li><li class="lvl-2"><p>MixedGC<br>ä¸æ˜¯FullGCï¼Œè€å¹´ä»£çš„å †å æœ‰ç‡è¾¾åˆ°å‚æ•° <code>-XX:InitiatingHeapOccupancyPercent</code> è®¾å®šçš„å€¼åˆ™è§¦å‘ï¼Œå›æ”¶æ‰€æœ‰çš„Youngå’Œéƒ¨åˆ†Old(æ ¹æ®æœŸæœ›çš„GCåœé¡¿æ—¶é—´ç¡®å®šoldåŒºåƒåœ¾æ”¶é›†çš„ä¼˜å…ˆé¡ºåº)ä»¥åŠå¤§å¯¹è±¡åŒºï¼Œæ­£å¸¸æƒ…å†µG1çš„åƒåœ¾æ”¶é›†æ˜¯å…ˆåšMixedGCï¼Œä¸»è¦ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œéœ€è¦æŠŠå„ä¸ªregionä¸­å­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°åˆ«çš„regioné‡Œå»ï¼Œæ‹·è´è¿‡ç¨‹ä¸­å¦‚æœå‘ç°æ²¡æœ‰è¶³å¤Ÿçš„ç©ºregionèƒ½å¤Ÿæ‰¿è½½æ‹·è´å¯¹è±¡å°±ä¼šè§¦å‘ä¸€æ¬¡Full GC</p></li><li class="lvl-2"><p>Full GC<br>åœæ­¢ç³»ç»Ÿç¨‹åºï¼Œç„¶åé‡‡ç”¨å•çº¿ç¨‹è¿›è¡Œæ ‡è®°ã€æ¸…ç†å’Œå‹ç¼©æ•´ç†ï¼Œå¥½ç©ºé—²å‡ºæ¥ä¸€æ‰¹Regionæ¥ä¾›ä¸‹ä¸€æ¬¡MixedGCä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸è€—æ—¶çš„ã€‚(Shenandoahä¼˜åŒ–æˆå¤šçº¿ç¨‹æ”¶é›†äº†)</p></li></ul><h5 id="G1-æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨">G1 æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨</h5><table><thead><tr><th>å‚æ•°å</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>-XX:+UseG1GC</code></td><td>ä½¿ç”¨ G1 åƒåœ¾æ”¶é›†å™¨</td><td>-</td></tr><tr><td><code>-XX:ParallelGCThreads</code></td><td>æŒ‡å®š GC å·¥ä½œçš„çº¿ç¨‹æ•°é‡</td><td>ä¸ CPU æ•°é‡ç›¸å…³</td></tr><tr><td><code>-XX:G1HeapRegionSize</code></td><td>è®¾ç½®å †åˆ†åŒºå¤§å°ï¼ˆ1MB~32MBï¼Œ2 çš„å¹‚ï¼‰ï¼Œå †é»˜è®¤åˆ’åˆ†ä¸º 2048 ä¸ª Region</td><td>è‡ªåŠ¨è®¡ç®—</td></tr><tr><td><code>-XX:MaxGCPauseMillis</code></td><td>è®¾ç½® GC ç›®æ ‡æœ€å¤§æš‚åœæ—¶é—´</td><td>200ms</td></tr><tr><td><code>-XX:G1NewSizePercent</code></td><td>æ–°ç”Ÿä»£åˆå§‹å æ¯”ï¼ˆå æ•´ä¸ªå †ï¼‰</td><td>5%</td></tr><tr><td><code>-XX:G1MaxNewSizePercent</code></td><td>æ–°ç”Ÿä»£æœ€å¤§å æ¯”ï¼ˆå æ•´ä¸ªå †ï¼‰</td><td>60%</td></tr><tr><td><code>-XX:TargetSurvivorRatio</code></td><td>Survivor åŒºå¡«å……ç›®æ ‡ï¼ˆè¶…è¿‡è¯¥æ¯”ä¾‹ï¼Œæ™‹å‡è€å¹´ä»£ï¼‰</td><td>50%</td></tr><tr><td><code>-XX:MaxTenuringThreshold</code></td><td>æœ€å¤§å¯¹è±¡å¹´é¾„é˜ˆå€¼ï¼ˆå¹´é¾„è¶…è¿‡å°†è¿›å…¥è€å¹´ä»£ï¼‰</td><td>15</td></tr><tr><td><code>-XX:InitiatingHeapOccupancyPercent</code></td><td>è€å¹´ä»£ä½¿ç”¨ç‡è¶…è¿‡è¯¥å€¼è§¦å‘ Mixed GC</td><td>45%</td></tr><tr><td><code>-XX:G1MixedGCLiveThresholdPercent</code></td><td>Mixed GC ä¸­ï¼šRegion å­˜æ´»å¯¹è±¡å æ¯”ä½äºè¯¥å€¼æ‰ä¼šè¢«å›æ”¶</td><td>85%</td></tr><tr><td><code>-XX:G1MixedGCCountTarget</code></td><td>æ¯æ¬¡ Mixed GC çš„æœ€å¤§å›æ”¶è½®æ¬¡</td><td>8</td></tr><tr><td><code>-XX:G1HeapWastePercent</code></td><td>Mixed GC å›æ”¶ç›®æ ‡ï¼šç©ºé—² Region è¾¾å †æ€»é‡è¯¥ç™¾åˆ†æ¯”å°±ç»“æŸæ··åˆå›æ”¶</td><td>5%</td></tr></tbody></table><h4 id="ZGC-åƒåœ¾å›æ”¶å™¨">ZGC åƒåœ¾å›æ”¶å™¨</h4><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/bBUAYt.png" alt="" width="700" height="500"></p><ul class="lvl-0"><li class="lvl-2"><p>ZGC(Z Garbage Collector)æ˜¯ä¸€æ¬¾JDK 11ä¸­æ–°åŠ å…¥çš„å…·æœ‰å®éªŒæ€§è´¨çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨ï¼ŒZGCå¯ä»¥è¯´æºè‡ªäºæ˜¯Azul Systemå…¬å¸å¼€å‘çš„C4ï¼ˆConcurrent Continuously Compacting Collectorï¼‰ æ”¶é›†å™¨</p></li></ul><table><thead><tr><th>Platform</th><th>Supported</th><th>Since</th><th>Comment</th></tr></thead><tbody><tr><td>Linux/x64</td><td>âœ…</td><td>JDK 11</td><td></td></tr><tr><td>Linux/AArch64</td><td>âœ…</td><td>JDK 13</td><td></td></tr><tr><td>macOS</td><td>âœ…</td><td>JDK 14</td><td></td></tr><tr><td>Windows</td><td>âœ…</td><td>JDK 14</td><td>Requires Windows version 1803 (Windows 10 or Windows Server 2019) or later.</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ZGCæ”¶é›†å™¨æ˜¯ä¸€æ¬¾åŸºäºRegionå†…å­˜å¸ƒå±€çš„ï¼Œæš‚æ—¶ä¸è®¾åˆ†ä»£çš„(jdk21åæ”¯æŒåˆ†ä»£)ï¼Œä½¿ç”¨äº†<code>è¯»å±éšœ</code>ã€<code>é¢œè‰²æŒ‡é’ˆ</code>ç­‰æŠ€æœ¯æ¥å®ç°å¯å¹¶å‘çš„æ ‡è®°-æ•´ç†ç®—æ³•çš„ï¼Œä»¥ä½å»¶è¿Ÿä¸ºé¦–è¦ç›®æ ‡çš„ä¸€æ¬¾åƒåœ¾æ”¶é›†å™¨ã€‚</p></li></ul><div class="tips"><p><em><strong>é¢œè‰²æŒ‡é’ˆ</strong></em></p><ul class="lvl-1"><li class="lvl-2">åœ¨ ZGCï¼ˆZ Garbage Collectorï¼‰ä¸­ï¼Œé¢œè‰²æŒ‡é’ˆï¼ˆColored Pointerï¼‰æ˜¯ä¸€ç§æ ¸å¿ƒæœºåˆ¶ï¼ŒæŠŠå¯¹è±¡çš„ GC çŠ¶æ€ä¿¡æ¯ç›´æ¥åµŒå…¥åˆ°å¯¹è±¡çš„å¼•ç”¨ï¼ˆåœ°å€ï¼‰ä¸­ï¼Œç”¨äºåœ¨ä¸å¢åŠ å¯¹è±¡é¢å¤–å…ƒæ•°æ®çš„å‰æä¸‹ï¼Œè·Ÿè¸ªå¯¹è±¡åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­çš„çŠ¶æ€ã€‚</li><li class="lvl-2">åœ¨ä¼ ç»Ÿ GC ä¸­ï¼Œå¯¹è±¡çš„â€œé¢œè‰²â€ï¼ˆå¦‚ç™½è‰²ã€ç°è‰²ã€é»‘è‰²ï¼‰è¡¨ç¤ºå…¶åœ¨ GC ä¸åŒé˜¶æ®µçš„çŠ¶æ€ï¼Œè¿™äº›ä¿¡æ¯ä¸€èˆ¬å­˜å‚¨åœ¨é¢å¤–çš„æ•°æ®ç»“æ„ä¸­ï¼ˆå¦‚è®°å¿†é›†åˆã€ä½å›¾ç­‰ï¼‰ã€‚</li><li class="lvl-2">è€Œåœ¨ ZGC ä¸­ï¼ŒZGC å°†å¯¹è±¡çš„è¿™äº›çŠ¶æ€ä¿¡æ¯ç¼–ç è¿›æŒ‡é’ˆçš„é«˜ä½ä¸­ã€‚æ‰€ä»¥ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼ˆpointerï¼‰ä¸ä»…ä»…æ˜¯å†…å­˜åœ°å€ï¼Œè¿˜æºå¸¦äº†å¯¹è±¡åœ¨ GC è¿‡ç¨‹ä¸­çš„â€œé¢œè‰²â€ä¿¡æ¯ã€‚</li><li class="lvl-2">ZGC ä¸»è¦è¿è¡Œåœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼Œä½†å½“å‰çš„æ“ä½œç³»ç»Ÿå’Œ CPU å®é™…ä¸Šåªä½¿ç”¨ 48ï½57 ä½è™šæ‹Ÿåœ°å€ã€‚ZGC åˆ©ç”¨æœªä½¿ç”¨çš„é«˜ä½è¿›è¡Œç¼–ç ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/LD51Zb.png" alt="" width="900" height="300"></li><li class="lvl-2">æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ª64ä½æŒ‡é’ˆï¼Œè¿™64ä½è¢«åˆ†ä¸ºï¼š</li></ul><table><thead><tr><th>ä½æ•°</th><th>åç§°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>18 ä½</td><td>é¢„ç•™</td><td>ä¿ç•™ä½ï¼Œæœªæ¥å¯èƒ½ç”¨äºæ‰©å±•åŠŸèƒ½</td></tr><tr><td>1 ä½</td><td>Finalizable</td><td>è¡¨ç¤ºå¯¹è±¡å¯ç»ˆç»“ï¼ˆå³å®ç°äº† <code>finalize()</code> æ–¹æ³•ï¼‰</td></tr><tr><td>1 ä½</td><td>Remapped</td><td>æ ‡è¯†å¯¹è±¡æ˜¯å¦å·²è¢«è½¬ç§»(ç”¨äºæ ‡è¯†æŸä¸ªå¼•ç”¨æ˜¯å¦å·²ç»è¢«é‡å®šå‘ï¼ˆæ›´æ–°ä¸ºæ–°åœ°å€ï¼‰)ï¼›ä¸º 1 è¡¨ç¤ºè¯¥å¯¹è±¡æœªåœ¨é‡å®šä½é›†ï¼ˆRelocation Setï¼‰ä¸­ï¼Œå³æ–°åœ°å€ï¼Œä¸º0è¡¨ç¤ºæ—§åœ°å€</td></tr><tr><td>1 ä½</td><td>Marked1</td><td>æ ‡è®°ä½ä¹‹ä¸€ï¼Œç”¨äº GC è¿‡ç¨‹ä¸­çš„å¯¹è±¡æ ‡è®°é˜¶æ®µ ,ç”±äº ZGC æ˜¯å¹¶å‘ GCï¼Œéœ€è¦ä¸¤ä½æ¥æ”¯æŒé¢œè‰²åˆ‡æ¢æœºåˆ¶ï¼ˆColor Flipï¼‰ï¼Œç¡®ä¿åœ¨ä¸åŒ GC å‘¨æœŸä¸­å¯ä»¥åŒºåˆ†æ–°æ—§æ ‡è®°ï¼Œéœ€è¦è§¦å‘ä¸€æ¬¡è¯»å–å±éšœï¼ˆload barrierï¼‰ï¼Œæ‰¾åˆ°å¯¹è±¡çš„æ–°ä½ç½®ï¼Œå¹¶æ›´æ–°è¿™ä¸ªå¼•ç”¨ã€‚</td></tr><tr><td>1 ä½</td><td>Marked0</td><td>å¦ä¸€ä¸ªæ ‡è®°ä½ï¼Œä¸ Marked1 é…åˆç”¨äº GC æ ‡è®°é˜¶æ®µ</td></tr><tr><td>42 ä½</td><td>å¯¹è±¡åœ°å€éƒ¨åˆ†</td><td>å®é™…çš„å†…å­˜åœ°å€éƒ¨åˆ†ï¼Œæœ€å¤šå¯è¡¨ç¤º 2^42 å­—èŠ‚ï¼ˆå³ 4 TBï¼‰,jdk15åå ç”¨ 44ä½ï¼Œæ”¯æŒ 16TB</td></tr></tbody></table><p><em><strong>è¯»å±éšœ</strong></em></p><ul class="lvl-1"><li class="lvl-2"><p>ZGCï¼ˆZ Garbage Collectorï¼‰ä¸­çš„**è¯»å±éšœï¼ˆRead Barrierï¼‰æ˜¯å…¶æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ï¼Œå®ƒä¿è¯äº†å¹¶å‘å‹ç¼©ï¼ˆå¯¹è±¡ç§»åŠ¨ï¼‰**æ—¶ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œæ˜¯å®ç°ä½å»¶è¿Ÿã€é«˜å¹¶å‘åƒåœ¾å›æ”¶çš„å…³é”®ã€‚</p></li><li class="lvl-2"><p>åœ¨ä¼ ç»Ÿ GC ä¸­ï¼Œå¦‚æœå¯¹è±¡åœ¨ GC è¿‡ç¨‹ä¸­è¢«ç§»åŠ¨ï¼Œç¨‹åºè®¿é—®åˆ°çš„å¯¹è±¡åœ°å€å¯èƒ½å°±æ— æ•ˆäº†ã€‚å› æ­¤ï¼Œéœ€è¦**â€œåœä¸–ç•Œâ€**å°†æ‰€æœ‰å¼•ç”¨æ›´æ–°ã€‚</p></li><li class="lvl-2"><p>è€Œ ZGC çš„è®¾è®¡ç›®æ ‡æ˜¯ &lt;10ms çš„ GC åœé¡¿æ—¶é—´ï¼Œæ‰€ä»¥å®ƒé‡‡ç”¨ <code>å¹¶å‘æ ‡è®° + å¹¶å‘ç§»åŠ¨ + å¹¶å‘å¼•ç”¨æ›´æ–°</code> çš„æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¯¹è±¡å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶è¢«ç§»åŠ¨ï¼Œä½†ç¨‹åºè®¿é—®æ—¶å¿…é¡»â€œçŸ¥é“â€è¿™ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»è¢«ç§»åŠ¨ï¼Œå¹¶è·å–å…¶æœ€æ–°åœ°å€ï¼Œè¿™å°±æ˜¯è¯»å±éšœçš„èŒè´£ã€‚</p></li><li class="lvl-2"><p>è¯»å±éšœæ˜¯ä¸€ç§åœ¨è¯»å–å¯¹è±¡å¼•ç”¨æ—¶è‡ªåŠ¨æ’å…¥çš„é€»è¾‘ï¼Œç”¨äºæ£€æŸ¥å¼•ç”¨æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œä¿®æ­£ï¼ˆå³åœ°å€é‡å®šå‘ï¼‰ã€‚</p></li><li class="lvl-2"><p>ZGC æ˜¯ç›®å‰å”¯ä¸€åœ¨æ‰€æœ‰å¯¹è±¡è®¿é—®ä¸­éƒ½ä½¿ç”¨è¯»å±éšœçš„ GCï¼Œå®ƒåœ¨æ¯æ¬¡å¯¹è±¡æŒ‡é’ˆè§£å¼•ç”¨æ—¶éƒ½è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p></li></ul><table><thead><tr><th>èŒè´£</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ£€æµ‹å¼•ç”¨æ˜¯å¦æ˜¯è€åœ°å€</strong></td><td>åˆ©ç”¨æŒ‡é’ˆä¸­çš„å…ƒä¿¡æ¯ï¼ˆé¢œè‰²æŒ‡é’ˆï¼Œå¦‚ Remapped ä½ï¼‰åˆ¤æ–­å¼•ç”¨æ˜¯å¦å·²ç»è¢«æ›´æ–°</td></tr><tr><td><strong>å¦‚æœæœªæ›´æ–°åˆ™é‡å®šå‘å¼•ç”¨</strong></td><td>å¦‚æœå¼•ç”¨çš„æ˜¯æ—§åœ°å€ï¼Œå±éšœä¼šé€šè¿‡ forwarding table æ‰¾åˆ°æ–°åœ°å€å¹¶æ›´æ–°</td></tr><tr><td><strong>ä¿è¯æœ€ç»ˆè®¿é—®å¯¹è±¡çš„åœ°å€æ­£ç¡®</strong></td><td>å³ä½¿åœ¨å¯¹è±¡ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¹Ÿæ€»èƒ½è®¿é—®åˆ°æœ‰æ•ˆåœ°å€ï¼Œæ— éœ€åœé¡¿æ‰€æœ‰çº¿ç¨‹</td></tr></tbody></table><pre><code class="mermaid">graph TDA[ç¨‹åºè®¿é—®å¯¹è±¡å¼•ç”¨&lt;br&#x2F;&gt;ä¾‹å¦‚ï¼šPerson p &#x3D; personField] --&gt; B[JVM æ’å…¥è¯»å±éšœé€»è¾‘]B --&gt; C[è¯»å±éšœæ£€æŸ¥é¢œè‰²æŒ‡é’ˆä¸­çš„ Remapped ä½]C --&gt; D{Remapped ä½ä¸º 0 å—ï¼Ÿ}D -- æ˜¯ --&gt; E[æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²è¢«ç§»åŠ¨]E --&gt; F[æ›´æ–°å¼•ç”¨åœ°å€ä¸ºæ–°åœ°å€]F --&gt; G[è®¾ç½® Remapped ä½ä¸º 1]G --&gt; H[ä½¿ç”¨æ›´æ–°åçš„å¼•ç”¨è®¿é—®å¯¹è±¡]D -- å¦ --&gt; I[ç›´æ¥ä½¿ç”¨å½“å‰å¼•ç”¨è®¿é—®å¯¹è±¡]</code></pre></div><ul class="lvl-0"><li class="lvl-2"><p>ZGCçš„Regionå¯ä»¥å…·æœ‰å¤§ã€ä¸­ã€å°ä¸‰ç±»å®¹é‡ï¼š</p><ul class="lvl-2"><li class="lvl-6">å°å‹Regionï¼ˆSmall Regionï¼‰ ï¼š å®¹é‡å›ºå®šä¸º2MBï¼Œç”¨äºæ”¾ç½®å°äº256KBçš„å°å¯¹è±¡ã€‚</li><li class="lvl-6">ä¸­å‹Regionï¼ˆMedium Regionï¼‰ ï¼š å®¹é‡å›ºå®šä¸º32MBï¼Œç”¨äºæ”¾ç½®å¤§äºç­‰äº256KBä½†å°äº4MBçš„å¯¹è±¡ã€‚</li><li class="lvl-6">å¤§å‹Regionï¼ˆLarge Regionï¼‰ ï¼š å®¹é‡ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€å˜åŒ–ï¼Œä½†å¿…é¡»ä¸º2MBçš„æ•´æ•°å€ï¼Œç”¨äºæ”¾ç½®4MBæˆ–ä»¥ä¸Šçš„å¤§å¯¹è±¡ã€‚</li></ul><blockquote><p>æ¯ä¸ªå¤§å‹Regionä¸­åªä¼šå­˜æ”¾ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œè¿™ä¹Ÿé¢„ç¤ºç€è™½ç„¶åå­—å«ä½œâ€œå¤§å‹Regionâ€ï¼Œä½†å®ƒçš„å®é™…å®¹é‡å®Œå…¨æœ‰å¯èƒ½å°äºä¸­å‹Regionï¼Œæœ€å°å®¹é‡å¯ä½è‡³4MBã€‚</p></blockquote></li><li class="lvl-2"><p>ZGC ç‰¹ç‚¹ï¼š</p><ul class="lvl-2"><li class="lvl-6">æ”¯æŒæå¤§å †ï¼ˆJDK 15 èµ·æ”¯æŒæœ€é«˜ 16TBï¼‰</li><li class="lvl-6">GC åœé¡¿æ—¶é—´é€šå¸¸ä½äº 1msï¼ˆä¸å †å¤§å°åŸºæœ¬æ— å…³ï¼‰</li><li class="lvl-6">é€‚åˆä½å»¶è¿Ÿã€é«˜ååã€é«˜å¯ç”¨çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚äº¤æ˜“ç³»ç»Ÿã€å¹¿å‘Šæ¨èç­‰</li></ul></li></ul><h5 id="ZGCå­˜åœ¨çš„é—®é¢˜">ZGCå­˜åœ¨çš„é—®é¢˜</h5><ul class="lvl-0"><li class="lvl-2"><p>ZGCæœ€å¤§çš„é—®é¢˜æ˜¯<code>æµ®åŠ¨åƒåœ¾</code>ã€‚ZGCçš„åœé¡¿æ—¶é—´æ˜¯åœ¨10msä»¥ä¸‹ï¼Œä½†æ˜¯ZGCçš„æ‰§è¡Œæ—¶é—´è¿˜æ˜¯è¿œè¿œå¤§äºè¿™ä¸ªæ—¶é—´çš„ã€‚å‡å¦‚ZGCå…¨è¿‡ç¨‹éœ€è¦æ‰§è¡Œ10åˆ†é’Ÿï¼Œåœ¨è¿™ä¸ªæœŸé—´ç”±äºå¯¹è±¡åˆ†é…é€Ÿç‡å¾ˆé«˜ï¼Œå°†åˆ›å»ºå¤§é‡çš„æ–°å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¾ˆéš¾è¿›å…¥å½“æ¬¡GCï¼Œæ‰€ä»¥åªèƒ½åœ¨ä¸‹æ¬¡GCçš„æ—¶å€™è¿›è¡Œå›æ”¶ï¼Œè¿™äº›åªèƒ½ç­‰åˆ°ä¸‹æ¬¡GCæ‰èƒ½å›æ”¶çš„å¯¹è±¡å°±æ˜¯æµ®åŠ¨åƒåœ¾ã€‚</p></li><li class="lvl-2"><p>ZGCæ²¡æœ‰åˆ†ä»£æ¦‚å¿µï¼Œæ¯æ¬¡éƒ½éœ€è¦è¿›è¡Œå…¨å †æ‰«æï¼Œå¯¼è‡´ä¸€äº›â€œæœç”Ÿå¤•æ­»â€çš„å¯¹è±¡æ²¡èƒ½åŠæ—¶çš„è¢«å›æ”¶ã€‚</p></li><li class="lvl-2"><p>ç›®å‰å”¯ä¸€çš„åŠæ³•æ˜¯å¢å¤§å †çš„å®¹é‡ï¼Œä½¿å¾—ç¨‹åºå¾—åˆ°æ›´å¤šçš„å–˜æ¯æ—¶é—´ï¼Œä½†æ˜¯è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªæ²»æ ‡ä¸æ²»æœ¬çš„æ–¹æ¡ˆã€‚å¦‚æœéœ€è¦ä»æ ¹æœ¬ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿˜æ˜¯éœ€è¦å¼•å…¥åˆ†ä»£æ”¶é›†ï¼Œè®©æ–°ç”Ÿå¯¹è±¡éƒ½åœ¨ä¸€ä¸ªä¸“é—¨çš„åŒºåŸŸä¸­åˆ›å»ºï¼Œç„¶åä¸“é—¨é’ˆå¯¹è¿™ä¸ªåŒºåŸŸè¿›è¡Œæ›´é¢‘ç¹ã€æ›´å¿«çš„æ”¶é›†ã€‚</p></li><li class="lvl-2"><p>JDK21æ­£å¼å¼•å…¥äº†åˆ†ä»£ï¼ˆjdk17æ˜¯é¢„è§ˆç‰ˆï¼‰ï¼Œå¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ï¼š<code>-XX:+ZGenerational</code></p></li></ul><h5 id="ZGC-æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨">ZGC æ”¶é›†å™¨å‚æ•°é…ç½®è¡¨</h5><table><thead><tr><th>å‚æ•°å</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼ï¼ˆå¦‚æœªç‰¹æ®Šæ ‡æ³¨ï¼‰</th></tr></thead><tbody><tr><td><code>-XX:+UseZGC</code></td><td>å¯ç”¨ ZGC åƒåœ¾æ”¶é›†å™¨</td><td>-</td></tr><tr><td><code>-XX:+UnlockExperimentalVMOptions</code></td><td>è§£é”å®éªŒæ€§å‚æ•°ï¼ˆJDK 11~14 ä½¿ç”¨ ZGC å¿…é¡»ï¼‰</td><td>-</td></tr><tr><td><code>-XX:+UseLargePages</code></td><td>å¯ç”¨å¤§é¡µå†…å­˜ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰</td><td>false</td></tr><tr><td><code>-XX:+UseTransparentHugePages</code></td><td>å¯ç”¨é€æ˜å¤§é¡µï¼ˆéƒ¨åˆ† Linux ä¸Šå¯ç»“åˆä½¿ç”¨ï¼‰</td><td>false</td></tr><tr><td><code>-Xmx</code> / <code>-Xms</code></td><td>è®¾ç½®æœ€å¤§/åˆå§‹å †å¤§å°</td><td>ç”¨æˆ·é…ç½®</td></tr><tr><td><code>-XX:ZUncommitDelay=&lt;ç§’&gt;</code></td><td>æœªä½¿ç”¨å†…å­˜é‡Šæ”¾å›æ“ä½œç³»ç»Ÿçš„å»¶è¿Ÿæ—¶é—´ï¼ˆZGC ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼‰</td><td>300ï¼ˆ5åˆ†é’Ÿï¼‰</td></tr><tr><td><code>-XX:SoftMaxHeapSize=&lt;å¤§å°&gt;</code></td><td>è½¯æœ€å¤§å †ï¼ˆSoft Heap Limitï¼‰ï¼šZGC å°è¯•å°†ä½¿ç”¨çš„å †æ§åˆ¶åœ¨è¯¥å€¼ä»¥å†…</td><td>é»˜è®¤ç­‰äº Xmx</td></tr><tr><td><code>-XX:MaxHeapFreeRatio</code></td><td>æœ€å¤§å †ç©ºé—²æ¯”ä¾‹ï¼ˆè¶…è¿‡æ­¤æ¯”ä¾‹å¯èƒ½è§¦å‘å†…å­˜é‡Šæ”¾ï¼‰</td><td>70</td></tr><tr><td><code>-XX:MinHeapFreeRatio</code></td><td>æœ€å°å †ç©ºé—²æ¯”ä¾‹ï¼ˆä½äºæ­¤æ¯”ä¾‹å¯èƒ½è§¦å‘æ‰©å®¹ï¼‰</td><td>40</td></tr><tr><td><code>-XX:+ZGenerational</code></td><td>å¯ç”¨ ZGC åˆ†ä»£æ”¶é›†ï¼ˆä» JDK 21 èµ·æ”¯æŒï¼Œé»˜è®¤å…³é—­ï¼‰</td><td>falseï¼ˆJDK 21+ï¼‰</td></tr><tr><td><code>-XX:+PrintGC</code> / <code>-Xlog:gc*</code></td><td>å¼€å¯ GC æ—¥å¿—è¾“å‡º</td><td>-</td></tr><tr><td><code>-XX:+ZProactive</code></td><td>ä¸»åŠ¨å›æ”¶ç­–ç•¥ï¼ˆåœ¨ç³»ç»Ÿç©ºé—²æ—¶å°è¯•å›æ”¶ï¼‰</td><td>false</td></tr><tr><td><code>-XX:ZCollectionInterval=&lt;ç§’&gt;</code></td><td>ä¸»åŠ¨å›æ”¶ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ï¼ˆé…åˆ ZProactiveï¼‰</td><td>é»˜è®¤å€¼å› ç‰ˆæœ¬è€Œå¼‚</td></tr><tr><td><code>-XX:+ZConcurrentRootsScan</code></td><td>å¯ç”¨å¹¶å‘æ ¹æ‰«æï¼ˆä¼˜åŒ–åˆå§‹æ ‡è®°é˜¶æ®µï¼‰</td><td>JDK 17+ é»˜è®¤å¯ç”¨</td></tr></tbody></table><h3 id="ZGC-vs-G1-GC-vs-Parallel-GC-å¯¹æ¯”è¡¨">ZGC vs G1 GC vs Parallel GC å¯¹æ¯”è¡¨</h3><table><thead><tr><th>ç‰¹æ€§</th><th><strong>ZGC</strong></th><th><strong>G1 GC</strong></th><th><strong>Parallel GC</strong></th></tr></thead><tbody><tr><td><strong>è®¾è®¡ç›®æ ‡</strong></td><td><strong>æä½å»¶è¿Ÿ</strong>ï¼Œ&lt;1ms åœé¡¿</td><td>å¹³è¡¡ <strong>ä½å»¶è¿Ÿ</strong> ä¸ <strong>é«˜åå</strong></td><td><strong>é«˜åå</strong>ï¼Œæœ€å¤§åŒ– CPU ä½¿ç”¨</td></tr><tr><td><strong>GC åœé¡¿æ—¶é—´</strong></td><td>&lt;1msï¼Œå †å¤§å°å¢åŠ ä¸å½±å“åœé¡¿æ—¶é—´</td><td>å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼Œå †è¶Šå¤§åœé¡¿è¶Šæ˜æ˜¾</td><td>åœé¡¿æ—¶é—´å¯èƒ½è¾¾åˆ°ç§’çº§ï¼Œ<strong>å †è¶Šå¤§è¶Šæ˜æ˜¾</strong></td></tr><tr><td><strong>å †å¤§å°æ”¯æŒ</strong></td><td>æ”¯æŒé«˜è¾¾ <strong>16TB</strong>ï¼ˆJDK 15+ï¼‰</td><td>æ”¯æŒ <strong>æœ€å¤š 4TB</strong></td><td>æ”¯æŒå¤§å †ï¼Œä½†åœé¡¿æ˜æ˜¾</td></tr><tr><td><strong>æ˜¯å¦åˆ†ä»£</strong></td><td>é»˜è®¤ä¸åˆ†ä»£ï¼ˆJDK 21+ å¯å¼€å¯ <code>-XX:+ZGenerational</code>ï¼‰</td><td>åˆ†ä»£ï¼ˆæ–°ç”Ÿä»£ + è€å¹´ä»£ï¼‰</td><td>åˆ†ä»£ï¼ˆæ–°ç”Ÿä»£ + è€å¹´ä»£ï¼‰</td></tr><tr><td><strong>å¹¶å‘å›æ”¶</strong></td><td>æ˜¯ï¼Œ<strong>åŒ…æ‹¬æ ‡è®°ã€å‹ç¼©ã€å¼•ç”¨å¤„ç†éƒ½å¹¶å‘</strong></td><td>éƒ¨åˆ†å¹¶å‘ï¼Œä»åŒ…å«æ˜æ˜¾ Stop-The-World é˜¶æ®µ</td><td>å¦ï¼Œ<strong>å…¨éƒ¨ Stop-The-World</strong></td></tr><tr><td><strong>ç§»åŠ¨å¯¹è±¡æ—¶æ˜¯å¦åœé¡¿</strong></td><td>å¦ï¼Œä½¿ç”¨è¯»å±éšœå¹¶å‘è½¬ç§»å¯¹è±¡</td><td>æ˜¯ï¼ˆé€šè¿‡å¤åˆ¶åŒºåŸŸï¼‰</td><td>æ˜¯</td></tr><tr><td><strong>å®ç°æœºåˆ¶</strong></td><td>æ ‡è®°-é‡å®šä½ï¼ŒåŸºäºè¯»å±éšœ</td><td>Region åˆ†åŒº + æ ‡è®°-å¤åˆ¶ + Mixed GC</td><td>æ ‡è®°-å¤åˆ¶ï¼ˆæ–°ç”Ÿä»£ï¼‰ã€æ ‡è®°-æ•´ç†ï¼ˆè€å¹´ä»£ï¼‰</td></tr><tr><td><strong>ååèƒ½åŠ›</strong></td><td>ä¸­é«˜</td><td>é«˜</td><td><strong>æœ€é«˜</strong></td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>ä½å»¶è¿Ÿç³»ç»Ÿï¼Œå¦‚é‡‘èã€äº¤æ˜“ã€æ¨èç­‰å®æ—¶åº”ç”¨</td><td>é€šç”¨åå°ç³»ç»Ÿã€Web æœåŠ¡ç­‰</td><td>æ‰¹å¤„ç†ã€æ•°æ®è®¡ç®—ã€æ—¥å¿—åˆ†æç­‰ä¸æ•æ„Ÿäºåœé¡¿çš„ç³»ç»Ÿ</td></tr><tr><td><strong>é»˜è®¤å¯ç”¨</strong></td><td>å¦ï¼Œéœ€æŒ‡å®š <code>-XX:+UseZGC</code></td><td>JDK 9+ é»˜è®¤ GC</td><td>JDK 8 åŠä»¥å‰é»˜è®¤ GC</td></tr><tr><td><strong>è°ƒä¼˜å¤æ‚åº¦</strong></td><td>ä½ï¼Œå¤§å¤šæ•°å‚æ•°å¯çœç•¥</td><td>ä¸­ï¼Œéœ€è¦è®¾ç½®ç›®æ ‡åœé¡¿æ—¶é—´ç­‰</td><td>é«˜ï¼Œéœ€è¦ç²¾ç»†é…ç½® Eden/Survivor ç­‰æ¯”ä¾‹</td></tr><tr><td><strong>GC æ—¥å¿—é…ç½®æ–¹å¼</strong></td><td>ç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼š<code>-Xlog:gc*</code>ï¼ˆJDK 9+ï¼‰</td><td>æ”¯æŒä¼ ç»Ÿçš„ <code>-XX:+PrintGCDetails</code> å’Œ <code>-Xlog:gc*</code> æ—¥å¿—è¾“å‡º</td><td>ä¸»è¦ä½¿ç”¨æ—§å‚æ•°ï¼š<code>-XX:+PrintGCDetails</code> ç­‰</td></tr></tbody></table><div class="tips"><p><em><strong>ZGC ååèƒ½åŠ›è¾ƒå¼±çš„åŸå› </strong></em></p><table><thead><tr><th>åŸå› </th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong>1. å¹¶å‘é˜¶æ®µä»£ä»·è¾ƒé«˜</strong></td><td>ZGC å‡ ä¹æ‰€æœ‰çš„ GC å·¥ä½œï¼ˆåŒ…æ‹¬æ ‡è®°ã€æ•´ç†ã€å¼•ç”¨å¤„ç†ã€è½¬ç§»å¯¹è±¡ï¼‰éƒ½åœ¨ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚è™½ç„¶å‡å°‘äº†åœé¡¿ï¼Œä½†è¿™äº› GC çº¿ç¨‹ä¸ä¸šåŠ¡çº¿ç¨‹å…±äº« CPU èµ„æºï¼Œ<strong>å¢åŠ äº† CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç¼“å­˜ç«äº‰</strong>ï¼Œä»è€Œå½±å“ä¸šåŠ¡çº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡ã€‚</td></tr><tr><td><strong>2. è¯»å±éšœå¼€é”€</strong></td><td>ZGC ä¾èµ–<strong>ç€è‰²æŒ‡é’ˆå’Œè¯»å±éšœï¼ˆload barrierï¼‰æœºåˆ¶</strong>æ¥è·Ÿè¸ªå¯¹è±¡å¼•ç”¨çŠ¶æ€ï¼Œæ”¯æŒå¹¶å‘è½¬ç§»ã€‚è™½ç„¶éå¸¸é«˜æ•ˆï¼Œä½†ä»æ¯”ä¼ ç»Ÿ GC çš„æ™®é€šè¯»å†™è·¯å¾„æ…¢ä¸€äº›ï¼Œåœ¨é«˜é¢‘è®¿é—®å¯¹è±¡åœºæ™¯ä¸‹ä¼šå¸¦æ¥ä¸€å®š CPU å¼€é”€ã€‚</td></tr><tr><td><strong>3. å¯¹ç¡¬ä»¶ä¾èµ–é«˜ï¼Œè°ƒåº¦ä¿å®ˆ</strong></td><td>ä¸ºäº†å®ç°â€œ&lt;1ms åœé¡¿â€çš„ç›®æ ‡ï¼ŒZGC ä¼šé€‰æ‹©æ›´ä¿å®ˆçš„è°ƒåº¦ç­–ç•¥ï¼ˆå¦‚é¿å…å¹¶å‘çº¿ç¨‹ä½¿ç”¨è¿‡å¤š CPUï¼‰ï¼Œè€Œä¸ä¼šåƒ Parallel GC é‚£æ ·â€œæ¦¨å¹²â€æ‰€æœ‰æ ¸å¿ƒèµ„æºã€‚</td></tr><tr><td><strong>4. å†…å­˜å¼€é”€æ›´é«˜</strong></td><td>ä¸ºäº†æ”¯æŒå¹¶å‘å‹ç¼©å’Œè½¬ç§»ï¼ŒZGC é€šå¸¸éœ€è¦ä¸ºæ¯ä¸ªå¯¹è±¡ä¿ç•™å…ƒæ•°æ®å’Œæ›´å¤šçš„è½¬ç§»ç©ºé—´ï¼ˆå³â€œæµ®åŠ¨åƒåœ¾â€åŒºåŸŸï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´<strong>é¢‘ç¹çš„ GC å‘¨æœŸ</strong>ï¼Œå½±å“ååã€‚</td></tr><tr><td><strong>5. è®¾è®¡ç›®æ ‡éååä¼˜å…ˆ</strong></td><td>ZGC çš„é¦–è¦ç›®æ ‡æ˜¯<strong>ä½å»¶è¿Ÿè€Œéæœ€å¤§åå</strong>ã€‚ä¸ Parallel GCï¼ˆä»¥ååä¸ºæ ¸å¿ƒï¼‰è®¾è®¡ç›®æ ‡ä¸åŒï¼ŒZGC æ›´é€‚åˆåœºæ™¯ä¸ºâ€œå¯¹å»¶è¿Ÿæ•æ„Ÿä½†ååå¯æ¥å—â€çš„ç³»ç»Ÿã€‚</td></tr></tbody></table><p>æœ€ç³Ÿç³•çš„æƒ…å†µä¸‹ååé‡ä¼šé™ä½15%ã€‚è¿™éƒ½ä¸æ˜¯äº‹ï¼Œåœé¡¿æ—¶é—´è¶³å¤Ÿä¼˜ç§€ã€‚è‡³äºååé‡ï¼Œé€šè¿‡æ‰©å®¹åˆ†åˆ†é’Ÿè§£å†³ã€‚<br>å¦å¤–ï¼ŒOracleå®˜æ–¹æåˆ°äº†å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯ï¼šå®ƒçš„åœé¡¿æ—¶é—´ä¸ä¼šéšç€å †çš„å¢å¤§è€Œå¢é•¿ï¼<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡ åGå †çš„åœé¡¿æ—¶é—´æ˜¯10msä»¥ä¸‹ï¼Œå‡ ç™¾Gç”šè‡³ä¸ŠTå †çš„åœé¡¿æ—¶é—´ä¹Ÿæ˜¯10msä»¥ä¸‹ã€‚</p><p>ZGC ååå¼±ï¼Œä¸æ˜¯å› ä¸ºæŠ€æœ¯è½åï¼Œè€Œæ˜¯å› ä¸ºå®ƒä¸»åŠ¨é€‰æ‹©åœ¨ä½å»¶è¿Ÿå’Œé«˜ååä¹‹é—´åå‘äº†ä½å»¶è¿Ÿã€‚<br>åœ¨å¯¹å“åº”æ—¶é—´è¦æ±‚æé«˜çš„ç³»ç»Ÿä¸­ï¼Œå®ƒæ˜¯éå¸¸åˆé€‚çš„é€‰æ‹©ã€‚<br>ä½†å¦‚æœä½ çš„ç›®æ ‡æ˜¯å‹æ¦¨æœºå™¨æ€§èƒ½è·‘æ‰¹å¤„ç†ã€æ—¥å¿—åˆ†æè¿™ç±»ååå¯¼å‘å‹ä»»åŠ¡ï¼ŒParallel GC æˆ– G1 ä¼šæ›´åˆé€‚ã€‚</p></div><h2 id="å†…å­˜æº¢å‡º-OutOfMemoryErrorï¼Œç®€ç§°-OOM">å†…å­˜æº¢å‡º(OutOfMemoryErrorï¼Œç®€ç§° OOM)</h2><ul class="lvl-0"><li class="lvl-2"><p>JVM å¸¸è§å†…å­˜æº¢å‡ºç±»å‹æ±‡æ€»è¡¨</p></li></ul><table><thead><tr><th>æº¢å‡ºç±»å‹</th><th>å¼‚å¸¸ä¿¡æ¯</th><th>è§¦å‘åŸå› /æè¿°</th><th>ç›¸å…³å‚æ•°å’Œå»ºè®®é…ç½®</th></tr></thead><tbody><tr><td><strong>å †å†…å­˜æº¢å‡º</strong></td><td><code>java.lang.OutOfMemoryError: Java heap space</code></td><td>- åˆ›å»ºå¤§é‡å¯¹è±¡ï¼Œå †ç©ºé—´ä¸è¶³<br>- å†…å­˜æ³„æ¼ï¼šå¯¹è±¡ä¸å†ä½¿ç”¨å´æœ‰å¼ºå¼•ç”¨<br>- è€å¹´ä»£å¯¹è±¡å¤ªå¤šæ— æ³•æ™‹å‡</td><td><code>-Xms</code> / <code>-Xmx</code> è®¾ç½®å †å¤§å°</td></tr><tr><td><strong>æ ˆæº¢å‡ºï¼ˆé€’å½’ï¼‰</strong></td><td><code>java.lang.StackOverflowError</code></td><td>- æ–¹æ³•æ— é™é€’å½’æˆ–é€’å½’å±‚çº§å¤ªæ·±</td><td><code>-Xss</code> è®¾ç½®çº¿ç¨‹æ ˆå¤§å°</td></tr><tr><td><strong>æ— æ³•åˆ›å»ºæ–°çº¿ç¨‹</strong></td><td><code>java.lang.OutOfMemoryError: unable to create new native thread</code></td><td>- åˆ›å»ºçº¿ç¨‹è¿‡å¤šï¼ˆå¦‚çº¿ç¨‹æ± é…ç½®è¿‡å¤§ï¼‰<br>- ç³»ç»Ÿæˆ– JVM native çº¿ç¨‹èµ„æºè€—å°½</td><td>æ§åˆ¶çº¿ç¨‹æ± å¤§å°ï¼Œé¿å…æ— é™æ–°å»ºçº¿ç¨‹</td></tr><tr><td><strong>å…ƒç©ºé—´æº¢å‡º</strong></td><td><code>java.lang.OutOfMemoryError: Metaspace</code></td><td>- åŠ¨æ€åŠ è½½ç±»è¿‡å¤šï¼ˆå¦‚ä½¿ç”¨ CGLIBã€JSP åŠ¨æ€ç”Ÿæˆç±»ï¼‰<br>- ç±»æ— æ³•å¸è½½ï¼ˆå¦‚ ClassLoader æ³„æ¼ï¼‰</td><td><code>-XX:MetaspaceSize</code> / <code>-XX:MaxMetaspaceSize</code></td></tr><tr><td><strong>ç›´æ¥å†…å­˜æº¢å‡º</strong></td><td><code>java.lang.OutOfMemoryError: Direct buffer memory</code></td><td>- ä½¿ç”¨ <code>ByteBuffer.allocateDirect()</code> åˆ†é…å¤§é‡ç›´æ¥å†…å­˜<br>- Netty ç­‰æ¡†æ¶é»˜è®¤ä½¿ç”¨ç›´æ¥å†…å­˜</td><td><code>-XX:MaxDirectMemorySize</code></td></tr><tr><td><strong>GC å¼€é”€è¿‡é«˜</strong></td><td><code>java.lang.OutOfMemoryError: GC overhead limit exceeded</code></td><td>- JVM èŠ±è´¹ &gt;98% çš„æ—¶é—´ GC ä½†å›æ”¶ &lt;2% çš„å†…å­˜ï¼Œè®¤ä¸ºè¿›å…¥â€œGC æ­»å¾ªç¯â€</td><td>åˆ†æ GC æ—¥å¿—ã€ä¼˜åŒ–å †è®¾ç½®</td></tr><tr><td><strong>ç±»å¸è½½å¤±è´¥ï¼ˆå†…å­˜æ³„æ¼ï¼‰</strong></td><td>ï¼ˆä¸ä¸€å®šæŠ¥é”™ï¼Œä½†å¯èƒ½å¯¼è‡´ Metaspace OOMï¼‰</td><td>- Web å®¹å™¨é¢‘ç¹éƒ¨ç½²çƒ­æ›´æ–° WAR åŒ…æ—¶ï¼ŒClassLoader æ— æ³•å¸è½½ï¼Œå¯¼è‡´ç±»æ°¸ä¹…é©»ç•™</td><td>ä¼˜åŒ– ClassLoader ç®¡ç†ï¼Œä½¿ç”¨å†…å­˜åˆ†æå·¥å…·</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å †å¿«ç…§(å †è½¬å‚¨)æ–‡ä»¶åˆ†æ</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>-XX:+HeapDumpOnOutOfMemoryError</code></td><td>OOM æ—¶ç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶ ,å»ºè®®ç”Ÿäº§ç¯å¢ƒå¼€å¯</td></tr><tr><td><code>-XX:HeapDumpPath=xxx.hprof</code></td><td>æŒ‡å®šå †è½¬å‚¨æ–‡ä»¶ä¿å­˜è·¯å¾„ <br> é»˜è®¤ä¿å­˜åœ¨å½“å‰ç›®å½•</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¸¸ç”¨åˆ†æå·¥å…·ä¸å‘½ä»¤</p></li></ul><table><thead><tr><th>å·¥å…·/å‘½ä»¤</th><th>ç®€ä»‹ä¸åŠŸèƒ½</th><th>ä½¿ç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><strong>MATï¼ˆMemory Analyzer Toolï¼‰</strong></td><td>Eclipse å‡ºå“çš„å¼ºå¤§å›¾å½¢å·¥å…·ï¼Œæ”¯æŒæ³„æ¼åˆ†æã€å¯¹è±¡å¼•ç”¨é“¾åˆ†æã€å†…å­˜å ç”¨ç»Ÿè®¡ç­‰</td><td>ä¸‹è½½åœ°å€ï¼š<br><a href="https://www.eclipse.org/mat/">https://www.eclipse.org/mat/</a><br>æ‰“å¼€åç›´æ¥å¯¼å…¥ <code>.hprof</code> æ–‡ä»¶å³å¯åˆ†æ</td></tr><tr><td><strong>VisualVM</strong></td><td>å®˜æ–¹å¯è§†åŒ– JVM ç›‘æ§å·¥å…·ï¼Œæ”¯æŒå®æ—¶åˆ†æã€GC æŸ¥çœ‹ã€çº¿ç¨‹çŠ¶æ€ä¸å †è½¬å‚¨æŸ¥çœ‹</td><td>é™„å¸¦äº JDKï¼ˆæˆ–å•ç‹¬å®‰è£…ï¼‰ï¼Œæ‰“å¼€ <code>.hprof</code> æ–‡ä»¶è¿›è¡Œå¯è§†åŒ–åˆ†æ</td></tr><tr><td><strong>JProfiler</strong></td><td>å•†ä¸šçº§ Java æ€§èƒ½åˆ†æå·¥å…·ï¼Œæä¾›å †åˆ†æã€CPU åˆ†æã€çº¿ç¨‹åˆ†æç­‰å…¨å¥—åŠŸèƒ½</td><td>æ”¯æŒæ‰“å¼€ <code>.hprof</code> æ–‡ä»¶ï¼Œä¹Ÿå¯åœ¨è¿è¡Œæ—¶é…åˆä½¿ç”¨ï¼ˆéœ€ä»˜è´¹æˆ–è¯•ç”¨ï¼‰</td></tr><tr><td><strong>YourKit</strong></td><td>å•†ä¸šæ€§èƒ½åˆ†æå·¥å…·ï¼Œç•Œé¢å‹å¥½ï¼Œæ”¯æŒä¸°å¯Œçš„åˆ†æåŠŸèƒ½</td><td>æ”¯æŒå †åˆ†æï¼Œé€‚åˆå†…å­˜æ³„æ¼æ’æŸ¥</td></tr><tr><td><strong>jhat</strong>ï¼ˆè¿‡æ—¶ï¼‰</td><td>JDK é™„å¸¦çš„æ—§å·¥å…·ï¼Œç”¨äºåˆ†æ <code>.hprof</code> æ–‡ä»¶ï¼Œå¼€å¯ Web ç•Œé¢æŸ¥çœ‹ï¼ˆå·²åºŸå¼ƒï¼‰</td><td>å‘½ä»¤ï¼š<code>jhat heapdump.hprof</code>ï¼Œæµè§ˆå™¨è®¿é—® <code>http://localhost:7000</code>ï¼ˆJDK 8 åŠä»¥ä¸‹ï¼‰</td></tr><tr><td><strong>jmap</strong></td><td>ç”¨äºç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶æˆ–æŸ¥çœ‹å †å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯ï¼ˆ<strong>ä¸æ˜¯åˆ†æå·¥å…·æœ¬èº«</strong>ï¼‰</td><td>å‘½ä»¤ï¼š<code>jmap -dump:format=b,file=heap.hprof &lt;pid&gt;</code> ç”Ÿæˆè½¬å‚¨ï¼›é…åˆ MAT ä½¿ç”¨</td></tr><tr><td><strong>jcmd</strong></td><td>æ›´ç°ä»£çš„è¯Šæ–­å‘½ä»¤å·¥å…·ï¼Œå¯ç”Ÿæˆ heap dumpã€æ‰§è¡Œ GCã€æ‰“å° VM çŠ¶æ€ç­‰</td><td>å‘½ä»¤ï¼š<code>jcmd &lt;pid&gt; GC.heap_dump heap.hprof</code></td></tr><tr><td><strong><a href="http://GCEasy.io">GCEasy.io</a></strong></td><td>åœ¨çº¿åˆ†æå·¥å…·ï¼Œæ”¯æŒ <code>.hprof</code> æ–‡ä»¶å’Œ GC æ—¥å¿—ä¸Šä¼ åˆ†æ</td><td>ç½‘ç«™ï¼š<a href="https://gceasy.io">https://gceasy.io</a></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>GCæ—¥å¿—ç›¸å…³å‚æ•°(JDK1.8åŠä»¥ä¸‹)</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>-XX:+PrintGC</code></td><td>æ‰“å°åŸºæœ¬ GC ä¿¡æ¯ï¼ˆå»ºè®®é…åˆ <code>-XX:+PrintGCDetails</code> ä½¿ç”¨ï¼‰</td></tr><tr><td><code>-XX:+PrintGCDetails</code></td><td>æ‰“å°è¯¦ç»†çš„ GC æ—¥å¿—ä¿¡æ¯ï¼ˆå¦‚å„åŒºåŸŸä½¿ç”¨æƒ…å†µã€å¯¹è±¡åˆ†é…ã€æ™‹å‡ç­‰ï¼‰</td></tr><tr><td><code>-XX:+PrintGCDateStamps</code></td><td>åœ¨ GC æ—¥å¿—ä¸­æ·»åŠ æ—¥æœŸæ—¶é—´æˆ³</td></tr><tr><td><code>-XX:+PrintGCTimeStamps</code></td><td>åœ¨ GC æ—¥å¿—ä¸­æ·»åŠ  JVM å¯åŠ¨ä»¥æ¥çš„æ—¶é—´æˆ³</td></tr><tr><td><code>-Xloggc:/var/log/myapp/gc.log</code></td><td>å°† GC æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶</td></tr><tr><td><code>-XX:+UseGCLogFileRotation</code></td><td>å¯ç”¨ GC æ—¥å¿—æ–‡ä»¶è½®è½¬ï¼ˆé€‚ç”¨äºå¤§è§„æ¨¡ç³»ç»Ÿçš„ GC æ—¥å¿—ç®¡ç†ï¼‰</td></tr><tr><td><code>-XX:NumberOfGCLogFiles=5</code></td><td>æœ€å¤šä¿ç•™ 5 ä¸ª GC æ—¥å¿—å†å²æ–‡ä»¶</td></tr><tr><td><code>-XX:GCLogFileSize=10M</code></td><td>æ¯ä¸ª GC æ—¥å¿—æ–‡ä»¶æœ€å¤§ä¸º 10MB</td></tr><tr><td><code>-XX:+PrintGCCause</code></td><td>æ‰“å° GC çš„è§¦å‘åŸå› ï¼ˆå¦‚ Minor GCã€System.gc() ç­‰ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>GCæ—¥å¿—ç›¸å…³å‚æ•°(JDK9+)</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xlog:gc*:file=/var/log/app/gc.log:time,<span class="built_in">uptime</span>,level,tags:filecount=5,filesize=20M</span><br></pre></td></tr></table></figure><table><thead><tr><th>éƒ¨åˆ†</th><th>å«ä¹‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>gc*</code></td><td>æ—¥å¿—ç±»åˆ«</td><td>è¡¨ç¤ºè®°å½•æ‰€æœ‰ GC ç›¸å…³æ—¥å¿—ï¼ˆå¦‚ gcã€gc+startã€gc+heap ç­‰ï¼‰ã€‚<code>*</code> æ˜¯é€šé…ç¬¦ã€‚</td></tr><tr><td><code>file=/var/log/app/gc.log</code></td><td>è¾“å‡ºè·¯å¾„</td><td>å°† GC æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šè·¯å¾„ï¼Œè€Œä¸æ˜¯æ§åˆ¶å°ã€‚å¯ä»¥æ˜¯ç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„ã€‚</td></tr><tr><td><code>time</code></td><td>æ—¥å¿—æ—¶é—´æˆ³</td><td>æ·»åŠ æ ¼å¼åŒ–æ—¶é—´ï¼ˆå¦‚ 2025-05-12T10:21:33.123+0800ï¼‰ã€‚ä¾¿äºå®šä½å…·ä½“æ—¶é—´ã€‚</td></tr><tr><td><code>uptime</code></td><td>JVM å¯åŠ¨ä»¥æ¥çš„æ—¶é—´æˆ³</td><td>æ˜¾ç¤º GC å‘ç”Ÿæ—¶è·ç¦» JVM å¯åŠ¨çš„æ¯«ç§’æ•°ï¼ˆä¾‹å¦‚ <code>3.254s</code>ï¼‰ã€‚æœ‰åŠ©äºè°ƒè¯•å¯åŠ¨æœŸé—´çš„é—®é¢˜ã€‚</td></tr><tr><td><code>level</code></td><td>æ—¥å¿—çº§åˆ«</td><td>æ˜¾ç¤ºæ—¥å¿—çº§åˆ«ï¼ˆinfoã€debugã€warning ç­‰ï¼‰ï¼Œé»˜è®¤ infoã€‚</td></tr><tr><td><code>tags</code></td><td>æ—¥å¿—æ ‡ç­¾</td><td>æ˜¾ç¤ºæ—¥å¿—çš„æ¨¡å—æ ‡ç­¾ï¼Œå¦‚ <code>[gc,start]</code>ï¼Œå¸®åŠ©å¿«é€Ÿå®šä½ç±»åˆ«ã€‚</td></tr><tr><td><code>filecount=5</code></td><td>æ–‡ä»¶è½®è½¬ä¸ªæ•°</td><td>æœ€å¤šä¿ç•™ 5 ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ˆå½“å‰æ—¥å¿— + 4 ä¸ªå†å²ï¼‰ã€‚</td></tr><tr><td><code>filesize=20M</code></td><td>å•æ–‡ä»¶æœ€å¤§å¤§å°</td><td>æ¯ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§ 20MBï¼Œè¶…å‡ºæ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»JVMçš„å†…å­˜æ¨¡å‹ä¸åƒåœ¾å›æ”¶æœºåˆ¶&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/specs/jvms/se8/html/index.html&quot;&gt;The JavaÂ® Virtual Machine Specification&lt;/a&gt; ç‰ˆæœ¬jdk1.8&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="jvm" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/jvm/"/>
    
    
    <category term="jvm" scheme="https://blog.hanqunfeng.com/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>JVM ä¹‹ ç±»åŠ è½½å™¨</title>
    <link href="https://blog.hanqunfeng.com/2025/05/08/jvm-classloader-01/"/>
    <id>https://blog.hanqunfeng.com/2025/05/08/jvm-classloader-01/</id>
    <published>2025-05-08T13:30:05.000Z</published>
    <updated>2025-05-09T07:27:56.853Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»JVMçš„ç±»åŠ è½½å™¨</p></li><li class="lvl-2"><p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/index.html">The JavaÂ® Virtual Machine Specification</a> ç‰ˆæœ¬jdk1.8</p></li></ul><span id="more"></span><h2 id="ç±»åŠ è½½å™¨">ç±»åŠ è½½å™¨</h2><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/0QoWW8.png" alt="" width="900" height="600"></p><ul class="lvl-0"><li class="lvl-2"><p>å·¦ä¾§æ˜¯JDKä¸­å®ç°çš„ç±»åŠ è½½å™¨ï¼Œé€šè¿‡<code>parent</code>å±æ€§å½¢æˆâ½—â¼¦å…³ç³»ã€‚åº”â½¤ä¸­â¾ƒå®šä¹‰çš„ç±»åŠ è½½å™¨çš„<code>parent</code>éƒ½æ˜¯<br><code>AppClassLoader</code></p></li><li class="lvl-2"><p>å³ä¾§æ˜¯JDKä¸­çš„ç±»åŠ è½½å™¨å®ç°ç±»ã€‚é€šè¿‡ç±»ç»§æ‰¿çš„æœºåˆ¶å½¢æˆä½“ç³»ã€‚æœªæ¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç»§æ‰¿ç›¸å…³çš„ç±»å®ç°â¾ƒå®šä¹‰ç±»<br>åŠ è½½å™¨ã€‚</p></li><li class="lvl-2"><p>åœ¨ä»£ç ä¸­æŸ¥çœ‹ç±»åŠ è½½å™¨å…³ç³»</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoaderDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// â½—â¼¦å…³ç³» AppClassLoader &lt;- ExtClassLoader &lt;- BootStrap Classloader</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">cl1</span> <span class="operator">=</span> LoaderDemo.class.getClassLoader();</span><br><span class="line">        System.out.println(<span class="string">&quot;cl1 &gt; &quot;</span> + cl1); <span class="comment">// sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line">        System.out.println(<span class="string">&quot;parent of cl1 &gt; &quot;</span> + cl1.getParent()); <span class="comment">// sun.misc.Launcher$ExtClassLoader@1b6d3586</span></span><br><span class="line">        <span class="comment">// BootStrap Classloaderç”±C++å¼€å‘ï¼Œæ˜¯JVMè™šæ‹Ÿæœºçš„â¼€éƒ¨åˆ†ï¼Œæœ¬èº«ä¸æ˜¯JAVAç±»ã€‚</span></span><br><span class="line">        System.out.println(<span class="string">&quot;grant parent of cl1 &gt; &quot;</span> + cl1.getParent().getParent()); <span class="comment">// null</span></span><br><span class="line">        <span class="comment">// String,Intç­‰åŸºç¡€ç±»ç”±BootStrap ClassloaderåŠ è½½ã€‚</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">cl2</span> <span class="operator">=</span> String.class.getClassLoader();</span><br><span class="line">        System.out.println(<span class="string">&quot;cl2 &gt; &quot;</span> + cl2); <span class="comment">// null</span></span><br><span class="line">        System.out.println(cl1.loadClass(<span class="string">&quot;java.util.List&quot;</span>).getClass().getClassLoader()); <span class="comment">// null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒäº²å§”æ´¾æœºåˆ¶">åŒäº²å§”æ´¾æœºåˆ¶</h2><ul class="lvl-0"><li class="lvl-2"><p>å½“â¼€ä¸ªç±»åŠ è½½å™¨è¦åŠ è½½â¼€ä¸ªç±»æ—¶ï¼Œæ•´ä½“çš„è¿‡ç¨‹å°±æ˜¯é€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶å‘ä¸Šå§”æ‰˜æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°ï¼Œå°±å‘ä¸‹å§”æ‰˜åŠ è½½ã€‚</p></li><li class="lvl-2"><p>Java ç±»åŠ è½½æœºåˆ¶ä¸­çš„<code>åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Modelï¼‰</code>æ˜¯ä¸€ç§ä¿è¯äº†ç±»åŠ è½½å™¨æŒ‰ç…§å±‚æ¬¡ç»“æ„ä»ä¸Šåˆ°ä¸‹æ¥åŠ è½½ç±»çš„ç­–ç•¥ã€‚è¿™ç§å±‚çº§åŒ–çš„åŠ è½½æµç¨‹ç¡®ä¿äº†åº”ç”¨ç¨‹åºèƒ½å¤Ÿå®‰å…¨åœ°åŠ è½½å¹¶ä½¿ç”¨æ¥è‡ªä¸åŒæ¥æºçš„ç±»ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†å†…å­˜ä¸­å‡ºç°ç›¸åŒç±»çš„å¤šä¸ªæ‹·è´ã€‚</p></li><li class="lvl-2"><p>ä»¥ä¸‹æ˜¯åŒäº²å§”æ´¾æœºåˆ¶çš„å·¥ä½œåŸç†ï¼š</p><ul class="lvl-2"><li class="lvl-4">1.å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ¥æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªè¡Œå°è¯•å»å¯»æ‰¾ç±»æ–‡ä»¶ï¼Œè€Œæ˜¯å°†è¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ã€‚</li><li class="lvl-4">2.çˆ¶ç±»åŠ è½½å™¨åŒæ ·éµå¾ªæ­¤è§„åˆ™ï¼Œå®ƒä¼šç»§ç»­æŠŠè¯·æ±‚å‘ä¸Šå§”æ´¾ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ï¼Œç›´åˆ°è¾¾åˆ°æ ¹ï¼ˆbootstrappï¼‰ç±»åŠ è½½å™¨ä¸ºæ­¢ã€‚</li><li class="lvl-4">3.æ ¹ç±»åŠ è½½å™¨ä¸€èˆ¬ä¼šç›´æ¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ¥æŸ¥æ‰¾ç±»æ–‡ä»¶ï¼Œæ¯”å¦‚ JDK è‡ªå¸¦çš„æ ¸å¿ƒç±»åº“ï¼Œæˆ–è€…åœ¨-XbootclasspathæŒ‡å®šçš„è·¯å¾„ä¸‹æŸ¥æ‰¾ã€‚</li><li class="lvl-4">4.å¦‚æœæ ¹ç±»åŠ è½½å™¨æ‰¾åˆ°äº†è¯¥ç±»ï¼Œåˆ™è¿›è¡Œç±»çš„åŠ è½½ï¼›å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™æŠŠè¿™ä¸ªä»»åŠ¡äº¤å›ç»™å‘å‡ºè¯·æ±‚çš„å­ç±»åŠ è½½å™¨ã€‚</li><li class="lvl-4">5.å­ç±»åŠ è½½å™¨ä¹Ÿé‡å¤æ­¥éª¤ 4ï¼Œè‹¥æ‰¾åˆ°åˆ™åŠ è½½ï¼Œå¦åˆ™ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå­ç±»åŠ è½½å™¨ï¼Œç›´è‡³åŸå§‹æå‡ºè¯·æ±‚çš„ç±»åŠ è½½å™¨ã€‚</li><li class="lvl-4">6.è‹¥æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æœªèƒ½æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼Œåˆ™æœ€ç»ˆæŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/ftDnCj.png" alt="" width="600" height="800"></li></ul></li><li class="lvl-2"><p>åŒäº²å§”æ´¾æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š</p><ul class="lvl-2"><li class="lvl-4">å®‰å…¨æ€§ï¼šç”±äºç±»åŠ è½½æ˜¯ä»é¡¶å±‚å¼€å§‹ï¼Œè¿™èƒ½é˜²æ­¢æ¶æ„ä»£ç é€šè¿‡åŠ è½½ç›¸åŒçš„åŒ…åå’Œç±»åæ›¿ä»£ç³»ç»Ÿçš„å…³é”®ç±»ã€‚</li><li class="lvl-4">å”¯ä¸€æ€§ï¼šæ¯ä¸ªç±»éƒ½ä¼šè¢«ç‰¹å®šçš„ç±»åŠ è½½å™¨åŠ è½½ä¸€æ¬¡ï¼Œå³ä¾¿æ˜¯åœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸­ä¹Ÿèƒ½ä¿è¯ç±»çš„ç»Ÿä¸€æ€§ï¼Œé¿å…å› ä¸ºå¤šæ¬¡åŠ è½½å¯¼è‡´çš„é”™è¯¯ã€‚</li><li class="lvl-4">å¯é æ€§ï¼šç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ä¸ç”¨æ‹…å¿ƒåŸºç¡€ç±»å·²ç»è¢«åŠ è½½ï¼Œå®ƒä»¬å¯ä»¥ä¸“å¿ƒäºè‡ªå·±éœ€è¦å¤„ç†çš„éƒ¨åˆ†ã€‚</li></ul></li><li class="lvl-2"><p>ä¾‹å¦‚ï¼Œå½“åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œåº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰æ¥æ”¶åˆ°å¯¹java.lang.Stringç±»çš„åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒä¼šé¦–å…ˆå°†è¯·æ±‚ä¼ é€’ç»™æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼Œåè€…å†ä¼ é€’ç»™å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ã€‚å¼•å¯¼ç±»åŠ è½½å™¨ä¼šåœ¨å…¶æœç´¢è·¯å¾„ä¸­æ‰¾åˆ°Stringç±»ï¼Œå¹¶å®ŒæˆåŠ è½½è¿‡ç¨‹ã€‚å¦‚æœåº”ç”¨ç¨‹åºè¯•å›¾æä¾›è‡ªå·±çš„Stringç±»ï¼Œç”±äºåŒäº²å§”æ´¾çš„å­˜åœ¨ï¼Œåº”ç”¨ç¨‹åºæ‰€æŒ‡å®šçš„ç±»å¹¶ä¸ä¼šè¢«åŠ è½½ï¼Œä»è€Œä¿è¯äº†å¹³å°æ ¸å¿ƒ API çš„ä¸€è‡´æ€§ã€‚</p></li><li class="lvl-2"><p>æ€»ä¹‹ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶æ˜¯ Java ç±»åŠ è½½è¿‡ç¨‹ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒä¸ä»…ç»´æŠ¤äº†ç±»åŠ è½½çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ï¼Œä¹Ÿä¸ºå¼€å‘è€…æä¾›äº†çµæ´»å®šåˆ¶ç±»åŠ è½½è§„åˆ™çš„èƒ½åŠ›ã€‚</p></li></ul><h3 id="æ¯ä¸ªç±»åŠ è½½å™¨æŸ¥æ‰¾ç±»çš„é»˜è®¤è·¯å¾„">æ¯ä¸ªç±»åŠ è½½å™¨æŸ¥æ‰¾ç±»çš„é»˜è®¤è·¯å¾„</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ Java ä¸­ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„ç±»è·¯å¾„ï¼ˆClasspathï¼‰å»æŸ¥æ‰¾ç±»æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªä¸»è¦çš„ç±»åŠ è½½å™¨ä»¥åŠå®ƒä»¬çš„é»˜è®¤æŸ¥æ‰¾è·¯å¾„ï¼š</p><ul class="lvl-2"><li class="lvl-4">Bootstrap ClassLoader (å¯åŠ¨ç±»åŠ è½½å™¨)ï¼š<br>è¿™ä¸ªåŠ è½½å™¨æ˜¯ç”¨ <code>native</code> ä»£ç å®ç°çš„ï¼Œç”¨äºåŠ è½½æ ¸å¿ƒ Java ç±»åº“ã€‚å®ƒæ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨ã€‚<br>æŸ¥æ‰¾è·¯å¾„é€šå¸¸æ˜¯<code>&lt;JAVA_HOME&gt;/jre/lib</code>ç›®å½•ä¸‹çš„æ ¸å¿ƒè¿è¡Œæ—¶åº“ï¼Œä¾‹å¦‚rt.jarç­‰ï¼Œæˆ–æ˜¯ç”±<code>sun.boot.class.path</code>ç³»ç»Ÿå±æ€§æŒ‡å®šçš„è·¯å¾„ã€‚</li><li class="lvl-4">Extension ClassLoader (æ‰©å±•ç±»åŠ è½½å™¨)ï¼šExtClassLoader<br>è¿™ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„æ˜¯ Java å¹³å°æ‰©å±•çš„ä¸€äº›ç±»ï¼Œè¿™äº›é€šå¸¸ä½äº<code>&lt;JAVA_HOME&gt;/jre/lib/ext</code>ç›®å½•ä¸‹æˆ–æ˜¯ç”±<code>java.ext.dirs</code>ç³»ç»Ÿå±æ€§æŒ‡å®šçš„è·¯å¾„ã€‚<br>å®ƒçš„çˆ¶ç±»åŠ è½½å™¨æ˜¯ Bootstrap ClassLoaderã€‚</li><li class="lvl-4">Application ClassLoader (åº”ç”¨ç±»åŠ è½½å™¨ï¼Œä¹Ÿç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨)ï¼šAppClassLoader<br>è´Ÿè´£åŠ è½½åº”ç”¨ç¨‹åºçš„ä¸»ç±»è·¯å¾„ (Classpath) ä¸­å®šä¹‰çš„åº”ç”¨ç¨‹åºç±»ã€‚<br>é»˜è®¤æŸ¥æ‰¾è·¯å¾„åŒ…æ‹¬<code>-classpath</code>ã€<code>-cp</code>å‘½ä»¤è¡Œå‚æ•°ã€<code>CLASSPATH</code>ç¯å¢ƒå˜é‡æˆ–è€…æ˜¯ç”±<code>java.class.path</code>ç³»ç»Ÿå±æ€§æ‰€æŒ‡å®šçš„è·¯å¾„ã€‚<br>å¦‚æœä¸Šè¿°éƒ½æœªè®¾ç½®ï¼Œé‚£ä¹ˆå®ƒä¼šæŸ¥æ‰¾å½“å‰ç›®å½• <code>(.)</code>ã€‚<br>å…¶çˆ¶ç±»åŠ è½½å™¨ä¸º Extension ClassLoaderã€‚</li><li class="lvl-4">è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼š<br>ä»»ä½•åŸºäº<code>java.lang.ClassLoader</code>çš„å­ç±»éƒ½å¯ä»¥æ˜¯è‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚<br>è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¯ä»¥é€‰æ‹©æ€§åœ°é‡å†™<code>findClass()</code>æ–¹æ³•ä»¥å®ç°ç‰¹å®šçš„ç±»æ–‡ä»¶è¯»å–é€»è¾‘ï¼Œè¿™æ ·å¯ä»¥æ§åˆ¶ä»å“ªé‡ŒåŠ è½½ç±»æ–‡ä»¶ï¼Œæ¯”å¦‚ä»ç½‘ç»œã€æ•°æ®åº“æˆ–ç”šè‡³æ˜¯åŠ å¯†æ ¼å¼è·å–ç±»ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®ŠæŒ‡å®šï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„æŸ¥æ‰¾è·¯å¾„ä¸å…¶çˆ¶ç±»åŠ è½½å™¨ç›¸åŒã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è®¾å®šå…¶æœç´¢è·¯å¾„ã€‚</li></ul></li><li class="lvl-2"><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™¤äº† Bootstrap ClassLoader å¤–ï¼Œå…¶ä»–çš„æ‰€æœ‰ç±»åŠ è½½å™¨æœ€ç»ˆéƒ½æ˜¯java.lang.ClassLoaderçš„å­ç±»ï¼Œå¹¶ä¸”æ¯ä¸ªç±»åŠ è½½å™¨å®ä¾‹éƒ½æœ‰ä¸€ä¸ªç›´æ¥çš„çˆ¶ç±»åŠ è½½å™¨ã€‚å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»åŠ è½½å™¨ï¼Œå®ƒå°†ç»§æ‰¿ Application ClassLoader ä½œä¸ºå®ƒçš„çˆ¶ç±»ï¼Œé™¤éä½ åœ¨åˆ›å»ºæ—¶æŒ‡å®šäº†ä¸åŒçš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p></li><li class="lvl-2"><p>æ­¤å¤–ï¼ŒJava 9 å¼•å…¥äº†æ¨¡å—åŒ–ç³»ç»Ÿåï¼Œç±»åŠ è½½æœºåˆ¶ä¹Ÿæœ‰äº†ä¸€äº›å˜åŒ–ï¼Œå¯¹äºæ¨¡å—è·¯å¾„ä¸Šçš„ç±»åŠ è½½ï¼Œä¼šä½¿ç”¨æ–°çš„å±‚æ¬¡ç»“æ„æ¥å¤„ç†ï¼Œè¿™ä½¿å¾—ç±»åŠ è½½è¿‡ç¨‹æ›´åŠ çµæ´»åŒæ—¶ä¿æŒäº†å‘åçš„å…¼å®¹æ€§ã€‚ä¸è¿‡ï¼Œå¯¹äºä¼ ç»Ÿçš„ç±»è·¯å¾„ä¸Šçš„ç±»åŠ è½½ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹ä»ç„¶é€‚ç”¨ã€‚</p></li><li class="lvl-2"><p>åœ¨ä»£ç ä¸­æŸ¥çœ‹ç±»åŠ è½½è·¯å¾„</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BootStrap Classloaderï¼ŒåŠ è½½javaåŸºç¡€ç±»ã€‚</span></span><br><span class="line">System.out.println(<span class="string">&quot;BootStrap ClassLoaderåŠ è½½â½¬å½•ï¼š&quot;</span> + System.getProperty(<span class="string">&quot;sun.boot.class.path&quot;</span>));</span><br><span class="line"><span class="comment">// Extention Classloader åŠ è½½â¼€äº›æ‰©å±•ç±»ã€‚ å¯é€šè¿‡-D java.ext.dirså¦â¾æŒ‡å®šâ½¬å½•</span></span><br><span class="line">System.out.println(<span class="string">&quot;Extention ClassLoaderåŠ è½½â½¬å½•ï¼š&quot;</span> + System.getProperty(<span class="string">&quot;java.ext.dirs&quot;</span>));</span><br><span class="line"><span class="comment">// AppClassLoader åŠ è½½CLASSPATHï¼Œåº”â½¤ä¸‹çš„JaråŒ…ã€‚å¯é€šè¿‡-D java.class.pathå¦â¾æŒ‡å®šâ½¬å½•</span></span><br><span class="line">System.out.println(<span class="string">&quot;AppClassLoaderåŠ è½½â½¬å½•ï¼š&quot;</span> + System.getProperty(<span class="string">&quot;java.class.path&quot;</span>));</span><br></pre></td></tr></table></figure><h3 id="åŒäº²å§”æ´¾æœºåˆ¶çš„å®ç°åŸç†">åŒäº²å§”æ´¾æœºåˆ¶çš„å®ç°åŸç†</h3><ul class="lvl-0"><li class="lvl-2"><p>java.lang.ClassLoader ç±»çš„ loadClass æ–¹æ³•æ˜¯åŒäº²å§”æ´¾çš„æ ¸å¿ƒå®ç°</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ è½½æŒ‡å®šåç§°çš„ç±»ï¼Œå¹¶æ ¹æ® resolve å‚æ•°å†³å®šæ˜¯å¦è§£æè¯¥ç±»ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¯¥æ–¹æ³•å®ç°äº†ç±»åŠ è½½çš„åŸºæœ¬é€»è¾‘ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½ã€å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€</span></span><br><span class="line"><span class="comment"> * è‡ªè¡ŒåŠ è½½ç±»ä»¥åŠè§£æç±»ç­‰æ­¥éª¤ã€‚è¯¥æ–¹æ³•æ˜¯ Java ç±»åŠ è½½æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ï¼Œ</span></span><br><span class="line"><span class="comment"> * éµå¾ªåŒäº²å§”æ´¾æ¨¡å‹ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name    è¦åŠ è½½çš„ç±»çš„å…¨é™å®šå</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> resolve å¦‚æœä¸º trueï¼Œåˆ™åœ¨åŠ è½½åè§£æè¯¥ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> åŠ è½½çš„ Class å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ClassNotFoundException å¦‚æœæ‰¾ä¸åˆ°æŒ‡å®šçš„ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªâ½…æ³•æ˜¯protectedå£°æ˜çš„ï¼Œæ„å‘³ç€ï¼Œæ˜¯å¯ä»¥è¢«â¼¦ç±»è¦†ç›–çš„ï¼Œæ‰€ä»¥ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ä¹Ÿæ˜¯å¯ä»¥è¢«æ‰“ç ´çš„ï¼Œå¦‚Tomcatâ¼¦ç±»é‡å†™è¿™ä¸ªâ½…æ³•ï¼Œå¹¶ä½¿â½¤è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘ã€‚</span></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve)</span><br><span class="line">        <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ synchronized ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç±»åŠ è½½çš„åŒæ­¥</span></span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">        <span class="comment">// First, check if the class has already been loaded</span></span><br><span class="line">        <span class="comment">// æ¯ä¸ªç±»åŠ è½½å™¨å¯¹ä»–åŠ è½½è¿‡çš„ç±»éƒ½æœ‰â¼€ä¸ªç¼“å­˜ï¼Œå…ˆå»ç¼“å­˜ä¸­æŸ¥çœ‹æœ‰æ²¡æœ‰åŠ è½½è¿‡</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123; <span class="comment">//æ²¡æœ‰åŠ è½½è¿‡ï¼Œå°±â¾›åŒäº²å§”æ´¾</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">t0</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// çˆ¶ç±»å­˜åœ¨åˆ™è®©â½—ç±»åŠ è½½å™¨è¿›â¾åŠ è½½</span></span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                    c = parent.loadClass(name, <span class="literal">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">//å¦‚æœçˆ¶ç±»ä¸å­˜åœ¨ï¼Œåˆ™ä»å¼•å¯¼ç±»åŠ è½½å™¨è¿›â¾åŠ è½½</span></span><br><span class="line">                    c = findBootstrapClassOrNull(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                <span class="comment">// to find the class.</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                <span class="comment">// findClass æ–¹æ³•æ˜¯å­ç±»å®ç°çš„ï¼Œç”¨äºåŠ è½½æŒ‡å®šåç§°çš„ç±»</span></span><br><span class="line">                <span class="comment">// â½—ç±»åŠ è½½å™¨æ²¡æœ‰åŠ è½½è¿‡ï¼Œå°±â¾ƒâ¾è§£æclassâ½‚ä»¶åŠ è½½</span></span><br><span class="line">                c = findClass(name);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                <span class="comment">// æ€§èƒ½ç»Ÿè®¡ï¼šè®°å½•ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„æ—¶é—´æ¶ˆè€—å’Œè°ƒç”¨æ¬¡æ•°ï¼Œä¾¿äºç›‘æ§å’Œä¼˜åŒ–ã€‚</span></span><br><span class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹åªè¿›â¾äº†éªŒè¯å’Œå‡†å¤‡é˜¶æ®µï¼Œâ½½ä¸è¿›â¾è§£æ(å¦‚é“¾æ¥ã€åˆå§‹åŒ–)</span></span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¯¥æ–¹æ³•å®ç°äº†ç±»åŠ è½½çš„åŸºæœ¬é€»è¾‘ï¼ŒåŒ…æ‹¬æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½ã€å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨åŠ è½½ã€è‡ªè¡ŒåŠ è½½ç±»ä»¥åŠè§£æç±»ç­‰æ­¥éª¤ã€‚è¯¥æ–¹æ³•æ˜¯ Java ç±»åŠ è½½æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ï¼Œéµå¾ªåŒäº²å§”æ´¾æ¨¡å‹ã€‚</p></li><li class="lvl-2"><p>è¿™ä¸ªâ½…æ³•æ˜¯<code>protected</code>å£°æ˜çš„ï¼Œæ„å‘³ç€ï¼Œæ˜¯å¯ä»¥è¢«â¼¦ç±»è¦†ç›–çš„ï¼Œæ‰€ä»¥ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ä¹Ÿæ˜¯å¯ä»¥è¢«æ‰“ç ´çš„ï¼Œå¦‚Tomcatâ¼¦ç±»é‡å†™è¿™ä¸ªâ½…æ³•ï¼Œå¹¶ä½¿â½¤è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘ã€‚</p></li></ul><h2 id="æ²™ç®±ä¿æŠ¤æœºåˆ¶">æ²™ç®±ä¿æŠ¤æœºåˆ¶</h2><ul class="lvl-0"><li class="lvl-2"><p>æ²™ç®±ä¿æŠ¤æœºåˆ¶æ˜¯ Java è™šæ‹Ÿæœºæä¾›çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºä¿æŠ¤åº”ç”¨ç¨‹åºå…å—æ¶æ„ä»£ç çš„æ”»å‡»ã€‚</p></li><li class="lvl-2"><p>java.lang.ClassLoader ç±»çš„ preDefineClass æ–¹æ³•æ˜¯æ²™ç®±ä¿æŠ¤æœºåˆ¶çš„æ ¸å¿ƒå®ç°</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªæ–¹æ³•åœ¨åŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰è¢«è°ƒç”¨ï¼Œç”¨äºåœ¨åŠ è½½ç±»ä¹‹å‰è¿›è¡Œä¸€äº›é¢„å¤„ç†æ“ä½œã€‚</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">// name: è¦åŠ è½½çš„ç±»çš„å…¨é™å®šåã€‚</span></span><br><span class="line"><span class="comment">// pd: æä¾›çš„ä¿æŠ¤åŸŸä¿¡æ¯ï¼Œå¯èƒ½ä¸º nullã€‚</span></span><br><span class="line"><span class="keyword">private</span> ProtectionDomain <span class="title function_">preDefineClass</span><span class="params">(String name,</span></span><br><span class="line"><span class="params">                                            ProtectionDomain pd)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!checkName(name))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoClassDefFoundError</span>(<span class="string">&quot;IllegalName: &quot;</span> + name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Note:  Checking logic in java.lang.invoke.MemberName.checkForTypeAlias</span></span><br><span class="line">        <span class="comment">// relies on the fact that spoofing is impossible if a class has a name</span></span><br><span class="line">        <span class="comment">// of the form &quot;java.*&quot;</span></span><br><span class="line">        <span class="keyword">if</span> ((name != <span class="literal">null</span>) &amp;&amp; name.startsWith(<span class="string">&quot;java.&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span></span><br><span class="line">                (<span class="string">&quot;Prohibited package name: &quot;</span> +</span><br><span class="line">                 name.substring(<span class="number">0</span>, name.lastIndexOf(<span class="string">&#x27;.&#x27;</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pd == <span class="literal">null</span>) &#123;</span><br><span class="line">            pd = defaultDomain;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (name != <span class="literal">null</span>) checkCerts(name, pd.getCodeSource());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pd;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™ä¸ªæ–¹æ³• <code>preDefineClass</code> çš„ä½œç”¨æ˜¯åœ¨ç±»è¢«å®šä¹‰ä¹‹å‰è¿›è¡Œä¸€äº›å®‰å…¨æ£€æŸ¥å’Œå‡†å¤‡å·¥ä½œï¼Œç¡®ä¿ç±»çš„åˆæ³•æ€§ä¸å®‰å…¨æ€§ã€‚å®ƒé€šå¸¸ç”¨äºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸­ï¼Œä»¥å¢å¼ºç±»åŠ è½½è¿‡ç¨‹ä¸­çš„å®‰å…¨æ§åˆ¶ã€‚</p></li><li class="lvl-2"><p>æ–¹æ³•ä½œç”¨è¯¦è§£ï¼š</p><ul class="lvl-2"><li class="lvl-4">1.é˜²æ­¢å®šä¹‰éæ³•ç±»åçš„ç±»ï¼ˆå¦‚ java.* åŒ…ä¸‹çš„ç±»ï¼‰ï¼š<ul class="lvl-4"><li class="lvl-6">å¦‚æœå°è¯•åŠ è½½çš„ç±»å±äº java. å¼€å¤´çš„æ ‡å‡†åŒ…ï¼ˆå¦‚ java.lang, java.util ç­‰ï¼‰ï¼Œä¼šæŠ›å‡º SecurityExceptionã€‚</li><li class="lvl-6">è¿™æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·è‡ªå®šä¹‰ç±»ä¼ªè£…æˆ Java æ ¸å¿ƒç±»åº“ä¸­çš„ç±»ï¼Œä»è€Œé€ æˆå®‰å…¨é£é™©ã€‚</li></ul></li><li class="lvl-4">2.æ ¡éªŒç±»ååˆæ³•æ€§ï¼š<ul class="lvl-4"><li class="lvl-6">è°ƒç”¨ checkName(name) æ£€æŸ¥ç±»åæ˜¯å¦åˆæ³•ï¼ˆä¾‹å¦‚ä¸èƒ½åŒ…å« /ã€éæ³•å­—ç¬¦ç­‰ï¼‰ï¼Œè‹¥ä¸åˆæ³•åˆ™æŠ›å‡º NoClassDefFoundErrorã€‚</li></ul></li><li class="lvl-4">3.è¯ä¹¦ä¸€è‡´æ€§æ ¡éªŒï¼ˆç­¾åä¸€è‡´æ€§æ ¡éªŒï¼‰ï¼š<ul class="lvl-4"><li class="lvl-6">å¦‚æœç±»æœ‰åç§°ä¸”æä¾›äº† ProtectionDomainï¼Œä¼šè°ƒç”¨ checkCerts(name, codeSource) æ¥ç¡®ä¿å½“å‰ç±»çš„ç­¾åä¸å…¶æ‰€åœ¨åŒ…ä¸­å…¶ä»–ç±»çš„ç­¾åä¸€è‡´ã€‚</li><li class="lvl-6">é˜²æ­¢åŒä¸€åŒ…ä¸­æ··å…¥ä¸åŒç­¾åçš„ç±»ï¼Œé¿å…æ½œåœ¨çš„æ¶æ„ç¯¡æ”¹ã€‚</li></ul></li><li class="lvl-4">4.è®¾ç½®é»˜è®¤ä¿æŠ¤åŸŸï¼ˆProtectionDomainï¼‰ï¼š<ul class="lvl-4"><li class="lvl-6">å¦‚æœä¼ å…¥çš„ ProtectionDomain ä¸º nullï¼Œåˆ™ä½¿ç”¨ç±»åŠ è½½å™¨çš„é»˜è®¤åŸŸ defaultDomainã€‚</li></ul></li></ul></li></ul><h2 id="Linkingé“¾æ¥è¿‡ç¨‹">Linkingé“¾æ¥è¿‡ç¨‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ClassLoaderçš„<code>loadClass</code>â½…æ³•ä¸­ï¼Œè¿˜æœ‰â¼€ä¸ªä¸èµ·çœ¼çš„æ­¥éª¤ï¼Œ<code>resolveClass</code>ã€‚è¿™æ˜¯â¼€ä¸ª<code>native</code>â½…æ³•ã€‚â½½å…¶å®ç°çš„è¿‡ç¨‹ç§°ä¸º<code>linking-é“¾æ¥</code>ã€‚</p></li><li class="lvl-2"><p>é“¾æ¥è¿‡ç¨‹çš„å®ç°åŠŸèƒ½å¦‚ä¸‹å›¾ï¼š<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/9vkhLN.png" alt="" width="900" height="500"></p></li><li class="lvl-2"><p>å…¶ä¸­å…³äºåŠåˆå§‹åŒ–çŠ¶æ€å°±æ˜¯JDKåœ¨å¤„ç†â¼€ä¸ªç±»çš„staticé™æ€å±æ€§æ—¶ï¼Œä¼šå…ˆç»™è¿™ä¸ªå±æ€§åˆ†é…â¼€ä¸ªé»˜è®¤å€¼ï¼Œä½œâ½¤æ˜¯å ä½å†…å­˜ã€‚ç„¶åç­‰è¿æ¥è¿‡ç¨‹å®Œæˆåï¼Œåœ¨åâ¾¯çš„åˆå§‹åŒ–é˜¶æ®µï¼Œå†å°†é™æ€å±æ€§ä»é»˜è®¤å€¼ä¿®æ”¹ä¸ºæŒ‡å®šçš„åˆå§‹å€¼ã€‚</p></li><li class="lvl-2"><p>ç¬¦å·å¼•â½¤å’Œç›´æ¥å¼•â½¤</p></li></ul><blockquote><p>å¦‚æœAç±»ä¸­æœ‰â¼€ä¸ªé™æ€å±æ€§ï¼Œå¼•â½¤äº†å¦â¼€ä¸ªBç±»ã€‚é‚£ä¹ˆåœ¨å¯¹ç±»è¿›â¾åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºAå’ŒBè¿™ä¸¤ä¸ªç±»éƒ½æ²¡æœ‰åˆå§‹åŒ–ï¼ŒJVMå¹¶ä¸çŸ¥é“Aå’ŒBè¿™ä¸¤ä¸ªç±»çš„å…·ä½“åœ°å€ã€‚æ‰€ä»¥è¿™æ—¶ï¼Œåœ¨Aç±»ä¸­ï¼Œåªèƒ½åˆ›å»ºâ¼€ä¸ªä¸çŸ¥é“å…·ä½“åœ°å€çš„å¼•â½¤ï¼ŒæŒ‡å‘Bç±»ã€‚è¿™ä¸ªå¼•â½¤å°±ç§°ä¸ºç¬¦å·å¼•â½¤ã€‚â½½å½“Aç±»å’ŒBç±»éƒ½å®Œæˆåˆå§‹åŒ–åï¼ŒJVMâ¾ƒç„¶å°±éœ€è¦å°†è¿™ä¸ªç¬¦å·å¼•â½¤è½¬â½½æŒ‡å‘Bç±»å…·ä½“çš„å†…å­˜åœ°å€ï¼Œè¿™ä¸ªå¼•â½¤å°±ç§°ä¸ºç›´æ¥å¼•â½¤ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>æ¥çœ‹ä¸€ä¸ªæœ‰æ„æ€çš„ç¤ºä¾‹</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Apple</span> &#123;</span><br><span class="line">    <span class="comment">// é™æ€å˜é‡æŒ‰å£°æ˜é¡ºåºåˆå§‹åŒ–</span></span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•åˆå§‹åŒ–appleå¯¹è±¡æ—¶ï¼Œpriceè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå¤„äºé“¾æ¥è¿‡ç¨‹ä¸­çš„å‡†å¤‡é˜¶æ®µï¼Œå³åŠåˆå§‹åŒ–çŠ¶æ€ï¼Œæ‰€ä»¥priceä¸ºé»˜è®¤å€¼0.0</span></span><br><span class="line">    <span class="keyword">static</span> <span class="type">Apple</span> <span class="variable">apple</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Apple</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="comment">// è§£å†³æ–¹æ³•æ˜¯å°†priceå£°æ˜åœ¨appleçš„ä¸Šé¢å³å¯</span></span><br><span class="line">    <span class="keyword">static</span> <span class="type">double</span> <span class="variable">price</span> <span class="operator">=</span> <span class="number">20.00</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> totalpay;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Apple</span><span class="params">(<span class="type">double</span> discount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;====&quot;</span> + price);</span><br><span class="line">        totalpay = price - discount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PriceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Apple.apple.totalpay); <span class="comment">// -10.0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼Œå°±æ˜¯åªæœ‰å½“<code>loadClass</code>æ–¹æ³•ä¸­çš„<code>resolve</code>å‚æ•°ä¸º<code>true</code>æ—¶<code>resolveClass</code>æ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œ<code>resolve</code>å‚æ•°éƒ½æ˜¯<code>false</code>ï¼Œè¿™ä¸æ˜¯å¼ºåˆ¶é™åˆ¶è€Œæ˜¯å‡ºäºä»¥ä¸‹åŸå› ï¼š</p><ul class="lvl-2"><li class="lvl-4"><ol><li class="lvl-7">é¿å…é€’å½’è§£æä¸­å‡ºç°é”™è¯¯æˆ–æ­»å¾ªç¯<br>åœ¨ç±»çš„è§£æè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¯¥ç±»å¼•ç”¨äº†å¦ä¸€ä¸ªè¿˜æ²¡åŠ è½½çš„ç±»ï¼Œç«‹å³è§£æå¯èƒ½ä¼šå¯¼è‡´æ— é™é€’å½’æˆ–åŠ è½½é¡ºåºé—®é¢˜ã€‚é€šè¿‡å»¶è¿Ÿè§£æï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶åŠ è½½æµç¨‹ã€‚</li></ol></li><li class="lvl-4"><ol start="2"><li class="lvl-7">æé«˜åŠ è½½æ•ˆç‡<br>åŠ è½½ç±»å¯èƒ½ä¸ä¸€å®šé©¬ä¸Šå°±ç”¨åˆ°æ‰€æœ‰æ–¹æ³•ã€å­—æ®µç­‰ç¬¦å·å¼•ç”¨ï¼Œæ¨è¿Ÿè§£æå¯ä»¥æé«˜æ€§èƒ½ï¼Œå°¤å…¶åœ¨æ‰¹é‡åŠ è½½å¾ˆå¤šç±»æ—¶ã€‚</li></ol></li><li class="lvl-4"><ol start="3"><li class="lvl-7">æ›´çµæ´»åœ°å¤„ç†ç±»çš„ä¾èµ–<br>å¼€å‘è€…å¯ä»¥å…ˆåŠ è½½ç±»ï¼Œç¨åæ ¹æ®éœ€è¦å†è§£æã€‚ä¾‹å¦‚ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸­ï¼Œå¯èƒ½å…ˆåˆ¤æ–­ç±»æ˜¯å¦å·²ç»å­˜åœ¨ã€æ˜¯å¦éœ€è¦è¢«å¢å¼ºï¼ˆæ¯”å¦‚å­—èŠ‚ç å¢å¼ºï¼‰ï¼Œå†å†³å®šæ˜¯å¦è§£æã€‚</li></ol></li></ul></li></ul><h2 id="é€šè¿‡ç±»åŠ è½½å™¨å¼•â¼Šå¤–éƒ¨JaråŒ…">é€šè¿‡ç±»åŠ è½½å™¨å¼•â¼Šå¤–éƒ¨JaråŒ…</h2><ul class="lvl-0"><li class="lvl-2"><p>è™½ç„¶é€šå¸¸æˆ‘ä»¬ä¼šå°†ä¾èµ–çš„ jar åŒ…ç›´æ¥æ”¾å…¥é¡¹ç›®çš„ classpath ä¸­ï¼ˆæ¯”å¦‚é€šè¿‡æ„å»ºå·¥å…·å¦‚ Maven æˆ– Gradle ç®¡ç†ï¼‰ï¼Œä½†åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦åŠ¨æ€åœ°é€šè¿‡ URLClassLoader åŠ è½½å¤–éƒ¨ jar åŒ…ï¼Œè¿™æ˜¯ Java æä¾›çš„ä¸€ç§æ›´çµæ´»çš„ç±»åŠ è½½æœºåˆ¶ã€‚</p></li><li class="lvl-2"><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¿…é¡»æˆ–æ¨èä½¿ç”¨ URLClassLoader çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼š</p></li></ul><h3 id="1-æ’ä»¶æœºåˆ¶ï¼ˆPlugin-Systemï¼‰">1. æ’ä»¶æœºåˆ¶ï¼ˆPlugin Systemï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>åœºæ™¯è¯´æ˜ï¼š<br>ç³»ç»Ÿæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶ï¼ˆå¦‚ IDE æ’ä»¶ã€æµè§ˆå™¨æ‰©å±•ã€æ¸¸æˆ modï¼‰ï¼Œè¿™äº›æ’ä»¶åœ¨è¿è¡Œæ—¶æ‰åŠ è½½ï¼Œé¡¹ç›®æœ¬èº«åœ¨ç¼–è¯‘æœŸå¹¶ä¸çŸ¥é“æœ‰å“ªäº›æ’ä»¶ã€‚</p></li><li class="lvl-2"><p>ä¸¾ä¾‹ï¼š<br>Eclipse æˆ– IntelliJ çš„æ’ä»¶ç³»ç»Ÿ<br>Minecraft çš„ mod åŠ è½½å™¨<br>Spring Boot Devtools é‡æ–°åŠ è½½æœºåˆ¶</p></li><li class="lvl-2"><p>ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ”¾å…¥ classpathï¼Ÿ<br>å› ä¸ºæ’ä»¶æ˜¯åŠ¨æ€å‘ç°å’ŒåŠ è½½çš„ï¼Œä¸æ˜¯ç¼–è¯‘æ—¶ç¡®å®šçš„ã€‚</p></li></ul><h3 id="2-çƒ­éƒ¨ç½²-åŠ¨æ€åŠ è½½ç±»">2. çƒ­éƒ¨ç½² / åŠ¨æ€åŠ è½½ç±»</h3><ul class="lvl-0"><li class="lvl-2"><p>åœºæ™¯è¯´æ˜ï¼š<br>ä½ æƒ³åœ¨åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ è½½æ–°çš„ jar æˆ–ç±»ï¼Œæ¯”å¦‚çƒ­æ›´æ–°ä¸€ä¸ªæ¨¡å—è€Œæ— éœ€é‡å¯æœåŠ¡ã€‚</p></li><li class="lvl-2"><p>ä¸¾ä¾‹ï¼š<br>Web å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰çš„åº”ç”¨é‡æ–°éƒ¨ç½²<br>ä½¿ç”¨ URLClassLoader åŠ è½½æŸä¸ªæ¨¡å—çš„æ–°ç‰ˆæœ¬ä»¥å®ç°çƒ­æ›¿æ¢</p></li><li class="lvl-2"><p>ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ<br>classpath åœ¨å¯åŠ¨æ—¶å°±å›ºå®šäº†ï¼Œä¸èƒ½åŠ¨æ€æ·»åŠ ï¼›è€Œ URLClassLoader å¯ä»¥è¿è¡Œæ—¶åŠ è½½æ–° jarã€‚</p></li></ul><h3 id="3-å¤šç‰ˆæœ¬éš”ç¦»">3. å¤šç‰ˆæœ¬éš”ç¦»</h3><ul class="lvl-0"><li class="lvl-2"><p>åœºæ™¯è¯´æ˜ï¼š<br>ä½ å¸Œæœ›ä¸åŒçš„æ¨¡å—ä½¿ç”¨åŒä¸€ä¸ªåº“çš„ä¸åŒç‰ˆæœ¬ï¼Œä½† classpath æ— æ³•æ”¯æŒä¸¤ä¸ªç‰ˆæœ¬çš„åŒä¸€ä¸ªç±»ã€‚</p></li><li class="lvl-2"><p>ä¸¾ä¾‹ï¼š<br>ä¸€ä¸ªæœåŠ¡å™¨è¿è¡Œå¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œå®ƒä»¬åˆ†åˆ«ä¾èµ– log4j çš„ä¸åŒç‰ˆæœ¬<br>ä¸€ä¸ªç³»ç»Ÿçš„æ’ä»¶ A ä½¿ç”¨ fastjson 1.xï¼Œæ’ä»¶ B ä½¿ç”¨ fastjson 2.x</p></li><li class="lvl-2"><p>ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ<br>classpath æ˜¯å…±äº«çš„ï¼Œä¼šå‘ç”Ÿç±»å†²çªã€‚ä½¿ç”¨å¤šä¸ª URLClassLoaderï¼Œå¯å®ç°ç±»éš”ç¦»ã€‚</p></li></ul><h3 id="4-è„šæœ¬æˆ–ç”¨æˆ·ä¸Šä¼ ä»£ç æ‰§è¡Œ">4. è„šæœ¬æˆ–ç”¨æˆ·ä¸Šä¼ ä»£ç æ‰§è¡Œ</h3><ul class="lvl-0"><li class="lvl-2"><p>åœºæ™¯è¯´æ˜ï¼š<br>ç³»ç»Ÿå…è®¸ç”¨æˆ·ä¸Šä¼  jar æˆ– class æ–‡ä»¶ï¼Œç„¶ååœ¨æœåŠ¡ç«¯æ‰§è¡Œå…¶ä¸­çš„ç±»é€»è¾‘ã€‚</p></li><li class="lvl-2"><p>ä¸¾ä¾‹ï¼š<br>åœ¨çº¿ç¼–ç¨‹å¹³å°ï¼ˆå¦‚ LeetCode åç«¯ï¼‰<br>ç”¨æˆ·ä¸Šä¼ ç®—æ³• jarï¼Œå¹³å°è¿è¡Œå¹¶è¿”å›ç»“æœ</p></li><li class="lvl-2"><p>ä¸ºä»€ä¹ˆä¸èƒ½æ”¾å…¥ classpathï¼Ÿ<br>ç”¨æˆ·ä¸Šä¼ å†…å®¹æ˜¯åŠ¨æ€çš„ï¼Œç³»ç»Ÿåœ¨è¿è¡Œå‰æ— æ³•é¢„çŸ¥ã€‚</p></li></ul><h3 id="5-å®ç°ç±»çš„å»¶è¿ŸåŠ è½½ï¼ˆèŠ‚çœèµ„æºï¼‰">5. å®ç°ç±»çš„å»¶è¿ŸåŠ è½½ï¼ˆèŠ‚çœèµ„æºï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>åœºæ™¯è¯´æ˜ï¼š<br>æŸäº›ç±»/æ¨¡å—ä½“ç§¯è¾ƒå¤§æˆ–ä¾èµ–è¾ƒå¤šï¼Œä¸å¸Œæœ›åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±åŠ è½½ï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨æ—¶å†åŠ è½½ã€‚</p></li><li class="lvl-2"><p>ä¸¾ä¾‹ï¼š<br>å¤§å‹æ¡Œé¢åº”ç”¨ï¼ˆå¦‚ IntelliJï¼‰åœ¨æ‰“å¼€æŸä¸ªåŠŸèƒ½æ¨¡å—æ—¶æ‰åŠ è½½ç›¸åº” jar</p></li></ul><h3 id="æ€»ç»“">æ€»ç»“</h3><table><thead><tr><th>åœºæ™¯</th><th>ä½¿ç”¨ <code>URLClassLoader</code> çš„åŸå› </th></tr></thead><tbody><tr><td>æ’ä»¶ç³»ç»Ÿ</td><td>æ’ä»¶åŠ¨æ€åŠ è½½ï¼Œä¸åœ¨é¡¹ç›®ç¼–è¯‘æ—¶å¯çŸ¥</td></tr><tr><td>çƒ­éƒ¨ç½²</td><td>åŠ¨æ€æ›¿æ¢æ¨¡å—ï¼Œæ— éœ€é‡å¯</td></tr><tr><td>å¤šç‰ˆæœ¬å…±å­˜</td><td>é¿å…ç±»å†²çªï¼Œå®ç°ç±»åŠ è½½éš”ç¦»</td></tr><tr><td>ç”¨æˆ·ä¸Šä¼  jar</td><td>å†…å®¹åŠ¨æ€ç”Ÿæˆï¼Œclasspath æ— æ³•é¢„å…ˆé…ç½®</td></tr><tr><td>å»¶è¿ŸåŠ è½½æ¨¡å—</td><td>å¯åŠ¨æ›´å¿«ï¼ŒèŠ‚çœå†…å­˜</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä½ æ˜¯åœ¨åšæ¡†æ¶è®¾è®¡æˆ–éœ€è¦åŠ¨æ€æ‰©å±•èƒ½åŠ›çš„åœºæ™¯ï¼Œç†è§£å¹¶ä½¿ç”¨ URLClassLoader ä¼šéå¸¸æœ‰å¸®åŠ©ã€‚</p></li></ul><h3 id="åœºæ™¯å‡è®¾">åœºæ™¯å‡è®¾</h3><h4 id="è°ƒç”¨å¤–éƒ¨jar">è°ƒç”¨å¤–éƒ¨jar</h4><ul class="lvl-0"><li class="lvl-2"><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨ jar æ–‡ä»¶ï¼šhello-plugin.jarï¼Œå®ƒåŒ…å«ä¸€ä¸ªç±»ï¼š</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªç±»ç¼–è¯‘åæ‰“åŒ…è¿› hello-plugin.jar</span></span><br><span class="line"><span class="keyword">package</span> com.example.plugin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloPlugin</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello from plugin! :&quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸»ç¨‹åºä½¿ç”¨ URLClassLoader åŠ¨æ€åŠ è½½è¿™ä¸ª jar</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PluginLoader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// å¤–éƒ¨ jar çš„è·¯å¾„</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">jarFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;plugins/hello-plugin.jar&quot;</span>);</span><br><span class="line">        <span class="type">URL</span> <span class="variable">jarUrl</span> <span class="operator">=</span> jarFile.toURI().toURL();</span><br><span class="line">        <span class="comment">// HTTPS jar çš„ URL</span></span><br><span class="line">        <span class="comment">// URL jarUrl = new URL(&quot;https://your-domain.com/libs/hello-plugin.jar&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„å»º URLClassLoaderï¼ˆä¹Ÿå¯ä»¥è®¾ç½®çˆ¶åŠ è½½å™¨ï¼‰</span></span><br><span class="line">        <span class="type">URLClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLClassLoader</span>(<span class="keyword">new</span> <span class="title class_">URL</span>[]&#123;jarUrl&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ è½½æ’ä»¶ç±»</span></span><br><span class="line">        Class&lt;?&gt; clazz = classLoader.loadClass(<span class="string">&quot;com.example.plugin.HelloPlugin&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">plugin</span> <span class="operator">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">sayHello</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;sayHello&quot;</span>, String.class);</span><br><span class="line">        sayHello.invoke(plugin, <span class="string">&quot;World&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­ ClassLoaderï¼ˆJava 7+ æ¨èï¼‰</span></span><br><span class="line">        classLoader.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œæ—¶åŠ¨æ€ç¼–è¯‘-Java-æºä»£ç ">è¿è¡Œæ—¶åŠ¨æ€ç¼–è¯‘ Java æºä»£ç </h4><ul class="lvl-0"><li class="lvl-2"><p>æˆ‘ä»¬æœ‰ä¸€ä¸ª java ä»£ç ç‰‡æ®µï¼š</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.tools.JavaCompiler;</span><br><span class="line"><span class="keyword">import</span> javax.tools.ToolProvider;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLClassLoader;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicJavaRunner</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> <span class="string">&quot;com.example.dynamic.Hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Java æºä»£ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sourceCode</span> <span class="operator">=</span></span><br><span class="line">                <span class="string">&quot;package com.example.dynamic;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;public class Hello &#123;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;    public void say() &#123;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;        System.out.println(\&quot;Hello from dynamic source!\&quot;);\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸´æ—¶ç›®å½•</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">tempDir</span> <span class="operator">=</span> Files.createTempDirectory(<span class="string">&quot;dynamic-classes&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">outputDir</span> <span class="operator">=</span> tempDir.toFile();</span><br><span class="line">        <span class="comment">// System.out.println(&quot;ä¸´æ—¶ç›®å½•ï¼š&quot; + outputDir.getAbsolutePath());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»º .java æ–‡ä»¶</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">javaFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(outputDir, <span class="string">&quot;com/example/dynamic/Hello.java&quot;</span>);</span><br><span class="line">        javaFile.getParentFile().mkdirs();</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(javaFile)) &#123;</span><br><span class="line">            writer.write(sourceCode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¼–è¯‘ Java æ–‡ä»¶</span></span><br><span class="line">        <span class="type">JavaCompiler</span> <span class="variable">compiler</span> <span class="operator">=</span> ToolProvider.getSystemJavaCompiler();</span><br><span class="line">        <span class="keyword">if</span> (compiler == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;è¯·ç”¨ JDK è€Œé JRE è¿è¡Œï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> compiler.run(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, javaFile.getPath());</span><br><span class="line">        <span class="keyword">if</span> (result != <span class="number">0</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;ç¼–è¯‘å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ è½½ç±»å¹¶è°ƒç”¨</span></span><br><span class="line">        <span class="type">URLClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLClassLoader</span>(<span class="keyword">new</span> <span class="title class_">URL</span>[]&#123;outputDir.toURI().toURL()&#125;);</span><br><span class="line">        Class&lt;?&gt; clazz = classLoader.loadClass(className);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;say&quot;</span>);</span><br><span class="line">        method.invoke(instance);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¸…ç†ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">        classLoader.close();</span><br><span class="line">        <span class="comment">// åˆ é™¤ä¸´æ—¶ç›®å½•</span></span><br><span class="line">        Files.walk(outputDir.toPath())</span><br><span class="line">                .sorted(Comparator.reverseOrder()) <span class="comment">// å…ˆåˆ æ–‡ä»¶ï¼Œå†åˆ ç›®å½•</span></span><br><span class="line">                .map(Path::toFile)</span><br><span class="line">                .forEach(File::delete);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å…³é”®ç‚¹è¯´æ˜</p></li></ul><table><thead><tr><th>æœºåˆ¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>JavaCompiler</code></td><td>JDK è‡ªå¸¦çš„ç¼–è¯‘å™¨ï¼ˆ<code>tools.jar</code>ï¼‰</td></tr><tr><td><code>ToolProvider.getSystemJavaCompiler()</code></td><td>åªèƒ½åœ¨ JDK ç¯å¢ƒä¸­å·¥ä½œï¼ŒJRE æ— æ³•ä½¿ç”¨</td></tr><tr><td><code>URLClassLoader</code></td><td>ç”¨äºåŠ è½½ç¼–è¯‘åçš„ .class æ–‡ä»¶</td></tr><tr><td><code>FileWriter</code></td><td>ä¿å­˜ä»£ç ä¸ºä¸´æ—¶ Java æ–‡ä»¶</td></tr></tbody></table><h2 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨">è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h2><ul class="lvl-0"><li class="lvl-2"><p>è¦è‡ªå®šä¹‰ ClassLoaderï¼Œåªéœ€è¦ç»§æ‰¿äº <code>ClassLoader</code> æˆ–è€… <code>SecureClassLoader</code>ï¼Œå¹¶é‡å†™ <code>findClass()</code> æ–¹æ³•å³å¯</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œå‡çº§ï¼Œä¸åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­ç¼–è¯‘ä»£ç ï¼Œå¹¶ä»å†…å­˜ä¸­åŠ è½½å­—èŠ‚ç ï¼Œè€Œä¸ä¾èµ–ç£ç›˜æ–‡ä»¶ï¼Œæ›´é«˜æ•ˆä¹Ÿæ›´é€‚åˆç”Ÿäº§ç¯å¢ƒä¸­åŠ¨æ€ç±»åŠ è½½ï¼ˆå¦‚åœ¨çº¿ä»£ç æ‰§è¡Œã€è„šæœ¬å¼•æ“ç­‰ï¼‰ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.tools.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InMemoryJavaRunner</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> <span class="string">&quot;com.example.dynamic.Hello&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sourceCode</span> <span class="operator">=</span></span><br><span class="line">                <span class="string">&quot;package com.example.dynamic;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;public class Hello &#123;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;    public void say() &#123;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;        System.out.println(\&quot;Hello from memory compiled class!\&quot;);\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–ç³»ç»Ÿ Java ç¼–è¯‘å™¨</span></span><br><span class="line">        <span class="type">JavaCompiler</span> <span class="variable">compiler</span> <span class="operator">=</span> ToolProvider.getSystemJavaCompiler();</span><br><span class="line">        <span class="keyword">if</span> (compiler == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;è¯·ä½¿ç”¨ JDK è¿è¡Œæ­¤ç¨‹åºï¼ˆé JREï¼‰&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‡†å¤‡ç¼–è¯‘æºä»£ç ï¼šä¸€ä¸ª JavaFileObject è¡¨ç¤ºæºä»£ç </span></span><br><span class="line">        <span class="type">JavaFileObject</span> <span class="variable">sourceFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaSourceFromString</span>(className, sourceCode);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºè‡ªå®šä¹‰çš„å†…å­˜æ–‡ä»¶ç®¡ç†å™¨ï¼ˆæ›¿ä»£æ ‡å‡†çš„ç£ç›˜ç®¡ç†å™¨ï¼‰</span></span><br><span class="line">        <span class="type">StandardJavaFileManager</span> <span class="variable">standardFileManager</span> <span class="operator">=</span> compiler.getStandardFileManager(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">MemoryJavaFileManager</span> <span class="variable">fileManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MemoryJavaFileManager</span>(standardFileManager);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œç¼–è¯‘ä»»åŠ¡</span></span><br><span class="line">        JavaCompiler.<span class="type">CompilationTask</span> <span class="variable">task</span> <span class="operator">=</span> compiler.getTask(<span class="literal">null</span>, fileManager, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, Collections.singletonList(sourceFile));</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> task.call();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;ç¼–è¯‘å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ è½½ç¼–è¯‘åçš„ç±»</span></span><br><span class="line">        Map&lt;String, <span class="type">byte</span>[]&gt; classBytes = fileManager.getClassBytes();</span><br><span class="line">        <span class="type">InMemoryClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryClassLoader</span>(classBytes);</span><br><span class="line">        Class&lt;?&gt; clazz = classLoader.loadClass(className);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;say&quot;</span>);</span><br><span class="line">        method.invoke(instance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨äºè¡¨ç¤ºå†…å­˜ä¸­çš„ Java æºä»£ç </span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">JavaSourceFromString</span> <span class="keyword">extends</span> <span class="title class_">SimpleJavaFileObject</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> String code;</span><br><span class="line"></span><br><span class="line">        JavaSourceFromString(String className, String code) &#123;</span><br><span class="line">            <span class="built_in">super</span>(URI.create(<span class="string">&quot;string:///&quot;</span> + className.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>) + Kind.SOURCE.extension), Kind.SOURCE);</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> CharSequence <span class="title function_">getCharContent</span><span class="params">(<span class="type">boolean</span> ignoreEncodingErrors)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ç¼–è¯‘çš„ class æ–‡ä»¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆä¸æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼‰</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MemoryJavaFileManager</span> <span class="keyword">extends</span> <span class="title class_">ForwardingJavaFileManager</span>&lt;StandardJavaFileManager&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ByteArrayOutputStream&gt; classOutputBuffers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        MemoryJavaFileManager(StandardJavaFileManager standardManager) &#123;</span><br><span class="line">            <span class="built_in">super</span>(standardManager);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> JavaFileObject <span class="title function_">getJavaFileForOutput</span><span class="params">(Location location, String className,</span></span><br><span class="line"><span class="params">                                                   JavaFileObject.Kind kind, FileObject sibling)</span> &#123;</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            classOutputBuffers.put(className, outputStream);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleJavaFileObject</span>(</span><br><span class="line">                    URI.create(<span class="string">&quot;mem:///&quot;</span> + className.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>) + kind.extension), kind) &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> OutputStream <span class="title function_">openOutputStream</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> outputStream;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Map&lt;String, <span class="type">byte</span>[]&gt; getClassBytes() &#123;</span><br><span class="line">            Map&lt;String, <span class="type">byte</span>[]&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, ByteArrayOutputStream&gt; entry : classOutputBuffers.entrySet()) &#123;</span><br><span class="line">                result.put(entry.getKey(), entry.getValue().toByteArray());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰ ClassLoaderï¼Œç”¨äºä»å†…å­˜ä¸­åŠ è½½å­—èŠ‚ç </span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InMemoryClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, <span class="type">byte</span>[]&gt; classBytes;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">InMemoryClassLoader</span><span class="params">(Map&lt;String, <span class="type">byte</span>[]&gt; classBytes)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(ClassLoader.getSystemClassLoader());</span><br><span class="line">            <span class="built_in">this</span>.classBytes = classBytes;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">            <span class="comment">// ä»å†…å­˜ä¸­è·å–å­—èŠ‚ç </span></span><br><span class="line">            <span class="type">byte</span>[] bytes = classBytes.get(name);</span><br><span class="line">            <span class="keyword">if</span> (bytes == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">super</span>.findClass(name);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å®šä¹‰ç±»å¹¶è¿”å›ï¼Œä¸€å®šè¦ä½¿ç”¨ defineClass æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">return</span> defineClass(name, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿›ä¸€æ­¥å‡çº§ï¼šæˆ‘ä»¬ç°åœ¨å°†è¿™ä¸ªç³»ç»Ÿæ‰©å±•ä¸ºæ”¯æŒå¤šä¸ªç±»åŒæ—¶åŠ¨æ€ç¼–è¯‘ã€å†…å­˜åŠ è½½å¹¶æ‰§è¡Œã€‚è¿™å¯¹äºéœ€è¦å¤„ç†å¤šä¸ªç±»ï¼ˆä¾‹å¦‚æ¥å£ + å®ç°ã€å†…éƒ¨ä¾èµ–ç­‰ï¼‰éå¸¸å®ç”¨ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.tools.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiClassInMemoryCompiler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// å‡†å¤‡å¤šä¸ªç±»çš„æºä»£ç </span></span><br><span class="line">        Map&lt;String, String&gt; sources = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        sources.put(<span class="string">&quot;com.example.api.Greeter&quot;</span>,</span><br><span class="line">                <span class="string">&quot;package com.example.api;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;public interface Greeter &#123;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;    void greet();\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&#125;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        sources.put(<span class="string">&quot;com.example.impl.EnglishGreeter&quot;</span>,</span><br><span class="line">                <span class="string">&quot;package com.example.impl;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;import com.example.api.Greeter;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;public class EnglishGreeter implements Greeter &#123;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;    public void greet() &#123;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;        System.out.println(\&quot;Hello from EnglishGreeter!\&quot;);\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&#125;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">entryClassName</span> <span class="operator">=</span> <span class="string">&quot;com.example.impl.EnglishGreeter&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¼–è¯‘</span></span><br><span class="line">        Map&lt;String, <span class="type">byte</span>[]&gt; compiledClasses = compile(sources);</span><br><span class="line">        <span class="keyword">if</span> (compiledClasses == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;ç¼–è¯‘å¤±è´¥&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ è½½å¹¶æ‰§è¡Œ</span></span><br><span class="line">        <span class="type">InMemoryClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryClassLoader</span>(compiledClasses);</span><br><span class="line">        Class&lt;?&gt; clazz = classLoader.loadClass(entryClassName);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;greet&quot;</span>);</span><br><span class="line">        method.invoke(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨å…¥å£ï¼Œæ”¯æŒå¤šä¸ªç±»</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, <span class="type">byte</span>[]&gt; compile(Map&lt;String, String&gt; sources) &#123;</span><br><span class="line">        <span class="type">JavaCompiler</span> <span class="variable">compiler</span> <span class="operator">=</span> ToolProvider.getSystemJavaCompiler();</span><br><span class="line">        <span class="keyword">if</span> (compiler == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;è¯·ä½¿ç”¨ JDK è¿è¡Œ&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;JavaFileObject&gt; compilationUnits = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : sources.entrySet()) &#123;</span><br><span class="line">            compilationUnits.add(<span class="keyword">new</span> <span class="title class_">JavaSourceFromString</span>(entry.getKey(), entry.getValue()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">StandardJavaFileManager</span> <span class="variable">stdManager</span> <span class="operator">=</span> compiler.getStandardFileManager(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">MemoryJavaFileManager</span> <span class="variable">memManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MemoryJavaFileManager</span>(stdManager);</span><br><span class="line"></span><br><span class="line">        JavaCompiler.<span class="type">CompilationTask</span> <span class="variable">task</span> <span class="operator">=</span> compiler.getTask(<span class="literal">null</span>, memManager, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, compilationUnits);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> task.call();</span><br><span class="line">        <span class="keyword">return</span> success ? memManager.getClassBytes() : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æºæ–‡ä»¶è¡¨ç¤ºï¼ˆJava ä»£ç ä»¥å­—ç¬¦ä¸²æä¾›ï¼‰</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">JavaSourceFromString</span> <span class="keyword">extends</span> <span class="title class_">SimpleJavaFileObject</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> String code;</span><br><span class="line"></span><br><span class="line">        JavaSourceFromString(String className, String code) &#123;</span><br><span class="line">            <span class="built_in">super</span>(URI.create(<span class="string">&quot;string:///&quot;</span> + className.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>) + Kind.SOURCE.extension), Kind.SOURCE);</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> CharSequence <span class="title function_">getCharContent</span><span class="params">(<span class="type">boolean</span> ignoreEncodingErrors)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†…å­˜ä¸­çš„ç¼–è¯‘è¾“å‡ºç®¡ç†å™¨</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MemoryJavaFileManager</span> <span class="keyword">extends</span> <span class="title class_">ForwardingJavaFileManager</span>&lt;StandardJavaFileManager&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ByteArrayOutputStream&gt; classOutputBuffers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        MemoryJavaFileManager(StandardJavaFileManager standardManager) &#123;</span><br><span class="line">            <span class="built_in">super</span>(standardManager);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> JavaFileObject <span class="title function_">getJavaFileForOutput</span><span class="params">(Location location, String className,</span></span><br><span class="line"><span class="params">                                                   JavaFileObject.Kind kind, FileObject sibling)</span> &#123;</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            classOutputBuffers.put(className, outputStream);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleJavaFileObject</span>(</span><br><span class="line">                    URI.create(<span class="string">&quot;mem:///&quot;</span> + className.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>) + kind.extension), kind) &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> OutputStream <span class="title function_">openOutputStream</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> outputStream;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Map&lt;String, <span class="type">byte</span>[]&gt; getClassBytes() &#123;</span><br><span class="line">            Map&lt;String, <span class="type">byte</span>[]&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, ByteArrayOutputStream&gt; entry : classOutputBuffers.entrySet()) &#123;</span><br><span class="line">                result.put(entry.getKey(), entry.getValue().toByteArray());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨äºåŠ è½½å†…å­˜ä¸­çš„ class</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InMemoryClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, <span class="type">byte</span>[]&gt; classBytes;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">InMemoryClassLoader</span><span class="params">(Map&lt;String, <span class="type">byte</span>[]&gt; classBytes)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(ClassLoader.getSystemClassLoader());</span><br><span class="line">            <span class="built_in">this</span>.classBytes = classBytes;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = classBytes.get(name);</span><br><span class="line">            <span class="keyword">if</span> (bytes == <span class="literal">null</span>) <span class="keyword">return</span> <span class="built_in">super</span>.findClass(name);</span><br><span class="line">            <span class="keyword">return</span> defineClass(name, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°åŒç±»å¤šç‰ˆæœ¬å…±å­˜">æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°åŒç±»å¤šç‰ˆæœ¬å…±å­˜</h2><ul class="lvl-0"><li class="lvl-2"><p>å‡è®¾æˆ‘ä»¬æœ‰åŒä¸€ä¸ªjaråŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼š<code>a-1.0.jar</code>å’Œ<code>a-2.0.jar</code>ï¼Œä»–ä»¬å…·æœ‰åŒåçš„ <code>DemoClass</code>ç±» ,ç³»ç»Ÿ<code>classpath</code>ä¸­å¼•å…¥çš„æ˜¯ <code>a-1.0.jar</code>ï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬é€šè¿‡â¾ƒå®šçš„ClassLoaderåŠ è½½ <code>a-2.0.jar</code>ï¼Œå¹¶è°ƒç”¨ <code>DemoClass</code>ç±» ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œâ¾ƒå®šçš„ClassLoaderåŠ è½½çš„ç±»ä¾æ—§æ˜¯ <code>a-1.0.jar</code> ä¸­çš„ç±»ï¼Œè€Œä¸æ˜¯ <code>a-2.0.jar</code> ä¸­çš„ç±»ã€‚</p></li><li class="lvl-2"><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿè¿™å°±æ˜¯å› ä¸ºJDKçš„åŒäº²å§”æ´¾æœºåˆ¶ã€‚â¾ƒå®šçš„ClassLoaderçš„<code>parent</code>å±æ€§æŒ‡å‘çš„æ˜¯JDKå†…çš„<code>AppClassLoader</code>ï¼Œâ½½ <code>AppClassLoader</code> ä¼šåŠ è½½ç³»ç»Ÿå½“ä¸­çš„æ‰€æœ‰ä»£ç ï¼Œå°±åŒ…æ‹¬ <code>a-1.0.jar</code>ä¸­çš„ <code>DemoClass</code>ç±»ã€‚è¿™æ—¶ï¼Œâ¾ƒå®šçš„ClassLoaderå»åŠ è½½ <code>DemoClass</code>ç±»æ—¶ï¼Œé€šè¿‡åŒäº²å§”æ´¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œâ¾ƒç„¶åŠ è½½å‡ºæ¥çš„å°±æ˜¯APPClassloaderä¸­çš„<code>DemoClass</code>äº†ã€‚</p></li><li class="lvl-2"><p>å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ <code>loadClass()</code>æ–¹æ³•ï¼Œæ¥æ‰“ç ´åŒäº²å§”æ´¾ï¼Œå®ç°ç±»â½‚ä»¶çš„åŠ è½½ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLConnection;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomClassLoader</span> <span class="keyword">extends</span> <span class="title class_">SecureClassLoader</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> URL jarUrl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomClassLoader</span><span class="params">(URL jarUrl)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„å­ç±»åŠ è½½å™¨ï¼ŒåªåŠ è½½æŒ‡å®š JAR</span></span><br><span class="line">        <span class="built_in">this</span>.jarUrl = jarUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// æŠŠåŒäº²å§”æ´¾æœºåˆ¶åè¿‡æ¥ï¼Œå…ˆåˆ°â¼¦ç±»åŠ è½½å™¨ä¸­åŠ è½½ï¼ŒåŠ è½½ä¸åˆ°å†å»â½—ç±»åŠ è½½å™¨ä¸­åŠ è½½ã€‚</span></span><br><span class="line">        <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœç±»å·²åŠ è½½ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">            Class&lt;?&gt; loadedClass = findLoadedClass(name);</span><br><span class="line">            <span class="keyword">if</span> (loadedClass == <span class="literal">null</span>) &#123;</span><br><span class="line">                loadedClass = findClass(name);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨</span></span><br><span class="line">                loadedClass = <span class="built_in">super</span>.loadClass(name, resolve);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> loadedClass;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) &#123;</span><br><span class="line">        <span class="type">int</span> code;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è®¿é—®jaråŒ…çš„url</span></span><br><span class="line">            <span class="type">URLConnection</span> <span class="variable">urlConnection</span> <span class="operator">=</span> jarUrl.openConnection();</span><br><span class="line">            urlConnection.setUseCaches(<span class="literal">false</span>);</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> urlConnection.getInputStream();</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="keyword">while</span> ((code = is.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                bos.write(code);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">byte</span>[] data = bos.toByteArray();</span><br><span class="line">            is.close();</span><br><span class="line">            bos.close();</span><br><span class="line">            <span class="keyword">return</span> defineClass(name, data, <span class="number">0</span>, data.length);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµ‹è¯•ä»£ç </p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">jarFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;path/to/a-2.0.jar&quot;</span>);</span><br><span class="line">        <span class="type">URL</span> <span class="variable">jarUrl</span> <span class="operator">=</span> jarFile.toURI().toURL();</span><br><span class="line"></span><br><span class="line">        <span class="type">CustomClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomClassLoader</span>(jarUrl);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ è½½ DemoClass</span></span><br><span class="line">        Class&lt;?&gt; clazz = loader.loadClass(<span class="string">&quot;com.example.DemoClass&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class="line">        clazz.getMethod(<span class="string">&quot;print&quot;</span>).invoke(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„å…¸å‹åœºæ™¯">æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„å…¸å‹åœºæ™¯</h3><h4 id="Tomcatç±»åŠ è½½å™¨">Tomcatç±»åŠ è½½å™¨</h4><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/eGKhDn.png" alt="" width="550" height="700"></p><ul class="lvl-0"><li class="lvl-2"><p>CommonClassLoaderï¼šTomcatæœ€åŸºæœ¬çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯ä»¥è¢«Tomcatå®¹å™¨æœ¬èº«ä»¥åŠå„ä¸ªWebappè®¿é—®ï¼›</p></li><li class="lvl-2"><p>CatalinaClassLoaderï¼šTomcatå®¹å™¨ç§æœ‰çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºWebappä¸å¯â»…ï¼›</p></li><li class="lvl-2"><p>SharedClassLoaderï¼šå„ä¸ªWebappå…±äº«çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºæ‰€æœ‰Webappå¯â»…ï¼Œä½†æ˜¯å¯¹äºTomcatå®¹å™¨ä¸å¯â»…ï¼›</p></li><li class="lvl-2"><p>WebappClassLoaderï¼šå„ä¸ªWebappç§æœ‰çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classåªå¯¹å½“å‰Webappå¯â»…ï¼Œâ½å¦‚åŠ è½½waråŒ…â¾¥ç›¸å…³çš„ç±»ï¼Œæ¯ä¸ªwaråŒ…åº”â½¤éƒ½æœ‰â¾ƒâ¼°çš„WebappClassLoaderï¼Œå®ç°ç›¸äº’éš”ç¦»ï¼Œâ½å¦‚ä¸åŒwaråŒ…åº”â½¤å¼•â¼Šäº†ä¸åŒçš„springç‰ˆæœ¬ï¼Œè¿™æ ·å®ç°å°±èƒ½åŠ è½½å„â¾ƒçš„springç‰ˆæœ¬ï¼›</p></li><li class="lvl-2"><p>Jspç±»åŠ è½½å™¨ï¼šé’ˆå¯¹æ¯ä¸ªJSPâ»šâ¾¯åˆ›å»ºâ¼€ä¸ªåŠ è½½å™¨ã€‚è¿™ä¸ªåŠ è½½å™¨â½è¾ƒè½»é‡çº§ï¼Œæ‰€ä»¥Tomcatè¿˜å®ç°äº†çƒ­åŠ è½½ï¼Œä¹Ÿå°±æ˜¯JSPåªè¦ä¿®æ”¹äº†ï¼Œå°±åˆ›å»ºâ¼€ä¸ªæ–°çš„åŠ è½½å™¨ï¼Œä»â½½å®ç°äº†JSPâ»šâ¾¯çš„çƒ­æ›´æ–°ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»JVMçš„ç±»åŠ è½½å™¨&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/specs/jvms/se8/html/index.html&quot;&gt;The JavaÂ® Virtual Machine Specification&lt;/a&gt; ç‰ˆæœ¬jdk1.8&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="jvm" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/jvm/"/>
    
    
    <category term="jvm" scheme="https://blog.hanqunfeng.com/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢</title>
    <link href="https://blog.hanqunfeng.com/2025/04/22/elasticsearch-06-api-aggs/"/>
    <id>https://blog.hanqunfeng.com/2025/04/22/elasticsearch-06-api-aggs/</id>
    <published>2025-04-22T13:30:05.000Z</published>
    <updated>2025-04-24T02:53:13.488Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIsï¼šèšåˆæŸ¥è¯¢</p></li><li class="lvl-2"><p>Elasticsearchç‰ˆæœ¬8.17.3</p></li><li class="lvl-2"><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.17/rest-apis.html">å®˜æ–¹æ–‡æ¡£:REST APIs</a></p></li><li class="lvl-2"><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.17/search-aggregations.html">å®˜æ–¹æ–‡æ¡£:Aggregations</a></p></li><li class="lvl-2"><a href="/2025/04/17/elasticsearch-05-api/" title="Elasticsearch çš„ REST APIs">Elasticsearch çš„ REST APIs</a></li></ul><span id="more"></span><h2 id="èšåˆæŸ¥è¯¢">èšåˆæŸ¥è¯¢</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html">èšåˆæŸ¥è¯¢</a>ï¼Œå¯ä»¥è®©æˆ‘ä»¬æå…¶æ–¹ä¾¿çš„å®ç°å¯¹ç´¢å¼•æ•°æ®çš„ç»Ÿè®¡ã€åˆ†æã€è¿ç®—ç­‰æ“ä½œã€‚</p></li><li class="lvl-2"><p>åŸºæœ¬è¯­æ³•åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š</p><ul class="lvl-2"><li class="lvl-4">æŸ¥è¯¢æ¡ä»¶ï¼šæŒ‡å®šéœ€è¦èšåˆçš„æ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Elasticsearch æŸ¥è¯¢è¯­æ³•ï¼Œå¦‚ termã€matchã€range ç­‰ç­‰ã€‚</li><li class="lvl-4">èšåˆå‡½æ•°ï¼šæŒ‡å®šè¦æ‰§è¡Œçš„èšåˆæ“ä½œï¼Œå¦‚ sumã€avgã€minã€maxã€termsã€date_histogram ç­‰ç­‰ã€‚æ¯ä¸ªèšåˆå‘½ä»¤éƒ½ä¼šç”Ÿæˆä¸€ä¸ªèšåˆç»“æœã€‚</li><li class="lvl-4">èšåˆåµŒå¥—ï¼šèšåˆå‘½ä»¤å¯ä»¥åµŒå¥—ï¼Œä»¥ä¾¿æ›´ç»†ç²’åº¦åœ°åˆ†ææ•°æ®ã€‚</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET &lt;index_name&gt;/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;&lt;aggs_name&gt;&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;&lt;agg_type&gt;&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;&lt;field_name&gt;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è¯´æ˜</span></span><br><span class="line">  <span class="comment"># aggsï¼šèšåˆçš„æ ¹èŠ‚ç‚¹ï¼Œå›ºå®šå†™æ³•</span></span><br><span class="line">  <span class="comment"># aggs_nameï¼šèšåˆå‡½æ•°çš„åç§°ï¼Œè‡ªå·±éšæ„å®šä¹‰</span></span><br><span class="line">  <span class="comment"># agg_typeï¼šèšåˆç§ç±»ï¼Œæ¯”å¦‚æ˜¯æ¡¶èšåˆï¼ˆtermsï¼‰æˆ–è€…æ˜¯æŒ‡æ ‡èšåˆï¼ˆavgã€sumã€minã€maxç­‰ï¼‰</span></span><br><span class="line">  <span class="comment"># field_nameï¼šå­—æ®µåç§°æˆ–è€…å«åŸŸåã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>èšåˆçš„åˆ†ç±»</p><ul class="lvl-2"><li class="lvl-4">Metric Aggregationï¼šâ€”äº›æ•°å­¦è¿ç®—ï¼Œå¯ä»¥å¯¹æ–‡æ¡£å­—æ®µè¿›è¡Œç»Ÿè®¡åˆ†æï¼Œç±»æ¯”Mysqlä¸­çš„ min(), max(), sum() æ“ä½œã€‚</li><li class="lvl-4">Bucket Aggregationï¼šä¸€äº›æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£çš„é›†åˆæ”¾ç½®åˆ°ä¸€ä¸ªæ¡¶é‡Œï¼Œæ¯ä¸€ä¸ªæ¡¶å…³è”ä¸€ä¸ªkeyï¼Œç±»æ¯”Mysqlä¸­çš„group byæ“ä½œã€‚</li><li class="lvl-4">Pipeline Aggregationï¼šå¯¹å…¶ä»–çš„èšåˆç»“æœè¿›è¡ŒäºŒæ¬¡èšåˆ</li></ul></li></ul><h2 id="ç¤ºä¾‹æ•°æ®å‡†å¤‡">ç¤ºä¾‹æ•°æ®å‡†å¤‡</h2><ul class="lvl-0"><li class="lvl-2"><p>æˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡ä¸€äº›æ•°æ®ï¼Œæ‰èƒ½è¿›è¡Œèšåˆåˆ†æã€‚</p></li><li class="lvl-2"><p>åˆ›å»ºç´¢å¼•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœå­˜åœ¨å…ˆåˆ é™¤</span></span><br><span class="line">curl -X DELETE -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºç´¢å¼•</span></span><br><span class="line">curl -X PUT -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;settings&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;number_of_shards&quot;:&quot;1&quot;,</span></span><br><span class="line"><span class="string">      &quot;number_of_replicas&quot;:&quot;2&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;mappings&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;properties&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;category&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;keyword&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;price&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;double&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;count&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;integer&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;title&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;text&quot;,</span></span><br><span class="line"><span class="string">          &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">          &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;remark&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;type&quot;:&quot;text&quot;,</span></span><br><span class="line"><span class="string">        &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &quot;address&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;type&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="string">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">        &quot;fields&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;keyword&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &quot;tags&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’å…¥æ•°æ®</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;1&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;2&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;3&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;4&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;5&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;6&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Metric-Aggregation-æŒ‡æ ‡èšåˆ">Metric Aggregation(æŒ‡æ ‡èšåˆ)</h2><h3 id="å•å€¼åˆ†æï¸°åªè¾“å‡ºä¸€ä¸ªåˆ†æç»“æœ">å•å€¼åˆ†æï¸°åªè¾“å‡ºä¸€ä¸ªåˆ†æç»“æœ</h3><ul class="lvl-0"><li class="lvl-2"><p>min, max, avg, sum</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ€»å’Œ</span></span><br><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,  <span class="comment"># ä¸è¿”å›æ–‡æ¡£ï¼Œåªè¿”å›èšåˆç»“æœ</span></span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;max_price&quot;</span>: &#123; <span class="comment"># è‡ªå®šä¹‰åç§°ï¼Œè¿™é‡Œè¿”å›æœ€å¤§å€¼</span></span><br><span class="line">      <span class="string">&quot;max&quot;</span>: &#123;     <span class="comment"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°</span></span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span> <span class="comment"># æŒ‡æ ‡èšåˆå­—æ®µ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;min_price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;min&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;avg_price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;sum_price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;sum&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Cardinalityï¼ˆç±»ä¼¼distinct Count)</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0, <span class="comment"># ä¸è¿”å›æ–‡æ¡£ï¼Œåªè¿”å›èšåˆç»“æœ</span></span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;cardinality_count&quot;</span>: &#123; <span class="comment"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›å»é‡åçš„æ•°é‡</span></span><br><span class="line">      <span class="string">&quot;cardinality&quot;</span>: &#123;  <span class="comment"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œcardinalityè¡¨ç¤ºå»é‡</span></span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;category&quot;</span> <span class="comment"># æŒ‡æ ‡èšåˆå­—æ®µï¼Œå»é‡çš„å­—æ®µ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤šå€¼åˆ†æ-è¾“å‡ºå¤šä¸ªåˆ†æç»“æœ">å¤šå€¼åˆ†æ:è¾“å‡ºå¤šä¸ªåˆ†æç»“æœ</h3><ul class="lvl-0"><li class="lvl-2"><p>statsï¼ˆç»Ÿè®¡ï¼‰, extended stats</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;stats_price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;stats&quot;</span>: &#123; <span class="comment"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œstatsè¡¨ç¤ºç»Ÿè®¡ï¼Œä¼šè¿”å›å¤šä¸ªæŒ‡æ ‡</span></span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span>: 15,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 12,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span>: <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span>: null,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span>: []     <span class="comment"># å› ä¸ºè®¾ç½®size ä¸º 0ï¼Œæ‰€ä»¥è¿”å›çš„ç»“æœä¸ºç©º</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123; <span class="comment"># èšåˆç»“æœ</span></span><br><span class="line">    <span class="string">&quot;stats_price&quot;</span>: &#123; <span class="comment"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›å¤šç»„èšåˆç»“æœ</span></span><br><span class="line">      <span class="string">&quot;count&quot;</span>: 12,</span><br><span class="line">      <span class="string">&quot;min&quot;</span>: 3.99,</span><br><span class="line">      <span class="string">&quot;max&quot;</span>: 1999.99,</span><br><span class="line">      <span class="string">&quot;avg&quot;</span>: 562.1666666666666,</span><br><span class="line">      <span class="string">&quot;sum&quot;</span>: 6746</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>percentile ï¼ˆç™¾åˆ†ä½ï¼‰, percentile rank</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;percentile_price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;percentiles&quot;</span>: &#123; <span class="comment"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œpercentilesè¡¨ç¤ºç™¾åˆ†ä½æ•°èšåˆè®¡ç®—</span></span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>, <span class="comment"># æŒ‡æ ‡èšåˆå­—æ®µ</span></span><br><span class="line">        <span class="string">&quot;percents&quot;</span>: [1, 5, 25, 50, 75, 95, 99] <span class="comment"># éœ€è¦è®¡ç®—ç™¾åˆ†ä½æ•°çš„æ•°ç»„</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ç™¾åˆ†ä½æ•°æ˜¯ä¸€ä¸ªç»Ÿè®¡å­¦æ¦‚å¿µï¼Œç”¨äºæè¿°ä¸€ä¸ªç»™å®šé›†åˆçš„æ’åºå€¼ã€‚ä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="comment"># ç¬¬ 1 ç™¾åˆ†ä½æ•°è¡¨ç¤ºæ•°æ®ä¸­å°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰æ•°æ®å æ€»æ•°çš„ 1%ã€‚</span></span><br><span class="line"><span class="comment"># ç¬¬ 50 ç™¾åˆ†ä½æ•°ï¼ˆä¸­ä½æ•°ï¼‰è¡¨ç¤ºæ•°æ®ä¸­çš„ä¸€åŠå°äºè¿™ä¸ªå€¼ï¼Œå¦ä¸€åŠå¤§äºè¿™ä¸ªå€¼ã€‚</span></span><br><span class="line"><span class="comment"># ç¬¬ 99 ç™¾åˆ†ä½æ•°è¡¨ç¤ºæ•°æ®ä¸­å°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰æ•°æ®å æ€»æ•°çš„ 99%ã€‚</span></span><br><span class="line"><span class="comment"># é€šè¿‡è®¡ç®—è¿™äº›ç™¾åˆ†ä½æ•°ï¼Œä½ å¯ä»¥äº†è§£ price å­—æ®µåœ¨æ•´ä¸ªshoppingç´¢å¼•ä¸­çš„åˆ†å¸ƒæƒ…å†µï¼Œä»è€Œå¯ä»¥ç”¨äºæ•°æ®åˆ†æã€è¶‹åŠ¿åˆ¤æ–­ç­‰ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>top hits(æ’åœ¨å‰é¢çš„ç¤ºä¾‹)</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;top_hits&quot;</span>: &#123; <span class="comment"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ’åœ¨å‰é¢çš„ç¤ºä¾‹</span></span><br><span class="line">      <span class="string">&quot;top_hits&quot;</span>: &#123; <span class="comment"># æŒ‡æ ‡èšåˆå‡½æ•°åç§°ï¼Œtop_hitsè¡¨ç¤ºè¿”å›æ’åœ¨å‰é¢çš„ç¤ºä¾‹</span></span><br><span class="line">        <span class="string">&quot;sort&quot;</span>: [&#123;<span class="string">&quot;price&quot;</span>: &#123;<span class="string">&quot;order&quot;</span>: <span class="string">&quot;desc&quot;</span>&#125;&#125;], <span class="comment"># æ’åºï¼ŒæŒ‰ç…§priceå­—æ®µé™åºæ’åº</span></span><br><span class="line">        <span class="string">&quot;size&quot;</span>: 3 <span class="comment"># åªè¿”å›å‰3ä¸ª</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Bucket-Aggregation-æ¡¶èšåˆ">Bucket Aggregation(æ¡¶èšåˆ)</h2><ul class="lvl-0"><li class="lvl-2"><p>æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œå°†æ–‡æ¡£åˆ†é…åˆ°ä¸åŒçš„æ¡¶ä¸­ï¼Œä»è€Œè¾¾åˆ°åˆ†ç±»çš„ç›®çš„ã€‚</p></li><li class="lvl-2"><p>ESæä¾›çš„ä¸€äº›å¸¸è§çš„ Bucket Aggregationã€‚</p><ul class="lvl-2"><li class="lvl-4">termsï¼ˆè¯æ¡ï¼‰, rangeï¼ˆèŒƒå›´ï¼‰, date_rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰, ip_rangeï¼ˆIPèŒƒå›´ï¼‰, missingï¼ˆç¼ºå¤±ï¼‰, histogramï¼ˆç›´æ–¹å›¾ï¼‰, date_histogramï¼ˆæ—¥æœŸç›´æ–¹å›¾ï¼‰, geo_distanceï¼ˆåœ°ç†è·ç¦»ï¼‰, significant_termsï¼ˆé‡è¦è¯æ¡ï¼‰, compositeï¼ˆç»„åˆï¼‰</li></ul></li><li class="lvl-2"><p>æ¡¶èšåˆå¯ä»¥ç”¨äºå„ç§åœºæ™¯ï¼Œä¾‹å¦‚ï¼š</p><ul class="lvl-2"><li class="lvl-4">å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ç»Ÿè®¡ï¼Œæ¯”å¦‚æŒ‰ç…§åœ°åŒºã€å¹´é¾„æ®µã€æ€§åˆ«ç­‰å­—æ®µè¿›è¡Œåˆ†ç»„ç»Ÿè®¡ã€‚</li><li class="lvl-4">å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œæ—¶é—´æ®µåˆ†æï¼Œæ¯”å¦‚æŒ‰ç…§æ¯å°æ—¶ã€æ¯å¤©ã€æ¯æœˆã€æ¯å­£åº¦ã€æ¯å¹´ç­‰æ—¶é—´æ®µè¿›è¡Œåˆ†æã€‚</li><li class="lvl-4">å¯¹å„ç§æ ‡ç­¾ä¿¡æ¯åˆ†ç±»ï¼Œå¹¶ç»Ÿè®¡å…¶æ•°é‡ã€‚</li></ul></li></ul><h3 id="termsï¼ˆè¯æ¡ï¼‰">termsï¼ˆè¯æ¡ï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;category_count&quot;</span>: &#123; <span class="comment"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡</span></span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123; <span class="comment"># æ¡¶èšåˆå‡½æ•°åç§°ï¼Œtermsè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„</span></span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;category&quot;</span>, <span class="comment"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œæ³¨æ„ä¸èƒ½æ˜¯textç±»å‹ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="string">&quot;size&quot;</span>: 10, <span class="comment"># åªè¿”å›å‰10ä¸ªï¼Œé»˜è®¤æ˜¯10</span></span><br><span class="line">        <span class="string">&quot;order&quot;</span>: &#123;<span class="string">&quot;_count&quot;</span>: <span class="string">&quot;desc&quot;</span>&#125; <span class="comment"># æŒ‰ç…§æ•°é‡é™åºæ’åºï¼Œé»˜è®¤æ˜¯descï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åº</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span>: 15,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 12,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span>: <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span>: null,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;category_count&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;doc_count_error_upper_bound&quot;</span>: 0,  <span class="comment"># é”™è¯¯ä¸Šç•Œï¼Œè¡¨ç¤ºåœ¨èšåˆè¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨ä¸€äº›é”™è¯¯ï¼Œä½†é”™è¯¯æ•°é‡ä¸ä¼šè¶…è¿‡è¿™ä¸ªå€¼</span></span><br><span class="line">      <span class="string">&quot;sum_other_doc_count&quot;</span>: 0,         <span class="comment"># è¡¨ç¤ºåœ¨èšåˆè¿‡ç¨‹ä¸­ï¼Œé™¤äº†è¿”å›çš„10ä¸ªbucketï¼Œè¿˜æœ‰å…¶ä»–æ•°é‡ï¼Œè¿™ä¸ªæ•°é‡å°±æ˜¯sum_other_doc_count</span></span><br><span class="line">      <span class="string">&quot;buckets&quot;</span>: [                     <span class="comment"># è¿”å›çš„bucket</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="string">&quot;electronics&quot;</span>,          <span class="comment"># åˆ†ç»„çš„key</span></span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 4                 <span class="comment"># åˆ†ç»„çš„æ•°é‡</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="string">&quot;books&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 2</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="string">&quot;fashion&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 2</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="string">&quot;groceries&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 2</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="string">&quot;home_appliances&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 2</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é™å®šèšåˆèŒƒå›´</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;gte&quot;</span>: 100 <span class="comment"># é™å®šä»·æ ¼èŒƒå›´</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;category_count&quot;</span>: &#123; <span class="comment"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡</span></span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123; <span class="comment"># æ¡¶èšåˆå‡½æ•°åç§°ï¼Œtermsè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„</span></span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;category&quot;</span>, <span class="comment"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">        <span class="string">&quot;size&quot;</span>: 10, <span class="comment"># åªè¿”å›å‰10ä¸ªï¼Œé»˜è®¤æ˜¯10</span></span><br><span class="line">        <span class="string">&quot;order&quot;</span>: &#123;<span class="string">&quot;_count&quot;</span>: <span class="string">&quot;desc&quot;</span>&#125; <span class="comment"># æŒ‰ç…§æ•°é‡é™åºæ’åºï¼Œé»˜è®¤æ˜¯descï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åº</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="rangeï¼ˆèŒƒå›´ï¼‰">rangeï¼ˆèŒƒå›´ï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæŒ‰ç…§ä»·æ ¼èŒƒå›´è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price_range&quot;</span>: &#123; <span class="comment"># è‡ªå®šä¹‰åç§°ï¼Œè¿”å›æ¯ä¸ªç»„çš„æ•°é‡</span></span><br><span class="line">      <span class="string">&quot;range&quot;</span>: &#123; <span class="comment"># æ¡¶èšåˆå‡½æ•°åç§°ï¼Œrangeè¡¨ç¤ºæŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„</span></span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>, <span class="comment"># æŒ‰ç…§priceå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">        <span class="string">&quot;ranges&quot;</span>: [</span><br><span class="line">          &#123;<span class="string">&quot;to&quot;</span>: 100&#125;, <span class="comment"># å°äº100</span></span><br><span class="line">          &#123;<span class="string">&quot;from&quot;</span>: 100, <span class="string">&quot;to&quot;</span>: 200&#125;, <span class="comment"># 100-200ï¼ŒåŒ…æ‹¬100ï¼Œä¸åŒ…æ‹¬200</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">&quot;key&quot;</span>:<span class="string">&quot;&gt;=200&quot;</span>, <span class="comment"># è®¾å®šé”®å€¼ï¼Œç”¨äºåŒºåˆ†ä¸åŒèŒƒå›´</span></span><br><span class="line">            <span class="string">&quot;from&quot;</span>:200 <span class="comment"># å¤§äºç­‰äº200</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span>: 5,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 12,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span>: <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span>: null,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price_range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;buckets&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="string">&quot;*-100.0&quot;</span>,</span><br><span class="line">          <span class="string">&quot;to&quot;</span>: 100,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 6</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="string">&quot;100.0-200.0&quot;</span>,</span><br><span class="line">          <span class="string">&quot;from&quot;</span>: 100,</span><br><span class="line">          <span class="string">&quot;to&quot;</span>: 200,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 0</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="string">&quot;&gt;=200&quot;</span>,</span><br><span class="line">          <span class="string">&quot;from&quot;</span>: 200,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 6</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="date-rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰">date_rangeï¼ˆæ—¥æœŸèŒƒå›´ï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæŒ‰ç…§æ—¥æœŸèŒƒå›´è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;date_range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;date_range&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;created_at&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ranges&quot;</span>: [</span><br><span class="line">          &#123;<span class="string">&quot;to&quot;</span>: <span class="string">&quot;now-3d&quot;</span>&#125;, <span class="comment"># å°äºå½“å‰æ—¶é—´å‡å»3å¤©</span></span><br><span class="line">          &#123;<span class="string">&quot;from&quot;</span>: <span class="string">&quot;now-3d&quot;</span>,<span class="string">&quot;to&quot;</span>: <span class="string">&quot;now-1d&quot;</span>&#125;, <span class="comment"># å¤§äºå½“å‰æ—¶é—´å‡å»3å¤©ï¼ˆåŒ…å«ï¼‰ï¼Œå°äºå½“å‰æ—¶é—´å‡å»1å¤©</span></span><br><span class="line">          &#123;<span class="string">&quot;key&quot;</span>:<span class="string">&quot;now-1d&quot;</span>,<span class="string">&quot;from&quot;</span>: <span class="string">&quot;now-1d&quot;</span>&#125; <span class="comment"># å¤§äºå½“å‰æ—¶é—´å‡å»1å¤©ï¼ˆåŒ…å«ï¼‰ï¼Œå¹¶è®¾ç½®é”®å€¼</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span>: 3,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 12,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span>: <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span>: null,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;date_range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;buckets&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="string">&quot;*-2025-04-20 03:14:17&quot;</span>,</span><br><span class="line">          <span class="string">&quot;to&quot;</span>: 1745118857610,</span><br><span class="line">          <span class="string">&quot;to_as_string&quot;</span>: <span class="string">&quot;2025-04-20 03:14:17&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 4</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="string">&quot;2025-04-20 03:14:17-2025-04-22 03:14:17&quot;</span>,</span><br><span class="line">          <span class="string">&quot;from&quot;</span>: 1745118857610,</span><br><span class="line">          <span class="string">&quot;from_as_string&quot;</span>: <span class="string">&quot;2025-04-20 03:14:17&quot;</span>,</span><br><span class="line">          <span class="string">&quot;to&quot;</span>: 1745291657610,</span><br><span class="line">          <span class="string">&quot;to_as_string&quot;</span>: <span class="string">&quot;2025-04-22 03:14:17&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 4</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="string">&quot;now-1d&quot;</span>,</span><br><span class="line">          <span class="string">&quot;from&quot;</span>: 1745291657610,</span><br><span class="line">          <span class="string">&quot;from_as_string&quot;</span>: <span class="string">&quot;2025-04-22 03:14:17&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 4</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥æœŸæ ¼å¼</span></span><br><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;date_range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;date_range&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;created_at&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ranges&quot;</span>: [</span><br><span class="line">          &#123;<span class="string">&quot;to&quot;</span>: <span class="string">&quot;2025-04-20 00:00:00&quot;</span>&#125;, <span class="comment"># æ³¨æ„è¿™é‡Œçš„æ ¼å¼å¿…é¡»ä¸å­—æ®µæ ¼å¼ä¸€è‡´</span></span><br><span class="line">          &#123;<span class="string">&quot;from&quot;</span>: <span class="string">&quot;2025-04-20 00:00:00&quot;</span>,<span class="string">&quot;to&quot;</span>: <span class="string">&quot;2025-04-22 00:00:00&quot;</span>&#125;,</span><br><span class="line">          &#123;<span class="string">&quot;key&quot;</span>:<span class="string">&quot;2025-04-22 00:00:00&quot;</span>,<span class="string">&quot;from&quot;</span>: <span class="string">&quot;2025-04-22 00:00:00&quot;</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="histogramï¼ˆç›´æ–¹å›¾ï¼‰">histogramï¼ˆç›´æ–¹å›¾ï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>æŒ‰ç…§é—´éš”è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæŒ‰ç…§ä»·æ ¼çš„é—´éš”è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªç»„çš„æ•°é‡ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price_histogram&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;histogram&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>,</span><br><span class="line">        <span class="string">&quot;interval&quot;</span>: 500, <span class="comment"># é—´éš”500</span></span><br><span class="line">        <span class="string">&quot;extended_bounds&quot;</span>:&#123; <span class="comment"># è®¾ç½®è¾¹ç•Œ</span></span><br><span class="line">          <span class="string">&quot;min&quot;</span>:0, <span class="comment"># æœ€å°å€¼0</span></span><br><span class="line">          <span class="string">&quot;max&quot;</span>:2000 <span class="comment"># æœ€å¤§å€¼2000</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span>: 2,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span>: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 12,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span>: <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span>: null,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price_histogram&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;buckets&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: 0,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 8</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: 500,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: 1000,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: 1500,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 2</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: 2000,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 0</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="top-hitsï¼ˆåˆ†æ¡¶å–å‰Næ¡ï¼‰">top_hitsï¼ˆåˆ†æ¡¶å–å‰Næ¡ï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>æŒ‰ç…§å­—æ®µçš„å€¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶è¿”å›æ¯ä¸ªç»„çš„å‰Næ¡æ•°æ®ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå¹¶è¿”å›æ¯ä¸ªç»„çš„å‰3æ¡æ•°æ®ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price_top_hits&quot;</span>: &#123; <span class="comment"># è‡ªå®šä¹‰åç§°</span></span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;category&quot;</span>  <span class="comment"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;top_hits&quot;</span>: &#123; <span class="comment"># è‡ªå®šä¹‰åç§°</span></span><br><span class="line">          <span class="string">&quot;top_hits&quot;</span>: &#123; <span class="comment"># è¿”å›æ¯ä¸ªç»„çš„å‰3æ¡æ•°æ®</span></span><br><span class="line">            <span class="string">&quot;size&quot;</span>: 3, <span class="comment"># è¿”å›å‰3æ¡æ•°æ®</span></span><br><span class="line">            <span class="string">&quot;sort&quot;</span>: &#123; <span class="comment"># æŒ‰ç…§created_atå­—æ®µè¿›è¡Œæ’åº</span></span><br><span class="line">              <span class="string">&quot;created_at&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;order&quot;</span>: <span class="string">&quot;desc&quot;</span> <span class="comment"># é™åº</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­èšåˆ">å­èšåˆ</h3><ul class="lvl-0"><li class="lvl-2"><p>å­èšåˆï¼šåœ¨èšåˆå‡½æ•°ä¸­ï¼Œè¿˜å¯ä»¥å†å®šä¹‰ä¸€ä¸ªèšåˆå‡½æ•°ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;category_buckets&quot;</span>: &#123; <span class="comment"># è‡ªå®šä¹‰åç§°</span></span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;category&quot;</span>  <span class="comment"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123; <span class="comment"># å®šä¹‰å­èšåˆ</span></span><br><span class="line">        <span class="string">&quot;price_stats&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;stats&quot;</span>: &#123; <span class="comment"># ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯</span></span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šå±‚åµŒå¥—</span></span><br><span class="line"><span class="comment"># å…ˆæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„ï¼Œå†æŒ‰ç…§addressè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡ä»·æ ¼ä¿¡æ¯</span></span><br><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>:0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;category_buckets&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>:<span class="string">&quot;category&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;address_buckets&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;terms&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>:<span class="string">&quot;address.keyword&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;aggs&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;price_stats&quot;</span>:&#123;</span><br><span class="line">              <span class="string">&quot;stats&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;field&quot;</span>:<span class="string">&quot;price&quot;</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Pipeline-Aggregation-ç®¡é“èšåˆ">Pipeline Aggregation(ç®¡é“èšåˆ)</h2><ul class="lvl-0"><li class="lvl-2"><p>æ”¯æŒå¯¹èšåˆåˆ†æçš„ç»“æœï¼Œå†æ¬¡è¿›è¡Œèšåˆåˆ†æã€‚</p></li><li class="lvl-2"><p>Pipeline çš„åˆ†æç»“æœä¼šè¾“å‡ºåˆ°åŸç»“æœä¸­ï¼Œæ ¹æ®ä½ç½®çš„ä¸åŒï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š</p><ul class="lvl-2"><li class="lvl-4">Sibling - ç»“æœå’Œç°æœ‰åˆ†æç»“æœåŒçº§<ul class="lvl-4"><li class="lvl-6">Maxï¼Œminï¼ŒAvg &amp; Sum Bucket</li><li class="lvl-6">Statsï¼ŒExtended Status Bucket</li><li class="lvl-6">Percentiles Bucket</li></ul></li><li class="lvl-4">Parent -ç»“æœå†…åµŒåˆ°ç°æœ‰çš„èšåˆåˆ†æç»“æœä¹‹ä¸­<ul class="lvl-4"><li class="lvl-6">Derivative(æ±‚å¯¼)</li><li class="lvl-6">Cumultive Sum(ç´¯è®¡æ±‚å’Œ)</li><li class="lvl-6">Moving Function(ç§»åŠ¨å¹³å‡å€¼)</li></ul></li></ul></li></ul><h3 id="Maxï¼Œminï¼ŒAvg-Sum-Bucket">Maxï¼Œminï¼ŒAvg &amp; Sum Bucket</h3><ul class="lvl-0"><li class="lvl-2"><p>Maxï¼Œminï¼ŒAvg &amp; Sum Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œæœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ±‚å’Œç­‰æ“ä½œã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶æ‰¾å‡ºå¹³å‡ä»·æ ¼æœ€ä½çš„åˆ†ç»„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>:0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;category_buckets&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>:<span class="string">&quot;category&quot;</span> <span class="comment"># æŒ‰ç…§categoryå­—æ®µè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;price_avg&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;avg&quot;</span>:&#123; <span class="comment"># æ±‚ä»·æ ¼å¹³å‡å€¼</span></span><br><span class="line">            <span class="string">&quot;field&quot;</span>:<span class="string">&quot;price&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;min_price_in_category&quot;</span>:&#123; <span class="comment"># æ‰¾å‡ºå¹³å‡ä»·æ ¼æœ€ä½çš„åˆ†ç»„</span></span><br><span class="line">      <span class="string">&quot;min_bucket&quot;</span>:&#123; <span class="comment"># å¯¹èšåˆç»“æœè¿›è¡Œæœ€å°å€¼æ“ä½œ</span></span><br><span class="line">        <span class="string">&quot;buckets_path&quot;</span>:<span class="string">&quot;category_buckets&gt;price_avg&quot;</span> <span class="comment"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„price_avgå­—æ®µè¿›è¡Œæœ€å°å€¼æ“ä½œ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Statsï¼ŒExtended-Status-Bucket">Statsï¼ŒExtended Status Bucket</h3><ul class="lvl-0"><li class="lvl-2"><p>Statsï¼ŒExtended Status Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œï¼ŒåŒ…æ‹¬æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ±‚å’Œã€æ•°é‡ç­‰ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;category_buckets&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;category&quot;</span>,</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: 10 <span class="comment"># æŒ‡å®šåˆ†ç»„æ•°é‡</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;avg_price&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;stats_price_by_job&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;stats_bucket&quot;</span>: &#123; <span class="comment"># å¯¹èšåˆç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class="line">        <span class="string">&quot;buckets_path&quot;</span>: <span class="string">&quot;category_buckets&gt;avg_price&quot;</span> <span class="comment"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„avg_priceå­—æ®µè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Percentiles-Bucket">Percentiles Bucket</h3><ul class="lvl-0"><li class="lvl-2"><p>Percentiles Bucketï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç™¾åˆ†æ¯”æ“ä½œï¼ŒåŒ…æ‹¬ç™¾åˆ†æ¯”ã€ä¸­ä½æ•°ç­‰ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæŒ‰ç…§categoryè¿›è¡Œåˆ†ç»„æ±‚å‡ºå•†å“çš„å¹³å‡ä»·æ ¼ï¼Œå¹¶å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç™¾åˆ†æ¯”æ“ä½œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;category_buckets&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;category&quot;</span>,</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: 10</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;avg_price&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;percentiles_price_by_category&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;percentiles_bucket&quot;</span>: &#123; <span class="comment"># å¯¹èšåˆç»“æœè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class="line">        <span class="string">&quot;buckets_path&quot;</span>: <span class="string">&quot;category_buckets&gt;avg_price&quot;</span> <span class="comment"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹category_bucketsèšåˆç»“æœä¸­çš„avg_priceå­—æ®µè¿›è¡Œç»Ÿè®¡æ“ä½œ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Cumulative-Sum">Cumulative Sum</h3><ul class="lvl-0"><li class="lvl-2"><p>Cumulative Sumï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹: æŒ‰ç…§ä»·æ ¼è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡å¹³å‡ä»·æ ¼ä¿¡æ¯ï¼Œå¯¹åˆ†ç»„ç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price_histogram&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;histogram&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>,</span><br><span class="line">        <span class="string">&quot;interval&quot;</span>: 500, <span class="comment"># é—´éš”500</span></span><br><span class="line">        <span class="string">&quot;extended_bounds&quot;</span>:&#123; <span class="comment"># è®¾ç½®è¾¹ç•Œ</span></span><br><span class="line">          <span class="string">&quot;min&quot;</span>:0, <span class="comment"># æœ€å°å€¼0</span></span><br><span class="line">          <span class="string">&quot;max&quot;</span>:2000 <span class="comment"># æœ€å¤§å€¼2000</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;avg_price&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;cumulative_sum_price&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;cumulative_sum&quot;</span>: &#123; <span class="comment"># å¯¹èšåˆç»“æœè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œ</span></span><br><span class="line">            <span class="string">&quot;buckets_path&quot;</span>: <span class="string">&quot;avg_price&quot;</span> <span class="comment"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹avg_priceå­—æ®µè¿›è¡Œç´¯è®¡æ±‚å’Œæ“ä½œ</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Derivative">Derivative</h3><ul class="lvl-0"><li class="lvl-2"><p>Derivativeï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œæ±‚å¯¼æ“ä½œã€‚</p></li><li class="lvl-2"><p>Derivative èšåˆæŸ¥è¯¢æ˜¯ Elasticsearch ä¸­çš„ä¸€ç§é«˜çº§èšåˆç±»å‹ï¼Œç”¨äºè®¡ç®—æŸä¸ªåº¦é‡å€¼éšæ—¶é—´ï¼ˆæˆ–å…¶ä»–é¡ºåºå­—æ®µï¼‰å˜åŒ–çš„é€Ÿç‡ã€‚å®ƒé€šå¸¸ç”¨äºæ—¶é—´åºåˆ—åˆ†æï¼Œä»¥æ­ç¤ºåº¦é‡å€¼çš„å¢å‡è¶‹åŠ¿ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šæ˜¾ç¤ºæ¯å¤©çš„å¹³å‡ä»·æ ¼ä»¥åŠå¹³å‡ä»·æ ¼çš„å˜åŒ–è¶‹åŠ¿</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price_over_time&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;date_histogram&quot;</span>: &#123; <span class="comment"># æŒ‰ç…§æ—¥æœŸè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;created_at&quot;</span>, <span class="comment"># æŒ‡å®šå­—æ®µ</span></span><br><span class="line">        <span class="string">&quot;calendar_interval&quot;</span>: <span class="string">&quot;day&quot;</span> <span class="comment"># æŒ‡å®šæ—¶é—´é—´éš”ï¼Œå¯ç”¨çš„å€¼ï¼šyearã€quarterã€monthã€weekã€dayã€hourã€minuteã€second</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;average_price&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;price_derivative&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;derivative&quot;</span>: &#123; <span class="comment"># å¯¹èšåˆç»“æœè¿›è¡Œæ±‚å¯¼æ“ä½œ</span></span><br><span class="line">            <span class="string">&quot;buckets_path&quot;</span>: <span class="string">&quot;average_price&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Moving-Function">Moving Function</h3><ul class="lvl-0"><li class="lvl-2"><p>Moving Functionï¼šå¯¹èšåˆåˆ†æçš„ç»“æœè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œã€‚</p></li><li class="lvl-2"><p>Moving Function èšåˆæŸ¥è¯¢æ˜¯ Elasticsearch ä¸­çš„ä¸€ç§é«˜çº§èšåˆç±»å‹ï¼Œç”¨äºè®¡ç®—æŸä¸ªåº¦é‡å€¼åœ¨æ—¶é—´çª—å£å†…çš„ç§»åŠ¨å¹³å‡å€¼ã€‚å®ƒé€šå¸¸ç”¨äºæ—¶é—´åºåˆ—åˆ†æï¼Œä»¥äº†è§£åº¦é‡å€¼çš„å˜åŒ–è¶‹åŠ¿ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹ï¼šè®¡ç®— price å­—æ®µçš„ 7 å¤©ç§»åŠ¨å¹³å‡å€¼</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">GET /shopping/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price_over_time&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;date_histogram&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;created_at&quot;</span>,</span><br><span class="line">        <span class="string">&quot;calendar_interval&quot;</span>: <span class="string">&quot;day&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;daily_avg_price&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;moving_avg_price&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;moving_fn&quot;</span>: &#123; <span class="comment"># å¯¹èšåˆç»“æœè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œ</span></span><br><span class="line">            <span class="string">&quot;buckets_path&quot;</span>: <span class="string">&quot;daily_avg_price&quot;</span>, <span class="comment"># æŒ‡å®šè·¯å¾„ï¼Œå¯¹daily_avg_priceå­—æ®µè¿›è¡Œç§»åŠ¨å¹³å‡å€¼æ“ä½œ</span></span><br><span class="line">            <span class="string">&quot;script&quot;</span>: <span class="string">&quot;MovingFunctions.unweightedAvg(values)&quot;</span>, <span class="comment"># æŒ‡å®šè„šæœ¬ï¼Œè®¡ç®—ç§»åŠ¨å¹³å‡å€¼</span></span><br><span class="line">            <span class="string">&quot;window&quot;</span>: 7, <span class="comment"># çª—å£å¤§å°ï¼Œé»˜è®¤ä¸º 10</span></span><br><span class="line">            <span class="string">&quot;shift&quot;</span>: 0 <span class="comment"># çª—å£åç§»é‡ï¼Œé»˜è®¤ä¸º 0</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ES-èšåˆæ€§èƒ½ä¼˜åŒ–">ES èšåˆæ€§èƒ½ä¼˜åŒ–</h2><h3 id="ç´¢å¼•é¢„æ’åº">ç´¢å¼•é¢„æ’åº</h3><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœæ˜¯ Elasticsearch 6.X ä¹‹åç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ’å…¥æ•°æ®æ—¶å¯¹ç´¢å¼•è¿›è¡Œé¢„æ’åºï¼Œè€Œä¸æ˜¯åœ¨æŸ¥è¯¢æ—¶å†å¯¹ç´¢å¼•è¿›è¡Œæ’åºï¼Œè¿™å°†æé«˜èŒƒå›´æŸ¥è¯¢ï¼ˆrange queryï¼‰å’Œæ’åºæ“ä½œçš„æ€§èƒ½ã€‚</p></li><li class="lvl-2"><p>ä½†é¢„æ’åºå°†å¢åŠ  Elasticsearch å†™å…¥çš„æˆæœ¬ï¼Œå¯¼è‡´å¤§çº¦ 40%-50% çš„å†™æ€§èƒ½ä¸‹é™ï¼Œå¦‚æœåº”ç”¨åœºæ™¯æ˜¯æ›´å…³æ³¨å†™æ€§èƒ½çš„ä¸šåŠ¡ï¼Œå¼€å¯ç´¢å¼•é¢„æ’åºä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT /my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;index&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;sort.field&quot;</span>: <span class="string">&quot;create_time&quot;</span>,</span><br><span class="line">      <span class="string">&quot;sort.order&quot;</span>: <span class="string">&quot;desc&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;create_time&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜">ä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜</h3><ul class="lvl-0"><li class="lvl-2"><p>èšåˆè¯­å¥ä¸­ï¼Œè®¾ç½®ï¼šsizeï¼š0ï¼Œå°±ä¼šä½¿ç”¨åˆ†ç‰‡è¯·æ±‚ç¼“å­˜ç¼“å­˜ç»“æœã€‚size = 0 çš„å«ä¹‰æ˜¯ï¼šåªè¿”å›èšåˆç»“æœï¼Œä¸è¿”å›æŸ¥è¯¢ç»“æœã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;remark_agg&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;remark.keyword&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‹†åˆ†èšåˆï¼Œä½¿èšåˆå¹¶è¡ŒåŒ–">æ‹†åˆ†èšåˆï¼Œä½¿èšåˆå¹¶è¡ŒåŒ–</h3><ul class="lvl-0"><li class="lvl-2"><p>Elasticsearch æŸ¥è¯¢æ¡ä»¶ä¸­åŒæ—¶æœ‰å¤šä¸ªæ¡ä»¶èšåˆï¼Œé»˜è®¤æƒ…å†µä¸‹èšåˆä¸æ˜¯å¹¶è¡Œè¿è¡Œçš„ã€‚</p></li><li class="lvl-2"><p>å½“ä¸ºæ¯ä¸ªèšåˆæä¾›è‡ªå·±çš„æŸ¥è¯¢å¹¶æ‰§è¡Œ msearch æ—¶ï¼Œæ€§èƒ½ä¼šæœ‰æ˜¾è‘—æå‡ã€‚</p></li><li class="lvl-2"><p>å› æ­¤ï¼Œåœ¨ CPU èµ„æºä¸æ˜¯ç“¶é¢ˆçš„å‰æä¸‹ï¼Œå¦‚æœæƒ³ç¼©çŸ­å“åº”æ—¶é—´ï¼Œå¯ä»¥å°†å¤šä¸ªèšåˆæ‹†åˆ†ä¸ºå¤šä¸ªæŸ¥è¯¢ï¼Œå€ŸåŠ©ï¼šmsearch å®ç°å¹¶è¡Œèšåˆã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¸¸è§„çš„å¤šæ¡ä»¶èšåˆå®ç°</span></span><br><span class="line">GET /employees/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;job_agg&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;job.keyword&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_salary&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;max&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;salary&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># msearch æ‹†åˆ†å¤šä¸ªè¯­å¥çš„èšåˆå®ç°</span></span><br><span class="line">GET _msearch</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>:<span class="string">&quot;employees&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;size&quot;</span>:0,<span class="string">&quot;aggs&quot;</span>:&#123;<span class="string">&quot;job_agg&quot;</span>:&#123;<span class="string">&quot;terms&quot;</span>:&#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;job.keyword&quot;</span>&#125;&#125;&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>:<span class="string">&quot;employees&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;size&quot;</span>:0,<span class="string">&quot;aggs&quot;</span>:&#123;<span class="string">&quot;max_salary&quot;</span>:&#123;<span class="string">&quot;max&quot;</span>:&#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;salary&quot;</span>&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIsï¼šèšåˆæŸ¥è¯¢&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;Elasticsearchç‰ˆæœ¬8.17.3&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/8.17/rest-apis.html&quot;&gt;å®˜æ–¹æ–‡æ¡£:REST APIs&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/8.17/search-aggregations.html&quot;&gt;å®˜æ–¹æ–‡æ¡£:Aggregations&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;a href=&quot;/2025/04/17/elasticsearch-05-api/&quot; title=&quot;Elasticsearch çš„ REST APIs&quot;&gt;Elasticsearch çš„ REST APIs&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="elastic" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/"/>
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/elasticsearch/"/>
    
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearch çš„ REST APIs</title>
    <link href="https://blog.hanqunfeng.com/2025/04/17/elasticsearch-05-api/"/>
    <id>https://blog.hanqunfeng.com/2025/04/17/elasticsearch-05-api/</id>
    <published>2025-04-17T13:30:05.000Z</published>
    <updated>2025-04-23T02:42:29.434Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIs</p></li><li class="lvl-2"><p>Elasticsearchç‰ˆæœ¬8.17.3</p></li><li class="lvl-2"><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.17/rest-apis.html">å®˜æ–¹æ–‡æ¡£:REST APIs</a></p></li><li class="lvl-2"><a href="/2025/04/22/elasticsearch-06-api-aggs/" title="Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢">Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢</a></li></ul><span id="more"></span><h2 id="è¿”å›å†…å®¹æ ¼å¼åŒ–">è¿”å›å†…å®¹æ ¼å¼åŒ–</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿”å›jsonä¿¡æ¯æ ¼å¼: <code>?pretty</code> è¾“å‡ºæ ¼å¼åŒ–åçš„jsonï¼Œæ¯”å¦‚ï¼š<code>curl http://localhost:9200/_cluster/health?pretty</code></p></li><li class="lvl-2"><p>è¿”å›è¡Œä¿¡æ¯æ ¼å¼: <code>?v</code> è¾“å‡ºå†…å®¹ä¸Šæ–¹ä¼šåŠ ä¸Šæ ‡é¢˜è¡Œï¼Œæ¯”å¦‚ï¼š<code>curl http://localhost:9200/_cat/health?v</code></p></li></ul><h2 id="CAT-APIs">CAT APIs</h2><ul class="lvl-0"><li class="lvl-2"><p>Elasticsearch æä¾›äº† <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.17/cat.html">CAT APIs</a>ï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€å’Œé›†ç¾¤ä¸­çš„å„ç§èµ„æºï¼Œæ¯”å¦‚ç´¢å¼•ã€åˆ†ç‰‡ã€èŠ‚ç‚¹ç­‰ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">GET     /_cat/health             <span class="comment">#æŸ¥çœ‹é›†ç¾¤å½“å‰çŠ¶æ€ï¼šçº¢ã€é»„ã€ç»¿</span></span><br><span class="line">GET     /_cat/master             <span class="comment">#æŸ¥çœ‹masterèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">GET     /_cat/nodes              <span class="comment">#æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">GET     /_cat/plugins            <span class="comment">#æŸ¥çœ‹é›†ç¾¤å„ä¸ªèŠ‚ç‚¹ä¸Šçš„pluginä¿¡æ¯</span></span><br><span class="line">GET     /_cat/indices            <span class="comment">#æŸ¥çœ‹é›†ç¾¤ä¸­æ‰€æœ‰indexçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">GET     /_cat/indices/&#123;index&#125;    <span class="comment">#æŸ¥çœ‹é›†ç¾¤ä¸­æŒ‡å®šindexçš„è¯¦ç»†ä¿¡æ¯ï¼Œindexï¼šç´¢å¼•åç§°</span></span><br><span class="line">GET     /_cat/allocation         <span class="comment">#æŸ¥çœ‹å•èŠ‚ç‚¹çš„shardåˆ†é…æ•´ä½“æƒ…å†µ</span></span><br><span class="line">GET     /_cat/shards             <span class="comment">#æŸ¥çœ‹å„shardçš„è¯¦ç»†æƒ…å†µ</span></span><br><span class="line">GET     /_cat/shards/&#123;index&#125;     <span class="comment">#æŸ¥çœ‹æŒ‡å®šåˆ†ç‰‡çš„è¯¦ç»†æƒ…å†µ</span></span><br><span class="line">GET     /_cat/segments           <span class="comment">#æŸ¥çœ‹å„indexçš„segmentè¯¦ç»†ä¿¡æ¯,åŒ…æ‹¬segmentå, æ‰€å±shard, å†…å­˜(ç£ç›˜)å ç”¨å¤§å°, æ˜¯å¦åˆ·ç›˜</span></span><br><span class="line">GET     /_cat/segments/&#123;index&#125;   <span class="comment">#æŸ¥çœ‹æŒ‡å®šindexçš„segmentè¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">GET     /_cat/count              <span class="comment">#æŸ¥çœ‹å½“å‰é›†ç¾¤çš„docæ•°é‡</span></span><br><span class="line">GET     /_cat/count/&#123;index&#125;      <span class="comment">#æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„docæ•°é‡</span></span><br><span class="line">GET     /_cat/recovery           <span class="comment">#æŸ¥çœ‹é›†ç¾¤å†…æ¯ä¸ªshardçš„recoveryè¿‡ç¨‹.è°ƒæ•´replicaã€‚</span></span><br><span class="line">GET     /_cat/recovery/&#123;index&#125;   <span class="comment">#æŸ¥çœ‹æŒ‡å®šç´¢å¼•shardçš„recoveryè¿‡ç¨‹</span></span><br><span class="line">GET     /_cat/pending_tasks      <span class="comment">#æŸ¥çœ‹å½“å‰é›†ç¾¤çš„pending task</span></span><br><span class="line">GET     /_cat/aliases            <span class="comment">#æŸ¥çœ‹é›†ç¾¤ä¸­æ‰€æœ‰aliasä¿¡æ¯,è·¯ç”±é…ç½®ç­‰</span></span><br><span class="line">GET     /_cat/aliases/&#123;<span class="built_in">alias</span>&#125;    <span class="comment">#æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„aliasä¿¡æ¯</span></span><br><span class="line">GET     /_cat/thread_pool        <span class="comment">#æŸ¥çœ‹é›†ç¾¤å„èŠ‚ç‚¹å†…éƒ¨ä¸åŒç±»å‹çš„threadpoolçš„ç»Ÿè®¡ä¿¡æ¯,</span></span><br><span class="line">GET     /_cat/fielddata          <span class="comment">#æŸ¥çœ‹å½“å‰é›†ç¾¤å„ä¸ªèŠ‚ç‚¹çš„fielddataå†…å­˜ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">GET     /_cat/fielddata/&#123;fields&#125; <span class="comment">#æŸ¥çœ‹æŒ‡å®šfieldçš„å†…å­˜ä½¿ç”¨æƒ…å†µ,é‡Œé¢ä¼ fieldå±æ€§å¯¹åº”çš„å€¼</span></span><br><span class="line">GET     /_cat/nodeattrs          <span class="comment">#æŸ¥çœ‹å•èŠ‚ç‚¹çš„è‡ªå®šä¹‰å±æ€§</span></span><br><span class="line">GET     /_cat/repositories       <span class="comment">#è¾“å‡ºé›†ç¾¤ä¸­æ³¨å†Œå¿«ç…§å­˜å‚¨åº“</span></span><br><span class="line">GET     /_cat/templates          <span class="comment">#è¾“å‡ºå½“å‰æ­£åœ¨å­˜åœ¨çš„æ¨¡æ¿ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><h2 id="Cluster-APIs">Cluster APIs</h2><ul class="lvl-0"><li class="lvl-2"><p>Elasticsearch æä¾›äº†ä¸€ç³»åˆ—çš„ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.17/cluster.html">Cluster APIs</a>ï¼Œå®ƒä»¬æä¾›äº†ç®¡ç†å’Œç›‘æ§é›†ç¾¤çŠ¶æ€çš„åŠŸèƒ½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET     /_cluster/health            <span class="comment"># è·å–é›†ç¾¤çš„å¥åº·çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†é›†ç¾¤æ€»ä½“çš„çŠ¶å†µå¦‚statusã€number_of_nodesç­‰ã€‚</span></span><br><span class="line">GET     /_cluster/stats             <span class="comment"># æä¾›æ•´ä¸ªé›†ç¾¤å±‚é¢çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…å«ç´¢å¼•ã€èŠ‚ç‚¹å’Œå…¶ä»–é«˜çº§æŒ‡æ ‡ã€‚</span></span><br><span class="line">GET     /_cluster/state             <span class="comment"># æ˜¾ç¤ºé›†ç¾¤å…ƒæ•°æ®çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬è®¾ç½®ã€å—ã€è·¯ç”±è¡¨åŠå…ƒæ•°æ®ç­‰ï¼Œå…è®¸ç”¨æˆ·æŸ¥çœ‹é›†ç¾¤çš„å½“å‰è§†å›¾ã€‚</span></span><br><span class="line">POST    /_cluster/reroute           <span class="comment"># POSTè¯·æ±‚ï¼Œç”¨äºæ‰‹åŠ¨æ”¹å˜åˆ†ç‰‡åˆ†é…æƒ…å†µï¼Œå¯ä»¥å®ç°å¦‚è¿ç§»åˆ†ç‰‡ã€å–æ¶ˆåˆ†é…ç­‰æ“ä½œã€‚</span></span><br><span class="line">GET     /_cluster/nodes/hot_threads <span class="comment"># è¿”å›é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹â€œæœ€çƒ­â€çš„çº¿ç¨‹å †æ ˆè·Ÿè¸ªï¼Œé»˜è®¤æ˜¾ç¤ºå‰ä¸‰ä¸ªCPUæ—¶é—´æœ€é•¿çš„çº¿ç¨‹ã€‚</span></span><br><span class="line">GET     /_cluster/allocation/explain <span class="comment"># è§£é‡Šä¸ºä½•æŸä¸ªåˆ†ç‰‡è¢«å¦‚æ­¤åˆ†é…ï¼Œå¹¶æä¾›å¦‚ä½•è°ƒæ•´çš„å»ºè®®ã€‚</span></span><br><span class="line">GET     /_cluster/pending_tasks     <span class="comment"># åˆ—å‡ºæ‰€æœ‰ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚</span></span><br><span class="line">GET     /_cluster/settings          <span class="comment"># æŸ¥çœ‹æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„è®¾ç½®ã€‚</span></span><br><span class="line">PUT     /_cluster/settings          <span class="comment"># æ›´æ–°æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„è®¾ç½®ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="Index-APIs">Index APIs</h2><ul class="lvl-0"><li class="lvl-2"><p>Elasticsearch æä¾›äº† <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.17/indices.html">Index APIs</a>ï¼Œå®ƒä»¬æä¾›äº†å¯¹ç´¢å¼•çš„åˆ›å»ºã€æ›´æ–°ã€æŸ¥è¯¢å’Œåˆ é™¤ç­‰æ“ä½œã€‚</p></li><li class="lvl-2"><p>åˆ›å»ºç´¢å¼•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PUT /&lt;target&gt;</span></span><br><span class="line"><span class="comment"># è¿™é‡Œ shopping ä¸ºç´¢å¼•åç§°ï¼Œä½†æ­¤æ—¶æ²¡æœ‰ä¸ºç´¢å¼•è®¾ç½®åˆ†ç‰‡ç­–ç•¥ï¼Œä¹Ÿæ²¡æœ‰è®¾ç½®å­—æ®µä¿¡æ¯</span></span><br><span class="line">curl -X PUT -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;shards_acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;index&quot;</span>:<span class="string">&quot;shopping&quot;</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºç´¢å¼•å¹¶è®¾ç½®ç´¢å¼•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PUT /&lt;target&gt;</span></span><br><span class="line">curl -X PUT -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;settings&quot;:&#123;&quot;number_of_shards&quot;:&quot;1&quot;,&quot;number_of_replicas&quot;:&quot;2&quot;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;shards_acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;index&quot;</span>:<span class="string">&quot;shopping&quot;</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºå¹¶æ˜ å°„ç´¢å¼•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PUT /&lt;target&gt;</span></span><br><span class="line"><span class="comment"># è¿™é‡Œè®¾ç½®ç´¢å¼•åˆ†ç‰‡æ•°é‡ä¸º1ï¼Œå‰¯æœ¬æ•°é‡ä¸º2ï¼Œå¹¶è®¾ç½®å­—æ®µä¿¡æ¯</span></span><br><span class="line">curl -X PUT -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;settings&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;number_of_shards&quot;:&quot;1&quot;,</span></span><br><span class="line"><span class="string">      &quot;number_of_replicas&quot;:&quot;2&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;mappings&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;properties&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;title&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;text&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;category&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;keyword&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;price&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;double&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;count&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;integer&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment">## settings: è¿™ä¸ªå‚æ•°ç”¨äºé…ç½®ç´¢å¼•çš„è®¾ç½®ï¼ŒåŒ…æ‹¬åˆ†ç‰‡æ•°é‡å’Œå‰¯æœ¬æ•°é‡ã€‚</span></span><br><span class="line"><span class="comment">### number_of_shards: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†ç´¢å¼•ä¸­åˆ†ç‰‡çš„æ•°é‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnumber_of_shards è®¾ç½®ä¸º 1ï¼Œæ„å‘³ç€ç´¢å¼•å°†åªæœ‰ä¸€ä¸ªä¸»åˆ†ç‰‡ã€‚</span></span><br><span class="line"><span class="comment">### number_of_replicas: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¯ä¸ªä¸»åˆ†ç‰‡çš„å‰¯æœ¬æ•°é‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnumber_of_replicas è®¾ç½®ä¸º 2ï¼Œæ„å‘³ç€æ¯ä¸ªä¸»åˆ†ç‰‡å°†æœ‰ä¸¤ä¸ªå‰¯æœ¬ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## mappings: è¿™ä¸ªå‚æ•°ç”¨äºå®šä¹‰ç´¢å¼•ä¸­çš„å­—æ®µå’Œå­—æ®µç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">### properties: è¿™ä¸ªå‚æ•°å®šä¹‰äº†ç´¢å¼•ä¸­çš„å­—æ®µå’Œå­—æ®µç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰å››ä¸ªå­—æ®µï¼štitleã€categoryã€images å’Œ priceã€‚</span></span><br><span class="line"><span class="comment">### title: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ textï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå…¨æ–‡æ£€ç´¢å­—æ®µã€‚text é€‚åˆå­˜å‚¨é•¿æ–‡æœ¬æ•°æ®ï¼Œå¹¶æ”¯æŒå…¨æ–‡æœç´¢ã€‚</span></span><br><span class="line"><span class="comment">### category: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ keywordï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå…³é”®å­—å­—æ®µï¼Œä¸æ”¯æŒå…¨æ–‡æ£€ç´¢ã€‚keyword é€‚åˆå­˜å‚¨ä¸éœ€è¦åˆ†è¯çš„çŸ­æ–‡æœ¬æ•°æ®ï¼ˆå¦‚æ ‡ç­¾ã€ç±»åˆ«ç­‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºèšåˆå’Œè¿‡æ»¤ã€‚</span></span><br><span class="line"><span class="comment">### price: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ doubleï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæ•°å­—å­—æ®µã€‚double è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°å­—æ®µï¼Œé€‚åˆå­˜å‚¨æ•°å€¼æ•°æ®ï¼Œå¦‚ä»·æ ¼</span></span><br><span class="line"><span class="comment">### count: è¿™ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ integerï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°å­—æ®µã€‚integer è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ•´æ•°å­—æ®µï¼Œé€‚åˆå­˜å‚¨æ•´æ•°æ•°æ®ï¼Œå¦‚å•†å“æ•°é‡ç­‰ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;shards_acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;index&quot;</span>:<span class="string">&quot;shopping&quot;</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ›´æ–°ç´¢å¼•æ˜ å°„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PUT /&lt;target&gt;/_mapping</span></span><br><span class="line"><span class="comment"># æ³¨æ„è¯¥apiåªèƒ½å¢åŠ æ–°çš„å­—æ®µï¼Œä¸èƒ½ä¿®æ”¹å·²æœ‰å­—æ®µï¼Œå¦‚æœè¦ä¿®æ”¹æºå­—æ®µç±»å‹æˆ–è€…åˆ†è¯å™¨ç±»å‹ï¼Œä¸‹æ–‡ä¼šä»‹ç»</span></span><br><span class="line">curl -X PUT -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_mapping&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;properties&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;remark&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;type&quot;:&quot;text&quot;,</span></span><br><span class="line"><span class="string">        &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &quot;address&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;type&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="string">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">        &quot;fields&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;keyword&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &quot;tags&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># è¿™é‡Œä¸ºç´¢å¼•æ·»åŠ äº†4ä¸ªå­—æ®µ</span></span><br><span class="line"><span class="comment"># remarkï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºtextï¼Œåˆ†è¯å™¨ä¸ºik_max_wordï¼Œæœç´¢åˆ†è¯å™¨ä¸ºik_smart</span></span><br><span class="line">  <span class="comment"># analyzer: ç´¢å¼•åˆ†è¯å™¨</span></span><br><span class="line">  <span class="comment"># search_analyzerï¼šæœç´¢åˆ†è¯å™¨</span></span><br><span class="line">  <span class="comment"># ik_max_wordï¼šä¸­æ–‡åˆ†è¯å™¨ï¼Œå°†å¥å­æ‹†åˆ†ä¸ºæœ€å¤šè¯å…ƒï¼Œé€‚åˆé•¿å¥å­</span></span><br><span class="line">  <span class="comment"># ik_smartï¼šä¸­æ–‡åˆ†è¯å™¨ï¼Œå°†å¥å­æ‹†åˆ†ä¸ºæœ€å°‘è¯å…ƒï¼Œé€‚åˆçŸ­å¥å­</span></span><br><span class="line"><span class="comment"># addressï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºtextï¼Œåˆ†è¯å™¨ä¸ºik_max_wordï¼Œæœç´¢åˆ†è¯å™¨æœªæŒ‡å®šï¼Œé»˜è®¤ä¸åˆ†è¯å™¨åŒä¸€ä¸ªï¼Œè¿™é‡Œè¿˜ä¸ºaddressæ·»åŠ äº†keywordå­—æ®µï¼Œç”¨äºå­˜å‚¨åŸå§‹æ•°æ®ï¼Œä»¥æ”¯æŒç²¾ç¡®æœç´¢</span></span><br><span class="line"><span class="comment"># tagsï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºkeywordï¼Œä¸æ”¯æŒåˆ†è¯ï¼Œé€‚åˆå­˜å‚¨çŸ­æ–‡æœ¬æ•°æ®ï¼ˆå¦‚æ ‡ç­¾ã€ç±»åˆ«ç­‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºèšåˆå’Œè¿‡æ»¤ï¼Œå¯ä»¥å­˜å‚¨æ•°ç»„</span></span><br><span class="line"><span class="comment"># created_atï¼šæ–°å¢å­—æ®µï¼Œç±»å‹ä¸ºdateï¼Œæ ¼å¼ä¸ºyyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ›´æ–°ç´¢å¼•è®¾ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PUT /&lt;target&gt;/_settings</span></span><br><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œä¸èƒ½æ›´æ–°number_of_shards</span></span><br><span class="line">curl -X PUT -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_settings&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;number_of_replicas&quot;:&quot;1&quot;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹æŒ‡å®šç´¢å¼•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GET /&lt;target&gt;</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping?pretty&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;shopping&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;aliases&quot;</span> : &#123; &#125;,</span><br><span class="line">    <span class="string">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;address&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;fields&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">              <span class="string">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;analyzer&quot;</span> : <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;category&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;count&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;integer&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;created_at&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;date&quot;</span>,</span><br><span class="line">          <span class="string">&quot;format&quot;</span> : <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;price&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;double&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;remark&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;analyzer&quot;</span> : <span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">          <span class="string">&quot;search_analyzer&quot;</span> : <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;title&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;settings&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;index&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;routing&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;allocation&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;include&quot;</span> : &#123;</span><br><span class="line">              <span class="string">&quot;_tier_preference&quot;</span> : <span class="string">&quot;data_content&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;number_of_shards&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;provided_name&quot;</span> : <span class="string">&quot;shopping&quot;</span>,</span><br><span class="line">        <span class="string">&quot;creation_date&quot;</span> : <span class="string">&quot;1745291743120&quot;</span>,</span><br><span class="line">        <span class="string">&quot;number_of_replicas&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;uuid&quot;</span> : <span class="string">&quot;Y1IWrdlQTUm-CbbIWweSxQ&quot;</span>,</span><br><span class="line">        <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;created&quot;</span> : <span class="string">&quot;8525000&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ç´¢å¼•è®¾ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GET /&lt;target&gt;/_settings</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_settings?pretty&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;shopping&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;address&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;fields&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">              <span class="string">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;analyzer&quot;</span> : <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;category&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;count&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;integer&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;created_at&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;date&quot;</span>,</span><br><span class="line">          <span class="string">&quot;format&quot;</span> : <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;price&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;double&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;remark&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;analyzer&quot;</span> : <span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">          <span class="string">&quot;search_analyzer&quot;</span> : <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;title&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å­—æ®µæ˜ å°„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GET /&lt;target&gt;/_mapping/field/&lt;field&gt;</span></span><br><span class="line"><span class="comment"># shopping ä¸ºç´¢å¼•åç§°ï¼Œtitle ä¸ºå­—æ®µåç§°</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_mapping/field/title?pretty&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;shopping&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;title&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;full_name&quot;</span> : <span class="string">&quot;title&quot;</span>,</span><br><span class="line">        <span class="string">&quot;mapping&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;title&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ -I å‚æ•°æ¥å‘é€ HEAD è¯·æ±‚ï¼Œå¯ä»¥è·å–å“åº”å¤´è€Œä¸å¿…ä¸‹è½½å“åº”ä½“ã€‚</span></span><br><span class="line"><span class="comment"># HEAD /&lt;target&gt;</span></span><br><span class="line">curl -I -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">X-elastic-product: Elasticsearch</span><br><span class="line">content-type: application/json</span><br><span class="line">content-length: 603</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªå‘½ä»¤ä¸ä¼šè¿”å›å“åº”ä½“ï¼Œä½†å®ƒçš„ HTTP å“åº”ä»£ç å¯ä»¥å‘Šè¯‰ä½ ç´¢å¼•çš„å­˜åœ¨æƒ…å†µï¼š</span></span><br><span class="line">  <span class="comment"># 200 OK è¡¨ç¤ºç´¢å¼•å­˜åœ¨ã€‚</span></span><br><span class="line">  <span class="comment"># 404 Not Found è¡¨ç¤ºç´¢å¼•ä¸å­˜åœ¨ã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤ç´¢å¼•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DELETE /&lt;target&gt;</span></span><br><span class="line">curl -X DELETE -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºç´¢å¼•åˆ›å»ºåˆ«å</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ï¼šä¸åŒç´¢å¼•å¯ä»¥æœ‰ç›¸åŒåç§°çš„åˆ«åï¼Œæ‰€ä»¥åœ¨æ•°æ®ç»“æ„ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒçš„ç´¢å¼•åˆ›å»ºç›¸åŒçš„åˆ«åï¼Œç„¶åæ ¹æ®åˆ«åè¿›è¡Œæ•°æ®æŸ¥è¯¢</span></span><br><span class="line"><span class="comment"># POST /&lt;target&gt;/_alias/&lt;alias&gt;</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/_aliases&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;actions&quot;: [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        &quot;add&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;index&quot;: &quot;shopping&quot;,</span></span><br><span class="line"><span class="string">          &quot;alias&quot;: &quot;shopping_alias2&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ç´¢å¼•åˆ«å</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GET /&lt;target&gt;/_alias/&lt;alias&gt;</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias?pretty&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;shopping&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;aliases&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;shopping_alias&quot;</span> : &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç´¢å¼•çš„æ‰€æœ‰åˆ«å</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_alias?pretty&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„åˆ«å</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/_alias?pretty&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºç´¢å¼•åˆ é™¤åˆ«å</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DELETE /&lt;target&gt;/_alias/&lt;alias&gt;</span></span><br><span class="line">curl -X DELETE -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_alias/shopping_alias&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•ä¿®æ”¹ç´¢å¼•å­—æ®µç±»å‹æˆ–åˆ†è¯å™¨ç±»å‹ï¼Ÿ">å¦‚ä½•ä¿®æ”¹ç´¢å¼•å­—æ®µç±»å‹æˆ–åˆ†è¯å™¨ç±»å‹ï¼Ÿ</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºæ–°çš„ç´¢å¼•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œä¸ºtitleå­—æ®µå¢åŠ åˆ†è¯å™¨</span></span><br><span class="line">curl -X PUT -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping_new&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;settings&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;number_of_shards&quot;:&quot;1&quot;,</span></span><br><span class="line"><span class="string">      &quot;number_of_replicas&quot;:&quot;2&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;mappings&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;properties&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;category&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;keyword&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;price&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;double&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;count&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;integer&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;title&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;:&quot;text&quot;,</span></span><br><span class="line"><span class="string">          &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">          &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;remark&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;type&quot;:&quot;text&quot;,</span></span><br><span class="line"><span class="string">        &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &quot;address&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;type&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="string">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">        &quot;fields&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;keyword&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &quot;tags&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &quot;created_at&quot;: &#123;&quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot;&#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°†åŸç´¢å¼•çš„æ•°æ®è¿ç§»åˆ°æ–°ç´¢å¼•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/_reindex&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;source&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;index&quot;: &quot;shopping&quot;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;dest&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;index&quot;: &quot;shopping_new&quot;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;took&quot;</span>:101,<span class="string">&quot;timed_out&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;total&quot;</span>:2,<span class="string">&quot;updated&quot;</span>:0,<span class="string">&quot;created&quot;</span>:2,<span class="string">&quot;deleted&quot;</span>:0,<span class="string">&quot;batches&quot;</span>:1,<span class="string">&quot;version_conflicts&quot;</span>:0,<span class="string">&quot;noops&quot;</span>:0,<span class="string">&quot;retries&quot;</span>:&#123;<span class="string">&quot;bulk&quot;</span>:0,<span class="string">&quot;search&quot;</span>:0&#125;,<span class="string">&quot;throttled_millis&quot;</span>:0,<span class="string">&quot;requests_per_second&quot;</span>:-1.0,<span class="string">&quot;throttled_until_millis&quot;</span>:0,<span class="string">&quot;failures&quot;</span>:[]&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤åŸç´¢å¼•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X DELETE -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºæ–°ç´¢å¼•åˆ›å»ºåˆ«å</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping_new/_alias/shopping&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;errors&quot;</span>:<span class="literal">false</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®å¢åˆ æ”¹åŸºæœ¬æ“ä½œ">æ•°æ®å¢åˆ æ”¹åŸºæœ¬æ“ä½œ</h2><ul class="lvl-0"><li class="lvl-2"><p>æ–°å¢æ•°æ®</p><ul class="lvl-2"><li class="lvl-4">1.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_docæ–¹å¼ï¼šä¸æŒ‡å®šidé»˜è®¤éšæœºå­—ç¬¦ä¸²)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _doc çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¯ä»¥ä¸æŒ‡å®šidï¼Œé»˜è®¤ä¼šåˆ›å»ºæ–°çš„idï¼Œidç±»å‹ä¸ºéšæœºå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"># POST /&lt;target&gt;/_doc</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_doc?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class="line"><span class="string">    &quot;price&quot;: 999.99,</span></span><br><span class="line"><span class="string">    &quot;count&quot;: 10,</span></span><br><span class="line"><span class="string">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class="line"><span class="string">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class="line"><span class="string">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class="line"><span class="string">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class="line"><span class="string">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;shopping_new&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;sImNW5YBmgASmV9McVvI&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_version&quot;</span> : 1,</span><br><span class="line">  <span class="string">&quot;result&quot;</span> : <span class="string">&quot;created&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : 3,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;_seq_no&quot;</span> : 1,</span><br><span class="line">  <span class="string">&quot;_primary_term&quot;</span> : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-2"><li class="lvl-4">2.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_docæ–¹å¼ï¼šæŒ‡å®šid)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _doc çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¦‚æœæŒ‡å®šidï¼Œå†æ¬¡æ‰§è¡Œæ—¶ä¼šå…ˆåˆ é™¤åŸæ•°æ®å†åˆ›å»ºæ–°æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»å…¨é‡æ›´æ–°æ‰è¡Œã€‚</span></span><br><span class="line"><span class="comment"># PUT /&lt;target&gt;/_doc</span></span><br><span class="line">curl -X PUT -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_doc/100?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class="line"><span class="string">    &quot;price&quot;: 999.99,</span></span><br><span class="line"><span class="string">    &quot;count&quot;: 10,</span></span><br><span class="line"><span class="string">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class="line"><span class="string">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class="line"><span class="string">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class="line"><span class="string">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class="line"><span class="string">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;shopping_new&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;100&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_version&quot;</span> : 1,</span><br><span class="line">  <span class="string">&quot;result&quot;</span> : <span class="string">&quot;created&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : 3,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;_seq_no&quot;</span> : 2,</span><br><span class="line">  <span class="string">&quot;_primary_term&quot;</span> : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-2"><li class="lvl-4"><p>3.ä¸ºæŒ‡å®šç´¢å¼•æ’å…¥ä¸€æ¡æ•°æ®(_createæ–¹å¼ï¼šæŒ‡å®šid)</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _create çš„æ–¹å¼åˆ›å»ºç´¢å¼•æ•°æ®æ—¶ï¼Œå¿…é¡»æŒ‡å®šid,è€Œä¸”åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸ºæ‰§è¡Œè¿‡ä¸€æ¬¡åæŒ‡å®šidçš„æ•°æ®å°±å­˜åœ¨äº†ï¼Œä¸èƒ½å†æ¬¡åˆ›å»º</span></span><br><span class="line"><span class="comment"># POST /&lt;target&gt;/_create/&lt;id&gt;</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_create/1?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class="line"><span class="string">    &quot;price&quot;: 999.99,</span></span><br><span class="line"><span class="string">    &quot;count&quot;: 10,</span></span><br><span class="line"><span class="string">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class="line"><span class="string">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class="line"><span class="string">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class="line"><span class="string">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class="line"><span class="string">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure></li><li class="lvl-2"><p>ä¿®æ”¹æ•°æ®</p><ul class="lvl-2"><li class="lvl-4">1.ä¿®æ”¹å…¨éƒ¨æ•°æ®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># POST /&lt;target&gt;/_doc/&lt;id&gt;</span></span><br><span class="line"><span class="comment"># æ‰§è¡Œæ—¶ä¼šå…ˆåˆ é™¤åŸæ•°æ®å†åˆ›å»ºæ–°æ•°æ®ï¼Œæ‰€ä»¥å¿…é¡»å…¨é‡æ›´æ–°æ‰è¡Œã€‚</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_doc/sImNW5YBmgASmV9McVvI&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;category&quot;: &quot;electronics&quot;,</span></span><br><span class="line"><span class="string">    &quot;price&quot;: 999.99,</span></span><br><span class="line"><span class="string">    &quot;count&quot;: 20,</span></span><br><span class="line"><span class="string">    &quot;title&quot;: &quot;Smartphone X - 128GB&quot;,</span></span><br><span class="line"><span class="string">    &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;,</span></span><br><span class="line"><span class="string">    &quot;address&quot;: &quot;123 Electronic Ave, Beijing, China&quot;,</span></span><br><span class="line"><span class="string">    &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;],</span></span><br><span class="line"><span class="string">    &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-2"><li class="lvl-4">2.ä¿®æ”¹éƒ¨åˆ†æ•°æ®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># POST /&lt;target&gt;/_update/&lt;id&gt;</span></span><br><span class="line"><span class="comment"># æ‰§è¡Œæ—¶åªä¼šä¿®æ”¹æŒ‡å®šå­—æ®µï¼Œä¸ä¼šåˆ é™¤åŸæ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥éƒ¨åˆ†æ›´æ–°ã€‚</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_update/1&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;doc&quot;:&#123;&quot;count&quot;:100&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure></li><li class="lvl-2"><p>æŸ¥è¯¢æŒ‡å®šç´¢å¼•çš„æŒ‡å®šidçš„æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GET /&lt;target&gt;/_doc/&lt;id&gt;</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_doc/100?pretty&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;shopping_new&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;100&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_version&quot;</span> : 1,</span><br><span class="line">  <span class="string">&quot;_seq_no&quot;</span> : 2,</span><br><span class="line">  <span class="string">&quot;_primary_term&quot;</span> : 1,</span><br><span class="line">  <span class="string">&quot;found&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;_source&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;category&quot;</span> : <span class="string">&quot;electronics&quot;</span>,</span><br><span class="line">    <span class="string">&quot;price&quot;</span> : 999.99,</span><br><span class="line">    <span class="string">&quot;count&quot;</span> : 10,</span><br><span class="line">    <span class="string">&quot;title&quot;</span> : <span class="string">&quot;Smartphone X - 128GB&quot;</span>,</span><br><span class="line">    <span class="string">&quot;remark&quot;</span> : <span class="string">&quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;address&quot;</span> : <span class="string">&quot;123 Electronic Ave, Beijing, China&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tags&quot;</span> : [</span><br><span class="line">      <span class="string">&quot;latest&quot;</span>,</span><br><span class="line">      <span class="string">&quot;smartphone&quot;</span>,</span><br><span class="line">      <span class="string">&quot;technology&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;created_at&quot;</span> : <span class="string">&quot;2025-04-22 03:30:02&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤æŒ‡å®šç´¢å¼•çš„æŒ‡å®šidçš„æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DELETE /&lt;target&gt;/_doc/&lt;id&gt;</span></span><br><span class="line">curl -X DELETE -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_doc/100&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤ç´¢å¼•å…¨éƒ¨æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_delete_by_query?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="æ‰¹é‡æ“ä½œ">æ‰¹é‡æ“ä½œ</h2><ul class="lvl-0"><li class="lvl-2"><p>æ‰¹é‡æ–°å¢æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼</span></span><br><span class="line"><span class="comment"># POST /_bulk</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;1&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;2&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;3&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;4&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;5&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123; &quot;_index&quot;: &quot;shopping&quot;, &quot;_id&quot;: &quot;6&quot; &#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># index: ç”¨äºåˆ›å»ºæ–°æ–‡æ¡£æˆ–æ›¿æ¢å·²æœ‰æ–‡æ¡£ã€‚</span></span><br><span class="line"><span class="comment"># create: ç”¨äºåˆ›å»ºæ–°æ–‡æ¡£ï¼Œå¦‚æœæ–‡æ¡£å·²å­˜åœ¨ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚</span></span><br><span class="line"><span class="comment"># _index: æŒ‡å®šç´¢å¼•åç§°ã€‚</span></span><br><span class="line"><span class="comment"># _id: æŒ‡å®šæ–‡æ¡£IDã€‚å¦‚æœä¸æŒ‡å®šåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„IDã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡æ–°å¢æ•°æ®æ—¶ä¹Ÿå¯ä»¥åœ¨urlä¸­æŒ‡å®šç´¢å¼•åç§°</span></span><br><span class="line"><span class="comment"># æ­¤æ—¶å¯ä»¥æŒ‡å®šidï¼Œå¦‚æœä¸æŒ‡å®šåˆ™è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²çš„ID</span></span><br><span class="line"><span class="comment"># POST /&lt;target&gt;/_bulk</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_bulk&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 999.99, &quot;count&quot;: 10, &quot;title&quot;: &quot;Smartphone X - 128GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;fashion&quot;, &quot;price&quot;: 49.99, &quot;count&quot;: 25, &quot;title&quot;: &quot;Designer T-shirt&quot;, &quot;remark&quot;: &quot;Trendy designer T-shirt made with high quality fabric.&quot;, &quot;address&quot;: &quot;å¹¿å·è”æ¹¾å¤§å¦&quot;, &quot;tags&quot;: [&quot;clothing&quot;, &quot;designer&quot;, &quot;style&quot;], &quot;created_at&quot;: &quot;2025-04-21 12:15:00&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;home_appliances&quot;, &quot;price&quot;: 299.99, &quot;count&quot;: 5, &quot;title&quot;: &quot;Robot Vacuum Cleaner&quot;, &quot;remark&quot;: &quot;Efficient robot vacuum cleaner with smart navigation.&quot;, &quot;address&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;, &quot;tags&quot;: [&quot;appliances&quot;, &quot;vacuum&quot;, &quot;robot&quot;], &quot;created_at&quot;: &quot;2025-04-20 08:45:30&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;books&quot;, &quot;price&quot;: 19.99, &quot;count&quot;: 100, &quot;title&quot;: &quot;Inspirational Novel&quot;, &quot;remark&quot;: &quot;A gripping novel that inspires and motivates.&quot;, &quot;address&quot;: &quot;321 Book Rd, Shenzhen, China&quot;, &quot;tags&quot;: [&quot;book&quot;, &quot;novel&quot;, &quot;inspiration&quot;], &quot;created_at&quot;: &quot;2025-04-19 10:05:00&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;groceries&quot;, &quot;price&quot;: 3.99, &quot;count&quot;: 200, &quot;title&quot;: &quot;Organic Apples&quot;, &quot;remark&quot;: &quot;Fresh and crispy organic apples.&quot;, &quot;address&quot;: &quot;654 Grocery Ln, Chengdu, China&quot;, &quot;tags&quot;: [&quot;fruit&quot;, &quot;organic&quot;, &quot;healthy&quot;], &quot;created_at&quot;: &quot;2025-04-18 14:30:45&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;category&quot;: &quot;electronics&quot;, &quot;price&quot;: 1999.99, &quot;count&quot;: 15, &quot;title&quot;: &quot;Smartphone X - 256GB&quot;, &quot;remark&quot;: &quot;This latest Smartphone X comes with a powerful processor and high-resolution camera.&quot;, &quot;address&quot;: &quot;å¹¿å·å¤©æ²³å…¬å›­&quot;, &quot;tags&quot;: [&quot;latest&quot;, &quot;smartphone&quot;, &quot;technology&quot;], &quot;created_at&quot;: &quot;2025-04-22 03:30:02&quot; &#125;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰¹é‡ä¿®æ”¹æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;1&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;Smartphone X2 - 128GB&quot;,&quot;price&quot;:1000.11&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;update&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;2&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;T-shirt&quot;,&quot;price&quot;:45.99&#125;&#125;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># update: ç”¨äºæ›´æ–°æ–‡æ¡£ã€‚</span></span><br><span class="line"><span class="comment"># doc: æŒ‡å®šè¦æ›´æ–°çš„å­—æ®µã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰¹é‡åˆ é™¤æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„æ•°æ®è¡Œè¦é¡¶è¡Œå†™ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/_bulk&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;1&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;2&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;3&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;delete&quot;:&#123;&quot;_index&quot;:&quot;shopping&quot;,&quot;_id&quot;:&quot;4&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># delete: ç”¨äºåˆ é™¤æ–‡æ¡£ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="æ¡ä»¶æ›´æ–°">æ¡ä»¶æ›´æ–°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># POST /&lt;target&gt;/_update_by_query</span></span><br><span class="line"><span class="comment"># è¿™é‡Œå°†categoryä¸ºåä¸ºçš„æ•°æ®ä»·æ ¼æ”¹ä¸º1999</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_update_by_query?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;query&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;match&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;category&quot;: &quot;books&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;script&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;source&quot;: &quot;ctx._source.price = 20.99&quot;,</span></span><br><span class="line"><span class="string">      &quot;lang&quot;: &quot;painless&quot;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment">## &quot;query&quot;: &#123;&#125;  æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line"><span class="comment">## &quot;script&quot;: &#123;&#125;  è„šæœ¬</span></span><br><span class="line"><span class="comment">### source: è„šæœ¬å†…å®¹</span></span><br><span class="line"><span class="comment">### lang: è„šæœ¬è¯­è¨€</span></span><br><span class="line"><span class="comment">#### painless æ˜¯ Elasticsearch å®˜æ–¹æä¾›çš„è„šæœ¬è¯­è¨€ï¼Œå®ƒæä¾›äº†è®¸å¤šå†…ç½®å‡½æ•°å’Œå˜é‡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°å„ç§å¤æ‚çš„é€»è¾‘æ“ä½œã€‚https://www.elastic.co/guide/en/elasticsearch/painless/current/painless-lang-spec.html</span></span><br></pre></td></tr></table></figure><h2 id="æ¡ä»¶åˆ é™¤">æ¡ä»¶åˆ é™¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># POST /&lt;target&gt;/_delete_by_query</span></span><br><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_delete_by_query?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;books&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="æ¡ä»¶æŸ¥è¯¢">æ¡ä»¶æŸ¥è¯¢</h2><h3 id="match-all-å…¨éƒ¨åŒ¹é…æŸ¥è¯¢">match_all: å…¨éƒ¨åŒ¹é…æŸ¥è¯¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GET /&lt;target&gt;/_search</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span></span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ç®€å†™ä¸º</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="term-ç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼ˆå…³é”®å­—æŸ¥è¯¢ï¼Œå³ä¸åˆ†è¯ï¼‰">term: ç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼ˆå…³é”®å­—æŸ¥è¯¢ï¼Œå³ä¸åˆ†è¯ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå­—æ®µè¢«é¢å¤–è®¾ç½® keyword ç±»å‹ï¼Œåˆ™éœ€è¦åŠ ä¸Š .keyword åç¼€</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;address.keyword&quot;:&quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># termå¤„ç†å¤šå€¼å­—æ®µ(æ•°ç»„)æ—¶ï¼ŒtermæŸ¥è¯¢æ˜¯åŒ…å«ï¼Œä¸æ˜¯ç­‰äº</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;term&quot;:&#123;&quot;tags&quot;:&quot;technology&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="terms-å¤šå…³é”®å­—ç²¾ç¡®åŒ¹é…æŸ¥è¯¢">terms: å¤šå…³é”®å­—ç²¾ç¡®åŒ¹é…æŸ¥è¯¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;terms&quot;:&#123;&quot;category&quot;:[&quot;electronics&quot;,&quot;books&quot;]&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="range-èŒƒå›´æŸ¥è¯¢">range: èŒƒå›´æŸ¥è¯¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class="line">  <span class="comment"># gte: å¤§äºç­‰äº</span></span><br><span class="line">  <span class="comment"># lte: å°äºç­‰äº</span></span><br><span class="line">  <span class="comment"># gt: å¤§äº</span></span><br><span class="line">  <span class="comment"># lt: å°äº</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¶é—´èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;created_at&quot;:&#123;&quot;gte&quot;:&quot;2025-04-20 00:00:00&quot;,&quot;lte&quot;:&quot;2025-05-20 23:59:59&quot;&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºäºæ—¥æœŸæ•°å­¦è¡¨è¾¾å¼æŸ¥è¯¢</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;created_at&quot;:&#123;&quot;gte&quot;:&quot;now-1y&quot;&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”¯æŒçš„æ—¥æœŸè¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment"># - nowï¼šå½“å‰æ—¶é—´ç‚¹ã€‚</span></span><br><span class="line"><span class="comment"># - now-1dï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å¤©çš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class="line"><span class="comment"># - now-1wï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å‘¨çš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class="line"><span class="comment"># - now-1Mï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1ä¸ªæœˆçš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class="line"><span class="comment"># - now-1yï¼šä»å½“å‰æ—¶é—´ç‚¹å‘å‰æ¨1å¹´çš„æ—¶é—´ç‚¹ã€‚</span></span><br><span class="line"><span class="comment"># - now+1hï¼šä»å½“å‰æ—¶é—´ç‚¹å‘åæ¨1å°æ—¶çš„æ—¶é—´ç‚¹ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="exists-æŸ¥è¯¢å­—æ®µå­˜åœ¨çš„æ•°æ®">exists: æŸ¥è¯¢å­—æ®µå­˜åœ¨çš„æ•°æ®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;exists&quot;:&#123;&quot;field&quot;:&quot;title&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class="line">  <span class="comment"># field: æŒ‡å®šè¦æŸ¥è¯¢çš„å­—æ®µ</span></span><br><span class="line">  <span class="comment"># ç¤ºä¾‹ï¼šæŸ¥è¯¢ title å­—æ®µå­˜åœ¨çš„æ–‡æ¡£</span></span><br></pre></td></tr></table></figure><h3 id="ids-æ ¹æ®ä¸€ç»„IDæŸ¥è¯¢">ids: æ ¹æ®ä¸€ç»„IDæŸ¥è¯¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;ids&quot;:&#123;&quot;values&quot;:[&quot;1&quot;,&quot;2&quot;]&#125;&#125;&#125;&#x27;</span></span><br><span class="line">  <span class="comment"># values: æŒ‡å®šè¦æŸ¥è¯¢çš„IDåˆ—è¡¨</span></span><br><span class="line">  <span class="comment"># ç¤ºä¾‹ï¼šæŸ¥è¯¢IDä¸º1å’Œ2çš„æ–‡æ¡£</span></span><br></pre></td></tr></table></figure><h3 id="prefix-å‰ç¼€æŸ¥è¯¢">prefix: å‰ç¼€æŸ¥è¯¢</h3><ul class="lvl-0"><li class="lvl-2"><p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;category&quot;:&quot;elec&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»…é€‚ç”¨äºkeywordç±»å‹å­—æ®µï¼Œæ‰€ä»¥ä¸‹é¢è¿™ä¸ªè¯·æ±‚æŸ¥è¯¢ä¸åˆ°æ•°æ®</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;address&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># å› ä¸ºaddressè¢«é™„åŠ äº†keywordç±»å‹ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š.keywordåç¼€åå¯ä»¥æŸ¥è¯¢åˆ°æ•°æ®</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;prefix&quot;:&#123;&quot;address.keyword&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="wildcard-é€šé…ç¬¦æŸ¥è¯¢">wildcard: é€šé…ç¬¦æŸ¥è¯¢</h3><ul class="lvl-0"><li class="lvl-2"><p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;wildcard&quot;:&#123;&quot;category&quot;:&quot;e?e*&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># ?: ä»»æ„å•ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="comment"># *: ä»»æ„å¤šä¸ªå­—ç¬¦</span></span><br></pre></td></tr></table></figure><h3 id="regexp-æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢">regexp: æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢</h3><ul class="lvl-0"><li class="lvl-2"><p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;regexp&quot;:&#123;&quot;category&quot;:&quot;e.e.*&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="fuzzy-æ”¯æŒç¼–è¾‘è·ç¦»çš„æ¨¡ç³ŠæŸ¥è¯¢">fuzzy: æ”¯æŒç¼–è¾‘è·ç¦»çš„æ¨¡ç³ŠæŸ¥è¯¢</h3><ul class="lvl-0"><li class="lvl-2"><p>ä»…é€‚ç”¨äºå…³é”®å­—ç±»å‹(keyword)çš„å­—æ®µ</p></li><li class="lvl-2"><p>fuzzyæ£€ç´¢æ˜¯ä¸€ç§å¼ºå¤§çš„æœç´¢åŠŸèƒ½ï¼Œå®ƒèƒ½å¤Ÿåœ¨ç”¨æˆ·è¾“å…¥å†…å®¹å­˜åœ¨æ‹¼å†™é”™è¯¯æˆ–ä¸Šä¸‹æ–‡ä¸ä¸€è‡´æ—¶ï¼Œä»ç„¶è¿”å›ä¸æœç´¢è¯ç›¸ä¼¼çš„æ–‡æ¡£ã€‚é€šè¿‡ä½¿ç”¨ç¼–è¾‘è·ç¦»ç®—æ³•æ¥åº¦é‡è¾“å…¥è¯ä¸æ–‡æ¡£ä¸­è¯æ¡çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œæ¨¡ç³ŠæŸ¥è¯¢åœ¨ä¿è¯æœç´¢ç»“æœç›¸å…³æ€§çš„åŒæ—¶ï¼Œæœ‰æ•ˆåœ°æé«˜äº†æœç´¢å®¹é”™èƒ½åŠ›ã€‚</p></li><li class="lvl-2"><p>ç¼–è¾‘è·ç¦»æ˜¯æŒ‡ä»ä¸€ä¸ªå•è¯è½¬æ¢åˆ°å¦ä¸€ä¸ªå•è¯éœ€è¦ç¼–è¾‘å•å­—ç¬¦çš„æ¬¡æ•°ã€‚å¦‚ä¸­æ–‡é›†å›¢åˆ°ä¸­å¨é›†å›¢ç¼–è¾‘è·ç¦»å°±æ˜¯1ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸ªå­—ç¬¦ï¼›å¦‚æœfuzzinesså€¼åœ¨è¿™é‡Œè®¾ç½®æˆ2ï¼Œä¼šæŠŠç¼–è¾‘è·ç¦»ä¸º2çš„ä¸œä¸œé›†å›¢ä¹ŸæŸ¥å‡ºæ¥ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">      &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;fuzzy&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;category&quot;:&#123;</span></span><br><span class="line"><span class="string">            &quot;value&quot;:&quot;beeks&quot;,</span></span><br><span class="line"><span class="string">            &quot;fuzziness&quot;:&quot;2&quot;,</span></span><br><span class="line"><span class="string">            &quot;prefix_length&quot;:1</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;&#x27;</span></span><br><span class="line"><span class="comment"># fuzzinessï¼šç”¨äºç¼–è¾‘è·ç¦»çš„è®¾ç½®ï¼Œå…¶é»˜è®¤å€¼ä¸ºAUTOï¼Œæ”¯æŒçš„æ•°å€¼ä¸º[0ï¼Œ1ï¼Œ2]ã€‚å¦‚æœå€¼è®¾ç½®è¶Šç•Œä¼šæŠ¥é”™ã€‚</span></span><br><span class="line"><span class="comment"># prefix_length: æœç´¢è¯çš„å‰ç¼€é•¿åº¦ï¼Œåœ¨æ­¤é•¿åº¦å†…ä¸ä¼šåº”ç”¨æ¨¡ç³ŠåŒ¹é…ã€‚é»˜è®¤æ˜¯0ï¼Œå³æ•´ä¸ªè¯éƒ½ä¼šè¢«æ¨¡ç³ŠåŒ¹é…ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="match-å…¨æ–‡æ£€ç´¢-å³åˆ†è¯">match: å…¨æ–‡æ£€ç´¢(å³åˆ†è¯)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;query&quot;:&#123;&quot;match&quot;:&#123;&quot;address&quot;:&quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å› ä¸º desc çš„ç´¢å¼•åˆ†è¯å™¨æ˜¯ ik_max_wordï¼ŒæŸ¥çœ‹â€œå¹¿å·ç™½äº‘å±±å…¬å›­â€è¢«åˆ†è¯åçš„ç»“æœ</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/_analyze?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">        &quot;text&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;</span></span><br><span class="line"><span class="string">    &#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokens&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;å¹¿å·&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 2,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;ç™½äº‘å±±&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 2,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 5,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;ç™½äº‘&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 2,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 4,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;äº‘å±±&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 3,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 5,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;å…¬å›­&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 5,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 7,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 4</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># æ‰€ä»¥åªè¦descä¸­åŒ…å«å¦‚ä¸Šè¿™äº›å†…å®¹çš„æ•°æ®éƒ½ä¼šè¢«åŒ¹é…ä¸Š</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½†æ˜¯è¿™æ ·åŒ¹é…çš„ç»“æœå°±ä¸å¤Ÿç²¾ç¡®ï¼Œå¦‚ä½•å°½é‡åŒ¹é…æ›´å¤šçš„åˆ†è¯å‘¢ï¼Œå¯ä»¥å¢åŠ  minimum_should_match</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;match&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;address&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;query&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;,</span></span><br><span class="line"><span class="string">          &quot;minimum_should_match&quot;: 2</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"><span class="comment"># minimum_should_match: 2 è¡¨ç¤ºè‡³å°‘åŒ¹é…ä¸¤ä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå¸Œæœ›å…¨éƒ¨éƒ½åŒ¹é…å‘¢</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;match&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;address&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;query&quot;: &quot;å¹¿å·ç™½äº‘å±±å…¬å›­&quot;,</span></span><br><span class="line"><span class="string">          &quot;operator&quot;: &quot;and&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"><span class="comment"># operator: and è¡¨ç¤ºå…¨éƒ¨åŒ¹é…ï¼Œæ­¤æ—¶ç›¸å½“äºç²¾ç¡®åŒ¹é…ï¼Œå…¶é»˜è®¤å€¼æ˜¯ or</span></span><br></pre></td></tr></table></figure><h3 id="multi-match-å¤šå­—æ®µæŸ¥è¯¢">multi_match: å¤šå­—æ®µæŸ¥è¯¢</h3><ul class="lvl-0"><li class="lvl-2"><p>multi_matchæŸ¥è¯¢åœ¨Elasticsearchä¸­ç”¨äºåœ¨å¤šä¸ªå­—æ®µä¸Šæ‰§è¡Œç›¸åŒçš„æœç´¢æ“ä½œã€‚å®ƒå¯ä»¥æ¥å—ä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨æŒ‡å®šçš„å­—æ®µé›†åˆä¸­æœç´¢è¿™ä¸ªå­—ç¬¦ä¸²ã€‚multi_matchæŸ¥è¯¢æä¾›äº†çµæ´»çš„åŒ¹é…ç±»å‹å’Œæ“ä½œç¬¦é€‰é¡¹ï¼Œä»¥ä¾¿æ ¹æ®ä¸åŒçš„æœç´¢éœ€æ±‚è°ƒæ•´æœç´¢è¡Œä¸ºã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;multi_match&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;query&quot;: &quot;å¹¿å·shirt&quot;,</span></span><br><span class="line"><span class="string">        &quot;fields&quot;:[&quot;title&quot;,&quot;address&quot;]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"><span class="comment"># query: æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line"><span class="comment"># fields: æŒ‡å®šå¤šä¸ªå­—æ®µè¿›è¡ŒåŒ¹é…</span></span><br></pre></td></tr></table></figure><h3 id="match-phrase-çŸ­è¯­æŸ¥è¯¢">match_phrase: çŸ­è¯­æŸ¥è¯¢</h3><ul class="lvl-0"><li class="lvl-2"><p>match_phraseæŸ¥è¯¢åœ¨Elasticsearchä¸­ç”¨äºæ‰§è¡ŒçŸ­è¯­æœç´¢ï¼Œå®ƒä¸ä»…åŒ¹é…æ•´ä¸ªçŸ­è¯­ï¼Œè€Œä¸”è¿˜è€ƒè™‘äº†çŸ­è¯­ä¸­å„ä¸ªè¯çš„é¡ºåºå’Œä½ç½®ã€‚è¿™ç§æŸ¥è¯¢ç±»å‹å¯¹äºæœç´¢ç²¾ç¡®çŸ­è¯­éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨ç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢ä¸æ–‡æ¡£ä¸­çš„æ–‡æœ¬è¡¨è¾¾æ–¹å¼éœ€è¦ä¸¥æ ¼åŒ¹é…æ—¶ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;match_phrase&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;address&quot;:&#123;</span></span><br><span class="line"><span class="string">          &quot;query&quot;:&quot;å¹¿å·ç™½äº‘å±±&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¦æ±‚æŸ¥è¯¢ç»“æœä¸­çš„æ•°æ®å¿…é¡»åŒ…å«&quot;å¹¿å·ç™½äº‘å±±&quot;ï¼Œè€Œä¸”â€œå¹¿å·â€å’Œâ€œç™½äº‘å±±â€è¿™ä¸¤ä¸ªè¯æ˜¯ä¸èƒ½åˆ†å¼€çš„ï¼Œå› ä¸º match_phrase åŒ¹é…çš„æ˜¯ç›¸é‚»è¯æ¡</span></span><br></pre></td></tr></table></figure><h3 id="query-string-æ”¯æŒä¸æˆ–éè¡¨è¾¾å¼çš„æŸ¥è¯¢">query_string: æ”¯æŒ<code>ä¸æˆ–é</code>è¡¨è¾¾å¼çš„æŸ¥è¯¢</h3><ul class="lvl-0"><li class="lvl-2"><p>query_stringæŸ¥è¯¢æ˜¯ä¸€ç§çµæ´»çš„æŸ¥è¯¢ç±»å‹ï¼Œå®ƒå…è®¸ä½¿ç”¨LuceneæŸ¥è¯¢è¯­æ³•æ¥æ„å»ºå¤æ‚çš„æœç´¢æŸ¥è¯¢ã€‚è¿™ç§æŸ¥è¯¢ç±»å‹æ”¯æŒå¤šç§é€»è¾‘è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ä¸ï¼ˆANDï¼‰ã€æˆ–ï¼ˆORï¼‰å’Œéï¼ˆNOTï¼‰ï¼Œä»¥åŠé€šé…ç¬¦ã€æ¨¡ç³Šæœç´¢å’Œæ­£åˆ™è¡¨è¾¾å¼ç­‰åŠŸèƒ½ã€‚query_stringæŸ¥è¯¢å¯ä»¥åœ¨å•ä¸ªæˆ–å¤šä¸ªå­—æ®µä¸Šè¿›è¡Œæœç´¢ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†å¤æ‚çš„æŸ¥è¯¢é€»è¾‘ã€‚</p></li><li class="lvl-2"><p>æ³¨æ„: æŸ¥è¯¢å­—æ®µåˆ†è¯å°±å°†æŸ¥è¯¢æ¡ä»¶åˆ†è¯æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å­—æ®µä¸åˆ†è¯å°†æŸ¥è¯¢æ¡ä»¶ä¸åˆ†è¯æŸ¥è¯¢</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢æ‰€æœ‰å­—æ®µä¸­åŒ…å« &quot;å…¬å›­&quot;å’Œ &quot;åä¸º&quot; çš„æ–‡æ¡£</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;query_string&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;query&quot;:&quot;å…¬å›­ AND electronics&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæŸ¥è¯¢çš„å•ä¸ªå­—æ®µ</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;query_string&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;default_field&quot;:&quot;category&quot;,</span></span><br><span class="line"><span class="string">        &quot;query&quot;:&quot;ç™½äº‘å±± OR books&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæŸ¥è¯¢çš„å¤šä¸ªå­—æ®µ</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;query_string&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;fields&quot;:[&quot;category&quot;,&quot;address&quot;],</span></span><br><span class="line"><span class="string">        &quot;query&quot;:&quot;ç™½äº‘å±± OR (electronics AND shirt)&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="simple-query-string-ç±»ä¼¼-query-stringï¼Œä½†æ˜¯ä¼šå¿½ç•¥é”™è¯¯çš„è¯­æ³•ï¼ŒåŒæ—¶åªæ”¯æŒéƒ¨åˆ†æŸ¥è¯¢è¯­æ³•">simple_query_string: ç±»ä¼¼ <code>query_string</code>ï¼Œä½†æ˜¯ä¼šå¿½ç•¥é”™è¯¯çš„è¯­æ³•ï¼ŒåŒæ—¶åªæ”¯æŒéƒ¨åˆ†æŸ¥è¯¢è¯­æ³•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;simple_query_string&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;query&quot;:&quot;å¹¿å·å…¬å›­&quot;,</span></span><br><span class="line"><span class="string">        &quot;default_operator&quot;:&quot;AND&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"><span class="comment"># default_operator: é»˜è®¤ä¸º ORï¼Œè®¾ç½®ä¸º AND åˆ™å¿…é¡»åŒæ—¶åŒ¹é…</span></span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>ESæŸ¥è¯¢ç»“æœå±æ€§å«ä¹‰</strong></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span>:16,          <span class="comment"># è¡¨ç¤ºæŸ¥è¯¢ä»è¯·æ±‚åˆ°å®Œæˆè€—æ—¶ 16 æ¯«ç§’ã€‚</span></span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span>:<span class="literal">false</span>,  <span class="comment"># è¡¨ç¤ºæŸ¥è¯¢åœ¨è§„å®šçš„æ—¶é—´å†…å®Œæˆï¼Œæ²¡æœ‰å‘ç”Ÿè¶…æ—¶ã€‚å¦‚æœä¸º trueï¼Œåˆ™è¡¨ç¤ºæŸ¥è¯¢è¶…æ—¶ã€‚</span></span><br><span class="line">  <span class="string">&quot;_shards&quot;</span>:&#123;         <span class="comment"># æ¶‰åŠåˆ°æŸ¥è¯¢è¿‡ç¨‹ä¸­ä½¿ç”¨çš„åˆ†ç‰‡ä¿¡æ¯</span></span><br><span class="line">    <span class="string">&quot;total&quot;</span>:1,        <span class="comment"># è¡¨ç¤ºæŸ¥è¯¢æ¶‰åŠåˆ°çš„æ€»åˆ†ç‰‡æ•°ä¸º 1</span></span><br><span class="line">    <span class="string">&quot;successful&quot;</span>:1,   <span class="comment"># è¡¨ç¤ºæŸ¥è¯¢æˆåŠŸå®Œæˆçš„åˆ†ç‰‡æ•°ä¸º 1</span></span><br><span class="line">    <span class="string">&quot;skipped&quot;</span>:0,      <span class="comment"># è¡¨ç¤ºæŸ¥è¯¢è¿‡ç¨‹ä¸­è¢«è·³è¿‡çš„åˆ†ç‰‡æ•°ä¸º 0</span></span><br><span class="line">    <span class="string">&quot;failed&quot;</span>:0        <span class="comment"># è¡¨ç¤ºæŸ¥è¯¢è¿‡ç¨‹ä¸­å¤±è´¥çš„åˆ†ç‰‡æ•°ä¸º 0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span>:&#123;            <span class="comment"># åŒ…å«æŸ¥è¯¢ç»“æœçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">    <span class="string">&quot;total&quot;</span>:&#123;         <span class="comment"># åŒ…å«æŸ¥è¯¢ç»“æœçš„æ€»æ•°</span></span><br><span class="line">      <span class="string">&quot;value&quot;</span>:4,      <span class="comment"># è¡¨ç¤ºæŸ¥è¯¢ç»“æœçš„æ€»æ•°ä¸º 4</span></span><br><span class="line">      <span class="string">&quot;relation&quot;</span>:<span class="string">&quot;eq&quot;</span> <span class="comment"># è¡¨ç¤ºè¿”å›çš„æ€»æ•° value æ˜¯ç¡®åˆ‡çš„ï¼ˆequalï¼‰ã€‚å¦‚æœä¸º gteï¼Œåˆ™è¡¨ç¤ºè¿”å›çš„æ€»æ•°æ˜¯ä¸€ä¸ªä¸‹é™å€¼ã€‚</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span>:0.0,  <span class="comment"># è¡¨ç¤ºåŒ¹é…åˆ°çš„æ–‡æ¡£ä¸­æœ€é«˜çš„å¾—åˆ†ã€‚å¦‚æœæ˜¯æ’åºæŸ¥è¯¢ï¼Œè¿™ä¸ªå€¼ä¼šæœ‰æ„ä¹‰ã€‚å½“å‰ç»“æœå› ä¸º size: 0ï¼Œæ²¡æœ‰å®é™…è¿”å›æ–‡æ¡£ï¼Œæ‰€ä»¥å¾—åˆ†ä¸º 0.0</span></span><br><span class="line">    <span class="string">&quot;hits&quot;</span>:[ ]        <span class="comment"># åŒ…å«æŸ¥è¯¢ç»“æœçš„åˆ—è¡¨ï¼Œæ¯ä¸ªç»“æœéƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æ–‡æ¡£çš„å…ƒæ•°æ®ï¼Œå¦‚ idã€åˆ†æ•°ç­‰ã€‚</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="bool-æŸ¥è¯¢">bool æŸ¥è¯¢</h2><ul class="lvl-0"><li class="lvl-2"><p>å¸ƒå°”æŸ¥è¯¢å¯ä»¥æŒ‰ç…§å¸ƒå°”é€»è¾‘æ¡ä»¶ç»„ç»‡å¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œåªæœ‰ç¬¦åˆæ•´ä¸ªå¸ƒå°”æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šè¢«æœç´¢å‡ºæ¥ã€‚</p></li><li class="lvl-2"><p>åœ¨å¸ƒå°”æ¡ä»¶ä¸­ï¼Œå¯ä»¥åŒ…å«ä¸¤ç§ä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚</p><ul class="lvl-2"><li class="lvl-4">1.æœç´¢ä¸Šä¸‹æ–‡(query context)ï¼šä½¿ç”¨æœç´¢ä¸Šä¸‹æ–‡æ—¶ï¼ŒElasticsearchéœ€è¦è®¡ç®—æ¯ä¸ªæ–‡æ¡£ä¸æœç´¢æ¡ä»¶çš„ç›¸å…³åº¦å¾—åˆ†ï¼Œè¿™ä¸ªå¾—åˆ†çš„è®¡ç®—éœ€ä½¿ç”¨ä¸€å¥—å¤æ‚çš„è®¡ç®—å…¬å¼ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œå¸¦æ–‡æœ¬åˆ†æçš„å…¨æ–‡æ£€ç´¢çš„æŸ¥è¯¢è¯­å¥å¾ˆé€‚åˆæ”¾åœ¨æœç´¢ä¸Šä¸‹æ–‡ä¸­ã€‚</li><li class="lvl-4">2.è¿‡æ»¤ä¸Šä¸‹æ–‡(filter context)ï¼šä½¿ç”¨è¿‡æ»¤ä¸Šä¸‹æ–‡æ—¶ï¼ŒElasticsearchåªéœ€è¦åˆ¤æ–­æœç´¢æ¡ä»¶è·Ÿæ–‡æ¡£æ•°æ®æ˜¯å¦åŒ¹é…ï¼Œä¾‹å¦‚ä½¿ç”¨<code>Term query</code>åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦è·Ÿæœç´¢å†…å®¹ä¸€è‡´ï¼Œä½¿ç”¨<code>Range query</code>åˆ¤æ–­æŸæ•°æ®æ˜¯å¦ä½äºæŸä¸ªåŒºé—´ç­‰ã€‚è¿‡æ»¤ä¸Šä¸‹æ–‡çš„æŸ¥è¯¢ä¸éœ€è¦è¿›è¡Œç›¸å…³åº¦å¾—åˆ†è®¡ç®—ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¼“å­˜åŠ å¿«å“åº”é€Ÿåº¦ï¼Œå¾ˆå¤šæœ¯è¯­çº§æŸ¥è¯¢è¯­å¥éƒ½é€‚åˆæ”¾åœ¨è¿‡æ»¤ä¸Šä¸‹æ–‡ä¸­ã€‚</li></ul></li><li class="lvl-2"><p>bool æŸ¥è¯¢åŒ…å« mustã€must_notã€shouldã€filter å››ç§å­å¥ã€‚</p></li></ul><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>must</td><td>å¯åŒ…å«å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯æ¬¡æŸ¥è¯¢éœ€è¦è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œå±äºæœç´¢ä¸Šä¸‹æ–‡</td></tr><tr><td>should</td><td>å¯åŒ…å«å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œä¸å­˜åœ¨mustå’Œfiteræ¡ä»¶æ—¶ï¼Œè‡³å°‘è¦æ»¡è¶³å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ä¸­çš„ä¸€ä¸ªï¼Œæ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œå¦åˆ™éœ€æ»¡è¶³çš„æ¡ä»¶æ•°é‡ä¸å—é™åˆ¶,åŒ¹é…åˆ°çš„æŸ¥è¯¢è¶Šå¤šç›¸å…³åº¦è¶Šé«˜ï¼Œä¹Ÿå±äºæœç´¢ä¸Šä¸‹æ–‡</td></tr><tr><td>filter</td><td>å¯åŒ…å«å¤šä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯ä¸ªè¿‡æ»¤æ¡ä»¶ä¸è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œç»“æœåœ¨ä¸€å®šæ¡ä»¶ä¸‹ä¼šè¢«ç¼“å­˜ï¼Œ å±äºè¿‡æ»¤ä¸Šä¸‹æ–‡</td></tr><tr><td>must_not</td><td>å¯åŒ…å«å¤šä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œæ¯ä¸ªæ¡ä»¶å‡ä¸æ»¡è¶³çš„æ–‡æ¡£æ‰èƒ½è¢«æœç´¢åˆ°ï¼Œæ¯ä¸ªè¿‡æ»¤æ¡ä»¶ä¸è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œç»“æœåœ¨ä¸€å®šæ¡ä»¶ä¸‹ä¼šè¢«ç¼“å­˜ï¼Œ å±äºè¿‡æ»¤ä¸Šä¸‹æ–‡</td></tr></tbody></table><h3 id="must">must</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸¤ä¸ªæ¡ä»¶éƒ½éœ€è¦æ»¡è¶³</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;bool&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;must&quot;:[</span></span><br><span class="line"><span class="string">          &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class="line"><span class="string">          &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="must-not">must_not</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;bool&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;must_not&quot;:[</span></span><br><span class="line"><span class="string">          &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class="line"><span class="string">          &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="should">should</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸¤ä¸ªæ¡ä»¶æ»¡è¶³ä¸€ä¸ªå³å¯</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;bool&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;should&quot;:[</span></span><br><span class="line"><span class="string">          &#123;&quot;match&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class="line"><span class="string">          &#123;&quot;match&quot;:&#123;&quot;desc&quot;:&quot;å…¬å›­&quot;&#125;&#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="filter">filter</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># filterä¸­çš„æ¡ä»¶ä¸ºé matchï¼Œå³ä¸èƒ½æ˜¯å…¨æ–‡æ£€ç´¢</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">      &quot;bool&quot;:&#123;</span></span><br><span class="line"><span class="string">        &quot;filter&quot;:[</span></span><br><span class="line"><span class="string">          &#123;&quot;term&quot;:&#123;&quot;category&quot;:&quot;electronics&quot;&#125;&#125;,</span></span><br><span class="line"><span class="string">          &#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="åˆ†é¡µä¸æ’åº">åˆ†é¡µä¸æ’åº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from: ä»ç¬¬å‡ æ¡å¼€å§‹ï¼Œé»˜è®¤0</span></span><br><span class="line"><span class="comment"># size: å–å¤šå°‘æ¡</span></span><br><span class="line"><span class="comment"># sort: æ’åºï¼Œé»˜è®¤ä¸ºæŒ‰æ–‡æ¡£idå‡åº</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;,</span></span><br><span class="line"><span class="string">  &quot;sort&quot;:[&#123;&quot;price&quot;:&quot;address&quot;&#125;],</span></span><br><span class="line"><span class="string">  &quot;from&quot;:0,</span></span><br><span class="line"><span class="string">  &quot;size&quot;:5</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="åªè¿”å›éƒ¨åˆ†å­—æ®µ">åªè¿”å›éƒ¨åˆ†å­—æ®µ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _source: æŒ‡å®šè¦è¿”å›çš„å­—æ®µåˆ—è¡¨</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  &#123;&quot;query&quot;:&#123;&quot;range&quot;:&#123;&quot;price&quot;:&#123;&quot;gte&quot;:20,&quot;lte&quot;:30&#125;&#125;&#125;,</span></span><br><span class="line"><span class="string">  &quot;_source&quot;:[&quot;category&quot;,&quot;title&quot;,&quot;price&quot;]</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="é«˜äº®æ˜¾ç¤º">é«˜äº®æ˜¾ç¤º</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é«˜äº®æ˜¾ç¤ºä»…æ”¯æŒå…¨æ–‡æ£€ç´¢å­—æ®µ</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/shopping/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;query&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;multi_match&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;fields&quot;: [&quot;title&quot;,&quot;address&quot;],</span></span><br><span class="line"><span class="string">        &quot;query&quot;: &quot;å…¬å›­shirt&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;highlight&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;post_tags&quot;: [&quot;&lt;/span&gt;&quot;],</span></span><br><span class="line"><span class="string">      &quot;pre_tags&quot;: [&quot;&lt;span style=&#x27;</span>color:red<span class="string">&#x27;&gt;&quot;],</span></span><br><span class="line"><span class="string">      &quot;fields&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;*&quot;:&#123;&#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢">åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢æ˜¯æ•°æ®åº“å’Œæœç´¢ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨åœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰å’Œä½ç½®æœåŠ¡ä¸­ã€‚å®ƒå…è®¸ç”¨æˆ·åŸºäºåœ°ç†ä½ç½®ä¿¡æ¯æ¥æœç´¢å’Œè¿‡æ»¤æ•°æ®ã€‚åœ¨Elasticsearchè¿™æ ·çš„å…¨æ–‡æœç´¢å¼•æ“ä¸­ï¼Œåœ°ç†ç©ºé—´ä½ç½®æŸ¥è¯¢è¢«å¹¿æ³›åº”ç”¨ï¼Œä¾‹å¦‚åœ¨æ—…è¡Œã€æˆ¿åœ°äº§ã€ç‰©æµå’Œé›¶å”®ç­‰è¡Œä¸šï¼Œç”¨äºæä¾›åŸºäºä½ç½®çš„æœç´¢åŠŸèƒ½ã€‚</p></li><li class="lvl-2"><p>åœ¨Elasticsearchä¸­ï¼Œåœ°ç†ç©ºé—´æ•°æ®é€šå¸¸å­˜å‚¨åœ¨<code>geo_point</code>å­—æ®µç±»å‹ä¸­ã€‚è¿™ç§å­—æ®µç±»å‹å¯ä»¥å­˜å‚¨çº¬åº¦å’Œç»åº¦åæ ‡ï¼Œç”¨äºè¡¨ç¤ºåœ°çƒä¸Šçš„ä¸€ä¸ªç‚¹ã€‚</p></li></ul><h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå¹¶æ·»åŠ ä¸€ä¸ª<code>geo_point</code>å­—æ®µï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/tourist_spots&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;mappings&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;properties&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;name&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="string">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span></span><br><span class="line"><span class="string">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;location&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;geo_point&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ’å…¥æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/tourist_spots/_bulk&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;index&quot;:&#123;&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;:&quot;é›·å³°å¡”&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2615,&quot;lon&quot;:120.1480&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;index&quot;:&#123;&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;:&quot;è¥¿æ¹–&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2614,&quot;lon&quot;:120.1479&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;index&quot;:&#123;&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;:&quot;è‹å ¤æ˜¥æ™“&quot;,&quot;location&quot;:&#123;&quot;lat&quot;:30.2624,&quot;lon&quot;:120.1708&#125;&#125;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="comment"># lat: çº¬åº¦</span></span><br><span class="line"><span class="comment"># lon: ç»åº¦</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢æ­å·è¥¿æ¹–5kmé™„è¿‘çš„æ™¯ç‚¹</span></span><br><span class="line"><span class="comment"># é›·å³°å¡” - ä½äºè¥¿æ¹–é™„è¿‘ï¼Œè·ç¦»çº¦2.8å…¬é‡Œã€‚</span></span><br><span class="line"><span class="comment"># è‹å ¤æ˜¥æ™“ - ä½äºè¥¿æ¹–è¾¹ï¼Œè·ç¦»è¥¿æ¹–ä¸­å¿ƒçº¦1å…¬é‡Œã€‚</span></span><br><span class="line">curl -X GET -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/tourist_spots/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;query&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;bool&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;must&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;match_all&quot;: &#123;&#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;filter&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;geo_distance&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;distance&quot;: &quot;5km&quot;,</span></span><br><span class="line"><span class="string">            &quot;distance_type&quot;: &quot;arc&quot;,</span></span><br><span class="line"><span class="string">            &quot;location&quot;: &#123;</span></span><br><span class="line"><span class="string">              &quot;lat&quot;: 30.2614,</span></span><br><span class="line"><span class="string">              &quot;lon&quot;: 120.1479</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># distance: 5km è¡¨ç¤ºè·ç¦»ä¸º5å…¬é‡Œ</span></span><br><span class="line"><span class="comment"># distance_type: arc, plane, sloppy_arc,</span></span><br><span class="line">  <span class="comment"># arc: é»˜è®¤å€¼ï¼Œä½¿ç”¨haversineå…¬å¼è®¡ç®—è·ç¦»ï¼Œç»“æœæ˜¯ç²¾ç¡®çš„ï¼Œä½†è®¡ç®—é€Ÿåº¦è¾ƒæ…¢ã€‚</span></span><br><span class="line">  <span class="comment"># plane: ä½¿ç”¨å¹³é¢ç›´è§’åæ ‡ç³»è®¡ç®—è·ç¦»ï¼Œç»“æœæ˜¯ç²—ç•¥çš„ï¼Œä½†è®¡ç®—é€Ÿåº¦æ›´å¿«ã€‚</span></span><br><span class="line">  <span class="comment"># sloppy_arc: ä½¿ç”¨haversineå…¬å¼è®¡ç®—è·ç¦»ï¼Œä½†å…è®¸è¯¯å·®ã€‚</span></span><br><span class="line"><span class="comment"># location: æœç´¢æ¡ä»¶</span></span><br></pre></td></tr></table></figure><h2 id="å‘é‡æœç´¢">å‘é‡æœç´¢</h2><ul class="lvl-0"><li class="lvl-2"><p>Elasticsearch 8.x å¼•å…¥äº†ä¸€ä¸ªé‡è¦çš„æ–°ç‰¹æ€§ï¼šå‘é‡æ£€ç´¢ï¼ˆVector Searchï¼‰ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡KNNï¼ˆK-Nearest Neighborsï¼‰ç®—æ³•æ”¯æŒå‘é‡è¿‘é‚»æ£€ç´¢ã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾—Elasticsearchåœ¨æœºå™¨å­¦ä¹ ã€æ•°æ®åˆ†æå’Œæ¨èç³»ç»Ÿç­‰é¢†åŸŸçš„åº”ç”¨å˜å¾—æ›´åŠ å¹¿æ³›å’Œå¼ºå¤§ã€‚</p></li><li class="lvl-2"><p>å‘é‡æ£€ç´¢çš„åŸºæœ¬æ€è·¯æ˜¯ï¼Œå°†æ–‡æ¡£ï¼ˆæˆ–æ•°æ®é¡¹ï¼‰è¡¨ç¤ºä¸ºé«˜ç»´å‘é‡ï¼Œå¹¶ä½¿ç”¨è¿™äº›å‘é‡æ¥æ‰§è¡Œç›¸ä¼¼æ€§æœç´¢ã€‚åœ¨Elasticsearchä¸­ï¼Œè¿™äº›å‘é‡è¢«å­˜å‚¨åœ¨<code>dense_vector</code>ç±»å‹çš„å­—æ®µä¸­ï¼Œç„¶åä½¿ç”¨KNNç®—æ³•æ¥æ‰¾åˆ°ä¸ç»™å®šå‘é‡æœ€ç›¸ä¼¼çš„å…¶ä»–å‘é‡ã€‚</p></li></ul><h3 id="ç¤ºä¾‹-2">ç¤ºä¾‹</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºç´¢å¼•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/image-index&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;mappings&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;properties&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;image-vector&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;dense_vector&quot;,</span></span><br><span class="line"><span class="string">          &quot;dims&quot;: 3</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;title&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;text&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;file-type&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;keyword&quot;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;my_label&quot;: &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;text&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"><span class="comment"># dims: 3  è¡¨ç¤º3ç»´å‘é‡ï¼Œæœ€é«˜æ”¯æŒ2048</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/image-index/_bulk&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;image-vector&quot;: [-5, 9, -12], &quot;title&quot;: &quot;Image A&quot;, &quot;file-type&quot;: &quot;jpeg&quot;, &quot;my_label&quot;: &quot;red&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;image-vector&quot;: [10, -2, 3], &quot;title&quot;: &quot;Image B&quot;, &quot;file-type&quot;: &quot;png&quot;, &quot;my_label&quot;: &quot;blue&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;index&quot;: &#123;&#125; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;image-vector&quot;: [4, 0, -1], &quot;title&quot;: &quot;Image C&quot;, &quot;file-type&quot;: &quot;gif&quot;, &quot;my_label&quot;: &quot;red&quot; &#125;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘é‡æ£€ç´¢</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/image-index/_search?pretty&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;query&quot;:&#123; &quot;match_all&quot;: &#123;&#125; &#125;,</span></span><br><span class="line"><span class="string">    &quot;knn&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;field&quot;: &quot;image-vector&quot;,</span></span><br><span class="line"><span class="string">      &quot;query_vector&quot;: [-5, 10, -12],</span></span><br><span class="line"><span class="string">      &quot;k&quot;: 10,</span></span><br><span class="line"><span class="string">      &quot;num_candidates&quot;: 100</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;fields&quot;: [ &quot;title&quot;, &quot;file-type&quot; ]</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># query: æœç´¢æ¡ä»¶ï¼Œè¿™é‡Œå¯ä»¥ä¸åŠ è¿™ä¸ª</span></span><br><span class="line"><span class="comment"># knn: 8.8.1 ç‰ˆæœ¬å¼€å§‹é»˜è®¤æ”¯æŒ</span></span><br><span class="line"><span class="comment"># field: æœç´¢å‘é‡å­—æ®µ</span></span><br><span class="line"><span class="comment"># query_vector: æœç´¢å‘é‡</span></span><br><span class="line"><span class="comment"># k: æœç´¢ç»“æœæ•°é‡</span></span><br><span class="line"><span class="comment"># num_candidates: æœç´¢å€™é€‰æ•°é‡ï¼Œç”¨äºä¼˜åŒ–æ€§èƒ½</span></span><br><span class="line"><span class="comment"># fields: æœç´¢ç»“æœè¿”å›å­—æ®µ</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Elasticsearch çš„ REST APIs&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;Elasticsearchç‰ˆæœ¬8.17.3&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/8.17/rest-apis.html&quot;&gt;å®˜æ–¹æ–‡æ¡£:REST APIs&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;a href=&quot;/2025/04/22/elasticsearch-06-api-aggs/&quot; title=&quot;Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢&quot;&gt;Elasticsearch çš„ REST APIs:èšåˆæŸ¥è¯¢&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="elastic" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/"/>
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/elasticsearch/"/>
    
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearchçš„è¯ä¹¦è¿‡æœŸå¤„ç†æ–¹æ³•</title>
    <link href="https://blog.hanqunfeng.com/2025/04/16/elasticsearch-04-cert/"/>
    <id>https://blog.hanqunfeng.com/2025/04/16/elasticsearch-04-cert/</id>
    <published>2025-04-16T13:30:05.000Z</published>
    <updated>2025-04-16T09:41:30.609Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»Elasticsearchè¯ä¹¦è¿‡æœŸæ—¶çš„å¤„ç†æ–¹æ³•</p></li><li class="lvl-2"><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.17/index.html">Elasticsearch</a>ç‰ˆæœ¬8.17.3</p></li><li class="lvl-2"><p>æœ¬æ–‡åŸºäº <a href="/2025/03/20/elasticsearch-01-install/" title="linuxä¸‹å®‰è£…Elasticsearch">linuxä¸‹å®‰è£…Elasticsearch</a></p></li><li class="lvl-2"><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.17/update-node-certs.html">å®˜æ–¹æ–‡æ¡£:Updating node security certificates</a></p></li></ul><span id="more"></span><h2 id="ESè¯ä¹¦ç®€ä»‹">ESè¯ä¹¦ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Elasticsearch 8 é»˜è®¤æƒ…å†µä¸‹åˆ›å»ºçš„è¯ä¹¦åªæœ‰3å¹´æœ‰æ•ˆæœŸï¼Œè¿‡æœŸæ—¶éœ€è¦åˆ›å»ºæ–°çš„è¯ä¹¦ï¼Œä¸ºäº†ä¸å¿…è¦çš„éº»çƒ¦ï¼Œä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆæœŸæ¯”è¾ƒé•¿çš„è¯ä¹¦ã€‚</p></li><li class="lvl-2"><p>åœ¨ Elasticsearch 8 çš„é…ç½®ä¸‹ï¼Œ<code>config/certs</code> ç›®å½•é€šå¸¸å­˜æ”¾çš„æ˜¯ç”¨äºå®‰å…¨é€šä¿¡çš„è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ç¡®ä¿äº† Elasticsearch å®ä¾‹ä¹‹é—´çš„é€šè®¯ä»¥åŠä¸å¤–éƒ¨å®¢æˆ·ç«¯çš„é€šè®¯èƒ½å¤Ÿè¢«åŠ å¯†ä¸”ç»è¿‡è®¤è¯ã€‚</p></li><li class="lvl-2"><p><code>config/certs</code> ç›®å½•åŒ…å«ä¸‰ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯ï¼š</p><ul class="lvl-2"><li class="lvl-4"><code>http.p12</code>: è¿™æ˜¯ä¸€ä¸ª PKCS#12 æ ¼å¼çš„æ–‡ä»¶ï¼ˆé€šå¸¸å¸¦æœ‰.p12æˆ–.pfxæ‰©å±•åï¼‰ï¼ŒåŒ…å«äº† Elasticsearch HTTP å±‚ç”¨æ¥è¿›è¡Œ TLS/SSL é€šä¿¡æ‰€éœ€çš„ä¸€åˆ‡ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç§é’¥ã€ç›¸åº”çš„å…¬é’¥è¯ä¹¦ï¼ˆæœåŠ¡å™¨è¯ä¹¦ï¼‰åŠ CA è¯ä¹¦é“¾ã€‚å®¢æˆ·ç«¯ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¥éªŒè¯å®ƒä»¬æ­£åœ¨ä¸æ­£ç¡®çš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”æ­¤æœåŠ¡å™¨ä¹Ÿä¿¡ä»»è¯¥å®¢æˆ·ç«¯ã€‚</li><li class="lvl-4"><code>http_ca.crt</code>: CA (Certificate Authority) æ ¹è¯ä¹¦æˆ–ä¸­é—´è¯ä¹¦ï¼Œç”¨äºéªŒè¯é€šè¿‡ HTTP åè®®è¿æ¥è‡³ Elasticsearch æœåŠ¡ç«¯ç‚¹çš„èº«ä»½ã€‚å½“å®¢æˆ·ç«¯å°è¯•å»ºç«‹ HTTPS è¿æ¥æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥æ¥è‡ª Elasticsearch çš„è¯ä¹¦æ˜¯å¦ç”±è¿™ä¸ª CA ç­¾åï¼›è¿™æ˜¯ç¡®ä¿åŒæ–¹é€šä¿¡å®‰å…¨çš„é‡è¦æ­¥éª¤ä¹‹ä¸€ã€‚</li><li class="lvl-4"><code>transport.p12</code>: åŒæ ·ä¸º PKCS#12 æ ¼å¼ï¼Œä½†è¿™ä¸ªç‰¹å®šçš„æ–‡ä»¶æ˜¯ç»™ Elasticsearch èŠ‚ç‚¹ä¹‹é—´å†…éƒ¨ä¼ è¾“å±‚ä½¿ç”¨çš„ã€‚åœ¨é›†ç¾¤å†…ï¼ŒèŠ‚ç‚¹é—´éœ€<br>è¦ç›¸äº’è®¤è¯ï¼Œtransport.p12å°±åŒ…å«ç€è®©ä¸åŒ Elasticsearch å®ä¾‹èƒ½äº’ç›¸è¯†åˆ«æ‰€éœ€çš„ç§é’¥å’Œè¯ä¹¦ã€‚</li></ul></li><li class="lvl-2"><p>æ€»ä¹‹ï¼Œ<code>http.p12</code>æœåŠ¡äºé¢å‘ Web çš„æ¥å£ï¼Œè€Œ<code>transport.p12</code>åˆ™å¤„ç† Elasticsearch ç¾¤é›†å†…çš„äº¤äº’ï¼›ä¸¤è€…éƒ½ä¾èµ–äº<code>http_ca.crt</code>æ¥è¿›è¡Œèº«ä»½éªŒè¯è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</p></li></ul><h2 id="ESè¯ä¹¦è¿‡æœŸçš„å½±å“">ESè¯ä¹¦è¿‡æœŸçš„å½±å“</h2><ul class="lvl-0"><li class="lvl-2"><p>â€Œé›†ç¾¤æ— æ³•å¢åŠ æ–°èŠ‚ç‚¹â€Œï¼šç‰¹åˆ«æ˜¯åœ¨é‡å¯é›†ç¾¤æ—¶ï¼ŒèŠ‚ç‚¹æ— æ³•åŠ å…¥é›†ç¾¤ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸é‡å¯ã€‚â€Œ</p></li><li class="lvl-2"><p>â€Œè®¿é—®å¼‚å¸¸â€Œï¼šå¦‚æœä½¿ç”¨è¯ä¹¦è¿æ¥ESé›†ç¾¤ï¼Œä¼šå¯¼è‡´æ— æ³•æ­£å¸¸è®¿é—®é›†ç¾¤ã€‚</p></li><li class="lvl-2"><p>â€Œå®‰å…¨é£é™©â€Œï¼šè¯ä¹¦è¿‡æœŸä¼šç ´åè¯ä¹¦é“¾çš„ä¿¡ä»»ï¼Œå¯èƒ½å¼•å‘å®‰å…¨æ¼æ´ã€‚</p></li><li class="lvl-2"><p>â€Œæ—¥å¿—å¹²æ‰°â€Œï¼šä¼šæŒç»­å‡ºç°è¯ä¹¦è¿‡æœŸçš„é”™è¯¯æ—¥å¿—ï¼Œå¹²æ‰°é—®é¢˜æ’æŸ¥å’Œè¯Šæ–­ã€‚</p></li></ul><h2 id="æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´">æŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´</h2><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡opensslæŸ¥çœ‹è¯ä¹¦çš„è¿‡æœŸæ—¶é—´</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹crtè¯ä¹¦åˆ°æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment"># -dates: æ˜¾ç¤ºè¯ä¹¦çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´</span></span><br><span class="line"><span class="comment"># -noout: ä¸è¾“å‡ºè¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> config/certs/http_ca.crt -dates -noout</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹p12è¯ä¹¦åˆ°æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment"># -clcerts: åªæ˜¾ç¤ºè¯ä¹¦ï¼Œä¸æ˜¾ç¤ºç§é’¥</span></span><br><span class="line"><span class="comment"># -nokeys: ä¸è¾“å‡ºç§é’¥</span></span><br><span class="line"><span class="comment"># -password pass: æŒ‡å®šç§é’¥çš„å¯†ç ï¼Œè¿™é‡Œä¸ºç©º(å› ä¸ºåœ¨åˆ›å»ºè¯ä¹¦æ—¶æ²¡æœ‰è®¾ç½®å¯†ç )ï¼Œæ³¨æ„å¯†ç å¿…é¡»å†™åœ¨pass:çš„åé¢ï¼Œä¸åŠ è¿™ä¸ªå‚æ•°ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œç›´æ¥å›è½¦å³å¯</span></span><br><span class="line">openssl pkcs12 -<span class="keyword">in</span> ca.p12 -password pass: -clcerts -nokeys | openssl x509 -dates -noout</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡ESçš„APIæŸ¥çœ‹è¯ä¹¦è¿‡æœŸæ—¶é—´</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET -k -u <span class="string">&#x27;elastic:123456&#x27;</span> <span class="string">&#x27;https://127.0.0.1:9200/_ssl/certificates?pretty&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="è¯ä¹¦è¿‡æœŸå¤„ç†">è¯ä¹¦è¿‡æœŸå¤„ç†</h2><ul class="lvl-0"><li class="lvl-2"><p>Elasticsearch 8 çš„è¯ä¹¦åˆ›å»ºéœ€è¦ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· <code>elasticsearch-certutil</code>ï¼Œè¿™éƒ¨åˆ†çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.17/certutil.html">å®˜æ–¹æ–‡æ¡£:elasticsearch-certutil</a></p></li><li class="lvl-2"><p>å½“è¯ä¹¦è¿‡æœŸæ—¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶æ›´æ–°<code>config/certs</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ›´æ–°å‰è¦å¤‡ä»½åŸè¯ä¹¦ã€‚</p></li></ul><h3 id="å¤‡ä»½åŸè¯ä¹¦">å¤‡ä»½åŸè¯ä¹¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cp</span> -r config/certs config/certs.bak</span><br><span class="line">$ <span class="built_in">rm</span> -rf config/certs/*</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆæ–°è¯ä¹¦">ç”Ÿæˆæ–°è¯ä¹¦</h3><h4 id="ç”ŸæˆCAè¯ä¹¦">ç”ŸæˆCAè¯ä¹¦</h4><ul class="lvl-0"><li class="lvl-2"><p>ç”Ÿæˆcrtè¯ä¹¦</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --days 36500: æŒ‡å®šè¯ä¹¦çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºå¤©ï¼Œè¿™é‡Œè®¾ç½®ä¸º 36500 å¤©ï¼Œå¤§çº¦ 10 å¹´</span></span><br><span class="line">$ bin/elasticsearch-certutil ca --pem --out new-ca.zip --days 36500</span><br><span class="line"><span class="comment"># è§£å‹</span></span><br><span class="line">$ unzip new-ca.zip</span><br><span class="line"><span class="comment"># å°†åˆ›å»ºçš„è¯ä¹¦ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">$ <span class="built_in">mv</span> ca/ca.crt config/certs/http_ca.crt</span><br><span class="line">$ <span class="built_in">mv</span> ca/ca.key config/certs/http_ca.key</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¹Ÿå¯ä»¥ç”ŸæˆPKCS#12æ ¼å¼çš„è¯ä¹¦</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bin/elasticsearch-certutil ca --out config/certs/ca.p12 --days 36500</span><br></pre></td></tr></table></figure><h4 id="ç”Ÿæˆtransportè¯ä¹¦">ç”Ÿæˆtransportè¯ä¹¦</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºäºcrtè¯ä¹¦</span></span><br><span class="line">$ bin/elasticsearch-certutil cert --ca-cert config/certs/http_ca.crt --ca-key config/certs/http_ca.key --out config/certs/transport.p12 --days 36500</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºäºPKCS#12æ ¼å¼çš„è¯ä¹¦</span></span><br><span class="line">$ bin/elasticsearch-certutil cert --ca config/certs/ca.p12 --out config/certs/transport.p12 --days 36500</span><br></pre></td></tr></table></figure><h4 id="ç”Ÿæˆhttpè¯ä¹¦">ç”Ÿæˆhttpè¯ä¹¦</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œæ˜¯äº¤äº’å¼å‘½ä»¤è¡Œ</span></span><br><span class="line">$ bin/elasticsearch-certutil http</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¾“å‡ºè¯´æ˜</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">Generate a CSR? [y/N]n # ä¸ç”ŸæˆCSR</span><br><span class="line">Use an existing CA? [y/N]y # ä½¿ç”¨å·²æœ‰çš„CA</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»¥ä¸‹åŒºåˆ†crtè¯ä¹¦å’ŒPKCS#12æ ¼å¼çš„è¯ä¹¦</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">crt è¯ä¹¦</span></span><br><span class="line">CA Path: certs/http_ca.crt # CAè¯ä¹¦ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„</span><br><span class="line">CA Key: certs/http_ca.key # CAå¯†é’¥ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">PKCS#12æ ¼å¼çš„è¯ä¹¦</span></span><br><span class="line">CA Path: certs/ca.p12 # CAè¯ä¹¦ï¼Œè¿™é‡Œç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹åº” config ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„</span><br><span class="line">Password for ca.p12: # CAå¯†ç ï¼Œå› ä¸ºæ²¡æœ‰è®¾ç½®å¯†ç ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å›è½¦</span><br><span class="line"></span><br><span class="line">For how long should your certificate be valid? [5y] 100y # è¯ä¹¦æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºå¹´ï¼Œé»˜è®¤æ˜¯ 5 å¹´ï¼Œè¿™é‡Œè®¾ç½®ä¸º 100 å¹´</span><br><span class="line">Generate a certificate per node? [y/N]n # ä¸ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºç‹¬ç«‹çš„è¯ä¹¦ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹éƒ½ä½¿ç”¨åŒä¸€ä¸ªè¯ä¹¦</span><br><span class="line">Enter all the hostnames that you need, one per line.</span><br><span class="line">When you are done, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class="line"></span><br><span class="line">localhost # ä¸»æœºåï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œå›è½¦ä¸€è¡Œä¸€ä¸ªï¼Œè¿™é‡Œåº”è¯¥å¡«å†™é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„hostnameï¼Œå¯ä»¥é€šè¿‡ hostname å‘½ä»¤æŸ¥çœ‹</span><br><span class="line">ip-10-250-0-17.cn-northwest-1.compute.internal</span><br><span class="line">ip-10-250-0-173.cn-northwest-1.compute.internal</span><br><span class="line">ip-10-250-0-239.cn-northwest-1.compute.internal</span><br><span class="line"></span><br><span class="line">You entered the following hostnames.</span><br><span class="line"></span><br><span class="line"> - localhost</span><br><span class="line"> - ip-10-250-0-17.cn-northwest-1.compute.internal</span><br><span class="line"> - ip-10-250-0-173.cn-northwest-1.compute.internal</span><br><span class="line"> - ip-10-250-0-239.cn-northwest-1.compute.internal</span><br><span class="line"></span><br><span class="line">Is this correct [Y/n]y # ç¡®è®¤ä¸»æœºåæ˜¯å¦æ­£ç¡®</span><br><span class="line"></span><br><span class="line">Enter all the IP addresses that you need, one per line.</span><br><span class="line">When you are done, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class="line"></span><br><span class="line">127.0.0.1 # ä¸»æœºIPï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œå›è½¦ä¸€è¡Œä¸€ä¸ªï¼Œè¿™é‡Œåº”è¯¥å¡«å†™é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„IPåœ°å€</span><br><span class="line">10.250.0.17</span><br><span class="line">10.250.0.173</span><br><span class="line">10.250.0.239</span><br><span class="line"></span><br><span class="line">You entered the following IP addresses.</span><br><span class="line"></span><br><span class="line"> - 127.0.0.1</span><br><span class="line"> - 10.250.0.17</span><br><span class="line"> - 10.250.0.173</span><br><span class="line"> - 10.250.0.239</span><br><span class="line"></span><br><span class="line">Is this correct [Y/n]y # ç¡®è®¤IPæ˜¯å¦æ­£ç¡®</span><br><span class="line"></span><br><span class="line">Do you wish to change any of these options? [y/N]n # ä¸ä¿®æ”¹ä»»ä½•é€‰é¡¹</span><br><span class="line"></span><br><span class="line">If you wish to use a blank password, simply press &lt;enter&gt; at the prompt below.</span><br><span class="line">Provide a password for the &quot;http.p12&quot; file:  [&lt;ENTER&gt; for none] # ç›´æ¥å›è½¦ä¸è®¾ç½®å¯†ç </span><br><span class="line"></span><br><span class="line">What filename should be used for the output zip file? [/usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip] # è¾“å‡ºæ–‡ä»¶åï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯ elasticsearch-ssl-http.zip</span><br><span class="line"></span><br><span class="line">Zip file written to /usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è§£å‹å¹¶å°†httpè¯ä¹¦æ‹·è´åˆ°config/certsç›®å½•ä¸‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ unzip elasticsearch-ssl-http.zip</span><br><span class="line">Archive:  elasticsearch-ssl-http.zip</span><br><span class="line">   creating: elasticsearch/</span><br><span class="line">  inflating: elasticsearch/README.txt <span class="comment"># è¯´æ˜æ–‡ä»¶</span></span><br><span class="line">  inflating: elasticsearch/http.p12  <span class="comment"># httpè¯ä¹¦</span></span><br><span class="line">  inflating: elasticsearch/sample-elasticsearch.yml <span class="comment"># ç¤ºä¾‹elasticsearché…ç½®æ–‡ä»¶</span></span><br><span class="line">   creating: kibana/</span><br><span class="line">  inflating: kibana/README.txt <span class="comment"># è¯´æ˜æ–‡ä»¶</span></span><br><span class="line">  inflating: kibana/elasticsearch-ca.pem  <span class="comment"># kibanaç”¨äºéªŒè¯ESçš„è¯ä¹¦ï¼Œå³ elasticsearch.ssl.certificateAuthorities ä¸­çš„é…ç½®</span></span><br><span class="line">  inflating: kibana/sample-kibana.yml <span class="comment"># ç¤ºä¾‹kibanaé…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†httpè¯ä¹¦æ‹·è´åˆ°config/certsç›®å½•ä¸‹</span></span><br><span class="line">$ <span class="built_in">cp</span> elasticsearch/http.p12 config/certs/http.p12</span><br></pre></td></tr></table></figure><h3 id="åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹">åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢åˆ›å»ºæ–°çš„è¯ä¹¦æ—¶æˆ‘ä»¬åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œå³å¯ï¼Œä¹‹åå°†ç”Ÿæˆå¥½çš„è¯ä¹¦åˆ†å‘åˆ°ESé›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹ï¼Œè¿™é‡Œå°±æ˜¯ <code>http.p12</code> å’Œ <code>transport.p12</code>ï¼Œå°†å…¶æ‹·è´åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ <code>config/certs</code> ç›®å½•ä¸‹ï¼Œæ‹·è´å‰åšå¥½åŸè¯ä¹¦çš„å¤‡ä»½ã€‚</p></li><li class="lvl-2"><p>å¦‚æœ‰å¿…è¦ä¹Ÿå¯ä»¥æ‹·è´ <code>ca.p12</code> æˆ–è€… <code>http_ca.crt</code> å’Œ <code>http_ca.key</code> åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ <code>config/certs</code> ç›®å½•ä¸‹</p></li></ul><h3 id="é‡å¯ESæœåŠ¡">é‡å¯ESæœåŠ¡</h3><ul class="lvl-0"><li class="lvl-2"><p>é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¾æ¬¡é‡å¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bin/elasticsearch -d</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡å¯æ—¶å¯èƒ½ä¼šæŠ¥é”™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.elasticsearch.ElasticsearchSecurityException: failed to load SSL configuration [xpack.security.transport.ssl] - cannot <span class="built_in">read</span> configured [PKCS12] keystore (as a truststore) [/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/transport.p12] - this is usually caused by an incorrect password; (a keystore password was provided)</span><br><span class="line"><span class="comment"># è™½ç„¶æˆ‘ä»¬æ²¡æœ‰ç»™transport.p12è®¾ç½®å¯†ç ï¼Œä½†è¿™é‡Œä¾æ—§æç¤ºæä¾›çš„å¯†ç ä¸æ­£ç¡®ï¼Œå®é™…ä¸Šè¿™é‡Œä½¿ç”¨çš„æ˜¯ secure_password</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è§£å†³æ–¹æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨bin/elasticsearch-keystore listæŸ¥çœ‹ç°æœ‰çš„å¯†é’¥åˆ—è¡¨</span></span><br><span class="line">$ bin/elasticsearch-keystore list</span><br><span class="line">keystore.seed</span><br><span class="line">xpack.security.http.ssl.keystore.secure_password</span><br><span class="line">xpack.security.transport.ssl.keystore.secure_password</span><br><span class="line">xpack.security.transport.ssl.truststore.secure_password</span><br><span class="line"><span class="comment"># åˆ é™¤secure_passwordåå†æ¬¡é‡å¯ESæœåŠ¡å°±ä¼šæ­£å¸¸äº†</span></span><br><span class="line">$ bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password</span><br><span class="line">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password</span><br><span class="line">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password</span><br></pre></td></tr></table></figure><h3 id="æ›¿æ¢Kibanaçš„è¯ä¹¦">æ›¿æ¢Kibanaçš„è¯ä¹¦</h3><ul class="lvl-0"><li class="lvl-2"><p>å°†ä¸Šé¢åˆ›å»ºå¥½çš„ <code>kibana/elasticsearch-ca.pem</code> æ‹·è´åˆ°KibanaæœåŠ¡å™¨ï¼Œæ¯”å¦‚ <code>/usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem</code></p></li><li class="lvl-2"><p>ä¿®æ”¹Kibanaé…ç½®æ–‡ä»¶ <code>config/kibana.yml</code> ä¸­çš„ <code>elasticsearch.ssl.certificateAuthorities</code> é…ç½®ï¼Œä½¿å…¶æŒ‡å‘ <code>/usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem</code></p></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">elasticsearch.ssl.certificateAuthorities:</span> [<span class="string">&quot;/usr/local/kibana/kibana-8.17.3/config/certs/elasticsearch-ca.pem&quot;</span>]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡å¯KibanaæœåŠ¡</p></li></ul><h2 id="è¯ä¹¦æ ¼å¼è½¬æ¢">è¯ä¹¦æ ¼å¼è½¬æ¢</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># p12è½¬æ¢ä¸ºcrtæ ¼å¼</span></span><br><span class="line">$ openssl pkcs12 -<span class="keyword">in</span> config/certs/ca.p12 -out config/certs/http_ca.crt -nokeys</span><br><span class="line"><span class="comment"># p12è½¬æ¢ä¸ºkeyæ ¼å¼</span></span><br><span class="line">$ openssl pkcs12 -<span class="keyword">in</span> config/certs/ca.p12 -out config/certs/http_ca.key -nocerts -nodes</span><br><span class="line"><span class="comment"># p12è½¬æ¢ä¸ºpemæ ¼å¼</span></span><br><span class="line">$ openssl pkcs12 -<span class="keyword">in</span> config/certs/ca.p12 -out config/certs/http_ca.pem -nodes</span><br><span class="line"><span class="comment"># crtè½¬æ¢å›PKCS12æ ¼å¼</span></span><br><span class="line">$ openssl pkcs12 -<span class="built_in">export</span> -out config/certs/http_ca.p12 -inkey config/certs/http_ca.key -<span class="keyword">in</span> config/certs/http_ca.crt -name <span class="string">&quot;My CA&quot;</span></span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>ç”Ÿæˆhttpè¯ä¹¦æ—¶ä¸ºæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬é…ç½®è¯ä¹¦</strong></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Generate a certificate per node? [y/N]y <span class="comment"># æ˜¯å¦ä¸ºæ¯ä¸ªèŠ‚ç‚¹å•ç‹¬é…ç½®è¯ä¹¦ï¼Œè¿™é‡Œé€‰æ‹©æ˜¯</span></span><br><span class="line">node <span class="comment">#1 name: node-1 # èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ESé…ç½®æ–‡ä»¶ä¸­çš„node.nameä¸€è‡´</span></span><br><span class="line"></span><br><span class="line">Enter all the hostnames that you need, one per line. <span class="comment"># è¾“å…¥ node-1 èŠ‚ç‚¹çš„hostname</span></span><br><span class="line">When you are <span class="keyword">done</span>, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class="line"></span><br><span class="line">localhost                                         <span class="comment"># ä¹ æƒ¯åŠ ä¸Š localhost</span></span><br><span class="line">ip-10-250-0-239.cn-northwest-1.compute.internal   <span class="comment"># node-1 çš„ hostname</span></span><br><span class="line"></span><br><span class="line">You entered the following hostnames.</span><br><span class="line"></span><br><span class="line"> - localhost</span><br><span class="line"> - ip-10-250-0-239.cn-northwest-1.compute.internal</span><br><span class="line"></span><br><span class="line">Is this correct [Y/n]y <span class="comment"># ç¡®è®¤æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"></span><br><span class="line">Enter all the IP addresses that you need, one per line. <span class="comment"># è¾“å…¥ node-1 èŠ‚ç‚¹çš„IPåœ°å€</span></span><br><span class="line">When you are <span class="keyword">done</span>, press &lt;ENTER&gt; once more to move on to the next step.</span><br><span class="line"></span><br><span class="line">127.0.0.1                                         <span class="comment"># ä¹ æƒ¯åŠ ä¸Š 127.0.0.1</span></span><br><span class="line">10.250.0.239                                      <span class="comment"># node-1 çš„ IP</span></span><br><span class="line"></span><br><span class="line">You entered the following IP addresses.</span><br><span class="line"></span><br><span class="line"> - 127.0.0.1</span><br><span class="line"> - 10.250.0.239</span><br><span class="line"></span><br><span class="line">Is this correct [Y/n]y <span class="comment"># ç¡®è®¤æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"></span><br><span class="line">Do you wish to change any of these options? [y/N]n <span class="comment"># ä¸ä¿®æ”¹ä»»ä½•é€‰é¡¹</span></span><br><span class="line">Generate additional certificates? [Y/n]y  <span class="comment"># æ˜¯å¦ç”Ÿæˆå…¶ä»–è¯ä¹¦ï¼Œè¿™é‡Œé€‰æ‹©æ˜¯ï¼Œæ¥ç€ä¸ºå…¶å®ƒèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦</span></span><br><span class="line">node <span class="comment">#2 name: node-2 # èŠ‚ç‚¹åç§°ï¼Œå¿…é¡»ä¸ESé…ç½®æ–‡ä»¶ä¸­çš„node.nameä¸€è‡´</span></span><br><span class="line"><span class="comment"># ä¾æ¬¡ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦</span></span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line"></span><br><span class="line">Generate additional certificates? [Y/n]n <span class="comment"># åˆ›å»ºå¥½æ‰€æœ‰èŠ‚ç‚¹çš„è¯ä¹¦åï¼Œé€‰æ‹©nï¼Œä¸å†åˆ›å»ºæ–°çš„è¯ä¹¦</span></span><br><span class="line"></span><br><span class="line">If you wish to use a blank password, simply press &lt;enter&gt; at the prompt below.</span><br><span class="line">Provide a password <span class="keyword">for</span> the <span class="string">&quot;http.p12&quot;</span> file:  [&lt;ENTER&gt; <span class="keyword">for</span> none] <span class="comment"># ç›´æ¥å›è½¦ä¸è®¾ç½®å¯†ç </span></span><br><span class="line"></span><br><span class="line">What filename should be used <span class="keyword">for</span> the output zip file? [/usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip] <span class="comment"># è¾“å‡ºæ–‡ä»¶åï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰ï¼Œé»˜è®¤æ˜¯ elasticsearch-ssl-http.zip</span></span><br><span class="line"></span><br><span class="line">Zip file written to /usr/local/elasticsearch/elasticsearch-8.17.3/elasticsearch-ssl-http.zip</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">æ­¤æ—¶è§£å‹æŸ¥çœ‹æ–‡ä»¶ç»“æ„</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">unzip elasticsearch-ssl-http.zip</span><br><span class="line">Archive:  elasticsearch-ssl-http.zip</span><br><span class="line">   creating: elasticsearch/</span><br><span class="line">   creating: elasticsearch/node-1/</span><br><span class="line">  inflating: elasticsearch/node-1/README.txt</span><br><span class="line">  inflating: elasticsearch/node-1/http.p12  <span class="comment"># node-1 çš„è¯ä¹¦</span></span><br><span class="line">  inflating: elasticsearch/node-1/sample-elasticsearch.yml</span><br><span class="line">   creating: elasticsearch/node-2/</span><br><span class="line">  inflating: elasticsearch/node-2/README.txt</span><br><span class="line">  inflating: elasticsearch/node-2/http.p12 <span class="comment"># node-2 çš„è¯ä¹¦</span></span><br><span class="line">  inflating: elasticsearch/node-2/sample-elasticsearch.yml</span><br><span class="line">  creating: elasticsearch/node-3/</span><br><span class="line">  inflating: elasticsearch/node-3/README.txt</span><br><span class="line">  inflating: elasticsearch/node-3/http.p12 <span class="comment"># node-3 çš„è¯ä¹¦</span></span><br><span class="line">  inflating: elasticsearch/node-3/sample-elasticsearch.yml</span><br><span class="line">   creating: kibana/</span><br><span class="line">  inflating: kibana/README.txt</span><br><span class="line">  inflating: kibana/elasticsearch-ca.pem <span class="comment"># kibana çš„è¯ä¹¦</span></span><br><span class="line">  inflating: kibana/sample-kibana.yml</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2"><p>å°†å¯¹åº”çš„è¯ä¹¦æ‹·è´åˆ°å¯¹åº”èŠ‚ç‚¹çš„ <code>config/certs</code> ç›®å½•ä¸‹</p></li></ul></div>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»Elasticsearchè¯ä¹¦è¿‡æœŸæ—¶çš„å¤„ç†æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/8.17/index.html&quot;&gt;Elasticsearch&lt;/a&gt;ç‰ˆæœ¬8.17.3&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åŸºäº &lt;a href=&quot;/2025/03/20/elasticsearch-01-install/&quot; title=&quot;linuxä¸‹å®‰è£…Elasticsearch&quot;&gt;linuxä¸‹å®‰è£…Elasticsearch&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/8.17/update-node-certs.html&quot;&gt;å®˜æ–¹æ–‡æ¡£:Updating node security certificates&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="elastic" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/"/>
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/elasticsearch/"/>
    
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Springbootæ•´åˆLogstashå®ç°æ—¥å¿—é‡‡é›†</title>
    <link href="https://blog.hanqunfeng.com/2025/04/07/elk-02-springboot/"/>
    <id>https://blog.hanqunfeng.com/2025/04/07/elk-02-springboot/</id>
    <published>2025-04-07T13:30:05.000Z</published>
    <updated>2025-04-08T08:26:08.292Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Springbooté¡¹ç›®ä¸­æ•´åˆLogStashå®ç°æ—¥å¿—é‡‡é›†</p></li><li class="lvl-2"><p>æœ¬æ–‡åŸºäºSpringboot2.7.xç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼ŒLogstashç‰ˆæœ¬ä¸º8.17.3</p></li></ul><span id="more"></span><h2 id="ä½¿ç”¨logstashæ—¥å¿—æ’ä»¶">ä½¿ç”¨logstashæ—¥å¿—æ’ä»¶</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/logfellow/logstash-logback-encoder">SpringBootçš„Logstashæ—¥å¿—æ’ä»¶</a>ï¼Œæœ¬æ–‡åªè¿›è¡Œç®€å•ä»‹ç»ï¼Œæ›´å¤šè¯¦ç»†é…ç½®å¯ä»¥å‚è€ƒ<a href="https://github.com/logfellow/logstash-logback-encoder">å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p>å¼•å…¥ä¾èµ–ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„8.xä»¥ä¸Šçš„ç‰ˆæœ¬éœ€è¦jdk11ï¼Œå¦‚æœæ˜¯jdk8çš„è¯å¯ä»¥ä½¿ç”¨6.xæˆ–7.xç‰ˆæœ¬</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.logstash.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logstash-logback-encoder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- ç‰ˆæœ¬å·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<br>springboot2.7.xä»¥ä¸‹ç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨logstash-logback-encoderçš„7.3ä»¥ä¸‹ç‰ˆæœ¬ã€‚<br>springboot3.x.xä»¥ä¸Šç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨logstash-logback-encoderçš„7.4åŠä»¥ä¸Šç‰ˆæœ¬ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p><code>logback-spring.xml</code>ä¸­æ·»åŠ logstashé…ç½®</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦ %logger&#123;50&#125;ï¼šç±»è·¯å¾„ï¼Œæœ€å¤§æ˜¾ç¤º50ä¸ªå­—ç¬¦ %Mï¼šæ–¹æ³•åç§° %Lï¼šè¡Œå· %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>[%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;] [%thread] %-5level [%X&#123;userName&#125;][%X&#123;userLocale&#125;] %logger&#123;50&#125; - %M - %L - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- logstashè¾“å‡º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;LOGSTASH&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">destination</span>&gt;</span>161.189.78.202:4560<span class="tag">&lt;/<span class="name">destination</span>&gt;</span> <span class="comment">&lt;!-- logstashåœ°å€å’Œç«¯å£ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;net.logstash.logback.encoder.LogstashEncoder&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timestampPattern</span>&gt;</span>yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS<span class="tag">&lt;/<span class="name">timestampPattern</span>&gt;</span> <span class="comment">&lt;!-- æ—¶é—´æ ¼å¼ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includeMdc</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeMdc</span>&gt;</span>   <span class="comment">&lt;!-- é»˜è®¤true, trueè¡¨ç¤ºè¾“å‡ºMDCä¿¡æ¯ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includeCallerData</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeCallerData</span>&gt;</span> <span class="comment">&lt;!-- é»˜è®¤false, trueè¡¨ç¤ºè¾“å‡ºæ‰“å°æ—¥å¿—çš„ç±»åã€æ–¹æ³•åã€è¡Œå·ç­‰ä¿¡æ¯ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">customFields</span>&gt;</span>&#123;&quot;appname&quot;: &quot;springboot-logstash-demo&quot;&#125;<span class="tag">&lt;/<span class="name">customFields</span>&gt;</span> <span class="comment">&lt;!-- è‡ªå®šä¹‰å­—æ®µ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;LOGSTASH&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ <code>config/springboot-demo.conf</code>é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    host =&gt; <span class="string">&quot;0.0.0.0&quot;</span> <span class="comment"># ç›‘å¬ä»»æ„åœ°å€</span></span><br><span class="line">    port =&gt; <span class="string">&quot;4560&quot;</span> <span class="comment"># ç›‘å¬ç«¯å£</span></span><br><span class="line">    mode =&gt; <span class="string">&quot;server&quot;</span> <span class="comment"># serveræ¨¡å¼</span></span><br><span class="line">    codec =&gt; json_lines <span class="comment"># ä½¿ç”¨json_linesæ ¼å¼</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123;</span><br><span class="line">    codec =&gt; rubydebug</span><br><span class="line">  &#125;</span><br><span class="line">  elasticsearch &#123; <span class="comment"># è¾“å‡ºåˆ°ES</span></span><br><span class="line">        index =&gt; <span class="string">&quot;%&#123;[appname]&#125;-%&#123;+YYYY-MM-DD&#125;&quot;</span> <span class="comment"># ç´¢å¼•å,æŒ‰å¤©åˆ†éš”ï¼Œè¿™é‡Œä½¿ç”¨å˜é‡appnameä½œä¸ºç´¢å¼•å</span></span><br><span class="line">        hosts =&gt; [<span class="string">&quot;https://10.250.0.239:9200&quot;</span>] <span class="comment"># ESåœ°å€</span></span><br><span class="line">        user =&gt; <span class="string">&quot;elastic&quot;</span>                   <span class="comment"># ESç”¨æˆ·å</span></span><br><span class="line">        password =&gt; <span class="string">&quot;123456&quot;</span>                <span class="comment"># ESå¯†ç </span></span><br><span class="line">        ssl =&gt; <span class="literal">true</span>                         <span class="comment"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class="line">        ssl_certificate_verification =&gt; <span class="literal">false</span> <span class="comment"># ç¦ç”¨è¯ä¹¦éªŒè¯</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨logstash</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/logstash -f config/springboot-demo.conf --config.reload.automatic</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>logstashå¯åŠ¨æˆåŠŸåï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">            <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;Tomcat started on port(s): 8088 (http) with context path &#x27;/springboot-logstash&#x27;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;level_value&quot;</span> =&gt; 20000,</span><br><span class="line">            <span class="string">&quot;appname&quot;</span> =&gt; <span class="string">&quot;springboot-logstash-demo&quot;</span>,</span><br><span class="line">              <span class="string">&quot;level&quot;</span> =&gt; <span class="string">&quot;INFO&quot;</span>,</span><br><span class="line">        <span class="string">&quot;logger_name&quot;</span> =&gt; <span class="string">&quot;org.springframework.boot.web.embedded.tomcat.TomcatWebServer&quot;</span>,</span><br><span class="line">         <span class="string">&quot;@timestamp&quot;</span> =&gt; 2025-04-07T09:39:43.569Z,</span><br><span class="line">           <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;thread_name&quot;</span> =&gt; <span class="string">&quot;restartedMain&quot;</span>,</span><br><span class="line">        <span class="string">&quot;caller_class_name&quot;</span> =&gt; <span class="string">&quot;org.springframework.boot.web.embedded.tomcat.TomcatWebServer&quot;</span>,</span><br><span class="line">        <span class="string">&quot;caller_file_name&quot;</span> =&gt; <span class="string">&quot;TomcatWebServer.java&quot;</span>,</span><br><span class="line">        <span class="string">&quot;caller_method_name&quot;</span> =&gt; <span class="string">&quot;start&quot;</span>,</span><br><span class="line">        <span class="string">&quot;caller_line_number&quot;</span> =&gt; 220,</span><br><span class="line">        <span class="string">&quot;userName&quot;</span> =&gt; <span class="string">&quot;admin&quot;</span>, <span class="comment"># MDCä¿¡æ¯é»˜è®¤ä¼šæ‰“å°</span></span><br><span class="line">        <span class="string">&quot;userLocale&quot;</span> =&gt; <span class="string">&quot;zh_CN&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥è®¿é—®ESæˆ–è€…KibanaæŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Springbooté¡¹ç›®ä¸­æ•´åˆLogStashå®ç°æ—¥å¿—é‡‡é›†&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åŸºäºSpringboot2.7.xç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼ŒLogstashç‰ˆæœ¬ä¸º8.17.3&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/"/>
    
    <category term="logstash" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/logstash/"/>
    
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/tags/springboot/"/>
    
    <category term="logstash" scheme="https://blog.hanqunfeng.com/tags/logstash/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æ–‡ææ‡‚ELK</title>
    <link href="https://blog.hanqunfeng.com/2025/03/27/elk-01/"/>
    <id>https://blog.hanqunfeng.com/2025/03/27/elk-01/</id>
    <published>2025-03-27T13:30:05.000Z</published>
    <updated>2025-04-08T08:42:47.683Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…LogStashå’ŒFileBeat</p></li><li class="lvl-2"><p>é€šè¿‡ç¤ºä¾‹è®²è§£ELKçš„ç»å…¸æ¶æ„å’Œé«˜å¹¶å‘æ¶æ„çš„å®ç°è¿‡ç¨‹</p></li><li class="lvl-2"><p>LogStashç‰ˆæœ¬8.17.3ï¼ŒFileBeatç‰ˆæœ¬8.17.3</p></li><li class="lvl-2"><p>Elasticsearchç‰ˆæœ¬8.17.3ï¼Œ<a href="/2025/03/20/elasticsearch-01-install/" title="linuxä¸‹å®‰è£…Elasticsearch">linuxä¸‹å®‰è£…Elasticsearch</a></p></li><li class="lvl-2"><p>Kibanaç‰ˆæœ¬8.17.3ï¼Œ<a href="/2025/03/21/kibana-01-install/" title="linuxä¸‹å®‰è£…Kibana">linuxä¸‹å®‰è£…Kibana</a></p></li><li class="lvl-2"><p>Elasticsearché›†ç¾¤æ­å»ºï¼Œ<a href="/2025/03/24/elasticsearch-02-install-cluster/" title="linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤">linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤</a></p></li></ul><span id="more"></span><h2 id="Logstashæ¦‚è¿°">Logstashæ¦‚è¿°</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://www.elastic.co/cn/logstash">Logstash</a> æ˜¯å…è´¹ä¸”å¼€æ”¾çš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œèƒ½å¤Ÿä»å¤šä¸ªæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°æ‚¨æœ€å–œæ¬¢çš„å­˜å‚¨åº“ä¸­ã€‚</p></li><li class="lvl-2"><p>Logstashæ•°æ®ä¼ è¾“åŸç†<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/image-2.png" alt=""></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.æ•°æ®é‡‡é›†ä¸è¾“å…¥ï¼šLogstashæ”¯æŒå„ç§è¾“å…¥é€‰æ‹©ï¼Œèƒ½å¤Ÿä»¥è¿ç»­çš„æµå¼ä¼ è¾“æ–¹å¼ï¼Œè½»æ¾åœ°ä»æ—¥å¿—ã€æŒ‡æ ‡ã€Webåº”ç”¨ä»¥åŠæ•°æ®å­˜å‚¨ä¸­é‡‡é›†æ•°æ®ã€‚</span><br><span class="line">2.å®æ—¶è§£æå’Œæ•°æ®è½¬æ¢ï¼šé€šè¿‡Logstashè¿‡æ»¤å™¨è§£æå„ä¸ªäº‹ä»¶ï¼Œè¯†åˆ«å·²å‘½åçš„å­—æ®µæ¥æ„å»ºç»“æ„ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢æˆé€šç”¨æ ¼å¼ï¼Œæœ€ç»ˆå°†æ•°æ®ä»æºç«¯ä¼ è¾“åˆ°å­˜å‚¨åº“ä¸­ã€‚</span><br><span class="line">3.å­˜å‚¨ä¸æ•°æ®å¯¼å‡ºï¼šLogstashæä¾›å¤šç§è¾“å‡ºé€‰æ‹©ï¼Œå¯ä»¥å°†æ•°æ®å‘é€åˆ°æŒ‡å®šçš„åœ°æ–¹ã€‚</span><br></pre></td></tr></table></figure><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/%E6%88%AA%E5%9B%BE-3.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>Logstashé€šè¿‡ç®¡é“å®Œæˆæ•°æ®çš„é‡‡é›†ä¸å¤„ç†ï¼Œç®¡é“é…ç½®ä¸­åŒ…å«inputã€outputå’Œfilterï¼ˆå¯é€‰ï¼‰æ’ä»¶ï¼Œinputå’Œoutputç”¨æ¥é…ç½®è¾“å…¥å’Œè¾“å‡ºæ•°æ®æºã€filterç”¨æ¥å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤æˆ–é¢„å¤„ç†ã€‚</p></li></ul><h2 id="Logstashä¸‹è½½å®‰è£…">Logstashä¸‹è½½å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.elastic.co/cn/downloads/past-releases#logstash">https://www.elastic.co/cn/downloads/past-releases#logstash</a></p></li><li class="lvl-2"><p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>LogStash 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/logstash/logstash-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/logstash</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/local/logstash</span><br><span class="line">tar -zxvf logstash-8.17.3-linux-x86_64.tar.gz -C /usr/local/logstash</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨ï¼Œä¸ºäº†ç»Ÿä¸€ç®¡ç†ï¼Œlogstashä¹Ÿä½¿ç”¨è¿™ä¸ªç”¨æˆ·ï¼ˆéå¿…è¦ï¼‰</p></li><li class="lvl-2"><p>åˆ›å»ºç”¨æˆ·<code>elastic</code>ï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬åœ¨å®‰è£…elasticsearchçš„æ—¶å€™å·²ç»é…ç½®è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd elastic</span><br><span class="line">passwd elastic</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹logstashå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R elastic:elastic /usr/local/logstash</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢ç”¨æˆ·</span></span><br><span class="line">su - elastic</span><br><span class="line"><span class="comment"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/logstash/logstash-8.17.3/</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -e: ç›´æ¥æŠŠé…ç½®æ”¾åœ¨å‘½ä»¤ä¸­ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆå¿«é€Ÿè¿›è¡Œæµ‹è¯•</span></span><br><span class="line"><span class="comment"># input &#123; stdin &#123; &#125; &#125;: è¾“å…¥æ’ä»¶ï¼Œä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment"># output &#123; stdout &#123;&#125; &#125;: è¾“å‡ºæ’ä»¶ï¼Œå°†æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º</span></span><br><span class="line"><span class="comment"># è¿™é‡ŒåªåŒ…å«äº† input å’Œ output ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå®é™…ä½¿ç”¨ä¸­è¿˜éœ€è¦æ·»åŠ  filter éƒ¨åˆ†</span></span><br><span class="line">./bin/logstash -e <span class="string">&#x27;input &#123; stdin &#123; &#125; &#125; output &#123; stdout &#123;&#125; &#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ <span class="comment"># è¾“å‡ºå¯åŠ¨ä¿¡æ¯</span></span><br><span class="line">The stdin plugin is now waiting <span class="keyword">for</span> input: <span class="comment"># è¾“å‡ºæç¤ºä¿¡æ¯ï¼Œæç¤ºä½ è¾“å…¥å†…å®¹</span></span><br><span class="line">hello world  <span class="comment"># æˆ‘è¾“å…¥å†…å®¹</span></span><br><span class="line"><span class="comment"># logstashè¾“å‡ºå†…å®¹</span></span><br><span class="line">&#123;</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">         <span class="string">&quot;event&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;original&quot;</span> =&gt; <span class="string">&quot;hello world&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;hostname&quot;</span> =&gt; <span class="string">&quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2025-03-27T06:48:12.810617855Z</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨logstash</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim test.conf</span></span><br><span class="line">input &#123;</span><br><span class="line">  stdin &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># codec =&gt; rubydebug : æ˜¯æŒ‡å®šäº†ä¸€ä¸ªç¼–ç å™¨ï¼ˆCodecï¼‰ä¸º rubydebugã€‚</span></span><br><span class="line"><span class="comment"># ç¼–ç å™¨è´Ÿè´£å¦‚ä½•æ ¼å¼åŒ–è¾“å‡ºçš„æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment"># Rubydebug ç¼–ç å™¨æ˜¯ä¸€ç§ç‰¹åˆ«é€‚åˆå¼€å‘å’Œè°ƒè¯•ç›®çš„çš„ç¼–ç å™¨ï¼Œå› ä¸ºå®ƒèƒ½ä»¥ç›¸å½“æ˜“è¯»çš„å½¢å¼å±•ç¤ºå¤æ‚çš„ç»“æ„åŒ–æ•°æ®ï¼Œæ¯”å¦‚åµŒå¥—çš„å“ˆå¸Œè¡¨æˆ–è€…æ•°ç»„ã€‚</span></span><br><span class="line"><span class="comment"># é™¤äº† Rubydebug ç¼–ç å™¨ï¼ŒLogstash è¿˜æä¾›äº†å…¶ä»–å‡ ç§ç¼–ç å™¨ï¼Œæ¯”å¦‚ jsonã€plainã€multiline ç­‰ç­‰ã€‚</span></span><br><span class="line"><span class="comment"># å…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/en/logstash/current/codec-plugins.html</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/logstash -f ./test.conf</span><br></pre></td></tr></table></figure><h2 id="Logstashæ’ä»¶">Logstashæ’ä»¶</h2><h3 id="Input-Plugins">Input Plugins</h3><blockquote><p><a href="https://www.elastic.co/guide/en/logstash/8.17/input-plugins.html">https://www.elastic.co/guide/en/logstash/8.17/input-plugins.html</a></p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ª Pipelineå¯ä»¥æœ‰å¤šä¸ªinputæ’ä»¶</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- Stdin / File</span><br><span class="line">- Beats / Log4J /Elasticsearch / JDBC / Kafka /Rabbitmq /Redis</span><br><span class="line">- JMX/ HTTP / Websocket / UDP / TCP</span><br><span class="line">- Google Cloud Storage / S3</span><br><span class="line">- Github / Twitter</span><br></pre></td></tr></table></figure><h3 id="Filter-Plugins">Filter Plugins</h3><blockquote><p><a href="https://www.elastic.co/guide/en/logstash/8.17/filter-plugins.html">https://www.elastic.co/guide/en/logstash/8.17/filter-plugins.html</a></p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>Filter Pluginå¯ä»¥å¯¹Logstash Eventè¿›è¡Œå„ç§å¤„ç†ï¼Œä¾‹å¦‚è§£æï¼Œåˆ é™¤å­—æ®µï¼Œç±»å‹è½¬æ¢</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- Date: æ—¥æœŸè§£æ</span><br><span class="line">- Dissect: åˆ†å‰²ç¬¦è§£æ</span><br><span class="line">- Grok: æ­£åˆ™åŒ¹é…è§£æ</span><br><span class="line">- Mutate: å¯¹å­—æ®µåšå„ç§æ“ä½œ</span><br><span class="line">- Convert : ç±»å‹è½¬æ¢</span><br><span class="line">- Gsub : å­—ç¬¦ä¸²æ›¿æ¢</span><br><span class="line">- Split / Join /Merge:  å­—ç¬¦ä¸²åˆ‡å‰²ï¼Œæ•°ç»„åˆå¹¶å­—ç¬¦ä¸²ï¼Œæ•°ç»„åˆå¹¶æ•°ç»„</span><br><span class="line">- Rename: å­—æ®µé‡å‘½å</span><br><span class="line">- Update / Replace: å­—æ®µå†…å®¹æ›´æ–°æ›¿æ¢</span><br><span class="line">- Remove_field: å­—æ®µåˆ é™¤</span><br><span class="line">- Ruby: åˆ©ç”¨Ruby ä»£ç æ¥åŠ¨æ€ä¿®æ”¹Event</span><br></pre></td></tr></table></figure><h3 id="Output-Plugins">Output Plugins</h3><blockquote><p><a href="https://www.elastic.co/guide/en/logstash/8.17/output-plugins.html">https://www.elastic.co/guide/en/logstash/8.17/output-plugins.html</a></p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å°†Eventå‘é€åˆ°ç‰¹å®šçš„ç›®çš„åœ°ï¼Œæ˜¯ Pipeline çš„æœ€åä¸€ä¸ªé˜¶æ®µã€‚å¸¸è§ Output Pluginsï¼š</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- Elasticsearch</span><br><span class="line">- Email / Pageduty</span><br><span class="line">- Influxdb / Kafka / Mongodb / Opentsdb / Zabbix</span><br><span class="line">- Http / TCP / Websocket</span><br></pre></td></tr></table></figure><h3 id="Codec-Plugins">Codec Plugins</h3><blockquote><p><a href="https://www.elastic.co/guide/en/logstash/8.17/codec-plugins.html">https://www.elastic.co/guide/en/logstash/8.17/codec-plugins.html</a></p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å°†åŸå§‹æ•°æ®decodeæˆEvent;å°†Event encodeæˆç›®æ ‡æ•°æ®ï¼Œå†…ç½®çš„Codec Plugins:</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- Line / Multiline</span><br><span class="line">- JSON / Avro / Cef (ArcSight Common Event Format)</span><br><span class="line">- Dots / Rubydebug</span><br></pre></td></tr></table></figure><h2 id="FileBeatæ¦‚è¿°">FileBeatæ¦‚è¿°</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://www.elastic.co/cn/beats">Beats</a> æ˜¯ä¸€ä¸ªå…è´¹ä¸”å¼€æ”¾çš„å¹³å°ï¼Œé›†åˆäº†å¤šç§å•ä¸€ç”¨é€”çš„æ•°æ®é‡‡é›†å™¨ã€‚å®ƒä»¬ä»æˆç™¾ä¸Šåƒæˆ–æˆåƒä¸Šä¸‡å°æœºå™¨å’Œç³»ç»Ÿå‘ Logstash æˆ– Elasticsearch å‘é€æ•°æ®ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/iEmI1C.png" alt=""></p></li><li class="lvl-2"><p><a href="https://www.elastic.co/cn/beats/filebeat">FileBeat</a> ä¸“é—¨ç”¨äºè½¬å‘å’Œæ”¶é›†æ—¥å¿—æ•°æ®çš„è½»é‡çº§é‡‡é›†å·¥å…·ã€‚å®ƒå¯ä»¥ä½œä¸ºä»£ç†å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šï¼ŒFileBeatç›‘è§†æŒ‡å®šè·¯å¾„çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ”¶é›†æ—¥å¿—æ•°æ®ï¼Œå¹¶å°†æ”¶é›†åˆ°çš„æ—¥å¿—è½¬å‘åˆ°Elasticsearchæˆ–è€…Logstashã€‚</p></li></ul><h2 id="logstash-vs-FileBeat">logstash vs FileBeat</h2><ul class="lvl-0"><li class="lvl-2"><p>Logstashæ˜¯åœ¨jvmä¸Šè¿è¡Œçš„ï¼Œèµ„æºæ¶ˆè€—æ¯”è¾ƒå¤§ã€‚è€ŒFileBeatæ˜¯åŸºäºgolangç¼–å†™çš„ï¼ŒåŠŸèƒ½è¾ƒå°‘ä½†èµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°ï¼Œæ›´è½»é‡çº§ã€‚</p></li><li class="lvl-2"><p>Logstash å’ŒFilebeatéƒ½å…·æœ‰æ—¥å¿—æ”¶é›†åŠŸèƒ½ï¼ŒFilebeatæ›´è½»é‡ï¼Œå ç”¨èµ„æºæ›´å°‘</p></li><li class="lvl-2"><p>Logstash å…·æœ‰FilteråŠŸèƒ½ï¼Œèƒ½è¿‡æ»¤åˆ†ææ—¥å¿—</p></li><li class="lvl-2"><p>ä¸€èˆ¬ç»“æ„éƒ½æ˜¯Filebeaté‡‡é›†æ—¥å¿—ï¼Œç„¶åå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€Redisã€MQä¸­ï¼Œç„¶åLogstashå»è·å–ï¼Œåˆ©ç”¨FilteråŠŸèƒ½è¿‡æ»¤åˆ†æï¼Œç„¶åå­˜å‚¨åˆ°Elasticsearchä¸­</p></li><li class="lvl-2"><p>FileBeatå’ŒLogstashé…åˆï¼Œå®ç°èƒŒå‹æœºåˆ¶ã€‚å½“å°†æ•°æ®å‘é€åˆ°Logstashæˆ– Elasticsearchæ—¶ï¼ŒFilebeatä½¿ç”¨èƒŒå‹æ•æ„Ÿåè®®ï¼Œä»¥åº”å¯¹æ›´å¤šçš„æ•°æ®é‡ã€‚å¦‚æœLogstashæ­£åœ¨å¿™äºå¤„ç†æ•°æ®ï¼Œåˆ™ä¼šå‘Šè¯‰Filebeat å‡æ…¢è¯»å–é€Ÿåº¦ã€‚ä¸€æ—¦æ‹¥å µå¾—åˆ°è§£å†³ï¼ŒFilebeatå°±ä¼šæ¢å¤åˆ°åŸæ¥çš„æ­¥ä¼å¹¶ç»§ç»­ä¼ è¾“æ•°æ®ã€‚</p></li></ul><h2 id="FileBeatä¸‹è½½å’Œå®‰è£…">FileBeatä¸‹è½½å’Œå®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.elastic.co/cn/downloads/past-releases#filebeat">https://www.elastic.co/cn/downloads/past-releases#filebeat</a></p></li><li class="lvl-2"><p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>FileBeat 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/filebeat</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/local/filebeat</span><br><span class="line">tar -zxvf filebeat-8.17.3-linux-x86_64.tar.gz -C /usr/local/filebeat</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹logstashå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R elastic:elastic /usr/local/filebeat</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢ç”¨æˆ·</span></span><br><span class="line">su - elastic</span><br><span class="line"><span class="comment"># è¿›å…¥ filebeat å®‰è£…ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/filebeat/filebeat-8.17.3-linux-x86_64/</span><br></pre></td></tr></table></figure><h2 id="ç»å…¸çš„ELKæ¶æ„">ç»å…¸çš„ELKæ¶æ„</h2><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/%E6%88%AA%E5%9B%BE.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>Filebeatæ—¥å¿—æ”¶é›†ï¼šFilebeatä½œä¸ºè½»é‡çº§çš„æ—¥å¿—æ”¶é›†ä»£ç†ï¼Œéƒ¨ç½²åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œæ¶ˆè€—èµ„æºå°‘ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°æ”¶é›†æ—¥å¿—æ•°æ®ã€‚</p></li><li class="lvl-2"><p>Logstashæ•°æ®å¤„ç†ï¼šLogstashä½œä¸ºæ•°æ®å¤„ç†ç®¡é“ï¼Œè´Ÿè´£å°†Filebeatæ”¶é›†çš„æ—¥å¿—æ•°æ®è¿›è¡Œè¿‡æ»¤ã€è½¬æ¢ç­‰æ“ä½œï¼Œç„¶åå‘é€åˆ°Elasticsearchè¿›è¡Œå­˜å‚¨ã€‚</p></li><li class="lvl-2"><p>Elasticsearchå­˜å‚¨ä¸æœç´¢ï¼šElasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼Œæä¾›å¼ºå¤§çš„æ•°æ®å­˜å‚¨å’Œæœç´¢èƒ½åŠ›ã€‚</p></li><li class="lvl-2"><p>Kibanaå¯è§†åŒ–ï¼šKibanaä¸ºElasticsearchæä¾›Webå¯è§†åŒ–ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡å›¾è¡¨ã€ä»ªè¡¨ç›˜ç­‰æ–¹å¼ç›´è§‚åœ°æŸ¥çœ‹å’Œåˆ†ææ—¥å¿—æ•°æ®ã€‚</p></li><li class="lvl-2"><p>é€‚ç”¨åœºæ™¯ï¼šç»å…¸çš„ELKæ¶æ„ä¸»è¦é€‚ç”¨äºæ•°æ®é‡è¾ƒå°çš„å¼€å‘ç¯å¢ƒã€‚ç„¶è€Œï¼Œç”±äºç¼ºå°‘æ¶ˆæ¯é˜Ÿåˆ—çš„ç¼“å†²æœºåˆ¶ï¼Œå½“Logstashæˆ–Elasticsearchå‡ºç°æ•…éšœæ—¶ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚</p></li></ul><h2 id="ä¸€ä¸ªç»å…¸ELKæ¶æ„ç¤ºä¾‹">ä¸€ä¸ªç»å…¸ELKæ¶æ„ç¤ºä¾‹</h2><h3 id="FileBeaté‡‡é›†NginxæœåŠ¡å™¨æ—¥å¿—å¹¶å‘é€åˆ°Logstash">FileBeaté‡‡é›†NginxæœåŠ¡å™¨æ—¥å¿—å¹¶å‘é€åˆ°Logstash</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>filebeat-nginx.yml</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Filebeatå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å› ä¸ºNginxçš„access.logæ—¥å¿—éƒ½æ˜¯ä»¥IPåœ°å€å¼€å¤´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹åŒ¹é…å­—æ®µã€‚</span></span><br><span class="line"><span class="comment"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class="line"><span class="attr">filebeat.inputs:</span> <span class="comment"># è¾“å…¥æºé…ç½®</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">log</span> <span class="comment"># æ—¥å¿—ç±»å‹</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¯ç”¨</span></span><br><span class="line">  <span class="attr">paths:</span> <span class="comment"># é‡‡é›†è·¯å¾„</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/nginx/access*.*</span></span><br><span class="line">  <span class="attr">exclude_files:</span> [<span class="string">&quot;.gz$&quot;</span>] <span class="comment"># æ’é™¤ä»¥.gz ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class="line">  <span class="attr">multiline.pattern:</span> <span class="string">&#x27;^\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\s&#x27;</span> <span class="comment"># åŒ¹é…ä»¥IPåœ°å€å¼€å¤´ï¼Œå¹¶ç´§è·Ÿä¸€ä¸ªç©ºç™½å­—ç¬¦</span></span><br><span class="line">  <span class="attr">multiline.negate:</span> <span class="literal">true</span> <span class="comment"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class="line">  <span class="attr">multiline.match:</span> <span class="string">after</span> <span class="comment"># è¿½åŠ åˆ°ä¸Šä¸€è¡Œçš„åé¢</span></span><br><span class="line">  <span class="comment"># multiline: å¤šè¡Œæ—¥å¿—é…ç½®ï¼Œè¿™é‡Œå®é™…ä¸Šä¸éœ€è¦é…ç½®å¤šè¡Œè®¾ç½®ï¼Œå› ä¸ºnginxçš„accessæ—¥å¿—éƒ½æ˜¯å•è¡Œæ—¥å¿—ï¼Œè¿™é‡Œåªåšæ¼”ç¤º</span></span><br><span class="line">    <span class="comment"># pattern: æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="comment"># negate: falseï¼ŒåŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œï¼›trueï¼Œä¸åŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class="line">    <span class="comment"># match: afterï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„æœ«å°¾ï¼›beforeï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„å¼€å¤´</span></span><br><span class="line">  <span class="attr">scan_frequency:</span> <span class="string">10s</span> <span class="comment"># æ¯ 10 ç§’æ‰«æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">  <span class="attr">clean_removed:</span> <span class="literal">true</span> <span class="comment"># åœ¨æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤åæ˜¯å¦ä»å…¶å†…éƒ¨çŠ¶æ€ä¸­ç§»é™¤è¯¥æ–‡ä»¶çš„è®°å½•</span></span><br><span class="line">  <span class="attr">clean_inactive:</span> <span class="string">2h</span> <span class="comment"># åœ¨æ—¥å¿—æ–‡ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€å¤šé•¿æ—¶é—´åå°†å…¶ä»çŠ¶æ€æ•°æ®åº“ä¸­ç§»,è®¾ç½®ä¸ºæ¯” ignore_older + scan_frequency æ›´å¤§çš„å€¼</span></span><br><span class="line">  <span class="attr">ignore_older:</span> <span class="string">1h</span> <span class="comment"># å¿½ç•¥é‚£äº›æ¯”å½“å‰æ—¶é—´æ—©äº 1 å°æ—¶çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="attr">output.logstash:</span> <span class="comment"># è¾“å‡ºé…ç½®ï¼Œè¿™é‡Œæ˜¯å‘é€åˆ°Logstash</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¯ç”¨</span></span><br><span class="line">  <span class="attr">hosts:</span> [<span class="string">&quot;10.250.0.239:5044&quot;</span>] <span class="comment"># LogstashæœåŠ¡åœ°å€</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºFileBeatçš„ç”¨æˆ·åˆ†é…æ—¥å¿—ç›®å½•çš„è¯»å–æƒé™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ setfaclå‘½ä»¤ä¸ºelasticç”¨æˆ·åˆ†é…æ—¥å¿—ç›®å½•çš„è¯»å–æƒé™</span></span><br><span class="line"><span class="built_in">sudo</span> setfacl -d -m u:elastic:r-x -R /var/log/nginx/</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨FileBeat</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./filebeat -e -c conf/filebeat-nginx.yml</span><br><span class="line"><span class="comment"># åå°å¯åŠ¨</span></span><br><span class="line"><span class="built_in">nohup</span> ./filebeat -e -c conf/filebeat-nginx.yml &amp;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨å¯åŠ¨filebeatæ—¶å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exiting: error loading config file: config file (<span class="string">&quot;conf/filebeat-nginx.yml&quot;</span>) can only be writable by the owner but the permissions are <span class="string">&quot;-rw-rw-r--&quot;</span> (to fix the permissions use: <span class="string">&#x27;chmod go-w /usr/local/filebeat/filebeat-8.17.3-linux-x86_64/conf/filebeat-nginx.yml&#x27;</span>)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-4"><p>å› ä¸ºå®‰å…¨åŸå› ä¸è¦å…¶ä»–ç”¨æˆ·å†™çš„æƒé™ï¼Œå»æ‰å†™çš„æƒé™å°±å¯ä»¥äº†</p></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> go-w conf/filebeat-nginx.yml</span><br></pre></td></tr></table></figure><h3 id="é…ç½®Logstashæ¥æ”¶FileBeatæ”¶é›†çš„æ•°æ®å¹¶æ‰“å°">é…ç½®Logstashæ¥æ”¶FileBeatæ”¶é›†çš„æ•°æ®å¹¶æ‰“å°</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>logstash-nginx.conf</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Logstashå®‰è£…ç›®å½•ä¸‹çš„configç›®å½•ä¸‹ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class="line"><span class="comment"># vim config/logstash-nginx.conf</span></span><br><span class="line"><span class="comment"># é…ç½®ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class="line">input &#123; <span class="comment"># è¾“å…¥æºé…ç½®</span></span><br><span class="line">    beats &#123; <span class="comment"># ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class="line">      port =&gt; 5044 <span class="comment"># ç›‘å¬5044ç«¯å£</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123; <span class="comment"># è¾“å‡ºé…ç½®</span></span><br><span class="line">    stdout &#123; <span class="comment"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class="line">      codec =&gt; rubydebug <span class="comment"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµ‹è¯•logstashé…ç½®æ˜¯å¦æ­£ç¡®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/logstash -f config/logstash-nginx.conf --config.test_and_exit</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨logstash</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reload.automaticï¼šä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½</span></span><br><span class="line">bin/logstash -f config/logstash-nginx.conf --config.reload.automatic</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶åœ¨æ§åˆ¶å°ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">         <span class="string">&quot;input&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;log&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">      <span class="string">&quot;@version&quot;</span> =&gt; <span class="string">&quot;1&quot;</span>,</span><br><span class="line">       <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;1.119.161.30 - elastic [27/Mar/2025:08:52:41 +0000] \&quot;GET /_cluster/stats HTTP/1.1\&quot; 200 7445 \&quot;-\&quot; \&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\&quot; \&quot;-\&quot;&quot;</span>,</span><br><span class="line">           <span class="string">&quot;log&quot;</span> =&gt; &#123;</span><br><span class="line">          <span class="string">&quot;file&quot;</span> =&gt; &#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span> =&gt; <span class="string">&quot;/var/log/nginx/access.log&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;offset&quot;</span> =&gt; 42985</span><br><span class="line">    &#125;,</span><br><span class="line">          <span class="string">&quot;tags&quot;</span> =&gt; [</span><br><span class="line">        [0] <span class="string">&quot;beats_input_codec_plain_applied&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;@timestamp&quot;</span> =&gt; 2025-03-27T08:52:42.947Z,</span><br><span class="line">           <span class="string">&quot;ecs&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;version&quot;</span> =&gt; <span class="string">&quot;8.0.0&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">         <span class="string">&quot;agent&quot;</span> =&gt; &#123;</span><br><span class="line">                  <span class="string">&quot;id&quot;</span> =&gt; <span class="string">&quot;4dbe185b-900d-4990-b841-c13bf9618fc6&quot;</span>,</span><br><span class="line">                <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ephemeral_id&quot;</span> =&gt; <span class="string">&quot;6bb04808-7da7-4acb-95fd-f3f915651457&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span> =&gt; <span class="string">&quot;filebeat&quot;</span>,</span><br><span class="line">             <span class="string">&quot;version&quot;</span> =&gt; <span class="string">&quot;8.17.3&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">         <span class="string">&quot;event&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;original&quot;</span> =&gt; <span class="string">&quot;1.119.161.30 - elastic [27/Mar/2025:08:52:41 +0000] \&quot;GET /_cluster/stats HTTP/1.1\&quot; 200 7445 \&quot;-\&quot; \&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\&quot; \&quot;-\&quot;&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">          <span class="string">&quot;host&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;ip-10-250-0-239.cn-northwest-1.compute.internal&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿—">åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿—</h4><ul class="lvl-0"><li class="lvl-2"><p>ä»æ‰“å°ç»“æœçœ‹åˆ°åŒ…å«äº†å¤§é‡çš„æ— å…³æ•°æ®ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨Logstashè¿‡æ»¤å™¨è§£ææ—¥å¿—ï¼Œè¿™é‡Œä½¿ç”¨<code>Grok</code>æ’ä»¶</p></li><li class="lvl-2"><p><a href="https://www.elastic.co/guide/en/logstash/8.17/plugins-filters-grok.html">Grok</a>æ˜¯ä¸€ç§å°†éç»“æ„åŒ–æ—¥å¿—è§£æä¸ºç»“æ„åŒ–çš„æ’ä»¶ã€‚è¿™ä¸ªå·¥å…·éå¸¸é€‚åˆç”¨æ¥è§£æç³»ç»Ÿæ—¥å¿—ã€WebæœåŠ¡å™¨æ—¥å¿—ã€MySQLæˆ–è€…æ˜¯ä»»æ„å…¶ä»–çš„æ—¥å¿—æ ¼å¼ã€‚</p></li><li class="lvl-2"><p>Grokæ˜¯é€šè¿‡æ¨¡å¼åŒ¹é…çš„æ–¹å¼æ¥è¯†åˆ«æ—¥å¿—ä¸­çš„æ•°æ®,å¯ä»¥æŠŠGrokæ’ä»¶ç®€å•ç†è§£ä¸ºå‡çº§ç‰ˆæœ¬çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å®ƒæ‹¥æœ‰æ›´å¤šçš„æ¨¡å¼ï¼Œé»˜è®¤Logstashæ‹¥æœ‰120ä¸ªæ¨¡å¼ã€‚å¦‚æœè¿™äº›æ¨¡å¼ä¸æ»¡è¶³æˆ‘ä»¬è§£ææ—¥å¿—çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¿›è¡ŒåŒ¹é…ã€‚</p></li><li class="lvl-2"><p><a href="https://help.aliyun.com/zh/sls/user-guide/grok-patterns">GROKæ¨¡å¼å‚è€ƒ</a></p></li><li class="lvl-2"><p>grokæ¨¡å¼çš„è¯­æ³•æ˜¯:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%&#123;SYNTAX:SEMANTIC&#125;</span><br><span class="line"><span class="comment"># SYNTAXï¼ˆè¯­æ³•ï¼‰æŒ‡çš„æ˜¯Grokæ¨¡å¼åç§°ï¼ŒSEMANTICï¼ˆè¯­ä¹‰ï¼‰æ˜¯ç»™æ¨¡å¼åŒ¹é…åˆ°çš„æ–‡æœ¬å­—æ®µåã€‚ä¾‹å¦‚ï¼š</span></span><br><span class="line">%&#123;NUMBER:duration&#125; %&#123;IP:client&#125;</span><br><span class="line"><span class="comment"># durationè¡¨ç¤ºï¼šåŒ¹é…ä¸€ä¸ªæ•°å­—ï¼Œclientè¡¨ç¤ºåŒ¹é…ä¸€ä¸ªIPåœ°å€ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŒ¹é…nginxæ—¥å¿—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx accessæ—¥å¿—æ ¼å¼</span></span><br><span class="line">1.119.161.30 - elastic [27/Mar/2025:03:05:36 +0000] <span class="string">&quot;GET /_cluster/stats HTTP/1.1&quot;</span> 200 7446 <span class="string">&quot;-&quot;</span> <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36&quot;</span> <span class="string">&quot;-&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># grok</span></span><br><span class="line">%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \[%&#123;HTTPDATE:timestamp&#125;\] \&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \&quot;%&#123;NOTSPACE:referrer&#125;\&quot; \&quot;%&#123;GREEDYDATA:agent&#125;\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;</span><br><span class="line"><span class="comment"># è§£é‡Šæ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ï¼š</span></span><br><span class="line"><span class="comment"># %&#123;IP:client_ip&#125;ï¼šåŒ¹é…å®¢æˆ·ç«¯ IP åœ°å€ã€‚</span></span><br><span class="line"><span class="comment"># -ï¼šåŒ¹é…ä¸€ä¸ªç ´æŠ˜å·ï¼ˆ-ï¼‰ï¼Œè¡¨ç¤ºåŒ¿åç”¨æˆ·æˆ–æœªè®¤è¯ç”¨æˆ·ã€‚</span></span><br><span class="line"><span class="comment"># %&#123;USER:remote_user&#125;ï¼šåŒ¹é…è¿œç¨‹ç”¨æˆ·åï¼Œ - è¡¨ç¤ºåŒ¿åç”¨æˆ·ã€‚</span></span><br><span class="line"><span class="comment"># \[%&#123;HTTPDATE:timestamp&#125;\]ï¼šåŒ¹é…è¯·æ±‚çš„æ—¶é—´æˆ³ï¼Œæ ¼å¼ä¸º [27/Mar/2025:03:05:36 +0000]ã€‚</span></span><br><span class="line"><span class="comment"># \&quot;%&#123;WORD:verb&#125; : åŒ¹é…è¯·æ±‚æ–¹æ³• (GET)</span></span><br><span class="line"><span class="comment"># %&#123;URIPATHPARAM:request&#125; : åŒ¹é…è¯·æ±‚è·¯å¾„ (/_cluster/stats)</span></span><br><span class="line"><span class="comment"># HTTP/%&#123;NUMBER:httpversion&#125;\\\&quot;ï¼šåŒ¹é… HTTP ç‰ˆæœ¬ (HTTP/1.1)ã€‚</span></span><br><span class="line"><span class="comment"># %&#123;INT:http_status&#125;ï¼šåŒ¹é… HTTP å“åº”çŠ¶æ€ç  (200)ã€‚</span></span><br><span class="line"><span class="comment"># %&#123;INT:body_bytes_sent&#125;ï¼šåŒ¹é…å“åº”ä½“çš„å­—èŠ‚æ•° (7446)ã€‚</span></span><br><span class="line"><span class="comment"># \&quot;%&#123;NOTSPACE:referrer&#125;\&quot;ï¼šåŒ¹é…å¼•ç”¨é¡µ (Referer) å­—æ®µï¼Œè¿™é‡Œä¸ºç©º (&quot;-&quot;)ã€‚</span></span><br><span class="line"><span class="comment"># \&quot;%&#123;GREEDYDATA:agent&#125;\&quot;ï¼šåŒ¹é…ç”¨æˆ·ä»£ç† (User-Agent) å­—æ®µã€‚GREEDYDATA ä¼šåŒ¹é…å°½å¯èƒ½å¤šçš„æ•°æ®ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªåˆ†éš”ç¬¦ã€‚</span></span><br><span class="line"><span class="comment"># %&#123;QUOTEDSTRING:x_forwarded_for&#125;ï¼šåŒ¹é… X-Forwarded-For å¤´å­—æ®µï¼Œè¿™é‡Œä¸ºç©º (&quot;-&quot;)ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒ¹é…ç»“æœ</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;request&quot;</span>: <span class="string">&quot;/_cluster/stats&quot;</span>,</span><br><span class="line">  <span class="string">&quot;agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">  <span class="string">&quot;body_bytes_sent&quot;</span>: <span class="string">&quot;7446&quot;</span>,</span><br><span class="line">  <span class="string">&quot;verb&quot;</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  <span class="string">&quot;x_forwarded_for&quot;</span>: <span class="string">&quot;\&quot;-\&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;remote_user&quot;</span>: <span class="string">&quot;elastic&quot;</span>,</span><br><span class="line">  <span class="string">&quot;referrer&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">  <span class="string">&quot;client_ip&quot;</span>: <span class="string">&quot;1.119.161.30&quot;</span>,</span><br><span class="line">  <span class="string">&quot;httpversion&quot;</span>: <span class="string">&quot;1.1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;http_status&quot;</span>: <span class="string">&quot;200&quot;</span>,</span><br><span class="line">  <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;27/Mar/2025:03:05:36 +0000&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŒ¹é…Grokæ¨¡å¼æ˜¯ä¸ªéå¸¸ç¹ççš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Kibanaæ¥è¿›è¡Œå¯è§†åŒ–çš„Grokè°ƒè¯•<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/nhgnKY.png" alt=""></p></li><li class="lvl-2"><p>groké…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grok &#123;</span><br><span class="line">    match =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \[%&#123;HTTPDATE:timestamp&#125;\] \&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \&quot;%&#123;NOTSPACE:referrer&#125;\&quot; \&quot;%&#123;GREEDYDATA:agent&#125;\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨mutateæ’ä»¶è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µ">ä½¿ç”¨mutateæ’ä»¶è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µ</h4><ul class="lvl-0"><li class="lvl-2"><p>é™¤äº†nginxæ—¥å¿—æœ¬èº«çš„æ ¼å¼å¤–ï¼Œlogstashè¿˜ä¼šæ‰“å°è®¸å¤šæˆ‘ä»¬ä¸éœ€è¦çš„å­—æ®µï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨<code>mutate</code>æ’ä»¶æ¥è¿‡æ»¤æ‰ä¸éœ€è¦çš„å­—æ®µã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mutate &#123;</span><br><span class="line">    enable_metric =&gt; <span class="string">&quot;false&quot;</span> <span class="comment"># ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥</span></span><br><span class="line">    remove_field =&gt; [<span class="string">&quot;message&quot;</span>, <span class="string">&quot;log&quot;</span>, <span class="string">&quot;tags&quot;</span>, <span class="string">&quot;input&quot;</span>, <span class="string">&quot;agent&quot;</span>, <span class="string">&quot;host&quot;</span>, <span class="string">&quot;ecs&quot;</span>, <span class="string">&quot;@version&quot;</span>] <span class="comment"># ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨Dateæ’ä»¶å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼è½¬æ¢">ä½¿ç”¨Dateæ’ä»¶å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼è½¬æ¢</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> &#123;</span><br><span class="line">    match =&gt; [<span class="string">&quot;timestamp&quot;</span>,<span class="string">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span>,<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>] <span class="comment"># æ—¶é—´æ ¼å¼è½¬æ¢</span></span><br><span class="line">    target =&gt; <span class="string">&quot;timestamp&quot;</span> <span class="comment"># ç›®æ ‡å­—æ®µ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®Œæ•´çš„Logstashé…ç½®">å®Œæ•´çš„Logstashé…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class="line"><span class="comment"># vim config/logstsh-nginx.conf</span></span><br><span class="line"><span class="comment"># é…ç½®ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class="line">input &#123; <span class="comment"># è¾“å…¥æºé…ç½®</span></span><br><span class="line">    beats &#123; <span class="comment"># ä»FileBeatæ¥æ”¶æ•°æ®</span></span><br><span class="line">      port =&gt; 5044 <span class="comment"># ç›‘å¬5044ç«¯å£</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123; <span class="comment"># è¿‡æ»¤å™¨é…ç½®</span></span><br><span class="line">    grok &#123;</span><br><span class="line">        match =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \[%&#123;HTTPDATE:timestamp&#125;\] \&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \&quot;%&#123;NOTSPACE:referrer&#125;\&quot; \&quot;%&#123;GREEDYDATA:agent&#125;\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mutate &#123;</span><br><span class="line">        enable_metric =&gt; <span class="string">&quot;false&quot;</span> <span class="comment"># ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥</span></span><br><span class="line">        remove_field =&gt; [<span class="string">&quot;message&quot;</span>, <span class="string">&quot;log&quot;</span>, <span class="string">&quot;tags&quot;</span>, <span class="string">&quot;input&quot;</span>, <span class="string">&quot;agent&quot;</span>, <span class="string">&quot;host&quot;</span>, <span class="string">&quot;ecs&quot;</span>, <span class="string">&quot;@version&quot;</span>] <span class="comment"># ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">date</span> &#123;</span><br><span class="line">        match =&gt; [<span class="string">&quot;timestamp&quot;</span>,<span class="string">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span>,<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>] <span class="comment"># æ—¶é—´æ ¼å¼è½¬æ¢</span></span><br><span class="line">        target =&gt; <span class="string">&quot;timestamp&quot;</span> <span class="comment"># ç›®æ ‡å­—æ®µ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123; <span class="comment"># è¾“å‡ºé…ç½®</span></span><br><span class="line">    stdout &#123; <span class="comment"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class="line">      codec =&gt; rubydebug <span class="comment"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡æ–°å¯åŠ¨logstashåå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">              <span class="string">&quot;event&quot;</span> =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;original&quot;</span> =&gt; <span class="string">&quot;1.119.161.30 - elastic [27/Mar/2025:09:49:41 +0000] \&quot;GET /_cluster/stats HTTP/1.1\&quot; 200 7445 \&quot;-\&quot; \&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\&quot; \&quot;-\&quot;&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">          <span class="string">&quot;client_ip&quot;</span> =&gt; <span class="string">&quot;1.119.161.30&quot;</span>,</span><br><span class="line">            <span class="string">&quot;request&quot;</span> =&gt; <span class="string">&quot;/_cluster/stats&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http_status&quot;</span> =&gt; <span class="string">&quot;200&quot;</span>,</span><br><span class="line">         <span class="string">&quot;@timestamp&quot;</span> =&gt; 2025-03-27T09:49:45.751Z,</span><br><span class="line">    <span class="string">&quot;body_bytes_sent&quot;</span> =&gt; <span class="string">&quot;7445&quot;</span>,</span><br><span class="line">    <span class="string">&quot;x_forwarded_for&quot;</span> =&gt; <span class="string">&quot;\&quot;-\&quot;&quot;</span>,</span><br><span class="line">          <span class="string">&quot;timestamp&quot;</span> =&gt; 2025-03-27T09:49:41.000Z,</span><br><span class="line">           <span class="string">&quot;referrer&quot;</span> =&gt; <span class="string">&quot;-&quot;</span>,</span><br><span class="line">        <span class="string">&quot;remote_user&quot;</span> =&gt; <span class="string">&quot;elastic&quot;</span>,</span><br><span class="line">        <span class="string">&quot;httpversion&quot;</span> =&gt; <span class="string">&quot;1.1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;verb&quot;</span> =&gt; <span class="string">&quot;GET&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å°†ç»“æœè¾“å‡ºåˆ°ES">å°†ç»“æœè¾“å‡ºåˆ°ES</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨è¾“å‡ºé…ç½®ä¸­æ·»åŠ ESè¾“å‡ºé…ç½®</span></span><br><span class="line">output &#123; <span class="comment"># è¾“å‡ºé…ç½®</span></span><br><span class="line">    stdout &#123; <span class="comment"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class="line">      codec =&gt; rubydebug <span class="comment"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    elasticsearch &#123; <span class="comment"># è¾“å‡ºåˆ°ES</span></span><br><span class="line">        index =&gt; <span class="string">&quot;nginx_access_log_%&#123;+YYYY-MM&#125;&quot;</span> <span class="comment"># ç´¢å¼•å,æŒ‰æœˆåˆ†éš”</span></span><br><span class="line">        hosts =&gt; [<span class="string">&quot;https://10.250.0.239:9200&quot;</span>] <span class="comment"># ESåœ°å€</span></span><br><span class="line">        user =&gt; <span class="string">&quot;elastic&quot;</span>                   <span class="comment"># ESç”¨æˆ·å</span></span><br><span class="line">        password =&gt; <span class="string">&quot;123456&quot;</span>                <span class="comment"># ESå¯†ç </span></span><br><span class="line">        ssl =&gt; <span class="literal">true</span>                         <span class="comment"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class="line">        ssl_certificate_verification =&gt; <span class="literal">false</span> <span class="comment"># ç¦ç”¨è¯ä¹¦éªŒè¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœéœ€è¦å¼€å¯è¯ä¹¦æ ¡éªŒï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•è¿›è¡Œé…ç½®</p><ul class="lvl-2"><li class="lvl-6">è·å– Elasticsearch çš„ SSL è¯ä¹¦ï¼š</li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä» Elasticsearch çš„é…ç½®æ–‡ä»¶æˆ–è¯ä¹¦æ–‡ä»¶è·¯å¾„ä¸­è·å–è¯ä¹¦ï¼ˆé€šå¸¸æ˜¯ .pem æˆ– .crt æ–‡ä»¶ï¼‰ã€‚</span></span><br><span class="line">/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt</span><br></pre></td></tr></table></figure><ul class="lvl-2"><li class="lvl-6">å¯¼å…¥è¯ä¹¦åˆ° Java ä¿¡ä»»åº“ï¼šæ³¨æ„è¿™é‡Œè¦å¯¼å…¥åˆ°å¯åŠ¨Logstashçš„JAVAè¿›ç¨‹çš„ä¿¡ä»»åº“</li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># logstashçš„jdkè·¯å¾„ï¼Œé»˜è®¤åœ¨logstashçš„å®‰è£…ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/logstash/logstash-8.17.3/jdk</span><br><span class="line"></span><br><span class="line">bin/keytool -importcert -<span class="built_in">alias</span> es-cert -keystore /usr/local/logstash/logstash-8.17.3/logstash.keystore -file /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">Enter keystore password:  <span class="comment"># è¾“å…¥å¯†ç  è¿™é‡Œæ˜¯123456</span></span><br><span class="line">Re-enter new password:</span><br><span class="line">Owner: CN=Elasticsearch security auto-configuration HTTP CA</span><br><span class="line">Issuer: CN=Elasticsearch security auto-configuration HTTP CA</span><br><span class="line">Serial number: 89d5c501a2efd5d45a6ee5e08daa16bd605d8c28</span><br><span class="line">Valid from: Thu Mar 20 08:53:26 UTC 2025 <span class="keyword">until</span>: Sun Mar 19 08:53:26 UTC 2028</span><br><span class="line">Certificate fingerprints:</span><br><span class="line">    SHA1: DE:73:0C:EC:46:59:69:83:52:7C:C4:CC:6B:65:EC:B6:31:BE:10:22</span><br><span class="line">    SHA256: 3F:14:1C:16:DF:C6:E1:65:89:4B:C1:67:20:84:B2:20:DC:DD:22:FF:E0:21:16:D5:1A:C1:80:03:CF:AA:5A:1D</span><br><span class="line">Signature algorithm name: SHA256withRSA</span><br><span class="line">Subject Public Key Algorithm: 4096-bit RSA key</span><br><span class="line">Version: 3</span><br><span class="line"></span><br><span class="line">Extensions:</span><br><span class="line"></span><br><span class="line"><span class="comment">#1: ObjectId: 2.5.29.35 Criticality=false</span></span><br><span class="line">AuthorityKeyIdentifier [</span><br><span class="line">KeyIdentifier [</span><br><span class="line">0000: 25 EF BA 81 AE 5E 14 1C   7E FF A1 87 12 F8 D0 2E  %....^..........</span><br><span class="line">0010: 3A D7 54 5F                                        :.T_</span><br><span class="line">]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">#2: ObjectId: 2.5.29.19 Criticality=true</span></span><br><span class="line">BasicConstraints:[</span><br><span class="line">CA:<span class="literal">true</span></span><br><span class="line">PathLen: no <span class="built_in">limit</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">#3: ObjectId: 2.5.29.14 Criticality=false</span></span><br><span class="line">SubjectKeyIdentifier [</span><br><span class="line">KeyIdentifier [</span><br><span class="line">0000: 25 EF BA 81 AE 5E 14 1C   7E FF A1 87 12 F8 D0 2E  %....^..........</span><br><span class="line">0010: 3A D7 54 5F                                        :.T_</span><br><span class="line">]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">Trust this certificate? [no]:  <span class="built_in">yes</span> <span class="comment"># yesç¡®è®¤</span></span><br><span class="line">Certificate was added to keystore</span><br></pre></td></tr></table></figure><ul class="lvl-2"><li class="lvl-6"><p>é…ç½® Logstash ä½¿ç”¨ä¿¡ä»»åº“</p></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">output &#123;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        index =&gt; <span class="string">&quot;nginx_access_log_%&#123;+YYYY-MM&#125;&quot;</span> <span class="comment"># ç´¢å¼•å,æŒ‰æœˆåˆ†éš”</span></span><br><span class="line">        hosts =&gt; [<span class="string">&quot;https://10.250.0.239:9200&quot;</span>] <span class="comment"># ESåœ°å€</span></span><br><span class="line">        user =&gt; <span class="string">&quot;elastic&quot;</span>                     <span class="comment"># ESç”¨æˆ·å</span></span><br><span class="line">        password =&gt; <span class="string">&quot;123456&quot;</span>                  <span class="comment"># ESå¯†ç </span></span><br><span class="line">        ssl =&gt; <span class="literal">true</span>                           <span class="comment"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class="line">        ssl_certificate_verification =&gt; <span class="literal">true</span>  <span class="comment"># å¯ç”¨è¯ä¹¦æ ¡éªŒ</span></span><br><span class="line">        ssl_truststore_path =&gt; <span class="string">&quot;/usr/local/logstash/logstash-8.17.3/logstash.keystore&quot;</span> <span class="comment"># æŒ‡å®šä¿¡ä»»åº“è·¯å¾„</span></span><br><span class="line">        ssl_truststore_password =&gt; <span class="string">&quot;123456&quot;</span>   <span class="comment"># ä¿¡ä»»åº“å¯†ç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="æ•´åˆæ¶ˆæ¯é˜Ÿåˆ—-Nginxçš„ELKæ¶æ„">æ•´åˆæ¶ˆæ¯é˜Ÿåˆ—+Nginxçš„ELKæ¶æ„</h2><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/%E6%88%AA%E5%9B%BE-2.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºç¼“å†²æœºåˆ¶ï¼Œç¡®ä¿å³ä½¿åœ¨Logstashæˆ–Elasticsearchå‡ºç°æ•…éšœæ—¶ï¼Œæ—¥å¿—æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æ¶ˆæ¯é˜Ÿåˆ—èƒ½å¤Ÿå‡è¡¡ç½‘ç»œä¼ è¾“ï¼Œé™ä½æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§ã€‚</p></li><li class="lvl-2"><p>Nginxï¼šNginxä½œä¸ºé«˜æ€§èƒ½çš„Webå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚å®ƒå¯ä»¥åœ¨è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ç­‰æ–¹é¢å‘æŒ¥ä½œç”¨ï¼Œæå‡ç”¨æˆ·è®¿é—®ä½“éªŒã€‚</p></li><li class="lvl-2"><p>æ‰©å±•æ€§ï¼šç”±äºå¼•å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—å’ŒNginxç­‰ç»„ä»¶ï¼Œæ•´ä¸ªæ¶æ„çš„æ‰©å±•æ€§å¾—åˆ°å¢å¼ºã€‚å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚åŠ¨æ€è°ƒæ•´å„ç»„ä»¶çš„èµ„æºåˆ†é…å’Œéƒ¨ç½²è§„æ¨¡ã€‚</p></li><li class="lvl-2"><p>é€‚ç”¨åœºæ™¯ï¼šæ•´åˆæ¶ˆæ¯é˜Ÿåˆ—+Nginxçš„æ¶æ„ä¸»è¦é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç‰¹åˆ«æ˜¯éœ€è¦å¤„ç†å¤§æ•°æ®é‡çš„åœºæ™¯ã€‚å®ƒèƒ½å¤Ÿç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ï¼ŒåŒæ—¶æä¾›é«˜æ€§èƒ½çš„æ—¥å¿—å¤„ç†å’Œå¯è§†åŒ–åˆ†ææœåŠ¡ã€‚</p></li><li class="lvl-2"><p>æ€»ç»“æ¥è¯´å°±æ˜¯</p><ul class="lvl-2"><li class="lvl-4">filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis\RabbitMQ\Kafkaç­‰</li><li class="lvl-4">Logstashå†ä»Redis\RabbitMQ\Kafkaä¸­è¯»å–æ—¥å¿—æ•°æ®ï¼Œå¹¶è¿›è¡Œè§£æåå‘é€åˆ°ESä¸­ã€‚</li><li class="lvl-4">ESé›†ç¾¤ä½¿ç”¨nginxè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä»¥å®ç°é«˜å¯ç”¨å’Œé«˜æ€§èƒ½ã€‚å…·ä½“å®ç°æ–¹æ³•æŸ¥çœ‹ï¼š<a href="/2025/03/24/elasticsearch-02-install-cluster/" title="linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤">linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤</a></li></ul></li></ul><h2 id="åŸºäºRedisçš„ELKæ¶æ„ç¤ºä¾‹">åŸºäºRedisçš„ELKæ¶æ„ç¤ºä¾‹</h2><h3 id="filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis">filebeatå°†é‡‡é›†çš„æ—¥å¿—å‘é€åˆ°Redis</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>filebeat-nginx-to-redis.yml</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Filebeatå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å› ä¸ºNginxçš„access.logæ—¥å¿—éƒ½æ˜¯ä»¥IPåœ°å€å¼€å¤´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸‹åŒ¹é…å­—æ®µã€‚</span></span><br><span class="line"><span class="comment"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class="line"><span class="attr">filebeat.inputs:</span> <span class="comment"># è¾“å…¥æºé…ç½®</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">log</span> <span class="comment"># æ—¥å¿—ç±»å‹</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¯ç”¨</span></span><br><span class="line">  <span class="attr">paths:</span> <span class="comment"># é‡‡é›†è·¯å¾„</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/nginx/access*.*</span></span><br><span class="line">  <span class="attr">exclude_files:</span> [<span class="string">&quot;.gz$&quot;</span>] <span class="comment"># æ’é™¤ä»¥.gz ç»“å°¾çš„æ–‡ä»¶</span></span><br><span class="line">  <span class="attr">multiline.pattern:</span> <span class="string">&#x27;^\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\s&#x27;</span> <span class="comment"># åŒ¹é…ä»¥IPåœ°å€å¼€å¤´ï¼Œå¹¶ç´§è·Ÿä¸€ä¸ªç©ºç™½å­—ç¬¦</span></span><br><span class="line">  <span class="attr">multiline.negate:</span> <span class="literal">true</span> <span class="comment"># ä¸ä»¥ipåœ°å€å¼€å¤´çš„è¡Œè¿½åŠ åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class="line">  <span class="attr">multiline.match:</span> <span class="string">after</span> <span class="comment"># è¿½åŠ åˆ°ä¸Šä¸€è¡Œçš„åé¢</span></span><br><span class="line">  <span class="comment"># multiline: å¤šè¡Œæ—¥å¿—é…ç½®ï¼Œè¿™é‡Œå®é™…ä¸Šä¸éœ€è¦é…ç½®å¤šè¡Œè®¾ç½®ï¼Œå› ä¸ºnginxçš„accessæ—¥å¿—éƒ½æ˜¯å•è¡Œæ—¥å¿—ï¼Œè¿™é‡Œåªåšæ¼”ç¤º</span></span><br><span class="line">    <span class="comment"># pattern: æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="comment"># negate: falseï¼ŒåŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œï¼›trueï¼Œä¸åŒ¹é…patternçš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œ</span></span><br><span class="line">    <span class="comment"># match: afterï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„æœ«å°¾ï¼›beforeï¼Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œçš„å¼€å¤´</span></span><br><span class="line">  <span class="attr">scan_frequency:</span> <span class="string">10s</span> <span class="comment"># æ¯ 10 ç§’æ‰«æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">  <span class="attr">clean_removed:</span> <span class="literal">true</span> <span class="comment"># åœ¨æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤åæ˜¯å¦ä»å…¶å†…éƒ¨çŠ¶æ€ä¸­ç§»é™¤è¯¥æ–‡ä»¶çš„è®°å½•</span></span><br><span class="line">  <span class="attr">clean_inactive:</span> <span class="string">2h</span> <span class="comment"># åœ¨æ—¥å¿—æ–‡ä»¶å¤„äºéæ´»åŠ¨çŠ¶æ€å¤šé•¿æ—¶é—´åå°†å…¶ä»çŠ¶æ€æ•°æ®åº“ä¸­ç§»,è®¾ç½®ä¸ºæ¯” ignore_older + scan_frequency æ›´å¤§çš„å€¼</span></span><br><span class="line">  <span class="attr">ignore_older:</span> <span class="string">1h</span> <span class="comment"># å¿½ç•¥é‚£äº›æ¯”å½“å‰æ—¶é—´æ—©äº 1 å°æ—¶çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="attr">output.redis:</span> <span class="comment"># Redisè¾“å‡ºé…ç½®</span></span><br><span class="line">  <span class="attr">hosts:</span> [<span class="string">&quot;10.250.0.214:6379&quot;</span>] <span class="comment"># RedisæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;123456&quot;</span> <span class="comment"># Rediså¯†ç </span></span><br><span class="line">  <span class="attr">key:</span> <span class="string">&quot;filebeat_nginx&quot;</span> <span class="comment"># Redisçš„keyï¼Œç±»å‹ä¸º list</span></span><br><span class="line">  <span class="attr">db:</span> <span class="number">3</span> <span class="comment"># Redisæ•°æ®åº“</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">3</span> <span class="comment"># Redisè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨Filebeatï¼Œå¹¶æŸ¥çœ‹æ—¥å¿—è¾“å‡ºã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./filebeat -e -c conf/filebeat-nginx-to-redis.yml</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹Redisä¸­çš„æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -h 10.250.0.214 -p 6379 -a 123456</span><br><span class="line">10.250.0.214:6379&gt; <span class="keyword">select</span> 3</span><br><span class="line">OK</span><br><span class="line">10.250.0.214:6379[3]&gt; keys filebeat*</span><br><span class="line">1) <span class="string">&quot;filebeat_nginx&quot;</span></span><br><span class="line">10.250.0.214:6379[3]&gt; <span class="built_in">type</span> filebeat_nginx</span><br><span class="line">list</span><br><span class="line">10.250.0.214:6379[3]&gt; LLEN filebeat_nginx</span><br><span class="line">(<span class="built_in">integer</span>) 14</span><br><span class="line">10.250.0.214:6379[3]&gt; LINDEX filebeat_nginx 1</span><br><span class="line"><span class="string">&quot;&#123;\&quot;@timestamp\&quot;:\&quot;2025-03-28T09:15:23.402Z\&quot;,\&quot;@metadata\&quot;:&#123;\&quot;beat\&quot;:\&quot;filebeat\&quot;,\&quot;type\&quot;:\&quot;_doc\&quot;,\&quot;version\&quot;:\&quot;8.17.3\&quot;&#125;,\&quot;host\&quot;:&#123;\&quot;name\&quot;:\&quot;ip-10-250-0-239.cn-northwest-1.compute.internal\&quot;&#125;,\&quot;agent\&quot;:&#123;\&quot;version\&quot;:\&quot;8.17.3\&quot;,\&quot;ephemeral_id\&quot;:\&quot;c0a521fe-690b-46b1-aadc-bbe16ef1db9a\&quot;,\&quot;id\&quot;:\&quot;4dbe185b-900d-4990-b841-c13bf9618fc6\&quot;,\&quot;name\&quot;:\&quot;ip-10-250-0-239.cn-northwest-1.compute.internal\&quot;,\&quot;type\&quot;:\&quot;filebeat\&quot;&#125;,\&quot;log\&quot;:&#123;\&quot;offset\&quot;:46745,\&quot;file\&quot;:&#123;\&quot;path\&quot;:\&quot;/var/log/nginx/access.log\&quot;&#125;&#125;,\&quot;message\&quot;:\&quot;1.119.161.30 - elastic [28/Mar/2025:09:15:13 +0000] \\\&quot;GET /_cluster/stats HTTP/1.1\\\&quot; 200 7457 \\\&quot;-\\\&quot; \\\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\\&quot; \\\&quot;-\\\&quot;\&quot;,\&quot;input\&quot;:&#123;\&quot;type\&quot;:\&quot;log\&quot;&#125;,\&quot;ecs\&quot;:&#123;\&quot;version\&quot;:\&quot;8.0.0\&quot;&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Logstashä»Redisä¸­è¯»å–æ—¥å¿—å¹¶å†™å…¥Elasticsearch">Logstashä»Redisä¸­è¯»å–æ—¥å¿—å¹¶å†™å…¥Elasticsearch</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>logstash-nginx-redis-to-es.conf</code>ï¼Œå°†å…¶ä¿å­˜åˆ°Logstashå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸‹ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥logstashå®‰è£…ç›®å½•</span></span><br><span class="line"><span class="comment"># vim logstash-nginx-redis-to-es.conf</span></span><br><span class="line"><span class="comment"># é…ç½®ä» redis æ¥æ”¶æ•°æ®</span></span><br><span class="line">input &#123; <span class="comment"># è¾“å…¥æºé…ç½®</span></span><br><span class="line">    redis &#123; <span class="comment"># Redisè¾“å…¥é…ç½®</span></span><br><span class="line">        host =&gt; <span class="string">&#x27;10.250.0.214&#x27;</span> <span class="comment"># RedisæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">        port =&gt; <span class="string">&quot;6379&quot;</span> <span class="comment"># RedisæœåŠ¡å™¨ç«¯å£</span></span><br><span class="line">        password =&gt; <span class="string">&quot;123456&quot;</span> <span class="comment"># Rediså¯†ç </span></span><br><span class="line">        db =&gt; <span class="string">&quot;3&quot;</span>           <span class="comment"># Redisæ•°æ®åº“</span></span><br><span class="line">        data_type =&gt; <span class="string">&#x27;list&#x27;</span> <span class="comment"># æ•°æ®ç±»å‹ä¸ºlist</span></span><br><span class="line">        key =&gt; <span class="string">&quot;filebeat_nginx&quot;</span>   <span class="comment"># Redisçš„key</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123; <span class="comment"># è¿‡æ»¤å™¨é…ç½®</span></span><br><span class="line">    grok &#123;</span><br><span class="line">        match =&gt; &#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;%&#123;IP:client_ip&#125; - %&#123;USER:remote_user&#125; \[%&#123;HTTPDATE:timestamp&#125;\] \&quot;%&#123;WORD:verb&#125; %&#123;URIPATHPARAM:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\&quot; %&#123;INT:http_status&#125; %&#123;INT:body_bytes_sent&#125; \&quot;%&#123;NOTSPACE:referrer&#125;\&quot; \&quot;%&#123;GREEDYDATA:agent&#125;\&quot; %&#123;QUOTEDSTRING:x_forwarded_for&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mutate &#123;</span><br><span class="line">        enable_metric =&gt; <span class="string">&quot;false&quot;</span> <span class="comment"># ç¦ç”¨æŒ‡æ ‡ä¸ŠæŠ¥</span></span><br><span class="line">        remove_field =&gt; [<span class="string">&quot;message&quot;</span>, <span class="string">&quot;log&quot;</span>, <span class="string">&quot;tags&quot;</span>, <span class="string">&quot;input&quot;</span>, <span class="string">&quot;agent&quot;</span>, <span class="string">&quot;host&quot;</span>, <span class="string">&quot;ecs&quot;</span>, <span class="string">&quot;@version&quot;</span>] <span class="comment"># ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">date</span> &#123;</span><br><span class="line">        match =&gt; [<span class="string">&quot;timestamp&quot;</span>,<span class="string">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span>,<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>] <span class="comment"># æ—¶é—´æ ¼å¼è½¬æ¢</span></span><br><span class="line">        target =&gt; <span class="string">&quot;timestamp&quot;</span> <span class="comment"># ç›®æ ‡å­—æ®µ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è¾“å‡ºé…ç½®ä¸­æ·»åŠ ESè¾“å‡ºé…ç½®</span></span><br><span class="line">output &#123; <span class="comment"># è¾“å‡ºé…ç½®</span></span><br><span class="line">    stdout &#123; <span class="comment"># æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class="line">      codec =&gt; rubydebug <span class="comment"># æŒ‡å®šç¼–ç å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    elasticsearch &#123; <span class="comment"># è¾“å‡ºåˆ°ES</span></span><br><span class="line">        index =&gt; <span class="string">&quot;redis_nginx_access_log_%&#123;+YYYY-MM&#125;&quot;</span> <span class="comment"># ç´¢å¼•å,æŒ‰æœˆåˆ†éš”</span></span><br><span class="line">        hosts =&gt; [<span class="string">&quot;https://10.250.0.239:9200&quot;</span>] <span class="comment"># ESåœ°å€</span></span><br><span class="line">        user =&gt; <span class="string">&quot;elastic&quot;</span>                   <span class="comment"># ESç”¨æˆ·å</span></span><br><span class="line">        password =&gt; <span class="string">&quot;123456&quot;</span>                <span class="comment"># ESå¯†ç </span></span><br><span class="line">        ssl =&gt; <span class="literal">true</span>                         <span class="comment"># æ˜¯å¦å¯ç”¨SSLï¼Œå› ä¸ºè¿™é‡Œæ˜¯httpsè®¿é—®ES</span></span><br><span class="line">        ssl_certificate_verification =&gt; <span class="literal">false</span> <span class="comment"># ç¦ç”¨è¯ä¹¦éªŒè¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµ‹è¯•logstashé…ç½®æ˜¯å¦æ­£ç¡®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/logstash -f config/logstash-nginx-redis-to-es.conf --config.test_and_exit</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨logstash</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reload.automaticï¼šä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½</span></span><br><span class="line">bin/logstash -f config/logstash-nginx-redis-to-es.conf --config.reload.automatic</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…LogStashå’ŒFileBeat&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;é€šè¿‡ç¤ºä¾‹è®²è§£ELKçš„ç»å…¸æ¶æ„å’Œé«˜å¹¶å‘æ¶æ„çš„å®ç°è¿‡ç¨‹&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;LogStashç‰ˆæœ¬8.17.3ï¼ŒFileBeatç‰ˆæœ¬8.17.3&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;Elasticsearchç‰ˆæœ¬8.17.3ï¼Œ&lt;a href=&quot;/2025/03/20/elasticsearch-01-install/&quot; title=&quot;linuxä¸‹å®‰è£…Elasticsearch&quot;&gt;linuxä¸‹å®‰è£…Elasticsearch&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;Kibanaç‰ˆæœ¬8.17.3ï¼Œ&lt;a href=&quot;/2025/03/21/kibana-01-install/&quot; title=&quot;linuxä¸‹å®‰è£…Kibana&quot;&gt;linuxä¸‹å®‰è£…Kibana&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;Elasticsearché›†ç¾¤æ­å»ºï¼Œ&lt;a href=&quot;/2025/03/24/elasticsearch-02-install-cluster/&quot; title=&quot;linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤&quot;&gt;linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="elastic" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/"/>
    
    <category term="kibana" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/kibana/"/>
    
    <category term="logstash" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/kibana/logstash/"/>
    
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/tags/elasticsearch/"/>
    
    <category term="kibana" scheme="https://blog.hanqunfeng.com/tags/kibana/"/>
    
    <category term="logstash" scheme="https://blog.hanqunfeng.com/tags/logstash/"/>
    
  </entry>
  
  <entry>
    <title>linuxä¸‹Elasticsearchæ’ä»¶å®‰è£…</title>
    <link href="https://blog.hanqunfeng.com/2025/03/25/elasticsearch-03-plugins/"/>
    <id>https://blog.hanqunfeng.com/2025/03/25/elasticsearch-03-plugins/</id>
    <published>2025-03-25T13:30:05.000Z</published>
    <updated>2025-03-25T08:23:28.882Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸ºElasticsearchå®‰è£…æ’ä»¶</p></li><li class="lvl-2"><p>Elasticsearchç‰ˆæœ¬8.17.3</p></li></ul><span id="more"></span><h2 id="å®‰è£…Elasticsearchæ ¸å¿ƒåº“æ’ä»¶">å®‰è£…Elasticsearchæ ¸å¿ƒåº“æ’ä»¶</h2><ul class="lvl-0"><li class="lvl-2"><p>ä»¥å®‰è£… <code>analysis-icu</code> è¿™ä¸ªåˆ†è¯æ’ä»¶ä¸ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥Elasticsearchå®‰è£…ç›®å½•ï¼Œæ’ä»¶çš„å®‰è£…è·¯å¾„åœ¨ plugins ç›®å½•ä¸‹</span></span><br><span class="line"><span class="comment"># å®‰è£…æ’ä»¶</span></span><br><span class="line">bin/elasticsearch-plugin install analysis-icu</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…æˆ–å¸è½½æ’ä»¶åï¼Œéœ€è¦é‡å¯ElasticsearchæœåŠ¡</p></li></ul><h2 id="å®‰è£…å…¶å®ƒæ¥æºçš„æ’ä»¶">å®‰è£…å…¶å®ƒæ¥æºçš„æ’ä»¶</h2><ul class="lvl-0"><li class="lvl-2"><p>ä»¥å®‰è£… <code>analysis-ik</code> è¿™ä¸ªä¸­æ–‡åˆ†è¯æ’ä»¶ä¸ºä¾‹</p></li><li class="lvl-2"><p>ä»<a href="https://release.infinilabs.com/analysis-ik/stable/">https://release.infinilabs.com/analysis-ik/stable/</a>æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„æ’ä»¶è¿æ¥ï¼Œè¿™é‡Œä»¥<code>8.17.3</code>ä¸ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åŸºäºurlå®‰è£…æ’ä»¶</span></span><br><span class="line">bin/elasticsearch-plugin install https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-8.17.3.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.åŸºäºæœ¬åœ°æ–‡ä»¶å®‰è£…æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†æ’ä»¶ä¸‹è½½çš„æœ¬åœ°ç›®å½•</span></span><br><span class="line">wget https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-8.17.3.zip -P /tmp/</span><br><span class="line">bin/elasticsearch-plugin install file:///tmp/elasticsearch-analysis-ik-8.17.3.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å¯ä»¥å°†ä¸‹è½½å¥½çš„åŒ…è§£å‹åˆ°pluginsç›®å½•ä¸‹ï¼Œç„¶åé‡å¯ElasticsearchæœåŠ¡</span></span><br><span class="line"><span class="built_in">mkdir</span> /usr/local/elasticsearch/elasticsearch-8.17.3/plugins/analysis-ik</span><br><span class="line">unzip elasticsearch-analysis-ik-8.17.3.zip -d /usr/local/elasticsearch/elasticsearch-8.17.3/plugins/analysis-ik</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å’Œå¸è½½æ’ä»¶">æŸ¥çœ‹å’Œå¸è½½æ’ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰æ’ä»¶</span></span><br><span class="line">bin/elasticsearch-plugin list</span><br><span class="line"><span class="comment"># å¸è½½æ’ä»¶</span></span><br><span class="line">bin/elasticsearch-plugin remove analysis-ik</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡curlå‘½ä»¤æŸ¥çœ‹æ’ä»¶ä¿¡æ¯</span></span><br><span class="line">curl -u elastic:123456 -k https://localhost:9200/_cat/plugins?v</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…æˆ–å¸è½½æ’ä»¶åï¼Œéœ€è¦é‡å¯ElasticsearchæœåŠ¡</p></li></ul><h2 id="analysis-ik-ä¸­æ–‡åˆ†è¯æ’ä»¶çš„ä½¿ç”¨"><code>analysis-ik</code> ä¸­æ–‡åˆ†è¯æ’ä»¶çš„ä½¿ç”¨</h2><ul class="lvl-0"><li class="lvl-2"><p>æµ‹è¯•åˆ†è¯æ•ˆæœ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ESçš„é»˜è®¤åˆ†è¯å™¨æ˜¯standardï¼Œä¼šå•å­—æ‹†åˆ†</span></span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">    <span class="string">&quot;text&quot;</span>: <span class="string">&quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#analysis-ikçš„ik_smartåˆ†è¯å™¨:ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†</span></span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span>,</span><br><span class="line">    <span class="string">&quot;text&quot;</span>: <span class="string">&quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#analysis-ikçš„ik_max_wordåˆ†è¯å™¨:ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†</span></span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">    <span class="string">&quot;text&quot;</span>: <span class="string">&quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®ç´¢å¼•çš„åˆ†è¯å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç´¢å¼•ï¼Œå¹¶æŒ‡å®šé»˜è®¤åˆ†è¯å™¨ä¸ºik_max_word</span></span><br><span class="line">PUT /test_index</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;settings&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;index&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;analysis.analyzer.default.type&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç´¢å¼•settingä¿¡æ¯</span></span><br><span class="line">GET /test_index/_settings</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®ç´¢å¼•å­—æ®µçš„åˆ†è¯å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºç´¢å¼•</span></span><br><span class="line">PUT /index</span><br><span class="line"><span class="comment"># æŒ‡å®šcontentå­—æ®µä½¿ç”¨ikåˆ†è¯å™¨</span></span><br><span class="line">POST /index/_mapping</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;content&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">      <span class="string">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç´¢å¼•æ–‡æ¡£ï¼Œä¹Ÿå°±æ˜¯æ’å…¥æ–‡æ¡£</span></span><br><span class="line">POST /index/_create/1</span><br><span class="line">&#123;<span class="string">&quot;content&quot;</span>:<span class="string">&quot;ç¾å›½ç•™ç»™ä¼Šæ‹‰å…‹çš„æ˜¯ä¸ªçƒ‚æ‘Šå­å—&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">POST /index/_create/2</span><br><span class="line">&#123;<span class="string">&quot;content&quot;</span>:<span class="string">&quot;å…¬å®‰éƒ¨ï¼šå„åœ°æ ¡è½¦å°†äº«æœ€é«˜è·¯æƒ&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">POST /index/_create/3</span><br><span class="line">&#123;<span class="string">&quot;content&quot;</span>:<span class="string">&quot;ä¸­éŸ©æ¸”è­¦å†²çªè°ƒæŸ¥ï¼šéŸ©è­¦å¹³å‡æ¯å¤©æ‰£1è‰˜ä¸­å›½æ¸”èˆ¹&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">POST /index/_create/4</span><br><span class="line">&#123;<span class="string">&quot;content&quot;</span>:<span class="string">&quot;ä¸­å›½é©»æ´›æ‰çŸ¶é¢†äº‹é¦†é­äºšè£”ç”·å­æªå‡» å«ŒçŠ¯å·²è‡ªé¦–&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¸¦é«˜äº®çš„æŸ¥è¯¢</span></span><br><span class="line">POST /index/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;content&quot;</span>: <span class="string">&quot;ä¸­å›½&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;highlight&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;pre_tags&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;&lt;tag1&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;&lt;tag2&gt;&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;post_tags&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;&lt;/tag1&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;&lt;/tag2&gt;&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;fields&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;content&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸ºElasticsearchå®‰è£…æ’ä»¶&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;Elasticsearchç‰ˆæœ¬8.17.3&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="elastic" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/"/>
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/elasticsearch/"/>
    
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤</title>
    <link href="https://blog.hanqunfeng.com/2025/03/24/elasticsearch-02-install-cluster/"/>
    <id>https://blog.hanqunfeng.com/2025/03/24/elasticsearch-02-install-cluster/</id>
    <published>2025-03-24T13:30:05.000Z</published>
    <updated>2025-03-25T10:10:54.922Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤(ä¸‰èŠ‚ç‚¹)</p></li><li class="lvl-2"><p>Elasticsearchç‰ˆæœ¬8.17.3</p></li><li class="lvl-2"><p>å•èŠ‚ç‚¹å®‰è£…å‚è€ƒ<a href="/2025/03/20/elasticsearch-01-install/" title="linuxä¸‹å®‰è£…Elasticsearch">linuxä¸‹å®‰è£…Elasticsearch</a>ï¼Œæœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆé›†ç¾¤å®‰è£…</p></li></ul><span id="more"></span><h2 id="é›†ç¾¤å®‰è£…">é›†ç¾¤å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸‰ä¸ªèŠ‚ç‚¹åˆ†åˆ«å®‰ç…§å•èŠ‚ç‚¹çš„å®‰è£…æ–¹å¼å®Œæˆä¸‹è½½ï¼Œç”¨æˆ·é…ç½®ï¼Œç¯å¢ƒå˜é‡é…ç½®ï¼Œç³»ç»Ÿå‚æ•°é…ç½®ï¼Œç­‰ç­‰ã€‚</p></li><li class="lvl-2"><p>ä»»é€‰ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„masterèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å‘½åä¸º<code>node-1</code>ï¼Œå…¶å®ƒèŠ‚ç‚¹å‘½åä¸º<code>node-2</code>å’Œ<code>node-3</code></p></li><li class="lvl-2"><p>å…ˆé…ç½®<code>node-1</code>èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é›†ç¾¤åç§°</span></span><br><span class="line">cluster.name: test-elk</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°</span></span><br><span class="line">node.name: node-1</span><br><span class="line"><span class="comment"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class="line">path.data: /usr/local/elasticsearch/data</span><br><span class="line"><span class="comment"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class="line">path.logs: /usr/local/elasticsearch/logs</span><br><span class="line"><span class="comment"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class="line">bootstrap.memory_lock: <span class="literal">false</span></span><br><span class="line"><span class="comment"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line"><span class="comment"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class="line">http.port: 9200</span><br><span class="line"><span class="comment"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class="line">transport.port: 9300</span><br><span class="line"><span class="comment"># é›†ç¾¤å†…çš„ä¸»æœºåˆ—è¡¨ï¼Œå¼€å¯å®‰å…¨è®¤è¯æ—¶æ— éœ€é…ç½®ï¼Œæ³¨æ„è¿™é‡Œä¸è¦è¿›è¡Œé…ç½®</span></span><br><span class="line"><span class="comment"># discovery.seed_hosts: [&quot;127.0.0.1&quot;]</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦å‚ä¸é€‰ä¸»çš„èŠ‚ç‚¹åç§°ï¼Œè¿™é‡Œåªé…ç½®node-1</span></span><br><span class="line">cluster.initial_master_nodes: [<span class="string">&quot;node-1&quot;</span>]</span><br><span class="line"><span class="comment">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class="line">http.cors.enabled: <span class="literal">true</span></span><br><span class="line">http.cors.allow-origin: <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®<code>node-2</code>èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é›†ç¾¤åç§°</span></span><br><span class="line">cluster.name: test-elk</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°</span></span><br><span class="line">node.name: node-2</span><br><span class="line"><span class="comment"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class="line">path.data: /usr/local/elasticsearch/data</span><br><span class="line"><span class="comment"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class="line">path.logs: /usr/local/elasticsearch/logs</span><br><span class="line"><span class="comment"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class="line">bootstrap.memory_lock: <span class="literal">false</span></span><br><span class="line"><span class="comment"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line"><span class="comment"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class="line">http.port: 9200</span><br><span class="line"><span class="comment"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class="line">transport.port: 9300</span><br><span class="line"><span class="comment">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class="line">http.cors.enabled: <span class="literal">true</span></span><br><span class="line">http.cors.allow-origin: <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®<code>node-3</code>èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é›†ç¾¤åç§°</span></span><br><span class="line">cluster.name: test-elk</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°</span></span><br><span class="line">node.name: node-3</span><br><span class="line"><span class="comment"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class="line">path.data: /usr/local/elasticsearch/data</span><br><span class="line"><span class="comment"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class="line">path.logs: /usr/local/elasticsearch/logs</span><br><span class="line"><span class="comment"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class="line">bootstrap.memory_lock: <span class="literal">false</span></span><br><span class="line"><span class="comment"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line"><span class="comment"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class="line">http.port: 9200</span><br><span class="line"><span class="comment"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class="line">transport.port: 9300</span><br><span class="line"><span class="comment">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class="line">http.cors.enabled: <span class="literal">true</span></span><br><span class="line">http.cors.allow-origin: <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨<code>node-1</code>ï¼Œå¯åŠ¨æˆåŠŸåæˆ‘ä»¬ä¼šåœ¨æ—¥å¿—ä¸­çœ‹åˆ°å¦‚ä¸‹å®‰å…¨è®¤è¯ä¿¡æ¯ä¿¡æ¯ï¼Œè®°å½•å…¶ä¸­çš„åŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹çš„tokenä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span><br><span class="line"><span class="comment"># è¿™äº›æ—¥å¿—ä¿¡æ¯æä¾›äº† Elasticsearch 8 åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç‰¹æ€§ã€ç”Ÿæˆçš„é»˜è®¤å¯†ç ã€è¯ä¹¦æŒ‡çº¹ä»¥åŠå¦‚ä½•é…ç½® Kibana å’Œå…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¯¦ç»†è¯´æ˜ã€‚</span></span><br><span class="line">âœ… Elasticsearch security features have been automatically configured!</span><br><span class="line">âœ… Authentication is enabled and cluster connections are encrypted.</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ˜¯ elastic ç”¨æˆ·çš„é»˜è®¤å¯†ç ã€‚ç³»ç»Ÿå»ºè®®ä½ ä½¿ç”¨ bin/elasticsearch-reset-password -u elastic å‘½ä»¤æ¥é‡ç½®æ­¤å¯†ç ã€‚</span></span><br><span class="line">â„¹ï¸  Password <span class="keyword">for</span> the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):</span><br><span class="line">  BNb=*qz6_M*mXL9uZiSP <span class="comment"># è¿™é‡Œä¼šæ‰“å°å‡ºESè‡ªåŠ¨ç”Ÿæˆçš„å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ˜¯ HTTP CA è¯ä¹¦çš„ SHA-256 æŒ‡çº¹ã€‚CA è¯ä¹¦ç”¨äºéªŒè¯ HTTPS è¿æ¥çš„èº«ä»½ã€‚</span></span><br><span class="line">â„¹ï¸  HTTP CA certificate SHA-256 fingerprint:</span><br><span class="line">  3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d</span><br><span class="line"></span><br><span class="line"><span class="comment"># æä¾›äº†å°† Kibana é…ç½®ä¸ºä½¿ç”¨æ­¤ Elasticsearch é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class="line">â„¹ï¸  Configure Kibana to use this cluster:</span><br><span class="line"><span class="comment"># å¯åŠ¨ Kibana å¹¶æŒ‰ç…§ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é…ç½®é“¾æ¥è¿›è¡Œæ“ä½œã€‚</span></span><br><span class="line">â€¢ Run Kibana and click the configuration <span class="built_in">link</span> <span class="keyword">in</span> the terminal when Kibana starts.</span><br><span class="line"><span class="comment"># å¤åˆ¶æä¾›çš„æ³¨å†Œä»¤ç‰Œï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Kibana æ—¶ç²˜è´´æ­¤ä»¤ç‰Œã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class="line"><span class="comment"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„kibanaæ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s kibana</span></span><br><span class="line">â€¢ Copy the following enrollment token and <span class="built_in">paste</span> it into Kibana <span class="keyword">in</span> your browser (valid <span class="keyword">for</span> the next 30 minutes):</span><br><span class="line">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImFSWFBzcFVCTVVmc1d5aUJnbjBtOmRzbVBLQV95UXhDZkJpXzQyWDNEMVEifQ==</span><br><span class="line"></span><br><span class="line"><span class="comment"># æä¾›äº†å°†æ–°çš„ Elasticsearch èŠ‚ç‚¹åŠ å…¥ç°æœ‰é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class="line">â„¹ï¸ Configure other nodes to <span class="built_in">join</span> this cluster:</span><br><span class="line"><span class="comment"># ä½¿ç”¨ bin/elasticsearch --enrollment-token &lt;token&gt; å‘½ä»¤å¯åŠ¨æ–°çš„ Elasticsearch èŠ‚ç‚¹ã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class="line"><span class="comment"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s node</span></span><br><span class="line">â€¢ Copy the following enrollment token and start new Elasticsearch nodes with `bin/elasticsearch --enrollment-token &lt;token&gt;` (valid <span class="keyword">for</span> the next 30 minutes):</span><br><span class="line">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImF4WFBzcFVCTVVmc1d5aUJnbjFtOkFEallPdnpzUzh1MGJqOFpfVFE4a3cifQ==</span><br><span class="line"><span class="comment"># å¦‚æœä½ åœ¨ Docker ä¸­è¿è¡Œ Elasticsearchï¼Œå¯ä»¥ä½¿ç”¨ docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3 å‘½ä»¤å¯åŠ¨æ–°èŠ‚ç‚¹ã€‚</span></span><br><span class="line">  If you<span class="string">&#x27;re running in Docker, copy the enrollment token and run:</span></span><br><span class="line"><span class="string">  `docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3`</span></span><br><span class="line"><span class="string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>tokenä¿¡æ¯æœ‰æ•ˆæ—¶é—´åªæœ‰30åˆ†é’Ÿï¼Œè¶…æ—¶åå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆæ–°çš„token</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥node-1èŠ‚ç‚¹çš„ESå®‰è£…ç›®å½•ï¼Œæ­¤å‘½ä»¤ä¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œ</span></span><br><span class="line">bin/elasticsearch-create-enrollment-token -s node</span><br><span class="line">eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6IlpoRVZ4NVVCeXRPajdLeTBqb3BvOmdHRW44ZW5mU0RDZHA2Yy1uSDF4eGcifQ==</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨<code>node-2</code>èŠ‚ç‚¹ï¼Œå¯åŠ¨æ—¶è¦å¸¦ä¸Štokenä¿¡æ¯ï¼Œ<code>node-3</code>ä¸æ­¤ä¸€æ ·ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡åŠ å…¥é›†ç¾¤æ—¶å¯åŠ¨æ‰éœ€è¦å¸¦ä¸Šæ³¨å†Œä»¤ç‰Œï¼Œåç»­å¯åŠ¨ä¸éœ€è¦tokenä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥node-2èŠ‚ç‚¹çš„ESå®‰è£…ç›®å½•ï¼Œæ­¤å‘½ä»¤ä¼šå¯åŠ¨ESèŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥åˆ°é›†ç¾¤ä¸­</span></span><br><span class="line"><span class="comment"># bin/elasticsearch --enrollment-token &lt;token&gt;</span></span><br><span class="line">bin/elasticsearch --enrollment-token eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6IlpoRVZ4NVVCeXRPajdLeTBqb3BvOmdHRW44ZW5mU0RDZHA2Yy1uSDF4eGcifQ==</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>åŠ å…¥é›†ç¾¤å¤±è´¥</strong></em></p><ul class="lvl-1"><li class="lvl-2">åœ¨æ‰§è¡Œ<code>bin/elasticsearch --enrollment-token &lt;token&gt;</code>æ—¶æœ‰å¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹å¼‚å¸¸ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Aborting auto configuration because the node keystore contains password settings already, with <span class="built_in">exit</span> code 78</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">è¿™é€šå¸¸æ„å‘³ç€èŠ‚ç‚¹çš„ <code>keystore</code> å·²ç»åŒ…å«äº†å¯†ç è®¾ç½®ï¼Œå› æ­¤è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¢«ä¸­æ­¢ã€‚</li><li class="lvl-2">äº§ç”Ÿè¿™ç§é”™è¯¯çš„åŸå› å¤§æ¦‚ç‡æ˜¯å½“å‰ESæ˜¯ä»å·²ç»å®‰è£…å¥½çš„æœåŠ¡å™¨ä¸Šæ‹·è´è¿‡æ¥çš„ï¼Œè€Œä¸æ˜¯å…¨æ–°å®‰è£…çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬é™¤äº†éœ€è¦æ¸…ç©º<code>data</code>ç›®å½•å¤–ï¼Œè¿˜éœ€è¦åˆ é™¤ <code>keystore</code> ä¸­çš„å¯†ç </li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹keystoreä¸­çš„å¯†ç </span></span><br><span class="line">$ bin/elasticsearch-keystore list</span><br><span class="line">keystore.seed</span><br><span class="line">xpack.security.http.ssl.keystore.secure_password</span><br><span class="line">xpack.security.transport.ssl.keystore.secure_password</span><br><span class="line">xpack.security.transport.ssl.truststore.secure_password</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤keystoreä¸­çš„å¯†ç </span></span><br><span class="line">$ bin/elasticsearch-keystore remove xpack.security.http.ssl.keystore.secure_password</span><br><span class="line">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.keystore.secure_password</span><br><span class="line">$ bin/elasticsearch-keystore remove xpack.security.transport.ssl.truststore.secure_password</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2"><p>å†æ¬¡æ‰§è¡Œ<code>bin/elasticsearch --enrollment-token &lt;token&gt;</code>å³å¯ã€‚</p></li><li class="lvl-2"><p>å¦å¤–è¿˜å¯èƒ½é‡åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Aborting enrolling to cluster. Could not communicate with the node on any of the addresses from the enrollment token. All of [10.250.0.239:9200] were attempted., with <span class="built_in">exit</span> code 69</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">è¿™æ˜¯ç”±äºtokenè¿‡æœŸäº†ï¼Œé‡æ–°ç”Ÿæˆæ–°çš„tokenå³å¯</li></ul></div><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨æˆåŠŸåä¼šåœ¨<code>node-2</code>çš„é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°å¦‚ä¸‹é…ç½®ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The following settings, TLS certificates, and keys have been automatically</span></span><br><span class="line"><span class="comment"># generated to configure Elasticsearch security features on 24-03-2025 07:45:11</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># --------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable security features</span></span><br><span class="line">xpack.security.enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">xpack.security.enrollment.enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents</span></span><br><span class="line">xpack.security.http.ssl:</span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  keystore.path: certs/http.p12</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable encryption and mutual authentication between cluster nodes</span></span><br><span class="line">xpack.security.transport.ssl:</span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  verification_mode: certificate</span><br><span class="line">  keystore.path: certs/transport.p12</span><br><span class="line">  truststore.path: certs/transport.p12</span><br><span class="line"><span class="comment"># Discover existing nodes in the cluster</span></span><br><span class="line">discovery.seed_hosts: [<span class="string">&quot;10.250.0.239:9300&quot;</span>] <span class="comment"># è¿™é‡Œæ˜¯node-1èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## è€Œnode-3è¿™é‡Œä¼šæ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¶Šæ˜¯åæ¥åŠ å…¥è¿›æ¥çš„ï¼Œè¿™é‡Œå°±ä¼šåŠ ä¸Šä¹‹å‰æ‰€æœ‰èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·</span></span><br><span class="line">discovery.seed_hosts: [<span class="string">&quot;10.250.0.239:9300&quot;</span>, <span class="string">&quot;10.250.0.17:9300&quot;</span>] <span class="comment"># è¿™é‡Œæ˜¯node-1å’Œnode-2èŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------- END SECURITY AUTO CONFIGURATION -------------------------</span></span><br></pre></td></tr></table></figure><h2 id="éªŒè¯é›†ç¾¤çŠ¶æ€">éªŒè¯é›†ç¾¤çŠ¶æ€</h2><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨å®Œæˆåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</span></span><br><span class="line">$ curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt  https://127.0.0.1:9200/_cluster/health?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;test-elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;status&quot;</span> : <span class="string">&quot;green&quot;</span>,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;number_of_nodes&quot;</span> : 3,</span><br><span class="line">  <span class="string">&quot;number_of_data_nodes&quot;</span> : 3,</span><br><span class="line">  <span class="string">&quot;active_primary_shards&quot;</span> : 31,</span><br><span class="line">  <span class="string">&quot;active_shards&quot;</span> : 62,</span><br><span class="line">  <span class="string">&quot;relocating_shards&quot;</span> : 0,</span><br><span class="line">  <span class="string">&quot;initializing_shards&quot;</span> : 0,</span><br><span class="line">  <span class="string">&quot;unassigned_shards&quot;</span> : 0,</span><br><span class="line">  <span class="string">&quot;unassigned_primary_shards&quot;</span> : 0,</span><br><span class="line">  <span class="string">&quot;delayed_unassigned_shards&quot;</span> : 0,</span><br><span class="line">  <span class="string">&quot;number_of_pending_tasks&quot;</span> : 0,</span><br><span class="line">  <span class="string">&quot;number_of_in_flight_fetch&quot;</span> : 0,</span><br><span class="line">  <span class="string">&quot;task_max_waiting_in_queue_millis&quot;</span> : 0,</span><br><span class="line">  <span class="string">&quot;active_shards_percent_as_number&quot;</span> : 100.0</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼Œå…¶ä¸­ * è¡¨ç¤ºå½“å‰èŠ‚ç‚¹ä¸ºmasterèŠ‚ç‚¹</span></span><br><span class="line">$ curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt  https://127.0.0.1:9200/_cat/nodes?v</span><br><span class="line">ip           heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span><br><span class="line">10.250.0.17             8          63  28    1.03    0.38     0.14 cdfhilmrstw -      node-2</span><br><span class="line">10.250.0.173            9          63  22    0.86    0.37     0.19 cdfhilmrstw -      node-3</span><br><span class="line">10.250.0.239            9          78   6    0.38    0.22     0.16 cdfhilmrstw *      node-1</span><br></pre></td></tr></table></figure><h2 id="é‡è¦è¯´æ˜">é‡è¦è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p>é›†ç¾¤ä¸€æ—¦åˆ›å»ºå®Œæˆï¼Œåˆ™è‡³å°‘éœ€è¦ä¸¤ä¸ªèŠ‚ç‚¹è¿è¡Œæ‰èƒ½ä¿è¯é›†ç¾¤å¯ç”¨æ€§ï¼Œå¦åˆ™é›†ç¾¤å°†æ— æ³•è¿è¡Œã€‚</p></li><li class="lvl-2"><p>å¦‚æœ<code>node-1</code>èŠ‚ç‚¹æŒ‚äº†ï¼Œé›†ç¾¤ä¸­å‰©ä¸‹çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªæ–°çš„<code>master</code>èŠ‚ç‚¹ï¼Œä¸ä¼šå½±å“é›†ç¾¤çš„å¯ç”¨æ€§ã€‚</p></li><li class="lvl-2"><p>ä¸€æ—¦å…³é—­<code>node-1</code>ï¼Œåˆ™é‡æ–°å¯åŠ¨<code>node-1</code>èŠ‚ç‚¹å‰è¦ä¿®æ”¹å…¶é…ç½®æ–‡ä»¶ï¼Œå¦åˆ™æ— æ³•å¯åŠ¨æˆåŠŸã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨é‡Šæ‰è¯¥é…ç½®</span></span><br><span class="line"><span class="comment"># cluster.initial_master_nodes: [&quot;node-1&quot;]</span></span><br><span class="line"><span class="comment"># åŠ å…¥è¯¥é…ç½®ï¼Œå®é™…ä¸Šæœ€å¥½åœ¨é‡å¯æ¯ä¸ªèŠ‚ç‚¹å‰ï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹éƒ½é…ç½®ä¸ºè¿™æ ·</span></span><br><span class="line">discovery.seed_hosts: [<span class="string">&quot;10.250.0.239:9300&quot;</span>, <span class="string">&quot;10.250.0.17:9300&quot;</span>, <span class="string">&quot;10.250.0.173:9300&quot;</span>]</span><br></pre></td></tr></table></figure><h2 id="Kibanaå…³è”ESé›†ç¾¤">Kibanaå…³è”ESé›†ç¾¤</h2><ul class="lvl-0"><li class="lvl-2"><p>Kibana å…³è”å•èŠ‚ç‚¹ESå‚è€ƒ <a href="/2025/03/21/kibana-01-install/" title="linuxä¸‹å®‰è£…Kibana">linuxä¸‹å®‰è£…Kibana</a>ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯¹é…ç½®æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³è”é›†ç¾¤çš„èŠ‚ç‚¹åœ°å€ï¼Œå°†é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€éƒ½é…ç½®åˆ°è¯¥å­—æ®µä¸­</span></span><br><span class="line">elasticsearch.hosts: [<span class="string">&#x27;https://10.250.0.239:9200&#x27;</span>, <span class="string">&#x27;https://10.250.0.173:9200&#x27;</span>, <span class="string">&#x27;https://10.250.0.17:9200&#x27;</span>]</span><br><span class="line"><span class="comment"># å…³è”é›†ç¾¤çš„è¾“å‡ºåœ°å€ï¼Œå°†é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€éƒ½é…ç½®åˆ°è¯¥å­—æ®µä¸­</span></span><br><span class="line">xpack.fleet.outputs: [&#123;<span class="built_in">id</span>: fleet-default-output, name: default, is_default: <span class="literal">true</span>, is_default_monitoring: <span class="literal">true</span>, <span class="built_in">type</span>: elasticsearch, hosts: [<span class="string">&#x27;https://10.250.0.239:9200&#x27;</span>, <span class="string">&#x27;https://10.250.0.173:9200&#x27;</span>, <span class="string">&#x27;https://10.250.0.17:9200&#x27;</span>], ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d&#125;]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡å¯Kibana</p></li><li class="lvl-2"><p>åªè¦ä¿è¯é›†ç¾¤å†…è‡³å°‘æœ‰ä¸¤ä¸ªESèŠ‚ç‚¹å·¥ä½œæ­£å¸¸ï¼Œå³å¯æ­£å¸¸è®¿é—®Kibana</p></li></ul><h2 id="nginxåå‘ä»£ç†ESé›†ç¾¤">nginxåå‘ä»£ç†ESé›†ç¾¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/es.conf <span class="comment"># æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class="line">upstream es &#123;</span><br><span class="line">    server 10.250.0.239:9200;</span><br><span class="line">    server 10.250.0.173:9200;</span><br><span class="line">    server 10.250.0.17:9200;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen       8888;</span><br><span class="line">        server_name  localhost es.domain;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass https://es; <span class="comment">#è¿™ä¸ªåç§°å’Œè¦ä¸Šé¢ upstream es å¯¹åº”ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ https åè®®</span></span><br><span class="line">            proxy_redirect     default;</span><br><span class="line">            proxy_http_version 1.1;</span><br><span class="line"></span><br><span class="line">            proxy_set_header   Host              <span class="variable">$host</span>;</span><br><span class="line">            proxy_set_header   X-Real-IP         <span class="variable">$remote_addr</span>;</span><br><span class="line">            proxy_set_header   X-Forwarded-For   <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">            proxy_set_header   X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">            proxy_max_temp_file_size 0;</span><br><span class="line"></span><br><span class="line">            <span class="comment">#this is the maximum upload size</span></span><br><span class="line">            client_max_body_size       10m;</span><br><span class="line">            client_body_buffer_size    128k;</span><br><span class="line"></span><br><span class="line">            proxy_connect_timeout      90;</span><br><span class="line">            proxy_send_timeout         90;</span><br><span class="line">            proxy_read_timeout         90;</span><br><span class="line">            proxy_buffering            off;</span><br><span class="line">            proxy_request_buffering    off; <span class="comment"># Required for HTTP CLI commands</span></span><br><span class="line">            proxy_set_header Connection <span class="string">&quot;&quot;</span>; <span class="comment"># Clear for keepalive</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯nginx</span></span><br><span class="line">systemctl restart nginx</span><br><span class="line"><span class="comment"># è®¿é—®ESé›†ç¾¤</span></span><br><span class="line">curl -u elastic:123456 http://127.0.0.1:8888/_cluster/health?pretty</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearché›†ç¾¤(ä¸‰èŠ‚ç‚¹)&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;Elasticsearchç‰ˆæœ¬8.17.3&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;å•èŠ‚ç‚¹å®‰è£…å‚è€ƒ&lt;a href=&quot;/2025/03/20/elasticsearch-01-install/&quot; title=&quot;linuxä¸‹å®‰è£…Elasticsearch&quot;&gt;linuxä¸‹å®‰è£…Elasticsearch&lt;/a&gt;ï¼Œæœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆé›†ç¾¤å®‰è£…&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="elastic" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/"/>
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/elasticsearch/"/>
    
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>linuxä¸‹å®‰è£…Kibana</title>
    <link href="https://blog.hanqunfeng.com/2025/03/21/kibana-01-install/"/>
    <id>https://blog.hanqunfeng.com/2025/03/21/kibana-01-install/</id>
    <published>2025-03-21T13:30:05.000Z</published>
    <updated>2025-04-22T02:38:15.404Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Kibana</p></li><li class="lvl-2"><p>Kibanaç‰ˆæœ¬8.17.3</p></li><li class="lvl-2"><p>Elasticsearchç‰ˆæœ¬8.17.3ï¼Œ<a href="/2025/03/20/elasticsearch-01-install/" title="linuxä¸‹å®‰è£…Elasticsearch">linuxä¸‹å®‰è£…Elasticsearch</a></p></li></ul><span id="more"></span><h2 id="ä¸‹è½½">ä¸‹è½½</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.elastic.co/cn/downloads/past-releases#kibana">https://www.elastic.co/cn/downloads/past-releases#kibana</a></p></li><li class="lvl-2"><p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>Kibana 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/kibana/kibana-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/kibana</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/local/kibana</span><br><span class="line">tar -zxvf kibana-8.17.3-linux-x86_64.tar.gz -C /usr/local/kibana</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºå¯åŠ¨ç”¨æˆ·">åˆ›å»ºå¯åŠ¨ç”¨æˆ·</h2><ul class="lvl-0"><li class="lvl-2"><p>elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨</p></li><li class="lvl-2"><p>åˆ›å»ºç”¨æˆ·<code>elastic</code>ï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬åœ¨å®‰è£…elasticsearchçš„æ—¶å€™å·²ç»é…ç½®è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd elastic</span><br><span class="line">passwd elastic</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹kibanaå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R elastic:elastic /usr/local/kibana</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ‡æ¢åˆ°elasticç”¨æˆ·ä¸‹æ‰§è¡Œå‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su - elastic</span><br></pre></td></tr></table></figure><h2 id="å…³è”Kibanaå’ŒElasticsearch">å…³è”Kibanaå’ŒElasticsearch</h2><h3 id="æ–¹æ³•1ï¼šæ³¨å†Œä»¤ç‰ŒTokenå…³è”-å®˜æ–¹æ¨è">æ–¹æ³•1ï¼šæ³¨å†Œä»¤ç‰ŒTokenå…³è”[å®˜æ–¹æ¨è]</h3><ul class="lvl-0"><li class="lvl-2"><p>æ³¨æ„æ­¤æ–¹æ³•è¦æ±‚<code>elasticsearch</code>å¿…é¡»å¼€å¯å®‰å…¨è®¤è¯ï¼Œè€Œä¸”<code>xpack.security.http.ssl.enabled</code> å¿…é¡»è®¾ç½®ä¸º true</p></li><li class="lvl-2"><p>é…ç½®å¯åŠ¨æ–‡ä»¶ï¼Œè¿›å…¥<code>/usr/local/kibana/kibana-8.17.3/config</code>ç›®å½•ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹<code>kibana.yml</code>æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç«¯å£ï¼Œé»˜è®¤5601</span></span><br><span class="line">server.port: 5601</span><br><span class="line"><span class="comment"># kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®ï¼Œé»˜è®¤ä¸ºlocalhost</span></span><br><span class="line">server.host: <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="comment"># ä¸­æ–‡ï¼Œé»˜è®¤ä¸º en</span></span><br><span class="line">i18n.locale: <span class="string">&quot;zh-CN&quot;</span></span><br><span class="line"><span class="comment"># é…ç½®httpsï¼Œé»˜è®¤å€¼ä¸º certificate</span></span><br><span class="line">elasticsearch.ssl.verificationMode: <span class="string">&#x27;certificate&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿˜è®°å¾—æˆ‘ä»¬ç¬¬ä¸€æ¬¡å¯åŠ¨ESæ—¶æ—¥å¿—ä¿¡æ¯ä¸­çš„æœ‰å…³kibanaæ³¨å†Œä»¤ç‰Œçš„ä¿¡æ¯å—ï¼Ÿé‚£ä¸ªä»¤ç‰Œåªæœ‰30åˆ†é’Ÿæœ‰æ•ˆæœŸï¼Œè¿‡æœŸåå¯ä»¥è¿›å…¥elasticsearchå®‰è£…ç›®å½•ï¼Œé‡æ–°åˆ›å»ºkibanaæ³¨å†Œä»¤ç‰Œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/elasticsearch-create-enrollment-token -s kibana</span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœå¦‚ä¸‹</span></span><br><span class="line">eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImxlTWh1SlVCcVJWQUw4WGFjMk1HOkVHYTYxcWlfVEotQWQ1Y3dQdXcyckEifQ==</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿›å…¥kibanaå®‰è£…ç›®å½•ï¼Œé€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ³¨å†Œ Kibana</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bin/kibana-setup --enrollment-token &lt;enrollment-token&gt;</span></span><br><span class="line">bin/kibana-setup --enrollment-token eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImxlTWh1SlVCcVJWQUw4WGFjMk1HOkVHYTYxcWlfVEotQWQ1Y3dQdXcyckEifQ==</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨å†ŒæˆåŠŸä¼šè¾“å‡º</span></span><br><span class="line">âœ” Kibana configured successfully.</span><br></pre></td></tr></table></figure><div class="tips"><ul class="lvl-1"><li class="lvl-2"><p>å¦‚æœESçš„<code>xpack.security.http.ssl.enabled</code> è®¾ç½®ä¸º falseï¼Œæ³¨å†ŒKibanaæ—¶ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ– Unable to connect to Elasticsearch with the provided enrollment token: Unable to connect to any of the provided hosts.</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">æ³¨å†ŒæˆåŠŸåä¼šåœ¨<code>/usr/local/kibana/kibana-8.17.3/config/kibana.yml</code>æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This section was automatically generated during setup.</span></span><br><span class="line"><span class="comment"># ESæœåŠ¡URL</span></span><br><span class="line">elasticsearch.hosts: [<span class="string">&#x27;https://10.250.0.239:9200&#x27;</span>] <span class="comment"># 10.250.0.239æ˜¯æœ¬æœºçš„å†…ç½‘IP</span></span><br><span class="line"><span class="comment"># æŒ‡å®šç”¨äºè®¤è¯çš„æœåŠ¡è´¦æˆ·ä»¤ç‰Œ</span></span><br><span class="line">elasticsearch.serviceAccountToken: AAEAAWVsYXN0aWMva2liYW5hL2Vucm9sbC1wcm9jZXNzLXRva2VuLTE3NDI1NTA5ODU0MTg6Z2lJUERGaG1TR3VNcC1sb0RyMnMydw</span><br><span class="line"><span class="comment"># æŒ‡å®šç”¨æ¥éªŒè¯ Elasticsearch æœåŠ¡å™¨ SSL è¯ä¹¦çš„ CA è¯ä¹¦è·¯å¾„</span></span><br><span class="line">elasticsearch.ssl.certificateAuthorities: [/usr/local/kibana/kibana-8.17.3/data/ca_1742550986498.crt]</span><br><span class="line"><span class="comment"># é…ç½® Fleet çš„è¾“å‡ºç›®æ ‡ã€‚Fleet æ˜¯ Elastic çš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†å’Œç›‘æ§å¼¹æ€§æ ˆï¼ˆElastic Stackï¼‰ã€‚è¿™ä¸ªé…ç½®å®šä¹‰äº† Fleet é»˜è®¤è¾“å‡ºçš„ç›®æ ‡ï¼Œå³ Elasticsearchã€‚</span></span><br><span class="line">xpack.fleet.outputs: [&#123;<span class="built_in">id</span>: fleet-default-output, name: default, is_default: <span class="literal">true</span>, is_default_monitoring: <span class="literal">true</span>, <span class="built_in">type</span>: elasticsearch, hosts: [<span class="string">&#x27;https://10.250.0.239:9200&#x27;</span>], ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d&#125;]</span><br><span class="line">  <span class="comment"># id: fleet-default-outputï¼šè¾“å‡ºçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</span></span><br><span class="line">  <span class="comment"># name: defaultï¼šè¾“å‡ºçš„åç§°ã€‚</span></span><br><span class="line">  <span class="comment"># is_default: trueï¼šè¡¨ç¤ºè¿™æ˜¯é»˜è®¤è¾“å‡ºã€‚</span></span><br><span class="line">  <span class="comment"># is_default_monitoring: trueï¼šè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ç›‘æ§è¾“å‡ºã€‚</span></span><br><span class="line">  <span class="comment"># type: elasticsearchï¼šè¾“å‡ºç±»å‹æ˜¯ Elasticsearchã€‚</span></span><br><span class="line">  <span class="comment"># hosts: [&#x27;https://10.250.0.239:9200&#x27;]ï¼šè¿æ¥åˆ°çš„ Elasticsearch ä¸»æœºåœ°å€ã€‚</span></span><br><span class="line">  <span class="comment"># ca_trusted_fingerprint: 3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1dï¼šCA è¯ä¹¦çš„ä¿¡ä»»æŒ‡çº¹ï¼Œç”¨äºéªŒè¯ CA è¯ä¹¦çš„èº«ä»½ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•2ï¼šç”¨æˆ·åå¯†ç å…³è”">æ–¹æ³•2ï¼šç”¨æˆ·åå¯†ç å…³è”</h3><ul class="lvl-1"><li class="lvl-2"><p>åˆ›å»ºkibanaè¿æ¥elasticsearchçš„ç”¨æˆ·å¯†ç ï¼Œä¸èƒ½ç”¨ <code>elastic</code> è¿™ä¸ªç”¨æˆ·ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯è¶…çº§ç”¨æˆ·ï¼Œè¦ä½¿ç”¨ kibana_system ç”¨æˆ·</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥elasticsearchå®‰è£…ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤é‡ç½® kibana_system ç”¨æˆ·çš„å¯†ç </span></span><br><span class="line">bin/elasticsearch-reset-password -u kibana_system -i</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2"><p>é…ç½®å¯åŠ¨æ–‡ä»¶ï¼Œè¿›å…¥<code>/usr/local/kibana/kibana-8.17.3/config</code>ç›®å½•ï¼Œä¿®æ”¹<code>kibana.yml</code>æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç«¯å£ï¼Œé»˜è®¤5601</span></span><br><span class="line">server.port: 5601</span><br><span class="line"><span class="comment"># kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®</span></span><br><span class="line">server.host: <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># elasctisearchå…³è”</span></span><br><span class="line"><span class="comment"># ESæœåŠ¡åœ°å€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯https</span></span><br><span class="line">elasticsearch.hosts: [<span class="string">&quot;https://10.250.0.239:9200&quot;</span>]</span><br><span class="line"><span class="comment"># æŒ‡å®šhttpsè¯ä¹¦è·¯å¾„ï¼Œå¯ä»¥ä»ESçš„è¯ä¹¦ç›®å½•ä¸­è·å–</span></span><br><span class="line">elasticsearch.ssl.certificateAuthorities: [<span class="string">&quot;/usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt&quot;</span>]</span><br><span class="line"><span class="comment"># ç”¨æˆ·åå¯†ç </span></span><br><span class="line">elasticsearch.username: <span class="string">&quot;kibana_system&quot;</span></span><br><span class="line">elasticsearch.password: <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="comment"># ä¸­æ–‡</span></span><br><span class="line">i18n.locale: <span class="string">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2"><p>å¦‚æœESæ²¡æœ‰å¼€å¯å®‰å…¨è®¤è¯ï¼Œåˆ™åªéœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®å³å¯ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç«¯å£ï¼Œé»˜è®¤5601</span></span><br><span class="line">server.port: 5601</span><br><span class="line"><span class="comment"># kibanaæœåŠ¡å™¨çš„ipï¼Œ4ä¸ª0è¡¨ç¤ºä»»ä½•ä¸€ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®</span></span><br><span class="line">server.host: <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="comment"># ESæœåŠ¡åœ°å€ï¼Œæ³¨æ„è¿™é‡Œæ˜¯http</span></span><br><span class="line">elasticsearch.hosts: [<span class="string">&quot;http://10.250.0.239:9200&quot;</span>]</span><br><span class="line"><span class="comment"># ä¸­æ–‡</span></span><br><span class="line">i18n.locale: <span class="string">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure></div><h2 id="å¯åŠ¨KibanaæœåŠ¡">å¯åŠ¨KibanaæœåŠ¡</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿›å…¥<code>/usr/local/kibana/kibana-8.17.3</code>ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/kibana</span><br><span class="line"><span class="comment"># åå°å¯åŠ¨ï¼Œå¹¶å°†æ—¥å¿—å†™å…¥åˆ°logs/kibana.log</span></span><br><span class="line"><span class="built_in">nohup</span> bin/kibana &gt; logs/kibana.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è®¿é—®åœ°å€ï¼š<a href="http://localhost:5601">http://localhost:5601</a>ï¼Œè¿™é‡Œæ³¨æ„ç™»å½•ç”¨æˆ·éœ€è¦ä½¿ç”¨ï¼š<code>elastic</code>ï¼Œè€Œä¸æ˜¯<code>kibana_system</code>ã€‚</p></li></ul><h2 id="å¯åŠ¨KibanaæœåŠ¡åçš„æ—¥å¿—å‘Šè­¦">å¯åŠ¨KibanaæœåŠ¡åçš„æ—¥å¿—å‘Šè­¦</h2><ul class="lvl-0"><li class="lvl-2"><p>KibanaæœåŠ¡å¯åŠ¨åï¼Œä¼šåœ¨<code>/usr/local/kibana/kibana-8.17.3/logs/kibana.log</code>æ–‡ä»¶ä¸­è®°å½•ä¸€äº›é”™è¯¯æ—¥å¿—ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—ï¼Œè§£å†³é”™è¯¯ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[WARN ][plugins.fleet] xpack.encryptedSavedObjects.encryptionKey is not configured, private key passphrase is being stored <span class="keyword">in</span> plain text</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™ä¸ªè­¦å‘Šä¿¡æ¯è¡¨æ˜ Kibana çš„æŸäº›æ’ä»¶ï¼ˆå¦‚ Fleetï¼‰åœ¨ç¼ºå°‘ <code>xpack.encryptedSavedObjects.encryptionKey</code> é…ç½®çš„æƒ…å†µä¸‹è¿è¡Œï¼Œå¯¼è‡´ç§é’¥å¯†ç å’Œä»£ç†å¸è½½ä»¤ç‰Œä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ã€‚ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œå»ºè®®é…ç½®ä¸€ä¸ªåŠ å¯†å¯†é’¥ã€‚</p></li><li class="lvl-2"><p>ç”ŸæˆåŠ å¯†å¯†é’¥</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ bin/kibana-encryption-keys generate</span><br><span class="line">Kibana is currently running with legacy OpenSSL providers enabled! For details and instructions on how to <span class="built_in">disable</span> see https://www.elastic.co/guide/en/kibana/8.17/production.html#openssl-legacy-provider</span><br><span class="line"><span class="comment">## Kibana Encryption Key Generation Utility</span></span><br><span class="line"></span><br><span class="line">The <span class="string">&#x27;generate&#x27;</span> <span class="built_in">command</span> guides you through the process of setting encryption keys <span class="keyword">for</span>:</span><br><span class="line"></span><br><span class="line">xpack.encryptedSavedObjects.encryptionKey</span><br><span class="line">    Used to encrypt stored objects such as dashboards and visualizations</span><br><span class="line">    https://www.elastic.co/guide/en/kibana/current/xpack-security-secure-saved-objects.html#xpack-security-secure-saved-objects</span><br><span class="line"></span><br><span class="line">xpack.reporting.encryptionKey</span><br><span class="line">    Used to encrypt saved reports</span><br><span class="line">    https://www.elastic.co/guide/en/kibana/current/reporting-settings-kb.html#general-reporting-settings</span><br><span class="line"></span><br><span class="line">xpack.security.encryptionKey</span><br><span class="line">    Used to encrypt session information</span><br><span class="line">    https://www.elastic.co/guide/en/kibana/current/security-settings-kb.html#security-session-and-cookie-settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Already defined settings are ignored and can be regenerated using the --force flag.  Check the documentation links <span class="keyword">for</span> instructions on how to rotate encryption keys.</span><br><span class="line">Definitions should be <span class="built_in">set</span> <span class="keyword">in</span> the kibana.yml used configure Kibana.</span><br><span class="line"></span><br><span class="line">Settings:</span><br><span class="line">xpack.encryptedSavedObjects.encryptionKey: 47967e4b78bd26decb622b78f0ddd324</span><br><span class="line">xpack.reporting.encryptionKey: 78b5f603f3b0e6ad76c13a0f5d00cde0</span><br><span class="line">xpack.security.encryptionKey: 8aa7f4dfbc4e734a2a9f92a2730b36af</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é…ç½® Kibana ä»¥ä½¿ç”¨åŠ å¯†å¯†é’¥ï¼Œæ·»åŠ åˆ° kibana.yml æ–‡ä»¶ä¸­ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xpack.encryptedSavedObjects.encryptionKey: 47967e4b78bd26decb622b78f0ddd324</span><br><span class="line">xpack.reporting.encryptionKey: 78b5f603f3b0e6ad76c13a0f5d00cde0</span><br><span class="line">xpack.security.encryptionKey: 8aa7f4dfbc4e734a2a9f92a2730b36af</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡å¯ Kibana æœåŠ¡ ä»¥åº”ç”¨æ›´æ”¹ã€‚</p></li></ul><h2 id="Kibana-è‡ªå¯åŠ¨è„šæœ¬">Kibana è‡ªå¯åŠ¨è„šæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæœåŠ¡æ–‡ä»¶</span></span><br><span class="line">$ vim /usr/lib/systemd/system/kibana.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=kibana</span><br><span class="line">Documentation=https://www.elastic.co</span><br><span class="line">After=es.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line"><span class="comment"># æŒ‡å®šESç”¨æˆ·</span></span><br><span class="line">User=elastic</span><br><span class="line">Group=elastic</span><br><span class="line">LimitNOFILE=100000</span><br><span class="line">LimitNPROC=100000</span><br><span class="line">Restart=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">ExecStart=/usr/local/kibana/kibana-8.17.3/bin/kibana</span><br><span class="line">ExecRestart=/bin/kill -s HUP <span class="variable">$MAINPID</span></span><br><span class="line">ExecStop=/bin/kill -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½</span></span><br><span class="line">$ systemctl daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">$ systemctl start kibana</span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">$ systemctl stop kibana</span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">$ systemctl status kibana</span><br><span class="line"><span class="comment"># è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br><span class="line">$ systemctl <span class="built_in">enable</span> kibana</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Kibana&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;Kibanaç‰ˆæœ¬8.17.3&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;Elasticsearchç‰ˆæœ¬8.17.3ï¼Œ&lt;a href=&quot;/2025/03/20/elasticsearch-01-install/&quot; title=&quot;linuxä¸‹å®‰è£…Elasticsearch&quot;&gt;linuxä¸‹å®‰è£…Elasticsearch&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="elastic" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/"/>
    
    <category term="kibana" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/kibana/"/>
    
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/tags/elasticsearch/"/>
    
    <category term="kibana" scheme="https://blog.hanqunfeng.com/tags/kibana/"/>
    
  </entry>
  
  <entry>
    <title>linuxä¸‹å®‰è£…Elasticsearch</title>
    <link href="https://blog.hanqunfeng.com/2025/03/20/elasticsearch-01-install/"/>
    <id>https://blog.hanqunfeng.com/2025/03/20/elasticsearch-01-install/</id>
    <published>2025-03-20T13:30:05.000Z</published>
    <updated>2025-04-21T09:22:28.281Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearch</p></li><li class="lvl-2"><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.17/index.html">Elasticsearch</a>ç‰ˆæœ¬8.17.3</p></li></ul><span id="more"></span><h2 id="ä¸‹è½½">ä¸‹è½½</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch">https://www.elastic.co/cn/downloads/past-releases#elasticsearch</a></p></li><li class="lvl-2"><p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼šè¿™é‡Œé€‰æ‹©å½“å‰çš„æœ€æ–°ç‰ˆ<code>Elasticsearch 8.17.3</code>ï¼Œä¹‹åé€‰æ‹©å¯¹åº”çš„æ“ä½œç³»ç»Ÿ<code>LINUX X86_64</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°<code>/usr/local/elasticsearch</code>ç›®å½•ä¸‹ï¼Œè§£å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/local/elasticsearch</span><br><span class="line">tar -zxvf elasticsearch-8.17.3-linux-x86_64.tar.gz -C /usr/local/elasticsearch</span><br></pre></td></tr></table></figure><h2 id="ElasticSearchç›®å½•ç»“æ„">ElasticSearchç›®å½•ç»“æ„</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bin        <span class="comment"># è„šæœ¬æ–‡ä»¶ï¼ŒåŒ…æ‹¬å¯åŠ¨elasticsearchï¼Œå®‰è£…æ’ä»¶ï¼Œè¿è¡Œç»Ÿè®¡æ•°æ®ç­‰</span></span><br><span class="line">config     <span class="comment"># é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå¦‚elasticsearché…ç½®ã€è§’è‰²é…ç½®ã€jvmé…ç½®ã€è¯ä¹¦ç­‰ã€‚</span></span><br><span class="line">data       <span class="comment"># æ•°æ®ç›®å½•ï¼Œé»˜è®¤å€¼ $ES_HOME/dataï¼ŒåŒ…å«èŠ‚ç‚¹ã€åˆ†ç‰‡ã€ç´¢å¼•ã€æ–‡æ¡£çš„æ‰€æœ‰æ•°æ®ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹</span></span><br><span class="line">jdk        <span class="comment"># JDKç›®å½•ï¼Œç”¨äºè¿è¡ŒElasticsearchï¼Œ7.xä»¥åè‡ªå¸¦</span></span><br><span class="line">lib        <span class="comment"># Elasticsearchä¾èµ–çš„JARåŒ…</span></span><br><span class="line">logs       <span class="comment"># æ—¥å¿—ç›®å½•ï¼Œé»˜è®¤å€¼ $ES_HOME/logsï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹</span></span><br><span class="line">modules    <span class="comment"># åŒ…å«æ‰€æœ‰çš„Elasticsearchæ¨¡å—ï¼Œå¦‚Clusterã€Discoveryã€Indicesç­‰</span></span><br><span class="line">plugins    <span class="comment"># å·²å®‰è£…æ’ä»¶ç›®å½•</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºå¯åŠ¨ç”¨æˆ·">åˆ›å»ºå¯åŠ¨ç”¨æˆ·</h2><ul class="lvl-0"><li class="lvl-2"><p>elasticsearchå’Œkibanaéƒ½ä¸èƒ½ç”¨rootç”¨æˆ·å¯åŠ¨</p></li><li class="lvl-2"><p>åˆ›å»ºç”¨æˆ·<code>elastic</code>ï¼Œå¹¶è®¾ç½®å¯†ç </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd elastic</span><br><span class="line">passwd elastic</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹elasticsearchå®‰è£…ç›®å½•çš„ç”¨æˆ·æƒé™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R elastic:elastic /usr/local/elasticsearch</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ç¯å¢ƒå˜é‡">é…ç½®ç¯å¢ƒå˜é‡</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿›å…¥elasticç”¨æˆ·ä¸»ç›®å½•ï¼Œ/home/elasticç›®å½•ä¸‹ï¼Œè®¾ç½®ç”¨æˆ·çº§åˆ«çš„ç¯å¢ƒå˜é‡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ°elasticç”¨æˆ·</span></span><br><span class="line">su - elastic</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>vim .bash_profile</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Elasticsearchå®‰è£…ç›®å½•ï¼Œå®ƒç”¨äºå®šä½Elasticsearchçš„é…ç½®æ–‡ä»¶ã€æ’ä»¶å’Œå…¶ä»–ç›¸å…³èµ„æºã€‚</span></span><br><span class="line"><span class="built_in">export</span> ES_HOME=/usr/local/elasticsearch/elasticsearch-8.17.3</span><br><span class="line"><span class="comment"># Elasticsearchä½¿ç”¨çš„JDKå®‰è£…ç›®å½•ï¼Œåœ¨å¯åŠ¨Elasticsearchæ—¶ï¼Œå®ƒä¼šæ£€æŸ¥ES_JAVA_HOMEç¯å¢ƒå˜é‡å¹¶ä½¿ç”¨å…¶ä¸­çš„Javaè·¯å¾„ã€‚</span></span><br><span class="line"><span class="built_in">export</span> ES_JAVA_HOME=/usr/local/elasticsearch/elasticsearch-8.17.3/jdk/</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> .bash_profile</span><br></pre></td></tr></table></figure><h2 id="é…ç½®JVMå‚æ•°ï¼ˆå¯é€‰ï¼‰">é…ç½®JVMå‚æ•°ï¼ˆå¯é€‰ï¼‰</h2><ul class="lvl-0"><li class="lvl-2"><p>ESæ¯”è¾ƒè€—å†…å­˜ï¼Œå»ºè®®è™šæ‹Ÿæœº4Gæˆ–ä»¥ä¸Šå†…å­˜ï¼Œjvm1gä»¥ä¸Šçš„å†…å­˜åˆ†é…</p></li><li class="lvl-2"><p>è¿›å…¥<code>/usr/local/elasticsearch/elasticsearch-8.17.3/config</code>ç›®å½•ï¼Œä¿®æ”¹<code>jvm.options</code>æ–‡ä»¶ï¼Œè°ƒæ•´jvmå †å†…å­˜å¤§å°</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Xms4g <span class="comment"># è®¾ç½®æœ€å°å †å†…å­˜ï¼Œé»˜è®¤4gï¼Œä¸èƒ½å°äº1g</span></span><br><span class="line">-Xmx4g <span class="comment"># è®¾ç½®æœ€å¤§å †å†…å­˜ï¼Œé»˜è®¤4gï¼ŒXmxä¸è¦è¶…è¿‡æœºå™¨å†…å­˜çš„50%ï¼Œä¸è¦è¶…è¿‡30g</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºæ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•">åˆ›å»ºæ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ°elasticç”¨æˆ·</span></span><br><span class="line">su - elastic</span><br><span class="line"><span class="comment"># åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> /usr/local/elasticsearch/data /usr/local/elasticsearch/log</span><br></pre></td></tr></table></figure><h2 id="é…ç½®å¯åŠ¨æ–‡ä»¶">é…ç½®å¯åŠ¨æ–‡ä»¶</h2><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœæ˜¯æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ä¸åšä»»ä½•ä¿®æ”¹ç›´æ¥å¯åŠ¨ï¼Œå› ä¸ºå¤§éƒ¨åˆ†é…ç½®é¡¹éƒ½æœ‰é»˜è®¤å€¼ï¼Œä½†ä¸ºäº†æ›´å¥½çš„æ§åˆ¶ESï¼Œæ¨èæŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œé…ç½®</p></li><li class="lvl-2"><p>è¿›å…¥<code>/usr/local/elasticsearch/elasticsearch-8.17.3/config</code>ç›®å½•ï¼Œä¿®æ”¹<code>elasticsearch.yml</code>æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é›†ç¾¤åç§°ï¼Œå¤šä¸ªèŠ‚ç‚¹å¦‚æœè¦ç»„æˆåŒä¸€ä¸ªé›†ç¾¤ï¼Œé‚£ä¹ˆé›†ç¾¤åç§°ä¸€å®šè¦é…ç½®æˆç›¸åŒï¼Œé»˜è®¤å€¼elasticsearch</span></span><br><span class="line">cluster.name: test-elk</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤å€¼å½“å‰èŠ‚ç‚¹éƒ¨ç½²æ‰€åœ¨æœºå™¨çš„ä¸»æœºå</span></span><br><span class="line">node.name: node-1</span><br><span class="line"><span class="comment"># æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/data</span></span><br><span class="line">path.data: /usr/local/elasticsearch/data</span><br><span class="line"><span class="comment"># æ—¥å¿—å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤å€¼ $ES_HOME/logs</span></span><br><span class="line">path.logs: /usr/local/elasticsearch/logs</span><br><span class="line"><span class="comment"># é…ç½®ESå¯åŠ¨æ—¶æ˜¯å¦è¿›è¡Œå†…å­˜é”å®šæ£€æŸ¥ï¼Œé»˜è®¤å€¼trueï¼Œæœ¬æœºå†…å­˜æ¯”è¾ƒå°æ—¶è®¾ç½®ä¸ºfalse</span></span><br><span class="line">bootstrap.memory_lock: <span class="literal">false</span></span><br><span class="line"><span class="comment"># å…è®¸é€šè¿‡ä»»ä½•åœ°å€è®¿é—®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®</span></span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line"><span class="comment"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ 9200</span></span><br><span class="line">http.port: 9200</span><br><span class="line"><span class="comment"># é…ç½®å½“å‰ESèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡çš„tcpç«¯å£ï¼Œé»˜è®¤ 9300</span></span><br><span class="line">transport.port: 9300</span><br><span class="line"><span class="comment"># é›†ç¾¤å†…çš„ä¸»æœºåˆ—è¡¨ï¼Œå•èŠ‚ç‚¹å¯åŠ¨æ—¶å¯ä»¥ä¸é…ç½®</span></span><br><span class="line"><span class="comment"># discovery.seed_hosts: [&quot;127.0.0.1&quot;]</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦å‚ä¸é€‰ä¸»çš„èŠ‚ç‚¹åç§°</span></span><br><span class="line">cluster.initial_master_nodes: [<span class="string">&quot;node-1&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class="line">http.cors.enabled: <span class="literal">true</span></span><br><span class="line">http.cors.allow-origin: <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨ElasticSearchæœåŠ¡">å¯åŠ¨ElasticSearchæœåŠ¡</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿›å…¥<code>/usr/local/elasticsearch/elasticsearch-8.17.3</code>ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch</span><br><span class="line"><span class="comment"># åå°å¯åŠ¨</span></span><br><span class="line">./bin/elasticsearch -d</span><br></pre></td></tr></table></figure><h2 id="ESå¯åŠ¨å‰çš„å¼•å¯¼æ£€æŸ¥">ESå¯åŠ¨å‰çš„å¼•å¯¼æ£€æŸ¥</h2><ul class="lvl-0"><li class="lvl-2"><p>ESå¯åŠ¨æ—¶ï¼Œé»˜è®¤ä¼šè¿›è¡Œå¼•å¯¼æ£€æŸ¥ï¼Œæ‰€è°“å¼•å¯¼æ£€æŸ¥å°±æ˜¯åœ¨æœåŠ¡å¯åŠ¨ä¹‹å‰å¯¹ä¸€äº›é‡è¦çš„é…ç½®é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å…¶é…ç½®å€¼æ˜¯å¦æ˜¯åˆç†çš„ã€‚å¼•å¯¼æ£€æŸ¥åŒ…æ‹¬å¯¹JVMå¤§å°ã€å†…å­˜é”ã€è™šæ‹Ÿå†…å­˜ã€æœ€å¤§çº¿ç¨‹æ•°ã€é›†ç¾¤å‘ç°ç›¸å…³é…ç½®ç­‰ç›¸å…³çš„æ£€æŸ¥ï¼Œå¦‚æœæŸä¸€é¡¹æˆ–è€…å‡ é¡¹çš„é…ç½®ä¸åˆç†ï¼ŒESä¼šæ‹’ç»å¯åŠ¨æœåŠ¡ã€‚</p></li><li class="lvl-2"><p>å¦‚æœå¯åŠ¨æœåŠ¡æ—¶ï¼ŒæŠ¥ä»¥ä¸‹é”™è¯¯ï¼Œåˆ™éœ€è¦è§£å†³å¼•å¯¼æ£€æŸ¥ä¸­çš„é—®é¢˜</p></li><li class="lvl-2"><p>1.max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144];</p><ul class="lvl-2"><li class="lvl-6">åŸå› ï¼šæœ€å¤§è™šæ‹Ÿå†…å­˜å¤ªå°,è°ƒå¤§ç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜</li><li class="lvl-6">è§£å†³åŠæ³•ï¼š</li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rootç”¨æˆ·ä¸‹è¿è¡Œ</span></span><br><span class="line">vim /etc/sysctl.conf</span><br><span class="line"><span class="comment"># è¿½åŠ ä»¥ä¸‹å†…å®¹ï¼š</span></span><br><span class="line">vm.max_map_count=262144</span><br><span class="line"><span class="comment"># ä¿å­˜é€€å‡ºä¹‹åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></li><li class="lvl-2"><p>2.max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]</p><ul class="lvl-2"><li class="lvl-6">åŸå› ï¼šæ–‡ä»¶æè¿°ç¬¦å¤ªå°ï¼Œè°ƒå¤§ç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦</li><li class="lvl-6">è§£å†³åŠæ³•ï¼š</li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rootç”¨æˆ·ä¸‹è¿è¡Œ</span></span><br><span class="line">vim /etc/security/limits.conf</span><br><span class="line"><span class="comment"># æœ«å°¾æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</span></span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 65536</span><br><span class="line">* soft <span class="built_in">nproc</span> 4096</span><br><span class="line">* hard <span class="built_in">nproc</span> 4096</span><br></pre></td></tr></table></figure></li><li class="lvl-2"><p>å¦‚æœåªæ˜¯å•èŠ‚ç‚¹çš„å¼€å‘ç¯å¢ƒï¼Œåˆ™å¯ä»¥å…³é—­å¼•å¯¼æ£€æŸ¥ï¼Œç”Ÿæˆç¯å¢ƒä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºå…³é—­å¼•å¯¼æ£€æŸ¥åï¼ŒESæœåŠ¡å°†æ— æ³•ä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥elasticsearchå®‰è£…ç›®å½•</span></span><br><span class="line">vim config/elasticsearch.yml</span><br><span class="line"><span class="comment"># æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</span></span><br><span class="line"><span class="comment"># æŒ‡å®šèŠ‚ç‚¹ä¸ºå•èŠ‚ç‚¹ï¼Œå¯ä»¥ç»•è¿‡å¼•å¯¼æ£€æŸ¥</span></span><br><span class="line">discovery.type: single-node</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡æ­£å¸¸å¯åŠ¨åä»ç„¶ä¸èƒ½æ­£å¸¸è®¿é—®">æœåŠ¡æ­£å¸¸å¯åŠ¨åä»ç„¶ä¸èƒ½æ­£å¸¸è®¿é—®</h2><ul class="lvl-0"><li class="lvl-2"><p>è®¿é—®æœåŠ¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:9200</span><br><span class="line">curl: (52) Empty reply from server</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹æ—¥å¿—<code>/usr/local/elasticsearch/elasticsearch-8.17.3/logs/test-elk.log</code>ï¼Œå‘ç°æŠ¥å¦‚ä¸‹è­¦å‘Šï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[WARN ][o.e.h.n.Netty4HttpServerTransport] [node-1] received plaintext http traffic on an https channel, closing connection Netty4HttpChannel&#123;localAddress=/127.0.0.1:9200, remoteAddress=/127.0.0.1:38426&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŸå› æ˜¯ESåœ¨å¯åŠ¨æœåŠ¡æ—¶é»˜è®¤å¼€å¯äº† <code>X-Pack å®‰å…¨åŠŸèƒ½</code>ï¼ŒæŸ¥çœ‹é…ç½®æ–‡ä»¶<code>/usr/local/elasticsearch/elasticsearch-8.17.3/config/elasticsearch.yml</code>ï¼Œå‘ç°é…ç½®é¡¹<code>xpack.security.xxx</code>ç›¸å…³é…ç½®é¡¹è¢«è‡ªåŠ¨æ·»åŠ äº†ï¼Œå¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The following settings, TLS certificates, and keys have been automatically</span></span><br><span class="line"><span class="comment"># generated to configure Elasticsearch security features on 20-03-2025 08:53:20</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># --------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable security features</span></span><br><span class="line"><span class="comment"># å¯ç”¨ Elasticsearch çš„å®‰å…¨ç‰¹æ€§ï¼ŒåŒ…æ‹¬ç”¨æˆ·è®¤è¯ã€è§’è‰²ç®¡ç†ã€åŠ å¯†ç­‰ã€‚</span></span><br><span class="line"><span class="comment"># å¼€å¯äº† X-Pack å®‰å…¨åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦è¿›è¡Œç”¨æˆ·è®¤è¯æ‰èƒ½è®¿é—® Elasticsearchã€‚</span></span><br><span class="line"><span class="comment"># å¦‚æœéœ€è¦å…³é—­ X-Pack å®‰å…¨åŠŸèƒ½ï¼Œä½ å¯ä»¥å°† xpack.security.enabled è®¾ç½®ä¸º falseã€‚</span></span><br><span class="line">xpack.security.enabled: <span class="literal">true</span></span><br><span class="line"><span class="comment"># å¯ç”¨å®‰å…¨æ³¨å†ŒåŠŸèƒ½ï¼Œå…è®¸é€šè¿‡äº¤äº’å¼å‘å¯¼æ¥é…ç½®å®‰å…¨è®¾ç½®ã€‚</span></span><br><span class="line"><span class="comment"># è¿™ä½¿å¾—ä½ å¯ä»¥é€šè¿‡ Kibana æˆ–å‘½ä»¤è¡Œå·¥å…·æ¥è‡ªåŠ¨é…ç½® SSL è¯ä¹¦å’Œå…¶ä»–å®‰å…¨è®¾ç½®ã€‚</span></span><br><span class="line">xpack.security.enrollment.enabled: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents</span></span><br><span class="line"><span class="comment"># å¯ç”¨ HTTP API å®¢æˆ·ç«¯è¿æ¥çš„åŠ å¯†</span></span><br><span class="line"><span class="comment"># Kibanaã€Logstash å’Œå…¶ä»–é€šè¿‡ HTTP API è¿æ¥åˆ° Elasticsearch çš„å®¢æˆ·ç«¯å°†ä½¿ç”¨ HTTPS è¿›è¡Œé€šä¿¡ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚</span></span><br><span class="line">xpack.security.http.ssl:</span><br><span class="line">  enabled: <span class="literal">true</span> <span class="comment"># å¯ç”¨ HTTP å±‚çš„ SSL åŠ å¯†ï¼Œå³httpsè®¿é—®ï¼Œç¡®ä¿å®¢æˆ·ç«¯ä¸ Elasticsearch ä¹‹é—´çš„é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚è®¾ç½®ä¸ºfalseæ—¶ï¼Œå…³é—­åŠ å¯†ï¼Œå³httpè®¿é—®</span></span><br><span class="line">  keystore.path: certs/http.p12 <span class="comment"># æŒ‡å®šç”¨äº HTTP å±‚åŠ å¯†çš„å¯†é’¥åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™æ˜¯ä¸€ä¸ª PKCS12 æ–‡ä»¶ï¼ŒåŒ…å«ç”¨äºåŠ å¯†å’ŒéªŒè¯çš„å…¬é’¥å’Œç§é’¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable encryption and mutual authentication between cluster nodes</span></span><br><span class="line"><span class="comment"># å¯ç”¨èŠ‚ç‚¹é—´çš„åŠ å¯†å’ŒåŒå‘è®¤è¯</span></span><br><span class="line"><span class="comment"># Elasticsearch é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å°†ä½¿ç”¨ SSL åŠ å¯†ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šéªŒè¯å…¶ä»–èŠ‚ç‚¹çš„èº«ä»½ï¼Œä»è€Œå¢å¼ºé›†ç¾¤çš„å®‰å…¨æ€§ã€‚</span></span><br><span class="line"><span class="comment"># æ‰€æœ‰èŠ‚ç‚¹è¦é…ç½®ç›¸åŒçš„è¯ä¹¦</span></span><br><span class="line">xpack.security.transport.ssl:</span><br><span class="line">  enabled: <span class="literal">true</span> <span class="comment"># å¯ç”¨ä¼ è¾“å±‚çš„ SSL åŠ å¯†ï¼Œç¡®ä¿èŠ‚ç‚¹ä¹‹é—´çš„å†…éƒ¨é€šä¿¡æ˜¯åŠ å¯†çš„ã€‚</span></span><br><span class="line">  verification_mode: certificate <span class="comment"># è®¾ç½®éªŒè¯æ¨¡å¼ä¸º certificateï¼Œè¿™æ„å‘³ç€èŠ‚ç‚¹ä¹‹é—´éœ€è¦åŒå‘è®¤è¯ï¼ˆå³æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼‰ã€‚</span></span><br><span class="line">  keystore.path: certs/transport.p12 <span class="comment"># æŒ‡å®šç”¨äºä¼ è¾“å±‚åŠ å¯†çš„å¯†é’¥åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™æ˜¯å¦ä¸€ä¸ª PKCS12 æ–‡ä»¶ï¼ŒåŒ…å«ç”¨äºåŠ å¯†å’ŒéªŒè¯çš„å…¬é’¥å’Œç§é’¥ã€‚</span></span><br><span class="line">  truststore.path: certs/transport.p12 <span class="comment"># æŒ‡å®šç”¨äºå­˜å‚¨ä¿¡ä»»è¯ä¹¦çš„ä¿¡ä»»åº“æ–‡ä»¶è·¯å¾„ã€‚è¿™é€šå¸¸ä¸å¯†é’¥åº“ç›¸åŒï¼Œä½†å¯ä»¥ä¸åŒã€‚</span></span><br><span class="line"><span class="comment">#----------------------- END SECURITY AUTO CONFIGURATION -------------------------</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è§£å†³æ–¹æ³•ï¼š</p><ul class="lvl-2"><li class="lvl-6">1.ä¸æƒ³å¼€å¯å®‰å…¨è®¤è¯ï¼Œå°† <code>xpack.security.enabled</code> è®¾ç½®ä¸º falseï¼Œè¿™æ ·å³ä¾¿ä¸‹é¢çš„é…ç½®éƒ½è®¾ç½®ä¸ºtrueä¹Ÿä¸ä¼šæœ‰æ•ˆã€‚</li><li class="lvl-6">2.ä¸æƒ³httpsè®¿é—®ï¼Œå°† <code>xpack.security.http.ssl.enabled</code> è®¾ç½®ä¸º falseï¼Œä½†è¿™æ ·ä¼šå¯¼è‡´æ— æ³•é€šè¿‡è®¤è¯Tokenæ·»åŠ å…¶å®ƒèŠ‚ç‚¹æˆ–Kibanaã€‚</li><li class="lvl-6">3.ä¸æƒ³èŠ‚ç‚¹é—´é€šä¿¡åŠ å¯†ï¼Œå°† <code>xpack.security.transport.ssl.enabled</code> è®¾ç½®ä¸º false</li></ul></li><li class="lvl-2"><p>ä¸ºäº†ä¿è¯ESçš„å®‰å…¨ï¼Œæˆ‘è¿™é‡Œå°±å¼€å¯å®‰å…¨è®¤è¯ï¼Œå¹¶ä¸”é€šè¿‡httpsè®¿é—®ESï¼Œä½†æ­¤æ—¶æˆ‘ä»¬è®¿é—®ESçš„APIå°±éœ€è¦å¸¦ä¸Šè®¤è¯ç”¨æˆ·ï¼Œé‚£ä¹ˆç”¨æˆ·åå’Œå¯†ç æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p></li><li class="lvl-2"><p>å®é™…ä¸Šåœ¨ESç¬¬ä¸€æ¬¡æ­£å¸¸å¯åŠ¨æ—¶å…¶æ—¥å¿—ä¸­å°±æ‰“å°äº†è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç›¸å…³çš„ä¿¡æ¯æç¤ºï¼Œé‡Œé¢å°±ç»™å‡ºäº†ç™»å½•ç”¨æˆ·å’Œåˆå§‹çš„å¯†ç ï¼Œå¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span><br><span class="line"><span class="comment"># è¿™äº›æ—¥å¿—ä¿¡æ¯æä¾›äº† Elasticsearch 8 åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®çš„å®‰å…¨ç‰¹æ€§ã€ç”Ÿæˆçš„é»˜è®¤å¯†ç ã€è¯ä¹¦æŒ‡çº¹ä»¥åŠå¦‚ä½•é…ç½® Kibana å’Œå…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„è¯¦ç»†è¯´æ˜ã€‚</span></span><br><span class="line">âœ… Elasticsearch security features have been automatically configured!</span><br><span class="line">âœ… Authentication is enabled and cluster connections are encrypted.</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ˜¯ elastic ç”¨æˆ·çš„é»˜è®¤å¯†ç ã€‚ç³»ç»Ÿå»ºè®®ä½ ä½¿ç”¨ bin/elasticsearch-reset-password -u elastic å‘½ä»¤æ¥é‡ç½®æ­¤å¯†ç ã€‚</span></span><br><span class="line">â„¹ï¸  Password <span class="keyword">for</span> the elastic user (reset with `bin/elasticsearch-reset-password -u elastic`):</span><br><span class="line">  BNb=*qz6_M*mXL9uZiSP <span class="comment"># è¿™é‡Œä¼šæ‰“å°å‡ºESè‡ªåŠ¨ç”Ÿæˆçš„å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ˜¯ HTTP CA è¯ä¹¦çš„ SHA-256 æŒ‡çº¹ã€‚CA è¯ä¹¦ç”¨äºéªŒè¯ HTTPS è¿æ¥çš„èº«ä»½ã€‚</span></span><br><span class="line">â„¹ï¸  HTTP CA certificate SHA-256 fingerprint:</span><br><span class="line">  3f141c16dfc6e165894bc1672084b220dcdd22ffe02116d51ac18003cfaa5a1d</span><br><span class="line"></span><br><span class="line"><span class="comment"># æä¾›äº†å°† Kibana é…ç½®ä¸ºä½¿ç”¨æ­¤ Elasticsearch é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class="line">â„¹ï¸  Configure Kibana to use this cluster:</span><br><span class="line"><span class="comment"># å¯åŠ¨ Kibana å¹¶æŒ‰ç…§ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é…ç½®é“¾æ¥è¿›è¡Œæ“ä½œã€‚</span></span><br><span class="line">â€¢ Run Kibana and click the configuration <span class="built_in">link</span> <span class="keyword">in</span> the terminal when Kibana starts.</span><br><span class="line"><span class="comment"># å¤åˆ¶æä¾›çš„æ³¨å†Œä»¤ç‰Œï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Kibana æ—¶ç²˜è´´æ­¤ä»¤ç‰Œã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class="line"><span class="comment"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„kibanaæ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s kibana</span></span><br><span class="line">â€¢ Copy the following enrollment token and <span class="built_in">paste</span> it into Kibana <span class="keyword">in</span> your browser (valid <span class="keyword">for</span> the next 30 minutes):</span><br><span class="line">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImFSWFBzcFVCTVVmc1d5aUJnbjBtOmRzbVBLQV95UXhDZkJpXzQyWDNEMVEifQ==</span><br><span class="line"></span><br><span class="line"><span class="comment"># æä¾›äº†å°†æ–°çš„ Elasticsearch èŠ‚ç‚¹åŠ å…¥ç°æœ‰é›†ç¾¤çš„æ­¥éª¤ã€‚</span></span><br><span class="line">â„¹ï¸ Configure other nodes to <span class="built_in">join</span> this cluster:</span><br><span class="line"><span class="comment"># ä½¿ç”¨ bin/elasticsearch --enrollment-token &lt;token&gt; å‘½ä»¤å¯åŠ¨æ–°çš„ Elasticsearch èŠ‚ç‚¹ã€‚ä»¤ç‰Œåœ¨æ¥ä¸‹æ¥çš„ 30 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚</span></span><br><span class="line"><span class="comment"># è¡¥å……è¯´æ˜ï¼šç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ³¨å†Œä»¤ç‰Œï¼šbin/elasticsearch-create-enrollment-token -s node</span></span><br><span class="line">â€¢ Copy the following enrollment token and start new Elasticsearch nodes with `bin/elasticsearch --enrollment-token &lt;token&gt;` (valid <span class="keyword">for</span> the next 30 minutes):</span><br><span class="line">  eyJ2ZXIiOiI4LjE0LjAiLCJhZHIiOlsiMTAuMjUwLjAuMjM5OjkyMDAiXSwiZmdyIjoiM2YxNDFjMTZkZmM2ZTE2NTg5NGJjMTY3MjA4NGIyMjBkY2RkMjJmZmUwMjExNmQ1MWFjMTgwMDNjZmFhNWExZCIsImtleSI6ImF4WFBzcFVCTVVmc1d5aUJnbjFtOkFEallPdnpzUzh1MGJqOFpfVFE4a3cifQ==</span><br><span class="line"><span class="comment"># å¦‚æœä½ åœ¨ Docker ä¸­è¿è¡Œ Elasticsearchï¼Œå¯ä»¥ä½¿ç”¨ docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3 å‘½ä»¤å¯åŠ¨æ–°èŠ‚ç‚¹ã€‚</span></span><br><span class="line">  If you<span class="string">&#x27;re running in Docker, copy the enrollment token and run:</span></span><br><span class="line"><span class="string">  `docker run -e &quot;ENROLLMENT_TOKEN=&lt;token&gt;&quot; docker.elastic.co/elasticsearch/elasticsearch:8.17.3`</span></span><br><span class="line"><span class="string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç™»å½•ç”¨æˆ·ä¸º<code>elastic</code>[å…¶è§’è‰²ä¸ºè¶…çº§ç”¨æˆ·]ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ—¥å¿—æŸ¥çœ‹åˆå§‹çš„å¯†ç ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤é‡ç½®å¯†ç </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡ç½®å¯†ç ï¼Œå¯†ç è‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class="line">bin/elasticsearch-reset-password -u elastic</span><br><span class="line"><span class="comment"># é‡ç½®å¯†ç ï¼Œè‡ªå·±è¾“å…¥è¦è®¾ç½®çš„å¯†ç ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œè¿™æ˜¯ä¸º 123456</span></span><br><span class="line">bin/elasticsearch-reset-password -u elastic -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡curlé‡ç½®å¯†ç </span></span><br><span class="line">curl -X PUT -u elastic:old_password -k <span class="string">&#x27;https://127.0.0.1:9200/_security/user/elastic/_password&#x27;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">      &quot;password&quot;: &quot;new_password&quot;</span></span><br><span class="line"><span class="string">    &#125;&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>curl è®¿é—®ESæœåŠ¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -k å¿½ç•¥è¯ä¹¦æ ¡éªŒ</span></span><br><span class="line">curl -u elastic:123456 -k https://127.0.0.1:9200</span><br><span class="line"><span class="comment"># æˆ–è€… å°†è®¤è¯ä¿¡æ¯é€šè¿‡headerä¼ é€’ï¼Œelastic:123456 é€šè¿‡base64åŠ å¯†</span></span><br><span class="line">curl -k https://127.0.0.1:9200 -H <span class="string">&#x27;Authorization: Basic ZWxhc3RpYzoxMjM0NTY=&#x27;</span></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥é€šè¿‡è¯ä¹¦è®¿é—®httpsæœåŠ¡ï¼Œè¿™ä¸ªè¯ä¹¦å°±æ˜¯ESåœ¨å¼€å¯å®‰å…¨è®¤è¯å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆçš„</span></span><br><span class="line">curl -u elastic:123456 --cacert /usr/local/elasticsearch/elasticsearch-8.17.3/config/certs/http_ca.crt  https://127.0.0.1:9200</span><br><span class="line"><span class="comment"># è¾“å‡ºå¦‚ä¸‹ï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;node-1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;test-elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;RykjCSPnSCi4Hsi37uziWw&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;8.17.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;tar&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;a091390de485bd4b127884f7e565c0cad59b10d2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2025-02-28T10:07:26.089129809Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;9.12.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;7.17.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;7.0.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å¼€å‘æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼</strong></em></p><ul class="lvl-1"><li class="lvl-2">å¼€å‘æ¨¡å¼ï¼šå¦‚æœç”¨æˆ·åªæ˜¯å‡ºäºå­¦ä¹ ç›®çš„ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  <code>discovery.type=single-node</code> ï¼Œè¡¨ç¤ºå•èŠ‚ç‚¹æ¨¡å¼ï¼Œå³å¼€å‘æ¨¡å¼ã€‚æ­¤æ¨¡å¼å¯ä»¥ç»•è¿‡å¼•å¯¼æ£€æŸ¥ã€‚</li><li class="lvl-2">ç”Ÿäº§æ¨¡å¼ï¼šå½“ç”¨æˆ·é…ç½®äº†æœ‰å…³é›†ç¾¤çš„ç›¸å…³é…ç½®é¡¹æ—¶å°±ä¼šè§¦å‘ç”Ÿäº§æ¨¡å¼ï¼Œåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å¯åŠ¨ä¼šè§¦å‘ESçš„å¼•å¯¼æ£€æŸ¥æˆ–è€…å«å¯åŠ¨æ£€æŸ¥ï¼ˆbootstrap checksï¼‰ï¼Œå¼•å¯¼æ£€æŸ¥ååˆ†ä¸¥æ ¼ï¼Œå³æŸäº›æ£€æŸ¥é¡¹ä¸é€šè¿‡åˆ™ESæœåŠ¡å°†æ— æ³•å¯åŠ¨ã€‚<ul class="lvl-3"><li class="lvl-4">å¼•å¯¼æ£€æŸ¥ï¼šåœ¨æœåŠ¡å¯åŠ¨ä¹‹å‰å¯¹ä¸€äº›é‡è¦çš„é…ç½®é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥å…¶é…ç½®å€¼æ˜¯å¦æ˜¯åˆç†çš„ã€‚å¼•å¯¼æ£€æŸ¥åŒ…æ‹¬å¯¹JVMå¤§å°ã€å†…å­˜é”ã€è™šæ‹Ÿå†…å­˜ã€æœ€å¤§çº¿ç¨‹æ•°ã€é›†ç¾¤å‘ç°ç›¸å…³é…ç½®ç­‰ç›¸å…³çš„æ£€æŸ¥ï¼Œå¦‚æœæŸä¸€é¡¹æˆ–è€…å‡ é¡¹çš„é…ç½®ä¸åˆç†ï¼ŒESä¼šæ‹’ç»å¯åŠ¨æœåŠ¡ï¼Œå¹¶ä¸”åœ¨å¼€å‘æ¨¡å¼ä¸‹çš„æŸäº›è­¦å‘Šä¿¡æ¯ä¼šå‡çº§æˆé”™è¯¯ä¿¡æ¯è¾“å‡ºã€‚å¼•å¯¼æ£€æŸ¥ååˆ†ä¸¥æ ¼ï¼Œä¹‹æ‰€ä»¥å®å¯æ‹’ç»æœåŠ¡ä¹Ÿè¦é˜»æ­¢ç”¨æˆ·å¯åŠ¨æœåŠ¡æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·åœ¨å¯¹ESçš„åŸºæœ¬ä½¿ç”¨ä¸äº†è§£çš„å‰æä¸‹å¯åŠ¨æœåŠ¡è€Œå¯¼è‡´çš„åæœŸæ€§èƒ½é—®é¢˜æ— æ³•è§£å†³æˆ–è€…è§£å†³èµ·æ¥å¾ˆéº»çƒ¦ã€‚å› ä¸ºä¸€æ—¦æœåŠ¡ä»¥æŸç§ä¸åˆç†çš„é…ç½®å¯åŠ¨ï¼Œæ—¶é—´ä¹…äº†ä¹‹åå¯èƒ½ä¼šäº§ç”Ÿè¾ƒå¤§çš„æ€§èƒ½é—®é¢˜ï¼Œä½†æ­¤æ—¶é›†ç¾¤å·²ç»å˜å¾—éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•ï¼ŒESä¸ºäº†é¿å…è¿™ç§æƒ…å†µè€Œåšå‡ºäº†å¼•å¯¼æ£€æŸ¥çš„è®¾ç½®ï¼Œæœ¬æ¥åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¸ºè­¦å‘Šçš„å¯åŠ¨æ—¥å¿—ä¼šå‡çº§ä¸ºæŠ¥é”™ï¼ˆErrorï¼‰ã€‚è¿™ç§è®¾å®šè™½ç„¶å¢åŠ äº†ç”¨æˆ·çš„ä½¿ç”¨é—¨æ§›ï¼Œä½†æ˜¯é¿å…äº†æ—¥åäº§ç”Ÿæ›´å¤§çš„é—®é¢˜ã€‚</li></ul></li></ul></div><h2 id="ESæµè§ˆå™¨æ’ä»¶">ESæµè§ˆå™¨æ’ä»¶</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://elasticvue.com/">Elasticvue</a> : chrome/edge æ’ä»¶ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ESé›†ç¾¤ä¿¡æ¯ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§</p></li></ul><h2 id="ESè‡ªå¯åŠ¨è„šæœ¬">ESè‡ªå¯åŠ¨è„šæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæœåŠ¡æ–‡ä»¶</span></span><br><span class="line">$ vim /usr/lib/systemd/system/es.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=elasticsearch</span><br><span class="line">Documentation=https://www.elastic.co</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line"><span class="comment"># æŒ‡å®šESç”¨æˆ·</span></span><br><span class="line">User=elastic</span><br><span class="line">Group=elastic</span><br><span class="line">LimitNOFILE=100000</span><br><span class="line">LimitNPROC=100000</span><br><span class="line">Restart=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">ExecStart=/usr/local/elasticsearch/elasticsearch-8.17.3/bin/elasticsearch</span><br><span class="line">ExecRestart=/bin/kill -s HUP <span class="variable">$MAINPID</span></span><br><span class="line">ExecStop=/bin/kill -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½</span></span><br><span class="line">$ systemctl daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">$ systemctl start es</span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">$ systemctl stop es</span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">$ systemctl status es</span><br><span class="line"><span class="comment"># è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br><span class="line">$ systemctl <span class="built_in">enable</span> es</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡ApiKeyè®¿é—®ES">é€šè¿‡ApiKeyè®¿é—®ES</h2><ul class="lvl-0"><li class="lvl-2"><p>å…³äºApiKeyçš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-api-key.html">å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p>åˆ›å»ºApiKey</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">curl -k <span class="string">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \</span><br><span class="line">-u elastic:123456 \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;name&quot;: &quot;elastic_api_key&quot;,</span></span><br><span class="line"><span class="string">    &quot;expiration&quot;: &quot;1d&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¯·æ±‚å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># name: ApiKeyçš„åç§°</span></span><br><span class="line"><span class="comment"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®ä¸ºä¸€å¤©ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™æ°¸ä¸è¿‡æœŸ</span></span><br><span class="line"><span class="comment"># è¯·æ±‚å‚æ•°ä¸­è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å‚æ•° `role_descriptors`ï¼Œå…¶å«ä¹‰æ˜¯ï¼ŒæŒ‡å®šApiKeyæ‰€æ‹¥æœ‰çš„æƒé™ï¼Œå³è§’è‰²ã€‚å¦‚æœä¸è¿›è¡Œè®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰è®¤è¯ç”¨æˆ·çš„çš„è§’è‰²</span></span><br><span class="line"><span class="comment"># metadata: ApiKeyçš„å…ƒæ•°æ®ï¼Œå³è‡ªå®šä¹‰çš„é”®å€¼å¯¹ï¼Œè¿™é‡Œå¯ä»¥ä¸è®¾ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;id&quot;</span>:<span class="string">&quot;70It0ZUBrL2GcOxX0d1L&quot;</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>:<span class="string">&quot;elastic_api_key&quot;</span>,</span><br><span class="line">  <span class="string">&quot;expiration&quot;</span>:1743057595723,</span><br><span class="line">  <span class="string">&quot;api_key&quot;</span>:<span class="string">&quot;s85lqVkmQISkBlgXCTJmDQ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;encoded&quot;</span>:<span class="string">&quot;NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è¾“å‡ºå‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># id: ApiKeyçš„id</span></span><br><span class="line"><span class="comment"># name: ApiKeyçš„åç§°</span></span><br><span class="line"><span class="comment"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’</span></span><br><span class="line"><span class="comment"># api_key: ApiKeyçš„å¯†é’¥</span></span><br><span class="line"><span class="comment"># encoded: å¯¹ `id:api_key` è¿›è¡Œbase64ç¼–ç ï¼Œå³å¯å¾—åˆ° `encoded`</span></span><br><span class="line">    <span class="comment"># echo -n &#x27;70It0ZUBrL2GcOxX0d1L:s85lqVkmQISkBlgXCTJmDQ&#x27; | base64</span></span><br><span class="line">    <span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line">    <span class="comment"># NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨ApiKeyè®¿é—®ES</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œçš„ApiKeyï¼Œå°±æ˜¯ä¸Šé¢è¾“å‡ºçš„encoded</span></span><br><span class="line">curl -k <span class="string">&#x27;https://127.0.0.1:9200?pretty&#x27;</span> \</span><br><span class="line">-H <span class="string">&#x27;Authorization: ApiKey NzBJdDBaVUJyTDJHY094WDBkMUw6czg1bHFWa21RSVNrQmxnWENUSm1EUQ==&#x27;</span></span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;node-1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;test-elk&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;RykjCSPnSCi4Hsi37uziWw&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;8.17.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;tar&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;a091390de485bd4b127884f7e565c0cad59b10d2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2025-02-28T10:07:26.089129809Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;9.12.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;7.17.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;7.0.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ApiKeyä¿¡æ¯ï¼Œå‚è€ƒ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-get-api-key.html">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/_security/api_key?name=elastic_api_key&amp;pretty&#x27;</span></span><br><span class="line"><span class="comment"># è¯·æ±‚å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># name: ApiKeyçš„åç§°ï¼Œä¸åŒçš„ApiKeyå¯ä»¥æ‹¥æœ‰ç›¸åŒçš„åç§°ï¼Œä½†idä¸åŒï¼Œæ‰€ä»¥é€šè¿‡nameè¿›è¡ŒæŸ¥è¯¢å¯èƒ½ä¼šè¿”å›å¤šä¸ªç»“æœ</span></span><br><span class="line"><span class="comment"># æˆ–è€… id: ApiKeyçš„idï¼Œå»ºè®®é€šè¿‡idè¿›è¡ŒæŸ¥è¯¢ï¼Œidå”¯ä¸€ï¼Œæ‰€ä»¥é€šè¿‡idè¿›è¡ŒæŸ¥è¯¢åªä¼šè¿”å›ä¸€ä¸ªç»“æœ</span></span><br><span class="line"><span class="comment"># username: æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„ApiKey</span></span><br><span class="line"><span class="comment"># owner: æ˜¯å¦åªæŸ¥è¯¢å½“å‰è®¤è¯ç”¨æˆ·åä¸‹çš„ApiKeyï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸ºfalseæ—¶å¿…é¡»è‡³å°‘è®¾ç½®name\ids\usernameä¸­çš„ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸åŠ ä»»ä½•å‚æ•°è¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ™è¿”å›æ‰€æœ‰ApiKeyçš„ä¿¡æ¯</span></span><br><span class="line">curl -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ›´æ–°ApiKeyï¼Œå‚è€ƒ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-update-api-key.html">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">curl -u elastic:123456 -X PUT -k <span class="string">&#x27;https://127.0.0.1:9200/_security/api_key/&#123;ApiKeyId&#125;?pretty&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;expiration&quot;: &quot;1h&quot;,</span></span><br><span class="line"><span class="string">    &quot;role_descriptors&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;role-a&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;indices&quot;: [</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                &quot;names&quot;: [&quot;*&quot;],</span></span><br><span class="line"><span class="string">                &quot;privileges&quot;: [&quot;write&quot;]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;metadata&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;environment&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;level&quot;: 2,</span></span><br><span class="line"><span class="string">            &quot;trusted&quot;: true,</span></span><br><span class="line"><span class="string">            &quot;tags&quot;: [&quot;production&quot;]</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥æ›´æ–°çš„å‚æ•°æœ‰ï¼š</span></span><br><span class="line"><span class="comment"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœå·²ç»è®¾ç½®è¿‡expirationï¼Œæ­¤æ—¶å¸Œæœ›ä½¿å…¶æ°¸ä¸è¿‡æœŸï¼Œåˆ™åªèƒ½å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ—¶é—´ï¼Œæ¯”å¦‚ &quot;expiration&quot;: &quot;100y&quot;</span></span><br><span class="line"><span class="comment"># role_descriptors: ApiKeyæ‰€æ‹¥æœ‰çš„è§’è‰²ï¼ŒåŸå…ˆè®¾ç½®äº†role_descriptorsï¼Œæ›´æ–°æ—¶å¸Œæœ›å…¶ä½¿ç”¨è®¤è¯ç”¨æˆ·çš„è§’è‰²ï¼Œåˆ™æ­¤æ—¶å¯ä»¥å°†å…¶è®¾ç½®ä¸º &quot;role_descriptors&quot;: &#123;&#125;</span></span><br><span class="line"><span class="comment"># metadata: ApiKeyçš„å…ƒæ•°æ®ï¼ŒåŸå…ˆè®¾ç½®äº† metadata ï¼Œæ›´æ–°æ—¶å¸Œæœ›å»é™¤æ‰€æœ‰ metadata ä¿¡æ¯ï¼Œåˆ™æ­¤æ—¶å¯ä»¥å°†å…¶è®¾ç½®ä¸º &quot;metadata&quot;: &#123;&#125;</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šä¸‰ä¸ªå‚æ•°å¯ä»¥åªæ›´æ–°å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œæ›´æ–°å“ªä¸ªå°±åªæ›¿æ¢å“ªä¸ªï¼Œæ²¡æœ‰è¢«æ›´æ–°çš„å‚æ•°ä¸ä¼šå—åˆ°ä¿®æ”¹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŒæ—¶æ›´æ–°å…¨éƒ¨</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç½®ApiKeyæ— æ•ˆï¼Œå‚è€ƒ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-invalidate-api-key.html">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå®˜æ–¹æ²¡æœ‰æä¾›åˆ é™¤ApiKeyçš„æ¥å£ï¼Œåªæœ‰ç½®æ— æ•ˆçš„æ¥å£</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">curl -u elastic:123456 -X DELETE -k <span class="string">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;name&quot;: &quot;elastic_api_key&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¯·æ±‚å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># name: ApiKeyçš„åç§°ï¼Œä¼š</span></span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨  &quot;ids&quot; : [ &quot;70It0ZUBrL2GcOxX0d1L&quot; ] ï¼Œé€šè¿‡idè¿›è¡Œåˆ é™¤ï¼Œæ­¤æ—¶å¯ä»¥ä¸€æ¬¡åˆ é™¤å¤šä¸ªApiKey</span></span><br><span class="line"><span class="comment"># username: åˆ é™¤æŒ‡å®šç”¨æˆ·çš„ApiKey</span></span><br><span class="line"><span class="comment"># owner: æ˜¯å¦åªåˆ é™¤å½“å‰è®¤è¯ç”¨æˆ·åä¸‹çš„ApiKeyï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸ºfalseæ—¶å¿…é¡»è‡³å°‘è®¾ç½®name\ids\usernameä¸­çš„ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;invalidated_api_keys&quot;</span>:[</span><br><span class="line">    <span class="string">&quot;70It0ZUBrL2GcOxX0d1L&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;previously_invalidated_api_keys&quot;</span>:[ ],</span><br><span class="line">  <span class="string">&quot;error_count&quot;</span>:0</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è¾“å‡ºå‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># invalidated_api_keys: è¢«åˆ é™¤çš„ApiKeyçš„idåˆ—è¡¨</span></span><br><span class="line"><span class="comment"># previously_invalidated_api_keys: ä¹‹å‰è¢«åˆ é™¤çš„ApiKeyçš„idåˆ—è¡¨</span></span><br><span class="line"><span class="comment"># error_count: é”™è¯¯æ•°é‡ï¼Œå¦‚æœä¸º0ï¼Œåˆ™è¡¨ç¤ºæˆåŠŸ</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨ApiKeyçš„ä¼˜ç¼ºç‚¹</p><ul class="lvl-2"><li class="lvl-6">ä¼˜ç‚¹</li></ul>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">å®‰å…¨æ€§:</span><br><span class="line">    ç»†ç²’åº¦æ§åˆ¶: API Key å¯ä»¥ä¸ç‰¹å®šçš„è§’è‰²æè¿°ç¬¦å…³è”ï¼Œå…è®¸éå¸¸ç»†åŒ–çš„æƒé™æ§åˆ¶ã€‚è¿™æœ‰åŠ©äºéµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œåªæˆäºˆå¿…è¦çš„è®¿é—®æƒé™ã€‚</span><br><span class="line">    æ—¶é—´é™åˆ¶: å¯ä»¥ä¸º API Key è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç¡®ä¿å¯†é’¥ä¸ä¼šæ°¸è¿œæœ‰æ•ˆï¼Œå‡å°‘é•¿æœŸæ³„éœ²çš„é£é™©ã€‚</span><br><span class="line">    å¯æ’¤é”€æ€§: å¦‚æœæ€€ç–‘æŸä¸ª API Key è¢«æ³„éœ²æˆ–ä¸å†éœ€è¦ï¼Œå¯ä»¥éšæ—¶æ’¤é”€è¯¥å¯†é’¥ï¼Œæé«˜å®‰å…¨æ€§ã€‚</span><br><span class="line">æ–¹ä¾¿æ€§:</span><br><span class="line">    æ˜“äºç”Ÿæˆå’Œç®¡ç†: åˆ›å»ºå’Œç®¡ç† API Key çš„è¿‡ç¨‹é€šå¸¸å¾ˆç®€å•ï¼Œå¯ä»¥é€šè¿‡ REST API æˆ– Kibana ç•Œé¢è¿›è¡Œã€‚</span><br><span class="line">    æ— éœ€ç”¨æˆ·äº¤äº’: ä¸€æ—¦ç”Ÿæˆï¼ŒAPI Key å¯ä»¥ç›´æ¥ç”¨äºè‡ªåŠ¨åŒ–è„šæœ¬æˆ–åº”ç”¨ç¨‹åºï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨ç™»å½•æˆ–æä¾›å‡­æ®ã€‚</span><br><span class="line">å®¡è®¡å’Œç›‘æ§:</span><br><span class="line">    è·Ÿè¸ªä½¿ç”¨æƒ…å†µ: é€šè¿‡æ—¥å¿—è®°å½•å’Œå®¡è®¡åŠŸèƒ½ï¼Œå¯ä»¥è·Ÿè¸ªå“ªä¸ª API Key è¿›è¡Œäº†å“ªäº›æ“ä½œï¼Œä¾¿äºå®‰å…¨å®¡è®¡å’Œé—®é¢˜æ’æŸ¥ã€‚</span><br><span class="line">    æ´»åŠ¨ç›‘æ§: å¯ä»¥ç›‘æ§ API Key çš„æ´»åŠ¨ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸è¡Œä¸ºï¼Œå¹¶é‡‡å–ç›¸åº”çš„æªæ–½ã€‚</span><br><span class="line">çµæ´»æ€§:</span><br><span class="line">    å¤šç§ç”¨é€”: API Key å¯ä»¥ç”¨äºå„ç§ç”¨é€”ï¼Œå¦‚åº”ç”¨ç¨‹åºé›†æˆã€æ•°æ®å¯¼å…¥å¯¼å‡ºã€ç›‘æ§å·¥å…·ç­‰ã€‚</span><br><span class="line">    å¤šç¯å¢ƒæ”¯æŒ: å¯ä»¥ä¸ºä¸åŒçš„ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ç”Ÿæˆç‹¬ç«‹çš„ API Keyï¼Œç¡®ä¿å„ç¯å¢ƒä¹‹é—´çš„éš”ç¦»ã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-2"><li class="lvl-6">ç¼ºç‚¹</li></ul>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å®‰å…¨æ€§é£é™©:</span><br><span class="line">    å¯†é’¥å­˜å‚¨: API Key éœ€è¦å®‰å…¨åœ°å­˜å‚¨å’Œä¼ è¾“ï¼Œå¦‚æœå¯†é’¥è¢«æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œæœªæˆæƒçš„æ“ä½œã€‚</span><br><span class="line">    é™æ€å‡­è¯: ä¸åŠ¨æ€çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼ˆå¦‚ OAuth ä»¤ç‰Œï¼‰ç›¸æ¯”ï¼ŒAPI Key æ˜¯é™æ€çš„ï¼Œä¸€æ—¦æ³„éœ²å¯èƒ½ä¼šå¯¼è‡´é•¿æœŸçš„å®‰å…¨é£é™©ã€‚</span><br><span class="line">ç®¡ç†å¤æ‚æ€§:</span><br><span class="line">    å¯†é’¥ç®¡ç†: éšç€æ—¶é—´å’Œä½¿ç”¨è§„æ¨¡çš„å¢é•¿ï¼Œç®¡ç†å’Œç»´æŠ¤å¤§é‡ API Key å¯èƒ½ä¼šå˜å¾—å¤æ‚ã€‚éœ€è¦å®šæœŸæ›´æ–°å’Œæ’¤é”€è€æ—§çš„å¯†é’¥ã€‚</span><br><span class="line">    è§’è‰²åˆ†é…: ç»†ç²’åº¦çš„æƒé™æ§åˆ¶è™½ç„¶æä¾›äº†å®‰å…¨æ€§ï¼Œä½†ä¹Ÿå¢åŠ äº†é…ç½®å’Œç®¡ç†çš„å¤æ‚æ€§ã€‚</span><br><span class="line">ç¼ºä¹ç”¨æˆ·ä¸Šä¸‹æ–‡:</span><br><span class="line">    åŒ¿åæ€§: API Key é€šå¸¸æ²¡æœ‰ç”¨æˆ·ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸åƒåŸºäºç”¨æˆ·çš„è®¤è¯æœºåˆ¶ï¼ˆå¦‚ Basic Auth æˆ– OAuthï¼‰ï¼Œè¿™å¯èƒ½ä¸åˆ©äºæŸäº›ä¾èµ–ç”¨æˆ·èº«ä»½çš„åŠŸèƒ½ã€‚</span><br><span class="line">ä¾èµ–å®¢æˆ·ç«¯é…ç½®:</span><br><span class="line">    æ˜“é”™æ€§: å¦‚æœå®¢æˆ·ç«¯é…ç½®ä¸å½“ï¼Œå¦‚é”™è¯¯åœ°å¤„ç†æˆ–æš´éœ² API Keyï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨æ¼æ´ã€‚</span><br><span class="line">    æ›´æ–°æŒ‘æˆ˜: æ›´æ–° API Key åï¼Œæ‰€æœ‰ä½¿ç”¨è¯¥å¯†é’¥çš„å®¢æˆ·ç«¯éƒ½éœ€è¦åŒæ­¥æ›´æ–°ï¼Œè¿™åœ¨å¤§è§„æ¨¡ç¯å¢ƒä¸­å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚</span><br></pre></td></tr></table></figure></li><li class="lvl-2"><p>ä½•æ—¶ä½¿ç”¨ API Key</p><ul class="lvl-2"><li class="lvl-6">å½“æ‚¨éœ€è¦ä¸ºè‡ªåŠ¨åŒ–è„šæœ¬ã€ç¬¬ä¸‰æ–¹æœåŠ¡æˆ–åº”ç”¨ç¨‹åºæä¾›è®¿é—®æƒé™æ—¶ã€‚</li><li class="lvl-6">å½“æ‚¨å¸Œæœ›å®ç°ç»†ç²’åº¦çš„æƒé™æ§åˆ¶å¹¶èƒ½å¤Ÿè½»æ¾ç®¡ç†å¯†é’¥çš„ç”Ÿå‘½å‘¨æœŸæ—¶ã€‚</li><li class="lvl-6">å½“ä¸éœ€è¦ç”¨æˆ·ä¸Šä¸‹æ–‡æˆ–å¤æ‚çš„ç”¨æˆ·ä¼šè¯ç®¡ç†æ—¶ã€‚</li></ul></li><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºApiKey</span></span><br><span class="line">curl -X POST -k <span class="string">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \</span><br><span class="line">-u elastic:123456 \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;name&quot;: &quot;my-api-key&quot;,</span></span><br><span class="line"><span class="string">  &quot;expiration&quot;: &quot;1d&quot;,</span></span><br><span class="line"><span class="string">  &quot;role_descriptors&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;role-a&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;cluster&quot;: [&quot;all&quot;],</span></span><br><span class="line"><span class="string">      &quot;indices&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;names&quot;: [&quot;index-a*&quot;],</span></span><br><span class="line"><span class="string">          &quot;privileges&quot;: [&quot;read&quot;]</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;role-b&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;cluster&quot;: [&quot;all&quot;],</span></span><br><span class="line"><span class="string">      &quot;indices&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;names&quot;: [&quot;index-b*&quot;],</span></span><br><span class="line"><span class="string">          &quot;privileges&quot;: [&quot;all&quot;]</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;metadata&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;application&quot;: &quot;my-application&quot;,</span></span><br><span class="line"><span class="string">    &quot;environment&quot;: &#123;</span></span><br><span class="line"><span class="string">       &quot;level&quot;: 1,</span></span><br><span class="line"><span class="string">       &quot;trusted&quot;: true,</span></span><br><span class="line"><span class="string">       &quot;tags&quot;: [&quot;dev&quot;, &quot;staging&quot;]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># name: ApiKeyçš„åç§°</span></span><br><span class="line"><span class="comment"># expiration: ApiKeyçš„è¿‡æœŸæ—¶é—´ï¼Œæ”¯æŒçš„æ—¶é—´å•ä½ä¸ºï¼šsï¼ˆç§’ï¼‰ï¼Œmï¼ˆåˆ†é’Ÿï¼‰ï¼Œhï¼ˆå°æ—¶ï¼‰ï¼Œdï¼ˆå¤©ï¼‰ï¼Œwï¼ˆå‘¨ï¼‰ï¼ŒMï¼ˆæœˆï¼‰ï¼Œyï¼ˆå¹´ï¼‰</span></span><br><span class="line">    <span class="comment"># expirationä¸èƒ½è®¾ç½®å°äº1åˆ†é’Ÿçš„æ—¶é—´ï¼Œå¦‚æœçœç•¥expirationï¼Œåˆ™è¡¨ç¤ºæ— è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment"># role_descriptors: è§’è‰²æè¿°ç¬¦ï¼ŒåŒ…å«å¤šä¸ªè§’è‰²</span></span><br><span class="line">    <span class="comment"># role-a: è§’è‰²æè¿°ç¬¦åç§°ï¼ŒåŒ…å«é›†ç¾¤å’Œç´¢å¼•çš„æƒé™æè¿°</span></span><br><span class="line">        <span class="comment"># cluster: é›†ç¾¤æƒé™</span></span><br><span class="line">            <span class="comment"># all: è¡¨ç¤ºæ‹¥æœ‰å…¨éƒ¨é›†ç¾¤æƒé™</span></span><br><span class="line">            <span class="comment"># manage: å¯ä»¥ç®¡ç†é›†ç¾¤è®¾ç½®ã€æ¨¡æ¿å’ŒèŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡åˆ†é…ã€‚</span></span><br><span class="line">            <span class="comment"># monitor: å¯ä»¥ç›‘è§†é›†ç¾¤çš„çŠ¶æ€ã€‚</span></span><br><span class="line">            <span class="comment"># manage_security: å¯ä»¥ç®¡ç†å®‰å…¨è®¾ç½®ï¼Œå¦‚ç”¨æˆ·ã€è§’è‰²å’Œè§’è‰²æ˜ å°„ã€‚</span></span><br><span class="line">            <span class="comment"># manage_api_key: ç®¡ç† API Key</span></span><br><span class="line">        <span class="comment"># indices: ç´¢å¼•æƒé™ï¼ŒåŒ…å«nameså’Œprivilegesï¼Œ</span></span><br><span class="line">            <span class="comment"># names: è¡¨ç¤ºç´¢å¼•åç§°ï¼Œindex-a*è¡¨ç¤ºæ‰€æœ‰ä»¥index-aå¼€å¤´çš„ç´¢å¼•ï¼Œallè¡¨ç¤ºæ‰€æœ‰ç´¢å¼•</span></span><br><span class="line">            <span class="comment"># privileges: è¡¨ç¤ºç´¢å¼•æƒé™</span></span><br><span class="line">                <span class="comment"># read: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„è¯»å–æƒé™</span></span><br><span class="line">                <span class="comment"># write: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„å†™å…¥æƒé™</span></span><br><span class="line">                <span class="comment"># delete: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„åˆ é™¤æƒé™</span></span><br><span class="line">                <span class="comment"># index: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„ç´¢å¼•æƒé™</span></span><br><span class="line">                <span class="comment"># manage: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„è®¾ç½®å’Œæ˜ å°„æƒé™</span></span><br><span class="line">                <span class="comment"># monitor: è¡¨ç¤ºæ‹¥æœ‰ç´¢å¼•çš„ç›‘æ§æƒé™</span></span><br><span class="line">                <span class="comment"># create_index: è¡¨ç¤ºå…è®¸åˆ›å»ºç´¢å¼•</span></span><br><span class="line">                <span class="comment"># crud: ç»„åˆäº† read, index, delete æƒé™</span></span><br><span class="line">                <span class="comment"># all: è¡¨ç¤ºæ‹¥æœ‰å…¨éƒ¨ç´¢å¼•æƒé™</span></span><br><span class="line">            <span class="comment"># allow_restricted_indices: è¡¨ç¤ºæ˜¯å¦å…è®¸å¯¹ restricted indices(å—é™åˆ¶ç´¢å¼•ï¼Œæ¯”å¦‚ä»¥.å¼€å¤´çš„ç´¢å¼•) è¿›è¡Œæ“ä½œï¼Œtrueè¡¨ç¤ºå…è®¸ï¼Œfalseè¡¨ç¤ºä¸å…è®¸</span></span><br><span class="line"><span class="comment"># metadata: å…ƒæ•°æ®</span></span><br><span class="line">    <span class="comment"># application: è¡¨ç¤ºåº”ç”¨ç¨‹åºåç§°</span></span><br><span class="line">    <span class="comment"># environment: è¡¨ç¤ºç¯å¢ƒä¿¡æ¯</span></span><br><span class="line">        <span class="comment"># level: è¡¨ç¤ºç¯å¢ƒçº§åˆ«</span></span><br><span class="line">        <span class="comment"># trusted: è¡¨ç¤ºæ˜¯å¦å—ä¿¡ä»»</span></span><br><span class="line">        <span class="comment"># tags: è¡¨ç¤ºç¯å¢ƒæ ‡ç­¾</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;id&quot;</span> : <span class="string">&quot;-kKu0ZUBrL2GcOxX0t1R&quot;</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;my-api-key&quot;</span>,</span><br><span class="line">  <span class="string">&quot;expiration&quot;</span> : 1743066050130,</span><br><span class="line">  <span class="string">&quot;api_key&quot;</span> : <span class="string">&quot;03eNOYg_SCCHdzc0orsRvw&quot;</span>,</span><br><span class="line">  <span class="string">&quot;encoded&quot;</span> : <span class="string">&quot;LWtLdTBaVUJyTDJHY094WDB0MVI6MDNlTk9ZZ19TQ0NIZHpjMG9yc1J2dw==&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ApiKeyä¿¡æ¯ï¼Œæ ¹æ®idæŸ¥è¯¢åªä¼šè¿”å›ä¸€ä¸ªApiKeyï¼Œæ ¹æ®nameæŸ¥è¯¢ä¼šè¿”å›å¤šä¸ªApiKey</span></span><br><span class="line">curl -u elastic:123456 -k <span class="string">&#x27;https://127.0.0.1:9200/_security/api_key?id=-kKu0ZUBrL2GcOxX0t1R&amp;pretty&#x27;</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;api_keys&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;id&quot;</span> : <span class="string">&quot;-kKu0ZUBrL2GcOxX0t1R&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span> : <span class="string">&quot;my-api-key&quot;</span>,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;rest&quot;</span>,</span><br><span class="line">      <span class="string">&quot;creation&quot;</span> : 1742979650130,</span><br><span class="line">      <span class="string">&quot;expiration&quot;</span> : 1743066050130,</span><br><span class="line">      <span class="string">&quot;invalidated&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;username&quot;</span> : <span class="string">&quot;elastic&quot;</span>,</span><br><span class="line">      <span class="string">&quot;realm&quot;</span> : <span class="string">&quot;reserved&quot;</span>,</span><br><span class="line">      <span class="string">&quot;realm_type&quot;</span> : <span class="string">&quot;reserved&quot;</span>,</span><br><span class="line">      <span class="string">&quot;metadata&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;environment&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;level&quot;</span> : 1,</span><br><span class="line">          <span class="string">&quot;trusted&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="string">&quot;tags&quot;</span> : [</span><br><span class="line">            <span class="string">&quot;dev&quot;</span>,</span><br><span class="line">            <span class="string">&quot;staging&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;application&quot;</span> : <span class="string">&quot;my-application&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;role_descriptors&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;role-a&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;cluster&quot;</span> : [</span><br><span class="line">            <span class="string">&quot;all&quot;</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="string">&quot;indices&quot;</span> : [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;names&quot;</span> : [</span><br><span class="line">                <span class="string">&quot;index-a*&quot;</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="string">&quot;privileges&quot;</span> : [</span><br><span class="line">                <span class="string">&quot;read&quot;</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="string">&quot;allow_restricted_indices&quot;</span> : <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">&quot;applications&quot;</span> : [ ],</span><br><span class="line">          <span class="string">&quot;run_as&quot;</span> : [ ],</span><br><span class="line">          <span class="string">&quot;metadata&quot;</span> : &#123; &#125;,</span><br><span class="line">          <span class="string">&quot;transient_metadata&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;enabled&quot;</span> : <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;role-b&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;cluster&quot;</span> : [</span><br><span class="line">            <span class="string">&quot;all&quot;</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="string">&quot;indices&quot;</span> : [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;names&quot;</span> : [</span><br><span class="line">                <span class="string">&quot;index-b*&quot;</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="string">&quot;privileges&quot;</span> : [</span><br><span class="line">                <span class="string">&quot;all&quot;</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="string">&quot;allow_restricted_indices&quot;</span> : <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">&quot;applications&quot;</span> : [ ],</span><br><span class="line">          <span class="string">&quot;run_as&quot;</span> : [ ],</span><br><span class="line">          <span class="string">&quot;metadata&quot;</span> : &#123; &#125;,</span><br><span class="line">          <span class="string">&quot;transient_metadata&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;enabled&quot;</span> : <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°ApiKey</span></span><br><span class="line">curl -u elastic:123456 -X PUT -k <span class="string">&#x27;https://127.0.0.1:9200/_security/api_key/-kKu0ZUBrL2GcOxX0t1R?pretty&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;metadata&quot;: &#123;&#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;updated&quot;</span> : <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç½®ApiKeyæ— æ•ˆ</span></span><br><span class="line">curl -u elastic:123456 -X DELETE -k <span class="string">&#x27;https://127.0.0.1:9200/_security/api_key?pretty&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">--data <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">   &quot;ids&quot; : [ &quot;-kKu0ZUBrL2GcOxX0t1R&quot; ]</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;invalidated_api_keys&quot;</span> : [</span><br><span class="line">    <span class="string">&quot;-kKu0ZUBrL2GcOxX0t1R&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;previously_invalidated_api_keys&quot;</span> : [ ],</span><br><span class="line">  <span class="string">&quot;error_count&quot;</span> : 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨linuxä¸‹å®‰è£…Elasticsearch&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/8.17/index.html&quot;&gt;Elasticsearch&lt;/a&gt;ç‰ˆæœ¬8.17.3&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="elastic" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/"/>
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/elastic/elasticsearch/"/>
    
    
    <category term="elasticsearch" scheme="https://blog.hanqunfeng.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>npmä½¿ç”¨æ‰‹å†Œ</title>
    <link href="https://blog.hanqunfeng.com/2025/03/13/npm-study/"/>
    <id>https://blog.hanqunfeng.com/2025/03/13/npm-study/</id>
    <published>2025-03-13T13:30:05.000Z</published>
    <updated>2025-03-17T07:18:07.043Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨npm</p></li><li class="lvl-2"><p>npmç‰ˆæœ¬10.5.0</p></li></ul><span id="more"></span><h2 id="npmç®€ä»‹">npmç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>npmï¼ˆNode Package Managerï¼‰æ˜¯ Node.js çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¹Ÿæ˜¯ JavaScript ç¼–ç¨‹ç¤¾åŒºä¸­æœ€å¸¸ç”¨çš„ç®¡ç†å’Œåˆ†äº«ä»£ç çš„å·¥å…·ã€‚</p></li><li class="lvl-2"><p>å®ƒå…è®¸å¼€å‘è€…è½»æ¾åœ°å®‰è£…ã€å…±äº«ã€å’Œç®¡ç†åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„ JavaScript åŒ…ã€‚</p></li><li class="lvl-2"><p>npm åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼šå‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰å’Œ npm æ³¨å†Œè¡¨ã€‚</p></li><li class="lvl-2"><p>å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰ï¼šç”¨äºä¸æ³¨å†Œè¡¨è¿›è¡Œäº¤äº’ï¼Œå®‰è£…å’Œç®¡ç†é¡¹ç›®ä¸­çš„ä¾èµ–ã€‚</p></li><li class="lvl-2"><p>npm æ³¨å†Œè¡¨ï¼šä¸€ä¸ªåœ¨çº¿çš„æ•°æ®åº“ï¼Œå­˜å‚¨äº†æ•°ç™¾ä¸‡ä¸ªå¼€æºçš„ Node.js åŒ…ï¼Œå¼€å‘è€…å¯ä»¥åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨è¿™äº›åŒ…ã€‚</p></li></ul><h2 id="npm-çš„å®‰è£…ä¸é…ç½®">npm çš„å®‰è£…ä¸é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>npm é€šå¸¸ä¸ Node.js ä¸€èµ·å®‰è£…ï¼Œå› æ­¤å®‰è£… Node.js ä¼šè‡ªåŠ¨å®‰è£… npmã€‚</p></li><li class="lvl-2"><p>ä» <a href="https://nodejs.org/zh-cn">Node.js å®˜ç½‘</a>ä¸‹è½½å¹¶å®‰è£… Node.jsã€‚</p></li><li class="lvl-2"><p>è·Ÿéš<a href="https://nodejs.org/zh-cn/download">Node.js å®˜ç½‘â€“Download</a>çš„æç¤ºå®Œæˆ Node.js çš„å®‰è£…ï¼Œ</p></li><li class="lvl-2"><p>ç°åœ¨å®˜æ–¹æ›´æ¨èä½¿ç”¨<a href="https://github.com/nvm-sh/nvm">nvm</a>çš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å¯¹åº”ç³»ç»Ÿçš„äºŒè¿›åˆ¶åŒ…è¿›è¡Œå®‰è£…ï¼ˆæ­¤ç§æ–¹æ³•è¦å°†nodeçš„binç›®å½•é…ç½®åˆ°PATHç¯å¢ƒå˜é‡ï¼‰ï¼Œnode.jså®‰è£…å®Œæˆåï¼Œnpm ä¹Ÿä¼šä¸€èµ·å®‰è£…ã€‚</p></li><li class="lvl-2"><p>æ‰“å¼€å‘½ä»¤è¡Œæˆ–ç»ˆç«¯å·¥å…·ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ˜¯å¦æˆåŠŸå®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm -v</span><br><span class="line">node -v</span><br></pre></td></tr></table></figure><h2 id="npm-å¸¸ç”¨å‘½ä»¤">npm å¸¸ç”¨å‘½ä»¤</h2><h3 id="npm-initï¼šåˆå§‹åŒ–é¡¹ç›®">npm initï¼šåˆå§‹åŒ–é¡¹ç›®</h3><ul class="lvl-0"><li class="lvl-2"><p>npm initå‘½ä»¤ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®ï¼Œç”Ÿæˆä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«é¡¹ç›®çš„å…ƒæ•°æ®å’Œé…ç½®ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> my-project</span><br><span class="line"><span class="built_in">cd</span> my-project</span><br><span class="line">npm init</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œä¼šæŒ‰ç…§æç¤ºè¾“å…¥ä¸€äº›é¡¹ç›®ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚åç§°ã€ç‰ˆæœ¬ã€æè¿°ç­‰ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>npm init -y</code> è·³è¿‡æç¤ºï¼Œç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„package.jsonæ–‡ä»¶ã€‚</p></li></ul><h3 id="npm-createï¼šåŸºäºæ¨¡æ¿åˆ›å»ºé¡¹ç›®">npm createï¼šåŸºäºæ¨¡æ¿åˆ›å»ºé¡¹ç›®</h3><ul class="lvl-0"><li class="lvl-2"><p>npm createå‘½ä»¤ç”¨äºåŸºäºæ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºäºVueçš„Webé¡¹ç›®ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create vue@latest</span><br></pre></td></tr></table></figure><h3 id="npm-installï¼šå®‰è£…ä¾èµ–åŒ…">npm installï¼šå®‰è£…ä¾èµ–åŒ…</h3><ul class="lvl-0"><li class="lvl-2"><p>npm installå‘½ä»¤ç”¨äºå®‰è£…é¡¹ç›®ä¸­æ‰€éœ€çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚åœ¨package.jsonæ–‡ä»¶ä¸­æŒ‡å®šäº†ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…å®Œæˆåï¼Œä¼šåœ¨node_modulesç›®å½•ä¸‹ç”Ÿæˆä¾èµ–åŒ…ï¼Œå¹¶æ›´æ–°package-lock.jsonæ–‡ä»¶ã€‚</p></li><li class="lvl-2"><p>å®‰è£…æŒ‡å®šä¾èµ–åŒ…ï¼Œé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆï¼Œè‡ªåŠ¨å°†ä¾èµ–åŒ…æ·»åŠ åˆ° package.json çš„ â€œdependenciesâ€ éƒ¨åˆ†ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœéœ€è¦å®‰è£…ç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express@4.17.1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…å¼€å‘ä¾èµ–åŒ…ï¼Œå®‰è£…å¹¶å†™å…¥package.jsonçš„&quot;devDependencies&quot;ä¸­</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install express -D</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">npm install express --save-dev</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…å…¨å±€ä¾èµ–åŒ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¨å±€å®‰è£…çš„åŒ…ä¼šè¢«å®‰è£…åˆ°å…¨å±€çš„node_modulesç›®å½•ä¸‹ï¼Œä¸ä¼šè¢«å®‰è£…åˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨package.jsonä¸­</span></span><br><span class="line">npm install express -g</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">npm install express --global</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¨å±€node_modulesç›®å½•è·¯å¾„æŸ¥çœ‹</span></span><br><span class="line">npm root -g</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä»æœ¬åœ°å®‰è£…ä¾èµ–åŒ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»æœ¬åœ°å®‰è£…</span></span><br><span class="line">npm install ./path/to/local_project</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä»è¿œç¨‹Gitä»“åº“å®‰è£…ä¾èµ–åŒ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…å…¬å…±é¡¹ç›®ï¼š</span></span><br><span class="line"><span class="comment"># npm install https://github.com/user_name/node_project</span></span><br><span class="line">npm install https://github.com/trentm/json.git</span><br><span class="line"><span class="comment"># ç¼©å†™ï¼Œå¦‚æœæ˜¯gitlabä»“åº“ï¼Œåˆ™éœ€è¦ä½¿ç”¨gitlabå‰ç¼€ï¼Œæ¨èä½¿ç”¨ä¸Šé¢çš„å®Œæ•´è¯­ä¹‰ç‰ˆæœ¬</span></span><br><span class="line">npm install github:trentm/json</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ç‰¹å®šæäº¤ï¼š</span></span><br><span class="line"><span class="comment"># npm install https://github.com/user_name/node_project#commit</span></span><br><span class="line">npm install https://github.com/trentm/json.git\#6912b25272312d0f13ad32e98ebc1b4deb6334cc</span><br><span class="line"><span class="comment"># å®‰è£…ç‰¹å®šåˆ†æ”¯ï¼š</span></span><br><span class="line"><span class="comment"># npm install https://github.com/user_name/node_project#branchName</span></span><br><span class="line">npm install https://github.com/trentm/json.git\#streaming</span><br><span class="line"><span class="comment"># é€šè¿‡æ ‡ç­¾å®‰è£…ï¼š</span></span><br><span class="line"><span class="comment"># npm install https://github.com/user_name/node_project#tag</span></span><br><span class="line">npm install https://github.com/trentm/json.git\#10.0.0</span><br><span class="line"><span class="comment"># å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼š</span></span><br><span class="line"><span class="comment"># npm install https://github.com/user_name/node_project#version</span></span><br><span class="line">npm install https://github.com/trentm/json.git\#10.0.0</span><br><span class="line"><span class="comment"># å®Œæ•´çš„è¯­ä¹‰ç‰ˆæœ¬ï¼š</span></span><br><span class="line">npm install https://github.com/trentm/json.git\#semver:v10.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨gitçš„ssh repo link å®‰è£…ç§æœ‰åº“ï¼šåé¢åŒæ ·å¯ä»¥æ¥ commitã€branchNameã€tagã€versionç­‰</span></span><br><span class="line"><span class="comment"># npm install git+ssh://git@github.com:user_name/node_project.git</span></span><br><span class="line">npm install git+ssh://git@github.com/trentm/json.git</span><br></pre></td></tr></table></figure><h3 id="npm-updateï¼šæ›´æ–°ä¾èµ–åŒ…">npm updateï¼šæ›´æ–°ä¾èµ–åŒ…</h3><ul class="lvl-0"><li class="lvl-2"><p>npm updateå‘½ä»¤ç”¨äºæ›´æ–°é¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æ›´æ–°expressä¾èµ–åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ–°ç”Ÿäº§ç¯å¢ƒä¾èµ–åŒ…</span></span><br><span class="line">npm update express</span><br><span class="line"><span class="comment"># æ›´æ–°å¼€å‘ç¯å¢ƒä¾èµ–åŒ…</span></span><br><span class="line">npm update express -D</span><br><span class="line"><span class="comment"># å…¨å±€æ›´æ–°</span></span><br><span class="line">npm update express -g</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹äº†package.jsonæ–‡ä»¶ï¼Œå¹¶å¸Œæœ›æ›´æ–°ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># #ä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œå¯ä»¥å…ˆåˆ é™¤é¡¹ç›®ä¸­çš„node_modulesæ–‡ä»¶å¤¹åœ¨æ‰§è¡Œï¼Œæ­¤æ—¶å’Œ npm install ä¸€æ ·</span></span><br><span class="line">npm update</span><br></pre></td></tr></table></figure><h3 id="npm-outdateï¼šæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§">npm outdateï¼šæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§</h3><ul class="lvl-0"><li class="lvl-2"><p>npm outdateå‘½ä»¤ç”¨äºæ£€æŸ¥å“ªäº›åŒ…å¯ä»¥å‡çº§</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å½“å‰é¡¹ç›®ä¸‹å“ªäº›åŒ…å¯ä»¥å‡çº§</span></span><br><span class="line">npm outdate</span><br><span class="line"><span class="comment"># æ£€æŸ¥æŒ‡å®šåŒ…</span></span><br><span class="line">npm outdated express</span><br><span class="line"><span class="comment"># æ£€æŸ¥å…¨å±€æ¨¡å—</span></span><br><span class="line">npm outdate -g</span><br><span class="line">npm outdated -g express</span><br></pre></td></tr></table></figure><h3 id="npm-upgradeï¼šåˆ¤æ–­package-jsonå“ªäº›åŒ…éœ€è¦å‡çº§">npm-upgradeï¼šåˆ¤æ–­package.jsonå“ªäº›åŒ…éœ€è¦å‡çº§</h3><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g npm-upgrade</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ¤æ–­package.jsonå“ªäº›åŒ…éœ€è¦å‡çº§ï¼Œç”¨æˆ·ç¡®è®¤åä¼šè‡ªåŠ¨æ›´æ–°package.jsonæ–‡ä»¶ï¼Œæ­¤æ—¶åªæ˜¯æ›´æ–°æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰çœŸæ­£å‡çº§</span></span><br><span class="line">npm-upgrade</span><br><span class="line"><span class="comment"># åŸºäºpackage.jsonä¸­çš„é…ç½®è¿›è¡Œå‡çº§ï¼Œå¯ä»¥å…ˆåˆ é™¤node_moduleså†æ‰§è¡Œï¼Œæ­¤æ—¶å’Œ npm install ä¸€æ ·</span></span><br><span class="line">npm update</span><br></pre></td></tr></table></figure><h3 id="npm-listï¼šåˆ—å‡ºä¾èµ–åŒ…">npm listï¼šåˆ—å‡ºä¾èµ–åŒ…</h3><ul class="lvl-0"><li class="lvl-2"><p>npm listå‘½ä»¤ç”¨äºåˆ—å‡ºé¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦åˆ—å‡ºå½“å‰é¡¹ç›®ä¸‹çš„ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­¤æ—¶åˆ—å‡ºçš„æ˜¯package.jsonä¸­çš„dependenciesä¾èµ–åŒ…</span></span><br><span class="line">npm list</span><br><span class="line"><span class="comment"># åˆ—å‡ºå¼€å‘ä¾èµ–åŒ…ï¼Œæ­¤æ—¶ä¼šåˆ—å‡ºpackage.jsonä¸­çš„devDependencieså’Œdependenciesä¾èµ–åŒ…</span></span><br><span class="line">npm list -D</span><br><span class="line"><span class="comment"># åˆ—å‡ºæŒ‡å®šåŒ…</span></span><br><span class="line">npm list express</span><br><span class="line"><span class="comment"># åˆ—å‡ºå…¨å±€æ¨¡å—</span></span><br><span class="line">npm list -g</span><br><span class="line">npm list -g express</span><br></pre></td></tr></table></figure><h3 id="npm-uninstallï¼šå¸è½½ä¾èµ–åŒ…">npm uninstallï¼šå¸è½½ä¾èµ–åŒ…</h3><ul class="lvl-0"><li class="lvl-2"><p>npm uninstallå‘½ä»¤ç”¨äºå¸è½½é¡¹ç›®ä¸­çš„ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦å¸è½½expressä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall express</span><br><span class="line"><span class="comment"># åˆ é™¤å…¨å±€æ¨¡å—</span></span><br><span class="line">npm uninstall -g express</span><br></pre></td></tr></table></figure><h3 id="npm-searchï¼šæœç´¢ä¾èµ–åŒ…">npm searchï¼šæœç´¢ä¾èµ–åŒ…</h3><ul class="lvl-0"><li class="lvl-2"><p>npm searchå‘½ä»¤ç”¨äºæœç´¢ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æœç´¢expressä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm search express</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢ä¾èµ–åŒ…ï¼Œæ¯”å¦‚è¦æœç´¢ä»¥expresså¼€å¤´çš„ä¾èµ–åŒ…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm search /^express/</span><br></pre></td></tr></table></figure><h3 id="npm-view-npm-infoï¼šæŸ¥çœ‹åŒ…ä¿¡æ¯">npm view == npm infoï¼šæŸ¥çœ‹åŒ…ä¿¡æ¯</h3><ul class="lvl-0"><li class="lvl-2"><p>npm viewå‘½ä»¤ç”¨äºæŸ¥çœ‹åŒ…çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹expressä¾èµ–åŒ…çš„ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm view express</span><br><span class="line"><span class="comment"># æˆ–è€…ï¼Œviewä¸infoå‘½ä»¤å¯ä»¥äº’æ¢ä½¿ç”¨</span></span><br><span class="line">npm info express</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>npm viewå‘½ä»¤è¿˜å¯ä»¥æŸ¥çœ‹åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚è¦æŸ¥çœ‹expressä¾èµ–åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­¤æ—¶æˆ‘ä»¬ä»ç»“æœä¸­é€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬è¿›è¡Œå®‰è£…å³å¯</span></span><br><span class="line">npm view express versions</span><br></pre></td></tr></table></figure><h3 id="npm-homeï¼šæ‰“å¼€åŒ…çš„ä¸»é¡µ">npm homeï¼šæ‰“å¼€åŒ…çš„ä¸»é¡µ</h3><ul class="lvl-0"><li class="lvl-2"><p>æ‰“å¼€æŸä¸ª npm åŒ…çš„ä¸»é¡µï¼ˆé€šå¸¸æ˜¯ GitHub ä¸»é¡µæˆ– npm é¡µé¢ï¼‰ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm home express</span><br></pre></td></tr></table></figure><h2 id="npm-é•œåƒæº">npm é•œåƒæº</h2><ul class="lvl-0"><li class="lvl-2"><p>npm é»˜è®¤ä½¿ç”¨å®˜æ–¹çš„é•œåƒæºï¼Œä½†æ˜¯å®˜æ–¹çš„é•œåƒæºé€Ÿåº¦å¾ˆæ…¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„é•œåƒæºæ¥åŠ é€Ÿä¸‹è½½ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm å®˜æ–¹åŸå§‹é•œåƒç½‘å€æ˜¯ï¼šhttps://registry.npmjs.org/</span><br><span class="line">æ·˜å® NPM é•œåƒï¼šhttp://registry.npmmirror.com</span><br><span class="line">é˜¿é‡Œäº‘ NPM é•œåƒï¼šhttps://npm.aliyun.com</span><br><span class="line">è…¾è®¯äº‘ NPM é•œåƒï¼šhttps://mirrors.cloud.tencent.com/npm/</span><br><span class="line">åä¸ºäº‘ NPM é•œåƒï¼šhttps://mirrors.huaweicloud.com/repository/npm/</span><br><span class="line">ç½‘æ˜“ NPM é•œåƒï¼šhttps://mirrors.163.com/npm/</span><br><span class="line">ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¼€æºé•œåƒç«™ï¼šhttp://mirrors.ustc.edu.cn/</span><br><span class="line">æ¸…åå¤§å­¦å¼€æºé•œåƒç«™ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„é•œåƒæºï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config get registry</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥è®¾ç½®é•œåƒæºï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmmirror.com</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤ç”¨æˆ·é…ç½®çš„é•œåƒæºï¼Œåˆ é™¤åæ¢å¤ä¸ºé»˜è®¤é•œåƒæºï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config delete registry</span><br></pre></td></tr></table></figure><h2 id="npm-é…ç½®">npm é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹npmçš„é…ç½®ä¿¡æ¯ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼Œåªæ˜¾ç¤ºç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line">npm config list</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼Œæ˜¾ç¤ºæ‰€æœ‰é…ç½®ä¿¡æ¯åŠå…¶é»˜è®¤ç¼ºçœå€¼</span></span><br><span class="line">npm config <span class="built_in">ls</span> -l</span><br><span class="line"><span class="comment"># json æ ¼å¼ æ˜¾ç¤ºå…¨éƒ¨é…ç½®ä¿¡æ¯</span></span><br><span class="line">npm config list --json</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é»˜è®¤å…¨å±€é…ç½®åœ¨å½“å‰ç”¨æˆ·HOMEç›®å½•ä¸‹çš„.npmrcæ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å…¨å±€é…ç½®ä¿¡æ¯ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.npmrc</span><br><span class="line"><span class="built_in">cat</span> ~/.npmrc | grep registry</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª.npmrc æ–‡ä»¶å¯ä»¥ä¸ºè¯¥é¡¹ç›®å•ç‹¬è®¾ç½® npm é…ç½®ã€‚</p></li><li class="lvl-2"><p>npm config å…è®¸ä½ æ§åˆ¶ npm çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬ å®‰è£…ç›®å½•ã€ä»£ç†ã€æ—¥å¿—çº§åˆ«ã€ä¾èµ–ç®¡ç† ç­‰ã€‚</p></li><li class="lvl-2"><p>ä½ å¯ä»¥ä½¿ç”¨ <code>npm config get &lt;key&gt;</code> æŸ¥çœ‹å€¼ï¼Œ<code>npm config set &lt;key&gt; &lt;value&gt;</code> è¿›è¡Œä¿®æ”¹ï¼Œ<code>npm config delete &lt;key&gt;</code> åˆ é™¤è®¾ç½®ã€‚</p></li><li class="lvl-2"><p>npmå¸¸ç”¨é…ç½®</p></li></ul><table><thead><tr><th>é…ç½®é¡¹</th><th>ä½œç”¨</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>prefix</td><td>è®¾ç½® npm å…¨å±€å®‰è£…çš„è·¯å¾„ï¼ˆnpm install -g å½±å“çš„ç›®å½•ï¼‰</td><td>ç¯å¢ƒå˜é‡ NODE_HOME æˆ– /usr/localï¼ˆç³»ç»Ÿï¼‰</td></tr><tr><td>cache</td><td>npm çš„ç¼“å­˜ç›®å½•</td><td>~/.npm</td></tr><tr><td>registry</td><td>æŒ‡å®š npm çš„åŒ…ç®¡ç†ä»“åº“åœ°å€ï¼ˆå¦‚å®˜æ–¹ã€æ·˜å®é•œåƒï¼‰</td><td><a href="https://registry.npmjs.org/">https://registry.npmjs.org/</a></td></tr><tr><td>strict-ssl</td><td>æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨ HTTPS è¿›è¡Œ npm æ“ä½œ</td><td>true</td></tr><tr><td>proxy</td><td>é…ç½® HTTP ä»£ç†</td><td>null</td></tr><tr><td>https-proxy</td><td>é…ç½® HTTPS ä»£ç†</td><td>null</td></tr><tr><td>init-author-name</td><td>è®¾ç½® package.json é»˜è®¤ä½œè€…åç§°</td><td>â€œâ€</td></tr><tr><td>init-author-email</td><td>è®¾ç½® package.json é»˜è®¤ä½œè€…é‚®ç®±</td><td>â€œâ€</td></tr><tr><td>init-author-url</td><td>è®¾ç½® package.json é»˜è®¤ä½œè€…ç½‘ç«™</td><td>â€œâ€</td></tr><tr><td>init-license</td><td>è®¾ç½® package.json é»˜è®¤è®¸å¯è¯</td><td>â€œISCâ€</td></tr><tr><td>init-version</td><td>package.json é»˜è®¤ç‰ˆæœ¬å·</td><td>â€œ1.0.0â€</td></tr><tr><td>save-exact</td><td>true æ—¶ï¼Œå®‰è£…ä¾èµ–æ—¶ä¸ä½¿ç”¨ ^ æˆ– ~ï¼Œç›´æ¥é”å®šç‰ˆæœ¬</td><td>false</td></tr><tr><td>engine-strict</td><td>æ˜¯å¦å¼ºåˆ¶åŒ¹é… package.json çš„ engines å­—æ®µ</td><td>false</td></tr><tr><td>loglevel</td><td>è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼ˆsilent, error, warn, notice, info, verbose, sillyï¼‰</td><td>notice</td></tr><tr><td>fund</td><td>æ˜¯å¦æ˜¾ç¤º package çš„èµ„é‡‘æ”¯æŒä¿¡æ¯</td><td>true</td></tr><tr><td>audit</td><td>æ˜¯å¦å¯ç”¨å®‰å…¨å®¡è®¡</td><td>true</td></tr></tbody></table><h3 id="npm-config-save-exact">npm config save-exact</h3><ul class="lvl-0"><li class="lvl-2"><p>æ¨èé…ç½®ä¸º trueï¼Œé¿å…å› ä¸ºç‰ˆæœ¬æ›´æ–°å¯¼è‡´ä¾èµ–åŒ…ç‰ˆæœ¬ä¸åŒ¹é…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> save-exact <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="npm-config-loglevel">npm config loglevel</h3><ul class="lvl-0"><li class="lvl-2"><p>loglevel å¯é€‰å€¼</p></li></ul><table><thead><tr><th>çº§åˆ«</th><th>è¯´æ˜</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>silent</td><td>ä¸è¾“å‡ºä»»ä½•æ—¥å¿—ï¼ˆé™¤éå‘ç”Ÿé”™è¯¯ï¼‰</td><td>é€‚ç”¨äº CI/CD éœ€è¦æœ€å°‘æ—¥å¿—çš„ç¯å¢ƒ</td></tr><tr><td>error</td><td>ä»…æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯</td><td>åªå…³å¿ƒ npm è¿è¡Œæ˜¯å¦å‡ºé”™</td></tr><tr><td>warn</td><td>æ˜¾ç¤ºè­¦å‘Šå’Œé”™è¯¯</td><td>å‘ç°æ½œåœ¨é—®é¢˜ä½†ä¸å½±å“ä½¿ç”¨</td></tr><tr><td>notice (é»˜è®¤)</td><td>æ˜¾ç¤ºå…³é”®ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯</td><td>npm é»˜è®¤å€¼ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯</td></tr><tr><td>http</td><td>è®°å½• HTTP è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯</td><td>ç”¨äºè°ƒè¯• npm ä¸‹è½½é€Ÿåº¦é—®é¢˜</td></tr><tr><td>info</td><td>æ˜¾ç¤ºä¸€èˆ¬ä¿¡æ¯ã€ä¾èµ–å®‰è£…æƒ…å†µç­‰</td><td>é€‚ç”¨äºä¸€èˆ¬å¼€å‘è€…è°ƒè¯•</td></tr><tr><td>verbose</td><td>è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯</td><td>é€‚ç”¨äºæ·±å…¥åˆ†æ npm è¿è¡Œæƒ…å†µ</td></tr><tr><td>silly</td><td>æœ€è¯¦ç»†çš„æ—¥å¿—ï¼ŒåŒ…å«æ‰€æœ‰è°ƒè¯•ä¿¡æ¯</td><td>é€‚ç”¨äº npm å¼€å‘è€…æˆ–æç«¯è°ƒè¯•éœ€æ±‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è®¾ç½®æ–¹æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> loglevel verbose</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸´æ—¶ä½¿ç”¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">npm --loglevel verbose install</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">npm -<span class="built_in">dd</span> install</span><br><span class="line"></span><br><span class="line"><span class="comment">#  æ”¯æŒå¿«æ·æ–¹å¼çš„å€¼ï¼š</span></span><br><span class="line"><span class="comment"># â€¢ -s, --silent: --loglevel silent</span></span><br><span class="line"><span class="comment"># â€¢ -q, --quiet: --loglevel warn</span></span><br><span class="line"><span class="comment"># â€¢ -d: --loglevel info</span></span><br><span class="line"><span class="comment"># â€¢ -dd, --verbose: --loglevel verbose</span></span><br><span class="line"><span class="comment"># â€¢ -ddd: --loglevel silly</span></span><br></pre></td></tr></table></figure><h3 id="npm-config-timing">npm config timing</h3><ul class="lvl-0"><li class="lvl-2"><p>timing æ˜¯ npm çš„ä¸€ä¸ª æ—¥å¿—è¾“å‡ºé…ç½®é¡¹ï¼Œç”¨äºæ§åˆ¶æ˜¯å¦åœ¨å‘½ä»¤æ‰§è¡Œæ—¶æ˜¾ç¤ºè¯¦ç»†çš„æ—¶é—´ä¿¡æ¯ï¼Œé»˜è®¤å€¼ä¸º falseã€‚</p></li><li class="lvl-2"><p>å½“ timing è®¾ä¸º true æ—¶ï¼Œnpm ä¼šåœ¨å‘½ä»¤æ‰§è¡Œç»“æŸå æ‰“å°è¯¦ç»†çš„æ—¶é—´ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š</p><ul class="lvl-2"><li class="lvl-6">æ¯ä¸ªå­ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼ˆå¦‚è§£æ package.jsonã€è§£æ node_modulesã€ä¸‹è½½ä¾èµ–ç­‰ï¼‰</li><li class="lvl-6">ç½‘ç»œè¯·æ±‚çš„è€—æ—¶</li><li class="lvl-6">ä¾èµ–è§£æå’Œå®‰è£…çš„è€—æ—¶</li><li class="lvl-6">æ•´ä½“æ‰§è¡Œçš„æ—¶é—´å¼€é”€</li></ul></li><li class="lvl-2"><p>è¿™å¯¹åˆ†æ npm æ€§èƒ½ã€ä¼˜åŒ–ä¾èµ–å®‰è£…é€Ÿåº¦éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§é¡¹ç›®æˆ– CI/CD ç¯å¢ƒä¸­ã€‚</p></li><li class="lvl-2"><p>å¯ç”¨ timing</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> timing <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸´æ—¶å¯ç”¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm --timing install</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é€‚ç”¨åœºæ™¯</p><ul class="lvl-2"><li class="lvl-6">åˆ†æ npm å‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼Œä¼˜åŒ–æ„å»ºé€Ÿåº¦</li><li class="lvl-6">CI/CD ç¯å¢ƒä¸­æ’æŸ¥ npm å®‰è£…å˜æ…¢çš„åŸå› </li><li class="lvl-6">æ’æŸ¥ npm ä¾èµ–è§£æã€å®‰è£…æˆ–ä¸‹è½½è¿‡ç¨‹çš„æ€§èƒ½ç“¶é¢ˆ</li></ul></li><li class="lvl-2"><p>ä¸€èˆ¬æ—¥å¸¸å¼€å‘ï¼šæ—¥å¿—ä¼šå˜é•¿ï¼Œå¯èƒ½å½±å“å¯è¯»æ€§ï¼Œæ‰€ä»¥å†æ²¡æœ‰é‡åˆ°é—®é¢˜æ—¶ä¸å»ºè®®å¼€å¯</p></li></ul><h2 id="npmã€pnpmã€yarn-ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«">npmã€pnpmã€yarn ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™ä¸‰è€…éƒ½æ˜¯ JavaScript ç”Ÿæ€ä¸­çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºå®‰è£…ã€ç®¡ç†å’Œè¿è¡Œ Node.js é¡¹ç›®çš„ä¾èµ–ã€‚å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š</p><ul class="lvl-2"><li class="lvl-6">npmï¼ˆNode Package Managerï¼‰æ˜¯ Node.js å®˜æ–¹è‡ªå¸¦çš„åŒ…ç®¡ç†å·¥å…·ã€‚</li><li class="lvl-6"><a href="https://classic.yarnpkg.com/en/docs">yarnï¼ˆYet Another Resource Negotiatorï¼‰</a>æ˜¯ Facebook å¼€å‘çš„æ›¿ä»£ npm çš„å·¥å…·ï¼Œæä¾›æ›´å¿«ã€æ›´å®‰å…¨çš„ä¾èµ–ç®¡ç†ã€‚</li><li class="lvl-6"><a href="https://pnpm.io/zh/">pnpmï¼ˆPerformant npmï¼‰</a>æ˜¯ä¸€ä¸ªæ›´é«˜æ•ˆçš„ npm æ›¿ä»£å“ï¼Œä½¿ç”¨ç¡¬é“¾æ¥å’Œå»é‡æœºåˆ¶æ¥å‡å°‘ç£ç›˜å ç”¨å¹¶åŠ å¿«å®‰è£…é€Ÿåº¦ã€‚</li></ul></li><li class="lvl-2"><p>npmã€pnpmã€yarn çš„ä¸»è¦åŒºåˆ«</p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>npm</th><th>yarn</th><th>pnpm</th></tr></thead><tbody><tr><td>é»˜è®¤åŒ…ç®¡ç†æ–¹å¼</td><td>ç›´æ¥å®‰è£…åˆ° node_modules/</td><td>ç›´æ¥å®‰è£…åˆ° node_modules/</td><td>ä½¿ç”¨ ç¡¬é“¾æ¥ + å…±äº«ä¾èµ–ï¼Œå ç”¨æ›´å°‘ç£ç›˜</td></tr><tr><td>å®‰è£…é€Ÿåº¦</td><td>5+ ç‰ˆæœ¬åé€Ÿåº¦è¾ƒå¿«ï¼Œä½†ä¾èµ–è§£æä»æœ‰æ€§èƒ½é—®é¢˜</td><td>é€Ÿåº¦è¾ƒå¿«ï¼Œæ”¯æŒå¹¶è¡Œä¸‹è½½</td><td>æœ€å¿«ï¼Œå»é‡èƒ½åŠ›å¼º</td></tr><tr><td>ç£ç›˜å ç”¨</td><td>è¾ƒå¤§ï¼ˆæ¯ä¸ªé¡¹ç›®éƒ½ä¼šå­˜ä¸€ä»½å®Œæ•´çš„ä¾èµ–ï¼‰</td><td>è¾ƒå¤§ï¼ˆå’Œ npm ç±»ä¼¼ï¼‰</td><td>æœ€å°ï¼ˆå…±äº«å…¨å±€ç¼“å­˜ï¼Œå¤šä¸ªé¡¹ç›®å…±ç”¨ä¾èµ–ï¼‰</td></tr><tr><td>é”æ–‡ä»¶</td><td>package-lock.json</td><td>yarn.lock</td><td>pnpm-lock.yaml</td></tr><tr><td>å¹¶å‘å®‰è£…</td><td>æ”¯æŒï¼ˆnpm 5+ ä¼˜åŒ–ï¼‰</td><td>æ”¯æŒï¼ˆæ›´å¿«ï¼‰</td><td>æ”¯æŒï¼ˆæœ€ä¼˜åŒ–ï¼‰</td></tr><tr><td>å…¨å±€ç¼“å­˜</td><td>æ”¯æŒï¼ˆä½†é¡¹ç›®ä»ä¼šå­˜å‰¯æœ¬ï¼‰</td><td>æ”¯æŒï¼ˆä»ä¼šæ‹·è´åˆ° node_modules/ï¼‰</td><td>å¼ºåˆ¶å¯ç”¨ï¼ˆå¤šä¸ªé¡¹ç›®å…±ç”¨ä¾èµ–ï¼ŒèŠ‚çœç©ºé—´ï¼‰</td></tr><tr><td>monorepoï¼ˆå¤šåŒ…ç®¡ç†ï¼‰</td><td>éœ€è¦æ‰‹åŠ¨é…ç½®</td><td>æ”¯æŒ Workspaces</td><td>åŸç”Ÿæ”¯æŒ Workspacesï¼ˆæœ€å¼ºå¤§ï¼‰</td></tr><tr><td>å‘½ä»¤å…¼å®¹æ€§</td><td>æ ‡å‡†</td><td>å…¼å®¹ npmï¼Œéƒ¨åˆ†ä¸åŒ</td><td>å…¼å®¹ npmï¼Œå¤§éƒ¨åˆ†å‘½ä»¤ç›¸åŒ</td></tr><tr><td>è‡ªåŠ¨ä¿®å¤ package.json</td><td>æ˜¯</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>ç”Ÿæ€å…¼å®¹æ€§</td><td>å®˜æ–¹æ ‡å‡†ï¼Œå…¼å®¹æ€§æœ€å¥½</td><td>å…¼å®¹ npmï¼Œä½†éƒ¨åˆ†ç‰¹æ€§ä¸åŒ</td><td>å…¼å®¹ npmï¼Œä½†é‡‡ç”¨ä¸åŒçš„ä¾èµ–ç®¡ç†æ–¹å¼</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¸¸è§å‘½ä»¤å¯¹æ¯”</p></li></ul><table><thead><tr><th>ä»»åŠ¡</th><th>npm</th><th>yarn</th><th>pnpm</th></tr></thead><tbody><tr><td>åˆå§‹åŒ–é¡¹ç›®</td><td>npm init</td><td>yarn init</td><td>pnpm init</td></tr><tr><td>å®‰è£…ä¾èµ–</td><td>npm install</td><td>yarn install</td><td>pnpm install</td></tr><tr><td>å®‰è£…ç‰¹å®šä¾èµ–</td><td>npm install lodash</td><td>yarn add lodash</td><td>pnpm add lodash</td></tr><tr><td>å®‰è£…å¼€å‘ä¾èµ–</td><td>npm install lodash -D</td><td>yarn add lodash -D</td><td>pnpm add lodash -D</td></tr><tr><td>åˆ é™¤ä¾èµ–</td><td>npm uninstall lodash</td><td>yarn remove lodash</td><td>pnpm remove lodash</td></tr><tr><td>æ›´æ–°ä¾èµ–</td><td>npm update lodash</td><td>yarn upgrade lodash</td><td>pnpm update lodash</td></tr><tr><td>å…¨å±€å®‰è£…</td><td>npm install -g serve</td><td>yarn global add serve</td><td>pnpm add -g serve</td></tr><tr><td>è¿è¡Œè„šæœ¬</td><td>npm run dev</td><td>yarn dev</td><td>pnpm dev</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ npmã€yarnã€pnpmï¼Ÿ</p><ul class="lvl-2"><li class="lvl-6"><p>âœ… ä½¿ç”¨ pnpmï¼ˆæ¨èï¼‰ï¼š<br>1.ä½ å¸Œæœ›å‡å°‘ç£ç›˜å ç”¨ã€åŠ å¿«å®‰è£…é€Ÿåº¦<br>2.ä½ æ­£åœ¨å¼€å‘ monorepoï¼ˆå¤šåŒ…ï¼‰é¡¹ç›®<br>3.ä½ å¸Œæœ›æ›´é«˜æ•ˆåœ°ç®¡ç†ä¾èµ–</p></li><li class="lvl-6"><p>âœ… ä½¿ç”¨ yarnï¼š<br>1.ä½ å¸Œæœ›æ›´å¿«çš„å®‰è£…é€Ÿåº¦ï¼Œä½†åˆä¸æƒ³æ”¹å˜ npm ä¼ ç»Ÿç»“æ„<br>2.ä½ çš„å›¢é˜Ÿä¹ æƒ¯ä½¿ç”¨ yarn.lock æ–‡ä»¶<br>3.ä½ åœ¨ç”¨ React Nativeï¼ˆå®˜æ–¹æ¨è yarnï¼‰</p></li><li class="lvl-6"><p>âœ… ä½¿ç”¨ npmï¼ˆé€‚åˆç®€å•é¡¹ç›®ï¼‰ï¼š<br>1.ä½ å¸Œæœ›ä½¿ç”¨ Node.js å®˜æ–¹çš„é»˜è®¤å·¥å…·<br>2.ä½ ä¸æƒ³å®‰è£…é¢å¤–çš„åŒ…ç®¡ç†å·¥å…·<br>3.ä½ åœ¨å¼€å‘å°å‹é¡¹ç›®ï¼Œä¸éœ€è¦ workspaces</p></li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨npm&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;npmç‰ˆæœ¬10.5.0&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="npm" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/npm/"/>
    
    <category term="nodejs" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/npm/nodejs/"/>
    
    
    <category term="npm" scheme="https://blog.hanqunfeng.com/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>Hexo-Next ä¸»é¢˜çš„å›¾å½¢å·¥å…· -- Mermaid</title>
    <link href="https://blog.hanqunfeng.com/2025/01/02/mermaid/"/>
    <id>https://blog.hanqunfeng.com/2025/01/02/mermaid/</id>
    <published>2025-01-02T13:55:05.000Z</published>
    <updated>2025-01-03T09:49:43.412Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %--><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://mermaid.js.org/intro/">Mermaid</a> æ˜¯ä¸€ä¸ªæ”¯æŒåœ¨Markdownæ–‡æ¡£ä¸­ç»˜åˆ¶æµç¨‹å›¾ã€ç”˜ç‰¹å›¾ã€åºåˆ—å›¾ç­‰å›¾å½¢çš„å·¥å…·ã€‚å®ƒåŸºäºJavaScriptå®ç°ï¼Œèƒ½å¤Ÿå°†Markdownä¸­çš„å…ƒç´ æ¸²æŸ“æˆHTMLå…ƒç´ ï¼Œä»è€Œåœ¨ç½‘é¡µä¸Šç›´è§‚åœ°å±•ç¤ºå„ç§å›¾è¡¨â€Œ</p></li><li class="lvl-2"><p><a href="https://theme-next.js.org/docs/tag-plugins/mermaid">Nextä¸»é¢˜ä¸­ä½¿ç”¨Mermaidè¯´æ˜</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ <code>Hexo-Next</code> ä¸»é¢˜ä¸­ä½¿ç”¨ <code>Mermaid</code></p></li></ul><span id="more"></span><h2 id="é…ç½®å’Œä½¿ç”¨æ–¹æ³•">é…ç½®å’Œä½¿ç”¨æ–¹æ³•</h2><ul class="lvl-0"><li class="lvl-2"><p>NexT config file ä¸­æ‰¾åˆ°<code>mermaid</code>é…ç½®ï¼Œå¹¶è®¾ç½®ä¸º<code>true</code>ï¼Œ<code>theme</code> å¯ä»¥è®¾ç½®æµ…è‰²å’Œæ·±è‰²èƒŒæ™¯çš„æ ·å¼ï¼Œå…±æœ‰4ä¸ªå¯ç”¨é€‰é¡¹</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mermaid:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Available themes: default | dark | forest | neutral</span></span><br><span class="line">  <span class="attr">theme:</span></span><br><span class="line">    <span class="attr">light:</span> <span class="string">dark</span></span><br><span class="line">    <span class="attr">dark:</span> <span class="string">dark</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨æ–¹æ³•ï¼Œå…¶ä¸­mermaidä¸endmermaidæ˜¯å›ºå®šæ­é…ï¼Œtype ç”¨äºè®¾ç½®å›¾å½¢çš„ç§ç±»ï¼Œå¦‚æµç¨‹å›¾ã€æ—¶åºå›¾ã€ç”˜ç‰¹å›¾ç­‰ï¼Œä¸‹é¢ç¤ºä¾‹ä¸­ä¼šä»‹ç»</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid type %&#125;</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æœ‰äº›å°ä¼™ä¼´å–œæ¬¢ä½¿ç”¨ä»£ç å—çš„å½¢å¼ï¼Œä½¿ç”¨æ—¶å»æ‰å‰é¢çš„<code>#</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#```mermaid</span><br><span class="line">type</span><br><span class="line"></span><br><span class="line">#```</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä½†æ˜¯æ­¤æ—¶éœ€è¦åœ¨ Hexo config file ä¸­æ‰¾åˆ°<code>highlight</code>ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œæ‰ä¼šä½¿ä»£ç å—çš„å½¢å¼ç”Ÿæ•ˆ</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight:</span></span><br><span class="line">  <span class="attr">exclude_languages:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mermaid</span></span><br></pre></td></tr></table></figure><h2 id="å›¾å½¢ç¤ºä¾‹">å›¾å½¢ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œåªä»‹ç»å¸¸ç”¨çš„ä¸€äº›å›¾è¡¨ï¼Œæ›´å¤šå›¾è¡¨çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒ<a href="https://mermaid.js.org/intro/">Mermaidå¸®åŠ©æ–‡æ¡£</a></p></li></ul><h3 id="Flowchart">Flowchart</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶æµç¨‹å›¾ï¼Œæ”¯æŒæ–¹å‘ï¼ˆä¾‹å¦‚ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹ï¼‰å’ŒèŠ‚ç‚¹é—´å…³ç³»çš„å®šä¹‰ã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/flowchart.html">Mermaid Flowchart</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;graph TD&quot;</code>æˆ–è€…<code>&quot;graph LR&quot;</code>ï¼Œåˆ†åˆ«è¡¨ç¤ºä»ä¸Šåˆ°ä¸‹å’Œä»å·¦åˆ°å³çš„æ–¹å‘</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- æµç¨‹å›¾æ–¹å‘:</span><br><span class="line">  - TB - ä»ä¸Šåˆ°ä¸‹</span><br><span class="line">  - TD - è‡ªä¸Šè€Œä¸‹ï¼Œç­‰åŒäºTB</span><br><span class="line">  - BT - ä»ä¸‹åˆ°ä¸Š</span><br><span class="line">  - RL - ä»å³åˆ°å·¦</span><br><span class="line">  - LR - ä»å·¦åˆ°å³</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>&quot;graph TD&quot;</code>ï¼šä»ä¸Šåˆ°ä¸‹</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid graph TD %&#125;</span><br><span class="line">A[Hard] --&gt;|Text| B(Round)</span><br><span class="line">B --&gt; C&#123;Decision&#125;</span><br><span class="line">C --&gt;|One| D[Result 1]</span><br><span class="line">C --&gt;|Two| E[Result 2]</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">graph TDA[Hard] --&gt;|Text| B(Round)B --&gt; C&#123;Decision&#125;C --&gt;|One| D[Result 1]C --&gt;|Two| E[Result 2]</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">graph TDï¼Œå®šä¹‰ä¸€ä¸ªä»ä¸Šåˆ°ä¸‹çš„æµç¨‹å›¾ã€‚</span><br><span class="line">TD æ˜¯ Top to Down çš„ç¼©å†™ï¼Œè¡¨ç¤ºæµç¨‹å›¾ä»ä¸Šå‘ä¸‹æ’åˆ—ã€‚</span><br><span class="line"></span><br><span class="line">A[Hard] --&gt;|Text| B(Round)ï¼Œå®šä¹‰äº†ä¸€ä¸ªèŠ‚ç‚¹ Aï¼Œæ˜¾ç¤ºä¸º Hardã€‚</span><br><span class="line">ä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç®­å¤´ --&gt;|Text| æŒ‡å‘èŠ‚ç‚¹ Bï¼Œç®­å¤´ä¸Šçš„æ ‡ç­¾ä¸º Textã€‚</span><br><span class="line">èŠ‚ç‚¹ B è¢«å®šä¹‰ä¸º Roundï¼Œè¿™æ˜¯ä¸€ä¸ªæ¤­åœ†å½¢èŠ‚ç‚¹ã€‚</span><br><span class="line"></span><br><span class="line">B --&gt; C&#123;Decision&#125;ï¼ŒèŠ‚ç‚¹ B æŒ‡å‘èŠ‚ç‚¹ Cã€‚</span><br><span class="line">èŠ‚ç‚¹ C è¢«å®šä¹‰ä¸º Decisionï¼Œè¿™æ˜¯ä¸€ä¸ªå†³ç­–èŠ‚ç‚¹ï¼Œç”¨å¤§æ‹¬å· &#123;&#125; è¡¨ç¤ºã€‚</span><br><span class="line"></span><br><span class="line">C --&gt;|One| D[Result 1]ï¼Œå†³ç­–èŠ‚ç‚¹ C çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå¸¦æ ‡ç­¾ Oneï¼ŒæŒ‡å‘èŠ‚ç‚¹ Dã€‚</span><br><span class="line">èŠ‚ç‚¹ D æ˜¾ç¤ºä¸º Result 1ï¼Œè¿™æ˜¯ä¸€ä¸ªçŸ©å½¢èŠ‚ç‚¹ã€‚</span><br><span class="line"></span><br><span class="line">C --&gt;|Two| E[Result 2]ï¼Œå†³ç­–èŠ‚ç‚¹ C çš„å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œå¸¦æ ‡ç­¾ Twoï¼ŒæŒ‡å‘èŠ‚ç‚¹ Eã€‚</span><br><span class="line">èŠ‚ç‚¹ E æ˜¾ç¤ºä¸º Result 2ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªçŸ©å½¢èŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>&quot;graph LR&quot;</code>ï¼šä»å·¦åˆ°å³</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid graph LR %&#125;</span><br><span class="line">A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))</span><br><span class="line">A --&gt; C(åœ†è§’é•¿æ–¹å½¢)</span><br><span class="line">B --&gt; D&#123;è±å½¢&#125;</span><br><span class="line">C --&gt; D</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">graph LRA[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))A --&gt; C(åœ†è§’é•¿æ–¹å½¢)B --&gt; D&#123;è±å½¢&#125;C --&gt; D</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">graph LRï¼Œå®šä¹‰æµç¨‹å›¾çš„æ–¹å‘æ˜¯ä»å·¦åˆ°å³ï¼ˆLeft to Rightï¼‰ã€‚</span><br><span class="line">èŠ‚ç‚¹å’Œç®­å¤´ä»å·¦å‘å³æ’åˆ—ã€‚</span><br><span class="line"></span><br><span class="line">A[é•¿æ–¹å½¢] -- é“¾æ¥ --&gt; B((åœ†))ï¼Œå®šä¹‰äº†èŠ‚ç‚¹ A å’ŒèŠ‚ç‚¹ Bã€‚</span><br><span class="line">A æ˜¯ä¸€ä¸ªé•¿æ–¹å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œé•¿æ–¹å½¢â€ã€‚</span><br><span class="line">B æ˜¯ä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ï¼Œå†…å®¹ä¸ºç©ºã€‚</span><br><span class="line">å®ƒä»¬ä¹‹é—´é€šè¿‡ä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç®­å¤´ -- é“¾æ¥ --&gt; è¿æ¥ï¼Œç®­å¤´ä¸Šæ ‡æ³¨äº†â€œé“¾æ¥â€ã€‚</span><br><span class="line"></span><br><span class="line">A --&gt; C(åœ†è§’é•¿æ–¹å½¢)ï¼ŒèŠ‚ç‚¹ A æŒ‡å‘èŠ‚ç‚¹ Cã€‚</span><br><span class="line">C æ˜¯ä¸€ä¸ªåœ†è§’é•¿æ–¹å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œåœ†è§’é•¿æ–¹å½¢â€ã€‚</span><br><span class="line"></span><br><span class="line">B --&gt; D&#123;è±å½¢&#125;ï¼ŒèŠ‚ç‚¹ B æŒ‡å‘èŠ‚ç‚¹ Dã€‚</span><br><span class="line">D æ˜¯ä¸€ä¸ªè±å½¢èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå†…å®¹ä¸ºâ€œè±å½¢â€ã€‚</span><br><span class="line"></span><br><span class="line">C --&gt; Dï¼ŒèŠ‚ç‚¹ C ä¹ŸæŒ‡å‘èŠ‚ç‚¹ Dï¼Œç®­å¤´ä¸å¸¦æ ‡ç­¾ã€‚</span><br><span class="line"></span><br><span class="line">èŠ‚ç‚¹ç±»å‹å’Œå½¢çŠ¶</span><br><span class="line">é•¿æ–¹å½¢ [] ï¼šå¦‚ A[é•¿æ–¹å½¢]ï¼Œæ˜¯é»˜è®¤çš„çŸ©å½¢èŠ‚ç‚¹ã€‚</span><br><span class="line">åœ†å½¢ (()) ï¼šå¦‚ B((åœ†))ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ã€‚</span><br><span class="line">åœ†è§’é•¿æ–¹å½¢ () ï¼šå¦‚ C(åœ†è§’é•¿æ–¹å½¢)ï¼Œç”¨äºè¡¨ç¤ºåœ†è§’çŸ©å½¢èŠ‚ç‚¹ã€‚</span><br><span class="line">è±å½¢ &#123;&#125; ï¼šå¦‚ D&#123;è±å½¢&#125;ï¼Œç”¨äºè¡¨ç¤ºå†³ç­–ç‚¹æˆ–æ¡ä»¶åˆ†æ”¯ã€‚</span><br></pre></td></tr></table></figure><h3 id="Sequence-Diagram">Sequence Diagram</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶æ—¶åºå›¾ï¼Œæ˜¾ç¤ºå¤šä¸ªå®ä½“ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼ŒåŒ…æ‹¬æ¶ˆæ¯ã€æ—¶é—´ã€çŠ¶æ€å’Œæ•°æ®äº¤æ¢ã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/sequenceDiagram.html">Mermaid Sequence Diagram</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;sequenceDiagram&quot;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid sequenceDiagram %&#125;</span><br><span class="line">Alice-&gt;&gt;John: Hello John, how are you?</span><br><span class="line">loop Healthcheck</span><br><span class="line">    John-&gt;&gt;John: Fight against hypochondria</span><br><span class="line">end</span><br><span class="line">Note right of John: Rational thoughts!</span><br><span class="line">John--&gt;&gt;Alice: Great!</span><br><span class="line">John-&gt;&gt;Bob: How about you?</span><br><span class="line">Bob--&gt;&gt;John: Jolly good!</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">sequenceDiagramAlice-&gt;&gt;John: Hello John, how are you?loop Healthcheck    John-&gt;&gt;John: Fight against hypochondriaendNote right of John: Rational thoughts!John--&gt;&gt;Alice: Great!John-&gt;&gt;Bob: How about you?Bob--&gt;&gt;John: Jolly good!</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬ç»“æ„è¯´æ˜</span><br><span class="line">sequenceDiagram: å®šä¹‰ä¸€ä¸ªåºåˆ—å›¾ï¼Œè¡¨ç¤ºæ¶ˆæ¯å’Œäº‹ä»¶çš„æ—¶é—´é¡ºåºã€‚</span><br><span class="line">å‚ä¸è€…</span><br><span class="line">    Aliceã€John å’Œ Bob æ˜¯å‚ä¸è€…ã€‚</span><br><span class="line">    æ¯ä¸ªå‚ä¸è€…åœ¨å›¾ä¸­ä¼šä»¥å‚ç›´æ’åˆ—çš„å½¢å¼æ˜¾ç¤ºã€‚</span><br><span class="line">æ¶ˆæ¯å’Œç®­å¤´</span><br><span class="line">    -&gt;&gt; è¡¨ç¤ºä¸€ä¸ªæ¶ˆæ¯çš„å‘é€ï¼Œæ–¹å‘ç”±ç®­å¤´å†³å®šã€‚</span><br><span class="line">    æ¶ˆæ¯å†…å®¹å†™åœ¨ç®­å¤´æ—è¾¹ã€‚</span><br><span class="line">å¾ªç¯ï¼ˆloopï¼‰</span><br><span class="line">    ä½¿ç”¨ loop å®šä¹‰ä¸€ä¸ªå¾ªç¯å—ï¼Œå¾ªç¯ä¸­çš„æ¶ˆæ¯ä¼šé‡å¤æ‰§è¡Œï¼Œè¡¨ç¤ºæŸç§æŒç»­è¡Œä¸ºã€‚</span><br><span class="line">å¤‡æ³¨ï¼ˆNoteï¼‰</span><br><span class="line">    Note right of John å®šä¹‰äº†ä¸€æ¡å¤‡æ³¨ï¼Œæ˜¾ç¤ºåœ¨ John çš„å³ä¾§ï¼Œç”¨æ¥è¡¥å……è¯´æ˜ã€‚</span><br><span class="line"></span><br><span class="line">ä»£ç é€æ­¥è§£æ</span><br><span class="line">Alice-&gt;&gt;John: Hello John, how are you?</span><br><span class="line">    è¡¨ç¤º Alice ç»™ John å‘é€ä¸€æ¡æ¶ˆæ¯ï¼šâ€œHello John, how are you?â€</span><br><span class="line">loop Healthcheck</span><br><span class="line">    å®šä¹‰ä¸€ä¸ªå¾ªç¯å—ï¼Œæ ‡é¢˜ä¸ºâ€œHealthcheckâ€ï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚</span><br><span class="line">    å¾ªç¯å†…å®¹æ˜¯ï¼š</span><br><span class="line">        John-&gt;&gt;John: Fight against hypochondria</span><br><span class="line">        è¡¨ç¤º John è‡ªå·±å‘è‡ªå·±å‘é€ä¸€æ¡æ¶ˆæ¯ï¼šâ€œFight against hypochondriaâ€ï¼ˆä¸ç–‘ç—…ç—‡æŠ—äº‰ï¼‰ã€‚</span><br><span class="line">Note right of John: Rational thoughts!</span><br><span class="line">    å®šä¹‰äº†ä¸€æ¡å¤‡æ³¨ï¼Œæ˜¾ç¤ºåœ¨ John çš„å³ä¾§ã€‚</span><br><span class="line">    å¤‡æ³¨å†…å®¹ä¸ºï¼šâ€œRational thoughts!â€ï¼ˆç†æ€§æ€è€ƒï¼ï¼‰ã€‚</span><br><span class="line">John--&gt;&gt;Alice: Great!</span><br><span class="line">    John å›å¤ Alice ä¸€æ¡æ¶ˆæ¯ï¼šâ€œGreat!â€ï¼ˆå¾ˆå¥½ï¼ï¼‰ã€‚</span><br><span class="line">    ä½¿ç”¨ --&gt;&gt; è¡¨ç¤ºå›å¤æ¶ˆæ¯ã€‚</span><br><span class="line">John-&gt;&gt;Bob: How about you?</span><br><span class="line">    John è¯¢é—® Bob ä¸€æ¡æ¶ˆæ¯ï¼šâ€œHow about you?â€ï¼ˆä½ æ€ä¹ˆæ ·ï¼Ÿï¼‰ã€‚</span><br><span class="line">Bob--&gt;&gt;John: Jolly good!</span><br><span class="line">    Bob å›å¤ John ä¸€æ¡æ¶ˆæ¯ï¼šâ€œJolly good!â€ï¼ˆéå¸¸å¥½ï¼ï¼‰ã€‚</span><br></pre></td></tr></table></figure><h3 id="Class-Diagram">Class Diagram</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶ç±»å›¾ï¼Œæ˜¾ç¤ºå¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼ŒåŒ…æ‹¬ç»§æ‰¿ã€å…³è”ã€ä¾èµ–ç­‰ã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/classDiagram.html">Mermaid Class Diagram</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;classDiagram&quot;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid classDiagram %&#125;</span><br><span class="line">Class01 &lt;|-- AveryLongClass : Cool</span><br><span class="line">&lt;&lt;interface&gt;&gt; Class01</span><br><span class="line">Class09 --&gt; C2 : Where am i?</span><br><span class="line">Class09 --* C3</span><br><span class="line">Class09 --|&gt; Class07</span><br><span class="line">Class07 : equals()</span><br><span class="line">Class07 : Object[] elementData</span><br><span class="line">Class01 : size()</span><br><span class="line">Class01 : int chimp</span><br><span class="line">Class01 : int gorilla</span><br><span class="line">class Class10 &#123;</span><br><span class="line">  &lt;&lt;service&gt;&gt;</span><br><span class="line">  int id</span><br><span class="line">  size()</span><br><span class="line">&#125;</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">classDiagramClass01 &lt;|-- AveryLongClass : Cool&lt;&lt;interface&gt;&gt; Class01Class09 --&gt; C2 : Where am i?Class09 --* C3Class09 --|&gt; Class07Class07 : equals()Class07 : Object[] elementDataClass01 : size()Class01 : int chimpClass01 : int gorillaclass Class10 &#123;  &lt;&lt;service&gt;&gt;  int id  size()&#125;</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬ç»“æ„</span><br><span class="line">classDiagram</span><br><span class="line">    å®šä¹‰ä¸€ä¸ªç±»å›¾ï¼Œå±•ç¤ºç±»çš„å±æ€§ã€æ–¹æ³•ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚</span><br><span class="line">ç±»å’Œä¿®é¥°ç¬¦</span><br><span class="line">    ä½¿ç”¨ class ClassName å®šä¹‰ä¸€ä¸ªç±»ã€‚</span><br><span class="line">    ç±»çš„å±æ€§å’Œæ–¹æ³•å®šä¹‰åœ¨ class å—å†…ã€‚</span><br><span class="line">    ç‰¹æ®Šä¿®é¥°ç¬¦å¦‚ &lt;&lt;interface&gt;&gt; å’Œ &lt;&lt;service&gt;&gt; ç”¨äºè¯´æ˜ç±»çš„è§’è‰²æˆ–ç±»å‹ã€‚</span><br><span class="line">å…³ç³»ç¬¦å·</span><br><span class="line">    &lt;|-- è¡¨ç¤ºç»§æ‰¿ï¼ˆextendsï¼‰ã€‚</span><br><span class="line">    --|&gt; è¡¨ç¤ºå®ç°ï¼ˆimplementsï¼Œæ¥å£çš„å®ç°ï¼‰ã€‚</span><br><span class="line">    --&gt; è¡¨ç¤ºå…³è”ï¼ˆæ™®é€šå¼•ç”¨ï¼‰ã€‚</span><br><span class="line">    --* è¡¨ç¤ºç»„åˆå…³ç³»ï¼ˆä¸€ä¸ªç±»åŒ…å«å¦ä¸€ä¸ªç±»ï¼‰ã€‚</span><br><span class="line">    : åè·Ÿå…³ç³»çš„è¯´æ˜æˆ–æ³¨é‡Šã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä»£ç é€æ­¥è§£æ</span><br><span class="line">Class01 &lt;|-- AveryLongClass : Cool</span><br><span class="line">    è¡¨ç¤º AveryLongClass ç»§æ‰¿äº† Class01ï¼Œå…³ç³»åç§°ä¸º Coolã€‚</span><br><span class="line">    &lt;|-- è¡¨ç¤ºç»§æ‰¿ï¼ˆçˆ¶ç±»åˆ°å­ç±»ï¼‰ã€‚</span><br><span class="line">&lt;&lt;interface&gt;&gt; Class01</span><br><span class="line">    å°† Class01 æ ‡è®°ä¸ºä¸€ä¸ªæ¥å£ã€‚</span><br><span class="line">Class09 --&gt; C2 : Where am i?</span><br><span class="line">    è¡¨ç¤º Class09 ä¸ C2 æœ‰ä¸€ä¸ªå…³è”å…³ç³»ï¼Œæ³¨é‡Šä¸º â€œWhere am i?â€ã€‚</span><br><span class="line">Class09 --* C3</span><br><span class="line">    è¡¨ç¤º Class09 ä¸ C3 æœ‰ä¸€ä¸ªç»„åˆå…³ç³»ã€‚</span><br><span class="line">    Class09 åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª C3 çš„å®ä¾‹ã€‚</span><br><span class="line">Class09 --|&gt; Class07</span><br><span class="line">    è¡¨ç¤º Class09 å®ç°äº† Class07ã€‚</span><br><span class="line">    --|&gt; é€šå¸¸ç”¨äºè¡¨ç¤ºæ¥å£å®ç°ã€‚</span><br><span class="line">Class07 : equals()</span><br><span class="line">    è¡¨ç¤º Class07 å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³• equals()ã€‚</span><br><span class="line">Class07 : Object[] elementData</span><br><span class="line">    è¡¨ç¤º Class07 æœ‰ä¸€ä¸ªå±æ€§ elementDataï¼Œç±»å‹æ˜¯ Object[]ï¼ˆæ•°ç»„ï¼‰ã€‚</span><br><span class="line">Class01 : size()</span><br><span class="line">    è¡¨ç¤º Class01 æœ‰ä¸€ä¸ªæ–¹æ³• size()ã€‚</span><br><span class="line">Class01 : int chimp å’Œ Class01 : int gorilla</span><br><span class="line">    è¡¨ç¤º Class01 æœ‰ä¸¤ä¸ªæ•´å‹å±æ€§ï¼šchimp å’Œ gorillaã€‚</span><br><span class="line">class Class10 &#123; ... &#125;</span><br><span class="line">    å®šä¹‰äº†ä¸€ä¸ªåä¸º Class10 çš„ç±»ã€‚</span><br><span class="line">    ç±»ä¸­æœ‰ä¸€ä¸ªä¿®é¥°ç¬¦ &lt;&lt;service&gt;&gt;ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæœåŠ¡ç±»ã€‚</span><br><span class="line">    å±æ€§å’Œæ–¹æ³•ï¼š</span><br><span class="line">        int idï¼šæ•´å‹å±æ€§ã€‚</span><br><span class="line">        size()ï¼šæ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure><h3 id="State-Diagram">State Diagram</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶çŠ¶æ€å›¾ï¼Œæ˜¾ç¤ºå¯¹è±¡çš„çŠ¶æ€è½¬ç§»å’Œè¡Œä¸ºã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/stateDiagram.html">Mermaid State Diagram</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;stateDiagram&quot;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid stateDiagram %&#125;</span><br><span class="line">[*] --&gt; Still</span><br><span class="line">Still --&gt; [*]</span><br><span class="line">Still --&gt; Moving</span><br><span class="line">Moving --&gt; Still</span><br><span class="line">Moving --&gt; Crash</span><br><span class="line">Crash --&gt; [*]</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">stateDiagram[*] --&gt; StillStill --&gt; [*]Still --&gt; MovingMoving --&gt; StillMoving --&gt; CrashCrash --&gt; [*]</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬ç»“æ„</span><br><span class="line">stateDiagram</span><br><span class="line">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªçŠ¶æ€å›¾ï¼Œç”¨äºè¡¨ç¤ºçŠ¶æ€å’ŒçŠ¶æ€ä¹‹é—´çš„è½¬æ¢ã€‚</span><br><span class="line">[*]</span><br><span class="line">    è¡¨ç¤ºåˆå§‹çŠ¶æ€æˆ–ç»ˆæ­¢çŠ¶æ€ã€‚</span><br><span class="line">    èµ·å§‹çŠ¶æ€é€šå¸¸æœ‰ç®­å¤´æŒ‡å‘ç¬¬ä¸€ä¸ªçŠ¶æ€ã€‚</span><br><span class="line">    ç»ˆæ­¢çŠ¶æ€é€šå¸¸æœ‰ç®­å¤´æŒ‡å‘å®ƒã€‚</span><br><span class="line">çŠ¶æ€</span><br><span class="line">    ç”¨çŠ¶æ€åç§°å®šä¹‰çŠ¶æ€ï¼Œä¾‹å¦‚ Stillã€Movingã€Crashã€‚</span><br><span class="line">ç®­å¤´</span><br><span class="line">    --&gt; è¡¨ç¤ºçŠ¶æ€ä¹‹é—´çš„è½¬æ¢æ–¹å‘ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä»£ç é€æ­¥è§£æ</span><br><span class="line">[*] --&gt; Still</span><br><span class="line">    ç³»ç»Ÿä»åˆå§‹çŠ¶æ€è¿›å…¥ Still çŠ¶æ€ã€‚</span><br><span class="line">Still --&gt; [*]</span><br><span class="line">    ç³»ç»Ÿä» Still çŠ¶æ€å¯ä»¥ç›´æ¥è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼ˆç³»ç»Ÿç»“æŸï¼‰ã€‚</span><br><span class="line">Still --&gt; Moving</span><br><span class="line">    ç³»ç»Ÿä» Still çŠ¶æ€å¯ä»¥è½¬æ¢ä¸º Moving çŠ¶æ€ã€‚</span><br><span class="line">Moving --&gt; Still</span><br><span class="line">    ç³»ç»Ÿä» Moving çŠ¶æ€å¯ä»¥è¿”å›åˆ° Still çŠ¶æ€ã€‚</span><br><span class="line">Moving --&gt; Crash</span><br><span class="line">    ç³»ç»Ÿä» Moving çŠ¶æ€å¯ä»¥è¿›å…¥ Crash çŠ¶æ€ã€‚</span><br><span class="line">Crash --&gt; [*]</span><br><span class="line">    ç³»ç»Ÿä» Crash çŠ¶æ€å¯ä»¥è¿›å…¥ç»ˆæ­¢çŠ¶æ€ï¼ˆè¡¨ç¤ºç³»ç»Ÿå´©æºƒæˆ–ç»ˆæ­¢ï¼‰ã€‚</span><br></pre></td></tr></table></figure><h3 id="Entity-Relationship-Diagram">Entity Relationship Diagram</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶å®ä½“å…³ç³»å›¾ï¼Œæ˜¾ç¤ºå®ä½“ä¹‹é—´çš„å…³ç³»ï¼ŒåŒ…æ‹¬å…³è”ã€ä¾èµ–ç­‰ã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/entityRelationshipDiagram.html">Mermaid Entity Relationship Diagram</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;erDiagram&quot;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid erDiagram %&#125;</span><br><span class="line">CUSTOMER ||--o&#123; ORDER : places</span><br><span class="line">ORDER ||--|&#123; ITEM : contains</span><br><span class="line">CUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">erDiagramCUSTOMER ||--o&#123; ORDER : placesORDER ||--|&#123; ITEM : containsCUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬ç»“æ„</span><br><span class="line">erDiagram</span><br><span class="line">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªå®ä½“å…³ç³»å›¾ã€‚</span><br><span class="line">    å±•ç¤ºæ•°æ®åº“ä¸­è¡¨ï¼ˆå®ä½“ï¼‰ä¹‹é—´çš„å…³ç³»ã€‚</span><br><span class="line">å®ä½“</span><br><span class="line">    ä¾‹å¦‚ CUSTOMERã€ORDER å’Œ ITEMï¼Œæ¯ä¸ªå®ä½“å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ã€‚</span><br><span class="line">å…³ç³»</span><br><span class="line">    ||--o&#123; è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ã€‚</span><br><span class="line">    ||--|&#123; è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ï¼Œä½†å¼ºè°ƒå®ä½“çš„å”¯ä¸€æ€§ï¼ˆæ¯ä¸ªå­è®°å½•å±äºå”¯ä¸€çš„çˆ¶è®°å½•ï¼‰ã€‚</span><br><span class="line">    &#125;|..|&#123; è¡¨ç¤ºå¤šå¯¹å¤šå…³ç³»ï¼ˆN:Mï¼‰ã€‚</span><br><span class="line">æ³¨é‡Š</span><br><span class="line">    : åçš„æ–‡å­—æ˜¯å…³ç³»çš„æè¿°ï¼Œä¾‹å¦‚ placesã€containsã€hasã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä»£ç é€æ­¥è§£æ</span><br><span class="line">CUSTOMER ||--o&#123; ORDER : places</span><br><span class="line">    è¡¨ç¤ºä¸€ä¸ªå®¢æˆ· (CUSTOMER) å¯ä»¥ä¸‹å¤šä¸ªè®¢å• (ORDER)ã€‚</span><br><span class="line">    ||--o&#123; è¡¨ç¤º ä¸€å¯¹å¤šå…³ç³»ï¼ˆ1:Nï¼‰ï¼Œå³ä¸€ä¸ªå®¢æˆ·å¯¹åº”å¤šä¸ªè®¢å•ã€‚</span><br><span class="line">ORDER ||--|&#123; ITEM : contains</span><br><span class="line">    è¡¨ç¤ºä¸€ä¸ªè®¢å• (ORDER) åŒ…å«å¤šä¸ªå•†å“ (ITEM)ã€‚</span><br><span class="line">    ||--|&#123; è¡¨ç¤º ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸”æ¯ä¸ªå•†å“çš„è®°å½•ä¸æŸä¸ªè®¢å•å”¯ä¸€å¯¹åº”ã€‚</span><br><span class="line">CUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : has</span><br><span class="line">    è¡¨ç¤ºä¸€ä¸ªå®¢æˆ· (CUSTOMER) å¯ä»¥æœ‰å¤šä¸ªé…é€åœ°å€ (DELIVERY-ADDRESS)ï¼Œè€Œæ¯ä¸ªé…é€åœ°å€ä¹Ÿå¯èƒ½å¯¹åº”å¤šä¸ªå®¢æˆ·ã€‚</span><br><span class="line">    &#125;|..|&#123; è¡¨ç¤º å¤šå¯¹å¤šå…³ç³»ï¼ˆN:Mï¼‰ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Gantt-Chart">Gantt Chart</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶ç”˜ç‰¹å›¾ï¼Œæ˜¾ç¤ºä»»åŠ¡è®¡åˆ’ã€è¿›åº¦å’Œèµ„æºåˆ†é…ã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/gantt.html">Mermaid Gantt Chart</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;gantt&quot;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid gantt %&#125;</span><br><span class="line">title Project Timeline</span><br><span class="line">dateFormat  YYYY-MM-DD</span><br><span class="line">section Section1</span><br><span class="line">Completed :done,    des1, 2014-01-06,2014-01-08</span><br><span class="line">Active        :active,  des2, 2014-01-07, 3d</span><br><span class="line">Parallel 1   :         des3, after des1, 1d</span><br><span class="line">Parallel 2   :         des4, after des1, 1d</span><br><span class="line">Parallel 3   :         des5, after des3, 1d</span><br><span class="line">Parallel 4   :         des6, after des4, 1d</span><br><span class="line">section Section2</span><br><span class="line">Task 1 :  t1,after des6,5d</span><br><span class="line">Task 2 :  t2,after t1,3d</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">gantttitle Project TimelinedateFormat  YYYY-MM-DDsection Section1Completed :done,    des1, 2014-01-06,2014-01-08Active        :active,  des2, 2014-01-07, 3dParallel 1   :         des3, after des1, 1dParallel 2   :         des4, after des1, 1dParallel 3   :         des5, after des3, 1dParallel 4   :         des6, after des4, 1dsection Section2Task 1 :  t1,after des6,5dTask 2 :  t2,after t1,3d</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬ç»“æ„</span><br><span class="line">gantt</span><br><span class="line">    å®šä¹‰ä¸€ä¸ªç”˜ç‰¹å›¾ï¼Œç”¨äºè¡¨ç¤ºä»»åŠ¡çš„æ—¶é—´åˆ†å¸ƒå’Œä¾èµ–å…³ç³»ã€‚</span><br><span class="line">title</span><br><span class="line">    å®šä¹‰ç”˜ç‰¹å›¾çš„æ ‡é¢˜ï¼Œè¿™é‡Œæ˜¯ Project Timelineã€‚</span><br><span class="line">dateFormat</span><br><span class="line">    å®šä¹‰æ—¥æœŸæ ¼å¼ï¼Œè¿™é‡Œæ˜¯ YYYY-MM-DDï¼ˆå¹´-æœˆ-æ—¥ï¼‰ã€‚</span><br><span class="line">section</span><br><span class="line">    å®šä¹‰ä»»åŠ¡çš„åˆ†ç±»ï¼ˆéƒ¨åˆ†ï¼‰ã€‚</span><br><span class="line">    æ¯ä¸ª section ä¸‹åŒ…å«ä¸€ç»„ä»»åŠ¡ï¼Œä»»åŠ¡åœ¨å›¾è¡¨ä¸­åˆ†ç»„æ˜¾ç¤ºã€‚</span><br><span class="line">ä»»åŠ¡æ ¼å¼</span><br><span class="line">    æ¯ä¸ªä»»åŠ¡æŒ‰ä»¥ä¸‹æ ¼å¼å®šä¹‰ï¼š</span><br><span class="line">        ä»»åŠ¡åç§° : çŠ¶æ€, æ ‡è¯†ç¬¦, å¼€å§‹æ—¥æœŸæˆ–ä¾èµ–, æŒç»­æ—¶é—´</span><br><span class="line">    ä»»åŠ¡åç§°ï¼šä»»åŠ¡çš„æè¿°ã€‚</span><br><span class="line">    çŠ¶æ€ï¼šå¯é€‰ï¼Œè¡¨ç¤ºä»»åŠ¡çŠ¶æ€ï¼š</span><br><span class="line">        doneï¼šå·²å®Œæˆã€‚</span><br><span class="line">        activeï¼šæ­£åœ¨è¿›è¡Œã€‚</span><br><span class="line">    æ ‡è¯†ç¬¦ï¼šä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºå®šä¹‰ä¾èµ–å…³ç³»ã€‚</span><br><span class="line">    æ—¶é—´ï¼šå¯ä»¥æ˜¯å¼€å§‹æ—¥æœŸã€ç»“æŸæ—¥æœŸã€æˆ–ä¾èµ–ä»»åŠ¡ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä»£ç é€æ­¥è§£æ</span><br><span class="line">section Section1</span><br><span class="line">    å®šä¹‰ä¸€ä¸ªåä¸º Section1 çš„éƒ¨åˆ†ï¼ŒåŒ…å«ä¸€ç»„ä»»åŠ¡ã€‚</span><br><span class="line">Completed :done, des1, 2014-01-06,2014-01-08</span><br><span class="line">    ä»»åŠ¡åç§°ï¼šCompletedã€‚</span><br><span class="line">    çŠ¶æ€ï¼šdoneï¼ˆå·²å®Œæˆï¼‰ã€‚</span><br><span class="line">    æ ‡è¯†ç¬¦ï¼šdes1ã€‚</span><br><span class="line">    å¼€å§‹æ—¥æœŸï¼š2014-01-06ã€‚</span><br><span class="line">    ç»“æŸæ—¥æœŸï¼š2014-01-08ã€‚</span><br><span class="line">Active :active, des2, 2014-01-07, 3d</span><br><span class="line">    ä»»åŠ¡åç§°ï¼šActiveã€‚</span><br><span class="line">    çŠ¶æ€ï¼šactiveï¼ˆæ­£åœ¨è¿›è¡Œï¼‰ã€‚</span><br><span class="line">    æ ‡è¯†ç¬¦ï¼šdes2ã€‚</span><br><span class="line">    å¼€å§‹æ—¥æœŸï¼š2014-01-07ã€‚</span><br><span class="line">    æŒç»­æ—¶é—´ï¼š3dï¼ˆ3å¤©ï¼‰ã€‚</span><br><span class="line">Parallel 1 : des3, after des1, 1d</span><br><span class="line">    ä»»åŠ¡åç§°ï¼šParallel 1ã€‚</span><br><span class="line">    æ— çŠ¶æ€ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚</span><br><span class="line">    æ ‡è¯†ç¬¦ï¼šdes3ã€‚</span><br><span class="line">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des1ï¼ˆåœ¨ä»»åŠ¡ Completed åå¼€å§‹ï¼‰ã€‚</span><br><span class="line">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class="line">Parallel 2 : des4, after des1, 1d</span><br><span class="line">    ä»»åŠ¡åç§°ï¼šParallel 2ã€‚</span><br><span class="line">    æ— çŠ¶æ€ã€‚</span><br><span class="line">    æ ‡è¯†ç¬¦ï¼šdes4ã€‚</span><br><span class="line">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des1ï¼ˆåœ¨ä»»åŠ¡ Completed åå¼€å§‹ï¼‰ã€‚</span><br><span class="line">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class="line">Parallel 3 : des5, after des3, 1d</span><br><span class="line">    ä»»åŠ¡åç§°ï¼šParallel 3ã€‚</span><br><span class="line">    æ— çŠ¶æ€ã€‚</span><br><span class="line">    æ ‡è¯†ç¬¦ï¼šdes5ã€‚</span><br><span class="line">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des3ï¼ˆåœ¨ä»»åŠ¡ Parallel 1 åå¼€å§‹ï¼‰ã€‚</span><br><span class="line">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class="line">Parallel 4 : des6, after des4, 1d</span><br><span class="line">    ä»»åŠ¡åç§°ï¼šParallel 4ã€‚</span><br><span class="line">    æ— çŠ¶æ€ã€‚</span><br><span class="line">    æ ‡è¯†ç¬¦ï¼šdes6ã€‚</span><br><span class="line">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des4ï¼ˆåœ¨ä»»åŠ¡ Parallel 2 åå¼€å§‹ï¼‰ã€‚</span><br><span class="line">    æŒç»­æ—¶é—´ï¼š1dï¼ˆ1å¤©ï¼‰ã€‚</span><br><span class="line">section Section2</span><br><span class="line">    å®šä¹‰ç”˜ç‰¹å›¾çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œç”¨äºåˆ†ç»„æ˜¾ç¤ºåç»­ä»»åŠ¡ã€‚</span><br><span class="line">    ä»»åŠ¡å±äºä¸åŒçš„éƒ¨åˆ†ä»¥ä¾¿åˆ†ç±»å’Œåˆ†ç»„ã€‚</span><br><span class="line">Task 1 : t1, after des6, 5d</span><br><span class="line">    ä»»åŠ¡åç§°ï¼šTask 1ã€‚</span><br><span class="line">    æ ‡è¯†ç¬¦ï¼št1ã€‚</span><br><span class="line">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ des6ï¼ˆParallel 4ï¼‰å®Œæˆåå¼€å§‹ã€‚</span><br><span class="line">    æŒç»­æ—¶é—´ï¼š5dï¼ˆ5å¤©ï¼‰ã€‚</span><br><span class="line">Task 2 : t2, after t1, 3d</span><br><span class="line">    ä»»åŠ¡åç§°ï¼šTask 2ã€‚</span><br><span class="line">    æ ‡è¯†ç¬¦ï¼št2ã€‚</span><br><span class="line">    å¼€å§‹æ—¶é—´ï¼šä¾èµ–ä»»åŠ¡ t1ï¼ˆTask 1ï¼‰å®Œæˆåå¼€å§‹ã€‚</span><br><span class="line">    æŒç»­æ—¶é—´ï¼š3dï¼ˆ3å¤©ï¼‰ã€‚</span><br></pre></td></tr></table></figure><h3 id="Pie-Chart">Pie Chart</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶é¥¼çŠ¶å›¾ï¼Œæ˜¾ç¤ºæ•°æ®åˆ†å¸ƒæƒ…å†µã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/pie.html">Mermaid Pie Chart</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;pie&quot;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid pie showData %&#125;</span><br><span class="line">%%&#123;init: &#123;&quot;pie&quot;: &#123;&quot;textPosition&quot;: 0.4&#125;, &quot;themeVariables&quot;: &#123;&quot;pieOuterStrokeWidth&quot;: &quot;5px&quot;,&quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;&#125;&#125; &#125;%%</span><br><span class="line">title Expenses</span><br><span class="line">&quot;Rent&quot; : 200</span><br><span class="line">&quot;Food&quot; : 200</span><br><span class="line">&quot;Transport&quot; : 400</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">%%&#123;init: &#123;&quot;pie&quot;: &#123;&quot;textPosition&quot;: 0.4&#125;, &quot;themeVariables&quot;: &#123;&quot;pieOuterStrokeWidth&quot;: &quot;5px&quot;,&quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;&#125;&#125; &#125;%%pie showDatatitle Expenses&quot;Rent&quot; : 200&quot;Food&quot; : 200&quot;Transport&quot; : 400</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬ç»“æ„</span><br><span class="line">%%&#123;init: ...&#125;%%ï¼š</span><br><span class="line">    Mermaid.js çš„åˆå§‹åŒ–é…ç½®ï¼Œç”¨äºå…¨å±€è®¾ç½®å›¾è¡¨å±æ€§å’Œæ ·å¼ã€‚</span><br><span class="line">    pie å±æ€§</span><br><span class="line">        textPosition: è®¾ç½®é¥¼å›¾æ•°æ®æ ‡ç­¾çš„ç›¸å¯¹ä½ç½®ã€‚</span><br><span class="line">            å€¼èŒƒå›´ä¸º 0 åˆ° 1ï¼Œè¡¨ç¤ºæ ‡ç­¾è·ç¦»é¥¼å›¾ä¸­å¿ƒçš„æ¯”ä¾‹ã€‚0.4 è¡¨ç¤ºæ ‡ç­¾è·ç¦»ä¸­å¿ƒè¾ƒè¿‘ï¼Œæ¥è¿‘ 40% çš„åŠå¾„ä½ç½®ã€‚</span><br><span class="line">    themeVariables</span><br><span class="line">        pieOuterStrokeWidth: è®¾ç½®é¥¼å›¾å¤–ç¯çš„å®½åº¦ã€‚è®¾ç½®ä¸º 5pxï¼Œè¡¨ç¤ºé¥¼å›¾æœ‰æ˜æ˜¾çš„å¤–è¾¹æ¡†ã€‚</span><br><span class="line">        &quot;pie1&quot;: &quot;#ff9999&quot;,&quot;pie2&quot;: &quot;#99ccff&quot;,&quot;pie3&quot;: &quot;#99ff99&quot;: é…ç½®æ¯ä¸ªåˆ†åŒºçš„é¢œè‰²ã€‚</span><br><span class="line">pie</span><br><span class="line">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªé¥¼å›¾ã€‚</span><br><span class="line">showData</span><br><span class="line">    æ˜¾ç¤ºæ•°æ®é¡¹çš„æ•°å€¼ã€‚</span><br><span class="line">title Expenses</span><br><span class="line">    è®¾ç½®é¥¼å›¾çš„æ ‡é¢˜ä¸º Expensesï¼ˆè´¹ç”¨ï¼‰ã€‚</span><br><span class="line">æ•°æ®é¡¹</span><br><span class="line">    æ•°æ®é¡¹å®šä¹‰äº†é¥¼å›¾çš„å„ä¸ªéƒ¨åˆ†ï¼š</span><br><span class="line">        &quot;Rent&quot; : 200ï¼Œå æ¯”ï¼š200 / (200 + 200 + 400) = 1/4 = 25%ã€‚</span><br><span class="line">        &quot;Food&quot; : 200ï¼Œå æ¯”ï¼š200 / (200 + 200 + 400) = 1/4 = 25%ã€‚</span><br><span class="line">        &quot;Transport&quot; : 400ï¼Œå æ¯”ï¼š400 / (200 + 200 + 400) = 1/2 = 50%ã€‚</span><br><span class="line">    æ¯ä¸ªæ•°æ®é¡¹åŒ…å«ï¼š</span><br><span class="line">        æ ‡ç­¾ï¼šå¦‚ &quot;Rent&quot;ã€&quot;Food&quot;ã€&quot;Transport&quot;ã€‚</span><br><span class="line">        æ•°å€¼ï¼šå¦‚ 200ã€400ï¼Œè¡¨ç¤ºè¯¥éƒ¨åˆ†çš„æƒé‡æˆ–æ•°å€¼å¤§å°ã€‚</span><br></pre></td></tr></table></figure><h3 id="XY-Chart">XY Chart</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶ XY è½´å›¾(æŸ±çŠ¶å›¾å’ŒæŠ˜çº¿å›¾)ï¼Œæ˜¾ç¤ºæ•°æ®åˆ†å¸ƒå’Œè¶‹åŠ¿ã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/xyChart.html">Mermaid XY Chart</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;xychart-beta&quot;</code>ï¼Œç›®å‰ xychart-beta è¿˜å¤„åœ¨æ”¹è¿›é˜¶æ®µ</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid xychart-beta %&#125;</span><br><span class="line">%%&#123;init: &#123;&quot;xyChart&quot;: &#123;&quot;width&quot;: 900,&quot;height&quot;:600&#125;, &quot;themeVariables&quot;: &#123;&quot;xyChart&quot;:&#123;&quot;titleColor&quot;: &quot;#ff0000&quot;&#125;&#125;&#125; &#125;%%</span><br><span class="line">title &quot;Sales Revenue&quot;</span><br><span class="line">x-axis [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec]</span><br><span class="line">y-axis &quot;Revenue (in $)&quot; 4000 --&gt; 11000</span><br><span class="line">bar [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]</span><br><span class="line">line [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">---config:    xyChart:        width: 900        height: 600    themeVariables:        xyChart:            titleColor: &quot;#ff0000&quot;---xychart-betatitle &quot;Sales Revenue&quot;x-axis [jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec]y-axis &quot;Revenue (in $)&quot; 4000 --&gt; 11000bar [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]line [5000, 6000, 7500, 8200, 9500, 10500, 11000, 10200, 9200, 8500, 7000, 6000]</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ä»£ç ç»“æ„è§£æ</span><br><span class="line">%%&#123;init: ...&#125;%%ï¼š</span><br><span class="line">    Mermaid.js çš„åˆå§‹åŒ–é…ç½®ï¼Œç”¨äºå…¨å±€è®¾ç½®å›¾è¡¨å±æ€§å’Œæ ·å¼ã€‚</span><br><span class="line">    xyChart.width å’Œ xyChart.height : è®¾ç½®å›¾è¡¨çš„å®½åº¦å’Œé«˜åº¦ã€‚</span><br><span class="line">    themeVariables.xyChart.titleColor: è®¾ç½®æ ‡é¢˜çš„é¢œè‰²ã€‚</span><br><span class="line">title</span><br><span class="line">    è®¾ç½®å›¾è¡¨çš„æ ‡é¢˜ã€‚</span><br><span class="line">åæ ‡è½´å®šä¹‰</span><br><span class="line">    x-axisï¼šXè½´æ ‡ç­¾ä¸ºæœˆä»½ï¼ˆä»1æœˆåˆ°12æœˆï¼‰ã€‚</span><br><span class="line">    y-axisï¼šYè½´èŒƒå›´ä» $4000 åˆ° $11000ï¼Œå•ä½ä¸ºç¾å…ƒã€‚</span><br><span class="line">æ•°æ®</span><br><span class="line">    barï¼šæŸ±çŠ¶å›¾æ•°æ®ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆçš„é”€å”®æ”¶å…¥ã€‚</span><br><span class="line">    lineï¼šæŠ˜çº¿å›¾æ•°æ®ï¼Œè¡¨ç¤ºæ¯ä¸ªæœˆçš„é”€é‡è¶‹åŠ¿ã€‚</span><br></pre></td></tr></table></figure><h3 id="Journey-Diagram">Journey Diagram</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶æ—…ç¨‹å›¾ï¼Œæ˜¾ç¤ºç”¨æˆ·çš„ä½“éªŒæµç¨‹ï¼ŒåŒ…æ‹¬ç”¨æˆ·è¿›å…¥ç³»ç»Ÿã€æ“ä½œã€é€€å‡ºç³»ç»Ÿç­‰ã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/userJourney.html">Mermaid Journey Diagram</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;journey&quot;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid journey %&#125;</span><br><span class="line">title My working day</span><br><span class="line">section Morning</span><br><span class="line">  wake up : 5 : me</span><br><span class="line">  go to work : 3 : me,you</span><br><span class="line">section Lunch</span><br><span class="line">  have lunch : 5 : me,you</span><br><span class="line">  go to work : 1 : me,you</span><br><span class="line">section Dinner</span><br><span class="line">  finish your meal : 5 : me</span><br><span class="line">section Go home</span><br><span class="line">  go home : 5 : me</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">journeytitle My working daysection Morning  wake up : 5 : me  go to work : 3 : me,yousection Lunch  have lunch : 5 : me,you  go to work : 1 : me,yousection Dinner  finish your meal : 5 : mesection Go home  go home : 5 : me</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬ç»“æ„</span><br><span class="line">journey</span><br><span class="line">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªæ—…ç¨‹å›¾ã€‚</span><br><span class="line">title My working day</span><br><span class="line">    è®¾ç½®æ—…ç¨‹å›¾çš„æ ‡é¢˜ä¸º &quot;My working day&quot;ï¼ˆæˆ‘çš„å·¥ä½œæ—¥ï¼‰ã€‚</span><br><span class="line">section</span><br><span class="line">    å®šä¹‰æ—…ç¨‹å›¾çš„åˆ†æ®µï¼Œç”¨äºè¡¨ç¤ºä¸€å¤©ä¸­çš„ä¸åŒé˜¶æ®µï¼Œä¾‹å¦‚ï¼š</span><br><span class="line">        Morningï¼ˆæ—©æ™¨ï¼‰ã€‚</span><br><span class="line">        Lunchï¼ˆåˆé¤æ—¶é—´ï¼‰ã€‚</span><br><span class="line">        Dinnerï¼ˆæ™šé¤ï¼‰ã€‚</span><br><span class="line">        Go homeï¼ˆå›å®¶ï¼‰ã€‚</span><br><span class="line">ä»»åŠ¡æ ¼å¼</span><br><span class="line">    ä»»åŠ¡æè¿° : æ»¡æ„åº¦è¯„åˆ† : å‚ä¸è€…</span><br><span class="line">        ä»»åŠ¡æè¿°ï¼šæè¿°å…·ä½“çš„ä»»åŠ¡æˆ–æ´»åŠ¨ã€‚</span><br><span class="line">        æ»¡æ„åº¦è¯„åˆ†ï¼šä» 1 åˆ° 5ï¼Œè¡¨ç¤ºå¯¹ä»»åŠ¡æˆ–æ´»åŠ¨çš„æ»¡æ„ç¨‹åº¦ã€‚</span><br><span class="line">        å‚ä¸è€…ï¼šå‚ä¸ä»»åŠ¡çš„äººï¼Œå¯ä»¥æ˜¯ meï¼ˆè‡ªå·±ï¼‰ã€youï¼ˆå…¶ä»–äººï¼‰æˆ–ä¸¤è€…ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä»£ç é€æ­¥è§£æ</span><br><span class="line">section Morning</span><br><span class="line">    wake up : 5 : me</span><br><span class="line">        æ´»åŠ¨ï¼šwake upï¼ˆèµ·åºŠï¼‰ã€‚</span><br><span class="line">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class="line">        å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚</span><br><span class="line">    go to work : 3 : me,you</span><br><span class="line">        æ´»åŠ¨ï¼šgo to workï¼ˆå»å·¥ä½œï¼‰ã€‚</span><br><span class="line">        æ»¡æ„åº¦ï¼š3ï¼ˆä¸­ç­‰æ»¡æ„ï¼‰ã€‚</span><br><span class="line">        å‚ä¸è€…ï¼šme å’Œ youï¼ˆè‡ªå·±å’Œå…¶ä»–äººï¼‰ã€‚</span><br><span class="line">section Lunch</span><br><span class="line">    have lunch : 5 : me,you</span><br><span class="line">        æ´»åŠ¨ï¼šhave lunchï¼ˆåƒåˆé¥­ï¼‰ã€‚</span><br><span class="line">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class="line">        å‚ä¸è€…ï¼šme å’Œ youï¼ˆè‡ªå·±å’Œå…¶ä»–äººï¼‰ã€‚</span><br><span class="line">    go to work : 1 : me,you</span><br><span class="line">        æ´»åŠ¨ï¼šgo to workï¼ˆåƒå®Œé¥­ç»§ç»­å·¥ä½œï¼‰ã€‚</span><br><span class="line">        æ»¡æ„åº¦ï¼š1ï¼ˆéå¸¸ä¸æ»¡æ„ï¼‰ã€‚</span><br><span class="line">        å‚ä¸è€…ï¼šme å’Œ youã€‚</span><br><span class="line">section Dinner</span><br><span class="line">    finish your meal : 5 : me</span><br><span class="line">        æ´»åŠ¨ï¼šfinish your mealï¼ˆåƒå®Œé¥­ï¼‰ã€‚</span><br><span class="line">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class="line">        å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚</span><br><span class="line">section Go home</span><br><span class="line">    go home : 5 : me</span><br><span class="line">        æ´»åŠ¨ï¼šgo homeï¼ˆå›å®¶ï¼‰ã€‚</span><br><span class="line">        æ»¡æ„åº¦ï¼š5ï¼ˆéå¸¸æ»¡æ„ï¼‰ã€‚</span><br><span class="line">        å‚ä¸è€…ï¼šmeï¼ˆè‡ªå·±ï¼‰ã€‚</span><br></pre></td></tr></table></figure><h3 id="Requirement-Diagram">Requirement Diagram</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶éœ€æ±‚å›¾ï¼Œæ˜¾ç¤ºç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚å’Œä¾èµ–å…³ç³»ã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/requirementDiagram.html">Mermaid Requirement Diagram</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;requirementDiagram&quot;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid requirementDiagram %&#125;</span><br><span class="line">requirement &quot;æµ‹è¯•éœ€æ±‚&quot; &#123;</span><br><span class="line">    id: 1</span><br><span class="line">    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;</span><br><span class="line">    risk: High</span><br><span class="line">    verifymethod: test</span><br><span class="line">&#125;</span><br><span class="line">requirement &quot;æµ‹è¯•éœ€æ±‚2&quot; &#123;</span><br><span class="line">    id: 2</span><br><span class="line">    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;</span><br><span class="line">    risk: High</span><br><span class="line">    verifymethod: test</span><br><span class="line">&#125;</span><br><span class="line">element &quot;æµ‹è¯•å®ä½“&quot; &#123;</span><br><span class="line">    type: &quot;æ¨¡æ‹Ÿ&quot;</span><br><span class="line">&#125;</span><br><span class="line">&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot;</span><br><span class="line">&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot;</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">requirementDiagramrequirement &quot;æµ‹è¯•éœ€æ±‚&quot; &#123;    id: 1    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;    risk: High    verifymethod: test&#125;requirement &quot;æµ‹è¯•éœ€æ±‚2&quot; &#123;    id: 2    text: &quot;æµ‹è¯•æ–‡æœ¬&quot;    risk: High    verifymethod: test&#125;element &quot;æµ‹è¯•å®ä½“&quot; &#123;    type: &quot;æ¨¡æ‹Ÿ&quot;&#125;&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot;&quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot;</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬ç»“æ„</span><br><span class="line">requirementDiagram</span><br><span class="line">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªéœ€æ±‚å›¾ã€‚</span><br><span class="line">requirement</span><br><span class="line">    å®šä¹‰ä¸€ä¸ªéœ€æ±‚èŠ‚ç‚¹ï¼ŒåŒ…å«éœ€æ±‚çš„è¯¦ç»†å±æ€§ï¼Œå¦‚ï¼š</span><br><span class="line">        idï¼šéœ€æ±‚ç¼–å·ã€‚</span><br><span class="line">        textï¼šéœ€æ±‚çš„æè¿°ã€‚</span><br><span class="line">        riskï¼šéœ€æ±‚çš„é£é™©çº§åˆ«ï¼ˆå¦‚ High è¡¨ç¤ºé«˜é£é™©ï¼‰ã€‚</span><br><span class="line">        verifymethodï¼šéªŒè¯éœ€æ±‚çš„æ–¹æ³•ï¼ˆå¦‚ test è¡¨ç¤ºé€šè¿‡æµ‹è¯•éªŒè¯ï¼‰ã€‚</span><br><span class="line">element</span><br><span class="line">    å®šä¹‰ä¸€ä¸ªå…ƒç´ ï¼Œç”¨äºè¡¨ç¤ºç³»ç»Ÿä¸­çš„æŸä¸ªå®ä½“æˆ–å¯¹è±¡ã€‚</span><br><span class="line">    åŒ…å«å±æ€§ï¼Œå¦‚ï¼š</span><br><span class="line">        typeï¼šå®ä½“çš„ç±»å‹ï¼ˆå¦‚ æ¨¡æ‹Ÿ è¡¨ç¤ºæ¨¡æ‹Ÿå®ä½“ï¼‰ã€‚</span><br><span class="line">å…³ç³»å®šä¹‰</span><br><span class="line">    å®šä¹‰äº†ä¸¤ä¸ªå…³ç³»ï¼š</span><br><span class="line">        &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚&quot;  : æµ‹è¯•å®ä½“ æ»¡è¶³äº† æµ‹è¯•éœ€æ±‚</span><br><span class="line">        &quot;æµ‹è¯•å®ä½“&quot; - satisfies -&gt; &quot;æµ‹è¯•éœ€æ±‚2&quot; : æµ‹è¯•å®ä½“ æ»¡è¶³äº† æµ‹è¯•éœ€æ±‚2</span><br><span class="line">    - satisfies -&gt;ï¼šsatisfies è¡¨ç¤ºæ»¡è¶³å…³ç³»ï¼Œç®­å¤´æ–¹å‘ä»å®ä½“æŒ‡å‘éœ€æ±‚</span><br><span class="line"></span><br><span class="line">ä»£ç é€æ­¥è§£æ</span><br><span class="line">éœ€æ±‚å®šä¹‰</span><br><span class="line">    requirement &quot;æµ‹è¯•éœ€æ±‚&quot;</span><br><span class="line">        å®šä¹‰ç¬¬ä¸€ä¸ªéœ€æ±‚ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•éœ€æ±‚ã€‚</span><br><span class="line">        å±æ€§ï¼š</span><br><span class="line">            id: 1ï¼ˆéœ€æ±‚ç¼–å·ä¸º 1ï¼‰ã€‚</span><br><span class="line">            text: &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼ˆæè¿°æ–‡æœ¬ä¸º &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼‰ã€‚</span><br><span class="line">            risk: Highï¼ˆé«˜é£é™©éœ€æ±‚ï¼‰ã€‚</span><br><span class="line">            verifymethod: testï¼ˆéªŒè¯æ–¹æ³•ä¸ºæµ‹è¯•ï¼‰ã€‚</span><br><span class="line">    requirement &quot;æµ‹è¯•éœ€æ±‚2&quot;</span><br><span class="line">        å®šä¹‰ç¬¬äºŒä¸ªéœ€æ±‚ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•éœ€æ±‚2ã€‚</span><br><span class="line">        å±æ€§ï¼š</span><br><span class="line">            id: 2ï¼ˆéœ€æ±‚ç¼–å·ä¸º 2ï¼‰ã€‚</span><br><span class="line">            text: &quot;æµ‹è¯•æ–‡æœ¬&quot;ï¼ˆæè¿°æ–‡æœ¬ä¸ç¬¬ä¸€ä¸ªéœ€æ±‚ç›¸åŒï¼‰ã€‚</span><br><span class="line">            risk: Highï¼ˆé«˜é£é™©éœ€æ±‚ï¼‰ã€‚</span><br><span class="line">            verifymethod: testï¼ˆéªŒè¯æ–¹æ³•ä¸ºæµ‹è¯•ï¼‰ã€‚</span><br><span class="line">å®ä½“å®šä¹‰</span><br><span class="line">    element &quot;æµ‹è¯•å®ä½“&quot;</span><br><span class="line">        å®šä¹‰ä¸€ä¸ªç³»ç»Ÿå®ä½“ï¼Œæ˜¾ç¤ºåç§°ä¸º æµ‹è¯•å®ä½“ã€‚</span><br><span class="line">        å±æ€§ï¼š</span><br><span class="line">            type: &quot;æ¨¡æ‹Ÿ&quot;ï¼ˆå®ä½“ç±»å‹ä¸º &quot;æ¨¡æ‹Ÿ&quot;ï¼‰ã€‚</span><br></pre></td></tr></table></figure><h3 id="Gitgraph-Diagram">Gitgraph Diagram</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶Gitå›¾ï¼Œæ˜¾ç¤ºä»£ç ä»“åº“çš„æäº¤å†å²å’Œåˆ†æ”¯å…³ç³»ã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/gitgraph.html">Mermaid Gitgraph Diagram</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;gitgraph&quot;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid gitGraph %&#125;</span><br><span class="line">commit</span><br><span class="line">commit</span><br><span class="line">commit</span><br><span class="line">branch newbranch</span><br><span class="line">checkout newbranch</span><br><span class="line">commit</span><br><span class="line">commit</span><br><span class="line">checkout main</span><br><span class="line">merge newbranch</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">gitGraphcommitcommitcommitbranch newbranchcheckout newbranchcommitcommitcheckout mainmerge newbranch</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬ç»“æ„</span><br><span class="line">gitGraph</span><br><span class="line">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ª Git å›¾ã€‚</span><br><span class="line">commit</span><br><span class="line">    è¡¨ç¤ºä¸€æ¬¡æäº¤æ“ä½œï¼Œæ¯ä¸ª commit èŠ‚ç‚¹ä»£è¡¨ä»£ç ä»“åº“çš„æŸä¸ªæäº¤ç‚¹ã€‚</span><br><span class="line">branch</span><br><span class="line">    åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ã€‚</span><br><span class="line">    æ ¼å¼ï¼šbranch åˆ†æ”¯åç§°ã€‚</span><br><span class="line">checkout</span><br><span class="line">    åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ã€‚</span><br><span class="line">    æ ¼å¼ï¼šcheckout åˆ†æ”¯åç§°ã€‚</span><br><span class="line">merge</span><br><span class="line">    å°†æŒ‡å®šåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚</span><br><span class="line">    æ ¼å¼ï¼šmerge åˆ†æ”¯åç§°ã€‚</span><br></pre></td></tr></table></figure><h3 id="Mindmap">Mindmap</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶æ€ç»´å¯¼å›¾ï¼Œæ˜¾ç¤ºä¸»é¢˜å’Œå­ä¸»é¢˜ä¹‹é—´çš„ hierarchical å…³ç³»ã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/mindmap.html">Mermaid Mindmap</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;mindmap&quot;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid mindmap %&#125;</span><br><span class="line">root((mindmap))</span><br><span class="line">    (origins)</span><br><span class="line">        Long history</span><br><span class="line">        ::icon(fa fa-book)</span><br><span class="line">        Popularisation</span><br><span class="line">            British popular psychology author Tony Buzan</span><br><span class="line">    [Research]</span><br><span class="line">        On effectivness&lt;br/&gt;and features</span><br><span class="line">        On Automatic creation</span><br><span class="line">            Uses</span><br><span class="line">                Creative techniques</span><br><span class="line">                Strategic planning</span><br><span class="line">                Argument mapping</span><br><span class="line">    Tools</span><br><span class="line">        Pen and paper</span><br><span class="line">        Mermaid</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">mindmaproot((mindmap))    (origins)        Long history        ::icon(fa fa-book)        Popularisation            British popular psychology author Tony Buzan    [Research]        On effectivness&lt;br/&gt;and features        On Automatic creation            Uses                Creative techniques                Strategic planning                Argument mapping    Tools        Pen and paper        Mermaid</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬ç»“æ„</span><br><span class="line">mindmap</span><br><span class="line">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªæ€ç»´å¯¼å›¾ã€‚</span><br><span class="line">root((mindmap))</span><br><span class="line">    å®šä¹‰æ€ç»´å¯¼å›¾çš„æ ¹èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºä¸ºåœ†å½¢å¹¶æ ‡æ³¨ä¸º &quot;mindmap&quot;ã€‚</span><br><span class="line">å­èŠ‚ç‚¹ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºä»å±å…³ç³»ï¼š</span><br><span class="line">    æ¯ä¸€çº§ç¼©è¿›ä»£è¡¨ä¸€ä¸ªå±‚çº§çš„å­èŠ‚ç‚¹ã€‚</span><br><span class="line">    å­èŠ‚ç‚¹å¯ä»¥ç›´æ¥æ·»åŠ å†…å®¹æˆ–é€šè¿‡ &lt;br/&gt; æ¢è¡Œã€‚</span><br><span class="line">::icon(...)</span><br><span class="line">    ä¸ºèŠ‚ç‚¹æ·»åŠ å›¾æ ‡ã€‚Mermaid.js æ”¯æŒä½¿ç”¨ FontAwesome çš„å›¾æ ‡ã€‚</span><br><span class="line"></span><br><span class="line">èŠ‚ç‚¹å½¢çŠ¶</span><br><span class="line">é•¿æ–¹å½¢ [] ï¼šå¦‚ [é•¿æ–¹å½¢]ï¼Œæ˜¯é»˜è®¤çš„çŸ©å½¢èŠ‚ç‚¹ã€‚è¿™ä¸ªæ˜¯é»˜è®¤çš„èŠ‚ç‚¹ç±»å‹ã€‚</span><br><span class="line">åœ†å½¢ (()) ï¼šå¦‚ ((åœ†))ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåœ†å½¢èŠ‚ç‚¹ã€‚</span><br><span class="line">åœ†è§’é•¿æ–¹å½¢ () ï¼šå¦‚ (åœ†è§’é•¿æ–¹å½¢)ï¼Œç”¨äºè¡¨ç¤ºåœ†è§’çŸ©å½¢èŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure><h3 id="QuadrantChart">QuadrantChart</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨äºç»˜åˆ¶è±¡é™å›¾ï¼Œæ˜¾ç¤ºä¸åŒç»´åº¦ä¹‹é—´çš„æ¯”è¾ƒå…³ç³»ã€‚</p></li><li class="lvl-2"><p><a href="https://mermaid.js.org/syntax/quadrantChart.html">Mermaid QuadrantChart</a></p></li><li class="lvl-2"><p>type ä¸º <code>&quot;quadrantChart&quot;</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid quadrantChart %&#125;</span><br><span class="line">%%&#123;init: &#123;&quot;quadrantChart&quot;: &#123;&quot;chartHeight&quot;: 600, &quot;chartWidth&quot;: 800, &quot;pointTextPadding&quot;: 10&#125;, &quot;themeVariables&quot;: &#123;&quot;quadrant1Fill&quot;: &quot;#ff0000&quot;, &quot;quadrant2Fill&quot;: &quot;#FFFF00&quot;, &quot;quadrant3Fill&quot;: &quot;#32CD32&quot;, &quot;quadrant4Fill&quot;: &quot;#800080&quot;&#125;&#125;&#125;%%</span><br><span class="line">title Reach and engagement of carpaigns</span><br><span class="line">x-axis Low Reach --&gt; High Reach</span><br><span class="line">y-axis Low Engagement --&gt; High Engagement</span><br><span class="line">quadrant-1 we should expand</span><br><span class="line">quadrant-2 Need to promote</span><br><span class="line">quadrant-3 Re-evaluate</span><br><span class="line">quadrant-4 May be improved</span><br><span class="line">Campaign A: [0.3,0.6]</span><br><span class="line">Campaign B: [0.45,0.23]</span><br><span class="line">Campaign C: [0.57,0.69]</span><br><span class="line">Campaign D: [0.78,0.34]</span><br><span class="line">Campaign E: [0.40,0.34]</span><br><span class="line">Campaign F: [0.35,0.78]</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ•ˆæœ</p></li></ul><pre><code class="highlight mermaid">%%&#123;init: &#123;&quot;quadrantChart&quot;: &#123;&quot;chartHeight&quot;: 600, &quot;chartWidth&quot;: 800, &quot;pointTextPadding&quot;: 10&#125;, &quot;themeVariables&quot;: &#123;&quot;quadrant1Fill&quot;: &quot;#ff0000&quot;, &quot;quadrant2Fill&quot;: &quot;#FFFF00&quot;, &quot;quadrant3Fill&quot;: &quot;#32CD32&quot;, &quot;quadrant4Fill&quot;: &quot;#800080&quot;&#125;&#125;&#125;%%quadrantCharttitle Reach and engagement of carpaignsx-axis Low Reach --&gt; High Reachy-axis Low Engagement --&gt; High Engagementquadrant-1 we should expandquadrant-2 Need to promotequadrant-3 Re-evaluatequadrant-4 May be improvedCampaign A: [0.3,0.6]Campaign B: [0.45,0.23]Campaign C: [0.57,0.69]Campaign D: [0.78,0.34]Campaign E: [0.40,0.34]Campaign F: [0.35,0.78]</code></pre><ul class="lvl-0"><li class="lvl-2"><p>è¯´æ˜</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">åŸºæœ¬ç»“æ„</span><br><span class="line">%%&#123;init: ...&#125;%%</span><br><span class="line">    è¿™æ˜¯ Mermaid.js çš„åˆå§‹åŒ–é…ç½®å—ï¼Œç”¨äºè‡ªå®šä¹‰å›¾è¡¨çš„å…¨å±€å‚æ•°å’Œæ ·å¼ã€‚</span><br><span class="line">    é…ç½®å†…å®¹ï¼Œè¯¦è§ä¸‹æ–‡ï¼š</span><br><span class="line">        quadrantChartï¼šè‡ªå®šä¹‰è±¡é™å›¾çš„ç›¸å…³å‚æ•°ã€‚</span><br><span class="line">        themeVariablesï¼š å›¾è¡¨ä¸»é¢˜é…è‰²ã€‚</span><br><span class="line">quadrantChart</span><br><span class="line">    å®šä¹‰è¿™æ˜¯ä¸€ä¸ªè±¡é™å›¾ã€‚</span><br><span class="line">title</span><br><span class="line">    æ ‡é¢˜</span><br><span class="line"></span><br><span class="line">åæ ‡è½´ï¼Œå®šä¹‰ X è½´å’Œ Y è½´çš„èŒƒå›´å’Œæ–¹å‘ï¼š</span><br><span class="line">x-axis Low Reach --&gt; High Reach</span><br><span class="line">    X è½´ ä» â€œLow Reachâ€ åˆ° â€œHigh Reachâ€ã€‚</span><br><span class="line">y-axis Low Engagement --&gt; High Engagement</span><br><span class="line">    Y è½´ ä» â€œLow Engagementâ€ åˆ° â€œHigh Engagementâ€ã€‚</span><br><span class="line"></span><br><span class="line">è±¡é™å®šä¹‰</span><br><span class="line">quadrant-1 we should expand</span><br><span class="line">    è±¡é™ 1ï¼ˆå³ä¸Šï¼‰ï¼š&quot;we should expand&quot;</span><br><span class="line">quadrant-2 Need to promote</span><br><span class="line">    è±¡é™ 2ï¼ˆå·¦ä¸Šï¼‰ï¼š&quot;Need to promote&quot;</span><br><span class="line">quadrant-3 Re-evaluate</span><br><span class="line">    è±¡é™ 3ï¼ˆå·¦ä¸‹ï¼‰ï¼š&quot;Re-evaluate&quot;</span><br><span class="line">quadrant-4 May be improved</span><br><span class="line">    è±¡é™ 4ï¼ˆå³ä¸‹ï¼‰ï¼š&quot;May be improved&quot;</span><br><span class="line"></span><br><span class="line">æ•°æ®ç‚¹</span><br><span class="line">Campaign A: [0.3,0.6]</span><br><span class="line">Campaign B: [0.45,0.23]</span><br><span class="line">Campaign C: [0.57,0.69]</span><br><span class="line">Campaign D: [0.78,0.34]</span><br><span class="line">Campaign E: [0.40,0.34]</span><br><span class="line">Campaign F: [0.35,0.78]</span><br><span class="line">å®šä¹‰äº† 6 ä¸ªæ´»åŠ¨ï¼ˆCampaignï¼‰çš„æ•°æ®ç‚¹ï¼Œä½¿ç”¨ [name]: [x, y] çš„æ ¼å¼æ¥æ·»åŠ æ•°æ®ç‚¹ï¼Œå…¶ä¸­ [name] æ˜¯æ•°æ®ç‚¹çš„åç§°ï¼Œ[x, y] æ˜¯æ•°æ®ç‚¹åœ¨ x è½´å’Œ y è½´ä¸Šçš„åæ ‡å€¼ï¼Œå¯¹äºç‚¹xå’Œyå€¼ï¼Œæœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼ä¸º1ã€‚</span><br><span class="line">X å€¼ï¼šè¡¨ç¤ºæ´»åŠ¨çš„ Reachï¼ˆè¦†ç›–é¢ï¼‰ã€‚</span><br><span class="line">Y å€¼ï¼šè¡¨ç¤ºæ´»åŠ¨çš„ Engagementï¼ˆå‚ä¸åº¦ï¼‰ã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆå§‹åŒ–é…ç½®</p><ul class="lvl-2"><li class="lvl-6">quadrantChartï¼šè‡ªå®šä¹‰è±¡é™å›¾çš„ç›¸å…³å‚æ•°</li></ul><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>chartHeight</td><td>å›¾è¡¨çš„é«˜åº¦</td><td>500</td></tr><tr><td>chartWidth</td><td>å›¾è¡¨çš„å®½åº¦</td><td>500</td></tr><tr><td>pointLabelFontSize</td><td>ç‚¹æ–‡æœ¬å­—ä½“å¤§å°</td><td>12</td></tr><tr><td>pointRadius</td><td>è¦ç»˜åˆ¶çš„ç‚¹çš„åŠå¾„</td><td>5</td></tr><tr><td>pointTextPadding</td><td>ç‚¹å’Œä¸‹é¢æ–‡æœ¬ä¹‹é—´çš„å¡«å……</td><td>5</td></tr><tr><td>quadrantExternalBorderStrokeWidth</td><td>è±¡é™å¤–è¾¹æ¡†æè¾¹å®½åº¦</td><td>2</td></tr><tr><td>quadrantInternalBorderStrokeWidth</td><td>è±¡é™å†…çš„è¾¹æ¡†æè¾¹å®½åº¦</td><td>1</td></tr><tr><td>quadrantLabelFontSize</td><td>è±¡é™æ–‡æœ¬å­—ä½“å¤§å°</td><td>16</td></tr><tr><td>quadrantPadding</td><td>æ‰€æœ‰è±¡é™å¤–çš„å¡«å……</td><td>5</td></tr><tr><td>quadrantTextTopPadding</td><td>å½“æ–‡æœ¬ç»˜åˆ¶åœ¨é¡¶éƒ¨æ—¶è±¡é™æ–‡æœ¬é¡¶éƒ¨å¡«å……ï¼ˆé‚£é‡Œæ²¡æœ‰æ•°æ®ç‚¹ï¼‰</td><td>5</td></tr><tr><td>titlePadding</td><td>æ ‡é¢˜çš„é¡¶éƒ¨å’Œåº•éƒ¨å¡«å……</td><td>10</td></tr><tr><td>titleFontSize</td><td>æ ‡é¢˜å­—ä½“å¤§å°</td><td>20</td></tr><tr><td>xAxisLabelPadding</td><td>x è½´æ–‡æœ¬çš„é¡¶éƒ¨å’Œåº•éƒ¨å¡«å……</td><td>5</td></tr><tr><td>xAxisLabelFontSize</td><td>X è½´æ–‡æœ¬å­—ä½“å¤§å°</td><td>16</td></tr><tr><td>xAxisPosition</td><td>x è½´çš„ä½ç½®ï¼ˆé¡¶éƒ¨ã€åº•éƒ¨ï¼‰å¦‚æœæœ‰ç‚¹ï¼Œåˆ™ x è½´å°†å§‹ç»ˆæ¸²æŸ“åœ¨åº•éƒ¨</td><td>â€˜topâ€™</td></tr><tr><td>yAxisLabelPadding</td><td>y è½´æ–‡æœ¬çš„å·¦å³å¡«å……</td><td>5</td></tr><tr><td>yAxisLabelFontSize</td><td>Y è½´æ–‡æœ¬å­—ä½“å¤§å°</td><td>16</td></tr><tr><td>yAxisPosition</td><td>y è½´ä½ç½®ï¼ˆå·¦ã€å³ï¼‰</td><td>â€˜leftâ€™</td></tr></tbody></table><ul class="lvl-2"><li class="lvl-6"><p>themeVariablesï¼š å›¾è¡¨ä¸»é¢˜é…è‰²</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>quadrant1Fill</td><td>å³ä¸Šè±¡é™çš„å¡«å……é¢œè‰²</td></tr><tr><td>quadrant2Fill</td><td>å·¦ä¸Šè±¡é™çš„å¡«å……é¢œè‰²</td></tr><tr><td>quadrant3Fill</td><td>å·¦ä¸‹è±¡é™çš„å¡«å……é¢œè‰²</td></tr><tr><td>quadrant4Fill</td><td>å³ä¸‹è±¡é™çš„å¡«å……é¢œè‰²</td></tr><tr><td>quadrant1TextFill</td><td>å³ä¸Šè±¡é™çš„æ–‡æœ¬é¢œè‰²</td></tr><tr><td>quadrant2TextFill</td><td>å·¦ä¸Šè±¡é™çš„æ–‡æœ¬é¢œè‰²</td></tr><tr><td>quadrant3TextFill</td><td>å·¦ä¸‹è±¡é™çš„æ–‡æœ¬é¢œè‰²</td></tr><tr><td>quadrant4TextFill</td><td>å³ä¸‹è±¡é™çš„æ–‡æœ¬é¢œè‰²</td></tr><tr><td>quadrantPointFill</td><td>ç‚¹å¡«å……é¢œè‰²</td></tr><tr><td>quadrantPointTextFill</td><td>ç‚¹æ–‡æœ¬é¢œè‰²</td></tr><tr><td>quadrantXAxisTextFill</td><td>X è½´æ–‡æœ¬é¢œè‰²</td></tr><tr><td>quadrantYAxisTextFill</td><td>Y è½´æ–‡æœ¬é¢œè‰²</td></tr><tr><td>quadrantInternalBorderStrokeFill</td><td>è±¡é™å†…è¾¹æ¡†é¢œè‰²</td></tr><tr><td>quadrantExternalBorderStrokeFill</td><td>è±¡é™å¤–è¾¹æ¡†é¢œè‰²</td></tr><tr><td>quadrantTitleFill</td><td>æ ‡é¢˜é¢œè‰²</td></tr></tbody></table></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

--&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://mermaid.js.org/intro/&quot;&gt;Mermaid&lt;/a&gt; æ˜¯ä¸€ä¸ªæ”¯æŒåœ¨Markdownæ–‡æ¡£ä¸­ç»˜åˆ¶æµç¨‹å›¾ã€ç”˜ç‰¹å›¾ã€åºåˆ—å›¾ç­‰å›¾å½¢çš„å·¥å…·ã€‚å®ƒåŸºäºJavaScriptå®ç°ï¼Œèƒ½å¤Ÿå°†Markdownä¸­çš„å…ƒç´ æ¸²æŸ“æˆHTMLå…ƒç´ ï¼Œä»è€Œåœ¨ç½‘é¡µä¸Šç›´è§‚åœ°å±•ç¤ºå„ç§å›¾è¡¨â€Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://theme-next.js.org/docs/tag-plugins/mermaid&quot;&gt;Nextä¸»é¢˜ä¸­ä½¿ç”¨Mermaidè¯´æ˜&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ &lt;code&gt;Hexo-Next&lt;/code&gt; ä¸»é¢˜ä¸­ä½¿ç”¨ &lt;code&gt;Mermaid&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="Hexo" scheme="https://blog.hanqunfeng.com/categories/Hexo/"/>
    
    
    <category term="Hexo" scheme="https://blog.hanqunfeng.com/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew</title>
    <link href="https://blog.hanqunfeng.com/2024/11/28/brew/"/>
    <id>https://blog.hanqunfeng.com/2024/11/28/brew/</id>
    <published>2024-11-28T13:55:05.000Z</published>
    <updated>2024-12-03T07:24:40.709Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %--><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://brew.sh">brew</a>æ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚<code>git</code>ã€<code>node</code>ã€<code>python</code>ç­‰ã€‚</p></li><li class="lvl-2"><p><code>brew</code>è™½ç„¶æ”¯æŒlinuxï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ä¼šä½¿ç”¨brewæ¥ç®¡ç†linuxçš„è½¯ä»¶åŒ…ã€‚</p></li><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹å®‰è£…brewï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨brewç®¡ç†å„ç§è½¯ä»¶åŒ…ã€‚</p></li><li class="lvl-2"><p>æœ¬æ–‡åŸºäº MacOS Intel Ventura 13.7.1ï¼Œbrew ç‰ˆæœ¬ä¸º4.4.8ã€‚</p></li></ul><span id="more"></span><h2 id="å®‰è£…">å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>é¦–å…ˆè¦ç¡®ä¿ç³»ç»Ÿä¸­å®‰è£…äº† <code>git</code> å’Œ <code>curl</code>ï¼Œå¯¹äº macOS ç”¨æˆ·æ¥è¯´ï¼Œè¿™äº›ç³»ç»Ÿéƒ½è‡ªå¸¦äº†ï¼Œå”¯ä¸€éœ€é¢å¤–è¦æ±‚å®‰è£…çš„æ˜¯<code>Command Line Tools (CLT) for Xcode</code>ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å®‰è£…äº† Command Line Tools (CLT) for Xcode</span></span><br><span class="line">xcode-select --version <span class="comment"># èƒ½å¤Ÿè¾“å‡ºç‰ˆæœ¬å·è¯´æ˜å®‰è£…äº†ï¼Œå¦åˆ™éœ€è¦å®‰è£…ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Command Line Tools (CLT) for Xcode</span></span><br><span class="line">xcode-select --install</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°å½“å‰çš„ Command Line Tools (CLT) for Xcode çš„å®‰è£…è·¯å¾„</span></span><br><span class="line">xcode-select -p <span class="comment"># /Library/Developer/CommandLineTools</span></span><br></pre></td></tr></table></figure><h3 id="åœ¨MacOSä¸Šå®‰è£…brewçš„æ–¹æ³•">åœ¨MacOSä¸Šå®‰è£…brewçš„æ–¹æ³•</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/Homebrew/install">å‚è€ƒèµ„æ–™</a></p></li></ul><h4 id="æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å®‰è£…">æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…æ—¶å¯ä»¥æŒ‡å®šé•œåƒä¸‹è½½æºï¼Œé»˜è®¤æ˜¯<a href="https://github.com/Homebrew/brew.git">Homebrewçš„GitHubä¸‹è½½æº</a>ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å›½å†…çš„é•œåƒæºï¼Œæ¯”å¦‚ä½¿ç”¨<a href="https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/">æ¸…åå¤§å­¦çš„Homebrew</a>é•œåƒæº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ§åˆ¶äº† Homebrew åœ¨å®‰è£…è½¯ä»¶åŒ…æ—¶æ˜¯å¦ä» Homebrew çš„ API æœåŠ¡å™¨è·å–ä¿¡æ¯ï¼Œbrew4.0åæ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ— éœ€è®¾ç½®</span></span><br><span class="line"><span class="built_in">export</span> HOMEBREW_INSTALL_FROM_API=1</span><br><span class="line"><span class="comment"># è®¾ç½®brewä»“åº“ä¸Šæ¸¸</span></span><br><span class="line"><span class="built_in">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class="line"><span class="comment"># è®¾ç½®homebrewæ ¸å¿ƒä¸Šæ¸¸</span></span><br><span class="line"><span class="built_in">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class="line">/bin/bash -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•äºŒï¼šä½¿ç”¨PKGæ–‡ä»¶å®‰è£…">æ–¹æ³•äºŒï¼šä½¿ç”¨PKGæ–‡ä»¶å®‰è£…</h4><ul class="lvl-0"><li class="lvl-2"><p>ä»<a href="https://github.com/Homebrew/brew">Homebrewçš„github</a>ä¸Šä¸‹è½½æœ€æ–°ç‰ˆçš„<a href="https://github.com/Homebrew/brew/releases/latest">Homebrew-x.x.x.pkg</a></p></li></ul><h4 id="æ–¹æ³•ä¸‰ï¼šå›½å†…æ— æ³•è®¿é—®githubåœ°å€æ—¶å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæº">æ–¹æ³•ä¸‰ï¼šå›½å†…æ— æ³•è®¿é—®githubåœ°å€æ—¶å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæº</h4><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œä¾æ—§ä»¥æ¸…åå¤§å­¦çš„Homebrewé•œåƒæºä¸ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class="line"><span class="built_in">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class="line"><span class="comment"># ä»é•œåƒä¸‹è½½å®‰è£…è„šæœ¬å¹¶å®‰è£… Homebrew / Linuxbrew</span></span><br><span class="line">git <span class="built_in">clone</span> --depth=1 https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/install.git brew-install</span><br><span class="line">/bin/bash brew-install/install.sh</span><br><span class="line"><span class="built_in">rm</span> -rf brew-install</span><br></pre></td></tr></table></figure><h4 id="éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ">éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</h4><ul class="lvl-0"><li class="lvl-2"><p><code>brew</code> å‘½ä»¤æœ¬èº«åŠé€šè¿‡brewå®‰è£…çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«è½¯é“¾æ¥åˆ°<code>/usr/local/bin/</code>ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­</p></li><li class="lvl-2"><p>é‡å¯ç»ˆç«¯ï¼Œç„¶åæ‰§è¡Œ<code>brew -v</code>å‘½ä»¤æŸ¥çœ‹brewçš„ç‰ˆæœ¬ï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹å†…å®¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew -v</span><br><span class="line">Homebrew 4.4.8-40-g13c3def</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Homebrewæœ¬èº«çš„å®‰è£…ä½ç½®å¯ä»¥é€šè¿‡<code>brew --repo</code>æŸ¥çœ‹ï¼Œé»˜è®¤ä¸º<code>/usr/local/Homebrew</code></p></li><li class="lvl-2"><p>é€šè¿‡brewå®‰è£…çš„è½¯ä»¶åŒ…é»˜è®¤ä¼šè¢«å®‰è£…åˆ°<code>/usr/local/Cellar/</code>ä¸‹ï¼Œæ¯”å¦‚<code>git</code>å®‰è£…åä¼šåœ¨<code>/usr/local/Cellar/git/</code>ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡<code>brew info git</code>æŸ¥çœ‹å®‰è£…ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¾èµ–åº“ç­‰ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤º Homebrew å®‰è£…è·¯å¾„ï¼ŒmacOS ARM: /opt/homebrewï¼ŒmacOS Intel: /usr/local</span></span><br><span class="line">$ brew --prefix</span><br><span class="line">/usr/local</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤º Homebrew æœ¬åœ°çš„ Git ä»“åº“</span></span><br><span class="line">$ brew --repo</span><br><span class="line">/usr/local/Homebrew</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤º Homebrew Cellar è·¯å¾„ï¼Œå‘½ä»¤è¡Œå·¥å…·çš„å®‰è£…è·¯å¾„</span></span><br><span class="line">$ brew --cellar</span><br><span class="line">/usr/local/Cellar</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤º Homebrew Caskroom è·¯å¾„ï¼ŒGUIå·¥å…·çš„å®‰è£…è·¯å¾„</span></span><br><span class="line">$ brew --caskroom</span><br><span class="line">/usr/local/Caskroom</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼“å­˜è·¯å¾„ï¼Œä¸‹è½½å®‰è£…åŒ…çš„ç¼“å­˜è·¯å¾„ï¼Œé€šè¿‡ brew cleanup æ¸…ç†</span></span><br><span class="line">$ brew --cache</span><br><span class="line">~/Library/Caches/Homebrew</span><br></pre></td></tr></table></figure><h4 id="é…ç½®å‘½ä»¤è¡¥å…¨">é…ç½®å‘½ä»¤è¡¥å…¨</h4><ul class="lvl-0"><li class="lvl-2"><p>å‚è€ƒå®˜ç½‘<a href="https://docs.brew.sh/Shell-Completion">Homebrew Documentationâ€“brew Shell Completion</a></p></li><li class="lvl-2"><p>æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>zsh</code>ï¼Œåœ¨<code>~/.zshrc</code>ä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹å¹¶é‡å¯ç»ˆç«¯å³å¯ç”Ÿæ•ˆ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">autoload</span> -Uz compinit</span><br><span class="line">compinit</span><br></pre></td></tr></table></figure><h4 id="å¸è½½brew">å¸è½½brew</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p><code>brew</code>æ”¯æŒå®‰è£…<code>å‘½ä»¤è¡Œå·¥å…·(formula)</code>å’Œ<code>GUIå·¥å…·(cask)</code></p><ul class="lvl-2"><li class="lvl-5"><code>brew install xxx</code> å®‰è£…å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™ä¸ªæœ€ä¸ºå¸¸ç”¨ï¼Œæ¯”å¦‚ <code>brew install fd</code></li><li class="lvl-5"><code>brew install --cask xxx</code> å®‰è£…GUIå·¥å…·ï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨brewå®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚ <code>brew install --cask firefox</code></li></ul></li><li class="lvl-2"><p>brewçš„å‘½ä»¤å’Œå‚æ•°éå¸¸å¤šï¼Œä½†æ—¥å¸¸ä½¿ç”¨åªéœ€è¦è®°ä½å¸¸ç”¨çš„å‡ ä¸ªå°±å¤Ÿäº†ï¼Œè¯¦ç»†çš„å‘½ä»¤åˆ—è¡¨å¯ä»¥å‚è€ƒ<a href="https://docs.brew.sh/Manpage">Homebrew Documentation</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹brewæ”¯æŒå“ªäº›å‘½ä»¤</span></span><br><span class="line">brew commands</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œæ¯”å¦‚</span></span><br><span class="line">brew install --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><h3 id="ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤">ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">brew update <span class="comment"># æ›´æ–°brewåˆ°æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line">brew --version <span class="comment"># æŸ¥çœ‹brewçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç®€å†™ä¸º brew -v</span></span><br><span class="line">brew config <span class="comment"># æŸ¥çœ‹brewçš„é…ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°ä¸brewç›¸å…³çš„ç¯å¢ƒå˜é‡çš„å€¼</span></span><br><span class="line">brew home <span class="comment"># æµè§ˆå™¨æ‰“å¼€brewå®˜ç½‘</span></span><br><span class="line">brew home xxx <span class="comment"># æµè§ˆå™¨æ‰“å¼€xxxå®˜ç½‘ å¦‚ï¼šæ‰“å¼€fdå‘½ä»¤çš„å®˜ç½‘ brew home fd ,å…·ä½“çš„åç§°å¯ä»¥é€šè¿‡brew listæŸ¥çœ‹</span></span><br><span class="line">brew cleanup <span class="comment"># æ¸…ç†ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼Œå»ºè®®å®šæœŸæ¸…ç†ï¼Œå½“è¿è¡Œbrewæ—¶ä¼šè‡ªåŠ¨æ¸…ç†ï¼ˆ2.0ä»¥åçš„ç‰ˆæœ¬ï¼‰</span></span><br><span class="line">brew cleanup -n <span class="comment"># æ˜¾ç¤ºå°†è¦æ¸…ç†çš„ç¼“å­˜åŠæ—¥å¿—æ–‡ä»¶ï¼ŒåªæŸ¥çœ‹ä¸åˆ é™¤</span></span><br><span class="line">brew doctor <span class="comment"># æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–é—®é¢˜ï¼Œæ¯”å¦‚æ²¡æœ‰å®‰è£…ä¾èµ–åº“ï¼Œæˆ–è€…ä¾èµ–åº“ç‰ˆæœ¬è¿‡ä½ï¼Œå½“è¿è¡ŒbrewæŠ¥é”™æ—¶å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤è¿›è¡Œæ£€æŸ¥å¹¶æ ¹æ®æç¤ºè¿›è¡Œä¿®æ”¹</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å·²å®‰è£…çš„åŒ…</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">brew list <span class="comment"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…</span></span><br><span class="line">brew list --versions <span class="comment"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…åŠç‰ˆæœ¬</span></span><br><span class="line">brew info xxx <span class="comment"># æŸ¥çœ‹xxxçš„å®‰è£…ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…ã€å¸è½½</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥æ‰¾ã€å®‰è£…ã€å¸è½½</span></span><br><span class="line">brew search xxx <span class="comment"># æŸ¥æ‰¾è½¯ä»¶åŒ…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ https://formulae.brew.sh ç½‘é¡µè¿›è¡Œæœç´¢</span></span><br><span class="line">brew install xxx <span class="comment"># å®‰è£…è½¯ä»¶åŒ…ï¼Œæ­¤å‘½ä»¤ç›¸å½“äºåŠ ä¸Šäº† --formula ï¼Œå®‰è£…æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–åº“ï¼Œæ¯”å¦‚å®‰è£…`nginx`æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½`openssl@3`å’Œ`pcre2`ç­‰</span></span><br><span class="line">brew install --cask xxx <span class="comment"># å®‰è£…GUIå·¥å…·ï¼Œæ¯”å¦‚`firefox`</span></span><br><span class="line">brew uninstall xxx <span class="comment"># å¸è½½è½¯ä»¶åŒ…ï¼Œæ­¤å‘½ä»¤ç›¸å½“äºåŠ ä¸Šäº† --formula ï¼Œåªä¼šå¸è½½å½“å‰åŒ…ï¼Œä¸ä¼šå¸è½½ä¾èµ–åº“ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å­˜åœ¨å¾ˆå¤šå†—ä½™åŒ…</span></span><br><span class="line">brew uninstall --cask xxx <span class="comment"># å¸è½½GUIå·¥å…·</span></span><br><span class="line">brew autoremove <span class="comment"># åˆ é™¤æ‰€æœ‰ä»…ä½œä¸ºå¦ä¸€ä¸ªè½¯ä»¶åŒ…çš„ä¾èµ–é¡¹å®‰è£…å¹¶ä¸”ç°åœ¨ä¸å†éœ€è¦çš„åŒ…</span></span><br><span class="line">brew autoremove --dry-run <span class="comment"># --dry-run ä»…æŸ¥çœ‹å“ªäº›åŒ…å¯ä»¥åˆ é™¤ï¼Œå¹¶ä¸ä¼šçœŸçš„åˆ é™¤</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‡çº§</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡çº§</span></span><br><span class="line">brew outdated <span class="comment"># æŸ¥çœ‹éœ€è¦å‡çº§çš„åŒ…</span></span><br><span class="line">brew upgrade xxx <span class="comment"># å‡çº§xxxåˆ°æœ€æ–°ç‰ˆ</span></span><br><span class="line">brew upgrade <span class="comment"># æ›´æ–°å…¨éƒ¨å‘½ä»¤åˆ°æœ€æ–°ç‰ˆ</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¾èµ–å…³ç³»</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¾èµ–å…³ç³»</span></span><br><span class="line">brew deps --tree xxx <span class="comment"># æ ‘å½¢æ˜¾ç¤ºåŒ…çš„ä¾èµ–æ ‘</span></span><br><span class="line">brew deps --installed --tree <span class="comment"># æ ‘å½¢æ˜¾ç¤ºæ‰€æœ‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»</span></span><br><span class="line">brew deps --installed xxx <span class="comment"># æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œçºµå‘å±•ç¤º</span></span><br><span class="line">brew deps --installed --for-each xxx <span class="comment"># æ˜¾ç¤ºå½“å‰å®‰è£…åŒ…çš„ä¾èµ–å…³ç³»ï¼Œæ¨ªå‘å±•ç¤º</span></span><br><span class="line">brew uses --installed xxx <span class="comment"># æŸ¥çœ‹å·²ç»å®‰è£…çš„å“ªäº›å·¥å…·ä¾èµ–å½“å‰åŒ…</span></span><br><span class="line">brew leaves <span class="comment"># æŸ¥çœ‹é¡¶çº§å®‰è£…åŒ…ï¼Œå³ä½ é€šè¿‡brewç›´æ¥å®‰è£…çš„åŒ…ï¼Œè€Œä¸æ˜¯é€šè¿‡å®‰è£…å…¶ä»–è½¯ä»¶åŒ…é—´æ¥å®‰è£…çš„</span></span><br><span class="line">brew leaves | xargs brew deps --installed --for-each --formula <span class="comment"># æŸ¥çœ‹é¡¶çº§åŒ…ï¼Œå¹¶åˆ—å‡ºæ¯ä¸ªé¡¶çº§åŒ…çš„å·²å®‰è£…ä¾èµ–</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä»“åº“ç®¡ç†ï¼Œå‚è€ƒèµ„æ–™<a href="https://docs.brew.sh/Taps">Homebrew Documentationâ€“Taps</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»“åº“ç®¡ç†</span></span><br><span class="line">brew tap <span class="comment"># æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„ä»“åº“ï¼Œtapå®‰è£…è·¯å¾„ /usr/local/Homebrew/Library/Taps/</span></span><br><span class="line">brew tap user/repo <span class="comment"># æ·»åŠ ä¸€ä¸ªä»“åº“ï¼Œä»gitthubä¸‹è½½</span></span><br><span class="line">brew tap repo_url <span class="comment"># æ·»åŠ ä¸€ä¸ªä»“åº“ï¼Œä»ç»™å®šçš„ä»“åº“åœ°å€ä¸‹è½½</span></span><br><span class="line">brew untap user/repo <span class="comment"># åˆ é™¤ä¸€ä¸ªä»“åº“</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»ç¬¬ä¸‰æ–¹ä»“åº“å®‰è£…å·¥å…·ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨å°† homebrew-ffmpeg/ffmpeg è¿™ä¸ªä»“åº“æ·»åŠ åˆ°æœ¬åœ°</span></span><br><span class="line">brew install homebrew-ffmpeg/ffmpeg/ffmpeg</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°ä»“åº“ï¼Œæ— è®ºæ˜¯brewè‡ªå·±çš„ä»“åº“è¿˜æ˜¯ç¬¬ä¸‰æ–¹ä»“åº“ï¼Œéƒ½ä¼šè‡ªåŠ¨æ›´æ–°</span></span><br><span class="line">brew update</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>brew services</code>: brewçš„æœåŠ¡ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†é€šè¿‡brewå®‰è£…çš„æœåŠ¡ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ï¼Œç­‰ç­‰ï¼Œæ¯”å¦‚<code>nginxã€redisã€mysql</code>ç­‰ï¼Œå…·ä½“å‘½ä»¤å¯ä»¥å‚è€ƒ<a href="https://docs.brew.sh/Manpage#services-subcommand">Homebrew Documentation</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡æ‰§è¡Œ services ç›¸å…³çš„å‘½ä»¤æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ homebrew/servicesï¼Œä¹Ÿå¯ä»¥ é€šè¿‡ brew tap homebrew/services æå‰ä¸‹è½½</span></span><br><span class="line">brew services list <span class="comment"># æŸ¥çœ‹å·²å®‰è£…çš„æ‰€æœ‰æœåŠ¡</span></span><br><span class="line">brew services start nginx <span class="comment"># å¯åŠ¨æœåŠ¡ï¼Œå¹¶æ³¨å†Œåˆ°ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ï¼Œå³åˆ›å»ºç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶ï¼š ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</span></span><br><span class="line">brew services stop nginx <span class="comment"># åœæ­¢æœåŠ¡ï¼Œå¹¶ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤ï¼Œå³åˆ é™¤ç³»ç»Ÿè‡ªå¯åŠ¨æ–‡ä»¶</span></span><br><span class="line">brew services <span class="built_in">kill</span> nginx <span class="comment"># ç«‹å³æ€æ­»æœåŠ¡ï¼Œä½†ä¸ä»ç³»ç»Ÿå¯åŠ¨æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤</span></span><br><span class="line">brew services restart nginx <span class="comment"># é‡å¯æœåŠ¡</span></span><br><span class="line">brew services info nginx <span class="comment"># æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€å’Œè¿›ç¨‹IP</span></span><br><span class="line">brew services run nginx <span class="comment"># è¿è¡ŒæœåŠ¡ï¼Œä½†ä¸ä¼šä¿å­˜åˆ°æœåŠ¡åˆ—è¡¨ä¸­</span></span><br><span class="line">brew services cleanup <span class="comment"># æ¸…ç†æ— æ•ˆçš„æœåŠ¡ï¼Œå³å·²å¸è½½åº”ç”¨çš„æ— ç”¨çš„é…ç½®</span></span><br><span class="line">brew services --<span class="built_in">help</span> <span class="comment"># æŸ¥çœ‹å¸®åŠ©</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®å›½å†…é•œåƒæº">é…ç½®å›½å†…é•œåƒæº</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢å®‰è£…éƒ¨åˆ†ä»‹ç»äº†å¦‚ä½•åœ¨å®‰è£…brewæ—¶å°±æŒ‡å®šé•œåƒæºï¼Œä½†æœ‰äº›æ—¶å€™å› ä¸ºæˆ‘ä»¬åœ¨å®‰è£…æ—¶å¿˜è®°é…ç½®ï¼Œæˆ–è€…åŸæ¥çš„é•œåƒæºå·²ç»å¤±æ•ˆéœ€è¦é‡æ–°é…ç½®ï¼Œæ­¤æ—¶å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œé…ç½®ã€‚</p></li><li class="lvl-2"><p>æ­¤å¤„ä»¥é…ç½®<a href="https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/">æ¸…åé•œåƒæº</a>ä¸ºä¾‹ï¼Œé˜¿é‡Œé•œåƒæºè¯·å‚è€ƒ<a href="https://developer.aliyun.com/mirror/homebrew/">é˜¿é‡Œçš„å®˜ç½‘æ–‡æ¡£â€“Homebrewé•œåƒ</a>ï¼Œç§‘å¤§æºå‚è€ƒ<a href="https://mirrors.ustc.edu.cn/help/brew.git.html">Homebrew</a></p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¸´æ—¶æ›¿æ¢</span></span><br><span class="line"><span class="comment"># é…ç½®brewå›½å†…é•œåƒæº</span></span><br><span class="line">$ <span class="built_in">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class="line"><span class="comment"># é…ç½®brew-coreå›½å†…é•œåƒæº</span></span><br><span class="line">$ <span class="built_in">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class="line"><span class="comment"># é…ç½®brew-bottleå›½å†…é•œåƒæº</span></span><br><span class="line">$ <span class="built_in">export</span> HOMEBREW_API_DOMAIN=<span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;</span></span><br><span class="line">$ <span class="built_in">export</span> HOMEBREW_BOTTLE_DOMAIN=<span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;</span></span><br><span class="line"><span class="comment"># æ›´æ–°é…ç½®</span></span><br><span class="line">$ brew update</span><br><span class="line"></span><br><span class="line"><span class="comment">## é…ç½®æ°¸ä¹…ç”Ÿæ•ˆï¼Œzshç”¨æˆ·</span></span><br><span class="line"><span class="comment"># é…ç½®brewå›½å†…é•œåƒæº</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="comment"># é…ç½®brew-coreå›½å†…é•œåƒæº</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="comment"># é…ç½®brew-bottleå›½å†…é•œåƒæº</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line">$ <span class="built_in">source</span> ~/.zshrc</span><br><span class="line"><span class="comment"># æ›´æ–°é…ç½®</span></span><br><span class="line">$ brew update</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶æŸ¥çœ‹brewé…ç½®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»ç”Ÿæ•ˆäº†</span></span><br><span class="line">$ brew config</span><br><span class="line">HOMEBREW_VERSION: 4.4.8-38-g6089077</span><br><span class="line">ORIGIN: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</span><br><span class="line">HEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93</span><br><span class="line">Last commit: 9 hours ago</span><br><span class="line">Branch: master</span><br><span class="line">Core tap origin: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</span><br><span class="line">Core tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107</span><br><span class="line">Core tap last commit: 11 minutes ago</span><br><span class="line">Core tap JSON: 29 Nov 09:56 UTC</span><br><span class="line">Core cask tap HEAD: 4c34bd8c418e13160fc79f1ca9312555d2edc254</span><br><span class="line">Core cask tap last commit: 19 minutes ago</span><br><span class="line">Core cask tap JSON: 29 Nov 09:56 UTC</span><br><span class="line">HOMEBREW_PREFIX: /usr/local</span><br><span class="line">HOMEBREW_API_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api</span><br><span class="line">HOMEBREW_BOTTLE_DOMAIN: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles</span><br><span class="line">HOMEBREW_BREW_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</span><br><span class="line">HOMEBREW_CASK_OPTS: []</span><br><span class="line">HOMEBREW_CORE_GIT_REMOTE: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</span><br><span class="line">HOMEBREW_GITHUB_API_TOKEN: <span class="built_in">set</span></span><br><span class="line">HOMEBREW_MAKE_JOBS: 12</span><br><span class="line">HOMEBREW_SORBET_RUNTIME: <span class="built_in">set</span></span><br><span class="line">Homebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/ruby</span><br><span class="line">CPU: dodeca-core 64-bit kabylake</span><br><span class="line">Clang: 15.0.0 build 1500</span><br><span class="line">Git: 2.43.0 =&gt; /usr/local/bin/git</span><br><span class="line">Curl: 8.7.1 =&gt; /usr/bin/curl</span><br><span class="line">macOS: 13.7.1-x86_64</span><br><span class="line">CLT: 15.0.0.0.1.1694021235</span><br><span class="line">Xcode: N/A</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡brewå‡çº§fdï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†æ¸…åæº</span></span><br><span class="line">$ brew upgrade fd</span><br><span class="line">==&gt; Upgrading 1 outdated package:</span><br><span class="line">fd 8.2.1 -&gt; 10.2.0</span><br><span class="line">==&gt; Fetching fd</span><br><span class="line">==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/fd-10.2.0.ventura.bottle.tar.gz</span><br><span class="line"><span class="comment">################################################################################################################################################################################### 100.0%</span></span><br><span class="line">==&gt; Verifying attestation <span class="keyword">for</span> fd</span><br><span class="line">==&gt; Upgrading fd</span><br><span class="line">  8.2.1 -&gt; 10.2.0</span><br><span class="line">==&gt; Pouring fd-10.2.0.ventura.bottle.tar.gz</span><br><span class="line">==&gt; Caveats</span><br><span class="line">zsh completions have been installed to:</span><br><span class="line">  /usr/local/share/zsh/site-functions</span><br><span class="line">==&gt; Summary</span><br><span class="line">ğŸº  /usr/local/Cellar/fd/10.2.0: 14 files, 2.9MB</span><br><span class="line">==&gt; Running `brew cleanup fd`...</span><br><span class="line">Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.</span><br><span class="line">Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).</span><br><span class="line">Removing: /usr/local/Cellar/fd/8.2.1... (13 files, 2.4MB)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ¢å¤ä¸ºé»˜è®¤çš„GitHubé•œåƒæº</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">unset</span> HOMEBREW_BREW_GIT_REMOTE</span><br><span class="line">$ <span class="built_in">unset</span> HOMEBREW_CORE_GIT_REMOTE</span><br><span class="line">$ <span class="built_in">unset</span> HOMEBREW_API_DOMAIN</span><br><span class="line">$ <span class="built_in">unset</span> HOMEBREW_BOTTLE_DOMAIN</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ‚¨ä¹‹å‰æ°¸ä¹…é…ç½®äº† HOMEBREW ç¯å¢ƒå˜é‡ï¼Œè¿˜éœ€è¦åœ¨å¯¹åº”çš„ ~/.bash_profile æˆ–è€… ~/.zshrc é…ç½®æ–‡ä»¶ä¸­ï¼Œå°†å¯¹åº”çš„ HOMEBREW ç¯å¢ƒå˜é‡é…ç½®è¡Œåˆ é™¤</span></span><br><span class="line">$ <span class="built_in">source</span> ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°brew</span></span><br><span class="line">$ git -C <span class="string">&quot;<span class="subst">$(brew --repo)</span>&quot;</span> remote set-url origin https://github.com/Homebrew/brew</span><br><span class="line"><span class="comment"># æ›´æ–°brew-coreï¼Œbrew4.0åä¸ä¼šå†ä¸‹è½½brew-coreï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥</span></span><br><span class="line"><span class="comment"># ä¸è¿‡ä»ä½ç‰ˆæœ¬å‡çº§ä¸Šæ¥çš„è¿˜ä¼šæœ‰è¿™ä¸ªä»“åº“ï¼Œå¯ä»¥é€šè¿‡ brew tap æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ï¼Œå®é™…ä¸Šæ”¹ä¸æ”¹éƒ½ä¸ä¼šæœ‰å½±å“ï¼Œçœ‹ç€ä¸èˆ’æœå°±ä¿®æ”¹å§</span></span><br><span class="line">$ git -C <span class="string">&quot;<span class="subst">$(brew --repo homebrew/core)</span>&quot;</span> remote set-url origin https://github.com/Homebrew/homebrew-core</span><br><span class="line">$ brew update</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹brewé…ç½®ä¿¡æ¯</span></span><br><span class="line">$ brew config</span><br><span class="line">HOMEBREW_VERSION: 4.4.8-38-g6089077</span><br><span class="line">ORIGIN: https://github.com/Homebrew/brew</span><br><span class="line">HEAD: 60890774e0a70fe93f94973b080068cf7b0d1c93</span><br><span class="line">Last commit: 9 hours ago</span><br><span class="line">Branch: master</span><br><span class="line">Core tap HEAD: 787d1587bfa92794f7d141063a31773064ef9107</span><br><span class="line">Core tap last commit: 13 minutes ago</span><br><span class="line">Core tap JSON: 29 Nov 10:09 UTC</span><br><span class="line">Core cask tap HEAD: 871fe2e8b93aac896a1808571ff11f8b89e6d90e</span><br><span class="line">Core cask tap last commit: 48 seconds ago</span><br><span class="line">Core cask tap JSON: 29 Nov 10:09 UTC</span><br><span class="line">HOMEBREW_PREFIX: /usr/local</span><br><span class="line">HOMEBREW_CASK_OPTS: []</span><br><span class="line">HOMEBREW_GITHUB_API_TOKEN: <span class="built_in">set</span></span><br><span class="line">HOMEBREW_MAKE_JOBS: 12</span><br><span class="line">HOMEBREW_SORBET_RUNTIME: <span class="built_in">set</span></span><br><span class="line">Homebrew Ruby: 3.3.6 =&gt; /usr/local/Homebrew/Library/Homebrew/vendor/portable-ruby/3.3.6/bin/ruby</span><br><span class="line">CPU: dodeca-core 64-bit kabylake</span><br><span class="line">Clang: 15.0.0 build 1500</span><br><span class="line">Git: 2.43.0 =&gt; /usr/local/bin/git</span><br><span class="line">Curl: 8.7.1 =&gt; /usr/bin/curl</span><br><span class="line">macOS: 13.7.1-x86_64</span><br><span class="line">CLT: 15.0.0.0.1.1694021235</span><br><span class="line">Xcode: N/A</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡brewå‡çº§telnetï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†GitHubæº</span></span><br><span class="line">$ brew upgrade telnet</span><br><span class="line">==&gt; Upgrading 1 outdated package:</span><br><span class="line">telnet 294 -&gt; 303.141.1</span><br><span class="line">==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/manifests/303.141.1</span><br><span class="line"><span class="comment">################################################################################################################################################################################### 100.0%</span></span><br><span class="line">==&gt; Fetching telnet</span><br><span class="line">==&gt; Downloading https://ghcr.io/v2/homebrew/core/telnet/blobs/sha256:1be6b7b6a17a311fb3a2f1bffe7dae52284f3239b8af03f651c4fac11362f702</span><br><span class="line"><span class="comment">################################################################################################################################################################################### 100.0%</span></span><br><span class="line">==&gt; Verifying attestation <span class="keyword">for</span> telnet</span><br><span class="line">==&gt; Upgrading telnet</span><br><span class="line">  294 -&gt; 303.141.1</span><br><span class="line">==&gt; Pouring telnet--303.141.1.ventura.bottle.tar.gz</span><br><span class="line">ğŸº  /usr/local/Cellar/telnet/303.141.1: 5 files, 207.5KB</span><br><span class="line">==&gt; Running `brew cleanup telnet`...</span><br><span class="line">Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.</span><br><span class="line">Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).</span><br><span class="line">Removing: /usr/local/Cellar/telnet/294... (4 files, 208.2KB)</span><br></pre></td></tr></table></figure><h2 id="é‡è¦çš„è¯´æ˜">é‡è¦çš„è¯´æ˜</h2><h3 id="ç¯å¢ƒå˜é‡">ç¯å¢ƒå˜é‡</h3><ul class="lvl-0"><li class="lvl-2"><p>brewå®‰è£…çš„è½¯ä»¶åŒ…ä¼šè¢«è½¯è¿æ¥åˆ°<code>/usr/local/bin/</code>ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å°†è¯¥è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒPATHä¸­</p></li><li class="lvl-2"><p>è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœè¯¥è·¯å¾„åœ¨PATHä¸­å£°æ˜çš„æ¯”è¾ƒé å‰ï¼Œå°±å¯èƒ½ä¼šè¢«ä¼˜å…ˆä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å·²ç»æ‰‹å·¥åœ¨ç³»ç»Ÿä¸­å®‰è£…äº†<code>python</code>çš„æŸä¸ªç‰ˆæœ¬ï¼Œä½†é€šè¿‡brewå®‰è£…æŸäº›è½¯ä»¶åŒ…æ—¶å› ä¸ºå…¶ä¾èµ–pythonï¼Œå°±ä¼šé€šè¿‡brewåŒæ—¶å®‰è£…å¯¹åº”çš„pythonç‰ˆæœ¬ï¼Œæ­¤æ—¶æˆ‘ä»¬åœ¨ä½¿ç”¨pythonå‘½ä»¤æ—¶ï¼Œå°±ä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸ª</p></li><li class="lvl-2"><p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ï¼Œ1æ˜¯é€šè¿‡<code>brew unlink python</code>æ¥è§£é™¤é“¾æ¥ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯åˆ é™¤ï¼Œè€Œåªæ˜¯è§£é™¤äº†è½¯é“¾ï¼Œä¸ä¼šå½±å“ä¾èµ–å®ƒçš„å·¥å…·çš„ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦æ¢å¤é“¾æ¥ï¼Œå¯ä»¥é€šè¿‡<code>brew link python</code>æ¥æ¢å¤é“¾æ¥ï¼›2æ˜¯å°†æˆ‘ä»¬çš„ç³»ç»Ÿä¸­è‡ªå·±å®‰è£…çš„ä¸€äº›å·¥å…·çš„è·¯å¾„å£°æ˜åœ¨<code>/usr/local/bin/</code>ä¹‹å‰ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰å½±å“äº†ã€‚</p></li></ul><h3 id="Homebrew-4-0-å¸¦æ¥çš„æ–°å˜åŒ–">Homebrew 4.0 å¸¦æ¥çš„æ–°å˜åŒ–</h3><ul class="lvl-0"><li class="lvl-2"><p>Homebrew 4.0 è¿›è¡Œäº†ä¸€é¡¹æœ€å¤§çš„æ”¹åŠ¨ï¼Œç»„ç»‡æ–¹å¼ä»Gitä»“åº“ç®¡ç†æ”¹ä¸º<a href="https://formulae.brew.sh/api/formula.jws.json">JSONæ–‡ä»¶</a>ä¸‹è½½ã€‚</p></li><li class="lvl-2"><p>JSONæ–‡ä»¶ä¼šä»<a href="https://formulae.brew.sh">formulae.brew.sh</a>ä¸‹è½½ï¼Œè€Œä¸å†ä½¿ç”¨<code>homebrew/core</code>ã€<code>homebrew/cask</code>ä¸¤ä¸ªä»“åº“ï¼Œæ‰€ä»¥å‡çº§åˆ°4.0åï¼Œæœ¬åœ°çš„<code>homebrew/core</code>ã€<code>homebrew/cask</code> ä»“åº“éƒ½å¯ä»¥åˆ é™¤ä»¥é‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æœ¬åœ°ä»“åº“</span></span><br><span class="line">$ brew tap</span><br><span class="line">homebrew/cask <span class="comment"># cask ä»“åº“ï¼ŒGUIçš„å·¥å…·ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¸å†ä½¿ç”¨</span></span><br><span class="line">homebrew/core <span class="comment"># core ä»“åº“ï¼Œå³ formula ä»“åº“ï¼Œå‘½ä»¤è¡Œå·¥å…·ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¸å†ä½¿ç”¨</span></span><br><span class="line">homebrew/services <span class="comment"># services ä»“åº“ï¼Œservices å·¥å…·æœ¬èº«ä¼šä»æ­¤ä¸‹è½½ï¼Œbrew4.0åä¾æ—§ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æœ¬åœ°ä»“åº“</span></span><br><span class="line">$ brew untap homebrew/core</span><br><span class="line">$ brew untap homebrew/cask</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶å†æ¬¡æ‰§è¡Œ brew outdated ç­‰å‘½ä»¤æ—¶ï¼Œä¼šçœ‹åˆ°jsonæ–‡ä»¶è¢«ä¸‹è½½äº†ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥jsonæ–‡ä»¶é—´éš”24å°æ—¶æ›´æ–°ä¸€æ¬¡</span></span><br><span class="line">$ brew outdated</span><br><span class="line">==&gt; Downloading https://formulae.brew.sh/api/formula.jws.json</span><br><span class="line"><span class="comment">##################################################################################### 100.0%</span></span><br><span class="line">==&gt; Downloading https://formulae.brew.sh/api/cask.jws.json</span><br><span class="line"><span class="comment">##################################################################################### 100.0%</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœè¿˜æƒ³ä½¿ç”¨æ—§çš„ä»“åº“æ¨¡å¼ï¼Œåªè¦é…ç½®ä¸‹ç¯å¢ƒå˜é‡</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export HOMEBREW_NO_INSTALL_FROM_API=1&#x27;</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure><h3 id="ä»é•œåƒæºçš„åˆ‡æ¢æ¥ç†è§£brewä¸‹è½½å®‰è£…åŒ…çš„è¿‡ç¨‹">ä»é•œåƒæºçš„åˆ‡æ¢æ¥ç†è§£brewä¸‹è½½å®‰è£…åŒ…çš„è¿‡ç¨‹</h3><ul class="lvl-0"><li class="lvl-2"><p>å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ï¼Œåˆ‡æ¢é•œåƒæºæ—¶è¦è®¾ç½®4ä¸ªç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™å‡ ä¸ªå˜é‡å‘¢ï¼Ÿå®ƒä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Œä¸‹é¢æˆ‘å°±ä¸€ä¸ªä¸€ä¸ªè¯´æ˜ï¼š</p><ul class="lvl-2"><li class="lvl-4"><p>HOMEBREW_BREW_GIT_REMOTE</p><ul class="lvl-4"><li class="lvl-6">è®¾ç½®brewä»“åº“ï¼Œç”¨äºæ›´æ–°brewå‘½ä»¤æœ¬èº«ï¼Œè¿™ä¸ªæ¯”è¾ƒå®¹æ˜“ç†è§£</li></ul></li><li class="lvl-4"><p>HOMEBREW_CORE_GIT_REMOTE</p><ul class="lvl-4"><li class="lvl-6">è®¾ç½®coreä»“åº“ï¼Œç”¨äºæ›´æ–°formulaçš„å®‰è£…è„šæœ¬</li><li class="lvl-6">å½“é€šè¿‡<code>brew info xxx</code>æŸ¥çœ‹å®‰è£…åŒ…ä¿¡æ¯æ—¶ï¼Œå¯ä»¥çœ‹åˆ°<code>From</code>ä¿¡æ¯ï¼Œè¿™ä¸ªå°±æ˜¯å‘½ä»¤çš„å®‰è£…è„šæœ¬ï¼Œæ¯”å¦‚ä¸‹é¢çš„<code>fd.rb</code></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ brew info fd</span><br><span class="line">==&gt; fd: stable 10.2.0 (bottled), HEAD</span><br><span class="line">Simple, fast and user-friendly alternative to find</span><br><span class="line">https://github.com/sharkdp/fd</span><br><span class="line">Conflicts with:</span><br><span class="line">  fdclone (because both install `fd` binaries)</span><br><span class="line">Installed</span><br><span class="line">/usr/local/Cellar/fd/10.2.0 (14 files, 2.9MB) *</span><br><span class="line">  Poured from bottle using the formulae.brew.sh API on 2024-11-29 at 18:02:16</span><br><span class="line">From: https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/f/fd.rb</span><br><span class="line">License: Apache-2.0 OR MIT</span><br><span class="line">==&gt; Dependencies</span><br><span class="line">Build: rust âœ˜</span><br><span class="line">==&gt; Options</span><br><span class="line">--HEAD</span><br><span class="line">  Install HEAD version</span><br><span class="line">==&gt; Caveats</span><br><span class="line">zsh completions have been installed to:</span><br><span class="line">  /usr/local/share/zsh/site-functions</span><br><span class="line">==&gt; Analytics</span><br><span class="line">install: 6,327 (30 days), 24,518 (90 days), 116,476 (365 days)</span><br><span class="line">install-on-request: 6,326 (30 days), 24,515 (90 days), 116,363 (365 days)</span><br><span class="line">build-error: 0 (30 days)</span><br></pre></td></tr></table></figure><ul class="lvl-4"><li class="lvl-6">è¿™ä¸ªå®‰è£…è„šæœ¬ä¸­åŒ…å«<code>bottle do</code>éƒ¨åˆ†ï¼Œå…¶ä½œç”¨æ˜¯å½“å®‰è£…è„šæœ¬æ—¶ï¼Œä¼˜å…ˆä»è¯¥éƒ¨åˆ†è·å–å¯¹åº”çš„æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶é¢„ç¼–è¯‘åŒ…çš„sha256æ ¡éªŒå€¼ï¼Œå¦‚æœä»å¯¹åº”çš„äºŒè¿›åˆ¶æºä¸­æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥ä»äºŒè¿›åˆ¶é¢„ç¼–è¯‘åŒ…çš„åœ°å€è¿›è¡Œä¸‹è½½ï¼Œè¯¥é¢„ç¼–è¯‘ä¸‹è½½åœ°å€ç”±<code>HOMEBREW_BOTTLE_DOMAIN</code>æŒ‡å®šï¼Œé»˜è®¤ä»å®˜æ–¹æºä¸‹è½½ã€‚</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">class Fd &lt; Formula</span><br><span class="line">  desc <span class="string">&quot;Simple, fast and user-friendly alternative to find&quot;</span></span><br><span class="line">  homepage <span class="string">&quot;https://github.com/sharkdp/fd&quot;</span></span><br><span class="line">  url <span class="string">&quot;https://github.com/sharkdp/fd/archive/refs/tags/v10.2.0.tar.gz&quot;</span></span><br><span class="line">  sha256 <span class="string">&quot;73329fe24c53f0ca47cd0939256ca5c4644742cb7c14cf4114c8c9871336d342&quot;</span></span><br><span class="line">  license any_of: [<span class="string">&quot;Apache-2.0&quot;</span>, <span class="string">&quot;MIT&quot;</span>]</span><br><span class="line">  <span class="built_in">head</span> <span class="string">&quot;https://github.com/sharkdp/fd.git&quot;</span>, branch: <span class="string">&quot;master&quot;</span></span><br><span class="line"></span><br><span class="line">  bottle <span class="keyword">do</span></span><br><span class="line">    sha256 cellar: :any_skip_relocation, arm64_sequoia:  <span class="string">&quot;9d17cfb029fbdc6ed31c732108f7aa746d3082dd4783ed35471ef79340615509&quot;</span></span><br><span class="line">    sha256 cellar: :any_skip_relocation, arm64_sonoma:   <span class="string">&quot;82d5c2ffc2e2d0d8643a7c3f620c81ed49d7b23920aa23b6a7f4c50be69abc0b&quot;</span></span><br><span class="line">    sha256 cellar: :any_skip_relocation, arm64_ventura:  <span class="string">&quot;354412ababb7d6c52abd9153ff96f133391406ce292b2122c76b96c2ab714f87&quot;</span></span><br><span class="line">    sha256 cellar: :any_skip_relocation, arm64_monterey: <span class="string">&quot;0b41f292041767fd1c3c5b92daaa6c823fb07c1d7cd11b0427a415f08463f035&quot;</span></span><br><span class="line">    sha256 cellar: :any_skip_relocation, sonoma:         <span class="string">&quot;4fa0fb4b3f512e45d35c569953efc7c59ebd8976caac9b2c1b1394b7e29157a0&quot;</span></span><br><span class="line">    sha256 cellar: :any_skip_relocation, ventura:        <span class="string">&quot;b1406e5414252b1e1b90cfad188454eb31058256ed6246baed48c4e1cfe593a1&quot;</span></span><br><span class="line">    sha256 cellar: :any_skip_relocation, monterey:       <span class="string">&quot;0ac060bf7d1529aa1f65e634f64b98b906df533d71f2185c883165c01f59ad53&quot;</span></span><br><span class="line">    sha256 cellar: :any_skip_relocation, x86_64_linux:   <span class="string">&quot;2464fb21cc981166ffa9783fa14a09265790af4d89ce3a763421ddaf29119541&quot;</span></span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  depends_on <span class="string">&quot;rust&quot;</span> =&gt; :build</span><br><span class="line"></span><br><span class="line">  conflicts_with <span class="string">&quot;fdclone&quot;</span>, because: <span class="string">&quot;both install `fd` binaries&quot;</span></span><br><span class="line"></span><br><span class="line">  def install</span><br><span class="line">    system <span class="string">&quot;cargo&quot;</span>, <span class="string">&quot;install&quot;</span>, *std_cargo_args</span><br><span class="line">    man1.install <span class="string">&quot;doc/fd.1&quot;</span></span><br><span class="line">    generate_completions_from_executable(bin/<span class="string">&quot;fd&quot;</span>, <span class="string">&quot;--gen-completions&quot;</span>, shells: [:bash, :fish])</span><br><span class="line">    zsh_completion.install <span class="string">&quot;contrib/completion/_fd&quot;</span></span><br><span class="line">    <span class="comment"># Bash completions are not compatible with Bash 3 so don&#x27;t use v1 directory.</span></span><br><span class="line">    <span class="comment"># bash: complete: nosort: invalid option name</span></span><br><span class="line">    <span class="comment"># Issue ref: https://github.com/clap-rs/clap/issues/5190</span></span><br><span class="line">    (share/<span class="string">&quot;bash-completion/completions&quot;</span>).install bash_completion.children</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  <span class="built_in">test</span> <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">touch</span> <span class="string">&quot;foo_file&quot;</span></span><br><span class="line">    <span class="built_in">touch</span> <span class="string">&quot;test_file&quot;</span></span><br><span class="line">    assert_equal <span class="string">&quot;test_file&quot;</span>, shell_output(<span class="string">&quot;#&#123;bin&#125;/fd test&quot;</span>).chomp</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure><ul class="lvl-4"><li class="lvl-6">æ³¨æ„ï¼Œbrew4.0åä¸å†ä½¿ç”¨ä»è¯¥gitä»“åº“ä¸­è·å–å®‰è£…è„šæœ¬ï¼Œå› ä¸ºformulaçš„å®‰è£…æºä»£ç å·²ç»å…¨éƒ¨å­˜å‚¨åœ¨jsonæ–‡ä»¶ä¸­(è§<code>HOMEBREW_API_DOMAIN</code>è¯´æ˜)ï¼Œä¸å†éœ€è¦é€šè¿‡Gitä»“åº“ä¸‹è½½</li><li class="lvl-6">åˆ‡æ¢é•œåƒæºæ—¶ï¼Œbrew4.0åä¸éœ€è¦è®¾ç½®è¯¥ç¯å¢ƒå˜é‡</li></ul></li><li class="lvl-4"><p>HOMEBREW_API_DOMAIN</p><ul class="lvl-4"><li class="lvl-6">è®¾ç½®<code>formula\cask</code>çš„å®‰è£…è„šæœ¬ä¸‹è½½æºï¼Œé»˜è®¤<a href="https://formulae.brew.sh">https://formulae.brew.sh</a></li><li class="lvl-6">brew4.0åä¸å†ä»gitä»“åº“è·å–å®‰è£…è„šæœ¬ï¼Œè€Œæ˜¯ä»è¿™ä¸ªjsonæ–‡ä»¶ä¸­ä¸€æ¬¡æ€§è·å–æ‰€æœ‰å·¥å…·çš„å®‰è£…è„šæœ¬ï¼Œé»˜è®¤24å°æ—¶æ›´æ–°ä¸€æ¬¡</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å®˜æ–¹æºï¼š</span><br><span class="line">  formulaæºï¼šhttps://formulae.brew.sh/api/formula.jws.json</span><br><span class="line">  caskæºï¼šhttps://formulae.brew.sh/api/cask.jws.json</span><br><span class="line"></span><br><span class="line">æ¸…åæºï¼š</span><br><span class="line">  formulaæºï¼šhttps://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api/formula.jws.json</span><br><span class="line">  caskæºï¼šhttps://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api/cask.jws.json</span><br></pre></td></tr></table></figure><ul class="lvl-4"><li class="lvl-6">å¦‚æœè¿˜æƒ³ä½¿ç”¨æ—§çš„ä»“åº“æ¨¡å¼ï¼Œåªè¦é…ç½®ä¸‹ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·å³ä½¿ä½ å‡çº§åå·²ç»åˆ é™¤äº†å¯¹åº”çš„ä»“åº“ï¼Œå®ƒä¹Ÿä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨åˆ°æ—¶è‡ªåŠ¨ä¸‹è½½</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®˜æ–¹ä¹Ÿæåˆ°ï¼Œéå¼€å‘äººå‘˜æ²¡å¿…è¦è¿™æ ·åš</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export HOMEBREW_NO_INSTALL_FROM_API=1&#x27;</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure></li><li class="lvl-4"><p>HOMEBREW_BOTTLE_DOMAIN</p><ul class="lvl-4"><li class="lvl-6">æŒ‡å®šé¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼ˆä¹Ÿç§°ä¸º bottlesï¼‰çš„ä¸‹è½½åœ°å€ï¼ŒHomebrew ä½¿ç”¨è¿™äº› bottles æ¥åŠ é€Ÿè½¯ä»¶å®‰è£…è¿‡ç¨‹ï¼Œé¿å…åœ¨æ¯ä¸ªç”¨æˆ·çš„è®¡ç®—æœºä¸Šéƒ½é‡æ–°ä»æºä»£ç æ„å»ºè½¯ä»¶ã€‚</li><li class="lvl-6">å½“æˆ‘ä»¬é€šè¿‡<code>brew install xxx</code>å®‰è£…è½¯ä»¶æ—¶ï¼Œbrewä¼šå…ˆä»è¯¥formulaçš„å®‰è£…è„šæœ¬ï¼ˆ4.0ä»¥å‰ä»HOMEBREW_CORE_GIT_REMOTEæŒ‡å®šçš„gitä»“åº“è·å–ï¼Œ4.0ä»¥åä»HOMEBREW_API_DOMAINæŒ‡å®šçš„jsonæ–‡ä»¶ä¸­è·å–ï¼‰ä¸­è·å–è¯¥è½¯ä»¶çš„å®‰è£…ä¿¡æ¯ï¼Œç„¶åæ ¹æ®å®‰è£…ä¿¡æ¯ä»bottleä¸­ä¸‹è½½å¯¹åº”çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼Œå†å°†å…¶å®‰è£…åˆ°æœ¬åœ°ã€‚</li><li class="lvl-6">ä¸‹è½½åçš„äºŒè¿›åˆ¶åŒ…ä¼šè¢«ä¿å­˜åˆ°ç¼“å­˜ç›®å½•ä¸­(<code>brew --cache</code>)ï¼Œå®‰è£…åçš„è½¯ä»¶åŒ…å­˜å‚¨åˆ°Cellarç›®å½•ä¸­(<code>brew --cellar</code>)</li></ul></li></ul></li><li class="lvl-2"><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œåˆ‡æ¢é•œåƒæºæ—¶ï¼Œå®é™…ä¸Šåªéœ€è¦è®¾ç½®3ä¸ªå˜é‡å°±å¤Ÿäº†</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HOMEBREW_BREW_GIT_REMOTE</span><br><span class="line">HOMEBREW_API_DOMAIN</span><br><span class="line">HOMEBREW_BOTTLE_DOMAIN</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

--&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://brew.sh&quot;&gt;brew&lt;/a&gt;æ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚&lt;code&gt;git&lt;/code&gt;ã€&lt;code&gt;node&lt;/code&gt;ã€&lt;code&gt;python&lt;/code&gt;ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;code&gt;brew&lt;/code&gt;è™½ç„¶æ”¯æŒlinuxï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ä¼šä½¿ç”¨brewæ¥ç®¡ç†linuxçš„è½¯ä»¶åŒ…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹å®‰è£…brewï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨brewç®¡ç†å„ç§è½¯ä»¶åŒ…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åŸºäº MacOS Intel Ventura 13.7.1ï¼Œbrew ç‰ˆæœ¬ä¸º4.4.8ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="macos" scheme="https://blog.hanqunfeng.com/categories/macos/"/>
    
    
    <category term="macos" scheme="https://blog.hanqunfeng.com/tags/macos/"/>
    
    <category term="brew" scheme="https://blog.hanqunfeng.com/tags/brew/"/>
    
  </entry>
  
  <entry>
    <title>Poetry--è½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨</title>
    <link href="https://blog.hanqunfeng.com/2024/11/22/python_poetry/"/>
    <id>https://blog.hanqunfeng.com/2024/11/22/python_poetry/</id>
    <published>2024-11-22T15:33:15.000Z</published>
    <updated>2024-12-05T03:41:10.947Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><a href="https://python-poetry.org/docs/">Poetry</a>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨ï¼Œå…¶ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºã€å‘å¸ƒå’Œåˆ†äº«pythonåŒ…ã€‚è¯´å®ƒè½»é‡ï¼Œæ˜¯ä¸ <a href="https://docs.conda.io/projects/conda/en/stable/">conda</a> ç›¸æ¯” poetry æ›´è½»é‡ï¼ŒåŒæ—¶ä¸ <code>venv + pip</code> <a href="/2018/04/28/python_virtualenv/" title="Python--virtualenv">Python--virtualenv</a> çš„æ–¹å¼ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š<ul class="lvl-2"><li class="lvl-6">ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ä¸‹è½½ä¾èµ–åŒ…</li><li class="lvl-6">åŒ…ç®¡ç†ä¸Šæ›´åŠ ç²¾ç¡®ï¼Œåˆ é™¤ä¸éœ€è¦çš„åŒ…æ—¶ä¼šåŒæ—¶åˆ é™¤ä¸å…¶å…³è”çš„ä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„é‚£äº›ä¾èµ–åŒ…ï¼Œé¿å…æ— ç”¨çš„ä¾èµ–åŒ…é€ æˆæ‰“åŒ…ä½“ç§¯è¿‡å¤§</li><li class="lvl-6">æ‰“åŒ…å’Œå‘å¸ƒæ›´åŠ ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å’Œå‘å¸ƒ</li></ul></li></ul><span id="more"></span><h2 id="å®‰è£…">å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£<a href="https://python-poetry.org/docs/#installation">Installation</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®˜æ–¹æ¨èä½¿ç”¨pipxå®‰è£…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ pip</span></span><br><span class="line">$ pipx install poetry</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">$ poetry --version</span><br><span class="line">Poetry (version 1.8.4)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</span></span><br><span class="line">$ <span class="built_in">mkdir</span>  ~/.zfunc</span><br><span class="line">$ poetry completions zsh &gt; ~/.zfunc/_poetry</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ ~/.zshrc ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆæˆ‘æ˜¯ç”¨çš„æ˜¯zshï¼Œå…¶ä»–shellå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰</span></span><br><span class="line">fpath+=~/.zfunc</span><br><span class="line"><span class="built_in">autoload</span> -Uz compinit &amp;&amp; compinit</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>pipxç®€ä»‹</strong></em></p><ul class="lvl-1"><li class="lvl-2"><p><a href="https://github.com/pypa/pipx">pipx</a> æ˜¯ä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨pipxå®‰è£…å·¥å…·åŒ…æ—¶ï¼Œæ¯ä¸ªå·¥å…·éƒ½ä¼šè¢«å®‰è£…åœ¨ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œé¿å…ä¸åŒå·¥å…·ä¹‹é—´çš„ä¾èµ–å†²çªã€‚</p></li><li class="lvl-2"><p>åœºæ™¯ï¼šä¸¤ä¸ªå·¥å…·ä¾èµ–ä¸åŒç‰ˆæœ¬çš„åŒä¸€ä¸ªåº“<br>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼š</p><p>å·¥å…·A ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.27.1ã€‚<br>å·¥å…·B ä¾èµ–äº requests åº“çš„ç‰ˆæœ¬ 2.31.0ã€‚</p><p>å¦‚æœä½¿ç”¨ pip å®‰è£…<br>å·¥å…·ä¼šè¢«å®‰è£…åˆ°å…¨å±€ç¯å¢ƒï¼Œå…±äº«ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install toolA  <span class="comment"># å®‰è£…æ—¶ä¼šå®‰è£… requests 2.27.1</span></span><br><span class="line">pip install toolB  <span class="comment"># å®‰è£…æ—¶ä¼šå°† requests å‡çº§åˆ° 2.31.0</span></span><br></pre></td></tr></table></figure><p>ç»“æœï¼š<br>å½“ä½ è¿è¡Œå·¥å…·Aæ—¶ï¼Œå®ƒå¯èƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒä¾èµ–çš„ requests 2.27.1 å·²è¢« requests 2.31.0 æ›¿æ¢ã€‚<br>å…¨å±€ç¯å¢ƒä¸­çš„æ‰€æœ‰å·¥å…·éƒ½å…±äº«ä¸€ä¸ª requestsï¼Œç‰ˆæœ¬å†²çªä¸å¯é¿å…ã€‚</p><p>å¦‚æœä½¿ç”¨ pipx å®‰è£…<br>æ¯ä¸ªå·¥å…·ä¼šè¢«å®‰è£…åˆ°ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œå„è‡ªçš„ä¾èµ–äº’ä¸å½±å“ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pipx install toolA  <span class="comment"># åœ¨è™šæ‹Ÿç¯å¢ƒAä¸­å®‰è£… toolA å’Œ requests 2.27.1</span></span><br><span class="line">pipx install toolB  <span class="comment"># åœ¨è™šæ‹Ÿç¯å¢ƒBä¸­å®‰è£… toolB å’Œ requests 2.31.0</span></span><br></pre></td></tr></table></figure><p>ç»“æœï¼š<br>è™šæ‹Ÿç¯å¢ƒA åªåŒ…å« toolA å’Œå®ƒçš„ä¾èµ– requests 2.27.1ã€‚<br>è™šæ‹Ÿç¯å¢ƒB åªåŒ…å« toolB å’Œå®ƒçš„ä¾èµ– requests 2.31.0ã€‚<br>å·¥å…·ä¹‹é—´å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šå› ä¸ºä¾èµ–ç‰ˆæœ¬å†²çªè€Œå¯¼è‡´é—®é¢˜ã€‚</p></li><li class="lvl-2"><p>æ‰€ä»¥ï¼Œå½“éœ€è¦å®‰è£…å…¨å±€å‘½ä»¤è¡Œå·¥å…·æ—¶ï¼Œä½¿ç”¨pipxæ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©</p></li><li class="lvl-2"><p><a href="https://github.com/pypa/pipx">pipx</a> çš„å®‰è£…</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…pipx</span></span><br><span class="line">pip install pipx</span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¿è¡Œè¯¥å‘½ä»¤ä¼šå°†</span></span><br><span class="line">pipx ensurepath</span><br><span class="line"><span class="comment"># è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¼šå°†å¦‚ä¸‹å†…å®¹åŠ å…¥ä½ çš„shellé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘çš„æ˜¯ .zshrc æ–‡ä»¶ï¼Œå®é™…ä¸Šä½ ä¹Ÿå¯ä»¥æ‰‹å·¥æ·»åŠ è¯¥é…ç½®ï¼Œå°†$HOME/.local/binæ”¾åˆ°å‰é¢æ›´å¥½ä¸€äº›ã€‚</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/.local/bin&quot;</span></span><br><span class="line"><span class="comment"># æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ pipxè‡ªåŠ¨ä»£ç è¡¥å…¨</span></span><br><span class="line"><span class="comment"># è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶æ ¹æ®æç¤ºå®Œæˆ</span></span><br><span class="line">pipx completions</span><br><span class="line"><span class="comment"># æˆ‘çš„æ˜¯zshï¼Œæ‰€ä»¥åœ¨ .zshrcä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class="line"><span class="built_in">autoload</span> -Uz compinit &amp;&amp; compinit <span class="comment"># å¦‚æœæ²¡æœ‰æ·»åŠ è¿‡å°±éœ€è¦å…ˆæ·»åŠ è¿™ä¸ª</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(register-python-argcomplete pipx)</span>&quot;</span> <span class="comment"># æ·»åŠ è‡ªåŠ¨ä»£ç è¡¥å…¨</span></span><br><span class="line"><span class="comment"># æ³¨æ„æ·»åŠ å®Œæˆåè¦é‡å¯shell</span></span><br></pre></td></tr></table></figure></div><h2 id="æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤">æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤</h2><blockquote><p>æˆ‘å·²ç»å°†å…¶ç¿»è¯‘ä¸ºä¸­æ–‡</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">$ poetry list</span><br><span class="line">Poetry (ç‰ˆæœ¬ 1.8.4)</span><br><span class="line"></span><br><span class="line">ç”¨æ³•ï¼š</span><br><span class="line">  <span class="built_in">command</span> [é€‰é¡¹] [å‚æ•°]</span><br><span class="line"></span><br><span class="line">é€‰é¡¹ï¼š</span><br><span class="line">  -h, --<span class="built_in">help</span>                 æ˜¾ç¤ºç»™å®šå‘½ä»¤çš„å¸®åŠ©ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‘½ä»¤ï¼Œåˆ™æ˜¾ç¤ºåˆ—è¡¨å‘½ä»¤çš„å¸®åŠ©ã€‚</span><br><span class="line">  -q, --quiet                ä¸è¾“å‡ºä»»ä½•æ¶ˆæ¯ã€‚</span><br><span class="line">  -V, --version              æ˜¾ç¤ºæ­¤åº”ç”¨ç¨‹åºç‰ˆæœ¬ã€‚</span><br><span class="line">      --ansi                å¼ºåˆ¶è¾“å‡ºANSIæ ¼å¼ã€‚</span><br><span class="line">      --no-ansi             ç¦ç”¨ANSIè¾“å‡ºã€‚</span><br><span class="line">  -n, --no-interaction       ä¸è¦æé—®ä»»ä½•äº¤äº’æ€§é—®é¢˜ã€‚</span><br><span class="line">      --no-plugins           ç¦ç”¨æ’ä»¶ã€‚</span><br><span class="line">      --no-cache            ç¦ç”¨æºç¼“å­˜ã€‚</span><br><span class="line">  -C, --directory=ç›®å½•      Poetryå‘½ä»¤çš„å·¥ä½œç›®å½•ï¼ˆé»˜è®¤ä¸ºå½“å‰å·¥ä½œç›®å½•ï¼‰ã€‚</span><br><span class="line">  -v|vv|vvv, --verbose       å¢åŠ æ¶ˆæ¯çš„å†—é•¿åº¦ï¼š1 è¡¨ç¤ºæ­£å¸¸è¾“å‡ºï¼Œ2 è¡¨ç¤ºæ›´è¯¦ç»†çš„è¾“å‡ºï¼Œ3 è¡¨ç¤ºè°ƒè¯•ã€‚</span><br><span class="line"></span><br><span class="line">å¯ç”¨å‘½ä»¤ï¼š</span><br><span class="line">  about              æ˜¾ç¤ºå…³äºPoetryçš„ä¿¡æ¯ã€‚</span><br><span class="line">  add                å°†æ–°ä¾èµ–é¡¹æ·»åŠ åˆ°pyproject.tomlå¹¶å®‰è£…å®ƒã€‚</span><br><span class="line">  build              é»˜è®¤æ„å»ºä¸€ä¸ªåŒ…ï¼Œåˆ†åˆ«æ˜¯tarballå’Œwheelã€‚</span><br><span class="line">  check              éªŒè¯pyproject.tomlæ–‡ä»¶çš„å†…å®¹åŠå…¶ä¸poetry.lockæ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚</span><br><span class="line">  config             ç®¡ç†é…ç½®è®¾ç½®ã€‚</span><br><span class="line">  <span class="built_in">export</span>             å°†é”æ–‡ä»¶å¯¼å‡ºåˆ°å…¶ä»–æ ¼å¼ã€‚</span><br><span class="line">  <span class="built_in">help</span>               æ˜¾ç¤ºç‰¹å®šå‘½ä»¤çš„å¸®åŠ©ã€‚</span><br><span class="line">  init               åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„pyproject.tomlæ–‡ä»¶ã€‚</span><br><span class="line">  install            å®‰è£…é¡¹ç›®ä¾èµ–é¡¹ã€‚</span><br><span class="line">  list               åˆ—å‡ºå‘½ä»¤ã€‚</span><br><span class="line">  lock              é”å®šé¡¹ç›®ä¾èµ–é¡¹ã€‚</span><br><span class="line">  new               åœ¨&lt;path&gt;å¤„åˆ›å»ºä¸€ä¸ªæ–°çš„Pythoné¡¹ç›®ã€‚</span><br><span class="line">  publish           å°†åŒ…å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ã€‚</span><br><span class="line">  remove            ä»é¡¹ç›®ä¾èµ–é¡¹ä¸­ç§»é™¤åŒ…ã€‚</span><br><span class="line">  run                åœ¨é€‚å½“çš„ç¯å¢ƒä¸­è¿è¡Œå‘½ä»¤ã€‚</span><br><span class="line">  search            åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢åŒ…ã€‚</span><br><span class="line">  shell            åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å¯åŠ¨shellã€‚</span><br><span class="line">  show              æ˜¾ç¤ºæœ‰å…³åŒ…çš„ä¿¡æ¯ã€‚</span><br><span class="line">  update            æ ¹æ®pyproject.tomlæ–‡ä»¶æ›´æ–°ä¾èµ–é¡¹ã€‚</span><br><span class="line">  version           æ˜¾ç¤ºé¡¹ç›®çš„ç‰ˆæœ¬æˆ–åœ¨æä¾›æœ‰æ•ˆç‰ˆæœ¬è§„åˆ™æ—¶æ›´æ–°å®ƒã€‚</span><br><span class="line"></span><br><span class="line">ç¼“å­˜</span><br><span class="line">  cache clear        æŒ‰åç§°æ¸…é™¤Poetryç¼“å­˜ã€‚</span><br><span class="line">  cache list         åˆ—å‡ºPoetryçš„ç¼“å­˜åˆ—è¡¨ã€‚</span><br><span class="line"></span><br><span class="line">è°ƒè¯•</span><br><span class="line">  debug info        æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ã€‚</span><br><span class="line">  debug resolve    è°ƒè¯•ä¾èµ–é¡¹è§£æã€‚</span><br><span class="line"></span><br><span class="line">ç¯å¢ƒ</span><br><span class="line">  <span class="built_in">env</span> info         æ˜¾ç¤ºå½“å‰ç¯å¢ƒçš„ä¿¡æ¯ã€‚</span><br><span class="line">  <span class="built_in">env</span> list          åˆ—å‡ºä¸å½“å‰é¡¹ç›®å…³è”çš„æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class="line">  <span class="built_in">env</span> remove        ç§»é™¤ä¸é¡¹ç›®å…³è”çš„è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class="line">  <span class="built_in">env</span> use           æ¿€æ´»æˆ–åˆ›å»ºå½“å‰é¡¹ç›®çš„æ–°çš„è™šæ‹Ÿç¯å¢ƒã€‚</span><br><span class="line"></span><br><span class="line">è‡ªèº«</span><br><span class="line">  self add          å‘Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒæ·»åŠ å…¶ä»–åŒ…ã€‚</span><br><span class="line">  self install      å®‰è£…æ­¤Poetryå®‰è£…æ‰€éœ€çš„é”å®šåŒ…ï¼ˆåŒ…æ‹¬æ’ä»¶ï¼‰ã€‚</span><br><span class="line">  self lock         é”å®šPoetryå®‰è£…çš„ç³»ç»Ÿè¦æ±‚ã€‚</span><br><span class="line">  self remove       ä»Poetryçš„è¿è¡Œæ—¶ç¯å¢ƒä¸­ç§»é™¤å…¶ä»–åŒ…ã€‚</span><br><span class="line">  self show         æ˜¾ç¤ºPoetryè¿è¡Œæ—¶ç¯å¢ƒä¸­çš„åŒ…ã€‚</span><br><span class="line">  self show plugins æ˜¾ç¤ºå½“å‰å·²å®‰è£…æ’ä»¶çš„ä¿¡æ¯ã€‚</span><br><span class="line">  self update       æ›´æ–°Poetryåˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</span><br><span class="line"></span><br><span class="line">æº</span><br><span class="line">  <span class="built_in">source</span> add         ä¸ºé¡¹ç›®æ·»åŠ æºé…ç½®ã€‚</span><br><span class="line">  <span class="built_in">source</span> remove      ç§»é™¤ä¸ºé¡¹ç›®é…ç½®çš„æºã€‚</span><br><span class="line">  <span class="built_in">source</span> show        æ˜¾ç¤ºä¸ºé¡¹ç›®é…ç½®çš„æºä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œåªå¯¹æ—¥å¸¸å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤è¿›è¡Œç®€è¦è¯´æ˜ï¼Œè¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ<a href="https://python-poetry.org/docs/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><h3 id="new-åˆ›å»ºé¡¹ç›®">new : åˆ›å»ºé¡¹ç›®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‰ç…§é»˜è®¤è§„åˆ™åˆ›å»ºä¸€ä¸ªåŸºäº poetry çš„é¡¹ç›®</span></span><br><span class="line">$ poetry new my-project</span><br><span class="line">Created package my_project <span class="keyword">in</span> my-project</span><br><span class="line">$ <span class="built_in">cd</span> my-project</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç”Ÿæˆçš„ç›®å½•ç»“æ„</span></span><br><span class="line">$ exa -T</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ my_project</span><br><span class="line">â”‚  â””â”€â”€ __init__.py</span><br><span class="line">â”œâ”€â”€ pyproject.toml</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â””â”€â”€ tests</span><br><span class="line">   â””â”€â”€ __init__.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ pyproject.toml å†…å®¹ï¼Œè¯¥æ–‡ä»¶ä¸ºé¡¹ç›®çš„é…ç½®çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">$ more pyproject.toml</span><br><span class="line">[tool.poetry]</span><br><span class="line">name = <span class="string">&quot;my-project&quot;</span></span><br><span class="line">version = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line">description = <span class="string">&quot;&quot;</span></span><br><span class="line">authors = [<span class="string">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>]</span><br><span class="line">readme = <span class="string">&quot;README.md&quot;</span></span><br><span class="line"></span><br><span class="line">[tool.poetry.dependencies]</span><br><span class="line">python = <span class="string">&quot;^3.11&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[build-system]</span><br><span class="line">requires = [<span class="string">&quot;poetry-core&quot;</span>]</span><br><span class="line">build-backend = <span class="string">&quot;poetry.core.masonry.api&quot;</span></span><br></pre></td></tr></table></figure><h3 id="init-åˆå§‹åŒ–ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ç›®å½•">init : åˆå§‹åŒ–ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ç›®å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸ªé¡¹ç›®ç›®å½•ï¼Œç›®å½•åç§°ä¸º poetryDemo</span></span><br><span class="line">$ <span class="built_in">cd</span> poetryDemo</span><br><span class="line"><span class="comment"># åˆå§‹åŒ– poetryDemo ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œæ³¨æ„è¯¥æ“ä½œåªä¼šåˆ›å»ºè¯¥æ–‡ä»¶ï¼ŒåŒ…ç›®å½•ä»¥åŠreadmeæ–‡ä»¶éƒ½æ²¡æœ‰ï¼Œéœ€è¦æ‰‹å·¥åˆ›å»º</span></span><br><span class="line">$ poetry init</span><br><span class="line">This <span class="built_in">command</span> will guide you through creating your pyproject.toml config.</span><br><span class="line"></span><br><span class="line">Package name [poetrydemo]:  <span class="comment"># åŒ…åç§°</span></span><br><span class="line">Version [0.1.0]:  <span class="comment"># ç‰ˆæœ¬å·</span></span><br><span class="line">Description []:   <span class="comment"># æè¿°ä¿¡æ¯</span></span><br><span class="line">Author [hanqunfeng &lt;hanqf2008@163.com&gt;, n to skip]:  <span class="comment"># ä½œè€…</span></span><br><span class="line">License []:  <span class="comment"># License</span></span><br><span class="line">Compatible Python versions [^3.11]:  <span class="comment"># python ç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line">Would you like to define your main dependencies interactively? (<span class="built_in">yes</span>/no) [<span class="built_in">yes</span>] <span class="comment"># æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„ä¸»ç¯å¢ƒä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yes</span></span><br><span class="line">You can specify a package <span class="keyword">in</span> the following forms:  <span class="comment"># æ‚¨å¯ä»¥æŒ‰ä»¥ä¸‹å½¢å¼æŒ‡å®šåŒ…ï¼š</span></span><br><span class="line">  - A single name (requests): this will search <span class="keyword">for</span> matches on PyPI <span class="comment"># å•ä¸ªåç§°ï¼ˆrequestsï¼‰ï¼šè¿™å°†åœ¨å®˜æ–¹ä»“åº“PyPIä¸Šæœç´¢åŒ¹é…é¡¹ï¼Œå¦‚æœæŒ‡å®šäº†å…¶å®ƒé•œåƒæºå°±ä¼šä»æŒ‡å®šçš„æºä¸‹è½½</span></span><br><span class="line">  - A name and a constraint (requests@^2.23.0) <span class="comment"># åç§°å’Œç‰ˆæœ¬çº¦æŸ</span></span><br><span class="line">  - A git url (git+https://github.com/python-poetry/poetry.git) <span class="comment"># gitåœ°å€</span></span><br><span class="line">  - A git url with a revision (git+https://github.com/python-poetry/poetry.git#develop) <span class="comment"># gitåœ°å€ï¼ŒæŒ‡å®šæŸä¸ªåˆ†æ”¯</span></span><br><span class="line">  - A file path (../my-package/my-package.whl) <span class="comment"># æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  - A directory (../my-package/) <span class="comment"># ç›®å½•è·¯å¾„</span></span><br><span class="line">  - A url (https://example.com/packages/my-package-0.1.0.tar.gz) <span class="comment"># ä¸€ä¸ªå®‰è£…åŒ…çš„åœ°å€</span></span><br><span class="line"></span><br><span class="line">Package to add or search <span class="keyword">for</span> (leave blank to skip): <span class="comment"># æ·»åŠ ä¸»ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™</span></span><br><span class="line"></span><br><span class="line">Would you like to define your development dependencies interactively? (<span class="built_in">yes</span>/no) [<span class="built_in">yes</span>] <span class="comment"># æ‚¨æƒ³ä»¥äº¤äº’æ–¹å¼å®šä¹‰æ‚¨çš„å¼€å‘ä¾èµ–å…³ç³»å—ï¼Ÿé»˜è®¤yes</span></span><br><span class="line">Package to add or search <span class="keyword">for</span> (leave blank to skip): <span class="comment"># æ·»åŠ å¼€å‘ç¯å¢ƒä¾èµ–ï¼ŒæŒ‰ä¸Šé¢çš„æ ¼å¼è¦æ±‚å¡«å†™</span></span><br><span class="line"></span><br><span class="line">Generated file</span><br><span class="line"><span class="comment"># è¦ç”Ÿæˆçš„ pyproject.toml å†…å®¹</span></span><br><span class="line">[tool.poetry]</span><br><span class="line">name = <span class="string">&quot;poetrydemo&quot;</span>  <span class="comment"># åŒ…åç§°</span></span><br><span class="line">version = <span class="string">&quot;0.1.0&quot;</span>    <span class="comment"># ç‰ˆæœ¬</span></span><br><span class="line">description = <span class="string">&quot;&quot;</span>     <span class="comment"># æè¿°ä¿¡æ¯</span></span><br><span class="line">authors = [<span class="string">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>] <span class="comment"># ä½œè€…ä¿¡æ¯</span></span><br><span class="line">readme = <span class="string">&quot;README.md&quot;</span> <span class="comment"># è¯´æ˜æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">[tool.poetry.dependencies] <span class="comment"># ä¸»ç¯å¢ƒä¾èµ–</span></span><br><span class="line">python = <span class="string">&quot;^3.11&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[build-system]</span><br><span class="line">requires = [<span class="string">&quot;poetry-core&quot;</span>]</span><br><span class="line">build-backend = <span class="string">&quot;poetry.core.masonry.api&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Do you confirm generation? (<span class="built_in">yes</span>/no) [<span class="built_in">yes</span>] <span class="comment"># ç¡®è®¤æ˜¯å¦æŒ‰ç…§ä¸Šé¢çš„å†…å®¹åˆ›å»º pyproject.toml æ–‡ä»¶ï¼Œé»˜è®¤yes</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢çš„æ–¹å¼åœ¨åˆå§‹åŒ–æ—¶ä¼šè¯¢é—®ä½ ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚æœä½ å¸Œæœ›éƒ½ç”¨é»˜è®¤å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poetry init -n</span><br></pre></td></tr></table></figure><h3 id="config-poetryçš„å…¨å±€é…ç½®">config : poetryçš„å…¨å±€é…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å…¨å±€é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ poetry config --list</span><br><span class="line">cache-dir = <span class="string">&quot;/Users/hanqf/Library/Caches/pypoetry&quot;</span>  <span class="comment"># ç¼“å­˜ç›®å½•,ç”¨äºå­˜å‚¨é¡¹ç›®ä¾èµ–å’Œè™šæ‹Ÿç¯å¢ƒç­‰ç¼“å­˜ä¿¡æ¯ã€‚</span></span><br><span class="line">experimental.system-git-client = <span class="literal">false</span>              <span class="comment"># æ˜¯å¦ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„gitå®¢æˆ·ç«¯,falseè¡¨ç¤ºä½¿ç”¨Poetryå†…ç½®çš„gitå®¢æˆ·ç«¯</span></span><br><span class="line">installer.max-workers = null                        <span class="comment"># å®‰è£…ä¾èµ–æ—¶çš„æœ€å¤§çº¿ç¨‹æ•°,nullè¡¨ç¤ºä½¿ç”¨é»˜è®¤çº¿ç¨‹æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸ºcpuæ ¸æ•°+4</span></span><br><span class="line">installer.modern-installation = <span class="literal">true</span>                <span class="comment"># æ˜¯å¦ä½¿ç”¨Poetryçš„ç°ä»£å®‰è£…æ–¹æ¡ˆ,trueè¡¨ç¤ºä½¿ç”¨</span></span><br><span class="line">installer.no-binary = null                          <span class="comment"># æ˜¯å¦ä¸ä½¿ç”¨é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶åŒ…,nullè¡¨ç¤ºä¸é™åˆ¶</span></span><br><span class="line">installer.parallel = <span class="literal">true</span>                           <span class="comment"># æ˜¯å¦å¹¶è¡Œå®‰è£…ä¾èµ–,trueè¡¨ç¤ºå¹¶è¡Œå®‰è£…</span></span><br><span class="line">keyring.enabled = <span class="literal">true</span>                              <span class="comment"># æ˜¯å¦å¯ç”¨å¯†é’¥ç¯ï¼ˆkeyringï¼‰ä»¥ä¿å­˜è®¤è¯ä¿¡æ¯ã€‚true è¡¨ç¤ºå¯ç”¨ã€‚</span></span><br><span class="line">solver.lazy-wheel = <span class="literal">true</span>                            <span class="comment"># æ˜¯å¦å»¶è¿Ÿè§£æ wheel åŒ…ã€‚true è¡¨ç¤ºå»¶è¿Ÿè§£æã€‚</span></span><br><span class="line">virtualenvs.create = <span class="literal">true</span>                           <span class="comment"># æ˜¯å¦è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ,trueè¡¨ç¤ºåˆ›å»º</span></span><br><span class="line">virtualenvs.in-project = null                       <span class="comment"># æ˜¯å¦åœ¨é¡¹ç›®å†…åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œnull è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼ï¼ˆé€šå¸¸ä¸º falseï¼‰ï¼Œå³ä¸åœ¨é¡¹ç›®ä¸­åˆ›å»ºã€‚trueè¡¨ç¤ºåœ¨é¡¹ç›®ä¸­åˆ›å»º</span></span><br><span class="line">virtualenvs.options.always-copy = <span class="literal">false</span>             <span class="comment"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry ä¼šå§‹ç»ˆå¤åˆ¶æ–‡ä»¶åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ã€‚è¿™å¯ä»¥é¿å…æŸäº›ç³»ç»Ÿä¸Šçš„æƒé™é—®é¢˜ï¼Œä½†ä¼šå¢åŠ è™šæ‹Ÿç¯å¢ƒçš„å­˜å‚¨éœ€æ±‚ã€‚</span></span><br><span class="line">virtualenvs.options.no-pip = <span class="literal">false</span>                  <span class="comment"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… pipã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ pipï¼Œå¹¶ä¸”ä½ å¸Œæœ›é€šè¿‡ Poetry ç®¡ç†æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œå¯ä»¥å°† no-pip è®¾ç½®ä¸º trueï¼Œä»¥å‡å°‘è™šæ‹Ÿç¯å¢ƒä¸­çš„ä¸å¿…è¦çš„ä¾èµ–é¡¹ã€‚</span></span><br><span class="line">virtualenvs.options.no-setuptools = <span class="literal">false</span>           <span class="comment"># å¦‚æœè®¾ç½®ä¸º trueï¼ŒPoetry åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä¸ä¼šå®‰è£… setuptoolsã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒPoetry ä¼šå®‰è£… pip å’Œ setuptoolsï¼Œä»¥ä¾¿ä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥ç®¡ç†ä¾èµ–é¡¹ã€‚</span></span><br><span class="line">virtualenvs.options.system-site-packages = <span class="literal">false</span>    <span class="comment"># é»˜è®¤å€¼falseï¼Œæ­¤æ—¶ Poetry åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒå°†ä¸ä¼šåŒ…å«å…¨å±€ Python å®‰è£…çš„ site-packages ç›®å½•ä¸­çš„åŒ…ã€‚è¿™æœ‰åŠ©äºç¡®ä¿é¡¹ç›®ä¾èµ–é¡¹çš„éš”ç¦»æ€§ï¼Œé¿å…ä¸ç³»ç»Ÿä¸­çš„å…¶ä»–åŒ…å‘ç”Ÿå†²çªã€‚</span></span><br><span class="line">virtualenvs.path = <span class="string">&quot;&#123;cache-dir&#125;/virtualenvs&quot;</span>  <span class="comment"># /Users/hanqf/Library/Caches/pypoetry/virtualenvs # è™šæ‹Ÿç¯å¢ƒå­˜æ”¾çš„è·¯å¾„ï¼Œå¦‚æœvirtualenvs.in-projectè®¾ç½®ä¸ºtrueï¼Œå°±åªä¼šåœ¨é¡¹ç›®ä¸­åˆ›å»º</span></span><br><span class="line">virtualenvs.prefer-active-python = <span class="literal">false</span>            <span class="comment"># æ˜¯å¦ä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿæ¿€æ´»çš„Pythonè§£é‡Šå™¨</span></span><br><span class="line">virtualenvs.prompt = <span class="string">&quot;&#123;project_name&#125;-py&#123;python_version&#125;&quot;</span>  <span class="comment"># è™šæ‹Ÿç¯å¢ƒçš„å‘½ä»¤æç¤ºæ ¼å¼</span></span><br><span class="line">warnings.export = <span class="literal">true</span>                              <span class="comment"># æ˜¯å¦åœ¨å¯¼å‡ºæ—¶æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ã€‚true è¡¨ç¤ºæ˜¾ç¤º</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹å…¨å±€é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹å…¨å±€é…ç½®ï¼Œæ­¤åä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º .venv ç›®å½•å­˜æ”¾è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">$ poetry config virtualenvs.in-project <span class="literal">true</span></span><br><span class="line"><span class="comment"># è¿›å…¥è™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœè™šæ‹Ÿç¯å¢ƒå°šæœªåˆ›å»ºä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line">$ poetry shell</span><br><span class="line"><span class="comment"># é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">$ <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆï¼Œæ­¤æ—¶ä¼šåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º poetry.toml æ¥ä¿å­˜è¿™äº›é…ç½®ä¿¡æ¯</span></span><br><span class="line">$ poetry config virtualenvs.in-project <span class="literal">true</span> --<span class="built_in">local</span></span><br><span class="line">$ poetry config virtualenvs.options.system-site-packages <span class="literal">true</span> --<span class="built_in">local</span></span><br><span class="line">$ more poetry.toml</span><br><span class="line">[virtualenvs]</span><br><span class="line">in-project = <span class="literal">true</span></span><br><span class="line">[virtualenvs.options]</span><br><span class="line">system-site-packages = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œè¦æ³¨æ„ virtualenvs ä¸‹çš„å±æ€§å¿…é¡»åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå‰è®¾ç½®æ‰ä¼šæœ‰æ•ˆ</span></span><br></pre></td></tr></table></figure><h3 id="env-è™šæ‹Ÿç¯å¢ƒç®¡ç†">env : è™šæ‹Ÿç¯å¢ƒç®¡ç†</h3><ul class="lvl-0"><li class="lvl-2"><p>Poetry ä¼šåœ¨ä½ ç¬¬ä¸€æ¬¡è¿è¡ŒæŸäº›å‘½ä»¤ï¼ˆå¦‚ <code>poetry shell</code> æˆ–è€… <code>poetry add somepackage</code>ï¼‰æ—¶è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚</p></li><li class="lvl-2"><p>ä¸è¿‡è¿™ç§æ—¶å€™éƒ½æ˜¯ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„pythonæ¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœç³»ç»Ÿä¸­å®‰è£…äº†å¤šä¸ªpythonï¼Œåˆ™å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¾ç½®è™šæ‹Ÿç¯å¢ƒè¦ä½¿ç”¨å“ªä¸ªpythonç‰ˆæœ¬</p></li><li class="lvl-2"><p>åˆ›å»º/åˆ‡æ¢è™šæ‹Ÿç¯å¢ƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®špythonçš„ç‰ˆæœ¬ï¼Œè¿™ä¼šä»pythonçš„é»˜è®¤å®‰è£…è·¯å¾„ä¸‹æŸ¥æ‰¾å¯¹åº”çš„ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"># æ¯”å¦‚macOsä¼šä»è¯¥è·¯å¾„ä¸‹æŸ¥æ‰¾ï¼š/Library/Frameworks/Python.framework/Versions</span></span><br><span class="line">$ poetry <span class="built_in">env</span> use 3.11</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨pythonå‘½ä»¤,æ¯”å¦‚ï¼špython3.12 -Vï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">$ poetry <span class="built_in">env</span> use python3.12</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœpythonå®‰è£…åˆ°äº†å…¶å®ƒè·¯å¾„ï¼Œå¯ä»¥æŒ‡å®špythonå®‰è£…è·¯å¾„</span></span><br><span class="line">$ poetry <span class="built_in">env</span> use /pythonDir/3.13/bin/python3</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å½“å‰é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåŸºäº python3.13 çš„è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">$ poetry <span class="built_in">env</span> use python3.13</span><br><span class="line">Creating virtualenv poetrydemo-fyqYbfje-py3.13 <span class="keyword">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class="line">Using virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13</span><br><span class="line"><span class="comment"># å†åˆ›å»ºä¸€ä¸ªåŸºäº python3.11 çš„è™šæ‹Ÿç¯å¢ƒï¼Œæœ€åè¢«useçš„å¤„äºé»˜è®¤æ¿€æ´»çŠ¶æ€</span></span><br><span class="line">$ poetry <span class="built_in">env</span> use python3.11</span><br><span class="line">Creating virtualenv poetrydemo-fyqYbfje-py3.11 <span class="keyword">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class="line">Using virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰é¡¹ç›®æœ‰å¤šå°‘ä¸ªè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">$ poetry <span class="built_in">env</span> list</span><br><span class="line">poetrydemo-fyqYbfje-py3.11 (Activated) <span class="comment"># poetrydemo-fyqYbfje-py3.11 è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»</span></span><br><span class="line">poetrydemo-fyqYbfje-py3.13</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è™šæ‹ŸåŒ–ç¯å¢ƒè·¯å¾„</span></span><br><span class="line">$ poetry <span class="built_in">env</span> list  --full-path</span><br><span class="line">/Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11 (Activated)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</span></span><br><span class="line">$ poetry <span class="built_in">env</span> info</span><br><span class="line"></span><br><span class="line">Virtualenv</span><br><span class="line">Python:         3.11.3</span><br><span class="line">Implementation: CPython</span><br><span class="line">Path:           /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class="line">Executable:     /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/python</span><br><span class="line">Valid:          True</span><br><span class="line"></span><br><span class="line">Base</span><br><span class="line">Platform:   darwin</span><br><span class="line">OS:         posix</span><br><span class="line">Python:     3.11.3</span><br><span class="line">Path:       /Library/Frameworks/Python.framework/Versions/3.11</span><br><span class="line">Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">$ poetry <span class="built_in">env</span> remove python3.13</span><br><span class="line">Deleted virtualenv: /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.13</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤å…¨éƒ¨è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">$ poetry <span class="built_in">env</span> remove --all</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ³¨æ„ï¼Œå½“<code>virtualenvs.in-project</code>è¢«è®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œå³åªåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ï¼Œåªä¼šä¿ç•™ä¸€ä¸ªç¯å¢ƒï¼Œå³<code>.venv</code></p></li><li class="lvl-2"><p>åˆ‡æ¢åˆ°æ–°çš„è™šæ‹Ÿç¯å¢ƒæ—¶ä¼šå…¨æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ç¯å¢ƒï¼ŒåŸå…ˆçš„ç¯å¢ƒä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥è¦ä½¿ç”¨<code>poetry install</code>å‘½ä»¤é‡æ–°å®‰è£…ä¾èµ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ poetry <span class="built_in">env</span> use python3.11</span><br><span class="line">Recreating virtualenv poetrydemo <span class="keyword">in</span> /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class="line">Using virtualenv: /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class="line"></span><br><span class="line">$ poetry <span class="built_in">env</span> list <span class="comment"># è™½ç„¶å¯ä»¥é€šè¿‡ poetry env use çš„æ–¹å¼æ¥åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒï¼Œä½†å®é™…ä¸Šåªä¼šæœ‰ä¸€ä¸ªç¯å¢ƒè¢«ä¿ç•™ï¼Œæ‰€ä»¥è¿™é‡Œåªä¼šæ˜¾ç¤ºä¸€ä¸ª</span></span><br><span class="line">.venv (Activated) <span class="comment"># .venv è¡¨ç¤ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼ŒActivatedè¡¨ç¤ºå½“å‰è™šæ‹Ÿç¯å¢ƒå·²ç»è¢«æ¿€æ´»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒä¿¡æ¯</span></span><br><span class="line">$ poetry <span class="built_in">env</span> info</span><br><span class="line"></span><br><span class="line">Virtualenv</span><br><span class="line">Python:         3.11.3</span><br><span class="line">Implementation: CPython</span><br><span class="line">Path:           /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv</span><br><span class="line">Executable:     /Users/hanqf/Desktop/pythonDir/poetryDir/poetryDemo/.venv/bin/python</span><br><span class="line">Valid:          True</span><br><span class="line"></span><br><span class="line">Base</span><br><span class="line">Platform:   darwin</span><br><span class="line">OS:         posix</span><br><span class="line">Python:     3.11.3</span><br><span class="line">Path:       /Library/Frameworks/Python.framework/Versions/3.11</span><br><span class="line">Executable: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11</span><br></pre></td></tr></table></figure><h3 id="ä¾èµ–åŒ…ç®¡ç†">ä¾èµ–åŒ…ç®¡ç†</h3><ul class="lvl-0"><li class="lvl-2"><p>add : å®‰è£…ä¾èµ–åŒ…</p></li></ul><blockquote><p>è¿™ä¸ªå‘½ä»¤ä¼šä¿®æ”¹ pyproject.toml æ–‡ä»¶ï¼Œåœ¨ [tool.poetry.dependencies] éƒ¨åˆ†æ·»åŠ æ–°çš„ä¾èµ–é¡¹ã€‚è¿˜ä¼šè‡ªåŠ¨æ›´æ–° poetry.lock æ–‡ä»¶ï¼Œé”å®šä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–ï¼Œå®‰è£…åä¼šå°†ä¾èµ–ä¿¡æ¯å†™å…¥ pyproject.toml ä¸­</span></span><br><span class="line"><span class="comment"># ä¸æŒ‡å®šç‰ˆæœ¬åˆ™å®‰è£…æœ€æ–°ç‰ˆ</span></span><br><span class="line">$ poetry add fastapi</span><br><span class="line">Using version ^0.115.5 <span class="keyword">for</span> fastapi</span><br><span class="line"></span><br><span class="line">Updating dependencies</span><br><span class="line">Resolving dependencies... (1.3s)</span><br><span class="line"></span><br><span class="line">Package operations: 9 installs, 0 updates, 0 removals</span><br><span class="line"></span><br><span class="line">  - Installing idna (3.10)</span><br><span class="line">  - Installing sniffio (1.3.1)</span><br><span class="line">  - Installing typing-extensions (4.12.2)</span><br><span class="line">  - Installing annotated-types (0.7.0)</span><br><span class="line">  - Installing anyio (4.6.2.post1)</span><br><span class="line">  - Installing pydantic-core (2.23.4)</span><br><span class="line">  - Installing pydantic (2.9.2)</span><br><span class="line">  - Installing starlette (0.41.3)</span><br><span class="line">  - Installing fastapi (0.115.5)</span><br><span class="line"></span><br><span class="line">Writing lock file</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç‰ˆæœ¬å·å®‰è£…ä¾èµ–</span></span><br><span class="line">poetry add package_name@^1.2.3</span><br><span class="line">    <span class="comment"># è§„åˆ™è¯´æ˜</span></span><br><span class="line">    ^1.2.3 è¡¨ç¤ºå…¼å®¹ 1.2.3 åŠæ›´é«˜çš„å°ç‰ˆæœ¬ï¼Œä½†ä¸åŒ…æ‹¬ 2.0.0ã€‚    å¦‚ï¼špoetry add requests@^2.28.0</span><br><span class="line">    ~1.2.3ï¼šå…è®¸å‡çº§åˆ° 1.2.xï¼Œä½†ä¸åŒ…æ‹¬ 1.3.0ã€‚               å¦‚ï¼špoetry add requests@~2.28.0</span><br><span class="line">    1.2.3ï¼šå›ºå®šä¸º 1.2.3ã€‚                                   å¦‚ï¼špoetry add requests@2.28.0</span><br><span class="line">    &gt;=1.2.3ï¼šå…è®¸ä½¿ç”¨ 1.2.3 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add <span class="string">&quot;requests@&gt;=2.28.0&quot;</span></span><br><span class="line">    &lt;2.0.0ï¼šå…è®¸ä½¿ç”¨å°äº 2.0.0 çš„ç‰ˆæœ¬ã€‚ æ³¨æ„zshä¸‹è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦‚ï¼špoetry add <span class="string">&quot;requests@&lt;3.0.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…åˆ°æŒ‡å®šçš„åˆ†ç»„ï¼Œé»˜è®¤éƒ½æ˜¯å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­çš„ï¼Œpoetry buildé»˜è®¤åªä¼šæ‰“åŒ…ä¸»ç¯å¢ƒçš„ä¾èµ–</span></span><br><span class="line">poetry add flask <span class="comment"># å®‰è£…åˆ°ä¸»ç¯å¢ƒä¸­</span></span><br><span class="line">poetry add flask --group=<span class="built_in">test</span> <span class="comment">#æ·»åŠ åˆ†ç»„å test</span></span><br><span class="line">poetry add flask --dev  <span class="comment">#ç›¸å½“äº--group=dev</span></span><br><span class="line"><span class="comment"># åˆ†åˆ«æ‰§è¡Œä¸Šé¢3ä¸ªå®‰è£…å‘½ä»¤åï¼Œè¾“å‡º pyproject.toml çš„å†…å®¹å¦‚ä¸‹</span></span><br><span class="line">[tool.poetry]</span><br><span class="line">name = <span class="string">&quot;poetrydemo&quot;</span></span><br><span class="line">version = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line">description = <span class="string">&quot;&quot;</span></span><br><span class="line">authors = [<span class="string">&quot;hanqunfeng &lt;hanqf2008@163.com&gt;&quot;</span>]</span><br><span class="line">readme = <span class="string">&quot;README.md&quot;</span></span><br><span class="line"></span><br><span class="line">[tool.poetry.dependencies] <span class="comment"># ä¸»ç¯å¢ƒ</span></span><br><span class="line">python = <span class="string">&quot;^3.11&quot;</span></span><br><span class="line">flask = <span class="string">&quot;^3.1.0&quot;</span></span><br><span class="line"></span><br><span class="line">[tool.poetry.group.test.dependencies] <span class="comment"># teståˆ†ç»„ä¾èµ–</span></span><br><span class="line">flask = <span class="string">&quot;^3.1.0&quot;</span></span><br><span class="line"></span><br><span class="line">[tool.poetry.group.dev.dependencies] <span class="comment"># devåˆ†ç»„ä¾èµ–</span></span><br><span class="line">flask = <span class="string">&quot;^3.1.0&quot;</span></span><br><span class="line"></span><br><span class="line">[build-system]</span><br><span class="line">requires = [<span class="string">&quot;poetry-core&quot;</span>]</span><br><span class="line">build-backend = <span class="string">&quot;poetry.core.masonry.api&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>show : æŸ¥çœ‹ä¾èµ–åŒ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰é¡¹ç›®éƒ½éœ€è¦å“ªäº›ä¾èµ–ï¼Œè¿™äº›ä¾èµ–ä¸ä¸€å®šéƒ½å®‰è£…äº†ï¼Œå®ƒåªæ˜¯è§£æ pyproject.toml ä¸­çš„å£°æ˜æ¥è§£æä¾èµ–æ ‘</span></span><br><span class="line">$ poetry show</span><br><span class="line">annotated-types   0.7.0       Reusable constraint types to use with typing.Annotated</span><br><span class="line">anyio             4.6.2.post1 High level compatibility layer <span class="keyword">for</span> multiple asynchronous ...</span><br><span class="line">fastapi           0.115.5     FastAPI framework, high performance, easy to learn, fast ...</span><br><span class="line">idna              3.10        Internationalized Domain Names <span class="keyword">in</span> Applications (IDNA)</span><br><span class="line">pydantic          2.9.2       Data validation using Python <span class="built_in">type</span> hints</span><br><span class="line">pydantic-core     2.23.4      Core functionality <span class="keyword">for</span> Pydantic validation and serialization</span><br><span class="line">sniffio           1.3.1       Sniff out <span class="built_in">which</span> async library your code is running under</span><br><span class="line">starlette         0.41.3      The little ASGI library that shines.</span><br><span class="line">typing-extensions 4.12.2      Backported and Experimental Type Hints <span class="keyword">for</span> Python 3.8+</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªæŸ¥çœ‹é¡¶çº§ä¾èµ–ï¼Œå³åªæŸ¥çœ‹åœ¨ pyproject.toml ä¸­å£°æ˜çš„ä¾èµ–</span></span><br><span class="line">$ poetry show --top-level</span><br><span class="line">fastapi           0.115.5     FastAPI framework, high performance, easy to learn, fast ...</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>remove : åˆ é™¤ä¾èµ–åŒ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤ä¾èµ–ï¼Œæ­¤æ—¶ä¼šå°†å½“å‰åŒ…åŠå…¶æ‰€æœ‰ä¾èµ–ä¸€å—åˆ é™¤</span></span><br><span class="line">$ poetry remove fastapi</span><br><span class="line">Updating dependencies</span><br><span class="line">Resolving dependencies... (0.1s)</span><br><span class="line"></span><br><span class="line">Package operations: 0 installs, 0 updates, 9 removals</span><br><span class="line"></span><br><span class="line">  - Removing annotated-types (0.7.0)</span><br><span class="line">  - Removing anyio (4.6.2.post1)</span><br><span class="line">  - Removing fastapi (0.115.5)</span><br><span class="line">  - Removing idna (3.10)</span><br><span class="line">  - Removing pydantic (2.9.2)</span><br><span class="line">  - Removing pydantic-core (2.23.4)</span><br><span class="line">  - Removing sniffio (1.3.1)</span><br><span class="line">  - Removing starlette (0.41.3)</span><br><span class="line">  - Removing typing-extensions (4.12.2)</span><br><span class="line"></span><br><span class="line">Writing lock file</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>search : æœç´¢è¿œç¨‹ä»“åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœç´¢è¿œç¨‹ä»“åº“</span></span><br><span class="line">$ poetry search fastapi</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>install å’Œ update : å®‰è£…å’Œæ›´æ–°ä¾èµ–åŒ…<br><em><strong>åœ¨ Poetry ä¸­ï¼Œinstall å’Œ update æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œä½†å®ƒä»¬çš„ä½œç”¨å’Œä½¿ç”¨åœºæ™¯ä¸åŒ</strong></em></p><ul class="lvl-2"><li class="lvl-7"><p><code>poetry install</code> çš„ä½œç”¨æ˜¯æ ¹æ®ç°æœ‰çš„ poetry.lock æ–‡ä»¶æ¥å®‰è£…ä¾èµ–ï¼Œç¡®ä¿å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ä¸é”æ–‡ä»¶ä¸­è®°å½•çš„ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ã€‚<br>æ ¸å¿ƒç‰¹ç‚¹ï¼š</p><ul class="lvl-4"><li class="lvl-10">å®‰è£…é”å®šçš„ç‰ˆæœ¬ï¼šå®ƒåªä¼šå®‰è£… poetry.lock æ–‡ä»¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå³ä½¿ pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ç‰ˆæœ¬èŒƒå›´å·²ç»æœ‰æ›´æ–°ç‰ˆæœ¬ã€‚</li><li class="lvl-10">é‡ç°ä¾èµ–ç¯å¢ƒï¼šé€‚ç”¨äºå›¢é˜Ÿåä½œæˆ–éƒ¨ç½²ç¯å¢ƒï¼Œç¡®ä¿æ‰€æœ‰äººæˆ–æœºå™¨å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬å®Œå…¨ç›¸åŒã€‚</li><li class="lvl-10">é”æ–‡ä»¶å­˜åœ¨æ—¶æ›´é«˜æ•ˆï¼šå¦‚æœ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry install ä¸ä¼šé‡æ–°è§£æä¾èµ–æ ‘ã€‚</li><li class="lvl-10">é¦–æ¬¡è¿è¡Œæ—¶ç”Ÿæˆé”æ–‡ä»¶ï¼šå¦‚æœæ²¡æœ‰ poetry.lock æ–‡ä»¶ï¼Œpoetry install ä¼šè§£æä¾èµ–å¹¶ç”Ÿæˆé”æ–‡ä»¶ã€‚<br>ä½¿ç”¨åœºæ™¯ï¼š</li><li class="lvl-10">æ–°å…‹éš†çš„é¡¹ç›®ï¼Œéœ€è¦å®‰è£…ä¾èµ–ç¯å¢ƒã€‚</li><li class="lvl-10">éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–ç‰ˆæœ¬çš„ç¨³å®šæ€§ã€‚</li><li class="lvl-10">é‡æ–°å®‰è£…ä¹‹å‰å·²å®šä¹‰çš„ä¾èµ–ï¼ˆä¾‹å¦‚æ¸…ç©ºäº†è™šæ‹Ÿç¯å¢ƒï¼‰ã€‚</li></ul></li><li class="lvl-6"><p><code>poetry update</code> çš„ä½œç”¨æ˜¯æ ¹æ® pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„ä¾èµ–èŒƒå›´é‡æ–°è§£æä¾èµ–æ ‘ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ä¸ºæœ€æ–°çš„ç‰ˆæœ¬ã€‚<br>æ ¸å¿ƒç‰¹ç‚¹ï¼š</p><ul class="lvl-4"><li class="lvl-10">æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼šå®ƒä¼šå°è¯•å®‰è£…ä¾èµ–èŒƒå›´å†…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶æ›´æ–° poetry.lock æ–‡ä»¶ã€‚</li><li class="lvl-10">è§£ææ–°çš„ä¾èµ–æ ‘ï¼šå³ä½¿ poetry.lock æ–‡ä»¶å­˜åœ¨ï¼Œpoetry update ä¹Ÿä¼šå¿½ç•¥å®ƒå¹¶é‡æ–°è§£æä¾èµ–ã€‚</li><li class="lvl-10">æ›´æ”¹é”æ–‡ä»¶ï¼šå®ƒä¼šè¦†ç›–ç°æœ‰çš„ poetry.lock æ–‡ä»¶ï¼Œå› æ­¤å›¢é˜Ÿå…¶ä»–æˆå‘˜éœ€è¦é‡æ–°è¿è¡Œ poetry install ä»¥åŒæ­¥ã€‚<br>ä½¿ç”¨åœºæ™¯ï¼š</li><li class="lvl-10">æ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆåœ¨ä¾èµ–èŒƒå›´å†…ï¼‰ã€‚</li><li class="lvl-10">å½“æ·»åŠ æ–°ä¾èµ–åï¼Œæƒ³è¦å®‰è£…å¹¶æ›´æ–°é”æ–‡ä»¶ã€‚</li><li class="lvl-10">ä¿®å¤å¯èƒ½çš„ç‰ˆæœ¬å†²çªæˆ–ä¸å…¼å®¹é—®é¢˜ã€‚</li></ul></li></ul></li></ul><h3 id="lock-é”å®šä¾èµ–åŒ…">lock : é”å®šä¾èµ–åŒ…</h3><ul class="lvl-0"><li class="lvl-2"><p><code>poetry lock</code> æ˜¯ Poetryï¼ˆä¸€ä¸ª Python åŒ…ç®¡ç†å·¥å…·ï¼‰ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºé”å®šé¡¹ç›®çš„ä¾èµ–å…³ç³»ã€‚ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥åˆ›å»ºæˆ–æ›´æ–° <code>poetry.lock</code> æ–‡ä»¶ï¼Œç¡®ä¿ä½ çš„é¡¹ç›®ä¸­æ‰€ä½¿ç”¨çš„æ¯ä¸ªåŒ…çš„ç‰ˆæœ¬éƒ½è¢«æ˜ç¡®è®°å½•ä¸‹æ¥ã€‚è¿™æ ·åšå¯¹äºé¡¹ç›®çš„å¯å¤ç°æ€§å’Œç¨³å®šæ€§è‡³å…³é‡è¦ã€‚</p></li><li class="lvl-2"><p>å®é™…ä¸Šï¼Œå½“è¿è¡Œ <code>poetry install</code> ã€ <code>poetry update</code> æˆ–è€… <code>poetry add</code> ç­‰å‘½ä»¤æ—¶ï¼Œ poetry éƒ½ä¼šæ ¹æ®<br><code>pyproject.toml</code> æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œè§£æä¾èµ–æ ‘ï¼Œå¹¶åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºæˆ–æ›´æ–° <code>poetry.lock</code> æ–‡ä»¶ã€‚</p></li><li class="lvl-2"><p>å½“æˆ‘ä»¬æ‰‹å·¥ä¿®æ”¹äº† <code>pyproject.toml</code> æ–‡ä»¶ä¸­çš„ä¾èµ–èŒƒå›´ï¼Œæ­¤æ—¶åˆä¸æƒ³ç«‹åˆ»æ›´æ–°ä¾èµ–ï¼Œè€Œæ˜¯å¸Œæœ›åœ¨æŸä¸ªæ—¶æœºå†æ›´æ–°ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ <code>poetry lock</code> å‘½ä»¤ï¼Œå…ˆé”å®šè¿™äº›ä¾èµ–ï¼Œä¹‹åå†é€šè¿‡ <code>poetry install</code> å‘½ä»¤å®‰è£…ã€‚</p></li><li class="lvl-2"><p>å¯ä»¥ä½¿ç”¨ <code>poetry check</code> å‘½ä»¤æ£€æŸ¥ <code>pyproject.toml</code> æ–‡ä»¶ ä¸ <code>poetry.lock</code> æ–‡ä»¶çš„ä¸€è‡´æ€§ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯”å¦‚æˆ‘æ‰‹å·¥åˆ é™¤äº† `pyproject.toml` æ–‡ä»¶ä¸­çš„æŸä¸ªä¾èµ–</span></span><br><span class="line"><span class="comment"># æ­¤æ—¶è¿è¡Œ check æ£€æŸ¥ä¸€è‡´æ€§ä¼šæŠ¥é”™</span></span><br><span class="line">$ poetry check</span><br><span class="line">Error: pyproject.toml changed significantly since poetry.lock was last generated. Run `poetry lock [--no-update]` to fix the lock file.</span><br><span class="line"><span class="comment"># é”å®šä¾èµ–</span></span><br><span class="line">$ poetry lock</span><br><span class="line">Updating dependencies</span><br><span class="line">Resolving dependencies... (0.1s)</span><br><span class="line"></span><br><span class="line">Writing lock file</span><br><span class="line"><span class="comment"># æ£€æŸ¥ä¸€è‡´æ€§é€šè¿‡</span></span><br><span class="line">$ poetry check</span><br><span class="line">All <span class="built_in">set</span>!</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">æ³¨æ„ï¼Œæ­¤æ—¶é€šè¿‡ <code>poetry show</code> æŸ¥çœ‹ä¸åˆ°é‚£ä¸ªæ‰‹å·¥åˆ é™¤çš„ä¾èµ–åŒ…ï¼Œä½†å®é™…ä¸Šä¾èµ–ä¾æ—§åœ¨äºè™šæ‹Ÿç¯å¢ƒä¸­</li><li class="lvl-2">æ‰€ä»¥å°½é‡é¿å…æ‰‹å·¥åˆ é™¤ä¾èµ–ï¼Œè€Œæ˜¯é€šè¿‡ <code>poetry remove</code> å‘½ä»¤æ¥åˆ é™¤ä¾èµ–</li></ul></div><h3 id="source-é•œåƒæºç®¡ç†">source : é•œåƒæºç®¡ç†</h3><ul class="lvl-0"><li class="lvl-2"><p>é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ä»Pypiçš„å®˜æ–¹ä»“åº“ä¸‹è½½ï¼Œå›½å†…ä¸€èˆ¬éœ€è¦æŒ‡å®šé•œåƒæºæ¥åŠ é€Ÿä¸‹è½½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ é•œåƒæºï¼Œé»˜è®¤å°±æ˜¯ä¸»è¦æºï¼Œæ³¨æ„è¯¥æ–¹å¼åªå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼ï¼špoetry source add [é€‰é¡¹] [--] &lt;name&gt; [&lt;url&gt;]ï¼Œnameï¼šæºä»“åº“çš„åç§°ï¼Œurlï¼šæºä»“åº“çš„ URL</span></span><br><span class="line">$ poetry <span class="built_in">source</span> add tsinghua https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">Adding <span class="built_in">source</span> with name tsinghua.</span><br><span class="line"></span><br><span class="line"><span class="comment"># --priority=PRIORITYè®¾ç½®æ­¤æºçš„ä¼˜å…ˆçº§ã€‚å¯ä»¥æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼šdefaultï¼ˆé»˜è®¤ï¼‰ã€primaryï¼ˆä¸»è¦ï¼‰ã€supplementalï¼ˆå¤‡ç”¨ï¼‰ã€explicitï¼ˆæ˜¾å¼æºï¼Œåªæœ‰å½“åŒ…æ˜ç¡®å£°æ˜ä½¿ç”¨è¯¥æºæ—¶æ‰ä¼šè¢«ä½¿ç”¨ï¼‰ã€‚é»˜è®¤ä¸º primaryã€‚</span></span><br><span class="line">$ poetry <span class="built_in">source</span> add  --priority=supplemental aliyun http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é•œåƒæºä¿¡æ¯</span></span><br><span class="line">$ poetry <span class="built_in">source</span> show</span><br><span class="line"> name      : tsinghua</span><br><span class="line"> url       : https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"> priority  : primary</span><br><span class="line"></span><br><span class="line"> name      : aliyun</span><br><span class="line"> url       : http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line"> priority  : supplemental</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶æŸ¥çœ‹ pyproject.toml æ–‡ä»¶å¯ä»¥çœ‹åˆ°é•œåƒæºä¿¡æ¯</span></span><br><span class="line">[[tool.poetry.source]]</span><br><span class="line">name = <span class="string">&quot;tsinghua&quot;</span></span><br><span class="line">url = <span class="string">&quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;</span></span><br><span class="line">priority = <span class="string">&quot;primary&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[[tool.poetry.source]]</span><br><span class="line">name = <span class="string">&quot;aliyun&quot;</span></span><br><span class="line">url = <span class="string">&quot;http://mirrors.aliyun.com/pypi/simple/&quot;</span></span><br><span class="line">priority = <span class="string">&quot;supplemental&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤é•œåƒæº</span></span><br><span class="line">$ poetry <span class="built_in">source</span> remove aliyun <span class="comment"># æŒ‡å®šé•œåƒæºåç§°</span></span><br><span class="line">Removing <span class="built_in">source</span> with name aliyun.</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œ">è¿è¡Œ</h3><p>è¿™é‡Œä»¥ä¸€ä¸ªå°ç¤ºä¾‹æ¥è¯´æ˜è¿™ä¸ªåŠŸèƒ½</p><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ poetry new poetryDemo</span><br><span class="line">Created package poetrydemo <span class="keyword">in</span> poetryDemo</span><br><span class="line"><span class="comment"># è¿›å…¥é¡¹ç›®ç›®å½•</span></span><br><span class="line">$ <span class="built_in">cd</span> poetryDemo</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶</span></span><br><span class="line">$ ll</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  6 hanqf  staff  192 11 21 17:32 .</span><br><span class="line">drwxr-xr-x  4 hanqf  staff  128 11 21 17:32 ..</span><br><span class="line">-rw-r--r--  1 hanqf  staff    0 11 21 17:32 README.md</span><br><span class="line">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 poetrydemo</span><br><span class="line">-rw-r--r--  1 hanqf  staff  266 11 21 17:32 pyproject.toml</span><br><span class="line">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 tests</span><br><span class="line"><span class="comment"># è¿›å…¥åŒ…ç›®å½•</span></span><br><span class="line">$ <span class="built_in">cd</span> poetrydemo</span><br><span class="line"><span class="comment"># æŸ¥çœ‹åŒ…ç›®å½•ä¸‹çš„æ–‡ä»¶</span></span><br><span class="line">$ ll</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  3 hanqf  staff   96 11 21 17:32 .</span><br><span class="line">drwxr-xr-x  6 hanqf  staff  192 11 21 17:32 ..</span><br><span class="line">-rw-r--r--  1 hanqf  staff    0 11 21 17:32 __init__.py</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨åŒ…ç›®å½•ä¸‹åˆ›å»º array_util.pyï¼Œå†…å®¹å¦‚ä¸‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">def generate_random_array(shape, distribution=<span class="string">&quot;uniform&quot;</span>, params=None, seed=None):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    ç”Ÿæˆéšæœºæ•°ç»„çš„å·¥å…·æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param shape: tupleï¼ŒæŒ‡å®šæ•°ç»„çš„å½¢çŠ¶ï¼Œä¾‹å¦‚ (3, 4) è¡¨ç¤º 3 è¡Œ 4 åˆ—ã€‚</span></span><br><span class="line"><span class="string">    :param distribution: strï¼ŒæŒ‡å®šéšæœºæ•°åˆ†å¸ƒç±»å‹ï¼Œå¯é€‰å€¼ï¼š</span></span><br><span class="line"><span class="string">        - &quot;</span>uniform<span class="string">&quot;ï¼šå‡åŒ€åˆ†å¸ƒï¼ˆé»˜è®¤ï¼‰ã€‚</span></span><br><span class="line"><span class="string">        - &quot;</span>normal<span class="string">&quot;ï¼šæ­£æ€åˆ†å¸ƒã€‚</span></span><br><span class="line"><span class="string">        - &quot;</span><span class="built_in">integer</span><span class="string">&quot;ï¼šéšæœºæ•´æ•°ã€‚</span></span><br><span class="line"><span class="string">    :param params: dictï¼Œåˆ†å¸ƒçš„å‚æ•°é…ç½®ï¼š</span></span><br><span class="line"><span class="string">        - å‡åŒ€åˆ†å¸ƒï¼š&#123;&quot;</span>low<span class="string">&quot;: æœ€å°å€¼, &quot;</span>high<span class="string">&quot;: æœ€å¤§å€¼&#125;ï¼Œé»˜è®¤ low=0, high=1ã€‚</span></span><br><span class="line"><span class="string">        - æ­£æ€åˆ†å¸ƒï¼š&#123;&quot;</span>mean<span class="string">&quot;: å‡å€¼, &quot;</span>std<span class="string">&quot;: æ ‡å‡†å·®&#125;ï¼Œé»˜è®¤ mean=0, std=1ã€‚</span></span><br><span class="line"><span class="string">        - éšæœºæ•´æ•°ï¼š&#123;&quot;</span>low<span class="string">&quot;: æœ€å°å€¼, &quot;</span>high<span class="string">&quot;: æœ€å¤§å€¼, &quot;</span>dtype<span class="string">&quot;: ç±»å‹&#125;ï¼Œé»˜è®¤ low=0, high=10ã€‚</span></span><br><span class="line"><span class="string">    :param seed: intï¼Œéšæœºæ•°ç§å­ï¼ˆå¯é€‰ï¼‰ï¼Œç”¨äºç»“æœå¯å¤ç°ã€‚</span></span><br><span class="line"><span class="string">    :return: np.ndarrayï¼Œç”Ÿæˆçš„éšæœºæ•°ç»„ã€‚</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> seed is not None:</span><br><span class="line">        np.random.seed(seed)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> params is None:</span><br><span class="line">        params = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> distribution == <span class="string">&quot;uniform&quot;</span>:</span><br><span class="line">        low = params.get(<span class="string">&quot;low&quot;</span>, 0)</span><br><span class="line">        high = params.get(<span class="string">&quot;high&quot;</span>, 1)</span><br><span class="line">        <span class="built_in">return</span> np.random.uniform(low, high, size=shape)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> distribution == <span class="string">&quot;normal&quot;</span>:</span><br><span class="line">        mean = params.get(<span class="string">&quot;mean&quot;</span>, 0)</span><br><span class="line">        std = params.get(<span class="string">&quot;std&quot;</span>, 1)</span><br><span class="line">        <span class="built_in">return</span> np.random.normal(mean, std, size=shape)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> distribution == <span class="string">&quot;integer&quot;</span>:</span><br><span class="line">        low = params.get(<span class="string">&quot;low&quot;</span>, 0)</span><br><span class="line">        high = params.get(<span class="string">&quot;high&quot;</span>, 10)</span><br><span class="line">        dtype = params.get(<span class="string">&quot;dtype&quot;</span>, int)</span><br><span class="line">        <span class="built_in">return</span> np.random.randint(low, high, size=shape, dtype=dtype)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        raise ValueError(<span class="string">&quot;ä¸æ”¯æŒçš„åˆ†å¸ƒç±»å‹ï¼å¯é€‰å€¼ä¸º &#x27;uniform&#x27;, &#x27;normal&#x27;, &#x27;integer&#x27;ã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ç”¨æ³•</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    array_uniform = generate_random_array((<span class="number">3</span>, <span class="number">4</span>), distribution=&quot;uniform&quot;, params=&#123;&quot;low&quot;: <span class="number">1</span>, &quot;high&quot;: <span class="number">10</span>&#125;)</span><br><span class="line">    array_normal = generate_random_array((<span class="number">2</span>, <span class="number">3</span>), distribution=&quot;normal&quot;, params=&#123;&quot;mean&quot;: <span class="number">0</span>, &quot;std&quot;: <span class="number">1</span>&#125;, seed=<span class="number">42</span>)</span><br><span class="line">    array_integer = generate_random_array((<span class="number">4</span>, <span class="number">5</span>), distribution=&quot;integer&quot;, params=&#123;&quot;low&quot;: <span class="number">0</span>, &quot;high&quot;: <span class="number">20</span>&#125;)</span><br><span class="line"></span><br><span class="line">    print(&quot;å‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\n&quot;, array_uniform)</span><br><span class="line">    print(&quot;æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š\n&quot;, array_normal)</span><br><span class="line">    print(&quot;éšæœºæ•´æ•°æ•°ç»„ï¼š\n&quot;, array_integer)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…ä¾èµ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ poetry add numpy</span><br><span class="line">Using version ^2.1.3 <span class="keyword">for</span> numpy</span><br><span class="line"></span><br><span class="line">Updating dependencies</span><br><span class="line">Resolving dependencies... (1.1s)</span><br><span class="line"></span><br><span class="line">Package operations: 1 install, 0 updates, 0 removals</span><br><span class="line"></span><br><span class="line">  - Installing numpy (2.1.3)</span><br><span class="line"></span><br><span class="line">Writing lock file</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œï¼Œä¸¤ç§æ–¹æ³•</p><ul class="lvl-2"><li class="lvl-6"><code>poetry run</code></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ poetry run python array_util.py</span><br><span class="line">å‡åŒ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š</span><br><span class="line">[[7.44623063 1.89415788 4.81008329 4.25556572]</span><br><span class="line">[3.31925154 6.44037063 5.3216543  7.54950573]</span><br><span class="line">[3.97160747 5.04800698 3.28299934 3.42841887]]</span><br><span class="line">æ­£æ€åˆ†å¸ƒéšæœºæ•°ç»„ï¼š</span><br><span class="line">[[ 0.49671415 -0.1382643   0.64768854]</span><br><span class="line">[ 1.52302986 -0.23415337 -0.23413696]]</span><br><span class="line">éšæœºæ•´æ•°æ•°ç»„ï¼š</span><br><span class="line">[[10 10  3  7  2]</span><br><span class="line">[ 1 11  5  1  0]</span><br><span class="line">[11 11 16  9 15]</span><br><span class="line">[14 14 18 11 19]]</span><br></pre></td></tr></table></figure><ul class="lvl-2"><li class="lvl-6"><code>poetry shell</code> : æ­¤æ—¶ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„shellï¼Œå¹¶å¼€å¯è™šæ‹Ÿç¯å¢ƒ</li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">$ poetry shell</span><br><span class="line">Spawning shell within /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11</span><br><span class="line">Restored session: 2024å¹´11æœˆ21æ—¥ æ˜ŸæœŸå›› 15æ—¶31åˆ†52ç§’ CST</span><br><span class="line">âœ  poetrydemo <span class="built_in">emulate</span> bash -c <span class="string">&#x27;. /Users/hanqf/Library/Caches/pypoetry/virtualenvs/poetrydemo-fyqYbfje-py3.11/bin/activate&#x27;</span></span><br><span class="line"><span class="comment"># åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹è¿è¡Œ</span></span><br><span class="line">$ python array_util.py</span><br></pre></td></tr></table></figure></li></ul><h3 id="æ‰“åŒ…å’Œå‘å¸ƒ">æ‰“åŒ…å’Œå‘å¸ƒ</h3><ul class="lvl-0"><li class="lvl-2"><p>æ¥ç€ä¸Šé¢çš„é¡¹ç›®</p></li><li class="lvl-2"><p>æ‰“åŒ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º dist ç›®å½•ï¼Œå¹¶å°†æ‰“å¥½çš„åŒ…å­˜æ”¾äºæ­¤</span></span><br><span class="line">$ poetry build</span><br><span class="line">Building poetrydemo (0.1.0)</span><br><span class="line">  - Building sdist</span><br><span class="line">  - Built poetrydemo-0.1.0.tar.gz</span><br><span class="line">  - Building wheel</span><br><span class="line">  - Built poetrydemo-0.1.0-py3-none-any.whl</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç”Ÿæˆçš„æ‰“åŒ…æ–‡ä»¶</span></span><br><span class="line">$ exa -1 dist</span><br><span class="line">hqf_poetrydemo-0.1.0-py3-none-any.whl</span><br><span class="line">hqf_poetrydemo-0.1.0.tar.gz</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘å¸ƒ</p></li><li class="lvl-2"><p>é¦–å…ˆè¦å…ˆåœ¨<a href="https://pypi.org/">PyPI</a>ä¸Šæ³¨å†Œä¸ªå¸å·ï¼Œéœ€è¦å¼€å¯â€œåŒè¦ç´ èº«ä»½éªŒè¯ ï¼ˆ2FAï¼‰â€ï¼Œå¦åˆ™ä¸èƒ½è·å–å‘å¸ƒæ—¶çš„APIä»¤ç‰Œã€‚</p></li><li class="lvl-2"><p>è·å–APIä»¤ç‰Œ<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/iShot_2024-11-21_18.00.50.png" alt=""></p></li><li class="lvl-2"><p>å‘å¸ƒï¼Œä¸è¿‡è¿™æ¬¡å‘å¸ƒæç¤ºåŒ…åå·²ç»å­˜åœ¨äº†</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘å¸ƒæ—¶æç¤ºåŒ…åå·²ç»å­˜åœ¨äº†</span></span><br><span class="line">$ poetry publish -u __token__  -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtN</span><br><span class="line">Publishing poetrydemo (0.1.0) to PyPI</span><br><span class="line"> - Uploading poetrydemo-0.1.0-py3-none-any.whl FAILED</span><br><span class="line"></span><br><span class="line">HTTP Error 400: The name <span class="string">&#x27;poetrydemo&#x27;</span> is too similar to an existing project. See https://pypi.org/help/#project-name <span class="keyword">for</span> more information. | b<span class="string">&quot;&lt;html&gt;\n &lt;head&gt;\n  &lt;title&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\n \n &lt;body&gt;\n  &lt;h1&gt;400 The name &#x27;poetrydemo&#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\n  The server could not comply with the request since it is either malformed or otherwise incorrect.&lt;br/&gt;&lt;br/&gt;\nThe name &amp;#x27;poetrydemo&amp;#x27; is too similar to an existing project. See https://pypi.org/help/#project-name for more information.\n\n\n \n&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å…ˆä¿®æ”¹åŒ…åï¼Œç›´æ¥ç¼–è¾‘ pyproject.toml å³å¯ï¼Œå°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€ï¼Œç„¶åå°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ª<code>mv poetrydemo hqf_poetrydemo</code>ï¼Œå¹¶åˆ é™¤distç›®å½•ï¼Œä¹‹åé‡æ–°æ‰“åŒ…<code>poetry build</code>ï¼Œå†æ¬¡å‘å¸ƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ vim pyproject.toml <span class="comment"># å°†nameå±æ€§ä¿®æ”¹ä¸ºâ€œhqf_poetrydemoâ€</span></span><br><span class="line">$ <span class="built_in">mv</span> poetrydemo hqf_poetrydemo <span class="comment"># å°†åŒ…ç›®å½•çš„åç§°ä¹Ÿä¿®æ”¹ä¸ºè¿™ä¸ª</span></span><br><span class="line">$ <span class="built_in">rm</span> -rf dist <span class="comment"># åˆ é™¤distç›®å½•</span></span><br><span class="line">$ poetry build    <span class="comment"># é‡æ–°æ‰“åŒ…</span></span><br><span class="line">Creating virtualenv hqf-poetrydemo-fyqYbfje-py3.11 <span class="keyword">in</span> /Users/hanqf/Library/Caches/pypoetry/virtualenvs</span><br><span class="line">Building hqf_poetrydemo (0.1.0)</span><br><span class="line">  - Building sdist</span><br><span class="line">  - Built hqf_poetrydemo-0.1.0.tar.gz</span><br><span class="line">  - Building wheel</span><br><span class="line">  - Built hqf_poetrydemo-0.1.0-py3-none-any.whl</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡å‘å¸ƒ</span></span><br><span class="line">$ poetry publish -u __token__  -p pypi-AgEIcHlwaS5vcmcCJDU0Y2Q5NjhkLWYyYTEtN</span><br><span class="line"></span><br><span class="line">Publishing hqf_poetrydemo (0.1.0) to PyPI</span><br><span class="line"> - Uploading hqf_poetrydemo-0.1.0-py3-none-any.whl 100%</span><br><span class="line"> - Uploading hqf_poetrydemo-0.1.0.tar.gz 100%</span><br></pre></td></tr></table></figure><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/iShot_2024-11-21_18.13.21.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>ä¹‹åå°±å¯ä»¥åœ¨å…¶å®ƒé¡¹ç›®ä¸­å®‰è£…è¿™ä¸ªåŒ…äº†</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip install</span></span><br><span class="line">$ pip install hqf_poetrydemo</span><br><span class="line"></span><br><span class="line"><span class="comment"># poetry add</span></span><br><span class="line">$ poetry add hqf_poetrydemo</span><br><span class="line">Using version ^0.1.0 <span class="keyword">for</span> hqf-poetrydemo</span><br><span class="line"></span><br><span class="line">Updating dependencies</span><br><span class="line">Resolving dependencies... (0.5s)</span><br><span class="line"></span><br><span class="line">Package operations: 2 installs, 0 updates, 0 removals</span><br><span class="line"></span><br><span class="line">  - Installing numpy (2.1.3)</span><br><span class="line">  - Installing hqf-poetrydemo (0.1.0)</span><br><span class="line"></span><br><span class="line">Writing lock file</span><br></pre></td></tr></table></figure><h3 id="self-update-å‡çº§-poetry-ç‰ˆæœ¬"><code>self update</code> : å‡çº§ poetry ç‰ˆæœ¬</h3><ul class="lvl-0"><li class="lvl-2"><p>self ç›¸å…³å‘½ä»¤ä¸»è¦ç”¨äº poetry è‡ªèº«å®‰è£…æ’ä»¶ä½¿ç”¨</p></li><li class="lvl-2"><p>ä¼°è®¡æ’ä»¶åŠŸèƒ½ç›®å‰è¿˜ä¸æˆç†Ÿï¼Œå®˜ç½‘ä¹Ÿæ²¡æœ‰è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼Œå¹¶ä¸” windows ä¸‹æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œä¸è®¨è®ºã€‚</p></li><li class="lvl-2"><p><code>self</code>å‘½ä»¤ä¸‹ç›®å‰åªéœ€è¦è®°ä½ä¸€ä¸ªå‘½ä»¤ï¼š <code>self update</code> : å‡çº§ poetry ç‰ˆæœ¬</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ poetry self update</span><br></pre></td></tr></table></figure><h3 id="debug-resolve-æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³»"><code>debug resolve</code> : æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³»</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªæŸ¥çœ‹ï¼Œä¸å®‰è£…</span></span><br><span class="line">$ poetry debug resolve requests</span><br><span class="line">Resolving dependencies... (0.4s)</span><br><span class="line"></span><br><span class="line">Resolution results:</span><br><span class="line"></span><br><span class="line">certifi            2024.8.30</span><br><span class="line">charset-normalizer 3.4.0</span><br><span class="line">idna               3.10</span><br><span class="line">urllib3            2.2.3</span><br><span class="line">requests           2.32.3</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„ä¾èµ–å…³ç³»</span></span><br><span class="line">$ poetry debug resolve requests@2.32.3</span><br></pre></td></tr></table></figure><h3 id="cache-ç¼“å­˜ç®¡ç†">cache : ç¼“å­˜ç®¡ç†</h3><ul class="lvl-0"><li class="lvl-2"><p>poetryä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½å°±æ˜¯ç¼“å­˜å®‰è£…åŒ…ï¼Œå¯ä»¥ <code>å‡å°‘</code> ç›¸åŒçš„å®‰è£…åŒ…è¢«é‡å¤ä¸‹è½½ã€‚ä¸ºä»€ä¹ˆæ˜¯å‡å°‘è€Œä¸æ˜¯é¿å…å‘¢ï¼Ÿå› ä¸ºä¸åŒçš„é•œåƒæºçš„åŒ…æ˜¯åˆ†åˆ«ç¼“å­˜çš„ã€‚</p></li><li class="lvl-2"><p>é€šè¿‡ <code>poetry config --list </code> å¯ä»¥çœ‹åˆ° <code>cache-dir</code> çš„åœ°å€ï¼Œè¿™é‡Œå°±æ˜¯ç¼“å­˜ä¸‹è½½åŒ…çš„ç›®å½•ã€‚</p></li><li class="lvl-2"><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯</p><ul class="lvl-2"><li class="lvl-6">è§£å†³ä¾èµ–å®‰è£…é—®é¢˜ï¼š<br>å¦‚æœä½ åœ¨å®‰è£…æˆ–æ›´æ–°ä¾èµ–æ—¶é‡åˆ°é—®é¢˜ï¼ˆä¾‹å¦‚ï¼ŒæŸä¸ªåŒ…æ— æ³•æ­£ç¡®å®‰è£…æˆ–ç‰ˆæœ¬ä¸å¯¹ï¼‰ï¼Œæ¸…ç©ºç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ Poetry é‡æ–°ä¸‹è½½æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶ï¼Œä»è€Œè§£å†³é—®é¢˜ã€‚</li><li class="lvl-6">æ¸…ç†ç£ç›˜ç©ºé—´ï¼š<br>å¦‚æœä½ çš„é¡¹ç›®å¾ˆå¤šæˆ–è€…ç»å¸¸ä¿®æ”¹ä¾èµ–é¡¹ï¼Œç¼“å­˜å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ã€‚ä½¿ç”¨ poetry cache clear å¯ä»¥å¸®åŠ©é‡Šæ”¾ç£ç›˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸ç»å¸¸ä½¿ç”¨æŸäº›åŒ…æ—¶ã€‚</li><li class="lvl-6">æµ‹è¯•æœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–ï¼š<br>å¦‚æœä½ æƒ³æµ‹è¯•æŸä¸ªåŒ…çš„æ–°ç‰ˆæœ¬æ˜¯å¦è§£å†³äº†æŸä¸ªé—®é¢˜ï¼Œæˆ–è€…æƒ³ç¡®ä¿ä½ ä½¿ç”¨çš„ç¡®å®æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¼ºåˆ¶ Poetry ä»è¿œç¨‹ä»“åº“é‡æ–°ä¸‹è½½æœ€æ–°çš„åŒ…ã€‚</li><li class="lvl-6">ç¯å¢ƒå˜åŒ–ï¼š<br>å¦‚æœä½ çš„å¼€å‘æˆ–ç”Ÿäº§ç¯å¢ƒå‘ç”Ÿäº†å˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œåˆ‡æ¢äº†æ“ä½œç³»ç»Ÿã€æ›´æ–°äº† Python ç‰ˆæœ¬ç­‰ï¼‰ï¼Œæ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿ä¾èµ–é¡¹åœ¨æ–°ç¯å¢ƒä¸­æ­£ç¡®å®‰è£…ã€‚</li><li class="lvl-6">è°ƒè¯•ä¾èµ–é—®é¢˜ï¼š<br>åœ¨è°ƒè¯•ä¾èµ–é¡¹é—®é¢˜æ—¶ï¼Œæœ‰æ—¶å€™æ¸…é™¤ç¼“å­˜å¯ä»¥å¸®åŠ©ä½ ç¡®å®šé—®é¢˜æ˜¯å¦ä¸ç¼“å­˜ä¸­çš„æ—§ç‰ˆæœ¬æœ‰å…³ã€‚</li><li class="lvl-6">CI/CD ç¯å¢ƒçš„ä¸€è‡´æ€§ï¼š<br>åœ¨æŒç»­é›†æˆæˆ–æŒç»­éƒ¨ç½² (CI/CD) ç¯å¢ƒä¸­ï¼Œä¸ºäº†ç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½åŸºäºæœ€æ–°çš„ä¾èµ–ï¼Œæœ‰æ—¶ä¼šåœ¨æ„å»ºè„šæœ¬ä¸­åŒ…å«æ¸…é™¤ç¼“å­˜çš„æ­¥éª¤ã€‚</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ç¼“å­˜åˆ—è¡¨ï¼Œè¿™é‡Œä¼šæŒ‰é•œåƒæºè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">$ poetry cache list</span><br><span class="line">PyPI</span><br><span class="line">_default_cache</span><br><span class="line">tsinghua</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…é™¤æŒ‡å®šæºçš„å…¨éƒ¨ç¼“å­˜</span></span><br><span class="line">$ poetry cache clear pypi --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…é™¤æŒ‡å®šæºä¸‹æŸä¸ªåŒ…çš„ç¼“å­˜</span></span><br><span class="line">$ poetry cache clear pypi:requests:2.24.0</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;&lt;a href=&quot;https://python-poetry.org/docs/&quot;&gt;Poetry&lt;/a&gt;æ˜¯ä¸€ä¸ªè½»é‡çº§çš„pythonåŒ…ç®¡ç†å™¨ï¼Œå…¶ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€è½»æ¾åœ°æ„å»ºã€å‘å¸ƒå’Œåˆ†äº«pythonåŒ…ã€‚è¯´å®ƒè½»é‡ï¼Œæ˜¯ä¸ &lt;a href=&quot;https://docs.conda.io/projects/conda/en/stable/&quot;&gt;conda&lt;/a&gt; ç›¸æ¯” poetry æ›´è½»é‡ï¼ŒåŒæ—¶ä¸ &lt;code&gt;venv + pip&lt;/code&gt; &lt;a href=&quot;/2018/04/28/python_virtualenv/&quot; title=&quot;Python--virtualenv&quot;&gt;Python--virtualenv&lt;/a&gt; çš„æ–¹å¼ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š
&lt;ul class=&quot;lvl-2&quot;&gt;
&lt;li class=&quot;lvl-6&quot;&gt;ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ä¸‹è½½ä¾èµ–åŒ…&lt;/li&gt;
&lt;li class=&quot;lvl-6&quot;&gt;åŒ…ç®¡ç†ä¸Šæ›´åŠ ç²¾ç¡®ï¼Œåˆ é™¤ä¸éœ€è¦çš„åŒ…æ—¶ä¼šåŒæ—¶åˆ é™¤ä¸å…¶å…³è”çš„ä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„é‚£äº›ä¾èµ–åŒ…ï¼Œé¿å…æ— ç”¨çš„ä¾èµ–åŒ…é€ æˆæ‰“åŒ…ä½“ç§¯è¿‡å¤§&lt;/li&gt;
&lt;li class=&quot;lvl-6&quot;&gt;æ‰“åŒ…å’Œå‘å¸ƒæ›´åŠ ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å’Œå‘å¸ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="Python" scheme="https://blog.hanqunfeng.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>pip--CERTIFICATE_VERIFY_FAILED</title>
    <link href="https://blog.hanqunfeng.com/2024/11/18/python_pip/"/>
    <id>https://blog.hanqunfeng.com/2024/11/18/python_pip/</id>
    <published>2024-11-18T15:33:15.000Z</published>
    <updated>2024-12-05T03:41:10.932Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">æµ‹è¯•ç¯å¢ƒï¼šmacOS 13.7.1ï¼ŒPython 3.11.3</li><li class="lvl-2">ä»Šå¤©å°†<code>pip</code>å‡çº§(<code>pip install --upgrade pip</code>)åˆ°<code>24.3.1</code>ç‰ˆæœ¬åï¼Œé€šè¿‡<code>pip install</code>å‘½ä»¤å®‰è£…ä¾èµ–æ—¶ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pip install certifi</span><br><span class="line">Could not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=<span class="string">&#x27;pypi.org&#x27;</span>, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, <span class="string">&#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;</span>))) - skipping</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2">å¾ˆå¥‡æ€ªï¼Œä»<code>pip</code>è‡ªå·±çš„ç½‘ç«™ä¸Šä¸‹è½½ä¾èµ–éƒ½ä¼šå‡ºç°è¯ä¹¦æ— æ³•éªŒè¯çš„é”™è¯¯ã€‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè¯¥é—®é¢˜åªåœ¨macOSä¸Šé‡åˆ°ï¼Œå…¶ä»–å¹³å°æ²¡æœ‰é‡åˆ°è¿‡ã€‚</li><li class="lvl-2">å…ˆè¯´ç»“è®ºï¼Œæ¨èä½¿ç”¨ç¬¬äº”ç§æ–¹æ³•ã€‚</li></ul><span id="more"></span><h2 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h2><h3 id="1-trusted-host-å¿½ç•¥è¯ä¹¦éªŒè¯">1. <code>--trusted-host</code>: å¿½ç•¥è¯ä¹¦éªŒè¯</h3><ul class="lvl-0"><li class="lvl-2"><p>æŒ‡å®šä¿¡ä»»çš„è¯ä¹¦åŸŸåï¼Œä»è€Œä¸è¿›è¡ŒéªŒè¯è¯ä¹¦ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install certifi --trusted-host pypi.org --trusted-host files.pythonhosted.org</span><br></pre></td></tr></table></figure><h3 id="2-cert-æŒ‡å®šè¯ä¹¦æ–‡ä»¶">2. <code>--cert</code>: æŒ‡å®šè¯ä¹¦æ–‡ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶éœ€è¦å…ˆä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼Œç”¨Chromeæµè§ˆå™¨æ‰“å¼€<a href="https://pypi.org">https://pypi.org</a>ï¼ŒæŒ‰å¦‚ä¸‹æ­¥éª¤å¯¼å‡ºè¯ä¹¦æ–‡ä»¶<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/tMocyD.png" alt="" width="300" height="300"><br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/uS4W2W.png" alt="" width="300" height="300"><br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/OiZf9R.png" alt="" width="400" height="500"><br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/JHw2ML.png" alt="" width="400" height="300"></p></li><li class="lvl-2"><p>ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install certifi --cert ~/Downloads/GlobalSign.pem</span><br></pre></td></tr></table></figure><h3 id="3-pip-conf-é…ç½®å…¨å±€è¯ä¹¦æ–‡ä»¶">3. <code>pip.conf</code>: é…ç½®å…¨å±€è¯ä¹¦æ–‡ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>è¿˜æ˜¯éœ€è¦å…ˆä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼Œå‚è€ƒä¸Šé¢æ–¹æ³•</p></li><li class="lvl-2"><p><code>pip</code> çš„é…ç½®æ–‡ä»¶ä½ç½®å› æ“ä½œç³»ç»Ÿè€Œå¼‚ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°é…ç½®æ–‡ä»¶è·¯å¾„ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æˆ‘ä½¿ç”¨çš„æ˜¯ macOS</span></span><br><span class="line">$ pip config -v list</span><br><span class="line">For variant <span class="string">&#x27;global&#x27;</span>, will try loading <span class="string">&#x27;/Library/Application Support/pip/pip.conf&#x27;</span></span><br><span class="line">For variant <span class="string">&#x27;user&#x27;</span>, will try loading <span class="string">&#x27;/Users/hanqf/.pip/pip.conf&#x27;</span></span><br><span class="line">For variant <span class="string">&#x27;user&#x27;</span>, will try loading <span class="string">&#x27;/Users/hanqf/.config/pip/pip.conf&#x27;</span></span><br><span class="line">For variant <span class="string">&#x27;site&#x27;</span>, will try loading <span class="string">&#x27;/Library/Frameworks/Python.framework/Versions/3.11/pip.conf&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>pip</code>ä¼šä»ä¸Šé¢çš„è·¯å¾„ä¸­æŸ¥æ‰¾é…ç½®ä¿¡æ¯ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ç¬¬äºŒä¸ªï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»º<code>~/.pip/pip.conf</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[global]</span></span><br><span class="line"><span class="attr">cert</span> = ~/Downloads/GlobalSign.pem</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®å¥½åå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é…ç½®ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pip config list</span><br><span class="line">global.cert=<span class="string">&#x27;~/.pip/GlobalSign.pem&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install certifi</span><br></pre></td></tr></table></figure><h3 id="4-å°†è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿä¿¡ä»»çš„è¯ä¹¦å­˜å‚¨">4.å°†è¯ä¹¦æ·»åŠ åˆ°ç³»ç»Ÿä¿¡ä»»çš„è¯ä¹¦å­˜å‚¨</h3><h4 id="å¯¹äº-macOSï¼š">å¯¹äº macOSï¼š</h4><div class="danger"><p><em><strong>æˆ‘è®¾ç½®åä¾æ—§æŠ¥é”™ï¼Œæš‚ä¸æ¸…æ¥šåŸå› </strong></em></p></div><ul class="lvl-0"><li class="lvl-2"><p>æ‰“å¼€ <code>é’¥åŒ™ä¸²è®¿é—®</code> åº”ç”¨ç¨‹åºï¼Œå¹¶é€‰æ‹© <code>ç³»ç»Ÿé’¥åŒ™ä¸²</code> ä¸­çš„ <code>ç³»ç»Ÿ</code> (ä»ç½‘ä¸ŠæŸ¥è¯¢è¯´æ˜¯è¦åŠ å…¥<code>ç³»ç»Ÿæ ¹è¯ä¹¦</code>ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰åŠ å…¥æˆåŠŸ)</p></li><li class="lvl-2"><p><code>æ–‡ä»¶</code> ã€‹<code>å¯¼å…¥é¡¹ç›®</code> ã€‹ <code>é€‰æ‹©è¯ä¹¦æ–‡ä»¶</code></p></li><li class="lvl-2"><p>ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œå¦‚æœè¯ä¹¦ä¸å—ä¿¡ä»»ï¼Œå¯ä»¥å°†è¯ä¹¦è®¾ç½®ä¸ºä¸ºå§‹ç»ˆä¿¡ä»»è¯¥è¯ä¹¦ (åŒå‡»è¯ä¹¦ ã€‹ ä¿¡ä»» ã€‹ ä½¿ç”¨æ­¤è¯ä¹¦æ—¶ ã€‹è®¾ç½®ä¸º<code>å§‹ç»ˆä¿¡ä»»</code>)ã€‚</p></li></ul><h3 id="5-ä½¿ç”¨-Python-å®˜æ–¹æ¨èçš„è¯ä¹¦ä¿®å¤å·¥å…·-ï¼ˆæ¨èï¼‰">5.ä½¿ç”¨ Python å®˜æ–¹æ¨èçš„è¯ä¹¦ä¿®å¤å·¥å…· ï¼ˆæ¨èï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>è¿™ä¸ªæ–¹æ³•æœ€ç®€å•</p></li><li class="lvl-2"><p>è¿è¡Œè¿™ä¸ªè„šæœ¬å‰éœ€è¦å…ˆå®‰è£… <code>certifi</code>ï¼Œå…¶ä¸»è¦ç”¨äºæä¾›æƒå¨çš„CAæ ¹è¯ä¹¦åˆ—è¡¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install certifi --trusted-host pypi.org --trusted-host files.pythonhosted.org</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œè¯ä¹¦å®‰è£…è„šæœ¬ï¼ˆé€‚ç”¨äº macOS å†…ç½®çš„ Pythonï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–æ¬¡è¿è¡Œä¾æ—§ä¼šæŠ¥é”™ï¼Œä½†å®é™…ä¸Šå·²ç»è¿›è¡Œäº†ä¿®å¤ï¼Œä¸»è¦å°±æ˜¯æœ€å4æ­¥è¿›è¡Œçš„æ“ä½œ</span></span><br><span class="line"><span class="comment"># æ³¨æ„æ›¿æ¢ä½ è‡ªå·±çš„Pythonç‰ˆæœ¬å·</span></span><br><span class="line">$ /Applications/Python\ 3.11/Install\ Certificates.<span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"> -- pip install --upgrade certifi</span><br><span class="line">Requirement already satisfied: certifi <span class="keyword">in</span> /Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages (2024.8.30)</span><br><span class="line">WARNING: Retrying (Retry(total=4, connect=None, <span class="built_in">read</span>=None, redirect=None, status=None)) after connection broken by <span class="string">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class="built_in">local</span> issuer certificate (_ssl.c:1002)<span class="string">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class="line">WARNING: Retrying (Retry(total=3, connect=None, <span class="built_in">read</span>=None, redirect=None, status=None)) after connection broken by <span class="string">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class="built_in">local</span> issuer certificate (_ssl.c:1002)<span class="string">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class="line">WARNING: Retrying (Retry(total=2, connect=None, <span class="built_in">read</span>=None, redirect=None, status=None)) after connection broken by <span class="string">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class="built_in">local</span> issuer certificate (_ssl.c:1002)<span class="string">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class="line">WARNING: Retrying (Retry(total=1, connect=None, <span class="built_in">read</span>=None, redirect=None, status=None)) after connection broken by <span class="string">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class="built_in">local</span> issuer certificate (_ssl.c:1002)<span class="string">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class="line">WARNING: Retrying (Retry(total=0, connect=None, <span class="built_in">read</span>=None, redirect=None, status=None)) after connection broken by <span class="string">&#x27;SSLError(SSLCertVerificationError(1, &#x27;</span>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get <span class="built_in">local</span> issuer certificate (_ssl.c:1002)<span class="string">&#x27;))&#x27;</span>: /simple/certifi/</span><br><span class="line">Could not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=<span class="string">&#x27;pypi.org&#x27;</span>, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, <span class="string">&#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&#x27;</span>))) - skipping</span><br><span class="line"> -- removing any existing file or <span class="built_in">link</span></span><br><span class="line"> -- creating symlink to certifi certificate bundle</span><br><span class="line"> -- setting permissions</span><br><span class="line"> -- update complete</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¹‹åå†è¿è¡Œ<code>pip install</code>å‘½ä»¤ï¼Œå°±ä¸ä¼šæŠ¥é”™äº†</p></li></ul><h3 id="6-ä½¿ç”¨å…¶å®ƒé•œåƒæº">6.ä½¿ç”¨å…¶å®ƒé•œåƒæº</h3><ul class="lvl-0"><li class="lvl-2"><p>è¯¥é—®é¢˜æ˜¯å› ä¸ºPypiè½¯ä»¶ä»“åº“å®˜ç½‘çš„è¯ä¹¦æ–‡ä»¶å­˜åœ¨é—®é¢˜å¯¼è‡´çš„ï¼Œåªè¦æˆ‘ä»¬ä¸ä»å®˜ç½‘ä¸‹è½½å°±ä¸ä¼šæœ‰é—®é¢˜ã€‚</p></li><li class="lvl-2"><p>åœ¨å›½å†…ä¸ºäº†åŠ é€Ÿä¸‹è½½æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨å›½å†…çš„é•œåƒæºï¼Œä¾‹å¦‚<a href="https://developer.aliyun.com/mirror/pypi">é˜¿é‡Œäº‘çš„Pypié•œåƒæº</a>æˆ–è€…<a href="https://mirrors.tuna.tsinghua.edu.cn/help/pypi/">æ¸…åå¤§å­¦çš„Pypié•œåƒæº</a>ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å‚è€ƒå„è‡ªçš„å®˜ç½‘è¯´æ˜å³å¯ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æµ‹è¯•ç¯å¢ƒï¼šmacOS 13.7.1ï¼ŒPython 3.11.3&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;ä»Šå¤©å°†&lt;code&gt;pip&lt;/code&gt;å‡çº§(&lt;code&gt;pip install --upgrade pip&lt;/code&gt;)åˆ°&lt;code&gt;24.3.1&lt;/code&gt;ç‰ˆæœ¬åï¼Œé€šè¿‡&lt;code&gt;pip install&lt;/code&gt;å‘½ä»¤å®‰è£…ä¾èµ–æ—¶ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ pip install certifi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Could not fetch URL https://pypi.org/simple/certifi/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=&lt;span class=&quot;string&quot;&gt;&amp;#x27;pypi.org&amp;#x27;&lt;/span&gt;, port=443): Max retries exceeded with url: /simple/certifi/ (Caused by SSLError(SSLCertVerificationError(1, &lt;span class=&quot;string&quot;&gt;&amp;#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1002)&amp;#x27;&lt;/span&gt;))) - skipping&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;å¾ˆå¥‡æ€ªï¼Œä»&lt;code&gt;pip&lt;/code&gt;è‡ªå·±çš„ç½‘ç«™ä¸Šä¸‹è½½ä¾èµ–éƒ½ä¼šå‡ºç°è¯ä¹¦æ— æ³•éªŒè¯çš„é”™è¯¯ã€‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè¯¥é—®é¢˜åªåœ¨macOSä¸Šé‡åˆ°ï¼Œå…¶ä»–å¹³å°æ²¡æœ‰é‡åˆ°è¿‡ã€‚&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;å…ˆè¯´ç»“è®ºï¼Œæ¨èä½¿ç”¨ç¬¬äº”ç§æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="Python" scheme="https://blog.hanqunfeng.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Hexo NexT -- æ•°å­¦å…¬å¼</title>
    <link href="https://blog.hanqunfeng.com/2024/11/12/mathjax-demo/"/>
    <id>https://blog.hanqunfeng.com/2024/11/12/mathjax-demo/</id>
    <published>2024-11-12T13:55:05.000Z</published>
    <updated>2024-11-18T02:08:19.229Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %--><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>Hexoæ˜¯åŸºäºmarkdownçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨LaTexè¯­æ³•æ¥ç¼–å†™æ•°å­¦å…¬å¼ï¼Œåªä¸è¿‡éœ€è¦å®‰è£…ç›¸åº”çš„å…¬å¼æ¸²æŸ“æ’ä»¶æ¥å®ç°ã€‚</p></li><li class="lvl-2"><p>Nextä¸»é¢˜ æ”¯æŒçš„å…¬å¼æ’ä»¶ä¸º<code>MathJax</code>å’Œ<code>KaTeX</code>ï¼Œå®ƒä»¬éƒ½æ”¯æŒLaTexè¯­æ³•ï¼Œå‚è€ƒ: <a href="https://theme-next.js.org/docs/third-party-services/math-equations">https://theme-next.js.org/docs/third-party-services/math-equations</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„æ˜¯<a href="https://katex.org/docs/supported">Katex</a>ï¼ŒåŸå› æ˜¯æˆ‘å·²ç»ä½¿ç”¨äº†<a href="https://github.com/hexojs/hexo-renderer-markdown-it">hexo-renderer-markdown-it</a>æ¸²æŸ“å™¨ï¼Œå…¶ä¸ mathjax çš„ <a href="https://github.com/hexojs/hexo-renderer-pandoc">hexo-renderer-pandoc</a>æ¸²æŸ“å™¨ä¸èƒ½å¹¶å­˜ï¼Œæ‰€ä»¥åªèƒ½é€‰<code>Katex</code>äº†ã€‚</p></li></ul><span id="more"></span><h2 id="å®‰è£…">å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>è¯¦ç»†çš„å®‰è£…æ–¹æ³•è¯·å‚è€ƒ:<a href="https://theme-next.js.org/docs/third-party-services/math-equations">Math Equations</a></p></li><li class="lvl-2"><p>å› ä¸ºå·²ç»ä½¿ç”¨äº†<a href="https://github.com/hexojs/hexo-renderer-markdown-it">hexo-renderer-markdown-it</a>æ¸²æŸ“å™¨ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ²¡æœ‰ä½¿ç”¨<a href="https://github.com/CHENXCHEN/hexo-renderer-markdown-it-plus">hexo-renderer-markdown-it-plus</a>æ¸²æŸ“å™¨ï¼Œå…¶å®ä¸¤è€…ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œåªä¸è¿‡åè€…é»˜è®¤å°±åŠ è½½äº†ä¸€äº›æ’ä»¶ï¼Œè€Œå‰è€…éœ€è¦è‡ªå·±å®‰è£…æ’ä»¶å¹¶é…ç½®æ‰å¯ä»¥ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p>ä½†æ˜¯æµ‹è¯•æ—¶å‘ç°ï¼ŒæŒ‰ç…§å®˜ç½‘çš„é…ç½®<code>hexo-renderer-markdown-it</code> + <code>markdown-it-katex</code> çš„æ–¹å¼å¹¶ä¸èƒ½å¾ˆå¥½çš„è¿›è¡Œå…¬å¼çš„æ¸²æŸ“ï¼Œæ‰€ä»¥è¿™é‡Œå‚è€ƒäº† <code>hexo-renderer-markdown-it-plus</code> æ¸²æŸ“å™¨ï¼Œå°†å…¶æ›´æ¢ä¸º<a href="https://github.com/iktakahiro/markdown-it-katex#readme">@iktakahiro/markdown-it-katex</a>ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @iktakahiro/markdown-it-katex --save</span><br></pre></td></tr></table></figure><p>åœ¨<code>_config.yml</code>é…ç½®ä¸Šè¯¥æ’ä»¶</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config of hexo-renderer-markdown-it</span></span><br><span class="line"><span class="attr">markdown:</span></span><br><span class="line">  <span class="attr">render:</span></span><br><span class="line">    <span class="attr">html:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">xhtmlOut:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">breaks:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">linkify:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">typographer:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">quotes:</span> <span class="string">&#x27;â€œâ€â€˜â€™&#x27;</span></span><br><span class="line">  <span class="attr">plugins:</span></span><br><span class="line">    <span class="comment"># katexå…¬å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;@iktakahiro/markdown-it-katex&quot;</span></span><br></pre></td></tr></table></figure><h2 id="å®‰è£…åé‡åˆ°çš„é—®é¢˜">å®‰è£…åé‡åˆ°çš„é—®é¢˜</h2><h3 id="1-å®‰è£…åå‘ç°é€šè¿‡hexoç¼–è¯‘æ—¶ä¼šæŠ¥ç±»ä¼¼å¦‚ä¸‹è­¦å‘Š">1.å®‰è£…åå‘ç°é€šè¿‡hexoç¼–è¯‘æ—¶ä¼šæŠ¥ç±»ä¼¼å¦‚ä¸‹è­¦å‘Š</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LaTeX-incompatible input and strict mode is set to &#x27;warn&#x27;: Unicode text character &quot;å³&quot; used in math mode [unicodeTextInMathMode]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŸå› æ˜¯<code>@iktakahiro/markdown-it-katex</code>æ’ä»¶é»˜è®¤å¼€å¯çš„æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¸èƒ½åœ¨<code>$$...$$</code>æˆ–<code>$...$</code>ä¸­åŒ…å«ä¸­æ–‡ï¼Œè™½ç„¶æˆ‘è®¾ç½®çš„æ˜¯<code>math -- every_page: false</code>ï¼Œä½†å…¶åœ¨ç¼–è¯‘é˜¶æ®µä¾æ—§ä¼šæ£€æŸ¥æ‰€æœ‰çš„é¡µé¢ï¼Œä¸è¿‡æŠ¥è¿™ä¸ªè­¦å‘Šå¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥ã€‚</p></li><li class="lvl-2"><p>å¦‚æœä¸å¸Œæœ›çœ‹åˆ°è¿™ä¸ªè­¦å‘Šï¼Œå¯ä»¥ä¸º <code>@iktakahiro/markdown-it-katex</code> æ·»åŠ æ¨¡å¼çš„æ§åˆ¶è¡Œä¸º</p></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config of hexo-renderer-markdown-it</span></span><br><span class="line"><span class="attr">markdown:</span></span><br><span class="line">  <span class="attr">render:</span></span><br><span class="line">    <span class="attr">html:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">xhtmlOut:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">breaks:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">linkify:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">typographer:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">quotes:</span> <span class="string">&#x27;â€œâ€â€˜â€™&#x27;</span></span><br><span class="line">  <span class="attr">plugins:</span></span><br><span class="line">    <span class="comment"># katexå…¬å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;@iktakahiro/markdown-it-katex&quot;</span></span><br><span class="line">      <span class="attr">options:</span></span><br><span class="line">         <span class="attr">strict:</span> <span class="string">error</span> <span class="comment"># é»˜è®¤ä¸ºwarnï¼Œè¿™é‡Œè®¾ç½®ä¸ºerrorï¼Œåªæœ‰å½“è§£æå™¨é‡åˆ°ä¸æ”¯æŒçš„å…¬å¼æ—¶æ‰æŠ¥é”™ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º falseï¼Œè¡¨ç¤ºä¸æ£€æŸ¥</span></span><br></pre></td></tr></table></figure><h3 id="ä¸æ”¯æŒKatexçš„Auto-render-Extension">ä¸æ”¯æŒ<code>Katex</code>çš„<code>Auto-render Extension</code></h3><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡æŸ¥çœ‹<code>Katex</code>å®˜ç½‘å¯ä»¥çŸ¥é“ï¼Œå¼€å¯<a href="https://katex.org/docs/autorender">Auto-render Extension</a>åï¼Œ<code>Katex</code>å¯ä»¥æ¸²æŸ“æ›´å¤šçš„å…¬å¼è¯­æ³•ï¼Œä½†è¦æ³¨æ„è¿™å¹¶ä¸æ˜¯<code>LaTex</code>çš„æ ‡å‡†è¯­æ³•</p></li><li class="lvl-2"><p>ä½†æ˜¯<code>@iktakahiro/markdown-it-katex</code>ä¸­å¹¶æ²¡æœ‰ç›¸åº”çš„é…ç½®ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç®€å•çš„æ–¹æ³•å°±æ˜¯å°†æ‰€éœ€è¦çš„èµ„æºæ·»åŠ åˆ°é¡µé¢ä¸­ï¼Œæ¯”å¦‚æˆ‘åœ¨<code>source\_data\post-body-start.njk</code>ä¸­æ·»åŠ äº†å¦‚ä¸‹å†…å®¹</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;%- if page.mathjax %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css&quot;</span> <span class="attr">integrity</span>=<span class="string">&quot;sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js&quot;</span> <span class="attr">integrity</span>=<span class="string">&quot;sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js&quot;</span> <span class="attr">integrity</span>=<span class="string">&quot;sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">renderMathInElement</span>(<span class="variable language_">document</span>.<span class="property">body</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// customised options</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// â€¢ auto-render specific keys, e.g.:</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">delimiters</span>: [</span></span><br><span class="line"><span class="language-javascript">            &#123;<span class="attr">left</span>: <span class="string">&quot;$$&quot;</span>, <span class="attr">right</span>: <span class="string">&quot;$$&quot;</span>, <span class="attr">display</span>: <span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;<span class="attr">left</span>: <span class="string">&quot;\\(&quot;</span>, <span class="attr">right</span>: <span class="string">&quot;\\)&quot;</span>, <span class="attr">display</span>: <span class="literal">false</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;<span class="attr">left</span>: <span class="string">&quot;\\begin&#123;equation&#125;&quot;</span>, <span class="attr">right</span>: <span class="string">&quot;\\end&#123;equation&#125;&quot;</span>, <span class="attr">display</span>: <span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;<span class="attr">left</span>: <span class="string">&quot;\\begin&#123;align&#125;&quot;</span>, <span class="attr">right</span>: <span class="string">&quot;\\end&#123;align&#125;&quot;</span>, <span class="attr">display</span>: <span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;<span class="attr">left</span>: <span class="string">&quot;\\begin&#123;alignat&#125;&quot;</span>, <span class="attr">right</span>: <span class="string">&quot;\\end&#123;alignat&#125;&quot;</span>, <span class="attr">display</span>: <span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;<span class="attr">left</span>: <span class="string">&quot;\\begin&#123;gather&#125;&quot;</span>, <span class="attr">right</span>: <span class="string">&quot;\\end&#123;gather&#125;&quot;</span>, <span class="attr">display</span>: <span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;<span class="attr">left</span>: <span class="string">&quot;\\begin&#123;CD&#125;&quot;</span>, <span class="attr">right</span>: <span class="string">&quot;\\end&#123;CD&#125;&quot;</span>, <span class="attr">display</span>: <span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;<span class="attr">left</span>: <span class="string">&quot;\\[&quot;</span>, <span class="attr">right</span>: <span class="string">&quot;\\]&quot;</span>, <span class="attr">display</span>: <span class="literal">true</span>&#125;</span></span><br><span class="line"><span class="language-javascript">            ],</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// â€¢ rendering keys, e.g.:</span></span></span><br><span class="line"><span class="language-javascript">          throwOnError : <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;%- endif %&#125;</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å°è´´å£«</strong></em><br>å¯ä»¥é€šè¿‡nextæ¨¡æ¿çš„<code>_config.yml</code>ä¸­çš„<code>custom_file_path</code>é…ç½®é¡¹æ¥è‡ªå®šä¹‰æ¸²æŸ“é¡µé¢çš„æŸä¸ªéƒ¨åˆ†ï¼Œè¿™æ ·å¯¹åº”çš„æ¯ä¸ªé¡µé¢éƒ½ä¼šåŠ ä¸Šè¯¥æ¨¡æ¿å†…å®¹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">custom_file_path:</span></span><br><span class="line">  <span class="attr">postBodyStart:</span> <span class="string">source/_data/post-body-start.njk</span></span><br></pre></td></tr></table></figure></div><hr><div class="warning"><ul class="lvl-1"><li class="lvl-2"><p>ä½¿ç”¨<code>hexo-renderer-markdown-it-plus</code>æ¸²æŸ“å™¨æ—¶ï¼Œå¦‚æœä¿®æ”¹äº†é¡µé¢çš„å†…å®¹ï¼Œæ­¤æ—¶åˆ·æ–°é¡µé¢ï¼Œä¼šå‘ç°é¡µé¢ä¸­çš„å…¬å¼ä¸èƒ½è¢«æ¸²æŸ“äº†ï¼Œåªèƒ½é‡æ–°å¯åŠ¨hexoæœåŠ¡ã€‚</p></li><li class="lvl-2"><p>ä½†æ˜¯ä½¿ç”¨<code>hexo-renderer-markdown-it</code>æ¸²æŸ“å™¨æ—¶ï¼Œåˆ·æ–°é¡µé¢åå…¬å¼å°±å¯ä»¥è¢«æ¸²æŸ“äº†ã€‚</p></li></ul></div><hr><h2 id="ä½¿ç”¨">ä½¿ç”¨</h2><ul class="lvl-0"><li class="lvl-2"><p>æ¯ä¸ªé¡µé¢çš„<code>front-matter</code>ä¸­è¦æ·»åŠ <code>mathjax: true</code>ï¼Œè¿™æ ·åœ¨é¡µé¢ä¸­å°±å¯ä»¥ä½¿ç”¨å…¬å¼äº†ã€‚</p></li><li class="lvl-2"><p><code>Katex</code>å…¬å¼çš„æ¸²æŸ“æ–¹å¼æ”¯æŒ<code>$...$</code>å’Œ<code>$$...$$</code>ä¸¤ç§æ–¹å¼</p><ul class="lvl-2"><li class="lvl-5"><code>$...$</code>ä¸ºè¡Œçº§å…¬å¼</li></ul> <figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span>sin(<span class="keyword">\omega</span> t)=<span class="keyword">\frac</span>&#123;1&#125;&#123;2j&#125;(e<span class="built_in">^</span>&#123;j<span class="keyword">\omega</span> t&#125;-e<span class="built_in">^</span>&#123;-j<span class="keyword">\omega</span> t&#125;)<span class="built_in">$</span></span><br></pre></td></tr></table></figure><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>Ï‰</mi><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>j</mi></mrow></mfrac><mo stretchy="false">(</mo><msup><mi>e</mi><mrow><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo>âˆ’</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">sin(\omega t)=\frac{1}{2j}(e^{j\omega t}-e^{-j\omega t})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ï‰</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.326216em;vertical-align:-0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Ï‰</span><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0746639999999998em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Ï‰</span><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><ul class="lvl-2"><li class="lvl-5"><code>$$...$$</code>ä¸ºå—çº§å…¬å¼ï¼Œç‹¬å ä¸€è¡Œä¸”å±…ä¸­å±•ç¤º</li></ul> <figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line">sin(<span class="keyword">\omega</span> t)=<span class="keyword">\frac</span>&#123;1&#125;&#123;2j&#125;(e<span class="built_in">^</span>&#123;j<span class="keyword">\omega</span> t&#125;-e<span class="built_in">^</span>&#123;-j<span class="keyword">\omega</span> t&#125;)</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>Ï‰</mi><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>j</mi></mrow></mfrac><mo stretchy="false">(</mo><msup><mi>e</mi><mrow><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo>âˆ’</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>j</mi><mi>Ï‰</mi><mi>t</mi></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">sin(\omega t)=\frac{1}{2j}(e^{j\omega t}-e^{-j\omega t})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ï‰</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.20188em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.874664em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Ï‰</span><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.124664em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.874664em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Ï‰</span><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p></li><li class="lvl-2"><p><code>$$...$$</code>å’Œ<code>$...$</code>ä¸­ä¸èƒ½å‡ºç°Unicodeå­—ç¬¦ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå³ä¸æ”¯æŒä¸­æ–‡ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºä¸­æ–‡ï¼Œåˆ™éœ€è¦ä½¿ç”¨<code>\text&#123;ä¸­æ–‡&#125;</code></p></li><li class="lvl-2"><p>å—çº§å…¬å¼ï¼Œåœ¨å¼€å¤´çš„<code>$$</code>ä¹‹å‰å’Œç»“å°¾çš„<code>$$</code>ä¹‹åï¼Œä¸å¾—æœ‰ä»»ä½•å­—ç¬¦ï¼ˆç©ºæ ¼é™¤å¤–ï¼‰</p></li><li class="lvl-2"><p>è¡Œçº§å…¬å¼ï¼Œåœ¨å¼€å¤´çš„<code>$</code>ä¹‹åå’Œç»“å°¾çš„<code>$</code>ä¹‹å‰ï¼Œä¸å¾—æœ‰ç©ºæ ¼</p></li></ul><h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒ <a href="https://katex.org/docs/supported">KaTeXå…¬å¼ç¬¦å·</a> ä»¥åŠ <a href="https://zh.wikipedia.org/wiki/Help:%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F">ç»´åŸºç™¾ç§‘ï¼šLaTeXå…¬å¼æ‰‹å†Œ</a></p></li><li class="lvl-2"><p>ä¸è¿‡è®°ä½è¿™äº›å…¬å¼ç¬¦å·è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œè¿™é‡Œæ¨èä¸¤ä¸ªå·¥å…·</p><ul class="lvl-2"><li class="lvl-5"><a href="https://webdemo.myscript.com/views/math/index.html">MyScript</a>: æ‰‹å†™è½¬LaTeXå…¬å¼ï¼Œç›´æ¥å°†ä½ éœ€è¦çš„æ•°å­¦å…¬å¼ç”»å‡ºæ¥ï¼Œå®ƒä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸ºLaTeXå…¬å¼ï¼Œç„¶åå¤åˆ¶å³å¯</li><li class="lvl-5"><a href="https://www.latexlive.com/home">LaTeXå…¬å¼ç¼–è¾‘å™¨</a>: æä¾›å…¬å¼æ¨¡æ¿ã€å›¾ç‰‡è¯†åˆ«(æœ‰æ¬¡æ•°é™åˆ¶)ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”æ”¯æŒè¾“å‡ºå„ç§æ ¼å¼ã€‚</li><li class="lvl-5"><a href="https://simpletex.cn/ai/latex_ocr">Simpletex</a>: æ”¯æŒLaTexå…¬å¼å›¾ç‰‡è¯†åˆ«å’Œæ‰‹å†™è½¬å…¬å¼ï¼Œä¸”æ— æ¬¡æ•°é™åˆ¶ï¼Œä½†æ˜¯éœ€è¦æ³¨å†Œè´¦å·ã€‚åŒæ—¶ä¹Ÿæä¾›äº†å®¢æˆ·ç«¯ç‰ˆæœ¬ã€‚</li></ul></li></ul><hr><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œéšä¾¿ç»™å‡ ä¸ªç¤ºä¾‹ï¼Œä»¥ä¸‹æ˜¯<code>LaTeX</code>çš„æ ‡å‡†è¯­æ³•</p></li></ul><hr><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\left</span>(<span class="keyword">\beta</span> m c<span class="built_in">^</span>2 + c <span class="keyword">\left</span>(<span class="keyword">\sum</span><span class="built_in">_</span>&#123;n=1&#125;<span class="built_in">^</span>3<span class="keyword">\alpha</span><span class="built_in">_</span>n p<span class="built_in">_</span>n<span class="keyword">\right</span>)<span class="keyword">\right</span>) <span class="keyword">\psi</span>(x,t)</span><br><span class="line">= i<span class="keyword">\hbar</span> <span class="keyword">\frac</span>&#123;<span class="keyword">\partial</span> <span class="keyword">\psi</span>(x,t)&#125;&#123;<span class="keyword">\partial</span> t&#125;</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">(</mo><mi>Î²</mi><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup><mo>+</mo><mi>c</mi><mrow><mo fence="true">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><mn>3</mn></munderover><msub><mi>Î±</mi><mi>n</mi></msub><msub><mi>p</mi><mi>n</mi></msub><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow><mi>Ïˆ</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mi>i</mi><mi mathvariant="normal">â„</mi><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>Ïˆ</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\left(\beta m c^2 + c \left(\sum_{n=1}^3\alpha_n p_n\right)\right) \psi(x,t)= i\hbar \frac{\partial \psi(x,t)}{\partial t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.068226em;vertical-align:-1.267113em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span><span class="mord mathnormal">m</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïˆ</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord mathnormal">i</span><span class="mord">â„</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïˆ</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><hr><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Aha! <span class="built_in">$</span>E = mc<span class="built_in">^</span>&#123;2&#125;<span class="built_in">$</span>.</span><br></pre></td></tr></table></figure><p>Aha! <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">E = mc^{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord mathnormal">m</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>.</p><hr><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\left</span>(<span class="keyword">\LARGE</span>&#123;AB&#125;<span class="keyword">\right</span>)</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">(</mo><mstyle mathsize="1.728em"><mrow><mi>A</mi><mi>B</mi></mrow></mstyle><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\left(\LARGE{AB}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.83081424em;vertical-align:-0.65002em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord sizing reset-size6 size9"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span></p><hr><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;matrix&#125;</span><br><span class="line">   a <span class="built_in">&amp;</span> b <span class="keyword">\\</span></span><br><span class="line">   c <span class="built_in">&amp;</span> d</span><br><span class="line"><span class="keyword">\end</span>&#123;matrix&#125;</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>c</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>d</mi></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{matrix}   a &amp; b \\   c &amp; d\end{matrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4000000000000004em;vertical-align:-0.9500000000000004em;"></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><hr><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\def</span><span class="keyword">\arraystretch</span>&#123;1.5&#125;</span><br><span class="line">   <span class="keyword">\begin</span>&#123;array&#125;&#123;c:c:c&#125;</span><br><span class="line">   a <span class="built_in">&amp;</span> b <span class="built_in">&amp;</span> c <span class="keyword">\\</span> <span class="keyword">\hline</span></span><br><span class="line">   d <span class="built_in">&amp;</span> e <span class="built_in">&amp;</span> f <span class="keyword">\\</span></span><br><span class="line">   <span class="keyword">\hdashline</span></span><br><span class="line">   g <span class="built_in">&amp;</span> h <span class="built_in">&amp;</span> i</span><br><span class="line"><span class="keyword">\end</span>&#123;array&#125;</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.6599999999999999em" columnalign="center center center" columnlines="dashed dashed" columnspacing="1em" rowlines="solid dashed"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>c</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>d</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>e</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>f</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>g</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>h</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>i</mi></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\def\arraystretch{1.5}   \begin{array}{c:c:c}   a &amp; b &amp; c \\ \hline   d &amp; e &amp; f \\   \hdashline   g &amp; h &amp; i\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.4em;vertical-align:-2.45em;"></span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-4.95em;"><span class="pstrut" style="height:4.95em;"></span><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-4.95em;"><span class="pstrut" style="height:3.26em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.26em;"></span><span class="mord"><span class="mord mathnormal">d</span></span></span><span style="top:-1.3499999999999996em;"><span class="pstrut" style="height:3.26em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="vertical-separator" style="height:5.4em;border-right-width:0.04em;border-right-style:dashed;margin:0 -0.02em;vertical-align:-2.45em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-4.95em;"><span class="pstrut" style="height:3.26em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.26em;"></span><span class="mord"><span class="mord mathnormal">e</span></span></span><span style="top:-1.3499999999999996em;"><span class="pstrut" style="height:3.26em;"></span><span class="mord"><span class="mord mathnormal">h</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="vertical-separator" style="height:5.4em;border-right-width:0.04em;border-right-style:dashed;margin:0 -0.02em;vertical-align:-2.45em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-4.95em;"><span class="pstrut" style="height:3.26em;"></span><span class="mord"><span class="mord mathnormal">c</span></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.26em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span><span style="top:-1.3499999999999996em;"><span class="pstrut" style="height:3.26em;"></span><span class="mord"><span class="mord mathnormal">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span style="top:-4.300000000000001em;"><span class="pstrut" style="height:4.95em;"></span><span class="hdashline" style="border-bottom-width:0.04em;"></span></span><span style="top:-6.1000000000000005em;"><span class="pstrut" style="height:4.95em;"></span><span class="hline" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span></span></span></span></span></span></span></span></span></span></p><hr><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\tilde</span>&#123;a&#125;<span class="built_in">$</span>  <span class="built_in">&amp;</span>nbsp;<span class="built_in">&amp;</span>nbsp; <span class="built_in">&amp;</span>nbsp; <span class="built_in">&amp;</span>nbsp; <span class="built_in">&amp;</span>nbsp; <span class="built_in">$</span><span class="keyword">\underrightarrow</span>&#123;AB&#125;<span class="built_in">$</span></span><br></pre></td></tr></table></figure><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>~</mo></mover></mrow><annotation encoding="application/x-tex">\tilde{a}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6678599999999999em;vertical-align:0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span></span></span></span></span></span></span>  Â Â  Â  Â  Â  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder accentunder="true"><mrow><mi>A</mi><mi>B</mi></mrow><mo stretchy="true">â†’</mo></munder></mrow><annotation encoding="application/x-tex">\underrightarrow{AB}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.20533em;vertical-align:-0.522em;"></span><span class="mord accentunder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span class="svg-align" style="top:-2.4779999999999998em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.522em;"><span></span></span></span></span></span></span></span></span></p><hr><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\tilde</span>&#123;a&#125; <span class="keyword">\underrightarrow</span>&#123;AB&#125;<span class="keyword">\begin</span>&#123;array&#125;&#123;l&#125;</span><br><span class="line">  a<span class="keyword">\mathop</span>&#123;x&#125;<span class="keyword">\nolimits</span><span class="built_in">^</span>&#123;2&#125;+bx+c=0 <span class="keyword">\\</span></span><br><span class="line">  <span class="keyword">\Delta</span> =<span class="keyword">\mathop</span>&#123;b&#125;<span class="keyword">\nolimits</span><span class="built_in">^</span>&#123;2&#125;-4ac <span class="keyword">\\</span></span><br><span class="line">  <span class="keyword">\left</span><span class="keyword">\&#123;</span><span class="keyword">\begin</span>&#123;matrix&#125;</span><br><span class="line">  <span class="keyword">\Delta</span> <span class="keyword">\gt</span> 0<span class="keyword">\text</span>&#123;æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹&#125; <span class="keyword">\\</span></span><br><span class="line">  <span class="keyword">\Delta</span> = 0<span class="keyword">\text</span>&#123;æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹&#125; <span class="keyword">\\</span></span><br><span class="line">  <span class="keyword">\Delta</span> <span class="keyword">\lt</span> 0<span class="keyword">\text</span>&#123;æ–¹ç¨‹æ— å®æ ¹&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;matrix&#125;<span class="keyword">\right</span>.</span><br><span class="line"><span class="keyword">\end</span>&#123;array&#125;</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>a</mi><mo>~</mo></mover><munder accentunder="true"><mrow><mi>A</mi><mi>B</mi></mrow><mo stretchy="true">â†’</mo></munder><mtable rowspacing="0.15999999999999992em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><msup><mo><mi>x</mi></mo><mn>2</mn></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">Î”</mi><mo>=</mo><msup><mo><mi>b</mi></mo><mn>2</mn></msup><mo>âˆ’</mo><mn>4</mn><mi>a</mi><mi>c</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo fence="true">{</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">Î”</mi><mo>&gt;</mo><mn>0</mn><mtext>Â æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">Î”</mi><mo>=</mo><mn>0</mn><mtext>Â æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">Î”</mi><mo>&lt;</mo><mn>0</mn><mtext>Â æ–¹ç¨‹æ— å®æ ¹</mtext></mrow></mstyle></mtd></mtr></mtable></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\tilde{a} \underrightarrow{AB}\begin{array}{l}  a\mathop{x}\nolimits^{2}+bx+c=0 \\  \Delta =\mathop{b}\nolimits^{2}-4ac \\  \left\{\begin{matrix}  \Delta \gt 0\text{ æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹} \\  \Delta = 0\text{ æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹} \\  \Delta \lt 0\text{ æ–¹ç¨‹æ— å®æ ¹}\end{matrix}\right.\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6.0584880000000005em;vertical-align:-2.7792439999999994em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mord accentunder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.68333em;"><span class="svg-align" style="top:-2.4779999999999998em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="height:0.522em;min-width:0.888em;"><svg width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.522em;"><span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.2792440000000007em;"><span style="top:-6.489264000000001em;"><span class="pstrut" style="height:4.05002em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop mathnormal" style="position:relative;top:-0.03472em;">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">+</span><span class="mord mathnormal">b</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-5.230816em;"><span class="pstrut" style="height:4.05002em;"></span><span class="mord"><span class="mord">Î”</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop"><span class="mop mathnormal" style="position:relative;top:0.09721999999999997em;">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">âˆ’</span><span class="mord">4</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span></span></span><span style="top:-2.8207960000000005em;"><span class="pstrut" style="height:4.05002em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05002em;"><span style="top:-2.49999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â©</span></span></span><span style="top:-2.20499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â¨</span></span></span><span style="top:-4.00501em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.30002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â§</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Î”</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mord text"><span class="mord">Â </span><span class="mord cjk_fallback">æ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ ¹</span></span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Î”</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mord text"><span class="mord">Â </span><span class="mord cjk_fallback">æ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ ¹</span></span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Î”</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mord text"><span class="mord">Â </span><span class="mord cjk_fallback">æ–¹ç¨‹æ— å®æ ¹</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.7792439999999994em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><hr><ul class="lvl-0"><li class="lvl-2"><p>ä»¥ä¸‹ä¸ºå¼€å¯<code>Auto-render Extension</code>åæ”¯æŒçš„å…¬å¼è¯­æ³•ï¼Œå¹¶ä¸æ˜¯<code>LaTex</code>çš„æ ‡å‡†è¯­æ³•</p></li></ul><hr><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;equation&#125;</span><br><span class="line"><span class="keyword">\begin</span>&#123;split&#125;   a <span class="built_in">&amp;</span>=b+c<span class="keyword">\\</span></span><br><span class="line">      <span class="built_in">&amp;</span>=e+f</span><br><span class="line"><span class="keyword">\end</span>&#123;split&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;equation&#125;</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: equation at position 7: \begin{Ì²eÌ²qÌ²uÌ²aÌ²tÌ²iÌ²oÌ²nÌ²}Ì²\begin{split} â€¦'>\begin{equation}\begin{split}   a &amp;=b+c\\      &amp;=e+f\end{split}\end{equation}</p><hr><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;align&#125;</span><br><span class="line">   a<span class="built_in">&amp;</span>=b+c <span class="keyword">\\</span></span><br><span class="line">   d+e<span class="built_in">&amp;</span>=f</span><br><span class="line"><span class="keyword">\end</span>&#123;align&#125;</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: align at position 7: \begin{Ì²aÌ²lÌ²iÌ²gÌ²nÌ²}Ì²   a&amp;=b+c \\ â€¦'>\begin{align}   a&amp;=b+c \\   d+e&amp;=f\end{align}</p><hr><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;CD&#125;</span><br><span class="line">   A @&gt;a&gt;&gt; B <span class="keyword">\\</span></span><br><span class="line">@VbVV @AAcA <span class="keyword">\\</span></span><br><span class="line">   C @= D</span><br><span class="line"><span class="keyword">\end</span>&#123;CD&#125;</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p class='katex-block katex-error' title='ParseError: KaTeX parse error: No such environment: CD at position 7: \begin{Ì²CÌ²DÌ²}Ì²   A @&gt;a&gt;&gt; B \â€¦'>\begin{CD}   A @&gt;a&gt;&gt; B \\@VbVV @AAcA \\   C @= D\end{CD}</p>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

--&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;Hexoæ˜¯åŸºäºmarkdownçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨LaTexè¯­æ³•æ¥ç¼–å†™æ•°å­¦å…¬å¼ï¼Œåªä¸è¿‡éœ€è¦å®‰è£…ç›¸åº”çš„å…¬å¼æ¸²æŸ“æ’ä»¶æ¥å®ç°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;Nextä¸»é¢˜ æ”¯æŒçš„å…¬å¼æ’ä»¶ä¸º&lt;code&gt;MathJax&lt;/code&gt;å’Œ&lt;code&gt;KaTeX&lt;/code&gt;ï¼Œå®ƒä»¬éƒ½æ”¯æŒLaTexè¯­æ³•ï¼Œå‚è€ƒ: &lt;a href=&quot;https://theme-next.js.org/docs/third-party-services/math-equations&quot;&gt;https://theme-next.js.org/docs/third-party-services/math-equations&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„æ˜¯&lt;a href=&quot;https://katex.org/docs/supported&quot;&gt;Katex&lt;/a&gt;ï¼ŒåŸå› æ˜¯æˆ‘å·²ç»ä½¿ç”¨äº†&lt;a href=&quot;https://github.com/hexojs/hexo-renderer-markdown-it&quot;&gt;hexo-renderer-markdown-it&lt;/a&gt;æ¸²æŸ“å™¨ï¼Œå…¶ä¸ mathjax çš„ &lt;a href=&quot;https://github.com/hexojs/hexo-renderer-pandoc&quot;&gt;hexo-renderer-pandoc&lt;/a&gt;æ¸²æŸ“å™¨ä¸èƒ½å¹¶å­˜ï¼Œæ‰€ä»¥åªèƒ½é€‰&lt;code&gt;Katex&lt;/code&gt;äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="Hexo" scheme="https://blog.hanqunfeng.com/categories/Hexo/"/>
    
    
    <category term="Hexo" scheme="https://blog.hanqunfeng.com/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>zabbixç›‘æ§å‘Šè­¦--vfs.fs.inodeä¸è¶³5%çš„è§£å†³è¿‡ç¨‹</title>
    <link href="https://blog.hanqunfeng.com/2024/09/05/linux-zabbix_vfs_fs_inode/"/>
    <id>https://blog.hanqunfeng.com/2024/09/05/linux-zabbix_vfs_fs_inode/</id>
    <published>2024-09-05T14:30:05.000Z</published>
    <updated>2024-11-25T06:56:28.738Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote % --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>è§£å†³Linuxç´¢å¼•èŠ‚ç‚¹(inode)ç”¨æ»¡å¯¼è‡´æ•…éšœçš„æ–¹æ³•</p></li></ul><span id="more"></span><h2 id="zabbixå‘Šè­¦">zabbixå‘Šè­¦</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vfs.fs.inode[/,pfree]):5 %</span><br></pre></td></tr></table></figure><h2 id="è§£å†³è¿‡ç¨‹">è§£å†³è¿‡ç¨‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ç™»å½•linuxç³»ç»ŸåæŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µå’Œç£ç›˜ä½¿ç”¨æƒ…å†µ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inode ä¸è¶³äº†</span></span><br><span class="line"><span class="built_in">df</span> -hi</span><br><span class="line">æ–‡ä»¶ç³»ç»Ÿ      Inode  å·²ç”¨(I)  å¯ç”¨(I) å·²ç”¨(I)%% æŒ‚è½½ç‚¹</span><br><span class="line">/dev/xvda1              1.9M    1.8M     96K   96% /</span><br><span class="line">tmpfs                   251K       1    251K    1% /dev/shm</span><br><span class="line"></span><br><span class="line"><span class="comment"># disk å……è¶³</span></span><br><span class="line"><span class="built_in">df</span> -hT</span><br><span class="line">æ–‡ä»¶ç³»ç»Ÿ    ç±»å‹      å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨%% æŒ‚è½½ç‚¹</span><br><span class="line">/dev/xvda1    ext4     30G   18G   12G  61% /</span><br><span class="line">tmpfs        tmpfs   1003M     0 1003M   0% /dev/shm</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ ¹æ®ä¸Šé¢çš„æŸ¥è¯¢ç»“æœåˆæ­¥åˆ¤æ–­æ˜¯ç³»ç»Ÿäº§ç”Ÿäº†å¤§é‡çš„ä¸´æ—¶æ–‡ä»¶å¯¼è‡´inodeç”¨å°½äº†</p></li><li class="lvl-2"><p>æ’æŸ¥åˆ°åº•å“ªä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æ•°è¿‡å¤š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ç»Ÿè®¡æ–‡ä»¶æ•°é‡å‰ååï¼Œè¿™é‡Œå‘ç°æ˜¯/varç›®å½•ä¸­æ–‡ä»¶å¼‚å¸¸çš„å¤š</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /*; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(find $i |wc -l)</span>:<span class="variable">$i</span>&quot;</span>; <span class="keyword">done</span> | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -n 10</span><br><span class="line">1815728:/var</span><br><span class="line">52498:/usr</span><br><span class="line">18804:/proc</span><br><span class="line">7333:/sys</span><br><span class="line">1834:/lib</span><br><span class="line">1447:/opt</span><br><span class="line">1047:/etc</span><br><span class="line">457:/dev</span><br><span class="line">411:/lib64</span><br><span class="line">245:/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ç€æŸ¥çœ‹/varä¸­çš„æ–‡ä»¶æ•°é‡</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /var/*; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(find $i |wc -l)</span>:<span class="variable">$i</span>&quot;</span>; <span class="keyword">done</span> | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -n 10</span><br><span class="line">1813442:/var/spool</span><br><span class="line">2033:/var/lib</span><br><span class="line">85:/var/cache</span><br><span class="line">82:/var/log</span><br><span class="line">39:/var/run</span><br><span class="line">24:/var/lock</span><br><span class="line">7:/var/db</span><br><span class="line">3:/var/yp</span><br><span class="line">2:/var/empty</span><br><span class="line">2:/var/account</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ç€æŸ¥çœ‹/var/spoolä¸­çš„æ–‡ä»¶æ•°é‡ï¼Œè¿™é‡ŒåŸºæœ¬å®šä½åˆ°æ˜¯/var/spool/clientmqueueç›®å½•</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /var/spool/*; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(find $i |wc -l)</span>:<span class="variable">$i</span>&quot;</span>; <span class="keyword">done</span> | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -n 10</span><br><span class="line">1812413:/var/spool/clientmqueue</span><br><span class="line">7:/var/spool/mail</span><br><span class="line">4:/var/spool/anacron</span><br><span class="line">3:/var/spool/at</span><br><span class="line">2:/var/spool/cron</span><br><span class="line">1:/var/spool/mqueue</span><br><span class="line">1:/var/spool/lpd</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç™¾åº¦ä¸€ä¸‹<code>/var/spool/clientmqueue</code>ç›®å½•çš„ä½œç”¨</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â€ŒLinuxæ–‡ä»¶ç›®å½• /var/spool/clientmqueue/ ä¸‹çš„æ–‡ä»¶ä¸»è¦æ˜¯ç”±cronä»»åŠ¡äº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶ã€‚â€Œ å½“cronä»»åŠ¡ä¸­æœ‰è¾“å‡ºå†…å®¹æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰é…ç½®sendmailæœåŠ¡ï¼Œè¿™äº›è¾“å‡ºå†…å®¹å°±ä¼šè¢«ä¿å­˜åˆ° /var/spool/clientmqueue/ ç›®å½•å†…ã€‚è¿™æ˜¯å› ä¸ºcronä»»åŠ¡ä¸­çš„å‘½ä»¤å¦‚æœæœ‰è¾“å‡ºï¼ˆæ¯”å¦‚é”™è¯¯ä¿¡æ¯æˆ–è€…æ­£å¸¸çš„è¾“å‡ºä¿¡æ¯ï¼‰ï¼Œé»˜è®¤ä¼šé€šè¿‡sendmailå‘é€ï¼Œä½†å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰é…ç½®sendmailæœåŠ¡ï¼Œè¿™äº›è¾“å‡ºå†…å®¹å°±ä¼šè¢«ä¿å­˜åˆ° /var/spool/clientmqueue/ ç›®å½•ä¸­ã€‚å› æ­¤ï¼Œè¿™ä¸ªç›®å½•ä¸‹ä¸»è¦åŒ…å«çš„æ˜¯ç”±cronä»»åŠ¡äº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è®°å½•äº†cronä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¾“å‡ºä¿¡æ¯ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœéœ€è¦å¤„ç†è¿™äº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹crontabé…ç½®æ¥å®ç°ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥åœ¨æ¯ä¸ªcronä»»åŠ¡å‘½ä»¤çš„æœ«å°¾æ·»åŠ é‡å®šå‘æ“ä½œï¼Œå°†è¾“å‡ºå†…å®¹æŠ›å¼ƒï¼Œä¾‹å¦‚ä½¿ç”¨å‘½ä»¤ &gt;/dev/null 2&gt;&amp;1ã€‚è¿™æ ·ï¼Œæ— è®ºæ ‡å‡†è¾“å‡ºè¿˜æ˜¯é”™è¯¯è¾“å‡ºéƒ½ä¼šè¢«é‡å®šå‘åˆ° /dev/nullï¼Œå³è¢«æŠ›å¼ƒï¼Œä»è€Œé¿å…åœ¨ /var/spool/clientmqueue/ ç›®å½•ä¸‹äº§ç”Ÿä¸å¿…è¦çš„æ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢çš„è§£é‡Šè¯´æ˜<code>/var/spool/clientmqueue</code>ç›®å½•ä¸‹çš„æ–‡ä»¶å¯ä»¥è¢«åˆ é™¤ï¼Œæ‰€ä»¥ç›´æ¥åˆ äº†å°±å¯ä»¥è§£å†³è¯¥é—®é¢˜äº†</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–‡ä»¶æ•°é‡è¿‡å¤šï¼Œä¸èƒ½è¿™ä¹ˆåˆ é™¤</span></span><br><span class="line"><span class="comment"># rm -rf /var/spool/clientmqueue/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®æ–¹æ³•</span></span><br><span class="line">find /var/spool/clientmqueue -name <span class="string">&quot;*&quot;</span> -<span class="built_in">type</span> f | xargs <span class="built_in">rm</span> -rf</span><br></pre></td></tr></table></figure><h2 id="è¯¦è§£inode">è¯¦è§£inode</h2><ul class="lvl-0"><li class="lvl-2"><p>inodeæ˜¯æ–‡ä»¶ç³»ç»Ÿå†…ä¸€ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼Œå®ƒç”¨æ¥æè¿°ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€æ–‡ä»¶ç±»å‹ã€æƒé™ã€æ‰€æœ‰è€…ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ç­‰ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„inodeå·ï¼Œè¿™ä¸ªinodeå·æ˜¯åˆ†é…ç»™è¯¥æ–‡ä»¶çš„ï¼Œå¹¶ä¸”ä¸èƒ½è¢«æ”¹å˜ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç›®å½•çš„inodeå·</span></span><br><span class="line"><span class="built_in">ls</span> -li</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ“ä½œç³»ç»Ÿæ‰“å¼€æ–‡ä»¶æ—¶ä¼šæŒ‰å¦‚ä¸‹æ­¥éª¤æ‰§è¡Œï¼š</p><ul class="lvl-2"><li class="lvl-6">æŸ¥æ‰¾æ–‡ä»¶åç§°å¯¹åº”çš„inodeå·</li><li class="lvl-6">æ ¹æ®inodeå·è·å–inodeä¿¡æ¯</li><li class="lvl-6">æ ¹æ®inodeä¿¡æ¯æ‰¾åˆ°æ–‡ä»¶å¯¹åº”çš„æ•°æ®å—ï¼Œè¯»å‡ºæ•°æ®</li></ul></li><li class="lvl-2"><p>inodeçš„å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼Œé€šå¸¸å–å†³äºæ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿã€‚åœ¨å¤§å¤šæ•°Linuxæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œinodeå¤§å°é€šå¸¸æ˜¯128å­—èŠ‚æˆ–256å­—èŠ‚ã€‚è¿™æ˜¯ç”±æ–‡ä»¶ç³»ç»Ÿåœ¨æ ¼å¼åŒ–æ—¶å†³å®šçš„ï¼Œå¹¶ä¸”æ ¼å¼åŒ–åä¸èƒ½æ›´æ”¹ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹inodeå¤§å°</span></span><br><span class="line">dumpe2fs /dev/xvda1 | grep <span class="string">&quot;Inode size&quot;</span></span><br><span class="line">dumpe2fs 1.43.5 (04-Aug-2017)</span><br><span class="line">Inode size:          256</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„inodeæ€»æ•°</p></li></ul><blockquote><p>ä¸€ä¸ªinodeåªå¯¹åº”ä¸€ä¸ªå®é™…æ–‡ä»¶ï¼Œæ‰€ä»¥inodesæœ€å¤§æ•°é‡å°±æ˜¯æ–‡ä»¶çš„æœ€å¤§æ•°é‡ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰æŒ‚è½½ç£ç›˜</span></span><br><span class="line"><span class="built_in">df</span> -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šç£ç›˜</span></span><br><span class="line"><span class="built_in">df</span> -i /dev/xvda1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿé»˜è®¤çš„inodeæ•°é‡ä¸åŒï¼Œä»¥<code>1G</code>ç£ç›˜ç©ºé—´ä¸ºä¾‹ï¼Œ<code>ext4</code>æ–‡ä»¶ç³»ç»Ÿé»˜è®¤ä¸º<code>65536</code>ï¼Œ<code>xfs</code>æ–‡ä»¶ç³»ç»Ÿé»˜è®¤ä¸º<code>52ä¸‡</code>(æ¯2kè®¾ç½®ä¸€ä¸ªinode)ï¼Œå¹¶ä¸”<code>xfs</code>ä¼šåŠ¨æ€æ‰©å®¹inodeæ•°é‡ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;è§£å†³Linuxç´¢å¼•èŠ‚ç‚¹(inode)ç”¨æ»¡å¯¼è‡´æ•…éšœçš„æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="linux" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/linux/"/>
    
    <category term="zabbix" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/linux/zabbix/"/>
    
    
    <category term="linux" scheme="https://blog.hanqunfeng.com/tags/linux/"/>
    
    <category term="zabbix" scheme="https://blog.hanqunfeng.com/tags/zabbix/"/>
    
  </entry>
  
  <entry>
    <title>å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Gradleç‰ˆ(æœ€æ–°æ–¹å¼)</title>
    <link href="https://blog.hanqunfeng.com/2024/08/02/gradle-depoly-maven-center-repository-new/"/>
    <id>https://blog.hanqunfeng.com/2024/08/02/gradle-depoly-maven-center-repository-new/</id>
    <published>2024-08-02T13:30:05.000Z</published>
    <updated>2024-08-02T06:39:05.191Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><a href="https://oss.sonatype.org">https://oss.sonatype.org</a>å·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸º<a href="https://central.sonatype.com">https://central.sonatype.com</a></li><li class="lvl-2">é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Gradleæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“</li><li class="lvl-2">Mavenæ„å»ºæ–¹å¼è¯·çœ‹ <a href="/2024/08/01/mvn-depoly-maven-center-repository-new/" title="å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ã€‚</li><li class="lvl-2">å‰ä¸‰ä¸ªæ­¥éª¤ä¸ <a href="/2024/08/01/mvn-depoly-maven-center-repository-new/" title="å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚</li></ul><span id="more"></span><h2 id="ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚-Githubæˆ–è€…Gitee">ä¸€ã€å°†é¡¹ç›®æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚ <code>Github</code>æˆ–è€…<code>Gitee</code></h2><h2 id="äºŒã€æ³¨å†Œ-Sonatype-è´¦æˆ·">äºŒã€æ³¨å†Œ <code>Sonatype</code> è´¦æˆ·</h2><h2 id="ä¸‰ã€ç™»å½•-Sonatype-åˆ›å»ºNamespace">ä¸‰ã€ç™»å½• Sonatype åˆ›å»º<code>Namespace</code></h2><p>å‰ä¸‰ä¸ªæ­¥éª¤ä¸ <a href="/2024/08/01/mvn-depoly-maven-center-repository-new/" title="å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚</p><h2 id="å››ã€å‘å¸ƒ">å››ã€å‘å¸ƒ</h2><ul class="lvl-0"><li class="lvl-2"><p>ç­¾å<br>æˆ‘æ˜¯macç”µè„‘ï¼Œäºæ˜¯ç­¾åå·¥å…·ä½¿ç”¨çš„æ˜¯<a href="https://gpgtools.org">https://gpgtools.org</a>ï¼Œgradleç­¾åæ—¶éœ€è¦ä½¿ç”¨åˆ°<code>.gpg</code>è¯ä¹¦æ–‡ä»¶ï¼Œè¿™ä¸ªå·¥å…·ä¸æ”¯æŒç›´æ¥å¯¼å‡º<code>.gpg</code>ï¼Œå…¶å¯¼å‡ºçš„è¯ä¹¦æ–‡ä»¶æ˜¯<code>.asc</code>æ ¼å¼çš„ï¼Œ<code>asc</code>å…¶å®å°±æ˜¯<code>å­—ç¬¦ä¸²</code>ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€æŸ¥çœ‹ã€‚</p><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¼å‡º<code>.gpg</code>æ ¼å¼çš„è¯ä¹¦ï¼š</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºå½“å‰å…¨éƒ¨è¯ä¹¦</span></span><br><span class="line">gpg -k</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºç§é’¥ï¼Œqunfeng_han@126.comæ˜¯åˆ›å»ºè¯ä¹¦æ—¶ä½¿ç”¨çš„é‚®ç®±ï¼Œä¼šè¦æ±‚ä½ è¾“å…¥åˆ›å»ºè¯ä¹¦æ—¶çš„å¯†ç </span></span><br><span class="line">gpg --output private.pgp --armor --export-secret-key qunfeng_han@126.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºå…¬é’¥</span></span><br><span class="line">gpg --output public.pgp --armor --<span class="built_in">export</span> qunfeng_han@126.com</span><br></pre></td></tr></table></figure></li><li class="lvl-2"><p>build.gradle<br>å®˜æ–¹æ²¡æœ‰å‡ºgradleå‘å¸ƒæ’ä»¶ï¼Œä½†æ˜¯<a href="https://central.sonatype.org/publish/publish-portal-gradle/">å®˜ç½‘</a>æ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹çš„<a href="https://jreleaser.org/guide/latest/examples/maven/maven-central.html#_gradle">jreleaser</a>æ’ä»¶ã€‚</p></li></ul><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line"><span class="comment">//    id &#x27;io.spring.dependency-management&#x27; version &#x27;1.0.10.RELEASE&#x27;</span></span><br><span class="line">    id <span class="string">&#x27;io.spring.dependency-management&#x27;</span> version <span class="string">&#x27;1.1.6&#x27;</span></span><br><span class="line">    <span class="comment">//æ­¤å¤„å¿…é¡»æ˜¯java-libraryï¼Œå¦‚æœæ˜¯javaåˆ™apiæ–¹æ³•ä¸å¯ç”¨ï¼Œapiå¯ä»¥ç†è§£ä¸ºå°±æ˜¯compileï¼Œæ”¯æŒä¼ é€’ä¾èµ–</span></span><br><span class="line">    id <span class="string">&#x27;java-library&#x27;</span></span><br><span class="line">    <span class="comment">//å‘å¸ƒæ’ä»¶</span></span><br><span class="line">    id <span class="string">&#x27;maven-publish&#x27;</span></span><br><span class="line">    <span class="comment">//è‡ªåŠ¨å‘å¸ƒåˆ°mavenä¸­å¤®ä»“åº“æ’ä»¶</span></span><br><span class="line">    <span class="comment">//https://jreleaser.org/guide/latest/examples/maven/maven-central.html#_gradle</span></span><br><span class="line">    id <span class="string">&#x27;org.jreleaser&#x27;</span> version <span class="string">&#x27;1.13.1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">group</span> = <span class="string">&#x27;io.github.hanqunfeng&#x27;</span></span><br><span class="line"><span class="comment">//version = &#x27;1.0.0-SNAPSHOT&#x27;</span></span><br><span class="line">version = <span class="string">&#x27;1.0.1&#x27;</span></span><br><span class="line"><span class="keyword">sourceCompatibility</span> = <span class="string">&#x27;1.8&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">java &#123;</span><br><span class="line">    withJavadocJar()</span><br><span class="line">    withSourcesJar()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">repositories</span> &#123;</span><br><span class="line">    maven &#123; url <span class="string">&#x27;https://maven.aliyun.com/repository/public/&#x27;</span> &#125;</span><br><span class="line">    mavenLocal()</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencyManagement &#123;</span><br><span class="line">    imports &#123; mavenBom(<span class="string">&quot;software.amazon.awssdk:bom:2.23.10&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="comment">//lombok</span></span><br><span class="line">    compileOnly <span class="string">&#x27;org.projectlombok:lombok:1.18.32&#x27;</span></span><br><span class="line">    annotationProcessor <span class="string">&#x27;org.projectlombok:lombok:1.18.32&#x27;</span></span><br><span class="line">    api <span class="string">&#x27;software.amazon.awssdk:s3&#x27;</span></span><br><span class="line">    api <span class="string">&#x27;software.amazon.awssdk:apache-client&#x27;</span></span><br><span class="line">    api <span class="string">&#x27;software.amazon.awssdk:s3-transfer-manager&#x27;</span></span><br><span class="line">    api <span class="string">&#x27;software.amazon.awssdk:aws-crt-client&#x27;</span></span><br><span class="line">    api <span class="string">&#x27;org.springframework:spring-core:5.3.29&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// javaç¼–è¯‘çš„æ—¶å€™ç¼ºçœçŠ¶æ€ä¸‹ä¼šå› ä¸ºä¸­æ–‡å­—ç¬¦è€Œå¤±è´¥</span></span><br><span class="line">[compileJava, compileTestJava]*.<span class="keyword">options</span>*.encoding = <span class="string">&#x27;UTF-8&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘å¸ƒæ’ä»¶</span></span><br><span class="line"><span class="comment"> * å‚è€ƒï¼šhttps://docs.gradle.org/6.6.1/userguide/publishing_maven.html#publishing_maven:resolved_dependencies</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å‘å¸ƒä¸ºbomï¼Œå‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/195678201</span></span><br><span class="line"><span class="comment"> * æ³¨æ„ï¼šjava-platformä¸èƒ½ä¸javaå’Œjava-libraryåŒæ—¶å­˜åœ¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">publishing &#123;</span><br><span class="line">    publications &#123;</span><br><span class="line">        maven(MavenPublication) &#123;</span><br><span class="line">            groupId = <span class="keyword">project</span>.<span class="keyword">group</span></span><br><span class="line">            artifactId = <span class="keyword">project</span>.name</span><br><span class="line">            version = <span class="keyword">project</span>.version</span><br><span class="line">            <span class="comment">//å¦‚æœä¸å®šä¹‰ï¼Œåˆ™ä¼šæŒ‰ç…§ä»¥ä¸Šé»˜è®¤å€¼æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">from</span> components.java</span><br><span class="line"></span><br><span class="line">            pom &#123;</span><br><span class="line">                name = <span class="string">&#x27;aws-s3-v2-tools-gradle&#x27;</span></span><br><span class="line">                <span class="keyword">description</span> = <span class="string">&#x27;AWS S3 Tools.&#x27;</span></span><br><span class="line">                url = <span class="string">&#x27;https://blog.hanqunfeng.com&#x27;</span></span><br><span class="line">                licenses &#123;</span><br><span class="line">                    license &#123;</span><br><span class="line">                        name = <span class="string">&#x27;The Apache License, Version 2.0&#x27;</span></span><br><span class="line">                        url = <span class="string">&#x27;http://www.apache.org/licenses/LICENSE-2.0.txt&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                developers &#123;</span><br><span class="line">                    developer &#123;</span><br><span class="line">                        id = <span class="string">&#x27;hanqf&#x27;</span></span><br><span class="line">                        name = <span class="string">&#x27;han qunfeng&#x27;</span></span><br><span class="line">                        email = <span class="string">&#x27;qunfeng_han@126.com&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                scm &#123;</span><br><span class="line">                    connection = <span class="string">&#x27;scm:git:https://github.com/hanqunfeng/aws-s3-v2-tools-gradle.git&#x27;</span></span><br><span class="line">                    developerConnection = <span class="string">&#x27;scm:git:https://github.com:hanqunfeng/aws-s3-v2-tools-gradle.git&#x27;</span></span><br><span class="line">                    url = <span class="string">&#x27;https://github.com/hanqunfeng/aws-s3-v2-tools-gradle&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            versionMapping &#123;</span><br><span class="line">                usage(<span class="string">&#x27;java-api&#x27;</span>) &#123;</span><br><span class="line">                    fromResolutionOf(<span class="string">&#x27;runtimeClasspath&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                usage(<span class="string">&#x27;java-runtime&#x27;</span>) &#123;</span><br><span class="line">                    fromResolutionResult()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url = layout.buildDirectory.dir(<span class="string">&#x27;staging-deploy&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tasks.withType(JavaCompile) &#123;</span><br><span class="line">    <span class="keyword">options</span>.encoding = <span class="string">&#x27;UTF-8&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//javadocï¼Œå¦‚æœç”¨jdk11ï¼Œé»˜è®¤å°±æ”¯æŒä¸­æ–‡</span></span><br><span class="line"><span class="comment">//æŸ¥çœ‹å¯ä»¥é…ç½®çš„å±æ€§ï¼šhttps://docs.gradle.org/current/javadoc/org/gradle/external/javadoc/StandardJavadocDocletOptions.html</span></span><br><span class="line">tasks.withType(Javadoc) &#123;</span><br><span class="line">    <span class="keyword">options</span>.version = <span class="keyword">true</span></span><br><span class="line">    <span class="keyword">options</span>.author = <span class="keyword">true</span></span><br><span class="line">    <span class="keyword">options</span>.encoding = <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">    <span class="keyword">options</span>.charSet = <span class="string">&quot;UTF-8&quot;</span>  <span class="comment">//è§£å†³ä¸­æ–‡ä¹±ç </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">javadoc &#123;</span><br><span class="line">    <span class="keyword">if</span> (JavaVersion.current().isJava9Compatible()) &#123;</span><br><span class="line">        <span class="keyword">options</span>.addBooleanOption(<span class="string">&#x27;html5&#x27;</span>, <span class="keyword">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (JavaVersion.current().isJava8Compatible()) &#123;</span><br><span class="line">        tasks.withType(Javadoc) &#123;</span><br><span class="line">            <span class="comment">// disable the crazy super-strict doclint tool in Java 8</span></span><br><span class="line">            <span class="comment">// noinspection SpellCheckingInspection</span></span><br><span class="line">            <span class="keyword">options</span>.addStringOption(<span class="string">&#x27;Xdoclint:none&#x27;</span>, <span class="string">&#x27;-quiet&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jreleaseré…ç½®æ–‡ä»¶ï¼š~/.jreleaser/config.toml</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">JRELEASER_MAVENCENTRAL_USERNAME = &quot;&lt;your-publisher-portal-username&gt;&quot;</span></span><br><span class="line"><span class="comment">JRELEASER_MAVENCENTRAL_PASSWORD = &quot;&lt;your-publisher-portal-password&gt;&quot;</span></span><br><span class="line"><span class="comment">JRELEASER_NEXUS2_USERNAME = &quot;&lt;your-sonatype-account-username&gt;&quot;</span></span><br><span class="line"><span class="comment">JRELEASER_NEXUS2_PASSWORD = &quot;&lt;your-sonatype-account-password&gt;&quot;</span></span><br><span class="line"><span class="comment">JRELEASER_GPG_PASSPHRASE = &quot;&lt;your-pgp-passphrase&gt;&quot;</span></span><br><span class="line"><span class="comment">JRELEASER_GITHUB_TOKEN = &quot;&lt;your-github-token&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">jreleaser &#123;</span><br><span class="line">    signing &#123;</span><br><span class="line">        active = <span class="string">&#x27;ALWAYS&#x27;</span></span><br><span class="line">        armored = <span class="keyword">true</span></span><br><span class="line">        mode = <span class="string">&#x27;FILE&#x27;</span></span><br><span class="line">        publicKey = <span class="string">&#x27;/Users/hanqf/develop_soft/gpg_key/hanqf/public.pgp&#x27;</span></span><br><span class="line">        secretKey = <span class="string">&#x27;/Users/hanqf/develop_soft/gpg_key/hanqf/private.pgp&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    deploy &#123;</span><br><span class="line">        maven &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* Portal Publisher API */</span></span><br><span class="line">            mavenCentral &#123;</span><br><span class="line">                sonatype &#123;</span><br><span class="line">                    active = <span class="string">&#x27;ALWAYS&#x27;</span></span><br><span class="line">                    url = <span class="string">&#x27;https://central.sonatype.com/api/v1/publisher&#x27;</span></span><br><span class="line">                    stagingRepository(<span class="string">&#x27;build/staging-deploy&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>~/.jreleaser/config.toml ï¼šé…ç½®ç›¸å…³è®¤è¯ä¿¡æ¯</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://central.sonatype.com çš„è®¤è¯ä¿¡æ¯</span></span><br><span class="line"><span class="attr">JRELEASER_MAVENCENTRAL_USERNAME</span> = <span class="string">&quot;&lt;your-publisher-portal-username&gt;&quot;</span></span><br><span class="line"><span class="attr">JRELEASER_MAVENCENTRAL_PASSWORD</span> = <span class="string">&quot;&lt;your-publisher-portal-password&gt;&quot;</span></span><br><span class="line"><span class="comment"># https://oss.sonatype.org çš„è®¤è¯ä¿¡æ¯ï¼Œè¿™é‡Œæ²¡æœ‰ç”¨åˆ°ï¼Œå¯ä»¥ä¸è¿›è¡Œé…ç½®</span></span><br><span class="line"><span class="attr">JRELEASER_NEXUS2_USERNAME</span> = <span class="string">&quot;&lt;your-sonatype-account-username&gt;&quot;</span></span><br><span class="line"><span class="attr">JRELEASER_NEXUS2_PASSWORD</span> = <span class="string">&quot;&lt;your-sonatype-account-password&gt;&quot;</span></span><br><span class="line"><span class="comment"># åˆ›å»º pgp å¯†é’¥æ—¶çš„å¯†ç </span></span><br><span class="line"><span class="attr">JRELEASER_GPG_PASSPHRASE</span> = <span class="string">&quot;&lt;your-pgp-passphrase&gt;&quot;</span></span><br><span class="line"><span class="comment"># github token</span></span><br><span class="line"><span class="attr">JRELEASER_GITHUB_TOKEN</span> = <span class="string">&quot;&lt;your-github-token&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰§è¡Œå‘½ä»¤</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./gradlew jreleaserConfig <span class="comment"># éªŒè¯é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">./gradlew clean publish <span class="comment"># å‘å¸ƒåˆ°æœ¬åœ° build/staging-deploy</span></span><br><span class="line">./gradlew jreleaserFullRelease <span class="comment"># å‘å¸ƒåˆ°è¿œç¨‹Mavenä¸­å¤®ä»“åº“</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ›´æ–°éƒ¨ç½²<br>ä¸ <a href="/2024/08/01/mvn-depoly-maven-center-repository-new/" title="å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)">å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)</a> ä¸­çš„æè¿°ç±»ä¼¼ï¼Œåªéœ€è¦ä¿®æ”¹<code>build.gradle</code>ä¸­å¯¹åº”çš„ç‰ˆæœ¬å·åé‡æ–°æ‰§è¡Œä¸Šé¢çš„å‘å¸ƒå‘½ä»¤å³å¯ï¼Œå‘å¸ƒçš„jaråŒ…å¯ä»¥åœ¨<a href="https://central.sonatype.com">https://central.sonatype.com</a>ä¸­æ£€ç´¢ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;&lt;a href=&quot;https://oss.sonatype.org&quot;&gt;https://oss.sonatype.org&lt;/a&gt;å·²ç»ä¸å†æ”¯æŒæ–°ç”¨æˆ·æ³¨å†Œï¼Œæ–°çš„æ³¨å†Œåœ°å€ä¸º&lt;a href=&quot;https://central.sonatype.com&quot;&gt;https://central.sonatype.com&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;é€šè¿‡æœ¬æ–‡ï¼Œä½ å°†çŸ¥é“å¦‚ä½•å°†Gradleæ„å»ºçš„é¡¹ç›®å‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Mavenæ„å»ºæ–¹å¼è¯·çœ‹ &lt;a href=&quot;/2024/08/01/mvn-depoly-maven-center-repository-new/&quot; title=&quot;å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)&quot;&gt;å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)&lt;/a&gt; ã€‚&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;å‰ä¸‰ä¸ªæ­¥éª¤ä¸ &lt;a href=&quot;/2024/08/01/mvn-depoly-maven-center-repository-new/&quot; title=&quot;å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)&quot;&gt;å‘å¸ƒJaråˆ°Mavenä¸­å¤®ä»“åº“--Mavenç‰ˆ(æœ€æ–°æ–¹å¼)&lt;/a&gt; ç›¸åŒï¼Œä¸åœ¨èµ˜è¿°ã€‚&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="maven" scheme="https://blog.hanqunfeng.com/tags/maven/"/>
    
    <category term="gradle" scheme="https://blog.hanqunfeng.com/tags/gradle/"/>
    
  </entry>
  
</feed>
