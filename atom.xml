<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£˜é€¸å³°çš„åšå®¢</title>
  
  <subtitle>Spring--Javaç¨‹åºå‘˜çš„æ˜¥å¤©</subtitle>
  <link href="https://blog.hanqunfeng.com/atom.xml" rel="self"/>
  
  <link href="https://blog.hanqunfeng.com/"/>
  <updated>2025-12-10T09:16:12.420Z</updated>
  <id>https://blog.hanqunfeng.com/</id>
  
  <author>
    <name>é£˜é€¸å³°</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Redis SCAN å‘½ä»¤è¯¦è§£ï¼šä½œç”¨ã€ç”¨æ³•ä¸æœ€ä½³å®è·µ</title>
    <link href="https://blog.hanqunfeng.com/2025/12/10/redis7-scan/"/>
    <id>https://blog.hanqunfeng.com/2025/12/10/redis7-scan/</id>
    <published>2025-12-10T13:30:05.000Z</published>
    <updated>2025-12-10T09:16:12.420Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">åœ¨ä½¿ç”¨ Redis æ—¶ï¼Œç»å¸¸éœ€è¦éå†æ•°æ®åº“ä¸­çš„é”®ï¼Œä¾‹å¦‚æŸ¥æ‰¾ç‰¹å®šå‰ç¼€çš„ keyã€ç»Ÿè®¡ key æ•°é‡ã€æ‰¹é‡åˆ é™¤ key ç­‰ã€‚</li><li class="lvl-2">Redis æä¾›äº†ä¸¤ç§æ€è·¯ï¼šä½¿ç”¨ <code>KEYS pattern</code> æˆ–ä½¿ç”¨æ¸¸æ ‡å¼éå†å‘½ä»¤ <code>SCAN</code>ã€‚</li><li class="lvl-2"><code>KEYS pattern</code> æ˜¯ä¸€ç§éå¸¸ä¸å®‰å…¨çš„æ–¹å¼ï¼Œå› ä¸ºå®ƒä¼šè§¦å‘ Redis æœåŠ¡å™¨çš„é˜»å¡ï¼Œä»è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚è®¾ç½®ä¸€äº›æ³¨é‡å®‰å…¨çš„ç¯å¢ƒä¼šç¦ç”¨<code>KEYS pattern</code>ç­‰å±é™©å‘½ä»¤ã€‚</li><li class="lvl-2">æ‰€ä»¥Rediså®˜æ–¹å¼ºçƒˆæ¨è <code>SCAN</code> æ–¹å¼ï¼Œå…¶æ˜¯æœ€å®‰å…¨ã€æœ€å¯æ§çš„éå†æ–¹æ³•ã€‚</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li></ul><span id="more"></span><h2 id="SCAN-çš„æ ¸å¿ƒä½œç”¨">SCAN çš„æ ¸å¿ƒä½œç”¨</h2><ul class="lvl-0"><li class="lvl-2"><p>SCAN çš„ä¸»è¦åŠŸèƒ½æ˜¯<strong>åŸºäºæ¸¸æ ‡çš„ã€éé˜»å¡çš„ã€æ¸è¿›å¼éå† Redis æ•°æ®åº“ä¸­çš„ key</strong>ã€‚</p></li><li class="lvl-2"><p>å®ƒå…è®¸åº”ç”¨åœ¨ä¸é˜»å¡æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡æ‹‰å–å°‘é‡ keyï¼Œä»è€Œå®‰å…¨åœ°åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ key éå†æ“ä½œã€‚</p></li><li class="lvl-2"><p>SCAN çš„è®¾è®¡ç›®æ ‡åŒ…æ‹¬ï¼š</p><ul class="lvl-2"><li class="lvl-5">é¿å…é˜»å¡ Redis ä¸»çº¿ç¨‹</li><li class="lvl-5">åˆ†æ‰¹ã€æ¸è¿›æ‰«æå¤§è§„æ¨¡ key é›†åˆ</li><li class="lvl-5">çµæ´»é…åˆæ¨¡å¼åŒ¹é…ï¼ˆMATCHï¼‰</li><li class="lvl-5">æ§åˆ¶æ¯æ¬¡è¿”å› key çš„æ•°é‡ï¼ˆCOUNTï¼‰</li><li class="lvl-5">åœ¨ä¸å½±å“çº¿ä¸Šä¸šåŠ¡çš„æƒ…å†µä¸‹å¤„ç†æ•°ç™¾ä¸‡ç”šè‡³æ•°åƒä¸‡çº§åˆ«é”®å€¼æ‰«æ</li></ul></li><li class="lvl-2"><p>SCAN å‘½ä»¤æ˜¯å®Œæ•´æ¸¸æ ‡éå†æ—çš„ä¸€éƒ¨åˆ†ï¼Œè¿˜åŒ…æ‹¬ï¼š</p><ul class="lvl-2"><li class="lvl-5"><code>HSCAN</code>ï¼šéå†å“ˆå¸Œè¡¨ field/value</li><li class="lvl-5"><code>SSCAN</code>ï¼šéå† set å…ƒç´ </li><li class="lvl-5"><code>ZSCAN</code>ï¼šéå†æœ‰åºé›†åˆ</li></ul></li><li class="lvl-2"><p>ä¸ºäº†å®Œæˆåé¢çš„ç¤ºä¾‹æ¼”ç¤ºï¼Œè¿™é‡Œå‡†å¤‡ä¸€ä¸ªæµ‹è¯•æ•°æ®æ‰¹é‡ç”Ÿäº§è„šæœ¬</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è„šæœ¬åç§°ï¼šimport_unified_data.sh</span></span><br><span class="line"><span class="comment"># è¿è¡Œæ–¹æ³•ï¼šsh $0 &lt;type&gt; [count]</span></span><br><span class="line"><span class="comment"># &lt;type&gt;: string, hash, list, set, æˆ– zset</span></span><br><span class="line"><span class="comment"># [count]: å¯¼å…¥çš„æ•°æ®é‡ (å¯é€‰ï¼Œé»˜è®¤ä¸º 100)</span></span><br><span class="line"><span class="comment"># ----------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 1. å‚æ•°æ ¡éªŒä¸é…ç½® ---</span></span><br><span class="line"></span><br><span class="line">SUPPORTED_TYPES=<span class="string">&quot;string hash list set zset&quot;</span></span><br><span class="line"><span class="comment"># å®šä¹‰æ¯ä¸ªé›†åˆ/åˆ—è¡¨/æœ‰åºé›†åˆè¦æ·»åŠ çš„æˆå‘˜æ•°é‡</span></span><br><span class="line">MEMBERS_PER_KEY=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦æä¾›äº†ç±»å‹å‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 1 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âŒ é”™è¯¯ï¼šè¯·æŒ‡å®šå¯¼å…¥ç±»å‹ã€‚&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ”¯æŒçš„ç±»å‹: <span class="variable">$&#123;SUPPORTED_TYPES&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ç”¨æ³•: sh <span class="variable">$0</span> &lt;type&gt; [count]&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç±»å‹å‚æ•° (ç¬¬ä¸€ä¸ªå‚æ•°)</span></span><br><span class="line">DATA_TYPE=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> | <span class="built_in">tr</span> <span class="string">&#x27;[:upper:]&#x27;</span> <span class="string">&#x27;[:lower:]&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ•°æ®é‡å‚æ•° (ç¬¬äºŒä¸ªå‚æ•°)ï¼Œä¸å­˜åœ¨åˆ™é»˜è®¤ä¸º 1000</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ge 2 ]; <span class="keyword">then</span></span><br><span class="line">    DATA_COUNT=<span class="variable">$2</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    DATA_COUNT=100</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç±»å‹æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line"><span class="keyword">if</span> [[ ! <span class="string">&quot; <span class="variable">$&#123;SUPPORTED_TYPES&#125;</span> &quot;</span> =~ <span class="string">&quot; <span class="variable">$&#123;DATA_TYPE&#125;</span> &quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âŒ é”™è¯¯ï¼šä¸æ”¯æŒçš„ç±»å‹ &#x27;<span class="variable">$DATA_TYPE</span>&#x27;ã€‚&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ”¯æŒçš„ç±»å‹: <span class="variable">$&#123;SUPPORTED_TYPES&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Redis è¿æ¥é…ç½®</span></span><br><span class="line">REDIS_HOST=<span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">REDIS_PORT=<span class="string">&quot;6379&quot;</span></span><br><span class="line">REDIS_PASSWORD=<span class="string">&quot;password&quot;</span> <span class="comment"># æ›¿æ¢ä¸ºä½ çš„å®é™…å¯†ç æˆ–ç•™ç©º</span></span><br><span class="line">KEY_PREFIX=<span class="string">&quot;test_data&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------</span></span><br><span class="line"><span class="comment"># --- 2. å‘½ä»¤ç”Ÿæˆä¸»é€»è¾‘ ---</span></span><br><span class="line"><span class="comment"># ----------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;â³ æ­£åœ¨ç”Ÿæˆ <span class="variable">$&#123;DATA_COUNT&#125;</span> æ¡ Redis [<span class="variable">$&#123;DATA_TYPE&#125;</span>] å‘½ä»¤...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»º RESP å‘½ä»¤æµ</span></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le <span class="variable">$DATA_COUNT</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$DATA_TYPE</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">        <span class="comment"># --- String ç±»å‹å¯¼å…¥ (SET key value) ---</span></span><br><span class="line">        string)</span><br><span class="line">            KEY=<span class="string">&quot;<span class="variable">$&#123;KEY_PREFIX&#125;</span>:string:<span class="variable">$&#123;i&#125;</span>&quot;</span></span><br><span class="line">            VALUE=<span class="string">&quot;value_of_<span class="variable">$&#123;i&#125;</span>_<span class="subst">$(date +%s%N)</span>&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># SET å‘½ä»¤ RESP åè®®: *3 (SET, key, value)</span></span><br><span class="line">            <span class="built_in">printf</span> <span class="string">&quot;*3\r\n\$3\r\nSET\r\n\$<span class="variable">$&#123;#KEY&#125;</span>\r\n<span class="variable">$&#123;KEY&#125;</span>\r\n\$<span class="variable">$&#123;#VALUE&#125;</span>\r\n<span class="variable">$&#123;VALUE&#125;</span>\r\n&quot;</span></span><br><span class="line">            ;;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- Hash ç±»å‹å¯¼å…¥ (HSET key field1 value1 field2 value2) ---</span></span><br><span class="line">        <span class="built_in">hash</span>)</span><br><span class="line">            HASH_KEY=<span class="string">&quot;<span class="variable">$&#123;KEY_PREFIX&#125;</span>:hash:<span class="variable">$&#123;i&#125;</span>&quot;</span></span><br><span class="line">            FIELD1=<span class="string">&quot;name&quot;</span></span><br><span class="line">            VALUE1=<span class="string">&quot;User_Name_<span class="variable">$&#123;i&#125;</span>&quot;</span></span><br><span class="line">            FIELD2=<span class="string">&quot;age&quot;</span></span><br><span class="line">            VALUE2=$(( (i % <span class="number">50</span>) + <span class="number">20</span> ))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># HSET å‘½ä»¤ RESP åè®®: *6 (HSET, key, f1, v1, f2, v2)</span></span><br><span class="line">            <span class="built_in">printf</span> <span class="string">&quot;*6\r\n\$4\r\nHSET\r\n\$<span class="variable">$&#123;#HASH_KEY&#125;</span>\r\n<span class="variable">$&#123;HASH_KEY&#125;</span>\r\n&quot;</span></span><br><span class="line">            <span class="built_in">printf</span> <span class="string">&quot;\$<span class="variable">$&#123;#FIELD1&#125;</span>\r\n<span class="variable">$&#123;FIELD1&#125;</span>\r\n\$<span class="variable">$&#123;#VALUE1&#125;</span>\r\n<span class="variable">$&#123;VALUE1&#125;</span>\r\n&quot;</span></span><br><span class="line">            <span class="built_in">printf</span> <span class="string">&quot;\$<span class="variable">$&#123;#FIELD2&#125;</span>\r\n<span class="variable">$&#123;FIELD2&#125;</span>\r\n\$<span class="variable">$&#123;#VALUE2&#125;</span>\r\n<span class="variable">$&#123;VALUE2&#125;</span>\r\n&quot;</span></span><br><span class="line">            ;;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- List ç±»å‹å¯¼å…¥ (LPUSH key value) ---</span></span><br><span class="line">        list)</span><br><span class="line">            LIST_KEY=<span class="string">&quot;<span class="variable">$&#123;KEY_PREFIX&#125;</span>:list:<span class="variable">$&#123;i&#125;</span>&quot;</span></span><br><span class="line">            <span class="comment"># å¾ªç¯æ·»åŠ  5 ä¸ªæˆå‘˜</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 <span class="variable">$MEMBERS_PER_KEY</span>); <span class="keyword">do</span></span><br><span class="line">                VALUE=<span class="string">&quot;list_element_<span class="variable">$&#123;i&#125;</span>_<span class="variable">$&#123;j&#125;</span>&quot;</span></span><br><span class="line">                <span class="comment"># LPUSH å‘½ä»¤ RESP åè®®: *3 (LPUSH, key, value)</span></span><br><span class="line">                <span class="built_in">printf</span> <span class="string">&quot;*3\r\n\$5\r\nLPUSH\r\n\$<span class="variable">$&#123;#LIST_KEY&#125;</span>\r\n<span class="variable">$&#123;LIST_KEY&#125;</span>\r\n\$<span class="variable">$&#123;#VALUE&#125;</span>\r\n<span class="variable">$&#123;VALUE&#125;</span>\r\n&quot;</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">            ;;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- Set ç±»å‹å¯¼å…¥ (SADD key member) ---</span></span><br><span class="line">        <span class="built_in">set</span>)</span><br><span class="line">            SET_KEY=<span class="string">&quot;<span class="variable">$&#123;KEY_PREFIX&#125;</span>:set:<span class="variable">$&#123;i&#125;</span>&quot;</span></span><br><span class="line">            <span class="comment"># å¾ªç¯æ·»åŠ  5 ä¸ªæˆå‘˜</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 <span class="variable">$MEMBERS_PER_KEY</span>); <span class="keyword">do</span></span><br><span class="line">                MEMBER=<span class="string">&quot;set_member_<span class="variable">$&#123;i&#125;</span>_<span class="variable">$&#123;j&#125;</span>&quot;</span></span><br><span class="line">                <span class="comment"># SADD å‘½ä»¤ RESP åè®®: *3 (SADD, key, member)</span></span><br><span class="line">                <span class="built_in">printf</span> <span class="string">&quot;*3\r\n\$4\r\nSADD\r\n\$<span class="variable">$&#123;#SET_KEY&#125;</span>\r\n<span class="variable">$&#123;SET_KEY&#125;</span>\r\n\$<span class="variable">$&#123;#MEMBER&#125;</span>\r\n<span class="variable">$&#123;MEMBER&#125;</span>\r\n&quot;</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">            ;;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- Sorted Set ç±»å‹å¯¼å…¥ (ZADD key score member) ---</span></span><br><span class="line">        zset)</span><br><span class="line">            ZSET_KEY=<span class="string">&quot;<span class="variable">$&#123;KEY_PREFIX&#125;</span>:zset:<span class="variable">$&#123;i&#125;</span>&quot;</span></span><br><span class="line">            <span class="comment"># å¾ªç¯æ·»åŠ  5 ä¸ªæˆå‘˜</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 <span class="variable">$MEMBERS_PER_KEY</span>); <span class="keyword">do</span></span><br><span class="line">                SCORE=<span class="string">&quot;<span class="variable">$&#123;i&#125;</span><span class="variable">$&#123;j&#125;</span>&quot;</span> <span class="comment"># ç”Ÿæˆå”¯ä¸€åˆ†æ•°ï¼šä¾‹å¦‚ key 1 çš„åˆ†æ•°æ˜¯ 11, 12...</span></span><br><span class="line">                MEMBER=<span class="string">&quot;zset_member_<span class="variable">$&#123;i&#125;</span>_<span class="variable">$&#123;j&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># ZADD å‘½ä»¤ RESP åè®®: *4 (ZADD, key, score, member)</span></span><br><span class="line">                <span class="built_in">printf</span> <span class="string">&quot;*4\r\n\$4\r\nZADD\r\n\$<span class="variable">$&#123;#ZSET_KEY&#125;</span>\r\n<span class="variable">$&#123;ZSET_KEY&#125;</span>\r\n\$<span class="variable">$&#123;#SCORE&#125;</span>\r\n<span class="variable">$&#123;SCORE&#125;</span>\r\n\$<span class="variable">$&#123;#MEMBER&#125;</span>\r\n<span class="variable">$&#123;MEMBER&#125;</span>\r\n&quot;</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">            ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line">    i=$((i+<span class="number">1</span>))</span><br><span class="line"><span class="keyword">done</span> | (</span><br><span class="line">    <span class="comment"># ----------------------------------------</span></span><br><span class="line">    <span class="comment"># --- 3. ç®¡é“å¯¼å…¥åˆ° Redis ---</span></span><br><span class="line">    <span class="comment"># ----------------------------------------</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ğŸ“¤ æ­£åœ¨é€šè¿‡ redis-cli --pipe å¯¼å…¥æ•°æ®...&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»º redis-cli å‘½ä»¤</span></span><br><span class="line">    REDIS_CLI_CMD=<span class="string">&quot;redis-cli -h <span class="variable">$&#123;REDIS_HOST&#125;</span> -p <span class="variable">$&#123;REDIS_PORT&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœè®¾ç½®äº†å¯†ç ï¼Œåˆ™æ·»åŠ  -a å‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$&#123;REDIS_PASSWORD&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        REDIS_CLI_CMD=<span class="string">&quot;<span class="variable">$&#123;REDIS_CLI_CMD&#125;</span> -a <span class="variable">$&#123;REDIS_PASSWORD&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰§è¡Œå¯¼å…¥</span></span><br><span class="line">    <span class="variable">$&#123;REDIS_CLI_CMD&#125;</span> --pipe</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ£€æŸ¥å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;âœ… æ•°æ®å¯¼å…¥æˆåŠŸï¼å…±å¯¼å…¥ <span class="variable">$&#123;DATA_COUNT&#125;</span> æ¡ [<span class="variable">$&#123;DATA_TYPE&#125;</span>] è®°å½•ã€‚&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;âŒ æ•°æ®å¯¼å…¥å¤±è´¥ï¼è¯·æ£€æŸ¥ Redis æœåŠ¡æ˜¯å¦è¿è¡Œä»¥åŠé…ç½®æ˜¯å¦æ­£ç¡®ã€‚&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="SCAN-çš„åŸºæœ¬ç”¨æ³•">SCAN çš„åŸºæœ¬ç”¨æ³•</h2><ul class="lvl-0"><li class="lvl-2"><p>SCAN çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCAN cursor [MATCH pattern] [COUNT count] [TYPE <span class="built_in">type</span>]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è§£é‡Šï¼š</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>cursor</td><td>æ¸¸æ ‡ï¼Œä» 0 å¼€å§‹ï¼Œè¿”å›å€¼ç”¨äºä¸‹ä¸€æ¬¡æ‰«æï¼›å½“è¿”å›å€¼ä¸º 0 æ—¶è¡¨ç¤ºéå†ç»“æŸ</td></tr><tr><td>MATCH pattern</td><td>ä½¿ç”¨é€šé…ç¬¦åŒ¹é… keyï¼ˆå¯é€‰ï¼‰</td></tr><tr><td>COUNT count</td><td>å»ºè®® Redis æ¯æ¬¡è¿”å›å¤šå°‘ keyï¼ˆå¯é€‰ï¼‰ï¼Œå°½åŠ›è€Œä¸ºï¼Œå¹¶ä¸ä¿è¯è¿”å›çš„ key æ•°é‡ä¸æŒ‡å®šçš„æ•°é‡ä¸€è‡´</td></tr><tr><td>TYPE type</td><td>åŒ¹é…çš„ key ç±»å‹ï¼ˆå¯é€‰ï¼‰</td></tr></tbody></table><h3 id="ç¤ºä¾‹ï¼š">ç¤ºä¾‹ï¼š</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºäº†æµ‹è¯• SCAN å‘½ä»¤ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€äº›æµ‹è¯•æ•°æ®ï¼Œé€šè¿‡å¦‚ä¸‹è„šæœ¬åˆå§‹åŒ– 100 æ¡æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh import_unified_data.sh string 100</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol><li class="lvl-5">è·å–æ‰€æœ‰ keyï¼š</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¸¸æ ‡åˆå§‹å€¼ä¸º0</span></span><br><span class="line">127.0.0.1:6379&gt; scan 0</span><br><span class="line">1) <span class="string">&quot;88&quot;</span>  <span class="comment"># æ¸¸æ ‡</span></span><br><span class="line">2)  1) <span class="string">&quot;test_data:string:16&quot;</span></span><br><span class="line">    2) <span class="string">&quot;test_data:string:85&quot;</span></span><br><span class="line">    3) <span class="string">&quot;test_data:string:21&quot;</span></span><br><span class="line">    4) <span class="string">&quot;test_data:string:83&quot;</span></span><br><span class="line">    5) <span class="string">&quot;test_data:string:97&quot;</span></span><br><span class="line">    6) <span class="string">&quot;test_data:string:77&quot;</span></span><br><span class="line">    7) <span class="string">&quot;test_data:string:29&quot;</span></span><br><span class="line">    8) <span class="string">&quot;test_data:string:89&quot;</span></span><br><span class="line">    9) <span class="string">&quot;test_data:string:91&quot;</span></span><br><span class="line">   10) <span class="string">&quot;test_data:string:28&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## è¯´æ˜</span></span><br><span class="line"><span class="comment"># å®é™…ä¸Šåªä¼šè¿”å›10æ¡key(é»˜è®¤countä¸º10)ï¼Œå¹¶ä¸ä¼šå‘ keys * é‚£æ ·è¿”å›æ‰€æœ‰key</span></span><br><span class="line"><span class="comment">## æ‰«æç»“æœä¸­ï¼š</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ¸¸æ ‡ï¼Œä¸ä¸º0æ—¶ï¼Œè¡¨ç¤ºè¿˜æœ‰æ›´å¤šçš„ key å¯ä»¥ç»§ç»­æ‰«æï¼Œåªæœ‰0è¡¨ç¤ºæ‰«æç»“æŸ</span></span><br><span class="line"><span class="comment"># ç¬¬äºŒä¸ªå…ƒç´ æ˜¯åŒ¹é…çš„ keyåˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ç€ä¸Šé¢ç»™å‡ºçš„æ¸¸æ ‡ï¼Œç»§ç»­æ‰«æï¼š</span></span><br><span class="line">127.0.0.1:6379&gt; scan 88</span><br><span class="line">1) <span class="string">&quot;92&quot;</span>  <span class="comment"># ä¸ä¸º0å°±è¡¨ç¤ºè¿˜æœ‰æ›´å¤šçš„ key å¯ä»¥ç»§ç»­æ‰«æ</span></span><br><span class="line">2)  1) <span class="string">&quot;test_data:string:63&quot;</span></span><br><span class="line">    2) <span class="string">&quot;test_data:string:2&quot;</span></span><br><span class="line">    3) <span class="string">&quot;test_data:string:4&quot;</span></span><br><span class="line">    4) <span class="string">&quot;test_data:string:20&quot;</span></span><br><span class="line">    5) <span class="string">&quot;test_data:string:57&quot;</span></span><br><span class="line">    6) <span class="string">&quot;test_data:string:78&quot;</span></span><br><span class="line">    7) <span class="string">&quot;test_data:string:71&quot;</span></span><br><span class="line">    8) <span class="string">&quot;test_data:string:35&quot;</span></span><br><span class="line">    9) <span class="string">&quot;test_data:string:86&quot;</span></span><br><span class="line">   10) <span class="string">&quot;test_data:string:6&quot;</span></span><br><span class="line">   11) <span class="string">&quot;test_data:string:47&quot;</span></span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">127.0.0.1:6379&gt; scan 87</span><br><span class="line">1) <span class="string">&quot;0&quot;</span> <span class="comment"># æ‰«æç»“æŸ æ¸¸æ ‡ä¸º0</span></span><br><span class="line">2) 1) <span class="string">&quot;test_data:68&quot;</span></span><br><span class="line">   2) <span class="string">&quot;test_data:79&quot;</span></span><br><span class="line">   3) <span class="string">&quot;test_data:41&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="2"><li class="lvl-5">æ§åˆ¶æ¯æ¬¡è·å–çš„ key æ•°é‡</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; scan 0 count 20</span><br><span class="line">1) <span class="string">&quot;92&quot;</span></span><br><span class="line">2)  1) <span class="string">&quot;test_data:string:16&quot;</span></span><br><span class="line">    2) <span class="string">&quot;test_data:string:85&quot;</span></span><br><span class="line">    3) <span class="string">&quot;test_data:string:21&quot;</span></span><br><span class="line">    4) <span class="string">&quot;test_data:string:83&quot;</span></span><br><span class="line">    5) <span class="string">&quot;test_data:string:97&quot;</span></span><br><span class="line">    6) <span class="string">&quot;test_data:string:77&quot;</span></span><br><span class="line">    7) <span class="string">&quot;test_data:string:29&quot;</span></span><br><span class="line">    8) <span class="string">&quot;test_data:string:89&quot;</span></span><br><span class="line">    9) <span class="string">&quot;test_data:string:91&quot;</span></span><br><span class="line">   10) <span class="string">&quot;test_data:string:28&quot;</span></span><br><span class="line">   11) <span class="string">&quot;test_data:string:63&quot;</span></span><br><span class="line">   12) <span class="string">&quot;test_data:string:2&quot;</span></span><br><span class="line">   13) <span class="string">&quot;test_data:string:4&quot;</span></span><br><span class="line">   14) <span class="string">&quot;test_data:string:20&quot;</span></span><br><span class="line">   15) <span class="string">&quot;test_data:string:57&quot;</span></span><br><span class="line">   16) <span class="string">&quot;test_data:string:78&quot;</span></span><br><span class="line">   17) <span class="string">&quot;test_data:string:71&quot;</span></span><br><span class="line">   18) <span class="string">&quot;test_data:string:35&quot;</span></span><br><span class="line">   19) <span class="string">&quot;test_data:string:86&quot;</span></span><br><span class="line">   20) <span class="string">&quot;test_data:string:6&quot;</span></span><br><span class="line">   21) <span class="string">&quot;test_data:string:47&quot;</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šCOUNT æ˜¯â€œå°½åŠ›è€Œä¸ºâ€ï¼Œå¹¶ä¸ä¿è¯ä¸€å®šè¿”å› 20 æ¡ã€‚</span></span><br><span class="line"><span class="comment"># æœ¬ç¤ºä¾‹å°±è¿”å›äº†21æ¡ï¼Œæ¯” count è¿˜å¤šäº† 1 æ¡</span></span><br><span class="line"><span class="comment"># ç”šè‡³æœ‰å¯èƒ½ä¸€æ¡éƒ½ä¸ä¼šè¿”å›ï¼Œä½†æ˜¯æ¸¸æ ‡å´å¹¶ä¸ä¸º0çš„æƒ…å†µï¼Œæ­¤æ—¶å°±éœ€è¦ç»§ç»­æ‰«æï¼Œç›´åˆ°æ¸¸æ ‡ä¸º0æ‰ç®—æ‰«æç»“æŸã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="3"><li class="lvl-5">æ‰«æä»¥ test_data:string å¼€å¤´çš„ key</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; scan 0 match test_data:string*</span><br><span class="line">1) <span class="string">&quot;88&quot;</span></span><br><span class="line">2)  1) <span class="string">&quot;test_data:string:16&quot;</span></span><br><span class="line">    2) <span class="string">&quot;test_data:string:85&quot;</span></span><br><span class="line">    3) <span class="string">&quot;test_data:string:21&quot;</span></span><br><span class="line">    4) <span class="string">&quot;test_data:string:83&quot;</span></span><br><span class="line">    5) <span class="string">&quot;test_data:string:97&quot;</span></span><br><span class="line">    6) <span class="string">&quot;test_data:string:77&quot;</span></span><br><span class="line">    7) <span class="string">&quot;test_data:string:29&quot;</span></span><br><span class="line">    8) <span class="string">&quot;test_data:string:89&quot;</span></span><br><span class="line">    9) <span class="string">&quot;test_data:string:91&quot;</span></span><br><span class="line">   10) <span class="string">&quot;test_data:string:28&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="4"><li class="lvl-5">æ‰«æä»¥ test_data:string å¼€å¤´çš„ keyï¼Œå¹¶è¿”å› 30 æ¡</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; scan 0 match test_data:string* count 30</span><br><span class="line">1) <span class="string">&quot;10&quot;</span></span><br><span class="line">2)  1) <span class="string">&quot;test_data:string:16&quot;</span></span><br><span class="line">    2) <span class="string">&quot;test_data:string:85&quot;</span></span><br><span class="line">    3) <span class="string">&quot;test_data:string:21&quot;</span></span><br><span class="line">    4) <span class="string">&quot;test_data:string:83&quot;</span></span><br><span class="line">    5) <span class="string">&quot;test_data:string:97&quot;</span></span><br><span class="line">    6) <span class="string">&quot;test_data:string:77&quot;</span></span><br><span class="line">    7) <span class="string">&quot;test_data:string:29&quot;</span></span><br><span class="line">    8) <span class="string">&quot;test_data:string:89&quot;</span></span><br><span class="line">    9) <span class="string">&quot;test_data:string:91&quot;</span></span><br><span class="line">   10) <span class="string">&quot;test_data:string:28&quot;</span></span><br><span class="line">   11) <span class="string">&quot;test_data:string:63&quot;</span></span><br><span class="line">   12) <span class="string">&quot;test_data:string:2&quot;</span></span><br><span class="line">   13) <span class="string">&quot;test_data:string:4&quot;</span></span><br><span class="line">   14) <span class="string">&quot;test_data:string:20&quot;</span></span><br><span class="line">   15) <span class="string">&quot;test_data:string:57&quot;</span></span><br><span class="line">   16) <span class="string">&quot;test_data:string:78&quot;</span></span><br><span class="line">   17) <span class="string">&quot;test_data:string:71&quot;</span></span><br><span class="line">   18) <span class="string">&quot;test_data:string:35&quot;</span></span><br><span class="line">   19) <span class="string">&quot;test_data:string:86&quot;</span></span><br><span class="line">   20) <span class="string">&quot;test_data:string:6&quot;</span></span><br><span class="line">   21) <span class="string">&quot;test_data:string:47&quot;</span></span><br><span class="line">   22) <span class="string">&quot;test_data:string:48&quot;</span></span><br><span class="line">   23) <span class="string">&quot;test_data:string:74&quot;</span></span><br><span class="line">   24) <span class="string">&quot;test_data:string:67&quot;</span></span><br><span class="line">   25) <span class="string">&quot;test_data:string:26&quot;</span></span><br><span class="line">   26) <span class="string">&quot;test_data:string:60&quot;</span></span><br><span class="line">   27) <span class="string">&quot;test_data:string:36&quot;</span></span><br><span class="line">   28) <span class="string">&quot;test_data:string:49&quot;</span></span><br><span class="line">   29) <span class="string">&quot;test_data:string:3&quot;</span></span><br><span class="line">   30) <span class="string">&quot;test_data:string:44&quot;</span></span><br><span class="line">   31) <span class="string">&quot;test_data:string:68&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæˆ‘ä»¬è™½ç„¶æŒ‡å®šäº† count 30ï¼Œä½†æ˜¯å®é™…è¿”å›çš„ key æ•°é‡å´æœ‰ 31 ä¸ª</span></span><br><span class="line"><span class="comment"># ä¹Ÿæœ‰å¯èƒ½æ¯” count å°‘ï¼Œç”šè‡³ä¸º 0 ä¸ª</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="5"><li class="lvl-5">æ‰«æä»¥ h_key å¼€å¤´çš„ keyï¼Œå¹¶è¿”å› 30 æ¡</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆæ’å…¥ä¸€æ¡è®°å½•</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> h_key:1 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; scan 0 match h_key* count 30</span><br><span class="line">1) <span class="string">&quot;124&quot;</span></span><br><span class="line">2) (empty array)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæˆ‘ä»¬è™½ç„¶æŒ‡å®šäº† count 30ï¼Œä½†æ˜¯å®é™…è¿”å›çš„ key æ•°é‡ä¸º 0 ä¸ª</span></span><br><span class="line"><span class="comment"># è™½ç„¶æˆ‘ä»¬åœ¨redisä¸­è®¾ç½®äº†h_key:1ï¼Œä½†æ˜¯h_key:1 å¹¶æ²¡æœ‰è¢«è¿”å›</span></span><br><span class="line"><span class="comment"># å¹¶ä¸”æ­¤æ—¶è¿”å›çš„æ¸¸æ ‡ä¹Ÿä¸ä¸º0ï¼Œè¯´æ˜æˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­æ‰«æ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®Œæ•´çš„æ‰«æè¿‡ç¨‹å¦‚ä¸‹ï¼š</span></span><br><span class="line">127.0.0.1:6379&gt; scan 0 match h_key* count 30</span><br><span class="line">1) <span class="string">&quot;124&quot;</span></span><br><span class="line">2) (empty array)  <span class="comment"># empty array ä¹Ÿä¸èƒ½è¯´æ˜ä¸€å®šæ²¡æœ‰</span></span><br><span class="line">127.0.0.1:6379&gt; scan 124 match h_key* count 30</span><br><span class="line">1) <span class="string">&quot;9&quot;</span></span><br><span class="line">2) (empty array)</span><br><span class="line">127.0.0.1:6379&gt; scan 9 match h_key* count 30</span><br><span class="line">1) <span class="string">&quot;43&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;h_key:1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; scan 43 match h_key* count 30</span><br><span class="line">1) <span class="string">&quot;0&quot;</span>      <span class="comment"># åªæœ‰æ¸¸æ ‡ä¸º0æ—¶æ‰ç®—æ‰«æç»“æŸ</span></span><br><span class="line">2) (empty array)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®é™…ä¸Šrediså®˜æ–¹æ¨èï¼šå½“è¿”å›çš„æ¸¸æ ‡ä¸ä¸º0ï¼Œä½†æ˜¯keyæ•°é‡ä¸º0æ—¶ï¼Œä¸‹ä¸€æ¬¡æ‰«æå¯ä»¥å¢åŠ countçš„æ•°é‡ï¼Œæ¯”å¦‚æ‰©å¤§2å€ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆå‡å°‘æ‰«ææ¬¡æ•°</span></span><br><span class="line">127.0.0.1:6379&gt; scan 0 match h_key* count 30</span><br><span class="line">1) <span class="string">&quot;124&quot;</span></span><br><span class="line">2) (empty array)</span><br><span class="line">127.0.0.1:6379&gt; scan 124 match h_key* count 60</span><br><span class="line">1) <span class="string">&quot;75&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;h_key:1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; scan 75 match h_key* count 60</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2) (empty array)</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="6"><li class="lvl-5">æ‰«ææŒ‡å®šç±»å‹çš„key</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; scan 0 <span class="built_in">type</span> string</span><br><span class="line">1) <span class="string">&quot;88&quot;</span></span><br><span class="line">2)  1) <span class="string">&quot;test_data:string:16&quot;</span></span><br><span class="line">    2) <span class="string">&quot;test_data:string:85&quot;</span></span><br><span class="line">    3) <span class="string">&quot;test_data:string:21&quot;</span></span><br><span class="line">    4) <span class="string">&quot;test_data:string:83&quot;</span></span><br><span class="line">    5) <span class="string">&quot;test_data:string:97&quot;</span></span><br><span class="line">    6) <span class="string">&quot;test_data:string:77&quot;</span></span><br><span class="line">    7) <span class="string">&quot;test_data:string:29&quot;</span></span><br><span class="line">    8) <span class="string">&quot;test_data:string:89&quot;</span></span><br><span class="line">    9) <span class="string">&quot;test_data:string:91&quot;</span></span><br><span class="line">   10) <span class="string">&quot;test_data:string:28&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”¯æŒçš„ç±»å‹æœ‰ï¼š</span></span><br><span class="line"><span class="comment"># string list set zset hash stream</span></span><br><span class="line"><span class="comment"># æ³¨æ„ä¸€ä¸ªå°é—®é¢˜ï¼ŒæŸäº› Redis ç±»å‹ï¼Œå¦‚ GeoHashesã€HyperLogLogsã€Bitmaps å’Œ Bitfieldï¼Œå†…éƒ¨å¯èƒ½ç”¨å…¶ä»– Redis ç±»å‹å®ç°ï¼Œå¦‚å­—ç¬¦ä¸²æˆ– zsetï¼Œå› æ­¤æ— æ³•é€šè¿‡ type åŒºåˆ† ã€‚</span></span><br><span class="line"><span class="comment"># ä¾‹å¦‚ï¼ŒZSET å’Œ GEOHASH éƒ½æ˜¯ zset ç±»å‹ã€‚</span></span><br><span class="line">127.0.0.1:6379&gt; GEOADD geokey 0 0 value</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> geokey</span><br><span class="line">zset</span><br><span class="line">127.0.0.1:6379&gt; ZADD zkey 1000 value</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; SCAN 0 TYPE zset count 1000</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;zkey&quot;</span></span><br><span class="line">   2) <span class="string">&quot;geokey&quot;</span></span><br></pre></td></tr></table></figure><h2 id="HSCAN-çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•">HSCAN çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•</h2><ul class="lvl-0"><li class="lvl-2"><p>HSCAN çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HSCAN key cursor [MATCH pattern] [COUNT count] [NOVALUES]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è§£é‡Šï¼š</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>key</td><td>é”®å</td></tr><tr><td>cursor</td><td>æ¸¸æ ‡ï¼Œä» 0 å¼€å§‹ï¼Œè¿”å›å€¼ç”¨äºä¸‹ä¸€æ¬¡æ‰«æï¼›å½“è¿”å›å€¼ä¸º 0 æ—¶è¡¨ç¤ºéå†ç»“æŸ</td></tr><tr><td>MATCH pattern</td><td>ä½¿ç”¨é€šé…ç¬¦åŒ¹é… keyï¼ˆå¯é€‰ï¼‰</td></tr><tr><td>COUNT count</td><td>å»ºè®® Redis æ¯æ¬¡è¿”å›å¤šå°‘ keyï¼ˆå¯é€‰ï¼‰ï¼Œå°½åŠ›è€Œä¸ºï¼Œå¹¶ä¸ä¿è¯è¿”å›çš„ key æ•°é‡ä¸æŒ‡å®šçš„æ•°é‡ä¸€è‡´</td></tr><tr><td>NOVALUES</td><td>redis8+å¢åŠ çš„å±æ€§ï¼Œåªè¿”å›keyï¼Œä¸è¿”å› valueï¼ˆå¯é€‰ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºäº†æµ‹è¯• HSCANï¼Œæˆ‘ä»¬å…ˆæ’å…¥ä¸€äº›æ•°æ®ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh import_unified_data.sh <span class="built_in">hash</span> 100</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h3><ul class="lvl-0"><li class="lvl-2"><ol><li class="lvl-5">è·å–æ‰€æœ‰ field å’Œ valueï¼š</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; scan 0 <span class="built_in">type</span> <span class="built_in">hash</span></span><br><span class="line">1) <span class="string">&quot;48&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;test_data:hash:42&quot;</span></span><br><span class="line">   2) <span class="string">&quot;test_data:hash:71&quot;</span></span><br><span class="line">   3) <span class="string">&quot;test_data:hash:54&quot;</span></span><br><span class="line">   4) <span class="string">&quot;test_data:hash:87&quot;</span></span><br><span class="line">   5) <span class="string">&quot;test_data:hash:96&quot;</span></span><br><span class="line">   6) <span class="string">&quot;test_data:hash:49&quot;</span></span><br><span class="line"><span class="comment"># è·å– test_data:hash:42 çš„æ‰€æœ‰ field å’Œ value</span></span><br><span class="line">127.0.0.1:6379&gt; hscan test_data:<span class="built_in">hash</span>:42 0</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;User_Name_42&quot;</span></span><br><span class="line">   3) <span class="string">&quot;age&quot;</span></span><br><span class="line">   4) <span class="string">&quot;62&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="2"><li class="lvl-5">æ¨¡ç³ŠåŒ¹é… fieldï¼š</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hscan test_data:<span class="built_in">hash</span>:42 0 match age*</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;age&quot;</span></span><br><span class="line">   2) <span class="string">&quot;62&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="3"><li class="lvl-5">æ¨¡ç³ŠåŒ¹é… fieldï¼Œå¹¶è¿”å› 10 æ¡æ•°æ®ï¼š</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hscan test_data:<span class="built_in">hash</span>:42 0 match *e* count 10</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;User_Name_42&quot;</span></span><br><span class="line">   3) <span class="string">&quot;age&quot;</span></span><br><span class="line">   4) <span class="string">&quot;62&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="4"><li class="lvl-5">ä¸æ˜¾ç¤ºvalue(éœ€è¦redis8+)</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hscan test_data:<span class="built_in">hash</span>:42 0 novalues</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;age&quot;</span></span><br></pre></td></tr></table></figure><h2 id="SSCAN-çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•">SSCAN çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•</h2><ul class="lvl-0"><li class="lvl-2"><p>SSCAN çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SSCAN key cursor [MATCH pattern] [COUNT count]</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ç¤ºä¾‹-2">ä½¿ç”¨ç¤ºä¾‹</h3><ul class="lvl-0"><li class="lvl-2"><ol><li class="lvl-5">è·å–æŒ‡å®škeyçš„æ‰€æœ‰å…ƒç´ ï¼š</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; scan 0 <span class="built_in">type</span> <span class="built_in">set</span></span><br><span class="line">1) <span class="string">&quot;112&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;test_data:set:43&quot;</span></span><br><span class="line">   2) <span class="string">&quot;test_data:set:33&quot;</span></span><br><span class="line">   3) <span class="string">&quot;test_data:set:98&quot;</span></span><br><span class="line">   4) <span class="string">&quot;test_data:set:61&quot;</span></span><br><span class="line">   5) <span class="string">&quot;test_data:set:2&quot;</span></span><br><span class="line">   6) <span class="string">&quot;test_data:set:70&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sscan test_data:<span class="built_in">set</span>:43 0</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;set_member_43_1&quot;</span></span><br><span class="line">   2) <span class="string">&quot;set_member_43_2&quot;</span></span><br><span class="line">   3) <span class="string">&quot;set_member_43_3&quot;</span></span><br><span class="line">   4) <span class="string">&quot;set_member_43_4&quot;</span></span><br><span class="line">   5) <span class="string">&quot;set_member_43_5&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="2"><li class="lvl-5">æ¨¡ç³ŠåŒ¹é…å…ƒç´ ï¼š</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sscan test_data:<span class="built_in">set</span>:43 0 match *_3*</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;set_member_43_3&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="3"><li class="lvl-5">è¿”å› 1 ä¸ªå…ƒç´ : å®é™…ä¸Šæ§åˆ¶ä¸ä½ï¼Œå¤§æ¦‚ç‡ä¼šè¿”å›æ‰€æœ‰å…ƒç´ </li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sscan test_data:<span class="built_in">set</span>:43 0 count 1</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;set_member_43_1&quot;</span></span><br><span class="line">   2) <span class="string">&quot;set_member_43_2&quot;</span></span><br><span class="line">   3) <span class="string">&quot;set_member_43_3&quot;</span></span><br><span class="line">   4) <span class="string">&quot;set_member_43_4&quot;</span></span><br><span class="line">   5) <span class="string">&quot;set_member_43_5&quot;</span></span><br></pre></td></tr></table></figure><h2 id="ZSCAN-çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•">ZSCAN çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•</h2><ul class="lvl-0"><li class="lvl-2"><p>ZSCAN çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSCAN key cursor [MATCH pattern] [COUNT count]</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ç¤ºä¾‹-3">ä½¿ç”¨ç¤ºä¾‹</h3><ul class="lvl-0"><li class="lvl-2"><ol><li class="lvl-5">è·å–æŒ‡å®škeyçš„æ‰€æœ‰å…ƒç´ ï¼š</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; scan 0 <span class="built_in">type</span> zset</span><br><span class="line">1) <span class="string">&quot;112&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;test_data:zset:89&quot;</span></span><br><span class="line">   2) <span class="string">&quot;test_data:zset:81&quot;</span></span><br><span class="line">   3) <span class="string">&quot;test_data:zset:73&quot;</span></span><br><span class="line">   4) <span class="string">&quot;test_data:zset:79&quot;</span></span><br><span class="line">   5) <span class="string">&quot;test_data:zset:15&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; zscan test_data:zset:89 0</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2)  1) <span class="string">&quot;zset_member_89_1&quot;</span></span><br><span class="line">    2) <span class="string">&quot;891&quot;</span></span><br><span class="line">    3) <span class="string">&quot;zset_member_89_2&quot;</span></span><br><span class="line">    4) <span class="string">&quot;892&quot;</span></span><br><span class="line">    5) <span class="string">&quot;zset_member_89_3&quot;</span></span><br><span class="line">    6) <span class="string">&quot;893&quot;</span></span><br><span class="line">    7) <span class="string">&quot;zset_member_89_4&quot;</span></span><br><span class="line">    8) <span class="string">&quot;894&quot;</span></span><br><span class="line">    9) <span class="string">&quot;zset_member_89_5&quot;</span></span><br><span class="line">   10) <span class="string">&quot;895&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="2"><li class="lvl-5">æ¨¡ç³ŠåŒ¹é…å…ƒç´ ï¼š</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zscan test_data:zset:89 0 match *_3*</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;zset_member_89_3&quot;</span></span><br><span class="line">   2) <span class="string">&quot;893&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="3"><li class="lvl-5">è·å–æŒ‡å®škeyçš„æ‰€æœ‰å…ƒç´ ï¼Œå¹¶è¿”å› 1 ä¸ªå…ƒç´ ï¼ŒåŒæ ·æ§åˆ¶ä¸ä½</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;  zscan test_data:zset:89 0 count 1</span><br><span class="line">1) <span class="string">&quot;0&quot;</span></span><br><span class="line">2)  1) <span class="string">&quot;zset_member_89_1&quot;</span></span><br><span class="line">    2) <span class="string">&quot;891&quot;</span></span><br><span class="line">    3) <span class="string">&quot;zset_member_89_2&quot;</span></span><br><span class="line">    4) <span class="string">&quot;892&quot;</span></span><br><span class="line">    5) <span class="string">&quot;zset_member_89_3&quot;</span></span><br><span class="line">    6) <span class="string">&quot;893&quot;</span></span><br><span class="line">    7) <span class="string">&quot;zset_member_89_4&quot;</span></span><br><span class="line">    8) <span class="string">&quot;894&quot;</span></span><br><span class="line">    9) <span class="string">&quot;zset_member_89_5&quot;</span></span><br><span class="line">   10) <span class="string">&quot;895&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;åœ¨ä½¿ç”¨ Redis æ—¶ï¼Œç»å¸¸éœ€è¦éå†æ•°æ®åº“ä¸­çš„é”®ï¼Œä¾‹å¦‚æŸ¥æ‰¾ç‰¹å®šå‰ç¼€çš„ keyã€ç»Ÿè®¡ key æ•°é‡ã€æ‰¹é‡åˆ é™¤ key ç­‰ã€‚&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis æä¾›äº†ä¸¤ç§æ€è·¯ï¼šä½¿ç”¨ &lt;code&gt;KEYS pattern&lt;/code&gt; æˆ–ä½¿ç”¨æ¸¸æ ‡å¼éå†å‘½ä»¤ &lt;code&gt;SCAN&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;&lt;code&gt;KEYS pattern&lt;/code&gt; æ˜¯ä¸€ç§éå¸¸ä¸å®‰å…¨çš„æ–¹å¼ï¼Œå› ä¸ºå®ƒä¼šè§¦å‘ Redis æœåŠ¡å™¨çš„é˜»å¡ï¼Œä»è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚è®¾ç½®ä¸€äº›æ³¨é‡å®‰å…¨çš„ç¯å¢ƒä¼šç¦ç”¨&lt;code&gt;KEYS pattern&lt;/code&gt;ç­‰å±é™©å‘½ä»¤ã€‚&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æ‰€ä»¥Rediså®˜æ–¹å¼ºçƒˆæ¨è &lt;code&gt;SCAN&lt;/code&gt; æ–¹å¼ï¼Œå…¶æ˜¯æœ€å®‰å…¨ã€æœ€å¯æ§çš„éå†æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Maven æ–°ä¸€ä»£æ„å»ºå·¥å…· mvnd</title>
    <link href="https://blog.hanqunfeng.com/2025/12/07/maven-mvnd/"/>
    <id>https://blog.hanqunfeng.com/2025/12/07/maven-mvnd/</id>
    <published>2025-12-07T14:30:05.000Z</published>
    <updated>2025-12-08T06:04:23.696Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Maven æ–°ä¸€ä»£æ„å»ºå·¥å…· mvnd</p></li><li class="lvl-2"><p><a href="https://github.com/apache/maven-mvnd">mvnd GitHub</a></p></li><li class="lvl-2"><p>æœ¬æ–‡å®‰è£…çš„æ˜¯ mvnd 1.0.3ã€‚</p></li></ul><span id="more"></span><h2 id="mvnd-ç®€ä»‹">mvnd ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>mvnd æ˜¯ Maven æ–°ä¸€ä»£æ„å»ºå·¥å…·ï¼Œä½¿ç”¨ Java è¯­è¨€ç¼–å†™ã€‚</p></li><li class="lvl-2"><p>mvnd å€Ÿé‰´ Gradle å’Œ Takari ä¸­çš„æŠ€æœ¯ä»è€Œæä¾›æ›´å¿«çš„Mavenæ„å»ºé€Ÿåº¦ã€‚</p></li></ul><h3 id="æ¶æ„æ¦‚è¿°">æ¶æ„æ¦‚è¿°</h3><ul class="lvl-0"><li class="lvl-2"><p>mvndå†…åµŒMavenï¼ˆå› æ­¤ä¸éœ€è¦å•ç‹¬å®‰è£…Mavenï¼‰ã€‚1.xç‰ˆæœ¬å†…åµŒmaven3.xç‰ˆæœ¬ï¼Œ2.xç‰ˆæœ¬å†…åµŒmaven4.xç‰ˆæœ¬ã€‚</p></li><li class="lvl-2"><p>å®é™…æ„å»ºå‘ç”Ÿåœ¨ä¸€ä¸ªé•¿é©»åå°è¿›ç¨‹ä¸­ï¼Œåˆåå®ˆæŠ¤ç¨‹åºã€‚</p></li><li class="lvl-2"><p>ä¸€ä¸ªå®ˆæŠ¤ç¨‹åºå®ä¾‹å¯ä»¥æœåŠ¡æ¥è‡ªmvndå®¢æˆ·ç«¯çš„å¤šä¸ªè¿ç»­è¯·æ±‚ã€‚</p></li><li class="lvl-2"><p>mvndå®¢æˆ·ç«¯æ˜¯ä½¿ç”¨GraalVMæ„å»ºçš„åŸç”Ÿå¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¸å¯åŠ¨ä¼ ç»Ÿçš„JVMç›¸æ¯”ï¼Œå®ƒå¯åŠ¨é€Ÿåº¦æ›´å¿«ï¼Œå ç”¨çš„å†…å­˜æ›´å°‘ã€‚</p></li><li class="lvl-2"><p>å¦‚æœæ²¡æœ‰é—²ç½®å®ˆæŠ¤ç¨‹åºæ¥æœåŠ¡æ„å»ºè¯·æ±‚ï¼Œåˆ™å¯ä»¥å¹¶è¡Œç”Ÿæˆå¤šä¸ªå®ˆæŠ¤ç¨‹åºã€‚</p></li><li class="lvl-2"><p>è¿™ç§æ¶æ„å¸¦æ¥äº†ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul class="lvl-2"><li class="lvl-6">ä¸éœ€è¦æ¯æ¬¡æ„å»ºé‡æ–°å¯åŠ¨ JVMï¼Œå¤§å¤§èŠ‚çœæ—¶é—´ã€‚</li><li class="lvl-6">æŒæœ‰Mavenæ’ä»¶ç±»çš„classloadersè¢«ç¼“å­˜åœ¨å¤šä¸ªæ„å»ºä¸­ã€‚å› æ­¤ï¼Œæ’ä»¶jaråªè¢«è¯»å–å’Œè§£æä¸€æ¬¡ã€‚Mavenæ’ä»¶çš„SNAPSHOTç‰ˆæœ¬æ²¡æœ‰ç¼“å­˜ã€‚</li><li class="lvl-6">JVMå†…Just-In-Timeï¼ˆJITï¼‰ç¼–è¯‘å™¨ç”Ÿæˆçš„åŸç”Ÿä»£ç ä¹Ÿè¢«ä¿ç•™ã€‚ä¸ä¼ ç»Ÿçš„Mavenç›¸æ¯”ï¼ŒJITç¼–è¯‘èŠ±è´¹çš„æ—¶é—´æ›´å°‘ã€‚åœ¨é‡å¤æ„å»ºæœŸé—´ï¼ŒJITä¼˜åŒ–çš„ä»£ç ç«‹å³å¯ç”¨ã€‚è¿™ä¸ä»…é€‚ç”¨äºæ¥è‡ªMavenæ’ä»¶å’ŒMaven Coreçš„ä»£ç ï¼Œä¹Ÿé€‚ç”¨äºæ¥è‡ªJDKæœ¬èº«çš„æ‰€æœ‰ä»£ç ã€‚</li></ul></li><li class="lvl-2"><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œmvnd ä½¿ç”¨å¤šä¸ª CPU å†…æ ¸å¹¶è¡Œæ„å»ºæ¨¡å—ï¼Œä½¿ç”¨çš„æ ¸å¿ƒæ•°ç”±ä»¥ä¸‹å…¬å¼ç»™å‡º: <code>availableProcessors - 1</code></p></li></ul><h2 id="mvnd-å®‰è£…">mvnd å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>mvnd å®‰è£…åŒ…ä¸‹è½½åœ°å€ï¼š</p><ul class="lvl-2"><li class="lvl-6"><a href="https://github.com/apache/maven-mvnd/releases">mvnd Github Release</a></li><li class="lvl-6"><a href="https://maven.apache.org/download.cgi">maven å®˜ç½‘ä¸‹è½½é¡µ</a></li></ul></li><li class="lvl-2"><p>æœ¬æ–‡ä»¥ macOS ä¸ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ mvnd å¯¹åº”çš„å®‰è£…åŒ…</span></span><br><span class="line">curl -L https://github.com/apache/maven-mvnd/releases/download/1.0.3/maven-mvnd-1.0.3-darwin-amd64.tar.gz | tar xz</span><br><span class="line"><span class="built_in">ln</span> -s mvnd-1.0.3-darwin-amd64 mvnd</span><br><span class="line"><span class="comment"># æ·»åŠ  mvnd åˆ°ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;MVND_HOME=$HOME/develop_soft/mvnd&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PATH=$MVND_HOME/bin:$PATH&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br><span class="line"><span class="comment"># æ£€æŸ¥ mvnd æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">mvnd --version</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>mvnd å†…åµŒ mavenï¼Œå…¶æœ¬è´¨ä¸Šè¿˜æ˜¯ä¾èµ–äºmavenï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºmavençš„é…ç½®æ–‡ä»¶ <code>~/.m2/settings.xml</code> ï¼Œç”±äºæœ¬æœºä¹‹å‰å®‰è£…è¿‡ Mavenï¼Œæ‰€ä»¥è¿™ä¸€æ­¥å°±çœç•¥äº†ã€‚</p></li><li class="lvl-2"><p>[æ¨è]å°† mvnd çš„é…ç½®æ–‡ä»¶æ‹·è´åˆ° <code>~/.m2</code> ç›®å½•ä¸‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ mavenäº†ç±»ä¼¼ï¼Œ`~/.m2/mvnd.properties` ä¼˜å…ˆçº§é«˜äº `$MVND_HOME/conf/mvnd.properties`</span></span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$MVND_HOME</span>/conf/mvnd.properties <span class="variable">$HOME</span>/.m2/mvnd.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>mvnd é…ç½®é¡¹è¯´æ˜ï¼Œä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹ï¼Œå¯èƒ½ä¼šä¿®æ”¹çš„æˆ‘ç”¨ <code>[*]</code> åšäº†æ ‡æ³¨</p></li></ul><table><thead><tr><th>é…ç½®é¡¹</th><th>é»˜è®¤å€¼</th><th>ä¸­æ–‡è§£é‡Š</th></tr></thead><tbody><tr><td><strong>mvnd.noBuffering</strong> <code>[*]</code></td><td>false</td><td>æ˜¯å¦ç¦ç”¨è¾“å‡ºç¼“å†²ï¼Œä»è€Œåƒæ™®é€š Maven ä¸€æ ·å®æ—¶æ˜¾ç¤ºæ—¥å¿—ã€‚å‘½ä»¤è¡Œä¼ é€’ <code>-B</code> æˆ– <code>--batch-mode</code> ä¹Ÿä¼šå¯ç”¨æ­¤è¡Œä¸º</td></tr><tr><td><strong>mvnd.rollingWindowSize</strong></td><td>0</td><td>æ„å»ºå¹¶è¡Œæ¨¡å—æ—¶ï¼Œæ¯ä¸ªæ¨¡å—æ˜¾ç¤ºçš„æ—¥å¿—è¡Œæ•°</td></tr><tr><td><strong>mvnd.logPurgePeriod</strong></td><td>7d</td><td>è‡ªåŠ¨æ¸…ç†æ—¥å¿—çš„å‘¨æœŸï¼ˆå¦‚ï¼š7å¤©ï¼‰ï¼Œæ—¥å¿—ä¿å­˜è·¯å¾„ï¼š <code>$HOME/.m2/mvnd/registry/1.0.3/</code></td></tr><tr><td><strong>mvnd.noDaemon</strong></td><td>false</td><td>ç¦æ­¢ä½¿ç”¨ daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰ã€‚ä¸€èˆ¬ç”¨äºè°ƒè¯•ï¼Œä»…åœ¨é native æ¨¡å¼ä¸‹æœ‰æ•ˆ</td></tr><tr><td><strong>mvnd.debug</strong></td><td>false</td><td>ä½¿ç”¨è°ƒè¯•æ¨¡å¼å¯åŠ¨ daemonï¼ŒJVM å‚æ•°ä¸ºï¼š<code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=8000</code></td></tr><tr><td><strong>mvnd.idleTimeout</strong></td><td>3 hours</td><td>å®ˆæŠ¤è¿›ç¨‹åœ¨ç©ºé—²å¤šä¹…åè‡ªåŠ¨å…³é—­</td></tr><tr><td><strong>mvnd.keepAlive</strong></td><td>100 ms</td><td>å¦‚æœæ„å»ºè¿‡ç¨‹æ²¡æœ‰è¾“å‡ºï¼Œdaemon å‘å®¢æˆ·ç«¯å‘é€ä¿æ´»æ¶ˆæ¯çš„æ—¶é—´é—´éš”</td></tr><tr><td><strong>mvnd.maxLostKeepAlive</strong></td><td>30</td><td>å…è®¸ä¸¢å¤±çš„æœ€å¤§ä¿æ´»æ¶ˆæ¯æ•°é‡ï¼Œè¶…è¿‡åˆ™å®¢æˆ·ç«¯è®¤ä¸º daemon å·²å¤±è´¥</td></tr><tr><td><strong>mvnd.minThreads</strong></td><td>1</td><td>æ„å»ºæ—¶è¦ä½¿ç”¨çš„æœ€å°‘çº¿ç¨‹æ•°é‡ã€‚å¦‚æœæ˜¾å¼æŒ‡å®šäº† <code>-T</code>ã€<code>--threads</code> æˆ– <code>mvnd.threads</code>ï¼Œè¯¥å€¼å°†è¢«å¿½ç•¥</td></tr><tr><td><strong>mvnd.threads</strong> <code>[*]</code></td><td>æœªè®¾ç½®</td><td>ä¼ é€’ç»™ daemon çš„çº¿ç¨‹æ•°ï¼Œä¸ Maven çš„ <code>-T / --threads</code> è¯­æ³•ä¸€è‡´</td></tr><tr><td><strong>mvnd.builder</strong></td><td>smart</td><td>æŒ‡å®šä½¿ç”¨çš„ Maven æ„å»ºå™¨åç§°ï¼ˆç­‰åŒäº <code>-b</code> æˆ– <code>--builder</code>ï¼‰</td></tr><tr><td><strong>mvnd.minHeapSize</strong></td><td>128M</td><td>å®ˆæŠ¤è¿›ç¨‹ JVM çš„æœ€å°å †å†…å­˜</td></tr><tr><td><strong>mvnd.maxHeapSize</strong> <code>[*]</code></td><td>2G</td><td>å®ˆæŠ¤è¿›ç¨‹ JVM çš„æœ€å¤§å †å†…å­˜</td></tr><tr><td><strong>mvnd.threadStackSize</strong></td><td>1M</td><td>å®ˆæŠ¤è¿›ç¨‹çº¿ç¨‹æ ˆå¤§å°</td></tr><tr><td><strong>mvnd.jvmArgs</strong></td><td>æœªè®¾ç½®</td><td>ä¼ é€’ç»™ daemon çš„é¢å¤– JVM å‚æ•°</td></tr><tr><td><strong>mvnd.enableAssertions</strong></td><td>false</td><td>æ˜¯å¦ä¸º daemon å¯ç”¨ JVM æ–­è¨€ï¼ˆ-eaï¼‰</td></tr><tr><td><strong>mvnd.expirationCheckDelay</strong></td><td>10 seconds</td><td>å®ˆæŠ¤è¿›ç¨‹æ£€æµ‹è‡ªèº«æ˜¯å¦éœ€è¦è¿‡æœŸçš„æ—¶é—´é—´éš”</td></tr><tr><td><strong>mvnd.duplicateDaemonGracePeriod</strong></td><td>10 seconds</td><td>å¤šä¸ª daemon å­˜åœ¨æ—¶ï¼Œå¤šä½™ daemon çš„å®½é™é€€å‡ºæ—¶é—´</td></tr><tr><td><strong>mvnd.home</strong></td><td>è‡ªåŠ¨è®¾ç½®</td><td>mvnd å®‰è£…ç›®å½•ï¼Œå®¢æˆ·ç«¯é€šå¸¸ä¼šæ ¹æ® mvnd å¯æ‰§è¡Œæ–‡ä»¶ä½ç½®è®¾ç½®</td></tr><tr><td><strong>java.home</strong></td><td>ä½¿ç”¨ç¯å¢ƒå˜é‡</td><td>å¯åŠ¨ daemon çš„ Java ç›®å½•ï¼ˆç­‰åŒ JAVA_HOMEï¼‰</td></tr><tr><td><strong>maven.settings</strong> <code>[*]</code></td><td>~/.m2/settings.xml</td><td>maven çš„ settings.xml è·¯å¾„</td></tr></tbody></table><h2 id="mvnd-ä½¿ç”¨">mvnd ä½¿ç”¨</h2><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œä½¿ç”¨æ–¹å¼ä¸ mvn ä¸€æ ·ï¼Œæ¯”å¦‚ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvnd clean install</span><br><span class="line">mvnd clean package -Dmaven.test.skip=<span class="literal">true</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>mvnd çš„ daemon ç¼“å­˜äº†ä¸€åˆ‡ï¼Œæ‰€ä»¥è¿è¡Œ <code>mvnd clean install</code> åï¼Œä¹‹åå†æ¬¡è¿è¡Œ <code>mvnd clean install</code> æ—¶ï¼Œmvnd ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–æ„å»ºç»“æœï¼Œä»è€ŒèŠ‚çœäº†æ„å»ºæ—¶é—´ã€‚</p></li><li class="lvl-2"><p>mvnd è¿˜æœ‰äº›ç‰¹æ®Šç”¨æ³•ï¼Œæ¯”å¦‚ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„å®ˆæŠ¤è¿›ç¨‹åˆ—è¡¨ï¼Œå®ˆæŠ¤è¿›ç¨‹ç©ºé—²è¶…è¿‡ mvnd.idleTimeout=3 hours ä¼šè‡ªåŠ¨å…³é—­</span></span><br><span class="line">mvnd --status</span><br><span class="line"><span class="comment"># æ‰‹åŠ¨åœæ­¢æ‰€æœ‰è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹</span></span><br><span class="line">mvnd --stop</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨IDEAä¸­ä½¿ç”¨<code>mvnd</code>ï¼Œåœ¨Mavenè®¾ç½®ä¸­å°†<code>mvnd</code>çš„å®‰è£…ç›®å½•æ·»åŠ åˆ° <code>Maven Home Path</code> ä¸­<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/7oSR8O.png" alt=""></p></li></ul><h2 id="mvnd-ä¸-mvnw-çš„åŒºåˆ«">mvnd ä¸ mvnw çš„åŒºåˆ«</h2><ul class="lvl-0"><li class="lvl-2"><p>æˆ‘ä»¬ç°åœ¨å¤§éƒ¨åˆ†åˆ›å»ºçš„é¡¹ç›®éƒ½æ˜¯Springbooté¡¹ç›®ï¼Œé€šè¿‡IDEAåˆ›å»ºSpringbooté¡¹ç›®æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºå¦‚ä¸‹æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.mvnï¼š æ–‡ä»¶å¤¹ï¼Œå…¶å†…éƒ¨å­˜æ”¾äº† `wrapper/maven-wrapper.properties` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ç”¨äºå£°æ˜  mvn çš„ url</span><br><span class="line">mvnwï¼š linux è„šæœ¬æ–‡ä»¶</span><br><span class="line">mvnw.cmdï¼š windows è„šæœ¬æ–‡ä»¶</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®é™…ä¸Š <code>mvnw</code> æ˜¯ä¸€ä¸ª Maven å¯åŠ¨è„šæœ¬ï¼Œç”¨äºè‡ªåŠ¨ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„Mavenï¼Œå¹¶è¿è¡Œ Maven æ„å»ºã€‚</p></li><li class="lvl-2"><p>ç¬¬ä¸€æ¬¡ä½¿ç”¨<code>mvnw</code>æ—¶ä¼šé€šè¿‡<code>wrapper/maven-wrapper.properties</code> æ–‡ä»¶ä¸­çš„å£°æ˜è‡ªåŠ¨ä¸‹è½½mavenï¼Œå¹¶ä¿å­˜åœ¨ <code>~/.m2/wrapper/dists/</code> ç›®å½•ä¸‹</p></li><li class="lvl-2"><p><code>mvnw</code>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mvnw clean install</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œé€Ÿåº¦ï¼š <code>mvnd &gt;&gt; mvnw â‰ˆ mvn</code></p></li></ul><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>mvnd</th><th>mvnwï¼ˆMaven Wrapperï¼‰</th></tr></thead><tbody><tr><td>æ˜¯ä»€ä¹ˆ</td><td>ä¸€ä¸ªã€Œå¸¸é©»çš„ Maven å®ˆæŠ¤è¿›ç¨‹ã€</td><td>ä¸€ä¸ªã€ŒMaven å¯åŠ¨è„šæœ¬ã€</td></tr><tr><td>æ˜¯å¦å¸¸é©»</td><td>âœ… æ˜¯ï¼ˆdaemonï¼‰</td><td>âŒ å¦ï¼ˆä¸€æ¬¡æ€§ï¼‰</td></tr><tr><td>æ˜¯å¦ä¸‹è½½ Maven</td><td>âŒ ä¸ä¸‹è½½ï¼Œè‡ªå·±å°±æ˜¯ç¨‹åº</td><td>âœ… ä¼šè‡ªåŠ¨ä¸‹è½½æŒ‡å®šç‰ˆæœ¬</td></tr><tr><td>ä¸»è¦ç›®çš„</td><td>åŠ é€Ÿæ„å»º</td><td>ä¿è¯ç‰ˆæœ¬ä¸€è‡´</td></tr><tr><td>æ˜¯å¦æ¨èåœ¨ CI</td><td>ä¸€èˆ¬ä¸å»ºè®®</td><td>âœ… éå¸¸æ¨è</td></tr><tr><td>ä½¿ç”¨æ–¹å¼</td><td><code>mvnd clean install</code></td><td><code>./mvnw clean install</code></td></tr><tr><td>æ˜¯å¦ä¸é¡¹ç›®ç»‘å®š</td><td>âŒ å…¨å±€ä½¿ç”¨</td><td>âœ… å’Œé¡¹ç›®ç»‘å®š</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Maven æ–°ä¸€ä»£æ„å»ºå·¥å…· mvnd&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/apache/maven-mvnd&quot;&gt;mvnd GitHub&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡å®‰è£…çš„æ˜¯ mvnd 1.0.3ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="maven" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/maven/"/>
    
    <category term="mvnd" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/maven/mvnd/"/>
    
    
    <category term="mavne" scheme="https://blog.hanqunfeng.com/tags/mavne/"/>
    
    <category term="mvnd" scheme="https://blog.hanqunfeng.com/tags/mvnd/"/>
    
  </entry>
  
  <entry>
    <title>Redis 7 + ACL ç®€ä»‹</title>
    <link href="https://blog.hanqunfeng.com/2025/12/07/redis7-acl/"/>
    <id>https://blog.hanqunfeng.com/2025/12/07/redis7-acl/</id>
    <published>2025-12-07T13:30:05.000Z</published>
    <updated>2025-12-07T07:50:08.659Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">Redis 7 + ACL ç®€ä»‹</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li></ul><span id="more"></span><h2 id="Redis-ACL-ç®€ä»‹">Redis ACL ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ä» Redis 6.0 å¼€å§‹ï¼Œå¼•å…¥äº† ACL åŠŸèƒ½ï¼Œç”¨æ¥ç²¾ç»†åŒ–æ§åˆ¶ä¸åŒç”¨æˆ·èƒ½åšä»€ä¹ˆï¼Œä»£æ›¿è¿‡å»åªæœ‰ä¸€ä¸ªå…¨å±€å¯†ç ï¼ˆrequirepassï¼‰çš„ç²—ç²’åº¦æ¨¡å¼ã€‚</p></li><li class="lvl-2"><p>ACL å¯ä»¥æ§åˆ¶çš„ç»´åº¦åŒ…æ‹¬ï¼š</p><ul class="lvl-2"><li class="lvl-5">è°èƒ½ç™»å½•ï¼ˆç”¨æˆ·ã€å¯†ç ï¼‰</li><li class="lvl-5">å¯ä»¥æ‰§è¡Œå“ªäº›å‘½ä»¤</li><li class="lvl-5">å¯ä»¥è®¿é—®å“ªäº› keyï¼ˆæŒ‰å‰ç¼€ / æ­£åˆ™ï¼‰</li><li class="lvl-5">å¯å¦é€šè¿‡ç½‘ç»œè®¿é—®</li><li class="lvl-5">æ˜¯å¦å¯ç”¨ / ç¦ç”¨æŸä¸ªç”¨æˆ·</li></ul></li><li class="lvl-2"><p>ä¸€å¥è¯ï¼šRedis ACL å®ç°äº†å¤šç”¨æˆ· + æƒé™æœ€å°åŒ– + èµ„æºéš”ç¦»</p></li></ul><h2 id="Redis-ACL-çš„ä½¿ç”¨">Redis ACL çš„ä½¿ç”¨</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ <code>redis.conf</code> ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®š ACL æ–‡ä»¶</span></span><br><span class="line">aclfile /etc/redis/users.acl</span><br><span class="line"><span class="comment"># å…³é—­ å¯†ç </span></span><br><span class="line"><span class="comment"># requirepass foobared</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¹Ÿå¯ä»¥ä¸é…ç½® <code>aclfile</code>ï¼Œè€Œæ˜¯å°†ç”¨æˆ·ä¿¡æ¯ç›´æ¥ç¼–å†™åœ¨ <code>redis.conf</code> ä¸­ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšã€‚</p></li></ul><h3 id="ACL-çš„é…ç½®æ–¹å¼">ACL çš„é…ç½®æ–¹å¼</h3><h4 id="ç›´æ¥ç¼–è¾‘-aclfile">ç›´æ¥ç¼–è¾‘ aclfile</h4><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ª <code>users.acl</code> æ–‡ä»¶ï¼Œå¹¶å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®ä¸€ä¸ªç®¡ç†å‘˜</span></span><br><span class="line">user admin on ~* &amp;* +@all &gt;password</span><br><span class="line"><span class="comment"># é…ç½®ä¸€ä¸ªåº”ç”¨ç”¨æˆ·</span></span><br><span class="line">user appuser on  ~cache:* &amp;app:* +get +<span class="built_in">set</span> &gt;password</span><br><span class="line"><span class="comment"># é…ç½®ä¸€ä¸ªåªè¯»ç”¨æˆ·</span></span><br><span class="line">user <span class="built_in">readonly</span> on ~* -@all +@<span class="built_in">read</span> +ping +info +client +config|get &gt;password</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„ï¼Œaclfile ä¸æ”¯æŒæ³¨é‡Šè¡Œï¼Œæ‰€æœ‰è¡Œéƒ½å¿…é¡»ä»¥ user å¼€å¤´ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p></li><li class="lvl-2"><p>æ ¼å¼è¯´æ˜</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">user: å›ºå®šå‰ç¼€</span><br><span class="line">username: ç”¨æˆ·å</span><br><span class="line">on: å¯ç”¨ off: ç¦ç”¨</span><br><span class="line">~pattern: key åŒ¹é…æ¨¡å¼ï¼Œ~*ï¼šåŒ¹é…æ‰€æœ‰ keyï¼Œ~cache:*ï¼š åŒ¹é… cache: å¼€å¤´çš„æ‰€æœ‰ key</span><br><span class="line">&amp;pattern: é¢‘é“åŒ¹é…æ¨¡å¼ï¼Œ&amp;*ï¼šåŒ¹é…æ‰€æœ‰é¢‘é“ï¼Œ&amp;app:*ï¼šåŒ¹é… app:* å¼€å¤´çš„æ‰€æœ‰é¢‘é“ï¼Œé€šé“å°±æ˜¯ pub/sub çš„é¢‘é“</span><br><span class="line">+<span class="built_in">command</span>: å…è®¸çš„å‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å‘½ä»¤åç§°ï¼Œå¦‚ +get +<span class="built_in">set</span>ï¼Œå­å‘½ä»¤ +config|getï¼Œä¹Ÿå¯ä»¥æ˜¯å‘½ä»¤çš„ç±»åˆ«ï¼Œå‘½ä»¤ç±»åˆ« é€šè¿‡ acl <span class="built_in">cat</span> å‘½ä»¤æŸ¥çœ‹ï¼Œä»¥@å¼€å¤´ï¼Œæ¯”å¦‚ @<span class="built_in">read</span> @writeï¼Œ+ è¡¨ç¤ºå…è®¸å‘½ä»¤ï¼Œ- è¡¨ç¤ºç¦æ­¢å‘½ä»¤</span><br><span class="line">&gt;password: å¯†ç æ˜æ–‡ï¼Œæ³¨æ„ &gt; ä¸ å¯†ç ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºäº†å…¼å®¹ä»¥å‰çš„ç‰ˆæœ¬ï¼ŒRedis æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„ç”¨æˆ·ï¼š<code>default</code>ï¼Œä¸æŒ‡å®šç”¨æˆ·åçš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯ <code>default</code> ç”¨æˆ·ï¼Œå…¶å¯¹åº”çš„aclæƒé™ä¸º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªè¶…çº§ç®¡ç†å‘˜æƒé™</span></span><br><span class="line">user default on nopass sanitize-payload ~* &amp;* +@all</span><br><span class="line"><span class="comment"># å¦‚æœè®¾ç½®äº† requirepass å¯†ç </span></span><br><span class="line">user default on sanitize-payload <span class="comment">#5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 ~* &amp;* +@all</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¼€å¯<code>ACL</code>åï¼Œæ¨èå…³é—­ <code>default</code> ç”¨æˆ·ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­é»˜è®¤ç”¨æˆ·ï¼Œç¦æ­¢åŒ¿åè®¿é—®</span></span><br><span class="line">user default off</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç™»å½•redis</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥æ—¶ç›´æ¥ç™»å½•, --pass == -a</span></span><br><span class="line">redis-cli --user username --pass password -h host -p port</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">redis-cli -u redis://admin:123456@127.0.0.1:6379</span><br><span class="line"><span class="comment"># æœ¬æœºç™»å½•</span></span><br><span class="line">redis-cli -u redis://admin:123456@</span><br><span class="line"><span class="comment"># æœ¬æœºç™»å½•æ—¶ç«¯å£ä¸æ˜¯é»˜è®¤çš„6379æ—¶</span></span><br><span class="line">redis-cli -u redis://admin:123456@:6380</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆè¿æ¥åç™»å½•</span></span><br><span class="line">redis-cli -h host -p port</span><br><span class="line">&gt; auth username password</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Redis ACL è§„åˆ™ä¸­æ–‡è¯´æ˜</p></li></ul><table><thead><tr><th>è§„åˆ™ / è¯­æ³•</th><th>ä¸­æ–‡è¯´æ˜</th></tr></thead><tbody><tr><td><code>on</code></td><td>å¯ç”¨ç”¨æˆ·ï¼šå¯ä»¥ä½¿ç”¨è¯¥ç”¨æˆ·è¿›è¡Œè®¤è¯ç™»å½•</td></tr><tr><td><code>off</code></td><td>ç¦ç”¨ç”¨æˆ·ï¼šæ— æ³•å†ä½¿ç”¨è¯¥ç”¨æˆ·è®¤è¯ï¼Œä½†<strong>å·²è®¤è¯çš„è¿æ¥ä»ç„¶æœ‰æ•ˆ</strong></td></tr><tr><td><code>skip-sanitize-payload</code></td><td>è·³è¿‡å¯¹ <code>RESTORE</code> å‘½ä»¤çš„ dump æ•°æ®è½½è·è¿‡æ»¤ï¼ˆè·³è¿‡å®‰å…¨æ£€æŸ¥ï¼‰</td></tr><tr><td><code>sanitize-payload</code></td><td>å¯¹ <code>RESTORE</code> å‘½ä»¤çš„ dump æ•°æ®è½½è·è¿›è¡Œè¿‡æ»¤ï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td><code>+&lt;command&gt;</code></td><td>å…è®¸æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼›å¯ä»¥æŒ‡å®šå­å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š<code>+config | get</code></td></tr><tr><td><code>-&lt;command&gt;</code></td><td>ç¦æ­¢æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼›å¯ä»¥æŒ‡å®šå­å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š<code>-config | set</code></td></tr><tr><td><code>+@&lt;category&gt;</code></td><td>å…è®¸ä¸€ä¸ªå‘½ä»¤åˆ†ç±»çš„æ‰€æœ‰å‘½ä»¤ï¼Œå¦‚ï¼š<code>@admin</code>, <code>@set</code>, <code>@sortedset</code> ç­‰ã€‚å®Œæ•´åˆ†ç±»åœ¨ <code>server.c</code> çš„å‘½ä»¤è¡¨ä¸­</td></tr><tr><td><code>@all</code></td><td>ç‰¹æ®Šåˆ†ç±»ï¼Œè¡¨ç¤ºæ‰€æœ‰<strong>å½“å‰å·²æœ‰å‘½ä»¤ + æœªæ¥æ¨¡å—åŠ è½½çš„å‘½ä»¤</strong></td></tr><tr><td><code>+&lt;command&gt;|first-arg</code></td><td>åªå…è®¸ä½¿ç”¨æŸå‘½ä»¤çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆ<strong>å·²åºŸå¼ƒï¼Œå°†å¯èƒ½ç§»é™¤</strong>ï¼‰ï¼›åªæ”¯æŒæ–°å¢ï¼Œä¸æ”¯æŒç¦æ­¢ï¼ˆå¦‚ <code>-SELECT|1</code> ä¸å…è®¸ï¼‰</td></tr><tr><td><code>allcommands</code></td><td><code>+@all</code> çš„åˆ«åï¼Œå…è®¸æ‰€æœ‰å‘½ä»¤ï¼ˆåŒ…æ‹¬å°†æ¥å¯èƒ½åŠ è½½çš„æ¨¡å—å‘½ä»¤ï¼‰</td></tr><tr><td><code>nocommands</code></td><td><code>-@all</code> çš„åˆ«åï¼Œç¦æ­¢æ‰€æœ‰å‘½ä»¤</td></tr><tr><td><code>~&lt;pattern&gt;</code></td><td>æ·»åŠ å…è®¸è®¿é—®çš„ key æ¨¡å¼ï¼ˆglob é£æ ¼ï¼‰ï¼Œå¦‚ï¼š<code>~user:*</code>ï¼›å¯ä»¥æœ‰å¤šä¸ª</td></tr><tr><td><code>%R~&lt;pattern&gt;</code></td><td>æ·»åŠ <strong>å…è®¸è¯»å–</strong>çš„ key æ¨¡å¼</td></tr><tr><td><code>%W~&lt;pattern&gt;</code></td><td>æ·»åŠ <strong>å…è®¸å†™å…¥</strong>çš„ key æ¨¡å¼</td></tr><tr><td><code>allkeys</code></td><td><code>~*</code> çš„åˆ«åï¼Œå…è®¸æ‰€æœ‰ key</td></tr><tr><td><code>resetkeys</code></td><td>æ¸…ç©ºå…è®¸è®¿é—®çš„ key æ¨¡å¼</td></tr><tr><td><code>&amp;&lt;pattern&gt;</code></td><td>æ·»åŠ å¯è®¿é—®çš„ Pub/Sub channel æ¨¡å¼ï¼ˆglob é£æ ¼ï¼‰ï¼Œå¯å¤šä¸ª</td></tr><tr><td><code>allchannels</code></td><td><code>&amp;*</code> çš„åˆ«åï¼Œå…è®¸æ‰€æœ‰ channel</td></tr><tr><td><code>resetchannels</code></td><td>æ¸…ç©º Pub/Sub channel æ¨¡å¼åˆ—è¡¨</td></tr><tr><td><code>&gt;&lt;password&gt;</code></td><td>æ·»åŠ å¯†ç ï¼Œä¾‹å¦‚ï¼š<code>&gt;mypass</code>ï¼›æ­¤æŒ‡ä»¤ä¼šæ¸…é™¤ <code>nopass</code> æ ‡å¿—</td></tr><tr><td><code>&lt;&lt;password&gt;</code></td><td>ç§»é™¤æŒ‡å®šå¯†ç </td></tr><tr><td><code>nopass</code></td><td>ç§»é™¤æ‰€æœ‰å¯†ç ï¼Œä¸”ä»»ä½•å¯†ç éƒ½å¯ç™»å½•ã€‚å¦‚æœç”¨äº <code>default</code> ç”¨æˆ·ï¼Œåˆ™æ–°è¿æ¥<strong>æ— éœ€ AUTH å³è‡ªåŠ¨ç™»å½•ä¸º default</strong></td></tr><tr><td><code>resetpass</code></td><td>æ¸…ç©ºæ‰€æœ‰å¯†ç ï¼Œå¹¶ç§»é™¤ <code>nopass</code> çŠ¶æ€ã€‚æ­¤å<strong>æ²¡æœ‰å¯†ç å°†æ— æ³•è®¤è¯</strong></td></tr><tr><td><code>reset</code></td><td>é‡ç½®æ‰€æœ‰è®¾ç½®ï¼šåŒ…æ‹¬ <code>resetpass</code>ã€<code>resetkeys</code>ã€<code>resetchannels</code>ã€<code>allchannels</code>ï¼ˆå¦‚æœå¼€å¯ acl-pubsub-defaultï¼‰ã€<code>off</code>ã€<code>clearseletors</code>ã€<code>-@all</code></td></tr><tr><td><code>(&lt;options&gt;)</code></td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„ selectorï¼ˆé€‰æ‹©å™¨ï¼‰ï¼Œæ‹¬å·å†…ä¸ºè¯¥ selector çš„ç‹¬ç«‹æƒé™è§„åˆ™</td></tr><tr><td><code>clearselectors</code></td><td>åˆ é™¤æ‰€æœ‰ selectorï¼Œä½†ä¸ä¼šå½±å“æ ¹æƒé™ï¼ˆç›´æ¥èµ‹ç»™ç”¨æˆ·çš„æƒé™ï¼‰</td></tr></tbody></table><h4 id="é€šè¿‡-ACL-å‘½ä»¤">é€šè¿‡ ACL å‘½ä»¤</h4><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/iddYko.png" alt=""></p><h5 id="ACL-SETUSER">ACL SETUSER</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º/ä¿®æ”¹ç”¨æˆ·</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­ default ç”¨æˆ·</span></span><br><span class="line">ACL SETUSER default off</span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜</span></span><br><span class="line">ACL SETUSER admin on ~* &amp;* +@all &gt;password</span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·</span></span><br><span class="line">ACL SETUSER appuser on &gt;password ~cache:* &amp;app:* +get +<span class="built_in">set</span></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåªè¯»ç”¨æˆ·</span></span><br><span class="line">ACL SETUSER <span class="built_in">readonly</span> on ~* -@all +@<span class="built_in">read</span> +ping +info +client +config|get &gt;password</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥çœ‹çš„å‡ºæ¥ï¼Œ<code>ACL SETUSER</code> åé¢çš„å‘½ä»¤æ ¼å¼ä¸ç›´æ¥ç¼–è¾‘ <code>users.acl</code> æ–‡ä»¶æ˜¯ä¸€æ ·çš„</p></li><li class="lvl-2"><p>è¿™é‡Œè¦æ³¨æ„ <code>ACL SETUSER</code> å³å¯ä»¥åˆ›å»ºç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ç”¨æˆ·ï¼Œå½“ç”¨æˆ·ä¸å­˜åœ¨æ—¶åˆ›å»ºç”¨æˆ·ï¼Œå½“ç”¨æˆ·å­˜åœ¨æ—¶ä¿®æ”¹ç”¨æˆ·ï¼Œä¿®æ”¹ç”¨æˆ·æ—¶å¹¶ä¸ä¼šè¦†ç›–æ—§ç”¨æˆ·ï¼Œè€Œæ˜¯ä¼šå°†æƒé™è¿›è¡Œåˆå¹¶ï¼Œæ¯”å¦‚ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span></span><br><span class="line">ACL SETUSER testuser on ~* -@all +@<span class="built_in">read</span> +ping  &gt;password</span><br><span class="line"><span class="comment"># ç¬¬äºŒæ¬¡æ‰§è¡Œï¼Œåªæ·»åŠ æ–°çš„æƒé™</span></span><br><span class="line">ACL SETUSER testuser +info +client +config|get</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œåçš„ç»“æœ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;user testuser on sanitize-payload #5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 ~* resetchannels -@all +@read +ping +info +client +config|get&quot;</span></span><br></pre></td></tr></table></figure><h6 id="ä¿®æ”¹ç”¨æˆ·æƒé™">ä¿®æ”¹ç”¨æˆ·æƒé™</h6><ul class="lvl-0"><li class="lvl-2"><p>é‡ç½®æƒé™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡ç½®æ‰€æœ‰æƒé™</span></span><br><span class="line">ACL SETUSER testuser reset</span><br><span class="line"><span class="comment">## è¿è¡Œç»“æœï¼šå»é™¤æ‰€æœ‰é¢‘é“å’Œå‘½ä»¤æƒé™ï¼Œç¦æ­¢ç™»å½•</span></span><br><span class="line"><span class="string">&quot;user testuser off sanitize-payload resetchannels -@all&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å–æ¶ˆå¯†ç ï¼Œä½†ä¿ç•™æƒé™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ACL SETUSER testuser nopass</span><br><span class="line"><span class="comment">## è¿è¡Œç»“æœï¼šå–æ¶ˆå¯†ç </span></span><br><span class="line"><span class="string">&quot;user testuser on nopass sanitize-payload ~* resetchannels -@all +@read +ping&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å»é™¤æ‰€æœ‰é¢‘é“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ACL SETUSER testuser resetchannels</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å»é™¤æ‰€æœ‰<code>selectors</code>ï¼Œå…³äº<code>selectors</code>åé¢ä¼šè¯¦ç»†ä»‹ç»</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ACL SETUSER testuser clearselectors</span><br></pre></td></tr></table></figure><h5 id="ACL-LIST">ACL LIST</h5><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ Redis ä¸­æ‰€æœ‰çš„ç”¨æˆ·</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ACL LIST</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) <span class="string">&quot;user admin on sanitize-payload #8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92 ~* &amp;* +@all&quot;</span></span><br><span class="line">2) <span class="string">&quot;user appuser on sanitize-payload #5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 ~cache:* resetchannels &amp;app:* -@all +get +set&quot;</span></span><br><span class="line">3) <span class="string">&quot;user default off sanitize-payload resetchannels -@all&quot;</span></span><br><span class="line">4) <span class="string">&quot;user readonly on sanitize-payload #5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 ~* resetchannels -@all +@read +ping +info +client +config|get&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œæ˜¾ç¤ºçš„å¹¶ä¸æ˜¯è®¾ç½®æƒé™æ—¶çš„å‘½ä»¤æ ¼å¼ï¼Œè€Œæ˜¯ç»è¿‡ç¿»è¯‘åçš„å‘½ä»¤æ ¼å¼</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">user: å›ºå®šå‰ç¼€</span><br><span class="line">username: ç”¨æˆ·å</span><br><span class="line">on: å¯ç”¨</span><br><span class="line">sanitize-payload: æ˜¯åœ¨ç”¨ RESTORE å‘½ä»¤å¯¼å…¥ RDB æ•°æ®æ—¶ï¼Œå¸®ä½ â€œä½“æ£€ + æ¶ˆæ¯’ + æ¸…æ´—â€è¿™ä»½æ•°æ®ï¼Œé˜²æ­¢æ¶æ„å†…å®¹è¢«å¯¼è¿›å»ã€‚</span><br><span class="line">#xxx: å¯†ç çš„åŠ å¯†å“ˆå¸Œå€¼ï¼ˆé€šå¸¸æ˜¯ SHA-256ï¼‰, &gt;xxx = æ˜æ–‡å¯†ç ï¼Œä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ï¼Œä½†æ¨èä½¿ç”¨å“ˆå¸Œå€¼ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡æ˜æ–‡é…ç½®ï¼Œç„¶åé€šè¿‡ ACL SAVE å‘½ä»¤ä¿å­˜å°±ä¼šå°†å¯†ç å˜æˆå“ˆå¸Œå€¼äº†</span><br><span class="line">~pattern: key åŒ¹é…æ¨¡å¼ï¼Œ~*ï¼šåŒ¹é…æ‰€æœ‰ keyï¼Œ~cache:*ï¼š åŒ¹é… cache: å¼€å¤´çš„æ‰€æœ‰ key</span><br><span class="line">resetchannels: é‡ç½®é¢‘é“æƒé™ï¼Œå°±æ˜¯å…ˆåˆ é™¤æ‰€æœ‰é¢‘é“æƒé™ï¼Œåé¢æ ¹æ® &amp; çš„é…ç½®å†æ·»åŠ æ–°çš„é¢‘é“æƒé™ã€‚</span><br><span class="line">&amp;pattern: é¢‘é“åŒ¹é…æ¨¡å¼ï¼Œ&amp;*ï¼šåŒ¹é…æ‰€æœ‰é¢‘é“ï¼Œ&amp;app:*ï¼šåŒ¹é… app:* å¼€å¤´çš„æ‰€æœ‰é¢‘é“ï¼Œé€šé“å°±æ˜¯ pub/sub çš„é¢‘é“</span><br><span class="line">+command: å…è®¸çš„å‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å‘½ä»¤åç§°ï¼Œå¦‚ +get +setï¼Œå­å‘½ä»¤ +config|getï¼Œä¹Ÿå¯ä»¥æ˜¯å‘½ä»¤çš„ç±»åˆ«ï¼Œå‘½ä»¤ç±»åˆ« é€šè¿‡ acl cat å‘½ä»¤æŸ¥çœ‹ï¼Œä»¥@å¼€å¤´ï¼Œæ¯”å¦‚ @read @writeï¼Œ+ è¡¨ç¤ºå…è®¸å‘½ä»¤ï¼Œ- è¡¨ç¤ºç¦æ­¢å‘½ä»¤</span><br></pre></td></tr></table></figure><h5 id="ACL-LOAD">ACL LOAD</h5><ul class="lvl-0"><li class="lvl-2"><p>å½“é€šè¿‡ ACL SETUSER åˆ›å»ºç”¨æˆ·æ—¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å°†å…¶ä¿å­˜åˆ° <code>users.acl</code> æ–‡ä»¶ä¸­</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ACL SAVE</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶ä¿å­˜çš„æ–‡ä»¶å†…å®¹å°±æ˜¯ <code>ACL LIST</code> å‘½ä»¤çš„è¾“å‡º</p></li></ul><h5 id="ACL-SAVE">ACL SAVE</h5><ul class="lvl-0"><li class="lvl-2"><p>å½“ä¿®æ”¹äº† <code>users.acl</code> æ–‡ä»¶åï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å°†å…¶é‡æ–°åŠ è½½åˆ° Redis ä¸­</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ACL LOAD</span><br></pre></td></tr></table></figure><h5 id="ACL-USERS">ACL USERS</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ—å‡ºæ‰€æœ‰å·²åˆ›å»ºçš„ç”¨æˆ·</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ACL USERS</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) <span class="string">&quot;admin&quot;</span></span><br><span class="line">2) <span class="string">&quot;appuser&quot;</span></span><br><span class="line">3) <span class="string">&quot;default&quot;</span></span><br><span class="line">4) <span class="string">&quot;readonly&quot;</span></span><br></pre></td></tr></table></figure><h5 id="ACL-GETUSER">ACL GETUSER</h5><ul class="lvl-0"><li class="lvl-2"><p>è·å–æŒ‡å®šç”¨æˆ·çš„æƒé™ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ACL GETUSER appuser</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1) <span class="string">&quot;flags&quot;</span></span><br><span class="line"> 2) 1) <span class="string">&quot;on&quot;</span></span><br><span class="line">    2) <span class="string">&quot;sanitize-payload&quot;</span></span><br><span class="line"> 3) <span class="string">&quot;passwords&quot;</span></span><br><span class="line"> 4) 1) <span class="string">&quot;5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8&quot;</span></span><br><span class="line"> 5) <span class="string">&quot;commands&quot;</span></span><br><span class="line"> 6) <span class="string">&quot;-@all +get +set&quot;</span></span><br><span class="line"> 7) <span class="string">&quot;keys&quot;</span></span><br><span class="line"> 8) <span class="string">&quot;~cache:*&quot;</span></span><br><span class="line"> 9) <span class="string">&quot;channels&quot;</span></span><br><span class="line">10) <span class="string">&quot;&amp;app:*&quot;</span></span><br><span class="line">11) <span class="string">&quot;selectors&quot;</span></span><br><span class="line">12) (empty array)</span><br></pre></td></tr></table></figure><h6 id="selectors-é€‰æ‹©å™¨è§„åˆ™">selectors(é€‰æ‹©å™¨è§„åˆ™)</h6><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œçœ‹åˆ°æœ€åæœ‰ä¸€ä¸ª<code>selectors</code>ï¼Œè¿™ä¸ªæ˜¯Redis 7.0 å¼•å…¥çš„ä¸€ä¸ªæ–°èƒ½åŠ›ï¼Œå®ƒå…è®¸ä¸€ä¸ªç”¨æˆ·åŒæ—¶æ‹¥æœ‰å¤šå¥—ä¸åŒçš„ ACL è§„åˆ™ï¼Œè€Œä¸æ˜¯åªèƒ½æœ‰ä¸€å¥—è§„åˆ™ã€‚</p></li><li class="lvl-2"><p>ä»¥å‰ = ä¸€ä¸ªç”¨æˆ·ä¸€æ¡è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ¹æƒé™ï¼ˆå…¨å±€è§„åˆ™ï¼‰</span></span><br><span class="line">ACL SETUSER selectoruser on ~cache:* +get +<span class="built_in">set</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç°åœ¨ = ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªâ€œæƒé™åˆ†èº«â€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€‰æ‹©å™¨è§„åˆ™</span></span><br><span class="line"><span class="comment"># æ³¨æ„å‘½ä»¤æœ€åçš„ä¸¤ä¸ª()ï¼Œè¿™é‡Œè®¾ç½®äº†ä¸¤ä¸ªè§„åˆ™ï¼Œæ¯ä¸ª()ä»£è¡¨ä¸€ä¸ªè§„åˆ™ï¼Œæ ¹æ®ä¸åŒçš„keyå‰ç¼€æˆäºˆç”¨æˆ·ä¸åŒçš„æƒé™</span></span><br><span class="line">ACL SETUSER selectoruser on (~cache:* +get) (~session:* +get +<span class="built_in">set</span>) &gt;123456</span><br><span class="line"><span class="comment">## ç¿»è¯‘åçš„ç»“æœ</span></span><br><span class="line"><span class="string">&quot;user selectoruser on sanitize-payload resetchannels -@all (~cache:* resetchannels -@all +get) (~session:* resetchannels -@all +get +set)&quot;</span> &gt;123456</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä¸€ä¸ªç”¨æˆ·åŒæ—¶æ‹¥æœ‰ æ ¹æƒé™è§„åˆ™ å’Œ é€‰æ‹©å™¨è§„åˆ™ï¼Œåˆ™ é€‰æ‹©å™¨è§„åˆ™ ä¼˜å…ˆçº§æ›´é«˜ã€‚</p></li></ul><h5 id="ACL-DELUSER">ACL DELUSER</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤ä¸€ä¸ªç”¨æˆ·</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ACL DELUSER ç”¨æˆ·å</span><br></pre></td></tr></table></figure><h5 id="ACL-WHOAMI">ACL WHOAMI</h5><ul class="lvl-0"><li class="lvl-2"><p>è·å–å½“å‰ç™»å½•çš„ç”¨æˆ·å</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ACL WHOAMI</span><br></pre></td></tr></table></figure><h5 id="ACL-CAT">ACL CAT</h5><ul class="lvl-0"><li class="lvl-2"><p>è·å–æ‰€æœ‰æƒé™ç±»åˆ«</p></li><li class="lvl-2"><p>å‰é¢æˆ‘ä»¬åœ¨ä¸ºç”¨æˆ·æˆæƒæ—¶ä»‹ç»è¿‡ï¼Œ<code>@</code> åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªæƒé™ç±»åˆ«ï¼Œæ¯”å¦‚ @allã€@dangerousï¼Œä½ å¯ä»¥ç†è§£ä¸ºå…¶æ˜¯ä¸€ç»„æƒé™(å‘½ä»¤)çš„é›†åˆã€‚</p></li><li class="lvl-2"><p><code>ACL CAT</code> å‘½ä»¤å¯ä»¥è·å–æ‰€æœ‰æƒé™ç±»åˆ«ï¼Œç„¶åä½ å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©éœ€è¦çš„æƒé™ç±»åˆ«ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–æ‰€æœ‰æƒé™ç±»åˆ«</span></span><br><span class="line">ACL CAT</span><br><span class="line"><span class="comment"># è·å–æŒ‡å®šç±»åˆ«ä¸­çš„å‘½ä»¤åˆ—è¡¨</span></span><br><span class="line">ACL CAT åˆ†ç±»åç§°</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„æƒé™ç±»åˆ« <code>@all</code> å¹¶ä¸åœ¨åˆ—å‡ºçš„æƒé™ç±»åˆ«ä¸­ï¼Œå…¶è¡¨ç¤ºæ‰€æœ‰å‘½ä»¤ã€‚</p></li></ul><h5 id="ACL-DRYRUN">ACL DRYRUN</h5><ul class="lvl-0"><li class="lvl-2"><p><code>ACL DRYRUN</code> å‘½ä»¤å¯ä»¥æ¨¡æ‹Ÿæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶è¿”å›æ¨¡æ‹Ÿç»“æœï¼Œå¹¶ä¸æ˜¯çœŸçš„æ‰§è¡Œå‘½ä»¤ã€‚</p></li><li class="lvl-2"><p>Redis 7.0.0 æ–°å¢ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; ACL SETUSER VIRGINIA +SET ~*</span><br><span class="line"><span class="string">&quot;OK&quot;</span></span><br><span class="line">&gt; ACL DRYRUN VIRGINIA SET foo bar</span><br><span class="line"><span class="string">&quot;OK&quot;</span></span><br><span class="line">&gt; ACL DRYRUN VIRGINIA GET foo</span><br><span class="line"><span class="string">&quot;User VIRGINIA has no permissions to run the &#x27;get&#x27; command&quot;</span></span><br></pre></td></tr></table></figure><h5 id="ACL-LOG">ACL LOG</h5><ul class="lvl-0"><li class="lvl-2"><p><code>ACL LOG</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹ ACL å‘½ä»¤æ‰§è¡Œæ—¥å¿—ã€‚</p></li><li class="lvl-2"><p>å®ƒè®°å½•äº† ACLï¼ˆè®¿é—®æ§åˆ¶ï¼‰ç›¸å…³çš„äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·åœ¨æ“ä½œè¢«æ‹’ç»æˆ–è§¦å‘ ACL è§„åˆ™æ—¶çš„è¡Œä¸ºè®°å½•ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ACL LOG          <span class="comment"># æŸ¥çœ‹é»˜è®¤æœ€æ–°çš„ ACL æ—¥å¿—æ¡ç›®</span></span><br><span class="line">ACL LOG RESET    <span class="comment"># æ¸…ç©º ACL æ—¥å¿—</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ—¥å¿—æ ¼å¼</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1) <span class="string">&quot;count&quot;</span> =&gt; 1</span><br><span class="line">   2) <span class="string">&quot;reason&quot;</span> =&gt; <span class="string">&quot;command&quot;</span></span><br><span class="line">   3) <span class="string">&quot;context&quot;</span> =&gt; <span class="string">&quot;toplevel&quot;</span></span><br><span class="line">   4) <span class="string">&quot;object&quot;</span> =&gt; <span class="string">&quot;acl|log&quot;</span></span><br><span class="line">   5) <span class="string">&quot;username&quot;</span> =&gt; <span class="string">&quot;selectoruser&quot;</span></span><br><span class="line">   6) <span class="string">&quot;age-seconds&quot;</span> =&gt; 1589.819</span><br><span class="line">   7) <span class="string">&quot;client-info&quot;</span> =&gt; <span class="string">&quot;id=8 addr=127.0.0.1:56424 laddr=127.0.0.1:6379 fd=11 name= age=1390 idle=0 flags=N db=0 ... cmd=acl|log user=selectoruser ...&quot;</span></span><br><span class="line">   8) <span class="string">&quot;entry-id&quot;</span> =&gt; 3</span><br><span class="line">   9) <span class="string">&quot;timestamp-created&quot;</span> =&gt; 1765089007352</span><br><span class="line">   10) <span class="string">&quot;timestamp-last-updated&quot;</span> =&gt; 1765089007352</span><br></pre></td></tr></table></figure><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>count</code></td><td>è§¦å‘è¯¥æ—¥å¿—çš„æ¬¡æ•°ã€‚æ¯”å¦‚åŒä¸€äº‹ä»¶è§¦å‘ 1 æ¬¡å°±æ˜¯ 1</td></tr><tr><td><code>reason</code></td><td>æ—¥å¿—è§¦å‘çš„åŸå› ï¼Œé€šå¸¸æ˜¯ <code>command</code> è¡¨ç¤ºæŸä¸ªå‘½ä»¤è¢«æ‰§è¡Œæˆ–è¢« ACL æ£€æŸ¥</td></tr><tr><td><code>context</code></td><td>æ‰§è¡Œå‘½ä»¤çš„ä¸Šä¸‹æ–‡ï¼Œ<code>toplevel</code> è¡¨ç¤ºç›´æ¥åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ</td></tr><tr><td><code>object</code></td><td>è§¦å‘äº‹ä»¶çš„å¯¹è±¡ï¼Œä¾‹å¦‚ <code>acl|log</code>è¡¨ç¤ºæ‰§è¡Œäº†<code>ACL LOG</code> å‘½ä»¤ï¼Œ<code>acl|list</code>è¡¨ç¤ºæ‰§è¡Œäº†<code>ACL LIST</code></td></tr><tr><td><code>username</code></td><td>è§¦å‘äº‹ä»¶çš„ç”¨æˆ·</td></tr><tr><td><code>age-seconds</code></td><td>äº‹ä»¶è·ç¦»å½“å‰çš„æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶Šå¤§è¡¨ç¤ºè¶Šä¹…è¿œ</td></tr><tr><td><code>client-info</code></td><td>å®¢æˆ·ç«¯è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯ IDã€IP åœ°å€ã€ç«¯å£ã€æœ¬åœ°åœ°å€ã€æ–‡ä»¶æè¿°ç¬¦ã€å®¢æˆ·ç«¯åç§°ã€DBã€æ‰§è¡Œå‘½ä»¤ç­‰</td></tr><tr><td><code>entry-id</code></td><td>æ—¥å¿—æ¡ç›® ID</td></tr><tr><td><code>timestamp-created</code></td><td>æ—¥å¿—åˆ›å»ºæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</td></tr><tr><td><code>timestamp-last-updated</code></td><td>æ—¥å¿—æœ€åæ›´æ–°æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</td></tr></tbody></table><h5 id="ACL-GENPASS">ACL GENPASS</h5><ul class="lvl-0"><li class="lvl-2"><p>ç”Ÿæˆä¸€ä¸ªéšæœºçš„ ACL å¯†ç </p></li><li class="lvl-2"><p>ç”Ÿæˆå¤æ‚å¯†ç çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œæ²¡å¿…è¦ç”¨è¿™ç©æ„ã€‚</p></li><li class="lvl-2"><p>è¯¥å‘½ä»¤çš„è¾“å‡ºæ˜¯äºŒè¿›åˆ¶å­—ç¬¦ä¸²çš„åå…­è¿›åˆ¶è¡¨ç¤ºå½¢å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šç”Ÿæˆ 256 ä½ï¼ˆå³ 64 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼‰ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æä¾›ä¸€ä¸ªå‚æ•°æ¥æŒ‡å®šç”Ÿæˆçš„ä½æ•°ï¼ŒèŒƒå›´ä» 1 åˆ° 1024 ä½ï¼Œä»¥æ”¹å˜è¾“å‡ºé•¿åº¦ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰€æä¾›çš„ä½æ•°æ€»æ˜¯ä¼šå‘ä¸Šå–æ•´åˆ° 4 çš„å€æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¯·æ±‚ç”Ÿæˆ 1 ä½å¯†ç ï¼Œå®é™…ä¸Šä¼šç”Ÿæˆ 4 ä½ï¼Œå¹¶ä»¥ å•ä¸ªåå…­è¿›åˆ¶å­—ç¬¦çš„å½¢å¼è¾“å‡ºã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤64ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼Œç›¸å½“äº ACL GENPASS 256</span></span><br><span class="line">&gt; ACL GENPASS</span><br><span class="line"><span class="string">&quot;dd721260bfe1b3d9601e7fbab36de6d04e2e67b0ef1c53de59d45950db0dd3cc&quot;</span></span><br><span class="line"><span class="comment"># æŒ‡å®šé•¿åº¦ï¼Œ32/4 = 8</span></span><br><span class="line">&gt; ACL GENPASS 32</span><br><span class="line"><span class="string">&quot;355ef3dd&quot;</span></span><br><span class="line"><span class="comment"># æŒ‡å®šé•¿åº¦ï¼Œ5 å‘ä¸Šå–4çš„å€æ•°ï¼Œå°±æ˜¯ 8ï¼Œé•¿åº¦å°±æ˜¯ 8/4 = 2</span></span><br><span class="line">&gt; ACL GENPASS 5</span><br><span class="line"><span class="string">&quot;90&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis 7 + ACL ç®€ä»‹&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
    <category term="redis cluster" scheme="https://blog.hanqunfeng.com/tags/redis-cluster/"/>
    
  </entry>
  
  <entry>
    <title>Redis 7 + ACL å•èŠ‚ç‚¹ã€ä¸»ä»ã€å“¨å…µã€é›†ç¾¤æ„å»ºæ–¹æ³•</title>
    <link href="https://blog.hanqunfeng.com/2025/12/05/redis7-config/"/>
    <id>https://blog.hanqunfeng.com/2025/12/05/redis7-config/</id>
    <published>2025-12-05T13:30:05.000Z</published>
    <updated>2025-12-10T02:58:13.541Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2">Redis 7 + ACL å•èŠ‚ç‚¹ã€ä¸»ä»ã€å“¨å…µã€é›†ç¾¤æ„å»ºæ–¹æ³•</li><li class="lvl-2">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code></li><li class="lvl-2">ä¼ ç»Ÿçš„éACLç‰ˆæœ¬ï¼Œå¯ä»¥å‚è€ƒ <a href="/2022/09/09/redis5-config/" title="Rediså•èŠ‚ç‚¹ã€ä¸»ä»ã€å“¨å…µã€é›†ç¾¤æ„å»ºæ–¹æ³•">Rediså•èŠ‚ç‚¹ã€ä¸»ä»ã€å“¨å…µã€é›†ç¾¤æ„å»ºæ–¹æ³•</a></li><li class="lvl-2">Rediså®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></li></ul><span id="more"></span><h2 id="rediså®‰è£…">rediså®‰è£…</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/local/soft</span><br><span class="line">wget https://download.redis.io/releases/redis-7.4.7.tar.gz -P /usr/local/soft</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/soft</span><br><span class="line">tar -zxvf redis-7.4.7.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘</span></span><br><span class="line"><span class="built_in">sudo</span> yum install gcc gcc-c++ -y</span><br><span class="line"><span class="built_in">cd</span> redis-7.4.7</span><br><span class="line"><span class="comment"># ç¼–è¯‘ï¼Œä¼šå°†ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨srcç›®å½•ä¸‹</span></span><br><span class="line">make</span><br><span class="line"><span class="comment"># ç¼–è¯‘å®‰è£…åˆ°æŒ‡å®šç›®å½•ï¼Œredisç›¸å…³å‘½ä»¤ä¼šè¢«å®‰è£…åˆ° $(pwd)/build_dir/binç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">mkdir</span> build_dir</span><br><span class="line">make install PREFIX=$(<span class="built_in">pwd</span>)/build_dir</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œä¸å»ºè®®åœ¨åŸæœ‰é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cp</span> redis.conf redis-6379.conf</span><br><span class="line">vim redis-6379.conf <span class="comment">#è§ä¸‹é¢çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å…¥ç¯å¢ƒå˜é‡ /etc/bashrcï¼Œæ³¨æ„è¿™é‡Œè¦æ˜¯å•å¼•å·ï¼Œå¦åˆ™ $PATH ä¼šè¢«è§£æ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PATH=$PATH:/usr/local/soft/redis-7.4.7/build_dir/bin&#x27;</span> &gt;&gt; /etc/bashrc</span><br><span class="line"><span class="built_in">source</span> /etc/bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯</span></span><br><span class="line">redis-cli --version</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">redis-cli 7.4.7</span><br></pre></td></tr></table></figure><h2 id="å•èŠ‚ç‚¹">å•èŠ‚ç‚¹</h2><ul class="lvl-0"><li class="lvl-2"><p><code>redis-6379.conf</code> çš„ä¸»è¦é…ç½®</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç«¯å£ï¼Œé»˜è®¤ 6379</span></span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"><span class="comment"># åå°å¯åŠ¨ï¼Œé»˜è®¤ no</span></span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># yes: å½“æ²¡æœ‰ bind / requirepass / ACL æ—¶ï¼Œåªå…è®¸æœ¬æœºè®¿é—®</span></span><br><span class="line"><span class="comment"># no: å…è®¸ä»»æ„è®¿é—®</span></span><br><span class="line"><span class="comment"># è¿™é‡Œä¼šå¯ç”¨ACLï¼Œæ‰€ä»¥è®¾ç½®ä¸º yesï¼Œé»˜è®¤ yes</span></span><br><span class="line">protected-mode <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨é‡Šæ‰bindï¼Œç»‘å®šçš„æ˜¯è‡ªå·±æœºå™¨ç½‘å¡çš„ipï¼Œå¦‚æœæœ‰å¤šå—ç½‘å¡å¯ä»¥é…å¤šä¸ªip,ä»£è¡¨å…è®¸å®¢æˆ·ç«¯é€šè¿‡æœºå™¨çš„å“ªäº›ç½‘å¡ipå»è®¿é—®ï¼Œå†…ç½‘ä¸€èˆ¬å¯ä»¥ä¸é…ç½®</span></span><br><span class="line"><span class="comment">#bind 127.0.0.1</span></span><br><span class="line"><span class="comment"># å¯ä»¥é…ç½®ä¸ºï¼Œæœ¬æœºIP å†…ç½‘IP å¤–ç½‘IP</span></span><br><span class="line"><span class="comment"># bind 127.0.0.1 10.250.0.103 18.163.188.20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­rdbå¿«ç…§ï¼Œå› ä¸ºä¼šå¯ç”¨æ··åˆæŒä¹…åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œä¸éœ€è¦å¼€å¯rdbå¿«ç…§</span></span><br><span class="line"><span class="comment"># è¿™é‡Œåªæ˜¯å…³é—­äº†è‡ªåŠ¨å¿«ç…§ï¼Œå¦‚æœæ‰‹åŠ¨æ‰§è¡Œäº† bgsave å‘½ä»¤ï¼Œè¿˜æ˜¯ä¼šç”Ÿæˆä¸€ä¸ª dump.rdb æ–‡ä»¶</span></span><br><span class="line">save <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®dirè·¯å¾„ï¼Œredisæ—¥å¿—ã€aofå’Œrdbæ–‡ä»¶éƒ½ä¼šç”Ÿæˆåœ¨è¿™ä¸ªè·¯å¾„ä¸‹ï¼Œéœ€è¦æå‰åˆ›å»ºå¥½è¿™ä¸ªç›®å½•</span></span><br><span class="line"><span class="built_in">dir</span> /usr/local/soft/dir-redis7/6379</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯aofï¼Œå®é™…ä¸Šåªéœ€è¦å¼€å¯è¿™ä¸ªé…ç½®ï¼Œä»¥ä¸‹aofç›¸å…³é…ç½®é»˜è®¤å³å¯ï¼Œé»˜è®¤ no</span></span><br><span class="line"><span class="comment"># å¼€å¯aofï¼Œé‡å¯redisæ—¶ï¼Œä¼šä¸»åŠ¨åŠ è½½ appendonlydir ä¸‹çš„ ç›¸å…³ aofæ–‡ä»¶è¿›è¡Œæ•°æ®æ¢å¤</span></span><br><span class="line"><span class="comment"># ç”Ÿæˆç¯å¢ƒå¿…é¡»å¼€å¯</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># aofæ–‡ä»¶åç§°ï¼Œé»˜è®¤ appendonly.aof</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line"><span class="comment"># aofæ–‡ä»¶ä¿å­˜ç›®å½•ï¼ŒåŸºäºä¸ºå½“å‰dirè·¯å¾„ï¼Œé»˜è®¤å€¼å°±æ˜¯ appendonlydir</span></span><br><span class="line"><span class="comment"># redis6+ä¼šç”Ÿæˆ3ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ä»¥ appendfilename é…ç½®çš„æ–‡ä»¶åç§°å¼€å¤´ï¼Œå¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># appendonly.aof.N.base.rdbï¼šæ¯æ¬¡è§¦å‘aofé‡å†™æ—¶éƒ½ä¼šç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ï¼ŒNæ˜¯å½“å‰aofæ–‡ä»¶åºå·ï¼Œbase.rdbæ˜¯å½“å‰rdbæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># appendonly.aof.N.incr.aofï¼šè®°å½•æ¯ä¸ªå†™æ“ä½œå‘½ä»¤</span></span><br><span class="line"><span class="comment"># appendonly.aof.manifestï¼šè®°å½• base.rdb å’Œ incr.aof æ–‡ä»¶çš„æœ€æ–°ç´¢å¼•(N)</span></span><br><span class="line">appenddirname <span class="string">&quot;appendonlydir&quot;</span></span><br><span class="line"><span class="comment"># aofå°†æ•°æ®fsyncåˆ°ç£ç›˜çš„ç­–ç•¥ï¼Œé»˜è®¤å³å¯ï¼Œè¡¨ç¤ºæ¯ç§’ä¸€æ¬¡ï¼Œæ•…éšœæ—¶æœ€å¤šä¼šä¸¢å¤±ä¸€ç§’çš„æ•°æ®ï¼Œé»˜è®¤ everysec</span></span><br><span class="line">appendfsync everysec</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªåŠ¨è§¦å‘aofé‡å†™éœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼Œå¦‚æœéœ€è¦æ‰‹åŠ¨è§¦å‘aofé‡å†™ï¼Œå¯ä»¥æ‰§è¡Œ BGREWRITEAOF å‘½ä»¤</span></span><br><span class="line"><span class="comment"># é‡å†™æ—¶ä¼šåˆ é™¤æ—§çš„ appendonly.aof.N.base.rdb(RDB å¿«ç…§) æ–‡ä»¶ï¼Œç”Ÿæˆæ–°çš„ appendonly.aof.N+1.base.rdb</span></span><br><span class="line"><span class="comment"># å½“ AOF é‡å†™å®Œæˆåï¼Œå½“å‰çš„ appendonly.aof.N.incr.aof ä¼šå°å­˜ï¼ŒRedis ä¼šæ–°å»ºä¸€ä¸ª appendonly.aof.N+1.incr.aof æ¥ç»§ç»­è®°å½•å†™å‘½ä»¤</span></span><br><span class="line"><span class="comment"># è€Œæ­¤æ—¶ appendonly.aof.manifest(ç´¢å¼•æ–‡ä»¶) ä¹Ÿä¼šè®°å½•æœ€æ–°çš„ appendonly.aof.N.incr.aof å’Œ appendonly.aof.N.base.rdb</span></span><br><span class="line"><span class="comment"># aofæ–‡ä»¶è‡³å°‘è¦è¾¾åˆ°64Mæ‰ä¼šè‡ªåŠ¨é‡å†™ï¼Œæ–‡ä»¶å¤ªå°æ¢å¤é€Ÿåº¦æœ¬æ¥å°±å¾ˆå¿«ï¼Œé‡å†™çš„æ„ä¹‰ä¸å¤§ï¼Œé»˜è®¤å³å¯ï¼Œé»˜è®¤ 64mb</span></span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"><span class="comment"># aofæ–‡ä»¶è‡ªä¸Šä¸€æ¬¡é‡å†™åæ–‡ä»¶å¤§å°å¢é•¿äº†100%åˆ™å†æ¬¡è§¦å‘é‡å†™ï¼Œé»˜è®¤ 100</span></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯æ··åˆæŒä¹…åŒ–ï¼Œ4.0ä»¥åç‰ˆæœ¬æ”¯æŒï¼Œéœ€è¦å…ˆå¼€å¯aofï¼Œé»˜è®¤ yes</span></span><br><span class="line"><span class="comment"># å¼€å¯æ··åˆæŒä¹…åŒ–åï¼Œappendonly.aof.N.base.rdb çš„æ–‡ä»¶åç¼€å°±æ˜¯ rdbï¼Œå¦åˆ™æ˜¯ aof</span></span><br><span class="line">aof-use-rdb-preamble <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># é˜²æ­¢ AOF æ„å¤–æˆªæ–­å¯¼è‡´ Redis èµ·ä¸æ¥ï¼Œé»˜è®¤ yes</span></span><br><span class="line">aof-load-truncated <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pidæ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤ /var/run/redis_6379.pid</span></span><br><span class="line">pidfile <span class="string">&quot;redis_6379.pid&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—æ–‡ä»¶åç§°ï¼Œé»˜è®¤ &quot;&quot;</span></span><br><span class="line">logfile <span class="string">&quot;6379.log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæœ€å¤§å†…å­˜ï¼Œå•ä½bytesï¼Œè¿™é‡Œè®¾ç½®4G</span></span><br><span class="line"><span class="comment"># å¦‚æœä¸è®¾ç½®æœ€å¤§å†…å­˜ï¼Œredisä¼šé»˜è®¤ä¸ºç‰©ç†å†…å­˜ï¼Œè¾¾åˆ°ä¸Šé™æ—¶ä¼šé¢‘ç¹ä¸ç£ç›˜å‘ç”Ÿäº¤æ¢ï¼Œä½¿redisæ€§èƒ½æ€¥å‰§ä¸‹é™</span></span><br><span class="line">maxmemory 4294967296</span><br><span class="line"><span class="comment"># è¾¾åˆ°æœ€å¤§å†…å­˜æ—¶çš„æ¸…é™¤ç­–ç•¥ï¼Œæ¨è allkeys-lruï¼Œæ·˜æ±°å¾ˆä¹…æ²¡è¢«è®¿é—®è¿‡çš„æ•°æ®ï¼ŒåŸºäºæœ€è¿‘ä¸€æ¬¡çš„è®¿é—®æ—¶é—´</span></span><br><span class="line"><span class="comment"># volatile-lru: åªä¼šæ·˜æ±°ã€Œè®¾ç½®äº†è¿‡æœŸæ—¶é—´ã€çš„ key</span></span><br><span class="line"><span class="comment"># allkeys-lru: æ·˜æ±°æœ€ä¹…æ²¡æœ‰è¢«è®¿é—®è¿‡çš„æ•°æ®ï¼Œæœ€è¿‘æœ€ä¹…æ²¡è¢«è®¿é—®çš„</span></span><br><span class="line"><span class="comment"># allkeys-lfu: æ·˜æ±°æœ€ä¸ç»å¸¸è¢«è®¿é—®è¿‡çš„æ•°æ®ï¼Œè®¿é—®æ¬¡æ•°æœ€å°‘çš„</span></span><br><span class="line"><span class="comment"># noeviction: ä¸æ·˜æ±°ï¼Œé»˜è®¤</span></span><br><span class="line">maxmemory-policy allkeys-lru</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ…¢æŸ¥è¯¢æ—¥å¿—</span></span><br><span class="line"><span class="comment"># å•ä½å¾®å¦™ï¼Œè¿™é‡Œè¡¨ç¤º10æ¯«ç§’ï¼Œå³è¶…è¿‡10æ¯«ç§’çš„æ“ä½œéƒ½ä¼šè®°å½•ä¸‹æ¥</span></span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•ä¿å­˜æ•°é‡ï¼Œå¦‚æœæ•°é‡å·²æ»¡ä¼šåˆ é™¤æœ€æ—©çš„è®°å½•</span></span><br><span class="line">slowlog-max-len 1024</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€§èƒ½ä¼˜åŒ–</span></span><br><span class="line"><span class="comment"># Redis ç”¨å¤šå°‘é™„åŠ çº¿ç¨‹æ¥å¤„ç†ç½‘ç»œ I/Oï¼ˆä¸æ˜¯æ‰§è¡Œå‘½ä»¤ï¼‰ï¼Œæ¨èï¼šæ ¸å¿ƒæ•° / 2ï¼Œé»˜è®¤ä¸º1ï¼Œè¶…è¿‡ 8 å‡ ä¹å°±æ²¡æœ‰æ˜æ˜¾æ”¶ç›Šäº†</span></span><br><span class="line">io-threads 4</span><br><span class="line"><span class="comment"># å¤šçº¿ç¨‹åŒæ—¶ç”¨äº è¯»å– + å†™å›ï¼Œ no ï¼šå¤šçº¿ç¨‹ä»…ç”¨äº å†™å›å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment"># æ¨è&gt;=4æ ¸æ‰å¼€å¯ï¼Œå¦åˆ™å¼€äº†åè€Œæ›´æ…¢</span></span><br><span class="line">io-threads-do-reads <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># æ“ä½œç³»ç»Ÿ TCP å±‚çš„å¥åº·æ£€æµ‹ï¼Œé»˜è®¤å€¼300ï¼Œè¿™é‡Œå¦‚æœ 60 ç§’å†…æ²¡æœ‰æ•°æ®æµåŠ¨ï¼Œå†…æ ¸ä¼šå‘é€æ¢æµ‹åŒ…ï¼Œåˆ¤æ–­è¿æ¥æ˜¯å¦æ´»ç€</span></span><br><span class="line">tcp-keepalive 60</span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯åœ¨ &quot;å¤šå°‘ç§’ä¸æ“ä½œ&quot; å°±å¼ºåˆ¶æ–­å¼€ï¼Œ0ï¼šæ°¸ä¸è¶…æ—¶ï¼ˆæ¨èï¼‰,é»˜è®¤ 0</span></span><br><span class="line"><span class="comment"># å› ä¸ºæœ‰ tcp-keepalive 60ï¼Œä¼šæ¯ 60 ç§’æ£€æµ‹ä¸€ä¸‹å¯¹é¢è¿˜åœ¨ä¸åœ¨ï¼Œå¦‚æœä¸åœ¨ï¼ŒRedis ä¼šä¸»åŠ¨æ–­å¼€è¯¥è¿æ¥ï¼Œæ‰€ä»¥ä¸ä¼šå¯¼è‡´è¿æ¥æ°¸ä¸é‡Šæ”¾</span></span><br><span class="line"><span class="built_in">timeout</span> 0</span><br><span class="line"><span class="comment"># æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤ 10000</span></span><br><span class="line">maxclients 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦ç”¨å±é™©å‘½ä»¤ï¼Œæ ¹æ®éœ€è¦è‡ªè¡Œæ·»åŠ ï¼Œredis6+ æ”¯æŒåœ¨ acl æ–‡ä»¶ä¸­ä¸ºä¸åŒçš„ç”¨æˆ·ç¦ç”¨å±é™©å‘½ä»¤</span></span><br><span class="line">rename-command FLUSHALL <span class="string">&quot;&quot;</span></span><br><span class="line">rename-command FLUSHDB <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># rename-command SHUTDOWN &quot;&quot;</span></span><br><span class="line"><span class="comment"># rename-command CONFIG &quot;&quot;</span></span><br><span class="line"><span class="comment"># rename-command KEYS &quot;&quot;</span></span><br><span class="line"><span class="comment"># rename-command SAVE &quot;&quot;</span></span><br><span class="line"><span class="comment"># rename-command BGSAVE &quot;&quot;</span></span><br><span class="line"><span class="comment"># rename-command DEBUG &quot;&quot;</span></span><br><span class="line"><span class="comment"># rename-command EVAL &quot;&quot;</span></span><br><span class="line"><span class="comment"># rename-command SCRIPT &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Redis åœ¨å†…éƒ¨å­˜åœ¨å¤§é‡â€œéšå¼åˆ é™¤â€åœºæ™¯ï¼ˆè¿‡æœŸã€è¦†ç›–å†™ã€evictionã€renameã€replication flush ç­‰ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›åˆ é™¤éƒ½æ˜¯åŒæ­¥é˜»å¡çš„ï¼ˆç±»ä¼¼ DELï¼‰ï¼Œå¯èƒ½å¯¼è‡´ä¸»çº¿ç¨‹å¡é¡¿ã€‚Lazy Freeing æœºåˆ¶å…è®¸ Redis åœ¨åå°çº¿ç¨‹ä¸­é‡Šæ”¾å¤§å¯¹è±¡çš„å†…å­˜ï¼ˆç±»ä¼¼ UNLINKï¼‰ï¼Œä»è€Œå‡å°‘é˜»å¡ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å¯ç”¨ maxmemory + eviction ç­–ç•¥ï¼ˆå¦‚ allkeys-lruã€volatile-ttlï¼‰æ—¶ï¼Œè¢«æ·˜æ±°çš„ key æ˜¯å¦é‡‡ç”¨å¼‚æ­¥é‡Šæ”¾ï¼ˆåå°çº¿ç¨‹ UNLINK æ¨¡å¼ï¼‰ã€‚é€‚ç”¨åœºæ™¯ï¼šé«˜ååã€é«˜å¹¶å‘ã€å¤§å¯¹è±¡ï¼ˆå¦‚å¤§å‹ hashã€setã€zsetã€åˆ—è¡¨ï¼‰åœºæ™¯æ‰æ˜æ˜¾å—ç›Šã€‚</span></span><br><span class="line">lazyfree-lazy-eviction <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># å½“ key åˆ°æœŸï¼ˆEXPIRE è§¦å‘åˆ é™¤ï¼‰æ—¶ï¼Œæ˜¯å¦å¼‚æ­¥é‡Šæ”¾å…¶ Valueã€‚å„ç§ä½¿ç”¨å¸¦ TTL çš„ç¼“å­˜ç³»ç»Ÿï¼Œå°¤å…¶ value æ˜¯å¤§å‹å¯¹è±¡ï¼ˆJSONã€å¤§ Setã€Hash ç­‰ï¼‰ã€‚è¿‡æœŸ key æ•°é‡å¤§ã€å¯¹è±¡ç»“æ„å¤§æ—¶ï¼Œæ¨èå¼€å¯ã€‚</span></span><br><span class="line">lazyfree-lazy-expire <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># é’ˆå¯¹â€œæœåŠ¡å™¨å†…éƒ¨å› å‘½ä»¤å‰¯ä½œç”¨å¯¼è‡´çš„åˆ é™¤æ“ä½œâ€æ˜¯å¦å¼‚æ­¥é‡Šæ”¾ï¼Œä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="comment">#    RENAME æ›¿æ¢æ—§ key æ—¶åˆ é™¤æ—§ value</span></span><br><span class="line"><span class="comment">#    SET æ“ä½œè¦†ç›–æ—§å€¼æ—¶åˆ é™¤æ—§ value</span></span><br><span class="line"><span class="comment">#    SUNIONSTORE / SORT STORE è¦†ç›–ç›®æ ‡ key æ—¶åˆ é™¤æ—§ value</span></span><br><span class="line"><span class="comment">#    é‡å†™å‡½æ•°ã€è„šæœ¬æ—¶åˆ é™¤æ—§å¯¹è±¡</span></span><br><span class="line"><span class="comment"># é€‚ç”¨åœºæ™¯ï¼šå¯¹è±¡ç‰¹åˆ«å¤§ï¼Œä¸”å­˜åœ¨è¦†ç›–å†™ã€rename æ“ä½œé¢‘ç¹çš„åº”ç”¨ã€‚</span></span><br><span class="line">lazyfree-lazy-server-del <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># å½“å‰¯æœ¬ï¼ˆReplica/Slaveï¼‰å› å…¨é‡åŒæ­¥è€Œæ‰§è¡Œ FLUSHDB æ—¶ï¼Œæ˜¯å¦å¼‚æ­¥é‡Šæ”¾åŸæœ‰æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment"># æ­¤é…ç½®åªå½±å“å‰¯æœ¬ä¸ä¼šå½±å“ä¸»èŠ‚ç‚¹ã€‚</span></span><br><span class="line">replica-lazy-flush <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># è®©ç”¨æˆ·æ‰§è¡Œ DEL æ—¶ä¹Ÿè‡ªåŠ¨ä½¿ç”¨å¼‚æ­¥é‡Šæ”¾ï¼ˆç­‰ä»·äºé»˜è®¤æŠŠ DEL è½¬æ¢ä¸º UNLINKï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># ä»£ç ä¸­å¤§é‡ä½¿ç”¨ DEL åˆ é™¤å¤§å¯¹è±¡åˆä¸æ–¹ä¾¿ç»Ÿä¸€æ”¹æˆ UNLINK æ—¶ã€‚</span></span><br><span class="line"><span class="comment"># ä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒæˆ‘ä»¬å€¾å‘ä¿æŒæ˜¾å¼çš„è¯­ä¹‰ï¼ˆDEL/UNLINKï¼‰ï¼Œä¸å»ºè®®è½»æ˜“æ”¹å†™ DEL è¡Œä¸ºã€‚</span></span><br><span class="line">lazyfree-lazy-user-del no</span><br><span class="line"><span class="comment"># FLUSHDB / FLUSHALL / SCRIPT FLUSH / FUNCTION FLUSH åœ¨æœªæ˜¾å¼æŒ‡å®š SYNC/ASYNC æ—¶æ˜¯å¦å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># å¤§éƒ¨åˆ†æƒ…å†µä¸‹å»ºè®®ä¿æŒ noï¼Œç”±åº”ç”¨å†³å®šæ˜¯å¦ç”¨ FLUSHDB ASYNCã€‚</span></span><br><span class="line">lazyfree-lazy-user-flush no</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯ ACL æ–‡ä»¶</span></span><br><span class="line">aclfile /usr/local/soft/redis-7.4.7/users.acl</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Redis 7 æ”¯æŒçš„æ·˜æ±°ç­–ç•¥</p></li></ul><table><thead><tr><th>ç­–ç•¥</th><th>æ˜¯å¦åªæ·˜æ±°å¸¦ TTL çš„ key</th><th>æ·˜æ±°è§„åˆ™</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>noeviction</strong></td><td>âŒ ä¸æ·˜æ±°</td><td>ä¸åˆ ä»»ä½• key</td><td>å†…å­˜æ»¡äº†ç›´æ¥è¿”å›é”™è¯¯ï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td><strong>allkeys-lru</strong></td><td>âŒ æ‰€æœ‰ key</td><td>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨</td><td>âœ… æœ€å¸¸ç”¨</td></tr><tr><td><strong>allkeys-lfu</strong></td><td>âŒ æ‰€æœ‰ key</td><td>è®¿é—®é¢‘ç‡æœ€å°‘</td><td>âœ… çƒ­ç‚¹åœºæ™¯æœ€å¥½</td></tr><tr><td><strong>allkeys-random</strong></td><td>âŒ æ‰€æœ‰ key</td><td>éšæœºåˆ é™¤</td><td>âŒ å¾ˆå°‘ç”¨</td></tr><tr><td><strong>volatile-lru</strong></td><td>âœ… åªæ·˜æ±°æœ‰ TTL çš„</td><td>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨</td><td>ä½ ä¹‹å‰ç”¨çš„</td></tr><tr><td><strong>volatile-lfu</strong></td><td>âœ… åªæ·˜æ±°æœ‰ TTL çš„</td><td>è®¿é—®é¢‘ç‡æœ€å°‘</td><td>è¾ƒå°‘ä½¿ç”¨</td></tr><tr><td><strong>volatile-random</strong></td><td>âœ… åªæ·˜æ±°æœ‰ TTL çš„</td><td>éšæœºåˆ é™¤</td><td>å¾ˆå°‘ç”¨</td></tr><tr><td><strong>volatile-ttl</strong></td><td>âœ… åªæ·˜æ±°æœ‰ TTL çš„</td><td>TTL æœ€å°ï¼ˆé©¬ä¸Šè¿‡æœŸçš„ï¼‰</td><td>ç‰¹æ®Šåœºæ™¯ç”¨</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p><code>users.acl</code> æ–‡ä»¶: è¯¥æ–‡ä»¶ä¸æ”¯æŒæ·»åŠ æ³¨é‡Šï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶éœ€è¦å»æ‰å¦‚ä¸‹æ³¨é‡Šè¡Œï¼Œå…³äºACLçš„è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒ <a href="/2025/12/07/redis7-acl/" title="Redis 7 + ACL ç®€ä»‹">Redis 7 + ACL ç®€ä»‹</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­é»˜è®¤ç”¨æˆ·ï¼Œç¦æ­¢åŒ¿åè®¿é—®</span></span><br><span class="line">user default off</span><br><span class="line"><span class="comment"># è¶…çº§ç®¡ç†å‘˜</span></span><br><span class="line">user admin on ~* &amp;* +@all &gt;123456</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>redis æœåŠ¡å¯åŠ¨ä¸å…³é—­</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line">redis-server redis-6379.conf</span><br><span class="line"><span class="comment"># ç™»å½•æœåŠ¡ï¼Œæœ¬æœºè®¿é—®å¯ä»¥çœç•¥ -h -p</span></span><br><span class="line">redis-cli -h 127.0.0.1 -p 6379 --user admin --pass 123456</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">redis-cli -u redis://admin:123456@127.0.0.1:6379</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æœåŠ¡</span></span><br><span class="line"><span class="comment"># shutdown == shutdown save</span></span><br><span class="line">redis-cli -u redis://admin:123456@127.0.0.1:6379 shutdown</span><br><span class="line"><span class="comment"># å…³é—­æœåŠ¡ï¼Œä¸ä¿å­˜æ•°æ®ï¼Œå·²ç»å¼€äº† AOFï¼ˆå°¤å…¶æ˜¯ everysec) çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥</span></span><br><span class="line">redis-cli -u redis://admin:123456@127.0.0.1:6379 shutdown nosave</span><br></pre></td></tr></table></figure><table><thead><tr><th>åœºæ™¯</th><th>æ¨èå‘½ä»¤</th></tr></thead><tbody><tr><td>æ­£å¸¸ä¸‹çº¿ï¼ˆç”Ÿäº§ï¼‰</td><td><code>shutdown nosave</code></td></tr><tr><td>å·²å¼€ AOF</td><td><code>shutdown nosave</code></td></tr><tr><td>æ•°æ®å¾ˆå¤§</td><td><code>shutdown nosave</code></td></tr><tr><td>å•æœºè°ƒè¯•</td><td><code>shutdown</code></td></tr><tr><td>ç¡®å®šè¦ç”Ÿæˆå¿«ç…§</td><td><code>shutdown save</code></td></tr><tr><td>å¼ºåˆ¶æ€æ­»(rediså¡æ­»)</td><td><code>kill -9</code>ï¼ˆæç«¯æƒ…å†µï¼‰</td></tr></tbody></table><h3 id="å•èŠ‚ç‚¹ä¼˜ç‚¹">å•èŠ‚ç‚¹ä¼˜ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>å•æœºéƒ¨ç½²ç®€å•æ–¹ä¾¿</p></li></ul><h3 id="å•èŠ‚ç‚¹ç¼ºç‚¹">å•èŠ‚ç‚¹ç¼ºç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸ä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œä¸é€‚ç”¨äºæ•°æ®å¯é æ€§è¦æ±‚é«˜çš„åœºæ™¯</p></li><li class="lvl-2"><p>å•ç‚¹æ•…éšœå¯¼è‡´æ— æ³•æä¾›æœåŠ¡ï¼Œæˆ–è€…ç¡¬ç›˜æŸåå¯¼è‡´æ•°æ®ä¸¢å¤±</p></li><li class="lvl-2"><p>rediså•èŠ‚ç‚¹æœ€å¤§qpsä¸º10w(å–å†³äºå•æ ¸cpuçš„å¤„ç†èƒ½åŠ›)ï¼Œè¶…è¿‡è¿™ä¸ªqpså°±éœ€è¦åšå‰ç«¯é™æµ</p></li></ul><h2 id="ä¸»ä»">ä¸»ä»</h2><ul class="lvl-0"><li class="lvl-2"><p>è§„åˆ’</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">master 10.250.0.235</span><br><span class="line">slave1 10.250.0.58</span><br><span class="line">slave2 10.250.0.36</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸»ä»é…ç½®æ—¶ï¼Œä¸»èŠ‚ç‚¹ä¸éœ€è¦åšä»»ä½•ä¿®æ”¹</p></li><li class="lvl-2"><p>ä»èŠ‚ç‚¹é…ç½®æ–‡ä»¶å¢åŠ åŒæ­¥ä¸»èŠ‚ç‚¹ä¿¡æ¯ï¼Œå…¶ä½™é…ç½®ä¸ä¸»èŠ‚ç‚¹ç›¸åŒ</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šä¸»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹ä¼šä»ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œè¿™é‡Œ10.250.0.235 6379æ˜¯ä¸»èŠ‚ç‚¹çš„ipå’Œç«¯å£å·</span></span><br><span class="line">replicaof 10.250.0.235 6379</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ä»èŠ‚ç‚¹åªè¯»ï¼Œé»˜è®¤å¼€å¯ï¼Œé¿å…æ•°æ®å†™å…¥ä»èŠ‚ç‚¹å¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´</span></span><br><span class="line">replica-read-only <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœä¸»èŠ‚ç‚¹å¼€å¯äº†ACLè®¤è¯ï¼Œåˆ™ä»èŠ‚ç‚¹éœ€è¦è®¾ç½®ä¸»èŠ‚ç‚¹çš„è®¤è¯ä¿¡æ¯ï¼Œè¿™é‡Œè®¾ç½®ä¸ºç®¡ç†å‘˜å¸å·</span></span><br><span class="line">masteruser admin</span><br><span class="line">masterauth 123456</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶å¯åŠ¨ä»èŠ‚ç‚¹<code>redis-server redis-6379.conf</code>ï¼Œä¼šè‡ªåŠ¨ä»ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼ŒåŒæ­¥å‰å¦‚æœä»èŠ‚ç‚¹å·²ç»æœ‰æ•°æ®ï¼Œåˆ™ä¼šå…ˆæ¸…é™¤åŸæœ‰æ•°æ®å†è¿›è¡ŒåŒæ­¥</p></li><li class="lvl-2"><p>ä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°ä»èŠ‚ç‚¹çš„åŒæ­¥è¯·æ±‚åï¼Œä¼šé€šè¿‡bgsaveå°†å†…å­˜æ•°æ®dumpåˆ°rdbæ–‡ä»¶ä¸­å¹¶ä¼ é€’ç»™ä»èŠ‚ç‚¹</p></li><li class="lvl-2"><p>ä¸»èŠ‚ç‚¹ç”Ÿæˆrdbæ–‡ä»¶å¹¶ä¼ é€’ç»™ä»èŠ‚ç‚¹æœŸé—´ä¼šç»§ç»­å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å°†è¿™éƒ¨åˆ†æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå¾…ä»èŠ‚ç‚¹æ¥æ”¶åˆ°ä¸»èŠ‚ç‚¹å‘è¿‡æ¥çš„rdbæ–‡ä»¶å¹¶å®Œæˆå†…å­˜åŠ è½½åï¼Œä¸»èŠ‚ç‚¹ä¼šå°†è¿™éƒ¨åˆ†ç¼“å­˜åœ¨å†…å­˜ä¸­çš„æ•°æ®å‘é€ç»™ä»èŠ‚ç‚¹</p></li><li class="lvl-2"><p>ä»èŠ‚ç‚¹ç›¸å½“äºä¸»èŠ‚ç‚¹çš„å¤‡ä»½ï¼Œä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œä»èŠ‚ç‚¹ä¸èƒ½è‡ªåŠ¨åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¦‚æœéœ€è¦è‡ªåŠ¨åˆ‡æ¢ï¼Œå¯ä»¥ä½¿ç”¨å“¨å…µæˆ–è€…é›†ç¾¤éƒ¨ç½²æ–¹å¼</p></li><li class="lvl-2"><p>æ­¤æ—¶ç™»å½•masterçš„rediså¹¶æ‰§è¡Œ<code>info replication</code>å‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master     <span class="comment"># è¡¨ç¤ºå½“å‰æ˜¯ä»èŠ‚ç‚¹</span></span><br><span class="line">connected_slaves:1 <span class="comment"># ä»èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">slave0:ip=10.250.0.36,port=6379,state=online,offset=56,lag=1 <span class="comment"># ä»èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">master_failover_state:no-failover <span class="comment"># ä¸»èŠ‚ç‚¹åˆ‡æ¢çŠ¶æ€ï¼Œæ— </span></span><br><span class="line">master_replid:93e564c18d27418e52fc40254c764d76c1dc3f67 <span class="comment"># ä¸»èŠ‚ç‚¹çš„å¤åˆ¶ID</span></span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:56  <span class="comment"># ä¸»èŠ‚ç‚¹å¤åˆ¶çš„åç§»é‡</span></span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1  <span class="comment"># æ˜¯å¦å¼€å¯å¤åˆ¶å›æ”¾</span></span><br><span class="line">repl_backlog_size:1048576 <span class="comment"># å¤åˆ¶å›æ”¾ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">repl_backlog_first_byte_offset:1 <span class="comment"># å¤åˆ¶å›æ”¾ç¼“å†²åŒºç¬¬ä¸€ä¸ªå­—èŠ‚çš„åç§»é‡</span></span><br><span class="line">repl_backlog_histlen:56 <span class="comment"># å¤åˆ¶å›æ”¾ç¼“å†²åŒºå†å²é•¿åº¦</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶ç™»å½•ä»èŠ‚ç‚¹çš„rediså¹¶æ‰§è¡Œ<code>info replication</code>å‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave               <span class="comment"># è¡¨ç¤ºå½“å‰æ˜¯ä»èŠ‚ç‚¹</span></span><br><span class="line">master_host:10.250.0.235 <span class="comment"># ä¸»èŠ‚ç‚¹çš„ip</span></span><br><span class="line">master_port:6379         <span class="comment"># ä¸»èŠ‚ç‚¹çš„ç«¯å£</span></span><br><span class="line">master_link_status:up    <span class="comment"># ä¸»ä»èŠ‚ç‚¹è¿æ¥çŠ¶æ€ï¼Œup è¡¨ç¤ºå·²ç»è¿æ¥ä¸Šä¸»èŠ‚ç‚¹</span></span><br><span class="line">master_last_io_seconds_ago:6 <span class="comment"># ä¸»ä»èŠ‚ç‚¹æœ€åä¸€æ¬¡ioæ“ä½œæ—¶é—´</span></span><br><span class="line">master_sync_in_progress:0 <span class="comment"># ä¸»ä»èŠ‚ç‚¹æ˜¯å¦æ­£åœ¨åŒæ­¥æ•°æ®ï¼Œ0è¡¨ç¤ºå·²å®Œæˆ</span></span><br><span class="line">slave_read_repl_offset:112 <span class="comment"># ä»èŠ‚ç‚¹å·²ç»è¯»å–çš„å¤åˆ¶åç§»é‡</span></span><br><span class="line">slave_repl_offset:112   <span class="comment"># ä»èŠ‚ç‚¹å·²ç»å†™å…¥çš„å¤åˆ¶åç§»é‡</span></span><br><span class="line">slave_priority:100      <span class="comment"># ä»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§</span></span><br><span class="line">slave_read_only:1       <span class="comment"># ä»èŠ‚ç‚¹æ˜¯å¦åªè¯»</span></span><br><span class="line">replica_announced:1     <span class="comment"># ä»èŠ‚ç‚¹æ˜¯å¦è¢«å…¶ä»–èŠ‚ç‚¹æ‰€ä»£ç†</span></span><br><span class="line">connected_slaves:0      <span class="comment"># ä»èŠ‚ç‚¹æ‰€ä»£ç†çš„ä»èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">master_failover_state:no-failover <span class="comment"># ä¸»èŠ‚ç‚¹çš„æ•…éšœè½¬ç§»çŠ¶æ€ï¼Œno-failoverè¡¨ç¤ºæ²¡æœ‰è¿›è¡Œæ•…éšœè½¬ç§»</span></span><br><span class="line">master_replid:93e564c18d27418e52fc40254c764d76c1dc3f67 <span class="comment"># ä¸»èŠ‚ç‚¹çš„å¤åˆ¶ID</span></span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:112  <span class="comment"># ä¸»èŠ‚ç‚¹å·²ç»å†™å…¥çš„å¤åˆ¶åç§»é‡ slave_read_repl_offset â‰ˆ master_repl_offsetï¼Œè¯´æ˜æ•°æ®å·²ç»åŒæ­¥</span></span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:15</span><br><span class="line">repl_backlog_histlen:98</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸»ä»æ•°æ®åŒæ­¥æ˜¯å¦å®Œæˆåˆ¤æ–­è§„åˆ™ï¼Œåœ¨ä»èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤<code>info replication</code></p></li></ul><table><thead><tr><th>å­—æ®µ</th><th>æ­£å¸¸å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>role</code></td><td>slave</td><td>è¡¨ç¤ºå½“å‰æ˜¯ä»èŠ‚ç‚¹</td></tr><tr><td><code>master_link_status</code></td><td>up</td><td>è¡¨ç¤ºå·²ç»è¿ä¸Šä¸»åº“</td></tr><tr><td><code>master_sync_in_progress</code></td><td>0</td><td>åŒæ­¥ä¸åœ¨è¿›è¡Œä¸­ = å·²å®Œæˆ</td></tr><tr><td><code>slave_read_repl_offset</code> â‰ˆ <code>master_repl_offset</code></td><td>æ¥è¿‘</td><td>è¯´æ˜æ•°æ®å·²è¿½ä¸Š</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å‚ç…§ä¸Šé¢çš„é…ç½®ï¼Œå†æ·»åŠ ä¸€ä¸ªä»èŠ‚ç‚¹åï¼Œåœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤ <code>info replication</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2  <span class="comment"># ä»èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">slave0:ip=10.250.0.36,port=6379,state=online,offset=4313,lag=0</span><br><span class="line">slave1:ip=10.250.0.58,port=6379,state=online,offset=4313,lag=0  <span class="comment"># ç¬¬äºŒä¸ªä»èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:93e564c18d27418e52fc40254c764d76c1dc3f67</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:4313</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:4313</span><br></pre></td></tr></table></figure><h3 id="ä¸»ä»ä¼˜ç‚¹">ä¸»ä»ä¼˜ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>å¯¹è¯·æ±‚è¿›è¡Œè¯»å†™åˆ†ç¦»ï¼Œæé«˜å¤„ç†æ•ˆç‡</p></li><li class="lvl-2"><p>å¯ä»¥æä¾›å¤šä¸ªå‰¯æœ¬ï¼Œæé«˜æ•°æ®å®‰å…¨æ€§</p></li></ul><h3 id="ä¸»ä»ç¼ºç‚¹">ä¸»ä»ç¼ºç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œä¸»èŠ‚ç‚¹æ•…éšœï¼Œé›†ç¾¤åˆ™æ— æ³•è¿›è¡Œå·¥ä½œï¼Œå¯ç”¨æ€§æ¯”è¾ƒä½ï¼Œä»èŠ‚ç‚¹å‡ä¸»èŠ‚ç‚¹éœ€è¦äººå·¥æ‰‹åŠ¨å¹²é¢„</p></li></ul><h2 id="å“¨å…µ">å“¨å…µ</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸‰ä¸ªå“¨å…µï¼Œä¸ºäº†æ–¹ä¾¿å°±åœ¨ä¸Šé¢ä¸»ä»é…ç½®çš„3å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å“¨å…µ</p></li><li class="lvl-2"><p>è§„åˆ’</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">master 10.250.0.235</span><br><span class="line">slave1 10.250.0.58</span><br><span class="line">slave2 10.250.0.36</span><br><span class="line">sentinel1 10.250.0.71</span><br><span class="line">sentinel2 10.250.0.131</span><br><span class="line">sentinel3 10.250.0.63</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«ç¼–è¾‘å„è‡ªçš„ <code>sentinel.conf</code></p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç«¯å£å·</span></span><br><span class="line">port 26379</span><br><span class="line"></span><br><span class="line"><span class="comment"># åå°å¯åŠ¨</span></span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dirï¼Œéœ€è¦æå‰åˆ›å»ºå¥½</span></span><br><span class="line"><span class="built_in">dir</span> /usr/local/soft/dir-redis7/sentinel</span><br><span class="line"></span><br><span class="line"><span class="comment"># pidæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">pidfile redis-sentinel.pid</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—æ–‡ä»¶åç§°</span></span><br><span class="line">logfile <span class="string">&quot;sentinel.log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç›‘å¬çš„ä¸»èŠ‚ç‚¹åœ°å€å’Œç«¯å£ï¼Œmymasterä¸ºè‡ªå®šä¹‰çš„åç§°ï¼Œæœ€åçš„2è¡¨ç¤ºï¼Œåªè¦æœ‰2ä¸ªå“¨å…µèŠ‚ç‚¹è®¤ä¸ºä¸»èŠ‚ç‚¹æŒ‚äº†å°±ä¼šè¿›è¡Œé‡æ–°é€‰ä¸»ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºsentinelæ€»æ•°/2+1</span></span><br><span class="line">sentinel monitor mymaster 10.250.0.235 6379 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»è§‚ä¸‹çº¿æ—¶é—´ï¼ˆ5ç§’ï¼‰ï¼Œé»˜è®¤30ç§’</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•…éšœè½¬ç§»è¶…æ—¶æ—¶é—´ 60ç§’ï¼Œé»˜è®¤180ç§’</span></span><br><span class="line">sentinel failover-timeout mymaster 60000</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯æ¬¡å…è®¸å¤šå°‘ä¸ªslaveé‡æ–°åŒæ­¥ï¼Œé»˜è®¤å°±æ˜¯ 1</span></span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># aclç”¨æˆ·åå’Œå¯†ç ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ä¹Ÿæ˜¯ç”¨çš„ç®¡ç†å‘˜å¸å·</span></span><br><span class="line">sentinel auth-user mymaster admin</span><br><span class="line">sentinel auth-pass mymaster 123456</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«å¯åŠ¨ä¸‰ä¸ªå“¨å…µèŠ‚ç‚¹<code>redis-sentinel sentinel.conf</code>ï¼Œæ­¤æ—¶ç™»å½•å“¨å…µèŠ‚ç‚¹<code>redis-cli -p 26379</code>ï¼Œå¹¶æ‰§è¡Œ<code>info Sentinel</code>å‘½ä»¤ï¼ŒæŸ¥çœ‹å…¶æ˜¯å¦æ­£ç¡®è¯†åˆ«äº†ä¸»ä»</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sentinel</span></span><br><span class="line">sentinel_masters:1      <span class="comment"># å“¨å…µé›†ç¾¤ä¸­ä¸»ä»èŠ‚ç‚¹çš„æ•°é‡</span></span><br><span class="line">sentinel_tilt:0         <span class="comment"># æ˜¯å¦å¤„äº tilt çŠ¶æ€</span></span><br><span class="line">sentinel_tilt_since_seconds:-1 <span class="comment"># tilt çŠ¶æ€çš„å¼€å§‹æ—¶é—´</span></span><br><span class="line">sentinel_running_scripts:0 <span class="comment"># æ­£åœ¨è¿è¡Œçš„è„šæœ¬æ•°é‡</span></span><br><span class="line">sentinel_scripts_queue_length:0 <span class="comment"># è„šæœ¬é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line">sentinel_simulate_failure_flags:0 <span class="comment"># æ¨¡æ‹Ÿæ•…éšœçš„æ ‡å¿—</span></span><br><span class="line">master0:name=mymaster,status=ok,address=10.250.0.235:6379,slaves=2,sentinels=3 <span class="comment"># ä¸»èŠ‚ç‚¹çš„åœ°å€ï¼Œä»èŠ‚ç‚¹æ•°é‡å’Œå“¨å…µæ•°é‡</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶æŸ¥çœ‹<code>sentinel.conf</code>å¯ä»¥åœ¨æ–‡ä»¶æœ€åçœ‹åˆ°ä»èŠ‚ç‚¹ä¿¡æ¯å’Œå…¶å®ƒçš„å“¨å…µèŠ‚ç‚¹ä¿¡æ¯(<em><strong>ä½†å®æµ‹æ— æ³•æ„ŸçŸ¥å…¶å®ƒå“¨å…µèŠ‚ç‚¹</strong></em>)ï¼Œç±»ä¼¼äº</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generated by CONFIG REWRITE</span></span><br><span class="line">latency-tracking-info-percentiles 50 99 99.9  <span class="comment"># å»¶è¿Ÿè¿½è¸ªä¿¡æ¯ç™¾åˆ†æ¯”</span></span><br><span class="line">user default on nopass sanitize-payload ~* &amp;* +@all <span class="comment"># ç”¨æˆ·ä¿¡æ¯ï¼Œå½“å‰çš„å“¨å…µæ²¡æœ‰å¼€å¯æƒé™è®¤è¯ï¼Œæ‰€ä»¥ç¼ºçœä¸ºdefaultç”¨æˆ·ï¼Œæ— å¯†ç </span></span><br><span class="line">sentinel myid 8b9d55a581f2e41b4f8d92f4a9434d9b8a78b3e6 <span class="comment"># æœ¬èŠ‚ç‚¹çš„id</span></span><br><span class="line">sentinel config-epoch mymaster 0</span><br><span class="line">sentinel leader-epoch mymaster 0</span><br><span class="line">sentinel current-epoch 0</span><br><span class="line"><span class="comment"># ä¸€ä¸ªä»èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">sentinel known-replica mymaster 10.250.0.58 6379</span><br><span class="line"><span class="comment"># å¦ä¸€ä¸ªä»èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">sentinel known-replica mymaster 10.250.0.36 6379</span><br><span class="line"><span class="comment"># ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">sentinel known-sentinel mymaster 10.250.0.71 26379 b230f6a6076c23eed1923b29027d9ba7b24bee5a</span><br><span class="line"><span class="comment"># å¦ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">sentinel known-sentinel mymaster 10.250.0.63 26379 74ef58ef3616a27cc63d83bcfe422f15e11731b8</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶å…³é—­masterèŠ‚ç‚¹(10.250.0.235:6379)ï¼Œç„¶åç™»å½•å“¨å…µèŠ‚ç‚¹æŸ¥çœ‹<code>info Sentinel</code>ï¼Œå°±ä¼šå‘ç°masterèŠ‚ç‚¹å˜æˆäº†ä»èŠ‚ç‚¹å…¶ä¸­çš„ä¸€ä¸ªäº†</p></li><li class="lvl-2"><p>æ­¤æ—¶å†æ¬¡å¼€å¯åŸmasterèŠ‚ç‚¹ï¼Œä¼šå‘ç°å…¶å˜æˆäº†ä»èŠ‚ç‚¹ï¼Œç›¸åº”çš„é…ç½®æ–‡ä»¶(redis-6379.conf)ä¹Ÿå‘ç”Ÿäº†å˜æ›´</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generated by CONFIG REWRITE</span></span><br><span class="line">latency-tracking-info-percentiles 50 99 99.9</span><br><span class="line">replicaof 10.250.0.36 6379</span><br><span class="line">save 3600 1</span><br><span class="line">save 300 100</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯masterèŠ‚ç‚¹é‡å¯å‰ä¹Ÿéœ€è¦é…ç½®å¦‚ä¸‹è®¤è¯ä¿¡æ¯ï¼Œå› ä¸ºmasteråœ¨å“¨å…µæ¨¡å¼ä¸‹å‘ç”Ÿæ•…éšœåé‡æ–°å¯åŠ¨ä¼šå˜æˆslave</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœä¸»èŠ‚ç‚¹å¼€å¯äº†ACLè®¤è¯ï¼Œåˆ™ä»èŠ‚ç‚¹éœ€è¦è®¾ç½®ä¸»èŠ‚ç‚¹çš„è®¤è¯ä¿¡æ¯ï¼Œè¿™é‡Œè®¾ç½®ä¸ºç®¡ç†å‘˜å¸å·</span></span><br><span class="line">masteruser admin</span><br><span class="line">masterauth 123456</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå…³é—­å“¨å…µæœåŠ¡çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 26379 shutdown</span><br></pre></td></tr></table></figure><h3 id="å“¨å…µä¼˜ç‚¹">å“¨å…µä¼˜ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸»èŠ‚ç‚¹æ•…éšœï¼Œå¯ä»¥è‡ªåŠ¨åœ¨ä»èŠ‚ç‚¹ä¸­é‡æ–°é€‰ä¸»</p></li></ul><h3 id="å“¨å…µç¼ºç‚¹">å“¨å…µç¼ºç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>å“¨å…µå•ç‚¹æ•…éšœï¼Œåˆ™é›†ç¾¤æ— æ³•å®Œæ•´è‡ªä¸»é€‰ä¸¾ä¸»èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦å¯¹å“¨å…µé›†ç¾¤éƒ¨ç½²ï¼Œå¢åŠ æœåŠ¡å™¨æˆæœ¬ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æå‡è´Ÿè½½</p></li><li class="lvl-2"><p>ä»èŠ‚ç‚¹ä»…ä½œä¸ºå¤‡ä»½ä¸æä¾›å¯¹å¤–æœåŠ¡ï¼Œåªæœ‰å½“masterå‡ºç°æ•…éšœæ—¶å…¶æ™‹å‡ä¸ºmasteråæ‰èƒ½æä¾›æœåŠ¡ï¼Œæ‰€ä»¥ä¸æ”¯æŒè¯»å†™åˆ†ç¦»</p></li></ul><h2 id="é›†ç¾¤">é›†ç¾¤</h2><ul class="lvl-0"><li class="lvl-2"><p>æ­å»º6ä¸ªredisçš„é›†ç¾¤ï¼Œ3ä¸»3ä»</p></li><li class="lvl-2"><p>è§„åˆ’</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis1 10.250.0.235</span><br><span class="line">redis2 10.250.0.58</span><br><span class="line">redis3 10.250.0.36</span><br><span class="line">redis4 10.250.0.71</span><br><span class="line">redis5 10.250.0.131</span><br><span class="line">redis6 10.250.0.63</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿˜æ˜¯åŸºäºå•èŠ‚ç‚¹é…ç½®æ–‡ä»¶ï¼Œåªæ˜¯å°†èŠ‚ç‚¹é…ç½®æˆé›†ç¾¤æ¨¡å¼ï¼Œredis-6379.confæ–‡ä»¶å¢åŠ å¦‚ä¸‹ä¿¡æ¯</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ACLè®¤è¯ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦é…ç½®</span></span><br><span class="line">masteruser <span class="string">&quot;admin&quot;</span></span><br><span class="line">masterauth <span class="string">&quot;123456&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨é›†ç¾¤æ¨¡å¼</span></span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯æ–‡ä»¶ï¼Œè¿™é‡Œæœ€å¥½å’Œportå¯¹åº”ä¸Š</span></span><br><span class="line">cluster-config-file nodes-6379.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># é›†ç¾¤èŠ‚ç‚¹é—´é€šä¿¡çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤15000ï¼Œè¿™ä¸ªæ—¶é—´åˆ«è®¾ç½®å¤ªçŸ­ï¼Œé¿å…ç½‘ç»œæŠ–åŠ¨ç­‰åŸå› å¹²æ‰°</span></span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™æ•°æ®æˆåŠŸæœ€å°‘åŒæ­¥çš„slaveæ•°é‡ï¼Œé»˜è®¤æ•°æ®å†™å…¥masterå°±è¿”å›ç»™clientäº†ï¼ŒåŠ ä¸Šè¿™ä¸ªé…ç½®ï¼Œå°±éœ€è¦æ•°æ®åŒæ­¥åˆ°æŒ‡å®šæ•°é‡çš„slaveåæ‰èƒ½è¿”å›ï¼Œ</span></span><br><span class="line"><span class="comment"># æ³¨æ„è¿™ä¸ªé…ç½®ä¸ä»…ä¼šå»¶é•¿clientçš„ç­‰å¾…æ—¶é—´ï¼Œè€Œä¸”å¯èƒ½ä¼šå½±å“é›†ç¾¤çš„å¯ç”¨æ€§ï¼Œæ¯”å¦‚è¿™é‡Œé…ç½®è‡³å°‘åŒæ­¥1ä¸ªslaveï¼Œä½†æ˜¯å¦‚æœæ­¤æ—¶masterå¯¹åº”å¯ç”¨çš„slaveä¸è¶³1ä¸ªï¼Œé›†ç¾¤å°±ä¸èƒ½æä¾›æœåŠ¡äº†ï¼Œæ‰€ä»¥å»ºè®®æ¯ä¸ªmasterè‡³å°‘é…ç½®äº†2ä¸ªä»¥ä¸Šçš„slaveæ—¶æ‰å¼€å¯è¿™ä¸ªé…ç½®</span></span><br><span class="line"><span class="comment"># å¼€å¯è¿™ä¸ªé…ç½®å¯ä»¥é¢„é˜²é›†ç¾¤è„‘è£‚é—®é¢˜ï¼Œé»˜è®¤ä¸º3</span></span><br><span class="line">min-replicas-to-write 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœé›†ç¾¤ä¸­æŸä¸ªmaster/slaveå…¨éƒ¨æŒ‚æ‰ï¼Œæ•´ä¸ªé›†ç¾¤çš„å…¶å®ƒmaster/slaveæ˜¯å¦è¿˜å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œé»˜è®¤yesï¼Œä¸èƒ½</span></span><br><span class="line"><span class="comment"># å¦‚æœè®¾ç½®ä¸ºnoï¼Œåˆ™è¡¨ç¤ºä¾æ—§å¯ä»¥æä¾›æœåŠ¡ï¼Œä¸è¿‡å¦‚æœæœ‰keyè½åœ¨äº†æŒ‚æ‰çš„ä¸»ä»ä¸Šå°±ä¼šå¤±è´¥</span></span><br><span class="line">cluster-require-full-coverage <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«å¯åŠ¨6ä¸ªredisæœåŠ¡</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis-6379.conf</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºé›†ç¾¤ï¼Œ3ä¸»3ä»ï¼Œæ³¨æ„åˆ›å»ºé›†ç¾¤å‰æ‰€æœ‰redisä¸èƒ½æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰éœ€è¦å…ˆæ¸…ç©º(<em><strong>åˆ é™¤diré…ç½®çš„ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å³å¯</strong></em>)ï¼Œç„¶ååœ¨ä»»æ„ä¸€ä¸ªredisæ‰§è¡Œ</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --user admin --pass 123456 --cluster create --cluster-replicas 1 10.250.0.235:6379 10.250.0.58:6379 10.250.0.36:6379 10.250.0.71:6379 10.250.0.131:6379 10.250.0.63:6379</span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># --cluster createï¼šåˆ›å»ºé›†ç¾¤</span></span><br><span class="line"><span class="comment"># --cluster-replicas 1ï¼šè®¾ç½®ä»èŠ‚ç‚¹æ•°é‡ï¼Œè¿™é‡Œè®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºæ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½å¯¹åº”ä¸€ä¸ªä»èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"># è¿™é‡Œé…ç½®äº†6ä¸ªèŠ‚ç‚¹ç»„å»ºé›†ç¾¤ï¼Œè¦ä¿è¯æ¯ä¸ªmasterèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œæ‰€ä»¥åˆšå¥½æ˜¯3ä¸»3ä»</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶ä¼šåˆ—å‡ºé›†ç¾¤å†…ä¸»ä»å’Œæ§½ä½çš„åˆ†é…æ–¹æ¡ˆï¼Œè¾“å…¥<code>yes</code>å³å¯</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Warning: Using a password with <span class="string">&#x27;-a&#x27;</span> or <span class="string">&#x27;-u&#x27;</span> option on the <span class="built_in">command</span> line interface may not be safe.</span><br><span class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 10.250.0.131:6379 to 10.250.0.235:6379</span><br><span class="line">Adding replica 10.250.0.63:6379 to 10.250.0.58:6379</span><br><span class="line">Adding replica 10.250.0.71:6379 to 10.250.0.36:6379</span><br><span class="line">M: afcb754ce8cc79122fe9bcd8c1567bbf13258fce 10.250.0.235:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: 2527142b7cffaf6bb92608550c919a0db0607c39 10.250.0.58:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 88762f7d0bbb99bbaf68556ef5fd113cba46d295 10.250.0.36:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 547fbd934293ddb5eb770e111b65910f4e604023 10.250.0.71:6379</span><br><span class="line">   replicates 88762f7d0bbb99bbaf68556ef5fd113cba46d295</span><br><span class="line">S: 17b33861e6b086b86902fe75f79e5b878bd26f94 10.250.0.131:6379</span><br><span class="line">   replicates afcb754ce8cc79122fe9bcd8c1567bbf13258fce</span><br><span class="line">S: 119e5823cccafef506b9b256aad206678eab7d41 10.250.0.63:6379</span><br><span class="line">   replicates 2527142b7cffaf6bb92608550c919a0db0607c39</span><br><span class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">&#x27;yes&#x27;</span> to accept): <span class="built_in">yes</span></span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to <span class="built_in">join</span> the cluster</span><br><span class="line">Waiting <span class="keyword">for</span> the cluster to <span class="built_in">join</span></span><br><span class="line">.</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 10.250.0.235:6379)</span><br><span class="line">M: afcb754ce8cc79122fe9bcd8c1567bbf13258fce 10.250.0.235:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 547fbd934293ddb5eb770e111b65910f4e604023 10.250.0.71:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 88762f7d0bbb99bbaf68556ef5fd113cba46d295</span><br><span class="line">S: 119e5823cccafef506b9b256aad206678eab7d41 10.250.0.63:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 2527142b7cffaf6bb92608550c919a0db0607c39</span><br><span class="line">S: 17b33861e6b086b86902fe75f79e5b878bd26f94 10.250.0.131:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates afcb754ce8cc79122fe9bcd8c1567bbf13258fce</span><br><span class="line">M: 88762f7d0bbb99bbaf68556ef5fd113cba46d295 10.250.0.36:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 2527142b7cffaf6bb92608550c919a0db0607c39 10.250.0.58:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç™»å½•é›†ç¾¤å¹¶æŸ¥è¯¢é›†ç¾¤é…ç½®ä¿¡æ¯</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -c è¡¨ç¤ºä»¥é›†ç¾¤æ¨¡å¼ç™»å½•ï¼Œ-h é›†ç¾¤å†…ä»»æ„ip</span></span><br><span class="line">redis-cli --user admin --pass 123456 -c -h 10.250.0.235</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.235:6379&gt; cluster info</span><br><span class="line"><span class="comment"># è¾“å‡ºé›†ç¾¤çŠ¶æ€</span></span><br><span class="line">cluster_state:ok                                <span class="comment"># é›†ç¾¤æ•´ä½“çŠ¶æ€ï¼šok è¡¨ç¤ºé›†ç¾¤å½“å‰å¯ç”¨ã€å¥åº·</span></span><br><span class="line">cluster_slots_assigned:16384                    <span class="comment"># å·²åˆ†é…çš„å“ˆå¸Œæ§½æ•°é‡ï¼ˆæ€»æ§½æ•°å›ºå®šä¸º 16384ï¼‰</span></span><br><span class="line">cluster_slots_ok:16384                          <span class="comment"># æ­£å¸¸å·¥ä½œçš„æ§½æ•°é‡ï¼ˆç­‰äºå·²åˆ†é…æ§½ï¼Œè¯´æ˜å…¨éƒ¨æ­£å¸¸ï¼‰</span></span><br><span class="line">cluster_slots_pfail:0                           <span class="comment"># å¤„äºâ€œç–‘ä¼¼å¤±è´¥(pfail)â€çŠ¶æ€çš„æ§½æ•°é‡</span></span><br><span class="line">cluster_slots_fail:0                            <span class="comment"># è¢«åˆ¤å®šä¸ºå¤±è´¥(fail)çš„æ§½æ•°é‡</span></span><br><span class="line">cluster_known_nodes:6                           <span class="comment"># å½“å‰èŠ‚ç‚¹å·²çŸ¥çš„é›†ç¾¤èŠ‚ç‚¹æ€»æ•°ï¼ˆä¸»èŠ‚ç‚¹ + ä»èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">cluster_size:3                                  <span class="comment"># ä¸»èŠ‚ç‚¹æ•°é‡ï¼ˆ3 ä¸»èŠ‚ç‚¹ï¼Œå…¸å‹çš„ 3 ä¸» 3 ä»ç»“æ„ï¼‰</span></span><br><span class="line">cluster_current_epoch:6                         <span class="comment"># é›†ç¾¤å½“å‰çš„å…¨å±€çºªå…ƒï¼ˆç”¨äºé€‰ä¸¾å’Œé…ç½®åŒæ­¥ï¼‰</span></span><br><span class="line">cluster_my_epoch:1                              <span class="comment"># å½“å‰è¿™ä¸ªèŠ‚ç‚¹æ‰€åœ¨çš„çºªå…ƒ</span></span><br><span class="line">cluster_stats_messages_ping_sent:159           <span class="comment"># å½“å‰èŠ‚ç‚¹å·²å‘é€çš„ PING æ¶ˆæ¯æ•°é‡ï¼ˆå¿ƒè·³ï¼‰</span></span><br><span class="line">cluster_stats_messages_pong_sent:156           <span class="comment"># å½“å‰èŠ‚ç‚¹å·²å‘é€çš„ PONG æ¶ˆæ¯æ•°é‡ï¼ˆå¿ƒè·³å“åº”ï¼‰</span></span><br><span class="line">cluster_stats_messages_sent:315                <span class="comment"># å½“å‰èŠ‚ç‚¹å‘é€çš„æ‰€æœ‰é›†ç¾¤æ¶ˆæ¯æ€»æ•°</span></span><br><span class="line">cluster_stats_messages_ping_received:151       <span class="comment"># å½“å‰èŠ‚ç‚¹æ”¶åˆ°çš„ PING æ¶ˆæ¯æ•°é‡</span></span><br><span class="line">cluster_stats_messages_pong_received:159       <span class="comment"># å½“å‰èŠ‚ç‚¹æ”¶åˆ°çš„ PONG æ¶ˆæ¯æ•°é‡</span></span><br><span class="line">cluster_stats_messages_meet_received:5         <span class="comment"># å½“å‰èŠ‚ç‚¹æ”¶åˆ°çš„ MEET æ¶ˆæ¯æ•°é‡ï¼ˆæ–°èŠ‚ç‚¹åŠ å…¥å‘ç°ï¼‰</span></span><br><span class="line">cluster_stats_messages_received:315            <span class="comment"># å½“å‰èŠ‚ç‚¹æ”¶åˆ°çš„æ‰€æœ‰é›†ç¾¤æ¶ˆæ¯æ€»æ•°</span></span><br><span class="line">total_cluster_links_buffer_limit_exceeded:0    <span class="comment"># å› è¾“å‡ºç¼“å†²åŒºè¶…é™è¢«å¼ºåˆ¶æ–­å¼€çš„é›†ç¾¤è¿æ¥æ•°ï¼ˆ0 = æ­£å¸¸ï¼‰</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.235:6379&gt; cluster nodes</span><br><span class="line"><span class="comment"># å½“å‰èŠ‚ç‚¹ï¼ˆmyselfï¼‰ï¼Œè§’è‰²ä¸º masterï¼Œè´Ÿè´£æ§½ä½ 0-5460ï¼Œæ˜¯æœ¬æœºæ‰€åœ¨çš„ä¸»èŠ‚ç‚¹</span></span><br><span class="line">afcb754ce8cc79122fe9bcd8c1567bbf13258fce 10.250.0.235:6379@16379 myself,master - 0 0 1 connected 0-5460</span><br><span class="line"><span class="comment"># ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰ï¼Œå¯¹åº”çš„ä¸»èŠ‚ç‚¹æ˜¯ 10.250.0.36 è¿™ä¸ª masterï¼ˆè´Ÿè´£æ§½ä½ 10923-16383ï¼‰</span></span><br><span class="line">547fbd934293ddb5eb770e111b65910f4e604023 10.250.0.71:6379@16379 slave 88762f7d0bbb99bbaf68556ef5fd113cba46d295 0 1765033120132 3 connected</span><br><span class="line"><span class="comment"># ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰ï¼Œå¯¹åº”çš„ä¸»èŠ‚ç‚¹æ˜¯ 10.250.0.58 è¿™ä¸ª masterï¼ˆè´Ÿè´£æ§½ä½ 5461-10922ï¼‰</span></span><br><span class="line">119e5823cccafef506b9b256aad206678eab7d41 10.250.0.63:6379@16379 slave 2527142b7cffaf6bb92608550c919a0db0607c39 0 1765033118000 2 connected</span><br><span class="line"><span class="comment"># ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰ï¼Œå¯¹åº”çš„ä¸»èŠ‚ç‚¹æ˜¯å½“å‰èŠ‚ç‚¹ 10.250.0.235ï¼ˆè´Ÿè´£æ§½ä½ 0-5460ï¼‰</span></span><br><span class="line">17b33861e6b086b86902fe75f79e5b878bd26f94 10.250.0.131:6379@16379 slave afcb754ce8cc79122fe9bcd8c1567bbf13258fce 0 1765033119000 1 connected</span><br><span class="line"><span class="comment"># ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰ï¼Œè´Ÿè´£æ§½ä½ 10923-16383ï¼ˆé›†ç¾¤ä¸­ç¬¬ä¸‰æ®µæ§½ä½ï¼‰</span></span><br><span class="line">88762f7d0bbb99bbaf68556ef5fd113cba46d295 10.250.0.36:6379@16379 master - 0 1765033117000 3 connected 10923-16383</span><br><span class="line"><span class="comment"># ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰ï¼Œè´Ÿè´£æ§½ä½ 5461-10922ï¼ˆé›†ç¾¤ä¸­ç¬¬äºŒæ®µæ§½ä½ï¼‰</span></span><br><span class="line">2527142b7cffaf6bb92608550c919a0db0607c39 10.250.0.58:6379@16379 master - 0 1765033119126 2 connected 5461-10922</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶æŸ¥çœ‹<code>nodes-6379.conf</code>ä¹Ÿä¼šçœ‹åˆ°å’Œä¸Šé¢ä¸€æ ·çš„èŠ‚ç‚¹ä¿¡æ¯</p></li><li class="lvl-2"><p>æ­¤æ—¶å…³é—­å…¶ä¸­ä¸€ä¸ªmasterèŠ‚ç‚¹ï¼Œæ¯”å¦‚<code>10.250.0.36</code>ï¼Œåˆ™å…¶å¯¹åº”çš„slaveèŠ‚ç‚¹<code>10.250.0.71</code>ä¼šåˆ‡æ¢ä¸ºæ–°çš„masterèŠ‚ç‚¹ï¼Œæ­¤æ—¶<code>10.250.0.36</code>çš„çŠ¶æ€æœ€ç»ˆå˜ä¸º<code>fail</code></p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.235:6379&gt; cluster nodes</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">afcb754ce8cc79122fe9bcd8c1567bbf13258fce 10.250.0.235:6379@16379 myself,master - 0 0 1 connected 0-5460</span><br><span class="line">547fbd934293ddb5eb770e111b65910f4e604023 10.250.0.71:6379@16379 master - 0 1765033733534 7 connected 10923-16383</span><br><span class="line">119e5823cccafef506b9b256aad206678eab7d41 10.250.0.63:6379@16379 slave 2527142b7cffaf6bb92608550c919a0db0607c39 0 1765033734542 2 connected</span><br><span class="line">17b33861e6b086b86902fe75f79e5b878bd26f94 10.250.0.131:6379@16379 slave afcb754ce8cc79122fe9bcd8c1567bbf13258fce 0 1765033732526 1 connected</span><br><span class="line">88762f7d0bbb99bbaf68556ef5fd113cba46d295 10.250.0.36:6379@16379 master,fail - 1765033690200 1765033686170 3 connected</span><br><span class="line">2527142b7cffaf6bb92608550c919a0db0607c39 10.250.0.58:6379@16379 master - 0 1765033735550 2 connected 5461-10922</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å†æ¬¡å¯åŠ¨<code>10.250.0.36</code>ï¼Œå…¶ä¼šå˜æˆ<code>10.250.0.71</code>çš„slaveèŠ‚ç‚¹</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.235:6379&gt; cluster nodes</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">afcb754ce8cc79122fe9bcd8c1567bbf13258fce 10.250.0.235:6379@16379 myself,master - 0 0 1 connected 0-5460</span><br><span class="line">547fbd934293ddb5eb770e111b65910f4e604023 10.250.0.71:6379@16379 master - 0 1765033859000 7 connected 10923-16383</span><br><span class="line">119e5823cccafef506b9b256aad206678eab7d41 10.250.0.63:6379@16379 slave 2527142b7cffaf6bb92608550c919a0db0607c39 0 1765033860493 2 connected</span><br><span class="line">17b33861e6b086b86902fe75f79e5b878bd26f94 10.250.0.131:6379@16379 slave afcb754ce8cc79122fe9bcd8c1567bbf13258fce 0 1765033858000 1 connected</span><br><span class="line">88762f7d0bbb99bbaf68556ef5fd113cba46d295 10.250.0.36:6379@16379 slave 547fbd934293ddb5eb770e111b65910f4e604023 0 1765033859488 7 connected</span><br><span class="line">2527142b7cffaf6bb92608550c919a0db0607c39 10.250.0.58:6379@16379 master - 0 1765033859000 2 connected 5461-10922</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è‹¥æ­¤æ—¶è¿˜æ˜¯å¸Œæœ› <code>10.250.0.36</code> åšä¸ºä¸»èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦å…ˆç™»å½•<code>10.250.0.36</code>ï¼Œå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„è¦åŠ  -c</span></span><br><span class="line">redis-cli -c --user admin --pass 123456 -h 10.250.0.36</span><br><span class="line">10.250.0.36:6379&gt; cluster failover <span class="comment"># å®‰å…¨ç‰ˆï¼ˆç­‰å¾…å¤åˆ¶åŒæ­¥ï¼‰</span></span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">10.250.0.36:6379&gt; CLUSTER FAILOVER TAKEOVER <span class="comment"># TAKEOVER ä¼šç«‹å³åˆ‡ä¸»ï¼Œä¸ä¼šç­‰å¾…å¤åˆ¶æ•°æ®ï¼Œéå¸¸å¼ºåˆ¶(ç”Ÿäº§ç¯å¢ƒä¸æ¨è)</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>redisé›†ç¾¤ä¼šå°†2çš„14æ¬¡å¹‚(16384)çš„slotå¹³å‡åˆ†é…åˆ°æ‰€æœ‰masterä¸Šï¼Œç„¶åå¯¹keyè¿›è¡Œhashåè®¡ç®—åº”è¯¥å­˜å‚¨åˆ°é‚£ä¸ªslot</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HASH_SLOT=CRC16(key) mod 16384</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·³è½¬é‡å®šä½</span></span><br><span class="line">10.250.0.235:6379&gt; <span class="built_in">set</span> name zhangsan</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">-&gt; Redirected to slot [5798] located at 10.250.0.58:6379</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å…³é—­é›†ç¾¤ï¼Œ6ä¸ªredisåˆ†åˆ«å…³é—­</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -h 10.250.0.235 -p 6379 --user admin --pass 123456 shutdown</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡å¯é›†ç¾¤ï¼Œ6ä¸ªredisåˆ†åˆ«å¯åŠ¨å³å¯</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis-6379.conf</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>mset/mgetè¦æ±‚keyéƒ½è½åœ¨åŒä¸€ä¸ªslotä¸Šï¼Œæ¯ä¸ªkeyéƒ½åŠ ä¸Šå“ˆå¸Œæ ‡ç­¾ï¼ˆHash Tagï¼‰-- <code>&#123;xxx&#125;</code>ï¼Œå…¶å¿…é¡»ç”¨<code>&#123;&#125;</code>æ‹¬èµ·æ¥ï¼Œ<code>xxx</code>å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œè®¡ç®—slotæ—¶ï¼Œåªä¼šæ ¹æ®<code>xxx</code>æ¥è®¡ç®—hashå€¼ï¼Œè¿™æ ·å°±ä¿è¯äº†æ‰€æœ‰keyä¸­åŒ…å«<code>&#123;xxx&#125;</code>çš„keyéƒ½ä¼šè½åˆ°åŒä¸€ä¸ªslotï¼Œ<code>&#123;xxx&#125;</code>å¯ä»¥æ”¾åœ¨keyçš„ä»»æ„ä½ç½®</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.235:6379&gt; mset name1 lisi name2 wangwu</span><br><span class="line">(error) CROSSSLOT Keys <span class="keyword">in</span> request don<span class="string">&#x27;t hash to the same slot</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">10.250.0.235:6379&gt; mset &#123;user&#125;:name1 lisi &#123;user&#125;:name2 wangwu</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">10.250.0.235:6379&gt; mget &#123;user&#125;:name1 &#123;user&#125;:name2</span></span><br><span class="line"><span class="string">-&gt; Redirected to slot [5474] located at 10.250.0.58:6379</span></span><br><span class="line"><span class="string">1) &quot;lisi&quot;</span></span><br><span class="line"><span class="string">2) &quot;wangwu&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„:<br>{â€¦} è®©å¤šä¸ª key è½åœ¨åŒä¸€ä¸ª slotï¼Œæ”¯æŒè·¨ key åŸå­æ“ä½œ<br>åªæœ‰ ç¬¬ä¸€ä¸ªåŒ¹é…çš„ {â€¦} ä¼šè¢«å½“åš tag<br>{} ä¸èƒ½åµŒå¥—<br>ç©ºæ ‡ç­¾ {} æ˜¯éæ³•çš„<br>{abc} å’Œ {def} å°±è½ä¸åŒ slot</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>å¦‚ä½•åˆ¤æ–­ key è½åœ¨å“ªä¸ªèŠ‚ç‚¹?</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.235:6379&gt; cluster keyslot name1</span><br><span class="line"><span class="comment"># è¾“å‡ºçš„æ•°å€¼å°±è¡¨ç¤º slot</span></span><br><span class="line">(<span class="built_in">integer</span>) 5461 <span class="comment"># slotå€¼</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚ä½•æŸ¥çœ‹æŒ‡å®šçš„slotä¸­æœ‰å¤šå°‘ä¸ªkey?</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.235:6379&gt; cluster countkeysinslot 5461</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">(<span class="built_in">integer</span>) 1 <span class="comment"># è¡¨ç¤ºslotä¸­keyçš„ä¸ªæ•°ï¼Œè¿™é‡Œæ˜¾ç¤ºåªæœ‰1ä¸ªkey</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é›†ç¾¤æ¨ä¸¾æ–°çš„masteræ—¶è¦æ±‚è‡³å°‘ä¸€åŠçš„masteråŒæ„ï¼Œæ‰€ä»¥ä¸€ä¸ªé›†ç¾¤è‡³å°‘éœ€è¦3ä¸ªmasterï¼Œå®˜æ–¹æ¨èmasterèŠ‚ç‚¹æ•°ä¸ºå¥‡æ•°ï¼Œæ¯”å¦‚3ä¸ªå’Œ4ä¸ªmasterèŠ‚ç‚¹ï¼Œéƒ½è‡³å¤šå…è®¸ä¸€ä¸ªmasterèŠ‚ç‚¹æŒ‚æ‰æ—¶è¿›è¡Œé€‰ä¸»ï¼Œä½†æ˜¯3ä¸ªmasterå¯ä»¥èŠ‚çœèµ„æº</p></li><li class="lvl-2"><p>é›†ç¾¤é€šè¿‡<code>10000+port</code>è¿™ä¸ªç«¯å£å·è¿›è¡Œé›†ç¾¤é—´é€šä¿¡ï¼Œæ‰€ä»¥é™¤äº†è¦å¼€æ”¾<code>prot</code>è¿™ä¸ªç«¯å£ï¼Œè¿˜è¦å¼€æ”¾<code>10000+port</code>è¿™ä¸ªç«¯å£</p></li><li class="lvl-2"><p>æœ‰å…³redisé›†ç¾¤åŠå…¶æ°´å¹³æ‰©å±•çš„è¿›ä¸€æ­¥è¯´æ˜ï¼Œå¯ä»¥å‚çœ‹<a href="/2018/12/27/redis-cluster/" title="Redisé›†ç¾¤">Redisé›†ç¾¤</a></p></li></ul><h3 id="é›†ç¾¤ä¼˜ç‚¹">é›†ç¾¤ä¼˜ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>æ— ä¸­å¿ƒæ¶æ„ï¼Œé›†ç¾¤å†…éƒ¨è‡ªè¡Œç»´æŠ¤æ•°æ®çš„åˆ†ç‰‡å’Œä¸»ä»çš„åˆ‡æ¢</p></li><li class="lvl-2"><p>æ•°æ®åˆ†ç‰‡å­˜å‚¨ï¼Œæä¾›å¾ˆé«˜çš„è®¿é—®æ•ˆç‡</p></li><li class="lvl-2"><p>é«˜å¯ç”¨æ€§ï¼Œå¯å®ç°éƒ¨åˆ†èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œé›†ç¾¤ä»å¯ç”¨</p></li><li class="lvl-2"><p>é«˜æ‰©å±•æ€§ï¼Œå¯ä»¥æ¨ªå‘æ‰©å±•1000ä¸ªèŠ‚ç‚¹åä¾æ—§ä¿è¯è®¿é—®æ•ˆç‡ï¼Œæ‰©å®¹ç¼©å®¹éƒ½æ”¯æŒ</p></li></ul><h3 id="é›†ç¾¤ç¼ºç‚¹">é›†ç¾¤ç¼ºç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>æ•°æ®é€šè¿‡å¼‚æ­¥å¤åˆ¶ï¼Œä¸ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§</p></li><li class="lvl-2"><p>ä¸æ”¯æŒå¤šæ•°æ®åº“ç©ºé—´ï¼Œå•æœºä¸‹çš„rediså¯ä»¥æ”¯æŒåˆ°16ä¸ªæ•°æ®åº“ï¼Œé›†ç¾¤æ¨¡å¼ä¸‹åªèƒ½ä½¿ç”¨1ä¸ªæ•°æ®åº“ç©ºé—´ï¼Œå³db 0</p></li><li class="lvl-2"><p>ä¸æ”¯æŒè·¨slotæ“ä½œï¼Œå¦‚ä½¿ç”¨msetã€mgetç›®å‰åªæ”¯æŒå…·æœ‰ç›¸åŒslotå€¼çš„Keyæ‰§è¡Œæ‰¹é‡æ“ä½œ</p></li><li class="lvl-2"><p>Keyä½œä¸ºæ•°æ®åˆ†åŒºçš„æœ€å°ç²’åº¦ï¼Œä¸èƒ½å°†ä¸€ä¸ªå¾ˆå¤§çš„é”®å€¼å¯¹è±¡å¦‚hashã€listç­‰æ˜ å°„åˆ°ä¸åŒçš„èŠ‚ç‚¹</p></li><li class="lvl-2"><p>Keyäº‹åŠ¡æ“ä½œæ”¯æŒæœ‰é™ï¼Œåªæ”¯æŒå¤škeyåœ¨åŒä¸€èŠ‚ç‚¹ä¸Šçš„äº‹åŠ¡æ“ä½œï¼Œå½“å¤šä¸ªKeyåˆ†å¸ƒäºä¸åŒçš„èŠ‚ç‚¹ä¸Šæ—¶æ— æ³•ä½¿ç”¨äº‹åŠ¡åŠŸèƒ½</p></li><li class="lvl-2"><p>ä¸å»ºè®®ä½¿ç”¨pipelineå’Œmulti-keysæ“ä½œ</p></li></ul><h3 id="redis-cli-çš„-Cluster-ç®¡ç†å‘½ä»¤ï¼ˆç”¨äºç®¡ç†-åˆ›å»º-è°ƒæ•´é›†ç¾¤ï¼‰">redis-cli çš„ Cluster ç®¡ç†å‘½ä»¤ï¼ˆç”¨äºç®¡ç†/åˆ›å»º/è°ƒæ•´é›†ç¾¤ï¼‰</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>redis-cli --cluster create host1:port host2:port ...</code></td><td>åˆ›å»º Redis Cluster é›†ç¾¤ï¼ˆè‡ªåŠ¨åˆ†é… slotsï¼‰</td><td><code>redis-cli --cluster create 10.0.0.1:7000 10.0.0.2:7000 --cluster-replicas 1</code></td></tr><tr><td><code>redis-cli --cluster check host:port</code></td><td>æ£€æŸ¥é›†ç¾¤çŠ¶æ€ã€å¥å£®æ€§</td><td><code>redis-cli --cluster check 10.0.0.1:7000</code></td></tr><tr><td><code>redis-cli --cluster info host:port</code></td><td>æ˜¾ç¤ºé›†ç¾¤ç»“æ„ã€èŠ‚ç‚¹ã€slots åˆ†å¸ƒ</td><td><code>redis-cli --cluster info 10.0.0.1:7000</code></td></tr><tr><td><code>redis-cli --cluster fix host:port</code></td><td>ä¿®å¤ slots ç§»åŠ¨ã€èŠ‚ç‚¹ä¸­æ–­ç­‰å¼‚å¸¸çŠ¶æ€</td><td><code>redis-cli --cluster fix 10.0.0.1:7000</code></td></tr><tr><td><code>redis-cli --cluster rebalance host:port</code></td><td>é‡æ–°åˆ†å¸ƒ slotsï¼ˆè‡ªåŠ¨å‡è¡¡è´Ÿè½½ï¼‰</td><td><code>redis-cli --cluster rebalance 10.0.0.1:7000</code></td></tr><tr><td><code>redis-cli --cluster rebalance --cluster-threshold &lt;percent&gt; host:port</code></td><td>æ‰‹åŠ¨è®¾ç½® rebalance é˜ˆå€¼ï¼›ä½äºæ­¤é˜ˆå€¼æ‰ä¼šè°ƒæ•´ï¼ˆç™¾åˆ†æ¯”ï¼‰</td><td><code>redis-cli --cluster rebalance --cluster-threshold 1 10.0.0.1:7000</code></td></tr><tr><td><code>redis-cli --cluster add-node newHost:newPort existingHost:existingPort</code></td><td>å°†æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</td><td><code>redis-cli --cluster add-node 10.0.0.3:7000 10.0.0.1:7000</code></td></tr><tr><td><code>redis-cli --cluster add-node --cluster-slave newHost:newPort existingMaster:port</code></td><td>å°†æ–°èŠ‚ç‚¹ä½œä¸ºæŸä¸»èŠ‚ç‚¹çš„ slave åŠ å…¥</td><td><code>redis-cli --cluster add-node --cluster-slave 10.0.0.4:7000 10.0.0.1:7000</code></td></tr><tr><td><code>redis-cli --cluster del-node host:port node_id</code></td><td>ä»é›†ç¾¤åˆ é™¤æŸèŠ‚ç‚¹ï¼ˆå¿…é¡»æ—  slotsï¼‰</td><td><code>redis-cli --cluster del-node 10.0.0.1:7000 &lt;node-id&gt;</code></td></tr><tr><td><code>redis-cli --cluster call host:port command ...</code></td><td>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰¹é‡æ‰§è¡Œå‘½ä»¤</td><td><code>redis-cli --cluster call 10.0.0.1:7000 PING</code></td></tr><tr><td><code>redis-cli --cluster help</code></td><td>æ˜¾ç¤º cluster å­å‘½ä»¤å¸®åŠ©</td><td><code>redis-cli --cluster help</code></td></tr></tbody></table><h3 id="Redis-å†…ç½®çš„-Cluster-æ“ä½œå‘½ä»¤">Redis å†…ç½®çš„ Cluster æ“ä½œå‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>CLUSTER INFO</code></td><td>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ã€failover çŠ¶æ€ã€slot åˆ†å¸ƒç»Ÿè®¡</td><td><code>CLUSTER INFO</code></td></tr><tr><td><code>CLUSTER NODES</code></td><td>æ˜¾ç¤ºæ‰€æœ‰èŠ‚ç‚¹å’Œè§’è‰²ï¼ˆmaster/slaveï¼‰</td><td><code>CLUSTER NODES</code></td></tr><tr><td><code>CLUSTER MYID</code></td><td>è¾“å‡ºæœ¬èŠ‚ç‚¹ ID</td><td><code>CLUSTER MYID</code></td></tr><tr><td><code>CLUSTER REPLICATE &lt;node-id&gt;</code></td><td>å°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºæŸä¸ª master çš„ slave</td><td><code>CLUSTER REPLICATE &lt;node-id&gt;</code></td></tr><tr><td><code>CLUSTER FAILOVER</code></td><td>ä¸»åŠ¨ failoverï¼ˆslave å‡çº§ä¸º masterï¼‰</td><td>ä»èŠ‚ç‚¹æ‰§è¡Œï¼š<code>CLUSTER FAILOVER</code></td></tr><tr><td><code>CLUSTER FAILOVER FORCE</code></td><td>ä¸ç­‰å¾…å¤åˆ¶åŒæ­¥ï¼Œç«‹åˆ»åˆ‡ä¸»</td><td><code>CLUSTER FAILOVER FORCE</code></td></tr><tr><td><code>CLUSTER FAILOVER TAKEOVER</code></td><td>å¼ºåˆ¶æ¥ç®¡ slotï¼ˆå®Œå…¨è¦†ç›– masterï¼‰ï¼ˆå±é™©ï¼‰</td><td><code>CLUSTER FAILOVER TAKEOVER</code></td></tr><tr><td><code>CLUSTER ADDSLOTS &lt;slot...&gt;</code></td><td>å°† slots åˆ†é…ç»™å½“å‰ master</td><td><code>CLUSTER ADDSLOTS 0 1 2</code></td></tr><tr><td><code>CLUSTER DELSLOTS &lt;slot...&gt;</code></td><td>ä»å½“å‰èŠ‚ç‚¹ç§»é™¤ slots</td><td><code>CLUSTER DELSLOTS 0 1 2</code></td></tr><tr><td><code>CLUSTER SETSLOT &lt;slot&gt; NODE &lt;node-id&gt;</code></td><td>ç›´æ¥æŒ‡å®šæŸä¸ª slot å±äºæŸä¸ªèŠ‚ç‚¹</td><td><code>CLUSTER SETSLOT 0 NODE &lt;id&gt;</code></td></tr><tr><td><code>CLUSTER SETSLOT &lt;slot&gt; IMPORTING &lt;node-id&gt;</code></td><td>è®¾å®šè¿ç§» key çš„æºèŠ‚ç‚¹ï¼ˆç”¨äº slot è¿ç§»ï¼‰</td><td>-</td></tr><tr><td><code>CLUSTER SETSLOT &lt;slot&gt; MIGRATING &lt;node-id&gt;</code></td><td>è®¾å®šè¿ç§» key çš„ç›®æ ‡èŠ‚ç‚¹ï¼ˆç”¨äº slot è¿ç§»ï¼‰</td><td>-</td></tr><tr><td><code>CLUSTER KEYSLOT key</code></td><td>è¿”å› key æ‰€å± slot</td><td><code>CLUSTER KEYSLOT mykey</code></td></tr><tr><td><code>CLUSTER COUNT-FAILURE-REPORTS &lt;node-id&gt;</code></td><td>æŸ¥çœ‹æŸèŠ‚ç‚¹çš„ fail ç¥¨æ•°</td><td>-</td></tr><tr><td><code>CLUSTER RESET</code></td><td>åˆ é™¤èŠ‚ç‚¹å…¨éƒ¨é›†ç¾¤ä¿¡æ¯ï¼ˆç”¨æ¥é‡ç½®ä¸º standaloneï¼‰</td><td><code>CLUSTER RESET HARD</code></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Redis 7 + ACL å•èŠ‚ç‚¹ã€ä¸»ä»ã€å“¨å…µã€é›†ç¾¤æ„å»ºæ–¹æ³•&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;æœ¬æ–‡åŸºäº&lt;code&gt;redis-7.4.7&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;ä¼ ç»Ÿçš„éACLç‰ˆæœ¬ï¼Œå¯ä»¥å‚è€ƒ &lt;a href=&quot;/2022/09/09/redis5-config/&quot; title=&quot;Rediså•èŠ‚ç‚¹ã€ä¸»ä»ã€å“¨å…µã€é›†ç¾¤æ„å»ºæ–¹æ³•&quot;&gt;Rediså•èŠ‚ç‚¹ã€ä¸»ä»ã€å“¨å…µã€é›†ç¾¤æ„å»ºæ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;Rediså®˜ç½‘ï¼š&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/redis/"/>
    
    
    <category term="redis" scheme="https://blog.hanqunfeng.com/tags/redis/"/>
    
    <category term="redis cluster" scheme="https://blog.hanqunfeng.com/tags/redis-cluster/"/>
    
  </entry>
  
  <entry>
    <title>brew -- åˆ›å»ºè‡ªå·±çš„ Formula</title>
    <link href="https://blog.hanqunfeng.com/2025/12/02/brew-my-formula/"/>
    <id>https://blog.hanqunfeng.com/2025/12/02/brew-my-formula/</id>
    <published>2025-12-02T13:55:05.000Z</published>
    <updated>2025-12-02T09:45:42.092Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %--><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://brew.sh">brew</a>æ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚<code>git</code>ã€<code>node</code>ã€<code>python</code>ç­‰ã€‚</p></li><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹åˆ›å»ºè‡ªå·±çš„ Formula</p></li><li class="lvl-2"><p>æœ¬æ–‡åŸºäº MacOS 15.7.2ï¼Œbrew ç‰ˆæœ¬ä¸º Homebrew 5.0.3ã€‚</p></li><li class="lvl-2"><p>å…³äº brew çš„å®‰è£…åŠä½¿ç”¨å¯ä»¥å‚è€ƒ <a href="/2024/11/28/brew/" title="MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew">MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew</a></p></li></ul><span id="more"></span><h2 id="ä»ä¸€ä¸ªç®€å•ç¤ºä¾‹å¼€å§‹">ä»ä¸€ä¸ªç®€å•ç¤ºä¾‹å¼€å§‹</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œä½¿ç”¨æˆ‘è‡ªå·±ç¼–å†™çš„ä¸€ä¸ªå‘½ä»¤è¡Œè„šæœ¬ä¸ºä¾‹ï¼Œè„šæœ¬åç§°ï¼šcolor_echoï¼Œå…·ä½“å†…å®¹å¯ä»¥æŸ¥çœ‹<a href="https://github.com/hanqunfeng/color_echo/blob/main/bin/color_echo">color_echo</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºç»ˆç«¯æ‰“å°å½©è‰²æ–‡æœ¬çš„å‘½ä»¤ã€‚</p></li></ul><h3 id="åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œç”¨äºå­˜å‚¨-color-echo-å‘½ä»¤">åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œç”¨äºå­˜å‚¨ color_echo å‘½ä»¤</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œç”¨äºå­˜å‚¨ <code>color_echo</code> å‘½ä»¤æ–‡ä»¶ï¼Œä»“åº“åç§°: <code>hanqunfeng/color_echo</code></p></li><li class="lvl-2"><p>ç¼–å†™å‘½ä»¤æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> color_echo_dir</span><br><span class="line"><span class="built_in">cd</span> color_echo_dir</span><br><span class="line"><span class="comment"># æ„Ÿå…´è¶£çš„è‡ªå·±å»githubä¸ŠæŸ¥çœ‹æ–‡ä»¶å†…å®¹å§ï¼Œè¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†</span></span><br><span class="line"><span class="comment"># è¿™é‡Œå°†å‘½ä»¤å­˜å‚¨åœ¨äº† bin ç›®å½•ä¸‹ï¼Œè¿™ä¸ªè·¯å¾„åé¢ç¼–å†™ Formula æ–‡ä»¶æ—¶ä¼šç”¨åˆ°</span></span><br><span class="line">bin/color_echo</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æäº¤ä»£ç å¹¶æ‰“Tag</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ color_echo_dir ç›®å½•ä¸‹åˆå§‹åŒ–ä»“åº“</span></span><br><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;Initial commit&quot;</span></span><br><span class="line">git branch -M main</span><br><span class="line">git remote add origin https://github.com/hanqunfeng/color_echo.git</span><br><span class="line">git push -u origin main</span><br><span class="line"><span class="comment"># åˆ›å»ºTag</span></span><br><span class="line">git tag v1.0.0</span><br><span class="line"><span class="comment"># æ¨é€Tag</span></span><br><span class="line">git push --tags</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è·å–tagçš„sha256å€¼</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/hanqunfeng/color_echo/archive/refs/tags/v1.0.0.tar.gz</span><br><span class="line">shasum -a 256 v1.0.0.tar.gz</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">9450952a4b477c83ea2d7e28386d6ae38132bf68c46746aa218c03c21aa75f6d  v1.0.0.tar.gz</span><br></pre></td></tr></table></figure><h3 id="å‘å¸ƒ-color-echo">å‘å¸ƒ color_echo</h3><blockquote><p><code>brew create</code> å‘½ä»¤å·²ç»å¤±æ•ˆï¼Œéœ€è¦æ‰‹å·¥åˆ›å»º</p></blockquote><h4 id="åˆ›å»º-tap-ä»“åº“">åˆ›å»º tap ä»“åº“</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">brew tap-new hanqunfeng/color_echo</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Warning: tap-new is a developer <span class="built_in">command</span>, so Homebrew<span class="string">&#x27;s</span></span><br><span class="line"><span class="string">developer mode has been automatically turned on.      # æç¤ºå¼€å‘è€…æ¨¡å¼å·²è‡ªåŠ¨æ‰“å¼€</span></span><br><span class="line"><span class="string">To turn developer mode off, run:</span></span><br><span class="line"><span class="string">  brew developer off  # å¦‚åç»­éœ€è¦å…³é—­å¼€å‘è€…æ¨¡å¼å¯ä»¥è¿è¡Œè¯¥å‘½ä»¤</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## åˆå§‹åŒ–ä»“åº“</span></span><br><span class="line"><span class="string">Initialized empty Git repository in /usr/local/Homebrew/Library/Taps/hanqunfeng/homebrew-color_echo/.git/</span></span><br><span class="line"><span class="string">[main (root-commit) 35d602b] Create hanqunfeng/color_echo tap</span></span><br><span class="line"><span class="string"> 3 files changed, 107 insertions(+)</span></span><br><span class="line"><span class="string"> create mode 100644 .github/workflows/publish.yml</span></span><br><span class="line"><span class="string"> create mode 100644 .github/workflows/tests.yml</span></span><br><span class="line"><span class="string"> create mode 100644 README.md</span></span><br><span class="line"><span class="string">==&gt; Created hanqunfeng/color_echo</span></span><br><span class="line"><span class="string">/usr/local/Homebrew/Library/Taps/hanqunfeng/homebrew-color_echo</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">When a pull request making changes to a formula (or formulae) becomes green</span></span><br><span class="line"><span class="string">(all checks passed), then you can publish the built bottles.</span></span><br><span class="line"><span class="string">To do so, label your PR as `pr-pull` and the workflow will be triggered.</span></span><br></pre></td></tr></table></figure><h4 id="æ‰‹å†™ä¸€ä¸ª-Formula-æ–‡ä»¶">æ‰‹å†™ä¸€ä¸ª Formula æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/Homebrew/Library/Taps/hanqunfeng/homebrew-color_echo/Formula</span><br><span class="line"><span class="built_in">touch</span> color_echo.rb</span><br></pre></td></tr></table></figure><p>å†™å…¥å†…å®¹ï¼ˆæ¨¡æ¿ï¼‰ï¼šæ¨¡æ¿æ ¼å¼åé¢ä¼šè¯¦ç»†ä»‹ç»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class ColorEcho &lt; Formula</span><br><span class="line">  desc <span class="string">&quot;Print colorful text in terminal&quot;</span></span><br><span class="line">  homepage <span class="string">&quot;https://github.com/hanqunfeng/color_echo&quot;</span></span><br><span class="line">  url <span class="string">&quot;https://github.com/hanqunfeng/color_echo/archive/refs/tags/v1.0.0.tar.gz&quot;</span></span><br><span class="line">  sha256 <span class="string">&quot;9450952a4b477c83ea2d7e28386d6ae38132bf68c46746aa218c03c21aa75f6d&quot;</span></span><br><span class="line">  license <span class="string">&quot;MIT&quot;</span></span><br><span class="line"></span><br><span class="line">  def install</span><br><span class="line">    bin.install <span class="string">&quot;bin/color_echo&quot;</span></span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  <span class="built_in">test</span> <span class="keyword">do</span></span><br><span class="line">    system <span class="string">&quot;#&#123;bin&#125;/color_echo&quot;</span>, <span class="string">&quot;--help&quot;</span></span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h4 id="æäº¤-Formula-æ–‡ä»¶åˆ°Githubä»“åº“">æäº¤ Formula æ–‡ä»¶åˆ°Githubä»“åº“</h4><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œç”¨äºå­˜å‚¨ Formula æ–‡ä»¶: <code>hanqunfeng/homebrew-color_echo</code></p></li><li class="lvl-2"><p>æ·»åŠ  Formula æ–‡ä»¶åˆ°ä»“åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> $(brew --repo hanqunfeng/color_echo)</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;Add color_echo 1.0.0&quot;</span></span><br><span class="line">git remote add origin https://github.com/hanqunfeng/homebrew-color_echo.git</span><br><span class="line">git push -u origin main</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Enumerating objects: 11, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (11/11), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 12 threads</span><br><span class="line">Compressing objects: 100% (9/9), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (11/11), 2.11 KiB | 2.11 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 11 (delta 0), reused 0 (delta 0), pack-reused 0 (from 0)</span><br><span class="line">To https://github.com/hanqunfeng/homebrew-color_echo.git</span><br><span class="line">! [remote rejected] main -&gt; main (refusing to allow a Personal Access Token to create or update workflow `.github/workflows/publish.yml` without `workflow` scope)</span><br><span class="line">error: failed to push some refs to <span class="string">&#x27;https://github.com/hanqunfeng/homebrew-color_echo.git&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æç¤ºç¼ºå°‘æƒé™ï¼Œéœ€è¦ç»™ä»“åº“æ·»åŠ æƒé™ã€‚åœ¨ Github ä¸­æ·»åŠ ä¸€ä¸ª Personal Access Tokenï¼Œå¹¶æ·»åŠ æƒé™<code>repo</code> å’Œ <code>workflow</code>ï¼Œé‡æ–°æ¨é€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®è¿œç¨‹ä»“åº“åœ°å€ï¼Œæ³¨æ„æ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€ï¼Œå¹¶ä¸”å¯†é’¥æ›¿æ¢ä¸ºå®é™…çš„å¯†é’¥</span></span><br><span class="line">git remote set-url origin https://ghp_xxxxx@github.com/hanqunfeng/homebrew-color_echo.git</span><br><span class="line">git push -u origin main</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Enumerating objects: 11, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (11/11), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 12 threads</span><br><span class="line">Compressing objects: 100% (9/9), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (11/11), 2.11 KiB | 2.11 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 11 (delta 0), reused 0 (delta 0), pack-reused 0 (from 0)</span><br><span class="line">To https://github.com/hanqunfeng/homebrew-color_echo.git</span><br><span class="line">* [new branch]      main -&gt; main</span><br><span class="line">branch <span class="string">&#x27;main&#x27;</span> <span class="built_in">set</span> up to track <span class="string">&#x27;origin/main&#x27;</span>.</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…-Formula">å®‰è£… Formula</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢ tapï¼Œæ³¨æ„: æ‰§è¡Œæœç´¢å’Œå®‰è£…æ—¶éœ€è¦å…ˆåˆ‡æ¢ tapï¼Œå¦åˆ™éœ€è¦ä½¿ç”¨å®Œæ•´åŒ…å hanqunfeng/color_echo/color_echo</span></span><br><span class="line">brew tap hanqunfeng/color_echo</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢</span></span><br><span class="line">brew search color_echo</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">==&gt; Formulae</span><br><span class="line">hanqunfeng/color_echo/color_echo              color-code</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®Œæ•´åŒ…åæœç´¢</span></span><br><span class="line">brew search hanqunfeng/color_echo/color_echo</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">==&gt; Formulae</span><br><span class="line">color_echo</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">brew install color_echo</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">==&gt; Fetching downloads <span class="keyword">for</span>: color_echo</span><br><span class="line">âœ”ï¸ Formula color_echo (1.0.0)                                   [Verifying     2.1KB/  2.1KB]</span><br><span class="line">==&gt; Installing color_echo from hanqunfeng/color_echo</span><br><span class="line">ğŸº  /usr/local/Cellar/color_echo/1.0.0: 4 files, 7.4KB, built <span class="keyword">in</span> 5 seconds</span><br><span class="line">==&gt; Running `brew cleanup color_echo`...</span><br><span class="line">Disable this behaviour by setting `HOMEBREW_NO_INSTALL_CLEANUP=1`.</span><br><span class="line">Hide these hints with `HOMEBREW_NO_ENV_HINTS=1` (see `man brew`).</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-Formula">æµ‹è¯• Formula</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">color_echo --<span class="built_in">help</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">ç”¨æ³•: color_echo [å‚æ•°] å†…å®¹</span><br><span class="line"></span><br><span class="line">å‚æ•°è¯´æ˜:</span><br><span class="line">  -c, --color &lt;color&gt;        è®¾ç½®å‰æ™¯è‰²ï¼ˆæ–‡å­—é¢œè‰²ï¼‰</span><br><span class="line">                             å¯é€‰é¢œè‰²: black red green yellow blue magenta cyan white</span><br><span class="line"></span><br><span class="line">  -b, --<span class="built_in">bg</span> &lt;color&gt;           è®¾ç½®èƒŒæ™¯è‰²</span><br><span class="line">                             å¯é€‰é¢œè‰²: black red green yellow blue magenta cyan white</span><br><span class="line"></span><br><span class="line">      --bold                 åŠ ç²—å­—ä½“</span><br><span class="line">      --underline            ä¸‹åˆ’çº¿</span><br><span class="line">      --italic               æ–œä½“å­—ä½“ï¼ˆä»…éƒ¨åˆ†ç»ˆç«¯,Terminal ä¸æ”¯æŒï¼ŒiTerm2 æ”¯æŒï¼‰</span><br><span class="line"></span><br><span class="line">  -n                         ä¸æ¢è¡Œè¾“å‡ºï¼Œå…¼å®¹ <span class="built_in">echo</span> çš„ -n å‚æ•°</span><br><span class="line"></span><br><span class="line">  -h, --<span class="built_in">help</span>                 æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹:</span><br><span class="line">  color_echo --color green <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  color_echo -c red -b yellow --bold <span class="string">&quot;Error Message&quot;</span></span><br><span class="line">  color_echo --underline <span class="string">&quot;This is underlined&quot;</span></span><br></pre></td></tr></table></figure><h2 id="formula-æ–‡ä»¶æ¨¡æ¿">formula æ–‡ä»¶æ¨¡æ¿</h2><ul class="lvl-0"><li class="lvl-2"><p>Rubyè¯­æ³•ï¼Œå®šä¹‰ä¸€ä¸ªFormulaçš„å­ç±»</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># class å­ç±» &lt; çˆ¶ç±»</span></span><br><span class="line">class ColorEcho &lt; Formula</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ å±æ€§</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">desc <span class="string">&quot;Print colorful text in terminal&quot;</span>  <span class="comment"># æè¿°</span></span><br><span class="line">homepage <span class="string">&quot;https://github.com/hanqunfeng/color_echo&quot;</span>  <span class="comment"># é¡¹ç›®åœ°å€</span></span><br><span class="line">url <span class="string">&quot;https://github.com/hanqunfeng/color_echo/archive/refs/tags/v1.0.0.tar.gz&quot;</span>  <span class="comment"># ä¸‹è½½åœ°å€ï¼Œå®‰è£…æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶è§£å‹</span></span><br><span class="line">sha256 <span class="string">&quot;9450952a4b477c83ea2d7e28386d6ae38132bf68c46746aa218c03c21aa75f6d&quot;</span>  <span class="comment"># sha256ï¼Œæ ¡éªŒv1.0.0.tar.gz</span></span><br><span class="line">license <span class="string">&quot;MIT&quot;</span>   <span class="comment"># è®¸å¯</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ å®‰è£…æ–¹æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def install  <span class="comment"># Homebrew ä¼šæ‰§è¡Œçš„å®‰è£…æ­¥éª¤ï¼Œå·¥ä½œç›®å½•ä¸ºè§£å‹åçš„æ–‡ä»¶ç›®å½•</span></span><br><span class="line">  <span class="comment"># è¿™é‡Œåªæœ‰ä¸€ä¸ªæ­¥éª¤ï¼Œå¦‚æœè¦ä¸€æ¬¡å®‰è£…å¤šä¸ªå‘½ä»¤ï¼Œå¯ä»¥å¤šæ¬¡æ·»åŠ  bin.install</span></span><br><span class="line">  bin.install <span class="string">&quot;bin/color_echo&quot;</span> <span class="comment"># å°† bin/color_echo å®‰è£…åˆ° /usr/local/bin/color_echo</span></span><br><span class="line">  <span class="comment"># å¦‚æœè¦æŒ‡å®šå®‰è£…åçš„å‘½ä»¤åç§°ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼</span></span><br><span class="line">  <span class="comment"># bin.install &quot;bin/color_echo.sh&quot; =&gt; &quot;color_echo&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¦‚æœéœ€è¦æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼</span></span><br><span class="line">  <span class="comment"># system &quot;echo&quot;, &quot;hello world&quot;</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ æµ‹è¯•æ–¹æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span> <span class="keyword">do</span>  <span class="comment"># Homebrew åœ¨å®‰è£…å®Œä½ çš„ formula ä¹‹åï¼Œä¼šåœ¨ä¸€ä¸ªéš”ç¦»ç¯å¢ƒä¸­æ‰§è¡Œè¿™æ®µä»£ç </span></span><br><span class="line">  <span class="comment"># system æŒ‡ä»¤ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œé€—å·åˆ†éš”ç›¸å½“äºç©ºæ ¼</span></span><br><span class="line">  system <span class="string">&quot;#&#123;bin&#125;/color_echo&quot;</span>, <span class="string">&quot;--help&quot;</span>  <span class="comment"># ç›¸å½“äºæ‰§è¡Œ color_echo --help</span></span><br><span class="line">  <span class="comment"># æ–­è¨€æµ‹è¯•</span></span><br><span class="line">  <span class="comment"># assert_equal &quot;2\n&quot;, pipe_output(&quot;#&#123;bin&#125;/jq .bar&quot;, &#x27;&#123;&quot;foo&quot;:1, &quot;bar&quot;:2&#125;&#x27;)</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure><blockquote><p>#{bin}: å½“å‰è¿™ä¸ª formula çš„ã€Œå®‰è£…ç›®å½•é‡Œçš„ bin ç›®å½•ã€ï¼Œä¸åŒå¹³å°ä¼šä¸åŒ</p></blockquote><table><thead><tr><th>ç³»ç»Ÿ / æ¶æ„</th><th>å®é™…è·¯å¾„ç¤ºä¾‹</th></tr></thead><tbody><tr><td>Intel Mac</td><td><code>/usr/local/Cellar/color_echo/1.0.0/bin</code></td></tr><tr><td>Apple Silicon</td><td><code>/opt/homebrew/Cellar/color_echo/1.0.0/bin</code></td></tr><tr><td>Linuxbrew</td><td><code>/home/linuxbrew/.linuxbrew/Cellar/.../bin</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœå½“å‰å®‰è£…çš„å‘½ä»¤ä¾èµ–å…¶å®ƒå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ·»åŠ ä¾èµ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ”¾åœ¨ def install æ–¹æ³•ä¹‹å‰</span></span><br><span class="line">depends_on <span class="string">&quot;jq&quot;</span> <span class="comment"># åœ¨å®‰è£…ä½ çš„ formula ä¹‹å‰ï¼ŒHomebrew ä¼šå…ˆè‡ªåŠ¨å®‰è£… jqï¼Œå¹¶ä¿è¯åœ¨ä½ çš„ install / test é˜¶æ®µå¯ä»¥ç”¨</span></span><br><span class="line">depends_on <span class="string">&quot;jq&quot;</span> =&gt; :build   <span class="comment"># åªåœ¨æ„å»ºæ—¶éœ€è¦</span></span><br><span class="line">depends_on <span class="string">&quot;jq&quot;</span> =&gt; :<span class="built_in">test</span>    <span class="comment"># æµ‹è¯•æ—¶éœ€è¦</span></span><br><span class="line">depends_on <span class="string">&quot;jq&quot;</span> =&gt; [:build, :<span class="built_in">test</span>] <span class="comment"># æ„å»ºå’Œæµ‹è¯•éƒ½éœ€è¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¯å¢ƒçº¦æŸ</span></span><br><span class="line">depends_on macos: :sonoma          <span class="comment"># ä»… macOS Sonoma</span></span><br><span class="line">depends_on <span class="built_in">arch</span>: :x86_64           <span class="comment"># ä»… x86_64</span></span><br><span class="line">depends_on xcode: [<span class="string">&quot;9.3&quot;</span>, :build]  <span class="comment"># ä»…å½“ Xcodeâ‰¥9.3 ä¸”ç”¨äº build</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾èµ–ç¬¬ä¸‰æ–¹åº“ä¸­çš„å‘½ä»¤è¦ç”¨å®Œæ•´åŒ…å</span></span><br><span class="line">depends_on <span class="string">&quot;hanqunfeng/color_echo/color_echo&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>å…³äºæ›´å¤šçš„ Formula æ–‡ä»¶æ¨¡æ¿ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://docs.brew.sh/Formula-Cookbook">https://docs.brew.sh/Formula-Cookbook</a></p></li><li class="lvl-2"><p>åŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ <code>brew edit xxx</code> å‘½ä»¤æŸ¥çœ‹è¯¥ Formula æ–‡ä»¶çš„å†…å®¹è¿›è¡Œå­¦ä¹ </p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

--&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://brew.sh&quot;&gt;brew&lt;/a&gt;æ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚&lt;code&gt;git&lt;/code&gt;ã€&lt;code&gt;node&lt;/code&gt;ã€&lt;code&gt;python&lt;/code&gt;ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹åˆ›å»ºè‡ªå·±çš„ Formula&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åŸºäº MacOS 15.7.2ï¼Œbrew ç‰ˆæœ¬ä¸º Homebrew 5.0.3ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;å…³äº brew çš„å®‰è£…åŠä½¿ç”¨å¯ä»¥å‚è€ƒ &lt;a href=&quot;/2024/11/28/brew/&quot; title=&quot;MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew&quot;&gt;MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="macos" scheme="https://blog.hanqunfeng.com/categories/macos/"/>
    
    
    <category term="macos" scheme="https://blog.hanqunfeng.com/tags/macos/"/>
    
    <category term="brew" scheme="https://blog.hanqunfeng.com/tags/brew/"/>
    
  </entry>
  
  <entry>
    <title>Linuxå¸¸ç”¨å‘½ä»¤--lsof</title>
    <link href="https://blog.hanqunfeng.com/2025/11/26/linux-command16-lsof/"/>
    <id>https://blog.hanqunfeng.com/2025/11/26/linux-command16-lsof/</id>
    <published>2025-11-26T13:30:05.000Z</published>
    <updated>2025-11-27T02:50:52.836Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote % --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» lsof å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•</p></li><li class="lvl-2"><p>æœ¬æ–‡åŸºäºCentOS8ã€‚</p></li></ul><span id="more"></span><h2 id="lsof-æ˜¯ä»€ä¹ˆï¼Ÿ">lsof æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul class="lvl-0"><li class="lvl-2"><p>lsof = list open files</p></li><li class="lvl-2"><p>å®ƒç”¨æ¥æŸ¥çœ‹ï¼š</p><ul class="lvl-2"><li class="lvl-4">å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶</li><li class="lvl-4">åŒ…å«æ™®é€šæ–‡ä»¶ã€ç›®å½•ã€socketã€ç®¡é“ã€ç½‘ç»œè¿æ¥ã€è®¾å¤‡ç­‰</li></ul></li><li class="lvl-2"><p>åœ¨ Linux ä¸­ï¼šâ€œä¸€åˆ‡çš†æ–‡ä»¶â€</p></li><li class="lvl-2"><p>æ‰€ä»¥ä½ å¯ä»¥ç”¨ lsof æŸ¥çœ‹ï¼š</p><ul class="lvl-2"><li class="lvl-4">è°åœ¨å ç”¨ä½ çš„ç«¯å£ï¼Ÿ</li><li class="lvl-4">å“ªä¸ªè¿›ç¨‹æ­£åœ¨è¯»/å†™æŸä¸ªæ–‡ä»¶ï¼Ÿ</li><li class="lvl-4">ä¸ºä»€ä¹ˆæ–‡ä»¶åˆ é™¤äº†å´è¿˜å ç£ç›˜ï¼Ÿ</li><li class="lvl-4">å“ªä¸ªæ–‡ä»¶è¢«é”ä½ï¼Ÿ</li><li class="lvl-4">å“ªäº›ç¨‹åºåœ¨è®¿é—®æŸä¸ªç›®å½•ï¼Ÿ</li></ul></li><li class="lvl-2"><p>CentOS é»˜è®¤åŒ…å« lsofï¼Œä½†å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥é€šè¿‡ yum å®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install lsof -y</span><br></pre></td></tr></table></figure><h2 id="lsof-çš„åŸºæœ¬ç”¨æ³•">lsof çš„åŸºæœ¬ç”¨æ³•</h2><h3 id="æŸ¥çœ‹è¢«åˆ é™¤ä½†ä»è¢«å ç”¨çš„æ–‡ä»¶">æŸ¥çœ‹è¢«åˆ é™¤ä½†ä»è¢«å ç”¨çš„æ–‡ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœè¿›ç¨‹æ­£åœ¨è¿è¡Œä¸”ä¿æŒæ–‡ä»¶çš„å¥æŸ„ï¼Œæ­¤æ—¶æ²¡æœ‰åœæ­¢è¿›ç¨‹å°±æ‰§è¡Œäº†<code>rm</code>å‘½ä»¤ï¼Œæ­¤æ—¶æ–‡ä»¶çš„**ç›®å½•é¡¹ï¼ˆåå­—ï¼‰**è¢«åˆ é™¤ï¼Œä½†æ˜¯æ–‡ä»¶æ•°æ®æœ¬èº«æ²¡æœ‰è¢«åˆ é™¤ï¼Œåªè¦æœ‰è¿›ç¨‹è¿˜åœ¨æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼ˆä¿æŒæ–‡ä»¶å¥æŸ„ï¼‰ï¼Œå®ƒå°±ç»§ç»­å ç”¨ç£ç›˜ç©ºé—´ã€‚</p></li><li class="lvl-2"><p>æ–‡ä»¶å·²ç»è¢«åˆ é™¤ï¼ˆunlinkï¼‰ï¼Œä½†è¿›ç¨‹ä»ç„¶æŒæœ‰è¯¥æ–‡ä»¶çš„æ‰“å¼€å¥æŸ„ï¼Œè¿™ç§æ–‡ä»¶åœ¨ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> ä¸­çœ‹ä¸åˆ°</span><br><span class="line"><span class="built_in">du</span> ä¸ä¼šç»Ÿè®¡ç©ºé—´</span><br><span class="line">åªæœ‰ lsof èƒ½çœ‹åˆ°ï¼Œè¿™æ˜¯å…¸å‹çš„ â€œdeleted but still openâ€ çŠ¶æ€ã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢å“ªäº›è¢«åˆ é™¤çš„æ–‡ä»¶è¿˜è¢«å ç”¨ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰ link count å°äº 1 çš„ï¼ˆdeletedï¼‰æ–‡ä»¶</span></span><br><span class="line">lsof +L1</span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰è¢«åˆ é™¤çš„æ–‡ä»¶</span></span><br><span class="line">lsof | grep deleted</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœæŸ¥è¯¢åˆ°è¿™ç§æ–‡ä»¶ï¼Œåˆ™éœ€è¦åœæ­¢è¿›ç¨‹ï¼Œæ‰èƒ½çœŸæ­£åˆ é™¤æ–‡ä»¶ã€‚</p></li></ul><div class="tips"><p><em><strong>è®°ä¸€æ¬¡çº¿ä¸ŠæœåŠ¡å™¨ç£ç›˜ç©ºé—´å‘Šè­¦é—®é¢˜æ’æŸ¥</strong></em></p><ul class="lvl-1"><li class="lvl-2">ç›‘æ§ç³»ç»Ÿå‘Šè­¦ç£ç›˜ç©ºé—´å°äº15%ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ç¡®å®å¦‚æ­¤</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">df</span> -hT</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">Filesystem Type  Size Used Avail Use% Mounted on</span><br><span class="line">/dev/xvda1 ext4  7.9G 3.3G 4.6G  42%  /</span><br><span class="line">tmpfs      tmpfs 2.0G 0    2.0G  0%   /dev/shm</span><br><span class="line">/dev/xvdf1 ext4  99G  80G  15G   85%  /usr/local/boss/logs</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">ä½†é€šè¿‡å¦‚ä¸‹å‘½ä»¤å…·ä½“æŸ¥çœ‹ç›®å½•å ç”¨ç©ºé—´æ—¶ï¼Œå‘ç°å ç”¨çš„ç©ºé—´æ¯”å®é™…å ç”¨çš„ç©ºé—´å°‘å¾ˆå¤š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">du</span> -sh /usr/local/boss/logs</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">2.3G    /usr/local/boss/logs</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">æ­¤æ—¶æƒ³åˆ°å¯èƒ½æ˜¯åˆ é™¤çš„æ–‡ä»¶å¥æŸ„æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lsof +L1</span><br><span class="line"><span class="comment">## è¾“å‡ºç¤ºä¾‹ï¼ŒNLINK:ç¡¬é“¾æ¥æ•°é‡ï¼ˆNumber of Linksï¼‰ï¼Œ=0 è¡¨ç¤ºæ–‡ä»¶è¢«åˆ é™¤ï¼Œä½†æ˜¯è¿›ç¨‹æ²¡æœ‰é‡Šæ”¾æ–‡ä»¶å¥æŸ„</span></span><br><span class="line">COMMAND    PID      USER    FD      TYPE    DEVICE  SIZE/OFF      NLINK   NODE    NAME</span><br><span class="line">java       1836     boss    1w      REG     202,81  82677994584   0       917554  /usr/local/boss/logs/tomcat_log/catalina.out (deleted)</span><br><span class="line">java       1836     boss    2w      REG     202,81  82677994584   0       917554  /usr/local/boss/logs/tomcat_log/catalina.out (deleted)</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">ç»“æœå¦‚é¢„æœŸï¼Œè¿™æ˜¯ä¸€ä¸ªtomcatè¿›ç¨‹ï¼Œåº”è¯¥æ˜¯åˆ é™¤äº†å…¶æ—¥å¿—æ–‡ä»¶ï¼Œä½†æ˜¯åˆ é™¤æ—¶æ²¡æœ‰åœæ­¢tomcatè¿›ç¨‹ï¼Œå¯¼è‡´æ–‡ä»¶è¢«ç»§ç»­å ç”¨ï¼Œæ­¤æ—¶å·²ç»å ç”¨äº†80å¤šä¸ªGçš„ç£ç›˜ç©ºé—´ï¼Œå¦‚æœè¦é‡Šæ”¾ç£ç›˜ç©ºé—´éœ€è¦åœæ­¢tomcatã€‚</li></ul></div><h3 id="æŸ¥ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨">æŸ¥ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæŒ‡å®šç«¯å£å¯¹åº”çš„è¿›ç¨‹</span></span><br><span class="line">lsof -i tcp:8080</span><br><span class="line"><span class="comment"># åè®®å¯ä»¥çœç•¥</span></span><br><span class="line">lsof -i :8080</span><br><span class="line"><span class="comment">## è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">COMMAND   PID USER   FD   TYPE     DEVICE SIZE/OFF NODE NAME</span><br><span class="line">java    18548 boss   39u  IPv6 1251548211      0t0  TCP *:webcache (LISTEN)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æœåŠ¡åç§°æ›¿æ¢ä¸ºç«¯å£</span></span><br><span class="line">lsof -i :8080 -P</span><br><span class="line"><span class="comment">## è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">COMMAND   PID USER   FD   TYPE     DEVICE SIZE/OFF NODE NAME</span><br><span class="line">java    18548 boss   39u  IPv6 1251548211      0t0  TCP *:8080 (LISTEN)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶">æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lsof -p &lt;PID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">COMMAND   PID USER   FD   TYPE     DEVICE  SIZE/OFF       NODE NAME</span><br><span class="line">java    18548 boss  cwd    DIR      202,1      4096      35377 /home/boss</span><br><span class="line">java    18548 boss  rtd    DIR      202,1      4096          2 /</span><br><span class="line">java    18548 boss  mem    REG      202,1 106065056      60671 /usr/lib/locale/locale-archive</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>èƒ½çœ‹åˆ°è¿™ä¸ªè¿›ç¨‹ï¼š</p><ul class="lvl-2"><li class="lvl-4">æ‰“å¼€çš„æ—¥å¿—æ–‡ä»¶</li><li class="lvl-4">ä½¿ç”¨çš„ jar æ–‡ä»¶</li><li class="lvl-4">ä½¿ç”¨çš„ socket</li><li class="lvl-4">ä½¿ç”¨çš„ config æ–‡ä»¶</li></ul></li><li class="lvl-2"><p>è¾“å‡ºç»“æœå­—æ®µè¯´æ˜</p></li></ul><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>COMMAND</td><td>ç¨‹åºåï¼ˆjavaï¼‰</td></tr><tr><td>PID</td><td>è¿›ç¨‹å·ï¼ˆ18548ï¼‰</td></tr><tr><td>USER</td><td>è¿è¡Œç”¨æˆ·ï¼ˆbossï¼‰</td></tr><tr><td>FD</td><td>æ–‡ä»¶æè¿°ç¬¦</td></tr><tr><td>TYPE</td><td>æ–‡ä»¶ç±»å‹</td></tr><tr><td>DEVICE</td><td>æ‰€åœ¨ç£ç›˜åˆ†åŒº ID</td></tr><tr><td>SIZE/OFF</td><td>æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰</td></tr><tr><td>NODE</td><td>inode ç¼–å·</td></tr><tr><td>NAME</td><td>æ–‡ä»¶åï¼ˆæˆ–ç½‘ç»œè¿æ¥ä¿¡æ¯ï¼‰</td></tr></tbody></table><h3 id="æŸ¥çœ‹æŒ‡å®šç”¨æˆ·å ç”¨çš„æ–‡ä»¶">æŸ¥çœ‹æŒ‡å®šç”¨æˆ·å ç”¨çš„æ–‡ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºç”¨æˆ· boss æ‰€æœ‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶</span></span><br><span class="line">lsof -u &lt;USER&gt;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æŒ‡å®šç¨‹åº-COMMAND-æ‰“å¼€çš„æ–‡ä»¶">æŸ¥çœ‹æŒ‡å®šç¨‹åº(COMMAND)æ‰“å¼€çš„æ–‡ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -c &lt;<span class="built_in">command</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥æŸä¸ªç›®å½•æˆ–æ–‡ä»¶æ­£åœ¨è¢«å“ªäº›è¿›ç¨‹å ç”¨">æŸ¥æŸä¸ªç›®å½•æˆ–æ–‡ä»¶æ­£åœ¨è¢«å“ªäº›è¿›ç¨‹å ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›®å½• +D</span></span><br><span class="line"><span class="comment"># èƒ½æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è®¿é—®è¯¥ç›®å½•ä¸­æ–‡ä»¶çš„è¿›ç¨‹</span></span><br><span class="line">lsof +D /home/boss/logs</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶</span></span><br><span class="line">lsof /home/boss/logs/access.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªåˆ—å‡º nginx ç”¨æˆ·å ç”¨çš„æ–‡ä»¶ç›®å½•ä¸­çš„å“ªäº›æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># -a: é€»è¾‘ä¸ï¼Œä¸åŠ  -a åˆ™è¡¨ç¤º é€»è¾‘æˆ–</span></span><br><span class="line">lsof -a -u nginx +D /usr/local/nginx/logs</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç½‘ç»œè¿æ¥">æŸ¥çœ‹ç½‘ç»œè¿æ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">lsof -i</span><br><span class="line"><span class="comment"># è¿‡æ»¤åè®®</span></span><br><span class="line">lsof -i tcp</span><br><span class="line">lsof -i udp</span><br><span class="line"><span class="comment"># è¿‡æ»¤çŠ¶æ€</span></span><br><span class="line">lsof -i -s tcp:listen</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰ç›‘å¬ç«¯å£ï¼Œ</span></span><br><span class="line"><span class="comment"># -i: æ˜¾ç¤ºç½‘ç»œç›¸å…³çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># -P: æ˜¾ç¤ºç«¯å£(ä¸åŠ -Påˆ™æ˜¾ç¤ºçš„æ˜¯æœåŠ¡å)</span></span><br><span class="line"><span class="comment"># -n: ä¸å°† IP æ˜ å°„æˆä¸»æœºåï¼ˆç¦ç”¨ DNS æŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="comment"># -s: è¿‡æ»¤æ˜¾ç¤ºè¿æ¥çŠ¶æ€</span></span><br><span class="line">lsof -i -P -n -s tcp:listen</span><br><span class="line"><span class="comment">## è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">mongod     1782     root    5u  IPv4       8697      0t0  TCP *:27017 (LISTEN)</span><br><span class="line">java       1808     boss   36u  IPv6       9221      0t0  TCP *:8082 (LISTEN)</span><br><span class="line">java       1808     boss   39u  IPv6       9230      0t0  TCP 127.0.0.1:7093 (LISTEN)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºç”¨æˆ· boss çš„ç½‘ç»œè¿æ¥</span></span><br><span class="line"><span class="comment"># -a: é€»è¾‘ä¸ï¼Œä¸åŠ  -a åˆ™è¡¨ç¤º é€»è¾‘æˆ–</span></span><br><span class="line">lsof -a -u boss -i</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨å‚æ•°è¯¦è§£">å¸¸ç”¨å‚æ•°è¯¦è§£</h2><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>-i</code></td><td>æŸ¥çœ‹ç½‘ç»œç›¸å…³æ–‡ä»¶/ç«¯å£</td><td><code>lsof -i</code></td></tr><tr><td><code>-i :ç«¯å£</code></td><td>æŸ¥çœ‹æŒ‡å®šç«¯å£</td><td><code>lsof -i :8080</code></td></tr><tr><td><code>-p PID</code></td><td>æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ‰€æœ‰æ‰“å¼€æ–‡ä»¶</td><td><code>lsof -p 1836</code></td></tr><tr><td><code>-u ç”¨æˆ·å</code></td><td>æŸ¥çœ‹æŸä¸ªç”¨æˆ·è¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶</td><td><code>lsof -u nginx</code></td></tr><tr><td><code>-c è¿›ç¨‹åå…³é”®å­—</code></td><td>æŸ¥çœ‹æŸä¸ªè¿›ç¨‹åç›¸å…³çš„æ–‡ä»¶</td><td><code>lsof -c java</code></td></tr><tr><td><code>+D ç›®å½•</code></td><td>æŸ¥çœ‹ç›®å½•ä¸­æ‰€æœ‰è¢«è®¿é—®çš„æ–‡ä»¶</td><td><code>lsof +D /usr/local/netqin/boss/netqin/logs</code></td></tr><tr><td><code>+L1</code></td><td>æŸ¥æ‰¾å·²åˆ é™¤ä½†ä»è¢«æ‰“å¼€çš„æ–‡ä»¶</td><td><code>lsof +L1</code>ï¼ˆ=æŸ¥æ‰¾â€œ(deleted)â€å ç›˜é—®é¢˜ï¼‰</td></tr><tr><td><code>-d FD</code></td><td>æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦</td><td><code>lsof -d 1 -p 1836</code>ï¼ˆçœ‹è¿›ç¨‹ stdoutï¼‰</td></tr><tr><td><code>-n</code></td><td>ä¸åš DNS è§£æï¼Œæé«˜é€Ÿåº¦</td><td><code>lsof -i -n</code></td></tr><tr><td><code>-P</code></td><td>æ˜¾ç¤ºç«¯å£å·ï¼ˆä¸è§£æä¸ºæœåŠ¡åï¼‰</td><td><code>lsof -i -P</code></td></tr><tr><td><code>-s</code></td><td>æŒ‰è¿æ¥çŠ¶æ€è¿‡æ»¤ï¼ˆTCP/UDPï¼‰</td><td><code>lsof -i -sTCP:LISTEN</code></td></tr><tr><td><code>-r</code></td><td>æŒç»­è¾“å‡ºï¼ˆå®æ—¶ç›‘æ§ï¼‰</td><td><code>lsof -i -r 1</code>ï¼ˆæ¯ç§’åˆ·æ–°ç½‘ç»œè¿æ¥ï¼‰</td></tr><tr><td><code>-a</code></td><td>é€»è¾‘ ANDï¼Œä¸åŠ  -a éƒ½æ˜¯ é€»è¾‘ OR</td><td><code>lsof -u boss -i</code>ï¼ˆåˆ—å‡ºç”¨æˆ· boss çš„ç½‘ç»œè¿æ¥ï¼‰</td></tr></tbody></table><h2 id="lsof-æ–‡ä»¶-FD-å­—æ®µè¯¦ç»†è§£é‡Š">lsof æ–‡ä»¶ FD å­—æ®µè¯¦ç»†è§£é‡Š</h2><ul class="lvl-0"><li class="lvl-2"><p>FDï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰æ ¼å¼æ€»è§„åˆ™ï¼šæ•°å­— + æ ‡å¿—ä½</p></li><li class="lvl-2"><p>lsof è¾“å‡ºä¸­çš„ FDï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰åˆ—ï¼Œæ¯ä¸€ä¸ªéƒ½ä»£è¡¨è¿›ç¨‹æ‰“å¼€çš„ä¸€ä¸ªâ€œæ–‡ä»¶â€ï¼ˆåŒ…æ‹¬æ™®é€šæ–‡ä»¶ã€ç›®å½•ã€è®¾å¤‡ã€socketã€pipe ç­‰ï¼‰ã€‚</p></li><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10r   â†’ FD=10ï¼Œ<span class="built_in">read</span> onlyï¼ˆåªè¯»ï¼‰</span><br><span class="line">1w    â†’ FD=1ï¼Œwrite onlyï¼ˆåªå†™ï¼‰</span><br><span class="line">36u   â†’ FD=36ï¼Œ<span class="built_in">read</span>/writeï¼ˆå¯è¯»å¯å†™ï¼‰</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è§£é‡Š</p></li></ul><table><thead><tr><th>éƒ¨åˆ†</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><strong>æ•°å­—ï¼ˆ0ã€1ã€2ã€3ã€10ã€36â€¦ï¼‰</strong></td><td>æ–‡ä»¶æè¿°ç¬¦ç¼–å·</td></tr><tr><td><strong>å­—æ¯ï¼ˆr / w / uï¼‰</strong></td><td>è®¿é—®æ¨¡å¼ï¼šè¯»/å†™/è¯»å†™</td></tr></tbody></table><table><thead><tr><th>FD ç¼–å·</th><th>æ ‡å‡†å«ä¹‰</th></tr></thead><tbody><tr><td><strong>0</strong></td><td>stdinï¼ˆæ ‡å‡†è¾“å…¥ï¼‰</td></tr><tr><td><strong>1</strong></td><td>stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰</td></tr><tr><td><strong>2</strong></td><td>stderrï¼ˆæ ‡å‡†é”™è¯¯è¾“å‡ºï¼‰</td></tr><tr><td><strong>3</strong> åŠä»¥ä¸Š</td><td>è¿›ç¨‹æ‰“å¼€çš„æ™®é€šæ–‡ä»¶ã€æ—¥å¿—ã€socketã€ç®¡é“ç­‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç‰¹æ®Š FD ç±»å‹ï¼ˆæ²¡æœ‰æ•°å­—ï¼‰</p></li></ul><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>cwd</code></td><td>å½“å‰å·¥ä½œç›®å½•ï¼Œè¯´æ˜è¿›ç¨‹åœ¨è¿™ä¸ªç›®å½•ä¸‹è¿è¡Œ</td></tr><tr><td><code>rtd</code></td><td>è¿›ç¨‹çš„æ ¹ç›®å½•ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ /ï¼Œå®¹å™¨é‡Œå¯èƒ½æ˜¯åˆ«çš„ rootfs</td></tr><tr><td><code>txt</code></td><td>å¯æ‰§è¡Œæ–‡ä»¶æœ¬ä½“</td></tr><tr><td><code>mem</code></td><td>å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰æ–‡ä»¶ï¼Œè¿›ç¨‹åŠ è½½åˆ°å†…å­˜ä¸­çš„åº“ / jar / so æ–‡ä»¶</td></tr></tbody></table><h2 id="lsof-æ–‡ä»¶-TYPE-å­—æ®µè¯¦ç»†è§£é‡Š">lsof æ–‡ä»¶ TYPE å­—æ®µè¯¦ç»†è§£é‡Š</h2><table><thead><tr><th>æ–‡ä»¶ç±»å‹</th><th>å…¨ç§°</th><th>å«ä¹‰</th><th>å¸¸è§åœºæ™¯</th></tr></thead><tbody><tr><td><strong>REG</strong></td><td>Regular file</td><td>æ™®é€šæ–‡ä»¶</td><td>æ—¥å¿—ã€é…ç½®ã€å¯æ‰§è¡Œç¨‹åºç­‰</td></tr><tr><td><strong>DIR</strong></td><td>Directory</td><td>ç›®å½•</td><td>è¿›ç¨‹è®¿é—®çš„ç›®å½•ï¼Œä¾‹å¦‚å½“å‰å·¥ä½œç›®å½•</td></tr><tr><td><strong>CHR</strong></td><td>Character special file</td><td>å­—ç¬¦è®¾å¤‡æ–‡ä»¶</td><td><code>/dev/null</code>ã€<code>/dev/tty</code>ã€ä¸²å£ã€é”®ç›˜ç­‰</td></tr><tr><td><strong>BLK</strong></td><td>Block special file</td><td>å—è®¾å¤‡æ–‡ä»¶</td><td><code>/dev/sda</code>ã€ç¡¬ç›˜ã€åˆ†åŒºç­‰</td></tr><tr><td><strong>FIFO</strong></td><td>Named pipe</td><td>å‘½åç®¡é“</td><td>Linux è¿›ç¨‹é—´é€šä¿¡ï¼Œå¦‚ Nginx å’Œ PHP-FPM çš„é€šä¿¡</td></tr><tr><td><strong>sock</strong></td><td>Socket</td><td>å¥—æ¥å­—ï¼ˆUnix åŸŸ socketï¼‰</td><td><code>/var/run/docker.sock</code>ã€MySQL UNix socket</td></tr><tr><td><strong>IPv4</strong></td><td>IPv4 socket</td><td>IPv4 ç½‘ç»œè¿æ¥/ç›‘å¬</td><td><code>TCP *:80</code>ã€<code>UDP 127.0.0.1:53</code></td></tr><tr><td><strong>IPv6</strong></td><td>IPv6 socket</td><td>IPv6 ç½‘ç»œè¿æ¥/ç›‘å¬</td><td><code>TCP [::]:22</code></td></tr><tr><td><strong>unix</strong></td><td>Unix domain socket</td><td>æœ¬åœ°è¿›ç¨‹é€šä¿¡</td><td><code>/run/systemd/journal/stdout</code></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» lsof å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åŸºäºCentOS8ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="linux" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/linux/"/>
    
    <category term="linuxå¸¸ç”¨å‘½ä»¤" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/linux/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    
    
    <category term="linuxå¸¸ç”¨å‘½ä»¤" scheme="https://blog.hanqunfeng.com/tags/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>ä»€ä¹ˆæ˜¯ UTCï¼Ÿä¸€ç¯‡äººäººéƒ½èƒ½çœ‹æ‡‚çš„ç§‘æ™®æ–‡ç« </title>
    <link href="https://blog.hanqunfeng.com/2025/11/20/utc/"/>
    <id>https://blog.hanqunfeng.com/2025/11/20/utc/</id>
    <published>2025-11-20T14:30:05.000Z</published>
    <updated>2025-11-20T08:36:36.524Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å¬åˆ°â€œUTC æ—¶é—´â€â€œåŒ—äº¬æ—¶é—´ UTC+8â€â€œæœåŠ¡å™¨æ—¶é—´æ˜¯ UTCâ€ï¼Œä½†è®¸å¤šäººå¹¶ä¸äº†è§£ UTC åˆ°åº•æ˜¯ä»€ä¹ˆã€‚æœ¬æ–‡å°†ç”¨å°½é‡ç®€å•çš„æ–¹å¼ï¼Œå¸¦ä½ ææ¸…æ¥šç°ä»£ä¸–ç•Œæ‰€ä¾èµ–çš„å…¨çƒé€šç”¨æ—¶é—´æ ‡å‡†â€”â€”UTCã€‚</p></li></ul><span id="more"></span><h2 id="ä¸€ã€ä¸ºä»€ä¹ˆä¸–ç•Œéœ€è¦ç»Ÿä¸€æ—¶é—´ï¼Ÿ">ä¸€ã€ä¸ºä»€ä¹ˆä¸–ç•Œéœ€è¦ç»Ÿä¸€æ—¶é—´ï¼Ÿ</h2><p>æ—©æœŸï¼Œæ¯ä¸ªåŸå¸‚ç”šè‡³æ¯ä¸ªä¹¡é•‡éƒ½æ ¹æ® <strong>å¤ªé˜³ä½ç½®</strong>ç¡®å®šæ—¶é—´ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>å¤ªé˜³åœ¨å¤´é¡¶å°±æ˜¯ 12 ç‚¹</p></li><li class="lvl-2"><p>ä¸åŒåœ°æ–¹ç»åº¦ä¸åŒï¼Œæ¯åœ°æ—¶é—´éƒ½ä¸åŒ</p></li></ul><p>è¿™ç§æ–¹æ³•åœ¨æœ¬åœ°æ²¡é—®é¢˜ï¼Œä½†åˆ°äº† <strong>è·¨åŒºåŸŸé“è·¯ã€é€šä¿¡ã€èˆªæµ·ã€èˆªç©ºã€äº’è”ç½‘æ—¶ä»£</strong>ï¼Œé—®é¢˜å·¨å¤§ï¼š</p><blockquote><p>ä¸¤åœ°æ—¶é—´ä¸ç»Ÿä¸€ï¼Œç«è½¦ã€èˆ°é˜Ÿã€è®¢å•ã€é€šä¿¡éƒ½æ²¡æ³•åŒæ­¥è®°å½•ã€‚</p></blockquote><p>å› æ­¤ä¸–ç•Œéœ€è¦ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ª <strong>å…¨çƒç»Ÿä¸€ã€ç²¾ç¡®çš„æ ‡å‡†æ—¶é—´</strong></p></li><li class="lvl-2"><p>æ‰€æœ‰äººã€æ‰€æœ‰ç³»ç»Ÿéƒ½èƒ½å¯¹é½ä½¿ç”¨</p></li></ul><p>UTC å°±æ˜¯åœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹è¯ç”Ÿçš„ã€‚</p><hr><h2 id="äºŒã€UTC-æ˜¯ä»€ä¹ˆï¼Ÿ">äºŒã€UTC æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>UTC çš„å…¨ç§°ï¼š</p><blockquote><p><strong>Coordinated Universal Timeï¼ˆåè°ƒä¸–ç•Œæ—¶ï¼‰</strong></p></blockquote><p>å®ƒæ˜¯å½“ä»Šå…¨çƒä½¿ç”¨çš„ <strong>æ ‡å‡†æ—¶é—´ç³»ç»Ÿ</strong>ã€‚</p><p>å®ƒçš„ä¸»è¦ç‰¹ç‚¹ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>ä¸æ˜¯æŸä¸ªå›½å®¶çš„æ—¶é—´</p></li><li class="lvl-2"><p>æ˜¯å›½é™…ç»„ç»‡å…±åŒç»´æŠ¤</p></li><li class="lvl-2"><p>å…¨ä¸–ç•Œæ‰€æœ‰æœºæˆ¿ã€é€šä¿¡ã€å«æ˜Ÿã€èˆªç­ã€GPSã€é‡‘èç³»ç»Ÿéƒ½ä»¥å®ƒä¸ºåŸºå‡†</p></li></ul><p>ä¸€å¥è¯ï¼š</p><blockquote><p><strong>UTC æ˜¯ç°ä»£ä¸–ç•Œå…±åŒä½¿ç”¨çš„â€œä¸–ç•Œæ—¶é—´â€ã€‚</strong></p></blockquote><hr><h2 id="ä¸‰ã€UTC-å’Œ-GMT-çš„å…³ç³»">ä¸‰ã€UTC å’Œ GMT çš„å…³ç³»</h2><p>å¾ˆå¤šäººå¬è¿‡ GMTï¼ˆæ ¼æ—å°¼æ²»æ—¶é—´ï¼‰ï¼Œå†å²ä¸Š GMT æ˜¯ä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œåæ¥è¢« UTC å–ä»£ã€‚</p><table><thead><tr><th>é¡¹ç›®</th><th>GMT</th><th>UTC</th></tr></thead><tbody><tr><td>å‡ºç°å¹´ä»£</td><td>19 ä¸–çºª</td><td>1972 å¹´</td></tr><tr><td>åŸºå‡†</td><td>åœ°çƒè‡ªè½¬ï¼ˆå¤©æ–‡æ—¶é—´ï¼‰</td><td>åŸå­é’Ÿï¼ˆæ›´ç²¾ç¡®ï¼‰</td></tr><tr><td>æ˜¯å¦ä»æ˜¯æ ‡å‡†</td><td>å·²è¢«æ›¿ä»£</td><td>å½“å‰å”¯ä¸€æ ‡å‡†</td></tr></tbody></table><p>ä½†åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼š</p><blockquote><p><strong>UTC â‰ˆ GMTï¼ˆåŒä¸ºé›¶æ—¶åŒºï¼‰</strong></p></blockquote><p>æ‰€ä»¥ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>è‹±å›½å†¬å­£ä½¿ç”¨ GMTï¼ˆUTC+0ï¼‰</p></li><li class="lvl-2"><p>æŠ€æœ¯ç³»ç»Ÿä½¿ç”¨ UTCï¼ˆUTC+0ï¼‰</p></li></ul><hr><h2 id="å››ã€UTC-æ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ">å››ã€UTC æ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ</h2><p>UTC å¹¶ä¸æ˜¯æŒ‰å¤ªé˜³èµ°ï¼Œè€Œæ˜¯ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>ç”±å…¨ä¸–ç•Œ <strong>åŸå­é’Ÿç½‘ç»œç»Ÿä¸€ç”Ÿæˆ</strong></p></li><li class="lvl-2"><p>æ¯ç§’è¯¯å·®å°äº <strong>åäº¿åˆ†ä¹‹ä¸€ç§’</strong></p></li><li class="lvl-2"><p>ç„¶åæ ¹æ®åœ°çƒè‡ªè½¬è¯¯å·®å¶å°”åŠ â€œé—°ç§’â€</p></li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2016-12-31 23:59:60 UTC   â† æ›¾ç»åŠ è¿‡é—°ç§’</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>ä¿è¯æ—¶é—´æå…¶å‡†ç¡®</p></li><li class="lvl-2"><p>åˆä¸ä¼šä¸åœ°çƒçœŸå®æ˜¼å¤œåç¦»å¤ªå¤š</p></li></ul><hr><h2 id="äº”ã€UTC-ä¸æ—¶åŒº">äº”ã€UTC ä¸æ—¶åŒº</h2><p>UTC æ˜¯ 0 æ—¶åŒºã€‚</p><p>æ‰€æœ‰æ—¶åŒºéƒ½æ˜¯ <strong>åœ¨ UTC åŸºç¡€ä¸ŠåŠ å‡åç§»</strong>ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>åŒ—äº¬æ—¶é—´ï¼šUTC + 8</p></li><li class="lvl-2"><p>çº½çº¦æ—¶é—´ï¼šUTC â€“ 5ï¼ˆå†¬å­£ï¼‰æˆ– â€“4ï¼ˆå¤ä»¤æ—¶ï¼‰</p></li><li class="lvl-2"><p>æ—¥æœ¬æ—¶é—´ï¼šUTC + 9</p></li></ul><p>æ‰€ä»¥ä½ å¸¸çœ‹åˆ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UTC+8 æˆ– UTC-5</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºè¯¥åœ°åŒºæ¯” UTC æ—©æˆ–æ™šå¤šå°‘å°æ—¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UTC+8  &gt;  UTC+0  &gt;  UTCâˆ’5</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ¢æˆç”Ÿæ´»è¯­è¨€ï¼š</p><ul class="lvl-2"><li class="lvl-4">UTC+8ï¼ˆä¾‹å¦‚åŒ—äº¬æ—¶é—´ï¼‰æ¯” UTC æ—© 8 å°æ—¶</li><li class="lvl-4">UTCâˆ’5ï¼ˆä¾‹å¦‚ç¾å›½ä¸œéƒ¨å†¬ä»¤æ—¶ï¼‰æ¯” UTC æ™š 5 å°æ—¶</li></ul></li><li class="lvl-2"><p>ä¸¾ä¾‹ï¼š</p><ul class="lvl-2"><li class="lvl-4">UTC(å³UTC+0) æ—¶é—´æ˜¯ 12:00</li><li class="lvl-4">UTC+8 = 20:00ï¼ˆå·²ç»æ™šä¸Šï¼‰</li><li class="lvl-4">UTCâˆ’5 = 07:00ï¼ˆè¿˜åœ¨æ—©ä¸Šï¼‰</li></ul></li></ul><hr><h2 id="å…­ã€UTC-åœ¨è®¡ç®—æœºä¸–ç•Œçš„é‡è¦æ€§">å…­ã€UTC åœ¨è®¡ç®—æœºä¸–ç•Œçš„é‡è¦æ€§</h2><p>å‡ ä¹æ‰€æœ‰ IT ç³»ç»Ÿéƒ½æ¨èï¼š</p><blockquote><p><strong>å­˜å‚¨ç”¨ UTCï¼Œå±•ç¤ºç»™ç”¨æˆ·å†è½¬æ¢æˆå½“åœ°æ—¶åŒºã€‚</strong></p></blockquote><p>åŸå› å¾ˆç®€å•ï¼š</p><ul class="lvl-0"><li class="lvl-2"><p>å…¨çƒä¸€è‡´ï¼Œä¸ä¼šæ··ä¹±</p></li><li class="lvl-2"><p>ä¸å—æ—¶åŒºæˆ–å¤ä»¤æ—¶å½±å“</p></li><li class="lvl-2"><p>è·¨å›½ç³»ç»Ÿæ—¥å¿—å¯å¯¹é½åˆ†æ</p></li></ul><p>ä½ åœ¨æ—¥å¿—é‡Œç»å¸¸è§åˆ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2025-11-20T08:30:00Z</span><br></pre></td></tr></table></figure><p>ç»“å°¾çš„ <code>Z</code> å°±è¡¨ç¤ºï¼š</p><blockquote><p><strong>è¿™æ˜¯ UTC æ—¶é—´</strong></p></blockquote><hr><h2 id="ä¸ƒã€UTCã€GMTã€CST-æ€»ç»“å¯¹æ¯”">ä¸ƒã€UTCã€GMTã€CST æ€»ç»“å¯¹æ¯”</h2><table><thead><tr><th>åç§°</th><th>å…¨ç§°</th><th>ç°åœ¨åœ°ä½</th><th>æ˜¯å¦æ ‡å‡†</th></tr></thead><tbody><tr><td>UTC</td><td>Coordinated Universal Time</td><td>å…¨çƒæ ‡å‡†</td><td>âœ”</td></tr><tr><td>GMT</td><td>Greenwich Mean Time</td><td>è¢« UTC æ›¿ä»£</td><td>âœ–ï¼ˆå†å²å«ä¹‰ï¼‰</td></tr><tr><td>CST</td><td>China Standard Timeï¼ˆä¸­å›½ï¼‰æˆ– Central Standard Timeï¼ˆç¾å›½ï¼‰</td><td>æœ¬åœ°æ—¶åŒº</td><td>ä¸æ˜¯ä¸–ç•Œç»Ÿä¸€åŸºå‡†</td></tr></tbody></table><p>æ³¨æ„ï¼š</p><blockquote><p>â€œCSTâ€ æ—¢å¯èƒ½æ˜¯ä¸­å›½åŒºï¼Œä¹Ÿå¯èƒ½æ˜¯ç¾å›½åŒºï¼Œéœ€è¦ç»“åˆ UTC åç§»åˆ¤æ–­ã€‚</p></blockquote><hr><h2 id="å…«ã€ä¸€å¥è¯æ€»ç»“">å…«ã€ä¸€å¥è¯æ€»ç»“</h2><ul class="lvl-0"><li class="lvl-2"><p><strong>UTC æ˜¯ç°ä»£å…¨çƒç»Ÿä¸€çš„æ ‡å‡†æ—¶é—´</strong></p></li><li class="lvl-2"><p><strong>æ‰€æœ‰æ—¶åŒºéƒ½æ˜¯ç›¸å¯¹äº UTC åç§»</strong></p></li><li class="lvl-2"><p><strong>è®¡ç®—æœºé¢†åŸŸæ™®éä½¿ç”¨ UTC å­˜å‚¨æ—¶é—´</strong></p></li><li class="lvl-2"><p><strong>GMT æ˜¯ UTC çš„å†å²å‰èº«</strong></p></li><li class="lvl-2"><p><strong>åŒ—äº¬æ—¶é—´ = UTC + 8</strong></p></li></ul><p>åªè¦ç†è§£è¿™å‡ ç‚¹ï¼Œä½ å·²ç»æŒæ¡äº†ä¸–ç•Œæ—¶é—´ä½“ç³»çš„æ ¸å¿ƒã€‚</p>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;åœ¨ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å¬åˆ°â€œUTC æ—¶é—´â€â€œåŒ—äº¬æ—¶é—´ UTC+8â€â€œæœåŠ¡å™¨æ—¶é—´æ˜¯ UTCâ€ï¼Œä½†è®¸å¤šäººå¹¶ä¸äº†è§£ UTC åˆ°åº•æ˜¯ä»€ä¹ˆã€‚æœ¬æ–‡å°†ç”¨å°½é‡ç®€å•çš„æ–¹å¼ï¼Œå¸¦ä½ ææ¸…æ¥šç°ä»£ä¸–ç•Œæ‰€ä¾èµ–çš„å…¨çƒé€šç”¨æ—¶é—´æ ‡å‡†â€”â€”UTCã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="UTC" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/UTC/"/>
    
    
    <category term="UTC" scheme="https://blog.hanqunfeng.com/tags/UTC/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ ACL 2.0</title>
    <link href="https://blog.hanqunfeng.com/2025/10/31/rocketmq-08-acl2.0/"/>
    <id>https://blog.hanqunfeng.com/2025/10/31/rocketmq-08-acl2.0/</id>
    <published>2025-10-31T13:40:05.000Z</published>
    <updated>2025-10-31T15:11:43.114Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» RocketMQ ACL 2.0 çš„ä½¿ç”¨æ–¹æ³•ã€‚</p></li><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/">RocketMQå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p></li><li class="lvl-2"><p>RocketMQ ä» 5.3.0 èµ·å¼•å…¥å®‰å…¨æ€§æ›´é«˜çš„ ACL 2.0ï¼Œ5.3.2 æ˜¯æœ€åä¸€ä¸ªè¿˜æ”¯æŒ ACL 1.0 çš„ç‰ˆæœ¬ï¼Œ5.3.3 ç§»é™¤äº† ACL 1.0ï¼Œå®˜æ–¹å»ºè®®æ‰€æœ‰ä½¿ç”¨ Apache RocketMQ ACL çš„ç”¨æˆ·è¿ç§»åˆ° ACL 2.0ã€‚</p></li></ul><span id="more"></span><h2 id="ACL-2-0-ç®€ä»‹">ACL 2.0 ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ <a href="https://rocketmq.apache.org/zh/">RocketMQå®˜ç½‘</a> ä¸­æ²¡æœ‰æ‰¾åˆ°å…³äº ACL 2.0 çš„ä»‹ç»ï¼Œä½†æ˜¯æœ‰ä»‹ç» ACL 1.0 çš„ä½¿ç”¨æ–¹æ³•: <a href="https://rocketmq.apache.org/zh/docs/bestPractice/03access">https://rocketmq.apache.org/zh/docs/bestPractice/03access</a>ã€‚</p></li><li class="lvl-2"><p>åœ¨é˜¿é‡Œäº‘ä¸Šæ‰¾åˆ°ä¸€ç¯‡å‚è€ƒèµ„æ–™ï¼š<a href="https://developer.aliyun.com/article/1569146">Apache RocketMQ ACL 2.0 å…¨æ–°å‡çº§</a></p></li></ul><h2 id="é…ç½®æ­¥éª¤">é…ç½®æ­¥éª¤</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡åœ¨ <a href="/2025/10/23/rocketmq-01-install/" title="RocketMQ çš„å®‰è£…åŠä½¿ç”¨">RocketMQ çš„å®‰è£…åŠä½¿ç”¨</a> ä¸­ é›†ç¾¤ å®‰è£…å®Œæˆä¹‹åï¼Œå¼€å§‹é…ç½® ACL 2.0ã€‚</p></li><li class="lvl-2"><p>åœ¨æ‰€æœ‰ Broker çš„é…ç½®æ–‡ä»¶<code>broker.conf</code>ä¸­å¢åŠ è®¤è¯ä¸æˆæƒé…ç½®:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># broker.conf</span></span><br><span class="line"><span class="comment"># è®¤è¯é…ç½®</span></span><br><span class="line">authenticationEnabled = <span class="literal">true</span></span><br><span class="line">authenticationProvider = org.apache.rocketmq.auth.authentication.provider.DefaultAuthenticationProvider</span><br><span class="line">initAuthenticationUser = &#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;mqadmin&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;1234567&quot;</span>&#125;</span><br><span class="line">innerClientAuthenticationCredentials = &#123;<span class="string">&quot;accessKey&quot;</span>:<span class="string">&quot;mqadmin&quot;</span>,<span class="string">&quot;secretKey&quot;</span>:<span class="string">&quot;1234567&quot;</span>&#125;</span><br><span class="line">authenticationMetadataProvider = org.apache.rocketmq.auth.authentication.provider.LocalAuthenticationMetadataProvider</span><br><span class="line"><span class="comment"># æˆæƒé…ç½®</span></span><br><span class="line">authorizationEnabled = <span class="literal">true</span></span><br><span class="line">authorizationProvider = org.apache.rocketmq.auth.authorization.provider.DefaultAuthorizationProvider</span><br><span class="line">authorizationMetadataProvider = org.apache.rocketmq.auth.authorization.provider.LocalAuthorizationMetadataProvider</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left">å‚æ•°å®šä¹‰</th><th style="text-align:left">å‚æ•°åç§°</th><th style="text-align:left">å‚æ•°æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><strong>authenticationEnabled</strong></td><td style="text-align:left">æ˜¯å¦æ‰“å¼€è®¤è¯å¼€å…³</td><td style="text-align:left">ç”¨äºåˆ¤æ–­è®¤è¯æ˜¯å¦æ‰“å¼€ã€‚<br>å¯é€‰å€¼ï¼š<br>â€¢ <code>true</code> â€“ æ˜¯<br>â€¢ <code>false</code> â€“ å¦</td></tr><tr><td style="text-align:left"><strong>authenticationProvider</strong></td><td style="text-align:left">è®¤è¯æ–¹å¼æä¾›è€…</td><td style="text-align:left">ç”¨äºæä¾›è¯·æ±‚è®¿é—®æ—¶çš„è®¤è¯æ–¹å¼ã€‚<br>å¯é€‰å€¼ï¼š<br>â€¢ <code>org.apache.rocketmq.auth.authentication.provider.DefaultAuthenticationProvider</code> â€“ é»˜è®¤çš„è®¤è¯æ–¹å¼</td></tr><tr><td style="text-align:left"><strong>initAuthenticationUser</strong></td><td style="text-align:left">ç³»ç»Ÿåˆå§‹åŒ–ç”¨æˆ·</td><td style="text-align:left">ç”¨äºç³»ç»Ÿåˆå§‹åŒ–æ—¶è‡ªåŠ¨åˆ›å»ºçš„ç”¨æˆ·è´¦å·ã€‚<br>ç¤ºä¾‹ï¼š<br><code>&#123;&quot;username&quot;:&quot;rocketmq&quot;,&quot;password&quot;:&quot;12345678&quot;&#125;</code></td></tr><tr><td style="text-align:left"><strong>innerClientAuthenticationCredentials</strong></td><td style="text-align:left">ç»„ä»¶é—´è®¤è¯ç”¨æˆ·</td><td style="text-align:left">ç”¨äºè®¾ç½®é›†ç¾¤å†…ç»„ä»¶ä¹‹é—´çš„è®¿é—®å‡­è¯ã€‚<br>ç¤ºä¾‹ï¼š<br><code>&#123;&quot;accessKey&quot;:&quot;rocketmq&quot;,&quot;secretKey&quot;:&quot;12345678&quot;&#125;</code></td></tr><tr><td style="text-align:left"><strong>authenticationMetadataProvider</strong></td><td style="text-align:left">è®¤è¯å…ƒæ•°æ®æä¾›è€…</td><td style="text-align:left">ç”¨äºæä¾›è®¤è¯ç›¸å…³çš„å…ƒæ•°æ®ï¼ˆå¦‚ç”¨æˆ·ï¼‰ã€‚<br>å¯é€‰å€¼ï¼š<br>â€¢ <code>org.apache.rocketmq.auth.authentication.provider.LocalAuthenticationMetadataProvider</code> â€“ æœ¬åœ°è®¤è¯å…ƒæ•°æ®æä¾›è€…<br>â€¢ <code>org.apache.rocketmq.proxy.auth.ProxyAuthenticationMetadataProvider</code> â€“ Proxyè®¤è¯å…ƒæ•°æ®æä¾›è€…</td></tr><tr><td style="text-align:left"><strong>authenticationStrategy</strong></td><td style="text-align:left">è®¤è¯ç­–ç•¥</td><td style="text-align:left">ç”¨äºæŒ‡å®šè¯·æ±‚è®¿é—®æ—¶çš„è®¤è¯ç­–ç•¥ã€‚<br>å¯é€‰å€¼ï¼š<br>â€¢ <code>org.apache.rocketmq.auth.authentication.strategy.StatelessAuthenticationStrategy</code> â€“ æ¯æ¬¡è¯·æ±‚è®¤è¯ç­–ç•¥<br>â€¢ <code>org.apache.rocketmq.auth.authentication.strategy.StatefulAuthenticationStrategy</code> â€“ é¦–æ¬¡è¯·æ±‚è®¤è¯ç­–ç•¥</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>é‡å¯å¯åŠ¨æ‰€æœ‰ Broker</p></li></ul><h2 id="å‘½ä»¤è¡Œç®¡ç†ç”¨æˆ·">å‘½ä»¤è¡Œç®¡ç†ç”¨æˆ·</h2><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœ RocketMQ å¼€å¯äº† ACLï¼Œæ— è®ºæ˜¯ ACL 1.0 è¿˜æ˜¯ ACL 2.0ï¼Œéƒ½éœ€è¦åœ¨ <code>conf/tools.yml</code> é…ç½®æ­£ç¡®çš„è´¦å·å¯†ç ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ <code>mqadmin</code> å‘½ä»¤ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">accessKey:</span> <span class="string">mqadmin</span></span><br><span class="line"><span class="attr">secretKey:</span> <span class="number">1234567</span></span><br></pre></td></tr></table></figure><h3 id="ç”¨æˆ·ç®¡ç†">ç”¨æˆ·ç®¡ç†</h3><table><thead><tr><th style="text-align:left">æ¥å£å®šä¹‰</th><th style="text-align:left">æ¥å£åç§°</th><th style="text-align:left">æ¥å£å‚æ•°</th></tr></thead><tbody><tr><td style="text-align:left"><strong>createUser</strong></td><td style="text-align:left">åˆ›å»ºç”¨æˆ·</td><td style="text-align:left">-n namesrv åœ°å€<br>-b broker åœ°å€<br>-c é›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-u ç”¨æˆ·åç§°<br>-p ç”¨æˆ·å¯†ç <br>-t ç”¨æˆ·ç±»å‹ï¼ˆSuperã€Normalï¼‰</td></tr><tr><td style="text-align:left"><strong>updateUser</strong></td><td style="text-align:left">æ›´æ–°ç”¨æˆ·</td><td style="text-align:left">-n namesrv åœ°å€<br>-b broker åœ°å€<br>-c é›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-u ç”¨æˆ·åç§°<br>-p ç”¨æˆ·å¯†ç <br>-t ç”¨æˆ·ç±»å‹ï¼ˆSuperã€Normalï¼‰</td></tr><tr><td style="text-align:left"><strong>deleteUser</strong></td><td style="text-align:left">åˆ é™¤ç”¨æˆ·</td><td style="text-align:left">-b broker åœ°å€<br>-c é›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-u ç”¨æˆ·åç§°</td></tr><tr><td style="text-align:left"><strong>getUser</strong></td><td style="text-align:left">æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…</td><td style="text-align:left">-n namesrv åœ°å€<br>-b broker åœ°å€<br>-c é›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-u ç”¨æˆ·åç§°</td></tr><tr><td style="text-align:left"><strong>listUser</strong></td><td style="text-align:left">æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨</td><td style="text-align:left">-n namesrv åœ°å€<br>-b broker åœ°å€<br>-c é›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-u ç”¨æˆ·åç§°<br>-f è¿‡æ»¤æ¡ä»¶ï¼ˆæ”¯æŒç”¨æˆ·åç§°æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯é€‰ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">sh bin/mqadmin createUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq -p rocketmq</span><br><span class="line"><span class="comment"># åˆ›å»ºç”¨æˆ·ï¼ŒæŒ‡å®šç”¨æˆ·ç±»å‹</span></span><br><span class="line">sh bin/mqadmin createUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq -p rocketmq -t Super</span><br><span class="line"><span class="comment"># æ›´æ–°ç”¨æˆ·</span></span><br><span class="line">sh bin/mqadmin updateUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq -p 12345678</span><br><span class="line"><span class="comment"># åˆ é™¤ç”¨æˆ·</span></span><br><span class="line">sh bin/mqadmin deleteUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq</span><br><span class="line"><span class="comment"># æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…</span></span><br><span class="line">sh bin/mqadmin getUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq</span><br><span class="line"><span class="comment"># æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨</span></span><br><span class="line">sh bin/mqadmin listUser -n 127.0.0.1:9876 -c DefaultCluster</span><br><span class="line"><span class="comment"># æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ï¼Œå¸¦è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">sh bin/mqadmin listUser -n 127.0.0.1:9876 -c DefaultCluster -f mq</span><br></pre></td></tr></table></figure><h3 id="æƒé™ç®¡ç†">æƒé™ç®¡ç†</h3><ul class="lvl-0"><li class="lvl-2"><p>ç®¡ç†å‘˜(Super)æ‹¥æœ‰æ‰€ä»¥èµ„æºçš„è®¿é—®æƒé™ï¼Œæ™®é€šç”¨æˆ·(Normal)åˆ™åªæœ‰å¯¹åº”èµ„æºç±»å‹çš„è®¿é—®æƒé™ã€‚ä»¥ä¸‹æ˜¯ä¸ºæ™®é€šç”¨æˆ·è®¾ç½®æƒé™çš„å‘½ä»¤ã€‚</p></li></ul><table><thead><tr><th style="text-align:left">å‘½ä»¤åç§°</th><th style="text-align:left">æ“ä½œå®šä¹‰</th><th style="text-align:left">å‘½ä»¤å‚æ•°åŠè§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:left"><strong><code>createAcl</code></strong></td><td style="text-align:left">åˆ›å»ºæˆæƒ</td><td style="text-align:left">-n <strong>127.0.0.1:9876</strong>ï¼šNameServer åœ°å€ï¼ˆå¤šä¸ªä»¥ <code>;</code> åˆ†éš”ï¼‰<br>-b broker åœ°å€<br>-c <strong>DefaultCluster</strong>ï¼šé›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-s <strong>User:rocketmq</strong>ï¼šæˆæƒçš„ç”¨æˆ·ï¼ˆ<code>User:rocketmq</code> è¡¨ç¤ºç»™ç”¨æˆ· <code>rocketmq</code> æˆæƒï¼‰<br>-r <strong>Topic:*,Group:</strong>ï¼šèµ„æºç±»å‹ä¸åç§°ï¼Œ<code>*</code> è¡¨ç¤ºæ‰€æœ‰ Topic å’Œ Group<br>-a <strong>Pub,Sub</strong>ï¼šæˆæƒæ“ä½œç±»å‹ï¼Œ<code>Pub</code> è¡¨ç¤ºå‘å¸ƒæƒé™ï¼Œ<code>Sub</code> è¡¨ç¤ºè®¢é˜…æƒé™<br>-i <strong>192.168.1.0/24</strong>ï¼šæˆæƒçš„ IP åœ°å€èŒƒå›´<br>-d <strong>Allow</strong>ï¼šæˆæƒç±»å‹ï¼Œ<code>Allow</code> å…è®¸ï¼Œ<code>Deny</code> æ‹’ç»</td></tr><tr><td style="text-align:left"><strong><code>updateAcl</code></strong></td><td style="text-align:left">æ›´æ–°æˆæƒ</td><td style="text-align:left">-n <strong>127.0.0.1:9876</strong>ï¼šNameServer åœ°å€<br>-b broker åœ°å€<br>-c <strong>DefaultCluster</strong>ï¼šé›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-s <strong>User:rocketmq</strong>ï¼šæˆæƒçš„ç”¨æˆ·<br>-r <strong>Topic:*,Group:</strong>ï¼šèµ„æºç±»å‹ä¸åç§°<br>-a <strong>Pub,Sub</strong>ï¼šæˆæƒæ“ä½œç±»å‹<br>-i <strong>192.168.1.0/24</strong>ï¼šIP åœ°å€èŒƒå›´<br>-d <strong>Deny</strong>ï¼šæˆæƒç±»å‹ï¼Œæ›´æ–°ä¸º <code>Deny</code></td></tr><tr><td style="text-align:left"><strong><code>deleteAcl</code></strong></td><td style="text-align:left">åˆ é™¤æˆæƒ</td><td style="text-align:left">-n <strong>127.0.0.1:9876</strong>ï¼šNameServer åœ°å€<br>-b broker åœ°å€<br>-c <strong>DefaultCluster</strong>ï¼šé›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-s <strong>User:rocketmq</strong>ï¼šæˆæƒçš„ç”¨æˆ·<br>-r <strong>Topic:</strong>ï¼šæŒ‡å®šåˆ é™¤æŸä¸ªèµ„æºï¼ˆå¦‚ Topicï¼‰æˆæƒ</td></tr><tr><td style="text-align:left"><strong><code>listAcl</code></strong></td><td style="text-align:left">æŸ¥è¯¢æˆæƒåˆ—è¡¨</td><td style="text-align:left">-n <strong>127.0.0.1:9876</strong>ï¼šNameServer åœ°å€<br>-b broker åœ°å€<br>-c <strong>DefaultCluster</strong>ï¼šé›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-s <strong>User:rocketmq</strong>ï¼šæˆæƒçš„ç”¨æˆ·<br>-r <strong>Topic:</strong>ï¼šæŒ‡å®šèµ„æºç±»å‹ï¼ˆå¦‚ Topicï¼‰</td></tr><tr><td style="text-align:left"><strong><code>getAcl</code></strong></td><td style="text-align:left">æŸ¥è¯¢æˆæƒè¯¦æƒ…</td><td style="text-align:left">-n <strong>127.0.0.1:9876</strong>ï¼šNameServer åœ°å€<br>-b broker åœ°å€<br>-c <strong>DefaultCluster</strong>ï¼šé›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-s <strong>User:rocketmq</strong>ï¼šæˆæƒçš„ç”¨æˆ·</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæˆæƒ</span></span><br><span class="line">sh bin/mqadmin createAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*,Group:* -a Pub,Sub -i 192.168.1.0/24 -d Allow</span><br><span class="line"><span class="comment"># æ›´æ–°æˆæƒ</span></span><br><span class="line">sh bin/mqadmin updateAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*,Group:* -a Pub,Sub -i 192.168.1.0/24 -d Deny</span><br><span class="line"><span class="comment"># åˆ é™¤æˆæƒ</span></span><br><span class="line">sh bin/mqadmin deleteAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq</span><br><span class="line"><span class="comment"># åˆ é™¤æˆæƒï¼ŒæŒ‡å®šèµ„æº</span></span><br><span class="line">sh bin/mqadmin deleteAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*</span><br><span class="line"><span class="comment"># æŸ¥è¯¢æˆæƒåˆ—è¡¨</span></span><br><span class="line">sh bin/mqadmin listAcl -n 127.0.0.1:9876 -c DefaultCluster</span><br><span class="line"><span class="comment"># æŸ¥è¯¢æˆæƒåˆ—è¡¨ï¼Œå¸¦è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">sh bin/mqadmin listAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*</span><br><span class="line"><span class="comment"># æŸ¥è¯¢æˆæƒè¯¦æƒ…</span></span><br><span class="line">sh bin/mqadmin getAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq</span><br></pre></td></tr></table></figure><h2 id="Dashboard-é…ç½®">Dashboard é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶åœ¨ Dashboard ä¸­é…ç½®å¥½è®¤è¯ä¿¡æ¯å¹¶é‡å¯ï¼Œå³å¯æ­£å¸¸è®¿é—®RocketMQé›†ç¾¤ï¼Œå¹¶ä¸”æ”¯æŒåœ¨webç«¯é…ç½®ACLè®¤è¯ä¿¡æ¯ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim run/application.yaml # æŒ‰éœ€æ›¿æ¢é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rocketmq:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">namesrvAddrs:</span>                <span class="comment"># å¡«å†™NameServeråœ°å€åˆ—è¡¨</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10.250</span><span class="number">.0</span><span class="number">.175</span><span class="string">:9876</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10.250</span><span class="number">.0</span><span class="number">.188</span><span class="string">:9876</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10.250</span><span class="number">.0</span><span class="number">.131</span><span class="string">:9876</span></span><br><span class="line">    <span class="attr">dataPath:</span> <span class="string">/usr/local/soft/rocketmq/data/dashboard</span> <span class="comment"># Dashboardæ–‡ä»¶ç›®å½•ï¼Œç™»å½•ç”¨æˆ·é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•</span></span><br><span class="line">    <span class="attr">loginRequired:</span> <span class="literal">true</span>  <span class="comment"># æ˜¯å¦éœ€è¦ç™»å½•ï¼Œæ­¤æ—¶éœ€è¦åœ¨ dataPath ä¸‹åˆ›å»º users.properties æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/users.propertiesæ–‡ä»¶</span></span><br><span class="line">    <span class="comment"># å¦‚æœ broker å¼€å¯äº† ACLï¼Œåˆ™éœ€è¦é…ç½® accessKey å’Œ secretKey</span></span><br><span class="line">    <span class="attr">accessKey:</span> <span class="string">mqadmin</span></span><br><span class="line">    <span class="attr">secretKey:</span> <span class="number">1234567</span></span><br></pre></td></tr></table></figure><h2 id="Proxy-é…ç½®">Proxy é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>Broker å¼€å¯ ACL 2.0 è®¤è¯åï¼Œå³ä½¿åœ¨ä»£ç ä¸­æ·»åŠ äº†ACLè®¤è¯ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œ<a href="https://github.com/apache/rocketmq-clients/tree/master/java/client/src/main/java/org/apache/rocketmq/client/java/example">æ–°ç‰ˆå®¢æˆ·ç«¯(rocketmq-client-java)</a>é€šè¿‡<code>Proxy</code>å‘é€æˆ–è®¢é˜…æ¶ˆæ¯ä¾æ—§ä¼šå¤±è´¥ï¼Œ<a href="https://github.com/apache/rocketmq/tree/develop/example">åŸå®¢æˆ·ç«¯(rocketmq-client)</a>é€šè¿‡<code>Nameserver</code>å‘é€æˆ–è®¢é˜…æ¶ˆæ¯æ­£å¸¸ï¼Œå°šä¸çŸ¥é“è¯¥å¦‚ä½•å®Œç¾è§£å†³ã€‚</p></li><li class="lvl-2"><p>æŒ‰ç…§è¿™ç¯‡æ–‡ç« <a href="https://developer.aliyun.com/article/1569146">Apache RocketMQ ACL 2.0 å…¨æ–°å‡çº§</a>çš„ä»‹ç»ï¼Œåœ¨æ‰€æœ‰ Proxy çš„é…ç½®æ–‡ä»¶<code>rmq-proxy.json</code>ä¸­å¢åŠ è®¤è¯ä¸æˆæƒé…ç½®ä¾æ—§æ²¡æœ‰è§£å†³è¯¥é—®é¢˜ã€‚</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;authenticationEnabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;authenticationProvider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.apache.rocketmq.auth.authentication.provider.DefaultAuthenticationProvider&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;authenticationMetadataProvider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.apache.rocketmq.proxy.auth.ProxyAuthenticationMetadataProvider&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;innerClientAuthenticationCredentials&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;\&quot;accessKey\&quot;:\&quot;mqadmin\&quot;, \&quot;secretKey\&quot;:\&quot;1234567\&quot;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;authorizationEnabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;authorizationProvider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.apache.rocketmq.auth.authorization.provider.DefaultAuthorizationProvider&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;authorizationMetadataProvider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.apache.rocketmq.proxy.auth.ProxyAuthorizationMetadataProvider&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.apache.rocketmq.client.java.exception.UnauthorizedException: [request-id=1b2af952-38d9-4201-bd10-055e442c6b59, response-code=40100] Authentication failed. Please verify the credentials and try again.</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¹‹åé€šè¿‡è¿™ç¯‡æ–‡ç«  <a href="https://blog.zcw159357.com/article/1/2025-03-15-0048.html">rocketmqéƒ¨ç½²è¸©å‘(äºŒ) aclé…ç½®</a> çš„ä»‹ç»ï¼Œéœ€è¦åœ¨ <code>rmq-proxy.json</code> ä¸­å¢åŠ å¦‚ä¸‹é…ç½®ï¼š</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;enableAclRpcHookForClusterMode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®å®Œæˆåï¼Œé‡å¯ Proxyï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯æœç„¶æ²¡é—®é¢˜äº†ï¼Œæ¶ˆè´¹è€…å¯åŠ¨ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å°±æ˜¯æ¥æ”¶ä¸åˆ°ä»»ä½•æ¶ˆæ¯ã€‚</p></li><li class="lvl-2"><p>ä¹‹åé€šè¿‡è¿™ç¯‡æ–‡ç«  <a href="https://blog.csdn.net/icebamboo2015/article/details/152118732">å…³äºRocketMq5.3.3å¼€å¯ACL2.0é€šè¿‡proxy8081ç«¯å£åªèƒ½å‘æ¶ˆæ¯ï¼Œä¸èƒ½æ”¶æ¶ˆæ¯é—®é¢˜ç®€å•å¤„ç†</a> çš„è¯´æ˜ï¼Œå°†æ‰€æœ‰ <code>broker.conf</code> ä¸­ <code>authorizationEnabled</code> é…ç½®æ”¹ä¸º <code>false</code>ï¼Œé‡å¯ Brokerï¼Œé—®é¢˜è§£å†³ã€‚</p></li></ul><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>ç¬”è€…æ„Ÿè§‰å½“å‰ RocketMQ çš„ ACL 2.0 è®¤è¯æœºåˆ¶è¿˜å­˜åœ¨ä¸€äº›bugï¼Œå°±è¿å®˜ç½‘ä¹Ÿæ²¡æœ‰æä¾›çš„æ–‡æ¡£è¯´æ˜ï¼Œæš‚æ—¶å…ˆç©ç©å§ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» RocketMQ ACL 2.0 çš„ä½¿ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://rocketmq.apache.org/zh/&quot;&gt;RocketMQå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;RocketMQ ä» 5.3.0 èµ·å¼•å…¥å®‰å…¨æ€§æ›´é«˜çš„ ACL 2.0ï¼Œ5.3.2 æ˜¯æœ€åä¸€ä¸ªè¿˜æ”¯æŒ ACL 1.0 çš„ç‰ˆæœ¬ï¼Œ5.3.3 ç§»é™¤äº† ACL 1.0ï¼Œå®˜æ–¹å»ºè®®æ‰€æœ‰ä½¿ç”¨ Apache RocketMQ ACL çš„ç”¨æˆ·è¿ç§»åˆ° ACL 2.0ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ ACL 1.0</title>
    <link href="https://blog.hanqunfeng.com/2025/10/29/rocketmq-08-acl1.0/"/>
    <id>https://blog.hanqunfeng.com/2025/10/29/rocketmq-08-acl1.0/</id>
    <published>2025-10-29T13:40:05.000Z</published>
    <updated>2025-10-31T10:10:05.001Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» RocketMQ ACL 1.0 çš„ä½¿ç”¨æ–¹æ³•ã€‚</p></li><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/">RocketMQå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p></li><li class="lvl-2"><p>RocketMQ ä» 5.3.0 èµ·å¼•å…¥å®‰å…¨æ€§æ›´é«˜çš„ ACL 2.0ï¼Œ5.3.2 æ˜¯æœ€åä¸€ä¸ªè¿˜æ”¯æŒ ACL 1.0 çš„ç‰ˆæœ¬ï¼Œ5.3.3 ç§»é™¤äº† ACL 1.0ï¼Œå®˜æ–¹å»ºè®®æ‰€æœ‰ä½¿ç”¨ Apache RocketMQ ACL çš„ç”¨æˆ·è¿ç§»åˆ° ACL 2.0ã€‚</p></li></ul><span id="more"></span><h2 id="ACL-1-0-ç®€ä»‹">ACL 1.0 ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ACLæ§åˆ¶åœ¨å¢å¼ºé›†ç¾¤è®¿é—®æ§åˆ¶å®‰å…¨æ€§çš„åŒæ—¶ä¹Ÿä¼šå¸¦æ¥éƒ¨ç½²æµç¨‹å’Œè¿ç»´ç®¡ç†çš„å¤æ‚åº¦ã€‚</p></li><li class="lvl-2"><p>ä¸€èˆ¬ä»…å»ºè®®åœ¨ç½‘ç»œç¯å¢ƒä¸å®‰å…¨ã€ä¸šåŠ¡æ•°æ®æ•æ„Ÿã€å¤šéƒ¨é—¨ç§Ÿæˆ·æ··ç”¨çš„åœºæ™¯ä¸‹ä½¿ç”¨ã€‚å¦‚æœç”Ÿäº§é›†ç¾¤æœ¬èº«æ˜¯ç§æœ‰é›†ç¾¤ä¸ä¼šè¢«å¤–éƒ¨éƒ¨é—¨ç§Ÿæˆ·è®¿é—®ï¼Œå¯ä»¥ä¸å¼€å¯ã€‚</p></li></ul><h2 id="ACL-1-0-ä½¿ç”¨æ–¹æ³•">ACL 1.0 ä½¿ç”¨æ–¹æ³•</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡åœ¨ <a href="/2025/10/23/rocketmq-01-install/" title="RocketMQ çš„å®‰è£…åŠä½¿ç”¨">RocketMQ çš„å®‰è£…åŠä½¿ç”¨</a> ä¸­ é›†ç¾¤ å®‰è£…å®Œæˆä¹‹åï¼Œå¼€å§‹é…ç½® ACL 1.0ã€‚</p></li><li class="lvl-2"><p>é¦–å…ˆéœ€è¦åœ¨ Broker èŠ‚ç‚¹å¼€å¯ ACL æƒé™ï¼Œåœ¨ <code>broker.conf</code> æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œå¹¶é‡å¯ Broker</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aclEnable=<span class="literal">true</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æƒé™é…ç½®æ–‡ä»¶ä¸º <code>conf/plain_acl.yml</code>ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸éœ€è¦ä¿®æ”¹ï¼Œåé¢ä¼šä»‹ç»å¦‚ä½•é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œé…ç½®ï¼Œé»˜è®¤çš„å†…å®¹å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¨å±€ç™½åå•ï¼Œæ”¯æŒçš„æ ¼å¼ï¼š*;192.168.*.*;192.168.0.1</span></span><br><span class="line"><span class="comment"># ç™½åå•å†…çš„ IP éƒ½å¯ä»¥è®¿é—®ï¼Œæ— éœ€é…ç½®å¸å·</span></span><br><span class="line"><span class="attr">globalWhiteRemoteAddresses:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">10.10</span><span class="number">.103</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.0</span><span class="string">.*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¨å±€ç™½åå•å¤–çš„IP,éœ€è¦è´¦å·è®¿é—®</span></span><br><span class="line"><span class="comment"># è´¦å·é…ç½®ï¼Œæ•°ç»„å½¢å¼</span></span><br><span class="line"><span class="attr">accounts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">accessKey:</span> <span class="string">RocketMQ</span> <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">secretKey:</span> <span class="number">12345678</span> <span class="comment"># å¯†ç </span></span><br><span class="line">    <span class="attr">whiteRemoteAddress:</span> <span class="comment"># å½“å‰å¸å·çš„ç™½åå•</span></span><br><span class="line">    <span class="attr">admin:</span> <span class="literal">false</span>        <span class="comment"># æ˜¯å¦æ˜¯ç®¡ç†å‘˜</span></span><br><span class="line">    <span class="attr">defaultTopicPerm:</span> <span class="string">DENY</span> <span class="comment"># å½“å‰ç”¨æˆ·å¯¹æœªåœ¨ topicPerms ä¸­æ˜¾å¼å£°æ˜çš„ Topic çš„é»˜è®¤æƒé™:DENY;PUB;SUB;PUB|SUB</span></span><br><span class="line">    <span class="attr">defaultGroupPerm:</span> <span class="string">SUB</span>  <span class="comment"># å½“å‰ç”¨æˆ·å¯¹æœªåœ¨ groupPerms ä¸­æ˜¾å¼å£°æ˜çš„ Consumer Group çš„é»˜è®¤æƒé™:DENY;PUB;SUB;PUB|SUB</span></span><br><span class="line">    <span class="attr">topicPerms:</span>            <span class="comment"># ç‰¹å®šçš„ topic æƒé™</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">topicA=DENY</span>        <span class="comment"># topicName=perm</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">topicB=PUB|SUB</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">topicC=SUB</span></span><br><span class="line">    <span class="attr">groupPerms:</span>            <span class="comment"># ç‰¹å®šçš„ ConsumerGroup æƒé™</span></span><br><span class="line">      <span class="comment"># the group should convert to retry topic</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">groupA=DENY</span>        <span class="comment"># groupName=perm</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">groupB=PUB|SUB</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">groupC=SUB</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">accessKey:</span> <span class="string">rocketmq2</span></span><br><span class="line">    <span class="attr">secretKey:</span> <span class="number">12345678</span></span><br><span class="line">    <span class="attr">whiteRemoteAddress:</span> <span class="number">192.168</span><span class="number">.1</span><span class="string">.*</span></span><br><span class="line">    <span class="comment"># if it is admin, it could access all resources</span></span><br><span class="line">    <span class="attr">admin:</span> <span class="literal">true</span>         <span class="comment"># æ˜¯å¦æ˜¯ç®¡ç†å‘˜,true è¡¨ç¤ºç®¡ç†å‘˜,ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰èµ„æº</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æƒé™å®šä¹‰</p></li></ul><table><thead><tr><th style="text-align:left">æƒé™å€¼</th><th style="text-align:left">å«ä¹‰</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left"><strong>DENY</strong></td><td style="text-align:left">æ‹’ç»</td><td style="text-align:left">ç¦æ­¢å¯¹è¯¥ Topic çš„ä»»ä½•æ“ä½œï¼ˆæ— è®ºæ˜¯å‘é€è¿˜æ˜¯è®¢é˜…ï¼‰</td></tr><tr><td style="text-align:left"><strong>ANY</strong></td><td style="text-align:left">ä»»æ„æƒé™</td><td style="text-align:left">å…·æœ‰å‘å¸ƒï¼ˆPUBï¼‰å’Œè®¢é˜…ï¼ˆSUBï¼‰åŒé‡æƒé™</td></tr><tr><td style="text-align:left"><strong>PUB</strong></td><td style="text-align:left">å‘é€æƒé™</td><td style="text-align:left">å…è®¸ç”Ÿäº§è€…å‘è¯¥ Topic å‘é€æ¶ˆæ¯</td></tr><tr><td style="text-align:left"><strong>SUB</strong></td><td style="text-align:left">è®¢é˜…æƒé™</td><td style="text-align:left">å…è®¸æ¶ˆè´¹è€…è®¢é˜…å¹¶æ¶ˆè´¹è¯¥ Topic çš„æ¶ˆæ¯</td></tr></tbody></table><div class="tips"><p><em><strong>defaultGroupPerm: SUB</strong></em></p><ul class="lvl-1"><li class="lvl-2">è¡¨ç¤ºï¼šé»˜è®¤å…è®¸è¯¥ç”¨æˆ·ä»¥ä»»æ„æ¶ˆè´¹è€…ç»„èº«ä»½å‚ä¸æ¶ˆè´¹ï¼ˆä¸é™åˆ¶ groupï¼‰ï¼Œä½†å‰ææ˜¯è¯¥æ¶ˆè´¹è€…å¯¹ç›®æ ‡ Topic ä¹Ÿå¿…é¡»æ‹¥æœ‰ SUB æƒé™ã€‚</li></ul></div><h3 id="å‘½ä»¤è¡Œé…ç½®-ACL">å‘½ä»¤è¡Œé…ç½® ACL</h3><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœ RocketMQ å¼€å¯äº† ACLï¼Œæ— è®ºæ˜¯ ACL 1.0 è¿˜æ˜¯ ACL 2.0ï¼Œéƒ½éœ€è¦åœ¨ <code>conf/tools.yml</code> é…ç½®æ­£ç¡®çš„è´¦å·å¯†ç ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ <code>mqadmin</code> å‘½ä»¤ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">accessKey:</span> <span class="string">mqadmin</span></span><br><span class="line"><span class="attr">secretKey:</span> <span class="number">1234567</span></span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œåä¼šè‡ªåŠ¨ä¿®æ”¹ <code>conf/plain_acl.yml</code> æ–‡ä»¶</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ ç™½åå•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sh bin/mqadmin updateGlobalWhiteAddr \</span><br><span class="line">    -n 127.0.0.1:9876 \</span><br><span class="line">    -c DefaultCluster \</span><br><span class="line">    -g 10.250.0.*,10.252.*.*,10.20.0.31</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:left">æ˜¯å¦å¿…å¡«</th><th style="text-align:left">å«ä¹‰</th><th style="text-align:left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td style="text-align:left"><code>-b</code></td><td style="text-align:left">äºŒé€‰ä¸€å¿…å¡«</td><td style="text-align:left">æŒ‡å®šè¦æ›´æ–°ç™½åå•çš„ <strong>Broker åœ°å€</strong></td><td style="text-align:left"><code>127.0.0.1:10911</code></td></tr><tr><td style="text-align:left"><code>-c</code></td><td style="text-align:left">äºŒé€‰ä¸€å¿…å¡«</td><td style="text-align:left">æŒ‡å®šè¦æ›´æ–°ç™½åå•çš„ <strong>Cluster åç§°</strong>ï¼Œé›†ç¾¤å†…æ‰€æœ‰ Broker éƒ½ä¼šè¢«æ›´æ–°</td><td style="text-align:left"><code>DefaultCluster</code></td></tr><tr><td style="text-align:left"><code>-g</code></td><td style="text-align:left">âœ… å¿…å¡«</td><td style="text-align:left">è¦è®¾ç½®çš„å…¨å±€ç™½åå•åœ°å€åˆ—è¡¨ï¼Œæ”¯æŒé€šé…ç¬¦</td><td style="text-align:left"><code>&quot;10.10.103.*,192.168.0.*&quot;</code></td></tr><tr><td style="text-align:left"><code>-n</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left">NameServer åœ°å€</td><td style="text-align:left"><code>127.0.0.1:9876</code></td></tr><tr><td style="text-align:left"><code>-p</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left">æŒ‡å®š ACL é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆBroker ç«¯å¯¹åº”çš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼‰</td><td style="text-align:left"><code>/home/rocketmq/conf/plain_acl.yml</code></td></tr><tr><td style="text-align:left"><code>-h</code></td><td style="text-align:left">å¦</td><td style="text-align:left">æ‰“å°å¸®åŠ©ä¿¡æ¯</td><td style="text-align:left">â€”</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºæˆ–æ›´æ–°ç”¨æˆ·ï¼ŒaccessKey å’Œ secretKey çš„é•¿åº¦å¿…é¡»å¤§äº 6 ä½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç®¡ç†å‘˜</span></span><br><span class="line">sh bin/mqadmin updateAclConfig \</span><br><span class="line">    -n 127.0.0.1:9876 \</span><br><span class="line">    -c DefaultCluster \</span><br><span class="line">    -a mqadmin \</span><br><span class="line">    -s 1234567 \</span><br><span class="line">    -m <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ™®é€šç”¨æˆ·</span></span><br><span class="line">sh bin/mqadmin updateAclConfig \</span><br><span class="line">  -c DefaultCluster \</span><br><span class="line">  -a rocketmq_user \</span><br><span class="line">  -s 12345678 \</span><br><span class="line">  -i <span class="string">&quot;PUB|SUB&quot;</span> \</span><br><span class="line">  -u SUB \</span><br><span class="line">  -t <span class="string">&quot;topicA=PUB|SUB,topicB=DENY&quot;</span> \</span><br><span class="line">  -g <span class="string">&quot;groupA=SUB,groupB=DENY&quot;</span> \</span><br><span class="line">  -w <span class="string">&quot;192.168.0.*&quot;</span> \</span><br><span class="line">  -n 127.0.0.1:9876</span><br><span class="line"></span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:left">æ˜¯å¦å¿…å¡«</th><th style="text-align:left">å«ä¹‰</th><th style="text-align:left">ç¤ºä¾‹</th><th></th></tr></thead><tbody><tr><td style="text-align:left"><code>-a</code></td><td style="text-align:left">âœ… å¿…å¡«</td><td style="text-align:left">ç”¨æˆ·åï¼ˆaccessKeyï¼‰</td><td style="text-align:left"><code>rocketmq_user</code></td><td></td></tr><tr><td style="text-align:left"><code>-s</code></td><td style="text-align:left">âœ… å¿…å¡«</td><td style="text-align:left">å¯†ç ï¼ˆsecretKeyï¼‰</td><td style="text-align:left"><code>12345678</code></td><td></td></tr><tr><td style="text-align:left"><code>-b</code></td><td style="text-align:left">äºŒé€‰ä¸€</td><td style="text-align:left">æŒ‡å®šç›®æ ‡ Broker åœ°å€</td><td style="text-align:left"><code>127.0.0.1:10911</code></td><td></td></tr><tr><td style="text-align:left"><code>-c</code></td><td style="text-align:left">äºŒé€‰ä¸€</td><td style="text-align:left">æŒ‡å®šç›®æ ‡é›†ç¾¤åç§°ï¼Œé›†ç¾¤ä¸­æ‰€æœ‰ Broker éƒ½ä¼šè¢«æ›´æ–°</td><td style="text-align:left"><code>DefaultCluster</code></td><td></td></tr><tr><td style="text-align:left"><code>-g</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left">æŒ‡å®š Group æƒé™åˆ—è¡¨</td><td style="text-align:left"><code>groupA=SUB,groupB=DENY</code></td><td></td></tr><tr><td style="text-align:left"><code>-t</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left">æŒ‡å®š Topic æƒé™åˆ—è¡¨</td><td style="text-align:left">`topicA=PUB</td><td>SUB,topicB=DENY`</td></tr><tr><td style="text-align:left"><code>-u</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left">è®¾ç½®é»˜è®¤ Group æƒé™</td><td style="text-align:left"><code>SUB</code></td><td></td></tr><tr><td style="text-align:left"><code>-i</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left">è®¾ç½®é»˜è®¤ Topic æƒé™</td><td style="text-align:left"><code>DENY</code></td><td></td></tr><tr><td style="text-align:left"><code>-w</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left">è®¾ç½® IP ç™½åå•</td><td style="text-align:left"><code>&quot;10.10.10.*,192.168.1.*&quot;</code></td><td></td></tr><tr><td style="text-align:left"><code>-m</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left">æ˜¯å¦è®¾ç½®ä¸ºç®¡ç†å‘˜è´¦å·</td><td style="text-align:left"><code>true</code> æˆ– <code>false</code></td><td></td></tr><tr><td style="text-align:left"><code>-n</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left">æŒ‡å®š NameServer åœ°å€</td><td style="text-align:left"><code>127.0.0.1:9876</code></td><td></td></tr><tr><td style="text-align:left"><code>-h</code></td><td style="text-align:left">å¦</td><td style="text-align:left">æ‰“å°å¸®åŠ©ä¿¡æ¯</td><td style="text-align:left">â€”</td><td></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤ç”¨æˆ·</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sh bin/mqadmin deleteAccessConfig \</span><br><span class="line">    -n 127.0.0.1:9876 \</span><br><span class="line">    -c DefaultCluster \</span><br><span class="line">    -a mqadmin</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:left">æ˜¯å¦å¿…å¡«</th><th style="text-align:left">å«ä¹‰</th><th style="text-align:left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td style="text-align:left"><code>-a</code></td><td style="text-align:left">âœ… å¿…å¡«</td><td style="text-align:left">è¦åˆ é™¤çš„ç”¨æˆ·åï¼ˆaccessKeyï¼‰</td><td style="text-align:left"><code>rocketmq_user</code></td></tr><tr><td style="text-align:left"><code>-b</code></td><td style="text-align:left">äºŒé€‰ä¸€</td><td style="text-align:left">æŒ‡å®šç›®æ ‡ Broker åœ°å€</td><td style="text-align:left"><code>127.0.0.1:10911</code></td></tr><tr><td style="text-align:left"><code>-c</code></td><td style="text-align:left">äºŒé€‰ä¸€</td><td style="text-align:left">æŒ‡å®šç›®æ ‡é›†ç¾¤åç§°ï¼ˆåˆ é™¤æ•´ä¸ªé›†ç¾¤ä¸Šçš„è¯¥è´¦å·ï¼‰</td><td style="text-align:left"><code>DefaultCluster</code></td></tr><tr><td style="text-align:left"><code>-n</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left">æŒ‡å®š NameServer åœ°å€</td><td style="text-align:left"><code>127.0.0.1:9876</code></td></tr><tr><td style="text-align:left"><code>-h</code></td><td style="text-align:left">å¦</td><td style="text-align:left">æ‰“å°å¸®åŠ©ä¿¡æ¯</td><td style="text-align:left">â€”</td></tr></tbody></table><h2 id="Dashboard-é…ç½®">Dashboard é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶åœ¨ Dashboard ä¸­é…ç½®å¥½è®¤è¯ä¿¡æ¯å¹¶é‡å¯ï¼Œå³å¯æ­£å¸¸è®¿é—®RocketMQé›†ç¾¤ï¼Œä½†æ˜¯å¹¶ä¸æ”¯æŒåœ¨webç«¯é…ç½®ACLè®¤è¯ä¿¡æ¯ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim run/application.yaml # æŒ‰éœ€æ›¿æ¢é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rocketmq:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">namesrvAddrs:</span>                <span class="comment"># å¡«å†™NameServeråœ°å€åˆ—è¡¨</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10.250</span><span class="number">.0</span><span class="number">.175</span><span class="string">:9876</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10.250</span><span class="number">.0</span><span class="number">.188</span><span class="string">:9876</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10.250</span><span class="number">.0</span><span class="number">.131</span><span class="string">:9876</span></span><br><span class="line">    <span class="attr">dataPath:</span> <span class="string">/usr/local/soft/rocketmq/data/dashboard</span> <span class="comment"># Dashboardæ–‡ä»¶ç›®å½•ï¼Œç™»å½•ç”¨æˆ·é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•</span></span><br><span class="line">    <span class="attr">loginRequired:</span> <span class="literal">true</span>  <span class="comment"># æ˜¯å¦éœ€è¦ç™»å½•ï¼Œæ­¤æ—¶éœ€è¦åœ¨ dataPath ä¸‹åˆ›å»º users.properties æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/users.propertiesæ–‡ä»¶</span></span><br><span class="line">    <span class="comment"># å¦‚æœ broker å¼€å¯äº† ACLï¼Œåˆ™éœ€è¦é…ç½® accessKey å’Œ secretKey</span></span><br><span class="line">    <span class="attr">accessKey:</span> <span class="string">mqadmin</span></span><br><span class="line">    <span class="attr">secretKey:</span> <span class="number">1234567</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Proxy-é…ç½®">Proxy é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>Broker å¼€å¯ ACL 1.0 è®¤è¯åï¼Œå³ä½¿åœ¨ä»£ç ä¸­æ·»åŠ äº†ACLè®¤è¯ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œ<a href="https://github.com/apache/rocketmq-clients/tree/master/java/client/src/main/java/org/apache/rocketmq/client/java/example">æ–°ç‰ˆå®¢æˆ·ç«¯(rocketmq-client-java)</a>é€šè¿‡<code>Proxy</code>å‘é€æˆ–è®¢é˜…æ¶ˆæ¯ä¾æ—§ä¼šå¤±è´¥ï¼Œ<a href="https://github.com/apache/rocketmq/tree/develop/example">åŸå®¢æˆ·ç«¯(rocketmq-client)</a>é€šè¿‡<code>Nameserver</code>å‘é€æˆ–è®¢é˜…æ¶ˆæ¯æ­£å¸¸ï¼Œå°šä¸çŸ¥é“è¯¥å¦‚ä½•å®Œç¾è§£å†³ã€‚</p></li></ul><h3 id="ç›®å‰æœ‰ä¸¤ç§æ²¡ä»€ä¹ˆæ„ä¹‰çš„è§£å†³æ–¹æ³•ï¼š">ç›®å‰æœ‰ä¸¤ç§æ²¡ä»€ä¹ˆæ„ä¹‰çš„è§£å†³æ–¹æ³•ï¼š</h3><ul class="lvl-0"><li class="lvl-2"><ol><li class="lvl-5">å°† Proxy IP æ·»åŠ åˆ°ç™½åå•ï¼Œå› ä¸ºå®¢æˆ·ç«¯è¿æ¥Proxyåï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯ç”±Proxyè½¬å‘ï¼Œæ‰€ä»¥å°†Proxy IPæ·»åŠ åˆ°ç™½åå•å³å¯å…äºè®¤è¯ï¼Œè¯¥æ–¹æ³•æ— éœ€é‡å¯å³å¯ç”Ÿæ•ˆ</li></ol></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sh bin/mqadmin updateGlobalWhiteAddr \</span><br><span class="line">    -n 127.0.0.1:9876 \</span><br><span class="line">    -c DefaultCluster \</span><br><span class="line">    -g 10.250.0.*</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><ol start="2"><li class="lvl-5">ä¸º Proxy å¼€å¯ <code>enableAclRpcHookForClusterMode</code></li></ol><ul class="lvl-2"><li class="lvl-6">ä¿®æ”¹<code>conf/rmq-proxy.json</code>æ–‡ä»¶ï¼Œæ·»åŠ <code>enableAclRpcHookForClusterMode</code>å‚æ•°</li></ul>  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;enableAclRpcHookForClusterMode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br></pre></td></tr></table></figure><ul class="lvl-2"><li class="lvl-6">ä¿®æ”¹<code>conf/tools.yml</code>æ–‡ä»¶ï¼Œé…ç½®å¸å·ä¿¡æ¯ï¼š</li></ul>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">accessKey:</span> <span class="string">mqadmin</span></span><br><span class="line"><span class="attr">secretKey:</span> <span class="number">1234567</span></span><br></pre></td></tr></table></figure><ul class="lvl-2"><li class="lvl-6">é‡æ–°å¯åŠ¨Proxyå³å¯</li></ul></li><li class="lvl-2"><p>ä¸¤ç§æ–¹æ³•ï¼Œå®¢æˆ·ç«¯ä»£ç éƒ½ä¸éœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œç”šè‡³ä¸éœ€è¦æ·»åŠ ACLè®¤è¯ä¿¡æ¯</p></li><li class="lvl-2"><p>ä½†è¿™æ ·åšæ²¡å•¥æ„ä¹‰ï¼Œproxyä¹Ÿå¯ä»¥é…ç½®aclï¼Œä½†æ˜¯æ²¡ææ‡‚å¦‚ä½•é…ç½®</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» RocketMQ ACL 1.0 çš„ä½¿ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://rocketmq.apache.org/zh/&quot;&gt;RocketMQå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;RocketMQ ä» 5.3.0 èµ·å¼•å…¥å®‰å…¨æ€§æ›´é«˜çš„ ACL 2.0ï¼Œ5.3.2 æ˜¯æœ€åä¸€ä¸ªè¿˜æ”¯æŒ ACL 1.0 çš„ç‰ˆæœ¬ï¼Œ5.3.3 ç§»é™¤äº† ACL 1.0ï¼Œå®˜æ–¹å»ºè®®æ‰€æœ‰ä½¿ç”¨ Apache RocketMQ ACL çš„ç”¨æˆ·è¿ç§»åˆ° ACL 2.0ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ Admin Tool</title>
    <link href="https://blog.hanqunfeng.com/2025/10/28/rocketmq-07-admin-tool/"/>
    <id>https://blog.hanqunfeng.com/2025/10/28/rocketmq-07-admin-tool/</id>
    <published>2025-10-28T13:40:05.000Z</published>
    <updated>2025-10-31T08:54:49.101Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» RocketMQ Admin Tool çš„å¸¸ç”¨å‘½ä»¤ã€‚</p></li><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/">RocketMQå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p></li></ul><span id="more"></span><h2 id="RocketMQ-Admin-Tool-ç®€ä»‹">RocketMQ Admin Tool ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/docs/deploymentOperations/02admintool">RocketMQ Admin Tool</a> æ˜¯ RocketMQ çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† RocketMQ çš„é›†ç¾¤ã€‚</p></li></ul><h2 id="Topic-ç›¸å…³å‘½ä»¤">Topic ç›¸å…³å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºæˆ–æ›´æ–° Topic</p></li></ul><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:left">å…¨ç§°</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:left">å¯é€‰å€¼ / æ ¼å¼</th><th style="text-align:left">æ˜¯å¦å¿…å¡«</th><th style="text-align:left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td style="text-align:left"><code>-t</code></td><td style="text-align:left"><code>--topic</code></td><td style="text-align:left">ä¸»é¢˜åç§°</td><td style="text-align:left">å­—ç¬¦ä¸²</td><td style="text-align:left">âœ… å¿…å¡«</td><td style="text-align:left"><code>-t MyTopic</code></td></tr><tr><td style="text-align:left"><code>-b</code></td><td style="text-align:left"><code>--brokerAddr</code></td><td style="text-align:left">æŒ‡å®šåˆ›å»º Topic çš„ Broker åœ°å€ï¼ˆä¸ <code>-c</code> äºŒé€‰ä¸€ï¼‰</td><td style="text-align:left"><code>ip:port</code></td><td style="text-align:left">âœ… å¿…å¡«ï¼ˆä¸ <code>-c</code> äºŒé€‰ä¸€ï¼‰</td><td style="text-align:left"><code>-b 192.168.1.10:10911</code></td></tr><tr><td style="text-align:left"><code>-c</code></td><td style="text-align:left"><code>--clusterName</code></td><td style="text-align:left">æŒ‡å®šåˆ›å»º Topic çš„é›†ç¾¤åï¼ˆä¸ <code>-b</code> äºŒé€‰ä¸€ï¼‰</td><td style="text-align:left">å­—ç¬¦ä¸²</td><td style="text-align:left">âœ… å¿…å¡«ï¼ˆä¸ <code>-b</code> äºŒé€‰ä¸€ï¼‰</td><td style="text-align:left"><code>-c DefaultCluster</code></td></tr><tr><td style="text-align:left"><code>-n</code></td><td style="text-align:left"><code>--namesrvAddr</code></td><td style="text-align:left">NameServer åœ°å€åˆ—è¡¨</td><td style="text-align:left">å¤šä¸ªåœ°å€ç”¨ <code>;</code> åˆ†éš”</td><td style="text-align:left">å¯é€‰</td><td style="text-align:left"><code>-n 192.168.1.1:9876;192.168.1.2:9876</code></td></tr><tr><td style="text-align:left"><code>-r</code></td><td style="text-align:left"><code>--readQueueNums</code></td><td style="text-align:left">è¯»é˜Ÿåˆ—æ•°é‡ï¼Œé»˜è®¤ä¸º8ï¼Œå§‹ç»ˆä¿æŒ r == w</td><td style="text-align:left">æ•´æ•°</td><td style="text-align:left">å¯é€‰</td><td style="text-align:left"><code>-r 4</code></td></tr><tr><td style="text-align:left"><code>-w</code></td><td style="text-align:left"><code>--writeQueueNums</code></td><td style="text-align:left">å†™é˜Ÿåˆ—æ•°é‡ï¼Œé»˜è®¤ä¸º8ï¼Œå§‹ç»ˆä¿æŒ r == w</td><td style="text-align:left">æ•´æ•°</td><td style="text-align:left">å¯é€‰</td><td style="text-align:left"><code>-w 4</code></td></tr><tr><td style="text-align:left"><code>-p</code></td><td style="text-align:left"><code>--perm</code></td><td style="text-align:left">Topic æƒé™ï¼Œé»˜è®¤ä¸º6</td><td style="text-align:left">2ï¼šå†™ï¼ˆWï¼‰<br>4ï¼šè¯»ï¼ˆRï¼‰<br>6ï¼šè¯»å†™ï¼ˆRWï¼‰</td><td style="text-align:left">å¯é€‰</td><td style="text-align:left"><code>-p 6</code></td></tr><tr><td style="text-align:left"><code>-o</code></td><td style="text-align:left"><code>--order</code></td><td style="text-align:left">æ˜¯å¦é¡ºåº Topicï¼Œå…¼å®¹4.xç‰ˆæœ¬ï¼Œ5.xç‰ˆæœ¬ä½¿ç”¨ -a â€œ+message.type=FIFOâ€</td><td style="text-align:left"><code>true</code> / <code>false</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left"><code>-o false</code></td></tr><tr><td style="text-align:left"><code>-u</code></td><td style="text-align:left"><code>--unit</code></td><td style="text-align:left">æ˜¯å¦ä¸ºå•å…ƒï¼ˆUnitï¼‰Topicï¼ˆç”¨äºå¤šç§Ÿæˆ·éš”ç¦»ï¼‰</td><td style="text-align:left"><code>true</code> / <code>false</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left"><code>-u false</code></td></tr><tr><td style="text-align:left"><code>-s</code></td><td style="text-align:left"><code>--hasUnitSub</code></td><td style="text-align:left">æ˜¯å¦æœ‰ Unit è®¢é˜…</td><td style="text-align:left"><code>true</code> / <code>false</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left"><code>-s false</code></td></tr><tr><td style="text-align:left"><code>-a</code></td><td style="text-align:left"><code>--attributes</code></td><td style="text-align:left">é¢å¤–å±æ€§è®¾ç½®ï¼Œç”¨ <code>+</code> è¡¨ç¤ºæ·»åŠ ã€<code>-</code> è¡¨ç¤ºåˆ é™¤</td><td style="text-align:left">ä¾‹ï¼š<code>+a=b,+c=d,-e</code></td><td style="text-align:left">å¯é€‰</td><td style="text-align:left"><code>-a &quot;+message.type=NORMAL&quot;</code></td></tr><tr><td style="text-align:left"><code>-h</code></td><td style="text-align:left"><code>--help</code></td><td style="text-align:left">æ‰“å°å¸®åŠ©ä¿¡æ¯</td><td style="text-align:left">æ— </td><td style="text-align:left">å¦</td><td style="text-align:left"><code>-h</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º Topicï¼Œæ­¤æ—¶ Topic ç±»å‹ä¸º UNSPECIFIEDï¼Œé›†ç¾¤ä¸‹æ‰€æœ‰ Broker éƒ½ä¼šåˆ›å»ºè¯¥ Topic</span></span><br><span class="line">sh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster</span><br><span class="line"><span class="comment"># ä»…åœ¨æŒ‡å®šçš„ Broker ä¸­åˆ›å»º Topicï¼Œæ³¨æ„åªèƒ½åœ¨ Master èŠ‚ç‚¹ä¸Šåˆ›å»º</span></span><br><span class="line">sh bin/mqadmin updateTopic  -n 127.0.0.1:9876 -b 10.250.0.31:10911 -t newTopic</span><br><span class="line"><span class="comment"># åˆ›å»º Topicï¼Œå¹¶æŒ‡å®š Topic ç±»å‹ä¸º NORMALï¼Œæ”¯æŒçš„æ¶ˆæ¯ç±»å‹ï¼šUNSPECIFIED, TRANSACTION, FIFO, MIXED, DELAY, NORMAL</span></span><br><span class="line">sh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster -a <span class="string">&quot;+message.type=NORMAL&quot;</span></span><br><span class="line"><span class="comment"># åˆ›å»º Topicï¼Œå¹¶æŒ‡å®š Topic ç±»å‹ä¸º FIFOï¼ŒåŒæ—¶æŒ‡å®šè¯»å†™é˜Ÿåˆ—æ•°é‡éƒ½ä¸º 4</span></span><br><span class="line">sh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster -r 4 -w 4 -a <span class="string">&quot;+message.type=FIFO&quot;</span></span><br><span class="line"><span class="comment"># æŒ‡å®šæƒé™ï¼Œé»˜è®¤ä¸º 6ï¼šè¯»å†™</span></span><br><span class="line">sh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster -p 6</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ä¸åˆ é™¤ Topic</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰ Topicï¼Œæ­¤æ—¶åªæ‰“å° topic åˆ—è¡¨</span></span><br><span class="line">sh bin/mqadmin topicList -n 127.0.0.1:9876</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰ Topicï¼Œ-c å‚æ•°è¡¨ç¤ºåŒæ—¶æ‰“å° Cluster Name å’Œ Consumer Group</span></span><br><span class="line">sh bin/mqadmin topicList -n 127.0.0.1:9876 -c</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ Topicï¼Œåˆ é™¤æŒ‡å®šé›†ç¾¤ä¸‹çš„æŒ‡å®šTopic</span></span><br><span class="line">sh bin/mqadmin deleteTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å…¶å®ƒ Topic å‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ Topic è·¯ç”±ä¿¡æ¯</span></span><br><span class="line">sh bin/mqadmin topicRoute -n 127.0.0.1:9876 -t newTopic</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;brokerDatas&quot;</span>:[</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;brokerAddrs&quot;</span>:&#123;0:<span class="string">&quot;10.250.0.188:11011&quot;</span>,1:<span class="string">&quot;10.250.0.31:10911&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;brokerName&quot;</span>:<span class="string">&quot;broker-b&quot;</span>,</span><br><span class="line"><span class="string">&quot;cluster&quot;</span>:<span class="string">&quot;DefaultCluster&quot;</span>,</span><br><span class="line"><span class="string">&quot;enableActingMaster&quot;</span>:<span class="literal">false</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;brokerAddrs&quot;</span>:&#123;0:<span class="string">&quot;10.250.0.31:11011&quot;</span>,1:<span class="string">&quot;10.250.0.188:10911&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;brokerName&quot;</span>:<span class="string">&quot;broker-a&quot;</span>,</span><br><span class="line"><span class="string">&quot;cluster&quot;</span>:<span class="string">&quot;DefaultCluster&quot;</span>,</span><br><span class="line"><span class="string">&quot;enableActingMaster&quot;</span>:<span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;filterServerTable&quot;</span>:&#123;&#125;,</span><br><span class="line"><span class="string">&quot;queueDatas&quot;</span>:[</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;brokerName&quot;</span>:<span class="string">&quot;broker-b&quot;</span>,</span><br><span class="line"><span class="string">&quot;perm&quot;</span>:6,</span><br><span class="line"><span class="string">&quot;readQueueNums&quot;</span>:8,</span><br><span class="line"><span class="string">&quot;topicSysFlag&quot;</span>:0,</span><br><span class="line"><span class="string">&quot;writeQueueNums&quot;</span>:8</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;brokerName&quot;</span>:<span class="string">&quot;broker-a&quot;</span>,</span><br><span class="line"><span class="string">&quot;perm&quot;</span>:6,</span><br><span class="line"><span class="string">&quot;readQueueNums&quot;</span>:8,</span><br><span class="line"><span class="string">&quot;topicSysFlag&quot;</span>:0,</span><br><span class="line"><span class="string">&quot;writeQueueNums&quot;</span>:8</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ Topic æ¶ˆæ¯é˜Ÿåˆ—offset</span></span><br><span class="line">sh bin/mqadmin topicStatus -n 127.0.0.1:9876 -t newTopic</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="comment">#Broker Name                      #QID  #Min Offset           #Max Offset             #Last Updated</span></span><br><span class="line">broker-a                          0     0                     3                       2025-10-27 03:08:43,112</span><br><span class="line">broker-a                          1     0                     4                       2025-10-27 06:13:21,968</span><br><span class="line">broker-a                          2     0                     2                       2025-10-27 06:13:34,685</span><br><span class="line">broker-a                          3     0                     2                       2025-10-26 05:44:17,222</span><br><span class="line">broker-a                          4     0                     1                       2025-10-26 05:44:45,513</span><br><span class="line">broker-a                          5     0                     1                       2025-10-26 06:13:10,541</span><br><span class="line">broker-a                          6     0                     2                       2025-10-26 02:58:34,393</span><br><span class="line">broker-a                          7     0                     1                       2025-10-25 12:42:41,189</span><br><span class="line">broker-b                          0     0                     1                       2025-10-25 14:01:24,836</span><br><span class="line">broker-b                          1     0                     2                       2025-10-26 06:14:24,411</span><br><span class="line">broker-b                          2     0                     0</span><br><span class="line">broker-b                          3     0                     0</span><br><span class="line">broker-b                          4     0                     0</span><br><span class="line">broker-b                          5     0                     1                       2025-10-25 12:30:57,672</span><br><span class="line">broker-b                          6     0                     1                       2025-10-26 06:19:47,051</span><br><span class="line">broker-b                          7     0                     1                       2025-10-26 06:14:49,216</span><br></pre></td></tr></table></figure><h2 id="é›†ç¾¤ç›¸å…³å‘½ä»¤">é›†ç¾¤ç›¸å…³å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼Œé›†ç¾¤ã€BrokerNameã€BrokerIdã€TPSç­‰ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é›†ç¾¤ä¿¡æ¯</span></span><br><span class="line">sh bin/mqadmin clusterList -n 127.0.0.1:9876 -c DefaultCluster</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="comment">#Cluster Name           #Broker Name            #BID  #Addr                  #Version              #InTPS(LOAD)                   #OutTPS(LOAD)  #Timer(Progress)        #PCWait(ms)  #Hour         #SPACE    #ACTIVATED</span></span><br><span class="line">DefaultCluster          broker-a                0     10.250.0.31:11011      V5_3_2                 0.00(0,0ms)               2.60(0,0ms|0,0ms)  1-0(0.0w, 0.0, 0.0)               0  67.03         0.3300          <span class="literal">true</span></span><br><span class="line">DefaultCluster          broker-a                1     10.250.0.188:10911     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  3-0(0.0w, 0.0, 0.0)               0  67.03         0.3200         <span class="literal">false</span></span><br><span class="line">DefaultCluster          broker-b                0     10.250.0.188:11011     V5_3_2                 0.00(0,0ms)               0.80(0,0ms|0,0ms)  1-0(0.0w, 0.0, 0.0)               0  67.17         0.3200          <span class="literal">true</span></span><br><span class="line">DefaultCluster          broker-b                1     10.250.0.31:10911      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  1-0(0.0w, 0.0, 0.0)               0  67.17         0.3300         <span class="literal">false</span></span><br><span class="line"><span class="comment">## Broker ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line"><span class="comment">#BID: BrokerIdï¼Œ0 è¡¨ç¤º Masterï¼Œ&gt;0 è¡¨ç¤º Slave</span></span><br><span class="line"><span class="comment">#InTPS(LOAD): ç”Ÿäº§è€…å†™å…¥ TPS ä¸è´Ÿè½½ï¼Œ 0.00(0,0ms): æ¯ç§’å…¥ç«™æ¶ˆæ¯æ•°(é˜Ÿåˆ—æ•°ï¼Œå¹³å‡è€—æ—¶)</span></span><br><span class="line"><span class="comment">#OutTPS(LOAD): æ¶ˆè´¹è€…æ‹‰å– TPS ä¸è´Ÿè½½ï¼Œ2.60(0,0ms|0,0ms): æ¯ç§’å‡ºç«™æ¶ˆæ¯æ•°(é˜Ÿåˆ—æ•°ï¼Œå¹³å‡è€—æ—¶|å¹³å‡å»¶æ—¶)</span></span><br><span class="line"><span class="comment">#Timer(Progress): Broker çš„æ¶ˆæ¯å¤„ç†è¿›åº¦ï¼Œæ ¼å¼å¦‚ 1-0(0.0w, 0.0, 0.0)ï¼šå‰é¢æ˜¯å®šæ—¶è½®æ¬¡è¿›åº¦ï¼Œæ‹¬å·å†…æ˜¯å†™å…¥ç­‰å¾…ç­‰ç»Ÿè®¡</span></span><br><span class="line"><span class="comment">#PCWait(ms): è¡¨ç¤º Broker å†™å…¥ PageCache çš„å¹³å‡ç­‰å¾…æ—¶é—´ï¼Œæ•°å€¼è¶Šä½è¶Šå¥½</span></span><br><span class="line"><span class="comment">#Hour: è¡¨ç¤º Broker å·²è¿è¡Œçš„æ—¶é•¿</span></span><br><span class="line"><span class="comment">#SPACE: ç£ç›˜ç©ºé—´ä½¿ç”¨æ¯”ä¾‹ï¼Œå°æ•°å½¢å¼ï¼Œä¾‹å¦‚ 0.3300 è¡¨ç¤ºä½¿ç”¨äº† 33.0%</span></span><br><span class="line"><span class="comment">#ACTIVATED: true è¡¨ç¤ºå½“å‰ Master æ­£åœ¨å·¥ä½œï¼›false è¡¨ç¤ºä»èŠ‚ç‚¹æˆ–å¤‡ç”¨ Master</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹é›†ç¾¤ç»Ÿè®¡ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sh bin/mqadmin clusterList -n 127.0.0.1:9876 -c DefaultCluster -m</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="comment">#Cluster Name     #Broker Name                       #InTotalYest  #OutTotalYest  #InTotalToday #OutTotalToday</span></span><br><span class="line">DefaultCluster    broker-a                                      0              0              0              0</span><br><span class="line">DefaultCluster    broker-a                                      0              0              0              0</span><br><span class="line">DefaultCluster    broker-b                                      0            369              0              0</span><br><span class="line">DefaultCluster    broker-b                                      0              0              0              0</span><br><span class="line"><span class="comment">## Broker ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line"><span class="comment">#InTotalYestï¼šæ˜¨æ—¥å…¥ç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨æ˜¨å¤©æ¥æ”¶ï¼ˆç”Ÿäº§è€…å†™å…¥ï¼‰çš„æ¶ˆæ¯æ€»æ•°</span></span><br><span class="line"><span class="comment">#OutTotalYestï¼šæ˜¨æ—¥å‡ºç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨æ˜¨å¤©å‘é€ï¼ˆæ¶ˆè´¹è€…æ¶ˆè´¹ï¼‰çš„æ¶ˆæ¯æ€»æ•°</span></span><br><span class="line"><span class="comment">#InTotalTodayï¼šä»Šæ—¥å…¥ç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨ä»Šå¤©æ¥æ”¶ï¼ˆç”Ÿäº§è€…å†™å…¥ï¼‰çš„æ¶ˆæ¯æ€»æ•°</span></span><br><span class="line"><span class="comment">#OutTotalTodayï¼šä»Šæ—¥å‡ºç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨ä»Šå¤©å‘é€ï¼ˆæ¶ˆè´¹è€…æ¶ˆè´¹ï¼‰çš„æ¶ˆæ¯æ€»æ•°</span></span><br></pre></td></tr></table></figure><h2 id="æ¶ˆæ¯ç›¸å…³">æ¶ˆæ¯ç›¸å…³</h2><h3 id="å‘é€æ¶ˆæ¯">å‘é€æ¶ˆæ¯</h3><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:left">å…¨å†™</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:center">æ˜¯å¦å¿…å¡«</th><th style="text-align:left">ç¤ºä¾‹å€¼</th><th style="text-align:left">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:left"><code>-t</code></td><td style="text-align:left"><code>--topic</code></td><td style="text-align:left">æ¶ˆæ¯è¦å‘é€çš„ Topic åç§°</td><td style="text-align:center">âœ…</td><td style="text-align:left"><code>TestTopic</code></td><td style="text-align:left">å¿…é¡»æŒ‡å®šç›®æ ‡ Topic</td></tr><tr><td style="text-align:left"><code>-p</code></td><td style="text-align:left"><code>--body</code></td><td style="text-align:left">æ¶ˆæ¯ä½“å†…å®¹ï¼ˆUTF-8 å­—ç¬¦ä¸²ï¼‰</td><td style="text-align:center">âœ…</td><td style="text-align:left"><code>&quot;Hello RocketMQ&quot;</code></td><td style="text-align:left">å®é™…æ¶ˆæ¯å†…å®¹</td></tr><tr><td style="text-align:left"><code>-n</code></td><td style="text-align:left"><code>--namesrvAddr</code></td><td style="text-align:left">NameServer åœ°å€</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>127.0.0.1:9876</code></td><td style="text-align:left">ä¸æŒ‡å®šåˆ™ç”¨é»˜è®¤é…ç½®</td></tr><tr><td style="text-align:left"><code>-b</code></td><td style="text-align:left"><code>--broker</code></td><td style="text-align:left">æŒ‡å®šå‘é€åˆ°å“ªä¸ª broker</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>broker-a</code></td><td style="text-align:left">ä¸€èˆ¬ç”¨äºæµ‹è¯• Broker çŠ¶æ€</td></tr><tr><td style="text-align:left"><code>-i</code></td><td style="text-align:left"><code>--qid</code></td><td style="text-align:left">æŒ‡å®šå‘é€åˆ°çš„é˜Ÿåˆ— ID</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>2</code></td><td style="text-align:left">ä¸€èˆ¬ä¸éœ€è¦è®¾ç½®ï¼ŒRocketMQ ä¼šè‡ªåŠ¨é€‰æ‹©</td></tr><tr><td style="text-align:left"><code>-c</code></td><td style="text-align:left"><code>--tags</code></td><td style="text-align:left">æ¶ˆæ¯çš„æ ‡ç­¾ï¼ˆtagï¼‰</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>testTag</code></td><td style="text-align:left">ç”¨äºæ¶ˆæ¯è¿‡æ»¤</td></tr><tr><td style="text-align:left"><code>-k</code></td><td style="text-align:left"><code>--key</code></td><td style="text-align:left">æ¶ˆæ¯çš„ä¸šåŠ¡é”®ï¼ˆkeyï¼‰</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>order123</code></td><td style="text-align:left">å¯ç”¨äºè¿½è¸ªæ¶ˆæ¯</td></tr><tr><td style="text-align:left"><code>-m</code></td><td style="text-align:left"><code>--msgTraceEnable</code></td><td style="text-align:left">æ˜¯å¦å¼€å¯æ¶ˆæ¯è½¨è¿¹</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>true</code></td><td style="text-align:left">é»˜è®¤ <code>false</code></td></tr><tr><td style="text-align:left"><code>-h</code></td><td style="text-align:left"><code>--help</code></td><td style="text-align:left">æ‰“å°å¸®åŠ©ä¿¡æ¯</td><td style="text-align:center">âŒ</td><td style="text-align:left">æ— </td><td style="text-align:left">æ˜¾ç¤ºå‘½ä»¤å‚æ•°è¯´æ˜</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘é€æ¶ˆæ¯</span></span><br><span class="line">sh bin/mqadmin sendMessage -n 127.0.0.1:9876 -t TestTopic -p <span class="string">&quot;Hello RocketMQ&quot;</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="comment">#Broker Name                      #QID  #Send Result            #MsgId</span></span><br><span class="line">broker-b                          2     SEND_OK                 0AFA00AFCF171EB44E468CC7D5EE0000</span><br><span class="line"><span class="comment">## è¾“å‡ºè§£é‡Š</span></span><br><span class="line"><span class="comment">#Broker Name: Broker åç§°</span></span><br><span class="line"><span class="comment">#QID: é˜Ÿåˆ— ID</span></span><br><span class="line"><span class="comment">#Send Result: å‘é€ç»“æœï¼ŒSEND_OK è¡¨ç¤ºæˆåŠŸ</span></span><br><span class="line"><span class="comment">#MsgId: æ¶ˆæ¯ ID</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®š tagsã€key</span></span><br><span class="line">sh bin/mqadmin sendMessage -n 127.0.0.1:9876 -t TestTopic -p <span class="string">&quot;Hello RocketMQ&quot;</span> -c testTag -k order123</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆè´¹æ¶ˆæ¯">æ¶ˆè´¹æ¶ˆæ¯</h3><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:left">å…¨å†™</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:center">æ˜¯å¦å¿…å¡«</th><th style="text-align:left">ç¤ºä¾‹å€¼</th><th style="text-align:left">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:left"><code>-t</code></td><td style="text-align:left"><code>--topic</code></td><td style="text-align:left">ç›®æ ‡ Topic åç§°</td><td style="text-align:center">âœ…</td><td style="text-align:left"><code>TestTopic</code></td><td style="text-align:left">å¿…å¡«</td></tr><tr><td style="text-align:left"><code>-n</code></td><td style="text-align:left"><code>--namesrvAddr</code></td><td style="text-align:left">NameServer åœ°å€</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>127.0.0.1:9876</code></td><td style="text-align:left">å»ºè®®å¡«å†™ä»¥é¿å…é»˜è®¤é…ç½®ä¸ç”Ÿæ•ˆ</td></tr><tr><td style="text-align:left"><code>-g</code></td><td style="text-align:left"><code>--consumerGroup</code></td><td style="text-align:left">æ¶ˆè´¹ç»„åç§°</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>TestGroup</code></td><td style="text-align:left">å¯æŒ‡å®šæ¶ˆè´¹ç»„ï¼ˆå½±å“æ¶ˆè´¹ä½ç‚¹ï¼‰</td></tr><tr><td style="text-align:left"><code>-b</code></td><td style="text-align:left"><code>--brokerName</code></td><td style="text-align:left">Broker åç§°</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>broker-a</code></td><td style="text-align:left">æŒ‡å®šä»å“ªä¸ª broker æ‹‰å–æ¶ˆæ¯</td></tr><tr><td style="text-align:left"><code>-i</code></td><td style="text-align:left"><code>--queueId</code></td><td style="text-align:left">é˜Ÿåˆ— ID</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>0</code></td><td style="text-align:left">é»˜è®¤ä» 0 å·é˜Ÿåˆ—å¼€å§‹</td></tr><tr><td style="text-align:left"><code>-o</code></td><td style="text-align:left"><code>--offset</code></td><td style="text-align:left">é˜Ÿåˆ—èµ·å§‹åç§»é‡ï¼ˆoffsetï¼‰</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>0</code></td><td style="text-align:left">æŒ‡å®šä»å“ªä¸ªä½ç½®å¼€å§‹æ¶ˆè´¹</td></tr><tr><td style="text-align:left"><code>-c</code></td><td style="text-align:left"><code>--MessageNumber</code></td><td style="text-align:left">æ¶ˆè´¹æ¶ˆæ¯æ•°é‡</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>10</code></td><td style="text-align:left">é»˜è®¤é€šå¸¸ä¸º 1</td></tr><tr><td style="text-align:left"><code>-s</code></td><td style="text-align:left"><code>--beginTimestamp</code></td><td style="text-align:left">èµ·å§‹æ—¶é—´</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>2025-10-28#10:00:00:000</code></td><td style="text-align:left">æ ¼å¼æˆ–æ—¶é—´æˆ³å‡å¯</td></tr><tr><td style="text-align:left"><code>-e</code></td><td style="text-align:left"><code>--endTimestamp</code></td><td style="text-align:left">ç»“æŸæ—¶é—´</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>2025-10-28#12:00:00:000</code></td><td style="text-align:left">ä¸ <code>-s</code> ä¸€èµ·ä½¿ç”¨</td></tr><tr><td style="text-align:left"><code>-h</code></td><td style="text-align:left"><code>--help</code></td><td style="text-align:left">æ‰“å°å¸®åŠ©ä¿¡æ¯</td><td style="text-align:center">âŒ</td><td style="text-align:left">æ— </td><td style="text-align:left">æ˜¾ç¤ºå‘½ä»¤å‚æ•°è¯´æ˜</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ä»é˜Ÿåˆ— 0 å¼€å§‹æ¶ˆè´¹ï¼Œæ‹‰å–å…¨éƒ¨æ¶ˆæ¯</span></span><br><span class="line">sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic</span><br><span class="line"><span class="comment"># æ‹‰å–æŒ‡å®šæ¡æ•°çš„æ¶ˆæ¯ï¼Œ-c æŒ‡å®šæ‹‰å–æ¡æ•°</span></span><br><span class="line">sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -c 10</span><br><span class="line"><span class="comment"># æŒ‡å®šåç§»é‡ï¼Œæ­¤æ—¶å¿…é¡»åŒæ—¶æŒ‡å®š brokerNameã€queueIdã€offset</span></span><br><span class="line">sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -b broker-b -i 2 -o 3</span><br><span class="line"><span class="comment"># æŒ‡å®šæ¶ˆè´¹è€…ç»„</span></span><br><span class="line">sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -g TestGroup</span><br><span class="line"><span class="comment"># æŒ‡å®šæ—¶é—´èŒƒå›´</span></span><br><span class="line">sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -s 2025-10-28#00:00:00:000 -e 2025-10-28#08:00:00:000</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆè´¹ç»“æœ">æ¶ˆè´¹ç»“æœ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Consume ok</span><br><span class="line">MSGID: 0AFA00AFCF171EB44E468CC7D5EE0000</span><br><span class="line">MessageExt [brokerName=broker-b, queueId=2, storeSize=228, queueOffset=0, sysFlag=0,</span><br><span class="line">  bornTimestamp=1761638706671, bornHost=/10.250.0.175:41362,</span><br><span class="line">  storeTimestamp=1761638706691, storeHost=/10.250.0.188:11011,</span><br><span class="line">  msgId=0AFA00BC00002B0300000000000CA1E9, commitLogOffset=827881,</span><br><span class="line">  bodyCRC=1774740973, reconsumeTimes=0, preparedTransactionOffset=0,</span><br><span class="line">  toString()=Message&#123;topic=<span class="string">&#x27;TestTopic&#x27;</span>, flag=0,</span><br><span class="line">    properties=&#123;MSG_REGION=DefaultRegion, UNIQ_KEY=0AFA00AFCF171EB44E468CC7D5EE0000,</span><br><span class="line">      CLUSTER=DefaultCluster, MIN_OFFSET=0, WAIT=<span class="literal">true</span>, TRACE_ON=<span class="literal">true</span>, MAX_OFFSET=1&#125;,</span><br><span class="line">    body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81],</span><br><span class="line">    transactionId=<span class="string">&#x27;null&#x27;</span>&#125;]</span><br><span class="line">BODY: Hello RocketMQ</span><br><span class="line"></span><br><span class="line">MessageQueue [topic=TestTopic, brokerName=broker-b, queueId=2] <span class="built_in">print</span> msg finished. status=NO_NEW_MSG, offset=1</span><br><span class="line">The older -1 message of the 2 queue will be provided</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ğŸ“˜ å­—æ®µè§£æè¡¨æ ¼</p></li></ul><table><thead><tr><th style="text-align:left">å­—æ®µ</th><th style="text-align:left">ç¤ºä¾‹å€¼</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left"><strong>MSGID</strong></td><td style="text-align:left"><code>0AFA00AFCF171EB44E468CC7D5EE0000</code></td><td style="text-align:left">æ¶ˆæ¯å”¯ä¸€æ ‡è¯†ï¼ˆå®¢æˆ·ç«¯ç”Ÿæˆï¼‰</td></tr><tr><td style="text-align:left"><strong>brokerName</strong></td><td style="text-align:left"><code>broker-b</code></td><td style="text-align:left">æ¶ˆæ¯å­˜å‚¨åœ¨å“ªä¸ª Broker ä¸Š</td></tr><tr><td style="text-align:left"><strong>queueId</strong></td><td style="text-align:left"><code>2</code></td><td style="text-align:left">å­˜å‚¨çš„é˜Ÿåˆ—ç¼–å·ï¼ˆTestTopic æœ‰å¤šä¸ªé˜Ÿåˆ—æ—¶çš„ç¬¬ 3 ä¸ªï¼‰</td></tr><tr><td style="text-align:left"><strong>queueOffset</strong></td><td style="text-align:left"><code>0</code></td><td style="text-align:left">é˜Ÿåˆ—ä¸­çš„åç§»é‡ï¼ˆä» 0 å¼€å§‹ï¼‰</td></tr><tr><td style="text-align:left"><strong>storeSize</strong></td><td style="text-align:left"><code>228</code></td><td style="text-align:left">æ¶ˆæ¯åœ¨ç£ç›˜ä¸­çš„å­˜å‚¨å­—èŠ‚å¤§å°</td></tr><tr><td style="text-align:left"><strong>sysFlag</strong></td><td style="text-align:left"><code>0</code></td><td style="text-align:left">æ¶ˆæ¯ç³»ç»Ÿæ ‡å¿—ä½ï¼ˆå†…éƒ¨ç”¨é€”ï¼‰</td></tr><tr><td style="text-align:left"><strong>bornTimestamp</strong></td><td style="text-align:left"><code>1761638706671</code></td><td style="text-align:left">æ¶ˆæ¯åœ¨ç”Ÿäº§è€…ç«¯åˆ›å»ºçš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</td></tr><tr><td style="text-align:left"><strong>bornHost</strong></td><td style="text-align:left"><code>/10.250.0.175:41362</code></td><td style="text-align:left">ç”Ÿäº§è€…å®¢æˆ·ç«¯çš„ IP å’Œç«¯å£</td></tr><tr><td style="text-align:left"><strong>storeTimestamp</strong></td><td style="text-align:left"><code>1761638706691</code></td><td style="text-align:left">æ¶ˆæ¯è¢« Broker å­˜å‚¨çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</td></tr><tr><td style="text-align:left"><strong>storeHost</strong></td><td style="text-align:left"><code>/10.250.0.188:11011</code></td><td style="text-align:left">Broker çš„å­˜å‚¨èŠ‚ç‚¹åœ°å€</td></tr><tr><td style="text-align:left"><strong>msgId</strong></td><td style="text-align:left"><code>0AFA00BC00002B0300000000000CA1E9</code></td><td style="text-align:left">æ¶ˆæ¯åœ¨ Broker å­˜å‚¨ç³»ç»Ÿç”Ÿæˆçš„å”¯ä¸€ ID</td></tr><tr><td style="text-align:left"><strong>commitLogOffset</strong></td><td style="text-align:left"><code>827881</code></td><td style="text-align:left">æ¶ˆæ¯åœ¨ commitLog æ–‡ä»¶ä¸­çš„åç§»é‡</td></tr><tr><td style="text-align:left"><strong>bodyCRC</strong></td><td style="text-align:left"><code>1774740973</code></td><td style="text-align:left">æ¶ˆæ¯ä½“çš„ CRC æ ¡éªŒç ï¼ˆç”¨äºæ ¡éªŒæ•°æ®ä¸€è‡´æ€§ï¼‰</td></tr><tr><td style="text-align:left"><strong>reconsumeTimes</strong></td><td style="text-align:left"><code>0</code></td><td style="text-align:left">è¢«é‡æ–°æ¶ˆè´¹çš„æ¬¡æ•°ï¼ˆ0 è¡¨ç¤ºç¬¬ä¸€æ¬¡æ¶ˆè´¹ï¼‰</td></tr><tr><td style="text-align:left"><strong>preparedTransactionOffset</strong></td><td style="text-align:left"><code>0</code></td><td style="text-align:left">å¦‚æœæ˜¯äº‹åŠ¡æ¶ˆæ¯ï¼Œè¿™é‡Œä¼šè®°å½•é¢„æäº¤åç§»é‡ï¼›æ™®é€šæ¶ˆæ¯ä¸º 0</td></tr><tr><td style="text-align:left"><strong>topic</strong></td><td style="text-align:left"><code>TestTopic</code></td><td style="text-align:left">æ¶ˆæ¯æ‰€å±ä¸»é¢˜</td></tr><tr><td style="text-align:left"><strong>properties</strong></td><td style="text-align:left"><code>&#123;MSG_REGION=DefaultRegion, UNIQ_KEY=..., ...&#125;</code></td><td style="text-align:left">æ¶ˆæ¯å±æ€§ï¼ŒåŒ…æ‹¬ç³»ç»Ÿå±æ€§ä¸ç”¨æˆ·å±æ€§</td></tr><tr><td style="text-align:left"><strong>body</strong></td><td style="text-align:left"><code>[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81]</code></td><td style="text-align:left">æ¶ˆæ¯ä½“çš„å­—èŠ‚æ•°ç»„</td></tr><tr><td style="text-align:left"><strong>BODYï¼ˆè§£ç åï¼‰</strong></td><td style="text-align:left"><code>Hello RocketMQ</code></td><td style="text-align:left">å®é™…æ¶ˆæ¯å†…å®¹ï¼ˆUTF-8 å­—ç¬¦ä¸²ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>âš™ï¸ æ¶ˆæ¯çŠ¶æ€è¯´æ˜</p></li></ul><table><thead><tr><th style="text-align:left">è¾“å‡ºä¿¡æ¯</th><th style="text-align:left">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:left"><code>Consume ok</code></td><td style="text-align:left">è¡¨ç¤ºæˆåŠŸä» Broker æ‹‰å–æ¶ˆæ¯</td></tr><tr><td style="text-align:left"><code>status=NO_NEW_MSG</code></td><td style="text-align:left">å½“å‰é˜Ÿåˆ—ï¼ˆqueueId=2ï¼‰ä¸­å·²ç»æ²¡æœ‰æ¯” offset=1 æ›´æ–°çš„æ¶ˆæ¯</td></tr><tr><td style="text-align:left"><code>offset=1</code></td><td style="text-align:left">å½“å‰é˜Ÿåˆ—æ¶ˆè´¹åˆ° offset=1ï¼ˆä¸‹æ¬¡æ¶ˆè´¹ä»æ­¤å¼€å§‹ï¼‰</td></tr><tr><td style="text-align:left"><code>The older -1 message of the 2 queue will be provided</code></td><td style="text-align:left">è¿™æ˜¯ä¸€å¥æç¤ºè¯­ï¼Œæ„æ€æ˜¯ï¼šé˜Ÿåˆ—ä¸­æ²¡æœ‰æ›´æ—©çš„æ¶ˆæ¯ï¼ˆoffset=-1 è¡¨ç¤ºæ— å†å²æ¶ˆæ¯ï¼‰</td></tr></tbody></table><h3 id="æŸ¥è¯¢æ¶ˆæ¯">æŸ¥è¯¢æ¶ˆæ¯</h3><h4 id="æ ¹æ®æ¶ˆæ¯-ID-æŸ¥è¯¢æ¶ˆæ¯-queryMsgById">æ ¹æ®æ¶ˆæ¯ ID æŸ¥è¯¢æ¶ˆæ¯(queryMsgById)</h4><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:left">å…¨å†™</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:center">æ˜¯å¦å¿…å¡«</th><th style="text-align:left">ç¤ºä¾‹å€¼</th><th style="text-align:left">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:left"><code>-i</code></td><td style="text-align:left"><code>--msgId</code></td><td style="text-align:left">è¦æŸ¥è¯¢çš„æ¶ˆæ¯ ID</td><td style="text-align:center">âœ…</td><td style="text-align:left"><code>0AFA00AFCF171EB44E468CC7D5EE0000</code></td><td style="text-align:left">å¿…å¡«ï¼Œç”¨äºç²¾ç¡®å®šä½æ¶ˆæ¯</td></tr><tr><td style="text-align:left"><code>-t</code></td><td style="text-align:left"><code>--topic</code></td><td style="text-align:left">ç›®æ ‡ Topic åç§°</td><td style="text-align:center">âœ…</td><td style="text-align:left"><code>TestTopic</code></td><td style="text-align:left">å¿…å¡«</td></tr><tr><td style="text-align:left"><code>-n</code></td><td style="text-align:left"><code>--namesrvAddr</code></td><td style="text-align:left">NameServer åœ°å€</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>127.0.0.1:9876</code></td><td style="text-align:left">å»ºè®®æ˜ç¡®æŒ‡å®š</td></tr><tr><td style="text-align:left"><code>-c</code></td><td style="text-align:left"><code>--cluster</code></td><td style="text-align:left">é›†ç¾¤åç§°æˆ– LMQ çˆ¶ Topic</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>DefaultCluster</code></td><td style="text-align:left">åœ¨å¤šé›†ç¾¤åœºæ™¯ä¸‹ä½¿ç”¨</td></tr><tr><td style="text-align:left"><code>-g</code></td><td style="text-align:left"><code>--consumerGroup</code></td><td style="text-align:left">æ¶ˆè´¹ç»„åç§°</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>TestGroup</code></td><td style="text-align:left">å½“ç”¨äºæ¶ˆè´¹è€…å…³è”æŸ¥è¯¢æ—¶å¯æŒ‡å®š</td></tr><tr><td style="text-align:left"><code>-d</code></td><td style="text-align:left"><code>--clientId</code></td><td style="text-align:left">æ¶ˆè´¹è€…å®¢æˆ·ç«¯ ID</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>192.168.0.1@12345</code></td><td style="text-align:left">è¾…åŠ©å®šä½æ¶ˆè´¹å®ä¾‹</td></tr><tr><td style="text-align:left"><code>-f</code></td><td style="text-align:left"><code>--bodyFormat</code></td><td style="text-align:left">æ¶ˆæ¯ä½“è¾“å‡ºæ ¼å¼</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>UTF-8</code> / <code>HEX</code> / <code>BASE64</code></td><td style="text-align:left">é»˜è®¤ UTF-8</td></tr><tr><td style="text-align:left"><code>-s</code></td><td style="text-align:left"><code>--sendMessage</code></td><td style="text-align:left">æ˜¯å¦é‡æ–°å‘é€æ¶ˆæ¯</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>true</code></td><td style="text-align:left">è°ƒè¯•æ—¶å¯ä½¿ç”¨</td></tr><tr><td style="text-align:left"><code>-u</code></td><td style="text-align:left"><code>--unitName</code></td><td style="text-align:left">å•å…ƒåï¼ˆå¤šå•å…ƒéƒ¨ç½²æ—¶ä½¿ç”¨ï¼‰</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>unit01</code></td><td style="text-align:left">ä¸€èˆ¬åœºæ™¯å¯å¿½ç•¥</td></tr><tr><td style="text-align:left"><code>-h</code></td><td style="text-align:left"><code>--help</code></td><td style="text-align:left">æ‰“å°å¸®åŠ©ä¿¡æ¯</td><td style="text-align:center">âŒ</td><td style="text-align:left">æ— </td><td style="text-align:left">æ˜¾ç¤ºå‘½ä»¤è¯´æ˜</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sh bin/mqadmin queryMsgById -n 127.0.0.1:9876 -t TestTopic -i 0AFA00AFCF171EB44E468CC7D5EE0000 -f UTF-8</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">OffsetID:            0AFA00BC00002B0300000000000CA1E9</span><br><span class="line">Topic:               TestTopic</span><br><span class="line">Tags:                [null]</span><br><span class="line">Keys:                [null]</span><br><span class="line">Queue ID:            2</span><br><span class="line">Queue Offset:        0</span><br><span class="line">CommitLog Offset:    827881</span><br><span class="line">Reconsume Times:     0</span><br><span class="line">Born Timestamp:      2025-10-28 08:05:06,671</span><br><span class="line">Store Timestamp:     2025-10-28 08:05:06,691</span><br><span class="line">Born Host:           10.250.0.175:41362</span><br><span class="line">Store Host:          10.250.0.188:11011</span><br><span class="line">System Flag:         0</span><br><span class="line">Properties:          &#123;MSG_REGION=DefaultRegion, UNIQ_KEY=0AFA00AFCF171EB44E468CC7D5EE0000, CLUSTER=DefaultCluster, WAIT=<span class="literal">true</span>, TRACE_ON=<span class="literal">true</span>&#125;</span><br><span class="line">Message Body Path:   /tmp/rocketmq/msgbodys/0AFA00AFCF171EB44E468CC7D5EE0000</span><br><span class="line">Message Body:        Hello RocketMQ</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¾“å‡ºå­—æ®µè¯¦è§£</p></li></ul><table><thead><tr><th style="text-align:left">å­—æ®µå</th><th style="text-align:left">å«ä¹‰</th><th style="text-align:left">ç¤ºä¾‹</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left"><strong>OffsetID</strong></td><td style="text-align:left">æ¶ˆæ¯åœ¨ CommitLog ä¸­çš„åç§»æ ‡è¯†ï¼ˆå†…éƒ¨å®šä½ä½¿ç”¨ï¼‰</td><td style="text-align:left"><code>0AFA00BC00002B0300000000000CA1E9</code></td><td style="text-align:left">å¯ç”¨äº broker å†…éƒ¨è¿½è¸ªå®šä½æ¶ˆæ¯</td></tr><tr><td style="text-align:left"><strong>Topic</strong></td><td style="text-align:left">ä¸»é¢˜åç§°</td><td style="text-align:left"><code>TestTopic</code></td><td style="text-align:left">æ¶ˆæ¯æ‰€å±çš„ä¸»é¢˜</td></tr><tr><td style="text-align:left"><strong>Tags</strong></td><td style="text-align:left">æ¶ˆæ¯æ ‡ç­¾</td><td style="text-align:left"><code>[null]</code></td><td style="text-align:left">è‹¥ç”Ÿäº§æ¶ˆæ¯æ—¶æœªè®¾ç½® tagï¼Œåˆ™ä¸º null</td></tr><tr><td style="text-align:left"><strong>Keys</strong></td><td style="text-align:left">æ¶ˆæ¯é”®</td><td style="text-align:left"><code>[null]</code></td><td style="text-align:left">é€šå¸¸å¯ç”¨äºä¸šåŠ¡å±‚ç´¢å¼•æŸ¥è¯¢</td></tr><tr><td style="text-align:left"><strong>Queue ID</strong></td><td style="text-align:left">æ¶ˆæ¯æ‰€åœ¨çš„é˜Ÿåˆ—ç¼–å·</td><td style="text-align:left"><code>2</code></td><td style="text-align:left">å¯¹åº” topic çš„ç¬¬ 3 ä¸ªé˜Ÿåˆ—ï¼ˆä» 0 å¼€å§‹ï¼‰</td></tr><tr><td style="text-align:left"><strong>Queue Offset</strong></td><td style="text-align:left">é˜Ÿåˆ—åç§»é‡</td><td style="text-align:left"><code>0</code></td><td style="text-align:left">è¡¨ç¤ºæ˜¯è¯¥é˜Ÿåˆ—çš„ç¬¬ä¸€æ¡æ¶ˆæ¯</td></tr><tr><td style="text-align:left"><strong>CommitLog Offset</strong></td><td style="text-align:left">æ¶ˆæ¯åœ¨ commitlog æ–‡ä»¶ä¸­çš„åç§»é‡</td><td style="text-align:left"><code>827881</code></td><td style="text-align:left">broker å­˜å‚¨å±‚ä½ç½®</td></tr><tr><td style="text-align:left"><strong>Reconsume Times</strong></td><td style="text-align:left">è¢«é‡æ–°æ¶ˆè´¹çš„æ¬¡æ•°</td><td style="text-align:left"><code>0</code></td><td style="text-align:left">è¡¨ç¤ºæœªé‡è¯•æ¶ˆè´¹è¿‡</td></tr><tr><td style="text-align:left"><strong>Born Timestamp</strong></td><td style="text-align:left">æ¶ˆæ¯ç”Ÿæˆæ—¶é—´</td><td style="text-align:left"><code>2025-10-28 08:05:06,671</code></td><td style="text-align:left">ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶é—´</td></tr><tr><td style="text-align:left"><strong>Store Timestamp</strong></td><td style="text-align:left">æ¶ˆæ¯å­˜å‚¨æ—¶é—´</td><td style="text-align:left"><code>2025-10-28 08:05:06,691</code></td><td style="text-align:left">broker å†™å…¥æ¶ˆæ¯çš„æ—¶é—´ï¼ˆé€šå¸¸ç›¸å·®å‡ æ¯«ç§’ï¼‰</td></tr><tr><td style="text-align:left"><strong>Born Host</strong></td><td style="text-align:left">ç”Ÿäº§è€…å®¢æˆ·ç«¯ IP:ç«¯å£</td><td style="text-align:left"><code>10.250.0.175:41362</code></td><td style="text-align:left">ç”Ÿäº§è€…æ‰€åœ¨æœºå™¨</td></tr><tr><td style="text-align:left"><strong>Store Host</strong></td><td style="text-align:left">broker å­˜å‚¨è¯¥æ¶ˆæ¯çš„åœ°å€</td><td style="text-align:left"><code>10.250.0.188:11011</code></td><td style="text-align:left">å¯¹åº”çš„ broker æœåŠ¡ç«¯</td></tr><tr><td style="text-align:left"><strong>System Flag</strong></td><td style="text-align:left">ç³»ç»Ÿæ ‡å¿—ä½</td><td style="text-align:left"><code>0</code></td><td style="text-align:left">å†…éƒ¨ä½¿ç”¨ï¼ˆæ ‡è¯†å‹ç¼©/äº‹åŠ¡ç­‰ï¼‰</td></tr><tr><td style="text-align:left"><strong>Properties</strong></td><td style="text-align:left">æ¶ˆæ¯å±æ€§</td><td style="text-align:left"><code>&#123;MSG_REGION=DefaultRegion, UNIQ_KEY=..., CLUSTER=DefaultCluster, WAIT=true, TRACE_ON=true&#125;</code></td><td style="text-align:left">åŒ…å« RocketMQ è‡ªåŠ¨é™„åŠ çš„å…ƒæ•°æ®</td></tr><tr><td style="text-align:left"><strong>Message Body Path</strong></td><td style="text-align:left">æ¶ˆæ¯ä½“åœ¨æœ¬åœ°ä¿å­˜çš„æ–‡ä»¶è·¯å¾„</td><td style="text-align:left"><code>/tmp/rocketmq/msgbodys/0AFA00AFCF171EB44E468CC7D5EE0000</code></td><td style="text-align:left">RocketMQ CLI å°†æ¶ˆæ¯ä½“å†…å®¹ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰å†™å…¥æ–‡ä»¶ä»¥ä¾›æŸ¥çœ‹</td></tr><tr><td style="text-align:left"><strong>Message Body</strong></td><td style="text-align:left">æ¶ˆæ¯å†…å®¹</td><td style="text-align:left"><code>Hello RocketMQ</code></td><td style="text-align:left">æ¶ˆæ¯å†…å®¹</td></tr></tbody></table><h4 id="æ ¹æ®æ¶ˆæ¯-Key-æŸ¥è¯¢æ¶ˆæ¯-queryMsgByKey">æ ¹æ®æ¶ˆæ¯ Key æŸ¥è¯¢æ¶ˆæ¯(queryMsgByKey)</h4><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:center">å¿…å¡«</th><th style="text-align:left">ç¤ºä¾‹</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left"><code>-t, --topic</code></td><td style="text-align:center">âœ…</td><td style="text-align:left"><code>TestTopic</code></td><td style="text-align:left">è¦æŸ¥è¯¢çš„ä¸»é¢˜åç§°</td></tr><tr><td style="text-align:left"><code>-k, --msgKey</code></td><td style="text-align:center">âœ…</td><td style="text-align:left"><code>order_10001</code></td><td style="text-align:left">å‘é€æ¶ˆæ¯æ—¶è®¾ç½®çš„ä¸šåŠ¡ Key</td></tr><tr><td style="text-align:left"><code>-n, --namesrvAddr</code></td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>127.0.0.1:9876</code></td><td style="text-align:left">NameServer åœ°å€</td></tr><tr><td style="text-align:left"><code>-c, --cluster</code></td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>DefaultCluster</code></td><td style="text-align:left">æŒ‡å®šé›†ç¾¤åç§°ï¼ˆå¯é€‰ï¼‰</td></tr><tr><td style="text-align:left"><code>-b, --beginTimestamp</code></td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>1730083200000</code></td><td style="text-align:left">æŸ¥è¯¢èµ·å§‹æ—¶é—´æˆ³ï¼ˆmsï¼‰</td></tr><tr><td style="text-align:left"><code>-e, --endTimestamp</code></td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>1730173200000</code></td><td style="text-align:left">æŸ¥è¯¢ç»“æŸæ—¶é—´æˆ³ï¼ˆmsï¼‰</td></tr><tr><td style="text-align:left"><code>-m, --maxNum</code></td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>64</code></td><td style="text-align:left">è¿”å›çš„æœ€å¤§æ¶ˆæ¯æ•°ï¼Œé»˜è®¤ 64</td></tr><tr><td style="text-align:left"><code>-h, --help</code></td><td style="text-align:center">âŒ</td><td style="text-align:left">-</td><td style="text-align:left">æ‰“å°å¸®åŠ©ä¿¡æ¯</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sh bin/mqadmin queryMsgByKey -n 127.0.0.1:9876 -t TestTopic -k order123</span><br><span class="line"><span class="comment">## æŸ¥è¯¢ç»“æœ</span></span><br><span class="line"><span class="comment">#Message ID                                        #QID                                  #Offset</span></span><br><span class="line">0AFA00AFCF781EB44E468CC902A30000                      7                                        1</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆè´¹è€…">æ¶ˆè´¹è€…</h2><h4 id="åˆ›å»ºæˆ–æ›´æ–°æ¶ˆè´¹è€…è®¢é˜…ç»„-updateSubGroup">åˆ›å»ºæˆ–æ›´æ–°æ¶ˆè´¹è€…è®¢é˜…ç»„(updateSubGroup)</h4><ul class="lvl-0"><li class="lvl-2"><p>æ¶ˆè´¹è€…è®¢é˜…ç»„ å°±æ˜¯ æ¶ˆè´¹è€…ç»„ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯è°ƒæ•´æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä¾‹å¦‚ï¼š</p><ul class="lvl-2"><li class="lvl-6">æ¶ˆè´¹é¡ºåºï¼ˆé¡ºåº/å¹¶å‘ï¼‰</li><li class="lvl-6">å¹¿æ’­æ¨¡å¼</li><li class="lvl-6">æ¶ˆè´¹ä½¿èƒ½</li><li class="lvl-6">æ¶ˆè´¹é‡è¯•ç­–ç•¥</li><li class="lvl-6">å»¶è¿Ÿæ¶ˆè´¹é˜Ÿåˆ—ç­‰</li></ul></li></ul><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:left">å…¨å†™</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:center">æ˜¯å¦å¿…å¡«</th><th style="text-align:left">ç¤ºä¾‹å€¼</th><th style="text-align:left">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:left"><code>-g</code></td><td style="text-align:left"><code>--groupName</code></td><td style="text-align:left">æ¶ˆè´¹è€…ç»„åç§°</td><td style="text-align:center">âœ…</td><td style="text-align:left"><code>TestConsumerGroup</code></td><td style="text-align:left">å¿…å¡«</td></tr><tr><td style="text-align:left"><code>-n</code></td><td style="text-align:left"><code>--namesrvAddr</code></td><td style="text-align:left">NameServer åœ°å€</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>127.0.0.1:9876</code></td><td style="text-align:left">å»ºè®®æ˜ç¡®æŒ‡å®š</td></tr><tr><td style="text-align:left"><code>-b</code></td><td style="text-align:left"><code>--brokerAddr</code></td><td style="text-align:left">æŒ‡å®š Broker åœ°å€</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>10.250.0.188:10911</code></td><td style="text-align:left">ä»…å¯¹å• Broker æ›´æ–°</td></tr><tr><td style="text-align:left"><code>-c</code></td><td style="text-align:left"><code>--clusterName</code></td><td style="text-align:left">æŒ‡å®š Cluster åç§°</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>DefaultCluster</code></td><td style="text-align:left">å¯¹æ•´ä¸ªé›†ç¾¤æ›´æ–°</td></tr><tr><td style="text-align:left"><code>-d</code></td><td style="text-align:left"><code>--consumeBroadcastEnable</code></td><td style="text-align:left">æ˜¯å¦å¹¿æ’­æ¶ˆè´¹</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>true</code> / <code>false</code></td><td style="text-align:left">true è¡¨ç¤ºå¹¿æ’­ï¼Œfalse è¡¨ç¤ºé›†ç¾¤æ¨¡å¼</td></tr><tr><td style="text-align:left"><code>-o</code></td><td style="text-align:left"><code>--consumeMessageOrderly</code></td><td style="text-align:left">æ˜¯å¦é¡ºåºæ¶ˆè´¹</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>true</code> / <code>false</code></td><td style="text-align:left">é¡ºåºæ¶ˆè´¹åªåœ¨åŒé˜Ÿåˆ—ä¸­ç”Ÿæ•ˆ</td></tr><tr><td style="text-align:left"><code>-i</code></td><td style="text-align:left"><code>--brokerId</code></td><td style="text-align:left">ä»å“ªä¸ª Broker è·å–è®¢é˜…ä¿¡æ¯</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>0</code></td><td style="text-align:left">å†…éƒ¨ç”¨é€”ï¼Œé€šå¸¸ä¸ç”¨è®¾ç½®</td></tr><tr><td style="text-align:left"><code>-m</code></td><td style="text-align:left"><code>--consumeFromMinEnable</code></td><td style="text-align:left">æ˜¯å¦ä»æœ€å° offset æ¶ˆè´¹</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>true</code> / <code>false</code></td><td style="text-align:left">æ–°ç»„é¦–æ¬¡æ¶ˆè´¹æ—¶ç”Ÿæ•ˆ</td></tr><tr><td style="text-align:left"><code>-p</code></td><td style="text-align:left"><code>--groupRetryPolicy</code></td><td style="text-align:left">æ¶ˆè´¹ç»„é‡è¯•ç­–ç•¥ JSON</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>&#123;&quot;type&quot;:&quot;EXPONENTIAL&quot;,&quot;exponentialRetryPolicy&quot;:&#123;&quot;initial&quot;:5000,&quot;max&quot;:7200000,&quot;multiplier&quot;:2&#125;&#125;</code></td><td style="text-align:left">å¯ä»¥è‡ªå®šä¹‰é‡è¯•é—´éš”</td></tr><tr><td style="text-align:left"><code>-q</code></td><td style="text-align:left"><code>--retryQueueNums</code></td><td style="text-align:left">é‡è¯•é˜Ÿåˆ—æ•°é‡</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>1</code> ~ <code>16</code></td><td style="text-align:left">é»˜è®¤ä¸º 1</td></tr><tr><td style="text-align:left"><code>-r</code></td><td style="text-align:left"><code>--retryMaxTimes</code></td><td style="text-align:left">æœ€å¤§é‡è¯•æ¬¡æ•°</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>16</code></td><td style="text-align:left">é»˜è®¤ 16 æ¬¡</td></tr><tr><td style="text-align:left"><code>-s</code></td><td style="text-align:left"><code>--consumeEnable</code></td><td style="text-align:left">æ˜¯å¦ä½¿èƒ½æ¶ˆè´¹</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>true</code> / <code>false</code></td><td style="text-align:left">false è¡¨ç¤ºæš‚åœæ¶ˆè´¹</td></tr><tr><td style="text-align:left"><code>-w</code></td><td style="text-align:left"><code>--whichBrokerWhenConsumeSlowly</code></td><td style="text-align:left">æ…¢æ¶ˆè´¹é€‰æ‹© Broker ID</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>0</code></td><td style="text-align:left">å†…éƒ¨ä½¿ç”¨</td></tr><tr><td style="text-align:left"><code>-a</code></td><td style="text-align:left"><code>--notifyConsumerIdsChanged</code></td><td style="text-align:left">é€šçŸ¥ ConsumerId æ”¹å˜</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>true</code> / <code>false</code></td><td style="text-align:left">å¯è§¦å‘æ¶ˆè´¹è€…åˆ·æ–°è®¢é˜…ä¿¡æ¯</td></tr><tr><td style="text-align:left"><code>--attributes</code></td><td style="text-align:left"><code>--attributes</code></td><td style="text-align:left">å…¶ä»–è‡ªå®šä¹‰å±æ€§</td><td style="text-align:center">âŒ</td><td style="text-align:left"><code>attr1=val1,attr2=val2</code></td><td style="text-align:left">å¯è®¾ç½®è‡ªå®šä¹‰é…ç½®</td></tr><tr><td style="text-align:left"><code>-h</code></td><td style="text-align:left"><code>--help</code></td><td style="text-align:left">æ‰“å°å¸®åŠ©</td><td style="text-align:center">âŒ</td><td style="text-align:left">-</td><td style="text-align:left">æ˜¾ç¤ºå‘½ä»¤å¸®åŠ©</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ™®é€šæ¶ˆè´¹è€…ç»„</span></span><br><span class="line">sh bin/mqadmin updateSubGroup -c DefaultCluster -g NormalGroup -n 127.0.0.1:9876</span><br><span class="line"><span class="comment"># åˆ›å»ºé¡ºåºæ¶ˆè´¹ç»„</span></span><br><span class="line">sh bin/mqadmin updateSubGroup -c DefaultCluster -g FIFOGroup -n 127.0.0.1:9876 -o <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå¹¿æ’­æ¶ˆè´¹ç»„</span></span><br><span class="line">sh bin/mqadmin updateSubGroup -c DefaultCluster -g BroadcastGroup -n 127.0.0.1:9876 -d <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè‡ªå®šä¹‰å±æ€§çš„æ¶ˆè´¹è€…ç»„ï¼Œè¿™é‡Œé…ç½®äº†é‡è¯•ç­–ç•¥</span></span><br><span class="line">sh bin/mqadmin updateSubGroup -n 127.0.0.1:9876 -g TestConsumerGroup -c DefaultCluster -d <span class="literal">true</span> -o <span class="literal">true</span> -m <span class="literal">true</span> -p <span class="string">&#x27;&#123;&quot;type&quot;:&quot;EXPONENTIAL&quot;,&quot;exponentialRetryPolicy&quot;:&#123;&quot;initial&quot;:5000,&quot;max&quot;:7200000,&quot;multiplier&quot;:2&#125;&#125;&#x27;</span> -q 1 -r 16 -s <span class="literal">true</span> -w 0 -a <span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤æ¶ˆè´¹è€…è®¢é˜…ç»„-deleteSubGroup">åˆ é™¤æ¶ˆè´¹è€…è®¢é˜…ç»„(deleteSubGroup)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh bin/mqadmin deleteSubGroup -n 127.0.0.1:9876 -g TestConsumerGroup -c DefaultCluster</span><br></pre></td></tr></table></figure><h2 id="é‡è¦è¯´æ˜">é‡è¦è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœ RocketMQ å¼€å¯äº† ACLï¼Œæ— è®ºæ˜¯ ACL 1.0 è¿˜æ˜¯ ACL 2.0ï¼Œéƒ½éœ€è¦åœ¨ <code>conf/tools.yml</code> é…ç½®æ­£ç¡®çš„è´¦å·å¯†ç ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ <code>mqadmin</code> å‘½ä»¤ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">accessKey:</span> <span class="string">mqadmin</span></span><br><span class="line"><span class="attr">secretKey:</span> <span class="number">1234567</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» RocketMQ Admin Tool çš„å¸¸ç”¨å‘½ä»¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://rocketmq.apache.org/zh/&quot;&gt;RocketMQå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ Proxy çš„é…ç½®é¡¹</title>
    <link href="https://blog.hanqunfeng.com/2025/10/28/rocketmq-06-proxy-config/"/>
    <id>https://blog.hanqunfeng.com/2025/10/28/rocketmq-06-proxy-config/</id>
    <published>2025-10-28T13:33:05.000Z</published>
    <updated>2025-10-30T06:45:46.620Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» RocketMQ Proxy çš„é…ç½®é¡¹ã€‚</p></li><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/">RocketMQå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p></li></ul><span id="more"></span><h2 id="é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹">é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>å½“å‰ç‰ˆæœ¬å°šä¸æ”¯æŒé€šè¿‡å‘½ä»¤è¡ŒæŸ¥çœ‹ Proxy çš„é…ç½®é¡¹ï¼Œä½†æ˜¯åœ¨å¯åŠ¨Proxyçš„æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°å½“å‰ç”Ÿæ•ˆçš„é…ç½®é¡¹ã€‚</p></li><li class="lvl-2"><p>å¦å¤–åœ¨æºç  <code>rocketmq-all-5.3.2-source-release/proxy</code> çš„å¯åŠ¨ç±» <code>org.apache.rocketmq.proxy.ProxyStartup</code>ä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±»</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.rocketmq.proxy.config.ProxyConfig</span><br></pre></td></tr></table></figure><h2 id="é…ç½®é¡¹è¯´æ˜">é…ç½®é¡¹è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p>Proxy é…ç½®å‚æ•°è¯´æ˜ä¸ä¼˜åŒ–å»ºè®®ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼ŒProxyçš„é…ç½®æ–‡ä»¶æ˜¯ JSON æ ¼å¼</p></li></ul><table><thead><tr><th style="text-align:left">åˆ†ç±»</th><th style="text-align:left">å‚æ•°å</th><th style="text-align:left">é»˜è®¤å€¼</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:left">ä¼˜åŒ–å»ºè®®</th></tr></thead><tbody><tr><td style="text-align:left"><strong>åŸºç¡€ä¿¡æ¯</strong></td><td style="text-align:left"><code>rocketMQClusterName</code></td><td style="text-align:left"><code>DefaultCluster</code></td><td style="text-align:left">Broker é›†ç¾¤åç§°ï¼ˆProxy ç”¨äºå…³è” RocketMQ é›†ç¾¤ï¼‰</td><td style="text-align:left">è‹¥æœ‰å¤šä¸ªé›†ç¾¤ï¼Œåº”å”¯ä¸€å‘½å</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>proxyClusterName</code></td><td style="text-align:left"><code>DefaultCluster</code></td><td style="text-align:left">Proxy æ‰€å±é›†ç¾¤åç§°ï¼ˆä¸ brokerClusterName å¯ä¸åŒï¼‰</td><td style="text-align:left">âœ…å»ºè®®ç‹¬ç«‹å‘½åï¼ŒåŒºåˆ† Proxy é›†ç¾¤</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>proxyName</code></td><td style="text-align:left">ä¸»æœºåï¼ˆä¾‹ï¼š<code>ip-10-250-0-175...</code>ï¼‰</td><td style="text-align:left">Proxy å®ä¾‹åç§°ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†</td><td style="text-align:left">âœ…å»ºè®®è®¾ç½®å”¯ä¸€åç§°</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>localServeAddr</code></td><td style="text-align:left">æœ¬åœ° IP</td><td style="text-align:left">Proxy æœ¬åœ°æœåŠ¡åœ°å€ï¼ˆRemoting é€šä¿¡ä½¿ç”¨ï¼‰</td><td style="text-align:left">âœ…å»ºè®®æ˜¾å¼æŒ‡å®š IP</td></tr><tr><td style="text-align:left"><strong>Namesrv</strong></td><td style="text-align:left"><code>namesrvAddr</code></td><td style="text-align:left">å¤šä¸ªåœ°å€ï¼ˆåˆ†å·åˆ†éš”ï¼‰</td><td style="text-align:left">NameServer åœ°å€ï¼ŒProxy é€šè¿‡å®ƒåŒæ­¥è·¯ç”±</td><td style="text-align:left">âœ…æ¨èé…ç½®ä¸ºå¯è®¿é—®çš„å†…ç½‘åœ°å€</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>namesrvDomain</code></td><td style="text-align:left">ç©º</td><td style="text-align:left">NameServer åŸŸåï¼ˆå¯ç”¨äºåŠ¨æ€è§£æï¼‰</td><td style="text-align:left">å¯é€‰ï¼ŒDNS æ–¹å¼æ—¶ä½¿ç”¨</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>namesrvDomainSubgroup</code></td><td style="text-align:left">ç©º</td><td style="text-align:left">å­åŸŸåˆ†ç»„ï¼ˆå¤šé›†ç¾¤åŸŸåå‘ç°ç”¨ï¼‰</td><td style="text-align:left">ä¸€èˆ¬å¯å¿½ç•¥</td></tr><tr><td style="text-align:left"><strong>TLS é…ç½®</strong></td><td style="text-align:left"><code>tlsTestModeEnable</code></td><td style="text-align:left">true</td><td style="text-align:left">æµ‹è¯•æ¨¡å¼ä¸‹è·³è¿‡éªŒè¯ï¼ˆä»…ç”¨äºæœ¬åœ°æµ‹è¯•ï¼‰</td><td style="text-align:left">â—ç”Ÿäº§åº”è®¾ä¸º false</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>tlsKeyPath</code></td><td style="text-align:left"><code>/conf/tls/rocketmq.key</code></td><td style="text-align:left">TLS ç§é’¥è·¯å¾„</td><td style="text-align:left">âœ…æ ¹æ®è¯ä¹¦è·¯å¾„è°ƒæ•´</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>tlsCertPath</code></td><td style="text-align:left"><code>/conf/tls/rocketmq.crt</code></td><td style="text-align:left">TLS è¯ä¹¦è·¯å¾„</td><td style="text-align:left">âœ…æ ¹æ®è¯ä¹¦è·¯å¾„è°ƒæ•´</td></tr><tr><td style="text-align:left"><strong>gRPC åŸºç¡€</strong></td><td style="text-align:left"><code>proxyMode</code></td><td style="text-align:left"><code>CLUSTER</code></td><td style="text-align:left">Proxy æ¨¡å¼ï¼šCLUSTER / LOCAL / REMOTING</td><td style="text-align:left">âœ…ç”Ÿäº§æ¨è CLUSTER</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>grpcServerPort</code></td><td style="text-align:left">8081</td><td style="text-align:left">gRPC æœåŠ¡ç«¯ç›‘å¬ç«¯å£</td><td style="text-align:left">è‹¥å†²çªå¯ä¿®æ”¹</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>grpcShutdownTimeSeconds</code></td><td style="text-align:left">30</td><td style="text-align:left">ä¼˜é›…å…³é—­ç­‰å¾…æ—¶é—´</td><td style="text-align:left">å¯é€‚å½“è°ƒå¤§</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>enableGrpcEpoll</code></td><td style="text-align:left">false</td><td style="text-align:left">å¯ç”¨ Linux epoll I/O æ¨¡å‹</td><td style="text-align:left">âœ…Linux å»ºè®®å¼€å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>grpcMaxInboundMessageSize</code></td><td style="text-align:left">136314880 (~130MB)</td><td style="text-align:left">æœ€å¤§å…¥ç«™æ¶ˆæ¯å¤§å°</td><td style="text-align:left">æ ¹æ®æ¶ˆæ¯å¤§å°è°ƒæ•´</td></tr><tr><td style="text-align:left"><strong>æ¶ˆæ¯é™åˆ¶</strong></td><td style="text-align:left"><code>maxMessageSize</code></td><td style="text-align:left">4194304 (4MB)</td><td style="text-align:left">æœ€å¤§æ¶ˆæ¯ä½“å¤§å°</td><td style="text-align:left">âœ…åº”ä¸ Broker ä¸€è‡´</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>enableMessageBodyEmptyCheck</code></td><td style="text-align:left">true</td><td style="text-align:left">æ ¡éªŒæ¶ˆæ¯ä½“æ˜¯å¦ä¸ºç©º</td><td style="text-align:left">ä¿æŒé»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>maxUserPropertySize</code></td><td style="text-align:left">16384 (16KB)</td><td style="text-align:left">ç”¨æˆ·å±æ€§æœ€å¤§é•¿åº¦</td><td style="text-align:left">æ ¹æ®ä¸šåŠ¡å¤æ‚åº¦è°ƒæ•´</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>userPropertyMaxNum</code></td><td style="text-align:left">128</td><td style="text-align:left">å•æ¡æ¶ˆæ¯æœ€å¤§å±æ€§æ•°é‡</td><td style="text-align:left">å¯é€‚å½“è°ƒä½é˜²æ­¢æ€§èƒ½æŸè€—</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>maxMessageGroupSize</code></td><td style="text-align:left">64</td><td style="text-align:left">æœ€å¤§æ¶ˆæ¯ç»„å¤§å°ï¼ˆæ‰¹é‡ pop ä½¿ç”¨ï¼‰</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>æ¶ˆæ¯å¯è§æ€§ä¸å»¶è¿Ÿ</strong></td><td style="text-align:left"><code>defaultInvisibleTimeMills</code></td><td style="text-align:left">60000 (60s)</td><td style="text-align:left">pop æ¶ˆæ¯é»˜è®¤ä¸å¯è§æ—¶é—´</td><td style="text-align:left">âœ…é«˜å¹¶å‘æ—¶å¯è°ƒä½</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>maxInvisibleTimeMills</code></td><td style="text-align:left">43200000 (12h)</td><td style="text-align:left">æœ€å¤§ä¸å¯è§æ—¶é•¿</td><td style="text-align:left">âœ…å¯æ ¹æ®ä¸šåŠ¡é™ä½</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>maxDelayTimeMills</code></td><td style="text-align:left">86400000 (1d)</td><td style="text-align:left">æœ€å¤§å»¶è¿Ÿæ—¶é—´</td><td style="text-align:left">ä¸ Broker ä¿æŒä¸€è‡´</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>useDelayLevel</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦ä½¿ç”¨å»¶è¿Ÿç­‰çº§æ¨¡å¼</td><td style="text-align:left">è‹¥ Broker å¯ç”¨ç­‰çº§å»¶è¿Ÿåˆ™å¼€å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>messageDelayLevel</code></td><td style="text-align:left"><code>&quot;1s 5s 10s ... 2h&quot;</code></td><td style="text-align:left">å»¶è¿Ÿç­‰çº§é…ç½®è¡¨</td><td style="text-align:left">âœ…éœ€ä¸ broker.conf å¯¹é½</td></tr><tr><td style="text-align:left"><strong>çº¿ç¨‹æ± ï¼ˆgRPC æ¨¡å—ï¼‰</strong></td><td style="text-align:left"><code>grpcBossLoopNum</code></td><td style="text-align:left">1</td><td style="text-align:left">Netty boss çº¿ç¨‹</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>grpcWorkerLoopNum</code></td><td style="text-align:left">4</td><td style="text-align:left">gRPC worker çº¿ç¨‹</td><td style="text-align:left">âœ…CPU&gt;4 æ—¶å¯è°ƒé«˜è‡³æ ¸æ•°</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>grpcThreadPoolNums</code></td><td style="text-align:left">20</td><td style="text-align:left">gRPC ä¸šåŠ¡çº¿ç¨‹æ•°</td><td style="text-align:left">âœ…å»ºè®® â‰ˆ CPU æ ¸æ•°Ã—2</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>grpcThreadPoolQueueCapacity</code></td><td style="text-align:left">100000</td><td style="text-align:left">é˜Ÿåˆ—å®¹é‡</td><td style="text-align:left">âš ï¸å»ºè®® â‰¤20000ï¼Œé˜² OOM</td></tr><tr><td style="text-align:left"><strong>çº¿ç¨‹æ± ï¼ˆå†…éƒ¨æ¨¡å—ï¼‰</strong></td><td style="text-align:left"><code>producerProcessorThreadPoolNums</code></td><td style="text-align:left">2</td><td style="text-align:left">ç”Ÿäº§è€…å¤„ç†çº¿ç¨‹</td><td style="text-align:left">âœ…å¯æ ¹æ®QPSè°ƒæ•´</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>consumerProcessorThreadPoolNums</code></td><td style="text-align:left">2</td><td style="text-align:left">æ¶ˆè´¹è€…å¤„ç†çº¿ç¨‹</td><td style="text-align:left">åŒä¸Š</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>topicRouteServiceThreadPoolNums</code></td><td style="text-align:left">2</td><td style="text-align:left">è·¯ç”±æœåŠ¡çº¿ç¨‹</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>renewThreadPoolNums</code></td><td style="text-align:left">2</td><td style="text-align:left">è‡ªåŠ¨ç»­æœŸçº¿ç¨‹</td><td style="text-align:left">é«˜å¹¶å‘æ—¶å¯è°ƒå¤§</td></tr><tr><td style="text-align:left"><strong>ç¼“å­˜é…ç½®</strong></td><td style="text-align:left"><code>topicRouteServiceCacheExpiredSeconds</code></td><td style="text-align:left">300</td><td style="text-align:left">è·¯ç”±ç¼“å­˜æœ‰æ•ˆæœŸ</td><td style="text-align:left">âœ…å¯é€‚å½“è°ƒå¤§</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>topicConfigCacheExpiredSeconds</code></td><td style="text-align:left">300</td><td style="text-align:left">Topic é…ç½®ç¼“å­˜æœ‰æ•ˆæœŸ</td><td style="text-align:left">åŒä¸Š</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>subscriptionGroupConfigCacheExpiredSeconds</code></td><td style="text-align:left">300</td><td style="text-align:left">è®¢é˜…ç»„ç¼“å­˜æœ‰æ•ˆæœŸ</td><td style="text-align:left">åŒä¸Š</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>aclCacheExpiredSeconds</code></td><td style="text-align:left">300</td><td style="text-align:left">ACL ç¼“å­˜æœ‰æ•ˆæœŸ</td><td style="text-align:left">âœ…åŒä¸Š</td></tr><tr><td style="text-align:left"><strong>äº‹åŠ¡ä¸å¿ƒè·³</strong></td><td style="text-align:left"><code>transactionHeartbeatThreadPoolNums</code></td><td style="text-align:left">20</td><td style="text-align:left">äº‹åŠ¡å¿ƒè·³çº¿ç¨‹æ•°</td><td style="text-align:left">âœ…æ ¹æ®äº‹åŠ¡é‡è°ƒæ•´</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>transactionHeartbeatPeriodSecond</code></td><td style="text-align:left">20</td><td style="text-align:left">äº‹åŠ¡å¿ƒè·³å‘¨æœŸ</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>transactionDataExpireMillis</code></td><td style="text-align:left">30000</td><td style="text-align:left">äº‹åŠ¡æ•°æ®è¿‡æœŸæ—¶é—´</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>æŒ‡æ ‡ä¸ç›‘æ§</strong></td><td style="text-align:left"><code>metricsExporterType</code></td><td style="text-align:left">DISABLE</td><td style="text-align:left">æŒ‡æ ‡å¯¼å‡ºæ–¹å¼ï¼šDISABLE / PROM / GRPC / LOG</td><td style="text-align:left">âœ…å»ºè®®å¯ç”¨ PROM</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>metricsPromExporterPort</code></td><td style="text-align:left">5557</td><td style="text-align:left">Prometheus å¯¼å‡ºç«¯å£</td><td style="text-align:left">âœ…å»ºè®®æš´éœ²ç›‘æ§</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>metricsInDelta</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦æŒ‰å¢é‡å¯¼å‡ºæŒ‡æ ‡</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>Remoting æ¨¡å¼</strong></td><td style="text-align:left"><code>enableRemotingLocalProxyGrpc</code></td><td style="text-align:left">true</td><td style="text-align:left">å¯ç”¨æœ¬åœ° Proxy gRPC è½¬å‘</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>remotingListenPort</code></td><td style="text-align:left">8080</td><td style="text-align:left">Remoting é€šä¿¡ç«¯å£</td><td style="text-align:left">è‹¥å†²çªä¿®æ”¹</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>sendLatencyEnable</code></td><td style="text-align:left">false</td><td style="text-align:left">å¯ç”¨å‘é€å»¶è¿Ÿæ¢æµ‹ï¼ˆLoadBalance ä¼˜åŒ–ï¼‰</td><td style="text-align:left">âœ…å»ºè®®å¼€å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>startDetectorEnable</code></td><td style="text-align:left">false</td><td style="text-align:left">å¯ç”¨å¯åŠ¨æ¢æµ‹åŠŸèƒ½</td><td style="text-align:left">å¯é€‰ï¼Œæµ‹è¯•é˜¶æ®µä½¿ç”¨</td></tr><tr><td style="text-align:left"><strong>å¯è§‚æµ‹æ€§</strong></td><td style="text-align:left"><code>traceOn</code></td><td style="text-align:left">false</td><td style="text-align:left">å¯ç”¨é“¾è·¯è¿½è¸ª</td><td style="text-align:left">âœ…å»ºè®®å¼€å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>enablePrintJstack</code></td><td style="text-align:left">true</td><td style="text-align:left">æ‰“å°çº¿ç¨‹å †æ ˆï¼ˆç”¨äºè¯Šæ–­ï¼‰</td><td style="text-align:left">âœ…å¯å»¶é•¿å‘¨æœŸå‡å°‘æ—¥å¿—</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç»¼åˆä¼˜åŒ–å»ºè®®</p></li></ul><table><thead><tr><th style="text-align:left">æ–¹å‘</th><th style="text-align:left">å»ºè®®</th></tr></thead><tbody><tr><td style="text-align:left"><strong>æ€§èƒ½è°ƒä¼˜</strong></td><td style="text-align:left">å¯ç”¨ <code>enableGrpcEpoll=true</code>ï¼›åˆç†é…ç½®çº¿ç¨‹æ± ï¼ˆå¦‚å‡å°‘é˜Ÿåˆ—é•¿åº¦ï¼‰ï¼›è®¾ç½®åˆé€‚çš„ <code>grpcThreadPoolNums</code>ã€‚</td></tr><tr><td style="text-align:left"><strong>å¯é æ€§</strong></td><td style="text-align:left">å¼€å¯ <code>traceOn</code> ä¸ <code>sendLatencyEnable</code> ç›‘æ§ï¼›ä½¿ç”¨ Prometheus æŒ‡æ ‡å¯¼å‡ºã€‚</td></tr><tr><td style="text-align:left"><strong>å®‰å…¨æ€§</strong></td><td style="text-align:left">ç¦ç”¨ <code>tlsTestModeEnable</code>ï¼Œä½¿ç”¨çœŸå® TLS è¯ä¹¦ã€‚</td></tr><tr><td style="text-align:left"><strong>èµ„æºç®¡ç†</strong></td><td style="text-align:left">é™åˆ¶ç¼“å­˜æ•°é‡ï¼ˆå¦‚ topic/user/aclï¼‰å’Œçº¿ç¨‹é˜Ÿåˆ—å®¹é‡ï¼Œé˜²æ­¢å†…å­˜è†¨èƒ€ã€‚</td></tr><tr><td style="text-align:left"><strong>å¯ç»´æŠ¤æ€§</strong></td><td style="text-align:left">ä½¿ç”¨ç‹¬ç«‹çš„ <code>proxyClusterName</code>ï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶ <code>rmq-proxy.json</code> ä¸­æ˜ç¡®å„é¡¹ç«¯å£å’Œè·¯å¾„ã€‚</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» RocketMQ Proxy çš„é…ç½®é¡¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://rocketmq.apache.org/zh/&quot;&gt;RocketMQå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ Controller çš„é…ç½®é¡¹</title>
    <link href="https://blog.hanqunfeng.com/2025/10/28/rocketmq-05-controller-config/"/>
    <id>https://blog.hanqunfeng.com/2025/10/28/rocketmq-05-controller-config/</id>
    <published>2025-10-28T13:32:05.000Z</published>
    <updated>2025-10-28T03:25:35.545Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» RocketMQ Controller çš„é…ç½®é¡¹ã€‚</p></li><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/">RocketMQå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p></li></ul><span id="more"></span><h2 id="æŸ¥çœ‹-Controller-é…ç½®é¡¹">æŸ¥çœ‹ Controller é…ç½®é¡¹</h2><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹</span></span><br><span class="line">sh bin/mqcontroller -p</span><br><span class="line"><span class="comment"># æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„å…¨éƒ¨é…ç½®é¡¹</span></span><br><span class="line">sh bin/mqcontroller -p -c conf/broker.conf</span><br></pre></td></tr></table></figure><h2 id="é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹">é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨æºç  <code>rocketmq-all-5.3.2-source-release/controller</code> çš„å¯åŠ¨ç±» <code>org.apache.rocketmq.controller.ControllerStartup</code>ä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±»</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">ControllerConfig</span> <span class="variable">controllerConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ControllerConfig</span>();</span><br><span class="line"><span class="keyword">final</span> <span class="type">JraftConfig</span> <span class="variable">jraftConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JraftConfig</span>();</span><br><span class="line">controllerConfig.setJraftConfig(jraftConfig);</span><br><span class="line"><span class="keyword">final</span> <span class="type">NettyServerConfig</span> <span class="variable">nettyServerConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NettyServerConfig</span>();</span><br><span class="line"><span class="keyword">final</span> <span class="type">NettyClientConfig</span> <span class="variable">nettyClientConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NettyClientConfig</span>();</span><br><span class="line">nettyServerConfig.setListenPort(<span class="number">19876</span>);</span><br></pre></td></tr></table></figure><h2 id="é…ç½®é¡¹è¯´æ˜">é…ç½®é¡¹è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p>Controller é…ç½®å‚æ•°è¯´æ˜ä¸ä¼˜åŒ–å»ºè®®</p></li></ul><table><thead><tr><th style="text-align:left">åˆ†ç±»</th><th style="text-align:left">å‚æ•°å</th><th style="text-align:left">é»˜è®¤å€¼</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:left">ä¼˜åŒ– / å»ºè®®</th></tr></thead><tbody><tr><td style="text-align:left"><strong>åŸºç¡€ä¿¡æ¯</strong></td><td style="text-align:left"><code>rocketmqHome</code></td><td style="text-align:left">/usr/local/soft/rocketmq/rocketmq5</td><td style="text-align:left">RocketMQ æ ¹è·¯å¾„</td><td style="text-align:left">ä¿æŒé»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>configStorePath</code></td><td style="text-align:left">/root/controller/controller.properties</td><td style="text-align:left">Controller é…ç½®æ–‡ä»¶è·¯å¾„</td><td style="text-align:left">âœ… æ”¹ä¸º <code>/data/rocketmq/controller/controller.properties</code>ï¼Œé¿å…ä½¿ç”¨ <code>/root</code></td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>controllerType</code></td><td style="text-align:left">DLedger</td><td style="text-align:left">Controller ç±»å‹ï¼ˆDLedger / STANDALONEï¼‰</td><td style="text-align:left">âœ… å»ºè®®ä½¿ç”¨ DLedgerï¼ˆé«˜å¯ç”¨ï¼‰</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>controllerStorePath</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">Controller å…ƒæ•°æ®å­˜å‚¨è·¯å¾„</td><td style="text-align:left">âœ… å»ºè®® <code>/data/rocketmq/controller/store</code></td></tr><tr><td style="text-align:left"><strong>DLedger é€‰ä¸¾é…ç½®</strong></td><td style="text-align:left"><code>controllerDLegerGroup</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">Controller é›†ç¾¤ç»„å</td><td style="text-align:left">âœ… å¿…å¡«ï¼Œä¾‹å¦‚ï¼š<code>controllerGroup01</code></td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>controllerDLegerPeers</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ ¼å¼ï¼š<code>n0-10.0.0.1:19876;n1-10.0.0.2:19876;n2-10.0.0.3:19876</code></td><td style="text-align:left">âœ… å¿…å¡«ï¼ˆ3 èŠ‚ç‚¹æ¨èï¼‰</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>controllerDLegerSelfId</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">å½“å‰èŠ‚ç‚¹ IDï¼Œå¦‚ <code>n0</code></td><td style="text-align:left">âœ… å¿…å¡«</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>mappedFileSize</code></td><td style="text-align:left">1073741824</td><td style="text-align:left">DLedger å­˜å‚¨æ–‡ä»¶å¤§å° (1GB)</td><td style="text-align:left">å¯ä¿æŒé»˜è®¤</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>electMasterMaxRetryCount</code></td><td style="text-align:left">3</td><td style="text-align:left">Master é€‰ä¸¾æœ€å¤§é‡è¯•æ¬¡æ•°</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>enableElectUncleanMaster</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å…è®¸é€‰ä¸¾éåŒæ­¥ Master</td><td style="text-align:left">âœ… å»ºè®®ä¿æŒ falseï¼ˆé¿å…æ•°æ®ä¸¢å¤±ï¼‰</td></tr><tr><td style="text-align:left"><strong>Broker ç®¡ç†</strong></td><td style="text-align:left"><code>scanNotActiveBrokerInterval</code></td><td style="text-align:left">5000</td><td style="text-align:left">æ‰«æä¸æ´»è·ƒ Broker çš„é—´éš”(ms)</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>scanInactiveMasterInterval</code></td><td style="text-align:left">5000</td><td style="text-align:left">æ£€æµ‹å¤±æ´» Master é—´éš”(ms)</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>notifyBrokerRoleChanged</code></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦é€šçŸ¥ Broker è§’è‰²å˜æ›´</td><td style="text-align:left">âœ… å»ºè®®å¼€å¯ï¼ˆä¿æŒåŒæ­¥ï¼‰</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>isProcessReadEvent</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¤„ç†è¯»äº‹ä»¶</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>çº¿ç¨‹ä¸æ€§èƒ½</strong></td><td style="text-align:left"><code>controllerThreadPoolNums</code></td><td style="text-align:left">16</td><td style="text-align:left">æ§åˆ¶çº¿ç¨‹æ± å¤§å°</td><td style="text-align:left">å¯è°ƒè‡³ 8â€“32 è§†è§„æ¨¡è€Œå®š</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>controllerRequestThreadPoolQueueCapacity</code></td><td style="text-align:left">50000</td><td style="text-align:left">æ§åˆ¶çº¿ç¨‹æ± é˜Ÿåˆ—å®¹é‡</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>Metrics ç›‘æ§</strong></td><td style="text-align:left"><code>metricsExporterType</code></td><td style="text-align:left">DISABLE</td><td style="text-align:left">æŒ‡æ ‡è¾“å‡ºæ–¹å¼ï¼ˆDISABLE / PROM / GRPC / LOGï¼‰</td><td style="text-align:left">âœ… å»ºè®®è®¾ä¸º <code>PROM</code></td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>metricsPromExporterPort</code></td><td style="text-align:left">5557</td><td style="text-align:left">Prometheus ç«¯å£</td><td style="text-align:left">âœ… è‹¥å¯ç”¨ç›‘æ§ï¼Œå¯ç”¨é»˜è®¤ 5557</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>metricsPromExporterHost</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">Prometheus ç»‘å®šä¸»æœº</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>metricLoggingExporterIntervalInMills</code></td><td style="text-align:left">10000</td><td style="text-align:left">æ—¥å¿—è¾“å‡ºæŒ‡æ ‡é—´éš”</td><td style="text-align:left">å¯è°ƒæ•´</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>metricsGrpcExporterTarget</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">gRPC ç›‘æ§ç›®æ ‡</td><td style="text-align:left">å¯å¿½ç•¥</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>metricsInDelta</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦ä»¥å¢é‡è¾“å‡ºæŒ‡æ ‡</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>JRaft é…ç½®ï¼ˆåº•å±‚ä¸€è‡´æ€§åè®®ï¼‰</strong></td><td style="text-align:left"><code>jRaftGroupId</code></td><td style="text-align:left">jRaft-Controller</td><td style="text-align:left">Raft ç»„å</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>jRaftServerId</code></td><td style="text-align:left">localhost:9880</td><td style="text-align:left">å½“å‰èŠ‚ç‚¹ ID</td><td style="text-align:left">âœ… ä¿®æ”¹ä¸ºå®é™… IPï¼Œä¾‹å¦‚ <code>10.0.0.1:9880</code></td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>jRaftInitConf</code></td><td style="text-align:left">localhost:9880,localhost:9881,localhost:9882</td><td style="text-align:left">é›†ç¾¤é…ç½®</td><td style="text-align:left">âœ… ä¿®æ”¹ä¸ºå®é™…èŠ‚ç‚¹ IP</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>jRaftControllerRPCAddr</code></td><td style="text-align:left">localhost:9770,localhost:9771,localhost:9772</td><td style="text-align:left">Controller RPC åœ°å€</td><td style="text-align:left">âœ… ä¿®æ”¹ä¸ºå®é™…èŠ‚ç‚¹ IP</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>jRaftElectionTimeoutMs</code></td><td style="text-align:left">1000</td><td style="text-align:left">é€‰ä¸¾è¶…æ—¶ï¼ˆmsï¼‰</td><td style="text-align:left">é»˜è®¤å³å¯ï¼ˆè¿‡ä½å¯èƒ½é¢‘ç¹é€‰ä¸¾ï¼‰</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>jRaftScanWaitTimeoutMs</code></td><td style="text-align:left">1000</td><td style="text-align:left">æ‰«æç­‰å¾…è¶…æ—¶</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>jRaftSnapshotIntervalSecs</code></td><td style="text-align:left">3600</td><td style="text-align:left">å¿«ç…§é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰</td><td style="text-align:left">âœ… å¯è®¾ä¸º 600ï¼ˆ10åˆ†é’Ÿï¼‰åŠ å¿«æ—¥å¿—å‹ç¼©</td></tr><tr><td style="text-align:left"><strong>ç½‘ç»œé…ç½®</strong></td><td style="text-align:left"><code>bindAddress</code></td><td style="text-align:left">0.0.0.0</td><td style="text-align:left">ç»‘å®šç›‘å¬åœ°å€</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>listenPort</code></td><td style="text-align:left">19876</td><td style="text-align:left">Controller æœåŠ¡ç«¯å£</td><td style="text-align:left">âœ… ç¡®ä¿æœªå†²çª</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>serverWorkerThreads</code></td><td style="text-align:left">8</td><td style="text-align:left">Netty å·¥ä½œçº¿ç¨‹</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>serverSelectorThreads</code></td><td style="text-align:left">3</td><td style="text-align:left">Selector çº¿ç¨‹æ•°</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>serverSocketBacklog</code></td><td style="text-align:left">1024</td><td style="text-align:left">Socket backlog é˜Ÿåˆ—</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>useEpollNativeSelector</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦ä½¿ç”¨ Epoll</td><td style="text-align:left">âœ… Linux ç¯å¢ƒå»ºè®® true</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>enableShutdownGracefully</code></td><td style="text-align:left">false</td><td style="text-align:left">ä¼˜é›…åœæœº</td><td style="text-align:left">âœ… å»ºè®® true</td></tr><tr><td style="text-align:left"><strong>å®¢æˆ·ç«¯é€šä¿¡</strong></td><td style="text-align:left"><code>clientWorkerThreads</code></td><td style="text-align:left">4</td><td style="text-align:left">å®¢æˆ·ç«¯å·¥ä½œçº¿ç¨‹</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>clientAsyncSemaphoreValue</code></td><td style="text-align:left">65535</td><td style="text-align:left">å¼‚æ­¥è¯·æ±‚ä¿¡å·é‡</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>clientCloseSocketIfTimeout</code></td><td style="text-align:left">true</td><td style="text-align:left">è¿æ¥è¶…æ—¶å…³é—­</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>connectTimeoutMillis</code></td><td style="text-align:left">3000</td><td style="text-align:left">è¿æ¥è¶…æ—¶</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>useTLS</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¯ç”¨ TLS</td><td style="text-align:left">âœ… è‹¥ç”Ÿäº§ç¯å¢ƒæœ‰å®‰å…¨è¦æ±‚ï¼Œå»ºè®®å¯ç”¨</td></tr><tr><td style="text-align:left"><strong>å…¶ä»–</strong></td><td style="text-align:left"><code>configBlackList</code></td><td style="text-align:left">configBlackList;configStorePath</td><td style="text-align:left">é…ç½®é»‘åå•é¡¹</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>maxReconnectIntervalTimeSeconds</code></td><td style="text-align:left">60</td><td style="text-align:left">æœ€å¤§é‡è¿é—´éš”</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>enableReconnectForGoAway</code></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦ä¸º GOAWAY è¿æ¥å¯ç”¨é‡è¿</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ¨èé‡ç‚¹ä¼˜åŒ–çš„å…³é”®é¡¹</p></li></ul><table><thead><tr><th style="text-align:left">é¡¹ç›®</th><th style="text-align:left">æ¨èå€¼</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left"><code>controllerType</code></td><td style="text-align:left">DLedger</td><td style="text-align:left">é«˜å¯ç”¨æ¨¡å¼</td></tr><tr><td style="text-align:left"><code>controllerDLegerGroup</code></td><td style="text-align:left">controllerGroup01</td><td style="text-align:left">é›†ç¾¤åˆ†ç»„å</td></tr><tr><td style="text-align:left"><code>controllerDLegerPeers</code></td><td style="text-align:left"><code>n0-10.0.0.1:19876;n1-10.0.0.2:19876;n2-10.0.0.3:19876</code></td><td style="text-align:left">ä¸‰èŠ‚ç‚¹æ¨è</td></tr><tr><td style="text-align:left"><code>controllerDLegerSelfId</code></td><td style="text-align:left">n0 / n1 / n2</td><td style="text-align:left">å¯¹åº”èŠ‚ç‚¹ ID</td></tr><tr><td style="text-align:left"><code>enableElectUncleanMaster</code></td><td style="text-align:left">false</td><td style="text-align:left">é˜²æ­¢è„ä¸»é€‰ä¸¾</td></tr><tr><td style="text-align:left"><code>notifyBrokerRoleChanged</code></td><td style="text-align:left">true</td><td style="text-align:left">ä¿æŒé›†ç¾¤ä¸€è‡´æ€§</td></tr><tr><td style="text-align:left"><code>metricsExporterType</code></td><td style="text-align:left">PROM</td><td style="text-align:left">ä¾¿äº Prometheus ç›‘æ§</td></tr><tr><td style="text-align:left"><code>metricsPromExporterPort</code></td><td style="text-align:left">5557</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><code>useEpollNativeSelector</code></td><td style="text-align:left">true</td><td style="text-align:left">Linux æ€§èƒ½ä¼˜åŒ–</td></tr><tr><td style="text-align:left"><code>enableShutdownGracefully</code></td><td style="text-align:left">true</td><td style="text-align:left">ä¼˜é›…åœæœº</td></tr><tr><td style="text-align:left"><code>controllerStorePath</code></td><td style="text-align:left">/data/rocketmq/controller/store</td><td style="text-align:left">é¿å…ä½¿ç”¨ <code>/root</code></td></tr><tr><td style="text-align:left"><code>jRaftSnapshotIntervalSecs</code></td><td style="text-align:left">600</td><td style="text-align:left">æé«˜å¿«ç…§é¢‘ç‡</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» RocketMQ Controller çš„é…ç½®é¡¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://rocketmq.apache.org/zh/&quot;&gt;RocketMQå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ Broker çš„é…ç½®é¡¹</title>
    <link href="https://blog.hanqunfeng.com/2025/10/28/rocketmq-04-broker-config/"/>
    <id>https://blog.hanqunfeng.com/2025/10/28/rocketmq-04-broker-config/</id>
    <published>2025-10-28T13:31:05.000Z</published>
    <updated>2025-10-28T03:23:18.328Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» RocketMQ Broker çš„é…ç½®é¡¹ã€‚</p></li><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/">RocketMQå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p></li></ul><span id="more"></span><h2 id="æŸ¥çœ‹-Broker-é…ç½®é¡¹">æŸ¥çœ‹ Broker é…ç½®é¡¹</h2><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹</span></span><br><span class="line">sh bin/mqbroker -p</span><br><span class="line"><span class="comment"># æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„å…¨éƒ¨é…ç½®é¡¹</span></span><br><span class="line">sh bin/mqbroker -p -c conf/broker.conf</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹é‡è¦çš„é…ç½®é¡¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹é‡è¦çš„é»˜è®¤é…ç½®é¡¹</span></span><br><span class="line">sh bin/mqbroker -m</span><br><span class="line"><span class="comment"># æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„é‡è¦é…ç½®é¡¹</span></span><br><span class="line">sh bin/mqbroker -m -c conf/broker.conf</span><br></pre></td></tr></table></figure><h2 id="é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹">é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨æºç  <code>rocketmq-all-5.3.2-source-release/broker</code> çš„å¯åŠ¨ç±» <code>org.apache.rocketmq.broker.BrokerStartup</code>ä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±»</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">BrokerConfig</span> <span class="variable">brokerConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrokerConfig</span>();</span><br><span class="line"><span class="keyword">final</span> <span class="type">NettyServerConfig</span> <span class="variable">nettyServerConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NettyServerConfig</span>();</span><br><span class="line"><span class="keyword">final</span> <span class="type">NettyClientConfig</span> <span class="variable">nettyClientConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NettyClientConfig</span>();</span><br><span class="line"><span class="keyword">final</span> <span class="type">MessageStoreConfig</span> <span class="variable">messageStoreConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageStoreConfig</span>();</span><br><span class="line"><span class="keyword">final</span> <span class="type">AuthConfig</span> <span class="variable">authConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AuthConfig</span>();</span><br><span class="line">nettyServerConfig.setListenPort(<span class="number">10911</span>);</span><br><span class="line">messageStoreConfig.setHaListenPort(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h2 id="é…ç½®é¡¹è¯´æ˜">é…ç½®é¡¹è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p>Brokerçš„å…¨éƒ¨é…ç½®é¡¹éå¸¸å¤šï¼Œè¿™é‡Œä»…åˆ—å‡ºäº†é‡è¦çš„é…ç½®é¡¹ã€‚</p></li></ul><table><thead><tr><th style="text-align:left">åˆ†ç±»</th><th style="text-align:left">å‚æ•°å</th><th style="text-align:left">é»˜è®¤å€¼</th><th style="text-align:left">å‚æ•°è¯´æ˜</th><th style="text-align:left">ä¼˜åŒ– / å»ºè®®</th></tr></thead><tbody><tr><td style="text-align:left"><strong>åŸºç¡€é…ç½®</strong></td><td style="text-align:left"><code>namesrvAddr</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">NameServer åœ°å€åˆ—è¡¨ï¼ˆå¤šä¸ªç”¨ <code>;</code> åˆ†éš”ï¼‰</td><td style="text-align:left">âœ… <strong>å¿…é¡»è®¾ç½®</strong>ï¼Œå¦åˆ™ broker æ— æ³•æ³¨å†Œåˆ° nameserverã€‚ä¾‹ï¼š<code>namesrvAddr=10.250.0.10:9876;10.250.0.11:9876</code></td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>listenPort</code></td><td style="text-align:left">6888</td><td style="text-align:left">Broker ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£</td><td style="text-align:left">âœ… å»ºè®®ä¿æŒé»˜è®¤æˆ–æ˜¾å¼è®¾ç½®ä¸º 10911ï¼ˆç»å…¸ç«¯å£ï¼‰</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>brokerIP1</code></td><td style="text-align:left">10.250.0.188</td><td style="text-align:left">Broker å¯¹å¤–é€šä¿¡ IP</td><td style="text-align:left">âœ… åœ¨å¤šç½‘å¡ç¯å¢ƒåŠ¡å¿…æŒ‡å®šå…¬ç½‘/å†…ç½‘ IP</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>recoverConcurrently</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¹¶å‘æ¢å¤ CommitLog</td><td style="text-align:left">é»˜è®¤å³å¯ï¼ˆé«˜å®‰å…¨æ€§ï¼‰</td></tr><tr><td style="text-align:left"><strong>Topic &amp; è®¢é˜…</strong></td><td style="text-align:left"><code>autoCreateTopicEnable</code></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topic</td><td style="text-align:left">âœ… ç”Ÿäº§å»ºè®®è®¾ä¸º <strong>false</strong>ï¼Œé˜²æ­¢è¯¯åˆ›å»º</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>autoCreateSubscriptionGroup</code></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„</td><td style="text-align:left">âœ… åŒä¸Šï¼Œå»ºè®® <strong>false</strong></td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>msgTraceTopicName</code></td><td style="text-align:left">RMQ_SYS_TRACE_TOPIC</td><td style="text-align:left">æ¶ˆæ¯è½¨è¿¹ä¸»é¢˜å</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>traceTopicEnable</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¼€å¯æ¶ˆæ¯è½¨è¿¹åŠŸèƒ½</td><td style="text-align:left">âœ… å»ºè®®è®¾ä¸º <strong>true</strong> ä»¥ä¾¿é—®é¢˜æ’æŸ¥</td></tr><tr><td style="text-align:left"><strong>äº‹åŠ¡æ¶ˆæ¯</strong></td><td style="text-align:left"><code>rejectTransactionMessage</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦æ‹’ç»äº‹åŠ¡æ¶ˆæ¯</td><td style="text-align:left">è‹¥ä¸ä½¿ç”¨äº‹åŠ¡å¯è®¾ä¸º true å‡å°‘è´Ÿæ‹…</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>transactionTimeOut</code></td><td style="text-align:left">6000</td><td style="text-align:left">äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>transactionCheckMax</code></td><td style="text-align:left">15</td><td style="text-align:left">äº‹åŠ¡æœ€å¤§å›æŸ¥æ¬¡æ•°</td><td style="text-align:left">å¯è°ƒé«˜ï¼ˆ20ï¼‰æé«˜å¯é æ€§</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>transactionCheckInterval</code></td><td style="text-align:left">30000</td><td style="text-align:left">äº‹åŠ¡å›æŸ¥é—´éš”ï¼ˆmsï¼‰</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>è®¿é—®æ§åˆ¶</strong></td><td style="text-align:left"><code>aclEnable</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¯ç”¨ ACL æƒé™éªŒè¯</td><td style="text-align:left">âœ… ç”Ÿäº§ç¯å¢ƒ <strong>å¿…é¡» true</strong></td></tr><tr><td style="text-align:left"><strong>å­˜å‚¨è·¯å¾„</strong></td><td style="text-align:left"><code>storePathRootDir</code></td><td style="text-align:left">/root/store</td><td style="text-align:left">æ¶ˆæ¯å­˜å‚¨æ ¹ç›®å½•</td><td style="text-align:left">âœ… æ”¹ä¸º <code>/data/rocketmq/store</code></td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>storePathCommitLog</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">CommitLog å­˜å‚¨è·¯å¾„</td><td style="text-align:left">è‹¥ä¸ºç©ºåˆ™ä½¿ç”¨ä¸Šé¢çš„æ ¹ç›®å½•</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>storePathDLedgerCommitLog</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">DLedger æ¨¡å¼å­˜å‚¨è·¯å¾„</td><td style="text-align:left">DLedger æ¨¡å¼æ‰éœ€è¦</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>storePathEpochFile</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">epoch æ–‡ä»¶è·¯å¾„</td><td style="text-align:left">Controller æ¨¡å¼ä½¿ç”¨</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>storePathBrokerIdentity</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">Broker èº«ä»½æ–‡ä»¶è·¯å¾„</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>disappearTimeAfterStart</code></td><td style="text-align:left">-1</td><td style="text-align:left">Broker å¯åŠ¨åå¤±æ•ˆç­‰å¾…æ—¶é—´</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>storeType</code></td><td style="text-align:left">default</td><td style="text-align:left">å­˜å‚¨ç±»å‹ï¼ˆdefault / dledgerï¼‰</td><td style="text-align:left">âœ… å¤šå‰¯æœ¬éƒ¨ç½²å»ºè®® dledger</td></tr><tr><td style="text-align:left"><strong>åˆ·ç›˜ä¸å†™å…¥</strong></td><td style="text-align:left"><code>flushIntervalCommitLog</code></td><td style="text-align:left">500</td><td style="text-align:left">å¼‚æ­¥ flush å‘¨æœŸï¼ˆmsï¼‰</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>commitIntervalCommitLog</code></td><td style="text-align:left">200</td><td style="text-align:left">commit é—´éš”</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>flushCommitLogTimed</code></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦å®šæ—¶ flush</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>æ–‡ä»¶æ¸…ç†</strong></td><td style="text-align:left"><code>deleteWhen</code></td><td style="text-align:left">04</td><td style="text-align:left">åˆ é™¤è¿‡æœŸæ–‡ä»¶æ—¶é—´ç‚¹</td><td style="text-align:left">æ¯å¤©å‡Œæ™¨ 4 ç‚¹</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>fileReservedTime</code></td><td style="text-align:left">72</td><td style="text-align:left">æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰</td><td style="text-align:left">âœ… å¯æ”¹ä¸º 48 å‡å°‘ç£ç›˜å‹åŠ›</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>deleteFileBatchMax</code></td><td style="text-align:left">10</td><td style="text-align:left">åˆ é™¤æ–‡ä»¶æ‰¹é‡æ•°</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>æ¶ˆæ¯è®¿é—®æ€§èƒ½</strong></td><td style="text-align:left"><code>maxTransferBytesOnMessageInMemory</code></td><td style="text-align:left">262144</td><td style="text-align:left">å†…å­˜æ¶ˆæ¯è¯»å–æœ€å¤§å­—èŠ‚</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>maxTransferCountOnMessageInMemory</code></td><td style="text-align:left">32</td><td style="text-align:left">å†…å­˜æ¶ˆæ¯è¯»å–æœ€å¤§æ¡æ•°</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>maxTransferBytesOnMessageInDisk</code></td><td style="text-align:left">65536</td><td style="text-align:left">ç£ç›˜æ¶ˆæ¯è¯»å–æœ€å¤§å­—èŠ‚</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>maxTransferCountOnMessageInDisk</code></td><td style="text-align:left">8</td><td style="text-align:left">ç£ç›˜æ¶ˆæ¯è¯»å–æœ€å¤§æ¡æ•°</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>accessMessageInMemoryMaxRatio</code></td><td style="text-align:left">40</td><td style="text-align:left">å†…å­˜è®¿é—®æ¯”ä¾‹é˜ˆå€¼</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>ç´¢å¼•ç®¡ç†</strong></td><td style="text-align:left"><code>messageIndexEnable</code></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦å¯ç”¨æ¶ˆæ¯ç´¢å¼•</td><td style="text-align:left">âœ… å»ºè®®å¼€å¯ï¼ˆæé«˜æŒ‰ key æŸ¥è¯¢æ€§èƒ½ï¼‰</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>messageIndexSafe</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å®‰å…¨æ¨¡å¼ç´¢å¼•</td><td style="text-align:left">è‹¥ç£ç›˜å¯é æ€§å·®å¯è®¾ä¸º true</td></tr><tr><td style="text-align:left"><strong>ä¸»ä»å¤åˆ¶</strong></td><td style="text-align:left"><code>haMasterAddress</code></td><td style="text-align:left"><em>(ç©º)</em></td><td style="text-align:left">Master åœ°å€ï¼ˆSlave æ¨¡å¼ä½¿ç”¨ï¼‰</td><td style="text-align:left">ä»…ä»èŠ‚ç‚¹é…ç½®</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>brokerRole</code></td><td style="text-align:left">ASYNC_MASTER</td><td style="text-align:left">Broker è§’è‰²ï¼ˆASYNC_MASTER / SYNC_MASTER / SLAVEï¼‰</td><td style="text-align:left">âœ… ä¸»èŠ‚ç‚¹å»ºè®® SYNC_MASTER æé«˜å¯é æ€§</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>flushDiskType</code></td><td style="text-align:left">ASYNC_FLUSH</td><td style="text-align:left">åˆ·ç›˜ç­–ç•¥ï¼ˆSYNC_FLUSH / ASYNC_FLUSHï¼‰</td><td style="text-align:left">âœ… é«˜å¯é å»ºè®® SYNC_FLUSH</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>cleanFileForciblyEnable</code></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦å¼ºåˆ¶æ¸…ç†æ–‡ä»¶</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>transientStorePoolEnable</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¯ç”¨ transient poolï¼ˆå †å¤–å†…å­˜ï¼‰</td><td style="text-align:left">âœ… å¯è®¾ä¸º true æå‡æ€§èƒ½ï¼ˆéœ€è¶³å¤Ÿå†…å­˜ï¼‰</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>dispatchFromSenderThread</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦ç”±å‘é€çº¿ç¨‹åˆ†å‘</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>wakeCommitWhenPutMessage</code></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦åœ¨æ¶ˆæ¯å†™å…¥æ—¶å”¤é†’ commit</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>wakeFlushWhenPutMessage</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å†™å…¥åç«‹å³ flush</td><td style="text-align:left">âœ… å¯¹å»¶è¿Ÿæ•æ„Ÿä¸šåŠ¡å¯è®¾ä¸º true</td></tr><tr><td style="text-align:left"><strong>æ¶ˆè´¹è¿›åº¦æ¸…ç†</strong></td><td style="text-align:left"><code>enableCleanExpiredOffset</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¯ç”¨ offset æ¸…ç†</td><td style="text-align:left">é»˜è®¤ false</td></tr><tr><td style="text-align:left"><strong>å‰¯æœ¬å‚æ•°</strong></td><td style="text-align:left"><code>totalReplicas</code></td><td style="text-align:left">1</td><td style="text-align:left">å‰¯æœ¬æ€»æ•°</td><td style="text-align:left">âœ… å¤šèŠ‚ç‚¹å»ºè®®è®¾ä¸º 3</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>inSyncReplicas</code></td><td style="text-align:left">1</td><td style="text-align:left">åŒæ­¥å‰¯æœ¬æ•°</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>minInSyncReplicas</code></td><td style="text-align:left">1</td><td style="text-align:left">æœ€å°åŒæ­¥å‰¯æœ¬</td><td style="text-align:left">âœ… å»ºè®®è®¾ä¸º 2 æé«˜å¯é æ€§</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>allAckInSyncStateSet</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦è¦æ±‚æ‰€æœ‰ ISR ç¡®è®¤</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"></td><td style="text-align:left"><code>enableAutoInSyncReplicas</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦è‡ªåŠ¨ç®¡ç† ISR</td><td style="text-align:left">å¯ä¿æŒé»˜è®¤</td></tr><tr><td style="text-align:left"><strong>HA ä¸æµæ§</strong></td><td style="text-align:left"><code>haFlowControlEnable</code></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¼€å¯ä¸»ä»æµæ§</td><td style="text-align:left">âœ… å¤šå‰¯æœ¬å»ºè®® true</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ¨èé‡ç‚¹ä¼˜åŒ–çš„å…³é”®é¡¹</p></li></ul><table><thead><tr><th style="text-align:left">ç±»åˆ«</th><th style="text-align:left">å‚æ•°</th><th style="text-align:left">æ¨èå€¼</th><th style="text-align:left">åŸå› </th></tr></thead><tbody><tr><td style="text-align:left">æ³¨å†Œ</td><td style="text-align:left"><code>namesrvAddr</code></td><td style="text-align:left">å¿…å¡«</td><td style="text-align:left">Broker å¿…é¡»å‘ NameServer æ³¨å†Œ</td></tr><tr><td style="text-align:left">å®‰å…¨</td><td style="text-align:left"><code>aclEnable</code></td><td style="text-align:left">true</td><td style="text-align:left">å¯ç”¨è®¿é—®æ§åˆ¶</td></tr><tr><td style="text-align:left">è‡ªåŠ¨åˆ›å»º</td><td style="text-align:left"><code>autoCreateTopicEnable</code></td><td style="text-align:left">false</td><td style="text-align:left">é˜²æ­¢è¯¯åˆ›å»º topic</td></tr><tr><td style="text-align:left">è‡ªåŠ¨è®¢é˜…</td><td style="text-align:left"><code>autoCreateSubscriptionGroup</code></td><td style="text-align:left">false</td><td style="text-align:left">é˜²æ­¢è¯¯æ¶ˆè´¹</td></tr><tr><td style="text-align:left">åˆ·ç›˜ç­–ç•¥</td><td style="text-align:left"><code>flushDiskType</code></td><td style="text-align:left">SYNC_FLUSH</td><td style="text-align:left">ä¿è¯å¯é æ€§</td></tr><tr><td style="text-align:left">ä¸»ä»</td><td style="text-align:left"><code>brokerRole</code></td><td style="text-align:left">SYNC_MASTERï¼ˆä¸»ï¼‰ / SLAVEï¼ˆä»ï¼‰</td><td style="text-align:left">æå‡å¯ç”¨æ€§</td></tr><tr><td style="text-align:left">å­˜å‚¨è·¯å¾„</td><td style="text-align:left"><code>storePathRootDir</code></td><td style="text-align:left"><code>/data/rocketmq/store</code></td><td style="text-align:left">é¿å… <code>/root</code> æƒé™é—®é¢˜</td></tr><tr><td style="text-align:left">å»¶è¿Ÿä¼˜åŒ–</td><td style="text-align:left"><code>transientStorePoolEnable</code></td><td style="text-align:left">true</td><td style="text-align:left">å †å¤–å†…å­˜åŠ é€Ÿå†™å…¥</td></tr><tr><td style="text-align:left">æ¸…ç†</td><td style="text-align:left"><code>fileReservedTime</code></td><td style="text-align:left">48</td><td style="text-align:left">å‡å°‘ç£ç›˜å ç”¨</td></tr><tr><td style="text-align:left">æ¶ˆæ¯è½¨è¿¹</td><td style="text-align:left"><code>traceTopicEnable</code></td><td style="text-align:left">true</td><td style="text-align:left">ä¾¿äºè¿½è¸ªæ¶ˆæ¯é“¾è·¯</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» RocketMQ Broker çš„é…ç½®é¡¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://rocketmq.apache.org/zh/&quot;&gt;RocketMQå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ NameServer çš„é…ç½®é¡¹</title>
    <link href="https://blog.hanqunfeng.com/2025/10/28/rocketmq-03-namesvr-config/"/>
    <id>https://blog.hanqunfeng.com/2025/10/28/rocketmq-03-namesvr-config/</id>
    <published>2025-10-28T13:30:05.000Z</published>
    <updated>2025-10-28T03:19:35.144Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» RocketMQ NameServer çš„é…ç½®é¡¹ã€‚</p></li><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/">RocketMQå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p></li></ul><span id="more"></span><h2 id="æŸ¥çœ‹-NameServer-é…ç½®é¡¹">æŸ¥çœ‹ NameServer é…ç½®é¡¹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹é»˜è®¤é…ç½®é¡¹</span></span><br><span class="line">sh bin/mqnamesrv -p</span><br><span class="line"><span class="comment"># æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„é…ç½®é¡¹ï¼Œå³é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹ä¼šè¦†ç›–é»˜è®¤é…ç½®é¡¹</span></span><br><span class="line">sh bin/mqnamesrv -p -c conf/namesvr.conf</span><br></pre></td></tr></table></figure><h2 id="é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹">é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨æºç  <code>rocketmq-all-5.3.2-source-release/namesrv</code> çš„å¯åŠ¨ç±» <code>org.apache.rocketmq.namesrv.NamesrvStartup</code>ä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±»</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">NamesrvConfig</span> <span class="variable">namesrvConfig</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">NettyServerConfig</span> <span class="variable">nettyServerConfig</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">NettyClientConfig</span> <span class="variable">nettyClientConfig</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ControllerConfig</span> <span class="variable">controllerConfig</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®é¡¹è¯´æ˜">é…ç½®é¡¹è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p>NameServer é…ç½®é¡¹è¯´æ˜ä¸å»ºè®®</p></li></ul><table><thead><tr><th style="text-align:left">å‚æ•°å</th><th style="text-align:left">é»˜è®¤å€¼</th><th style="text-align:left">å‚æ•°è¯´æ˜</th><th style="text-align:left">ä¼˜åŒ– / å»ºè®®</th></tr></thead><tbody><tr><td style="text-align:left"><strong>rocketmqHome</strong></td><td style="text-align:left">/usr/local/soft/rocketmq/rocketmq5</td><td style="text-align:left">RocketMQ å®‰è£…ç›®å½•</td><td style="text-align:left">ä¸å»ºè®®ä¿®æ”¹</td></tr><tr><td style="text-align:left"><strong>kvConfigPath</strong></td><td style="text-align:left">/root/namesrv/kvConfig.json</td><td style="text-align:left">KV é…ç½®å­˜å‚¨è·¯å¾„</td><td style="text-align:left">âœ… æ”¹ä¸º <code>/data/rocketmq/namesrv/kvConfig.json</code> æ›´è§„èŒƒ</td></tr><tr><td style="text-align:left"><strong>configStorePath</strong></td><td style="text-align:left">/root/namesrv/namesrv.properties</td><td style="text-align:left">NameServer å¯åŠ¨é…ç½®æ–‡ä»¶è·¯å¾„</td><td style="text-align:left">âœ… æ”¾åœ¨é root è·¯å¾„ä¸‹ <code>/etc/rocketmq/namesrv.properties</code></td></tr><tr><td style="text-align:left"><strong>productEnvName</strong></td><td style="text-align:left">center</td><td style="text-align:left">äº§å“ç¯å¢ƒåç§°æ ‡è¯†</td><td style="text-align:left">å¯ç”¨äºåŒºåˆ†ç¯å¢ƒï¼ˆdev/test/prodï¼‰</td></tr><tr><td style="text-align:left"><strong>clusterTest</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¯ç”¨é›†ç¾¤æµ‹è¯•æ¨¡å¼</td><td style="text-align:left">é»˜è®¤ falseï¼Œç”Ÿäº§å‹¿å¯ç”¨</td></tr><tr><td style="text-align:left"><strong>orderMessageEnable</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¼€å¯é¡ºåºæ¶ˆæ¯åŠŸèƒ½</td><td style="text-align:left">NameServer ä¸€èˆ¬æ— éœ€å¼€å¯</td></tr><tr><td style="text-align:left"><strong>returnOrderTopicConfigToBroker</strong></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦è¿”å›é¡ºåºæ¶ˆæ¯ä¸»é¢˜é…ç½®ç»™ broker</td><td style="text-align:left">ä¿æŒé»˜è®¤</td></tr><tr><td style="text-align:left"><strong>clientRequestThreadPoolNums</strong></td><td style="text-align:left">8</td><td style="text-align:left">å®¢æˆ·ç«¯è¯·æ±‚çº¿ç¨‹æ•°</td><td style="text-align:left">âœ… è‹¥ NameServer è´Ÿè½½é«˜å¯å¢è‡³ 16~32</td></tr><tr><td style="text-align:left"><strong>defaultThreadPoolNums</strong></td><td style="text-align:left">16</td><td style="text-align:left">é»˜è®¤çº¿ç¨‹æ± çº¿ç¨‹æ•°</td><td style="text-align:left">è§† CPU æ ¸å¿ƒæ•°è°ƒæ•´</td></tr><tr><td style="text-align:left"><strong>clientRequestThreadPoolQueueCapacity</strong></td><td style="text-align:left">50000</td><td style="text-align:left">å®¢æˆ·ç«¯è¯·æ±‚é˜Ÿåˆ—é•¿åº¦</td><td style="text-align:left">âœ… é«˜å¹¶å‘ç¯å¢ƒå¯è°ƒé«˜è‡³ 100000</td></tr><tr><td style="text-align:left"><strong>defaultThreadPoolQueueCapacity</strong></td><td style="text-align:left">10000</td><td style="text-align:left">é»˜è®¤ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦</td><td style="text-align:left">é€‚åº¦æé«˜é˜²æ­¢æ‹’ç»ä»»åŠ¡</td></tr><tr><td style="text-align:left"><strong>scanNotActiveBrokerInterval</strong></td><td style="text-align:left">5000</td><td style="text-align:left">æ‰«æå¤±æ•ˆ Broker çš„é—´éš”ï¼ˆmsï¼‰</td><td style="text-align:left">é»˜è®¤ 5sï¼Œå¯ä¿æŒ</td></tr><tr><td style="text-align:left"><strong>unRegisterBrokerQueueCapacity</strong></td><td style="text-align:left">3000</td><td style="text-align:left">Broker æ³¨é”€é˜Ÿåˆ—å®¹é‡</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>supportActingMaster</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦æ”¯æŒ ActingMaster åŠŸèƒ½</td><td style="text-align:left">âœ… è‹¥å¯ç”¨ controller å»ºè®®è®¾ä¸º true</td></tr><tr><td style="text-align:left"><strong>enableAllTopicList</strong></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦å¯ç”¨æ‰€æœ‰ä¸»é¢˜åˆ—è¡¨æ¥å£</td><td style="text-align:left">å¯ä¿æŒ</td></tr><tr><td style="text-align:left"><strong>enableTopicList</strong></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦å…è®¸ä¸»é¢˜åˆ—è¡¨æŸ¥è¯¢</td><td style="text-align:left">å¯ä¿æŒ</td></tr><tr><td style="text-align:left"><strong>notifyMinBrokerIdChanged</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦é€šçŸ¥æœ€å° brokerId å˜åŒ–</td><td style="text-align:left">ä¸€èˆ¬æ— éœ€å¼€å¯</td></tr><tr><td style="text-align:left"><strong>enableControllerInNamesrv</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦åœ¨ NameServer ä¸­å¯ç”¨ Controller æ¨¡å—</td><td style="text-align:left">âœ… è‹¥éƒ¨ç½²ç®€åŒ–é›†ç¾¤å¯è€ƒè™‘ trueï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰</td></tr><tr><td style="text-align:left"><strong>needWaitForService</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦ç­‰å¾…æœåŠ¡å°±ç»ªå†å¯åŠ¨</td><td style="text-align:left">å¯ä¿æŒ</td></tr><tr><td style="text-align:left"><strong>waitSecondsForService</strong></td><td style="text-align:left">45</td><td style="text-align:left">å¯åŠ¨ç­‰å¾…æ—¶é—´</td><td style="text-align:left">å¯ä¿æŒ</td></tr><tr><td style="text-align:left"><strong>deleteTopicWithBrokerRegistration</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ³¨å†Œæ—¶æ˜¯å¦åˆ é™¤ topic</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>configBlackList</strong></td><td style="text-align:left">configBlackList;configStorePath;kvConfigPath</td><td style="text-align:left">é»‘åå•é…ç½®é¡¹</td><td style="text-align:left">ä¿æŒé»˜è®¤</td></tr><tr><td style="text-align:left"><strong>bindAddress</strong></td><td style="text-align:left">0.0.0.0</td><td style="text-align:left">ç»‘å®šçš„ç›‘å¬åœ°å€</td><td style="text-align:left">âœ… ç”Ÿäº§ç¯å¢ƒå»ºè®®ç»‘å®šå†…ç½‘ IP</td></tr><tr><td style="text-align:left"><strong>listenPort</strong></td><td style="text-align:left">9876</td><td style="text-align:left">NameServer ç›‘å¬ç«¯å£</td><td style="text-align:left">âœ… å¯é€šè¿‡é˜²ç«å¢™é™åˆ¶å¤–éƒ¨è®¿é—®</td></tr><tr><td style="text-align:left"><strong>serverWorkerThreads</strong></td><td style="text-align:left">8</td><td style="text-align:left">æœåŠ¡ç«¯ä¸šåŠ¡å¤„ç†çº¿ç¨‹æ•°</td><td style="text-align:left">å¯æ ¹æ®è´Ÿè½½è°ƒæ•´</td></tr><tr><td style="text-align:left"><strong>serverCallbackExecutorThreads</strong></td><td style="text-align:left">0</td><td style="text-align:left">å›è°ƒæ‰§è¡Œçº¿ç¨‹æ•°</td><td style="text-align:left">0 è¡¨ç¤ºè‡ªåŠ¨è®¾ç½®</td></tr><tr><td style="text-align:left"><strong>serverSelectorThreads</strong></td><td style="text-align:left">3</td><td style="text-align:left">Selector çº¿ç¨‹æ•°</td><td style="text-align:left">ä¸€èˆ¬ 2~4 å³å¯</td></tr><tr><td style="text-align:left"><strong>serverOnewaySemaphoreValue</strong></td><td style="text-align:left">256</td><td style="text-align:left">å•å‘è¯·æ±‚å¹¶å‘é™åˆ¶</td><td style="text-align:left">å¯ä¿æŒ</td></tr><tr><td style="text-align:left"><strong>serverAsyncSemaphoreValue</strong></td><td style="text-align:left">64</td><td style="text-align:left">å¼‚æ­¥è¯·æ±‚å¹¶å‘é™åˆ¶</td><td style="text-align:left">å¯ä¿æŒæˆ–ç•¥å¢</td></tr><tr><td style="text-align:left"><strong>serverChannelMaxIdleTimeSeconds</strong></td><td style="text-align:left">120</td><td style="text-align:left">è¿æ¥ç©ºé—²å…³é—­æ—¶é—´</td><td style="text-align:left">å¯è°ƒå¤§åˆ° 300 æé«˜å®¹é”™</td></tr><tr><td style="text-align:left"><strong>serverSocketSndBufSize</strong></td><td style="text-align:left">0</td><td style="text-align:left">TCP å‘é€ç¼“å†²åŒºå¤§å°</td><td style="text-align:left">0 è¡¨ç¤ºä½¿ç”¨ç³»ç»Ÿé»˜è®¤</td></tr><tr><td style="text-align:left"><strong>serverSocketRcvBufSize</strong></td><td style="text-align:left">0</td><td style="text-align:left">TCP æ¥æ”¶ç¼“å†²åŒºå¤§å°</td><td style="text-align:left">å»ºè®® 131072ï¼ˆ128KBï¼‰ä»¥ä¸Š</td></tr><tr><td style="text-align:left"><strong>writeBufferHighWaterMark</strong></td><td style="text-align:left">0</td><td style="text-align:left">å†™ç¼“å†²é«˜æ°´ä½æ ‡è®°</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>writeBufferLowWaterMark</strong></td><td style="text-align:left">0</td><td style="text-align:left">å†™ç¼“å†²ä½æ°´ä½æ ‡è®°</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>serverSocketBacklog</strong></td><td style="text-align:left">1024</td><td style="text-align:left">TCP è¿æ¥ç­‰å¾…é˜Ÿåˆ—</td><td style="text-align:left">âœ… é«˜å¹¶å‘åœºæ™¯å¯è°ƒå¤§è‡³ 2048</td></tr><tr><td style="text-align:left"><strong>serverNettyWorkerGroupEnable</strong></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦å¯ç”¨ Netty worker çº¿ç¨‹ç»„</td><td style="text-align:left">é»˜è®¤ true</td></tr><tr><td style="text-align:left"><strong>serverPooledByteBufAllocatorEnable</strong></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦å¯ç”¨ Netty æ± åŒ–å†…å­˜</td><td style="text-align:left">å»ºè®®ä¿æŒ</td></tr><tr><td style="text-align:left"><strong>enableShutdownGracefully</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦ä¼˜é›…å…³é—­</td><td style="text-align:left">âœ… å»ºè®®è®¾ä¸º true</td></tr><tr><td style="text-align:left"><strong>shutdownWaitTimeSeconds</strong></td><td style="text-align:left">30</td><td style="text-align:left">ä¼˜é›…å…³é—­ç­‰å¾…æ—¶é—´</td><td style="text-align:left">å»ºè®® 30~60</td></tr><tr><td style="text-align:left"><strong>useEpollNativeSelector</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¯ç”¨ Linux Epoll</td><td style="text-align:left">âœ… Linux ç¯å¢ƒå»ºè®®è®¾ä¸º true æé«˜æ€§èƒ½</td></tr><tr><td style="text-align:left"><strong>clientWorkerThreads</strong></td><td style="text-align:left">4</td><td style="text-align:left">å®¢æˆ·ç«¯ worker çº¿ç¨‹æ•°</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>clientCallbackExecutorThreads</strong></td><td style="text-align:left">2</td><td style="text-align:left">å®¢æˆ·ç«¯å›è°ƒçº¿ç¨‹æ•°</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>clientOnewaySemaphoreValue</strong></td><td style="text-align:left">65535</td><td style="text-align:left">å®¢æˆ·ç«¯å•å‘è¯·æ±‚å¹¶å‘é™åˆ¶</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>clientAsyncSemaphoreValue</strong></td><td style="text-align:left">65535</td><td style="text-align:left">å®¢æˆ·ç«¯å¼‚æ­¥è¯·æ±‚å¹¶å‘é™åˆ¶</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>connectTimeoutMillis</strong></td><td style="text-align:left">3000</td><td style="text-align:left">è¿æ¥è¶…æ—¶ï¼ˆmsï¼‰</td><td style="text-align:left">âœ… å¯æé«˜è‡³ 5000 å¢åŠ å®¹é”™</td></tr><tr><td style="text-align:left"><strong>channelNotActiveInterval</strong></td><td style="text-align:left">60000</td><td style="text-align:left">æ£€æŸ¥é€šé“éæ´»åŠ¨é—´éš”</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>isScanAvailableNameSrv</strong></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦æ‰«æå¯ç”¨ NameServer</td><td style="text-align:left">ä¿æŒ</td></tr><tr><td style="text-align:left"><strong>clientChannelMaxIdleTimeSeconds</strong></td><td style="text-align:left">120</td><td style="text-align:left">å®¢æˆ·ç«¯ç©ºé—²è¿æ¥è¶…æ—¶</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>clientSocketSndBufSize</strong></td><td style="text-align:left">0</td><td style="text-align:left">å®¢æˆ·ç«¯ TCP å‘é€ç¼“å†²åŒº</td><td style="text-align:left">å»ºè®® 131072</td></tr><tr><td style="text-align:left"><strong>clientSocketRcvBufSize</strong></td><td style="text-align:left">0</td><td style="text-align:left">å®¢æˆ·ç«¯ TCP æ¥æ”¶ç¼“å†²åŒº</td><td style="text-align:left">å»ºè®® 131072</td></tr><tr><td style="text-align:left"><strong>clientPooledByteBufAllocatorEnable</strong></td><td style="text-align:left">false</td><td style="text-align:left">å®¢æˆ·ç«¯æ˜¯å¦å¯ç”¨æ± åŒ–</td><td style="text-align:left">âœ… å»ºè®®è®¾ä¸º true æé«˜æ€§èƒ½</td></tr><tr><td style="text-align:left"><strong>clientCloseSocketIfTimeout</strong></td><td style="text-align:left">true</td><td style="text-align:left">è¶…æ—¶æ˜¯å¦å…³é—­ socket</td><td style="text-align:left">ä¿æŒé»˜è®¤</td></tr><tr><td style="text-align:left"><strong>useTLS</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦å¯ç”¨ TLS é€šä¿¡</td><td style="text-align:left">âœ… è‹¥å…¬ç½‘éƒ¨ç½²å¼ºçƒˆå»ºè®®å¼€å¯</td></tr><tr><td style="text-align:left"><strong>socksProxyConfig</strong></td><td style="text-align:left">{}</td><td style="text-align:left">SOCKS ä»£ç†é…ç½®</td><td style="text-align:left">å†…ç½‘éƒ¨ç½²æ— éœ€è®¾ç½®</td></tr><tr><td style="text-align:left"><strong>disableCallbackExecutor</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦ç¦ç”¨å›è°ƒæ‰§è¡Œå™¨</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>disableNettyWorkerGroup</strong></td><td style="text-align:left">false</td><td style="text-align:left">æ˜¯å¦ç¦ç”¨ Netty worker group</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>maxReconnectIntervalTimeSeconds</strong></td><td style="text-align:left">60</td><td style="text-align:left">æœ€å¤§é‡è¿é—´éš”</td><td style="text-align:left">é»˜è®¤å³å¯</td></tr><tr><td style="text-align:left"><strong>enableReconnectForGoAway</strong></td><td style="text-align:left">true</td><td style="text-align:left">æ˜¯å¦å¯ç”¨ goaway è‡ªåŠ¨é‡è¿</td><td style="text-align:left">ä¿æŒ true å¢å¼ºå¥å£®æ€§</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ¨èé‡ç‚¹ä¼˜åŒ–çš„å…³é”®é¡¹</p></li></ul><table><thead><tr><th style="text-align:left">ç±»åˆ«</th><th style="text-align:left">å‚æ•°</th><th style="text-align:left">æ¨èå€¼</th><th style="text-align:left">åŸå› </th></tr></thead><tbody><tr><td style="text-align:left">æ€§èƒ½</td><td style="text-align:left"><code>useEpollNativeSelector</code></td><td style="text-align:left">true</td><td style="text-align:left">Linux æ€§èƒ½æ˜¾è‘—æå‡</td></tr><tr><td style="text-align:left">å®‰å…¨</td><td style="text-align:left"><code>bindAddress</code></td><td style="text-align:left">å†…ç½‘ IP</td><td style="text-align:left">é˜²æ­¢æš´éœ²å…¬ç½‘</td></tr><tr><td style="text-align:left">å®‰å…¨</td><td style="text-align:left"><code>useTLS</code></td><td style="text-align:left">trueï¼ˆå…¬ç½‘ï¼‰</td><td style="text-align:left">å¯ç”¨åŠ å¯†ä¼ è¾“</td></tr><tr><td style="text-align:left">å¥å£®æ€§</td><td style="text-align:left"><code>enableShutdownGracefully</code></td><td style="text-align:left">true</td><td style="text-align:left">é˜²æ­¢å¼ºåˆ¶å…³é—­å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´</td></tr><tr><td style="text-align:left">è´Ÿè½½</td><td style="text-align:left"><code>clientRequestThreadPoolNums</code></td><td style="text-align:left">16~32</td><td style="text-align:left">æé«˜å¹¶å‘èƒ½åŠ›</td></tr><tr><td style="text-align:left">ç½‘ç»œ</td><td style="text-align:left"><code>serverSocketBacklog</code></td><td style="text-align:left">2048</td><td style="text-align:left">å‡å°‘è¿æ¥æ‹’ç»</td></tr><tr><td style="text-align:left">ç¼“å†²</td><td style="text-align:left"><code>serverSocketSndBufSize</code> / <code>RcvBufSize</code></td><td style="text-align:left">131072</td><td style="text-align:left">æé«˜ç½‘ç»œåå</td></tr><tr><td style="text-align:left">æ–‡ä»¶è·¯å¾„</td><td style="text-align:left"><code>kvConfigPath</code> / <code>configStorePath</code></td><td style="text-align:left">é root è·¯å¾„</td><td style="text-align:left">é¿å…æƒé™é—®é¢˜</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» RocketMQ NameServer çš„é…ç½®é¡¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://rocketmq.apache.org/zh/&quot;&gt;RocketMQå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ Dashboard çš„å®‰è£…åŠä½¿ç”¨</title>
    <link href="https://blog.hanqunfeng.com/2025/10/24/rocketmq-02-dashboard/"/>
    <id>https://blog.hanqunfeng.com/2025/10/24/rocketmq-02-dashboard/</id>
    <published>2025-10-24T13:30:05.000Z</published>
    <updated>2025-10-31T16:17:18.960Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RocketMQ Dashboard çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/">RocketMQå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p></li></ul><span id="more"></span><h2 id="RocketMQ-Dashboard-ç®€ä»‹">RocketMQ Dashboard ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/docs/deploymentOperations/04Dashboard">å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p>RocketMQ Dashboard æ˜¯ RocketMQ çš„ç®¡æ§åˆ©å™¨ï¼Œä¸ºç”¨æˆ·æä¾›å®¢æˆ·ç«¯å’Œåº”ç”¨ç¨‹åºçš„å„ç§äº‹ä»¶ã€æ€§èƒ½çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ”¯æŒä»¥å¯è§†åŒ–å·¥å…·ä»£æ›¿ Topic é…ç½®ã€Broker ç®¡ç†ç­‰å‘½ä»¤è¡Œæ“ä½œã€‚</p></li><li class="lvl-2"><p>åŠŸèƒ½æ¦‚è§ˆ</p></li></ul><table><thead><tr><th>é¢æ¿</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><strong>è¿ç»´</strong></td><td>ä¿®æ”¹ <strong>NameServer åœ°å€</strong>ï¼›é€‰æ‹© <strong>VIPChannel</strong> ç­‰è¿ç»´é…ç½®ã€‚</td></tr><tr><td><strong>é©¾é©¶èˆ±</strong></td><td>æŸ¥çœ‹ <strong>Brokerã€Topic æ¶ˆæ¯é‡</strong> ç­‰è¿è¡Œæ€»è§ˆä¿¡æ¯ã€‚</td></tr><tr><td><strong>é›†ç¾¤</strong></td><td>æŸ¥çœ‹ <strong>é›†ç¾¤åˆ†å¸ƒ</strong>ã€Broker é…ç½®ã€è¿è¡ŒçŠ¶æ€åŠè¯¦ç»†ä¿¡æ¯ã€‚</td></tr><tr><td><strong>ä¸»é¢˜ï¼ˆTopicï¼‰</strong></td><td>æœç´¢ã€ç­›é€‰ã€åˆ é™¤ã€æ›´æ–°/æ–°å¢ä¸»é¢˜ï¼›æŸ¥çœ‹ <strong>æ¶ˆæ¯è·¯ç”±</strong>ï¼›æ‰§è¡Œ <strong>å‘é€æ¶ˆæ¯</strong>ã€<strong>é‡ç½®æ¶ˆè´¹ä½ç‚¹</strong> ç­‰æ“ä½œã€‚</td></tr><tr><td><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong></td><td>æœç´¢ã€åˆ é™¤ã€æ–°å¢/æ›´æ–°æ¶ˆè´¹è€…ç»„ï¼›æŸ¥çœ‹ <strong>ç»ˆç«¯ä¿¡æ¯ã€æ¶ˆè´¹è¯¦æƒ…ã€é…ç½®é¡¹</strong>ã€‚</td></tr><tr><td><strong>æ¶ˆæ¯ï¼ˆMessageï¼‰</strong></td><td>æŸ¥çœ‹ <strong>æ¶ˆæ¯è®°å½•ã€æ­»ä¿¡æ¶ˆæ¯ã€æ¶ˆæ¯è½¨è¿¹</strong> ç­‰æ¶ˆæ¯çº§è¯¦æƒ…ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç³»ç»Ÿè¦æ±‚ ä¸ ç½‘ç»œé…ç½®</p></li></ul><table><thead><tr><th>ç±»åˆ«</th><th>é¡¹ç›®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ç³»ç»Ÿè¦æ±‚</strong></td><td>æ“ä½œç³»ç»Ÿ</td><td>Linux / Unix / macOS</td></tr><tr><td></td><td>JDK</td><td>64 ä½ JDK, 1.x ç‰ˆæœ¬éœ€è¦<strong>1.8+</strong>ï¼Œ2.xç‰ˆæœ¬éœ€è¦ <strong>17+</strong></td></tr><tr><td></td><td>æ„å»ºå·¥å…·</td><td><strong>Maven 3.2.x</strong> æˆ–æ›´é«˜ç‰ˆæœ¬</td></tr><tr><td></td><td>å¯åŠ¨é¡¹</td><td>å¯åŠ¨ <strong>RocketMQ</strong>ï¼ˆåŒ…æ‹¬ NameServer ä¸ Brokerï¼‰</td></tr><tr><td><strong>ç½‘ç»œé…ç½®</strong></td><td>ç½‘ç»œè®¿é—®</td><td>äº‘æœåŠ¡å™¨éœ€å¯è¿œç¨‹è®¿é—®ï¼Œæˆ–æœ¬åœ°è™šæ‹Ÿæœºéœ€å¯ <strong>PING é€šå¤–ç½‘</strong></td></tr></tbody></table><h2 id="RocketMQ-Dashboard-çš„å®‰è£…">RocketMQ Dashboard çš„å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>éƒ¨ç½² RocketMQ Dashboard 2.xï¼Œéœ€è¦å®‰è£… JDK17</p></li><li class="lvl-2"><p>æºç å®‰è£…ï¼Œ<a href="https://github.com/apache/rocketmq-dashboard">æºç ä¸‹è½½</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½æºç </span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/soft/rocketmq</span><br><span class="line">wget https://github.com/apache/rocketmq-dashboard/archive/refs/tags/rocketmq-dashboard-2.1.0.tar.gz</span><br><span class="line">tar -zxvf rocketmq-dashboard-2.1.0.tar.gz</span><br><span class="line"><span class="built_in">ln</span> -s rocketmq-dashboard-rocketmq-dashboard-2.1.0 rocketmq-dashboard</span><br><span class="line"><span class="built_in">cd</span> rocketmq-dashboard</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>bug ä¿®å¤ï¼Œå½“å‰<code>2.1.0</code>ç‰ˆæœ¬å­˜åœ¨bugï¼Œåªèƒ½é€šè¿‡<code>http://localhost:8082</code>è®¿é—®ï¼Œå¦‚æœéœ€è¦ipæˆ–åŸŸåè®¿é—®ï¼Œåˆ™éœ€è¦ä¿®æ”¹æºç </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> frontend-new/src/api/remoteApi</span><br><span class="line">sed -i <span class="string">&#x27;s|apiBaseUrl: &#x27;</span>\&#x27;<span class="string">&#x27;http://localhost:8082&#x27;</span>\&#x27;<span class="string">&#x27;|apiBaseUrl: process.env.REACT_APP_API_BASE_URL \|\| window.location.origin|&#x27;</span> remoteApi.js.bck</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›¿æ¢å‰ï¼š</span></span><br><span class="line">const appConfig = &#123;</span><br><span class="line">    apiBaseUrl: <span class="string">&#x27;http://localhost:8082&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment"># æ›¿æ¢åï¼š</span></span><br><span class="line">const appConfig = &#123;</span><br><span class="line">    apiBaseUrl: process.env.REACT_APP_API_BASE_URL || window.location.origin</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><table><thead><tr><th>ç¯å¢ƒ</th><th>ç¯å¢ƒå˜é‡å€¼</th><th>ç»“æœ (<code>appConfig.apiBaseUrl</code>)</th></tr></thead><tbody><tr><td>å¼€å‘ç¯å¢ƒ</td><td><code>REACT_APP_API_BASE_URL=http://localhost:8080</code></td><td><code>http://localhost:8080</code></td></tr><tr><td>æµ‹è¯•ç¯å¢ƒ</td><td><code>REACT_APP_API_BASE_URL=https://api.test.example.com</code></td><td><code>https://api.test.example.com</code></td></tr><tr><td>æœªè®¾ç½®å˜é‡</td><td><em>(æ— è¯¥ç¯å¢ƒå˜é‡)</em> åˆ™ä½¿ç”¨é»˜è®¤çš„ <code>window.location.origin</code>ï¼Œå…¶è¡¨ç¤º å½“å‰ç½‘é¡µçš„ åè®® + åŸŸå + ç«¯å£å·</td><td>è‡ªåŠ¨ä½¿ç”¨å½“å‰ç½‘ç«™åœ°å€ï¼Œå¦‚ <code>https://myapp.example.com</code></td></tr></tbody></table><blockquote><p>ç›®å‰<code>2.1.0</code>ç‰ˆæœ¬çš„bugè¿˜æ¯”è¾ƒå¤šï¼ŒGitHubä»“åº“ä¸­çš„ä»£ç å·²ç»ä¿®å¤äº†åŒ…æ‹¬è¯¥bugåœ¨å†…çš„éƒ¨åˆ†bugï¼Œä¸è¿‡è¿˜æ²¡æœ‰å‘å¸ƒåˆ° releaseã€‚<br>ç€æ€¥çš„å°ä¼™ä¼´å¯ä»¥é€šè¿‡ <code>git clone</code> é¡¹ç›®ï¼Œç¼–è¯‘å¹¶è¿è¡Œï¼Œæˆ–è€…ç­‰å¾…ä½œè€…å‘å¸ƒæ–°ç‰ˆæœ¬ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/apache/rocketmq-dashboard.git</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¼–è¯‘</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/soft/rocketmq/rocketmq-dashboard</span><br><span class="line"><span class="comment"># ç¼–è¯‘</span></span><br><span class="line">JAVA_HOME=/usr/local/jdk/jdk17 mvn clean package -Dmaven.test.skip=<span class="literal">true</span></span><br><span class="line"><span class="comment"># å°†jaråŒ…å¤åˆ¶åˆ°runç›®å½•ä¸‹ï¼Œä»¥é¿å…é‡æ–°ç¼–è¯‘æ—¶è¢«è¦†ç›–</span></span><br><span class="line"><span class="built_in">mkdir</span> run</span><br><span class="line"><span class="built_in">cp</span> target/rocketmq-dashboard-2.1.0.jar run/</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŒ‰éœ€æ›¿æ¢é…ç½®ï¼Œ</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim run/application.yaml # æŒ‰éœ€æ›¿æ¢é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rocketmq:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">namesrvAddrs:</span>                <span class="comment"># å¡«å†™NameServeråœ°å€åˆ—è¡¨</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10.250</span><span class="number">.0</span><span class="number">.175</span><span class="string">:9876</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10.250</span><span class="number">.0</span><span class="number">.188</span><span class="string">:9876</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10.250</span><span class="number">.0</span><span class="number">.131</span><span class="string">:9876</span></span><br><span class="line">    <span class="attr">dataPath:</span> <span class="string">/usr/local/soft/rocketmq/data/dashboard</span> <span class="comment"># Dashboardæ–‡ä»¶ç›®å½•ï¼Œç™»å½•ç”¨æˆ·é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•</span></span><br><span class="line">    <span class="attr">loginRequired:</span> <span class="literal">true</span>  <span class="comment"># æ˜¯å¦éœ€è¦ç™»å½•ï¼Œæ­¤æ—¶éœ€è¦åœ¨ dataPath ä¸‹åˆ›å»º users.properties æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/users.propertiesæ–‡ä»¶</span></span><br><span class="line">    <span class="comment"># å¦‚æœ broker å¼€å¯äº† ACLï¼Œåˆ™éœ€è¦é…ç½® accessKey å’Œ secretKey</span></span><br><span class="line"><span class="comment">#    accessKey: mqadmin</span></span><br><span class="line"><span class="comment">#    secretKey: 1234567</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>users.properties</code> æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯¥æ–‡ä»¶æ”¯æŒçƒ­ä¿®æ”¹ï¼Œå³æ·»åŠ å’Œä¿®æ”¹ç”¨æˆ·æ—¶ï¼Œä¸éœ€è¦é‡æ–°å¯åŠ¨console</span></span><br><span class="line"><span class="comment"># æ ¼å¼ï¼Œ æ¯è¡Œå®šä¹‰ä¸€ä¸ªç”¨æˆ·ï¼Œ username=password[,N]  #Næ˜¯å¯é€‰é¡¹ï¼Œå¯ä»¥ä¸º0 (æ™®é€šç”¨æˆ·)ï¼› 1 ï¼ˆç®¡ç†å‘˜ï¼‰</span></span><br><span class="line"><span class="comment"># å®šä¹‰ç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜æ‹¥æœ‰å…¨éƒ¨æƒé™</span></span><br><span class="line">super=passwd,1</span><br><span class="line"><span class="comment"># å®šä¹‰æ™®é€šç”¨æˆ·ï¼Œæ™®é€šç”¨æˆ·çš„æƒé™éœ€è¦åœ¨ dataPath ä¸‹çš„ role-permission.yml æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/role-permission.ymlæ–‡ä»¶</span></span><br><span class="line">user1=passwd</span><br><span class="line">user2=passwd</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>role-permission.yml</code> æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯¥æ–‡ä»¶æ”¯æŒçƒ­ä¿®æ”¹ï¼Œå³æ·»åŠ å’Œä¿®æ”¹ç”¨æˆ·æ—¶ï¼Œä¸éœ€è¦é‡æ–°å¯åŠ¨console</span></span><br><span class="line"><span class="comment"># æ ¼å¼ï¼Œå¦‚æœå¢åŠ å’Œåˆ é™¤æ¥å£æƒé™ï¼Œç›´æ¥åœ¨åˆ—è¡¨ä¸­å¢åŠ å’Œåˆ é™¤æ¥å£åœ°å€å³å¯ã€‚</span></span><br><span class="line"><span class="comment"># æ¥å£è·¯å¾„é…ç½®æ”¯æŒé€šé…ç¬¦</span></span><br><span class="line"><span class="comment"># * è¡¨ç¤ºåŒ¹é…0æˆ–å¤šä¸ªä¸æ˜¯/çš„å­—ç¬¦</span></span><br><span class="line"><span class="comment"># ** è¡¨ç¤ºåŒ¹é…0æˆ–å¤šä¸ªä»»æ„å­—ç¬¦</span></span><br><span class="line"><span class="comment"># ? è¡¨ç¤ºåŒ¹é…1ä¸ªä»»æ„å­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rolePerms:</span></span><br><span class="line">  <span class="comment"># æ™®é€šç”¨æˆ·ï¼Œä»¥ä¸‹æƒé™ä¸ºé»˜è®¤æƒé™ï¼ŒåŸºæœ¬ä¸Šå°±åªæ˜¯æŸ¥è¯¢çš„æƒé™</span></span><br><span class="line">  <span class="attr">Normal:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/rocketmq/nsaddr</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/ops/*</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/dashboard/**</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/topic/*.query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/topic/sendTopicMessage.do</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/producer/*.query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/message/*</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/messageTrace/*</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/monitor/*</span></span><br><span class="line">    <span class="string">....</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> run</span><br><span class="line"><span class="comment"># å¯åŠ¨ï¼Œé»˜è®¤ä¼šåŠ è½½ä¸jaråŒ…åŒçº§ç›®å½•ä¸‹çš„application.yamlæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">nohup</span> /usr/local/jdk/jdk17/bin/java -jar rocketmq-dashboard-2.1.0.jar 1&gt;dashboard.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line"><span class="built_in">tail</span> -f dashboard.log</span><br></pre></td></tr></table></figure><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/9F26eh.png" alt="" width="1400" height="800"></p><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/apache/rocketmq-dashboard/blob/master/docs/1_0_0/UserGuide_CN.md">Dashboard ä½¿ç”¨æ‰‹å†Œ</a></p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RocketMQ Dashboard çš„å®‰è£…ä¸ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://rocketmq.apache.org/zh/&quot;&gt;RocketMQå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ çš„å®‰è£…åŠä½¿ç”¨</title>
    <link href="https://blog.hanqunfeng.com/2025/10/23/rocketmq-01-install/"/>
    <id>https://blog.hanqunfeng.com/2025/10/23/rocketmq-01-install/</id>
    <published>2025-10-23T13:30:05.000Z</published>
    <updated>2025-10-31T15:12:50.634Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RocketMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/">RocketMQå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p></li></ul><span id="more"></span><h2 id="Apache-RocketMQ-ç®€ä»‹">Apache RocketMQ ç®€ä»‹</h2><h3 id="ä¸€ã€RocketMQ-æ˜¯ä»€ä¹ˆï¼Ÿ">ä¸€ã€RocketMQ æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>RocketMQ æ˜¯ä¸€ä¸ª<strong>åˆ†å¸ƒå¼ã€é˜Ÿåˆ—æ¨¡å‹çš„æ¶ˆæ¯ä¸­é—´ä»¶</strong>ã€‚å®ƒç”±é˜¿é‡Œå·´å·´åœ¨2012å¹´å¼€æºï¼Œå¹¶äº2017å¹´æ­£å¼æˆä¸º Apache åŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ã€‚</p><p>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è´Ÿè´£å¯é ä¼ é€’æ¶ˆæ¯çš„â€œé‚®å±€â€æˆ–â€œå¿«é€’ç³»ç»Ÿâ€ã€‚å½“ç³»ç»ŸAéœ€è¦å‘é€æ•°æ®ç»™ç³»ç»ŸBï¼Œä½†å®ƒä»¬ä¹‹é—´ä¸ç›´æ¥é€šä¿¡æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ RocketMQ æ¥ä¸­è½¬ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ã€ä¸é‡å¤ï¼Œå¹¶ä¸”èƒ½æŒ‰é¡ºåºé€è¾¾ã€‚</p><p><strong>RocketMQ æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯é ã€é«˜å®æ—¶çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶</strong>ã€‚å®ƒå°±åƒåˆ†å¸ƒå¼ç³»ç»Ÿçš„â€œä¸­æ¢ç¥ç»ç³»ç»Ÿâ€ï¼Œè´Ÿè´£åœ¨å„ä¸ªæœåŠ¡ä¹‹é—´å¯é ã€é«˜æ•ˆåœ°ä¼ é€’æ•°æ®ï¼Œæ˜¯ç°ä»£äº’è”ç½‘æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„åŸºç¡€ç»„ä»¶ä¹‹ä¸€ã€‚</p><p><strong>RocketMQ 5.x é€šè¿‡å¼•å…¥ Proxy æ¨¡å¼ï¼Œæå¤§åœ°æå‡äº†æ¶æ„çš„çµæ´»æ€§ã€å¤šè¯­è¨€æ”¯æŒèƒ½åŠ›å’Œäº‘åŸç”Ÿäº²å’ŒåŠ›</strong>ï¼Œæ˜¯å…¶åœ¨æ¶ˆæ¯ä¸­é—´ä»¶é¢†åŸŸæŒç»­æ¼”è¿›çš„é‡è¦é‡Œç¨‹ç¢‘ã€‚</p><p>å®ƒä¸ Kafkaã€RabbitMQ ç­‰éƒ½æ˜¯ä¸šç•Œé¡¶çº§çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½†å„æœ‰ä¾§é‡ã€‚RocketMQ åœ¨äº‹åŠ¡æ¶ˆæ¯ã€é¡ºåºæ¶ˆæ¯å’Œå¯¹åœ¨çº¿ä¸šåŠ¡çš„ç¨³å®šæ€§æ”¯æŒæ–¹é¢è¡¨ç°å°¤ä¸ºå‡ºè‰²ã€‚</p><hr><h3 id="äºŒã€æ ¸å¿ƒç‰¹ç‚¹ä¸ä¼˜åŠ¿">äºŒã€æ ¸å¿ƒç‰¹ç‚¹ä¸ä¼˜åŠ¿</h3><table><thead><tr><th style="text-align:center">åºå·</th><th style="text-align:left">ç‰¹æ€§</th><th style="text-align:left">å…¸å‹åœºæ™¯</th><th style="text-align:left">ä¸»è¦ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:left"><strong>å‰Šå³°å¡«è°·</strong></td><td style="text-align:left">ç”µå•†ç§’æ€ã€å¤§ä¿ƒæ´»åŠ¨æ—¶å¤§é‡ä¸‹å•è¯·æ±‚ç¬é—´æ¶Œå…¥</td><td style="text-align:left">å°†çªå‘è¯·æ±‚å…ˆç¼“å­˜ä¸ºæ¶ˆæ¯ï¼Œåç«¯ç³»ç»ŸæŒ‰è‡ªèº«èƒ½åŠ›å¹³ç¨³æ¶ˆè´¹ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½å´©æºƒ</td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:left"><strong>å¼‚æ­¥è§£è€¦</strong></td><td style="text-align:left">ç”¨æˆ·æ³¨å†Œåè§¦å‘å¤šç³»ç»Ÿä»»åŠ¡ï¼ˆé‚®ä»¶ã€ä¼˜æƒ åˆ¸ã€ç§¯åˆ†ï¼‰</td><td style="text-align:left">ä¸»æµç¨‹åªè´Ÿè´£å‘é€æ¶ˆæ¯ï¼Œå…¶ä»–ç³»ç»Ÿç‹¬ç«‹å¼‚æ­¥å¤„ç†ï¼Œé™ä½ç³»ç»Ÿé—´è€¦åˆã€æé«˜æ‰©å±•æ€§</td></tr><tr><td style="text-align:center"><strong>3</strong></td><td style="text-align:left"><strong>é¡ºåºæ¶ˆæ¯</strong></td><td style="text-align:left">è®¢å•çŠ¶æ€å˜æ›´ï¼ˆåˆ›å»º â†’ ä»˜æ¬¾ â†’ å‘è´§ â†’ æ”¶è´§ï¼‰</td><td style="text-align:left">åŒä¸€ä¸šåŠ¡é”®ï¼ˆå¦‚è®¢å•IDï¼‰çš„æ¶ˆæ¯æŒ‰é¡ºåºå‘é€å’Œæ¶ˆè´¹ï¼Œä¿è¯ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§</td></tr><tr><td style="text-align:center"><strong>4</strong></td><td style="text-align:left"><strong>æŒä¹…åŒ–ä¸é«˜å¯é æ€§</strong></td><td style="text-align:left">å…³é”®ä¸šåŠ¡æ¶ˆæ¯å¿…é¡»ä¸ä¸¢å¤±ï¼ˆäº¤æ˜“ã€æ”¯ä»˜ã€æ—¥å¿—ï¼‰</td><td style="text-align:left">æ‰€æœ‰æ¶ˆæ¯å†™å…¥ç£ç›˜å¹¶æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œå³ä½¿æœåŠ¡å™¨é‡å¯ä¹Ÿèƒ½æ¢å¤ï¼Œä¿è¯é«˜å¯ç”¨</td></tr><tr><td style="text-align:center"><strong>5</strong></td><td style="text-align:left"><strong>æ¶ˆæ¯å›æº¯</strong></td><td style="text-align:left">æ¶ˆè´¹é€»è¾‘å‡ºé”™ã€æ•°æ®é‡ç®—ã€è¡¥å¿ä»»åŠ¡</td><td style="text-align:left">æ”¯æŒé‡ç½®æ¶ˆè´¹ä½ç‚¹ï¼Œé‡æ–°æ¶ˆè´¹å†å²æ¶ˆæ¯ï¼Œå®ç°ä¸šåŠ¡è¡¥å¿ä¸è¿½æº¯</td></tr><tr><td style="text-align:center"><strong>6</strong></td><td style="text-align:left"><strong>æµ·é‡æ¶ˆæ¯å †ç§¯èƒ½åŠ›</strong></td><td style="text-align:left">å¤§è§„æ¨¡å¼‚æ­¥æ—¥å¿—æ”¶é›†ã€IoT æ•°æ®æ±‡èšã€åŸ‹ç‚¹åˆ†æ</td><td style="text-align:left">æ”¯æŒä¸‡äº¿çº§æ¶ˆæ¯å †ç§¯ï¼Œæ€§èƒ½ç¨³å®šä¸è¡°å‡ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®åœºæ™¯</td></tr></tbody></table><hr><h3 id="ä¸‰ã€æ ¸å¿ƒæ¶æ„ä¸æ¦‚å¿µ">ä¸‰ã€æ ¸å¿ƒæ¶æ„ä¸æ¦‚å¿µ</h3><p>è¦ç†è§£ RocketMQï¼Œéœ€è¦çŸ¥é“å‡ ä¸ªå…³é”®è§’è‰²ï¼š<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/frTwo1.png" alt=""></p><h4 id="ç»å…¸æ ¸å¿ƒç»„ä»¶">ç»å…¸æ ¸å¿ƒç»„ä»¶</h4><table><thead><tr><th style="text-align:center">åºå·</th><th style="text-align:left">ç»„ä»¶åç§°</th><th style="text-align:left">ä¸»è¦ä½œç”¨</th><th style="text-align:left">è¯´æ˜ / ç‰¹ç‚¹</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:left"><strong>Producerï¼ˆç”Ÿäº§è€…ï¼‰</strong></td><td style="text-align:left">å‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯</td><td style="text-align:left">è´Ÿè´£å°†ä¸šåŠ¡ç³»ç»Ÿçš„æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„ <strong>Topic</strong>ï¼Œæ”¯æŒåŒæ­¥ã€å¼‚æ­¥ã€å•å‘ä¸‰ç§å‘é€æ–¹å¼</td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:left"><strong>Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰</strong></td><td style="text-align:left">æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯çš„å®¢æˆ·ç«¯</td><td style="text-align:left">ä» Broker æ‹‰å–æ¶ˆæ¯å¹¶è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¯åˆ†ä¸º <strong>Push</strong> å’Œ <strong>Pull</strong> ä¸¤ç§æ¶ˆè´¹æ¨¡å¼</td></tr><tr><td style="text-align:center"><strong>3</strong></td><td style="text-align:left"><strong>Consumer Groupï¼ˆæ¶ˆè´¹è€…ç»„ï¼‰</strong></td><td style="text-align:left">å®ç°è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨æ¶ˆè´¹</td><td style="text-align:left">å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…åŒä¸€ Topic æ—¶ç»„æˆæ¶ˆè´¹è€…ç»„ï¼Œä¸€ä¸ªåˆ†åŒºåªä¼šè¢«ç»„å†…ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</td></tr><tr><td style="text-align:center"><strong>4</strong></td><td style="text-align:left"><strong>Brokerï¼ˆæ¶ˆæ¯æœåŠ¡å™¨ï¼‰</strong></td><td style="text-align:left">å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯</td><td style="text-align:left">RocketMQ çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£æ¶ˆæ¯çš„æŒä¹…åŒ–ã€è½¬å‘ã€ä¸»ä»å¤åˆ¶å’Œé«˜å¯ç”¨</td></tr><tr><td style="text-align:center"><strong>5</strong></td><td style="text-align:left"><strong>Topicï¼ˆä¸»é¢˜ï¼‰</strong></td><td style="text-align:left">æ¶ˆæ¯çš„åˆ†ç±»ä¸è·¯ç”±å•å…ƒ</td><td style="text-align:left">Producer å‘é€æ¶ˆæ¯åˆ°æŒ‡å®š Topicï¼ŒConsumer è®¢é˜… Topic æ¶ˆè´¹æ¶ˆæ¯ï¼›ä¸€ä¸ª Topic å¯åŒ…å«å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆåˆ†åŒºï¼‰</td></tr><tr><td style="text-align:center"><strong>6</strong></td><td style="text-align:left"><strong>Name Serverï¼ˆåå­—æœåŠ¡ï¼‰</strong></td><td style="text-align:left">ç®¡ç† Broker åœ°å€ä¿¡æ¯</td><td style="text-align:left">ç±»ä¼¼è½»é‡çº§æ³¨å†Œä¸­å¿ƒï¼Œç»´æŠ¤ Broker å…ƒæ•°æ®ï¼Œå¸®åŠ© Producer å’Œ Consumer å®šä½æ¶ˆæ¯å­˜å‚¨ä½ç½®</td></tr><tr><td style="text-align:center"><strong>7</strong></td><td style="text-align:left"><strong>Controllerï¼ˆæ§åˆ¶å™¨ï¼‰</strong></td><td style="text-align:left">ä¸»ä»è‡ªåŠ¨åˆ‡æ¢ä¸é«˜å¯ç”¨æ§åˆ¶</td><td style="text-align:left">RocketMQ 5.x å¼•å…¥ï¼ŒåŸºäº Raftï¼ˆDLedgerï¼‰åè®®å®ç° Broker è‡ªåŠ¨é€‰ä¸»å’Œå…ƒæ•°æ®ç®¡ç†</td></tr><tr><td style="text-align:center"><strong>8</strong></td><td style="text-align:left"><strong>Proxyï¼ˆä»£ç†å±‚ï¼‰</strong></td><td style="text-align:left">å®¢æˆ·ç«¯è®¿é—®å…¥å£ä¸åè®®è½¬æ¢</td><td style="text-align:left">RocketMQ 5.x æ–°ç»„ä»¶ï¼Œæ— çŠ¶æ€ï¼Œå¯æ¨ªå‘æ‰©å±•ï¼›ç»Ÿä¸€æ¥å…¥å±‚ï¼Œæ”¯æŒå¤šåè®®ï¼ˆå¦‚ HTTPã€gRPCï¼‰ï¼Œéš”ç¦»å®¢æˆ·ç«¯ä¸ Broker</td></tr></tbody></table><blockquote><p><strong>å¼•å…¥ Proxy æ¨¡å¼çš„ä¼˜åŠ¿ï¼š</strong></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">**æ¶æ„è§£è€¦ä¸è¯­è¨€æ— å…³**ï¼šProxy ä½œä¸ºé€šç”¨ä»£ç†ï¼Œå°†å¤æ‚çš„ Broker åè®®å°è£…æˆæ›´ç®€å•çš„æ¥å£ï¼ˆå¦‚ gRPCï¼‰ï¼Œä½¿å¾—ç”¨ä¸åŒç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Go, Python, C++ ç­‰ï¼‰å¼€å‘çš„å®¢æˆ·ç«¯æ›´å®¹æ˜“æ¥å…¥ï¼Œè€Œæ— éœ€å®ç°å¤æ‚çš„åŸç”Ÿåè®®ã€‚</span><br><span class="line">**ç®€åŒ–å®¢æˆ·ç«¯**ï¼šå®¢æˆ·ç«¯ä¸å†éœ€è¦æ„ŸçŸ¥ Name Server å’Œ Broker çš„åœ°å€å˜åŒ–ï¼Œåªéœ€è¿æ¥å›ºå®šçš„ Proxy åœ°å€å³å¯ï¼Œå¤§å¤§é™ä½äº†å®¢æˆ·ç«¯çš„å¤æ‚åº¦ã€‚</span><br><span class="line">**å¢å¼ºå®‰å…¨æ€§**ï¼šå¯ä»¥åœ¨ Proxy å±‚ç»Ÿä¸€å®ç°å®‰å…¨è®¤è¯ã€é™æµã€å®¡è®¡ç­‰ç­–ç•¥ï¼Œä½œä¸ºBrokeré›†ç¾¤çš„å®‰å…¨å±éšœã€‚</span><br><span class="line">**äº‘åŸç”Ÿå‹å¥½**ï¼šæ— çŠ¶æ€çš„ Proxy éå¸¸é€‚åˆåœ¨ Kubernetes ç­‰å®¹å™¨åŒ–ç¯å¢ƒä¸­è¿›è¡Œéƒ¨ç½²å’Œå¼¹æ€§ä¼¸ç¼©ã€‚</span><br></pre></td></tr></table></figure><hr><h2 id="æ¶ˆæ¯ä¸­é—´ä»¶åŠŸèƒ½å¯¹æ¯”è¡¨ï¼ˆActiveMQ-vs-Kafka-vs-RabbitMQ-vs-RocketMQï¼‰">æ¶ˆæ¯ä¸­é—´ä»¶åŠŸèƒ½å¯¹æ¯”è¡¨ï¼ˆActiveMQ vs Kafka vs RabbitMQ vs RocketMQï¼‰</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://support.huaweicloud.com/intl/zh-cn/productdesc-hrm/hrm_pd_012.html">å‚è€ƒèµ„æ–™</a></p></li></ul><table><thead><tr><th style="text-align:left">åŠŸèƒ½é¡¹</th><th style="text-align:left">ActiveMQ</th><th style="text-align:left">Kafka</th><th style="text-align:left">RabbitMQ</th><th style="text-align:left">RocketMQ</th></tr></thead><tbody><tr><td style="text-align:left">å®¢æˆ·ç«¯ SDK</td><td style="text-align:left">Javaã€.NETã€C++ ç­‰</td><td style="text-align:left">Javaã€Scala ç­‰</td><td style="text-align:left">Javaã€.NETã€Goã€Pythonã€C ç­‰</td><td style="text-align:left">Javaã€C++ã€Go</td></tr><tr><td style="text-align:left">é€šä¿¡åè®®ä¸è§„èŒƒ</td><td style="text-align:left">æ¨é€æ¨¡å‹ï¼ˆPushï¼‰ï¼Œæ”¯æŒ OpenWireã€STOMPã€AMQPã€MQTTã€JMS</td><td style="text-align:left">æ‹‰å–æ¨¡å‹ï¼ˆPullï¼‰ï¼Œæ”¯æŒ TCP</td><td style="text-align:left">æ¨é€æ¨¡å‹ï¼ˆPushï¼‰ï¼Œæ”¯æŒ AMQPã€MQTTã€STOMPã€HTTPã€WebSocket</td><td style="text-align:left">æ‹‰å–æ¨¡å‹ï¼ˆPullï¼‰ï¼Œæ”¯æŒ TCPã€JMSã€OpenMessaging</td></tr><tr><td style="text-align:left">æ¶ˆæ¯æœ‰åºæ€§</td><td style="text-align:left">é€šè¿‡ç‹¬å æ¶ˆè´¹è€…ï¼ˆExclusive Consumerï¼‰æˆ–ç‹¬å é˜Ÿåˆ—ï¼ˆExclusive Queuesï¼‰ä¿è¯é¡ºåº</td><td style="text-align:left">ä¿è¯åˆ†åŒºå†…æ¶ˆæ¯é¡ºåº</td><td style="text-align:left">å•é˜Ÿåˆ—å†…æ¶ˆæ¯å¤©ç„¶æœ‰åº</td><td style="text-align:left">ä¸¥æ ¼é¡ºåºæ¶ˆæ¯ï¼Œå¯å¹³æ»‘æ‰©å±•</td></tr><tr><td style="text-align:left">å®šæ—¶/å»¶è¿Ÿæ¶ˆæ¯</td><td style="text-align:left">æ”¯æŒ</td><td style="text-align:left">ä¸æ”¯æŒ</td><td style="text-align:left">æ”¯æŒï¼ˆä½¿ç”¨å»¶è¿Ÿæ’ä»¶ï¼‰</td><td style="text-align:left">æ”¯æŒ</td></tr><tr><td style="text-align:left">æ‰¹é‡æ¶ˆæ¯</td><td style="text-align:left">ä¸æ”¯æŒ</td><td style="text-align:left">æ”¯æŒï¼ˆå¼‚æ­¥ç”Ÿäº§è€…ï¼‰</td><td style="text-align:left">æ”¯æŒï¼ˆPublisher Confirms æ¨¡å¼ä¸‹ï¼‰</td><td style="text-align:left">æ”¯æŒï¼ˆåŒæ­¥æ¨¡å¼å¯é¿å…æ¶ˆæ¯ä¸¢å¤±ï¼‰</td></tr><tr><td style="text-align:left">å¹¿æ’­æ¶ˆæ¯</td><td style="text-align:left">æ”¯æŒ</td><td style="text-align:left">ä¸æ”¯æŒ</td><td style="text-align:left">æ”¯æŒï¼ˆFanout äº¤æ¢æœºï¼‰</td><td style="text-align:left">æ”¯æŒ</td></tr><tr><td style="text-align:left">æ¶ˆæ¯è¿‡æ»¤</td><td style="text-align:left">æ”¯æŒ</td><td style="text-align:left">æ”¯æŒï¼ˆå¯ç”¨ Kafka Streams å®ç°ï¼‰</td><td style="text-align:left">æ”¯æŒï¼ˆåŸºäº Exchange çš„è·¯ç”±é”®æˆ– Headerï¼‰</td><td style="text-align:left">æ”¯æŒï¼ˆåŸºäº SQL92 å±æ€§è¿‡æ»¤ï¼‰</td></tr><tr><td style="text-align:left">æœåŠ¡å™¨ç«¯è§¦å‘é‡æŠ•é€’</td><td style="text-align:left">ä¸æ”¯æŒ</td><td style="text-align:left">ä¸æ”¯æŒ</td><td style="text-align:left">æ”¯æŒï¼ˆNack æˆ– TTL+DLXï¼‰</td><td style="text-align:left">æ”¯æŒ</td></tr><tr><td style="text-align:left">æ¶ˆæ¯å­˜å‚¨</td><td style="text-align:left">æ”¯æŒé«˜æ€§èƒ½æŒä¹…åŒ–ï¼ˆJDBC + LevelDB/KahaDBï¼‰</td><td style="text-align:left">é«˜æ€§èƒ½æ–‡ä»¶å­˜å‚¨</td><td style="text-align:left">å†…å­˜+ç£ç›˜æ··åˆå­˜å‚¨ï¼ˆMnesia/åŸºäº Erlang çš„æ—¥å¿—ï¼‰</td><td style="text-align:left">é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿæ–‡ä»¶å­˜å‚¨</td></tr><tr><td style="text-align:left">æ¶ˆæ¯å›æº¯ï¼ˆå†å²æ¶ˆæ¯æŸ¥è¯¢ï¼‰</td><td style="text-align:left">æ”¯æŒ</td><td style="text-align:left">æ”¯æŒï¼ˆé€šè¿‡ offsetï¼‰</td><td style="text-align:left">ä¸æ”¯æŒï¼ˆæ¶ˆæ¯è¢«æ¶ˆè´¹åæ— æ³•å›æº¯ï¼‰</td><td style="text-align:left">æ”¯æŒï¼ˆæ—¶é—´æˆ³ä¸ offsetï¼‰</td></tr><tr><td style="text-align:left">æ¶ˆæ¯ä¼˜å…ˆçº§</td><td style="text-align:left">æ”¯æŒ</td><td style="text-align:left">ä¸æ”¯æŒ</td><td style="text-align:left">æ”¯æŒï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰</td><td style="text-align:left">ä¸æ”¯æŒ</td></tr><tr><td style="text-align:left">é«˜å¯ç”¨ä¸æ•…éšœè½¬ç§»</td><td style="text-align:left">ä¾èµ–å­˜å‚¨ï¼Œå¦‚ LevelDB éœ€ ZooKeeper</td><td style="text-align:left">éœ€è¦ ZooKeeper</td><td style="text-align:left">æ”¯æŒé•œåƒé˜Ÿåˆ—ï¼ˆClassic / Quorum æ¨¡å¼ï¼‰</td><td style="text-align:left">æ”¯æŒä¸»ä»æ¨¡å¼ï¼ˆæ— éœ€é¢å¤–ç»„ä»¶ï¼‰</td></tr><tr><td style="text-align:left">æ¶ˆæ¯è½¨è¿¹ï¼ˆMessage Trackï¼‰</td><td style="text-align:left">ä¸æ”¯æŒ</td><td style="text-align:left">ä¸æ”¯æŒ</td><td style="text-align:left">ä¸æ”¯æŒï¼ˆå¯é€šè¿‡æ’ä»¶æ‰©å±•ï¼‰</td><td style="text-align:left">æ”¯æŒ</td></tr><tr><td style="text-align:left">é…ç½®å¤æ‚åº¦</td><td style="text-align:left">é»˜è®¤é…ç½®è¾ƒä½ï¼Œéœ€æ‰‹åŠ¨ä¼˜åŒ–</td><td style="text-align:left">é…ç½®ä¸ºé”®å€¼å¯¹ï¼Œå¯æ–‡ä»¶æˆ–ä»£ç æä¾›</td><td style="text-align:left">å¼€ç®±å³ç”¨ï¼Œé…ç½®çµæ´»ä½†é€‰é¡¹è¾ƒå¤š</td><td style="text-align:left">å¼€ç®±å³ç”¨ï¼Œä»…éœ€å…³æ³¨å°‘é‡é…ç½®</td></tr><tr><td style="text-align:left">ç®¡ç†ä¸è¿ç»´å·¥å…·</td><td style="text-align:left">æ”¯æŒ</td><td style="text-align:left">æ”¯æŒï¼ˆå‘½ä»¤è¡Œç›‘æ§ï¼‰</td><td style="text-align:left">æ”¯æŒï¼ˆWeb ç®¡ç†æ§åˆ¶å°ã€CLIï¼‰</td><td style="text-align:left">æ”¯æŒï¼ˆä¸°å¯Œçš„ Web ä¸å‘½ä»¤è¡Œå·¥å…·ï¼‰</td></tr></tbody></table><h2 id="RocketMQ-çš„å®‰è£…">RocketMQ çš„å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>RocketMQ 5.x ä¾èµ– JDK 1.8+ã€‚</p></li></ul><h3 id="å•æœºå®‰è£…">å•æœºå®‰è£…</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/docs/quickStart/01quickstart">å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p>ä¸‹è½½RocketMQ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /usr/local/soft/rocketmq/</span><br><span class="line">wget https://dist.apache.org/repos/dist/release/rocketmq/5.3.2/rocketmq-all-5.3.2-bin-release.zip</span><br><span class="line">unzip rocketmq-all-5.3.2-bin-release.zip</span><br><span class="line"><span class="built_in">ln</span> -s rocketmq-all-5.3.2-bin-release rocketmq5</span><br><span class="line"><span class="built_in">cd</span> rocketmq5</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">é»˜è®¤è„šæœ¬ä¸­ï¼ŒNameServeréœ€è¦4Gå†…å­˜ï¼ŒBroker éœ€è¦8Gå†…å­˜ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿï¼Œå¯ä»¥è¿›å…¥binç›®å½•ï¼Œå¯¹å…¶ä¸­çš„<code>runserver.sh</code>å’Œ<code>runbroker.sh</code>ä¸¤ä¸ªè„šæœ¬è¿›è¡Œä¸€ä¸‹ä¿®æ”¹</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨vi runserver.shæŒ‡ä»¤ï¼Œç¼–è¾‘è¿™ä¸ªè„šæœ¬ï¼Œæ‰¾åˆ°ä¸‹é¢çš„ä¸€è¡Œé…ç½®ï¼Œè°ƒæ•´Javaè¿›ç¨‹çš„å†…å­˜å¤§å°ã€‚</span></span><br><span class="line"><span class="comment"># NameServer,Controller,Proxy éƒ½ä½¿ç”¨è¿™ä¸ªè„šæœ¬å¯åŠ¨</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -server -Xms4g -Xmx4g -Xmn2G -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span></span><br><span class="line">ä¿®æ”¹ä¸ºï¼š</span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -server -Xms1g -Xmx1g -Xmn512m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥ï¼ŒåŒæ ·è°ƒæ•´runbroker.shä¸­çš„å†…å­˜å¤§å°ã€‚Broker ä½¿ç”¨è¿™ä¸ªè„šæœ¬å¯åŠ¨</span></span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -server -Xms8g -Xmx8g&quot;</span></span><br><span class="line">ä¿®æ”¹ä¸ºï¼š</span><br><span class="line">JAVA_OPT=<span class="string">&quot;<span class="variable">$&#123;JAVA_OPT&#125;</span> -server -Xms2g -Xmx2g&quot;</span></span><br></pre></td></tr></table></figure></div><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ NameServer</p></li></ul><blockquote><p>å®‰è£…å®ŒRocketMQåŒ…åï¼Œæˆ‘ä»¬å¯åŠ¨NameServer</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### å¯åŠ¨namesrv</span></span><br><span class="line">$ <span class="built_in">nohup</span> sh bin/mqnamesrv &amp;</span><br><span class="line"><span class="comment">## æŒ‡å®šé…ç½®æ–‡ä»¶</span></span><br><span class="line">$ <span class="built_in">nohup</span> sh bin/mqnamesrv -c namesrv.conf &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">### éªŒè¯namesrvæ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class="line">$ <span class="built_in">tail</span> -f ~/logs/rocketmqlogs/namesrv.log</span><br><span class="line"><span class="comment"># æˆ‘ä»¬å¯ä»¥åœ¨namesrv.log ä¸­çœ‹åˆ° &#x27;The Name Server boot success..&#x27;ï¼Œ è¡¨ç¤ºNameServer å·²æˆåŠŸå¯åŠ¨ã€‚</span></span><br><span class="line">The Name Server boot success. serializeType=JSON, address 0.0.0.0:9876</span><br></pre></td></tr></table></figure><blockquote><p>namesrv.conf ç¤ºä¾‹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The port of nameserver</span></span><br><span class="line">listenPort = 9876</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ Broker+Proxy</p></li></ul><blockquote><p>NameServeræˆåŠŸå¯åŠ¨åï¼Œæˆ‘ä»¬å¯åŠ¨Brokerå’ŒProxyã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Local æ¨¡å¼éƒ¨ç½²ï¼Œå³ Broker å’Œ Proxy åŒè¿›ç¨‹éƒ¨ç½²ã€‚5.x ç‰ˆæœ¬ä¹Ÿæ”¯æŒ Broker å’Œ Proxy åˆ†ç¦»éƒ¨ç½²ä»¥å®ç°æ›´çµæ´»çš„é›†ç¾¤èƒ½åŠ›ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### å…ˆå¯åŠ¨broker</span></span><br><span class="line">$ <span class="built_in">nohup</span> sh bin/mqbroker -n localhost:9876 --enable-proxy &amp;</span><br><span class="line"><span class="comment"># æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œ é»˜è®¤å°±æ˜¯ conf/broker.conf</span></span><br><span class="line">$ <span class="built_in">nohup</span> sh bin/mqbroker -n localhost:9876 -c conf/broker.conf --enable-proxy &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šé¢çš„å¯åŠ¨æ–¹å¼ä¸ä¸‹é¢çš„å¯åŠ¨æ–¹å¼æ•ˆæœä¸€æ ·</span></span><br><span class="line">$ <span class="built_in">nohup</span> sh bin/mqproxy -n localhost:9876 -pc /usr/local/soft/rocketmq/rocketmq5/conf/rmq-proxy.json -bc /usr/local/soft/rocketmq/rocketmq5/conf/broker.conf -pm <span class="built_in">local</span> &amp;</span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># -n, --namesrvAddr NameServer çš„åœ°å€</span></span><br><span class="line"><span class="comment"># -pc, --proxyConfigPath Proxy é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"># -bc, --brokerConfigPath Broker é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"># -pm, --proxyMode Proxy æ¨¡å¼ï¼Œlocal or cluster</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### éªŒè¯brokeræ˜¯å¦å¯åŠ¨æˆåŠŸ, æ¯”å¦‚, brokerçš„ipæ˜¯192.168.1.2 ç„¶ååå­—æ˜¯broker-a</span></span><br><span class="line">$ <span class="built_in">tail</span> -f ~/logs/rocketmqlogs/proxy.log</span><br><span class="line"><span class="comment"># æˆ‘ä»¬å¯ä»¥åœ¨ proxy.log ä¸­çœ‹åˆ°â€œThe broker[brokerName,ip:port] boot success..â€ï¼Œè¿™è¡¨æ˜ broker å·²æˆåŠŸå¯åŠ¨ã€‚</span></span><br><span class="line">The broker[broker-a, 10.250.0.175:10911] boot success. serializeType=JSON and name server is localhost:9876</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å…³é—­æœåŠ¡å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆåœæ­¢ Broker</span></span><br><span class="line">$ sh bin/mqshutdown broker</span><br><span class="line"><span class="comment"># åœæ­¢ NameServer</span></span><br><span class="line">$ sh bin/mqshutdown namesrv</span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤å®‰è£…-å¤šèŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰å¤šå‰¯æœ¬æ¨¡å¼-å¼‚æ­¥å¤åˆ¶">é›†ç¾¤å®‰è£…:å¤šèŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰å¤šå‰¯æœ¬æ¨¡å¼-å¼‚æ­¥å¤åˆ¶</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/docs/deploymentOperations/01deploy">å®˜ç½‘æ–‡æ¡£</a> å¯¹é›†ç¾¤å®‰è£…çš„æ–¹å¼ä»‹ç»äº†å¤šç§ï¼Œæœ¬æ–‡ä»…å®æˆ˜ä¸€ç§ï¼š<code>å¤šèŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰å¤šå‰¯æœ¬æ¨¡å¼-å¼‚æ­¥å¤åˆ¶</code></p></li><li class="lvl-2"><p>æ¯ä¸ªMasteré…ç½®ä¸€ä¸ªSlaveï¼Œæœ‰å¤šç»„ Master-Slaveï¼ŒHAé‡‡ç”¨å¼‚æ­¥å¤åˆ¶æ–¹å¼ï¼Œä¸»å¤‡æœ‰çŸ­æš‚æ¶ˆæ¯å»¶è¿Ÿï¼ˆæ¯«ç§’çº§ï¼‰ï¼Œè¿™ç§æ¨¡å¼çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š</p><ul class="lvl-2"><li class="lvl-6">ä¼˜ç‚¹ï¼šå³ä½¿ç£ç›˜æŸåï¼Œæ¶ˆæ¯ä¸¢å¤±çš„éå¸¸å°‘ï¼Œä¸”æ¶ˆæ¯å®æ—¶æ€§ä¸ä¼šå—å½±å“ï¼ŒåŒæ—¶Masterå®•æœºåï¼Œæ¶ˆè´¹è€…ä»ç„¶å¯ä»¥ä»Slaveæ¶ˆè´¹ï¼Œè€Œä¸”æ­¤è¿‡ç¨‹å¯¹åº”ç”¨é€æ˜ï¼Œä¸éœ€è¦äººå·¥å¹²é¢„ï¼Œæ€§èƒ½åŒå¤šMasteræ¨¡å¼å‡ ä¹ä¸€æ ·ï¼›</li><li class="lvl-6">ç¼ºç‚¹ï¼šMasterå®•æœºï¼Œç£ç›˜æŸåæƒ…å†µä¸‹ä¼šä¸¢å¤±å°‘é‡æ¶ˆæ¯ã€‚</li></ul></li><li class="lvl-2"><p>è¯¥æ¨¡å¼ä¸‹ï¼ŒMaster èŠ‚ç‚¹å’Œ Slave èŠ‚ç‚¹ä¹‹é—´æ˜¯å¼‚æ­¥å¤åˆ¶çš„ï¼ŒMaster èŠ‚ç‚¹æŒ‚æ‰åï¼ŒSlave èŠ‚ç‚¹ä¸ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸º Master èŠ‚ç‚¹ã€‚</p></li><li class="lvl-2"><p>é›†ç¾¤è§„åˆ’</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NameServer 3 å°</span></span><br><span class="line">NameServer1 10.250.0.175</span><br><span class="line">NameServer2 10.250.0.188</span><br><span class="line">NameServer3 10.250.0.31</span><br><span class="line"></span><br><span class="line"><span class="comment"># Broker 2 Master 2 Replicas</span></span><br><span class="line">Broker1 10.250.0.188 broker-a,broker-b-s</span><br><span class="line">Broker2 10.250.0.31  broker-b,broker-a-s</span><br><span class="line"></span><br><span class="line"><span class="comment"># Proxy 3 å°</span></span><br><span class="line">Proxy1 10.250.0.175</span><br><span class="line">Proxy2 10.250.0.188</span><br><span class="line">Proxy3 10.250.0.31</span><br></pre></td></tr></table></figure><h4 id="éƒ¨ç½²-NameServer">éƒ¨ç½² NameServer</h4><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ä¸‰å°æœåŠ¡å™¨ä¸Šåˆ†åˆ«å¯åŠ¨RocketMQ NameServer</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/soft/rocketmq/rocketmq5</span><br><span class="line"><span class="built_in">nohup</span> sh bin/mqnamesrv &amp;</span><br></pre></td></tr></table></figure><h4 id="éƒ¨ç½²Broker">éƒ¨ç½²Broker</h4><ul class="lvl-0"><li class="lvl-2"><p>broker-a.properties</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">brokerClusterName=DefaultCluster <span class="comment"># é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´</span></span><br><span class="line">brokerName=broker-a              <span class="comment"># broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´</span></span><br><span class="line">brokerId=0                       <span class="comment"># brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” master çš„ brokerId å¿…é¡»ä¸º 0</span></span><br><span class="line">deleteWhen=04                    <span class="comment"># è¡¨ç¤ºå‡Œæ™¨ 4 ç‚¹æ¸…ç†</span></span><br><span class="line">fileReservedTime=48              <span class="comment"># è¡¨ç¤ºä¿å­˜ 48 å°æ—¶çš„æ•°æ®</span></span><br><span class="line">brokerRole=ASYNC_MASTER          <span class="comment"># è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä¸»èŠ‚ç‚¹</span></span><br><span class="line">flushDiskType=ASYNC_FLUSH        <span class="comment"># è¡¨ç¤ºå¼‚æ­¥åˆ·ç›˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£</span></span><br><span class="line"><span class="comment"># å­˜å‚¨æ•°æ®è·¯å¾„ï¼Œåé¢ä¼šä»‹ç»</span></span><br><span class="line">storePathRootDir=/usr/local/soft/rocketmq/data/store-a</span><br><span class="line">storePathCommitLog=/usr/local/soft/rocketmq/data/store-a/commitlog</span><br><span class="line">storePathConsumeQueue=/usr/local/soft/rocketmq/data/store-a/consumequeue</span><br><span class="line">storePathIndex=/usr/local/soft/rocketmq/data/store-a/index</span><br><span class="line">storePathConfig=/usr/local/soft/rocketmq/data/store-a/config</span><br><span class="line">storeCheckpoint=/usr/local/soft/rocketmq/data/store-a/checkpoint</span><br><span class="line">abortFile=/usr/local/soft/rocketmq/data/store-a/abort</span><br><span class="line"><span class="comment">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£</span></span><br><span class="line">listenPort=10911</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>broker-a-s.properties</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">brokerClusterName=DefaultCluster <span class="comment"># é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´</span></span><br><span class="line">brokerName=broker-a              <span class="comment"># broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´</span></span><br><span class="line">brokerId=1                       <span class="comment"># brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” slave çš„ brokerId å¿…é¡»å¤§äº 0</span></span><br><span class="line">deleteWhen=04</span><br><span class="line">fileReservedTime=48</span><br><span class="line">brokerRole=SLAVE                 <span class="comment"># è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä»èŠ‚ç‚¹</span></span><br><span class="line">flushDiskType=ASYNC_FLUSH</span><br><span class="line"></span><br><span class="line"><span class="comment"># å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£</span></span><br><span class="line"><span class="comment"># å­˜å‚¨æ•°æ®è·¯å¾„</span></span><br><span class="line">storePathRootDir=/usr/local/soft/rocketmq/data/store-a</span><br><span class="line">storePathCommitLog=/usr/local/soft/rocketmq/data/store-a/commitlog</span><br><span class="line">storePathConsumeQueue=/usr/local/soft/rocketmq/data/store-a/consumequeue</span><br><span class="line">storePathIndex=/usr/local/soft/rocketmq/data/store-a/index</span><br><span class="line">storePathConfig=/usr/local/soft/rocketmq/data/store-a/config</span><br><span class="line">storeCheckpoint=/usr/local/soft/rocketmq/data/store-a/checkpoint</span><br><span class="line">abortFile=/usr/local/soft/rocketmq/data/store-a/abort</span><br><span class="line"><span class="comment">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£</span></span><br><span class="line">listenPort=11011</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>broker-b.properties</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">brokerClusterName=DefaultCluster <span class="comment"># é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´</span></span><br><span class="line">brokerName=broker-b              <span class="comment"># broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´</span></span><br><span class="line">brokerId=0                       <span class="comment"># brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” master çš„ brokerId å¿…é¡»ä¸º 0</span></span><br><span class="line">deleteWhen=04                    <span class="comment"># è¡¨ç¤ºå‡Œæ™¨ 4 ç‚¹æ¸…ç†</span></span><br><span class="line">fileReservedTime=48              <span class="comment"># è¡¨ç¤ºä¿å­˜ 48 å°æ—¶çš„æ•°æ®</span></span><br><span class="line">brokerRole=ASYNC_MASTER          <span class="comment"># è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä¸»èŠ‚ç‚¹</span></span><br><span class="line">flushDiskType=ASYNC_FLUSH        <span class="comment"># è¡¨ç¤ºå¼‚æ­¥åˆ·ç›˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£</span></span><br><span class="line"><span class="comment"># å­˜å‚¨æ•°æ®è·¯å¾„</span></span><br><span class="line">storePathRootDir=/usr/local/soft/rocketmq/data/store-b</span><br><span class="line">storePathCommitLog=/usr/local/soft/rocketmq/data/store-b/commitlog</span><br><span class="line">storePathConsumeQueue=/usr/local/soft/rocketmq/data/store-b/consumequeue</span><br><span class="line">storePathIndex=/usr/local/soft/rocketmq/data/store-b/index</span><br><span class="line">storePathConfig=/usr/local/soft/rocketmq/data/store-b/config</span><br><span class="line">storeCheckpoint=/usr/local/soft/rocketmq/data/store-b/checkpoint</span><br><span class="line">abortFile=/usr/local/soft/rocketmq/data/store-b/abort</span><br><span class="line"></span><br><span class="line"><span class="comment">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£</span></span><br><span class="line">listenPort=10911</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>broker-b-s.properties</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">brokerClusterName=DefaultCluster <span class="comment"># é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´</span></span><br><span class="line">brokerName=broker-b              <span class="comment"># broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´</span></span><br><span class="line">brokerId=1                       <span class="comment"># brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” slave çš„ brokerId å¿…é¡»å¤§äº 0</span></span><br><span class="line">deleteWhen=04</span><br><span class="line">fileReservedTime=48</span><br><span class="line">brokerRole=SLAVE                 <span class="comment"># è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä»èŠ‚ç‚¹</span></span><br><span class="line">flushDiskType=ASYNC_FLUSH</span><br><span class="line"></span><br><span class="line"><span class="comment"># å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£</span></span><br><span class="line"><span class="comment"># å­˜å‚¨æ•°æ®è·¯å¾„</span></span><br><span class="line">storePathRootDir=/usr/local/soft/rocketmq/data/store-b</span><br><span class="line">storePathCommitLog=/usr/local/soft/rocketmq/data/store-b/commitlog</span><br><span class="line">storePathConsumeQueue=/usr/local/soft/rocketmq/data/store-b/consumequeue</span><br><span class="line">storePathIndex=/usr/local/soft/rocketmq/data/store-b/index</span><br><span class="line">storePathConfig=/usr/local/soft/rocketmq/data/store-b/config</span><br><span class="line">storeCheckpoint=/usr/local/soft/rocketmq/data/store-b/checkpoint</span><br><span class="line">abortFile=/usr/local/soft/rocketmq/data/store-b/abort</span><br><span class="line"></span><br><span class="line"><span class="comment">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£</span></span><br><span class="line">listenPort=11011</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ Broker1 10.250.0.188 ä¸Šå¯åŠ¨ broker-a å’Œ broker-b-s</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ broker-a</span></span><br><span class="line"><span class="built_in">nohup</span> sh bin/mqbroker -n <span class="string">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -c conf/2m-2s-async/broker-a.properties &amp;</span><br><span class="line"><span class="comment"># å¯åŠ¨ broker-b-s</span></span><br><span class="line"><span class="built_in">nohup</span> sh bin/mqbroker -n <span class="string">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -c conf/2m-2s-async/broker-b-s.properties &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">## nohup.out ä¸­çš„è¾“å‡ºç±»ä¼¼ä¸ä¸‹é¢è¿™ç§å°±è¡¨ç¤ºå¯åŠ¨æˆåŠŸ</span></span><br><span class="line">The broker[broker-a, 10.250.0.31:11011] boot success. serializeType=JSON and name server is 10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ Broker2 10.250.0.31 ä¸Šå¯åŠ¨ broker-b å’Œ broker-a-s</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ broker-b</span></span><br><span class="line"><span class="built_in">nohup</span> sh bin/mqbroker -n <span class="string">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -c conf/2m-2s-async/broker-b.properties &amp;</span><br><span class="line"><span class="comment"># å¯åŠ¨ broker-a-s</span></span><br><span class="line"><span class="built_in">nohup</span> sh bin/mqbroker -n <span class="string">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -c conf/2m-2s-async/broker-a-s.properties &amp;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ£€æŸ¥æœºå™¨çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¡®è®¤ Broker æ˜¯å¦å·²ç»æˆåŠŸæ³¨å†Œåˆ° Nameserverï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆåœ¨ä»»æ„ä¸€å°æœºå™¨ä¸Šï¼‰</span></span><br><span class="line">sh bin/mqadmin clusterList -n 10.250.0.175:9876</span><br><span class="line"><span class="comment">## è¾“å‡ºç±»ä¼¼å¦‚ä¸‹</span></span><br><span class="line"><span class="comment">#Cluster Name           #Broker Name            #BID  #Addr                  #Version              #InTPS(LOAD)                   #OutTPS(LOAD)  #Timer(Progress)        #PCWait(ms)  #Hour         #SPACE    #ACTIVATED</span></span><br><span class="line">DefaultCluster          broker-a                0     10.250.0.188:10911     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489250.72     0.2900          <span class="literal">true</span></span><br><span class="line">DefaultCluster          broker-a                1     10.250.0.31:11011      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  3-0(0.0w, 0.0, 0.0)               0  489250.72     0.2600         <span class="literal">false</span></span><br><span class="line">DefaultCluster          broker-b                0     10.250.0.31:10911      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489250.72     0.2600          <span class="literal">true</span></span><br><span class="line">DefaultCluster          broker-b                1     10.250.0.188:11011     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  3-0(0.0w, 0.0, 0.0)               0  489250.72     0.2900         <span class="literal">false</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®-Proxy">é…ç½® Proxy</h4><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ä¸‰å°æœåŠ¡å™¨ä¸Šåˆ†åˆ«å¯åŠ¨RocketMQ NameServer</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> sh bin/mqproxy -n <span class="string">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œé›†ç¾¤çš„åç§°è¦ä¸ conf/rmq-proxy.json ä¸­é…ç½®çš„é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´ï¼Œé»˜è®¤æ˜¯ DefaultCluster</span></span><br><span class="line"><span class="comment">## é»˜è®¤çš„é…ç½®æ–‡ä»¶å°±æ˜¯ conf/rmq-proxy.jsonï¼Œä½†å¦‚æœé€šè¿‡ -pc æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="built_in">nohup</span> sh bin/mqproxy -n <span class="string">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -pc /usr/local/soft/rocketmq/rocketmq5/conf/rmq-proxy.json &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹æ—¥å¿—ï¼Œè¾“å‡ºå¦‚ä¸‹å†…å®¹å°±è¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼Œtail -f nohup.out</span></span><br><span class="line">rocketmq-proxy startup successfully</span><br></pre></td></tr></table></figure><blockquote><p>rmq-proxy.json ç¤ºä¾‹</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;rocketMQClusterName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DefaultCluster&quot;</span><span class="punctuation">,</span> # é›†ç¾¤åç§°</span><br><span class="line">  <span class="attr">&quot;remotingListenPort&quot;</span><span class="punctuation">:</span> <span class="number">8080</span><span class="punctuation">,</span>              # ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ <span class="number">8080</span></span><br><span class="line">  <span class="attr">&quot;grpcServerPort&quot;</span><span class="punctuation">:</span> <span class="number">8081</span>                   # grpc ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ <span class="number">8081</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœæ­¢Proxy</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢ Proxy</span></span><br><span class="line">sh bin/mqshutdown proxy</span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤å®‰è£…-ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼éƒ¨ç½²">é›†ç¾¤å®‰è£…:ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼éƒ¨ç½²</h3><ul class="lvl-0"><li class="lvl-2"><p>RocketMQ 5.x æä¾›äº†ä¸€ç§æ–°çš„éƒ¨ç½²æ–¹å¼ <code>Controller</code>ï¼Œå¯ä»¥åœ¨ä¸»ä»æ¨¡å¼ä¸‹å®ç°ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä»èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚</p></li><li class="lvl-2"><p><a href="https://rocketmq.apache.org/zh/docs/deploymentOperations/03autofailover">å®˜æ–¹æ–‡æ¡£:ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼éƒ¨ç½²</a></p></li><li class="lvl-2"><p>Controller ç»„ä»¶æä¾›é€‰ä¸»èƒ½åŠ›ï¼Œè‹¥éœ€è¦ä¿è¯ Controller å…·å¤‡å®¹é”™èƒ½åŠ›ï¼ŒController éƒ¨ç½²éœ€è¦ä¸‰å‰¯æœ¬åŠä»¥ä¸Šï¼ˆéµå¾ª Raft çš„å¤šæ•°æ´¾åè®®ï¼‰ã€‚</p></li><li class="lvl-2"><p>æœ¬æ–‡åœ¨ä¸Šæ–‡â€œé›†ç¾¤å®‰è£…:å¤šèŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰å¤šå‰¯æœ¬æ¨¡å¼-å¼‚æ­¥å¤åˆ¶â€çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹</p></li><li class="lvl-2"><p>Controller éƒ¨ç½²æœ‰ä¸¤ç§æ–¹å¼ã€‚ä¸€ç§æ˜¯åµŒå…¥äº NameServer è¿›è¡Œéƒ¨ç½²ï¼Œå¦ä¸€ç§æ˜¯ç‹¬ç«‹éƒ¨ç½²ï¼Œæœ¬æ–‡é‡‡ç”¨ç‹¬ç«‹éƒ¨ç½² Controller ç»„ä»¶çš„æ–¹å¼ã€‚</p></li><li class="lvl-2"><p>é›†ç¾¤è§„åˆ’</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Controller 3 å°</span></span><br><span class="line">Controller1 10.250.0.175</span><br><span class="line">Controller2 10.250.0.188</span><br><span class="line">Controller3 10.250.0.31</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«åœ¨æ¯å°æœºå™¨ä¸Šåˆ›å»º<code>controller.conf</code>é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹(æ³¨æ„ä¿®æ”¹èŠ‚ç‚¹Id)</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># controller.conf</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"># DLedger Raft Group çš„åå­—ï¼ŒåŒä¸€é›†ç¾¤ä¿æŒä¸€è‡´</span></span><br><span class="line">controllerDLegerGroup = group1</span><br><span class="line"><span class="comment"># é›†ç¾¤ä¸­ä¸‰ä¸ªèŠ‚ç‚¹çš„æˆå‘˜å®šä¹‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»ä¸€è‡´</span></span><br><span class="line">controllerDLegerPeers = n0-10.250.0.175:9877;n1-10.250.0.188:9877;n2-10.250.0.31:9877</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹ idï¼Œå¿…é¡»å±äº controllerDLegerPeers ä¸­çš„ä¸€ä¸ªï¼›åŒ Group å†…å„ä¸ªèŠ‚ç‚¹è¦å”¯ä¸€</span></span><br><span class="line">controllerDLegerSelfId = n0</span><br><span class="line"><span class="comment"># Controller æ•°æ®å­˜å‚¨è·¯å¾„ï¼ˆéå¸¸å…³é”®ï¼ä¸è¦åˆ é™¤ï¼‰</span></span><br><span class="line">controllerStorePath = /usr/local/soft/rocketmq/data/DledgerController</span><br><span class="line"><span class="comment"># æ˜¯å¦å…è®¸ä» SyncStateSet å¤–é€‰ä¸¾ Master</span></span><br><span class="line"><span class="comment"># true ä¼šåŠ å¿«é€‰ä¸¾ä½†å¯èƒ½ä¸¢æ¶ˆæ¯ï¼Œå»ºè®®ç”Ÿäº§ä¿æŒ false</span></span><br><span class="line">enableElectUncleanMaster = <span class="literal">false</span></span><br><span class="line"><span class="comment"># å½“ Broker å‰¯æœ¬è§’è‰²å˜åŒ–æ—¶æ˜¯å¦ä¸»åŠ¨é€šçŸ¥ï¼ˆå»ºè®®å¼€å¯ï¼‰</span></span><br><span class="line">notifyBrokerRoleChanged = <span class="literal">true</span></span><br><span class="line"><span class="comment"># å¯åŠ¨ç«¯å£ï¼Œç«¯å£ä¸èƒ½ä¸ NameServerã€Brokerã€Proxy ç«¯å£å†²çª</span></span><br><span class="line">listenPort = 9877</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«å¯åŠ¨æ¯å°æœºå™¨ä¸Šçš„ Controller</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> sh bin/mqcontroller -n <span class="string">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -c conf/controller.conf &amp;</span><br><span class="line"><span class="comment">## å¯åŠ¨æˆåŠŸåï¼ŒæŸ¥çœ‹ nohup.out æ–‡ä»¶ï¼Œè¾“å‡ºå¦‚ä¸‹å†…å®¹å°±è¡¨ç¤ºå¯åŠ¨æˆåŠŸ</span></span><br><span class="line">load config properties file OK, conf/controller.conf</span><br><span class="line">The Controller Server boot success. serializeType=JSON</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹ broker é…ç½®æ–‡ä»¶ï¼Œä»¥ <code>broker-a.properties</code> ä¸ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å»æ‰å¦‚ä¸‹é…ç½®ï¼ŒController æ¨¡å¼ä¸‹ ä¼šè‡ªåŠ¨åˆ†é…</span></span><br><span class="line"><span class="comment"># brokerId=1                       # brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” slave çš„ brokerId å¿…é¡»å¤§äº 0</span></span><br><span class="line"><span class="comment"># brokerRole=ASYNC_MASTER          # è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä¸»èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å¦‚ä¸‹é…ç½®</span></span><br><span class="line"><span class="comment"># å¯ç”¨ Controller æ¨¡å¼ï¼ˆè‡ªåŠ¨ä¸»ä»åˆ‡æ¢æ¨¡å¼çš„æ€»å¼€å…³ï¼‰</span></span><br><span class="line">enableControllerMode = <span class="literal">true</span></span><br><span class="line"><span class="comment"># Controller é›†ç¾¤åœ°å€åˆ—è¡¨ï¼ˆå»ºè®®ä¸ Controller é›†ç¾¤ä¿æŒä¸€è‡´ï¼‰</span></span><br><span class="line">controllerAddr = 10.250.0.175:9877;10.250.0.188:9877;10.250.0.31:9877</span><br></pre></td></tr></table></figure><blockquote><p>RocketMQ 5 Broker Controller æ¨¡å¼é…ç½®å‚æ•°è¡¨</p></blockquote><table><thead><tr><th style="text-align:left">å‚æ•°å</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:center">é»˜è®¤å€¼</th><th style="text-align:left">å¤‡æ³¨ / å»ºè®®</th></tr></thead><tbody><tr><td style="text-align:left"><strong>enableControllerMode</strong></td><td style="text-align:left">æ˜¯å¦å¯ç”¨ Controller æ¨¡å¼ï¼ˆè‡ªåŠ¨ä¸»ä»åˆ‡æ¢æ€»å¼€å…³ï¼‰</td><td style="text-align:center"><code>false</code></td><td style="text-align:left">å¿…é¡»è®¾ä¸º <code>true</code> æ‰èƒ½å¯ç”¨è‡ªåŠ¨ä¸»ä»åˆ‡æ¢</td></tr><tr><td style="text-align:left"><strong>controllerAddr</strong></td><td style="text-align:left">Controller é›†ç¾¤åœ°å€åˆ—è¡¨ï¼ˆä»¥åˆ†å·åˆ†éš”ï¼‰</td><td style="text-align:center">æ— </td><td style="text-align:left">æ‰€æœ‰ Broker é…ç½®åº”ä¸€è‡´ï¼Œä¾‹å¦‚ <code>10.250.0.175:9877;10.250.0.188:9877;10.250.0.31:9877</code></td></tr><tr><td style="text-align:left"><strong>syncBrokerMetadataPeriod</strong></td><td style="text-align:left">å‘ Controller åŒæ­¥ Broker å‰¯æœ¬ä¿¡æ¯çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰</td><td style="text-align:center"><code>5000</code> (5s)</td><td style="text-align:left">ä¿æŒé»˜è®¤å³å¯ï¼›ç”¨äºä¸ŠæŠ¥å¿ƒè·³ä¸å…ƒæ•°æ®</td></tr><tr><td style="text-align:left"><strong>checkSyncStateSetPeriod</strong></td><td style="text-align:left">æ£€æŸ¥åŒæ­¥çŠ¶æ€é›†ï¼ˆSyncStateSetï¼‰çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰</td><td style="text-align:center"><code>5000</code> (5s)</td><td style="text-align:left">Controller ä¼šå®šæœŸå‰”é™¤è½åå‰¯æœ¬</td></tr><tr><td style="text-align:left"><strong>syncControllerMetadataPeriod</strong></td><td style="text-align:left">åŒæ­¥ Controller å…ƒæ•°æ®çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰</td><td style="text-align:center"><code>10000</code> (10s)</td><td style="text-align:left">Broker å®šæœŸä»é›†ç¾¤è·å–å½“å‰æ´»è·ƒ Controller åœ°å€</td></tr><tr><td style="text-align:left"><strong>haMaxTimeSlaveNotCatchup</strong></td><td style="text-align:left">Slave æœªè·Ÿä¸Š Master çš„æœ€å¤§æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰</td><td style="text-align:center"><code>15000</code> (15s)</td><td style="text-align:left">è¶…è¿‡è¯¥æ—¶é—´å°† Slave ç§»å‡º SyncStateSet</td></tr><tr><td style="text-align:left"><strong>storePathEpochFile</strong></td><td style="text-align:left">Epoch æ–‡ä»¶å­˜å‚¨è·¯å¾„</td><td style="text-align:center"><code>store/epochFile</code></td><td style="text-align:left">éå¸¸é‡è¦ï¼ä¸è¦åˆ é™¤ï¼›å­˜å‚¨ä¸»ä»ä»»æœŸã€epoch ç­‰å…ƒä¿¡æ¯</td></tr><tr><td style="text-align:left"><strong>allAckInSyncStateSet</strong></td><td style="text-align:left">æ˜¯å¦è¦æ±‚æ‰€æœ‰åŒæ­¥å‰¯æœ¬éƒ½ ACK åæ‰è¿”å›æˆåŠŸ</td><td style="text-align:center"><code>false</code></td><td style="text-align:left"><code>true</code> å¯ä¿è¯å¼ºä¸€è‡´ä½†æ€§èƒ½ä¸‹é™ï¼›å»ºè®®ä¿æŒé»˜è®¤</td></tr><tr><td style="text-align:left"><strong>syncFromLastFile</strong></td><td style="text-align:left">Slave æ˜¯å¦ä»æœ€åä¸€ä¸ªæ–‡ä»¶å¼€å§‹å¤åˆ¶ï¼ˆç©ºç›˜å¯åŠ¨æ—¶ï¼‰</td><td style="text-align:center"><code>false</code></td><td style="text-align:left">è‹¥å†å²æ—¥å¿—å¾ˆå¤§ä¸” Slave æ–°å»ºï¼Œå¯è®¾ä¸º <code>true</code></td></tr><tr><td style="text-align:left"><strong>asyncLearner</strong></td><td style="text-align:left">æ˜¯å¦ä¸ºå¼‚æ­¥ learner å‰¯æœ¬ï¼ˆä¸å‚ä¸é€‰ä¸»ï¼‰</td><td style="text-align:center"><code>false</code></td><td style="text-align:left">ç”¨äºè¿œç¨‹ç¾å¤‡å‰¯æœ¬ï¼Œä¸ä¼šè¢«é€‰ä¸¾ä¸º Master</td></tr><tr><td style="text-align:left"><strong>inSyncReplicas</strong></td><td style="text-align:left">éœ€ä¿æŒåŒæ­¥çš„å‰¯æœ¬ç»„æ•°é‡</td><td style="text-align:center"><code>1</code></td><td style="text-align:left">è‹¥ <code>allAckInSyncStateSet=true</code>ï¼Œè¯¥å‚æ•°æ— æ•ˆ</td></tr><tr><td style="text-align:left"><strong>minInSyncReplicas</strong></td><td style="text-align:left">æœ€å°åŒæ­¥å‰¯æœ¬æ•°é‡ï¼Œä½äºè¯¥å€¼åˆ™æ‹’ç»å†™å…¥</td><td style="text-align:center"><code>1</code></td><td style="text-align:left">é˜²æ­¢å†™å…¥è¿‡å¤šæœªåŒæ­¥å‰¯æœ¬å¯¼è‡´æ•°æ®ä¸¢å¤±é£é™©</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>é‡æ–°å¯åŠ¨ Brokerï¼Œä¸ºä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§åœ¨é‡å¯æ—¶ä¸è¢«ç ´åï¼Œå¯åŠ¨é¡ºåºåº”ä¸ºå…ˆé‡æ–°åŸMasterï¼Œå†é‡å¯åŸSlave</p></li><li class="lvl-2"><p>å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ£€æŸ¥æœºå™¨çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°é›†ç¾¤å†…éƒ¨è‡ªåŠ¨åˆ†é…äº†ä¸»ä»</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¡®è®¤ Broker æ˜¯å¦å·²ç»æˆåŠŸæ³¨å†Œåˆ° Nameserverï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆåœ¨ä»»æ„ä¸€å°æœºå™¨ä¸Šï¼‰</span></span><br><span class="line">sh bin/mqadmin clusterList -n 10.250.0.175:9876</span><br><span class="line"><span class="comment">## è¾“å‡ºç±»ä¼¼å¦‚ä¸‹</span></span><br><span class="line"><span class="comment">#Cluster Name           #Broker Name            #BID  #Addr                  #Version              #InTPS(LOAD)                   #OutTPS(LOAD)  #Timer(Progress)        #PCWait(ms)  #Hour         #SPACE    #ACTIVATED</span></span><br><span class="line">DefaultCluster          broker-a                0     10.250.0.188:10911     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489268.48     0.2900          <span class="literal">true</span></span><br><span class="line">DefaultCluster          broker-a                2     10.250.0.31:11011      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  2-0(0.0w, 0.0, 0.0)               0  489268.48     0.2700         <span class="literal">false</span></span><br><span class="line">DefaultCluster          broker-b                0     10.250.0.31:10911      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489268.48     0.2700          <span class="literal">true</span></span><br><span class="line">DefaultCluster          broker-b                2     10.250.0.188:11011     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  3-0(0.0w, 0.0, 0.0)               0  489268.48     0.2900         <span class="literal">false</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>éªŒè¯ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢ï¼Œæ­¤æ—¶å…³é—­ <code>broker-b</code> çš„ Masterï¼Œå¹¶æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sh bin/mqadmin clusterList -n 10.250.0.175:9876</span><br><span class="line"><span class="comment">## è¾“å‡ºç±»ä¼¼å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°`broker-b`åŸæ¥çš„ Slave è¢«åˆ‡æ¢ä¸º Master</span></span><br><span class="line"><span class="comment">#Cluster Name           #Broker Name            #BID  #Addr                  #Version              #InTPS(LOAD)                   #OutTPS(LOAD)  #Timer(Progress)        #PCWait(ms)  #Hour         #SPACE    #ACTIVATED</span></span><br><span class="line">DefaultCluster          broker-a                0     10.250.0.188:10911     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489268.58     0.2900          <span class="literal">true</span></span><br><span class="line">DefaultCluster          broker-a                2     10.250.0.31:11011      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  1-0(0.0w, 0.0, 0.0)               0  489268.58     0.2700         <span class="literal">false</span></span><br><span class="line">DefaultCluster          broker-b                0     10.250.0.188:11011     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489268.58     0.2900          <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡æ–°å¯åŠ¨åˆšæ‰å…³é—­çš„ <code>broker-b</code> ï¼ŒèŠ‚ç‚¹ä¼šè‡ªåŠ¨åŠ å…¥é›†ç¾¤ï¼Œè§’è‰²ä¸º Slave</p></li><li class="lvl-2"><p>åœæ­¢ Controller</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢ PrControlleroxy</span></span><br><span class="line">sh bin/mqshutdown controller</span><br></pre></td></tr></table></figure><h2 id="ç«¯å£è¯´æ˜">ç«¯å£è¯´æ˜</h2><table><thead><tr><th>ç«¯å£å·</th><th>åè®®</th><th>ç»„ä»¶/æœåŠ¡</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><strong>9876</strong></td><td>TCP</td><td><strong>NameServer</strong></td><td>RocketMQ é›†ç¾¤çš„ <strong>NameServer</strong> æœåŠ¡ç«¯å£ã€‚<br>ç”¨äº Broker æ³¨å†Œã€å®¢æˆ·ç«¯è·¯ç”±å‘ç°ã€‚<br>Producer/Consumer è¿æ¥æ­¤ç«¯å£ä»¥è·å– Broker åœ°å€ã€‚</td></tr><tr><td><strong>8080</strong></td><td>TCP</td><td><strong>Proxy (gRPC / HTTP)</strong></td><td>RocketMQ 5 å¼•å…¥çš„ <strong>Proxy æœåŠ¡</strong> é»˜è®¤ç«¯å£ä¹‹ä¸€ã€‚<br>ç”¨äº <strong>HTTP/gRPC å®¢æˆ·ç«¯æ¥å…¥</strong>ï¼Œä¾‹å¦‚ RocketMQ Proxy REST APIã€å¼‚æ­¥æ¶ˆæ¯æ¥å£ç­‰ã€‚</td></tr><tr><td><strong>8081</strong></td><td>TCP</td><td><strong>Proxy Admin / Dashboard / gRPC Alt</strong></td><td>é€šå¸¸æ˜¯ Proxy çš„ <strong>ç®¡ç†æ¥å£</strong> æˆ– <strong>gRPC è¾…åŠ©ç«¯å£</strong>ï¼ˆä¾é…ç½®è€Œå®šï¼‰ã€‚<br>ä¹Ÿå¯èƒ½æ˜¯æ§åˆ¶é¢æ¥å£ï¼Œç”¨äºä¸ Console æˆ–æ§åˆ¶å·¥å…·é€šä¿¡ã€‚</td></tr><tr><td><strong>10909</strong></td><td>TCP</td><td><strong>Broker HA (High Availability)</strong></td><td>Broker <strong>ä¸»ä»åŒæ­¥ç«¯å£</strong>ï¼ˆMaster â†” Slave ä¹‹é—´çš„æ•°æ®å¤åˆ¶ï¼‰ã€‚<br>ç”¨äºæ¶ˆæ¯æ•°æ®ä¸å…ƒæ•°æ®çš„åŒæ­¥ã€‚</td></tr><tr><td><strong>10911</strong></td><td>TCP</td><td><strong>Broker æœåŠ¡ç«¯å£</strong></td><td>Broker çš„ <strong>ä¸»é€šä¿¡ç«¯å£</strong>ï¼Œå®¢æˆ·ç«¯è¿æ¥å‘é€æ¶ˆæ¯ã€æ¶ˆè´¹æ¶ˆæ¯ã€å¿ƒè·³ç­‰ã€‚<br>Producer å’Œ Consumer é€šè¿‡ NameServer è·å–è¯¥ç«¯å£åœ°å€åè¿›è¡Œé€šä¿¡ã€‚</td></tr><tr><td><strong>10912</strong></td><td>TCP</td><td><strong>Broker HA å®¢æˆ·ç«¯ç«¯å£</strong></td><td>Broker <strong>ä¸»ä»å¤åˆ¶ä¸­çš„ Slave è¿æ¥ Master</strong> æ—¶ä½¿ç”¨çš„ <strong>å®¢æˆ·ç«¯ç›‘å¬ç«¯å£</strong>ã€‚<br>é€šå¸¸ä¸ 10909 é…åˆä½¿ç”¨ï¼Œä¸€ä¸»å¤šä»æ¨¡å¼ä¸­ Slave ä¸»åŠ¨è¿æ¥ Masterã€‚</td></tr></tbody></table><h2 id="æ—¥å¿—åŠæ•°æ®å­˜å‚¨è·¯å¾„">æ—¥å¿—åŠæ•°æ®å­˜å‚¨è·¯å¾„</h2><ul class="lvl-0"><li class="lvl-2"><p>RocketMQ 5 ä¸»è¦æœ‰ä¸‰ç±»æœåŠ¡ç»„ä»¶éœ€è¦å…³æ³¨å®ƒä»¬çš„å­˜å‚¨ç›®å½•</p></li></ul><table><thead><tr><th style="text-align:left">ç»„ä»¶</th><th style="text-align:left">åŠŸèƒ½</th><th style="text-align:left">é»˜è®¤å­˜å‚¨å†…å®¹</th><th style="text-align:left">é»˜è®¤è·¯å¾„ï¼ˆLinux ç¯å¢ƒï¼‰</th></tr></thead><tbody><tr><td style="text-align:left"><strong>NameServer</strong></td><td style="text-align:left">è·¯ç”±æœåŠ¡ï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰</td><td style="text-align:left">å„ä¸ªç»„ä»¶çš„çš„æ³¨å†Œ</td><td style="text-align:left">æ—¥å¿—æ–‡ä»¶ï¼š<code>~/logs/rocketmqlogs/namesrv.log</code><br>æ—¥å¿—é…ç½®ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/rmq.namesrv.logback.xml</code> <br> é…ç½®æ–‡ä»¶ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/namesrv.conf</code>ï¼ˆå¯é€‰ï¼‰</td></tr><tr><td style="text-align:left"><strong>Broker</strong></td><td style="text-align:left">æ ¸å¿ƒæ¶ˆæ¯å­˜å‚¨ä¸è½¬å‘æœåŠ¡</td><td style="text-align:left">æ¶ˆæ¯æ•°æ®ï¼ˆCommitLogã€ConsumeQueueã€Indexã€Configï¼‰<br><strong>ç›®å½•ç»“æ„ï¼š</strong><br>â”œâ”€â”€ <code>commitlog/</code> â†’ æ¶ˆæ¯ç‰©ç†æ–‡ä»¶<br>â”œâ”€â”€ <code>consumequeue/</code> â†’ æ¶ˆè´¹é˜Ÿåˆ—ç´¢å¼•<br>â”œâ”€â”€ <code>index/</code> â†’ æ¶ˆæ¯ç´¢å¼•<br>â”œâ”€â”€ <code>config/</code> â†’ topicã€offsetã€subscription ä¿¡æ¯<br>â”œâ”€â”€ <code>checkpoint</code> â†’ å­˜å‚¨æ ¡éªŒç‚¹<br>â”œâ”€â”€ <code>abort</code> â†’ å¼‚å¸¸é€€å‡ºæ ‡å¿—</td><td style="text-align:left"><strong>æ•°æ®ç›®å½•</strong>ï¼š<code>~/store</code><br>æ—¥å¿—æ–‡ä»¶ï¼š<code>~/logs/rocketmqlogs/broker.log</code><br>æ—¥å¿—é…ç½®ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/rmq.broker.logback.xml</code><br>é…ç½®æ–‡ä»¶ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/broker.conf</code></td></tr><tr><td style="text-align:left"><strong>Proxy</strong></td><td style="text-align:left">å®¢æˆ·ç«¯è®¿é—®å…¥å£å±‚ï¼ˆæ— çŠ¶æ€ä»£ç†ï¼‰<br>ï¼ˆ5.x æ–°å¼•å…¥ç»„ä»¶ï¼‰</td><td style="text-align:left">è½¬å‘æ—¥å¿—ã€è®¿é—®æ—¥å¿—</td><td style="text-align:left">æ—¥å¿—é…ç½®ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/rmq.proxy.logback.xml</code><br>æ—¥å¿—æ–‡ä»¶ï¼š<code>~/logs/rocketmqlogs/proxy.log</code><br>é…ç½®æ–‡ä»¶ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/rmq-proxy.json</code></td></tr><tr><td style="text-align:left"><strong>Controller</strong></td><td style="text-align:left"><strong>Broker ä¸»ä»åè°ƒä¸é«˜å¯ç”¨ç®¡ç†</strong><br>ï¼ˆ5.x æ–°å¼•å…¥ç»„ä»¶ï¼‰</td><td style="text-align:left">- é›†ç¾¤ä¸»ä»å…ƒæ•°æ®ï¼ˆä¸»ä»å…³ç³»ã€brokeræ³¨å†Œä¿¡æ¯ï¼‰<br>- Controller è‡ªèº«è¿è¡ŒçŠ¶æ€ä¸é€‰ä¸¾å…ƒæ•°æ®</td><td style="text-align:left"><strong>æ•°æ®ç›®å½•</strong>ï¼š<code>~/store/controller</code><br>æ—¥å¿—æ–‡ä»¶ï¼š<code>~/logs/rocketmqlogs/controller.log</code><br>æ—¥å¿—é…ç½®ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/rmq.controller.logback.xml</code><br>é…ç½®æ–‡ä»¶ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/controller.conf</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>NameServer å’Œ Proxy éƒ½æ˜¯æ— çŠ¶æ€ï¼ˆstatelessï¼‰ç»„ä»¶ï¼Œä¸ä¼šæŒä¹…åŒ–ä¸šåŠ¡æ•°æ®ã€‚</p></li><li class="lvl-2"><p>Broker æ•°æ®è·¯å¾„è¯´æ˜</p></li></ul><table><thead><tr><th style="text-align:left">é…ç½®é¡¹</th><th style="text-align:left">é»˜è®¤è·¯å¾„</th><th style="text-align:left">è¯´æ˜</th><th style="text-align:left">ä¸»è¦ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:left"><strong>storePathRootDir</strong></td><td style="text-align:left"><code>/home/rocketmq/store</code><br>ï¼ˆé»˜è®¤ï¼‰</td><td style="text-align:left">æ¶ˆæ¯å­˜å‚¨çš„æ ¹ç›®å½•</td><td style="text-align:left">ä½œä¸ºæ‰€æœ‰å­˜å‚¨æ–‡ä»¶çš„çˆ¶çº§ç›®å½•ï¼Œå…¶ä»–è·¯å¾„è‹¥æœªå•ç‹¬é…ç½®ï¼Œåˆ™åœ¨æ­¤ç›®å½•ä¸‹åˆ›å»º</td></tr><tr><td style="text-align:left"><strong>storePathCommitLog</strong></td><td style="text-align:left"><code>$&#123;storePathRootDir&#125;/commitlog</code></td><td style="text-align:left">CommitLog æ–‡ä»¶å­˜æ”¾è·¯å¾„</td><td style="text-align:left">å­˜å‚¨æ¶ˆæ¯ä¸»ä½“å†…å®¹ï¼Œæ˜¯æœ€æ ¸å¿ƒçš„æ•°æ®æ–‡ä»¶ï¼ˆé¡ºåºå†™å…¥ï¼‰</td></tr><tr><td style="text-align:left"><strong>storePathConsumeQueue</strong></td><td style="text-align:left"><code>$&#123;storePathRootDir&#125;/consumequeue</code></td><td style="text-align:left">æ¶ˆè´¹é˜Ÿåˆ—æ–‡ä»¶å­˜æ”¾è·¯å¾„</td><td style="text-align:left">å­˜å‚¨æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­çš„ç´¢å¼•ï¼ˆé€»è¾‘é˜Ÿåˆ—ï¼‰ï¼ŒæŒ‡å‘ CommitLog çš„ç‰©ç†ä½ç½®</td></tr><tr><td style="text-align:left"><strong>storePathIndex</strong></td><td style="text-align:left"><code>$&#123;storePathRootDir&#125;/index</code></td><td style="text-align:left">ç´¢å¼•æ–‡ä»¶å­˜æ”¾è·¯å¾„</td><td style="text-align:left">æä¾›æŒ‰ Key æŸ¥è¯¢æ¶ˆæ¯çš„ç´¢å¼•ç»“æ„ï¼Œä¾¿äºé€šè¿‡ Message Key å¿«é€Ÿæ£€ç´¢æ¶ˆæ¯</td></tr><tr><td style="text-align:left"><strong>storePathConfig</strong></td><td style="text-align:left"><code>$&#123;storePathRootDir&#125;/config</code></td><td style="text-align:left">Broker è¿è¡Œæ—¶é…ç½®å­˜å‚¨è·¯å¾„</td><td style="text-align:left">å­˜å‚¨è¿è¡Œæ—¶ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ topicã€consumerOffsetã€subscriptionGroup ç­‰</td></tr><tr><td style="text-align:left"><strong>storeCheckpoint</strong></td><td style="text-align:left"><code>$&#123;storePathRootDir&#125;/checkpoint</code></td><td style="text-align:left">Checkpoint æ–‡ä»¶è·¯å¾„</td><td style="text-align:left">è®°å½• CommitLogã€ConsumeQueueã€Index ä¸‰è€…çš„åˆ·ç›˜è¿›åº¦ï¼Œç”¨äºå´©æºƒæ¢å¤</td></tr><tr><td style="text-align:left"><strong>abortFile</strong></td><td style="text-align:left"><code>$&#123;storePathRootDir&#125;/abort</code></td><td style="text-align:left">å¼‚å¸¸é€€å‡ºæ ‡å¿—æ–‡ä»¶è·¯å¾„</td><td style="text-align:left">ç”¨äºæ ‡è¯† Broker æ˜¯å¦å¼‚å¸¸é€€å‡ºï¼Œå¯åŠ¨æ—¶æ®æ­¤åˆ¤æ–­æ˜¯å¦æ‰§è¡Œæ¢å¤æµç¨‹</td></tr></tbody></table><hr><h2 id="å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜">å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜</h2><h3 id="1-å¯åŠ¨-Proxy-å¤±è´¥">1.å¯åŠ¨ Proxy å¤±è´¥</h3><ul class="lvl-0"><li class="lvl-2"><p>æ— è®ºæ˜¯ <code>Broker+Proxy</code> å¯åŠ¨ï¼Œè¿˜æ˜¯ å•ç‹¬å¯åŠ¨ <code>Proxy</code>ï¼Œéƒ½æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é”™è¯¯ä¼šåœ¨ nohup.out ä¸­è¾“å‡º</span></span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">&quot;main&quot;</span> java.lang.UnsatisfiedLinkError: failed to load the required native library</span><br><span class="line"></span><br><span class="line">Caused by: java.lang.IllegalArgumentException: Failed to load any of the given libraries: [netty_tcnative_linux_x86_64_fedora, netty_tcnative_linux_x86_64, netty_tcnative_x86_64, netty_tcnative]</span><br><span class="line"></span><br><span class="line">Suppressed: java.lang.UnsatisfiedLinkError: /tmp/libnetty_tcnative_linux_x86_642308675901892111861.so: libcrypt.so.1: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŸå› åˆ†æ</p><ul class="lvl-2"><li class="lvl-4"><ol><li class="lvl-7">Netty-tcnative çš„ç¼–è¯‘ä¾èµ–ï¼šRocketMQ ä½¿ç”¨çš„ Netty çš„ tcnative æ¨¡å—æ˜¯åœ¨è¾ƒæ—§çš„ç¯å¢ƒä¸­ç¼–è¯‘çš„ï¼Œè€ŒåŠ¨æ€é“¾æ¥çš„ç‰ˆæœ¬é”å®šï¼šç¼–è¯‘æ—¶é“¾æ¥çš„æ˜¯ libcrypt.so.1ï¼Œè¿è¡Œæ—¶å¿…é¡»æ‰¾åˆ°ç›¸åŒä¸»ç‰ˆæœ¬å·çš„åº“</li></ol></li><li class="lvl-4"><ol start="2"><li class="lvl-7">è€Œæˆ‘å½“å‰ä½¿ç”¨çš„ç³»ç»Ÿä¸º Amazon Linux 2023ï¼ŒåŸºäºæ›´æ–°çš„ glibcï¼Œå…¶åŠ å¯†åŠŸèƒ½å·²ç»è¿ç§»åˆ° libcrypt.so.2ã€‚ï¼ˆAmazon Linux 2ï¼šåŸºäºè¾ƒæ—§çš„ glibc ç‰ˆæœ¬ï¼Œlibcrypt.so.1 æ˜¯ä¸»è¦çš„åŠ å¯†åº“ï¼‰</li></ol></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥ libcrypt æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">$ ldconfig -p | grep libcrypt</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">  libcryptsetup.so.12 (libc6,x86-64) =&gt; /lib64/libcryptsetup.so.12</span><br><span class="line">libcrypto.so.3 (libc6,x86-64) =&gt; /lib64/libcrypto.so.3</span><br><span class="line">libcrypto.so (libc6,x86-64) =&gt; /lib64/libcrypto.so</span><br><span class="line">libcrypt.so.2 (libc6,x86-64) =&gt; /lib64/libcrypt.so.2</span><br><span class="line">libcrypt.so (libc6,x86-64) =&gt; /lib64/libcrypt.so</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è§£å†³åŠæ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…å…¼å®¹æ€§åŒ…</span></span><br><span class="line"><span class="built_in">sudo</span> yum install libxcrypt-compat</span><br><span class="line"><span class="comment"># æ£€æŸ¥ libcrypt æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">$ ldconfig -p | grep libcrypt</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">  libcryptsetup.so.12 (libc6,x86-64) =&gt; /lib64/libcryptsetup.so.12</span><br><span class="line">libcrypto.so.3 (libc6,x86-64) =&gt; /lib64/libcrypto.so.3</span><br><span class="line">libcrypto.so (libc6,x86-64) =&gt; /lib64/libcrypto.so</span><br><span class="line">libcrypt.so.2 (libc6,x86-64) =&gt; /lib64/libcrypt.so.2</span><br><span class="line">libcrypt.so.1 (libc6,x86-64) =&gt; /lib64/libcrypt.so.1</span><br><span class="line">libcrypt.so (libc6,x86-64) =&gt; /lib64/libcrypt.so</span><br></pre></td></tr></table></figure><h3 id="2-å†™å…¥æ¶ˆæ¯å¤±è´¥ï¼Œå¹¶æŠ¥å¦‚ä¸‹é”™è¯¯">2.å†™å…¥æ¶ˆæ¯å¤±è´¥ï¼Œå¹¶æŠ¥å¦‚ä¸‹é”™è¯¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14 DESC: service not available now. It may be caused by one of the following reasons: the broker<span class="string">&#x27;s disk is full [CL: 0.95 CQ: 0.95 INDEX: -1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 10.250.0.175:10911</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é”™è¯¯åŸå› </p><ul class="lvl-2"><li class="lvl-4">RocketMQ è¿”å›çš„ CODE: 14 è¡¨ç¤ºï¼šBroker å½“å‰ ä¸æ¥å—æ¶ˆæ¯å†™å…¥ï¼ˆæœåŠ¡æš‚ä¸å¯ç”¨ï¼‰ã€‚</li><li class="lvl-4">the brokerâ€™s disk is full [CL: 0.95 CQ: 0.95 INDEX: -1.00]: Broker çš„ç£ç›˜å·²æ»¡</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CL: 0.95 â†’ CommitLog 95% å·²ä½¿ç”¨</span><br><span class="line">CQ: 0.95 â†’ ConsumeQueue 95% å·²ä½¿ç”¨</span><br><span class="line">INDEX: -1.00 â†’ ç´¢å¼•å¼‚å¸¸æˆ–æœªé‡‡é›†</span><br></pre></td></tr></table></figure></li></ul><table><thead><tr><th>é…ç½®é¡¹</th><th>å«ä¹‰</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>diskMaxUsedSpaceRatio</code></td><td>Broker ç£ç›˜æœ€å¤§å¯ç”¨æ¯”ä¾‹ï¼ˆè¶…è¿‡åç¦æ­¢å†™å…¥ï¼‰</td><td><strong>75%</strong></td></tr><tr><td><code>storePathCommitLog</code></td><td>æ¶ˆæ¯å­˜å‚¨è·¯å¾„ï¼ˆCommitLogï¼‰</td><td><code>~/store/commitlog</code></td></tr><tr><td><code>storePathConsumeQueue</code></td><td>æ¶ˆè´¹é˜Ÿåˆ—è·¯å¾„ï¼ˆConsumeQueueï¼‰</td><td><code>~/store/consumequeue</code></td></tr><tr><td><code>storePathIndex</code></td><td>ç´¢å¼•è·¯å¾„</td><td><code>~/store/index</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-4"><p>æ€»ç»“ï¼šå¯ä»¥ç¡®è®¤æ˜¯ ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜ å¯¼è‡´ Broker è‡ªåŠ¨è¿›å…¥ â€œå†™ä¿æŠ¤â€ æ¨¡å¼ã€‚</p></li></ul><ul class="lvl-0"><li class="lvl-2"><p>è§£å†³æ–¹æ³•</p><ul class="lvl-2"><li class="lvl-6"><ol><li class="lvl-9">æ¸…ç†ç£ç›˜ï¼šç¡®è®¤ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜ï¼Œå¹¶æ¸…ç†ç£ç›˜ç©ºé—´ï¼Œæ—¢é™ä½ç£ç›˜ä½¿ç”¨ç‡</li></ol></li><li class="lvl-6"><ol start="2"><li class="lvl-9">ç£ç›˜æ‰©å®¹ï¼šå¦‚æœæ¸…ç†ç£ç›˜ç©ºé—´åï¼Œç£ç›˜ä½¿ç”¨ç‡ä¾ç„¶è¿‡é«˜ï¼Œåˆ™éœ€è¦æ‰©å®¹ç£ç›˜</li></ol></li><li class="lvl-6"><ol start="3"><li class="lvl-9">é…ç½®è°ƒæ•´ï¼šè°ƒæ•´ Broker é…ç½®(<code>broker.conf</code>)ï¼Œå°† <code>diskMaxUsedSpaceRatio</code> é…ç½®é€‚å½“æé«˜ï¼Œå¦‚ 96%(<code>diskMaxUsedSpaceRatio=96</code>)ï¼Œè°ƒæ•´åé‡å¯ Brokerã€‚ä»…å»ºè®®åœ¨ç´§æ€¥æƒ…å†µä¸‹ä¸´æ—¶è§£å†³ã€‚</li></ol></li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RocketMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://rocketmq.apache.org/zh/&quot;&gt;RocketMQå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="rocketmq" scheme="https://blog.hanqunfeng.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>Kafka ä» Zookeeper è¿ç§»åˆ° KRaft</title>
    <link href="https://blog.hanqunfeng.com/2025/10/16/kafka-06-zk-to-kraft/"/>
    <id>https://blog.hanqunfeng.com/2025/10/16/kafka-06-zk-to-kraft/</id>
    <published>2025-10-16T14:30:05.000Z</published>
    <updated>2025-10-20T02:50:02.041Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» å¦‚ä½•å°† Kafka é›†ç¾¤ä» Zookeeper æ¨¡å¼è¿ç§»åˆ° KRaft æ¨¡å¼</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org">Kafkaå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org/39/documentation.html#kraft_zk_migration">å®˜æ–¹æ–‡æ¡£ï¼šZooKeeperåˆ°KRaftè¿ç§»</a></p></li></ul><span id="more"></span><h2 id="ä»-Zookeeper-æ¨¡å¼è¿ç§»åˆ°-KRaft-æ¨¡å¼ï¼ˆå¹³æ»‘è¿ç§»ï¼‰">ä» Zookeeper æ¨¡å¼è¿ç§»åˆ° KRaft æ¨¡å¼ï¼ˆå¹³æ»‘è¿ç§»ï¼‰</h2><p><em><strong>ï¼ï¼ï¼è¿ç§»åå°†æ— æ³•å†æ¢å¤åˆ° ZooKeeper æ¨¡å¼ï¼ï¼ï¼</strong></em></p><ul class="lvl-0"><li class="lvl-2"><p>Kafka å®˜æ–¹åœ¨ 3.4+ å¼•å…¥äº†å®Œæ•´çš„ Zookeeper â†’ KRaft å¹³æ»‘è¿ç§»æœºåˆ¶ï¼Œç§°ä¸º <code>ZK to KRaft (ZkMigration)</code>ã€‚</p></li><li class="lvl-2"><p>è¿ç§»èƒŒæ™¯ä¸å‰æ</p></li></ul><table><thead><tr><th style="text-align:left">é¡¹ç›®</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">æ”¯æŒç‰ˆæœ¬</td><td style="text-align:left">Kafka <strong>3.4.0+</strong>ï¼ˆå»ºè®®è‡³å°‘ä½¿ç”¨ <strong>3.6.x ï¼Œç›®å‰æœ€æ–°ç‰ˆä¸º 3.9.x</strong>ï¼‰</td></tr><tr><td style="text-align:left">è¿ç§»ç›®çš„</td><td style="text-align:left">æ‘†è„± ZooKeeperï¼Œå®Œå…¨åˆ‡æ¢ä¸º KRaft è‡ªç®¡ç†æ¨¡å¼</td></tr><tr><td style="text-align:left">è¿ç§»æ¨¡å¼</td><td style="text-align:left"><strong>åœ¨çº¿è¿ç§»</strong>ï¼ˆæ— åœæœºæˆ–æœ€å°åœæœºï¼‰</td></tr><tr><td style="text-align:left">æœ€ç»ˆç›®æ ‡</td><td style="text-align:left">Kafka çš„æ§åˆ¶å™¨ä¸å…ƒæ•°æ®å®Œå…¨ç”± KRaft ç®¡ç†ï¼Œä¸å†ä¾èµ– ZooKeeperã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ•´ä½“è¿ç§»æµç¨‹æ¦‚è§ˆ</p></li></ul><table><thead><tr><th>é˜¶æ®µ</th><th>æ§åˆ¶å™¨ç±»å‹</th><th>Broker æ¨¡å¼</th><th>ZooKeeper è§’è‰²</th><th>KRaft è§’è‰²</th><th>ç‰¹å¾è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åˆå§‹é˜¶æ®µ</strong></td><td>ZooKeeper æ§åˆ¶å™¨</td><td>å…¨éƒ¨ä¸º ZK æ¨¡å¼</td><td>ç®¡ç†æ‰€æœ‰å…ƒæ•°æ®</td><td>å°šæœªå¯ç”¨</td><td>æ‰€æœ‰ Broker éƒ½è¿è¡Œåœ¨ ZK æ¨¡å¼ä¸‹ï¼Œç”± ZK æ§åˆ¶å™¨ç®¡ç†é›†ç¾¤ã€‚</td></tr><tr><td><strong>åˆå§‹å…ƒæ•°æ®åŠ è½½é˜¶æ®µ</strong></td><td>KRaft æ§åˆ¶å™¨å¼€å§‹åŠ è½½</td><td>éƒ¨åˆ†ï¼ˆæˆ–å…¨éƒ¨ï¼‰ä»ä¸º ZK æ¨¡å¼</td><td>æä¾›å…ƒæ•°æ®æº</td><td>ä» ZK åŠ è½½å…ƒæ•°æ®</td><td>KRaft æ³•å®šèŠ‚ç‚¹ï¼ˆcontroller.quorum.votersï¼‰ä» ZK ä¸­è¯»å–å¹¶åŒæ­¥å½“å‰é›†ç¾¤å…ƒæ•°æ®ã€‚</td></tr><tr><td><strong>æ··åˆé˜¶æ®µ</strong></td><td>KRaft æ§åˆ¶å™¨</td><td>éƒ¨åˆ† ZK æ¨¡å¼ï¼Œéƒ¨åˆ† KRaft æ¨¡å¼</td><td>ä¿ç•™åªè¯»å…ƒæ•°æ®</td><td>ç®¡ç†å¹¶æ›´æ–°å…ƒæ•°æ®</td><td>KRaft æ§åˆ¶å™¨æˆä¸ºä¸»æ§ï¼ŒZK ä»å­˜åœ¨ä½†åªæä¾›è¯»å–ï¼ŒBroker å¯å¤„äºä¸åŒæ¨¡å¼ï¼ˆæ··åˆçŠ¶æ€ï¼‰ã€‚</td></tr><tr><td><strong>åŒå†™é˜¶æ®µ</strong></td><td>KRaft æ§åˆ¶å™¨</td><td>å…¨éƒ¨ä¸º KRaft æ¨¡å¼</td><td>æ¥æ”¶ KRaft åŒæ­¥å†™å…¥</td><td>ç®¡ç†å…ƒæ•°æ®å¹¶å†™å…¥ ZK</td><td>æ‰€æœ‰ Broker éƒ½è¿è¡Œåœ¨ KRaft æ¨¡å¼ï¼Œæ§åˆ¶å™¨å°†å…ƒæ•°æ®åŒæ—¶å†™å…¥ ZK å’Œ KRaft æ—¥å¿—ã€‚</td></tr><tr><td><strong>è¿ç§»å®Œæˆé˜¶æ®µ</strong></td><td>KRaft æ§åˆ¶å™¨</td><td>å…¨éƒ¨ä¸º KRaft æ¨¡å¼</td><td>ä¸å†ä½¿ç”¨</td><td>ç‹¬ç«‹è¿è¡Œ</td><td>åœæ­¢å‘ ZK å†™å…¥å…ƒæ•°æ®ï¼ŒZK å¯å®‰å…¨å…³é—­ï¼ŒKafka å®Œå…¨è¿è¡Œåœ¨æ—  Zookeeper çš„ KRaft æ¨¡å¼ä¸‹ã€‚</td></tr></tbody></table><h2 id="å¼€å§‹è¿ç§»">å¼€å§‹è¿ç§»</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œä»¥å‰æ–‡ <a href="/2025/10/13/kafka-01-install-zookeeper/" title="Kafka çš„å®‰è£…ï¼šåŸºäº Zookeeper">Kafka çš„å®‰è£…ï¼šåŸºäº Zookeeper</a> ä¸­çš„3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸ºä¾‹ã€‚</p></li></ul><h3 id="å¯åŠ¨ä¸€ä¸ª-Controller-èŠ‚ç‚¹">å¯åŠ¨ä¸€ä¸ª Controller èŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨ä¸€ä¸ª Controller èŠ‚ç‚¹ï¼Œè¿™é‡Œä¸º worker1</p></li><li class="lvl-2"><p>å¯åŠ¨å‰éœ€è¦å…ˆè·å–å½“å‰ Kafka é›†ç¾¤çš„ Cluster ID</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ zookeeper-shell.sh localhost:2181 get /cluster/id</span><br><span class="line">Connecting to localhost:2181</span><br><span class="line"></span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected <span class="built_in">type</span>:None path:null</span><br><span class="line">&#123;<span class="string">&quot;version&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;id&quot;</span>:<span class="string">&quot;hp_Q0pihQ0ORcIvXlfHobQ&quot;</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‡†å¤‡å¥½ Controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œå¯ä»¥ç”¨ <code>config/kraft/controller.properties</code> ä¸ºæ¨¡æ¿è¿›è¡Œä¿®æ”¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ï¼Œè¿™é‡Œåªèƒ½æ˜¯controller</span></span><br><span class="line">process.roles=controller</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹IDï¼Œä¸èƒ½ä¸ç°æœ‰BrokerèŠ‚ç‚¹çš„IDä¸€è‡´</span></span><br><span class="line">node.id=3000</span><br><span class="line"><span class="comment"># é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å½“å‰åªå¯åŠ¨äº†ä¸€ä¸ªcontrollerèŠ‚ç‚¹ï¼Œæ‰€ä»¥åªèƒ½é…ç½®ä¸€ä¸ªæŠ•ç¥¨èŠ‚ç‚¹</span></span><br><span class="line">controller.quorum.bootstrap.servers=worker1:9098</span><br><span class="line"><span class="comment"># é…ç½®ç›‘å¬å™¨ï¼Œæ³¨æ„ç«¯å£ä¸èƒ½é‡å¤</span></span><br><span class="line">listeners=CONTROLLER://:9098</span><br><span class="line">advertised.listeners=CONTROLLER://worker1:9098</span><br><span class="line">controller.listener.names=CONTROLLER</span><br><span class="line"><span class="comment"># æ—¥å¿—å­˜æ”¾ç›®å½•ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯å…ƒæ•°æ®ï¼Œåœ¨æ ¼å¼åŒ–æ—¶è¿™ä¸ªç›®å½•å¿…é¡»ä¸ºç©ºç›®å½•</span></span><br><span class="line">log.dirs=/usr/local/kafka/dataDir/kraft-meta</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹</span></span><br><span class="line">zookeeper.metadata.migration.enable=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ZooKeeper client è¿æ¥</span></span><br><span class="line">zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®š Kafka é›†ç¾¤å†…éƒ¨ï¼ˆbroker ä¸ brokerã€KRaft æ§åˆ¶å™¨ä¸ brokerï¼‰é€šä¿¡æ‰€ä½¿ç”¨çš„ç›‘å¬å™¨ï¼ˆlistenerï¼‰åç§°ã€‚</span></span><br><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œè¦ä¸åŸå…ˆçš„ server.properties ä¸­é…ç½®çš„ç›‘å¬å™¨åç§°ä¸€è‡´</span></span><br><span class="line">inter.broker.listener.name=PLAINTEXT</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¶å®ƒå‚æ•°å°½é‡ä¿æŒä¸æ—§é›†ç¾¤çš„é…ç½®ä¸€è‡´</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ Controller èŠ‚ç‚¹</p></li></ul><blockquote><p>åƒä¸‡ä¸è¦åœ¨å·²æœ‰ broker çš„æ•°æ®ç›®å½•ï¼ˆåŒ…å«æ¶ˆæ¯æ•°æ®çš„ log.dirsï¼‰ä¸Šè¿è¡Œ <a href="http://kafka-storage.sh">kafka-storage.sh</a> format ï¼Œé‚£ä¼šæŠŠåŸæœ‰æ•°æ®ç»“æ„é‡ç½®æˆ–è¸©åã€‚<br>å¿…é¡»æ˜ç¡®ï¼šæ ¼å¼åŒ–åªé’ˆå¯¹ æ–° controller çš„ metadata ç›®å½•ï¼ˆä¸”è¯¥ç›®å½•å¿…é¡»ä¸ºç©ºï¼‰ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ¼å¼åŒ–å…ƒæ•°æ®ç›®å½•ï¼Œlog.dirs å‚æ•°æŒ‡å®šå…ƒæ•°æ®å­˜æ”¾ç›®å½•ï¼Œé¦–æ¬¡è¿è¡Œå‰å¿…é¡»ä¸ºç©ºç›®å½•</span></span><br><span class="line"><span class="comment"># -t å‚æ•°æŒ‡å®šé›†ç¾¤çš„ Cluster IDï¼Œå°±æ˜¯å‰é¢è·å–çš„ Cluster ID</span></span><br><span class="line">kafka-storage.sh format --standalone -t hp_Q0pihQ0ORcIvXlfHobQ -c /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br><span class="line"><span class="comment"># å¯åŠ¨ï¼Œè¿™é‡Œæ²¡æœ‰åå°å¯åŠ¨æ˜¯ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿæ—¥å¿—è¾“å‡º</span></span><br><span class="line">kafka-server-start.sh /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure><table><thead><tr><th>æ¨¡å¼</th><th>format å‘½ä»¤</th><th>quorum çŠ¶æ€</th><th>æ˜¯å¦ä» ZK åŠ è½½</th></tr></thead><tbody><tr><td>è¿ç§»é˜¶æ®µï¼ˆstandaloneï¼‰</td><td><code>--standalone</code></td><td>æ— ï¼ˆå•èŠ‚ç‚¹ï¼‰</td><td>âœ… æ˜¯</td></tr><tr><td>æ­£å¼ KRaft æ¨¡å¼</td><td>æ—  <code>--standalone</code></td><td>âœ… å¤šèŠ‚ç‚¹</td><td>âŒ å¦ï¼ˆç‹¬ç«‹è¿è¡Œï¼‰</td></tr></tbody></table><h3 id="å°†åŸå…ˆçš„ä¸‰ä¸ªèŠ‚ç‚¹ä½œä¸º-Broker-èŠ‚ç‚¹é‡æ–°å¯åŠ¨">å°†åŸå…ˆçš„ä¸‰ä¸ªèŠ‚ç‚¹ä½œä¸º Broker èŠ‚ç‚¹é‡æ–°å¯åŠ¨</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹åŸå…ˆçš„é…ç½®æ–‡ä»¶ <code>server.properties</code>ï¼Œåªéœ€è¦ä¿®æ”¹å¦‚ä¸‹å†…å®¹å³å¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨æœ€ååŠ å…¥ CONTROLLER:PLAINTEXT</span></span><br><span class="line">listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL,CONTROLLER:PLAINTEXT</span><br><span class="line"></span><br><span class="line"><span class="comment">## ä»¥ä¸‹æ˜¯æ–°åŠ å…¥çš„ é…ç½®é¡¹</span></span><br><span class="line"><span class="comment"># Set the IBPï¼Œå½“å‰ kafka ç‰ˆæœ¬æ˜¯ 3.9.1ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸º 3.9</span></span><br><span class="line">inter.broker.protocol.version=3.9</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹</span></span><br><span class="line">zookeeper.metadata.migration.enable=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># KRaft controller quorum configurationï¼Œå› ä¸ºç›®å‰åªå¯åŠ¨äº†ä¸€ä¸ª controller èŠ‚ç‚¹ï¼Œæ‰€ä»¥åªèƒ½é…ç½®ä¸€ä¸ªæŠ•ç¥¨èŠ‚ç‚¹</span></span><br><span class="line">controller.quorum.bootstrap.servers=worker1:9098</span><br><span class="line"><span class="comment"># æ§åˆ¶å™¨ç›‘å¬å™¨åç§°ï¼Œè¦ä¸ contreller èŠ‚ç‚¹é…ç½®æ–‡ä»¶ controller.properties ä¸­çš„é…ç½®ä¸€è‡´</span></span><br><span class="line">controller.listener.names=CONTROLLER</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«é‡æ–°å¯åŠ¨ä¸‰ä¸ªèŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­ kafka</span></span><br><span class="line">kafka-server-stop.sh</span><br><span class="line"><span class="comment"># è¿™é‡Œè¦æ³¨æ„ worker1 ä¸Šä¸è¦ä½¿ç”¨ kafka-server-stop.sh è¿›è¡Œå…³é—­ï¼Œå› ä¸º worker1 ä¸Šçš„ controller èŠ‚ç‚¹ ä¹Ÿåœ¨è¿è¡Œï¼Œä¼šæœ‰ä¸¤ä¸ª kafka è¿›ç¨‹è¿è¡Œï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå…³é—­ï¼›å› ä¸º controller èŠ‚ç‚¹ å¯åŠ¨ä½¿ç”¨çš„æ˜¯ controller.properties</span></span><br><span class="line">ps -ef | grep kafka | grep  <span class="string">&quot;server\.properties&quot;</span> | grep -v grep | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="built_in">kill</span> -9</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°å¯åŠ¨ kafka</span></span><br><span class="line">kafka-server-start.sh /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å½“ä¸‰ä¸ªèŠ‚ç‚¹éƒ½ä»¥å¿…è¦çš„é…ç½®é‡æ–°å¯åŠ¨åï¼Œè¿ç§»å°†è‡ªåŠ¨å¼€å§‹ã€‚è¿ç§»å®Œæˆåï¼Œå¯ä»¥åœ¨ Controller(worker1)èŠ‚ç‚¹ ä¸Šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹æ—¥å¿—ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># âœ… æ„å‘³ï¼šä» ZooKeeper åˆ° KRaft çš„åˆå§‹å…ƒæ•°æ®è¿ç§»å·²æˆåŠŸï¼Œå…±å†™å…¥ 62 æ¡è®°å½•ï¼Œå½“å‰ KRaft metadata offset ä¸º 3179ã€‚è¿™æ˜¯è¿ç§»æˆåŠŸçš„æ˜ç¡®è¯æ®ã€‚</span></span><br><span class="line">Completed migration of metadata from ZooKeeper to KRaft. 62 records were generated <span class="keyword">in</span> 300 ms across 1 batches. The average time spent waiting on a batch was 97.00 ms. The record types were &#123;TOPIC_RECORD=3, PARTITION_RECORD=56, CONFIG_RECORD=3&#125;. The current metadata offset is now 3179 with an epoch of 2. Saw 3 brokers <span class="keyword">in</span> the migrated metadata [1, 2, 3]. (org.apache.kafka.metadata.migration.KRaftMigrationDriver)</span><br><span class="line"></span><br><span class="line"><span class="comment"># âœ… æ„å‘³ï¼šæ§åˆ¶å™¨å·²åŠ è½½å¹¶ç”Ÿæ•ˆæ–°å…ƒæ•°æ®ä¸ feature setï¼ˆä¸ offset 3179 å¯¹åº”ï¼‰ã€‚</span></span><br><span class="line">Loaded new metadata Features(metadataVersion=3.9-IV0, finalizedFeatures=&#123;metadata.version=21&#125;, finalizedFeaturesEpoch=3179). (org.apache.kafka.metadata.publisher.FeaturesPublisher)</span><br><span class="line"></span><br><span class="line"><span class="comment"># âœ… æ„å‘³ï¼šå†…éƒ¨è¿ç§»çŠ¶æ€å·²æ›´æ–°ï¼ŒKRaft ä¸Šæœ‰äº†å†™å…¥ä½ç½®è®°å½•ã€‚</span></span><br><span class="line">Finished initial migration of ZK metadata to KRaft <span class="keyword">in</span> 3486479 ns. Transitioned migration state from ZkMigrationLeadershipState&#123;kraftControllerId=3000, kraftControllerEpoch=2, kraftMetadataOffset=-1, kraftMetadataEpoch=-1, lastUpdatedTimeMs=1760682050169, migrationZkVersion=1, controllerZkEpoch=3, controllerZkVersion=3&#125; to ZkMigrationLeadershipState&#123;kraftControllerId=3000, kraftControllerEpoch=2, kraftMetadataOffset=3179, kraftMetadataEpoch=2, lastUpdatedTimeMs=1760682050169, migrationZkVersion=2, controllerZkEpoch=3, controllerZkVersion=3&#125; (org.apache.kafka.metadata.migration.KRaftMigrationDriver)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># âœ… æ„å‘³ï¼šè¿ç§»æµç¨‹æŒ‰é¢„æœŸæ¨è¿›ï¼šå…ˆæŠŠ KRaft çš„å…ƒæ•°æ®ä¸ ZK å¯¹é½ï¼ˆsyncï¼‰ï¼Œç„¶åä¸ brokers å»ºç«‹é€šä¿¡ï¼Œæœ€ç»ˆè¿›å…¥ DUAL_WRITEï¼ˆåŒå†™ï¼‰ã€‚DUAL_WRITE é˜¶æ®µè¡¨ç¤ºæ§åˆ¶å™¨åœ¨å†™å…¥ KRaft metadata log çš„åŒæ—¶ï¼Œä»ç„¶ä¼šæŠŠå¿…è¦çš„å†™æ“ä½œä¹Ÿå†™å› ZooKeeperï¼ˆåŒå†™ï¼‰â€”â€”ç›´åˆ°è¿ç§»å®Œå…¨å®Œæˆå¹¶ç¡®è®¤å¯ä»¥åœæ­¢å†™ ZK ä¸ºæ­¢ã€‚</span></span><br><span class="line">3000 transitioning from ZK_MIGRATION to SYNC_KRAFT_TO_ZK state</span><br><span class="line">...</span><br><span class="line">Performing a full metadata <span class="built_in">sync</span> from KRaft to ZK.</span><br><span class="line">Did not make any ZK writes when reconciling with KRaft state.</span><br><span class="line">3000 transitioning ... to KRAFT_CONTROLLER_TO_BROKER_COMM</span><br><span class="line">...</span><br><span class="line">Sending RPCs to broker before moving to dual-write mode using at offset and epoch OffsetAndEpoch(offset=3179, epoch=2)</span><br><span class="line">...</span><br><span class="line">3000 transitioning ... to DUAL_WRITE state</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢çš„æ—¥å¿—æ€»ä½“ä¸Šè¡¨æ˜ï¼Œå…ƒæ•°æ®è¿ç§»å·²æˆåŠŸå®Œæˆå¹¶ä¸”æ§åˆ¶å™¨è¿›å…¥äº†åŒå†™ï¼ˆDUAL_WRITEï¼‰é˜¶æ®µã€‚</p></li></ul><h3 id="å°†ä¸‰ä¸ªBrokerèŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º-KRaft-æ¨¡å¼çš„-broker-èŠ‚ç‚¹">å°†ä¸‰ä¸ªBrokerèŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º KRaft æ¨¡å¼çš„ broker èŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹ä¸‰ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ <code>server.properties</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ process.roles=broker</span></span><br><span class="line">process.roles=broker</span><br><span class="line"><span class="comment"># ç”¨ node.id æ›¿æ¢ broker.idï¼Œæ³¨æ„ï¼Œnode.id éœ€è¦ä¸ broker.id ä¸€è‡´</span></span><br><span class="line"><span class="comment"># broker.id=1</span></span><br><span class="line">node.id=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»æ‰ zookeeper ç›¸å…³é…ç½®</span></span><br><span class="line"><span class="comment"># Don&#x27;t set the IBP, KRaft uses &quot;metadata.version&quot; feature flag</span></span><br><span class="line"><span class="comment"># inter.broker.protocol.version=3.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove the migration enabled flag</span></span><br><span class="line"><span class="comment"># zookeeper.metadata.migration.enable=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove ZooKeeper client configuration</span></span><br><span class="line"><span class="comment"># zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«é‡æ–°å¯åŠ¨ä¸‰ä¸ªèŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­ kafka</span></span><br><span class="line">kafka-server-stop.sh</span><br><span class="line"><span class="comment"># è¿™é‡Œè¦æ³¨æ„ worker1 ä¸Šä¸è¦ä½¿ç”¨ kafka-server-stop.sh è¿›è¡Œå…³é—­ï¼Œå› ä¸º worker1 ä¸Šçš„ controller èŠ‚ç‚¹ ä¹Ÿåœ¨è¿è¡Œï¼Œä¼šæœ‰ä¸¤ä¸ª kafka è¿›ç¨‹è¿è¡Œï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå…³é—­ï¼›å› ä¸º controller èŠ‚ç‚¹ å¯åŠ¨ä½¿ç”¨çš„æ˜¯ controller.properties</span></span><br><span class="line">ps -ef | grep kafka | grep  <span class="string">&quot;server\.properties&quot;</span> | grep -v grep | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="built_in">kill</span> -9</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°å¯åŠ¨ kafka</span></span><br><span class="line">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure><h3 id="å°†-Controller-èŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º-KRaft-æ¨¡å¼çš„-controller-èŠ‚ç‚¹">å°† Controller èŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º KRaft æ¨¡å¼çš„ controller èŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹ controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ <code>controller.properties</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å»æ‰å»ä¸‹å†…å®¹</span></span><br><span class="line"><span class="comment"># æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹</span></span><br><span class="line"><span class="comment"># zookeeper.metadata.migration.enable=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ZooKeeper client è¿æ¥</span></span><br><span class="line"><span class="comment"># zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡å¯å¯åŠ¨ controller èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­åé‡æ–°å¯åŠ¨</span></span><br><span class="line">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶ä½ å¯ä»¥å…³é—­ zookeeper é›†ç¾¤äº†ï¼Œæ–°çš„ kafka é›†ç¾¤å°†ä¸å†ä½¿ç”¨ ZooKeeperï¼Œä¹Ÿæ— æ³•åœ¨æ¢å¤åˆ° ZooKeeper æ¨¡å¼ã€‚</p></li></ul><h3 id="åŠ å…¥æ–°çš„-Controller-èŠ‚ç‚¹">åŠ å…¥æ–°çš„ Controller èŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>Controller å°½é‡ä¿æŒ å¥‡æ•°ä¸ªèŠ‚ç‚¹ã€‚</p></li><li class="lvl-2"><p>ä¹‹å‰å·²ç»åœ¨ <code>worker1</code> èŠ‚ç‚¹ä¸Šå¯åŠ¨äº† controller ï¼Œç°åœ¨ <code>worker2</code> å’Œ <code>worker3</code> ä¸Šä¹Ÿæ¥å¯åŠ¨ controller èŠ‚ç‚¹ï¼Œå¹¶å°†å®ƒä»¬åŠ å…¥åˆ° kafka é›†ç¾¤ä¸­ã€‚</p></li><li class="lvl-2"><p>åœ¨å¼€å§‹é…ç½®å‰ï¼Œå…ˆå°†ä¸Šé¢çš„ controller èŠ‚ç‚¹ å’Œ ä¸‰ä¸ª broker èŠ‚ç‚¹ çš„å¦‚ä¸‹é…ç½®è¿›è¡Œä¿®æ”¹ï¼Œå¹¶é‡å¯å¯åŠ¨ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°† controller.quorum.bootstrap.servers æ›¿æ¢ä¸º controller.quorum.voters</span></span><br><span class="line">controller.quorum.voters=3000@worker1:9098,3001@worker2:9098,3002@worker3:9098</span><br><span class="line"><span class="comment"># controller.quorum.bootstrap.servers=worker1:9098</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># controller.quorum.voters = è°æ˜¯æ­£å¼æŠ•ç¥¨æˆå‘˜ï¼ˆå›ºå®šé…ç½®ï¼‰</span></span><br><span class="line"><span class="comment"># controller.quorum.bootstrap.servers = ä¸´æ—¶æ‰¾è°å¼•å¯¼è¿æ¥ï¼ˆè¿ç§»æˆ–åˆå§‹åŒ–ç”¨ï¼‰</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>é…ç½®é¡¹</th><th>ä½œç”¨</th><th>é€‚ç”¨é˜¶æ®µ</th><th>æ˜¯å¦å¿…éœ€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong><code>controller.quorum.voters</code></strong></td><td>å®šä¹‰ <strong>æ­£å¼çš„ KRaft æ§åˆ¶å™¨æŠ•ç¥¨æˆå‘˜åˆ—è¡¨ï¼ˆvoter setï¼‰</strong></td><td>é›†ç¾¤æ­£å¸¸è¿è¡Œæ—¶</td><td>âœ… æ˜¯</td><td>æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»é…ç½®ç›¸åŒçš„å€¼</td></tr><tr><td><strong><code>controller.quorum.bootstrap.servers</code></strong></td><td>å®šä¹‰ <strong>è¿ç§»é˜¶æ®µæˆ–åˆå§‹åŒ–é˜¶æ®µçš„æ§åˆ¶å™¨è¿æ¥åœ°å€ï¼ˆbootstrap controller endpointï¼‰</strong></td><td><strong>ZK â†’ KRaft è¿ç§»é˜¶æ®µ</strong> æˆ– <strong>KRaft é›†ç¾¤åˆæ¬¡å¯åŠ¨</strong></td><td>âš™ï¸ å¯é€‰ï¼ˆä»…ç‰¹å®šé˜¶æ®µï¼‰</td><td>ç”¨äºåœ¨ controller quorum å°šæœªå½¢æˆæ—¶çš„ä¸´æ—¶å‘ç°</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å‚è€ƒ worker1 ä¸Šçš„ controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ <code>controller.properties</code>ï¼Œé…ç½® woker2 çš„ controller èŠ‚ç‚¹é…ç½®æ–‡ä»¶<code>controller.properties</code> ï¼Œworker3 ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ï¼Œè¿™é‡Œåªèƒ½æ˜¯controller</span></span><br><span class="line">process.roles=controller</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹IDï¼Œä¸èƒ½ä¸ç°æœ‰BrokerèŠ‚ç‚¹çš„IDä¸€è‡´</span></span><br><span class="line">node.id=3001</span><br><span class="line"><span class="comment"># é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹</span></span><br><span class="line">controller.quorum.voters=3000@worker1:9098,3001@worker2:9098,3002@worker3:9098</span><br><span class="line"><span class="comment"># é…ç½®ç›‘å¬å™¨ï¼Œæ³¨æ„ç«¯å£ä¸èƒ½é‡å¤</span></span><br><span class="line">listeners=CONTROLLER://:9098</span><br><span class="line">advertised.listeners=CONTROLLER://worker2:9098</span><br><span class="line">controller.listener.names=CONTROLLER</span><br><span class="line"><span class="comment"># æ—¥å¿—å­˜æ”¾ç›®å½•ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯å…ƒæ•°æ®</span></span><br><span class="line">log.dirs=/usr/local/kafka/dataDir/kraft-meta</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®š Kafka é›†ç¾¤å†…éƒ¨ï¼ˆbroker ä¸ brokerã€KRaft æ§åˆ¶å™¨ä¸ brokerï¼‰é€šä¿¡æ‰€ä½¿ç”¨çš„ç›‘å¬å™¨ï¼ˆlistenerï¼‰åç§°ã€‚</span></span><br><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œè¦ä¸åŸå…ˆçš„ server.properties ä¸­é…ç½®çš„ç›‘å¬å™¨åç§°ä¸€è‡´</span></span><br><span class="line">inter.broker.listener.name=PLAINTEXT</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆå§‹åŒ–æ—¥å¿—ç›®å½•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªæœ‰ Controller èŠ‚ç‚¹æ‰éœ€è¦åˆå§‹åŒ–æ—¥å¿—ç›®å½•</span></span><br><span class="line"><span class="comment"># -t å‚æ•°æŒ‡å®šé›†ç¾¤çš„ Cluster IDï¼Œå°±æ˜¯å‰é¢è·å–çš„ Cluster ID</span></span><br><span class="line">kafka-storage.sh format -t hp_Q0pihQ0ORcIvXlfHobQ -c /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«å¯åŠ¨ worker2 å’Œ worker3 ä¸Šçš„ controller èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶æ–°çš„ controller èŠ‚ç‚¹ä¸ä¼šç«‹åˆ»åŠ å…¥é€‰ä¸¾é˜Ÿåˆ—ï¼Œæ–°èŠ‚ç‚¹åˆå§‹çŠ¶æ€é»˜è®¤æ˜¯ observerï¼Œéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†èŠ‚ç‚¹åŠ å…¥é€‰ä¸¾é˜Ÿåˆ—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†åˆ«åœ¨ worker2 å’Œ worker3 ä¸Šæ‰§è¡Œ</span></span><br><span class="line">kafka-metadata-quorum.sh --bootstrap-server localhost:9092 --command-config /usr/local/kafka/kafka3/config/kraft/controller.properties add-controller</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ kafka-metadata-quorum.sh --bootstrap-server worker1:9092 describe --replication</span><br><span class="line">NodeIdDirectoryId           LogEndOffsetLagLastFetchTimestampLastCaughtUpTimestampStatus</span><br><span class="line">3000  RJ4oOPGgTw-KxHFNn4SmiQ27820       0  1760696136345     1760696136345        Leader</span><br><span class="line">3001  zGnWA7zYmRHG6bcTlFV2qA27820       0  1760696136259     1760696136259        Follower</span><br><span class="line">3002  gIDkhOQJEHqg-GJBdezU1Q27820       0  1760696136257     1760696136257        Follower</span><br><span class="line">2     9KeeAYKEQHT92DxqNSwYuA27820       0  1760696136257     1760696136257        Observer</span><br><span class="line">1     Q8lr8JQ2vrDS35_DrI1MxA27820       0  1760696136257     1760696136257        Observer</span><br><span class="line">3     rgQR5wd_i5hLgU97dCKIvA27820       0  1760696136257     1760696136257        Observer</span><br><span class="line"></span><br><span class="line">$ kafka-metadata-quorum.sh --bootstrap-server worker1:9092 describe --status</span><br><span class="line">ClusterId:              hp_Q0pihQ0ORcIvXlfHobQ</span><br><span class="line">LeaderId:               3000</span><br><span class="line">LeaderEpoch:            5</span><br><span class="line">HighWatermark:          30094</span><br><span class="line">MaxFollowerLag:         0</span><br><span class="line">MaxFollowerLagTimeMs:   0</span><br><span class="line">CurrentVoters:          [&#123;<span class="string">&quot;id&quot;</span>: 3000, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;RJ4oOPGgTw-KxHFNn4SmiQ&quot;</span>, <span class="string">&quot;endpoints&quot;</span>: [<span class="string">&quot;CONTROLLER://worker1:9098&quot;</span>]&#125;, &#123;<span class="string">&quot;id&quot;</span>: 3001, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;zGnWA7zYmRHG6bcTlFV2qA&quot;</span>, <span class="string">&quot;endpoints&quot;</span>: [<span class="string">&quot;CONTROLLER://worker2:9098&quot;</span>]&#125;, &#123;<span class="string">&quot;id&quot;</span>: 3002, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;gIDkhOQJEHqg-GJBdezU1Q&quot;</span>, <span class="string">&quot;endpoints&quot;</span>: [<span class="string">&quot;CONTROLLER://worker3:9098&quot;</span>]&#125;]</span><br><span class="line">CurrentObservers:       [&#123;<span class="string">&quot;id&quot;</span>: 2, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;9KeeAYKEQHT92DxqNSwYuA&quot;</span>&#125;, &#123;<span class="string">&quot;id&quot;</span>: 1, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;Q8lr8JQ2vrDS35_DrI1MxA&quot;</span>&#125;, &#123;<span class="string">&quot;id&quot;</span>: 3, <span class="string">&quot;directoryId&quot;</span>: <span class="string">&quot;rgQR5wd_i5hLgU97dCKIvA&quot;</span>&#125;]</span><br></pre></td></tr></table></figure><h3 id="åŠ å…¥-æ–°çš„-Broker-èŠ‚ç‚¹">åŠ å…¥ æ–°çš„ Broker èŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºæ–°çš„ Broker èŠ‚ç‚¹æ—¶ï¼Œå‚è€ƒå…¶å®ƒ Broker èŠ‚ç‚¹ é…ç½®å¥½é…ç½®æ–‡ä»¶ <code>server.properties</code>ï¼Œå¹¶å¯åŠ¨ Broker èŠ‚ç‚¹å³å¯ã€‚</p></li><li class="lvl-2"><p>æ— éœ€è¿è¡Œæ—¥å¿—ç›®å½•åˆå§‹åŒ–å‘½ä»¤ï¼Œå› ä¸º Broker èŠ‚ç‚¹åªå­˜æ”¾ æ¶ˆæ¯ æ•°æ®ã€‚</p></li></ul><h2 id="è¿ç§»åæ³¨æ„äº‹é¡¹">è¿ç§»åæ³¨æ„äº‹é¡¹</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿ç§»å®Œæˆåï¼ŒKafka å®¢æˆ·ç«¯ï¼ˆProducer / Consumer / AdminClientï¼‰ä¾ç„¶è¿æ¥çš„æ˜¯ Broker èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ Controller èŠ‚ç‚¹ã€‚</p></li><li class="lvl-2"><p>Kafka åœ¨ ZooKeeper æ¨¡å¼ä¸ KRaft æ¨¡å¼ä¸‹çš„åŒºåˆ«ä¸»è¦åœ¨äºï¼š</p><ul class="lvl-2"><li class="lvl-4">æ§åˆ¶å¹³é¢ï¼ˆControl Planeï¼‰ï¼šZK æ¨¡å¼ä¸‹ç”± ZooKeeper + Controller Broker å…±åŒç®¡ç†ï¼›KRaft æ¨¡å¼ä¸‹ç”± ç‹¬ç«‹çš„ Controller è¿›ç¨‹æˆ–è§’è‰² ç®¡ç†ï¼ˆé€šè¿‡ Raft åè®®åŒæ­¥å…ƒæ•°æ®ï¼‰ã€‚</li><li class="lvl-4">æ•°æ®å¹³é¢ï¼ˆData Planeï¼‰ï¼šæ— è®ºæ˜¯å“ªä¸ªæ¨¡å¼ï¼Œå®¢æˆ·ç«¯å‘é€ã€æ¶ˆè´¹æ¶ˆæ¯ä»ç„¶æ˜¯é€šè¿‡ Broker èŠ‚ç‚¹ å®Œæˆçš„ã€‚</li><li class="lvl-4">ä¹Ÿå°±æ˜¯è¯´ï¼ŒController ç®¡ç†é›†ç¾¤å…ƒæ•°æ®ï¼ˆä¸»é¢˜ã€åˆ†åŒºã€å‰¯æœ¬ã€Leader é€‰ä¸¾ç­‰ï¼‰ï¼Œè€Œ Broker èŠ‚ç‚¹å¤„ç†å®é™…çš„æ¶ˆæ¯æµã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» å¦‚ä½•å°† Kafka é›†ç¾¤ä» Zookeeper æ¨¡å¼è¿ç§»åˆ° KRaft æ¨¡å¼&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org&quot;&gt;Kafkaå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org/39/documentation.html#kraft_zk_migration&quot;&gt;å®˜æ–¹æ–‡æ¡£ï¼šZooKeeperåˆ°KRaftè¿ç§»&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafka çš„å®‰è£…ï¼šåŸºäº KRaft æ¨¡å¼</title>
    <link href="https://blog.hanqunfeng.com/2025/10/16/kafka-05-install-kraft/"/>
    <id>https://blog.hanqunfeng.com/2025/10/16/kafka-05-install-kraft/</id>
    <published>2025-10-16T13:30:05.000Z</published>
    <updated>2025-10-19T02:48:43.911Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº KRaft æ¨¡å¼ã€‚</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org">Kafkaå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p></li><li class="lvl-2"><p>æœ¬æ–‡çš„å®‰è£…æ–¹æ³•åŒæ ·é€‚ç”¨äº Kafka 4.x ç‰ˆæœ¬ï¼Œåªä¸è¿‡ Kafka 4.x ä¸­å·²ç»ä¸å†åŒ…å« ZooKeeper ç›¸å…³çš„é…ç½®æ–‡ä»¶ä»¥åŠç›¸å…³çš„å‘½ä»¤ï¼Œå¦å¤–è¦æ±‚JDK17+ã€‚</p></li></ul><span id="more"></span><h2 id="KRaft-ç®€ä»‹">KRaft ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Kraft æ˜¯ Kafka ä» 2.8.0 ç‰ˆæœ¬ å¼€å§‹â½€æŒçš„â¼€ç§æ–°çš„é›†ç¾¤æ¶æ„â½…å¼ã€‚å…¶â½¬çš„ä¸»è¦æ˜¯ä¸ºäº†æ‘†è„±Kafkaå¯¹Zookeeperçš„ä¾èµ–ã€‚å› ä¸ºä»¥å¾€åŸºäºZookeeperæ­å»ºçš„é›†ç¾¤ï¼Œå¢åŠ äº†Kafkaæ¼”è¿›ä¸è¿ç»´çš„éš¾åº¦ï¼Œé€æ¸å¼€å§‹æˆä¸ºKakfaæ‹¥æŠ±äº‘åŸâ½£çš„â¼€ç§éšœç¢ã€‚ä½¿â½¤Krafté›†ç¾¤åï¼ŒKafkaé›†ç¾¤å°±ä¸å†éœ€è¦ä¾èµ–Zookeeperï¼Œå°†ä¹‹å‰åŸºäºZookeeperç®¡ç†çš„é›†ç¾¤æ•°æ®ï¼Œè½¬ä¸ºç”±Kafkaé›†ç¾¤â¾ƒâ¼°ç®¡ç†ã€‚</p></li><li class="lvl-2"><p>ä¼ ç»Ÿçš„Kafkaé›†ç¾¤ï¼Œä¼šå°†æ¯ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ç»Ÿä¸€ä¿å­˜åœ¨Zookeeperä¸­ï¼Œå¹¶é€šè¿‡ZookeeperåŠ¨æ€é€‰ä¸¾äº§ç”Ÿä¸€ä¸ªControllerèŠ‚ç‚¹ï¼Œé€šè¿‡ControllerèŠ‚ç‚¹æ¥ç®¡ç†Kafkaé›†ç¾¤ï¼Œæ¯”å¦‚è§¦å‘Partitionçš„é€‰ä¸¾ã€‚è€Œåœ¨Krafté›†ç¾¤ä¸­ï¼Œä¼šå›ºå®šé…ç½®å‡ å°BrokerèŠ‚ç‚¹æ¥å…±åŒæ‹…ä»»Controllerçš„è§’è‰²ï¼Œå„ç»„Partitionçš„LeaderèŠ‚ç‚¹å°±ä¼šç”±è¿™äº›Controlleré€‰ä¸¾äº§ç”Ÿã€‚åŸæœ¬ä¿å­˜åœ¨Zookeeperä¸­çš„å…ƒæ•°æ®ä¹Ÿè½¬è€Œä¿å­˜åˆ°ControllerèŠ‚ç‚¹ä¸­ã€‚</p></li><li class="lvl-2"><p>ğŸ§­ Kafka KRaft æ¨¡å¼ vs Zookeeper æ¨¡å¼ å¯¹æ¯”è¡¨</p></li></ul><table><thead><tr><th style="text-align:left">å¯¹æ¯”é¡¹</th><th style="text-align:left"><strong>KRaft æ¨¡å¼ï¼ˆKafka Raft æ¨¡å¼ï¼‰</strong></th><th style="text-align:left"><strong>Zookeeper æ¨¡å¼ï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰</strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong>æ¶æ„ç»“æ„</strong></td><td style="text-align:left">å»ä¸­å¿ƒåŒ–æ¶æ„ï¼ŒKafka è‡ªèº«å†…ç½®æ§åˆ¶å¹³é¢ï¼Œä¸ä¾èµ–å¤–éƒ¨ Zookeeperã€‚</td><td style="text-align:left">æ§åˆ¶å¹³é¢ä¾èµ–å¤–éƒ¨ Zookeeper é›†ç¾¤ï¼ŒKafka Broker åªè´Ÿè´£æ•°æ®å¹³é¢ã€‚</td></tr><tr><td style="text-align:left"><strong>ç»„ä»¶æ•°é‡</strong></td><td style="text-align:left">æ— éœ€éƒ¨ç½² Zookeeperï¼Œåªæœ‰ Kafka Broker èŠ‚ç‚¹ã€‚</td><td style="text-align:left">éœ€è¦å•ç‹¬ç»´æŠ¤ Zookeeper é›†ç¾¤ã€‚</td></tr><tr><td style="text-align:left"><strong>å…ƒæ•°æ®å­˜å‚¨</strong></td><td style="text-align:left">å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka è‡ªèº«çš„å†…ç½®æ—¥å¿—ä¸­ï¼ˆ<code>__cluster_metadata</code> topicï¼‰ã€‚</td><td style="text-align:left">å…ƒæ•°æ®å­˜å‚¨åœ¨ Zookeeper çš„ znode æ ‘ç»“æ„ä¸­ã€‚</td></tr><tr><td style="text-align:left"><strong>ä¸€è‡´æ€§åè®®</strong></td><td style="text-align:left">ä½¿ç”¨ Kafka è‡ªå·±å®ç°çš„ Raft åè®®ï¼ˆKRaftï¼‰æ¥ä¿è¯å…ƒæ•°æ®ä¸€è‡´æ€§ã€‚</td><td style="text-align:left">ä½¿ç”¨ ZABï¼ˆZookeeper Atomic Broadcastï¼‰åè®®ä¿è¯ä¸€è‡´æ€§ã€‚</td></tr><tr><td style="text-align:left"><strong>å¯åŠ¨é€Ÿåº¦</strong></td><td style="text-align:left">æ›´å¿«ï¼Œæ§åˆ¶å™¨å†…åµŒäº Broker ä¸­ï¼Œä¸éœ€è¦ç­‰å¾…å¤–éƒ¨ Zookeeper å¯åŠ¨ã€‚</td><td style="text-align:left">å¯åŠ¨ä¾èµ– Zookeeperï¼Œå¯åŠ¨é¡ºåºå’Œè¿é€šæ€§è¦æ±‚æ›´ä¸¥æ ¼ã€‚</td></tr><tr><td style="text-align:left"><strong>å®¹é”™æ€§</strong></td><td style="text-align:left">Raft æ§åˆ¶å™¨å…·å¤‡æ—¥å¿—å¤åˆ¶æœºåˆ¶ï¼Œå®¹é”™æ€§ä¸ Kafka æ•°æ®å‰¯æœ¬ä¸€è‡´ã€‚</td><td style="text-align:left">å®¹é”™æ€§ç”± Zookeeper å†³å®šï¼ŒZookeeper æŒ‚æ‰å¯èƒ½å¯¼è‡´ Kafka æ§åˆ¶é¢ä¸å¯ç”¨ã€‚</td></tr><tr><td style="text-align:left"><strong>æ‰©å±•æ€§</strong></td><td style="text-align:left">å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka ä¸»é¢˜ä¸­ï¼Œæ°´å¹³æ‰©å±•èƒ½åŠ›æ›´å¼ºã€‚</td><td style="text-align:left">Zookeeper åœ¨é«˜åˆ†åŒºæ•°åœºæ™¯ä¸‹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</td></tr><tr><td style="text-align:left"><strong>è¿ç»´å¤æ‚åº¦</strong></td><td style="text-align:left">æ— éœ€ç»´æŠ¤ Zookeeper é›†ç¾¤ï¼Œç»Ÿä¸€è¿ç»´ Kafka å³å¯ã€‚</td><td style="text-align:left">éœ€è¦é¢å¤–ç»´æŠ¤ Zookeeper é›†ç¾¤ï¼ˆç›‘æ§ã€æ‰©å®¹ã€å‡çº§ï¼‰ã€‚</td></tr><tr><td style="text-align:left"><strong>æ•°æ®æ¢å¤</strong></td><td style="text-align:left">å…ƒæ•°æ®æ¢å¤ä¸ Kafka ä¸»é¢˜ä¸€è‡´ï¼Œå¯é€šè¿‡æ—¥å¿—å›æ”¾æ¢å¤ã€‚</td><td style="text-align:left">Zookeeper æ•°æ®æ¢å¤ç›¸å¯¹å¤æ‚ï¼Œä¾èµ–å¿«ç…§å’Œäº‹åŠ¡æ—¥å¿—ã€‚</td></tr><tr><td style="text-align:left"><strong>å®‰å…¨æœºåˆ¶</strong></td><td style="text-align:left">ç»Ÿä¸€ Kafka çš„å®‰å…¨æœºåˆ¶ï¼ˆSASLã€SSLã€ACL ç­‰ï¼‰ã€‚</td><td style="text-align:left">Zookeeper æœ‰ç‹¬ç«‹çš„å®‰å…¨é…ç½®ä½“ç³»ï¼Œéœ€å•ç‹¬ç®¡ç†ã€‚</td></tr><tr><td style="text-align:left"><strong>æ€§èƒ½è¡¨ç°</strong></td><td style="text-align:left">å…ƒæ•°æ®æ“ä½œå»¶è¿Ÿæ›´ä½ï¼ˆæ§åˆ¶å™¨ä¸ Broker æœ¬åœ°é€šä¿¡ï¼‰ã€‚</td><td style="text-align:left">å…ƒæ•°æ®æ“ä½œéœ€è¦è·¨è¿›ç¨‹ç½‘ç»œé€šä¿¡ï¼Œå»¶è¿Ÿæ›´é«˜ã€‚</td></tr><tr><td style="text-align:left"><strong>æ§åˆ¶å™¨è§’è‰²</strong></td><td style="text-align:left">ç”± Broker ä¸­çš„æ§åˆ¶å™¨ quorum é€‰ä¸¾äº§ç”Ÿï¼ˆæ”¯æŒå¤šæ§åˆ¶å™¨å€™é€‰ï¼‰ã€‚</td><td style="text-align:left">ç”± Zookeeper é€‰ä¸¾æ§åˆ¶å™¨ï¼ˆå•ç‚¹æ§åˆ¶å™¨ï¼‰ã€‚</td></tr><tr><td style="text-align:left"><strong>åˆ†åŒºä¸å‰¯æœ¬ç®¡ç†</strong></td><td style="text-align:left">å…¨éƒ¨å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka è‡ªèº«ï¼Œå¯å®ç°æ›´å¿«çš„åˆ†åŒºå˜æ›´å’Œæ‰©å®¹ã€‚</td><td style="text-align:left">åˆ†åŒºã€å‰¯æœ¬å…ƒæ•°æ®åŒæ­¥ä¾èµ– Zookeeperï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒä½ã€‚</td></tr><tr><td style="text-align:left"><strong>ç‰ˆæœ¬æ”¯æŒ</strong></td><td style="text-align:left">ä» Kafka 2.8 å¼€å§‹å¼•å…¥ï¼ŒKafka 3.3+ å·²ç»éå¸¸ç¨³å®šï¼ŒKafka 3.5+ é»˜è®¤æ¨èã€‚</td><td style="text-align:left">Kafka 3.5 å¼€å§‹æ ‡è®°ä¸ºâ€œLegacyâ€ï¼Œæœªæ¥ç‰ˆæœ¬è®¡åˆ’ç§»é™¤æ”¯æŒã€‚</td></tr><tr><td style="text-align:left"><strong>å…¼å®¹æ€§</strong></td><td style="text-align:left">å¯é€šè¿‡å…ƒæ•°æ®è¿ç§»å·¥å…·ä» Zookeeper æ¨¡å¼å¹³æ»‘è¿ç§»ã€‚</td><td style="text-align:left">ä¸èƒ½ç›´æ¥è¿ç§»åˆ° KRaftï¼Œéœ€è¦å·¥å…·è¾…åŠ©ã€‚</td></tr><tr><td style="text-align:left"><strong>è¿ç»´ç›‘æ§</strong></td><td style="text-align:left">å•ä¸€ç³»ç»Ÿå¯ç›‘æ§ï¼ˆKafka è‡ªå¸¦çš„ JMXã€Prometheus ç­‰ï¼‰ã€‚</td><td style="text-align:left">Kafka ä¸ Zookeeper å„è‡ªéœ€è¦ç‹¬ç«‹ç›‘æ§ä½“ç³»ã€‚</td></tr><tr><td style="text-align:left"><strong>æœªæ¥å‘å±•æ–¹å‘</strong></td><td style="text-align:left">å®˜æ–¹æ¨èå’Œé»˜è®¤æ¨¡å¼ï¼ˆZookeeper æ¨¡å¼å°†é€æ­¥æ·˜æ±°ï¼‰ã€‚</td><td style="text-align:left">å®˜æ–¹å·²ä¸å†å»ºè®®æ–°é›†ç¾¤ä½¿ç”¨ã€‚</td></tr></tbody></table><h2 id="Kafka-çš„-KRaft-é›†ç¾¤é…ç½®">Kafka çš„ KRaft é›†ç¾¤é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨Kafkaçš„configç›®å½•ä¸‹ï¼Œæä¾›äº†ä¸€ä¸ªkraftçš„æ–‡ä»¶å¤¹ï¼Œåœ¨è¿™é‡Œé¢æä¾›äº†ä¸‰ä¸ªKraftåè®®çš„å‚è€ƒé…ç½®æ–‡ä»¶</p><ul class="lvl-2"><li class="lvl-4">broker.properties: æ•°æ®èŠ‚ç‚¹ï¼Œclientè¿æ¥æ—¶åªè¿æ¥brokeræ•°æ®èŠ‚ç‚¹</li><li class="lvl-4">controller.properties: Controlleræ§åˆ¶èŠ‚ç‚¹</li><li class="lvl-4">server.properties: å³å¯ä»¥æ˜¯æ•°æ®èŠ‚ç‚¹ï¼Œåˆå¯ä»¥æ˜¯Controlleræ§åˆ¶èŠ‚ç‚¹ã€‚</li></ul></li><li class="lvl-2"><p>å®é™…ä¸Šè¿™äº›é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹åŸºæœ¬ä¸ serrver.properties ä¸€è‡´ï¼Œåªæ˜¯å»é™¤äº†ä¸ zookeeper ç›¸å…³çš„é…ç½®é¡¹ï¼ŒåŒæ—¶å¢åŠ äº†ä¸€äº› Kraft æ¨¡å¼ä¸‹çš„é…ç½®é¡¹ã€‚å…³äº server.properties çš„é…ç½®é¡¹ï¼Œè¯·å‚è€ƒ <a href="https://kafka.apache.org/39/documentation/#brokerconfigs">Kafka å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p>è¿™é‡Œä»¥ <code>kraft/serrver.properties</code> ä¸ºä¾‹è¿›è¡Œä¿®æ”¹ï¼Œé…ç½®ä¸‰ä¸ªèŠ‚ç‚¹çš„Kafkaé›†ç¾¤ï¼Œæ¯ä¸ªèŠ‚ç‚¹å³æ˜¯ controller èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯ broker èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹é¢è¿™å››ä¸ªé…ç½®é¡¹æ˜¯ kraft æ¨¡å¼ä¸‹æ–°å¢åŠ çš„</span></span><br><span class="line"><span class="comment"># é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ã€‚Controllerç›¸å½“äºZookeeperçš„åŠŸèƒ½ï¼Œè´Ÿè´£é›†ç¾¤ç®¡ç†ã€‚Brokeræä¾›å…·ä½“çš„æ¶ˆæ¯è½¬å‘æœåŠ¡ã€‚</span></span><br><span class="line"><span class="comment"># ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å³æ˜¯ Controller åˆæ˜¯ Brokerï¼Œä¹Ÿå¯ä»¥åªæ˜¯ Controller æˆ– Brokerã€‚</span></span><br><span class="line">process.roles=broker,controller</span><br><span class="line"><span class="comment"># é…ç½®å½“å‰èŠ‚ç‚¹çš„idã€‚ä¸æ™®é€šé›†ç¾¤ä¸€æ ·ï¼Œè¦æ±‚é›†ç¾¤å†…æ¯ä¸ªèŠ‚ç‚¹çš„IDä¸èƒ½é‡å¤ã€‚</span></span><br><span class="line">node.id=1</span><br><span class="line"><span class="comment"># é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹ã€‚å…¶ä¸­@å‰é¢çš„æ˜¯èŠ‚ç‚¹çš„idï¼Œåé¢æ˜¯èŠ‚ç‚¹çš„åœ°å€å’Œç«¯å£ï¼Œè¿™ä¸ªç«¯å£è·Ÿå®¢æˆ·ç«¯è®¿é—®çš„ç«¯å£æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¦ä¸ CONTROLLER åè®®å¯¹åº”çš„ç«¯å£ä¸€è‡´ï¼Œè¿™é‡Œé…ç½®ä¸º 9098</span></span><br><span class="line"><span class="comment"># é€šå¸¸å°†é›†ç¾¤å†…çš„æ‰€æœ‰ControllorèŠ‚ç‚¹éƒ½é…ç½®è¿›å»ã€‚</span></span><br><span class="line">controller.quorum.voters=1@worker1:9098,2@worker2:9098,3@worker3:9098</span><br><span class="line"><span class="comment"># ControlleræœåŠ¡åè®®çš„åˆ«åã€‚é»˜è®¤å°±æ˜¯CONTROLLER</span></span><br><span class="line">controller.listener.names=CONTROLLER</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹é…ç½®é¡¹ä¸ä¹‹å‰ä¸€æ ·ï¼ŒæŒ‰éœ€è¿›è¡Œé…ç½®å³å¯</span></span><br><span class="line"><span class="comment"># é›†ç¾¤é—´é€šä¿¡ä»ä½¿ç”¨å†…ç½‘</span></span><br><span class="line">inter.broker.listener.name=PLAINTEXT</span><br><span class="line"><span class="comment"># é…ç½®ç›‘å¬æœåŠ¡ã€‚ä¸åŒçš„æœåŠ¡å¯ä»¥ç»‘å®šä¸åŒçš„æ¥å£ã€‚è¿™ç§é…ç½®æ–¹å¼åœ¨ç«¯å£å‰é¢æ˜¯çœç•¥äº†ä¸€ä¸ªä¸»æœºIPçš„ï¼Œä¸»æœºIPé»˜è®¤æ˜¯ä½¿ç”¨çš„java.net.InetAddress.getCanonicalHostName()ï¼Œè¿™é‡ŒåŒæ—¶å¼€å¯å¤–ç½‘è®¿é—®ï¼Œå…³äº sasl_plaintext ã€sasl_sslåè®® çš„é…ç½®æ–¹å¼å‚è€ƒå‰æ–‡ kafka é€šä¿¡åè®®</span></span><br><span class="line">listeners=PLAINTEXT://:9092,CONTROLLER://:9098,EXTERNAL://0.0.0.0:9093</span><br><span class="line"><span class="comment"># Brokerå¯¹å®¢æˆ·ç«¯æš´éœ²çš„æœåŠ¡åœ°å€ã€‚åŸºäºPLAINTEXTåè®®ã€‚è¿™é‡Œè¦æ›¿æ¢ä¸ºå„ä¸ªèŠ‚ç‚¹çš„IPåœ°å€</span></span><br><span class="line">advertised.listeners=PLAINTEXT://worker1:9092,CONTROLLER://worker1:9098,EXTERNAL://161.189.227.200:9093</span><br><span class="line"><span class="comment"># å°†ç›‘å¬å™¨åç§°æ˜ å°„åˆ°å®‰å…¨åè®®ç±»å‹ï¼Œè¿™é‡Œ CONTROLLER åè®®å¯¹åº”çš„å®‰å…¨åè®®ç±»å‹ä¸º PLAINTEXT</span></span><br><span class="line">listener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL,EXTERNAL:PLAINTEXT</span><br><span class="line"><span class="comment"># æ•°æ®æ–‡ä»¶åœ°å€ã€‚é»˜è®¤é…ç½®åœ¨/tmpç›®å½•ä¸‹ã€‚</span></span><br><span class="line">log.dirs=/usr/local/kafka/dataDir/kraft-logs</span><br><span class="line"><span class="comment"># topicé»˜è®¤çš„partitionåˆ†åŒºæ•°ã€‚</span></span><br><span class="line">num.partitions=2</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨Kafkaé›†ç¾¤">å¯åŠ¨Kafkaé›†ç¾¤</h2><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨å‰è¦å¯¹æ—¥å¿—ç›®å½•è¿›è¡Œæ ¼å¼åŒ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨worker1èŠ‚ç‚¹ä¸Šç”Ÿæˆé›†ç¾¤ID</span></span><br><span class="line">$ kafka-storage.sh random-uuid</span><br><span class="line">oGwJsVANRDKYwE7Lhn2zIA</span><br><span class="line"><span class="comment"># ç„¶ååœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ ¼å¼åŒ–æ—¥å¿—ç›®å½•ï¼Œæ³¨æ„ --cluster-id å¿…é¡»ä¸€è‡´</span></span><br><span class="line"><span class="comment"># å¿…é¡»åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨å‰æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># ä¸å¯ä»¥é‡å¤æ‰§è¡Œï¼Œå¦åˆ™ä¼šæ¸…ç©ºæ•°æ®ç›®å½•å¹¶ç ´åå·²æœ‰å…ƒæ•°æ®</span></span><br><span class="line"><span class="comment"># åƒä¸‡ä¸è¦åœ¨å·²æœ‰ broker çš„æ•°æ®ç›®å½•ï¼ˆåŒ…å«æ¶ˆæ¯æ•°æ®çš„ log.dirsï¼‰ä¸Šè¿è¡Œ kafka-storage.sh format ï¼Œé‚£ä¼šæŠŠåŸæœ‰æ•°æ®ç»“æ„é‡ç½®æˆ–è¸©åã€‚</span></span><br><span class="line"><span class="comment"># å¿…é¡»æ˜ç¡®ï¼šæ ¼å¼åŒ–åªé’ˆå¯¹ æ–° controller çš„ metadata ç›®å½•ï¼ˆä¸”è¯¥ç›®å½•å¿…é¡»ä¸ºç©ºï¼‰ã€‚</span></span><br><span class="line">$ kafka-storage.sh format --cluster-id oGwJsVANRDKYwE7Lhn2zIA --config /usr/local/kafka/kafka3/config/kraft/server.properties</span><br><span class="line"><span class="comment">## æ ¼å¼åŒ–åä¼šåœ¨æ—¥å¿—ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># bootstrap.checkpoint # å­˜å‚¨å…ƒæ•°æ®æ—¥å¿—ï¼ˆMetadata Logï¼‰å¯¹åº”çš„åˆå§‹å¿«ç…§åç§»é‡ï¼ˆsnapshot offsetï¼‰ã€‚ç”¨äºæ§åˆ¶å™¨åœ¨å¯åŠ¨æ—¶æ¢å¤çŠ¶æ€çš„èµ·ç‚¹ã€‚</span></span><br><span class="line"><span class="comment"># meta.properties # å­˜å‚¨èŠ‚ç‚¹å…ƒä¿¡æ¯ï¼šcluster.idã€node.idã€version ç­‰</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨é›†ç¾¤ï¼Œæ‰€ä»¥èŠ‚ç‚¹å¯åŠ¨ kafka æœåŠ¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/server.properties</span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2><ul class="lvl-0"><li class="lvl-2"><p>Kafka é›†ç¾¤çš„å¯åŠ¨é¡ºåºä¸èƒ½ä¹±ï¼Œå¿…é¡»å…ˆå¯åŠ¨ Controller èŠ‚ç‚¹ï¼Œå†å¯åŠ¨ Broker èŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¿™é‡Œæ˜¯å°†èŠ‚ç‚¹åŒæ—¶åšä¸ºController å’Œ Broker ï¼Œå®é™…ç”Ÿäº§ç¯å¢ƒå»ºè®®åˆ†å¼€ã€‚</p></li><li class="lvl-2"><p>Controller èŠ‚ç‚¹è‡³å°‘3ä¸ªï¼Œå»ºè®®é…ç½®ä¸ºå¥‡æ•°ä¸ªã€‚Broker èŠ‚ç‚¹æ•°é‡ä»»æ„ï¼Œä½†å»ºè®®è‡³å°‘2ä¸ªä»¥ä¸Šï¼Œä»¥ä¿è¯åˆ†åŒºçš„å¤‡ä»½å¯ä»¥åˆ†å¼€å­˜å‚¨ã€‚</p></li><li class="lvl-2"><p>Client ä»…èƒ½ä¸ Broker èŠ‚ç‚¹é€šä¿¡ï¼Œä¸èƒ½ä¸ Controller èŠ‚ç‚¹é€šä¿¡ã€‚</p></li></ul><h2 id="Kafka-4-0-çš„æ–°ç‰¹æ€§">Kafka 4.0 çš„æ–°ç‰¹æ€§</h2><ul class="lvl-0"><li class="lvl-2"><p>å½»åº•ä»¥ KRaftï¼ˆKafka Raftï¼‰å–ä»£ ZooKeeperï¼ˆKRaft æˆä¸ºé»˜è®¤ä¸”å”¯ä¸€çš„å…ƒæ•°æ®ç®¡ç†ï¼‰</p><ul class="lvl-2"><li class="lvl-4">è¯´æ˜ï¼š4.x ç³»åˆ—æ ‡å¿—æ€§å˜åŒ–æ˜¯å®Œå…¨ç§»é™¤ ZooKeeperï¼Œå…ƒæ•°æ®ç”± KRaft ç®¡ç†ï¼ˆController ä¸ Broker æ›´ç´§å¯†é›†æˆï¼‰ã€‚å¯¹è¿ç»´è€Œè¨€ï¼šä¸å†éƒ¨ç½²/ç»´æŠ¤ ZooKeeper é›†ç¾¤ã€å…ƒæ•°æ®è¿ç§»/æ ¼å¼åŒ–æ­¥éª¤æ˜¯å‡çº§æ—¶çš„å…³é”®ã€‚</li><li class="lvl-4">å½±å“/æç¤ºï¼šå¿…é¡»æŒ‰å®˜æ–¹è¿ç§»æµç¨‹æŠŠå…ƒæ•°æ®ä» ZK å¯¼å…¥ KRaftï¼ˆè‹¥ä»æ—§ç‰ˆæœ¬å‡çº§ï¼‰ã€‚æµ‹è¯•è¿ç§»/å¤‡ä»½å…ƒæ•°æ®æ˜¯å¿…é¡»é¡¹ã€‚</li></ul></li><li class="lvl-2"><p>æ–°çš„ consumer-group åè®®ï¼ˆæ›´é«˜æ•ˆçš„ rebalance/ç¾¤ç»„ç®¡ç†ï¼‰ä¸æ¶ˆè´¹æ¨¡å‹æ”¹è¿›ï¼ˆåŒ…æ‹¬â€œQueues/Shared Groupâ€æ”¯æŒï¼‰</p><ul class="lvl-2"><li class="lvl-4">è¯´æ˜ï¼šå¼•å…¥/ç¨³å®šäº†æ–°çš„ Consumer Group åè®®ï¼ˆç›¸å…³ KIPï¼‰ï¼Œæ˜¾è‘—æ”¹å–„å¤§ç¾¤ç»„ä¸‹çš„é‡å¹³è¡¡å»¶è¿Ÿä¸ç¨³å®šæ€§ï¼›åŒæ—¶å¼•å…¥äº†ç±»ä¼¼â€œé˜Ÿåˆ—/å…±äº«ç»„ï¼ˆQueues for Kafkaï¼‰â€çš„æ¶ˆè´¹æ¨¡å¼ï¼ˆç”¨ä¾‹ï¼šç‚¹å¯¹ç‚¹æ¶ˆè´¹ï¼‰ï¼Œå…è®¸å¤šæ¶ˆè´¹è€…åŒæ—¶å¤„ç†åŒä¸€åˆ†åŒºæ¶ˆæ¯ã€‚</li><li class="lvl-4">å½±å“/æç¤ºï¼šå¦‚æœä½ æœ‰å¤§è§„æ¨¡æ¶ˆè´¹è€…ç¾¤ç»„æˆ–ä¾èµ–æ—§ rebalance è¡Œä¸ºï¼Œéœ€è¦æµ‹è¯•æ–°åè®®è¡Œä¸ºï¼›æŸäº›å®¢æˆ·ç«¯é…ç½®/è¡Œä¸ºå¯èƒ½éœ€è¦è°ƒæ•´ã€‚</li></ul></li></ul><table><thead><tr><th>æŒ‡æ ‡ç±»åˆ«</th><th>æ—§åè®®ï¼ˆEager Rebalanceï¼‰</th><th>æ–°åè®®ï¼ˆIncremental / Cooperative Rebalanceï¼‰</th></tr></thead><tbody><tr><td>é‡å¹³è¡¡å»¶è¿Ÿï¼ˆå¤§è§„æ¨¡ç¾¤ç»„ï¼‰</td><td>çº¦ <strong>60 ç§’</strong>ï¼ˆä¸‡çº§æ¶ˆè´¹è€…è§„æ¨¡ï¼‰</td><td>å°äº <strong>1 ç§’</strong>ï¼ˆæµ‹è¯•æ˜¾ç¤ºåœ¨åƒçº§ä»»åŠ¡æ—¶å¯åœ¨ä¸€åˆ†é’Ÿå†…å®Œæˆï¼‰ (<a href="https://www.confluent.io/blog/incremental-cooperative-rebalancing-in-kafka/?utm_source=chatgpt.com" title="Incremental Cooperative Rebalancing in Apache Kafka">Confluent</a>)</td></tr><tr><td>èµ„æºæ¶ˆè€—ï¼ˆCPUï¼‰</td><td>è¾ƒé«˜ï¼ˆåœ¨é‡å¹³è¡¡æœŸé—´ç³»ç»Ÿåœæ­¢æˆ–å¤§è§„æ¨¡è¿ç§»èµ„æºï¼‰</td><td>æ®ç§°å¯é™ä½çº¦ <strong>70%</strong> çš„ CPUï¼ç³»ç»Ÿä¸­æ–­è´Ÿè·ï¼ˆç¤¾åŒºç»éªŒï¼‰</td></tr><tr><td>æ¶ˆè´¹è€…ç¾¤ç»„æ‰©å±•ä¸Šé™</td><td>é€‚ç”¨äºâ€œåƒçº§æ¶ˆè´¹è€…â€è§„æ¨¡</td><td>å¯æ‰©å±•è‡³â€œåä¸‡çº§æ¶ˆè´¹è€…â€è§„æ¨¡ï¼ˆç†è®º/ç¤¾åŒºå®£ç§°ï¼‰</td></tr></tbody></table><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>ä¼ ç»Ÿæ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰</strong></th><th><strong>å…±äº«ç»„ï¼ˆShared Group / Queues for Kafkaï¼‰</strong></th></tr></thead><tbody><tr><td><strong>å¹¶è¡Œæ¶ˆè´¹æ¨¡å‹</strong></td><td>åˆ†åŒºæ•° = æ¶ˆè´¹è€…æ•°ï¼ˆä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼‰</td><td>æ¶ˆè´¹è€…æ•° &gt; åˆ†åŒºæ•°ï¼ˆåŒä¸€åˆ†åŒºå¯ç”±å¤šä¸ªæ¶ˆè´¹è€…å¹¶è¡Œå¤„ç†ï¼‰</td></tr><tr><td><strong>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</strong></td><td>é€šè¿‡æäº¤åç§»é‡ï¼ˆOffset Commitï¼‰å®ç°ç¡®è®¤</td><td>æ¯æ¡æ¶ˆæ¯å•ç‹¬ç¡®è®¤ï¼ˆACK/NACK æœºåˆ¶ï¼‰</td></tr><tr><td><strong>æŠ•é€’è¯­ä¹‰</strong></td><td><strong>At-Least-Once</strong>ï¼ˆè‡³å°‘ä¸€æ¬¡æŠ•é€’ï¼‰</td><td><strong>Exactly-Onceï¼ˆå¯é€‰ï¼‰</strong>ï¼Œæ”¯æŒç²¾ç¡®ä¸€æ¬¡å¤„ç†</td></tr><tr><td><strong>å…¸å‹åœºæ™¯</strong></td><td>æµå¼æ—¥å¿—ã€ç›‘æ§ã€é¡ºåºæ€§è¦æ±‚é«˜çš„åœºæ™¯</td><td>ä»»åŠ¡é˜Ÿåˆ—ã€å¹¶è¡Œè®¡ç®—ã€é«˜ååä»»åŠ¡å¤„ç†</td></tr><tr><td><strong>å®ç°æ–¹å¼</strong></td><td>åŸºäº Topic-Partition åˆ†é…ä¸åç§»ç®¡ç†</td><td>åŸºäºå…±äº«é˜Ÿåˆ—æ¨¡å‹ï¼Œå…è®¸å¤šæ¶ˆè´¹è€…ç«äº‰æ¶ˆè´¹åŒä¸€åˆ†åŒº</td></tr><tr><td><strong>Kafka ç‰ˆæœ¬æ”¯æŒ</strong></td><td>Kafka â‰¤ 3.x</td><td>Kafka 4.x å¼•å…¥ï¼ˆKIP-932 â€œQueues for Kafkaâ€ï¼‰</td></tr><tr><td><strong>ä¼˜åŠ¿</strong></td><td>é¡ºåºä¿è¯å¼ºã€æ¨¡å‹æˆç†Ÿç¨³å®š</td><td>å¹¶è¡Œèƒ½åŠ›å¼ºã€ååæå‡ã€æ”¯æŒç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰</td></tr><tr><td><strong>åŠ£åŠ¿</strong></td><td>åˆ†åŒºé™åˆ¶ååï¼Œæ‰©å±•å—é™</td><td>é¡ºåºæ€§å¯èƒ½å‡å¼±ï¼Œå®ç°æ›´å¤æ‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤é•¿æœŸå¼ƒç”¨çš„æ—§ API / åè®®ï¼ˆå‘åä¸å…¼å®¹çš„æ¸…ç†ï¼‰</p><ul class="lvl-2"><li class="lvl-4">è¯´æ˜ï¼š4.x ç§»é™¤äº†é‚£äº›å·²å¼ƒç”¨ â‰¥12 ä¸ªæœˆçš„æ¥å£/åè®®ï¼Œæ—¨åœ¨ç®€åŒ–ä»£ç åº“å¹¶é¼“åŠ±é‡‡ç”¨æ–°åŠŸèƒ½ã€‚</li><li class="lvl-4">å½±å“/æç¤ºï¼šå‡çº§å‰åŠ¡å¿…æ£€æŸ¥ä½ ä½¿ç”¨åˆ°çš„ Broker/Client/Streams/Connect API æ˜¯å¦ä¾èµ–è¢«ç§»é™¤çš„åŠŸèƒ½ï¼›æµ‹è¯•å®¢æˆ·ç«¯ä¸ç¬¬ä¸‰æ–¹ Connector/æ’ä»¶å…¼å®¹æ€§ã€‚</li></ul></li><li class="lvl-2"><p>Java è¿è¡Œç¯å¢ƒæœ€ä½ç‰ˆæœ¬æ›´æ–°ï¼šClients/Streams ä¸ Broker/Tools çš„ JDK è¦æ±‚æé«˜</p><ul class="lvl-2"><li class="lvl-4">è¯´æ˜ï¼šKafka 4.x å°†å®¢æˆ·ç«¯ï¼ˆKafka Clientsã€Kafka Streamsï¼‰ä¸ Broker/Connect/å·¥å…·åˆ†åˆ«æå‡ºäº†æ›´é«˜çš„ Java baselineï¼ˆClients/Streams æœ€ä½ Java 11ï¼ŒBroker/Connect/Tools æœ€ä½ Java 17 ç­‰ï¼‰ã€‚</li><li class="lvl-4">å½±å“/æç¤ºï¼šå‡çº§é›†ç¾¤å‰å…ˆç»Ÿä¸€å¹³å° JDK ç‰ˆæœ¬ï¼ŒCI/CD/å®¹å™¨é•œåƒä¹Ÿè¦å¯¹åº”æ›´æ–°ã€‚</li></ul></li><li class="lvl-2"><p>è®¸å¤šæ–°çš„ KIPï¼ˆåŠŸèƒ½å¢å¼ºï¼‰ä¸æ€§èƒ½/å¯è§‚æµ‹æ€§æ”¹è¿›</p><ul class="lvl-2"><li class="lvl-4">è¯´æ˜ï¼šåŒ…å«æ”¹è¿›çš„ Streams rebalanceã€æ›´å¤š Admin/è¿ç»´å‘½ä»¤ã€èŠ‚ç‚¹æ³¨å†Œ/åˆ—ä¸¾èƒ½åŠ›ã€æ’ä»¶/æŒ‡æ ‡æ‰©å±•ç‚¹ç­‰ï¼ˆå¤šé¡¹ KIP åœ¨ 4.0/4.1 é™†ç»­è½åœ°ï¼‰ã€‚è¿™äº›æ”¹è¿›è¦†ç›– Brokerã€Controllerã€Producerã€Consumerã€Admin å’Œ Streams å­ç³»ç»Ÿã€‚</li><li class="lvl-4">å½±å“/æç¤ºï¼šè¿ç»´ä¸ç›‘æ§é¢æ¿å¯èƒ½å—ç›Šï¼ˆæ–°å¢å¯è§‚æµ‹æŒ‡æ ‡/APIï¼‰ï¼›å¦‚æœä½ æœ‰è‡ªå®šä¹‰æ’ä»¶æˆ–ç›‘æ§æ¥å…¥ï¼Œéœ€è¦æ£€æŸ¥æ–°çš„æ’ä»¶/metrics æ³¨å†Œæœºåˆ¶ã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº KRaft æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org&quot;&gt;Kafkaå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡çš„å®‰è£…æ–¹æ³•åŒæ ·é€‚ç”¨äº Kafka 4.x ç‰ˆæœ¬ï¼Œåªä¸è¿‡ Kafka 4.x ä¸­å·²ç»ä¸å†åŒ…å« ZooKeeper ç›¸å…³çš„é…ç½®æ–‡ä»¶ä»¥åŠç›¸å…³çš„å‘½ä»¤ï¼Œå¦å¤–è¦æ±‚JDK17+ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafka çš„ å¸¸ç”¨å‘½ä»¤</title>
    <link href="https://blog.hanqunfeng.com/2025/10/15/kafka-04-command/"/>
    <id>https://blog.hanqunfeng.com/2025/10/15/kafka-04-command/</id>
    <published>2025-10-15T12:30:05.000Z</published>
    <updated>2025-10-16T06:05:44.574Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Kafka çš„ å¸¸ç”¨å‘½ä»¤</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org">Kafkaå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p></li><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/kafka-3-demo">Java-Client ä»£ç ç¤ºä¾‹</a></p></li></ul><span id="more"></span><h2 id="topic">topic</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º topic</span></span><br><span class="line">kafka-topics.sh --create --bootstrap-server localhost:9092 --topic <span class="built_in">test</span> --partitions 3 --replication-factor 2</span><br><span class="line"><span class="comment"># --bootstrap-server æŒ‡å®š kafka é›†ç¾¤åœ°å€</span></span><br><span class="line"><span class="comment"># --topic åˆ›å»ºçš„ topic åç§°</span></span><br><span class="line"><span class="comment"># --partitions æŒ‡å®šåˆ†åŒºæ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼</span></span><br><span class="line"><span class="comment"># --replication-factor æŒ‡å®šå‰¯æœ¬æ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡º topic</span></span><br><span class="line">kafka-topics.sh --list --bootstrap-server localhost:9092</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ topic è¯¦æƒ…</span></span><br><span class="line">kafka-topics.sh --describe --bootstrap-server localhost:9092 --topic <span class="built_in">test</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Topic: <span class="built_in">test</span>TopicId: Ru0tWQJ4RMWcjjGsKAdWQgPartitionCount: 3ReplicationFactor: 3Configs:</span><br><span class="line">Topic: <span class="built_in">test</span>Partition: 0Leader: 3Replicas: 3,1,2Isr: 3,2,1Elr: N/ALastKnownElr: N/A</span><br><span class="line">Topic: <span class="built_in">test</span>Partition: 1Leader: 1Replicas: 1,2,3Isr: 3,2,1Elr: N/ALastKnownElr: N/A</span><br><span class="line">Topic: <span class="built_in">test</span>Partition: 2Leader: 2Replicas: 2,3,1Isr: 3,2,1Elr: N/ALastKnownElr: N/A</span><br><span class="line"><span class="comment">## è¾“å‡ºè¯´æ˜</span></span><br><span class="line"><span class="comment"># æ€»ä½“ä¿¡æ¯ï¼ˆTopic æ¦‚è§ˆï¼‰Topic: testTopicId: Ru0tWQJ4RMWcjjGsKAdWQgPartitionCount: 3ReplicationFactor: 3Configs:</span></span><br><span class="line">| å­—æ®µ                                  | å«ä¹‰                                                            |</span><br><span class="line">| ----------------------------------- | ------------------------------------------------------------- |</span><br><span class="line">| **Topic: disTopic**                 | Topic åç§°ï¼Œå³å½“å‰æè¿°çš„ä¸»é¢˜ã€‚                                            |</span><br><span class="line">| **TopicId: VUK7Mc9oQdS1mjGG7OhQzQ** | Kafka å†…éƒ¨è‡ªåŠ¨ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUUIDï¼‰ï¼ŒKafka 3.x ä¹‹åå¼•å…¥ï¼Œç”¨äºåŒºåˆ†åŒåä½†ä¸åŒç”Ÿå‘½å‘¨æœŸçš„ topicã€‚ |</span><br><span class="line">| **PartitionCount: 3**               | è¯¥ä¸»é¢˜æœ‰ 3 ä¸ªåˆ†åŒºï¼ˆpartitionï¼‰ã€‚æ¯ä¸ªåˆ†åŒºå­˜å‚¨ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚                            |</span><br><span class="line">| **ReplicationFactor:**              | å‰¯æœ¬å› å­ã€‚è¿™é‡Œè™½ç„¶è¾“å‡ºä¸­æ²¡æ˜¾ç¤ºå…·ä½“å€¼ï¼Œä½†å¯ä»æ¯è¡Œåˆ†åŒºé…ç½®æ¨æ–­æ˜¯ **3**ï¼ˆæ¯ä¸ªåˆ†åŒºæœ‰ 3 ä¸ªå‰¯æœ¬ï¼‰ã€‚           |</span><br><span class="line">| **Configs:**                        | topic çš„é…ç½®é¡¹ï¼ˆä¾‹å¦‚æ¸…ç†ç­–ç•¥ã€å‹ç¼©ç±»å‹ç­‰ï¼‰ï¼Œå¦‚æœä¸ºç©ºï¼Œè¯´æ˜ä½¿ç”¨é»˜è®¤é…ç½®ã€‚                       |</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†åŒºè¯¦æƒ…ï¼ˆæ¯ä¸ª Partition ä¸€è¡Œï¼‰</span></span><br><span class="line"></span><br><span class="line">| å­—æ®µ                                | å«ä¹‰                                                          |</span><br><span class="line">| --------------------------------- | ----------------------------------------------------------- |</span><br><span class="line">| **Partition: 0**                  | ç¬¬ 0 å·åˆ†åŒºã€‚                                                    |</span><br><span class="line">| **Leader: 2**                     | è¯¥åˆ†åŒºå½“å‰çš„ **Leader Broker æ˜¯ broker ID = 2**ï¼Œåªæœ‰ Leader æ‰å¤„ç†è¯»å†™è¯·æ±‚ã€‚ |</span><br><span class="line">| **Replicas: 2,3,1**               | è¯¥åˆ†åŒºçš„æ‰€æœ‰å‰¯æœ¬å­˜æ”¾åœ¨å“ªäº› Broker ä¸Šï¼ˆå³å‰¯æœ¬åˆ†å¸ƒ,ARï¼‰ï¼Œåˆ†åˆ«æ˜¯ broker 2ã€3ã€1ã€‚             |</span><br><span class="line">| **Isr (In-Sync Replicas): 2,3,1** | å½“å‰ä¸ Leader ä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆã€‚è¿™é‡Œæ‰€æœ‰å‰¯æœ¬éƒ½åœ¨åŒæ­¥ä¸­ï¼ˆå¥åº·çŠ¶æ€ ğŸ‘ï¼‰ã€‚                  |</span><br><span class="line">| **Elr / LastKnownElr**            | Kafka æ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„ <span class="string">&quot;Enhanced Leader Replica&quot;</span> çŠ¶æ€ï¼Œç›®å‰æœªå¯ç”¨ï¼ˆN/Aï¼‰ã€‚      |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ topic</span></span><br><span class="line">kafka-topics.sh --delete --bootstrap-server localhost:9092 --topic <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h2 id="consumer">consumer</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º consumer</span></span><br><span class="line">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class="built_in">test</span> --group <span class="built_in">test</span></span><br><span class="line"><span class="comment"># --topic æŒ‡å®š topic</span></span><br><span class="line"><span class="comment"># --group æŒ‡å®š consumer ç»„</span></span><br><span class="line"></span><br><span class="line">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class="built_in">test</span>  --from-beginning</span><br><span class="line"><span class="comment"># --from-beginning ä» topic çš„æœ€å¼€å§‹æ¶ˆè´¹</span></span><br></pre></td></tr></table></figure><h2 id="consumer-group">consumer-group</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡º consumer ç»„</span></span><br><span class="line">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list</span><br><span class="line"><span class="comment"># --bootstrap-server é›†ç¾¤åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ consumer ç»„è¯¦æƒ…</span></span><br><span class="line">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group <span class="built_in">test</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">GROUP  TOPIC  PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG  CONSUMER-ID                                             HOST         CLIENT-ID</span><br><span class="line"><span class="built_in">test</span>   <span class="built_in">test</span>   0          2               2               0    console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1  /10.250.0.7   console-consumer</span><br><span class="line"><span class="built_in">test</span>   <span class="built_in">test</span>   1          2               2               0    console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1  /10.250.0.7   console-consumer</span><br><span class="line"><span class="built_in">test</span>   <span class="built_in">test</span>   2          1               1               0    console-consumer-9ac45b29-d8f3-4649-ab09-7b567aa2ba53  /10.250.0.108 console-consumer</span><br><span class="line"></span><br><span class="line"><span class="comment">## è¾“å‡ºè¯´æ˜</span></span><br><span class="line"><span class="comment"># GROUP       æ¶ˆè´¹ç»„åç§°</span></span><br><span class="line"><span class="comment"># TOPIC       topic åç§°</span></span><br><span class="line"><span class="comment"># PARTITION   åˆ†åŒºç¼–å·</span></span><br><span class="line"><span class="comment"># CURRENT-OFFSET  å½“å‰æ¶ˆè´¹çš„ offset</span></span><br><span class="line"><span class="comment"># LOG-END-OFFSET   topic ä¸­æœ€å¤§çš„ offset</span></span><br><span class="line"><span class="comment"># LAG         å½“å‰æ¶ˆè´¹çš„ offset ä¸ topic ä¸­æœ€å¤§çš„ offset çš„å·®å€¼ï¼Œå³å‰©ä½™æœªæ¶ˆè´¹çš„ æ¶ˆæ¯æ•°é‡</span></span><br><span class="line"><span class="comment"># CONSUMER-ID  å½“å‰æ¶ˆè´¹çš„ consumer çš„ id</span></span><br><span class="line"><span class="comment"># HOST        å½“å‰æ¶ˆè´¹çš„ consumer çš„ä¸»æœºå</span></span><br><span class="line"><span class="comment"># CLIENT-ID   å½“å‰æ¶ˆè´¹çš„ consumer çš„å®¢æˆ·ç«¯åç§°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ consumer ç»„</span></span><br><span class="line">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --delete --group <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h2 id="producer">producer</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º producer</span></span><br><span class="line">kafka-console-producer.sh --bootstrap-server localhost:9092 --topic <span class="built_in">test</span></span><br><span class="line"><span class="comment"># --topic æŒ‡å®š topic</span></span><br></pre></td></tr></table></figure><h2 id="æ‰‹åŠ¨è§¦å‘-Kafka-Partitoin-çš„-Leader-é€‰ä¸¾-è‡ªå¹³è¡¡">æ‰‹åŠ¨è§¦å‘ Kafka Partitoin çš„ Leader é€‰ä¸¾(è‡ªå¹³è¡¡)</h2><ul class="lvl-0"><li class="lvl-2"><p>kafkaçš„è‡ªå¹³è¡¡é»˜è®¤å¼€å¯ï¼Œæ¯éš” 300ç§’æ‰«æä¸€æ¬¡ï¼Œå¦‚æœéœ€è¦å¹³è¡¡çš„æ¯”ä¾‹é«˜äº 10%ï¼Œåˆ™ä¼šè§¦å‘ä¸€æ¬¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯è‡ªåŠ¨å¹³è¡¡</span></span><br><span class="line">auto.leader.rebalance.enable=<span class="literal">true</span></span><br><span class="line"><span class="comment"># é—´éš”æ‰«ææ—¶é—´ é»˜è®¤ 300 ç§’</span></span><br><span class="line">eader.imbalance.check.interval.seconds=300</span><br><span class="line"><span class="comment"># è§¦å‘æ¯”ä¾‹ï¼Œå³æ‰«æçš„ broker ä¸Šéœ€è¦å¹³è¡¡çš„ partition å å½“å‰ broker å…¨éƒ¨ partition çš„æ¯”ä¾‹ï¼Œé»˜è®¤ 10%</span></span><br><span class="line">leader.imbalance.per.broker.percentage=10</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å»ºè®®å…³é—­ï¼Œæ”¹ä¸ºä¸šåŠ¡ä½å³°æ—¶æ‰‹åŠ¨è§¦å‘</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªåŠ¨å¹³è¡¡</span></span><br><span class="line">kafka-leader-election.sh --bootstrap-server localhost:9092  --election-type preferred --topic <span class="built_in">test</span> --partition 0</span><br><span class="line"><span class="comment"># --topic æŒ‡å®šè¦è§¦å‘çš„ topic</span></span><br><span class="line"><span class="comment"># --partition 0 è§¦å‘ partition 0 çš„ leader é€‰ä¸¾</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ğŸ§© å‚æ•°è¯´æ˜ï¼šâ€“election-type</p></li></ul><table><thead><tr><th>å‚æ•°å€¼</th><th>å«ä¹‰</th><th>è§¦å‘æ¡ä»¶</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong><code>preferred</code></strong></td><td><strong>é¦–é€‰ Leader é€‰ä¸¾</strong>ï¼ˆPreferred Leader Electionï¼‰<br>Kafka ä¼šå°è¯•å°†åˆ†åŒºçš„ leader é‡æ–°åˆ‡æ¢ä¸ºã€Œé¦–é€‰å‰¯æœ¬ã€ï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªå‰¯æœ¬ï¼‰ã€‚</td><td>åªæœ‰å½“å‰ leader <strong>ä¸æ˜¯</strong> é¦–é€‰å‰¯æœ¬æ—¶æ‰æ‰§è¡Œã€‚</td><td>æŸäº›å‰¯æœ¬è¢«è‡ªåŠ¨é€‰ä¸¾æˆ leader åï¼Œå¸Œæœ›æ¢å¤åŸæœ‰ã€Œé¦–é€‰ leaderã€ç»“æ„ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</td></tr><tr><td><strong><code>unclean</code></strong></td><td><strong>éå¹²å‡€ Leader é€‰ä¸¾</strong>ï¼ˆUnclean Leader Electionï¼‰<br>å…è®¸ä»ä¸åŒæ­¥çš„å‰¯æœ¬ä¸­é€‰ä¸¾æ–°çš„ leaderã€‚</td><td>ä»…åœ¨åˆ†åŒº <strong>æ²¡æœ‰å¯ç”¨ leader</strong> æ—¶æ‰§è¡Œã€‚</td><td>åœ¨ç´§æ€¥æ¢å¤åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚æ‰€æœ‰ ISR å‰¯æœ¬éƒ½ä¸‹çº¿ï¼‰ï¼Œä¸ºäº†æ¢å¤æœåŠ¡å¯ç”¨æ€§ï¼Œå³ä½¿ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Leader Partitionâ¾ƒåŠ¨å¹³è¡¡æœºåˆ¶</p><ul class="lvl-2"><li class="lvl-6">Leader Partitoiné€‰ä¸¾æœºåˆ¶èƒ½å¤Ÿä¿è¯æ¯â¼€ä¸ªPartitionåŒâ¼€æ—¶åˆ»æœ‰ä¸”ä»…æœ‰â¼€ä¸ªLeader Partitionã€‚ä½†æ˜¯ï¼Œæ˜¯ä¸æ˜¯åªè¦åˆ†é…å¥½äº†Leader Partitionå°±å¤Ÿäº†å‘¢ï¼Ÿ</li><li class="lvl-6">åœ¨â¼€ç»„Partitonä¸­ï¼ŒLeader Partitioné€šå¸¸æ˜¯â½è¾ƒç¹å¿™çš„èŠ‚ç‚¹ï¼Œå› ä¸ºä»–è¦è´Ÿè´£ä¸å®¢æˆ·ç«¯çš„æ•°æ®äº¤äº’ï¼Œä»¥åŠå‘FolloweråŒæ­¥æ•°æ®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKafkaä¼šå°½é‡å°†Leader Partitionåˆ†é…åˆ°ä¸åŒçš„BrokerèŠ‚ç‚¹ä¸Šï¼Œâ½¤ä»¥ä¿è¯æ•´ä¸ªé›†ç¾¤çš„æ€§èƒ½å‹â¼’èƒ½å¤Ÿâ½è¾ƒå¹³å‡ã€‚</li><li class="lvl-6">ä½†æ˜¯ï¼Œç»è¿‡Leader Partitioné€‰ä¸¾åï¼Œè¿™ç§å¹³è¡¡å°±æœ‰å¯èƒ½ä¼šè¢«æ‰“ç ´ï¼Œè®©Leader Partitionè¿‡å¤šçš„é›†ä¸­åˆ°åŒâ¼€ä¸ªBrokerä¸Šã€‚è¿™æ ·ï¼Œè¿™ä¸ªBrokerçš„å‹â¼’å°±ä¼šæ˜æ˜¾â¾¼äºå…¶ä»–Brokerï¼Œä»â½½å½±å“åˆ°é›†ç¾¤çš„æ•´ä½“æ€§èƒ½ã€‚</li><li class="lvl-6">ä¸ºæ­¤ï¼ŒKafkaè®¾è®¡äº†Leader Partitionâ¾ƒåŠ¨å¹³è¡¡æœºåˆ¶ï¼Œå½“å‘ç°Leaderåˆ†é…ä¸å‡è¡¡æ—¶ï¼Œâ¾ƒåŠ¨è¿›â¾Leader Partitionè°ƒæ•´ã€‚</li><li class="lvl-6">Kafkaåœ¨è¿›â¾Leader Partitionâ¾ƒå¹³è¡¡æ—¶çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼šä»–ä¼šè®¤ä¸ºAR(Replicaså‰¯æœ¬é›†)å½“ä¸­çš„ç¬¬â¼€ä¸ªèŠ‚ç‚¹å°±åº”è¯¥æ˜¯LeaderèŠ‚ç‚¹ã€‚è¿™ç§é€‰ä¸¾ç»“æœæˆä¸ºpreferred election ç†æƒ³é€‰ä¸¾ç»“æœã€‚</li><li class="lvl-6">Controllerä¼šå®šæœŸæ£€æµ‹é›†ç¾¤çš„Partitionå¹³è¡¡æƒ…å†µï¼Œåœ¨å¼€å§‹æ£€æµ‹æ—¶ï¼ŒControllerä¼šä¾æ¬¡æ£€æŸ¥æ‰€æœ‰çš„Brokerã€‚å½“å‘ç°è¿™ä¸ªBrokerä¸Šçš„ä¸å¹³è¡¡çš„Partitionâ½ä¾‹â¾¼äº<code>leader.imbalance.per.broker.percentage</code>é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè§¦å‘â¼€æ¬¡Leader Partitonçš„â¾ƒå¹³è¡¡ã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Kafka çš„ å¸¸ç”¨å‘½ä»¤&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org&quot;&gt;Kafkaå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/kafka-3-demo&quot;&gt;Java-Client ä»£ç ç¤ºä¾‹&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>Kafka çš„ server.properties é…ç½®é¡¹</title>
    <link href="https://blog.hanqunfeng.com/2025/10/14/kafka-01-server-config/"/>
    <id>https://blog.hanqunfeng.com/2025/10/14/kafka-01-server-config/</id>
    <published>2025-10-14T13:30:05.000Z</published>
    <updated>2025-10-18T12:00:31.595Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„ server.properties çš„é…ç½®é¡¹ï¼ŒåŸºäº Zookeeperã€‚</p></li><li class="lvl-2"><p><a href="https://kafka.apache.org">Kafkaå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p></li></ul><span id="more"></span><h2 id="Kafka-3-x-server-properties-ä¸»è¦é…ç½®é¡¹æ¸…å•">Kafka 3.x server.properties ä¸»è¦é…ç½®é¡¹æ¸…å•</h2><ul class="lvl-0"><li class="lvl-2"><p>å…³äº server.properties çš„é…ç½®é¡¹ï¼Œè¯·å‚è€ƒ <a href="https://kafka.apache.org/39/documentation/#brokerconfigs">Kafka å®˜æ–¹æ–‡æ¡£</a></p></li></ul><table><thead><tr><th>åˆ†ç±»</th><th>å‚æ•°å</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th><th>æ¨è/å¤‡æ³¨</th></tr></thead><tbody><tr><td>ğŸ—‚ï¸ <strong>åŸºæœ¬ä¿¡æ¯</strong></td><td><code>broker.id</code></td><td>0</td><td>Broker å”¯ä¸€æ ‡è¯†</td><td>é›†ç¾¤ä¸­å¿…é¡»å”¯ä¸€</td></tr><tr><td></td><td><code>node.id</code></td><td>-</td><td>Raft æ¨¡å¼ï¼ˆKRaftï¼‰ä¸‹ä½¿ç”¨</td><td>ZK æ¨¡å¼å¿½ç•¥</td></tr><tr><td></td><td><code>process.roles</code></td><td>-</td><td>KRaft æ¨¡å¼è§’è‰²ï¼ˆcontroller, brokerï¼‰</td><td>ZK æ¨¡å¼ä¸é…ç½®</td></tr><tr><td>ğŸ”Œ <strong>ç½‘ç»œä¸ç›‘å¬é…ç½®</strong></td><td><code>listeners</code></td><td>PLAINTEXT://:9092</td><td>Broker ç›‘å¬åœ°å€</td><td>å¯ç”¨å¤šä¸ªåè®®ï¼Œå¦‚ SASL_PLAINTEXT, SSL</td></tr><tr><td></td><td><code>advertised.listeners</code></td><td>-</td><td>å®¢æˆ·ç«¯è¿æ¥æ—¶çœ‹åˆ°çš„åœ°å€</td><td>å¤–ç½‘è®¿é—®éœ€é…ç½®</td></tr><tr><td></td><td><code>listener.security.protocol.map</code></td><td>PLAINTEXT:PLAINTEXT</td><td>æ˜ å°„ç›‘å¬å™¨åè®®</td><td>å¤šåè®®æ—¶é…ç½®</td></tr><tr><td></td><td><code>inter.broker.listener.name</code></td><td>-ï¼ˆKafka 2.4+ é»˜è®¤ç¬¬ä¸€ä¸ª listenerï¼‰</td><td>æŒ‡å®š broker é—´é€šä¿¡ä½¿ç”¨å“ªä¸ª listenerï¼ˆå¦‚ INTERNALï¼‰</td><td>é›†ç¾¤å†…éƒ¨é€šä¿¡å¿…é¡»ä¸€è‡´ï¼›å¸¸é…åˆå¤š listener ä½¿ç”¨</td></tr><tr><td></td><td><code>num.network.threads</code></td><td>3</td><td>ç½‘ç»œçº¿ç¨‹æ•°</td><td>ä¸€èˆ¬ä¸éœ€ä¿®æ”¹</td></tr><tr><td></td><td><code>num.io.threads</code></td><td>8</td><td>å¤„ç†è¯·æ±‚çš„ IO çº¿ç¨‹æ•°</td><td>æ ¹æ® CPU è°ƒæ•´</td></tr><tr><td></td><td><code>socket.send.buffer.bytes</code></td><td>102400</td><td>å‘é€ç¼“å†²åŒºå¤§å°</td><td>ç½‘ç»œä¼˜åŒ–å‚æ•°</td></tr><tr><td></td><td><code>socket.receive.buffer.bytes</code></td><td>102400</td><td>æ¥æ”¶ç¼“å†²åŒºå¤§å°</td><td>ç½‘ç»œä¼˜åŒ–å‚æ•°</td></tr><tr><td></td><td><code>socket.request.max.bytes</code></td><td>104857600</td><td>å•è¯·æ±‚æœ€å¤§å¤§å° (100MB)</td><td>å¤§æ¶ˆæ¯éœ€è°ƒå¤§</td></tr><tr><td>âš™ï¸ <strong>é›†ç¾¤ä¸å…ƒæ•°æ®</strong></td><td><code>log.dirs</code></td><td>/tmp/kafka-logs</td><td>æ•°æ®å­˜å‚¨è·¯å¾„</td><td>å¤šç›®å½•å¯æå‡æ€§èƒ½</td></tr><tr><td></td><td><code>num.recovery.threads.per.data.dir</code></td><td>1</td><td>æ¯ä¸ªæ•°æ®ç›®å½•çš„æ¢å¤çº¿ç¨‹æ•°</td><td>å¤šç£ç›˜æ—¶å¯å¢åŠ </td></tr><tr><td></td><td><code>auto.create.topics.enable</code></td><td>true</td><td>æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topic</td><td>ç”Ÿäº§å»ºè®®ç¦ç”¨</td></tr><tr><td></td><td><code>controlled.shutdown.enable</code></td><td>true</td><td>ä¼˜é›…å…³é—­ Broker</td><td>å»ºè®®å¼€å¯</td></tr><tr><td></td><td><code>delete.topic.enable</code></td><td>true</td><td>æ˜¯å¦å…è®¸åˆ é™¤ Topic</td><td>ç”Ÿäº§æ…ç”¨</td></tr><tr><td></td><td><code>auto.leader.rebalance.enable</code></td><td>true</td><td>æ˜¯å¦è‡ªåŠ¨å‡è¡¡ Leader</td><td>å»ºè®®å¼€å¯</td></tr><tr><td></td><td><code>leader.imbalance.check.interval.seconds</code></td><td>300</td><td>æ£€æŸ¥ leader å¤±è¡¡é—´éš”</td><td>ä¸ä¸Šé…åˆä½¿ç”¨</td></tr><tr><td></td><td><code>leader.imbalance.per.broker.percentage</code></td><td>10</td><td>è§¦å‘ leader é‡å¹³è¡¡çš„é˜ˆå€¼</td><td>é»˜è®¤å³å¯</td></tr><tr><td>ğŸ§± <strong>å‰¯æœ¬ä¸å¤åˆ¶æœºåˆ¶</strong></td><td><code>default.replication.factor</code></td><td>1</td><td>æ–° Topic é»˜è®¤å‰¯æœ¬æ•°</td><td>ç”Ÿäº§å»ºè®® 3</td></tr><tr><td></td><td><code>offsets.topic.replication.factor</code></td><td>1</td><td>æ¶ˆè´¹ç»„åç§»ä¸»é¢˜å‰¯æœ¬æ•°</td><td>å»ºè®® 3</td></tr><tr><td></td><td><code>transaction.state.log.replication.factor</code></td><td>1</td><td>äº‹åŠ¡çŠ¶æ€ä¸»é¢˜å‰¯æœ¬æ•°</td><td>å»ºè®® 3</td></tr><tr><td></td><td><code>transaction.state.log.min.isr</code></td><td>1</td><td>äº‹åŠ¡çŠ¶æ€æ—¥å¿—æœ€å° ISR æ•°</td><td>å»ºè®® 2</td></tr><tr><td></td><td><code>min.insync.replicas</code></td><td>1</td><td>Leader å†™å…¥æ—¶è¦æ±‚çš„æœ€å° ISR å‰¯æœ¬æ•°</td><td>å»ºè®® <code>replication.factor - 1</code></td></tr><tr><td></td><td><code>unclean.leader.election.enable</code></td><td>false</td><td>æ˜¯å¦å…è®¸éåŒæ­¥å‰¯æœ¬é€‰ä¸º leader</td><td>ç”Ÿäº§å»ºè®® false</td></tr><tr><td></td><td><code>num.replica.fetchers</code></td><td>1</td><td>follower æ‹‰å–çº¿ç¨‹æ•°</td><td>å¯æå‡å¤åˆ¶æ€§èƒ½</td></tr><tr><td></td><td><code>replica.fetch.max.bytes</code></td><td>1048576 (1MB)</td><td>follower æ‹‰å–å•åˆ†åŒºæœ€å¤§æ•°æ®é‡</td><td>å¢å¤§å¯æé€Ÿ</td></tr><tr><td></td><td><code>replica.fetch.response.max.bytes</code></td><td>10485760 (10MB)</td><td>follower ä¸€æ¬¡æ‹‰å–å“åº”æ€»é‡</td><td>å¯è°ƒå¤§</td></tr><tr><td></td><td><code>replica.fetch.wait.max.ms</code></td><td>500</td><td>follower ç­‰å¾…æ–°æ•°æ®çš„æœ€å¤§æ—¶é•¿</td><td>å»¶è¿Ÿä¸ååæŠ˜ä¸­</td></tr><tr><td></td><td><code>replica.fetch.backoff.ms</code></td><td>1000</td><td>æ‹‰å–å¤±è´¥åé€€é¿æ—¶é—´</td><td>ç½‘ç»œä¸ç¨³æ—¶è°ƒæ•´</td></tr><tr><td></td><td><code>replica.socket.timeout.ms</code></td><td>30000</td><td>follower ä¸ leader é€šä¿¡è¶…æ—¶</td><td>â‰¥ <a href="http://fetch.wait.ms">fetch.wait.ms</a></td></tr><tr><td></td><td><code>replica.socket.receive.buffer.bytes</code></td><td>65536</td><td>æ‹‰å– socket ç¼“å†²åŒº</td><td>è°ƒå¤§å¯æé€Ÿ</td></tr><tr><td></td><td><code>replica.lag.time.max.ms</code></td><td>10000</td><td>follower è½å leader çš„æœ€å¤§æ—¶é—´</td><td>å½±å“ ISR</td></tr><tr><td></td><td><code>replica.high.watermark.checkpoint.interval.ms</code></td><td>5000</td><td>é«˜æ°´ä½å†™å…¥ checkpoint å‘¨æœŸ</td><td>å½±å“æ¢å¤é€Ÿåº¦</td></tr><tr><td></td><td><code>replica.selector.class</code></td><td>-</td><td>è‡ªå®šä¹‰å‰¯æœ¬é€‰æ‹©ç±»</td><td>ä¸€èˆ¬ä¿æŒé»˜è®¤</td></tr><tr><td>ğŸ§® <strong>æ—¥å¿—ä¸æ®µæ–‡ä»¶</strong></td><td><code>log.segment.bytes</code></td><td>1073741824 (1GB)</td><td>å•æ—¥å¿—æ®µæ–‡ä»¶å¤§å°</td><td>è°ƒå°ä¾¿äºåˆ é™¤</td></tr><tr><td></td><td><code>log.segment.ms</code></td><td>604800000 (7å¤©)</td><td>å¼ºåˆ¶æ»šåŠ¨æ—¥å¿—çš„æ—¶é—´</td><td>é€‚ç”¨äºæ—¶é—´æ§åˆ¶</td></tr><tr><td></td><td><code>log.retention.hours</code></td><td>168</td><td>æ—¥å¿—ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰</td><td>ä¸ç£ç›˜ç©ºé—´ç›¸å…³</td></tr><tr><td></td><td><code>log.retention.bytes</code></td><td>-1</td><td>æ—¥å¿—æ€»å¤§å°é™åˆ¶</td><td>-1 è¡¨ç¤ºä¸é™åˆ¶</td></tr><tr><td></td><td><code>log.retention.check.interval.ms</code></td><td>300000</td><td>æ£€æŸ¥æ—¥å¿—ä¿ç•™ç­–ç•¥é—´éš”</td><td>é»˜è®¤å³å¯</td></tr><tr><td></td><td><code>log.cleaner.enable</code></td><td>true</td><td>æ˜¯å¦å¯ç”¨æ—¥å¿—å‹ç¼©</td><td>compact ä¸»é¢˜éœ€å¯ç”¨</td></tr><tr><td></td><td><code>log.cleaner.threads</code></td><td>1</td><td>æ¸…ç†çº¿ç¨‹æ•°</td><td>å¤§é›†ç¾¤å¯å¢åŠ </td></tr><tr><td></td><td><code>log.cleaner.io.max.bytes.per.second</code></td><td>None</td><td>é™åˆ¶æ¸…ç† IO å¸¦å®½</td><td>æ§åˆ¶ç£ç›˜è´Ÿè½½</td></tr><tr><td></td><td><code>log.flush.interval.messages</code></td><td>Long.MAX_VALUE</td><td>ç´¯è®¡æ¶ˆæ¯æ•°è¾¾åˆ°åå¼ºåˆ¶ flush</td><td>é€šå¸¸ä¿æŒé»˜è®¤</td></tr><tr><td></td><td><code>log.flush.interval.ms</code></td><td>None</td><td>æ¯éš”å¤šä¹…å¼ºåˆ¶ flush</td><td>SSD å¯è°ƒå¤§</td></tr><tr><td></td><td><code>num.partitions</code></td><td>1</td><td>æ–° Topic é»˜è®¤åˆ†åŒºæ•°</td><td>é€šå¸¸ 3~6 èµ·æ­¥</td></tr><tr><td>ğŸ§µ <strong>ç”Ÿäº§ä¸æ¶ˆè´¹ç›¸å…³</strong></td><td><code>message.max.bytes</code></td><td>1048576</td><td>å…è®¸çš„æœ€å¤§æ¶ˆæ¯å¤§å°</td><td>ä¸ Producer <code>max.request.size</code> å¯¹é½</td></tr><tr><td></td><td><code>replica.fetch.max.bytes</code></td><td>1048576</td><td>ä¸ Producer/Consumer å¯¹åº”çš„é™åˆ¶</td><td>é˜²æ­¢å¤§æ¶ˆæ¯å¡æ­»</td></tr><tr><td></td><td><code>compression.type</code></td><td>producer</td><td>å‹ç¼©ç®—æ³•ï¼ˆnone, gzip, snappy, lz4, zstdï¼‰</td><td>å»ºè®® zstd</td></tr><tr><td></td><td><code>queued.max.requests</code></td><td>500</td><td>Broker æœ€å¤§æ’é˜Ÿè¯·æ±‚æ•°</td><td>é»˜è®¤å³å¯</td></tr><tr><td>ğŸ› ï¸ <strong>æ§åˆ¶å™¨ä¸åè°ƒå™¨</strong></td><td><code>controller.socket.timeout.ms</code></td><td>30000</td><td>æ§åˆ¶å™¨é€šä¿¡è¶…æ—¶</td><td>é»˜è®¤å³å¯</td></tr><tr><td></td><td><code>controller.quorum.voters</code></td><td>-</td><td>KRaft æ¨¡å¼é€‰ä¸¾æˆå‘˜</td><td>ZK æ¨¡å¼ä¸éœ€</td></tr><tr><td></td><td><code>controller.listener.names</code></td><td>-</td><td>æ§åˆ¶å™¨ç›‘å¬å</td><td>ZK æ¨¡å¼å¿½ç•¥</td></tr><tr><td>ğŸ“ˆ <strong>ç›‘æ§ä¸æŒ‡æ ‡</strong></td><td><code>metric.reporters</code></td><td>ç©º</td><td>æŒ‡æ ‡ä¸ŠæŠ¥ç±»</td><td>å¯æ¥ Prometheus</td></tr><tr><td></td><td><code>metrics.num.samples</code></td><td>2</td><td>æŒ‡æ ‡é‡‡æ ·æ•°</td><td>é»˜è®¤å³å¯</td></tr><tr><td></td><td><code>metrics.sample.window.ms</code></td><td>30000</td><td>æŒ‡æ ‡é‡‡æ ·çª—å£</td><td>é»˜è®¤å³å¯</td></tr><tr><td></td><td><code>replica.fetchers.metrics.enabled</code></td><td>true</td><td>æ˜¯å¦å¯ç”¨å‰¯æœ¬æ‹‰å–æŒ‡æ ‡</td><td>Kafka 3.x æ–°å¢</td></tr><tr><td>ğŸ”’ <strong>å®‰å…¨</strong></td><td><code>authorizer.class.name</code></td><td>ç©º</td><td>æˆæƒç±»å®ç°</td><td>å¼€å¯ ACL æ—¶é…ç½®</td></tr><tr><td></td><td><code>super.users</code></td><td>ç©º</td><td>è¶…çº§ç”¨æˆ·åˆ—è¡¨</td><td>ACL æ¨¡å¼ä¸‹é…ç½®</td></tr><tr><td></td><td><code>ssl.keystore.location</code></td><td>-</td><td>SSL è¯ä¹¦è·¯å¾„</td><td>å¯ç”¨ SSL æ—¶ä½¿ç”¨</td></tr><tr><td></td><td><code>ssl.truststore.location</code></td><td>-</td><td>ä¿¡ä»»è¯ä¹¦è·¯å¾„</td><td>å¯ç”¨ SSL æ—¶ä½¿ç”¨</td></tr></tbody></table><h2 id="å‚æ•°ä½¿ç”¨å»ºè®®æ€»ç»“">å‚æ•°ä½¿ç”¨å»ºè®®æ€»ç»“</h2><table><thead><tr><th>åœºæ™¯</th><th>æ¨èé…ç½®</th></tr></thead><tbody><tr><td><strong>é«˜å¯é æ€§é›†ç¾¤</strong></td><td><code>default.replication.factor=3</code>, <code>min.insync.replicas=2</code>, <code>unclean.leader.election.enable=false</code></td></tr><tr><td><strong>ååä¼˜å…ˆ</strong></td><td>æé«˜ <code>num.replica.fetchers</code>ã€<code>replica.fetch.max.bytes</code></td></tr><tr><td><strong>å¿«é€Ÿæ¢å¤</strong></td><td>å‡å°‘ <code>replica.high.watermark.checkpoint.interval.ms</code></td></tr><tr><td><strong>èŠ‚çœç£ç›˜</strong></td><td>å¯ç”¨ <code>log.cleaner.enable</code> å¹¶è®¾ç½® <code>log.retention.hours</code></td></tr><tr><td><strong>äº‹åŠ¡æˆ–ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰</strong></td><td>è®¾ç½® <code>transaction.state.log.replication.factor=3</code>ã€<code>transaction.state.log.min.isr=2</code></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„ server.properties çš„é…ç½®é¡¹ï¼ŒåŸºäº Zookeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org&quot;&gt;Kafkaå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/kafka/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="kafka" scheme="https://blog.hanqunfeng.com/tags/kafka/"/>
    
  </entry>
  
</feed>
