<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£˜é€¸å³°çš„åšå®¢</title>
  
  <subtitle>Spring--Javaç¨‹åºå‘˜çš„æ˜¥å¤©</subtitle>
  <link href="https://blog.hanqunfeng.com/atom.xml" rel="self"/>
  
  <link href="https://blog.hanqunfeng.com/"/>
  <updated>2025-07-02T12:27:08.083Z</updated>
  <id>https://blog.hanqunfeng.com/</id>
  
  <author>
    <name>é£˜é€¸å³°</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>K8S ä¹‹ Pod</title>
    <link href="https://blog.hanqunfeng.com/2025/07/02/k8s-pod/"/>
    <id>https://blog.hanqunfeng.com/2025/07/02/k8s-pod/</id>
    <published>2025-07-02T14:30:05.000Z</published>
    <updated>2025-07-02T12:27:08.083Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ Podï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/">k8s Pod ä»‹ç»</a></p></li></ul><span id="more"></span><h2 id="Pod-ä»‹ç»">Pod ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>Pod æ˜¯å¯ä»¥åœ¨ Kubernetes ä¸­åˆ›å»ºå’Œç®¡ç†çš„ã€æœ€å°çš„å¯éƒ¨ç½²çš„è®¡ç®—å•å…ƒã€‚</p></li><li class="lvl-2"><p>Podï¼ˆå°±åƒåœ¨è±Œè±†èšä¸­ï¼‰æ˜¯ä¸€ç»„ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰ å®¹å™¨ï¼Œè¿™äº›å®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œã€ä»¥åŠæ€æ ·è¿è¡Œè¿™äº›å®¹å™¨çš„è§„çº¦ã€‚</p></li><li class="lvl-2"><p>Pod ä¸­çš„å†…å®¹æ€»æ˜¯å¹¶ç½®ï¼ˆcolocatedï¼‰çš„å¹¶ä¸”ä¸€åŒè°ƒåº¦ï¼Œåœ¨å…±äº«çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚</p></li><li class="lvl-2"><p>Kubernetes é›†ç¾¤ä¸­çš„ Pod ä¸»è¦æœ‰ä¸¤ç§ç”¨æ³•ï¼š</p><ul class="lvl-2"><li class="lvl-4">è¿è¡Œå•ä¸ªå®¹å™¨çš„ Pod: &quot;æ¯ä¸ª Pod ä¸€ä¸ªå®¹å™¨&quot;æ¨¡å‹æ˜¯æœ€å¸¸è§çš„ Kubernetes ç”¨ä¾‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å°† Pod çœ‹ä½œå•ä¸ªå®¹å™¨çš„åŒ…è£…å™¨ï¼Œå¹¶ä¸” Kubernetes ç›´æ¥ç®¡ç† Podï¼Œè€Œä¸æ˜¯å®¹å™¨ã€‚</li><li class="lvl-4">è¿è¡Œå¤šä¸ªååŒå·¥ä½œçš„å®¹å™¨çš„ Pod: Pod å¯ä»¥å°è£…ç”±ç´§å¯†è€¦åˆä¸”éœ€è¦å…±äº«èµ„æºçš„å¤šä¸ªå¹¶ç½®å®¹å™¨ç»„æˆçš„åº”ç”¨ï¼Œè¿™äº›ä½äºåŒä¸€ä½ç½®çš„å®¹å™¨æ„æˆä¸€ä¸ªå†…èšå•å…ƒã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/nLmg0X.png" alt=""></li></ul></li></ul><h2 id="Pod-ç®¡ç†">Pod ç®¡ç†</h2><h3 id="Pod-åˆ›å»º">Pod åˆ›å»º</h3><ul class="lvl-0"><li class="lvl-2"><p><code>run</code> åˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl run nginx --image=nginx</span><br><span class="line"><span class="comment"># è¾“å‡º yaml</span></span><br><span class="line">kubectl run nginx --image=nginx --dry-run=client -o yaml &gt; pod.yaml</span><br><span class="line"><span class="comment"># é€šè¿‡ yaml æ–‡ä»¶åˆ›å»º</span></span><br><span class="line">kubectl apply -f pod.yaml</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>pod.yaml</code> æ–‡ä»¶è¯´æ˜</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                   <span class="comment"># å¿…å¡«ã€‚æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼ŒPod æ˜¯æ ¸å¿ƒèµ„æºï¼Œä½¿ç”¨ v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>                        <span class="comment"># å¿…å¡«ã€‚èµ„æºç±»å‹ï¼šPod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span>        <span class="comment"># âœ… å¯çœç•¥ã€‚ç”± Kubernetes ç³»ç»Ÿè‡ªåŠ¨å¡«å……</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">run:</span> <span class="string">nginx</span>                   <span class="comment"># âš ï¸ å¯çœç•¥ï¼Œä½†å»ºè®®ä¿ç•™ã€‚ç”¨äºæ ‡è¯† Podï¼Œå¯ä¾› Service/Selector åŒ¹é…</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span>                    <span class="comment"># å¿…å¡«ã€‚Pod çš„åç§°ï¼Œå‘½åç©ºé—´ä¸­å”¯ä¸€</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx</span>                 <span class="comment"># å¿…å¡«ã€‚å®¹å™¨ä½¿ç”¨çš„é•œåƒ</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span>                  <span class="comment"># å¿…å¡«ã€‚å®¹å™¨åç§°ï¼Œåœ¨åŒä¸€ä¸ª Pod å†…å¿…é¡»å”¯ä¸€</span></span><br><span class="line">    <span class="attr">resources:</span> &#123;&#125;                <span class="comment"># âœ… å¯çœç•¥ã€‚æœªè®¾ç½® CPU/å†…å­˜è¯·æ±‚æˆ–é™åˆ¶æ—¶å¯ä»¥ä¸å†™</span></span><br><span class="line">  <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span>        <span class="comment"># âš ï¸ å¯çœç•¥ã€‚é»˜è®¤å°±æ˜¯ ClusterFirstï¼Œä»…åœ¨è‡ªå®šä¹‰ DNS è®¾ç½®æ—¶éœ€è¦å†™</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Always</span>          <span class="comment"># âš ï¸ å¯çœç•¥ã€‚Pod é»˜è®¤ç­–ç•¥æ˜¯ Alwaysï¼Œé™¤éä½ æ˜¯ Job åœºæ™¯</span></span><br><span class="line"><span class="attr">status:</span> &#123;&#125;                       <span class="comment"># âœ… å¯çœç•¥ã€‚ç”± Kubernetes æ§åˆ¶å™¨åŠ¨æ€å¡«å……ï¼Œä¸éœ€è¦æ‰‹åŠ¨å®šä¹‰</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Pod é€šå¸¸ä¸æ˜¯ç›´æ¥ä½¿ç”¨ <code>run</code> åˆ›å»ºçš„ï¼Œè€Œæ˜¯ä½¿ç”¨å·¥ä½œè´Ÿè½½èµ„æºåˆ›å»ºçš„ï¼Œå¦‚ Deployment, StatefulSet, DaemonSetã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º Pod</span></span><br><span class="line">kubectl create deployment nginx --image=nginx</span><br><span class="line"><span class="comment"># ç”Ÿæˆ yaml æ–‡ä»¶ï¼Œä¸çœŸçš„æ‰§è¡Œåˆ›å»º</span></span><br><span class="line">kubectl create deployment nginx --image=nginx --dry-run=client -o yaml &gt; deployment.yaml</span><br><span class="line"><span class="comment"># é€šè¿‡ yaml æ–‡ä»¶åˆ›å»º</span></span><br><span class="line">kubectl apply -f deployment.yaml</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>deployment.yaml</code> æ–‡ä»¶è¯´æ˜</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>                  <span class="comment"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº Deployment èµ„æº</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>                     <span class="comment"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆDeploymentï¼‰</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span>            <span class="comment"># âœ… å¯çœç•¥ï¼Œé€šå¸¸ç”±ç³»ç»Ÿè‡ªåŠ¨å¡«å……</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span>                       <span class="comment"># æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†èµ„æºï¼Œå¯ä¸ selector åŒ¹é…</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span>                        <span class="comment"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class="line"><span class="attr">spec:</span>                                <span class="comment"># é…ç½®é¡¹</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span>                        <span class="comment"># å‰¯æœ¬æ•°ï¼Œè¡¨ç¤ºå¸Œæœ›è¿è¡Œå¤šå°‘ä¸ª Pod å®ä¾‹</span></span><br><span class="line">  <span class="attr">selector:</span>                          <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>                     <span class="comment"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span>                     <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š Deployment ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class="line">  <span class="attr">strategy:</span> &#123;&#125;                       <span class="comment"># âœ… å¯çœç•¥ï¼Œè¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„æ»šåŠ¨æ›´æ–°ç­–ç•¥</span></span><br><span class="line">  <span class="attr">template:</span>                          <span class="comment"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">creationTimestamp:</span> <span class="literal">null</span>        <span class="comment"># âœ… å¯çœç•¥ï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨å¡«å……</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span>                   <span class="comment"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx</span>                 <span class="comment"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ nginx é•œåƒ</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span>                  <span class="comment"># å®¹å™¨çš„åç§°</span></span><br><span class="line">        <span class="attr">resources:</span> &#123;&#125;                <span class="comment"># âœ… å¯çœç•¥ï¼Œè¡¨ç¤ºæœªè®¾ç½®èµ„æºè¯·æ±‚/é™åˆ¶</span></span><br><span class="line"><span class="attr">status:</span> &#123;&#125;                           <span class="comment"># âœ… å¯çœç•¥ï¼ŒçŠ¶æ€ä¿¡æ¯ç”± Kubernetes ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ</span></span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">yaml æ–‡ä»¶ä¸­ï¼Œå‡ºç°äº† <code>metadata.labels</code>,<code>spec.selector.matchLabels</code> ä»¥åŠ <code>template.metadata.labels</code>ï¼Œä¸‰è€…æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</li></ul><ol><li class="lvl-3">metadata.labelsï¼ˆDeployment çš„æ ‡ç­¾ï¼‰</li></ol><blockquote><p>ç»™ Deployment æœ¬èº« æ‰“çš„æ ‡ç­¾, å’Œ Pod æ²¡æœ‰ç›´æ¥ç®¡ç†å…³ç³»<br>å¸¸ç”¨äºèµ„æºåˆ†ç»„ã€æŸ¥æ‰¾ï¼ˆæ¯”å¦‚ï¼škubectl get deploy -l app=nginxï¼‰</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span>   <span class="comment"># å±äºè¿™ä¸ª Deployment çš„â€œæ ‡ç­¾â€ï¼Œåªæ˜¯æ ‡è¯†å®ƒè‡ªå·±</span></span><br></pre></td></tr></table></figure><ol start="2"><li class="lvl-3"><p>spec.selector.matchLabelsï¼ˆé€‰æ‹©å™¨ï¼‰</p></li></ol><blockquote><p>æŒ‡å®š Deployment è¦ç®¡ç†å“ªäº› Pod<br>å¿…é¡»ç²¾ç¡®åŒ¹é… Pod çš„æ ‡ç­¾<br>å†³å®š Deployment ä¼šä¸ä¼šâ€œæ¥ç®¡â€æŸäº› Pod</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure><ol start="3"><li class="lvl-3"><p>template.metadata.labelsï¼ˆæ¨¡æ¿ä¸­çš„ Pod æ ‡ç­¾ï¼‰</p></li></ol><blockquote><p>Pod æ¨¡æ¿ä¸­å®šä¹‰çš„æ ‡ç­¾<br>Deployment æŒ‰è¿™ä¸ªæ¨¡æ¿åˆ›å»º Pod<br>å¿…é¡»ä¸ matchLabels å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">template:</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span>   <span class="comment"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector åŒ¹é…ï¼</span></span><br></pre></td></tr></table></figure><p>ğŸ” å…³ç³»å›¾ç¤ºæ„ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Deployment</span></span><br><span class="line"><span class="string">â”‚</span></span><br><span class="line"><span class="string">â”œâ”€</span> <span class="string">metadata.labels</span>                <span class="string">â†</span> <span class="string">Deployment</span> <span class="string">æœ¬èº«çš„æ ‡ç­¾ï¼ˆéå…³é”®ï¼‰</span></span><br><span class="line"><span class="string">â”‚</span></span><br><span class="line"><span class="string">â”œâ”€</span> <span class="string">spec.selector.matchLabels</span> <span class="string">â”€â”</span></span><br><span class="line"><span class="string">â”‚</span>                             <span class="string">â”‚</span></span><br><span class="line"><span class="string">â””â”€</span> <span class="string">spec.template.metadata.labels</span> <span class="string">â†</span> <span class="string">å¿…é¡»åŒ¹é…</span> <span class="string">selectorï¼Œæ‰èƒ½è®©</span> <span class="string">Pod</span> <span class="string">è¢«</span> <span class="string">Deployment</span> <span class="string">ç®¡ç†</span></span><br></pre></td></tr></table></figure></div><h3 id="æŸ¥çœ‹-Pod">æŸ¥çœ‹ Pod</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ Podï¼Œé»˜è®¤æ˜¾ç¤º default å‘½åç©ºé—´ä¸‹çš„ Pod</span></span><br><span class="line">kubectl get pods</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ kube-system å‘½åç©ºé—´ä¸‹çš„ Pod</span></span><br><span class="line">kubectl get pods -n kube-system</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„ Pod</span></span><br><span class="line">kubectl get pods -A</span><br><span class="line"><span class="comment"># -o wide: æ˜¾ç¤º Pod çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ­¤æ—¶ä¼šçœ‹åˆ° pod çš„ IP åœ°å€ã€èŠ‚ç‚¹åç§°ç­‰ä¿¡æ¯</span></span><br><span class="line">kubectl get pods -o wide</span><br><span class="line"><span class="comment"># æ˜¾ç¤º Pod çš„æ ‡ç­¾</span></span><br><span class="line">kubectl get pod --show-labels</span><br><span class="line"><span class="comment"># æŒ‰ Pod çš„æ ‡ç­¾è¿›ç¨‹æŸ¥è¯¢</span></span><br><span class="line">kubectl get pod -l &lt;label_name&gt;=&lt;label_value&gt;</span><br><span class="line"><span class="comment"># æŒç»­æŸ¥çœ‹ Pod çš„çŠ¶æ€ï¼Œå½“ pod çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šå®æ—¶æ˜¾ç¤º</span></span><br><span class="line">kubectl get pods -w</span><br><span class="line"><span class="comment">## çŠ¶æ€ç±»å‹</span></span><br><span class="line">- Pending: Pod å°šæœªå°±ç»ª</span><br><span class="line">- ContainerCreating: Pod æ­£åœ¨åˆ›å»ºå®¹å™¨</span><br><span class="line">- Running: Pod æ­£åœ¨è¿è¡Œ</span><br><span class="line">- Error: Pod è¿è¡Œé”™è¯¯</span><br><span class="line">- Terminating: Pod æ­£åœ¨åˆ é™¤</span><br><span class="line">- Completed: Pod æ‰§è¡Œå®Œæˆ</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-Pod-è¯¦æƒ…">æŸ¥çœ‹ Pod è¯¦æƒ…</h3><ul class="lvl-0"><li class="lvl-2"><p>å½“ pod è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ pod çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå› </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod &lt;pod-name&gt;</span><br><span class="line">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ’æŸ¥åŸå› æ—¶ä¸»è¦è§‚å¯Ÿæœ€åçš„ Eventsï¼Œä»ä¸Šåˆ°ä¸‹å°±æ˜¯ Pod çš„è¿è¡Œè¿‡ç¨‹</span></span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age        From               Message</span><br><span class="line">  ----    ------     ----       ----               -------</span><br><span class="line">  <span class="comment"># è¢«è°ƒåº¦å™¨åˆ†é…åˆ° k8s-worker2 èŠ‚ç‚¹</span></span><br><span class="line">  Normal  Scheduled  4s         default-scheduler  Successfully assigned default/nginx to k8s-worker2</span><br><span class="line">  <span class="comment"># å¼€å§‹æ‹‰å–é•œåƒ</span></span><br><span class="line">  Normal  Pulling    &lt;invalid&gt;  kubelet            Pulling image <span class="string">&quot;nginx&quot;</span></span><br><span class="line">  <span class="comment"># é•œåƒæ‹‰å–æˆåŠŸ</span></span><br><span class="line">  Normal  Pulled     &lt;invalid&gt;  kubelet            Successfully pulled image <span class="string">&quot;nginx&quot;</span> <span class="keyword">in</span> 2.067s (2.067s including waiting). Image size: 72225394 bytes.</span><br><span class="line">  <span class="comment"># å¼€å§‹åˆ›å»ºå®¹å™¨</span></span><br><span class="line">  Normal  Created    &lt;invalid&gt;  kubelet            Created container: nginx</span><br><span class="line">  <span class="comment"># å®¹å™¨å¯åŠ¨æˆåŠŸ</span></span><br><span class="line">  Normal  Started    &lt;invalid&gt;  kubelet            Started container nginx</span><br></pre></td></tr></table></figure><h3 id="è¿›å…¥å®¹å™¨">è¿›å…¥å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl exec -it &lt;pod-name&gt; -n &lt;namespace-name&gt; -- &lt;command&gt;</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it nginx  -- /bin/bash</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤-Pod">åˆ é™¤ Pod</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod &lt;pod-name&gt;</span><br><span class="line">kubectl delete pod &lt;pod-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-Pod-æ—¥å¿—">æŸ¥çœ‹ Pod æ—¥å¿—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs &lt;pod-name&gt;</span><br><span class="line">kubectl logs pod/&lt;pod-name&gt;</span><br><span class="line">kubectl logs pod/&lt;pod-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®-Pod">è®¿é—® Pod</h3><ul class="lvl-0"><li class="lvl-2"><p>æˆ‘ä»¬åˆšåˆšåˆ›å»ºäº†ä¸€ä¸ªnginxçš„podï¼Œè¯¥å¦‚ä½•è®¿é—®å‘¢ï¼Ÿ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–podçš„ip</span></span><br><span class="line">$ k get pod -o wide</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE   IP             NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">nginx   1/1     Running   0          12m   10.244.126.8   k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ä»»æ„èŠ‚ç‚¹ä¸Šè®¿é—®ï¼Œnginx é»˜è®¤ç«¯å£æ˜¯80</span></span><br><span class="line">$ curl 10.244.126.8</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æš‚æ—¶æˆ‘ä»¬è¿˜ä¸èƒ½é€šè¿‡èŠ‚ç‚¹çš„ IP è®¿é—® Podï¼Œå› ä¸º Pod è¿è¡Œåœ¨å®¹å™¨ç½‘ç»œä¸­ï¼Œç­‰æˆ‘åé¢è®²è§£ deployment å’Œ service ä¹‹åï¼Œä¼šä»‹ç»å¦‚ä½•é€šè¿‡ service è®¿é—®</p></li></ul><h3 id="ä¸€ä¸ª-Pod-è¿è¡Œå¤šä¸ªå®¹å™¨">ä¸€ä¸ª Pod è¿è¡Œå¤šä¸ªå®¹å™¨</h3><ul class="lvl-0"><li class="lvl-2"><p>yaml æ–‡ä»¶</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">multi-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">tomcat</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œ pod</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f multi_pod.yaml</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹è¿è¡Œç»“æœ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œçœ‹åˆ°ï¼ŒREADY é‡Œæœ‰ä¸¤ä¸ªï¼Œè¡¨ç¤ºä¸¤ä¸ªå®¹å™¨éƒ½è¿è¡ŒæˆåŠŸ</span></span><br><span class="line">$ kubectl get pods -owide</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE    IP              NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">multi-pod   2/2     Running   0          118s   10.244.194.81   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è®¿é—®nginxå’Œtomcat</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¿é—®nginxï¼Œngxiné»˜è®¤ç«¯å£æ˜¯80</span></span><br><span class="line">curl http://10.244.194.81</span><br><span class="line"><span class="comment"># è®¿é—®tomcatï¼Œtomcaté»˜è®¤ç«¯å£æ˜¯8080ï¼Œå› ä¸ºtomcatçš„webappæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥çœ‹åˆ°404å°±è¯´æ˜æ­£å¸¸</span></span><br><span class="line">curl http://10.244.194.81:8080</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥nginxå®¹å™¨ï¼Œ-c æŒ‡å®šå®¹å™¨åç§°</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it multi-pod -c nginx -- /bin/bash</span><br><span class="line"><span class="comment">## è¿›å…¥nginxå®¹å™¨åè®¿é—®tomcatå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œè¯´æ˜åŒä¸€ä¸ªpodä¸­çš„å®¹å™¨å…±äº«èµ„æº</span></span><br><span class="line">curl http://localhost:8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥tomcatå®¹å™¨</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it multi-pod -c tomcat -- /bin/bash</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ Podï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/&quot;&gt;k8s Pod ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ Namespace</title>
    <link href="https://blog.hanqunfeng.com/2025/07/02/k8s-namespace/"/>
    <id>https://blog.hanqunfeng.com/2025/07/02/k8s-namespace/</id>
    <published>2025-07-02T13:30:05.000Z</published>
    <updated>2025-07-02T10:56:45.570Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ Namespaceï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/namespaces/">k8s Namespace ä»‹ç»</a></p></li></ul><span id="more"></span><h2 id="å‘½åç©ºé—´-Namespace-ä»‹ç»">å‘½åç©ºé—´(Namespace) ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ Kubernetes ä¸­ï¼Œå‘½åç©ºé—´æä¾›äº†ä¸€ç§åœ¨å•ä¸ªé›†ç¾¤ä¸­éš”ç¦»èµ„æºç»„çš„æœºåˆ¶ã€‚èµ„æºåç§°åœ¨å‘½åç©ºé—´å†…éœ€è¦å”¯ä¸€ï¼Œä½†ä¸éœ€è¦è·¨å‘½åç©ºé—´å”¯ä¸€ã€‚</p></li><li class="lvl-2"><p>åŸºäºå‘½åç©ºé—´çš„ä½œç”¨åŸŸä»…é€‚ç”¨äºå‘½åç©ºé—´å¯¹è±¡ ï¼ˆä¾‹å¦‚ï¼ŒDeploymentsã€Services ç­‰ï¼‰ï¼Œè€Œä¸é€‚ç”¨äºé›†ç¾¤èŒƒå›´çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ StorageClassã€Nodesã€PersistentVolumes ç­‰ï¼‰ã€‚</p></li><li class="lvl-2"><p>Namespace æ˜¯åœ¨å¤šä¸ªç”¨æˆ·ä¹‹é—´åˆ’åˆ†é›†ç¾¤èµ„æºçš„ä¸€ç§æ–¹æ³•ï¼Œé€‚ç”¨äºè·¨å¤šä¸ªå›¢é˜Ÿæˆ–é¡¹ç›®çš„åœºæ™¯ï¼ŒNamespace ä¸èƒ½ç›¸äº’åµŒå¥—ï¼Œæ¯ä¸ª Kubernetes èµ„æºåªèƒ½åœ¨ä¸€ä¸ª Namespace ä¸­ã€‚</p></li><li class="lvl-2"><p>é¿å…ä½¿ç”¨å‰ç¼€ <code>kube-</code> åˆ›å»º Namespaceï¼Œå› ä¸ºå®ƒæ˜¯ä¸º Kubernetes ç³»ç»Ÿ Namespace ä¿ç•™çš„ã€‚</p></li><li class="lvl-2"><p>Kubernetes å¯åŠ¨æ—¶ä¼šåˆ›å»ºå››ä¸ªåˆå§‹ Namespaceï¼š</p></li></ul><table><thead><tr><th>åç§°ç©ºé—´åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>default</code></td><td>é»˜è®¤å‘½åç©ºé—´ï¼Œä¾›ç”¨æˆ·å¼€å§‹ä½¿ç”¨æ–°é›†ç¾¤æ—¶ç›´æ¥éƒ¨ç½²èµ„æºï¼Œæ— éœ€é¢å¤–åˆ›å»ºå‘½åç©ºé—´ã€‚</td></tr><tr><td><code>kube-node-lease</code></td><td>å­˜æ”¾ä¸å„ä¸ª Node å…³è”çš„ Leaseï¼ˆç§Ÿçº¦ï¼‰å¯¹è±¡ï¼Œç”¨äº Kubelet å‘é€å¿ƒè·³ï¼Œå¸®åŠ©æ§åˆ¶å¹³é¢æ£€æµ‹èŠ‚ç‚¹å¥åº·çŠ¶æ€ã€‚</td></tr><tr><td><code>kube-public</code></td><td>æ‰€æœ‰å®¢æˆ·ç«¯ï¼ˆåŒ…æ‹¬åŒ¿åç”¨æˆ·ï¼‰éƒ½å¯ä»¥è¯»å–ï¼Œä¸»è¦ç”¨äºé›†ç¾¤èŒƒå›´å†…éœ€è¦å…¬å¼€è®¿é—®çš„èµ„æºã€‚å…¬å…±å±æ€§æ˜¯ä¸€ç§ä½¿ç”¨çº¦å®šã€‚</td></tr><tr><td><code>kube-system</code></td><td>Kubernetes ç³»ç»Ÿç»„ä»¶ï¼ˆå¦‚ kube-dnsã€kube-proxy ç­‰ï¼‰è¿è¡Œæ‰€åœ¨çš„å‘½åç©ºé—´ã€‚ç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ã€‚</td></tr></tbody></table><h2 id="æŸ¥çœ‹é›†ç¾¤ä¸­çš„å‘½åç©ºé—´">æŸ¥çœ‹é›†ç¾¤ä¸­çš„å‘½åç©ºé—´</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># namespace å¯ä»¥ç®€å†™ä¸º ns</span></span><br><span class="line">kubectl get namespace</span><br><span class="line">kubectl get ns</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºå‘½åç©ºé—´">åˆ›å»ºå‘½åç©ºé—´</h2><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œæ–¹å¼</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create namespace &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>yaml æ–¹å¼</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>  <span class="comment"># API ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ kubectl api-resources | grep Namespace è·å–</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span> <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line"><span class="attr">metadata:</span>       <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&lt;namespace-name&gt;</span> <span class="comment"># å‘½åç©ºé—´åç§°</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f &lt;namespace.yaml&gt;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡å‘½ä»¤è¡Œç›´æ¥ç”Ÿæˆyamlæ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --dry-run=client: æœ¬åœ°æ¨¡æ‹Ÿè¿è¡Œå‘½ä»¤ï¼Œä¸ä¼šçœŸçš„æ‰§è¡Œï¼Œ-o yaml: è¾“å‡ºyamlæ ¼å¼</span></span><br><span class="line">kubectl create namespace &lt;namespace-name&gt; --dry-run=client -o yaml &gt; &lt;namespace.yaml&gt;</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤å‘½åç©ºé—´">åˆ é™¤å‘½åç©ºé—´</h2><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œæ–¹å¼</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete namespace &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>yaml æ–¹å¼</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f &lt;namespace.yaml&gt;</span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®åå­—ç©ºé—´åå¥½">è®¾ç½®åå­—ç©ºé—´åå¥½</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ä¸º defaultï¼Œå³æˆ‘ä»¬åœ¨æ‰§è¡Œ &#x27;kubbectl get pod&#x27; æ—¶ï¼Œé»˜è®¤ä¼šæŸ¥çœ‹ default è¿™ä¸ªåå­—ç©ºé—´ä¸‹çš„æ‰€æœ‰ Pod</span></span><br><span class="line">kubectl config set-context --current --namespace=&lt;namespace-name&gt;</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹èµ„æºæ—¶æŒ‡å®šå‘½åç©ºé—´">æŸ¥çœ‹èµ„æºæ—¶æŒ‡å®šå‘½åç©ºé—´</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -n &lt;namespace-name&gt;</span><br><span class="line">kubectl get service -n &lt;namespace-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„èµ„æºï¼Œ-A, --all-namespaces</span></span><br><span class="line">kubectl get pod -A</span><br><span class="line">kubectl get service -A</span><br></pre></td></tr></table></figure><h2 id="å¹¶éæ‰€æœ‰å¯¹è±¡éƒ½åœ¨åå­—ç©ºé—´ä¸­">å¹¶éæ‰€æœ‰å¯¹è±¡éƒ½åœ¨åå­—ç©ºé—´ä¸­</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½äºåå­—ç©ºé—´ä¸­çš„èµ„æº</span></span><br><span class="line">kubectl api-resources --namespaced=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸åœ¨åå­—ç©ºé—´ä¸­çš„èµ„æº</span></span><br><span class="line">kubectl api-resources --namespaced=<span class="literal">false</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>kubectl api-resources</code> è¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤è·å–æ‰€æœ‰èµ„æºçš„ <code>ç®€å†™</code>ï¼Œä¹Ÿå¯ä»¥è·å–èµ„æºçš„ <code>apiVersion</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl api-resources</span><br><span class="line">NAME: èµ„æºåç§°</span><br><span class="line">SHORTNAMES: ç®€å†™</span><br><span class="line">APIVERSION: apiVersion</span><br><span class="line">NAMESPACED: æ˜¯å¦åœ¨åå­—ç©ºé—´ä¸­</span><br><span class="line">KIND: èµ„æºç±»å‹</span><br></pre></td></tr></table></figure><h2 id="Kubernetes-ä¸­å…³äº-å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ä¸-DNS-çš„æœºåˆ¶">Kubernetes ä¸­å…³äº å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ä¸ DNS çš„æœºåˆ¶</h2><ul class="lvl-0"><li class="lvl-2"><p>Kubernetes æœåŠ¡æœ‰è‡ªåŠ¨çš„ DNS åç§°ï¼Œå®ƒå’Œå‘½åç©ºé—´æœ‰å…³ã€‚é»˜è®¤æ˜¯èƒ½åœ¨æœ¬å‘½åç©ºé—´å†…ç›´æ¥è®¿é—®ï¼›è·¨å‘½åç©ºé—´è®¿é—®éœ€è¦å†™å®Œæ•´åŸŸåï¼ˆFQDNï¼‰ã€‚</p></li><li class="lvl-2"><p>å‘½åç©ºé—´åå­—ä¸èƒ½é‡å¤ï¼Œä¸”å‘½åç©ºé—´åå­—ä¸èƒ½ä¹±èµ·ï¼Œå°¤å…¶ä¸è¦ç”¨å…¬å…±äº’è”ç½‘åŸŸååè¯ï¼ˆå¦‚ comã€orgã€netã€cn ç­‰ï¼‰ã€‚</p></li></ul><h3 id="ä¸¾ä¸ªä¾‹å­è¯´æ˜æœåŠ¡-DNS-æ˜¯æ€ä¹ˆå·¥ä½œçš„">ä¸¾ä¸ªä¾‹å­è¯´æ˜æœåŠ¡ DNS æ˜¯æ€ä¹ˆå·¥ä½œçš„</h3><ul class="lvl-0"><li class="lvl-2"><p>åœºæ™¯ï¼šä½ åœ¨ä¸¤ä¸ªå‘½åç©ºé—´ä¸­éƒ¨ç½²äº†ä¸¤ä¸ª nginx æœåŠ¡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½åç©ºé—´ dev ä¸­åˆ›å»ºæœåŠ¡ nginx</span></span><br><span class="line">kubectl create ns dev</span><br><span class="line">kubectl create deployment nginx --image=nginx --replicas=2 -n dev</span><br><span class="line">kubectl expose deployment nginx --port=80 --<span class="built_in">type</span>=NodePort -n dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘½åç©ºé—´ prod ä¸­ä¹Ÿåˆ›å»ºæœåŠ¡ nginx</span></span><br><span class="line">kubectl create ns prod</span><br><span class="line">kubectl create deployment nginx --image=nginx --replicas=2 -n prod</span><br><span class="line">kubectl expose deployment nginx --port=80 --<span class="built_in">type</span>=NodePort -n prod</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>1ï¸âƒ£ å¦‚æœä½ åœ¨ dev å‘½åç©ºé—´çš„ Pod é‡Œè®¿é—®å¦‚ä¸‹è¯·æ±‚ï¼Œå®ƒå®é™…è§£æçš„ DNS æ˜¯ <code>nginx.dev.svc.cluster.local</code>ï¼Œä¹Ÿå°±æ˜¯ <code>&lt;æœåŠ¡å&gt;.&lt;å‘½åç©ºé—´&gt;.svc.cluster.local</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://nginx</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>2ï¸âƒ£ å¦‚æœä½ æƒ³ä» dev å‘½åç©ºé—´è®¿é—® prod å‘½åç©ºé—´çš„ nginx æœåŠ¡ï¼Œä½ å¿…é¡»è¿™æ ·è®¿é—®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://nginx.prod.svc.cluster.local</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ Namespaceï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/namespaces/&quot;&gt;k8s Namespace ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>Linux å®‰è£… K8S ä¹‹ sealos</title>
    <link href="https://blog.hanqunfeng.com/2025/07/01/k8s-install-sealos/"/>
    <id>https://blog.hanqunfeng.com/2025/07/01/k8s-install-sealos/</id>
    <published>2025-07-01T13:30:05.000Z</published>
    <updated>2025-07-02T03:14:34.095Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Linux ä¸‹ ä½¿ç”¨ sealos å®‰è£… K8S çš„æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://sealos.run/docs/k8s/quick-start/deploy-kubernetes">sealoså®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/labring/sealos">sealos Github</a></p></li></ul><span id="more"></span><h2 id="å®‰è£…å‰è®¾ç½®-æ‰€æœ‰èŠ‚ç‚¹">å®‰è£…å‰è®¾ç½®(æ‰€æœ‰èŠ‚ç‚¹)</h2><ul class="lvl-0"><li class="lvl-2"><p>å‡†å¤‡ä¸‰å°å¯ä»¥è¿æ¥å¤–ç½‘çš„ä¸»æœºï¼Œä¸è¦å®‰è£…docker,k8sç­‰ï¼Œå¦‚å·²å®‰è£…éœ€å…ˆå¸è½½</p></li><li class="lvl-2"><p>(æ¨è)å‡çº§ç³»ç»Ÿå†…æ ¸ï¼Œæœ¬æ–‡ä¸­éå¿…é¡»ï¼Œå‡çº§å†…æ ¸æ–¹æ³•å‚çœ‹ <a href="/2025/06/29/k8s-install-kubeadm/" title="Linux å®‰è£… K8S ä¹‹ kubeadm">Linux å®‰è£… K8S ä¹‹ kubeadm</a></p></li></ul><h3 id="æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹åº”è¯¥æœ‰ä¸åŒçš„ä¸»æœºåï¼Œä¸»æœºåä¸è¦å¸¦ä¸‹åˆ’çº¿">æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹åº”è¯¥æœ‰ä¸åŒçš„ä¸»æœºåï¼Œä¸»æœºåä¸è¦å¸¦ä¸‹åˆ’çº¿</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ä¸»æœºåæ˜ å°„: vi /etc/hosts</span></span><br><span class="line">10.211.55.12 k8s-m1</span><br><span class="line">10.211.55.13 k8s-w1</span><br><span class="line">10.211.55.14 k8s-w2</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ­£ç³»ç»Ÿçš„æ—¶é—´">ä¿®æ­£ç³»ç»Ÿçš„æ—¶é—´</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…chrony</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install chrony -y</span><br><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now chronyd</span><br><span class="line"><span class="comment"># ä¿®æ­£æ—¶é—´</span></span><br><span class="line"><span class="built_in">sudo</span> chronyc makestep</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¶é—´</span></span><br><span class="line"><span class="built_in">date</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-sealos">å®‰è£… sealos</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½</span></span><br><span class="line">wget https://github.com/labring/sealos/releases/download/v5.0.1/sealos_5.0.1_linux_amd64.rpm</span><br><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">yum install -y sealos_5.0.1_linux_amd64.rpm</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£… sealos çš„è‡ªåŠ¨è¡¥å…¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;source &lt;(sealos completion bash)&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºk8sé›†ç¾¤-master">åˆ›å»ºk8sé›†ç¾¤(master)</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºé›†ç¾¤: ä½¿ç”¨sealosåˆ›å»ºé›†ç¾¤åªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼Œç›®å‰å®˜ç½‘ç¤ºä¾‹ä¸­çš„k8sç‰ˆæœ¬ä¸ºv1.29.9(å°ç‰ˆæœ¬å·è¶Šé«˜è¶Šç¨³å®š)</p></li><li class="lvl-2"><p>å¯ä»¥åœ¨<a href="https://hub.docker.com">docker hub</a>ä¸ŠæŸ¥è¯¢ï¼Œæˆ–è€…ä½¿ç”¨ <a href="https://explore.ggcr.dev/">Registry Explorer</a> æŸ¥çœ‹å¦‚ä¸‹é•œåƒçš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œä¸å»ºè®®ä½¿ç”¨å¤ªé«˜çš„ç‰ˆæœ¬ï¼Œæœ‰å¯èƒ½å®‰è£…å¤±è´¥ã€‚</p></li><li class="lvl-2"><p>æ³¨æ„ sealos ä¸ kubernetes çš„ç‰ˆæœ¬æœ‰å¯¹åº”å…³ç³»ï¼Œç›®å‰ <code>Sealos &gt;=v5.0.0</code> å¯¹åº”çš„ <code>K8s &gt;=1.28</code>ï¼Œå…·ä½“å¯ä»¥ä»<a href="https://sealos.run/docs/k8s/quick-start/deploy-kubernetes">sealoså®˜ç½‘</a>æŸ¥è¯¢</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å›½å†…å¯ä»¥åœ¨é•œåƒå‰é¢åŠ ä¸Š registry.cn-shanghai.aliyuncs.com/</span></span><br><span class="line"><span class="comment"># sealos æ¨èçš„ç½‘ç»œæ¥å£æ˜¯ cilium</span></span><br><span class="line">$ sealos run labring/kubernetes:v1.29.9 labring/helm:v3.9.4 labring/cilium:v1.13.4 \</span><br><span class="line">     --masters 10.211.55.12 \</span><br><span class="line">     --nodes 10.211.55.13,10.211.55.14 -p [your-ssh-passwd]</span><br><span class="line"></span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># -masters: æŒ‡å®š master èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä½†å¿…é¡»æ˜¯å¥‡æ•°</span></span><br><span class="line"><span class="comment"># -nodes: æŒ‡å®š worker èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚</span></span><br><span class="line"><span class="comment"># -p, --passwd: æŒ‡å®š SSH ç™»å½•å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## å®‰è£…æˆåŠŸä¼šæ˜¾ç¤ºå¦‚ä¸‹å†…å®¹</span></span><br><span class="line">â„¹ï¸  Using Cilium version 1.13.4</span><br><span class="line">ğŸ”® Auto-detected cluster name: kubernetes</span><br><span class="line">ğŸ”® Auto-detected datapath mode: tunnel</span><br><span class="line">ğŸ”® Auto-detected kube-proxy has been installed</span><br><span class="line">2025-07-01T16:59:27 info succeeded <span class="keyword">in</span> creating a new cluster, enjoy it!</span><br><span class="line">2025-07-01T16:59:27 info</span><br><span class="line">      ___           ___           ___           ___       ___           ___</span><br><span class="line">     /\  \         /\  \         /\  \         /\__\     /\  \         /\  \</span><br><span class="line">    /::\  \       /::\  \       /::\  \       /:/  /    /::\  \       /::\  \</span><br><span class="line">   /:/\ \  \     /:/\:\  \     /:/\:\  \     /:/  /    /:/\:\  \     /:/\ \  \</span><br><span class="line">  _\:\~\ \  \   /::\~\:\  \   /::\~\:\  \   /:/  /    /:/  \:\  \   _\:\~\ \  \</span><br><span class="line"> /\ \:\ \ \__\ /:/\:\ \:\__\ /:/\:\ \:\__\ /:/__/    /:/__/ \:\__\ /\ \:\ \ \__\</span><br><span class="line"> \:\ \:\ \/__/ \:\~\:\ \/__/ \/__\:\/:/  / \:\  \    \:\  \ /:/  / \:\ \:\ \/__/</span><br><span class="line">  \:\ \:\__\    \:\ \:\__\        \::/  /   \:\  \    \:\  /:/  /   \:\ \:\__\</span><br><span class="line">   \:\/:/  /     \:\ \/__/        /:/  /     \:\  \    \:\/:/  /     \:\/:/  /</span><br><span class="line">    \::/  /       \:\__\         /:/  /       \:\__\    \::/  /       \::/  /</span><br><span class="line">     \/__/         \/__/         \/__/         \/__/     \/__/         \/__/</span><br><span class="line"></span><br><span class="line">                  Website: https://www.sealos.io/</span><br><span class="line">                  Address: github.com/labring/sealos</span><br><span class="line">                  Version: 5.0.1-2b74a1281</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ç”¨ shell è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å®‰è£… bash-completion</span></span><br><span class="line"><span class="comment"># 1.1 æ£€æŸ¥bash-completionæ˜¯å¦å·²å®‰è£…ï¼Œæœ‰è¾“å‡ºè¯´æ˜å·²ç»å®‰è£…</span></span><br><span class="line">$ <span class="built_in">type</span> _init_completion</span><br><span class="line"><span class="comment"># 1.2 å®‰è£…bash-completionï¼Œå®‰è£…åä¼šåˆ›å»ºæ–‡ä»¶ /usr/share/bash-completion/bash_completion</span></span><br><span class="line">$ dnf install bash-completion</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å®‰è£… kubectl çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</span></span><br><span class="line"><span class="comment"># 2.1 å½“å‰ç”¨æˆ·</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;source &lt;(kubectl completion bash)&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="comment"># 2.2 æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line">kubectl completion bash | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/bash_completion.d/kubectl &gt; /dev/null</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> a+r /etc/bash_completion.d/kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 å¦‚æœ kubectl æœ‰å…³è”çš„åˆ«åï¼Œä½ å¯ä»¥æ‰©å±• Shell è¡¥å…¨æ¥é€‚é…æ­¤åˆ«å</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;alias k=kubectl&#x27;</span> &gt;&gt;~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;complete -o default -F __start_kubectl k&#x27;</span> &gt;&gt;~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åˆ·æ–°é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºé›†ç¾¤æˆåŠŸåï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line">$ kubectl version</span><br><span class="line">Client Version: v1.29.9</span><br><span class="line">Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3</span><br><span class="line">Server Version: v1.29.9</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹</span></span><br><span class="line">$ kubectl get nodes -owide</span><br><span class="line">NAME     STATUS   ROLES           AGE     VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                            KERNEL-VERSION             CONTAINER-RUNTIME</span><br><span class="line">k8s-m1   Ready    control-plane   3m11s   v1.29.9   10.211.55.12   &lt;none&gt;        Rocky Linux 8.10 (Green Obsidian)   4.18.0-553.el8_10.x86_64   containerd://1.7.27</span><br><span class="line">k8s-w1   Ready    &lt;none&gt;          2m52s   v1.29.9   10.211.55.13   &lt;none&gt;        Rocky Linux 8.10 (Green Obsidian)   4.18.0-553.el8_10.x86_64   containerd://1.7.27</span><br><span class="line">k8s-w2   Ready    &lt;none&gt;          2m55s   v1.29.9   10.211.55.14   &lt;none&gt;        Rocky Linux 8.10 (Green Obsidian)   4.18.0-553.el8_10.x86_64   containerd://1.7.27</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹èµ„æº</span></span><br><span class="line">$ kubectl get all -A -owide</span><br><span class="line">NAMESPACE     NAME                                   READY   STATUS    RESTARTS   AGE     IP             NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">kube-system   pod/cilium-bbbdl                       1/1     Running   0          3m47s   10.211.55.13   k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/cilium-cz47k                       1/1     Running   0          3m47s   10.211.55.14   k8s-w2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/cilium-operator-6946ccbcc5-cxnn4   1/1     Running   0          3m47s   10.211.55.13   k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/cilium-vfc22                       1/1     Running   0          3m47s   10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/coredns-76f75df574-2ln5x           1/1     Running   0          3m54s   10.0.0.74      k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/coredns-76f75df574-plsds           1/1     Running   0          3m54s   10.0.0.146     k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/etcd-k8s-m1                        1/1     Running   0          4m6s    10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-apiserver-k8s-m1              1/1     Running   0          4m6s    10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-controller-manager-k8s-m1     1/1     Running   0          4m6s    10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-proxy-4xbzt                   1/1     Running   0          3m51s   10.211.55.13   k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-proxy-rjs8h                   1/1     Running   0          3m54s   10.211.55.14   k8s-w2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-proxy-xv4fg                   1/1     Running   0          3m55s   10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-scheduler-k8s-m1              1/1     Running   0          4m6s    10.211.55.12   k8s-m1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-sealos-lvscare-k8s-w1         1/1     Running   0          3m31s   10.211.55.13   k8s-w1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   pod/kube-sealos-lvscare-k8s-w2         1/1     Running   0          3m34s   10.211.55.14   k8s-w2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">NAMESPACE     NAME                  TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE     SELECTOR</span><br><span class="line">default       service/kubernetes    ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP                  4m8s    &lt;none&gt;</span><br><span class="line">kube-system   service/hubble-peer   ClusterIP   10.96.1.9    &lt;none&gt;        443/TCP                  3m47s   k8s-app=cilium</span><br><span class="line">kube-system   service/kube-dns      ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   4m7s    k8s-app=kube-dns</span><br><span class="line"></span><br><span class="line">NAMESPACE     NAME                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE     CONTAINERS     IMAGES                               SELECTOR</span><br><span class="line">kube-system   daemonset.apps/cilium       3         3         3       3            3           kubernetes.io/os=linux   3m47s   cilium-agent   quay.io/cilium/cilium:v1.13.4        k8s-app=cilium</span><br><span class="line">kube-system   daemonset.apps/kube-proxy   3         3         3       3            3           kubernetes.io/os=linux   4m7s    kube-proxy     registry.k8s.io/kube-proxy:v1.29.9   k8s-app=kube-proxy</span><br><span class="line"></span><br><span class="line">NAMESPACE     NAME                              READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS        IMAGES                                    SELECTOR</span><br><span class="line">kube-system   deployment.apps/cilium-operator   1/1     1            1           3m47s   cilium-operator   quay.io/cilium/operator:v1.13.4           io.cilium/app=operator,name=cilium-operator</span><br><span class="line">kube-system   deployment.apps/coredns           2/2     2            2           4m7s    coredns           registry.k8s.io/coredns/coredns:v1.11.1   k8s-app=kube-dns</span><br><span class="line"></span><br><span class="line">NAMESPACE     NAME                                         DESIRED   CURRENT   READY   AGE     CONTAINERS        IMAGES                                    SELECTOR</span><br><span class="line">kube-system   replicaset.apps/cilium-operator-6946ccbcc5   1         1         1       3m47s   cilium-operator   quay.io/cilium/operator:v1.13.4           io.cilium/app=operator,name=cilium-operator,pod-template-hash=6946ccbcc5</span><br><span class="line">kube-system   replicaset.apps/coredns-76f75df574           2         2         2       3m54s   coredns           registry.k8s.io/coredns/coredns:v1.11.1   k8s-app=kube-dns,pod-template-hash=76f75df574</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•ï¼šç”¨K8Séƒ¨ç½²Nginx">æµ‹è¯•ï¼šç”¨K8Séƒ¨ç½²Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºdeployment</span></span><br><span class="line">kubectl create deployment nginx --image=nginx</span><br><span class="line"><span class="comment"># åˆ›å»ºserviceï¼Œ--typeæŒ‡å®šä¸ºNodePortï¼Œå…¶å«ä¹‰ä¸ºå°†deploymentçš„80ç«¯å£æ˜ å°„åˆ°Nodeçš„éšæœºç«¯å£</span></span><br><span class="line">kubectl expose deployment nginx --<span class="built_in">type</span>=NodePort --port=80</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹podå’Œserviceï¼Œä¸åŠ  -n å‚æ•°ï¼Œé»˜è®¤æŸ¥çœ‹çš„æ˜¯defaultå‘½åç©ºé—´</span></span><br><span class="line">$ k get pods,svc -owide</span><br><span class="line">NAME                         READY   STATUS    RESTARTS   AGE   IP           NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">pod/nginx-7854ff8877-wgfxc   1/1     Running   0          19s   10.0.1.204   k8s-w2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE   SELECTOR</span><br><span class="line">service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP        44m   &lt;none&gt;</span><br><span class="line">service/nginx        NodePort    10.96.2.54   &lt;none&gt;        80:31044/TCP   5s    app=nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµè§ˆå™¨è®¿é—®ä»»æ„nodeIP:31044</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æµ‹è¯•èµ„æº</span></span><br><span class="line"><span class="comment">## åˆ é™¤deployment</span></span><br><span class="line">kubectl delete deployment nginx</span><br><span class="line"><span class="comment">## åˆ é™¤service</span></span><br><span class="line">kubectl delete service nginx</span><br></pre></td></tr></table></figure><h2 id="sealos-å‘½ä»¤">sealos å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p>sealos å‘½ä»¤æ¦‚è§ˆ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Cluster Management Commands:</span><br><span class="line">  apply         ä½¿ç”¨ Clusterfile åœ¨ Kubernetes é›†ç¾¤ä¸­è¿è¡Œäº‘é•œåƒ</span><br><span class="line">  cert          æ›´æ–° Kubernetes API Server çš„è¯ä¹¦</span><br><span class="line">  run           è½»æ¾è¿è¡Œäº‘åŸç”Ÿåº”ç”¨ï¼Œå¯ç”¨äºå·²æœ‰æˆ–æ–°å»ºé›†ç¾¤</span><br><span class="line">  reset         é‡ç½®é›†ç¾¤ä¸­çš„æ‰€æœ‰å†…å®¹</span><br><span class="line">  status        æŸ¥çœ‹ sealos çš„çŠ¶æ€</span><br><span class="line"></span><br><span class="line">Node Management Commands:</span><br><span class="line">  add           å‘é›†ç¾¤ä¸­æ·»åŠ èŠ‚ç‚¹</span><br><span class="line">  delete        ä»é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line">Remote Operation Commands:</span><br><span class="line">  <span class="built_in">exec</span>          åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ‰§è¡Œ shell å‘½ä»¤æˆ–è„šæœ¬</span><br><span class="line">  scp           å°†æ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šèŠ‚ç‚¹çš„è¿œç¨‹ä¸»æœºä¸Š</span><br><span class="line"></span><br><span class="line">Experimental Commands:</span><br><span class="line">  registry      ä¸é•œåƒä»“åº“ç›¸å…³çš„å®éªŒæ€§åŠŸèƒ½</span><br><span class="line"></span><br><span class="line">Container and Image Commands:</span><br><span class="line">  build         æ ¹æ® Containerfile æˆ– Kubefile æ„å»ºé•œåƒ</span><br><span class="line">  create        åˆ›å»ºé›†ç¾¤ä½†ä¸æ‰§è¡Œå‘½ä»¤ï¼Œç”¨äºæ£€æŸ¥é•œåƒ</span><br><span class="line">  diff          æŸ¥çœ‹å¯¹è±¡æ–‡ä»¶ç³»ç»Ÿçš„æ›´æ”¹</span><br><span class="line">  inspect       æ£€æŸ¥å®¹å™¨æˆ–é•œåƒçš„é…ç½®ä¿¡æ¯</span><br><span class="line">  images        åˆ—å‡ºæœ¬åœ°å­˜å‚¨ä¸­çš„é•œåƒ</span><br><span class="line">  load          ä»å½’æ¡£æ–‡ä»¶åŠ è½½é•œåƒ</span><br><span class="line">  login         ç™»å½•åˆ°å®¹å™¨é•œåƒä»“åº“</span><br><span class="line">  <span class="built_in">logout</span>        ç™»å‡ºå®¹å™¨é•œåƒä»“åº“</span><br><span class="line">  manifest      æ“ä½œ manifest åˆ—è¡¨å’Œé•œåƒç´¢å¼•</span><br><span class="line">  merge         åˆå¹¶å¤šä¸ªé•œåƒä¸ºä¸€ä¸ª</span><br><span class="line">  pull          ä»æŒ‡å®šä½ç½®æ‹‰å–é•œåƒ</span><br><span class="line">  push          å°†é•œåƒæ¨é€åˆ°æŒ‡å®šç›®æ ‡</span><br><span class="line">  rmi           ä»æœ¬åœ°åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ</span><br><span class="line">  save          å°†é•œåƒä¿å­˜ä¸ºå½’æ¡£æ–‡ä»¶</span><br><span class="line">  tag           ä¸ºæœ¬åœ°é•œåƒæ·»åŠ é¢å¤–çš„åç§°æ ‡ç­¾</span><br><span class="line"></span><br><span class="line">Other Commands:</span><br><span class="line">  completion    ç”ŸæˆæŒ‡å®š shell çš„è‡ªåŠ¨è¡¥å…¨è„šæœ¬</span><br><span class="line">  docs          ç”Ÿæˆ API å‚è€ƒæ–‡æ¡£</span><br><span class="line">  <span class="built_in">env</span>           è¾“å‡º sealos ä½¿ç”¨çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ä¿¡æ¯</span><br><span class="line">  gen           ç”ŸæˆåŒ…å«é»˜è®¤è®¾ç½®çš„ Clusterfile</span><br><span class="line">  version       æ‰“å°ç‰ˆæœ¬ä¿¡æ¯</span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤ç®¡ç†-masterèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤">é›†ç¾¤ç®¡ç†(masterèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤)</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºé›†ç¾¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sealos run labring/kubernetes:v1.29.9 labring/helm:v3.9.4 labring/cilium:v1.13.4 \</span><br><span class="line">     --masters 10.211.55.12 \</span><br><span class="line">     --nodes 10.211.55.13,10.211.55.14 -p [your-ssh-passwd]</span><br><span class="line"></span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line">-masters: æŒ‡å®š master èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä½†å¿…é¡»æ˜¯å¥‡æ•°</span><br><span class="line">-nodes: æŒ‡å®š worker èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚</span><br><span class="line">-p, --passwd: æŒ‡å®š SSH ç™»å½•å¯†ç </span><br><span class="line">-u, --user: ç™»å½•ç”¨æˆ·åï¼Œé»˜è®¤ä¸º root</span><br><span class="line">-i, --pk=<span class="string">&#x27;/root/.ssh/id_rsa&#x27;</span>: æŒ‡å®š SSH å¯†é’¥æ–‡ä»¶è·¯å¾„</span><br><span class="line">--port: æŒ‡å®š SSH ç«¯å£ï¼Œé»˜è®¤ä¸º 22</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Clusterfile æ–¹å¼åˆ›å»ºé›†ç¾¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆé›†ç¾¤é…ç½®æ–‡ä»¶ï¼ŒClusterfileå°±æ˜¯ä¸€ä¸ªyamlæ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«é›†ç¾¤çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line">sealos gen labring/kubernetes:v1.29.9 labring/helm:v3.9.4 labring/cilium:v1.13.4 \</span><br><span class="line">     --masters 10.211.55.12 \</span><br><span class="line">     --nodes 10.211.55.13,10.211.55.14 -p [your-ssh-passwd] &gt; Clusterfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œé…ç½®æ–‡ä»¶</span></span><br><span class="line">sealos apply -f Clusterfile</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sealos status</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ¸…é™¤K8sé›†ç¾¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sealos reset</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ›´æ–° Kubernetes API æœåŠ¡å™¨çš„è¯ä¹¦</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sealos åˆ›å»ºçš„è¯ä¹¦å­˜æ”¾åœ¨ /etc/kubernetes/pki/ ä¸‹ï¼Œé»˜è®¤è¯ä¹¦æœ‰æ•ˆæœŸä¸º 100 å¹´</span></span><br><span class="line"><span class="comment"># æ›´æ–°è¯ä¹¦ä¸€èˆ¬åªä¼šåœ¨æ·»åŠ æ–°çš„è®¿é—®ipæˆ–åŸŸåæ—¶æ‰éœ€è¦</span></span><br><span class="line">sealos cert --alt-names apiserver.cluster.local,10.211.55.12,127.0.0.1,localhost</span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># --alt-names: æ·»åŠ æ–°çš„è®¿é—®ipæˆ–åŸŸåï¼Œå¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class="line"><span class="comment"># -c, --cluster=&#x27;default&#x27;: è¦æ‰§è¡Œ exec æ“ä½œçš„é›†ç¾¤çš„åç§°ã€‚é»˜è®¤ä¸º defaultã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°è¯ä¹¦åï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ ¡éªŒï¼š</span></span><br><span class="line">kubectl -n kube-system get cm kubeadm-config -o yaml</span><br><span class="line">openssl x509 -<span class="keyword">in</span> /etc/kubernetes/pki/apiserver.crt -text</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æ‰§è¡Œæ­¤æ“ä½œä¹‹å‰ï¼Œä½ æœ€å¥½å…ˆå¤‡ä»½æ—§çš„è¯ä¹¦ã€‚<br>æ‰§è¡Œ sealos cert å‘½ä»¤åï¼Œä¼šæ›´æ–°é›†ç¾¤ API æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œä½ æ— éœ€æ‰‹åŠ¨é‡å¯ API æœåŠ¡å™¨ï¼Œsealosä¼šè‡ªåŠ¨å¸®ä½ é‡å¯æœåŠ¡ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ç¯å¢ƒå˜é‡</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -v æ˜¾ç¤ºå˜é‡çš„è¯´æ˜</span></span><br><span class="line">sealos <span class="built_in">env</span> -v</span><br><span class="line"><span class="comment">## è¯´æ˜</span></span><br><span class="line">SEALOS_PROMPT=enabled <span class="comment"># æ˜¯å¦å¯ç”¨ç»ˆç«¯ä¸­çš„äº¤äº’æç¤ºåŠŸèƒ½ã€‚</span></span><br><span class="line">SEALOS_RUNTIME_ROOT=/root/.sealos <span class="comment"># Sealos çš„è¿è¡Œæ—¶æ ¹ç›®å½•ï¼Œç”¨äºæŒä¹…åŒ–è¿è¡Œç›¸å…³çš„æ“ä½œæˆ–é…ç½®ã€‚</span></span><br><span class="line">SEALOS_DATA_ROOT=/var/lib/sealos  <span class="comment"># é›†ç¾¤åœ¨è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„æ ¹ç›®å½•è·¯å¾„ï¼Œç”¨äºå­˜å‚¨é›†ç¾¤ç›¸å…³çš„æ•°æ®ã€‚</span></span><br><span class="line">BUILDAH_FORMAT=oci <span class="comment"># é•œåƒæ„å»ºæ—¶ä½¿ç”¨çš„æ ¼å¼ï¼Œ`oci` è¡¨ç¤ºç¬¦åˆ OCI é•œåƒè§„èŒƒã€‚</span></span><br><span class="line">BUILDAH_LOG_LEVEL= <span class="comment"># buildah æ¨¡å—ä¸­ä½¿ç”¨çš„æ—¥å¿—çº§åˆ«ï¼Œå¯ä»¥æ˜¯ &quot;trace&quot;, &quot;debug&quot;, &quot;info&quot;, &quot;warn&quot;, &quot;error&quot;, &quot;fatal&quot;, æˆ– &quot;panic&quot;ã€‚</span></span><br><span class="line">CONTAINERS_STORAGE_CONF= <span class="comment"># å®¹å™¨å­˜å‚¨é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œè®¾ç½®è¿™ä¸ªå˜é‡å¯ä»¥è¦†ç›–é»˜è®¤çš„é…ç½®ä½ç½®ã€‚</span></span><br><span class="line">SEALOS_SYNC_WORKDIR=<span class="literal">true</span> <span class="comment"># æ˜¯å¦å°†è¿è¡Œæ—¶æ ¹ç›®å½•ï¼ˆSEALOS_RUNTIME_ROOTï¼‰åŒæ­¥åˆ°æ‰€æœ‰ master èŠ‚ç‚¹ï¼Œä½œä¸ºå¤‡ä»½ç”¨é€”ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sealos exec &quot;shell command or script&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">sealos <span class="built_in">exec</span> <span class="string">&quot;cat /etc/hosts&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œ--ips: å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„èŠ‚ç‚¹IPï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·åˆ†éš”</span></span><br><span class="line">sealos <span class="built_in">exec</span> <span class="string">&quot;cat /etc/hosts&quot;</span> --ips=10.211.55.13,10.211.55.14</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨é›†ç¾¤é—´æ‹·è´æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sealos scp &quot;source file path&quot; &quot;destination file path&quot;</span></span><br><span class="line"><span class="comment"># åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">sealos scp ~/Clusterfile /tmp/Clusterfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œ--ips: å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„èŠ‚ç‚¹IPï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ç”¨é€—å·åˆ†éš”</span></span><br><span class="line">sealos scp ~/Clusterfile /tmp/Clusterfile --ips=10.211.55.13,10.211.55.14</span><br></pre></td></tr></table></figure><h3 id="èŠ‚ç‚¹ç®¡ç†-masterèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤">èŠ‚ç‚¹ç®¡ç†(masterèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤)</h3><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ  master èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  master èŠ‚ç‚¹åï¼Œæ€»çš„ master èŠ‚ç‚¹ä¸ªæ•°å¿…é¡»ä¸ºå¥‡æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line">sealos add --masters 10.211.55.18,10.211.55.19</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ  worker èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  worker èŠ‚ç‚¹ï¼Œå¤šä¸ªéƒ½ä¼šåˆ†éš”</span></span><br><span class="line">sealos add --nodes 10.211.55.20,10.211.55.21</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤ master èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤ master èŠ‚ç‚¹åï¼Œå‰©ä½™çš„ master èŠ‚ç‚¹ä¸ªæ•°å¿…é¡»ä¸ºå¥‡æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line">sealos delete --masters 10.211.55.18,10.211.55.19</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤ worker èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sealos delete --nodes 10.211.55.20,10.211.55.21</span><br></pre></td></tr></table></figure><h3 id="é•œåƒç®¡ç†">é•œåƒç®¡ç†</h3><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹æ‰€æœ‰é•œåƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sealos images</span><br><span class="line">REPOSITORY                                                 TAG        IMAGE ID       CREATED         SIZE</span><br><span class="line">docker.io/labring/kubernetes                               v1.29.9    bca192f35556   2 months ago    669 MB</span><br><span class="line">docker.io/labring/cilium                                   v1.13.4    71aa52ad0a11   23 months ago   483 MB</span><br><span class="line">docker.io/labring/helm                                     v3.9.4     3376f6822067   2 years ago     46.4 MB</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤é•œåƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sealos rmi [image_id] | [image_name]</span></span><br><span class="line">sealos rmi docker.io/labring/kubernetes:v1.29.9</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‹‰å–é•œåƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sealos pull docker.io/labring/kubernetes:v1.29.9</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç™»å½•é•œåƒä»“åº“ï¼Œå»ºè®®ç™»å½•ä»“åº“ï¼Œè¿™æ ·å¯ä»¥æé«˜æ‹‰å–é•œåƒçš„æ¬¡æ•°ï¼Œé¿å…æ‹‰å–é•œåƒå¤±è´¥</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker.io å®˜æ–¹dockerhubé•œåƒä»“åº“</span></span><br><span class="line">sealos login docker.io -u [username] -p [password]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºé•œåƒæ‰“tag</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sealos tag docker.io/labring/kubernetes:v1.29.9 docker.io/hanqunfeng/kubernetes:v1.29.9</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ¨é€é•œåƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sealos push docker.io/hanqunfeng/kubernetes:v1.29.9</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹é•œåƒè¯¦æƒ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sealos inspect [image_id] | [image_name]</span></span><br><span class="line">sealos inspect docker.io/labring/kubernetes:v1.29.9</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç™»å‡ºé•œåƒä»“åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç™»å‡ºæŒ‡å®šçš„ä»“åº“</span></span><br><span class="line">sealos <span class="built_in">logout</span> docker.io</span><br><span class="line"><span class="comment"># ç™»å‡ºæ‰€æœ‰ä»“åº“</span></span><br><span class="line">sealos <span class="built_in">logout</span> --all</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡ Dockerfile æ„å»ºé•œåƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ docker build ç±»ä¼¼ï¼Œæ„å»ºå¥½çš„é•œåƒä¼šå¢åŠ å‰ç¼€ localhost/</span></span><br><span class="line">sealos build -t myapp:v1.0.0 -f Dockerfile .</span><br></pre></td></tr></table></figure><h3 id="å®¹å™¨ç®¡ç†">å®¹å™¨ç®¡ç†</h3><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sealos ps</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å®¹å™¨è¯¦æƒ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sealos inspect [container_id] | [container_name]</span></span><br><span class="line">sealos inspect bca192f35556</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Linux ä¸‹ ä½¿ç”¨ sealos å®‰è£… K8S çš„æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://sealos.run/docs/k8s/quick-start/deploy-kubernetes&quot;&gt;sealoså®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/labring/sealos&quot;&gt;sealos Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>Linux å®‰è£… K8S ä¹‹ kubeadm</title>
    <link href="https://blog.hanqunfeng.com/2025/06/29/k8s-install-kubeadm/"/>
    <id>https://blog.hanqunfeng.com/2025/06/29/k8s-install-kubeadm/</id>
    <published>2025-06-29T14:30:05.000Z</published>
    <updated>2025-07-02T10:00:31.252Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Linux ä¸‹ ä½¿ç”¨ kubeadm å®‰è£… K8S çš„æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/">ä½¿ç”¨ kubeadm å¼•å¯¼é›†ç¾¤</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/reference/setup-tools/kubeadm/">kubeadm å‘½ä»¤æŒ‡å—</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/">ç”¨ kubeadm è¿›è¡Œç®¡ç†</a></p></li></ul><span id="more"></span><h2 id="å®‰è£…å‰è®¾ç½®-æ‰€æœ‰èŠ‚ç‚¹">å®‰è£…å‰è®¾ç½®(æ‰€æœ‰èŠ‚ç‚¹)</h2><h3 id="ä¿®æ­£ç³»ç»Ÿçš„æ—¶é—´">ä¿®æ­£ç³»ç»Ÿçš„æ—¶é—´</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…chrony</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install chrony -y</span><br><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now chronyd</span><br><span class="line"><span class="comment"># ä¿®æ­£æ—¶é—´</span></span><br><span class="line"><span class="built_in">sudo</span> chronyc makestep</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¶é—´</span></span><br><span class="line"><span class="built_in">date</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-docker-å¯é€‰">å®‰è£… <code>docker</code>(å¯é€‰)</h3><ul class="lvl-0"><li class="lvl-2"><p>k8s ä½¿ç”¨<code>docker</code>ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶æ‰éœ€è¦å®‰è£…ï¼Œå®‰è£…æ–¹æ³•å‚è§ <a href="/2025/05/20/docker-install/" title="Linux å®‰è£… Docker">Linux å®‰è£… Docker</a></p></li></ul><h3 id="åˆ›å»ºç”¨æˆ·">åˆ›å»ºç”¨æˆ·</h3><ul class="lvl-0"><li class="lvl-2"><p>é¿å…ä½¿ç”¨rootç”¨æˆ·ï¼Œè¿™é‡Œåˆ›å»ºä¸€ä¸ª <code>centos</code> ç”¨æˆ·ï¼Œè¦æ±‚è¯¥ç”¨æˆ·å…·æœ‰<code>sudo</code>æƒé™ï¼Œå¦‚æœä½¿ç”¨<code>docker</code>è¿è¡Œæ—¶ï¼Œåˆ™éœ€è¦å°†è¯¥ç”¨æˆ·æ·»åŠ åˆ°<code>docker</code>ç”¨æˆ·ç»„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">$ <span class="built_in">sudo</span> useradd -m -s /bin/bash centos</span><br><span class="line"><span class="comment"># 2.æ·»åŠ åˆ°dockerç”¨æˆ·ç»„</span></span><br><span class="line">$ <span class="built_in">sudo</span> usermod -aG docker centos</span><br><span class="line"><span class="comment"># 3.å°†ç”¨æˆ·æ·»åŠ åˆ° sudoï¼ˆç®¡ç†å‘˜ï¼‰ç»„ï¼Œè¯´æ˜ï¼šwheel æ˜¯ CentOS ä¸­å…è®¸ä½¿ç”¨ sudo æƒé™çš„ç”¨æˆ·ç»„ã€‚å…·ä½“å¯ä»¥é€šè¿‡ visudo å‘½ä»¤æŸ¥çœ‹</span></span><br><span class="line">$ <span class="built_in">sudo</span> usermod -aG wheel centos</span><br><span class="line"><span class="comment">## è¿™ç§æ·»åŠ æ–¹å¼ä½¿ç”¨sudoæ—¶éœ€è¦è¾“å…¥å¯†ç ï¼Œå¦‚æœä¸å¸Œæœ›è¾“å…¥å¯†ç ï¼Œå¯ä»¥é€šè¿‡ visudo å‘½ä»¤ä¿®æ”¹ï¼Œå°† wheel ç»„æ”¹ä¸º %wheel ALL=(ALL) NOPASSWD: ALL çš„å½¢å¼</span></span><br><span class="line"><span class="comment"># 4.åˆ‡æ¢ç”¨æˆ·ï¼Œä»¥ä¸‹æ“ä½œå‡åœ¨è¯¥ç”¨æˆ·ä¸‹è¿›è¡Œ</span></span><br><span class="line">$ su - centos</span><br></pre></td></tr></table></figure><h3 id="å‡çº§å†…æ ¸">å‡çº§å†…æ ¸</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”± kubeadm åˆ›å»ºçš„ Kubernetes é›†ç¾¤ä¾èµ–äºä½¿ç”¨å†…æ ¸ç‰¹æ€§çš„ç›¸å…³è½¯ä»¶ã€‚</p></li><li class="lvl-3"><p>Kubernetes é›†ç¾¤çš„èŠ‚ç‚¹å¯¹äºä½¿ç”¨ Linux å†…æ ¸ç‰ˆæœ¬è¦æ±‚å‚åŠ <a href="https://kubernetes.io/zh-cn/docs/reference/node/kernel-version-requirements/">Linux å†…æ ¸ç‰ˆæœ¬è¦æ±‚</a></p></li><li class="lvl-3"><p>kubeadm é¡¹ç›®æ”¯æŒ LTS å†…æ ¸ã€‚å‚é˜… <a href="https://www.kernel.org/category/releases.html">LTS å†…æ ¸åˆ—è¡¨</a>ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰å†…æ ¸ç‰ˆæœ¬ä¸º 4.18.0</span></span><br><span class="line">$ <span class="built_in">uname</span> -r</span><br><span class="line">4.18.0-553.el8_10.x86_64</span><br><span class="line"><span class="comment">#æŸ¥çœ‹ yum ä¸­å¯å‡çº§çš„å†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum list kernel --showduplicates</span><br><span class="line"><span class="comment">#å¦‚æœlistä¸­æœ‰éœ€è¦çš„ç‰ˆæœ¬å¯ä»¥ç›´æ¥æ‰§è¡Œ update å‡çº§ï¼Œå¤šæ•°æ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥è¦æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¼å…¥ELRepoè½¯ä»¶ä»“åº“çš„å…¬å…±ç§˜é’¥</span></span><br><span class="line">$ <span class="built_in">sudo</span> rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line"></span><br><span class="line"><span class="comment">#Centos7ç³»ç»Ÿå®‰è£…ELRepo</span></span><br><span class="line"><span class="comment"># $sudo yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm</span></span><br><span class="line"><span class="comment">#Centos8ç³»ç»Ÿå®‰è£…ELRepo</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum install https://www.elrepo.org/elrepo-release-8.el8.elrepo.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹ELRepoæä¾›çš„å†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum --disablerepo=<span class="string">&quot;*&quot;</span> --enablerepo=<span class="string">&quot;elrepo-kernel&quot;</span> list available</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#kernel-ltï¼šè¡¨ç¤ºlongtermï¼Œå³é•¿æœŸæ”¯æŒçš„å†…æ ¸ï¼Œå½“å‰ltå†…æ ¸ç‰ˆæœ¬ä¸º 5.4.295</span></span><br><span class="line"><span class="comment">#kernel-mlï¼šè¡¨ç¤ºmainlineï¼Œå³å½“å‰ä¸»çº¿çš„å†…æ ¸ï¼Œå½“å‰mlå†…æ ¸ç‰ˆæœ¬ä¸º 6.15.4ï¼Œç¬”è€…æµ‹è¯•å®‰è£…è¯¥ç‰ˆæœ¬å†…æ ¸æœ€ååˆ›å»ºé›†ç¾¤æ—¶ä¼šå¤±è´¥</span></span><br><span class="line"><span class="comment">#å®‰è£…ltå†…æ ¸</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum --enablerepo=elrepo-kernel install kernel-lt.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å·²å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬ï¼Œå¯ä»¥çœ‹åˆ° åˆšåˆšå®‰è£…çš„ 5.4.295 å†…æ ¸ç‰ˆæœ¬çš„ä¸¤ä¸ªæ–‡ä»¶</span></span><br><span class="line">$ <span class="built_in">ls</span> -lh /boot/vmlinuz-* /boot/initramfs-* | grep <span class="string">&quot;5.4&quot;</span></span><br><span class="line">-rw-------  1 root root  29M 6æœˆ  29 17:15 /boot/initramfs-5.4.295-1.el8.elrepo.x86_64.img</span><br><span class="line">-rwxr-xr-x  1 root root 9.5M 6æœˆ  28 01:21 /boot/vmlinuz-5.4.295-1.el8.elrepo.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ä»¥ä½¿ç”¨çš„å†…æ ¸</span></span><br><span class="line">$ <span class="built_in">sudo</span> grubby --info=ALL | grep ^kernel</span><br><span class="line">kernel=<span class="string">&quot;/boot/vmlinuz-5.4.295-1.el8.elrepo.x86_64&quot;</span></span><br><span class="line">kernel=<span class="string">&quot;/boot/vmlinuz-4.18.0-553.el8_10.x86_64&quot;</span></span><br><span class="line">kernel=<span class="string">&quot;/boot/vmlinuz-0-rescue-88f75739047993488aacc30b9cd25ca0&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é»˜è®¤å†…æ ¸ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†æ–°å®‰è£…çš„å†…æ ¸è®¾ç½®ä¸ºé»˜è®¤å¯åŠ¨å†…æ ¸</span></span><br><span class="line">$ <span class="built_in">sudo</span> grubby --default-kernel</span><br><span class="line">/boot/vmlinuz-5.4.295-1.el8.elrepo.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ²¡æœ‰è‡ªåŠ¨å¯ç”¨ï¼Œåˆ™é€šè¿‡è¯¥å‘½ä»¤è®¾ç½®é»˜è®¤å†…æ ¸</span></span><br><span class="line">$ <span class="built_in">sudo</span> grubby --set-default /boot/vmlinuz-5.4.295-1.el8.elrepo.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ç³»ç»Ÿ</span></span><br><span class="line">$ <span class="built_in">sudo</span> reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ç™»å½•åéªŒè¯å†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line">$ <span class="built_in">uname</span> -r</span><br><span class="line">5.4.295-1.el8.elrepo.x86_64</span><br></pre></td></tr></table></figure><h3 id="å°†-SELinux-è®¾ç½®ä¸º-permissive-æ¨¡å¼ï¼ˆç›¸å½“äºå°†å…¶ç¦ç”¨ï¼‰">å°† SELinux è®¾ç½®ä¸º permissive æ¨¡å¼ï¼ˆç›¸å½“äºå°†å…¶ç¦ç”¨ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> setenforce 0</span><br><span class="line">$ <span class="built_in">sudo</span> sed -i <span class="string">&#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure><h3 id="ç¦ç”¨Firewalld">ç¦ç”¨Firewalld</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œå¯ä»¥ç¦ç”¨ firewalld</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop firewalld</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure><h4 id="ä¸å…³-Firewalld-åº”è¯¥å¼€æ”¾å“ªäº›ç«¯å£ï¼Ÿ-å®æµ‹è¿˜æ˜¯ä¼šé‡åˆ°å„ç§å„æ ·çš„é—®é¢˜">ä¸å…³ Firewalld åº”è¯¥å¼€æ”¾å“ªäº›ç«¯å£ï¼Ÿ(å®æµ‹è¿˜æ˜¯ä¼šé‡åˆ°å„ç§å„æ ·çš„é—®é¢˜)</h4><ul class="lvl-0"><li class="lvl-2"><p>Master èŠ‚ç‚¹éœ€è¦å¼€æ”¾çš„ç«¯å£</p></li></ul><table><thead><tr><th>ç«¯å£</th><th>åè®®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>6443</strong></td><td>TCP</td><td>kube-apiserverï¼Œç”¨äº kubectl ä¸é›†ç¾¤é€šä¿¡</td></tr><tr><td><strong>2379-2380</strong></td><td>TCP</td><td>etcd é›†ç¾¤é€šä¿¡ï¼ˆä»…åœ¨ä½ è‡ªå·±éƒ¨ç½² etcd æ—¶ï¼‰</td></tr><tr><td><strong>10250</strong></td><td>TCP</td><td>kubelet ç›‘å¬ç«¯å£ï¼Œä¾› apiserver ä¸èŠ‚ç‚¹é€šä¿¡</td></tr><tr><td><strong>10259</strong></td><td>TCP</td><td>kube-scheduler</td></tr><tr><td><strong>10257</strong></td><td>TCP</td><td>kube-controller-manager</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Worker èŠ‚ç‚¹éœ€è¦å¼€æ”¾çš„ç«¯å£</p></li></ul><table><thead><tr><th>ç«¯å£</th><th>åè®®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>10250</strong></td><td>TCP</td><td>kubelet ä¸ apiserver é€šä¿¡</td></tr><tr><td><strong>30000-32767</strong></td><td>TCP</td><td>NodePort æœåŠ¡é»˜è®¤ç«¯å£èŒƒå›´</td></tr><tr><td><strong>10255</strong></td><td>TCP</td><td>kubelet åªè¯»ç«¯å£ï¼ˆé»˜è®¤å…³é—­ï¼Œå¯ä¸å¼€æ”¾ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Calico ç½‘ç»œæ’ä»¶</p></li></ul><table><thead><tr><th>ç«¯å£</th><th>åè®®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>179</strong></td><td>TCP</td><td>BGP é€šä¿¡ç«¯å£ï¼Œç”¨äº Calico èŠ‚ç‚¹é—´è·¯ç”±ï¼ˆè‹¥ä½¿ç”¨ BGP æ¨¡å¼ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Flannelï¼ˆVXLAN æ¨¡å¼ï¼‰</p></li></ul><table><thead><tr><th>ç«¯å£</th><th>åè®®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>8472</strong></td><td>UDP</td><td>VXLAN æ•°æ®é€šä¿¡</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Ingress æ§åˆ¶å™¨ï¼ˆæ¯”å¦‚ NGINX Ingressï¼‰</p></li></ul><table><thead><tr><th>ç«¯å£</th><th>åè®®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>80</strong> / <strong>443</strong></td><td>TCP</td><td>æä¾› HTTP/HTTPS æœåŠ¡è®¿é—®ï¼ˆIngress æœåŠ¡ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹å‘½ä»¤ï¼šä½¿ç”¨ firewall-cmd å¼€æ”¾ç«¯å£</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ firewalld</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start firewalld</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šå¼€æ”¾å¸¸ç”¨ç«¯å£</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=6443/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=2379-2380/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=10250/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=10259/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=10257/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=30000-32767/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=179/tcp       <span class="comment"># å¦‚æœç”¨ Calico</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=8472/udp      <span class="comment"># å¦‚æœç”¨ Flannel</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=80/tcp        <span class="comment"># Ingress</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=443/tcp       <span class="comment"># Ingress</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸ Calico çš„å°è£…åè®® IPIP ,å…è®¸ IPIP åè®®ï¼ˆåè®®å· 4ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p 4 -j ACCEPT</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --direct --add-rule ipv4 filter OUTPUT 0 -p 4 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœ Calico ä½¿ç”¨ VXLAN æ¨¡å¼ï¼Œåˆ™éœ€è¦å¼€æ”¾ 4789 ç«¯å£</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=4789/udp</span><br><span class="line"><span class="comment"># Calico Typha ç½‘ç»œ</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=5473/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># Calico WireGuardï¼ˆIPv4 å’Œ IPv6ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=51820/udp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=51821/udp</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨æ›´æ”¹</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£</span></span><br><span class="line">$ <span class="built_in">sudo</span> firewall-cmd --list-ports</span><br><span class="line">80/tcp 179/tcp 443/tcp 2377/tcp 2379-2380/tcp 6443/tcp 7946/tcp 10250/tcp 10257/tcp 10259/tcp 30000-32767/tcp 4789/udp 7946/udp 8472/udp</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¼€æ”¾çš„ç›´æ¥è§„åˆ™</span></span><br><span class="line">$ <span class="built_in">sudo</span> firewall-cmd --direct --get-all-rules</span><br><span class="line">ipv4 filter INPUT 0 -p 4 -j ACCEPT</span><br></pre></td></tr></table></figure><h3 id="å…³é—­swap">å…³é—­swap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> swapoff -a</span><br><span class="line"><span class="built_in">sudo</span> sed -i <span class="string">&#x27;/ swap / s/^/#/&#x27;</span> /etc/fstab</span><br></pre></td></tr></table></figure><h3 id="åŠ è½½å†…æ ¸æ¨¡å—">åŠ è½½å†…æ ¸æ¨¡å—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> modprobe overlay</span><br><span class="line"><span class="built_in">sudo</span> modprobe br_netfilter</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å†…æ ¸å‚æ•°">è®¾ç½®å†…æ ¸å‚æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/kubernetes.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> sysctl --system</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…containerd">å®‰è£…containerd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="built_in">sudo</span> yum config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"><span class="built_in">sudo</span> yum install -y containerd.io</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/containerd</span><br><span class="line"><span class="built_in">sudo</span> containerd config default | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®Systemdä¸ºcgroup driver</span></span><br><span class="line"><span class="built_in">sudo</span> sed -i <span class="string">&#x27;s/SystemdCgroup = false/SystemdCgroup = true/&#x27;</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now containerd</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…cri-dockerd-å¯é€‰">å®‰è£…cri-dockerd(å¯é€‰)</h3><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä½¿ç”¨ containerdï¼Œåˆ™ä¸éœ€è¦å®‰è£… cri-dockerd</p></li><li class="lvl-2"><p>Kubernetes 1.24+ é»˜è®¤ç§»é™¤äº† dockershimï¼Œæ‰€ä»¥ä½ å¿…é¡»å®‰è£… cri-dockerd æ‰èƒ½ç»§ç»­ä½¿ç”¨ Docker</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½å¹¶å®‰è£… cri-dockerd RPMï¼Œç›®å‰æœ€æ–°ç‰ˆæ˜¯ 0.3.19ï¼Œfc35: Fedora 35 æ„å»ºï¼Œé€‚é… RHEL/CentOS 8 ç³»ç»Ÿçš„ glibc å’Œ libstdc++</span></span><br><span class="line">$ curl -LO https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.19/cri-dockerd-0.3.19-3.fc35.x86_64.rpm</span><br><span class="line"><span class="comment"># å®‰è£…æ—¶æŠ¥é”™ï¼šcri-dockerd-0.3.19-3.fc35.x86_64.rpm ä¾èµ– GLIBC â‰¥ 2.32 å’Œ 2.34ï¼Œä½† CentOS 8 ç³»ç»Ÿåªæä¾› GLIBC 2.28ã€‚</span></span><br><span class="line">$ <span class="built_in">sudo</span> dnf install -y ./cri-dockerd-0.3.19-3.fc35.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°ä¸‹è½½ä¸€ä¸ªå…¼å®¹çš„ç‰ˆæœ¬å³å¯ï¼Œè¿™é‡Œé€‰æ‹©ï¼šcri-dockerd-0.3.14-3.el8.x86_64.rpm</span></span><br><span class="line">$ curl -LO https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.14/cri-dockerd-0.3.14-3.el8.x86_64.rpm</span><br><span class="line">$ <span class="built_in">sudo</span> dnf install -y ./cri-dockerd-0.3.14-3.el8.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½æœåŠ¡</span></span><br><span class="line">$ <span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="comment"># åŠ å…¥å¼€æœºå¯åŠ¨å¹¶ç«‹åˆ»å¯åŠ¨</span></span><br><span class="line">$ <span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now cri-docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># åé¢çš„ kubeadm å‘½ä»¤ éƒ½è¦åŠ ä¸Š --cri-socket unix:///var/run/cri-dockerd.sock</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-kubelet-kubeadm-kubectl">å®‰è£… kubelet, kubeadm, kubectl</h3><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ  Kubernetes YUM æºï¼Œk8s çš„ç‰ˆæœ¬ä»<a href="https://kubernetes.io/zh-cn/docs/home/supported-doc-versions/">å®˜ç½‘</a>è·å–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://pkgs.k8s.io/core:/stable:/v1.33/rpm/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">repo_gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.33/rpm/repodata/repomd.xml.key</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç†yumç¼“å­˜å¹¶é‡æ–°å»ºç«‹ç¼“å­˜</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum clean all &amp;&amp; <span class="built_in">sudo</span> yum makecache</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£… kubelet, kubeadm, kubectl</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹kubeadmæœ‰ä»€ä¹ˆç‰ˆæœ¬</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum list --showduplicates  kubeadm</span><br><span class="line"><span class="comment"># ä¸æŒ‡å®šç‰ˆæœ¬é»˜è®¤é‚£ç§æœ€æ–°ç‰ˆ</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum install -y kubelet kubeadm kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨kubelet</span></span><br><span class="line">$ <span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶ä¸ºcontainerdï¼Œè¿™é‡Œé€šè¿‡ crictl æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶ä¸º containerd</span></span><br><span class="line"><span class="comment"># é…ç½®æ–‡ä»¶ï¼š/etc/crictl.yaml</span></span><br><span class="line">$ <span class="built_in">sudo</span> crictl config runtime-endpoint /run/containerd/containerd.sock</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥</span></span><br><span class="line">$ kubeadm version</span><br><span class="line">$ kubelet --version</span><br><span class="line">$ kubectl version --client</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ç”¨ shell è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å®‰è£… bash-completion</span></span><br><span class="line"><span class="comment"># 1.1 æ£€æŸ¥bash-completionæ˜¯å¦å·²å®‰è£…ï¼Œæœ‰è¾“å‡ºè¯´æ˜å·²ç»å®‰è£…</span></span><br><span class="line">$ <span class="built_in">type</span> _init_completion</span><br><span class="line"><span class="comment"># 1.2 å®‰è£…bash-completionï¼Œå®‰è£…åä¼šåˆ›å»ºæ–‡ä»¶ /usr/share/bash-completion/bash_completion</span></span><br><span class="line">$ dnf install bash-completion</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å®‰è£… kubectl çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</span></span><br><span class="line"><span class="comment"># 2.1 å½“å‰ç”¨æˆ·</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;source &lt;(kubectl completion bash)&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="comment"># 2.2 æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line">$ kubectl completion bash | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/bash_completion.d/kubectl &gt; /dev/null</span><br><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">chmod</span> a+r /etc/bash_completion.d/kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 å¦‚æœ kubectl æœ‰å…³è”çš„åˆ«åï¼Œä½ å¯ä»¥æ‰©å±• Shell è¡¥å…¨æ¥é€‚é…æ­¤åˆ«å</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;alias k=kubectl&#x27;</span> &gt;&gt;~/.bashrc</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;complete -o default -F __start_kubectl k&#x27;</span> &gt;&gt;~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åˆ·æ–°é…ç½®æ–‡ä»¶</span></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºé›†ç¾¤-masterèŠ‚ç‚¹">åˆ›å»ºé›†ç¾¤(masterèŠ‚ç‚¹)</h2><ul class="lvl-0"><li class="lvl-2"><p>masterèŠ‚ç‚¹: [hostname: k8s-master, IP: 10.211.55.11]</p></li><li class="lvl-2"><p>åˆå§‹åŒ–masterèŠ‚ç‚¹çš„æ§åˆ¶é¢æ¿ï¼Œå®¹å™¨è¿è¡Œæ—¶åŸºäº <code>containerd</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubeadm init --helpå¯ä»¥æŸ¥çœ‹å‘½ä»¤çš„å…·ä½“å‚æ•°ç”¨æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨masterèŠ‚ç‚¹æ‰§è¡Œåˆå§‹åŒ–ï¼ˆnodeèŠ‚ç‚¹ä¸ç”¨æ‰§è¡Œï¼‰</span></span><br><span class="line"><span class="comment"># --apiserver-advertise-address  æŒ‡å®šapiserverçš„IPï¼Œå³masterèŠ‚ç‚¹çš„IP</span></span><br><span class="line"><span class="comment"># --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers è®¾ç½®é•œåƒä»“åº“ä¸ºå›½å†…é•œåƒä»“åº“</span></span><br><span class="line"><span class="comment"># --kubernetes-version  è®¾ç½®k8sçš„ç‰ˆæœ¬ï¼Œè·Ÿkubeadmç‰ˆæœ¬ä¸€è‡´</span></span><br><span class="line"><span class="comment"># --service-cidr  è¿™æ˜¯è®¾ç½®nodeèŠ‚ç‚¹çš„ç½‘ç»œçš„ï¼Œæš‚æ—¶è¿™æ ·è®¾ç½®</span></span><br><span class="line"><span class="comment"># --pod-network-cidr  è¿™æ˜¯è®¾ç½®nodeèŠ‚ç‚¹çš„ç½‘ç»œçš„ï¼Œæš‚æ—¶è¿™æ ·è®¾ç½®</span></span><br><span class="line"><span class="comment"># --cri-socket unix:///var/run/cri-dockerd.sock  è®¾ç½®criä½¿ç”¨cri-dockerd</span></span><br><span class="line"><span class="comment"># --ignore-preflight-errors=all  å¿½ç•¥æ‰€æœ‰é¢„æ£€é”™è¯¯ï¼ˆPreflight Errorsï¼‰ã€‚è¿™ä¼šè·³è¿‡å¯¹ç³»ç»ŸçŠ¶æ€çš„æŸäº›æ£€æŸ¥ï¼Œä¾‹å¦‚æ˜¯å¦å¯ç”¨äº† swapã€CPU æ ¸å¿ƒæ•°ã€ç³»ç»Ÿé…ç½®ç­‰ã€‚ä¸æ¨èç”¨äºç”Ÿäº§ï¼Œåªç”¨äºè°ƒè¯•æˆ–æµ‹è¯•ç¯å¢ƒã€‚</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">sudo</span> kubeadm init \</span><br><span class="line">--apiserver-advertise-address=10.211.55.11 \</span><br><span class="line">--kubernetes-version v1.33.2 \</span><br><span class="line">--service-cidr=10.96.0.0/16 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br><span class="line"><span class="comment">## å®‰è£…æˆåŠŸä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯</span></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">Alternatively, <span class="keyword">if</span> you are the root user, you can run:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm <span class="built_in">join</span> 10.211.55.11:6443 --token sqwk6v.lxlnf0ibtbgr4i27 \</span><br><span class="line">        --discovery-token-ca-cert-hash sha256:c43f8b6d0e7081a76ab1d8ca8d3c5fb1ef3b21afcd81874566d7840167809412</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ k get cs</span><br><span class="line">Warning: v1 ComponentStatus is deprecated <span class="keyword">in</span> v1.19+</span><br><span class="line">NAME                 STATUS    MESSAGE   ERROR</span><br><span class="line">scheduler            Healthy   ok</span><br><span class="line">controller-manager   Healthy   ok</span><br><span class="line">etcd-0               Healthy   ok</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸ºå½“å‰ç”¨æˆ·æˆäºˆè¿æ¥é›†ç¾¤çš„æƒé™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…ç½‘ç»œæ’ä»¶ï¼š<a href="https://kubernetes.io/zh-cn/docs/concepts/cluster-administration/addons/">k8sæ”¯æŒçš„ç½‘ç»œæ’ä»¶</a>ï¼Œ</p></li><li class="lvl-2"><p><a href="https://www.tigera.io/project-calico/">calicoå®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/projectcalico/calico">calico GitHub</a>]</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…calicoå‰æŸ¥çœ‹podï¼Œ-A æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´</span></span><br><span class="line">$ kubectl get pods -A</span><br><span class="line">NAMESPACE     NAME                          READY   STATUS    RESTARTS      AGE</span><br><span class="line">kube-system   coredns-674b8bbfcf-8xllc      0/1     Pending   0             116m</span><br><span class="line">kube-system   coredns-674b8bbfcf-w2sxz      0/1     Pending   0             116m</span><br><span class="line">kube-system   etcd-k8s                      1/1     Running   2 (74m ago)   116m</span><br><span class="line">kube-system   kube-apiserver-k8s            1/1     Running   2 (74m ago)   116m</span><br><span class="line">kube-system   kube-controller-manager-k8s   1/1     Running   2 (74m ago)   116m</span><br><span class="line">kube-system   kube-proxy-94zqw              1/1     Running   1 (74m ago)   116m</span><br><span class="line">kube-system   kube-scheduler-k8s            1/1     Running   2 (74m ago)   116m</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½yamlæ–‡ä»¶ï¼Œç›®å‰æœ€æ–°ç‰ˆä¸º v3.30.2</span></span><br><span class="line">$ curl -LO https://raw.githubusercontent.com/projectcalico/calico/v3.30.2/manifests/calico.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º</span></span><br><span class="line">$ kubectl apply -f calico.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…calicoåæŸ¥çœ‹podï¼Œåœ¨å®‰è£… Calico ä¹‹å‰ CoreDNS æ˜¯ Pending çŠ¶æ€ï¼Œç°åœ¨å·²ç»å˜æˆ Running</span></span><br><span class="line"><span class="comment"># -o wide: æ˜¾ç¤ºpodçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">$ kubectl get pods -A -o wide</span><br><span class="line">NAMESPACE     NAME                                       READY   STATUS    RESTARTS      AGE     IP             NODE   NOMINATED NODE   READINESS GATES</span><br><span class="line">kube-system   calico-kube-controllers-7bfdc5b57c-9qv9m   1/1     Running   0             6m23s   10.244.77.1    k8s    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   calico-node-m7wc5                          1/1     Running   0             6m23s   10.211.55.11   k8s    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   coredns-674b8bbfcf-8xllc                   1/1     Running   0             123m    10.244.77.3    k8s    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   coredns-674b8bbfcf-w2sxz                   1/1     Running   0             123m    10.244.77.2    k8s    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   etcd-k8s                                   1/1     Running   2 (82m ago)   123m    10.211.55.11   k8s    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-apiserver-k8s                         1/1     Running   2 (82m ago)   123m    10.211.55.11   k8s    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-controller-manager-k8s                1/1     Running   2 (82m ago)   123m    10.211.55.11   k8s    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-proxy-94zqw                           1/1     Running   1 (82m ago)   123m    10.211.55.11   k8s    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-scheduler-k8s                         1/1     Running   2 (82m ago)   123m    10.211.55.11   k8s    &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><blockquote><p>calica å®‰è£…åå¯èƒ½å‡ºç°ä¸æ­£å¸¸çš„æƒ…å†µï¼Œæ¯”å¦‚ <code>calico-node-xxx</code> çš„podå§‹ç»ˆæ— æ³•æ­£å¸¸è¿è¡Œï¼Œæ­¤æ—¶å¯ä»¥å°è¯•é‡æ–°å®‰è£… calica</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤ calico</span></span><br><span class="line">$ kubectl delete -f calico.yaml</span><br><span class="line"><span class="comment">#å¦‚æœæ˜¯é‡è£…calicoï¼Œéœ€è¦å…ˆæ¸…é™¤æ—§çš„é…ç½®</span></span><br><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /etc/cni/net.d/</span><br><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/calico</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°å®‰è£… calico</span></span><br><span class="line">$ kubectl apply -f calico.yaml</span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ èŠ‚ç‚¹-workerèŠ‚ç‚¹">æ·»åŠ èŠ‚ç‚¹(workerèŠ‚ç‚¹)</h2><ul class="lvl-0"><li class="lvl-2"><p>workerèŠ‚ç‚¹: [hostname: k8s-worker1, IP: 10.211.55.15]</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å¾…åŠ å…¥çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¦‚æœå¿˜è®°tokenï¼Œåˆ™ä½¿ç”¨ä¸‹æ–‡çš„å‘½ä»¤é‡æ–°è·å–</span></span><br><span class="line">$ <span class="built_in">sudo</span> kubeadm <span class="built_in">join</span> 10.211.55.11:6443 --token sqwk6v.lxlnf0ibtbgr4i27 --discovery-token-ca-cert-hash sha256:c43f8b6d0e7081a76ab1d8ca8d3c5fb1ef3b21afcd81874566d7840167809412</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">        [WARNING SystemVerification]: cgroups v1 support is <span class="keyword">in</span> maintenance mode, please migrate to cgroups v2</span><br><span class="line">[preflight] Reading configuration from the <span class="string">&quot;kubeadm-config&quot;</span> ConfigMap <span class="keyword">in</span> namespace <span class="string">&quot;kube-system&quot;</span>...</span><br><span class="line">[preflight] Use <span class="string">&#x27;kubeadm init phase upload-config --config your-config-file&#x27;</span> to re-upload it.</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">&quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file <span class="string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[kubelet-check] Waiting <span class="keyword">for</span> a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s</span><br><span class="line">[kubelet-check] The kubelet is healthy after 1.004135788s</span><br><span class="line">[kubelet-start] Waiting <span class="keyword">for</span> the kubelet to perform the TLS Bootstrap</span><br><span class="line"></span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to apiserver and a response was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line">Run <span class="string">&#x27;kubectl get nodes&#x27;</span> on the control-plane to see this node <span class="built_in">join</span> the cluster.</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä¸Šé¢çš„ä»¤ç‰Œå¿˜è®°äº†ï¼Œæˆ–è€…æ–°çš„ worker èŠ‚ç‚¹åŠ å…¥ï¼Œåœ¨ master ä¸Šæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œç”Ÿæˆæ–°çš„ä»¤ç‰Œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm token create --print-join-command</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">kubeadm <span class="built_in">join</span> 10.211.55.11:6443 --token 5o3p2i.gj95aopph0xbrcig --discovery-token-ca-cert-hash sha256:c43f8b6d0e7081a76ab1d8ca8d3c5fb1ef3b21afcd81874566d7840167809412</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ master èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹æ–°åˆ›å»ºçš„èµ„æºï¼Œé»˜è®¤æƒ…å†µä¸‹ work èŠ‚ç‚¹ä¸æ”¯æŒç®¡ç† k8s</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹</span></span><br><span class="line">$ kubectl get nodes</span><br><span class="line">NAME          STATUS     ROLES           AGE     VERSION</span><br><span class="line">k8s           Ready      control-plane   3h33m   v1.33.2</span><br><span class="line">k8s-worker1   Ready      &lt;none&gt;          115s    v1.33.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹pod list</span></span><br><span class="line">$ kubectl get pods -A -o wide</span><br><span class="line">NAMESPACE     NAME                                       READY   STATUS    RESTARTS   AGE     IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">kube-system   calico-kube-controllers-7bfdc5b57c-q5xwp   1/1     Running   0          37m     10.244.235.193   k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   calico-node-7pbbq                          1/1     Running   0          4m51s   10.211.55.15     k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   calico-node-w47qq                          1/1     Running   0          37m     10.211.55.11     k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   coredns-674b8bbfcf-2tvld                   1/1     Running   0          37m     10.244.235.195   k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   coredns-674b8bbfcf-h6kx7                   1/1     Running   0          37m     10.244.235.194   k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   etcd-k8s-master                            1/1     Running   2          37m     10.211.55.11     k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-apiserver-k8s-master                  1/1     Running   4          37m     10.211.55.11     k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-controller-manager-k8s-master         1/1     Running   4          37m     10.211.55.11     k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-proxy-nkbns                           1/1     Running   0          4m51s   10.211.55.15     k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-proxy-plqw8                           1/1     Running   0          37m     10.211.55.11     k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-scheduler-k8s-master                  1/1     Running   4          38m     10.211.55.11     k8s-master    &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ work èŠ‚ç‚¹æ”¯æŒç®¡ç† k8s(å¯é€‰)ï¼šè¿œç¨‹ç®¡ç†</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°† master èŠ‚ç‚¹ä¸­çš„ ~/.kube/config å¤åˆ¶åˆ° work èŠ‚ç‚¹çš„ ~/.kube/config å³å¯</span></span><br><span class="line"><span class="comment"># åœ¨ master èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line">scp ~/.kube/config k8s-work1:/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ work èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/.kube</span><br><span class="line"><span class="built_in">mv</span> /tmp/config ~/.kube/config</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤workèŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># workerèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span></span><br><span class="line"><span class="comment">## åœ¨ç§»é™¤èŠ‚ç‚¹ä¹‹å‰ï¼Œè¯·é‡ç½® kubeadm å®‰è£…çš„çŠ¶æ€</span></span><br><span class="line">$ <span class="built_in">sudo</span> kubeadm reset</span><br><span class="line"><span class="comment">## é‡ç½®è¿‡ç¨‹ä¸ä¼šé‡ç½®æˆ–æ¸…é™¤ iptables è§„åˆ™æˆ– IPVS è¡¨ã€‚å¦‚æœä½ å¸Œæœ›é‡ç½® iptablesï¼Œåˆ™å¿…é¡»æ‰‹åŠ¨è¿›è¡Œ</span></span><br><span class="line">$ iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X</span><br><span class="line"></span><br><span class="line"><span class="comment"># master èŠ‚ç‚¹ä¸Šåˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">$ kubectl delete node k8s-worker1</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•ï¼šç”¨K8Séƒ¨ç½²Nginx">æµ‹è¯•ï¼šç”¨K8Séƒ¨ç½²Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºdeployment</span></span><br><span class="line">kubectl create deployment nginx --image=nginx</span><br><span class="line"><span class="comment"># åˆ›å»ºserviceï¼Œ--typeæŒ‡å®šä¸ºNodePortï¼Œå…¶å«ä¹‰ä¸ºå°†deploymentçš„80ç«¯å£æ˜ å°„åˆ°Nodeçš„éšæœºç«¯å£</span></span><br><span class="line">kubectl expose deployment nginx --<span class="built_in">type</span>=NodePort --port=80</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹podå’Œserviceï¼Œä¸åŠ  -n å‚æ•°ï¼Œé»˜è®¤æŸ¥çœ‹çš„æ˜¯defaultå‘½åç©ºé—´</span></span><br><span class="line">$ kubectl get pod,svc -o wide</span><br><span class="line">NAME                         READY   STATUS    RESTARTS   AGE   IP              NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">pod/nginx-5869d7778c-95z74   1/1     Running   0          19m   10.244.194.65   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE   SELECTOR</span><br><span class="line">service/kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP        61m   &lt;none&gt;</span><br><span class="line">service/nginx        NodePort    10.96.48.156   &lt;none&gt;        80:30291/TCP   14m   app=nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµè§ˆå™¨è®¿é—®ä»»æ„nodeIP:30291</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æµ‹è¯•èµ„æº</span></span><br><span class="line"><span class="comment">## åˆ é™¤deployment</span></span><br><span class="line">kubectl delete deployment nginx</span><br><span class="line"><span class="comment">## åˆ é™¤service</span></span><br><span class="line">kubectl delete service nginx</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡-kubeadm-å¸è½½-Kubernetes">é€šè¿‡ kubeadm å¸è½½ Kubernetes</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢ kubelet ç›¸å…³ç»„ä»¶,åˆ é™¤ /etc/kubernetes é…ç½®,æ¸…é™¤è¯ä¹¦ã€çŠ¶æ€ç›®å½•ç­‰,å–æ¶ˆ iptables è§„åˆ™,æ¸…é™¤å®¹å™¨è¿è¡Œæ—¶ä¸­çš„ Podã€é•œåƒä¿¡æ¯ç­‰</span></span><br><span class="line">$ <span class="built_in">sudo</span> kubeadm reset</span><br><span class="line"><span class="comment"># è™½ç„¶ kubeadm reset å·²ç»ä¼šæ¸…é™¤å¤§éƒ¨åˆ†å†…å®¹ï¼Œä½†ä»¥ä¸‹æ–‡ä»¶å’Œé…ç½®å¯èƒ½ä¾ç„¶å­˜åœ¨ï¼Œå»ºè®®ä¸€å¹¶æ‰‹åŠ¨æ¸…ç†</span></span><br><span class="line"><span class="comment">## åˆ é™¤ kubeconfig æ–‡ä»¶ï¼ˆæœ¬åœ° kubectl é…ç½®ï¼‰</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="variable">$HOME</span>/.kube</span><br><span class="line"><span class="comment">## æ¸…ç† etcd æ•°æ®ï¼ˆå¦‚ä½ å¯ç”¨äº†æœ¬åœ° etcdï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/etcd</span><br><span class="line"><span class="comment">## æ¸…ç† CNI ç½‘ç»œé…ç½®å’ŒçŠ¶æ€</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /etc/cni/net.d</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/cni/</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/kubelet/*</span><br><span class="line"><span class="comment"># æ¸…ç† Calico</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/calico</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç† iptables</span></span><br><span class="line"><span class="built_in">sudo</span> iptables -F</span><br><span class="line"><span class="built_in">sudo</span> iptables -X</span><br><span class="line"><span class="built_in">sudo</span> iptables -t nat -F</span><br><span class="line"><span class="built_in">sudo</span> iptables -t nat -X</span><br><span class="line"><span class="built_in">sudo</span> iptables -t mangle -F</span><br><span class="line"><span class="built_in">sudo</span> iptables -t mangle -X</span><br><span class="line"><span class="built_in">sudo</span> iptables -P INPUT ACCEPT</span><br><span class="line"><span class="built_in">sudo</span> iptables -P FORWARD ACCEPT</span><br><span class="line"><span class="built_in">sudo</span> iptables -P OUTPUT ACCEPT</span><br></pre></td></tr></table></figure><h2 id="åœæ­¢å’Œç¦ç”¨-kubelet-æœåŠ¡">åœæ­¢å’Œç¦ç”¨ kubelet æœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl stop kubelet</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> kubelet</span><br></pre></td></tr></table></figure><h2 id="å‡çº§-kubeadm-é›†ç¾¤">å‡çº§ kubeadm é›†ç¾¤</h2><ul class="lvl-0"><li class="lvl-2"><p>å°† kubeadm åˆ›å»ºçš„ Kubernetes é›†ç¾¤ä» 1.32.x ç‰ˆæœ¬ å‡çº§åˆ° 1.33.x ç‰ˆæœ¬ä»¥åŠä» 1.33.x å‡çº§åˆ° 1.33.yï¼ˆå…¶ä¸­ y &gt; xï¼‰ï¼Œç•¥è¿‡æ¬¡ç‰ˆæœ¬å·çš„å‡çº§æ˜¯ ä¸è¢«æ”¯æŒçš„ã€‚</p></li></ul><h3 id="å‡çº§æ­¥éª¤">å‡çº§æ­¥éª¤</h3><h4 id="å‡çº§-master-èŠ‚ç‚¹">å‡çº§ master èŠ‚ç‚¹</h4><ul class="lvl-0"><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/">å‡çº§ master èŠ‚ç‚¹</a></p></li><li class="lvl-2"><p>å¦‚æœè¦ä» <code>v1.33</code> å‡çº§åˆ° <code>v1.34</code>ï¼Œåˆ™éœ€è¦å…ˆä¿®æ”¹ Kubernetes YUM æºï¼Œå› ä¸ºæˆ‘ä¸Šé¢é…ç½® yum æºæ—¶é…ç½®çš„æ˜¯ <code>v1.33</code></p></li><li class="lvl-2"><p>å¦‚æœåªæ˜¯ä» <code>v1.33.2</code> å‡çº§åˆ° <code>v1.33.3</code>ï¼Œåˆ™ä¸éœ€è¦ä¿®æ”¹ Kubernetes YUM æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ kubeadm å¯ä»¥å‡çº§çš„ç‰ˆæœ¬</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum list --showduplicates kubeadm</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šè¦å‡çº§çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚è¿™é‡Œè¦å‡çº§åˆ° 1.33.3</span></span><br><span class="line"><span class="built_in">sudo</span> yum install -y kubeadm-1.33.3</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‡çº§åçš„ç‰ˆæœ¬</span></span><br><span class="line">kubeadm version</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯å‡çº§è®¡åˆ’: æ­¤å‘½ä»¤æ£€æŸ¥ä½ çš„é›†ç¾¤æ˜¯å¦å¯è¢«å‡çº§ï¼Œå¹¶å–å›ä½ è¦å‡çº§çš„ç›®æ ‡ç‰ˆæœ¬ã€‚ å‘½ä»¤ä¹Ÿä¼šæ˜¾ç¤ºä¸€ä¸ªåŒ…å«ç»„ä»¶é…ç½®ç‰ˆæœ¬çŠ¶æ€çš„è¡¨æ ¼ã€‚</span></span><br><span class="line">$ <span class="built_in">sudo</span> kubeadm upgrade plan</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡çº§ master èŠ‚ç‚¹: è¿™ä¸€æ­¥ä¼šå‡çº§ kube-apiserverã€controller-managerã€scheduler ç­‰é™æ€ Podã€‚</span></span><br><span class="line">$ <span class="built_in">sudo</span> kubeadm upgrade apply v1.33.3</span><br><span class="line"><span class="comment">## ä¸€æ—¦è¯¥å‘½ä»¤ç»“æŸï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ï¼š</span></span><br><span class="line"> [upgrade/successful] SUCCESS! Your cluster was upgraded to <span class="string">&quot;v1.33.3&quot;</span>. Enjoy!</span><br><span class="line"></span><br><span class="line"> [upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets <span class="keyword">if</span> you haven<span class="string">&#x27;t already done so.</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰‹åŠ¨å‡çº§ä½ çš„ CNI é©±åŠ¨æ’ä»¶ï¼Œæ¯”å¦‚ Calico</p></li><li class="lvl-2"><p>å‡çº§ kubelet å’Œ kubectl</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šçš„ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">sudo</span> yum install -y kubelet-1.33.3 kubectl-1.33.3</span><br><span class="line"><span class="comment"># é‡å¯ kubelet</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart kubelet</span><br></pre></td></tr></table></figure><h4 id="å‡çº§-worker-èŠ‚ç‚¹">å‡çº§ worker èŠ‚ç‚¹</h4><ul class="lvl-0"><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/upgrading-linux-nodes/">å‡çº§ worker èŠ‚ç‚¹</a></p></li><li class="lvl-2"><p>å¦‚æœè¦ä» <code>v1.33</code> å‡çº§åˆ° <code>v1.34</code>ï¼Œåˆ™éœ€è¦å…ˆä¿®æ”¹ Kubernetes YUM æºï¼Œå› ä¸ºæˆ‘ä¸Šé¢é…ç½® yum æºæ—¶é…ç½®çš„æ˜¯ <code>v1.33</code></p></li><li class="lvl-2"><p>å¦‚æœåªæ˜¯ä» <code>v1.33.2</code> å‡çº§åˆ° <code>v1.33.3</code>ï¼Œåˆ™ä¸éœ€è¦ä¿®æ”¹ Kubernetes YUM æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ kubeadm å¯ä»¥å‡çº§çš„ç‰ˆæœ¬</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum list --showduplicates kubeadm</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šè¦å‡çº§çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚è¿™é‡Œè¦å‡çº§åˆ° 1.33.3</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum install -y kubeadm-1.33.3</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‡çº§åçš„ç‰ˆæœ¬</span></span><br><span class="line">$ kubeadm version</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è…¾ç©ºèŠ‚ç‚¹ï¼šå¦‚æœæœ‰å¤šä¸ª worker èŠ‚ç‚¹ï¼Œå¯ä»¥é€‰æ‹©å…ˆè…¾ç©ºèŠ‚ç‚¹ã€‚å¦‚æœåªæœ‰ä¸€ä¸ª worker èŠ‚ç‚¹ï¼Œåˆ™ä¸éœ€è¦ã€‚</p></li></ul><blockquote><p>drain æ˜¯ä¸ºäº†åœ¨å‡çº§æœŸé—´ é¿å…è¯¥èŠ‚ç‚¹ä¸Šæ­£åœ¨è¿è¡Œçš„ä¸šåŠ¡å®¹å™¨å—åˆ°å½±å“</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸Šæ‰§è¡Œæ­¤å‘½ä»¤</span></span><br><span class="line"><span class="comment"># å°† &lt;node-to-drain&gt; æ›¿æ¢ä¸ºä½ æ­£è…¾ç©ºçš„èŠ‚ç‚¹çš„åç§°</span></span><br><span class="line">$ kubectl drain &lt;node-to-drain&gt; --ignore-daemonsets</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‡çº§ node èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> kubeadm upgrade node</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‡çº§ kubelet å’Œ kubectl</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šçš„ç‰ˆæœ¬</span></span><br><span class="line">$ <span class="built_in">sudo</span> yum install -y kubelet-1.33.3 kubectl-1.33.3</span><br><span class="line"><span class="comment"># é‡å¯ kubelet</span></span><br><span class="line">$ <span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line">$ <span class="built_in">sudo</span> systemctl restart kubelet</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœå‰é¢å¯¹èŠ‚ç‚¹åšäº† è…¾ç©ºèŠ‚ç‚¹ æ“ä½œï¼Œåˆ™éœ€è¦å–æ¶ˆå¯¹èŠ‚ç‚¹çš„ä¿æŠ¤ï¼Œå°†èŠ‚ç‚¹æ ‡è®°ä¸ºå¯è°ƒåº¦ï¼Œè®©èŠ‚ç‚¹é‡æ–°ä¸Šçº¿</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸Šæ‰§è¡Œæ­¤å‘½ä»¤</span></span><br><span class="line"><span class="comment"># å°† &lt;node-to-uncordon&gt; æ›¿æ¢ä¸ºä½ çš„èŠ‚ç‚¹åç§°</span></span><br><span class="line">$ kubectl uncordon &lt;node-to-uncordon&gt;</span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°è¯ä¹¦">æ›´æ–°è¯ä¹¦</h2><ul class="lvl-0"><li class="lvl-2"><p>kubeadm åˆ›å»ºçš„è¯ä¹¦å­˜æ”¾åœ¨ <code>/etc/kubernetes/pki/</code> ä¸‹ï¼Œé»˜è®¤å®¢æˆ·ç«¯è¯ä¹¦æœ‰æ•ˆæœŸä¸º 1 å¹´</p></li><li class="lvl-2"><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kube-system get cm kubeadm-config -o yaml</span><br><span class="line">openssl x509 -<span class="keyword">in</span> /etc/kubernetes/pki/apiserver.crt -text</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹è¯ä¹¦åˆ°æœŸæ—¶é—´</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> kubeadm certs check-expiration</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="comment">## å¯ä»¥çœ‹åˆ° å®¢æˆ·ç«¯ çš„è¯ä¹¦çš„è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º 1 å¹´</span></span><br><span class="line">CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED</span><br><span class="line">admin.conf                 Jun 29, 2026 14:41 UTC   363d            ca                      no</span><br><span class="line">apiserver                  Jun 29, 2026 14:41 UTC   363d            ca                      no</span><br><span class="line">apiserver-etcd-client      Jun 29, 2026 14:41 UTC   363d            etcd-ca                 no</span><br><span class="line">apiserver-kubelet-client   Jun 29, 2026 14:41 UTC   363d            ca                      no</span><br><span class="line">controller-manager.conf    Jun 29, 2026 14:41 UTC   363d            ca                      no</span><br><span class="line">etcd-healthcheck-client    Jun 29, 2026 14:41 UTC   363d            etcd-ca                 no</span><br><span class="line">etcd-peer                  Jun 29, 2026 14:41 UTC   363d            etcd-ca                 no</span><br><span class="line">etcd-server                Jun 29, 2026 14:41 UTC   363d            etcd-ca                 no</span><br><span class="line">front-proxy-client         Jun 29, 2026 14:41 UTC   363d            front-proxy-ca          no</span><br><span class="line">scheduler.conf             Jun 29, 2026 14:41 UTC   363d            ca                      no</span><br><span class="line">super-admin.conf           Jun 29, 2026 14:41 UTC   363d            ca                      no</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹è¯ä¹¦é»˜è®¤æœ‰æ•ˆæœŸä¸º 10 å¹´</span></span><br><span class="line">CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED</span><br><span class="line">ca                      Jun 27, 2035 14:41 UTC   9y              no</span><br><span class="line">etcd-ca                 Jun 27, 2035 14:41 UTC   9y              no</span><br><span class="line">front-proxy-ca          Jun 27, 2035 14:41 UTC   9y              no</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ›´æ–°å®¢æˆ·ç«¯è¯ä¹¦</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ–°å‰å¤‡ä»½</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> -rf /etc/kubernetes/ /etc/kubernetes.bak</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> -rf /var/lib/etcd/ /var/lib/etcd.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥æ›´æ–°å•ä¸ªå®¢æˆ·ç«¯è¯ä¹¦</span></span><br><span class="line"><span class="comment"># sudo kubeadm certs renew admin.conf</span></span><br><span class="line"><span class="comment"># sudo kubeadm certs renew apiserver</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡çº§å…¨éƒ¨å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä¹Ÿåªèƒ½ç»­æœŸ1å¹´</span></span><br><span class="line"><span class="built_in">sudo</span> kubeadm certs renew all</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">[renew] Reading configuration from the <span class="string">&quot;kubeadm-config&quot;</span> ConfigMap <span class="keyword">in</span> namespace <span class="string">&quot;kube-system&quot;</span>...</span><br><span class="line">[renew] Use <span class="string">&#x27;kubeadm init phase upload-config --config your-config-file&#x27;</span> to re-upload it.</span><br><span class="line"></span><br><span class="line">certificate embedded <span class="keyword">in</span> the kubeconfig file <span class="keyword">for</span> the admin to use and <span class="keyword">for</span> kubeadm itself renewed</span><br><span class="line">certificate <span class="keyword">for</span> serving the Kubernetes API renewed</span><br><span class="line">certificate the apiserver uses to access etcd renewed</span><br><span class="line">certificate <span class="keyword">for</span> the API server to connect to kubelet renewed</span><br><span class="line">certificate embedded <span class="keyword">in</span> the kubeconfig file <span class="keyword">for</span> the controller manager to use renewed</span><br><span class="line">certificate <span class="keyword">for</span> liveness probes to healthcheck etcd renewed</span><br><span class="line">certificate <span class="keyword">for</span> etcd nodes to communicate with each other renewed</span><br><span class="line">certificate <span class="keyword">for</span> serving etcd renewed</span><br><span class="line">certificate <span class="keyword">for</span> the front proxy client renewed</span><br><span class="line">certificate embedded <span class="keyword">in</span> the kubeconfig file <span class="keyword">for</span> the scheduler manager to use renewed</span><br><span class="line">certificate embedded <span class="keyword">in</span> the kubeconfig file <span class="keyword">for</span> the super-admin renewed</span><br><span class="line"></span><br><span class="line">Done renewing certificates. You must restart the kube-apiserver, kube-controller-manager, kube-scheduler and etcd, so that they can use the new certificates.</span><br><span class="line"></span><br><span class="line"><span class="comment"># éœ€è¦æ ¹æ®è¾“å‡ºæç¤ºé‡å¯ kube-apiserver, kube-controller-manager, kube-scheduler å’Œ etcd</span></span><br><span class="line"><span class="comment"># è¿™å‡ ä¸ªç»„ä»¶æ˜¯é€šè¿‡pod å¯åŠ¨çš„ï¼Œå¯ä»¥é€šè¿‡ kubectl get pod -n kube-system æŸ¥çœ‹</span></span><br><span class="line">$ kubectl get pods -n kube-system</span><br><span class="line">NAME                                       READY   STATUS    RESTARTS        AGE</span><br><span class="line">calico-kube-controllers-7bfdc5b57c-q5xwp   1/1     Running   3 (5h37m ago)   41h</span><br><span class="line">calico-node-7pbbq                          1/1     Running   3 (5h36m ago)   41h</span><br><span class="line">calico-node-v4hzr                          1/1     Running   2 (5h37m ago)   19h</span><br><span class="line">calico-node-w47qq                          1/1     Running   3 (5h37m ago)   41h</span><br><span class="line">coredns-674b8bbfcf-2tvld                   1/1     Running   3 (5h37m ago)   41h</span><br><span class="line">coredns-674b8bbfcf-h6kx7                   1/1     Running   3 (5h37m ago)   41h</span><br><span class="line">etcd-k8s-master                            1/1     Running   5 (5h37m ago)   41h</span><br><span class="line">kube-apiserver-k8s-master                  1/1     Running   7 (5h37m ago)   41h</span><br><span class="line">kube-controller-manager-k8s-master         1/1     Running   7 (5h37m ago)   41h</span><br><span class="line">kube-proxy-nkbns                           1/1     Running   3 (5h36m ago)   41h</span><br><span class="line">kube-proxy-plqw8                           1/1     Running   3 (5h37m ago)   41h</span><br><span class="line">kube-proxy-sbgh6                           1/1     Running   2 (5h37m ago)   19h</span><br><span class="line">kube-scheduler-k8s-master                  1/1     Running   7 (5h37m ago)   41h</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æŒ‡å®šçš„podå°±ä¼šè‡ªåŠ¨é‡å¯</span></span><br><span class="line">kubectl delete pod -n kube-system kube-apiserver-k8s-master kube-controller-manager-k8s-master  kube-scheduler-k8s-master etcd-k8s-master</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯æˆåŠŸåå†æ¬¡æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ï¼Œå°±ä¼šçœ‹åˆ°æ›´æ–°åçš„åˆ°æœŸæ—¶é—´ä¸º1å¹´</span></span><br><span class="line"><span class="built_in">sudo</span> kubeadm certs check-expiration</span><br></pre></td></tr></table></figure><h2 id="Kubernetes-èŠ‚ç‚¹ç»„ä»¶">Kubernetes èŠ‚ç‚¹ç»„ä»¶</h2><table><thead><tr><th>è§’è‰²</th><th>ç»„ä»¶å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Master Node</strong></td><td><code>kube-apiserver</code></td><td>Kubernetes çš„ API è¯·æ±‚å…¥å£ï¼Œå¤„ç†æ‰€æœ‰ REST è¯·æ±‚ï¼Œåè°ƒå„ç»„ä»¶ã€‚</td></tr><tr><td></td><td><code>kube-scheduler</code></td><td>è°ƒåº¦å™¨ï¼Œå†³å®šå°† Pod è°ƒåº¦åˆ°å“ªä¸ªåˆé€‚çš„ Nodeã€‚</td></tr><tr><td></td><td><code>kube-controller-manager</code></td><td>åŒ…å«å¤šä¸ªæ§åˆ¶å™¨ï¼ˆå¦‚ NodeControllerã€ReplicationControllerã€DeploymentController ç­‰ï¼‰ï¼Œç”¨äºæ§åˆ¶å’Œè°ƒæ•´é›†ç¾¤çŠ¶æ€ã€‚</td></tr><tr><td></td><td><code>etcd</code></td><td>åˆ†å¸ƒå¼ KV å­˜å‚¨ç³»ç»Ÿï¼Œå­˜å‚¨ Kubernetes æ‰€æœ‰çŠ¶æ€æ•°æ®ã€‚åªæœ‰ API Server èƒ½ç›´æ¥è®¿é—®ã€‚</td></tr><tr><td><strong>Worker Node</strong></td><td><code>kubelet</code></td><td>è´Ÿè´£ä¸ Master é€šä¿¡ï¼Œæ‰§è¡Œå…¶ä¸‹å‘çš„ Pod ç®¡ç†ä»»åŠ¡ï¼Œæ§åˆ¶å®¹å™¨ç”Ÿå‘½å‘¨æœŸã€‚</td></tr><tr><td></td><td><code>kube-proxy</code></td><td>è´Ÿè´£ç»´æŠ¤ Node ä¸Šçš„ç½‘ç»œè§„åˆ™ï¼Œæ”¯æŒæœåŠ¡è´Ÿè½½å‡è¡¡å’Œç½‘ç»œé€šä¿¡ã€‚</td></tr><tr><td></td><td><code>container runtime</code></td><td>å®¹å™¨è¿è¡Œæ—¶ï¼Œæ¯”å¦‚ Dockerã€containerdã€CRI-Oï¼Œè´Ÿè´£å®é™…è¿è¡Œå®¹å™¨ã€‚</td></tr></tbody></table><h2 id="crictl-å‘½ä»¤">crictl å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p><code>crictl</code> æ˜¯k8så®˜æ–¹å‡ºå“çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ containerd è¿›è¡Œé€šä¿¡ã€‚</p></li><li class="lvl-2"><p><code>crictl</code> å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç±»ä¼¼<code>docker</code>å‘½ä»¤</p></li></ul><table><thead><tr><th>æ“ä½œ</th><th><code>docker</code> å‘½ä»¤</th><th><code>crictl</code> å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</td><td><code>docker ps</code></td><td><code>crictl ps</code></td><td></td></tr><tr><td>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢ï¼‰</td><td><code>docker ps -a</code></td><td><code>crictl ps -a</code></td><td></td></tr><tr><td>æŸ¥çœ‹é•œåƒ</td><td><code>docker images</code></td><td><code>crictl images</code></td><td></td></tr><tr><td>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</td><td><code>docker logs &lt;container_id&gt;</code></td><td><code>crictl logs &lt;container_id&gt;</code></td><td></td></tr><tr><td>è¿›å…¥å®¹å™¨äº¤äº’</td><td><code>docker exec -it &lt;id&gt; sh</code></td><td><code>crictl exec -it &lt;id&gt; sh</code></td><td></td></tr><tr><td>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</td><td><code>docker inspect &lt;container_id&gt;</code></td><td><code>crictl inspect &lt;container_id&gt;</code></td><td></td></tr><tr><td>æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯</td><td>âŒï¼ˆä¸æ”¯æŒï¼‰</td><td><code>crictl inspectp &lt;pod_id&gt;</code></td><td>K8s ä¸“å±</td></tr><tr><td>åˆ é™¤å®¹å™¨</td><td><code>docker rm &lt;container_id&gt;</code></td><td><code>crictl rm &lt;container_id&gt;</code></td><td></td></tr><tr><td>åˆ é™¤é•œåƒ</td><td><code>docker rmi &lt;image_id&gt;</code></td><td><code>crictl rmi &lt;image_id&gt;</code></td><td></td></tr><tr><td>æ‹‰å–é•œåƒ</td><td><code>docker pull nginx</code></td><td><code>crictl pull nginx</code></td><td></td></tr><tr><td>è¿è¡Œå®¹å™¨ï¼ˆé K8s åœºæ™¯ï¼‰</td><td><code>docker run -it nginx</code></td><td>âŒï¼ˆä¸æ”¯æŒï¼‰</td><td><code>crictl</code> ä¸è¿è¡Œå®¹å™¨ï¼Œä»…è°ƒè¯•ç°æœ‰å®¹å™¨</td></tr><tr><td>åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶ä¿¡æ¯</td><td><code>docker info</code></td><td><code>crictl info</code></td><td></td></tr><tr><td>æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€</td><td><code>docker stats</code></td><td><code>crictl stats</code></td><td>ç®€è¦ç‰ˆ</td></tr><tr><td>è®¾ç½®é…ç½®æ–‡ä»¶</td><td><code>~/.docker/config.json</code></td><td><code>/etc/crictl.yaml</code></td><td>å¦‚è®¾ç½® endpoint</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Linux ä¸‹ ä½¿ç”¨ kubeadm å®‰è£… K8S çš„æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/&quot;&gt;ä½¿ç”¨ kubeadm å¼•å¯¼é›†ç¾¤&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/reference/setup-tools/kubeadm/&quot;&gt;kubeadm å‘½ä»¤æŒ‡å—&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/&quot;&gt;ç”¨ kubeadm è¿›è¡Œç®¡ç†&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>Linux å®‰è£… K8S ä¹‹ minikube</title>
    <link href="https://blog.hanqunfeng.com/2025/06/28/k8s-install-minikube/"/>
    <id>https://blog.hanqunfeng.com/2025/06/28/k8s-install-minikube/</id>
    <published>2025-06-28T13:30:05.000Z</published>
    <updated>2025-06-30T05:56:30.873Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Linux ä¸‹ ä½¿ç”¨ minikube å®‰è£… K8S çš„æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://minikube.sigs.k8s.io/docs/">minikubeå®˜ç½‘</a></p></li></ul><span id="more"></span><h2 id="å®‰è£…å‰è®¾ç½®">å®‰è£…å‰è®¾ç½®</h2><h3 id="ä¿®æ­£ç³»ç»Ÿçš„æ—¶é—´">ä¿®æ­£ç³»ç»Ÿçš„æ—¶é—´</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…chrony</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install chrony -y</span><br><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now chronyd</span><br><span class="line"><span class="comment"># ä¿®æ­£æ—¶é—´</span></span><br><span class="line"><span class="built_in">sudo</span> chronyc makestep</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¶é—´</span></span><br><span class="line"><span class="built_in">date</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-docker">å®‰è£… <code>docker</code></h3><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…æ–¹æ³•å‚è§ <a href="/2025/05/20/docker-install/" title="Linux å®‰è£… Docker">Linux å®‰è£… Docker</a></p></li></ul><h3 id="åˆ›å»ºç”¨æˆ·">åˆ›å»ºç”¨æˆ·</h3><ul class="lvl-0"><li class="lvl-2"><p>é¿å…ä½¿ç”¨rootç”¨æˆ·ï¼Œè¿™é‡Œåˆ›å»ºä¸€ä¸ª <code>centos</code> ç”¨æˆ·ï¼Œè¦æ±‚è¯¥ç”¨æˆ·å…·æœ‰<code>sudo</code>æƒé™ï¼Œå¦‚æœä½¿ç”¨<code>docker</code>è¿è¡Œæ—¶ï¼Œåˆ™éœ€è¦å°†è¯¥ç”¨æˆ·æ·»åŠ åˆ°<code>docker</code>ç”¨æˆ·ç»„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">$ <span class="built_in">sudo</span> useradd -m -s /bin/bash centos</span><br><span class="line"><span class="comment"># 2.æ·»åŠ åˆ°dockerç”¨æˆ·ç»„</span></span><br><span class="line">$ <span class="built_in">sudo</span> usermod -aG docker centos</span><br><span class="line"><span class="comment"># 3.å°†ç”¨æˆ·æ·»åŠ åˆ° sudoï¼ˆç®¡ç†å‘˜ï¼‰ç»„ï¼Œè¯´æ˜ï¼šwheel æ˜¯ CentOS ä¸­å…è®¸ä½¿ç”¨ sudo æƒé™çš„ç”¨æˆ·ç»„ã€‚å…·ä½“å¯ä»¥é€šè¿‡ visudo å‘½ä»¤æŸ¥çœ‹</span></span><br><span class="line">$ <span class="built_in">sudo</span> usermod -aG wheel centos</span><br><span class="line"><span class="comment">## è¿™ç§æ·»åŠ æ–¹å¼ä½¿ç”¨sudoæ—¶éœ€è¦è¾“å…¥å¯†ç ï¼Œå¦‚æœä¸å¸Œæœ›è¾“å…¥å¯†ç ï¼Œå¯ä»¥é€šè¿‡ visudo å‘½ä»¤ä¿®æ”¹ï¼Œå°† wheel ç»„æ”¹ä¸º %wheel ALL=(ALL) NOPASSWD: ALL çš„å½¢å¼</span></span><br><span class="line"><span class="comment"># 4.åˆ‡æ¢ç”¨æˆ·ï¼Œä»¥ä¸‹æ“ä½œå‡åœ¨è¯¥ç”¨æˆ·ä¸‹è¿›è¡Œ</span></span><br><span class="line">$ su - centos</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-kubectl">å®‰è£… <code>kubectl</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä¸‹è½½ kubectl</span></span><br><span class="line">$ curl -LO <span class="string">&quot;https://dl.k8s.io/release/<span class="subst">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.éªŒè¯ä¸‹è½½(å¯é€‰)</span></span><br><span class="line">$ curl -LO <span class="string">&quot;https://dl.k8s.io/release/<span class="subst">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl.sha256&quot;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(cat kubectl.sha256)</span>  kubectl&quot;</span> | <span class="built_in">sha256sum</span> --check</span><br><span class="line"><span class="comment">## éªŒè¯é€šè¿‡è¾“å‡º</span></span><br><span class="line">kubectl: æˆåŠŸ</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å®‰è£… kubectl</span></span><br><span class="line">$ <span class="built_in">sudo</span> install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æŸ¥çœ‹å®‰è£…çš„ç‰ˆæœ¬</span></span><br><span class="line">$ kubectl version --client</span><br><span class="line">Client Version: v1.33.2</span><br><span class="line">Kustomize Version: v5.6.0</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯ç”¨ shell è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å®‰è£… bash-completion</span></span><br><span class="line"><span class="comment"># 1.1 æ£€æŸ¥bash-completionæ˜¯å¦å·²å®‰è£…ï¼Œæœ‰è¾“å‡ºè¯´æ˜å·²ç»å®‰è£…</span></span><br><span class="line">$ <span class="built_in">type</span> _init_completion</span><br><span class="line"><span class="comment"># 1.2 å®‰è£…bash-completionï¼Œå®‰è£…åä¼šåˆ›å»ºæ–‡ä»¶ /usr/share/bash-completion/bash_completion</span></span><br><span class="line">$ dnf install bash-completion</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å®‰è£… kubectl çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</span></span><br><span class="line"><span class="comment"># 2.1 å½“å‰ç”¨æˆ·</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;source &lt;(kubectl completion bash)&#x27;</span> &gt;&gt;~/.bashrc</span><br><span class="line"><span class="comment"># 2.2 æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line">$ kubectl completion bash | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/bash_completion.d/kubectl &gt; /dev/null</span><br><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">chmod</span> a+r /etc/bash_completion.d/kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 å¦‚æœ kubectl æœ‰å…³è”çš„åˆ«åï¼Œä½ å¯ä»¥æ‰©å±• Shell è¡¥å…¨æ¥é€‚é…æ­¤åˆ«å</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;alias k=kubectl&#x27;</span> &gt;&gt;~/.bashrc</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;complete -o default -F __start_kubectl k&#x27;</span> &gt;&gt;~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åˆ·æ–°é…ç½®æ–‡ä»¶</span></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-minikube-åˆ›å»º-K8S-é›†ç¾¤">ä½¿ç”¨ minikube åˆ›å»º K8S é›†ç¾¤</h2><ul class="lvl-0"><li class="lvl-2"><p>è¯¥å·¥å…·åªé€‚åˆåœ¨æœ¬æœºè¿›è¡Œå¼€å‘å’Œæµ‹è¯•æ—¶ä½¿ç”¨ï¼Œå…¶åŸç†æ˜¯åœ¨æœ¬æœºçš„dockerç¯å¢ƒä¸­åˆ›å»ºä¸€ä¸ª<code>minikube</code>å®¹å™¨ä½œä¸º<code>k8s</code>çš„èŠ‚ç‚¹æœºã€‚</p></li></ul><h3 id="å®‰è£…-minikube">å®‰è£… minikube</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://minikube.sigs.k8s.io/docs/start/?arch=%2Flinux%2Fx86-64%2Fstable%2Fbinary+download">minikubeå®‰è£…è¯´æ˜</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä¸‹è½½</span></span><br><span class="line">$ curl -LO https://github.com/kubernetes/minikube/releases/latest/download/minikube-linux-amd64</span><br><span class="line"><span class="comment"># 2.å®‰è£…</span></span><br><span class="line">$ <span class="built_in">sudo</span> install minikube-linux-amd64 /usr/local/bin/minikube &amp;&amp; <span class="built_in">rm</span> minikube-linux-amd64</span><br><span class="line"><span class="comment"># 3.éªŒè¯</span></span><br><span class="line">$ minikube version</span><br><span class="line"><span class="comment"># 4.æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line">$ minikube --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºé›†ç¾¤">åˆ›å»ºé›†ç¾¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºé›†ç¾¤ï¼Œæ³¨æ„ä¸èƒ½ä½¿ç”¨ root ç”¨æˆ·ï¼Œè¦æ±‚è¯¥ç”¨æˆ·å…·æœ‰ docker æƒé™ï¼Œå¹¶ä¸”å…·æœ‰sudoæƒé™ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment"># ç³»ç»Ÿå†…å­˜è‡³å°‘ 4Gï¼Œä»¥ä¿è¯ç¨³å®šæ€§</span></span><br><span class="line"><span class="comment"># é»˜è®¤ä½¿ç”¨dockeré©±åŠ¨ --driver=dockerï¼Œminikube æ”¯æŒçš„é©±åŠ¨ï¼šhttps://minikube.sigs.k8s.io/docs/drivers/</span></span><br><span class="line">$ minikube start</span><br><span class="line">ğŸ˜„  Rocky 8.10 (amd64) ä¸Šçš„ minikube v1.36.0</span><br><span class="line">âœ¨  æ ¹æ®ç°æœ‰çš„é…ç½®æ–‡ä»¶ä½¿ç”¨ docker é©±åŠ¨ç¨‹åº</span><br><span class="line">ğŸ‘  åœ¨é›†ç¾¤ä¸­ <span class="string">&quot;minikube&quot;</span> å¯åŠ¨èŠ‚ç‚¹ <span class="string">&quot;minikube&quot;</span> primary control-plane</span><br><span class="line">ğŸšœ  æ­£åœ¨æ‹‰å–åŸºç¡€é•œåƒ v0.0.47 ...</span><br><span class="line">    &gt; index.docker.io/kicbase/sta...:  502.26 MiB / 502.26 MiB  100.00% 27.50 M</span><br><span class="line">â—  minikube was unable to download gcr.io/k8s-minikube/kicbase:v0.0.47, but successfully downloaded docker.io/kicbase/stable:v0.0.47@sha256:6ed579c9292b4370177b7ef3c42cc4b4a6dcd0735a1814916cbc22c8bf38412b as a fallback image</span><br><span class="line">ğŸ”¥  åˆ›å»º docker containerï¼ˆCPU=2ï¼Œå†…å­˜=2200MBï¼‰...</span><br><span class="line">ğŸ³  æ­£åœ¨ Docker 28.1.1 ä¸­å‡†å¤‡ Kubernetes v1.33.1â€¦</span><br><span class="line">    â–ª æ­£åœ¨ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥...</span><br><span class="line">    â–ª æ­£åœ¨å¯åŠ¨æ§åˆ¶å¹³é¢...</span><br><span class="line">    â–ª é…ç½® RBAC è§„åˆ™ ...</span><br><span class="line">ğŸ”—  é…ç½® bridge CNI (Container Networking Interface) ...</span><br><span class="line">ğŸ”  æ­£åœ¨éªŒè¯ Kubernetes ç»„ä»¶...</span><br><span class="line">    â–ª æ­£åœ¨ä½¿ç”¨é•œåƒ gcr.io/k8s-minikube/storage-provisioner:v5</span><br><span class="line">ğŸŒŸ  å¯ç”¨æ’ä»¶ï¼š default-storageclass, storage-provisioner</span><br><span class="line">ğŸ„  å®Œæˆï¼kubectl ç°åœ¨å·²é…ç½®ï¼Œé»˜è®¤ä½¿ç”¨<span class="string">&quot;minikube&quot;</span>é›†ç¾¤å’Œ<span class="string">&quot;default&quot;</span>å‘½åç©ºé—´</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Minikube å…è®¸ä½ åˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„ Kubernetes é›†ç¾¤ï¼Œæ¯ä¸ª profile æ˜¯ä¸€ä¸ªå•ç‹¬çš„ minikube å®ä¾‹ï¼Œäº’ä¸å¹²æ‰°ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -p æ˜¯ --profile çš„ç¼©å†™ï¼Œè¡¨ç¤º æŒ‡å®šä½¿ç”¨å“ªä¸ª Minikube é›†ç¾¤ï¼ˆProfileï¼‰,é»˜è®¤ profile åæ˜¯ minikube</span></span><br><span class="line">minikube start -p dev</span><br><span class="line">minikube start -p <span class="built_in">test</span></span><br><span class="line">minikube start -p prod</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è·å–é›†ç¾¤çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get nodes</span><br><span class="line">NAME       STATUS   ROLES           AGE   VERSION</span><br><span class="line">minikube   Ready    control-plane   27s   v1.33.1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹æœ¬æœºå®¹å™¨ï¼Œk8s é›†ç¾¤å°±åœ¨è¿™ä¸ªå®¹å™¨ä¸­</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE                    COMMAND                   CREATED          STATUS          PORTS                                                                                                                                  NAMES</span><br><span class="line">4e7eaad73934   kicbase/stable:v0.0.47   <span class="string">&quot;/usr/local/bin/entrâ€¦&quot;</span>   47 minutes ago   Up 47 minutes   127.0.0.1:32772-&gt;22/tcp, 127.0.0.1:32771-&gt;2376/tcp, 127.0.0.1:32770-&gt;5000/tcp, 127.0.0.1:32769-&gt;8443/tcp, 127.0.0.1:32768-&gt;32443/tcp   minikube</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¯¥å®¹å™¨ä¸­çš„dockerå®¹å™¨</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it minikube docker ps</span><br><span class="line">CONTAINER ID   IMAGE                        COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">c25bcc3cb76c   1cf5f116067c                 <span class="string">&quot;/coredns -conf /etcâ€¦&quot;</span>   2 minutes ago   Up 2 minutes             k8s_coredns_coredns-674b8bbfcf-8jrx4_kube-system_bc7a83c7-31e7-495c-820a-a29414099387_0</span><br><span class="line">a22714ccfce2   b79c189b052c                 <span class="string">&quot;/usr/local/bin/kubeâ€¦&quot;</span>   2 minutes ago   Up 2 minutes             k8s_kube-proxy_kube-proxy-5dkt4_kube-system_8ad25d8e-b023-4383-9441-0ddbb5159c9b_0</span><br><span class="line">a368d902aef9   registry.k8s.io/pause:3.10   <span class="string">&quot;/pause&quot;</span>                 2 minutes ago   Up 2 minutes             k8s_POD_kube-proxy-5dkt4_kube-system_8ad25d8e-b023-4383-9441-0ddbb5159c9b_0</span><br><span class="line">973caed86b2c   registry.k8s.io/pause:3.10   <span class="string">&quot;/pause&quot;</span>                 2 minutes ago   Up 2 minutes             k8s_POD_coredns-674b8bbfcf-8jrx4_kube-system_bc7a83c7-31e7-495c-820a-a29414099387_0</span><br><span class="line">9db7567143a2   6e38f40d628d                 <span class="string">&quot;/storage-provisioner&quot;</span>   2 minutes ago   Up 2 minutes             k8s_storage-provisioner_storage-provisioner_kube-system_4e82402e-ba65-4061-920e-988a71cb529b_0</span><br><span class="line">ba39fe88ad59   registry.k8s.io/pause:3.10   <span class="string">&quot;/pause&quot;</span>                 2 minutes ago   Up 2 minutes             k8s_POD_storage-provisioner_kube-system_4e82402e-ba65-4061-920e-988a71cb529b_0</span><br><span class="line">ef0733df95b4   ef43894fa110                 <span class="string">&quot;kube-controller-manâ€¦&quot;</span>   2 minutes ago   Up 2 minutes             k8s_kube-controller-manager_kube-controller-manager-minikube_kube-system_0378f173c980f85a71d36305bacb0ad1_0</span><br><span class="line">852828a600d5   c6ab243b29f8                 <span class="string">&quot;kube-apiserver --adâ€¦&quot;</span>   2 minutes ago   Up 2 minutes             k8s_kube-apiserver_kube-apiserver-minikube_kube-system_78e1292e1d47cc7d09b2c6f5826fa624_0</span><br><span class="line">97efb54702cd   499038711c08                 <span class="string">&quot;etcd --advertise-clâ€¦&quot;</span>   2 minutes ago   Up 2 minutes             k8s_etcd_etcd-minikube_kube-system_3924ef3609584191d8d09190210d2d78_0</span><br><span class="line">a3dd2c2817f1   398c985c0d95                 <span class="string">&quot;kube-scheduler --auâ€¦&quot;</span>   2 minutes ago   Up 2 minutes             k8s_kube-scheduler_kube-scheduler-minikube_kube-system_feee622ba49882ef945e2406d3ba86df_0</span><br><span class="line">927ebc63cf80   registry.k8s.io/pause:3.10   <span class="string">&quot;/pause&quot;</span>                 2 minutes ago   Up 2 minutes             k8s_POD_kube-scheduler-minikube_kube-system_feee622ba49882ef945e2406d3ba86df_0</span><br><span class="line">744d4c6e3571   registry.k8s.io/pause:3.10   <span class="string">&quot;/pause&quot;</span>                 2 minutes ago   Up 2 minutes             k8s_POD_kube-controller-manager-minikube_kube-system_0378f173c980f85a71d36305bacb0ad1_0</span><br><span class="line">4ae6bdc25908   registry.k8s.io/pause:3.10   <span class="string">&quot;/pause&quot;</span>                 2 minutes ago   Up 2 minutes             k8s_POD_kube-apiserver-minikube_kube-system_78e1292e1d47cc7d09b2c6f5826fa624_0</span><br><span class="line">dff641d8672a   registry.k8s.io/pause:3.10   <span class="string">&quot;/pause&quot;</span>                 2 minutes ago   Up 2 minutes             k8s_POD_etcd-minikube_kube-system_3924ef3609584191d8d09190210d2d78_0</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-3"><p>é…ç½®ä½ çš„ç»ˆç«¯ï¼Œè®© Docker CLI æŒ‡å‘ minikube å†…éƒ¨çš„ Docker å®ˆæŠ¤è¿›ç¨‹ï¼ˆå°±æ˜¯é€šè¿‡ docker è¿œç¨‹è¿æ¥çš„æ–¹å¼ï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹dockerè¿œç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶é…ç½®åˆ°å®¿ä¸»æœºçš„ç¯å¢ƒå˜é‡ä¸­</span></span><br><span class="line">$ minikube docker-env</span><br><span class="line"><span class="built_in">export</span> DOCKER_TLS_VERIFY=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="built_in">export</span> DOCKER_HOST=<span class="string">&quot;tcp://192.168.49.2:2376&quot;</span></span><br><span class="line"><span class="built_in">export</span> DOCKER_CERT_PATH=<span class="string">&quot;/home/centos/.minikube/certs&quot;</span></span><br><span class="line"><span class="built_in">export</span> MINIKUBE_ACTIVE_DOCKERD=<span class="string">&quot;minikube&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To point your shell to minikube&#x27;s docker-daemon, run:</span></span><br><span class="line"><span class="comment"># eval $(minikube -p minikube docker-env)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸´æ—¶é…ç½®å®¿ä¸»æœºç¯å¢ƒå˜é‡ï¼Œæ­¤æ—¶æˆ‘ä»¬å†æ‰§è¡Œdockerå‘½ä»¤ï¼Œå°±ä¼šä½¿ç”¨minikubeçš„docker-daemon</span></span><br><span class="line">$ <span class="built_in">eval</span> $(minikube -p minikube docker-env)</span><br><span class="line"><span class="comment"># å–æ¶ˆä¸´æ—¶é…ç½®,-u æ˜¯ --unset çš„ç¼©å†™</span></span><br><span class="line">$ <span class="built_in">eval</span> $(minikube -p minikube docker-env -u)</span><br></pre></td></tr></table></figure><h3 id="minikube-å‘½ä»¤">minikube å‘½ä»¤</h3><ul class="lvl-0"><li class="lvl-2"><p>ç™»å½•åˆ° minikube ç¯å¢ƒï¼ˆç”¨äºè°ƒè¯•ï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®é™…ä¸Šå°±æ˜¯è¿›å…¥minikubeå®¹å™¨çš„shell</span></span><br><span class="line">$ minikube ssh</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œ kubectl å‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ”¯æŒçš„å‘½ä»¤</span></span><br><span class="line">$ minikube kubectl -- --<span class="built_in">help</span></span><br><span class="line"><span class="comment"># è¿è¡Œ kubectl å‘½ä»¤ï¼Œè¿™é‡Œæ³¨æ„ minikube kubectl -- å‰é¢æœ‰ç©ºæ ¼</span></span><br><span class="line">$ minikube kubectl -- get pods --namespace kube-system</span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-674b8bbfcf-8jrx4           1/1     Running   0          45m</span><br><span class="line">etcd-minikube                      1/1     Running   0          45m</span><br><span class="line">kube-apiserver-minikube            1/1     Running   0          45m</span><br><span class="line">kube-controller-manager-minikube   1/1     Running   0          45m</span><br><span class="line">kube-proxy-5dkt4                   1/1     Running   0          45m</span><br><span class="line">kube-scheduler-minikube            1/1     Running   0          45m</span><br><span class="line">storage-provisioner                1/1     Running   0          45m</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>nodeèŠ‚ç‚¹ç®¡ç†</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ä¸€ä¸ªworkerèŠ‚ç‚¹ï¼Œæ­¤æ—¶å°±æ˜¯åˆå¯åŠ¨äº†ä¸€ä¸ªminikubeå®¹å™¨</span></span><br><span class="line">$ minikube node add</span><br><span class="line">ğŸ˜„  å°†èŠ‚ç‚¹ m02 ä½œä¸º [worker] æ·»åŠ åˆ°é›†ç¾¤ minikube</span><br><span class="line">â—  åœ¨æ²¡æœ‰ä»»ä½• CNI çš„æƒ…å†µä¸‹åˆ›å»ºé›†ç¾¤ï¼Œå‘å…¶ä¸­æ·»åŠ èŠ‚ç‚¹å¯èƒ½ä¼šå¯¼è‡´ç½‘ç»œä¸­æ–­ã€‚</span><br><span class="line">ğŸ‘  åœ¨é›†ç¾¤ä¸­ <span class="string">&quot;minikube&quot;</span> å¯åŠ¨èŠ‚ç‚¹ <span class="string">&quot;minikube-m02&quot;</span> worker</span><br><span class="line">ğŸšœ  æ­£åœ¨æ‹‰å–åŸºç¡€é•œåƒ v0.0.47 ...</span><br><span class="line">ğŸ”¥  åˆ›å»º docker containerï¼ˆCPU=2ï¼Œå†…å­˜=2200MBï¼‰...</span><br><span class="line">ğŸ³  æ­£åœ¨ Docker 28.1.1 ä¸­å‡†å¤‡ Kubernetes v1.33.1â€¦</span><br><span class="line">ğŸ”  æ­£åœ¨éªŒè¯ Kubernetes ç»„ä»¶...</span><br><span class="line">ğŸ„  å·²æˆåŠŸå°† m02 æ·»åŠ åˆ° minikubeï¼</span><br><span class="line"></span><br><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE                    COMMAND                   CREATED             STATUS             PORTS                                                                                                                                  NAMES</span><br><span class="line">ce5431e994c3   kicbase/stable:v0.0.47   <span class="string">&quot;/usr/local/bin/entrâ€¦&quot;</span>   24 minutes ago      Up 24 minutes      127.0.0.1:32792-&gt;22/tcp, 127.0.0.1:32791-&gt;2376/tcp, 127.0.0.1:32790-&gt;5000/tcp, 127.0.0.1:32789-&gt;8443/tcp, 127.0.0.1:32788-&gt;32443/tcp   minikube-m02</span><br><span class="line">2739aa21a085   kicbase/stable:v0.0.47   <span class="string">&quot;/usr/local/bin/entrâ€¦&quot;</span>   About an hour ago   Up About an hour   127.0.0.1:32777-&gt;22/tcp, 127.0.0.1:32776-&gt;2376/tcp, 127.0.0.1:32775-&gt;5000/tcp, 127.0.0.1:32774-&gt;8443/tcp, 127.0.0.1:32773-&gt;32443/tcp   minikube</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹</span></span><br><span class="line">$ kubectl get nodes</span><br><span class="line">NAME           STATUS   ROLES           AGE   VERSION</span><br><span class="line">minikube       Ready    control-plane   55m   v1.33.1</span><br><span class="line">minikube-m02   Ready    &lt;none&gt;          70s   v1.33.1</span><br><span class="line"></span><br><span class="line">$ minikube node list</span><br><span class="line">minikube        192.168.49.2</span><br><span class="line">minikube-m02    192.168.49.3</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢èŠ‚ç‚¹</span></span><br><span class="line">$ minikube node stop minikube-m02</span><br><span class="line">âœ‹  æ­£åœ¨åœæ­¢èŠ‚ç‚¹ <span class="string">&quot;minikube-m02&quot;</span> ...</span><br><span class="line">ğŸ›‘  æ­£åœ¨é€šè¿‡ SSH å…³é—­â€œminikube-m02â€â€¦</span><br><span class="line">ğŸ›‘  æˆåŠŸåœæ­¢èŠ‚ç‚¹ minikube-m02</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨èŠ‚ç‚¹</span></span><br><span class="line">$ minikube node start minikube-m02</span><br><span class="line">ğŸ‘  åœ¨é›†ç¾¤ä¸­ <span class="string">&quot;minikube&quot;</span> å¯åŠ¨èŠ‚ç‚¹ <span class="string">&quot;minikube-m02&quot;</span> worker</span><br><span class="line">ğŸšœ  æ­£åœ¨æ‹‰å–åŸºç¡€é•œåƒ v0.0.47 ...</span><br><span class="line">ğŸ”„  æ­£åœ¨ä¸º<span class="string">&quot;minikube-m02&quot;</span>é‡å¯ç°æœ‰çš„ docker container ...</span><br><span class="line">ğŸ³  æ­£åœ¨ Docker 28.1.1 ä¸­å‡†å¤‡ Kubernetes v1.33.1â€¦</span><br><span class="line">ğŸ”  æ­£åœ¨éªŒè¯ Kubernetes ç»„ä»¶...</span><br><span class="line">ğŸŒŸ  å¯ç”¨æ’ä»¶ï¼š</span><br><span class="line">ğŸ˜„  æˆåŠŸå¯åŠ¨èŠ‚ç‚¹ minikube-m02ï¼</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">$ minikube node delete minikube-m02</span><br><span class="line">ğŸ”¥  æ­£åœ¨ä»é›†ç¾¤ minikube ä¸­åˆ é™¤èŠ‚ç‚¹ minikube-m02</span><br><span class="line">âœ‹  æ­£åœ¨åœæ­¢èŠ‚ç‚¹ <span class="string">&quot;minikube-m02&quot;</span> ...</span><br><span class="line">ğŸ›‘  æ­£åœ¨é€šè¿‡ SSH å…³é—­â€œminikube-m02â€â€¦</span><br><span class="line">ğŸ”¥  æ­£åœ¨åˆ é™¤ docker ä¸­çš„â€œminikube-m02â€â€¦</span><br><span class="line">ğŸ’€  èŠ‚ç‚¹ minikube-m02 å·²æˆåŠŸåˆ é™¤ã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœæ­¢é›†ç¾¤: æ­¤æ—¶åªæ˜¯åœæ­¢å®¹å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ minikube stop</span><br><span class="line">âœ‹  æ­£åœ¨åœæ­¢èŠ‚ç‚¹ <span class="string">&quot;minikube&quot;</span> ...</span><br><span class="line">ğŸ›‘  æ­£åœ¨é€šè¿‡ SSH å…³é—­â€œminikubeâ€â€¦</span><br><span class="line">ğŸ›‘  1 ä¸ªèŠ‚ç‚¹å·²åœæ­¢</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤é›†ç¾¤: åˆ é™¤å®¹å™¨åŠå…¶é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ minikube delete</span><br><span class="line">ğŸ”¥  æ­£åœ¨åˆ é™¤ docker ä¸­çš„â€œminikubeâ€â€¦</span><br><span class="line">ğŸ”¥  æ­£åœ¨åˆ é™¤å®¹å™¨ <span class="string">&quot;minikube&quot;</span> ...</span><br><span class="line">ğŸ”¥  æ­£åœ¨ç§»é™¤ /home/centos/.minikube/machines/minikubeâ€¦</span><br><span class="line">ğŸ’€  å·²åˆ é™¤æ‰€æœ‰å…³äº <span class="string">&quot;minikube&quot;</span> é›†ç¾¤çš„ç—•è¿¹ã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å‚è€ƒ<a href="https://kubernetes.io/zh-cn/docs/tutorials/hello-minikube/">https://kubernetes.io/zh-cn/docs/tutorials/hello-minikube/</a></p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Linux ä¸‹ ä½¿ç”¨ minikube å®‰è£… K8S çš„æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://minikube.sigs.k8s.io/docs/&quot;&gt;minikubeå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>Docker Swarm ä¹‹ Config ä¸  Secret</title>
    <link href="https://blog.hanqunfeng.com/2025/06/12/docker-swarm-config-secret/"/>
    <id>https://blog.hanqunfeng.com/2025/06/12/docker-swarm-config-secret/</id>
    <published>2025-06-12T14:30:05.000Z</published>
    <updated>2025-06-12T03:19:18.357Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker Swarm ä¸­çš„ Config ä¸  Secret</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/engine/swarm/">Docker Swarm å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/reference/compose-file/">Compose file reference</a></p></li></ul><span id="more"></span><h2 id="Config-ç®€ä»‹">Config ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ Docker Swarm ä¸­ï¼ŒConfig æ˜¯ä¸€ç§ç”¨äºç®¡ç†é…ç½®èµ„æºçš„æœºåˆ¶ï¼Œå…è®¸ä½ å°†é…ç½®æ–‡ä»¶ä¸å®¹å™¨åˆ†ç¦»ï¼Œä¾¿äºåœ¨ä¸åŒç¯å¢ƒä¸­é‡ç”¨å’Œå…±äº«é…ç½®ã€‚</p></li><li class="lvl-2"><p>Config å’Œ Volume éƒ½æ˜¯ Docker ä¸­ç”¨äºç®¡ç†æ•°æ®çš„æœºåˆ¶ï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç›®çš„å’Œä½¿ç”¨åœºæ™¯æœ‰æ˜¾è‘—ä¸åŒï¼š</p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>Config</th><th>Volume</th></tr></thead><tbody><tr><td>ç”¨é€”</td><td>åªèƒ½æ˜¯æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨é…ç½®æ–‡ä»¶ã€åªè¯»æ•°æ®</td><td>æ–‡ä»¶ç›®å½•å‡å¯ï¼Œå­˜å‚¨åº”ç”¨æ•°æ®ã€å¯è¯»å†™æ•°æ®</td></tr><tr><td>å¯å˜æ€§</td><td>é€šå¸¸ä¸å¯å˜ï¼ˆåªè¯»ï¼‰</td><td>å¯å˜ï¼ˆè¯»å†™ï¼‰</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸ</td><td>éšæœåŠ¡éƒ¨ç½²æ›´æ–°</td><td>ç‹¬ç«‹äºå®¹å™¨ç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td>å­˜å‚¨ä½ç½®</td><td>å­˜å‚¨åœ¨Dockerç®¡ç†çš„å†…å­˜/æ–‡ä»¶ç³»ç»Ÿ</td><td>å­˜å‚¨åœ¨ä¸»æœºæ–‡ä»¶ç³»ç»Ÿæˆ–ç½‘ç»œå­˜å‚¨</td></tr><tr><td>Swarmæ”¯æŒ</td><td>åŸç”ŸSwarmåŠŸèƒ½</td><td>é€šç”¨åŠŸèƒ½</td></tr><tr><td>æ›´æ–°æœºåˆ¶</td><td>æ›´æ–°éœ€è¦é‡æ–°éƒ¨ç½²æœåŠ¡</td><td>å¯åŠ¨æ€æ›´æ–°</td></tr><tr><td>å…¸å‹ç”¨ä¾‹</td><td>é…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡</td><td>æ•°æ®åº“æ–‡ä»¶ã€æ—¥å¿—ã€ç”¨æˆ·ä¸Šä¼ å†…å®¹</td></tr></tbody></table><h3 id="Config-å‘½ä»¤">Config å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä¸­æ–‡è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>create</code></td><td>ä»æ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥åˆ›å»ºä¸€ä¸ª config</td><td><code>docker config create my_config config.txt</code></td></tr><tr><td><code>inspect</code></td><td>æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ª config çš„è¯¦ç»†ä¿¡æ¯</td><td><code>docker config inspect my_config</code></td></tr><tr><td><code>ls</code></td><td>åˆ—å‡ºæ‰€æœ‰ configs</td><td><code>docker config ls</code></td></tr><tr><td><code>rm</code></td><td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ª config</td><td><code>docker config rm my_config</code></td></tr></tbody></table><h4 id="docker-config-create-åˆ›å»ºä¸€ä¸ª-config"><code>docker config create</code>:  åˆ›å»ºä¸€ä¸ª config</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»æ–‡ä»¶ä¸­åˆ›å»º</span></span><br><span class="line">docker config create my_config my_config.json</span><br><span class="line"><span class="comment"># ä»æ ‡å‡†è¾“å…¥åˆ›å»º</span></span><br><span class="line"><span class="built_in">cat</span> my_config.json | docker config create my_config -</span><br></pre></td></tr></table></figure><h4 id="docker-config-inspect-æŸ¥çœ‹-config-çš„ä¿¡æ¯"><code>docker config inspect</code>:  æŸ¥çœ‹ config çš„ä¿¡æ¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker config inspect my_config</span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ° Data å­—æ®µï¼Œç”¨ base64 è§£ç åï¼Œå°±æ˜¯ config çš„åŸå§‹å†…å®¹</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;ID&quot;</span>: <span class="string">&quot;q4257t5c2wq6uvvkm4g3hssae&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Version&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Index&quot;</span>: 3145</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2025-06-10T06:09:25.712614071Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;UpdatedAt&quot;</span>: <span class="string">&quot;2025-06-10T06:09:25.712614071Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Spec&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;my_config&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;Data&quot;</span>: <span class="string">&quot;WwogICAgewogICAgICAgICJJRCI6ICJxbGtsc2t2eHRocDYxaTBuYnZ6dnI2d3V3IiwKICAgICAgICAiVmVyc2lvbiI6IHsKICAgICAgICAgICAgIkluZGV4IjogMzE0NAogICAgICAgIH0sCiAgICAgICAgIkNyZWF0ZWRBdCI6ICIyMDI1LTA2LTEwVDA2OjA3OjAzLjQwMzg4OTU2NVoiLAogICAgICAgICJVcGRhdGVkQXQiOiAiMjAyNS0wNi0xMFQwNjowNzowMy40MDM4ODk1NjVaIiwKICAgICAgICAiU3BlYyI6IHsKICAgICAgICAgICAgIk5hbWUiOiAibXlfc2VjcmV0IiwKICAgICAgICAgICAgIkxhYmVscyI6IHt9CiAgICAgICAgfQogICAgfQpdCg==&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment"># è§£ç </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;WwogICAgewogICAgICAgICJJRCI6ICJxbGtsc2t2eHRocDYxaTBuYnZ6dnI2d3V3IiwKICAgICAgICAiVmVyc2lvbiI6IHsKICAgICAgICAgICAgIkluZGV4IjogMzE0NAogICAgICAgIH0sCiAgICAgICAgIkNyZWF0ZWRBdCI6ICIyMDI1LTA2LTEwVDA2OjA3OjAzLjQwMzg4OTU2NVoiLAogICAgICAgICJVcGRhdGVkQXQiOiAiMjAyNS0wNi0xMFQwNjowNzowMy40MDM4ODk1NjVaIiwKICAgICAgICAiU3BlYyI6IHsKICAgICAgICAgICAgIk5hbWUiOiAibXlfc2VjcmV0IiwKICAgICAgICAgICAgIkxhYmVscyI6IHt9CiAgICAgICAgfQogICAgfQpdCg==&quot;</span> | <span class="built_in">base64</span> -d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ˜“è¯»</span></span><br><span class="line">docker config inspect --pretty my_config</span><br><span class="line">docker config inspect --format <span class="string">&quot;&#123;&#123;.ID&#125;&#125; &#123;&#123;.Spec.Name&#125;&#125;&quot;</span> my_config</span><br></pre></td></tr></table></figure><h4 id="docker-config-ls-åˆ—å‡ºæ‰€æœ‰-config"><code>docker config ls</code>:  åˆ—å‡ºæ‰€æœ‰ config</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker config <span class="built_in">ls</span></span><br><span class="line"><span class="comment">#  åªæ˜¾ç¤º ID</span></span><br><span class="line">docker config <span class="built_in">ls</span> -q</span><br></pre></td></tr></table></figure><h4 id="docker-config-rm-åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ª-config"><code>docker config rm</code>:  åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ª config</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker config <span class="built_in">rm</span> my_config</span><br><span class="line"><span class="comment"># åˆ é™¤å¤šä¸ª</span></span><br><span class="line">docker config <span class="built_in">rm</span> my_config1 my_config2</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰ ï¼Œæ…é‡ä½¿ç”¨</span></span><br><span class="line">docker config <span class="built_in">rm</span> $(docker config <span class="built_in">ls</span> -q)</span><br></pre></td></tr></table></figure><h3 id="Stackä¸­ä½¿ç”¨Config">Stackä¸­ä½¿ç”¨Config</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://docs.docker.com/reference/compose-file/configs/">Configs top-level elements</a></p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">configs:</span> <span class="comment">#  å£°æ˜ config åˆ—è¡¨</span></span><br><span class="line">  <span class="attr">nginx_config:</span>  <span class="comment">#  config åç§°</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./nginx/nginx.conf</span> <span class="comment">#  config æ–‡ä»¶</span></span><br><span class="line">  <span class="attr">my_config:</span> <span class="comment">#  ä½¿ç”¨å¤–éƒ¨ configï¼Œå³ docker config create åˆ›å»ºçš„</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    <span class="attr">configs:</span> <span class="comment"># æœåŠ¡ä½¿ç”¨ config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">nginx_config</span> <span class="comment"># æŒ‡å®š config åç§°</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/etc/nginx/nginx.conf</span> <span class="comment"># æŒ‡å®šå®¹å™¨ä¸­é…ç½®æ–‡ä»¶å­˜æ”¾ä½ç½®</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">my_config</span>  <span class="comment">#  ä½¿ç”¨å¤–éƒ¨ config</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/app/config.json</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0444</span> <span class="comment">#  æŒ‡å®šæƒé™</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="string">&quot;1000&quot;</span> <span class="comment"># æŒ‡å®šç”¨æˆ·</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="string">&quot;1000&quot;</span> <span class="comment"># æŒ‡å®šç”¨æˆ·ç»„</span></span><br></pre></td></tr></table></figure><h2 id="Secret-ç®€ä»‹">Secret ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Secrets æ˜¯ Docker ä¸“é—¨ä¸ºæ•æ„Ÿæ•°æ®è®¾è®¡çš„å®‰å…¨ç®¡ç†æœºåˆ¶ï¼Œç”¨äºå®‰å…¨åœ°å­˜å‚¨å’Œä¼ è¾“å¯†ç ã€APIå¯†é’¥ã€TLSè¯ä¹¦ç­‰æ•æ„Ÿä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>ä¸ Configs çš„ä¸»è¦åŒºåˆ«</p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>Secrets</th><th>Configs</th></tr></thead><tbody><tr><td>ç”¨é€”</td><td>æ•æ„Ÿæ•°æ®ï¼ˆå¯†ç ã€å¯†é’¥ç­‰ï¼‰</td><td>æ™®é€šé…ç½®æ–‡ä»¶</td></tr><tr><td>å­˜å‚¨</td><td>åŠ å¯†å­˜å‚¨</td><td>æ˜æ–‡å­˜å‚¨</td></tr><tr><td>ä¼ è¾“</td><td>åŠ å¯†ä¼ è¾“</td><td>æ˜æ–‡ä¼ è¾“</td></tr><tr><td>è®¿é—®</td><td>æŒ‚è½½ä¸ºå†…å­˜æ–‡ä»¶</td><td>å¸¸è§„æ–‡ä»¶æŒ‚è½½</td></tr><tr><td>æƒé™</td><td>é»˜è®¤ä»… root å¯è¯»ï¼ˆ0440ï¼‰</td><td>å¯è‡ªå®šä¹‰æƒé™</td></tr></tbody></table><h3 id="Secret-å‘½ä»¤">Secret å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>ä¸­æ–‡è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>create</code></td><td>ä»æ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥åˆ›å»ºä¸€ä¸ª secret</td><td><code>docker secret create my_secret secret.txt</code></td></tr><tr><td><code>inspect</code></td><td>æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ª secret çš„è¯¦ç»†ä¿¡æ¯</td><td><code>docker secret inspect my_secret</code></td></tr><tr><td><code>ls</code></td><td>åˆ—å‡ºæ‰€æœ‰ secrets</td><td><code>docker secret ls</code></td></tr><tr><td><code>rm</code></td><td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ª secret</td><td><code>docker secret rm my_secret</code></td></tr></tbody></table><h4 id="docker-secret-create-åˆ›å»ºä¸€ä¸ª-secret"><code>docker secret create</code>:  åˆ›å»ºä¸€ä¸ª secret</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»æ–‡ä»¶ä¸­åˆ›å»º</span></span><br><span class="line">docker secret create my_secret my_secret.txt</span><br><span class="line"><span class="comment"># ä»æ ‡å‡†è¾“å…¥åˆ›å»º</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;my_secret&quot;</span> | docker secret create my_secret -</span><br></pre></td></tr></table></figure><h4 id="docker-secret-inspect-æŸ¥çœ‹-secret-çš„ä¿¡æ¯"><code>docker secret inspect</code>:  æŸ¥çœ‹ secret çš„ä¿¡æ¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">docker secret inspect my_secret</span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ° æ²¡æœ‰ data å­—æ®µï¼Œæ‰€ä»¥æ— æ³•æŸ¥çœ‹åŸå§‹çš„å†…å®¹</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;ID&quot;</span>: <span class="string">&quot;qlklskvxthp61i0nbvzvr6wuw&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Version&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Index&quot;</span>: 3144</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2025-06-10T06:07:03.403889565Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;UpdatedAt&quot;</span>: <span class="string">&quot;2025-06-10T06:07:03.403889565Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Spec&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;my_secret&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment"># è¾“å‡ºæ›´æ˜“è¯»</span></span><br><span class="line">docker secret inspect --pretty my_secret</span><br><span class="line">docker secret inspect --format <span class="string">&quot;&#123;&#123;.ID&#125;&#125; &#123;&#123;.Spec.Name&#125;&#125;&quot;</span> my_secret</span><br></pre></td></tr></table></figure><h4 id="docker-secret-ls-åˆ—å‡ºæ‰€æœ‰çš„-secret"><code>docker secret ls</code>:  åˆ—å‡ºæ‰€æœ‰çš„ secret</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker secret <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰çš„ secret çš„ ID</span></span><br><span class="line">docker secret <span class="built_in">ls</span> -q</span><br><span class="line">docker secret <span class="built_in">ls</span> --filter name=my_secret</span><br></pre></td></tr></table></figure><h4 id="docker-secret-rm-åˆ é™¤-secret"><code>docker secret rm</code>:  åˆ é™¤ secret</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker secret <span class="built_in">rm</span> my_secret</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰ï¼Œæ…é‡ä½¿ç”¨</span></span><br><span class="line">docker secret <span class="built_in">rm</span> $(docker secret <span class="built_in">ls</span> -q)</span><br></pre></td></tr></table></figure><h3 id="Stackä¸­ä½¿ç”¨Secret">Stackä¸­ä½¿ç”¨Secret</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://docs.docker.com/reference/compose-file/secrets/">Secrets top-level elements</a></p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD_FILE:</span> <span class="string">/run/secrets/db_root_password</span></span><br><span class="line">    <span class="attr">secrets:</span> <span class="comment"># å…³è”secretï¼Œå®¹å™¨å†…å…³è”è·¯å¾„ä¸º /run/secrets/&lt;secret_name&gt;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db_root_password</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">my_secret</span></span><br><span class="line"></span><br><span class="line"><span class="attr">secrets:</span> <span class="comment"># å£°æ˜ secret åˆ—è¡¨</span></span><br><span class="line">  <span class="attr">db_root_password:</span> <span class="comment">#  secret åç§°</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./mysql_root_password.txt</span> <span class="comment">#  secret æ–‡ä»¶</span></span><br><span class="line">  <span class="attr">my_secret:</span> <span class="comment"># ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨é¢„åˆ›å»ºçš„secret</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span>  <span class="comment"># å¼•ç”¨é¢„å…ˆåˆ›å»ºçš„secret</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¼˜åŒ–: ä½¿ç”¨érootç”¨æˆ·ï¼Œå¹¶éšè— secret æ–‡ä»¶</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">&quot;mysql:mysql&quot;</span>  <span class="comment"># å…³é”®ç‚¹1ï¼šä½¿ç”¨érootç”¨æˆ·</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD_FILE:</span> <span class="string">/run/secrets/.db_root_password</span>  <span class="comment"># å…³é”®ç‚¹2ï¼šéšè—æ–‡ä»¶</span></span><br><span class="line">    <span class="attr">secrets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">db_root_password</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">.db_root_password</span>  <span class="comment"># éšè—æ–‡ä»¶å</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="string">&quot;999&quot;</span>  <span class="comment"># mysqlç”¨æˆ·ID</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="string">&quot;999&quot;</span>  <span class="comment"># mysqlç»„ID</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0400</span>  <span class="comment"># ä»…æ‹¥æœ‰è€…å¯è¯»</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">my_secret</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">.my_secret</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="string">&quot;999&quot;</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="string">&quot;999&quot;</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0400</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">secrets:</span></span><br><span class="line">  <span class="attr">db_root_password:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./mysql_root_password.txt</span></span><br><span class="line">  <span class="attr">my_secret:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker Swarm ä¸­çš„ Config ä¸  Secret&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/engine/swarm/&quot;&gt;Docker Swarm å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/reference/compose-file/&quot;&gt;Compose file reference&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker Swarm ä¹‹ æ ˆ(Stack)</title>
    <link href="https://blog.hanqunfeng.com/2025/06/11/docker-swarm-stack/"/>
    <id>https://blog.hanqunfeng.com/2025/06/11/docker-swarm-stack/</id>
    <published>2025-06-11T14:30:05.000Z</published>
    <updated>2025-06-28T03:28:50.646Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker Swarm çš„ æ ˆç®¡ç†</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/engine/swarm/">Docker Swarm å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/reference/compose-file/">Compose file reference</a></p></li></ul><span id="more"></span><h2 id="Stackç®€ä»‹">Stackç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>å‰é¢æˆ‘ä»¬åœ¨Swarmä¸­åˆ›å»ºæœåŠ¡éƒ½æ˜¯é€šè¿‡Serviceï¼Œæ¯æ¬¡åˆ›å»ºä¸€ä¸ªï¼Œæœ‰æ²¡æœ‰ç±»ä¼¼<code>docker compose</code>çš„æ–¹å¼æ¥åˆ›å»ºå¤šä¸ªæœåŠ¡å‘¢ï¼ŸDocker Swarmä¸ºæˆ‘ä»¬æä¾›äº†Stack</p></li><li class="lvl-2"><p>åœ¨ Docker Swarm ä¸­ï¼ŒStackï¼ˆæ ˆï¼‰ æ˜¯ç”¨æ¥å®šä¹‰å’Œéƒ¨ç½²ä¸€ç»„ç›¸å…³æœåŠ¡çš„é›†åˆã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯ä¸€ä¸ªåº”ç”¨çš„æ•´ä½“ï¼Œç”±å¤šä¸ªæœåŠ¡ï¼ˆserviceï¼‰ã€ç½‘ç»œï¼ˆnetworkï¼‰ã€å·ï¼ˆvolumeï¼‰ç­‰ç»„æˆã€‚</p></li></ul><h2 id="Stack-é€šå¸¸ç”¨-Docker-Compose-æ–‡ä»¶ï¼ˆYAML-æ ¼å¼ï¼‰-æè¿°">Stack é€šå¸¸ç”¨ Docker Compose æ–‡ä»¶ï¼ˆYAML æ ¼å¼ï¼‰ æè¿°</h2><ul class="lvl-0"><li class="lvl-2"><p>Stack å®Œå…¨å…¼å®¹ Docker Compose æ–‡ä»¶ï¼Œå¹¶å¯ä»¥åœ¨ compose æ–‡ä»¶ä¸­å£°æ˜å‰¯æœ¬é›†ç­‰ä¸Serviceç›¸å…³çš„é…ç½®é¡¹ã€‚</p></li><li class="lvl-2"><p>æˆ‘ç”¨è¡¨æ ¼æ€»ç»“ä¸€ä¸‹äºŒè€…çš„å·®å¼‚ï¼Œé‡ç‚¹æ”¾åœ¨ã€ŒStack æ”¯æŒçš„é…ç½®ã€ä¸Šï¼š</p></li></ul><table><thead><tr><th>é…ç½®é¡¹</th><th>Docker Compose (æœ¬åœ°)</th><th>Docker Stack (Swarm é›†ç¾¤)</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>name</code></td><td>âœ…</td><td>âŒ</td><td>Stack ä¸æ”¯æŒ name  å±æ€§</td></tr><tr><td><code>build</code></td><td>âœ…</td><td>âŒ</td><td>Stack ä¸æ”¯æŒ build å±æ€§ï¼Œåªèƒ½ä½¿ç”¨image</td></tr><tr><td><code>deploy</code></td><td>âŒï¼ˆéƒ¨åˆ†æ”¯æŒï¼Œé€šå¸¸è¢«å¿½ç•¥ï¼‰</td><td>âœ…ï¼ˆæ ¸å¿ƒæ”¯æŒï¼‰</td><td>Stack æ”¯æŒç”¨ <code>deploy</code> å®šä¹‰å‰¯æœ¬æ•°ã€èµ„æºé™åˆ¶ã€æ›´æ–°ç­–ç•¥ç­‰</td></tr><tr><td><code>deploy.replicas</code></td><td>âŒ</td><td>âœ…</td><td>å®šä¹‰æœåŠ¡å‰¯æœ¬æ•°</td></tr><tr><td><code>deploy.resources</code></td><td>âŒ</td><td>âœ…</td><td>å®šä¹‰ CPUã€å†…å­˜é™åˆ¶</td></tr><tr><td><code>deploy.placement</code></td><td>âŒ</td><td>âœ…</td><td>å®šä¹‰æœåŠ¡è°ƒåº¦ç­–ç•¥ï¼ˆåœ¨å“ªäº›èŠ‚ç‚¹ä¸Šè¿è¡Œï¼‰</td></tr><tr><td><code>deploy.update_config</code></td><td>âŒ</td><td>âœ…</td><td>å®šä¹‰æ»šåŠ¨æ›´æ–°çš„å‚æ•°</td></tr><tr><td><code>deploy.restart_policy</code></td><td>âŒ</td><td>âœ…</td><td>å®šä¹‰é‡å¯ç­–ç•¥</td></tr><tr><td><code>deploy.mode</code></td><td>âŒ</td><td>âœ…</td><td><code>replicated</code> æˆ– <code>global</code></td></tr><tr><td><code>depends_on</code></td><td>âœ…</td><td>ğŸš«ï¼ˆè¢«å¿½ç•¥ï¼‰</td><td>Stack ä¸æ”¯æŒå®¹å™¨å¯åŠ¨é¡ºåºæ§åˆ¶</td></tr><tr><td><code>build</code></td><td>âœ…</td><td>ğŸš«ï¼ˆè¢«å¿½ç•¥ï¼‰</td><td>Stack ä¸æ”¯æŒç›´æ¥æ„å»ºé•œåƒï¼Œåªèƒ½ç”¨å·²å­˜åœ¨çš„é•œåƒ</td></tr><tr><td><code>network.external</code></td><td>âœ…</td><td>âœ…</td><td>éƒ½æ”¯æŒå¤–éƒ¨ç½‘ç»œ</td></tr><tr><td><code>volumes.external</code></td><td>âœ…</td><td>âœ…</td><td>éƒ½æ”¯æŒå¤–éƒ¨å·</td></tr><tr><td><code>configs</code></td><td>ğŸš«</td><td>âœ…</td><td>Stack æ”¯æŒ Config å¯¹è±¡ï¼Œé€‚åˆé…ç½®æ–‡ä»¶ç®¡ç†</td></tr><tr><td><code>secrets</code></td><td>ğŸš«</td><td>âœ…</td><td>Stack æ”¯æŒ Secretsï¼Œç”¨äºå®‰å…¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ä»¥<a href="https://docs.portainer.io/">Portainer:Dockerå¯è§†åŒ–ç®¡ç†å·¥å…·</a>çš„stacké…ç½®æ–‡ä»¶ä¸ºä¾‹</p></li></ul><blockquote><p>Portainer ç¤¾åŒºç‰ˆ ï¼ˆCEï¼‰å¯è®©æ‚¨åœ¨ Dockerã€Docker Swarmã€Kubernetes å’Œ Azure ACI ä¸­è½»æ¾æ„å»ºå’Œç®¡ç†å®¹å™¨ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://downloads.portainer.io/ce-lts/portainer-agent-stack.yml -o portainer-agent-stack.yml</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.2&quot;</span> <span class="comment">#  docker-composeç‰ˆæœ¬ï¼Œæ–°ç‰ˆçš„dockerå·²ç»ä¸éœ€è¦é…ç½®ç‰ˆæœ¬å·äº†</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">agent:</span>  <span class="comment"># agentæœåŠ¡</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">portainer/agent:lts</span> <span class="comment"># é•œåƒï¼Œä¸èƒ½ä½¿ç”¨ Dockerfile</span></span><br><span class="line">    <span class="attr">volumes:</span>  <span class="comment"># æŒ‚è½½å·</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/lib/docker/volumes:/var/lib/docker/volumes</span></span><br><span class="line">    <span class="attr">networks:</span> <span class="comment"># æŒ‚è½½ç½‘ç»œï¼Œå¿…é¡»æ˜¯ overlay</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">agent_network</span></span><br><span class="line">    <span class="attr">deploy:</span>   <span class="comment"># éƒ¨ç½²ç­–ç•¥ï¼Œservice ç‰¹æœ‰å±æ€§</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">global</span> <span class="comment"># å…¨å±€æ¨¡å¼</span></span><br><span class="line">      <span class="attr">placement:</span> <span class="comment"># éƒ¨ç½²æ¡ä»¶</span></span><br><span class="line">        <span class="attr">constraints:</span> [<span class="string">node.platform.os</span> <span class="string">==</span> <span class="string">linux</span>] <span class="comment">#  è¿è¡Œåœ¨linuxèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">portainer:</span> <span class="comment">#  portaineræœåŠ¡</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">portainer/portainer-ce:lts</span> <span class="comment">#  é•œåƒ</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">-H</span> <span class="string">tcp://tasks.agent:9001</span> <span class="string">--tlsskipverify</span> <span class="comment">#  å¯åŠ¨å‚æ•°</span></span><br><span class="line">    <span class="attr">ports:</span> <span class="comment"># ç«¯å£æ˜ å°„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9443:9443&quot;</span>  <span class="comment"># æµè§ˆå™¨è®¿é—® https://localhost:9443</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9000:9000&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment">#  æŒ‚è½½å·</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">portainer_data:/data</span></span><br><span class="line">    <span class="attr">networks:</span> <span class="comment"># æŒ‚è½½ç½‘ç»œï¼Œä¸agentæœåŠ¡ç½‘ç»œä¸€è‡´</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">agent_network</span></span><br><span class="line">    <span class="attr">deploy:</span> <span class="comment">#  éƒ¨ç½²é…ç½®</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span> <span class="comment"># å‰¯æœ¬æ¨¡å¼</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span> <span class="comment">#  å‰¯æœ¬æ•°é‡</span></span><br><span class="line">      <span class="attr">placement:</span> <span class="comment">#  éƒ¨ç½²æ¡ä»¶</span></span><br><span class="line">        <span class="attr">constraints:</span> [<span class="string">node.role</span> <span class="string">==</span> <span class="string">manager</span>] <span class="comment">#  èŠ‚ç‚¹è§’è‰²ä¸ºmanager</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span> <span class="comment">#  ç½‘ç»œå£°æ˜</span></span><br><span class="line">  <span class="attr">agent_network:</span> <span class="comment">#  ç½‘ç»œåç§°</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">overlay</span> <span class="comment">#  ç½‘ç»œé©±åŠ¨</span></span><br><span class="line">    <span class="attr">attachable:</span> <span class="literal">true</span> <span class="comment"># å…è®¸å®¹å™¨åŠ å…¥</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span> <span class="comment">#  æŒ‚è½½å·å£°æ˜</span></span><br><span class="line">  <span class="attr">portainer_data:</span> <span class="comment">#  æŒ‚è½½å·åç§°</span></span><br></pre></td></tr></table></figure><h2 id="Stack-å‘½ä»¤">Stack å‘½ä»¤</h2><table><thead><tr><th>å­å‘½ä»¤</th><th>ä¸­æ–‡è¯´æ˜</th><th>ç¤ºä¾‹å‘½ä»¤</th></tr></thead><tbody><tr><td><code>config</code></td><td>è¾“å‡ºæœ€ç»ˆçš„é…ç½®æ–‡ä»¶ï¼ˆç»è¿‡åˆå¹¶ä¸å˜é‡æ›¿æ¢åï¼‰</td><td><code>docker stack config -c docker-compose.yml</code></td></tr><tr><td><code>deploy</code></td><td>éƒ¨ç½²æ–° stack æˆ–æ›´æ–°å·²æœ‰ stack</td><td><code>docker stack deploy -c docker-compose.yml mystack</code></td></tr><tr><td><code>ls</code></td><td>åˆ—å‡ºæ‰€æœ‰å·²éƒ¨ç½²çš„ stack</td><td><code>docker stack ls</code></td></tr><tr><td><code>ps</code></td><td>æŸ¥çœ‹ stack ä¸­çš„æ‰€æœ‰ä»»åŠ¡ï¼ˆå³å„ä¸ªå®¹å™¨å®ä¾‹ï¼‰</td><td><code>docker stack ps mystack</code></td></tr><tr><td><code>rm</code></td><td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ª stack</td><td><code>docker stack rm mystack</code></td></tr><tr><td><code>services</code></td><td>åˆ—å‡ºæŸä¸ª stack ä¸­çš„æ‰€æœ‰æœåŠ¡</td><td><code>docker stack services mystack</code></td></tr></tbody></table><h3 id="docker-stack-config-è¾“å‡ºæœ€ç»ˆçš„é…ç½®æ–‡ä»¶"><code>docker stack config</code>: è¾“å‡ºæœ€ç»ˆçš„é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­¤å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨æ¥éªŒè¯composeæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œåªä¿è¯æ ¼å¼æ­£ç¡®ï¼Œä¸ä¿è¯é€»è¾‘æ­£ç¡®</span></span><br><span class="line">docker stack config -c portainer-agent-stack.yml</span><br></pre></td></tr></table></figure><h3 id="docker-stack-deploy-éƒ¨ç½²-stack"><code>docker stack deploy</code>: éƒ¨ç½² stack</h3><ul class="lvl-0"><li class="lvl-3"><p><code>docker stack deploy</code> == <code>docker stack up</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c portainer-agent-stack.yml portainer</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Creating network portainer_agent_network</span><br><span class="line">Creating service portainer_agent</span><br><span class="line">Creating service portainer_portainer</span><br></pre></td></tr></table></figure><h3 id="docker-stack-ls-åˆ—å‡ºæ‰€æœ‰-stack"><code>docker stack ls</code>: åˆ—å‡ºæ‰€æœ‰ stack</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker stack ls</code> == <code>docker stack list</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker stack <span class="built_in">ls</span></span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œstackåç§°ä¸ºportainerï¼Œå…¶å†…éƒ¨æœ‰ä¸¤ä¸ªæœåŠ¡ï¼Œagentå’Œportainer</span></span><br><span class="line">NAME        SERVICES</span><br><span class="line">portainer   2</span><br></pre></td></tr></table></figure><h3 id="docker-stack-services-æŸ¥çœ‹æœåŠ¡"><code>docker stack services</code>:  æŸ¥çœ‹æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker stack services portainer</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">ID             NAME                  MODE         REPLICAS   IMAGE                        PORTS</span><br><span class="line">h5foyujr6jq9   portainer_agent       global       5/5        portainer/agent:lts</span><br><span class="line">zcek2jtloe09   portainer_portainer   replicated   1/1        portainer/portainer-ce:lts   *:8000-&gt;8000/tcp, *:9000-&gt;9000/tcp, *:9443-&gt;9443/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment">## ç­‰æ•ˆ</span></span><br><span class="line">docker service <span class="built_in">ls</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">ID             NAME                  MODE         REPLICAS   IMAGE                        PORTS</span><br><span class="line">h5foyujr6jq9   portainer_agent       global       5/5        portainer/agent:lts</span><br><span class="line">zcek2jtloe09   portainer_portainer   replicated   1/1        portainer/portainer-ce:lts   *:8000-&gt;8000/tcp, *:9000-&gt;9000/tcp, *:9443-&gt;9443/tcp</span><br></pre></td></tr></table></figure><h3 id="docker-stack-ps-åˆ—å‡º-stack-ä¸‹çš„æ‰€æœ‰æœåŠ¡å®ä¾‹"><code>docker stack ps</code>: åˆ—å‡º stack ä¸‹çš„æ‰€æœ‰æœåŠ¡å®ä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">docker stack ps portainer</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">ID             NAME                                        IMAGE                        NODE       DESIRED STATE   CURRENT STATE            ERROR     PORTS</span><br><span class="line">wshk9s6gyxh1   portainer_agent.hvzkh3ip5ef8gx973z1ywahbu   portainer/agent:lts          worker2    Running         Running 30 seconds ago</span><br><span class="line">n3jjzmr2fcv9   portainer_agent.kp2zerd28xgz5mmglnje0jp22   portainer/agent:lts          manager1   Running         Running 59 seconds ago</span><br><span class="line">24yy1ew3tiya   portainer_agent.oymi74epagdqeprah7s81tsa2   portainer/agent:lts          manager2   Running         Running 3 minutes ago</span><br><span class="line">kpo4hhdvwcwd   portainer_agent.r7388xl84nczjtnf53pwh7hla   portainer/agent:lts          manager3   Running         Running 35 seconds ago</span><br><span class="line">t8xjbotfuas0   portainer_agent.xkww4853bbdgv7bv8771xibob   portainer/agent:lts          worker1    Running         Running 48 seconds ago</span><br><span class="line">qox3kqypon69   portainer_portainer.1                       portainer/portainer-ce:lts   manager2   Running         Running 2 minutes ago</span><br><span class="line"></span><br><span class="line"><span class="comment">## ç­‰æ•ˆ</span></span><br><span class="line">docker service ps portainer_agent portainer_portainer</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">ID             NAME                                        IMAGE                        NODE       DESIRED STATE   CURRENT STATE            ERROR     PORTS</span><br><span class="line">wshk9s6gyxh1   portainer_agent.hvzkh3ip5ef8gx973z1ywahbu   portainer/agent:lts          worker2    Running         Running 7 minutes ago</span><br><span class="line">n3jjzmr2fcv9   portainer_agent.kp2zerd28xgz5mmglnje0jp22   portainer/agent:lts          manager1   Running         Running 8 minutes ago</span><br><span class="line">24yy1ew3tiya   portainer_agent.oymi74epagdqeprah7s81tsa2   portainer/agent:lts          manager2   Running         Running 10 minutes ago</span><br><span class="line">kpo4hhdvwcwd   portainer_agent.r7388xl84nczjtnf53pwh7hla   portainer/agent:lts          manager3   Running         Running 7 minutes ago</span><br><span class="line">t8xjbotfuas0   portainer_agent.xkww4853bbdgv7bv8771xibob   portainer/agent:lts          worker1    Running         Running 7 minutes ago</span><br><span class="line">qox3kqypon69   portainer_portainer.1                       portainer/portainer-ce:lts   manager2   Running         Running 10 minutes ago</span><br></pre></td></tr></table></figure><h3 id="docker-stack-rm-åœæ­¢å¹¶åˆ é™¤-stack"><code>docker stack rm</code>: åœæ­¢å¹¶åˆ é™¤ stack</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker stack rm</code> == <code>docker stack remove</code> == <code>docker stack down</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack <span class="built_in">rm</span> portainer</span><br></pre></td></tr></table></figure><h2 id="deploy-å‚æ•°è¯¦è§£"><code>deploy</code> å‚æ•°è¯¦è§£</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">my-service:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">3</span>  <span class="comment"># æŒ‡å®šå‰¯æœ¬æ•°ï¼Œä»…åœ¨ mode: replicated ä¸‹æœ‰æ•ˆã€‚è¡¨ç¤ºåŒæ—¶è¿è¡Œ3ä¸ªå®¹å™¨å‰¯æœ¬ã€‚</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span>  <span class="comment"># æœåŠ¡è¿è¡Œæ¨¡å¼ï¼Œå¯é€‰å€¼ï¼š</span></span><br><span class="line">                        <span class="comment"># - replicatedï¼šé€šè¿‡ replicas æŒ‡å®šå‰¯æœ¬æ•°é‡ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">                        <span class="comment"># - globalï¼šæ¯ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œå¿½ç•¥ replicas é…ç½®</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span>         <span class="comment"># å®¹å™¨çš„â€œç¡¬é™åˆ¶â€ï¼Œè¶…è¿‡ä¼šè¢«å¼ºåˆ¶é™åˆ¶</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">&#x27;1.0&#x27;</span>    <span class="comment"># é™åˆ¶æ¯ä¸ªå®¹å™¨æœ€å¤šä½¿ç”¨1ä¸ªé€»è¾‘ CPU</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">512M</span>   <span class="comment"># é™åˆ¶æ¯ä¸ªå®¹å™¨æœ€å¤šä½¿ç”¨512MBå†…å­˜</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">reservations:</span>   <span class="comment"># å®¹å™¨çš„â€œè½¯é™åˆ¶â€ï¼ŒSwarmè°ƒåº¦æ—¶é¢„ç•™èµ„æºå‚è€ƒå€¼ï¼ˆä¸ä¼šå¼ºåˆ¶é™åˆ¶ï¼‰</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">&#x27;0.25&#x27;</span>   <span class="comment"># å»ºè®®æ¯ä¸ªå®¹å™¨è‡³å°‘åˆ†é…0.25ä¸ªCPU</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">128M</span>   <span class="comment"># å»ºè®®æ¯ä¸ªå®¹å™¨è‡³å°‘åˆ†é…128MBå†…å­˜</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span>  <span class="comment"># æ§åˆ¶å®¹å™¨é‡å¯è¡Œä¸ºï¼Œå¯é€‰å€¼ï¼š</span></span><br><span class="line">                               <span class="comment"># - noneï¼šä¸é‡å¯</span></span><br><span class="line">                               <span class="comment"># - on-failureï¼šå¤±è´¥æ—¶é‡å¯ï¼ˆé0é€€å‡ºç ï¼‰</span></span><br><span class="line">                               <span class="comment"># - anyï¼šæ— è®ºæ˜¯å¦å¤±è´¥éƒ½é‡å¯</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">5s</span>              <span class="comment"># é‡å¯å‰ç­‰å¾…æ—¶é—´</span></span><br><span class="line">        <span class="attr">max_attempts:</span> <span class="number">3</span>        <span class="comment"># æœ€å¤šé‡å¯3æ¬¡</span></span><br><span class="line">        <span class="attr">window:</span> <span class="string">60s</span>            <span class="comment"># åˆ¤æ–­å¤±è´¥æ¬¡æ•°çš„æ—¶é—´çª—å£ï¼ˆ60ç§’å†…æœ€å¤šå¤±è´¥3æ¬¡ï¼‰</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span>           <span class="comment"># æŒ‡å®šå®¹å™¨è°ƒåº¦åˆ°å“ªäº›èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå¯ç”¨æ¡ä»¶æœ‰ï¼š</span></span><br><span class="line">                               <span class="comment"># - node.role == manager/worker</span></span><br><span class="line">                               <span class="comment"># - node.hostname == xxx</span></span><br><span class="line">                               <span class="comment"># - node.labels.xxx == yyy</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.role</span> <span class="string">==</span> <span class="string">worker</span>  <span class="comment"># åªè°ƒåº¦åˆ° worker èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">preferences:</span>           <span class="comment"># è°ƒåº¦åå¥½ï¼ˆä¸æ˜¯å¼ºçº¦æŸï¼‰</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">spread:</span> <span class="string">node.labels.zone</span>  <span class="comment"># å°†æœåŠ¡å‡åŒ€åœ°åˆ†å¸ƒåœ¨ zone æ ‡ç­¾ä¸åŒçš„èŠ‚ç‚¹ä¸Š</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">update_config:</span>           <span class="comment"># æ§åˆ¶æœåŠ¡æ»šåŠ¨æ›´æ–°çš„è¡Œä¸º</span></span><br><span class="line">        <span class="attr">parallelism:</span> <span class="number">2</span>         <span class="comment"># æ¯æ¬¡æœ€å¤šå¹¶å‘æ›´æ–°2ä¸ªå®¹å™¨</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">10s</span>             <span class="comment"># æ¯æ‰¹æ›´æ–°ä¹‹é—´ç­‰å¾…10ç§’</span></span><br><span class="line">        <span class="attr">failure_action:</span> <span class="string">rollback</span>  <span class="comment"># æ›´æ–°å¤±è´¥æ—¶çš„å¤„ç†æ–¹å¼ï¼Œå¯é€‰å€¼ï¼š</span></span><br><span class="line">                                  <span class="comment"># - pauseï¼šæš‚åœæ›´æ–°ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">                                  <span class="comment"># - continueï¼šç»§ç»­æ›´æ–°</span></span><br><span class="line">                                  <span class="comment"># - rollbackï¼šå›æ»šåˆ°æ—§ç‰ˆæœ¬</span></span><br><span class="line">        <span class="attr">order:</span> <span class="string">stop-first</span>      <span class="comment"># æ§åˆ¶æ›´æ–°é¡ºåºï¼Œå¯é€‰å€¼ï¼š</span></span><br><span class="line">                               <span class="comment"># - stop-firstï¼ˆå…ˆåœåå¯ï¼Œé»˜è®¤ï¼‰</span></span><br><span class="line">                               <span class="comment"># - start-firstï¼ˆå…ˆå¯ååœï¼Œé€‚ç”¨äºæ— çŠ¶æ€æœåŠ¡ï¼‰</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">rollback_config:</span>         <span class="comment"># å›æ»šæ—¶çš„è¡Œä¸ºï¼Œå­—æ®µä¸ update_config ç±»ä¼¼</span></span><br><span class="line">        <span class="attr">parallelism:</span> <span class="number">1</span>         <span class="comment"># å›æ»šæ—¶æ¯æ¬¡æœ€å¤šå¤„ç†1ä¸ªå®¹å™¨</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">5s</span>              <span class="comment"># æ¯æ‰¹å›æ»šä¹‹é—´ç­‰å¾…5ç§’</span></span><br><span class="line">        <span class="attr">failure_action:</span> <span class="string">pause</span>  <span class="comment"># å›æ»šå¤±è´¥æ—¶æš‚åœ</span></span><br><span class="line">        <span class="attr">order:</span> <span class="string">stop-first</span>      <span class="comment"># å›æ»šæ—¶å…ˆåœå†å¯</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker Swarm çš„ æ ˆç®¡ç†&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/engine/swarm/&quot;&gt;Docker Swarm å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/reference/compose-file/&quot;&gt;Compose file reference&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker Swarm ä¹‹ ç½‘ç»œ(Overlay)</title>
    <link href="https://blog.hanqunfeng.com/2025/06/11/docker-swarm-overlay/"/>
    <id>https://blog.hanqunfeng.com/2025/06/11/docker-swarm-overlay/</id>
    <published>2025-06-11T13:30:05.000Z</published>
    <updated>2025-06-11T08:04:58.671Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker Swarm çš„ ç½‘ç»œ(Overlay)</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/engine/swarm/">Docker Swarm å®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="Overlay-ç®€ä»‹">Overlay ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ Docker Swarm ä¸­ï¼Œoverlay ç½‘ç»œ æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç½‘ç»œé©±åŠ¨ï¼Œç”¨äºå°†é›†ç¾¤ä¸­ä¸åŒä¸»æœºä¸Šçš„å®¹å™¨è¿æ¥åˆ°åŒä¸€ä¸ªé€»è¾‘ç½‘ç»œä¸­ï¼Œå°±åƒå®ƒä»¬åœ¨åŒä¸€å°ä¸»æœºä¸Šä¸€æ ·ã€‚</p></li><li class="lvl-2"><p>å½“ä½ ä½¿ç”¨ Docker Swarm éƒ¨ç½²æœåŠ¡æ—¶ï¼ŒSwarm ä¼šè‡ªåŠ¨ä½¿ç”¨ overlay ç½‘ç»œæ¥è¿æ¥ä¸åŒèŠ‚ç‚¹ä¸Šçš„å®¹å™¨ï¼Œå®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼Œä¿è¯å®¹å™¨é—´çš„é€šä¿¡å®‰å…¨ï¼ˆé€šè¿‡åŠ å¯†ï¼‰ã€‚</p></li><li class="lvl-2"><p>overlay ç½‘ç»œç‰¹ç‚¹</p><ul class="lvl-2"><li class="lvl-4">è·¨ä¸»æœºé€šä¿¡ï¼šå®¹å™¨æ— è®ºåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šï¼Œéƒ½å¯ä»¥ä½¿ç”¨ overlay ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚</li><li class="lvl-4">å†…ç½®æœåŠ¡å‘ç°ï¼šå®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡æœåŠ¡åç§°ç›´æ¥é€šä¿¡ã€‚</li><li class="lvl-4">æ”¯æŒåŠ å¯†ï¼šSwarm çš„ overlay ç½‘ç»œæ”¯æŒæ•°æ®åŠ å¯†ï¼Œæé«˜å®‰å…¨æ€§ã€‚</li><li class="lvl-4">è‡ªåŠ¨é…ç½®ï¼šSwarm ä¼šè‡ªåŠ¨ä¸º overlay ç½‘ç»œåˆ†é…å­ç½‘ã€ç®¡ç† IP ç­‰ã€‚</li></ul></li></ul><h2 id="Swarm-ä¸­çš„-overlay-ç½‘ç»œ">Swarm ä¸­çš„ overlay ç½‘ç»œ</h2><ul class="lvl-0"><li class="lvl-2"><p>å½“æˆ‘ä»¬åˆå§‹åŒ–Swarm æ—¶ï¼ŒSwarm ä¼šè‡ªåŠ¨åˆ›å»ºä¸¤ä¸ªnetworkï¼Œä¸€ä¸ªæ˜¯ bridge networkï¼š<code>docker_gwbridge</code> ï¼Œä¸€ä¸ªæ˜¯ overlay networkï¼š<code>ingress</code>ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID     NAME              DRIVER    SCOPE</span><br><span class="line">6b7aadbbd180   bridge            bridge    <span class="built_in">local</span></span><br><span class="line">5ddadf5d0608   docker_gwbridge   bridge    <span class="built_in">local</span></span><br><span class="line">21c6f5b1bedd   host              host      <span class="built_in">local</span></span><br><span class="line">idx465x3jg68   ingress           overlay   swarm</span><br><span class="line">a770c5ad4b13   none              null      <span class="built_in">local</span></span><br></pre></td></tr></table></figure><h3 id="docker-gwbridge"><code>docker_gwbridge</code></h3><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ <code>docker_gwbridge</code> è¯¦æƒ…ï¼Œå…¶ç½‘æ®µä¸º <code>172.18.0.0/16</code>ï¼Œç½‘å…³ä¸º <code>172.18.0.1</code>ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªå®¹å™¨ <code>ingress-sbox</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">docker inspect docker_gwbridge</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;docker_gwbridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;5ddadf5d06086fcdad5890b8d59edcca4b1293bde23a26f1968fd6114fcaec93&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2025-06-08T07:29:52.119033035-04:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;172.18.0.0/16&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.18.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;ingress-sbox&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;gateway_ingress-sbox&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;4764160a1b048da6d325a2f14165a981a446892ea3b4ebb12e20ee689fdac397&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:12:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;172.18.0.2/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.enable_icc&quot;</span>: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.enable_ip_masquerade&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.name&quot;</span>: <span class="string">&quot;docker_gwbridge&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å…ˆæ¥çœ‹è¿™ä¸ªç½‘æ®µ <code>172.18.0.0/16</code>ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸»æœºçš„ç½‘ç»œå’Œè·¯ç”±è¡¨ï¼Œå¯ä»¥çœ‹åˆ° <code>261: docker_gwbridge</code>ï¼Œå…¶IPåœ°å€ä¸º <code>172.18.0.1</code>ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ <code>docker_gwbridge</code> å°±æ˜¯è¿æ¥åˆ°<code>261: docker_gwbridge</code>è¿™å—ç½‘å¡ä¸Šçš„ï¼Œå¦å¤–å½“å‰è¿˜æœ‰ä¸€ä¸ª<code>263: veth3176100@if262</code>è™šæ‹Ÿç½‘ç»œæ¥å£ä¹Ÿè¿æ¥åˆ°<code>261: docker_gwbridge</code>ä¸Šï¼Œé€šè¿‡è·¯ç”±è¡¨æˆ‘ä»¬å¾—çŸ¥å…¶æœ€ç»ˆè¿æ¥åˆ°<code>2: enp0s5</code>ä¸Šï¼Œä¹Ÿå°±æ˜¯è¿™å°ä¸»æœºçš„ç½‘å¡ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">ip a</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: enp0s5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:1c:42:49:12:82 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.211.55.10/24 brd 10.211.55.255 scope global noprefixroute enp0s5</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fdb2:2c26:f4e4:0:21c:42ff:fe49:1282/64 scope global dynamic noprefixroute</span><br><span class="line">       valid_lft 2591886sec preferred_lft 604686sec</span><br><span class="line">    inet6 fe80::21c:42ff:fe49:1282/64 scope <span class="built_in">link</span> noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:5c:31:<span class="built_in">cd</span>:30 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:5cff:fe31:cd30/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">261: docker_gwbridge: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:fe:e3:ca:f7 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.1/16 brd 172.18.255.255 scope global docker_gwbridge</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:feff:fee3:caf7/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">263: veth3176100@if262: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker_gwbridge state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 96:4b:c1:d9:83:c5 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::944b:c1ff:fed9:83c5/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è·¯ç”±è¡¨</span></span><br><span class="line">route -n</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœï¼Œå…¶ç›®çš„åœ°å€æœ€ç»ˆéƒ½ä¼šè½¬åˆ°ç½‘å…³ 10.211.55.1 ä¸Š</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.211.55.1     0.0.0.0         UG    100    0        0 enp0s5</span><br><span class="line">10.211.55.0     0.0.0.0         255.255.255.0   U     100    0        0 enp0s5</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br><span class="line">172.18.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker_gwbridge</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹docker_gwbridgeç½‘æ¡¥è®¾å¤‡ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å…¶æŒ‚è½½äº†ä¸€ä¸ªè™šæ‹Ÿç½‘å¡ veth3176100</span></span><br><span class="line">brctl show docker_gwbridge</span><br><span class="line">bridge name     bridge <span class="built_in">id</span>               STP enabled     interfaces</span><br><span class="line">docker_gwbridge         8000.0242fee3caf7       no              veth3176100</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŒ‰ç†è¯´<code>263: veth3176100@if262</code>è™šæ‹Ÿç½‘ç»œæ¥å£åº”è¯¥å¯¹åº”åˆ°ä¸€ä¸ªå®¹å™¨ä¸Šï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹ä¸€çœ‹è¿™ä¸ªå®¹å™¨ <code>ingress-sbox</code>ï¼Œå½“å‰dockerä¸­å¹¶æ²¡æœ‰è¿™ä¸ªå®¹å™¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨åœ¨å“ªé‡Œå‘¢ï¼Ÿdockeråˆ›å»ºçš„å®¹å™¨éƒ½ä¼šæœ‰ä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´ï¼Œå…¶ä¿å­˜åœ¨å®¿ä¸»æœºçš„<code>/var/run/docker/netns/</code>ä¸‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/run/docker/netns/</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è¿˜çœŸçš„å‘ç°äº†ä¸è¿™ä¸ªå®¹å™¨åç§°ç±»ä¼¼çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œå®¹å™¨åç§°æ˜¯ä¸­åˆ’çº¿ï¼Œç½‘ç»œå‘½åç©ºé—´åç§°æ˜¯ä¸‹åˆ’çº¿</span></span><br><span class="line">1-idx465x3jg  ingress_sbox</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿›å…¥è¿™ä¸ªç½‘ç»œï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°ä¸å®¿ä¸»æœºä¸Šçš„è™šæ‹Ÿç½‘ç»œæ¥å£å¯¹åº”çš„å®¹å™¨ç½‘ç»œæ¥å£äº†ï¼š<code>262: eth1@if263</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">nsenter --net=ingress_sbox ip a</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">259: eth0@if260: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:0a:00:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 10.0.0.2/24 brd 10.0.0.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">262: eth1@if263: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç½‘ç»œæ¥å£ <code>259: eth0@if260</code>ï¼Œå®ƒåˆæ˜¯ä¸è°å¯¹æ¥çš„å‘¢ï¼Ÿåˆ«ç€æ€¥ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚</p></li></ul><h3 id="ingress"><code>ingress</code></h3><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ <code>ingress</code> è¯¦æƒ…ï¼Œå…¶ç½‘æ®µä¸º <code>10.0.0.0/24</code>ï¼Œç½‘å…³ä¸º <code>10.0.0.1</code>ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªå®¹å™¨ <code>ingress-sbox</code>ï¼Œå¦å¤–å…¶æœ‰ä¸€ä¸ª<code>Peers</code>å±æ€§ï¼Œå†…éƒ¨åŒ…å«äº†é›†ç¾¤ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹IPï¼Œæ‰€ä»¥ä»è¿™é‡Œä¹Ÿèƒ½å¤§æ¦‚çŒœå‡ºè¿™ä¸ªç½‘ç»œæ˜¯è´Ÿè´£èŠ‚ç‚¹é—´é€šä¿¡çš„ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect ingress</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;ingress&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;idx465x3jg682fmceumsio297&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2025-06-08T07:29:51.734714967-04:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;swarm&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;overlay&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;10.0.0.0/24&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;10.0.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;ingress-sbox&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;ingress-endpoint&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;fd05086c5104e28c75dbed3e3b308236aaa0e87b698dad6186c23c81755bb009&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:0a:00:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;10.0.0.2/24&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;com.docker.network.driver.overlay.vxlanid_list&quot;</span>: <span class="string">&quot;4096&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Peers&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;4969a4611607&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;10.211.55.10&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;ae3756658a26&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;10.211.55.14&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;f12309731131&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;10.211.55.13&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;de5000b11067&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;10.211.55.12&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;377001904d63&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IP&quot;</span>: <span class="string">&quot;10.211.55.11&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥çœ‹è¿™ä¸ªç½‘å…³<code>10.0.0.1</code>ï¼Œåœ¨å“ªå‘¢ï¼Ÿå®¿ä¸»æœºçš„ç½‘ç»œè®¾å¤‡ä¸­å¹¶æ²¡æœ‰ï¼Œæ‰€ä»¥å®ƒåº”è¯¥æ˜¯dockeråˆ›å»ºçš„ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦ä»<code>/var/run/docker/netns</code>ä¸­æŸ¥çœ‹ä¸€ä¸‹ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªåç§°ä¸º <code>1-idx465x3jg</code> çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œæˆ‘ä»¬è¿›å»çœ‹çœ‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">nsenter --net=/var/run/docker/netns/1-idx465x3jg ip a</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">258: vxlan0@if258: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue master br0 state UNKNOWN group default</span><br><span class="line">    <span class="built_in">link</span>/ether 32:c9:a4:01:8a:19 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">2: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 32:c9:a4:01:8a:19 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.0.1/24 brd 10.0.0.255 scope global br0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">260: veth0@if259: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue master br0 state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 8a:d3:52:ac:7d:<span class="built_in">cd</span> brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨è¿™é‡Œæˆ‘ä»¬æ‰¾åˆ°äº†<code>2: br0</code>ï¼Œå…¶IPåœ°å€ä¸º<code>10.0.0.1</code>ï¼Œæ‰€ä»¥å®ƒå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç½‘å…³ã€‚å…¶ä¸Šé¢è¿˜æŒ‚è½½äº†ä¸¤ä¸ªç½‘ç»œè®¾å¤‡ï¼Œä¸€ä¸ªæ˜¯ <code>260: veth0@if259</code>ï¼Œè¿™ä¸ªå°±æ˜¯ä¸<code>ingress_sbox</code> ä¸­<code>259: eth0@if260</code>å¯¹åº”çš„ç½‘ç»œæ¥å£ ï¼Œå¦ä¸€ä¸ªæ˜¯ <code>258: vxlan0@if258</code>ï¼Œå…¶åŸºäº<code>vxlan</code>åè®®ï¼Œè´Ÿè´£é›†ç¾¤è·¨ä¸»æœºé€šä¿¡ã€‚</p></li></ul><h3 id="overlayæ€»ç»“">overlayæ€»ç»“</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker_gwbridge</code>ä¸­çš„å®¹å™¨<code>ingress-sbox</code>ï¼Œå…¶æœ‰ä¸¤å—ç½‘å¡ï¼Œä¸€å—å¯¹æ¥å®¿ä¸»æœºä¸Šçš„ <code>261: docker_gwbridge</code>ï¼Œå¦ä¸€å—å¯¹æ¥<code>/var/run/docker/netns/1-idx465x3jg</code>ä¸­çš„ <code>2: br0</code>ã€‚</p></li><li class="lvl-2"><p>å®é™…ä¸ŠSwarmä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½æœ‰ä¸¤ä¸ªç½‘å¡ï¼Œä¸€å—å¯¹æ¥å®¿ä¸»æœºä¸Šçš„ <code>261: docker_gwbridge</code>ï¼Œå¦ä¸€å—å¯¹æ¥<code>/var/run/docker/netns/1-idx465x3jg</code>ä¸­çš„ <code>2: br0</code>ã€‚</p></li><li class="lvl-2"><p>å½“è¯·æ±‚åˆ°è¾¾å®¿ä¸»æœºæ—¶ï¼Œä¼šé€šè¿‡<code>enp0s5</code>è½¬å‘åˆ°<code>docker_gwbridge</code>ï¼Œç„¶åå…ˆè¢«è½¬åˆ°<code>ingress-sbox</code>å®¹å™¨ï¼Œç„¶åå†ç»è¿‡å…¶è½¬å‘åˆ°<code>br0</code>ç½‘å…³ï¼Œå†ç”±å®ƒè´Ÿè´£æŸ¥æ‰¾ç›®æ ‡å®¹å™¨ã€‚å¦‚æœç›®æ ‡å®¹å™¨ä¸åœ¨æœ¬èŠ‚ç‚¹ï¼Œåˆ™é€šè¿‡<code>vxlan0</code>ç½‘ç»œæ¥å£è½¬å‘åˆ°å…¶å®ƒèŠ‚ç‚¹è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¸­é—´ç»è¿‡ä¸€ç³»åˆ—çš„ç½‘ç»œåœ°å€è½¬æ¢ã€‚</p></li></ul><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/9UVZzm.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>å½“ä½ é€šè¿‡<code>docker network create --driver overlay my-network</code>åˆ›å»ºä¸€ä¸ªoverlayç½‘ç»œæ—¶ï¼ŒDockerä¼šåˆ›å»ºä¸€ä¸ªç±»ä¼¼â€œingressâ€çš„ç½‘ç»œç»“æ„(æ–°çš„<code>br0</code>)ï¼Œå¦‚æœä¸æŒ‡å®šipæ®µï¼Œå…¶ipæ®µä¼šä»<code>10.0.1.0/24</code>å¼€å§‹ï¼Œä¾æ¬¡é€’å¢ä¸€ä¸ªç½‘æ®µã€‚ä½†ä¼šå…±ç”¨<code>docker_gwbridge</code>ã€‚</p></li></ul><h2 id="æŸ¥çœ‹overlayç½‘ç»œä¸­çš„è´Ÿè½½å‡è¡¡">æŸ¥çœ‹overlayç½‘ç»œä¸­çš„è´Ÿè½½å‡è¡¡</h2><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ä¸€ä¸ªservice</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service create --name my-nginx --replicas 5 --publish 80:80 nginx</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹<code>ingress_sbox</code>çš„<code>iptables</code>æ•°æ®é“¾ä¸­çš„ mangle è¡¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">nsenter --net=/var/run/docker/netns/ingress_sbox iptables -nvL -t mangle</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœï¼Œè¿™é‡Œçœ‹åˆ° PREROUTING é“¾ä¸­æœ‰ä¸€æ¡ç›‘å¬80ç«¯å£çš„è§„åˆ™ï¼Œå…¶è¢«æ‰“äº†Markæ ‡è®°: 0x105ï¼Œæ¢ç®—ä¸º10è¿›åˆ¶ï¼š261</span></span><br><span class="line">Chain PREROUTING (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80 MARK <span class="built_in">set</span> 0x105</span><br><span class="line"></span><br><span class="line">Chain INPUT (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 MARK       all  --  *      *       0.0.0.0/0            10.0.0.33            MARK <span class="built_in">set</span> 0x105</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é€šè¿‡<code>ipvsadm</code>æŸ¥çœ‹è´Ÿè½½å‡è¡¡ä¿¡æ¯</p></li></ul><blockquote><p>ipvsadm æ˜¯ Linux ä¸‹ç®¡ç† IPVSï¼ˆIP Virtual Serverï¼‰è´Ÿè½½å‡è¡¡å™¨çš„å‘½ä»¤ä¹‹ä¸€</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæ²¡æœ‰ipvsadmï¼Œåˆ™å®‰è£…</span></span><br><span class="line">dnf install ipvsadm -y</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ipvsä¿¡æ¯</span></span><br><span class="line">nsenter --net=/var/run/docker/netns/ingress_sbox ipvsadm -Ln</span><br><span class="line"><span class="comment"># -Lï¼šè¡¨ç¤ºåˆ—å‡ºå½“å‰ IPVS çš„è§„åˆ™å’ŒçŠ¶æ€ï¼ˆListï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># -nï¼šè¡¨ç¤ºä»¥æ•°å­—æ–¹å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£ï¼Œè€Œä¸è¿›è¡Œ DNS è§£ææˆ–ç«¯å£åè§£æï¼ˆå³ï¼šIP å’Œç«¯å£å·ä»¥æ•°å­—æ˜¾ç¤ºï¼Œæ›´ç›´è§‚ï¼Œä¹Ÿæ›´å¿«ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ° FWM 261 rrï¼Œè¿™é‡Œrrè¡¨ç¤ºè½®è¯¢</span></span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">FWM  261 rr</span><br><span class="line">  -&gt; 10.0.0.34:0                  Masq    1      0          0</span><br><span class="line">  -&gt; 10.0.0.35:0                  Masq    1      0          0</span><br><span class="line">  -&gt; 10.0.0.36:0                  Masq    1      0          0</span><br><span class="line">  -&gt; 10.0.0.37:0                  Masq    1      0          0</span><br><span class="line">  -&gt; 10.0.0.38:0                  Masq    1      0          0</span><br><span class="line"><span class="comment">## è¾“å‡ºè§£é‡Š</span></span><br><span class="line"><span class="comment"># Prot: åè®®ï¼ˆTCP/UDPï¼‰,è¿™é‡Œæ˜¯ FWMï¼Œè¡¨ç¤ºFirewall Markï¼ˆé˜²ç«å¢™æ ‡è®°ï¼‰æ¨¡å¼</span></span><br><span class="line"><span class="comment"># LocalAddress:Port: æœ¬åœ°åœ°å€å’Œç«¯å£å·ï¼Œè¿™é‡Œæ˜¯ 261 ï¼Œè¿™æ˜¯é˜²ç«å¢™æ ‡è®°å€¼ï¼ˆmark å€¼ï¼‰,å°±æ˜¯ä¸Šé¢çœ‹åˆ°çš„é‚£ä¸ª16è¿›åˆ¶ 0x105</span></span><br><span class="line"><span class="comment"># Scheduler: è°ƒåº¦ç®—æ³•ï¼Œè¿™é‡Œæ˜¯ rrï¼Œè¡¨ç¤ºè½®è¯¢(round-robin)ï¼Œè°ƒåº¦ç®—æ³•è¿˜æœ‰ wrrï¼ˆåŠ æƒè½®è¯¢ï¼‰ã€lcï¼ˆæœ€å°‘è¿æ¥ï¼‰ç­‰</span></span><br><span class="line"><span class="comment"># RemoteAddress:Port: è¿œç¨‹åœ°å€å’Œç«¯å£å·ï¼Œè¿™é‡Œæ˜¯ 10.0.0.34:0ï¼Œè¡¨ç¤ºè´Ÿè½½å‡è¡¡åˆ°çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåé¢åŒç†</span></span><br><span class="line"><span class="comment"># Forward: è½¬å‘ç­–ç•¥ï¼Œè¿™é‡Œæ˜¯ Masqï¼Œè¡¨ç¤ºå°†è´Ÿè½½å‡è¡¡åˆ°çš„èŠ‚ç‚¹çš„IPåœ°å€è½¬æ¢æˆå®¿ä¸»æœºçš„IPåœ°å€ï¼Œå³ Masqueradeï¼ˆä¼ªè£…ï¼‰ã€‚è½¬å‘æ–¹å¼ï¼ˆå¦‚ï¼šMasqã€Tunnelã€Direct Routeï¼‰</span></span><br><span class="line"><span class="comment"># Weight: æƒé‡ï¼Œè¿™é‡Œæ˜¯ 1ï¼Œè¡¨ç¤ºè´Ÿè½½å‡è¡¡åˆ°çš„èŠ‚ç‚¹çš„æƒé‡ï¼Œé»˜è®¤ä¸º 1</span></span><br><span class="line"><span class="comment"># ActiveConn: å½“å‰æ´»åŠ¨è¿æ¥æ•°ï¼Œè¿™é‡Œæ˜¯ 0</span></span><br><span class="line"><span class="comment"># InActConn: å½“å‰ä¸æ´»åŠ¨è¿æ¥æ•°ï¼ˆç­‰å¾…å…³é—­çš„è¿æ¥ï¼‰ï¼Œè¿™é‡Œæ˜¯ 0</span></span><br></pre></td></tr></table></figure><h2 id="VXLANæ˜¯ä»€ä¹ˆï¼Ÿ">VXLANæ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul class="lvl-0"><li class="lvl-2"><p>VXLANï¼ˆVirtual Extensible LANï¼‰æ˜¯ Cisco å…¬å¸å¼€å‘çš„ä¸€ç§è™šæ‹Ÿå±€åŸŸç½‘ï¼ˆVLANï¼‰æŠ€æœ¯ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ª VLAN é€»è¾‘åˆ†ç»„ï¼Œå¹¶ä½¿ç”¨å•ä¸ªç‰©ç†ç½‘ç»œè¿›è¡Œç®¡ç†ã€‚VXLAN çš„ä¸»è¦ä½œç”¨æ˜¯æé«˜ç½‘ç»œæ€§èƒ½å’Œæ‰©å±•æ€§ã€‚</p></li><li class="lvl-2"><p>å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ç§ ç½‘ç»œå°è£…åè®®ï¼ˆoverlay protocolï¼‰ï¼Œç”¨æ¥åœ¨å·²æœ‰çš„ IP ç½‘ç»œä¹‹ä¸Šï¼Œæ„å»ºäºŒå±‚ï¼ˆL2ï¼‰è™šæ‹Ÿç½‘ç»œã€‚</p></li></ul><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-VXLANï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦ VXLANï¼Ÿ</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ä¼ ç»Ÿæ•°æ®ä¸­å¿ƒæˆ–äº‘è®¡ç®—ä¸­ï¼Œç»å¸¸æœ‰è¿™æ ·çš„éœ€æ±‚ï¼š</p><ul class="lvl-2"><li class="lvl-6">è·¨ä¸åŒç‰©ç†ç½‘ç»œæˆ–å­ç½‘ï¼Œéƒ¨ç½²åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šçš„è™šæ‹Ÿæœºæˆ–å®¹å™¨ï¼Œè¦èƒ½åƒåœ¨åŒä¸€ä¸ªäºŒå±‚ç½‘ç»œé‡Œä¸€æ ·ç›´æ¥é€šä¿¡ã€‚</li><li class="lvl-6">VLANï¼ˆ802.1Qï¼‰æä¾›çš„äºŒå±‚éš”ç¦»èƒ½åŠ›åªæœ‰ 12 bit VLAN IDï¼ˆæœ€å¤š 4096 ä¸ª VLANï¼‰ï¼Œåœ¨å¤§å‹æ•°æ®ä¸­å¿ƒè¿œè¿œä¸å¤Ÿç”¨ã€‚</li></ul></li><li class="lvl-2"><p>æ•°æ®ä¸­å¿ƒæƒ³è¦æ›´å¥½çš„å¼¹æ€§ã€è·¨åŒºåŸŸéƒ¨ç½²ã€å®¹å™¨ç¼–æ’ã€å¤§è§„æ¨¡ç§Ÿæˆ·éš”ç¦»ã€‚</p></li></ul><h3 id="VXLAN-æ ¸å¿ƒåŸç†">VXLAN æ ¸å¿ƒåŸç†</h3><ul class="lvl-0"><li class="lvl-2"><p>VXLAN é€šè¿‡å°è£…çš„æ–¹å¼ï¼ŒæŠŠäºŒå±‚ä»¥å¤ªç½‘å¸§åŒ…åœ¨ UDP æ•°æ®æŠ¥é‡Œï¼Œåœ¨ä¸‰å±‚ IP ç½‘ç»œä¸­ä¼ é€’ã€‚</p></li><li class="lvl-2"><p>å°è£…æ ¼å¼å¤§è‡´æ˜¯ï¼š</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------+</span><br><span class="line">| å¤–å±‚IPå¤´ (IP Header)    |</span><br><span class="line">+-------------------------+</span><br><span class="line">| å¤–å±‚UDPå¤´ (UDP Header)  |</span><br><span class="line">+-------------------------+</span><br><span class="line">| VXLANå¤´ (VXLAN Header)  |</span><br><span class="line">+-------------------------+</span><br><span class="line">| å†…å±‚äºŒå±‚å¸§ (Ethernet)   |</span><br><span class="line">+-------------------------+</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¤–å±‚ IP/UDP ç”¨äºä¸‰å±‚ä¼ è¾“</p></li><li class="lvl-2"><p>å†…å±‚ä¿ç•™åŸæœ¬çš„äºŒå±‚ä»¥å¤ªç½‘å¸§ï¼ˆå¦‚ MAC åœ°å€ï¼‰</p></li><li class="lvl-2"><p>VXLAN å¤´éƒ¨é‡Œé¢åŒ…å«äº†ä¸€ä¸ª VNI (VXLAN Network Identifier)ï¼š24 bitï¼Œå¯æ”¯æŒ 1600ä¸‡ä¸ªè™šæ‹Ÿç½‘ç»œ</p></li><li class="lvl-2"><p>ç®€å•ç¤ºæ„å›¾</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">VM1 (10.1.1.1) â€”â€”&gt; VTEP1 â€”â€”&gt; Underlay IPç½‘ç»œ â€”â€”&gt; VTEP2 â€”â€”&gt; VM2 (10.1.1.2)</span><br><span class="line"></span><br><span class="line">VTEP1 å°è£…ï¼š</span><br><span class="line">  å†…å±‚ä»¥å¤ªç½‘å¸§  + VXLANå¤´ (VNI) + UDP + IP</span><br><span class="line"></span><br><span class="line">VTEP2 è§£å°è£…ï¼š</span><br><span class="line">  å»æ‰å¤–å±‚å¤´éƒ¨ï¼Œè¿˜åŸåŸå§‹äºŒå±‚å¸§</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker Swarm çš„ ç½‘ç»œ(Overlay)&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/engine/swarm/&quot;&gt;Docker Swarm å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker Swarm ä¹‹ æœåŠ¡(Service)</title>
    <link href="https://blog.hanqunfeng.com/2025/06/10/docker-swarm-service/"/>
    <id>https://blog.hanqunfeng.com/2025/06/10/docker-swarm-service/</id>
    <published>2025-06-10T13:30:05.000Z</published>
    <updated>2025-06-28T03:23:06.766Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker Swarm çš„ æœåŠ¡ç®¡ç†</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/engine/swarm/">Docker Swarm å®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="Service-ä¸-Task">Service ä¸ Task</h2><h3 id="ä»€ä¹ˆæ˜¯-Serviceï¼Ÿ">ä»€ä¹ˆæ˜¯ Serviceï¼Ÿ</h3><ul class="lvl-0"><li class="lvl-2"><p>Service æ˜¯ç”¨æˆ·å®šä¹‰çš„æœåŠ¡æŠ½è±¡ï¼Œä¸€ä¸ª Service è¡¨ç¤ºä½ å¸Œæœ›åœ¨ Swarm é›†ç¾¤ä¸­è¿è¡Œçš„æŸä¸ªâ€œåº”ç”¨â€ã€‚</p></li><li class="lvl-2"><p>å®ƒå®šä¹‰äº†ä½ è¦è¿è¡Œçš„å®¹å™¨é•œåƒã€å¯åŠ¨å‘½ä»¤ã€å‰¯æœ¬æ•°é‡ã€ç½‘ç»œé…ç½®ã€ç¯å¢ƒå˜é‡ã€ç«¯å£æ˜ å°„ç­‰ä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>å¯ä»¥ç±»æ¯”æˆ Kubernetes ä¸­çš„ Deploymentï¼Œä»£è¡¨çš„æ˜¯â€œæœŸæœ›çŠ¶æ€â€ã€‚</p></li></ul><h3 id="ä»€ä¹ˆæ˜¯-Taskï¼Ÿ">ä»€ä¹ˆæ˜¯ Taskï¼Ÿ</h3><ul class="lvl-0"><li class="lvl-2"><p>Task æ˜¯ Service çš„å®é™…æ‰§è¡Œå®ä¾‹ï¼ŒSwarm ä¼šæ ¹æ® Service çš„é…ç½®ç”Ÿæˆ Taskã€‚</p></li><li class="lvl-2"><p>Serviceä¸­çš„æ¯ä¸ªå‰¯æœ¬å¯¹åº”ä¸€ä¸ª Taskï¼Œæ¯ä¸€ä¸ª Task ä»£è¡¨ä¸€ä¸ªè¦åœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„å®¹å™¨ã€‚</p></li><li class="lvl-2"><p>Task çš„çŠ¶æ€ç”± Swarm ç®¡ç†ï¼Œå®ƒè´Ÿè´£å¯åŠ¨ã€è°ƒåº¦ã€é‡å¯ç­‰ç”Ÿå‘½å‘¨æœŸæ“ä½œã€‚</p></li><li class="lvl-2"><p>å½“æŸä¸ª Task å´©æºƒï¼ŒSwarm ä¼šè‡ªåŠ¨é‡æ–°è°ƒåº¦ä¸€ä¸ªæ–°çš„ Task æ¥æ›¿ä»£å®ƒã€‚</p></li><li class="lvl-2"><p>Task æ˜¯ä¸å¯å˜çš„ï¼Œä¸€æ—¦åˆ›å»ºä¸èƒ½ä¿®æ”¹ï¼Œæ›´æ–° Service ä¼šåˆ›å»ºæ–°çš„ Taskã€‚</p></li></ul><h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ªåä¸º nginx çš„ Serviceï¼Œå¹¶æŒ‡å®šé•œåƒä¸º nginx:latestï¼Œå¹¶è®¾ç½®å‰¯æœ¬æ•°ä¸º 3ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service create --name nginx --replicas 3 nginx:latest</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªåä¸º nginx çš„ Serviceï¼Œå¹¶è®¾ç½®äº†å‰¯æœ¬æ•°ä¸º 3ï¼Œå³Swarmä¼šåˆ›å»º3ä¸ªTaskæ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ª Task æœ€ç»ˆä¼šå¯¹åº”ä¸€ä¸ªå…·ä½“çš„nginxå®¹å™¨ã€‚</p></li></ul><table><thead><tr><th>é¡¹ç›®</th><th>Service</th><th>Task</th></tr></thead><tbody><tr><td>å®šä¹‰</td><td>ç”¨æˆ·å®šä¹‰çš„æœåŠ¡é…ç½®</td><td>æœåŠ¡é…ç½®ç”Ÿæˆçš„æ‰§è¡Œå•å…ƒ</td></tr><tr><td>æ•°é‡å…³ç³»</td><td>ä¸€ä¸ª Service åŒ…å«å¤šä¸ª Task</td><td>ä¸€ä¸ª Task å±äºä¸€ä¸ª Service</td></tr><tr><td>çŠ¶æ€</td><td>æè¿°â€œæœŸæœ›çŠ¶æ€â€</td><td>ä»£è¡¨â€œå®é™…çŠ¶æ€â€</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸ</td><td>å¯ä»¥æ›´æ–°</td><td>ä¸å¯å˜ï¼Œæ›´æ–°æ„å‘³ç€é‡æ–°åˆ›å»º</td></tr><tr><td>ç®¡ç†è€…</td><td>ç”±ç”¨æˆ·ç®¡ç†</td><td>å®Œå…¨ç”± Swarm è°ƒåº¦å’Œç®¡ç†</td></tr></tbody></table><h2 id="Service-ç›¸å…³å‘½ä»¤">Service ç›¸å…³å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä¸­æ–‡è¯´æ˜</th></tr></thead><tbody><tr><td>create</td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡</td></tr><tr><td>inspect</td><td>æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡çš„è¯¦ç»†ä¿¡æ¯</td></tr><tr><td>logs</td><td>è·å–æœåŠ¡æˆ–ä»»åŠ¡çš„æ—¥å¿—</td></tr><tr><td>ls</td><td>åˆ—å‡ºæ‰€æœ‰æœåŠ¡</td></tr><tr><td>ps</td><td>åˆ—å‡ºä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡çš„ä»»åŠ¡ï¼ˆTaskï¼‰</td></tr><tr><td>rm</td><td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡</td></tr><tr><td>rollback</td><td>å›æ»šæœåŠ¡çš„é…ç½®æ›´æ”¹</td></tr><tr><td>scale</td><td>æ‰©ç¼©ä¸€ä¸ªæˆ–å¤šä¸ªå¯å¤åˆ¶æœåŠ¡çš„å‰¯æœ¬æ•°é‡</td></tr><tr><td>update</td><td>æ›´æ–°æœåŠ¡é…ç½®</td></tr></tbody></table><h3 id="docker-service-create-åˆ›å»ºæœåŠ¡"><code>docker service create</code>:  åˆ›å»ºæœåŠ¡</h3><ul class="lvl-0"><li class="lvl-2"><p>å¸¸ç”¨å‚æ•°è¯´æ˜</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç¤ºä¾‹å‘½ä»¤ï¼ˆå«è¯´æ˜ï¼‰</th></tr></thead><tbody><tr><td><code>--name</code></td><td>æŒ‡å®šæœåŠ¡åç§°</td><td><code>docker service create --name my-web nginx</code><br>â†’ åˆ›å»ºä¸€ä¸ªåä¸º <code>my-web</code> çš„ nginx æœåŠ¡</td></tr><tr><td><code>--replicas</code></td><td>è®¾ç½®å‰¯æœ¬æ•°é‡ï¼ˆä»…é€‚ç”¨äº replicated æ¨¡å¼ï¼‰</td><td><code>docker service create --replicas 3 nginx</code><br>â†’ å¯åŠ¨ 3 ä¸ª nginx å‰¯æœ¬</td></tr><tr><td><code>--publish</code> æˆ– <code>-p</code></td><td>æ˜ å°„ç«¯å£ï¼ˆæ ¼å¼å¦‚ <code>80:80</code>ï¼‰</td><td><code>docker service create -p 8080:80 nginx</code><br>â†’ å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ°ä¸»æœº 8080</td></tr><tr><td><code>--env</code> æˆ– <code>-e</code></td><td>è®¾ç½®ç¯å¢ƒå˜é‡</td><td><code>docker service create -e ENV=prod nginx</code><br>â†’ è®¾ç½®ç¯å¢ƒå˜é‡ <code>ENV=prod</code></td></tr><tr><td><code>--mount</code></td><td>è®¾ç½®æ•°æ®å·æŒ‚è½½</td><td><code>docker service create --mount type=bind,src=/data,target=/app nginx</code><br>â†’ å°†ä¸»æœºçš„ <code>/data</code> ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†… <code>/app</code></td></tr><tr><td><code>--constraint</code></td><td>è®¾ç½®éƒ¨ç½²çº¦æŸï¼ˆå¦‚æŒ‡å®šèŠ‚ç‚¹ï¼‰</td><td><code>docker service create --constraint 'node.labels.type == web' nginx</code><br>â†’ ä»…éƒ¨ç½²åœ¨å¸¦æ ‡ç­¾ <code>type=web</code> çš„èŠ‚ç‚¹ä¸Š</td></tr><tr><td><code>--network</code></td><td>æŒ‡å®šæœåŠ¡æ‰€å±çš„ç½‘ç»œï¼ˆé€šå¸¸ä½¿ç”¨ overlay ç½‘ç»œï¼‰</td><td><code>docker service create --network my-net nginx</code><br>â†’ å°†æœåŠ¡è¿æ¥åˆ°è‡ªå®šä¹‰ç½‘ç»œ <code>my-net</code></td></tr><tr><td><code>--detach</code> æˆ– <code>-d</code></td><td>åå°è¿è¡ŒæœåŠ¡ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰</td><td><code>docker service create -d nginx</code><br>â†’ åå°åˆ›å»ºæœåŠ¡ï¼Œä¸é˜»å¡ç»ˆç«¯ï¼Œå› ä¸ºæ˜¯é»˜è®¤è¡Œä¸ºï¼Œæ‰€ä»¥ä¸åŠ  -d ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œserviceä¸æ”¯æŒåƒ docker run é‚£æ ·æ”¯æŒå‰å°è¿è¡Œ</td></tr><tr><td><code>--limit-cpu</code> / <code>--limit-memory</code></td><td>è®¾ç½®èµ„æºé™åˆ¶</td><td><code>docker service create --limit-cpu 0.5 --limit-memory 256M nginx</code><br>â†’ æ¯ä¸ªä»»åŠ¡æœ€å¤šä½¿ç”¨ 0.5 ä¸ª CPU å’Œ 256MB å†…å­˜</td></tr><tr><td><code>--restart-condition</code></td><td>è®¾ç½®é‡å¯ç­–ç•¥ï¼ˆå¦‚ on-failureã€anyã€noneï¼‰</td><td><code>docker service create --restart-condition on-failure nginx</code><br>â†’ ä»…å½“å®¹å™¨å¤±è´¥æ—¶è‡ªåŠ¨é‡å¯</td></tr><tr><td><code>--mode</code></td><td>æŒ‡å®šæœåŠ¡è¿è¡Œæ¨¡å¼ï¼Œæ”¯æŒï¼š<code>replicated</code>ã€<code>global</code>ã€<code>replicated-job</code>ã€<code>global-job</code></td><td><code>docker service create --mode global nginx</code><br>â†’ åœ¨é›†ç¾¤æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ª nginx å®ä¾‹</td></tr></tbody></table><blockquote><p>cpu ä¸ å†…å­˜é™åˆ¶</p></blockquote><table><thead><tr><th>å‚æ•°</th><th>æ„ä¹‰</th></tr></thead><tbody><tr><td><code>--limit-cpu 1.0</code></td><td>é™åˆ¶æ¯ä¸ªå®¹å™¨æœ€å¤šä½¿ç”¨ 1 æ ¸ CPUæ—¶é—´ , 1 CPU = åœ¨æ¯ä¸ªè°ƒåº¦å‘¨æœŸä¸­å¯å æ»¡ CPU çš„å…¨éƒ¨æ—¶é—´ä»½é¢(ä¸€ä¸ªå‘¨æœŸæ—¶é—´é»˜è®¤100ms)</td></tr><tr><td><code>--limit-cpu 0.5</code></td><td>é™åˆ¶æ¯ä¸ªå®¹å™¨æœ€å¤šä½¿ç”¨ 50% çš„å•æ ¸CPUæ—¶é—´</td></tr><tr><td><code>--limit-cpu 3.5</code></td><td>æ¯ä¸ªå®¹å™¨æœ€å¤šå¯ä»¥ä½¿ç”¨ 3.5 æ ¸çš„ CPU æ—¶é—´ï¼Œç”±è°ƒåº¦å™¨å†³å®šåˆ†é…ã€‚å¹¶ä¸æ˜¯é™åˆ¶æˆåªèƒ½è·‘åœ¨ä¸€ä¸ªæ ¸ä¸Šï¼Œè€Œæ˜¯é™åˆ¶â€œæ€»å…±ä½¿ç”¨ä¸è¶…è¿‡ 3.5 æ ¸çš„æ—¶é—´ç‰‡â€ã€‚</td></tr><tr><td><code>--limit-memory 512M</code></td><td>é™åˆ¶æ¯ä¸ªå®¹å™¨æœ€å¤šä½¿ç”¨æŒ‡å®šå†…å­˜ï¼ˆå¦‚ 512Mï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æœåŠ¡è¿è¡Œæ¨¡å¼ï¼ˆâ€“modeï¼‰è¯¦è§£</p></li></ul><table><thead><tr><th>æ¨¡å¼åç§°</th><th>è¯´æ˜</th><th>ä½¿ç”¨åœºæ™¯ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>replicated</code></td><td>é»˜è®¤æ¨¡å¼ã€‚ç”¨æˆ·æŒ‡å®šéœ€è¦è¿è¡Œå¤šå°‘ä¸ªå‰¯æœ¬ï¼ŒSwarm åœ¨åˆé€‚çš„èŠ‚ç‚¹ä¸Šè°ƒåº¦è¿™äº›å‰¯æœ¬ã€‚</td><td>å…¸å‹çš„ Web æœåŠ¡ï¼Œå¦‚ nginxã€Node.jsã€Java åº”ç”¨ç­‰</td></tr><tr><td><code>global</code></td><td>æ¯ä¸ªå¯ç”¨èŠ‚ç‚¹åªéƒ¨ç½²ä¸€ä¸ªä»»åŠ¡å®ä¾‹ï¼Œä¸éœ€è¦ç”¨æˆ·æŒ‡å®šå‰¯æœ¬æ•°ã€‚</td><td>ç³»ç»Ÿçº§æœåŠ¡ï¼Œå¦‚æ—¥å¿—æ”¶é›†å™¨ï¼ˆFluentdï¼‰ã€ç›‘æ§ä»£ç†ï¼ˆPrometheus node exporterï¼‰</td></tr><tr><td><code>replicated-job</code></td><td>åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Š<strong>æŒ‰å‰¯æœ¬æ•°</strong>è¿è¡Œä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œä»»åŠ¡å®Œæˆåå³é€€å‡ºã€‚</td><td>æ•°æ®å¤„ç†ã€æ‰¹å¤„ç†ä»»åŠ¡ï¼Œå¦‚è½¬æ¢æ–‡ä»¶æˆ–è·‘ ETL</td></tr><tr><td><code>global-job</code></td><td>åœ¨<strong>æ‰€æœ‰èŠ‚ç‚¹ä¸Šå„è¿è¡Œä¸€æ¬¡</strong>çš„çŸ­æš‚ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•å³é€€å‡ºã€‚</td><td>åˆå§‹åŒ–è„šæœ¬ã€æ¯å°æœºå™¨ä¸Šè¿è¡Œä¸€æ¬¡çš„æ•°æ®æ¸…æ´—ã€åˆå§‹åŒ–ç¯å¢ƒä»»åŠ¡ç­‰</td></tr></tbody></table><blockquote><p>job æ¨¡å¼é€šå¸¸é…åˆé•œåƒä¸­è®¾å®šçš„å…¥å£å‘½ä»¤ä½¿ç”¨ï¼Œä¸é€‚ç”¨äºé•¿æœŸè¿è¡Œçš„æœåŠ¡ã€‚<br>replicated å’Œ global æ¨¡å¼é€‚ç”¨äºæŒç»­è¿è¡Œçš„æœåŠ¡ï¼ŒSwarm ä¼šè‡ªåŠ¨é‡å¯å¤±è´¥çš„ä»»åŠ¡ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>æœåŠ¡é‡å¯ç­–ç•¥ï¼ˆâ€“restart-conditionï¼‰è¯¦è§£</p></li></ul><table><thead><tr><th>å€¼</th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td><code>none</code></td><td>ä¸é‡å¯ä»»åŠ¡ã€‚å³ä½¿ä»»åŠ¡å¤±è´¥ï¼Œä¹Ÿä¸ä¼šå°è¯•æ¢å¤ã€‚é€‚ç”¨äºçŸ­ç”Ÿå‘½å‘¨æœŸçš„ä»»åŠ¡æˆ–æµ‹è¯•æœåŠ¡ã€‚</td></tr><tr><td><code>on-failure</code></td><td><strong>ä»…åœ¨ä»»åŠ¡å¼‚å¸¸å¤±è´¥æ—¶</strong>ï¼ˆexit code é 0ï¼‰è‡ªåŠ¨é‡å¯ã€‚å¸¸ç”¨äºå¯èƒ½å¶å‘å¤±è´¥çš„æœåŠ¡ã€‚</td></tr><tr><td><code>any</code>ï¼ˆé»˜è®¤ï¼‰</td><td><strong>æ— è®ºä»»åŠ¡å¦‚ä½•é€€å‡º</strong>ï¼ˆåŒ…æ‹¬æ­£å¸¸é€€å‡ºæˆ–å¤±è´¥ï¼‰ï¼Œéƒ½ä¼šå°è¯•é‡å¯ã€‚é€‚ç”¨äºæŒç»­è¿è¡ŒæœåŠ¡ã€‚</td></tr></tbody></table><blockquote><p>æƒ…æ™¯æ€»ç»“</p></blockquote><table><thead><tr><th>æƒ…æ™¯</th><th><code>none</code></th><th><code>on-failure</code></th><th><code>any</code></th></tr></thead><tbody><tr><td>æœåŠ¡è¿è¡Œæ—¶å´©æºƒï¼ˆexit code â‰  0ï¼‰</td><td>âŒ ä¸é‡å¯</td><td>âœ… è‡ªåŠ¨é‡å¯</td><td>âœ… è‡ªåŠ¨é‡å¯</td></tr><tr><td>æœåŠ¡æ­£å¸¸ç»“æŸï¼ˆexit code = 0ï¼‰</td><td>âŒ ä¸é‡å¯</td><td>âŒ ä¸é‡å¯</td><td>âœ… è‡ªåŠ¨é‡å¯</td></tr><tr><td>æŒç»­è¿è¡Œå‹æœåŠ¡ï¼ˆå¦‚ nginxï¼‰</td><td>âŒ ä¸æ¨è</td><td>å¯ç”¨</td><td>âœ… æ¨è</td></tr><tr><td>ä¸€æ¬¡æ€§ä»»åŠ¡ï¼ˆå¦‚æ‰¹å¤„ç†ã€æ•°æ®åˆå§‹åŒ–ï¼‰</td><td>âœ… æ¨è</td><td>å¯ç”¨</td><td>âŒ ä¸æ¨è</td></tr></tbody></table><h4 id="docker-service-create-ä½¿ç”¨ç¤ºä¾‹"><code>docker service create</code> ä½¿ç”¨ç¤ºä¾‹</h4><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ªåä¸º my-nginx çš„æœåŠ¡ï¼Œå¹¶æŒ‡å®š 3 ä¸ªå‰¯æœ¬ï¼Œå°† 80 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 80 ç«¯å£ï¼Œå¹¶ä½¿ç”¨ nginx é•œåƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­¤æ—¶åœ¨æµè§ˆå™¨ä¸­è¾“å…¥Swarmä¸­ä»»æ„èŠ‚ç‚¹çš„IPåœ°å€ï¼Œå³å¯è®¿é—®åˆ°NginxæœåŠ¡ï¼Œå³ä½¿ä»»åŠ¡æ²¡æœ‰è¢«åˆ†é…åˆ°è¿™ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿèƒ½è®¿é—®åˆ°NginxæœåŠ¡ï¼Œè¿™å°±æ˜¯Swarmçš„è´Ÿè½½å‡è¡¡åŠŸèƒ½</span></span><br><span class="line">docker service create \</span><br><span class="line">  --name my-nginx \</span><br><span class="line">  --replicas 3 \</span><br><span class="line">  --publish 80:80 \</span><br><span class="line">  nginx</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ªåä¸º log-agent çš„å…¨å±€æœåŠ¡ï¼Œå¹¶ä½¿ç”¨ fluentd é•œåƒï¼Œå³æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè¿è¡Œä¸€ä¸ª fluentd å®¹å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># global</span></span><br><span class="line">docker service create --name log-agent --mode global fluentd</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ªåç§°ä¸º web-app çš„æœåŠ¡ï¼Œå¹¶è®¾ç½®ç¯å¢ƒå˜é‡ NODE_ENV=production ï¼ŒæŒ‚è½½ /data ç›®å½•åˆ°å®¹å™¨çš„ /app/data ç›®å½•ï¼Œå¹¶è®¾ç½® 2 ä¸ªå‰¯æœ¬ï¼Œå¹¶ä¸”æŒ‡å®šå¯åŠ¨å®¹å™¨çš„å‘½ä»¤ä¸º node server.js</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">  --name web-app \</span><br><span class="line">  --<span class="built_in">env</span> NODE_ENV=production \</span><br><span class="line">  --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,src=/data,target=/app/data \</span><br><span class="line">  --replicas 2 \</span><br><span class="line">  node:18 node server.js</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºä¸€ä¸ªåç§°ä¸º db çš„æœåŠ¡ï¼Œå¹¶æŒ‡å®šè¿è¡Œåœ¨å…·æœ‰ role=db æ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”ä½¿ç”¨åä¸º db-data çš„å·æŒ‚è½½æ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ•°æ®å·</span></span><br><span class="line">docker volume create db-data</span><br><span class="line"><span class="comment"># åˆ›å»ºæœåŠ¡</span></span><br><span class="line">docker service create \</span><br><span class="line">  --name db \</span><br><span class="line">  --constraint <span class="string">&#x27;node.labels.role == db&#x27;</span> \</span><br><span class="line">  --mount <span class="built_in">type</span>=volume,<span class="built_in">source</span>=db-data,target=/var/lib/mysql \</span><br><span class="line">  mysql:8</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨ on-failure ç­–ç•¥ï¼Œä»…åœ¨å¤±è´¥æ—¶è‡ªåŠ¨é‡å¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">  --name unstable-worker \</span><br><span class="line">  --restart-condition on-failure \</span><br><span class="line">  my-worker-image</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŒ‡å®šç½‘ç»œï¼Œç½‘ç»œé©±åŠ¨ç±»å‹ä¸º overlay</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆåœ¨managerèŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ª overlay ç½‘ç»œï¼ˆé€‚ç”¨äº Swarm æ¨¡å¼ï¼‰</span></span><br><span class="line">docker network create --driver overlay my-overlay-net</span><br><span class="line"><span class="comment"># åˆ›å»ºé©±åŠ¨ç±»å‹ä¸º overlay çš„ç½‘ç»œï¼Œä¼šç«‹å³åŒæ­¥æ‰€æœ‰ manager èŠ‚ç‚¹ï¼Œä½†ä¸ä¼šåŒæ­¥åˆ° worker èŠ‚ç‚¹ï¼Œåªæœ‰å½“ä»»åŠ¡è¢«åˆ†é…åˆ° worker èŠ‚ç‚¹æ—¶ï¼Œè¯¥ç½‘ç»œæ‰ä¼šåŒæ­¥åˆ° worker èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæœåŠ¡å¹¶åŠ å…¥è¯¥ç½‘ç»œ</span></span><br><span class="line">docker service create \</span><br><span class="line">  --name web-service \</span><br><span class="line">  --network my-overlay-net \</span><br><span class="line">  --replicas 5 \</span><br><span class="line">  nginx</span><br><span class="line">  <span class="comment"># --network: æŒ‡å®šæœåŠ¡è¿è¡Œæ—¶è¿æ¥åˆ°è¯¥ç½‘ç»œï¼Œè¿™æ ·åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­çš„æœåŠ¡ä¹‹é—´å¯ä»¥ä½¿ç”¨ æœåŠ¡åäº’ç›¸è®¿é—®ï¼Œå®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚</span></span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID     NAME              DRIVER    SCOPE</span><br><span class="line">6b7aadbbd180   bridge            bridge    <span class="built_in">local</span></span><br><span class="line">5ddadf5d0608   docker_gwbridge   bridge    <span class="built_in">local</span></span><br><span class="line">21c6f5b1bedd   host              host      <span class="built_in">local</span></span><br><span class="line">idx465x3jg68   ingress           overlay   swarm</span><br><span class="line">a770c5ad4b13   none              null      <span class="built_in">local</span></span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">åˆå§‹åŒ–Swarmé›†ç¾¤åï¼Œä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„ overlay ç½‘ç»œ: ingressï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»ºæœåŠ¡æ—¶æ²¡æœ‰æŒ‡å®šç½‘ç»œï¼Œé‚£ä¹ˆæœåŠ¡å°±ä¼šåŠ å…¥ ingress ç½‘ç»œã€‚</li><li class="lvl-2">ä½†æ˜¯è¿™ä¸ªé»˜è®¤çš„ ingress ç½‘ç»œå¹¶ä¸èƒ½ç”¨äºæœåŠ¡ä¹‹é—´é€šè¿‡æœåŠ¡åç§°äº’ç›¸è®¿é—®ï¼Œä½†å¯ä»¥é€šè¿‡IPæˆ–Hostnameè®¿é—®æœåŠ¡ã€‚</li><li class="lvl-2">é»˜è®¤çš„ ingress ç½‘ç»œä»…ç”¨äº ingress è´Ÿè½½å‡è¡¡ï¼ˆå³ -p ç«¯å£æ˜ å°„ï¼‰ï¼Œä¸æ”¯æŒæœåŠ¡å†…éƒ¨é€šä¿¡æˆ– DNS æœåŠ¡å‘ç°ã€‚</li><li class="lvl-2">å¦å¤–ï¼Œåˆå§‹åŒ–Swarmé›†ç¾¤åï¼Œè¿˜ä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„ bridge ç½‘ç»œ: docker_gwbridgeï¼Œè´Ÿè´£è¿æ¥ Swarm é›†ç¾¤çš„ Overlay ç½‘ç»œä¸å®¿ä¸»æœºç½‘ç»œï¼Œè´Ÿè´£è·¨èŠ‚ç‚¹çš„æµé‡è½¬å‘<ul class="lvl-3"><li class="lvl-4">å½“ä¸€ä¸ªå®¹å™¨åœ¨ Overlay ç½‘ç»œé‡Œè®¿é—®å¤–éƒ¨ IPï¼Œæ¯”å¦‚è®¿é—®å…¬ç½‘ï¼Œæµé‡æœ€ç»ˆé€šè¿‡ docker_gwbridge ç½‘ç»œå‡ºå£å‡ºå»ã€‚</li><li class="lvl-4">èŠ‚ç‚¹é—´ VXLAN éš§é“çš„æµé‡ä¹Ÿä¼šå€ŸåŠ©æ­¤ç½‘ç»œæ¡¥æ¥åˆ°å®¿ä¸»æœºçš„ç‰©ç†ç½‘ç»œæ¥å£ã€‚</li></ul></li></ul></div><h3 id="docker-service-ls-åˆ—å‡ºæ‰€æœ‰æœåŠ¡"><code>docker service ls</code>: åˆ—å‡ºæ‰€æœ‰æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker service <span class="built_in">ls</span></span><br><span class="line">ID             NAME       MODE         REPLICAS   IMAGE          PORTS</span><br><span class="line">dmnztimv3pb8   my-nginx   replicated   2/2        nginx:latest   *:80-&gt;80/tcp</span><br></pre></td></tr></table></figure><h3 id="docker-service-inspect-æŸ¥çœ‹æœåŠ¡è¯¦æƒ…"><code>docker service inspect</code>: æŸ¥çœ‹æœåŠ¡è¯¦æƒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service inspect my-nginx</span><br></pre></td></tr></table></figure><h3 id="docker-service-log-æŸ¥çœ‹æœåŠ¡æ—¥å¿—"><code>docker service log</code>: æŸ¥çœ‹æœåŠ¡æ—¥å¿—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šæœåŠ¡ä¸‹æ‰€æœ‰ä»»åŠ¡çš„æ—¥å¿—</span></span><br><span class="line">docker service logs my-nginx</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šä»»åŠ¡çš„æ—¥å¿—ï¼ŒæŒ‡å®šä»»åŠ¡IDï¼Œä¸æ”¯æŒä»»åŠ¡åç§°</span></span><br><span class="line">docker service logs p4tats0f9npk</span><br><span class="line"><span class="comment"># æ»šåŠ¨æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">docker service logs -f my-nginx</span><br></pre></td></tr></table></figure><h3 id="docker-service-ps-åˆ—å‡ºæœåŠ¡ä»»åŠ¡"><code>docker service ps</code>: åˆ—å‡ºæœåŠ¡ä»»åŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service ps my-nginx</span><br><span class="line">ID             NAME         IMAGE          NODE       DESIRED STATE   CURRENT STATE            ERROR     PORTS</span><br><span class="line">p4tats0f9npk   my-nginx.1   nginx:latest   manager1   Running         Running 13 minutes ago</span><br><span class="line">v7z383xy7dso   my-nginx.2   nginx:latest   manager2   Running         Running 15 minutes ago</span><br></pre></td></tr></table></figure><h3 id="docker-service-scale-æ‰©å®¹-ç¼©å®¹æœåŠ¡"><code>docker service scale</code>: æ‰©å®¹/ç¼©å®¹æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ä¸€ä¸ªæœåŠ¡</span></span><br><span class="line">docker service create \</span><br><span class="line">  --name my-nginx \</span><br><span class="line">  --replicas 3 \</span><br><span class="line">  --publish 80:80 \</span><br><span class="line">  nginx</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœåŠ¡ä»»åŠ¡</span></span><br><span class="line">docker service ps my-nginx</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">ID             NAME         IMAGE          NODE       DESIRED STATE   CURRENT STATE            ERROR     PORTS</span><br><span class="line">p4tats0f9npk   my-nginx.1   nginx:latest   manager1   Running         Running 14 seconds ago</span><br><span class="line">v7z383xy7dso   my-nginx.2   nginx:latest   manager2   Running         Running 2 minutes ago</span><br><span class="line">w0sm5ixvi6eb   my-nginx.3   nginx:latest   worker2    Running         Running 4 seconds ago</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰©å®¹åˆ°5ä¸ªä»»åŠ¡</span></span><br><span class="line">docker service scale my-nginx=5</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœåŠ¡ä»»åŠ¡</span></span><br><span class="line">docker service ps my-nginx</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">ID             NAME         IMAGE          NODE       DESIRED STATE   CURRENT STATE                    ERROR     PORTS</span><br><span class="line">p4tats0f9npk   my-nginx.1   nginx:latest   manager1   Running         Running about a minute ago</span><br><span class="line">v7z383xy7dso   my-nginx.2   nginx:latest   manager2   Running         Running 3 minutes ago</span><br><span class="line">w0sm5ixvi6eb   my-nginx.3   nginx:latest   worker2    Running         Running about a minute ago</span><br><span class="line">ksbeflwg3mcj   my-nginx.4   nginx:latest   worker1    Running         Running less than a second ago</span><br><span class="line">iw4zlm56n1x8   my-nginx.5   nginx:latest   manager3   Running         Running less than a second ago</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼©å®¹åˆ°2ä¸ªäººä»»åŠ¡</span></span><br><span class="line">docker service scale my-nginx=2</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœåŠ¡ä»»åŠ¡</span></span><br><span class="line">docker service ps my-nginx</span><br><span class="line">ID             NAME         IMAGE          NODE       DESIRED STATE   CURRENT STATE           ERROR     PORTS</span><br><span class="line">p4tats0f9npk   my-nginx.1   nginx:latest   manager1   Running         Running 2 minutes ago</span><br><span class="line">v7z383xy7dso   my-nginx.2   nginx:latest   manager2   Running         Running 4 minutes ago</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿˜å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ‰©ç¼©å®¹</span></span><br><span class="line">docker service update --replicas=5 my-nginx</span><br></pre></td></tr></table></figure><h3 id="docker-service-update-æ›´æ–°æœåŠ¡"><code>docker service update</code>: æ›´æ–°æœåŠ¡</h3><ul class="lvl-0"><li class="lvl-2"><p>æ”¯æŒçš„å‚æ•°</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>--image</code></td><td>æ›´æ–°æœåŠ¡ä½¿ç”¨çš„é•œåƒ</td><td><code>--image nginx:1.25</code></td></tr><tr><td><code>--replicas</code></td><td>è®¾ç½®æœåŠ¡çš„å‰¯æœ¬æ•°é‡ï¼ˆä»…é€‚ç”¨äº replicated æ¨¡å¼ï¼‰</td><td><code>--replicas 5</code></td></tr><tr><td><code>--env-add</code></td><td>æ·»åŠ ç¯å¢ƒå˜é‡</td><td><code>--env-add DEBUG=true</code></td></tr><tr><td><code>--env-rm</code></td><td>ç§»é™¤ç¯å¢ƒå˜é‡</td><td><code>--env-rm OLD_VAR</code></td></tr><tr><td><code>--publish-add</code></td><td>æ·»åŠ ç«¯å£æ˜ å°„</td><td><code>--publish-add published=8080,target=80</code></td></tr><tr><td><code>--publish-rm</code></td><td>ç§»é™¤ç«¯å£æ˜ å°„</td><td><code>--publish-rm 80</code></td></tr><tr><td><code>--mount-add</code></td><td>æ·»åŠ æŒ‚è½½</td><td><code>--mount-add type=bind,src=/data,dst=/data</code></td></tr><tr><td><code>--mount-rm</code></td><td>ç§»é™¤æŒ‚è½½</td><td><code>--mount-rm /data</code></td></tr><tr><td><code>--constraint-add</code></td><td>æ·»åŠ éƒ¨ç½²çº¦æŸ</td><td><code>--constraint-add 'node.labels.zone==east'</code></td></tr><tr><td><code>--constraint-rm</code></td><td>ç§»é™¤éƒ¨ç½²çº¦æŸ</td><td><code>--constraint-rm 'node.labels.zone==east'</code></td></tr><tr><td><code>--limit-cpu</code></td><td>è®¾ç½® CPU é™åˆ¶</td><td><code>--limit-cpu 0.5</code></td></tr><tr><td><code>--limit-memory</code></td><td>è®¾ç½®å†…å­˜é™åˆ¶</td><td><code>--limit-memory 256M</code></td></tr><tr><td><code>--restart-condition</code></td><td>è®¾ç½®é‡å¯ç­–ç•¥ï¼ˆnoneã€on-failureã€anyï¼‰</td><td><code>--restart-condition on-failure</code></td></tr><tr><td><code>--update-delay</code></td><td>è®¾ç½®ä»»åŠ¡æ›´æ–°ä¹‹é—´çš„å»¶è¿Ÿ</td><td><code>--update-delay 10s</code></td></tr><tr><td><code>--update-parallelism</code></td><td>è®¾ç½®å¹¶å‘æ›´æ–°ä»»åŠ¡çš„æ•°é‡</td><td><code>--update-parallelism 2</code></td></tr><tr><td><code>--update-order</code></td><td>è®¾ç½®æ›´æ–°é¡ºåºï¼ˆstart-first æˆ– stop-firstï¼‰</td><td><code>--update-order start-first</code></td></tr><tr><td><code>--update-failure-action</code></td><td>æ›´æ–°å¤±è´¥åçš„åŠ¨ä½œï¼ˆpauseã€continueã€rollbackï¼‰</td><td><code>--update-failure-action rollback</code></td></tr><tr><td><code>--rollback</code></td><td>å›æ»šåˆ°ä¸Šä¸€æ¬¡æˆåŠŸé…ç½®</td><td><code>--rollback</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker service update \</span><br><span class="line">  --image nginx:1.25 \</span><br><span class="line">  --replicas 4 \</span><br><span class="line">  --env-add ENV=prod \</span><br><span class="line">  --limit-memory 512M \</span><br><span class="line">  --limit-cpu 1.0 \</span><br><span class="line">  --update-delay 10s \</span><br><span class="line">  --update-parallelism 2 \</span><br><span class="line">  --update-failure-action rollback \</span><br><span class="line">  my-nginx</span><br></pre></td></tr></table></figure><h3 id="docker-service-rollback-å›æ»šæœåŠ¡"><code>docker service rollback</code>: å›æ»šæœåŠ¡</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¼šå°†æœåŠ¡å›æ»šåˆ°ä¸Šä¸€æ¬¡æˆåŠŸéƒ¨ç½²çš„ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬é•œåƒã€ç¯å¢ƒå˜é‡ã€éƒ¨ç½²çº¦æŸç­‰ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker service rollback &lt;service_name&gt;</span></span><br><span class="line">docker service rollback my-nginx</span><br></pre></td></tr></table></figure><h3 id="docker-service-rm-åˆ é™¤æœåŠ¡"><code>docker service rm</code>: åˆ é™¤æœåŠ¡</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤æœåŠ¡ä¼šåœæ­¢æœåŠ¡å¹¶åˆ é™¤æœåŠ¡ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker service rm &lt;service_name&gt;</span></span><br><span class="line">docker service <span class="built_in">rm</span> my-nginx</span><br></pre></td></tr></table></figure><h2 id="ç»éªŒæŠ€å·§">ç»éªŒæŠ€å·§</h2><h3 id="å¦‚ä½•è®©ä»»åŠ¡è¿è¡Œåœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šï¼Ÿ">å¦‚ä½•è®©ä»»åŠ¡è¿è¡Œåœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šï¼Ÿ</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºæœåŠ¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>--constraint</code> å‚æ•°æŒ‡å®šèŠ‚ç‚¹çš„æ ‡ç­¾ï¼Œä½¿å…¶è¿è¡Œåœ¨å…·æœ‰æŒ‡å®šæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»™ç»“ç‚¹åŠ æ ‡ç­¾</span></span><br><span class="line">docker node update --label-add <span class="built_in">env</span>=prod worker1</span><br><span class="line"></span><br><span class="line"><span class="comment"># node.labels æ˜¯Swarmå†…ç½®å±æ€§ï¼Œè¡¨ç¤ºèŠ‚ç‚¹çš„æ ‡ç­¾ï¼Œè¿™é‡ŒæŒ‡å®šèŠ‚ç‚¹æ ‡ç­¾ä¸º env=prod</span></span><br><span class="line">docker service create \</span><br><span class="line">--name my-nginx \</span><br><span class="line">--replicas 2 \</span><br><span class="line">--constraint <span class="string">&#x27;node.labels.env == prod&#x27;</span> \</span><br><span class="line">nginx:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œè¦æ³¨æ„ï¼Œè¿è¡Œä»»åŠ¡åå¦‚æœä¿®æ”¹äº†nodeçš„æ ‡ç­¾ï¼Œé‚£ä¹ˆä»»åŠ¡å°±ä¼šé‡æ–°åˆ†é…ï¼Œåˆ†é…æ˜¯å¦‚æœæ‰¾ä¸åˆ°ç¬¦åˆæ ‡ç­¾çš„èŠ‚ç‚¹ï¼Œå°±ä¼šè¿è¡Œå¤±è´¥ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åªèƒ½è¿è¡Œåœ¨ç®¡ç†èŠ‚ç‚¹ä¸Š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># node.role æ˜¯ Swarm çš„å†…ç½®å±æ€§ï¼Œè¡¨ç¤ºèŠ‚ç‚¹çš„ç±»å‹ï¼Œå€¼ä¸º manager æˆ– workerã€‚</span></span><br><span class="line">docker service create \</span><br><span class="line">  --name manager-only-service \</span><br><span class="line">  --constraint <span class="string">&#x27;node.role == manager&#x27;</span> \</span><br><span class="line">  nginx</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Swarm å†…ç½®å±æ€§</p></li></ul><table><thead><tr><th>å±æ€§å</th><th>ç¤ºä¾‹å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>node.id</code></td><td><code>node.id == abcd1234</code></td><td>èŠ‚ç‚¹çš„å”¯ä¸€ IDï¼ˆå¯ç”¨ <code>docker node ls</code> æŸ¥çœ‹ï¼‰</td></tr><tr><td><code>node.hostname</code></td><td><code>node.hostname == manager-1</code></td><td>èŠ‚ç‚¹ä¸»æœºå</td></tr><tr><td><code>node.role</code></td><td><code>node.role == manager</code> æˆ– <code>node.role == worker</code></td><td>èŠ‚ç‚¹åœ¨ Swarm ä¸­çš„è§’è‰²ï¼ˆç®¡ç†/å·¥ä½œï¼‰</td></tr><tr><td><code>engine.labels.*</code></td><td><code>engine.labels.disk == ssd</code></td><td>Docker å¼•æ“çº§åˆ«çš„æ ‡ç­¾ï¼ˆéœ€æ‰‹åŠ¨è®¾ç½®ï¼‰</td></tr><tr><td><code>node.platform.os</code></td><td><code>node.platform.os == linux</code></td><td>èŠ‚ç‚¹æ“ä½œç³»ç»Ÿç±»å‹</td></tr><tr><td><code>node.platform.arch</code></td><td><code>node.platform.arch == x86_64</code></td><td>èŠ‚ç‚¹æ¶æ„ç±»å‹ï¼ˆå¦‚ <code>arm64</code>, <code>x86_64</code>ï¼‰</td></tr></tbody></table><h3 id="å¦‚ä½•è®¿é—®ServiceæœåŠ¡ï¼Ÿ">å¦‚ä½•è®¿é—®ServiceæœåŠ¡ï¼Ÿ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ä¸€ä¸ªserviceï¼Œ3ä¸ªå‰¯æœ¬ï¼Œé•œåƒä¸º whoamiï¼Œè¿™ä¸ªé•œåƒä¼šè¿”å›å½“å‰è®¿é—®çš„å®¹å™¨çš„IDï¼Œå³è¿”å›çš„Hostname</span></span><br><span class="line">docker service create --name <span class="built_in">whoami</span> \</span><br><span class="line">  --replicas 3 \</span><br><span class="line">  -p 80:80 \</span><br><span class="line">  traefik/whoami</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹serviceæœåŠ¡è¿è¡Œåœ¨å“ªäº›èŠ‚ç‚¹ä¸Šï¼Œçœ‹åˆ°è¿™é‡Œåªæœ‰ manager1\manager2\worker2 èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæ³¨æ„è¿™é‡Œçœ‹åˆ°çš„IDæ˜¯Task IDï¼Œå¹¶éå®¹å™¨ID</span></span><br><span class="line">docker service ps <span class="built_in">whoami</span></span><br><span class="line">ID             NAME       IMAGE                   NODE       DESIRED STATE   CURRENT STATE            ERROR     PORTS</span><br><span class="line">u1elzp22hyvm   whoami.1   traefik/whoami:latest   manager2   Running         Running 2 minutes ago</span><br><span class="line">4cent1kfgghb   whoami.2   traefik/whoami:latest   worker2    Running         Running 17 seconds ago</span><br><span class="line">lu6u6j8ji0uq   whoami.3   traefik/whoami:latest   manager1   Running         Running 40 seconds ago</span><br><span class="line"><span class="comment"># å¦‚æœå¸Œæœ›æŸ¥è¯¢æŸä¸ªServiceçš„æ‰€æœ‰å®¹å™¨çš„IDï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span></span><br><span class="line">docker service ps <span class="built_in">whoami</span> -q | xargs docker inspect --format <span class="string">&#x27;&#123;&#123;.Status.ContainerStatus.ContainerID&#125;&#125;&#x27;</span> | <span class="built_in">cut</span> -c 1-12</span><br><span class="line">a3fb63bde8e7</span><br><span class="line">a14e30a02987</span><br><span class="line">549610f3a1e9</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶æˆ‘ä»¬é€šè¿‡curlè®¿é—® Swarm é›†ç¾¤ä¸­çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„IPï¼Œéƒ½å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªæœåŠ¡ï¼Œæ¯”å¦‚ <code>curl 10.211.55.12</code>ï¼Œè¿™æ˜¯ manager3 èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œè™½ç„¶è¿™ä¸ªæœåŠ¡å¹¶æ²¡æœ‰åœ¨ manager3 èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬ä¾æ—§å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªæœåŠ¡ï¼Œä¸ä»…å¦‚æ­¤ï¼Œæ¯æ¬¡è¿è¡Œå‘½ä»¤è¿”å›çš„Hostname(å°±æ˜¯å®¹å™¨ID)éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå…¶æ•ˆæœå°±æ˜¯åœ¨å„ä¸ªè¿è¡Œçš„å®¹å™¨é—´è½®è¯¢ï¼Œè¿™å°±æ˜¯ Swarm é›†ç¾¤çš„è´Ÿè½½å‡è¡¡æ•ˆæœã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.211.55.12</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Hostname: a3fb63bde8e7   <span class="comment"># å®¹å™¨ID</span></span><br><span class="line">IP: 127.0.0.1</span><br><span class="line">IP: ::1</span><br><span class="line">IP: 10.0.0.36            <span class="comment"># å®¹å™¨IPï¼Œå¯¹æ¥ br0</span></span><br><span class="line">IP: 172.18.0.4           <span class="comment"># å®¹å™¨IPï¼Œå¯¹æ¥ docker_gwbridge</span></span><br><span class="line">RemoteAddr: 10.0.0.6:52964</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: 10.211.55.12</span><br><span class="line">User-Agent: curl/7.61.1</span><br><span class="line">Accept: */*</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®æœåŠ¡ï¼Œå»ºè®®å°†æ‰€æœ‰æœåŠ¡è¿è¡Œåœ¨ç›¸åŒçš„networkä¸­ï¼Œè¿™æ ·å¯ä»¥ä¸åŒçš„serviceä¹‹é—´å¯ä»¥é€šè¿‡æœåŠ¡åç§°è®¿é—®æœåŠ¡ï¼Œåœ¨é›†ç¾¤å¤–éƒ¨ï¼Œå¯ä»¥é€šè¿‡nginxç­‰ä»£ç†è®¿é—®æœåŠ¡ã€‚</p></li><li class="lvl-2"><p>å¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬æ–¹ä¾¿æŸ¥çœ‹serviceä¸containerçš„è¿è¡Œå…³ç³»ï¼Œæ¯”å¦‚ï¼šdocker_service_container</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: docker_service_container</span></span><br><span class="line"><span class="comment"># ç”¨æ³•æç¤º</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ç”¨æ³•: <span class="variable">$0</span> &lt;SERVICE_NAME&gt;&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># serviceåç§°</span></span><br><span class="line">SERVCIE_NAME=<span class="variable">$1</span></span><br><span class="line"><span class="comment"># æ‰€å±network,é»˜è®¤ ingressï¼Œè¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯è‡ªå®šä¹‰çš„overlayç½‘ç»œï¼Œåªèƒ½è·å–åˆ°å½“å‰ä¸»æœºä¸Šçš„å®¹å™¨IP</span></span><br><span class="line">NETWORK=<span class="variable">$2</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  NETWORK=$(docker service inspect <span class="variable">$SERVCIE_NAME</span> --format <span class="string">&#x27;&#123;&#123;json .Endpoint.VirtualIPs&#125;&#125;&#x27;</span> | jq <span class="string">&#x27;.[0].NetworkID&#x27;</span> | sed <span class="string">&#x27;s/&quot;//g&#x27;</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># NETWORK=$&#123;2:-ingress&#125;</span></span><br><span class="line"></span><br><span class="line">d1=$(<span class="built_in">echo</span> -e <span class="string">&quot;SERVICE-ID TASK-ID CONTAINER-ID NODE-ID&quot;</span> | awk <span class="string">&#x27;&#123;printf &quot;%-12s    %-12s    %-12s    %-12s\n&quot;, substr($1,1,12), substr($2,1,12), substr($3,1,12), substr($4,1,12)&#125;&#x27;</span> ;\</span><br><span class="line">docker service ps <span class="variable">$SERVCIE_NAME</span> --filter <span class="string">&quot;desired-state=running&quot;</span> -q | xargs docker inspect --format <span class="string">&#x27;&#123;&#123;.ServiceID&#125;&#125;    &#123;&#123;.ID&#125;&#125;    &#123;&#123;.Status.ContainerStatus.ContainerID&#125;&#125;    &#123;&#123;.NodeID&#125;&#125;&#x27;</span> \</span><br><span class="line">| awk <span class="string">&#x27;&#123;printf &quot;%-12s    %-12s    %-12s    %-12s\n&quot;, substr($1,1,12), substr($2,1,12), substr($3,1,12), substr($4,1,12)&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#echo &quot;$d1&quot;</span></span><br><span class="line"></span><br><span class="line">d2=$(docker service ps <span class="variable">$SERVCIE_NAME</span> --filter <span class="string">&quot;desired-state=running&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#echo &quot;$d2&quot;</span></span><br><span class="line"></span><br><span class="line">nn1=$(awk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">NR==FNR &amp;&amp; FNR &gt; 1 &#123;</span></span><br><span class="line"><span class="string">  id = $1</span></span><br><span class="line"><span class="string">  name = $2</span></span><br><span class="line"><span class="string">  node = $4</span></span><br><span class="line"><span class="string">  desired = $5</span></span><br><span class="line"><span class="string">  # æ‹¼æ¥ CURRENT STATEï¼ˆä»ç¬¬6åˆ—å¼€å§‹çš„æ‰€æœ‰å­—æ®µï¼‰</span></span><br><span class="line"><span class="string">  current = &quot;&quot;</span></span><br><span class="line"><span class="string">  for (i=6; i&lt;=NF; i++) &#123;</span></span><br><span class="line"><span class="string">    current = current $i &quot; &quot;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  gsub(/ /, &quot;-&quot;, current)</span></span><br><span class="line"><span class="string">  current = substr(current, 1, length(current)-1)  # å»æ‰æœ€åç©ºæ ¼</span></span><br><span class="line"><span class="string">  info[id] = name &quot;\t&quot; node &quot;\t&quot; desired &quot;\t&quot; current</span></span><br><span class="line"><span class="string">  next</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">FNR==1 &#123;</span></span><br><span class="line"><span class="string">  print $0 &quot;\tTASK-NAME\tNODE\tDESIRED_STATE\tCURRENT_STATE&quot;</span></span><br><span class="line"><span class="string">  next</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  print $0 &quot;\t&quot; info[$2]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#x27;</span> &lt;(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$d2</span>&quot;</span>) &lt;(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$d1</span>&quot;</span>) | <span class="built_in">tail</span> -n +2 | column -t)</span><br><span class="line"></span><br><span class="line">nn2=$(<span class="built_in">echo</span> <span class="string">&quot;CONTAINER-ID IP&quot;</span>;docker network inspect <span class="variable">$&#123;NETWORK&#125;</span> -f <span class="string">&#x27;&#123;&#123;range $id, $container := .Containers&#125;&#125;&#123;&#123;slice $id 0 12&#125;&#125; &#123;&#123;$container.Name&#125;&#125; &#123;&#123;$container.IPv4Address&#125;&#125;&#123;&#123;println&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> | grep <span class="variable">$SERVCIE_NAME</span> | awk -F <span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $1&quot; &quot;$3&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">NR==FNR &#123; ip[$1]=$2; next &#125;</span></span><br><span class="line"><span class="string">&#123; print $0, ip[$3] &#125;</span></span><br><span class="line"><span class="string">&#x27;</span> &lt;(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$nn2</span>&quot;</span>) &lt;(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$nn1</span>&quot;</span>) | column -t</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/docker-swarm-service</span><br><span class="line"><span class="comment"># æ‰§è¡Œè„šæœ¬</span></span><br><span class="line">docker-swarm-service <span class="built_in">whoami</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">SERVICE-ID    TASK-ID       CONTAINER-ID  NODE-ID       TASK-NAME  NODE      DESIRED_STATE  CURRENT_STATE              IP</span><br><span class="line">snuhv0g2dm1q  czisrjrp8k2t  9e4ce349971c  kp2zerd28xgz  whoami.1   manager1  Running        Running-about-an-hour-ago  10.0.0.35/24</span><br><span class="line">snuhv0g2dm1q  tvbkwmnafedw  0d586021260d  kp2zerd28xgz  whoami.2   manager1  Running        Running-about-an-hour-ago  10.0.0.36/24</span><br><span class="line">snuhv0g2dm1q  815qp859a1f4  449d5e1a231d  kp2zerd28xgz  whoami.3   manager1  Running        Running-about-an-hour-ago  10.0.0.15/24</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker Swarm çš„ æœåŠ¡ç®¡ç†&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/engine/swarm/&quot;&gt;Docker Swarm å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker Swarm ä¹‹ èŠ‚ç‚¹(Node)</title>
    <link href="https://blog.hanqunfeng.com/2025/06/09/docker-swarm-node/"/>
    <id>https://blog.hanqunfeng.com/2025/06/09/docker-swarm-node/</id>
    <published>2025-06-09T13:30:05.000Z</published>
    <updated>2025-06-10T06:00:11.021Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker Swarm çš„ èŠ‚ç‚¹ç®¡ç†</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/engine/swarm/">Docker Swarm å®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="Docker-Swarm-ç®€ä»‹">Docker Swarm ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Docker Swarm æ˜¯ Docker å®˜æ–¹æä¾›çš„ä¸€ä¸ªé›†ç¾¤ç®¡ç†å·¥å…·ï¼ŒåŸºäº Docker Swarm å¯ä»¥å¿«é€Ÿå®ç° Docker é›†ç¾¤çš„ç®¡ç†ã€‚</p></li><li class="lvl-2"><p>ä» Docker v1.12 ç‰ˆæœ¬å¼€å§‹ï¼ŒDocker Swarm å·²ç»åŒ…å«åœ¨ Docker Engine ä¸­ï¼Œä¸éœ€è¦å•ç‹¬å®‰è£…ã€‚</p></li><li class="lvl-2"><p>Docker Swarm å…·æœ‰æœåŠ¡ç¼–æ’ã€æœåŠ¡è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‡çº§å’ŒæœåŠ¡å¤±è´¥è¿ç§»ç­‰åŠŸèƒ½ã€‚</p></li><li class="lvl-2"><p>Docker Swarm é›†ç¾¤ä¸­çš„èŠ‚ç‚¹åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šç®¡ç†èŠ‚ç‚¹(Manager Node)å’Œå·¥ä½œèŠ‚ç‚¹(Worker Node)ï¼Œç®¡ç†èŠ‚ç‚¹è´Ÿè´£é›†ç¾¤çš„ç®¡ç†ï¼Œå·¥ä½œèŠ‚ç‚¹è´Ÿè´£è¿è¡Œå®¹å™¨ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/KwTed9.png" alt=""></p></li><li class="lvl-2"><p>ä»¥ä¸‹æ˜¯ Docker Swarm ä¸­ ç®¡ç†èŠ‚ç‚¹ï¼ˆManager Nodeï¼‰ å’Œ å·¥ä½œèŠ‚ç‚¹ï¼ˆWorker Nodeï¼‰ çš„å¯¹æ¯”</p></li></ul><table><thead><tr><th>ç‰¹æ€§/åŠŸèƒ½</th><th>ç®¡ç†èŠ‚ç‚¹ï¼ˆManager Nodeï¼‰</th><th>å·¥ä½œèŠ‚ç‚¹ï¼ˆWorker Nodeï¼‰</th></tr></thead><tbody><tr><td>è§’è‰²</td><td>è´Ÿè´£é›†ç¾¤ç®¡ç†å’Œå†³ç­–</td><td>æ‰§è¡Œåˆ†é…çš„æœåŠ¡ä»»åŠ¡</td></tr><tr><td>æ˜¯å¦å‚ä¸æœåŠ¡è¿è¡Œ</td><td>å¯ä»¥è¿è¡ŒæœåŠ¡ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥åªåšç®¡ç†ï¼ˆå¯é…ç½®ï¼‰</td><td>ä»…è¿è¡ŒæœåŠ¡ä»»åŠ¡ï¼Œä¸å‚ä¸ç®¡ç†å†³ç­–</td></tr><tr><td>é›†ç¾¤çŠ¶æ€ç»´æŠ¤</td><td>ç»´æŠ¤æ•´ä¸ª Swarm çš„çŠ¶æ€ï¼ˆä½¿ç”¨ Raft åè®®ï¼‰</td><td>ä¸ç»´æŠ¤é›†ç¾¤çŠ¶æ€</td></tr><tr><td>è°ƒåº¦ä»»åŠ¡</td><td>å†³å®šå°†æœåŠ¡ä»»åŠ¡åˆ†é…ç»™å“ªä¸ªèŠ‚ç‚¹</td><td>ä¸è´Ÿè´£è°ƒåº¦ï¼Œåªæ‰§è¡Œæ¥æ”¶åˆ°çš„ä»»åŠ¡</td></tr><tr><td>ç®¡ç†å‘½ä»¤å¤„ç†</td><td>æ¥æ”¶å¹¶å¤„ç† Swarm ç®¡ç†å‘½ä»¤ï¼ˆå¦‚åˆ›å»ºæœåŠ¡ã€æ‰©ç¼©å®¹ç­‰ï¼‰</td><td>ä¸å¤„ç†ç®¡ç†å‘½ä»¤</td></tr><tr><td>æ•°æ®ä¸€è‡´æ€§</td><td>éœ€è¦ä¿æŒä¸€è‡´æ€§ï¼ˆè‡³å°‘ 3 ä¸ªç®¡ç†èŠ‚ç‚¹å½¢æˆé«˜å¯ç”¨ï¼‰</td><td>ä¸æ¶‰åŠä¸€è‡´æ€§</td></tr><tr><td>èµ„æºè¦æ±‚</td><td>ç›¸å¯¹è¾ƒé«˜ï¼Œéœ€è¦æ‰¿æ‹…ç®¡ç†å’Œåè°ƒå¼€é”€</td><td>ç›¸å¯¹è¾ƒä½ï¼Œä¸“æ³¨äºè¿è¡Œå®¹å™¨</td></tr><tr><td>å¯ç”¨æ€§è¦æ±‚</td><td>é€šå¸¸é…ç½®å¥‡æ•°ä¸ªï¼ˆ3ã€5ã€7â€¦ï¼‰ä»¥ä¿éšœé«˜å¯ç”¨</td><td>å¯æ ¹æ®éœ€è¦è‡ªç”±æ‰©å±•æˆ–ç¼©å‡</td></tr><tr><td>èŠ‚ç‚¹åŠ å…¥æ–¹å¼</td><td>é€šè¿‡ manager token åŠ å…¥ Swarm</td><td>é€šè¿‡ worker token åŠ å…¥ Swarm</td></tr><tr><td>æ•…éšœå½±å“</td><td>å¤šä¸ªç®¡ç†èŠ‚ç‚¹æ•…éšœå¯èƒ½å½±å“æ•´ä¸ª Swarm çš„æ§åˆ¶èƒ½åŠ›</td><td>éƒ¨åˆ†å·¥ä½œèŠ‚ç‚¹æ•…éšœé€šå¸¸ä¸ä¼šå½±å“ Swarm çš„ç®¡ç†èƒ½åŠ›</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>manager èŠ‚ç‚¹é€šå¸¸é…ç½®ä¸ºå¥‡æ•°ä¸ªï¼Œé»˜è®¤åˆ›å»ºé›†ç¾¤çš„èŠ‚ç‚¹å°±æ˜¯ manager èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ˜¯ manager èŠ‚ç‚¹ä¸­çš„çš„ Leader èŠ‚ç‚¹ã€‚Leader èŠ‚ç‚¹è´Ÿè´£ç®¡ç†é›†ç¾¤ï¼ŒLeader èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­åªèƒ½æœ‰ä¸€ä¸ªã€‚å½“ Leader èŠ‚ç‚¹æ•…éšœæ—¶ï¼ŒSwarm ä¼šè‡ªåŠ¨ä»å…¶å®ƒ manager èŠ‚ç‚¹ä¸­é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„ Leader èŠ‚ç‚¹ã€‚</p></li><li class="lvl-2"><p>worker èŠ‚ç‚¹æ˜¯è¿è¡Œå®¹å™¨çš„èŠ‚ç‚¹ï¼Œä¸å‚ä¸æœºå™¨çš„ç®¡ç†å’Œè°ƒåº¦ï¼Œä¸æ”¯æŒæ‰§è¡Œä»»ä½•å’Œé›†ç¾¤ç®¡ç†ç›¸å…³çš„æ“ä½œã€‚</p></li><li class="lvl-2"><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œmanager èŠ‚ç‚¹ä¹Ÿä¼šå‚ä¸æ¥æ”¶è¿è¡Œå®¹å™¨çš„ä»»åŠ¡ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è®¾ç½®æ¥æŒ‡å®š manager èŠ‚ç‚¹ä¸å‚ä¸æ¥æ”¶ä»»åŠ¡ã€‚</p></li><li class="lvl-2"><p>manager èŠ‚ç‚¹å’Œ worker èŠ‚ç‚¹å¯ä»¥é€šè¿‡â€œå‡çº§â€å’Œâ€œé™çº§â€ç›¸äº’è½¬æ¢ã€‚</p></li></ul><h2 id="æ­å»ºSwarmé›†ç¾¤">æ­å»ºSwarmé›†ç¾¤</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ•™ç¨‹éœ€è¦äº”å°å®‰è£…äº†Dockerä¸”èƒ½å¤Ÿé€šè¿‡ç½‘ç»œé€šä¿¡çš„ Linux ä¸»æœºï¼Œè¿™äº›ä¸»æœºå¯ä»¥æ˜¯ç‰©ç†æœºã€è™šæ‹Ÿæœºã€Amazon EC2 å®ä¾‹ï¼Œä¹Ÿå¯ä»¥ä»¥å…¶ä»–æ–¹å¼æ‰˜ç®¡ã€‚</p></li><li class="lvl-2"><p>å…¶ä¸­ä¸‰å°æœºå™¨æ˜¯ç®¡ç†èŠ‚ç‚¹ï¼ˆç§°ä¸ºmanager1,manager2,manager3ï¼‰ï¼Œå¦å¤–ä¸¤å°æ˜¯å·¥ä½œèŠ‚ç‚¹ï¼ˆworker1å’Œworker2ï¼‰ã€‚</p></li></ul><table><thead><tr><th>IP åœ°å€</th><th>HostName</th><th>è§’è‰²ç±»å‹</th></tr></thead><tbody><tr><td>10.211.55.10</td><td>manager1</td><td>ç®¡ç†èŠ‚ç‚¹</td></tr><tr><td>10.211.55.11</td><td>manager2</td><td>ç®¡ç†èŠ‚ç‚¹</td></tr><tr><td>10.211.55.12</td><td>manager3</td><td>ç®¡ç†èŠ‚ç‚¹</td></tr><tr><td>10.211.55.13</td><td>worker1</td><td>å·¥ä½œèŠ‚ç‚¹</td></tr><tr><td>10.211.55.14</td><td>worker2</td><td>å·¥ä½œèŠ‚ç‚¹</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ‰€æœ‰ä¸»æœºä¸Šå¿…é¡»å¼€å¯å¦‚ä¸‹ç«¯å£ï¼Œä»¥ç¡®ä¿Docker Swarm é›†ç¾¤æ­£å¸¸é€šä¿¡ï¼š</p></li></ul><table><thead><tr><th>ç«¯å£å·</th><th>åè®®</th><th>ç”¨é€”è¯´æ˜</th></tr></thead><tbody><tr><td>2377</td><td>TCP</td><td>ç®¡ç†å™¨èŠ‚ç‚¹ä¹‹é—´é€šä¿¡ï¼ˆç®¡ç†æŒ‡ä»¤å’ŒåŠ å…¥é›†ç¾¤ï¼‰</td></tr><tr><td>7946</td><td>TCP/UDP</td><td>èŠ‚ç‚¹å‘ç°å’Œé€šä¿¡ï¼ˆé›†ç¾¤å†…éƒ¨å‘ç°æœºåˆ¶ï¼‰</td></tr><tr><td>4789</td><td>UDP</td><td>è¦†ç›–ç½‘ç»œæµé‡ï¼ˆVXLANï¼Œç”¨äºå®¹å™¨é—´ç½‘ç»œï¼‰</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€æ”¾ Swarm ç®¡ç†èŠ‚ç‚¹é€šä¿¡ç«¯å£</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=2377/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹å‘ç°ï¼ˆcluster communicationï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=7946/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=7946/udp</span><br><span class="line"></span><br><span class="line"><span class="comment"># overlay ç½‘ç»œæµé‡ï¼ˆå®¹å™¨é—´é€šä¿¡ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=4789/udp</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨æ›´æ”¹</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --list-all</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰€æœ‰ä¸»æœºå¿…é¡»æ—¶é—´ä¸€è‡´</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒæ­¥ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart chronyd</span><br><span class="line">chronyc tracking</span><br><span class="line"><span class="comment"># åŒæ­¥åç³»ç»Ÿæ—¶é—´æ˜¾ç¤ºä¸º UTCï¼Œè€Œä¸æ˜¯ä¸­å›½æ—¶åŒºï¼ˆCST/Asia/Shanghaiï¼‰</span></span><br><span class="line"><span class="comment"># è®¾ç½®æ—¶åŒºä¸ºä¸­å›½ä¸Šæµ·æ—¶é—´ï¼ˆCSTï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> timedatectl set-timezone Asia/Shanghai</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¶é—´å’Œæ—¶åŒº</span></span><br><span class="line">timedatectl</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºé›†ç¾¤">åˆ›å»ºé›†ç¾¤</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ manager1 èŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„swarmé›†ç¾¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰dockerçš„swarmæ¨¡å¼æ˜¯å¦å¼€å¯</span></span><br><span class="line">docker info | grep <span class="string">&quot;Swarm&quot;</span></span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œ inactive è¡¨ç¤ºæ²¡æœ‰å¼€å¯swarmé›†ç¾¤</span></span><br><span class="line"> Swarm: inactive</span><br><span class="line"></span><br><span class="line"><span class="comment"># é›†ç¾¤åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"># docker swarm init --advertise-addr &lt;MANAGER-IP&gt;</span></span><br><span class="line">docker swarm init --advertise-addr 10.211.55.10</span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># --advertise-addrï¼šæŒ‡å®šå½“å‰èŠ‚ç‚¹çš„IPåœ°å€ï¼Œç”¨äºé›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹å‘ç°å½“å‰èŠ‚ç‚¹ï¼Œç«¯å£é»˜è®¤2377</span></span><br><span class="line"><span class="comment"># è¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œå¦‚æœèŠ‚ç‚¹ä¸Šå­˜åœ¨å¤šä¸ªç½‘å¡ï¼Œåˆ™éœ€è¦æŒ‡å®šå½“å‰èŠ‚ç‚¹çš„IPåœ°å€</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="comment"># swarm åˆå§‹åŒ–æˆåŠŸï¼Œå½“å‰èŠ‚ç‚¹æˆä¸º manager nodeï¼Œå¹¶è‡ªåŠ¨æˆä¸ºé›†ç¾¤çš„leader</span></span><br><span class="line">Swarm initialized: current node (kp2zerd28xgz5mmglnje0jp22) is now a manager.</span><br><span class="line"><span class="comment"># å°†ä¸€ä¸ªworker nodeåŠ å…¥é›†ç¾¤è¯·è¿è¡Œä¸‹é¢çš„å‘½ä»¤</span></span><br><span class="line">To add a worker to this swarm, run the following <span class="built_in">command</span>:</span><br><span class="line">    <span class="comment"># è¿™ä¸ªtokenä¸éœ€è¦è®°ä½ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ `docker swarm join-token worker` è·å–</span></span><br><span class="line">    docker swarm <span class="built_in">join</span> --token SWMTKN-1-256y3fmlkr5u76a5lor7jsboox2eztl954djhnuoj4p2x7dem4-0izbgc1xv73qulz31szmxnk3y 10.211.55.10:2377</span><br><span class="line"><span class="comment"># æ·»åŠ ä¸€ä¸ªmanager nodeéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è·å– manager token</span></span><br><span class="line">To add a manager to this swarm, run <span class="string">&#x27;docker swarm join-token manager&#x27;</span> and follow the instructions.</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹å½“å‰dockerçš„swarmæ¨¡å¼æ˜¯å¦å¼€å¯</span></span><br><span class="line">docker info | grep Swarm</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"> Swarm: active</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‹¥è¦æŸ¥çœ‹æ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯ï¼Œå¯ä»¥ç›´æ¥æŸ¥çœ‹ Swarm ä¸­çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ä¸»è¦ä¿¡æ¯ï¼Œæ­¤æ—¶é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ˜¯managerèŠ‚ç‚¹</span></span><br><span class="line">docker info --format <span class="string">&#x27;&#123;&#123;json .Swarm&#125;&#125;&#x27;</span> | jq <span class="string">&#x27;&#123;LocalNodeState,NodeID,NodeAddr,RemoteManagers,Nodes,Nodes,Managers,ControlAvailable&#125;&#x27;</span> | yq -P</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">LocalNodeState: active         <span class="comment"># èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line">NodeID: kp2zerd28xgz5mmglnje0jp22 <span class="comment"># èŠ‚ç‚¹ID</span></span><br><span class="line">NodeAddr: 10.211.55.10           <span class="comment"># èŠ‚ç‚¹IP</span></span><br><span class="line">RemoteManagers: [                <span class="comment"># èŠ‚ç‚¹ç®¡ç†èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">  - NodeID: kp2zerd28xgz5mmglnje0jp22 <span class="comment"># èŠ‚ç‚¹ç®¡ç†èŠ‚ç‚¹ID</span></span><br><span class="line">    Addr: 10.211.55.10:2377       <span class="comment"># èŠ‚ç‚¹ç®¡ç†èŠ‚ç‚¹åœ°å€</span></span><br><span class="line">Nodes: 1                          <span class="comment"># èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">Managers: 1                       <span class="comment"># ç®¡ç†èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">ControlAvailable: <span class="literal">true</span>            <span class="comment"># æ˜¯å¦æœ‰æ§åˆ¶èŠ‚ç‚¹</span></span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å®‰è£… yq å·¥å…·</strong></em></p><ul class="lvl-1"><li class="lvl-2">yq æ˜¯ yaml çš„å‘½ä»¤è¡Œå¤„ç†å·¥å…·ï¼Œå…·ä½“å‚è€ƒ<a href="https://github.com/mikefarah/yq">yq</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ yq æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line">VERSION=v4.45.4</span><br><span class="line">ARCH=amd64</span><br><span class="line">wget https://github.com/mikefarah/yq/releases/download/<span class="variable">$&#123;VERSION&#125;</span>/yq_linux_<span class="variable">$&#123;ARCH&#125;</span> -O /usr/local/bin/yq</span><br><span class="line"><span class="comment"># æ·»åŠ æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/yq</span><br><span class="line"><span class="comment"># éªŒè¯å®‰è£…</span></span><br><span class="line">yq --version</span><br></pre></td></tr></table></figure></div><h3 id="æ·»åŠ -manager-èŠ‚ç‚¹">æ·»åŠ  manager èŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>è·å– manager èŠ‚ç‚¹çš„ token</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ manager1 ä¸Šè¿è¡Œ</span></span><br><span class="line">docker swarm join-token manager</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">To add a manager to this swarm, run the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    docker swarm <span class="built_in">join</span> --token SWMTKN-1-256y3fmlkr5u76a5lor7jsboox2eztl954djhnuoj4p2x7dem4-byc8ygc6hdoyzna0in1btp9yu 10.211.55.10:2377</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°† manager2 å’Œ manager3 åŠ å…¥ swarm é›†ç¾¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†åˆ«åœ¨ manager2 å’Œ manager3 ä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œ</span></span><br><span class="line">docker swarm <span class="built_in">join</span> \</span><br><span class="line">--token SWMTKN-1-256y3fmlkr5u76a5lor7jsboox2eztl954djhnuoj4p2x7dem4-byc8ygc6hdoyzna0in1btp9yu \</span><br><span class="line">10.211.55.10:2377</span><br><span class="line"><span class="comment">## å¦‚æœæœºå™¨ä¸Šæœ‰å¤šå—ç½‘å¡ä¹Ÿéœ€è¦æŒ‡å®šip: å¦‚ --advertise-addr 10.211.55.11</span></span><br><span class="line"><span class="comment">## è¿è¡Œç»“æœ</span></span><br><span class="line">This node joined a swarm as a manager.</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ -worker-èŠ‚ç‚¹">æ·»åŠ  worker èŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>è·å– worker èŠ‚ç‚¹çš„ token</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ manager1 ä¸Šè¿è¡Œ</span></span><br><span class="line">docker swarm join-token worker</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">To add a worker to this swarm, run the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    docker swarm <span class="built_in">join</span> --token SWMTKN-1-256y3fmlkr5u76a5lor7jsboox2eztl954djhnuoj4p2x7dem4-0izbgc1xv73qulz31szmxnk3y 10.211.55.10:2377</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°† worker1 å’Œ worker2 åŠ å…¥ swarm é›†ç¾¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†åˆ«åœ¨ worker1 å’Œ worker2 ä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œ</span></span><br><span class="line">docker swarm <span class="built_in">join</span> \</span><br><span class="line">--token SWMTKN-1-256y3fmlkr5u76a5lor7jsboox2eztl954djhnuoj4p2x7dem4-0izbgc1xv73qulz31szmxnk3y \</span><br><span class="line">10.211.55.10:2377</span><br><span class="line"><span class="comment">## å¦‚æœæœºå™¨ä¸Šæœ‰å¤šå—ç½‘å¡ä¹Ÿéœ€è¦æŒ‡å®šip: å¦‚ --advertise-addr 10.211.55.13</span></span><br><span class="line"><span class="comment">## è¿è¡Œç»“æœ</span></span><br><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹é›†ç¾¤çŠ¶æ€">æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ manager1 ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker info --format <span class="string">&#x27;&#123;&#123;json .Swarm&#125;&#125;&#x27;</span> | jq <span class="string">&#x27;&#123;LocalNodeState,NodeID,NodeAddr,RemoteManagers,Nodes,Nodes,Managers,ControlAvailable&#125;&#x27;</span> | yq -P</span><br><span class="line"><span class="comment">## ç»“æœ</span></span><br><span class="line">LocalNodeState: active</span><br><span class="line">NodeID: kp2zerd28xgz5mmglnje0jp22</span><br><span class="line">NodeAddr: 10.211.55.10</span><br><span class="line">RemoteManagers:</span><br><span class="line">  - NodeID: oymi74epagdqeprah7s81tsa2</span><br><span class="line">    Addr: 10.211.55.11:2377</span><br><span class="line">  - NodeID: r7388xl84nczjtnf53pwh7hla</span><br><span class="line">    Addr: 10.211.55.12:2377</span><br><span class="line">  - NodeID: kp2zerd28xgz5mmglnje0jp22</span><br><span class="line">    Addr: 10.211.55.10:2377</span><br><span class="line">Nodes: 5</span><br><span class="line">Managers: 3</span><br><span class="line">ControlAvailable: <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹é›†ç¾¤å†…èŠ‚ç‚¹ä¿¡æ¯">æŸ¥çœ‹é›†ç¾¤å†…èŠ‚ç‚¹ä¿¡æ¯</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ ä»»æ„ manager èŠ‚ç‚¹ä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ manager1 ä¸Šè¿è¡Œï¼Œåˆ—å‡ºæ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯ï¼Œåªæœ‰ manager èŠ‚ç‚¹æ”¯æŒ node ç›¸å…³å‘½ä»¤</span></span><br><span class="line">docker node <span class="built_in">ls</span></span><br><span class="line"><span class="comment">## è¿è¡Œç»“æœ</span></span><br><span class="line">ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">kp2zerd28xgz5mmglnje0jp22 *   manager1   Ready     Active         Leader           26.1.3</span><br><span class="line">oymi74epagdqeprah7s81tsa2     manager2   Ready     Active         Reachable        26.1.3</span><br><span class="line">r7388xl84nczjtnf53pwh7hla     manager3   Ready     Active         Reachable        26.1.3</span><br><span class="line">v31visfparkcsr9hswkb6v09u     worker1    Ready     Active                          26.1.3</span><br><span class="line">lsxj50x8ftqw8etvz5y37xc5q     worker2    Ready     Active                          26.1.3</span><br></pre></td></tr></table></figure><table><thead><tr><th>å­—æ®µå</th><th>ç¤ºä¾‹å€¼</th><th>ä¸­æ–‡å«ä¹‰</th></tr></thead><tbody><tr><td><strong>ID</strong></td><td><code>kp2zerd28xgz5mmglnje0jp22</code></td><td>èŠ‚ç‚¹çš„å”¯ä¸€ IDï¼ˆåœ¨ swarm é›†ç¾¤ä¸­è‡ªåŠ¨ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼‰</td></tr><tr><td><strong>HOSTNAME</strong></td><td><code>manager1</code></td><td>èŠ‚ç‚¹çš„ä¸»æœºåï¼ˆå³åŠ å…¥ swarm é›†ç¾¤æ—¶è¯¥èŠ‚ç‚¹çš„ <code>hostname</code>ï¼‰</td></tr><tr><td><strong>STATUS</strong></td><td><code>Ready</code></td><td>èŠ‚ç‚¹çš„çŠ¶æ€ï¼š<br>â€¢ <code>Ready</code>ï¼šèŠ‚ç‚¹æ­£å¸¸è¿è¡Œä¸­<br>â€¢ <code>Down</code>ï¼šèŠ‚ç‚¹ç¦»çº¿æˆ–æ— æ³•é€šä¿¡<br>â€¢ <code>Paused</code>ï¼šæš‚åœ<br>â€¢ <code>Drain</code>ï¼šæ’ç©ºï¼Œæ­£åœ¨è¿ç§»ä»»åŠ¡</td></tr><tr><td><strong>AVAILABILITY</strong></td><td><code>Active</code></td><td>èŠ‚ç‚¹çš„å¯ç”¨æ€§è®¾ç½®ï¼š<br>â€¢ <code>Active</code>ï¼šèŠ‚ç‚¹å¯ä»¥è°ƒåº¦ä»»åŠ¡ï¼ˆé»˜è®¤ï¼‰<br>â€¢ <code>Pause</code>ï¼šæš‚åœè°ƒåº¦æ–°ä»»åŠ¡<br>â€¢ <code>Drain</code>ï¼šè¿ç§»ä»»åŠ¡å¹¶ä¸å†è°ƒåº¦</td></tr><tr><td><strong>MANAGER STATUS</strong></td><td><code>Leader</code> / <code>Reachable</code> / ç©º</td><td>ä»…é€‚ç”¨äºç®¡ç†èŠ‚ç‚¹ï¼š<br>â€¢ <code>Leader</code>ï¼šå½“å‰ swarm çš„ä¸»èŠ‚ç‚¹ï¼ˆè´Ÿè´£åè°ƒï¼‰<br>â€¢ <code>Reachable</code>ï¼šé›†ç¾¤ä¸­å¯é€šä¿¡çš„ç®¡ç†èŠ‚ç‚¹<br>â€¢ ç©ºï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ï¼ˆéç®¡ç†èŠ‚ç‚¹ï¼‰</td></tr><tr><td><strong>ENGINE VERSION</strong></td><td><code>26.1.3</code></td><td>Docker å¼•æ“çš„ç‰ˆæœ¬å·ï¼ˆå³è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ Docker ç‰ˆæœ¬ï¼‰</td></tr></tbody></table><h2 id="docker-swarmé›†ç¾¤ç®¡ç†"><code>docker swarm</code>é›†ç¾¤ç®¡ç†</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä¸­æ–‡å«ä¹‰</th></tr></thead><tbody><tr><td><code>ca</code></td><td>æ˜¾ç¤ºå’Œè½®æ¢ Swarm çš„æ ¹è¯ä¹¦ï¼ˆCAï¼‰</td></tr><tr><td><code>init</code></td><td>åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Swarm é›†ç¾¤</td></tr><tr><td><code>join</code></td><td>å°†å½“å‰èŠ‚ç‚¹åŠ å…¥åˆ° Swarm ä¸­ï¼Œä½œä¸ºå·¥ä½œèŠ‚ç‚¹æˆ–ç®¡ç†èŠ‚ç‚¹</td></tr><tr><td><code>join-token</code></td><td>ç®¡ç†ç”¨äºåŠ å…¥ Swarm çš„ä»¤ç‰Œï¼ˆæŸ¥çœ‹æˆ–é‡æ–°ç”Ÿæˆï¼‰</td></tr><tr><td><code>leave</code></td><td>å½“å‰èŠ‚ç‚¹ç¦»å¼€ Swarm é›†ç¾¤</td></tr><tr><td><code>unlock</code></td><td>è§£é”è¢«åŠ å¯†çš„ Swarmï¼ˆç”¨äºæ¢å¤ Manager èŠ‚ç‚¹ï¼‰</td></tr><tr><td><code>unlock-key</code></td><td>ç®¡ç† Swarm çš„è§£é”å¯†é’¥ï¼ˆæŸ¥çœ‹ã€å¤‡ä»½ç­‰ï¼‰</td></tr><tr><td><code>update</code></td><td>æ›´æ–° Swarm é›†ç¾¤çš„å…¨å±€é…ç½®ï¼ˆå¦‚åŠ å¯†ã€æ—¥å¿—ç­‰ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p><code>docker swarm init</code>: åˆå§‹åŒ– Swarm é›†ç¾¤ï¼ˆåªåœ¨é¦–æ¬¡åˆ›å»ºæ—¶ä½¿ç”¨ï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init --advertise-addr 10.211.55.10</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker swarm join-token</code>:  ç”ŸæˆåŠ å…¥é›†ç¾¤çš„ä»¤ç‰Œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆ worker èŠ‚ç‚¹çš„ä»¤ç‰Œ</span></span><br><span class="line">docker swarm join-token worker</span><br><span class="line"><span class="comment"># ç”Ÿæˆ manager èŠ‚ç‚¹çš„ä»¤ç‰Œ</span></span><br><span class="line">docker swarm join-token manager</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker swarm join</code>: åŠ å…¥ Swarm é›†ç¾¤ï¼ˆåœ¨å·²æœ‰ Swarm é›†ç¾¤ä¸­åŠ å…¥èŠ‚ç‚¹æ—¶ä½¿ç”¨ï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm <span class="built_in">join</span> --token &lt;token&gt; 10.211.55.10:2377</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker swarm leave</code>: ä½¿å½“å‰èŠ‚ç‚¹ç¦»å¼€ Swarm é›†ç¾¤ï¼ˆä» Swarm é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹æ—¶ä½¿ç”¨ï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># worker èŠ‚ç‚¹ç¦»å¼€é›†ç¾¤</span></span><br><span class="line">docker swarm leave</span><br><span class="line"><span class="comment"># manager èŠ‚ç‚¹å¿…é¡»å…ˆé™çº§ä¸º workerèŠ‚ç‚¹ï¼Œæˆ–è€…åŠ ä¸Š --force å¼ºåˆ¶ç¦»å¼€</span></span><br><span class="line">docker swarm leave --force</span><br><span class="line"><span class="comment"># å¦‚æœLeaderèŠ‚ç‚¹ç¦»å¼€é›†ç¾¤ï¼Œé‚£ä¹ˆé›†ç¾¤ä¸­çš„å…¶å®ƒManagerèŠ‚ç‚¹ï¼Œä¼šé‡æ–°é€‰ä¸¾ä¸€ä¸ªæ–°çš„LeaderèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"># é›†ç¾¤ä¸­è‡³å°‘éœ€è¦ä¸€ä¸ªManagerèŠ‚ç‚¹ï¼Œå¦åˆ™æ— æ³•è¿è¡ŒæœåŠ¡</span></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹ç¦»å¼€swarmé›†ç¾¤åï¼Œåœ¨ docker node lsä¸­ä»ç„¶å¯ä»¥çœ‹åˆ°ï¼Œæ¯”å¦‚å°† worker2 èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤ï¼Œå…¶çŠ¶æ€å˜ä¸º down</span></span><br><span class="line">docker node <span class="built_in">ls</span></span><br><span class="line">ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">kp2zerd28xgz5mmglnje0jp22 *   manager1   Ready     Active         Leader           26.1.3</span><br><span class="line">oymi74epagdqeprah7s81tsa2     manager2   Ready     Active         Reachable        26.1.3</span><br><span class="line">r7388xl84nczjtnf53pwh7hla     manager3   Ready     Active         Reachable        26.1.3</span><br><span class="line">v31visfparkcsr9hswkb6v09u     worker1    Ready     Active                          26.1.3</span><br><span class="line">lsxj50x8ftqw8etvz5y37xc5q     worker2    Down      Active                          26.1.3</span><br><span class="line"><span class="comment"># å¦‚éœ€å½»åº•åˆ é™¤éœ€è¦è¿è¡Œ</span></span><br><span class="line">docker node <span class="built_in">rm</span> worker2</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker swarm update</code>: æ›´æ–° Swarm é›†ç¾¤é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯Swarmé›†ç¾¤é”å®šï¼Œåªé’ˆå¯¹managerèŠ‚ç‚¹ï¼ŒmanagerèŠ‚ç‚¹é‡å¯åéœ€è¦è§£é”æ‰èƒ½æ¢å¤ï¼Œä¸‹é¢çš„å¯†é’¥ä¸éœ€è¦è®°ä½ï¼Œé€šè¿‡`docker swarm unlock-key`å‘½ä»¤æŸ¥çœ‹</span></span><br><span class="line">docker swarm update --autolock=<span class="literal">true</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Swarm updated.</span><br><span class="line">To unlock a swarm manager after it restarts, run the `docker swarm unlock`</span><br><span class="line"><span class="built_in">command</span> and provide the following key:</span><br><span class="line"></span><br><span class="line">    SWMKEY-1-X74/FGf+SkUkJEWtYok6ZFgCDAdwt3CQpOvLPT5lra4</span><br><span class="line"></span><br><span class="line">Please remember to store this key <span class="keyword">in</span> a password manager, since without it you</span><br><span class="line">will not be able to restart the manager.</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­Swarmé›†ç¾¤é”å®š</span></span><br><span class="line">docker swarm update --autolock=<span class="literal">false</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker swarm unlock-key</code>: è·å–Swarmé›†ç¾¤çš„è§£é”å¯†é’¥ï¼Œè¯¥å‘½ä»¤å¯ä»¥åˆ¤æ–­Swarmé›†ç¾¤æ˜¯å¦è¢«é”å®š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–Swarmé›†ç¾¤çš„è§£é”å¯†é’¥</span></span><br><span class="line">docker swarm unlock-key</span><br><span class="line"><span class="comment"># è½®æ¢Swarmé›†ç¾¤çš„è§£é”å¯†é’¥</span></span><br><span class="line">docker swarm unlock-key --rotate</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker swarm unlock</code>: æ‰‹åŠ¨è§£é”å½“å‰ manager èŠ‚ç‚¹ï¼Œä½¿å…¶åœ¨å¯ç”¨ autolock æ—¶æ¢å¤åŠŸèƒ½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœSwarmé›†ç¾¤è®¾ç½®ä¸ºé”å®šï¼Œåˆ™é‡å¯manager2ä¸Šçš„dockeræœåŠ¡åå°†æ— æ³•è¿è¡Œnodeç®¡ç†å‘½ä»¤</span></span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨</span></span><br><span class="line">docker node <span class="built_in">ls</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Error response from daemon: Swarm is encrypted and needs to be unlocked before it can be used. Please use <span class="string">&quot;docker swarm unlock&quot;</span> to unlock it.</span><br><span class="line"><span class="comment"># éœ€è¦å…ˆè§£é”æ‰å¯ä»¥è¿è¡ŒèŠ‚ç‚¹ç®¡ç†å‘½ä»¤</span></span><br><span class="line">docker swarm unlock</span><br><span class="line"><span class="comment">## ä¼šæç¤ºè¾“å…¥è§£é”å¯†é’¥ï¼Œè§£é”åå°±æ¢å¤æ­£å¸¸äº†</span></span><br><span class="line">Please enter unlock key:</span><br></pre></td></tr></table></figure><h2 id="docker-nodeèŠ‚ç‚¹ç®¡ç†"><code>docker node</code>èŠ‚ç‚¹ç®¡ç†</h2><ul class="lvl-0"><li class="lvl-2"><p>èŠ‚ç‚¹ç®¡ç†ç›¸å…³å‘½ä»¤ï¼Œåªèƒ½åœ¨ ç®¡ç†èŠ‚ç‚¹ ä¸Šæ‰§è¡Œ</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>ä¸­æ–‡å«ä¹‰</th></tr></thead><tbody><tr><td><code>demote</code></td><td>å°†ä¸€ä¸ªæˆ–å¤šä¸ªç®¡ç†èŠ‚ç‚¹é™çº§ä¸ºå·¥ä½œèŠ‚ç‚¹</td></tr><tr><td><code>inspect</code></td><td>æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯</td></tr><tr><td><code>ls</code></td><td>åˆ—å‡º swarm é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹</td></tr><tr><td><code>promote</code></td><td>å°†ä¸€ä¸ªæˆ–å¤šä¸ªå·¥ä½œèŠ‚ç‚¹æå‡ä¸ºç®¡ç†èŠ‚ç‚¹</td></tr><tr><td><code>ps</code></td><td>æŸ¥çœ‹ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ä¸Šæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼ˆé»˜è®¤å½“å‰èŠ‚ç‚¹ï¼‰</td></tr><tr><td><code>rm</code></td><td>ä» swarm é›†ç¾¤ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹</td></tr><tr><td><code>update</code></td><td>æ›´æ–°èŠ‚ç‚¹çš„å…ƒæ•°æ®ï¼ˆå¦‚æ ‡ç­¾ã€å¯ç”¨æ€§ç­‰ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p><code>docker node ls</code>: åˆ—å‡º swarm é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker node <span class="built_in">ls</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker node inspect &lt;node_id&gt;/&lt;hostname&gt;</code>: æŸ¥çœ‹æŒ‡å®šèŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker node inspect --pretty manager1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker node update &lt;options&gt; &lt;node_id&gt;/&lt;hostname&gt;</code>: æ›´æ–°èŠ‚ç‚¹çš„å…ƒæ•°æ®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®èŠ‚ç‚¹ä¸ºä¸å¯ç”¨</span></span><br><span class="line">docker node update --availability drain manager1</span><br><span class="line"><span class="comment"># æ·»åŠ æ ‡ç­¾</span></span><br><span class="line">docker node update --label-add foo=bar manager1</span><br><span class="line"><span class="comment"># åˆ é™¤æ ‡ç­¾</span></span><br><span class="line">docker node update --label-rm foo manager1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker node demote &lt;node_id&gt;/&lt;hostname&gt;</code>: å°†ç®¡ç†èŠ‚ç‚¹é™çº§ä¸ºå·¥ä½œèŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker node demote manager1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker note promote &lt;node_id&gt;/&lt;hostname&gt;</code>: å°†å·¥ä½œèŠ‚ç‚¹å‡çº§ä¸ºç®¡ç†èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker node promote worker1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker node rm &lt;node_id&gt;/&lt;hostname&gt;</code>: ä» swarm é›†ç¾¤ä¸­ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker node <span class="built_in">rm</span> manager1</span><br></pre></td></tr></table></figure><h2 id="èŠ‚ç‚¹ç®¡ç†å¸¸è§æƒ…å†µ">èŠ‚ç‚¹ç®¡ç†å¸¸è§æƒ…å†µ</h2><h3 id="å¦‚ä½•æ­£ç¡®çš„åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹">å¦‚ä½•æ­£ç¡®çš„åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹</h3><ul class="lvl-0"><li class="lvl-2"><p>1.å¦‚æœæ˜¯ manager èŠ‚ç‚¹ï¼Œå…ˆå°† manager èŠ‚ç‚¹é™çº§ä¸º worker èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker node demote manager1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>2.é€€å‡ºé›†ç¾¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨è¦é€€å‡ºé›†ç¾¤çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</span></span><br><span class="line">docker swarm leave</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>3.åˆ é™¤èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker node <span class="built_in">rm</span> manager1</span><br></pre></td></tr></table></figure><h3 id="èŠ‚ç‚¹è¢«é€€ç¾¤æˆ–åˆ é™¤åï¼Œå…¶ä¸Šè¿è¡Œçš„serviceä¼šæ€æ ·ï¼Ÿ">èŠ‚ç‚¹è¢«é€€ç¾¤æˆ–åˆ é™¤åï¼Œå…¶ä¸Šè¿è¡Œçš„serviceä¼šæ€æ ·ï¼Ÿ</h3><ul class="lvl-0"><li class="lvl-2"><p>ç”¨ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜ï¼Œå…ˆåœ¨ manager1 èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ª service</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --replicas 10 è¡¨ç¤ºå¯åŠ¨ 10 ä¸ª nginx å®¹å™¨ï¼Œswarmé›†ç¾¤æœ‰5ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥å¯åŠ¨10ä¸ªnginxå®¹å™¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šå¯åŠ¨2ä¸ªnginxå®¹å™¨</span></span><br><span class="line">docker service create \</span><br><span class="line">  --name my-nginx \</span><br><span class="line">  --publish 8080:80 \</span><br><span class="line">  --replicas 10 \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹serviceçŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker service ps my-nginx</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½å¯åŠ¨äº†2ä¸ªnginxå®¹å™¨</span></span><br><span class="line">ID             NAME          IMAGE          NODE       DESIRED STATE   CURRENT STATE                ERROR     PORTS</span><br><span class="line">fciheo523fb3   my-nginx.1    nginx:latest   manager2   Running         Running about a minute ago</span><br><span class="line">t9agioefr316   my-nginx.2    nginx:latest   manager2   Running         Running about a minute ago</span><br><span class="line">moitlj50nunh   my-nginx.3    nginx:latest   manager3   Running         Running 2 minutes ago</span><br><span class="line">x07voc2qth5q   my-nginx.4    nginx:latest   manager1   Running         Running about a minute ago</span><br><span class="line">p8khdhngz0xm   my-nginx.5    nginx:latest   manager3   Running         Running 2 minutes ago</span><br><span class="line">i6mieuodbrtg   my-nginx.6    nginx:latest   worker2    Running         Running about a minute ago</span><br><span class="line">2yohffzzsrrl   my-nginx.7    nginx:latest   worker1    Running         Running 2 minutes ago</span><br><span class="line">f3lusxoflqn2   my-nginx.8    nginx:latest   worker2    Running         Running about a minute ago</span><br><span class="line">xovzfmzsjlet   my-nginx.9    nginx:latest   worker1    Running         Running 2 minutes ago</span><br><span class="line">ndrz827kpu2k   my-nginx.10   nginx:latest   manager1   Running         Running about a minute ago</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™æ—¶å°† worker2 ä»é›†ç¾¤ä¸­é€€ç¾¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨worker2èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line">docker swarm leave</span><br><span class="line"><span class="comment"># åœ¨managerèŠ‚ç‚¹æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</span></span><br><span class="line">docker node <span class="built_in">ls</span></span><br><span class="line">ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">kp2zerd28xgz5mmglnje0jp22 *   manager1   Ready     Active         Leader           26.1.3</span><br><span class="line">oymi74epagdqeprah7s81tsa2     manager2   Ready     Active         Reachable        26.1.3</span><br><span class="line">r7388xl84nczjtnf53pwh7hla     manager3   Ready     Active         Reachable        26.1.3</span><br><span class="line">v31visfparkcsr9hswkb6v09u     worker1    Ready     Active                          26.1.3</span><br><span class="line">x87lfn4pzorahpr9zehv9ag3f     worker2    Down      Active                          26.1.3</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å†æ¬¡æŸ¥çœ‹serviceçŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker service ps my-nginx</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°worker2èŠ‚ç‚¹ä¸Šçš„å®¹å™¨å·²ç»è¢«å…³é—­ï¼Œæ–°çš„å®¹å™¨åœ¨å…¶å®ƒèŠ‚ç‚¹ä¸Šå¯åŠ¨äº†ï¼Œä¿è¯äº†serviceä¸­çš„å®¹å™¨æ•°é‡</span></span><br><span class="line">ID             NAME             IMAGE          NODE       DESIRED STATE   CURRENT STATE            ERROR     PORTS</span><br><span class="line">fciheo523fb3   my-nginx.1       nginx:latest   manager2   Running         Running 6 minutes ago</span><br><span class="line">t9agioefr316   my-nginx.2       nginx:latest   manager2   Running         Running 6 minutes ago</span><br><span class="line">moitlj50nunh   my-nginx.3       nginx:latest   manager3   Running         Running 6 minutes ago</span><br><span class="line">x07voc2qth5q   my-nginx.4       nginx:latest   manager1   Running         Running 6 minutes ago</span><br><span class="line">p8khdhngz0xm   my-nginx.5       nginx:latest   manager3   Running         Running 6 minutes ago</span><br><span class="line">uz7wam5ul4aa   my-nginx.6       nginx:latest   manager2   Running         Running 43 seconds ago</span><br><span class="line">i6mieuodbrtg    \_ my-nginx.6   nginx:latest   worker2    Shutdown        Running 6 minutes ago</span><br><span class="line">2yohffzzsrrl   my-nginx.7       nginx:latest   worker1    Running         Running 6 minutes ago</span><br><span class="line">34km8mzg3xat   my-nginx.8       nginx:latest   manager3   Running         Running 43 seconds ago</span><br><span class="line">f3lusxoflqn2    \_ my-nginx.8   nginx:latest   worker2    Shutdown        Running 6 minutes ago</span><br><span class="line">xovzfmzsjlet   my-nginx.9       nginx:latest   worker1    Running         Running 6 minutes ago</span><br><span class="line">ndrz827kpu2k   my-nginx.10      nginx:latest   manager1   Running         Running 6 minutes ago</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä¸é€€ç¾¤ç›´æ¥åˆ é™¤èŠ‚ç‚¹å‘¢ï¼Ÿè¿™æ¬¡æˆ‘ä»¬ç›´æ¥åˆ é™¤ worker1 èŠ‚ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤ worker1 èŠ‚ç‚¹</span></span><br><span class="line">docker node <span class="built_in">rm</span> worker1</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼Œæç¤º worker1 èŠ‚ç‚¹ä¸æ˜¯ down çŠ¶æ€ï¼Œä¸èƒ½åˆ é™¤</span></span><br><span class="line"><span class="comment"># Error response from daemon: rpc error: code = FailedPrecondition desc = node v31visfparkcsr9hswkb6v09u is not down and can&#x27;t be removed</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ç€æˆ‘ä»¬å¼ºåˆ¶åˆ é™¤</span></span><br><span class="line">docker node <span class="built_in">rm</span> -f worker1</span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨</span></span><br><span class="line">docker node <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°worker1èŠ‚ç‚¹å·²ç»åˆ é™¤äº†</span></span><br><span class="line">ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">kp2zerd28xgz5mmglnje0jp22 *   manager1   Ready     Active         Leader           26.1.3</span><br><span class="line">oymi74epagdqeprah7s81tsa2     manager2   Ready     Active         Reachable        26.1.3</span><br><span class="line">r7388xl84nczjtnf53pwh7hla     manager3   Ready     Active         Reachable        26.1.3</span><br><span class="line">x87lfn4pzorahpr9zehv9ag3f     worker2    Down      Active                          26.1.3</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹serviceçŠ¶æ€</span></span><br><span class="line">docker service ps my-nginx</span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°worker1(å› ä¸ºworker1èŠ‚ç‚¹å·²ç»è¢«åˆ é™¤ï¼Œæ‰€ä»¥è¿™é‡Œåªä¼šæ˜¾ç¤ºèŠ‚ç‚¹ID:v31visfparkcsr9hswkb6v09u)èŠ‚ç‚¹ä¸Šçš„å®¹å™¨å·²ç»è¢«å…³é—­ï¼Œæ–°çš„å®¹å™¨åœ¨å…¶å®ƒèŠ‚ç‚¹ä¸Šå¯åŠ¨äº†ï¼Œä¿è¯äº†serviceä¸­çš„å®¹å™¨æ•°é‡</span></span><br><span class="line">docker service ps my-nginx</span><br><span class="line">ID             NAME             IMAGE          NODE                        DESIRED STATE   CURRENT STATE                 ERROR     PORTS</span><br><span class="line">fciheo523fb3   my-nginx.1       nginx:latest   manager2                    Running         Running 12 minutes ago</span><br><span class="line">t9agioefr316   my-nginx.2       nginx:latest   manager2                    Running         Running 12 minutes ago</span><br><span class="line">moitlj50nunh   my-nginx.3       nginx:latest   manager3                    Running         Running 12 minutes ago</span><br><span class="line">x07voc2qth5q   my-nginx.4       nginx:latest   manager1                    Running         Running 12 minutes ago</span><br><span class="line">p8khdhngz0xm   my-nginx.5       nginx:latest   manager3                    Running         Running 12 minutes ago</span><br><span class="line">uz7wam5ul4aa   my-nginx.6       nginx:latest   manager2                    Running         Running 6 minutes ago</span><br><span class="line">i6mieuodbrtg    \_ my-nginx.6   nginx:latest   worker2                     Shutdown        Running 12 minutes ago</span><br><span class="line">3t4qvpvrzpg3   my-nginx.7       nginx:latest   manager1                    Running         Running about a minute ago</span><br><span class="line">2yohffzzsrrl    \_ my-nginx.7   nginx:latest   v31visfparkcsr9hswkb6v09u   Shutdown        Orphaned about a minute ago</span><br><span class="line">34km8mzg3xat   my-nginx.8       nginx:latest   manager3                    Running         Running 6 minutes ago</span><br><span class="line">f3lusxoflqn2    \_ my-nginx.8   nginx:latest   worker2                     Shutdown        Running 12 minutes ago</span><br><span class="line">4w5zfpfye3t8   my-nginx.9       nginx:latest   manager1                    Running         Running about a minute ago</span><br><span class="line">xovzfmzsjlet    \_ my-nginx.9   nginx:latest   v31visfparkcsr9hswkb6v09u   Shutdown        Orphaned about a minute ago</span><br><span class="line">ndrz827kpu2k   my-nginx.10      nginx:latest   manager1                    Running         Running 12 minutes ago</span><br></pre></td></tr></table></figure><h3 id="èŠ‚ç‚¹è¢«é€€ç¾¤æˆ–åˆ é™¤åæ˜¯å¦å¯ä»¥é‡æ–°åŠ å…¥é›†ç¾¤">èŠ‚ç‚¹è¢«é€€ç¾¤æˆ–åˆ é™¤åæ˜¯å¦å¯ä»¥é‡æ–°åŠ å…¥é›†ç¾¤</h3><ul class="lvl-0"><li class="lvl-2"><p>èŠ‚ç‚¹è¢«é€€ç¾¤æˆ–åˆ é™¤åï¼Œå¯ä»¥é€šè¿‡ <code>docker swarm join</code> å‘½ä»¤é‡æ–°åŠ å…¥é›†ç¾¤</p></li><li class="lvl-2"><p>è‹¥èŠ‚ç‚¹æ˜¯è¢«å¼ºåˆ¶åˆ é™¤ï¼Œè€Œæ²¡æœ‰é€€ç¾¤ï¼Œåˆ™é‡æ–°åŠ å…¥é›†ç¾¤æ—¶éœ€è¦å…ˆé€šè¿‡ <code>docker swarm leave</code> å‘½ä»¤é€€ç¾¤åå†åŠ å…¥é›†ç¾¤</p></li></ul><h3 id="å¦‚æœSwarmé›†ç¾¤è®¾ç½®ä¸ºé”å®šï¼Œåˆ™é‡å¯managerèŠ‚ç‚¹åæ— æ³•æä¾›é›†ç¾¤æœåŠ¡çš„è§£å†³æ–¹æ³•">å¦‚æœSwarmé›†ç¾¤è®¾ç½®ä¸ºé”å®šï¼Œåˆ™é‡å¯managerèŠ‚ç‚¹åæ— æ³•æä¾›é›†ç¾¤æœåŠ¡çš„è§£å†³æ–¹æ³•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œé‡å¯ä¸€ä¸ªmanagerèŠ‚ç‚¹çš„dockeræœåŠ¡</span></span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨</span></span><br><span class="line">docker node <span class="built_in">ls</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Error response from daemon: Swarm is encrypted and needs to be unlocked before it can be used. Please use <span class="string">&quot;docker swarm unlock&quot;</span> to unlock it.</span><br><span class="line"><span class="comment"># éœ€è¦å…ˆè§£é”æ‰å¯ä»¥è¿è¡ŒèŠ‚ç‚¹ç®¡ç†å‘½ä»¤</span></span><br><span class="line">docker swarm unlock</span><br><span class="line"><span class="comment">## ä¼šæç¤ºè¾“å…¥è§£é”å¯†é’¥ï¼Œè§£é”åå°±æ¢å¤æ­£å¸¸äº†</span></span><br><span class="line">Please enter unlock key:</span><br><span class="line"><span class="comment">## å¦‚æœå¿˜è®°äº†å¯†é’¥ï¼Œå¯ä»¥åœ¨å…¶å®ƒmanagerèŠ‚ç‚¹é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</span></span><br><span class="line">docker swarm unlock-key</span><br><span class="line"><span class="comment"># å¦‚æœæ‰€æœ‰managerèŠ‚ç‚¹éƒ½é‡å¯äº†ï¼Œä½ åˆæ²¡æœ‰è®°å½•è§£é”å¯†é’¥ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œåªèƒ½é‡æ–°åˆ›å»ºswarmé›†ç¾¤äº†</span></span><br></pre></td></tr></table></figure><h3 id="Swarm-é›†ç¾¤é”å®šåŠŸèƒ½çš„ä½œç”¨åŠä½¿ç”¨åœºæ™¯">Swarm é›†ç¾¤é”å®šåŠŸèƒ½çš„ä½œç”¨åŠä½¿ç”¨åœºæ™¯</h3><ul class="lvl-0"><li class="lvl-2"><p>ä½œç”¨</p></li></ul><table><thead><tr><th>âœ… ä½œç”¨</th><th>ğŸ“‹ è¯´æ˜</th></tr></thead><tbody><tr><td>åŠ å¯†ä¿æŠ¤ç®¡ç†å¯†é’¥</td><td>ç®¡ç†å™¨èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ï¼ˆå¦‚ Raft æ—¥å¿—ï¼‰è™½ç„¶é»˜è®¤åŠ å¯†ï¼Œä½†å¯†é’¥ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚å¯ç”¨é”å®šåŠŸèƒ½åï¼Œå¯†é’¥åœ¨èŠ‚ç‚¹é‡å¯æ—¶ä¸ä¼šè‡ªåŠ¨åŠ è½½ï¼Œå¿…é¡»æ‰‹åŠ¨æä¾›è§£é”å¯†é’¥æ‰èƒ½æ¢å¤ã€‚</td></tr><tr><td>é˜²æ­¢èŠ‚ç‚¹è¢«éæ³•é‡å¯ååŠ å…¥é›†ç¾¤</td><td>å¦‚æœæ”»å‡»è€…è·å¾—äº†ç®¡ç†èŠ‚ç‚¹çš„ç‰©ç†è®¿é—®æƒé™ï¼ˆå¦‚é‡å¯ã€ç£ç›˜å…‹éš†ç­‰ï¼‰ï¼Œé”å®šåŠŸèƒ½å¯ä»¥é˜²æ­¢å…¶è‡ªåŠ¨æ§åˆ¶æˆ–é‡æ–°åŠ å…¥ Swarm é›†ç¾¤ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åœºæ™¯</p></li></ul><table><thead><tr><th>åœºæ™¯ç±»å‹</th><th>å…·ä½“æè¿°</th></tr></thead><tbody><tr><td>âœ… é€‚åˆåœºæ™¯</td><td>å¯¹å®‰å…¨æ€§è¦æ±‚é«˜çš„ç”Ÿäº§ç¯å¢ƒ</td></tr><tr><td></td><td>éƒ¨ç½²åœ¨ä¸å¯ä¿¡æˆ–å…±äº«ç‰©ç†ç¯å¢ƒä¸­</td></tr><tr><td></td><td>äº‘æœåŠ¡å™¨ã€æ•°æ®ä¸­å¿ƒæœ‰ä¸“äººè¿ç»´ç®¡ç†è§£é”è¿‡ç¨‹</td></tr><tr><td></td><td>å¸Œæœ›é˜²æ­¢ç‰©ç†/è¿œç¨‹å…¥ä¾µè€…æ¢å¤ç®¡ç†å™¨è§’è‰²çš„å…¬å¸</td></tr><tr><td>âŒ ä¸é€‚åˆåœºæ™¯</td><td>éœ€è¦è‡ªåŠ¨åŒ–éƒ¨ç½²æˆ–é‡å¯çš„ CI/CD ç³»ç»Ÿ</td></tr><tr><td></td><td>æµ‹è¯•ç¯å¢ƒæˆ–å¼€å‘é›†ç¾¤</td></tr><tr><td></td><td>æ— äººå€¼å®ˆã€è¦æ±‚é«˜å¯ç”¨è‡ªåŠ¨æ¢å¤çš„éƒ¨ç½²ç³»ç»Ÿ</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ€»ç»“</p></li></ul><table><thead><tr><th>é¡¹ç›®</th><th>æ˜¯å¦æ¨è</th></tr></thead><tbody><tr><td>å®‰å…¨æ€§</td><td>âœ… å¼ºçƒˆæ¨èå¯ç”¨ï¼ˆå°¤å…¶åœ¨ç”Ÿäº§ç¯å¢ƒï¼‰</td></tr><tr><td>è‡ªåŠ¨åŒ–</td><td>âŒ ä¸æ¨èï¼ˆå¢åŠ äººå·¥å¹²é¢„æ­¥éª¤ï¼‰</td></tr><tr><td>è§£é”æ–¹å¼</td><td>è§£é”å‘½ä»¤ + unlock key</td></tr><tr><td>unlock key ä¸¢å¤±åæœ</td><td>å¯èƒ½éœ€è¦é‡å»º Swarmï¼ˆé™¤éæå‰å¤‡ä»½ï¼‰</td></tr></tbody></table><h3 id="docker-swarm-ca-æ˜¯åšä»€ä¹ˆç”¨çš„ï¼Ÿ"><code>docker swarm ca</code> æ˜¯åšä»€ä¹ˆç”¨çš„ï¼Ÿ</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker swarm ca</code> å‘½ä»¤æ˜¯ç”¨æ¥ <strong>ç®¡ç† Swarm é›†ç¾¤ä¸­çš„æ ¹è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰</strong> çš„å·¥å…·ã€‚å…·ä½“åŠŸèƒ½åŒ…æ‹¬ï¼š</p></li></ul><table><thead><tr><th>å­å‘½ä»¤/å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>docker swarm ca</code></td><td>æŸ¥çœ‹å½“å‰ Swarm çš„æ ¹ CA å…¬é’¥ï¼ˆPEM æ ¼å¼ï¼‰</td></tr><tr><td><code>docker swarm ca --rotate</code></td><td>è½®æ¢æ ¹ CAï¼Œç”¨äºå®‰å…¨æ›´æ–°</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Swarm ä¸­çš„è¯ä¹¦æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ</p></li></ul><table><thead><tr><th>ç”¨é€”</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>âœ… èŠ‚ç‚¹èº«ä»½éªŒè¯</td><td>æ¯ä¸ªèŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶ï¼Œéƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªç”±æ ¹ CA ç­¾å‘çš„ TLS è¯ä¹¦ï¼Œç”¨äºè¯æ˜å®ƒçš„èº«ä»½ã€‚</td></tr><tr><td>ğŸ” é€šä¿¡åŠ å¯†</td><td>èŠ‚ç‚¹ä¹‹é—´ï¼ˆManager â†” Workerï¼‰çš„é€šä¿¡é€šè¿‡ TLS è¿›è¡ŒåŠ å¯†ã€‚</td></tr><tr><td>ğŸ”„ è‡ªåŠ¨è½®æ¢</td><td>Docker ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªèŠ‚ç‚¹ç­¾å‘çŸ­æœŸè¯ä¹¦ï¼ˆé»˜è®¤æœ‰æ•ˆæœŸ 90 å¤©ï¼‰å¹¶å®šæœŸè‡ªåŠ¨è½®æ¢ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Swarm åœ¨åå°è‡ªåŠ¨ç®¡ç†è¯ä¹¦ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦æ‰‹åŠ¨å¤„ç†å®ƒä»¬ã€‚ä¸è¿‡ï¼Œä½ å¯ä»¥åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰¾åˆ°å®ƒä»¬çš„ä½ç½®ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/lib/docker/swarm/certificates</span><br><span class="line">tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ swarm-node.crt      <span class="comment"># èŠ‚ç‚¹è¯ä¹¦</span></span><br><span class="line">â”œâ”€â”€ swarm-node.key      <span class="comment"># èŠ‚ç‚¹å¯†é’¥</span></span><br><span class="line">â””â”€â”€ swarm-root-ca.crt   <span class="comment"># æ ¹CAè¯ä¹¦</span></span><br></pre></td></tr></table></figure><h3 id="åªè®©-Manager-åšç®¡ç†ï¼Œä¸è¿è¡ŒæœåŠ¡">åªè®© Manager åšç®¡ç†ï¼Œä¸è¿è¡ŒæœåŠ¡</h3><ul class="lvl-0"><li class="lvl-2"><p>èŠ‚ç‚¹çš„<code>AVAILABILITY</code>æœ‰ä¸‰ç§ï¼š<code>active</code>ã€<code>pause</code>ã€<code>drain</code>ã€‚</p></li></ul><table><thead><tr><th>çŠ¶æ€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>active</code></td><td>å¯è°ƒåº¦ï¼ŒSwarm å¯ä»¥åœ¨æ­¤èŠ‚ç‚¹ä¸Šè¿è¡ŒæœåŠ¡ä»»åŠ¡ï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td><code>pause</code></td><td>æš‚åœè°ƒåº¦ï¼Œä¸ä¼šåˆ†é…æ–°ä»»åŠ¡ï¼Œä½†ä¿ç•™å·²æœ‰ä»»åŠ¡</td></tr><tr><td><code>drain</code></td><td>æ’ç©ºæ¨¡å¼ï¼Œä¸å¯è°ƒåº¦ï¼ŒSwarm ä¼šå°†è¯¥èŠ‚ç‚¹ä¸Šçš„ä»»åŠ¡è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œæ–°çš„ä»»åŠ¡å°†ä¸ä¼šåˆ†é…åˆ°æ­¤èŠ‚ç‚¹</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä½ å¸Œæœ› Swarm Manager èŠ‚ç‚¹ä»…å‚ä¸ç®¡ç†å·¥ä½œï¼Œè€Œä¸è¿è¡ŒæœåŠ¡ä»»åŠ¡ï¼ˆtaskï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡ è®¾ç½®èŠ‚ç‚¹çš„å¯è°ƒåº¦çŠ¶æ€ä¸ºâ€œä¸å¯è°ƒåº¦â€ æ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½® manager1 èŠ‚ç‚¹ä¸ºâ€œä¸å¯è°ƒåº¦â€ï¼Œå³ æ’ç©ºæ¨¡å¼</span></span><br><span class="line">docker node update --availability drain manager1</span><br><span class="line"><span class="comment"># æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line">docker node <span class="built_in">ls</span></span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œmanager1 èŠ‚ç‚¹çŠ¶æ€å˜ä¸º æ’ç©º</span></span><br><span class="line">ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">kp2zerd28xgz5mmglnje0jp22 *   manager1   Ready     Drain          Reachable        26.1.3</span><br><span class="line">oymi74epagdqeprah7s81tsa2     manager2   Ready     Active         Reachable        26.1.3</span><br><span class="line">r7388xl84nczjtnf53pwh7hla     manager3   Ready     Active         Leader           26.1.3</span><br><span class="line">xkww4853bbdgv7bv8771xibob     worker1    Ready     Active                          26.1.3</span><br><span class="line">hvzkh3ip5ef8gx973z1ywahbu     worker2    Ready     Active                          26.1.3</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span></span><br><span class="line">docker service ps my-nginx</span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ° manager1 èŠ‚ç‚¹ä¸Šçš„ä»»åŠ¡å·²ç»å…³é—­ï¼Œå¹¶ä¸”åœ¨å…¶å®ƒèŠ‚ç‚¹ä¸Šè¿è¡Œäº†ä»»åŠ¡ã€‚</span></span><br><span class="line">ID             NAME             IMAGE          NODE       DESIRED STATE   CURRENT STATE                    ERROR     PORTS</span><br><span class="line">23m03nj54mzo   my-nginx.1       nginx:latest   worker2    Running         Running 35 seconds ago</span><br><span class="line">9xi83bnh4fus   my-nginx.2       nginx:latest   worker2    Running         Running 35 seconds ago</span><br><span class="line">wos8tbk449lk   my-nginx.3       nginx:latest   manager2   Running         Running 28 seconds ago</span><br><span class="line">uosmuh6bvwm0    \_ my-nginx.3   nginx:latest   manager1   Shutdown        Shutdown 7 seconds ago</span><br><span class="line">yeqhqc3f735y   my-nginx.4       nginx:latest   manager2   Running         Running about a minute ago</span><br><span class="line">g8rduix7s74v   my-nginx.5       nginx:latest   worker2    Running         Running less than a second ago</span><br><span class="line">wuxilgpv9f50    \_ my-nginx.5   nginx:latest   manager1   Shutdown        Shutdown 7 seconds ago</span><br><span class="line">3bxtn9boit28   my-nginx.6       nginx:latest   manager3   Running         Running 28 seconds ago</span><br><span class="line">57kdggaf8sag   my-nginx.7       nginx:latest   manager2   Running         Running about a minute ago</span><br><span class="line">uugi506p74s8   my-nginx.8       nginx:latest   worker1    Running         Running 28 seconds ago</span><br><span class="line">yifwpqjnts9l   my-nginx.9       nginx:latest   worker1    Running         Running 28 seconds ago</span><br><span class="line">yv4p6su7aom5   my-nginx.10      nginx:latest   manager3   Running         Running 28 seconds ago</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¢å¤è¿è¡Œä»»åŠ¡èƒ½åŠ›</span></span><br><span class="line">docker node update --availability active manager1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢æ¥æ”¶æ–°çš„ä»»åŠ¡ä½†ä¿ç•™è¿è¡Œä¸­çš„ä»»åŠ¡</span></span><br><span class="line">docker node update --availability pause manager1</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker Swarm çš„ èŠ‚ç‚¹ç®¡ç†&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/engine/swarm/&quot;&gt;Docker Swarm å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker å‘½ä»¤ ä¹‹ Dockerfile å¤šå¹³å°æ„å»º</title>
    <link href="https://blog.hanqunfeng.com/2025/06/06/docker-dockerfile-multi-platform/"/>
    <id>https://blog.hanqunfeng.com/2025/06/06/docker-dockerfile-multi-platform/</id>
    <published>2025-06-06T13:30:05.000Z</published>
    <updated>2025-06-07T11:32:29.230Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ Dockerfile å¤šå¹³å°æ„å»ºçš„ä½¿ç”¨æ–¹æ³•</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/engine/reference/builder/">Dockerfileå®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/build/building/multi-platform/">Multi-platform builds</a></p></li></ul><span id="more"></span><h2 id="ä»€ä¹ˆæ˜¯Dockerfile-å¤šå¹³å°æ„å»ºï¼Ÿ">ä»€ä¹ˆæ˜¯Dockerfile å¤šå¹³å°æ„å»ºï¼Ÿ</h2><ul class="lvl-0"><li class="lvl-2"><p>Dockerfile å¤šå¹³å°æ„å»ºï¼Œå¯ä»¥æ„å»ºå¤šä¸ªå¹³å°é•œåƒï¼Œæ¯”å¦‚ arm64ã€amd64ã€armã€386 ç­‰ã€‚</p></li><li class="lvl-2"><p>åœ¨æ²¡æœ‰å®‰è£… <code>docker-buildx-plugin</code> çš„æƒ…å†µä¸‹ï¼Œ<code>docker build</code> å‘½ä»¤æ˜¯ä¸æ”¯æŒä½¿ç”¨ <code>--platform</code> æ„å»ºå‡ºè·¨å¹³å°é•œåƒçš„ï¼Œå…¶ä»…èƒ½æ„å»ºä¸æœ¬æœºæ¶æ„å¹³å°ç›¸åŒçš„é•œåƒã€‚</p></li><li class="lvl-2"><p>è¦çœŸæ­£å®ç°è·¨å¹³å°æ„å»ºï¼ˆmulti-platform buildï¼‰ï¼Œæ¯”å¦‚åœ¨ amd64 ä¸Šæ„å»º arm64 çš„é•œåƒï¼Œéœ€è¦ä½¿ç”¨ BuildKit å’Œ buildx æ’ä»¶ã€‚</p></li><li class="lvl-2"><p><code>docker-buildx-plugin</code> æ˜¯åŸºäº BuildKit æ„å»ºçš„ï¼Œä½†å®ƒæœ¬èº«æ˜¯ Buildx çš„ä¸€ä¸ªå®ç°å½¢å¼ï¼Œå®ƒæ‰©å±•äº† <code>docker build</code> çš„èƒ½åŠ›ï¼Œæ”¯æŒå¤šå¹³å°æ„å»ºï¼ˆå¦‚åŒæ—¶æ„å»º Linux/amd64 å’Œ Linux/arm64ç­‰ï¼‰ã€‚</p></li></ul><h2 id="å®‰è£…-docker-buildx-plugin">å®‰è£… docker-buildx-plugin</h2><ul class="lvl-0"><li class="lvl-2"><p>éšdockeræœåŠ¡ä¸€èµ·å®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å•ç‹¬å®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf -y install docker-buildx-plugin</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ç‰ˆæœ¬</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker buildx version</span><br></pre></td></tr></table></figure><h2 id="docker-buildx-åŸºæœ¬å‘½ä»¤"><code>docker buildx</code> åŸºæœ¬å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p>ä»¥ä¸‹å‘½ä»¤åœ¨åé¢çš„ç¤ºä¾‹ä¸­éƒ½æœ‰ä½¿ç”¨</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>docker buildx create</code></td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„æ„å»ºå™¨å®ä¾‹</td></tr><tr><td><code>docker buildx use</code></td><td>è®¾ç½®å½“å‰ä½¿ç”¨çš„æ„å»ºå™¨</td></tr><tr><td><code>docker buildx inspect</code></td><td>æŸ¥çœ‹æ„å»ºå™¨çŠ¶æ€å’Œæ”¯æŒçš„å¹³å°</td></tr><tr><td><code>docker buildx build</code></td><td>æ„å»ºé•œåƒï¼ˆå¢å¼ºç‰ˆï¼‰ï¼Œç­‰åŒäº <code>docker build</code></td></tr><tr><td><code>docker buildx ls</code></td><td>åˆ—å‡ºæ‰€æœ‰æ„å»ºå™¨</td></tr><tr><td><code>docker buildx rm</code></td><td>åˆ é™¤æ„å»ºå™¨</td></tr><tr><td><code>docker buildx du</code></td><td>æŸ¥çœ‹æ„å»ºå™¨ä½¿ç”¨çš„ç£ç›˜ç©ºé—´</td></tr><tr><td><code>docker buildx prune</code></td><td>åˆ é™¤æ„å»ºè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ç¼“å­˜</td></tr><tr><td><code>docker buildx version</code></td><td>æŸ¥çœ‹ Docker Buildx çš„ç‰ˆæœ¬ä¿¡æ¯</td></tr></tbody></table><h2 id="è¦è®©Dockeræ”¯æŒå¤šå¹³å°æ„å»ºï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š">è¦è®©Dockeræ”¯æŒå¤šå¹³å°æ„å»ºï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</h2><ul class="lvl-0"><li class="lvl-2"><p>Linuxå†…æ ¸å¼€å¯å¤šå¤„ç†å™¨æ¶æ„æ”¯æŒ</p></li><li class="lvl-2"><p>æ„å»ºæ—¶ä½¿ç”¨åŸºäº<code>docker-container</code>é©±åŠ¨çš„Buildxå®ä¾‹</p></li><li class="lvl-2"><p>ä½¿ç”¨<code>docker buildx build</code>å‘½ä»¤æ„å»ºé•œåƒï¼Œæ„å»ºå‘½ä»¤å¿…é¡»æŒ‡å®š<code>â€“platform</code>å‚æ•°</p></li></ul><h2 id="Linuxå†…æ ¸å¼€å¯å¤šå¤„ç†å™¨æ¶æ„æ”¯æŒ">Linuxå†…æ ¸å¼€å¯å¤šå¤„ç†å™¨æ¶æ„æ”¯æŒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰æ„å»ºå™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªåç§°ä¸º&quot;default&quot;çš„æ„å»ºå™¨</span></span><br><span class="line">docker buildx <span class="built_in">ls</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">NAME/NODE        DRIVER/ENDPOINT                   STATUS    BUILDKIT   PLATFORMS</span><br><span class="line">default          docker</span><br><span class="line"> \_ default       \_ default                       running   v0.13.2    linux/amd64, linux/amd64/v2, linux/amd64/v3, linux/amd64/v4, linux/386</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯å¤šå¤„ç†å™¨æ¶æ„æ”¯æŒ</span></span><br><span class="line">docker run --privileged --<span class="built_in">rm</span> tonistiigi/binfmt --install all</span><br><span class="line"><span class="comment"># è¿™ä¸ªé•œåƒç”¨å®Œå°±å¯ä»¥åˆ é™¤äº†</span></span><br><span class="line">docker rmi tonistiigi/binfmt</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡åˆ—å‡ºæ‰€æœ‰æ„å»ºå™¨</span></span><br><span class="line">docker buildx <span class="built_in">ls</span></span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°PLATFORMSä¸­æœ‰å¤šä¸ªå¹³å°</span></span><br><span class="line">NAME/NODE        DRIVER/ENDPOINT                   STATUS    BUILDKIT   PLATFORMS</span><br><span class="line">default*         docker</span><br><span class="line"> \_ default       \_ default                       running   v0.13.2    linux/amd64, linux/amd64/v2, linux/amd64/v3, linux/amd64/v4, linux/386, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/mips64le, linux/mips64, linux/loong64, linux/arm/v7, linux/arm/v6</span><br></pre></td></tr></table></figure><h2 id="æ„å»ºæ—¶ä½¿ç”¨åŸºäºdocker-containeré©±åŠ¨çš„Buildxå®ä¾‹">æ„å»ºæ—¶ä½¿ç”¨åŸºäº<code>docker-container</code>é©±åŠ¨çš„Buildxå®ä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Docker çš„é»˜è®¤æ„å»ºé©±åŠ¨æ˜¯ dockerï¼Œå®ƒæ˜¯è¿è¡Œåœ¨æœ¬åœ° Docker å®ˆæŠ¤è¿›ç¨‹ä¸Šçš„ï¼Œä¸èƒ½è¿›è¡ŒçœŸæ­£çš„å¤šå¹³å°æ„å»ºï¼ˆä»…èƒ½æ„å»ºå½“å‰å¹³å°ï¼‰ã€‚</p></li><li class="lvl-2"><p>å¤šå¹³å°æ„å»ºéœ€è¦ä½¿ç”¨ BuildKit çš„ container é©±åŠ¨ï¼Œå®ƒä»¥å®¹å™¨çš„å½¢å¼è¿è¡Œæ„å»ºå™¨ï¼Œæ”¯æŒè™šæ‹ŸåŒ–å¹³å°å¹¶è¡Œæ„å»ºã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰é»˜è®¤çš„æ„å»ºå™¨default</span></span><br><span class="line">docker buildx inspect default</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">Name:          default</span><br><span class="line">Driver:        docker</span><br><span class="line">Last Activity: 2025-06-06 07:42:42 +0000 UTC</span><br><span class="line"></span><br><span class="line">Nodes:</span><br><span class="line">Name:             default</span><br><span class="line">Endpoint:         default</span><br><span class="line">Status:           running</span><br><span class="line">BuildKit version: v0.13.2</span><br><span class="line">Platforms:        linux/amd64, linux/amd64/v2, linux/amd64/v3, linux/amd64/v4, linux/386, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/mips64le, linux/mips64, linux/loong64, linux/arm/v7, linux/arm/v6</span><br><span class="line">Labels:</span><br><span class="line"> org.mobyproject.buildkit.worker.moby.host-gateway-ip: 172.17.0.1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåŸºäº <code>docker-container</code> é©±åŠ¨çš„Buildxå®ä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå¹¶åˆ‡æ¢åˆ°åä¸ºmybuilderçš„æ„å»ºå™¨å®ä¾‹</span></span><br><span class="line">docker buildx create --name mybuilder --use --driver docker-container</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æ„å»ºå™¨ä¿¡æ¯ï¼Œ--bootstrapï¼šæŸ¥çœ‹å‰ç¡®ä¿æ„å»ºå™¨å·²å¯åŠ¨ ï¼Œæ­¤æ—¶çœ‹åˆ°å…¶Driverä¸ºdocker-containerï¼Œè¿™ä¸ªå‘½ä»¤ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶å¯èƒ½ä¼šæç¤ºé”™è¯¯ï¼Œä¸è¿‡ä¸ç”¨ç®¡ï¼Œå†æ¬¡è¿è¡Œå°±æ­£å¸¸äº†</span></span><br><span class="line">docker buildx inspect --bootstrap</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Name:          mybuilder</span><br><span class="line">Driver:        docker-container</span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶ä¼šå¯åŠ¨ä¸€ä¸ªåç§°ä¸º`buildx_buildkit_mybuilder0`çš„å®¹å™¨ï¼Œæ¯åˆ›å»ºä¸€ä¸ªæ„å»ºå™¨å®ä¾‹ï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªåç§°ä¸º`buildx_buildkit_xxx`çš„å®¹å™¨ï¼Œåˆ é™¤æ„å»ºå™¨æ—¶ï¼Œå…¶å¯¹åº”çš„å®¹å™¨ä¹Ÿä¼šè¢«åˆ é™¤</span></span><br><span class="line">docker ps</span><br><span class="line">CONTAINER ID   IMAGE                           COMMAND                   CREATED             STATUS                       PORTS                    NAMES</span><br><span class="line">0ab9cab9ec9b   moby/buildkit:buildx-stable-1   <span class="string">&quot;buildkitd --allow-iâ€¦&quot;</span>   About an hour ago   Up About an hour                                      buildx_buildkit_mybuilder0</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>buildx_buildkit_xxx</code>è¿™ä¸ªå®¹å™¨å°±æ˜¯ä¸€ä¸ª BuildKit å®ˆæŠ¤è¿›ç¨‹å®¹å™¨ï¼Œå®ƒæ˜¯æ‰§è¡Œ buildx æ„å»ºä»»åŠ¡çš„å®é™…å·¥ä½œå¼•æ“ã€‚å…¶å¯¹åº”çš„é•œåƒä¸º<code>moby/buildkit:buildx-stable-1</code>ï¼Œå®¹å™¨ä¼šåœ¨æ‰§è¡Œ<code>docker buildx build</code> æˆ– <code>docker buildx inspect --bootstrap</code> æ—¶å¯åŠ¨</p></li></ul><table><thead><tr><th>åŠŸèƒ½</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ğŸ‘· æ‰§è¡Œæ„å»ºä»»åŠ¡</td><td>çœŸæ­£æ‰§è¡Œ <code>buildx build</code> æŒ‡ä»¤é‡Œçš„æ„å»ºè¿‡ç¨‹ï¼Œæ¯”å¦‚å¤šé˜¶æ®µæ„å»ºã€ç¼“å­˜å¤„ç†ã€è·¨å¹³å°ç¼–è¯‘ç­‰</td></tr><tr><td>ğŸ“¦ æ‹‰å–é•œåƒ</td><td>æ‹‰å– <code>Dockerfile</code> ä¸­çš„åŸºç¡€é•œåƒ</td></tr><tr><td>ğŸ“¤ ä¸Šä¼ /å¯¼å‡ºé•œåƒ</td><td>æ”¯æŒå¯¼å‡ºä¸º <code>docker image</code>, <code>tar</code>, æ¨é€åˆ°è¿œç¨‹ registry</td></tr><tr><td>ğŸª£ ç®¡ç†ç¼“å­˜</td><td>ç®¡ç†æ„å»ºç¼“å­˜ï¼ˆä¸­é—´é•œåƒã€å±‚ç­‰ï¼‰ä»¥åŠ é€Ÿåç»­æ„å»º</td></tr><tr><td>ğŸŒ æ”¯æŒå¤šå¹³å°</td><td>é€šè¿‡ QEMU æˆ–äº¤å‰ç¼–è¯‘å™¨æ”¯æŒè·¨å¹³å°ï¼ˆå¦‚æ„å»º <code>arm64</code> é•œåƒï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åœ¨å›½å†…ç¯å¢ƒä½¿ç”¨æ—¶ï¼Œå¦‚æœä¸èƒ½ç§‘å­¦ä¸Šç½‘ï¼Œå½“æˆ‘ä»¬åœ¨æ„å»ºé•œåƒæ—¶ä¼šæç¤ºæ— æ³•æ‹‰å–åŸºç¡€é•œåƒï¼Œå³ä¾¿æˆ‘ä»¬å·²ç»åœ¨<code>/etc/docker/daemon.json</code>ä¸­é…ç½®äº†å›½å†…çš„é•œåƒæºä¹Ÿä¸è¡Œï¼Œè¿™æ˜¯å› ä¸º<code>docker buildx</code> ä½¿ç”¨çš„æ˜¯ BuildKitï¼Œå®ƒçš„è¡Œä¸ºä¸åŒäºä¼ ç»Ÿçš„ <code>docker build</code></p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th><code>docker build</code>ï¼ˆä¼ ç»Ÿï¼‰</th><th><code>docker buildx</code>ï¼ˆBuildKitï¼‰</th></tr></thead><tbody><tr><td>æ˜¯å¦ä½¿ç”¨æœ¬åœ°é•œåƒç¼“å­˜</td><td>âœ… æ˜¯</td><td>âš ï¸ <strong>ä¸æ˜¯</strong></td></tr><tr><td>æ˜¯å¦éœ€è¦è”ç½‘æ‹‰å–å…ƒæ•°æ®ï¼ˆå³ä½¿é•œåƒå·²å­˜åœ¨ï¼‰</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>æ„å»ºç½‘ç»œéš”ç¦»</td><td>ä¸éš”ç¦»</td><td>éš”ç¦»æ„å»ºï¼Œæ— æ³•ç›´æ¥è®¿é—®å®¿ä¸»é•œåƒç¼“å­˜</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è§£å†³æ–¹æ³•ä¸ºæ„å»ºå™¨é…ç½®é•œåƒæº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º BuildKit é…ç½®æ–‡ä»¶ buildkitd.toml</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; buildkitd.toml</span></span><br><span class="line"><span class="string">[registry.&quot;docker.io&quot;]</span></span><br><span class="line"><span class="string">  mirrors = [&quot;https://docker.1ms.run&quot;]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[worker.oci]</span></span><br><span class="line"><span class="string">  gc = true</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º BuildKit æ„å»ºå™¨ï¼Œå¹¶æŒ‡å®šé…ç½®æ–‡ä»¶</span></span><br><span class="line">docker buildx create --name mybuilder --use --driver docker-container --config ./buildkitd.toml</span><br><span class="line">docker buildx inspect --bootstrap</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå­˜åœ¨åŒåçš„æ„å»ºå™¨ï¼Œåˆ™åˆ é™¤å®ƒåå†åˆ›å»º</span></span><br><span class="line">docker buildx <span class="built_in">rm</span> mybuilder</span><br><span class="line">docker buildx create --name mybuilder --use --driver docker-container --config ./buildkitd.toml</span><br><span class="line">docker buildx inspect --bootstrap</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ„å»ºå™¨åˆ—è¡¨</span></span><br><span class="line">docker buildx <span class="built_in">ls</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">NAME/NODE        DRIVER/ENDPOINT                   STATUS    BUILDKIT   PLATFORMS</span><br><span class="line">mybuilder*       docker-container</span><br><span class="line"> \_ mybuilder0    \_ unix:///var/run/docker.sock   running   v0.21.1    linux/amd64, linux/amd64/v2, linux/amd64/v3, linux/amd64/v4, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/386, linux/mips64le, linux/mips64, linux/loong64, linux/arm/v7, linux/arm/v6</span><br><span class="line">default          docker</span><br><span class="line"> \_ default       \_ default                       running   v0.13.2    linux/amd64, linux/amd64/v2, linux/amd64/v3, linux/amd64/v4, linux/386, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/mips64le, linux/mips64, linux/loong64, linux/arm/v7, linux/arm/v6</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœè¦åˆ‡æ¢å›é»˜è®¤çš„æ„å»ºå™¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span></span><br><span class="line">docker buildx use default</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨docker-buildx-buildå‘½ä»¤æ„å»ºé•œåƒï¼Œæ„å»ºå‘½ä»¤å¿…é¡»æŒ‡å®š-platformå‚æ•°">ä½¿ç”¨<code>docker buildx build</code>å‘½ä»¤æ„å»ºé•œåƒï¼Œæ„å»ºå‘½ä»¤å¿…é¡»æŒ‡å®š<code>--platform</code>å‚æ•°</h2><h3 id="ç¤ºä¾‹ä¸€ï¼šå•é˜¶æ®µæ„å»º">ç¤ºä¾‹ä¸€ï¼šå•é˜¶æ®µæ„å»º</h3><ul class="lvl-0"><li class="lvl-2"><p>æˆ‘ä»¬ä¾æ—§ä»¥ä¸€ä¸ªspringbooté¡¹ç›®ä¸ºä¾‹ï¼Œå…¶Dockerfileå¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨è½»é‡çº§ Alpine ç‰ˆæœ¬çš„ OpenJDK 17 å®˜æ–¹é•œåƒï¼Œé€‚åˆéƒ¨ç½² Spring Boot åº”ç”¨</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">17</span>-alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ„å»ºæ—¶å˜é‡ï¼Œé»˜è®¤ä½¿ç”¨æ„å»ºå¥½çš„ jar æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">ARG</span> JAR_FILE=app.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è¿è¡Œæ—¶ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_OPTS=<span class="string">&quot;-Xms1024M -Xmx1024M -XX:MetaspaceSize=128M -XX:MaxMetaspaceSize=128M&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># é•œåƒå…ƒä¿¡æ¯</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer=<span class="string">&quot;yourname@example.com&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> version=<span class="string">&quot;1.0.0&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> description=<span class="string">&quot;ç”¨äºéƒ¨ç½² Spring Boot åº”ç”¨çš„ç”Ÿäº§çº§é•œåƒ&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶ Spring Boot æ„å»ºç”Ÿæˆçš„ jar åŒ…</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> <span class="variable">$&#123;JAR_FILE&#125;</span> app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å£°æ˜æš´éœ²çš„åº”ç”¨ç«¯å£ï¼ˆSpring Boot é»˜è®¤æ˜¯ 8080ï¼‰</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶çš„ä¸»å‘½ä»¤ï¼ˆENTRYPOINT ä¸ä¼šè¢« docker run å‚æ•°è¦†ç›–ï¼‰</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;java <span class="variable">$JAVA_OPTS</span> -jar app.jar&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CMD æä¾›é»˜è®¤çš„è¿è¡Œå‚æ•°ï¼Œå¯ä»¥è¢« docker run è¦†ç›–</span></span><br><span class="line"><span class="comment"># è¿™é‡Œé€šè¿‡ Spring Boot å‚æ•°è®¾ç½®å¯åŠ¨ç¯å¢ƒå’Œç«¯å£å·</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;--spring.profiles.active=app&quot;</span>, <span class="string">&quot;--server.port=8080&quot;</span>]</span></span><br><span class="line"><span class="comment"># è¿™é‡Œä½¿ç”¨çš„æ˜¯ ENTRYPOINT + CMD çš„æ··åˆæ¨¡å¼</span></span><br><span class="line"><span class="comment"># å®Œæ•´å‘½ä»¤ï¼š java $JAVA_OPTS -jar app.jar --spring.profiles.active=app --server.port=8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å£°æ˜ä¸€ä¸ªå·æŒ‚è½½ç‚¹ï¼Œè¿è¡Œå®¹å™¨æ—¶å¯å°†è¯¥è·¯å¾„æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œå®ç°æ•°æ®æŒä¹…åŒ–</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;/app/logs&quot;</span>]</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¼€å§‹æ„å»ºé•œåƒï¼Œ<code>docker buildx build == docker build</code>ï¼Œæ„å»ºå¤šå¹³å°æ¶æ„æ—¶éœ€è¦ä½¿ç”¨<code>--platform</code>æŒ‡å®šæ„å»ºå¹³å°</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --platform inux/arm64 :æ„å»ºarm64é•œåƒ</span></span><br><span class="line"><span class="comment"># -t &quot;app.arm64&quot; :æ„å»ºåé•œåƒåç§°ï¼Œæ²¡æœ‰æŒ‡å®šç‰ˆæœ¬é»˜è®¤å°±æ˜¯ï¼šlatest</span></span><br><span class="line"><span class="comment"># --load :æ„å»ºååŠ è½½åˆ°æœ¬åœ°</span></span><br><span class="line"><span class="comment"># . :å½“å‰ç›®å½•æŸ¥æ‰¾Dockerfileæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># -f :å¦‚æœåç§°ä¸ä¸ºDockerfileï¼Œåˆ™é€šè¿‡è¯¥å‚æ•°æŒ‡å®šDockerfileæ–‡ä»¶çš„åç§°</span></span><br><span class="line">docker buildx build --platform linux/arm64 -t <span class="string">&quot;app.arm64&quot;</span> --load .</span><br><span class="line"><span class="comment">## æ­¤æ—¶ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯</span></span><br><span class="line">ERROR: failed to solve: openjdk:17-alpine: failed to resolve <span class="built_in">source</span> metadata <span class="keyword">for</span> docker.io/library/openjdk:17-alpine: no match <span class="keyword">for</span> platform <span class="keyword">in</span> manifest: not found</span><br><span class="line"><span class="comment">## åŸå› ï¼šopenjdk:17-alpine è¿™ä¸ªé•œåƒä¸æ”¯æŒarm64å¹³å°ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ¢ä¸€ä¸ªæ”¯æŒå¤šå¹³å°çš„é•œåƒ</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚ä½•æŸ¥çœ‹é•œåƒæ˜¯å¦æ”¯æŒå¤šå¹³å°å‘¢ï¼Ÿå¯ä»¥åœ¨docker hubä¸ŠæŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢é•œåƒæ”¯æŒçš„å¹³å°ï¼Œä¸è¿‡å›½å†…ä¾æ—§æ˜¯ä¸æ”¯æŒ</span></span><br><span class="line">docker buildx imagetools inspect nginx:latest |  grep Platform | <span class="built_in">sort</span> | <span class="built_in">uniq</span></span><br><span class="line"><span class="comment"># å¯ä»¥åœ¨é•œåƒåç§°å‰åŠ ä¸Šå›½å†…çš„é•œåƒä»“åº“åœ°å€è¿›è¡ŒæŸ¥è¯¢ï¼Œæ¯”å¦‚ï¼š</span></span><br><span class="line">docker buildx imagetools inspect docker.1ms.run/nginx:latest |  grep Platform | <span class="built_in">sort</span> | <span class="built_in">uniq</span></span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">  Platform:    linux/386</span><br><span class="line">  Platform:    linux/amd64</span><br><span class="line">  Platform:    linux/arm64/v8</span><br><span class="line">  Platform:    linux/arm/v5</span><br><span class="line">  Platform:    linux/arm/v7</span><br><span class="line">  Platform:    linux/mips64le</span><br><span class="line">  Platform:    linux/ppc64le</span><br><span class="line">  Platform:    linux/s390x</span><br><span class="line">  Platform:    unknown/unknown</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ç€æˆ‘ä»¬æŸ¥çœ‹openjdk:17-alpineè¿™ä¸ªé•œåƒ</span></span><br><span class="line">docker buildx imagetools inspect docker.1ms.run/openjdk:17-alpine | grep Platform | <span class="built_in">sort</span> | <span class="built_in">uniq</span></span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœï¼Œå…¶ç¡®å®ä¸æ”¯æŒ linux/arm64</span></span><br><span class="line">  Platform:  linux/amd64</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬æ¢ä¸€ä¸ªopenjdké•œåƒè¯•è¯•</span></span><br><span class="line">docker buildx imagetools inspect docker.1ms.run/openjdk:17-slim | grep Platform | <span class="built_in">sort</span> | <span class="built_in">uniq</span></span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªé•œåƒåŒæ—¶æ”¯æŒamd64å’Œarm64æ¶æ„</span></span><br><span class="line">  Platform:  linux/amd64</span><br><span class="line">  Platform:  linux/arm64/v8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨skopeoå®¹å™¨çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢</span></span><br><span class="line">docker run --<span class="built_in">rm</span> quay.io/skopeo/stable:latest inspect --raw --override-os linux docker://docker.1ms.run/openjdk:17-slim | jq -r <span class="string">&#x27;.manifests[].platform | &quot;\(.os)/\(.architecture)/\(.variant)&quot;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> | sed <span class="string">&#x27;s/\/null//&#x27;</span></span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">linux/amd64</span><br><span class="line">linux/arm64/v8</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ›¿æ¢æ”¯æŒå¤šæ¶æ„çš„é•œåƒåé‡æ–°æ„å»ºé•œåƒå°±ä¼šæˆåŠŸ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">docker buildx build --platform linux/arm64 -t <span class="string">&quot;app.arm64&quot;</span> --load .</span><br><span class="line">docker buildx build --platform linux/amd64 -t <span class="string">&quot;app.amd64&quot;</span> --load .</span><br><span class="line"><span class="comment"># åˆ—å‡ºé•œåƒ</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">REPOSITORY              TAG                IMAGE ID       CREATED        SIZE</span><br><span class="line">app.amd64               latest             859162438372   2 hours ago    431MB</span><br><span class="line">app.arm64               latest             0058c70dd16e   2 hours ago    426MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ„å»ºåé•œåƒçš„æ¶æ„</span></span><br><span class="line">docker inspect app.amd64 | jq <span class="string">&#x27;.[0].Architecture&#x27;</span></span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line"><span class="string">&quot;amd64&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ„å»ºåçš„é•œåƒè¾“å‡ºåˆ°æœ¬åœ°ç›®å½•</span></span><br><span class="line">docker buildx build --platform linux/amd64 -t <span class="string">&quot;app.amd64&quot;</span> --output <span class="built_in">type</span>=docker,dest=./app.amd64.tar .</span><br><span class="line"><span class="comment"># ç„¶åå†å°†é•œåƒå¯¼å…¥åˆ°æœ¬åœ°é•œåƒä»“åº“ä¸­</span></span><br><span class="line">docker load -i app.amd64.tar</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>--load</code>å’Œ <code>--output</code>éƒ½ä¸æ”¯æŒä¸€ä¸ªé•œåƒå¤šç§æ¶æ„ï¼Œè¦æ„å»ºåƒ<code>openjdk:17-slim</code>è¿™ç§æ”¯æŒå¤šæ¶æ„çš„é•œåƒå¯ä»¥ä½¿ç”¨<code>--push</code>ï¼Œä¸€æ­¥å°±æ¨é€åˆ°è¿œç¨‹ä»“åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºå¤šæ¶æ„é•œåƒï¼Œ--push å¯ä»¥ä¸€æ­¥åšåˆ°ï¼šå¤šå¹³å°æ„å»ºçš„é•œåƒä¸èƒ½åªä¿å­˜åˆ°æœ¬åœ°ï¼Œå¿…é¡»æ¨é€åˆ°è¿œç¨‹ registry æ‰èƒ½åˆå¹¶æ¶æ„ã€‚</span></span><br><span class="line"><span class="comment"># è¿™é‡Œä»¥æ¨é€åˆ° docker hub ä¸ºä¾‹</span></span><br><span class="line"><span class="comment"># ç™»å½• docker hup</span></span><br><span class="line">docker login -u hanqunfeng</span><br><span class="line"><span class="comment"># æ„å»ºï¼Œæ³¨æ„è¿™é‡Œçš„é•œåƒåç§°è¦åŠ ä¸Šä½ çš„dockerhubçš„å‘½åç©ºé—´ï¼Œ--platform æŒ‡å®šæ„å»ºçš„æ¶æ„ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªï¼Œéœ€è¦Dockerfileé…ç½®åŸºç¡€é•œåƒæ”¯æŒå¯¹åº”çš„æ¶æ„</span></span><br><span class="line">docker buildx build --platform linux/amd64,linux/arm64 -t hanqunfeng/app:latest --push .</span><br></pre></td></tr></table></figure><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/WdmJx0.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>é•œåƒæ‹‰å–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‹‰å–æŒ‡å®šæ¶æ„é•œåƒï¼Œä¸æŒ‡å®š --platform å‚æ•°ï¼Œé»˜è®¤æ‹‰å–å½“å‰æ¶æ„çš„é•œåƒ</span></span><br><span class="line">docker pull --platform=linux/arm64 hanqunfeng/app:latest</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹äºŒï¼šå¤šé˜¶æ®µæ„å»º">ç¤ºä¾‹äºŒï¼šå¤šé˜¶æ®µæ„å»º</h3><ul class="lvl-0"><li class="lvl-2"><p>è¦æ±‚æ¯ä¸ªé˜¶æ®µä¸­çš„åŸºç¡€é•œåƒéƒ½è¦æ”¯æŒå¤šæ¶æ„</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€é˜¶æ®µï¼šè·å–ä»£ç </span></span><br><span class="line"><span class="keyword">FROM</span> alpine/git AS fetcher</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /workspace/application</span></span><br><span class="line"><span class="comment"># å°†æ›¿æ¢ä¸ºå®é™…çš„Gitä»“åº“URLå’Œåˆ†æ”¯/æ ‡ç­¾</span></span><br><span class="line"><span class="keyword">ARG</span> GIT_REPOSITORY=https://gitee.com/hanqunfeng/springbootweb.git</span><br><span class="line"><span class="keyword">ARG</span> GIT_BRANCH=master</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> git <span class="built_in">clone</span> -b <span class="variable">$&#123;GIT_BRANCH&#125;</span> <span class="variable">$&#123;GIT_REPOSITORY&#125;</span> .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒé˜¶æ®µï¼šä½¿ç”¨Mavenç¯å¢ƒè¿›è¡Œæ„å»º</span></span><br><span class="line"><span class="keyword">FROM</span> maven:<span class="number">3.8</span>.<span class="number">4</span>-openjdk-<span class="number">17</span> AS builder</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /workspace/application</span></span><br><span class="line"><span class="comment"># ä»ç¬¬ä¸€é˜¶æ®µå¤åˆ¶ä»£ç </span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=fetcher /workspace/application .</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨Mavenæ¸…ç†å¹¶æ‰“åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> mvn clean package -DskipTests</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸‰é˜¶æ®µï¼šåˆ›å»ºæœ€ç»ˆçš„è¿è¡Œç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">17</span>-slim</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="comment"># è®¾ç½®è¿è¡Œæ—¶ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_OPTS=<span class="string">&quot;-Xms1024M -Xmx1024M -XX:MetaspaceSize=128M -XX:MaxMetaspaceSize=128M&quot;</span></span><br><span class="line"><span class="comment"># å°†ç¬¬äºŒé˜¶æ®µç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å¤åˆ¶åˆ°è¿™é‡Œã€‚æ³¨æ„è¿™é‡Œå‡è®¾ä½ çš„spring bootå·¥ç¨‹æ‰“æˆçš„jaråæ˜¯target/app.jar</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /workspace/application/target/app.jar app.jar</span></span><br><span class="line"><span class="comment"># æš´éœ²ç«¯å£ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰ã€‚è¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ç«¯å£å·</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="comment"># å£°æ˜ä¸€ä¸ªå·æŒ‚è½½ç‚¹ï¼Œè¿è¡Œå®¹å™¨æ—¶å¯å°†è¯¥è·¯å¾„æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œå®ç°æ•°æ®æŒä¹…åŒ–</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;/app/logs&quot;</span>]</span></span><br><span class="line"><span class="comment"># è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶çš„ä¸»å‘½ä»¤ï¼ˆENTRYPOINT ä¸ä¼šè¢« docker run å‚æ•°è¦†ç›–ï¼‰</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;java <span class="variable">$JAVA_OPTS</span> -jar app.jar&quot;</span>]</span></span><br><span class="line"><span class="comment"># CMD æä¾›é»˜è®¤çš„è¿è¡Œå‚æ•°ï¼Œå¯ä»¥è¢« docker run è¦†ç›–</span></span><br><span class="line"><span class="comment"># è¿™é‡Œé€šè¿‡ Spring Boot å‚æ•°è®¾ç½®å¯åŠ¨ç¯å¢ƒå’Œç«¯å£å·</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;--spring.profiles.active=app&quot;</span>, <span class="string">&quot;--server.port=8080&quot;</span>]</span></span><br><span class="line"><span class="comment"># è¿™é‡Œä½¿ç”¨çš„æ˜¯ ENTRYPOINT + CMD çš„æ··åˆæ¨¡å¼</span></span><br><span class="line"><span class="comment"># å®Œæ•´å‘½ä»¤ï¼š java $JAVA_OPTS -jar app.jar --spring.profiles.active=app --server.port=8080</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ„å»ºé•œåƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºå¤šå¹³å°é•œåƒå¹¶å‘å¸ƒåˆ°dockerhub</span></span><br><span class="line">docker buildx build --platform linux/amd64,linux/arm64 -t hanqunfeng/springboot:latest --push .</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•å°†æ„å»ºå¥½çš„å¤šä¸ªå•å¹³å°é•œåƒå‘å¸ƒä¸ºä¸€ä¸ªå¤šå¹³å°é•œåƒ">å¦‚ä½•å°†æ„å»ºå¥½çš„å¤šä¸ªå•å¹³å°é•œåƒå‘å¸ƒä¸ºä¸€ä¸ªå¤šå¹³å°é•œåƒ</h2><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä½ å·²ç»åˆ†åˆ«æ„å»ºå¥½å•å¹³å°é•œåƒï¼Œä¹Ÿå¯ä»¥ç”¨ <code>docker buildx imagetools create</code> æ¥åˆå¹¶</p></li><li class="lvl-2"><p>ä»¥ä¸Šé¢åˆ›å»ºçš„ä¸¤ä¸ªå•å¹³å°é•œåƒä¸ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºé•œåƒ</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">REPOSITORY              TAG                IMAGE ID       CREATED        SIZE</span><br><span class="line">app.amd64               latest             859162438372   2 hours ago    431MB</span><br><span class="line">app.arm64               latest             0058c70dd16e   2 hours ago    426MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€å®šè¦æ¨é€å•å¹³å°é•œåƒåˆ°è¿œç¨‹ä»“åº“ï¼Œå¦åˆ™æ— æ³•å®Œæˆåˆå¹¶</span></span><br><span class="line">docker tag app.amd64 hanqunfeng/app:amd64</span><br><span class="line">docker push hanqunfeng/app:amd64</span><br><span class="line"></span><br><span class="line">docker tag app.arm64 hanqunfeng/app:arm64</span><br><span class="line">docker push hanqunfeng/app:arm64</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå¹¶ï¼Œåˆ›å»ºå¤šå¹³å°é•œåƒæŒ‡å‘ï¼ˆmanifest listï¼‰</span></span><br><span class="line">docker buildx imagetools create \</span><br><span class="line">  --tag hanqunfeng/app:latest \</span><br><span class="line">   hanqunfeng/app:amd64 \</span><br><span class="line">   hanqunfeng/app:arm64</span><br></pre></td></tr></table></figure><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/5azhzj.png" alt=""></p><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä¸éœ€è¦å•å¹³å°é•œåƒï¼Œå¯ä»¥åœ¨dockerhubä¸Šåˆ é™¤å³å¯ã€‚</p></li></ul><h2 id="ç§»é™¤-BuildKitï¼ˆBuildxï¼‰æ„å»ºè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ç¼“å­˜æ•°æ®">ç§»é™¤ BuildKitï¼ˆBuildxï¼‰æ„å»ºè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ç¼“å­˜æ•°æ®</h2><ul class="lvl-0"><li class="lvl-2"><p>BuildKitï¼ˆBuildxï¼‰æ„å»ºè¿‡ç¨‹ä¼šäº§ç”Ÿç¼“å­˜æ•°æ®ï¼ŒåŒ…æ‹¬æœªä½¿ç”¨çš„ä¸­é—´é•œåƒã€æ„å»ºå±‚ç­‰ã€‚å¯¹äºé¢‘ç¹ä½¿ç”¨ Docker æ„å»ºçš„å¼€å‘è€…æ¥è¯´ï¼Œè¿™äº›ç¼“å­˜ä¼šé€æ¸å ç”¨å¤§é‡ç£ç›˜ç©ºé—´ã€‚</p></li><li class="lvl-2"><p>å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ç¼“å­˜å ç”¨ç£ç›˜ç©ºé—´çš„å¤§å°</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker buildx <span class="built_in">du</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker buildx prune</code> æ˜¯ä¸€ä¸ªç”¨äº æ¸…ç† Docker Buildx æ„å»ºç¼“å­˜ çš„å‘½ä»¤ï¼Œå¸¸ç”¨äºé‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚</p></li><li class="lvl-2"><p>å‘½ä»¤è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker buildx prune [OPTIONS]</span><br></pre></td></tr></table></figure><table><thead><tr><th>OPTIONS</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>-a</code>, <code>--all</code></td><td><strong>åŒ…æ‹¬å†…éƒ¨/å‰ç«¯é•œåƒ</strong>ã€‚é»˜è®¤åªåˆ é™¤æ— ç”¨ç¼“å­˜ï¼ŒåŠ ä¸Šè¯¥å‚æ•°ä¼šæ¸…é™¤æ›´å¤šç¼“å­˜å†…å®¹ï¼ŒåŒ…æ‹¬å¯èƒ½ä»å¯ç”¨çš„å†…å®¹ï¼ˆæ›´å½»åº•ï¼‰ã€‚</td></tr><tr><td><code>--builder string</code></td><td>æŒ‡å®šä½¿ç”¨å“ªä¸ª builder å®ä¾‹ï¼ˆå¯é€šè¿‡ <code>docker buildx ls</code> æŸ¥çœ‹å½“å‰æœ‰å“ªäº› builderï¼‰ã€‚</td></tr><tr><td><code>--filter filter</code></td><td>è®¾å®šæ¸…ç†æ¡ä»¶ï¼Œä¾‹å¦‚ï¼š<code>until=24h</code> è¡¨ç¤ºåªåˆ é™¤ 24 å°æ—¶å‰çš„ç¼“å­˜ã€‚</td></tr><tr><td><code>-f</code>, <code>--force</code></td><td><strong>ä¸æç¤ºç¡®è®¤ï¼Œç›´æ¥æ‰§è¡Œæ¸…ç†æ“ä½œ</strong>ã€‚å¸¸ç”¨äºè„šæœ¬ä¸­ã€‚</td></tr><tr><td><code>--keep-storage bytes</code></td><td>ä¿ç•™æŒ‡å®šå¤§å°çš„ç¼“å­˜ç©ºé—´ï¼Œå…¶ä½™åˆ é™¤ï¼ˆå¦‚ï¼š<code>--keep-storage 5GB</code>ï¼‰ã€‚</td></tr><tr><td><code>--verbose</code></td><td>è¾“å‡ºæ›´è¯¦ç»†çš„æ¸…ç†ä¿¡æ¯ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç¼“å­˜ï¼Œå¹¶è·³è¿‡ç¡®è®¤æç¤º</span></span><br><span class="line">docker buildx prune -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªåˆ é™¤ 24 å°æ—¶å‰çš„ç¼“å­˜ï¼Œä¿ç•™ 10GB çš„ç¼“å­˜ç©ºé—´</span></span><br><span class="line">docker buildx prune --filter <span class="string">&quot;until=24h&quot;</span> --keep-storage 10GB</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ Dockerfile å¤šå¹³å°æ„å»ºçš„ä½¿ç”¨æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/engine/reference/builder/&quot;&gt;Dockerfileå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/build/building/multi-platform/&quot;&gt;Multi-platform builds&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker ä¹‹ è¿œç¨‹è¿æ¥</title>
    <link href="https://blog.hanqunfeng.com/2025/06/05/docker-remote-connection/"/>
    <id>https://blog.hanqunfeng.com/2025/06/05/docker-remote-connection/</id>
    <published>2025-06-05T13:30:05.000Z</published>
    <updated>2025-06-06T06:03:47.970Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•è¿œç¨‹è¿æ¥Docker</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="è¿œç¨‹è¿æ¥Dockeræœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼">è¿œç¨‹è¿æ¥Dockeræœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼</h2><h3 id="æ–¹å¼ä¸€ï¼šå¼€å¯-TCPï¼ˆä¸å¸¦-TLSï¼Œä»…ç”¨äºå†…ç½‘è°ƒè¯•ï¼‰">æ–¹å¼ä¸€ï¼šå¼€å¯ TCPï¼ˆä¸å¸¦ TLSï¼Œä»…ç”¨äºå†…ç½‘è°ƒè¯•ï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨dockeræœåŠ¡ç«¯ç¼–è¾‘ <code>/etc/docker/daemon.json</code>ï¼ŒåŠ ä¸Šï¼š</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;hosts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;unix:///var/run/docker.sock&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tcp://0.0.0.0:2375&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶é€šè¿‡<code>sudo systemctl restart docker</code>é‡å¯ Dockerä¼šå¯åŠ¨å¤±è´¥ï¼ŒåŸå› æ˜¯systemdä¼šåœ¨dockerå¯åŠ¨å‘½ä»¤ä¸­æ·»åŠ  <code>-H fd://</code>ï¼Œå…¶å«ä¹‰æ˜¯ä» systemd ä¼ é€’è¿›æ¥çš„ socket æ–‡ä»¶æè¿°ç¬¦ç›‘å¬ API è¯·æ±‚ï¼Œå½“ Docker è¢« systemd å¯åŠ¨å¹¶å¯ç”¨ socket activationï¼ˆå¥—æ¥å­—æ¿€æ´»ï¼‰æ—¶ï¼Œsystemd ä¼šé¢„å…ˆåˆ›å»º socketï¼ˆæ¯”å¦‚ /var/run/docker.sockï¼‰ï¼Œç„¶åå†å¯åŠ¨ dockerdï¼Œå¹¶é€šè¿‡æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰æŠŠè¿™ä¸ª socket ä¼ é€’ç»™ dockerdã€‚æ­¤æ—¶ä½ åœ¨ dockerd ä¸­çœ‹åˆ°çš„ <code>-H fd://</code> æ„æ€æ˜¯ï¼šâ€œä¸ç”¨è‡ªå·±æ‰“å¼€ socketï¼Œå» systemd é‚£é‡Œæ‹¿å§ã€‚â€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡è¯¥å‘½ä»¤å¯ä»¥è·å– docker çš„å¯åŠ¨å‘½ä»¤æ–‡ä»¶æ˜¯ /usr/lib/systemd/system/docker.service</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl status docker</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ /usr/lib/systemd/system/docker.serviceï¼Œå¯ä»¥çœ‹åˆ° dockerçš„å¯åŠ¨å‘½ä»¤å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°  -H fd://</span></span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line"><span class="comment"># å¦å¤–å¯ä»¥åœ¨ä¸ docker.service åŒç›®å½•ä¸‹æ‰¾åˆ°  docker.socket æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹</span></span><br><span class="line">ListenStream=/run/docker.sock <span class="comment"># /run ç›®å½•æ˜¯è¢«è½¯è¿æ¥åˆ° /var/run/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€»ç»“ï¼šé€šè¿‡systemd å¯åŠ¨ dockeræ—¶ï¼Œå¦‚æœé…ç½®äº† -H fd://ï¼Œåˆ™ docker ä¼šç›‘å¬ /run/docker.sock æ–‡ä»¶ï¼Œå®é™…ä¸Šä¹Ÿå°±æ˜¯ /var/run/docker.sock</span></span><br><span class="line"><span class="comment"># è€Œæˆ‘ä»¬åœ¨/etc/docker/daemon.jsonä¸­åŠ ä¸Šçš„&quot;unix:///var/run/docker.sock&quot;, &quot;tcp://0.0.0.0:2375&quot;å®é™…ä¸Šå°±æ˜¯æ”¹å†™dockerçš„å¯åŠ¨å‚æ•°ï¼Œè¿™å°±ä¸ systemd å¯åŠ¨ docker çš„ `-H fd://` å‚æ•°å†²çªäº†</span></span><br><span class="line"><span class="comment"># æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä¸ä½¿ç”¨systemd å¯åŠ¨ dockerï¼Œè€Œæ˜¯ä½¿ç”¨ docker daemon å¯åŠ¨ docker</span></span><br><span class="line"><span class="built_in">sudo</span> dockerd --containerd=/run/containerd/containerd.sock</span><br><span class="line"><span class="comment"># ä½†è¿™æ ·ä¸åˆ©äº docker çš„ç®¡ç†ï¼Œå› æ­¤æœ€å¥½çš„æ–¹å¼æ˜¯ç¦ç”¨ `-H fd://`</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¦ç”¨ <code>-H fd://</code>ï¼ˆsystemd ä¸ daemon.json å†²çªçš„æ ¹æºï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼ä¸€: å»æ‰ `-H fd://` å‚æ•°</span></span><br><span class="line"><span class="built_in">sudo</span> vi /usr/lib/systemd/system/docker.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼äºŒ(æ¨è): åˆ›å»º override.conf æ–‡ä»¶ï¼Œå…¶ä½œç”¨æ˜¯ è¦†ç›– systemd é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œåªä¼šè¦†ç›–æŒ‡å®šçš„å‚æ•°</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/systemd/system/docker.service.d</span><br><span class="line"><span class="built_in">sudo</span> vi /etc/systemd/system/docker.service.d/override.conf</span><br><span class="line"><span class="comment"># å¡«å…¥</span></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=</span><br><span class="line">ExecStart=/usr/bin/dockerd --containerd=/run/containerd/containerd.sock</span><br><span class="line"><span class="comment"># è¿™é‡Œé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œ`--containerd=/run/containerd/containerd.sock` æ˜¯ docker é»˜è®¤å‚æ•°ï¼Œ</span></span><br><span class="line"><span class="comment"># å‘Šè¯‰ Docker å®ˆæŠ¤è¿›ç¨‹å»è¿æ¥å·²æœ‰çš„ containerd å®ä¾‹ï¼Œè€Œä¸æ˜¯è‡ªå·±å¯åŠ¨ä¸€ä¸ªæ–°çš„ã€‚</span></span><br><span class="line"><span class="comment"># Docker é»˜è®¤å†…éƒ¨ä½¿ç”¨ containerd æ¥ç®¡ç†å®¹å™¨è¿è¡Œæ—¶ï¼Œæ‰€ä»¥è¿™æ¡å‚æ•°æ˜¯æ˜ç¡®æŒ‡å®šè¦ä½¿ç”¨å“ªä¸ª containerd æœåŠ¡ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡å¯ docker daemon</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨å®¢æˆ·ç«¯æµ‹è¯•è¿æ¥</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -H tcp://è¿œç¨‹IP:2375 ps</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨å®¢æˆ·ç«¯åŠ å…¥ç¯å¢ƒå˜é‡åå°±ä¸éœ€è¦æ¯æ¬¡éƒ½åŠ ä¸Š -H å‚æ•°äº†</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zsh å°±æ¢æˆ ~/.zshrc</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export DOCKER_HOST=tcp://è¿œç¨‹IP:2375&quot;</span>  &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>â—ä¸è¦å¼€å¯æ— è®¤è¯çš„ <code>tcp://0.0.0.0:2375</code> åœ¨å…¬ç½‘ï¼Œè¿™æ˜¯è£¸å¥”çš„å®‰å…¨é£é™©ï¼Œä»»ä½•äººéƒ½èƒ½æ§åˆ¶ä½ çš„ Dockerã€‚</p></li><li class="lvl-2"><p>âœ… æ¨èæ–¹å¼æ˜¯ï¼š</p><ul class="lvl-2"><li class="lvl-6">ä½¿ç”¨ <code>tcp://0.0.0.0:2376 + --tlsverify</code></li><li class="lvl-6">æˆ–é€šè¿‡ <code>ssh:// éš§é“</code> è®¿é—® Docker</li></ul></li></ul><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">é€šè¿‡ä¸Šé¢çš„ä»‹ç»ä½ åº”è¯¥ææ˜ç™½ä¸€ä»¶äº‹ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥ä¸ç”¨åœ¨ <code>/etc/docker/daemon.json</code> ä¸­é…ç½®è¿œç¨‹è¿æ¥ï¼Œè€Œæ˜¯é€šè¿‡ systemd æ¥é…ç½®ï¼Œå³åœ¨ <code>/usr/lib/systemd/system/docker.service</code> æˆ–è€… <code>/etc/systemd/system/docker.service.d/override.conf</code>ä¸­é…ç½®ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExecStart=/usr/bin/dockerd -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375 --containerd=/run/containerd/containerd.sock</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šæ—¢ç„¶ systemd å°±èƒ½æå®šä¸€åˆ‡ï¼Œé‚£è¿˜è¦ <code>/etc/docker/daemon.json</code> æœ‰ä»€ä¹ˆç”¨ï¼Ÿç­”æ¡ˆæ˜¯ï¼šå¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ã€å·¥å…·å…¼å®¹æ€§æ›´å¼ºã€‚</li></ul><table><thead><tr><th>é¡¹ç›®</th><th><code>daemon.json</code></th><th><code>systemd ExecStart</code></th></tr></thead><tbody><tr><td>è¯­æ³•</td><td>JSON</td><td>Shell å‘½ä»¤è¡Œ</td></tr><tr><td>é€‚åˆè®¾ç½®</td><td>Hostsã€æ—¥å¿—ã€registryã€é•œåƒé©±åŠ¨ç­‰</td><td>å¯åŠ¨å‘½ä»¤ã€èµ„æºé™åˆ¶ç­‰</td></tr><tr><td>å¯è¯»æ€§</td><td>ğŸ‘ ç»“æ„åŒ–</td><td>ğŸ‘ è¾ƒé•¿ã€å®¹æ˜“å‡ºé”™</td></tr><tr><td>è‡ªåŠ¨åŒ–æ”¯æŒ</td><td>ğŸ‘ å·¥å…·å‹å¥½</td><td>ğŸ‘ éœ€è¦ patch systemd</td></tr></tbody></table></div><h3 id="æ–¹å¼äºŒï¼šå¼€å¯-TCP-TLS-å®‰å…¨è®¿é—®ï¼ˆæ¨èç”¨äºå…¬ç½‘ï¼‰">æ–¹å¼äºŒï¼šå¼€å¯ TCP + TLS å®‰å…¨è®¿é—®ï¼ˆæ¨èç”¨äºå…¬ç½‘ï¼‰</h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º TLS è¯ä¹¦ï¼Œé€šè¿‡ä¸€ä¸ªè„šæœ¬å®ç°ï¼Œè„šæœ¬åç§° <code>generate-docker-certs.sh</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line">SERVER_IP=166.189.9.114  <span class="comment"># ğŸš¨ ä¿®æ”¹ä¸ºä½ çš„ Docker æœåŠ¡å™¨ IP æˆ–åŸŸå</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] åˆ›å»º CA...&quot;</span></span><br><span class="line">openssl genrsa -out ca-key.pem 4096</span><br><span class="line">openssl req -new -x509 -days 365 \</span><br><span class="line">  -key ca-key.pem -subj <span class="string">&quot;/CN=docker-ca&quot;</span> -out ca.pem</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] åˆ›å»ºæœåŠ¡å™¨ç§é’¥...&quot;</span></span><br><span class="line">openssl genrsa -out server-key.pem 4096</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] åˆ›å»º OpenSSL é…ç½®æ–‡ä»¶...&quot;</span></span><br><span class="line"><span class="built_in">cat</span> &gt; extfile.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[req]</span></span><br><span class="line"><span class="string">distinguished_name = req_distinguished_name</span></span><br><span class="line"><span class="string">x509_extensions = v3_req</span></span><br><span class="line"><span class="string">prompt = no</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[req_distinguished_name]</span></span><br><span class="line"><span class="string">CN = $&#123;SERVER_IP&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[v3_req]</span></span><br><span class="line"><span class="string">keyUsage = keyEncipherment, dataEncipherment</span></span><br><span class="line"><span class="string">extendedKeyUsage = serverAuth</span></span><br><span class="line"><span class="string">subjectAltName = @alt_names</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[alt_names]</span></span><br><span class="line"><span class="string">IP.1 = $&#123;SERVER_IP&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] åˆ›å»ºæœåŠ¡å™¨è¯ä¹¦ç­¾åè¯·æ±‚ (CSR)...&quot;</span></span><br><span class="line">openssl req -new -key server-key.pem \</span><br><span class="line">  -out server.csr -config extfile.cnf</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] ç­¾å‘æœåŠ¡å™¨è¯ä¹¦...&quot;</span></span><br><span class="line">openssl x509 -req -days 365 -<span class="keyword">in</span> server.csr \</span><br><span class="line">  -CA ca.pem -CAkey ca-key.pem -CAcreateserial \</span><br><span class="line">  -out server-cert.pem -extensions v3_req -extfile extfile.cnf</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] åˆ›å»ºå®¢æˆ·ç«¯ç§é’¥...&quot;</span></span><br><span class="line">openssl genrsa -out key.pem 4096</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] åˆ›å»ºå®¢æˆ·ç«¯ CSR...&quot;</span></span><br><span class="line">openssl req -new -key key.pem -subj <span class="string">&quot;/CN=client&quot;</span> -out client.csr</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦...&quot;</span></span><br><span class="line"><span class="built_in">cat</span> &gt; client-ext.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">extendedKeyUsage = clientAuth</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">openssl x509 -req -days 365 -<span class="keyword">in</span> client.csr \</span><br><span class="line">  -CA ca.pem -CAkey ca-key.pem -CAcreateserial \</span><br><span class="line">  -out cert.pem -extfile client-ext.cnf</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[âœ“] æ‰€æœ‰è¯ä¹¦ç”Ÿæˆå®Œæˆï¼&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; æœåŠ¡å™¨è¯ä¹¦: server-cert.pem, server-key.pem&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; å®¢æˆ·ç«¯è¯ä¹¦: cert.pem, key.pem&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; CAæ ¹è¯ä¹¦:   ca.pem&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰§è¡Œè„šæœ¬</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x generate-docker-certs.sh</span><br><span class="line">./generate-docker-certs.sh</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°†ä»¥ä¸‹è¯ä¹¦æ–‡ä»¶éƒ¨ç½²åˆ°dockeræœåŠ¡ç«¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœåŠ¡ç«¯ï¼šserver-cert.pem, server-key.pem, ca.pem</span></span><br><span class="line"><span class="built_in">cp</span> server-cert.pem /etc/docker/server-cert.pem</span><br><span class="line"><span class="built_in">cp</span> server-key.pem /etc/docker/server-key.pem</span><br><span class="line"><span class="built_in">cp</span> ca.pem /etc/docker/ca.pem</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°†ä»¥ä¸‹è¯ä¹¦æ–‡ä»¶éƒ¨ç½²åˆ°dockerå®¢æˆ·ç«¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cert.pem, key.pem, ca.pem</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨dockeræœåŠ¡ç«¯ç¼–è¾‘ <code>/etc/docker/daemon.json</code></p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;hosts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;unix:///var/run/docker.sock&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tcp://0.0.0.0:2376&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tlsverify&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tlscacert&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/docker/ca.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tlscert&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/docker/server-cert.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tlskey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/docker/server-key.pem&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¦ç”¨ <code>-H fd://</code>ï¼ˆsystemd ä¸ daemon.json å†²çªçš„æ ¹æºï¼‰</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/systemd/system/docker.service.d</span><br><span class="line"><span class="built_in">sudo</span> vi /etc/systemd/system/docker.service.d/override.conf</span><br><span class="line"><span class="comment"># å¡«å…¥</span></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=</span><br><span class="line">ExecStart=/usr/bin/dockerd --containerd=/run/containerd/containerd.sock</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡å¯ docker daemon</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨å®¢æˆ·ç«¯æµ‹è¯•è¿æ¥</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker \</span><br><span class="line">  --tlsverify \</span><br><span class="line">  --tlscacert=ca.pem \</span><br><span class="line">  --tlscert=cert.pem \</span><br><span class="line">  --tlskey=key.pem \</span><br><span class="line">  -H tcp://166.189.9.114:2376 \</span><br><span class="line">  ps</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨å®¢æˆ·ç«¯åŠ å…¥ç¯å¢ƒå˜é‡åå°±ä¸éœ€è¦æ¯æ¬¡éƒ½åŠ ä¸Š -H å‚æ•° å’Œè¯ä¹¦å‚æ•°äº†</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOT &gt;&gt; ~/.bashrc</span></span><br><span class="line"><span class="string"># è¿œç¨‹Docker IPå’Œç«¯å£</span></span><br><span class="line"><span class="string">export DOCKER_HOST=tcp://166.189.9.114:2376</span></span><br><span class="line"><span class="string"># ç”¨äºé€šè¿‡ TLSï¼ˆSSLï¼‰å®‰å…¨è¿æ¥è¿œç¨‹ Docker å®ˆæŠ¤è¿›ç¨‹ï¼Œç±»ä¼¼äº docker --tlsverify</span></span><br><span class="line"><span class="string">export DOCKER_TLS_VERIFY=1</span></span><br><span class="line"><span class="string"># è¿™ä¸ªç›®å½•ä¸‹è¦æœ‰è¿™äº›è¯ä¹¦æ–‡ä»¶ï¼šca.pem, cert.pem, key.pem</span></span><br><span class="line"><span class="string">export DOCKER_CERT_PATH=/path/to/certs</span></span><br><span class="line"><span class="string">EOT</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼ä¸‰ï¼šssh-éš§é“è®¿é—®">æ–¹å¼ä¸‰ï¼šssh:// éš§é“è®¿é—®</h3><ul class="lvl-0"><li class="lvl-2"><p>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨ ssh è¿œç¨‹æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¸éœ€è¦ä»»ä½•é…ç½®ï¼Œæ”¯æŒå¯†ç å’Œè¯ä¹¦è®¤è¯ï¼Œä¹Ÿæ”¯æŒæŒ‡å®šç«¯å£ï¼Œä½†è¿™ä¸æ˜¯æ ‡å‡†çš„è¿œç¨‹è¿æ¥dockeræ–¹å¼ï¼Œé€‚ç”¨äºå¶å°”è®¿é—®çš„æƒ…å†µã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i ~/.ssh/lexing-test.pem -p22 centos@166.189.9.114 <span class="string">&quot;docker ps&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŸºäºå…å¯†è®¤è¯ï¼Œå¦‚ä½•é…ç½®å…å¯†ç™»å½•å¯ä»¥å‚è€ƒ <a href="/2023/02/28/linux-command02-ssh/" title="Linuxå¸¸ç”¨å‘½ä»¤--sshã€scpä¸å…å¯†ç™»å½•">Linuxå¸¸ç”¨å‘½ä»¤--sshã€scpä¸å…å¯†ç™»å½•</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker -H è¿œç¨‹è®¿é—® ä¸æ”¯æŒåœ¨å‘½ä»¤è¡Œç›´æ¥è¾“å…¥å¯†ç æˆ–å¯†é’¥æ–‡ä»¶ï¼Œå¿…é¡»é…ç½®å…å¯†ç™»å½•æ‰å¯ä»¥ï¼Œè€Œä¸”æ­¤æ—¶ç«¯å£å¿…é¡»æ˜¯é»˜è®¤çš„22</span></span><br><span class="line"><span class="comment"># è¦æ±‚ç™»å½•ç”¨æˆ·å¿…é¡»æ‹¥æœ‰dockerçš„è¿è¡Œæƒé™ï¼ˆåŠ å…¥ docker groupï¼‰</span></span><br><span class="line">docker -H ssh://centos@166.189.9.114 ps</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŸºäº<code>config</code>é…ç½®(æ¨è)</p><ul class="lvl-2"><li class="lvl-6">è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥é…ç½®è¯ä¹¦å’Œç«¯å£</li><li class="lvl-6">åœ¨ ~/.ssh/config ä¸­æŒ‡å®šå…·ä½“çš„å¯†é’¥æ–‡ä»¶å’Œç«¯å£ï¼Œç™»å½•ç”¨æˆ·å¿…é¡»æ‹¥æœ‰dockerçš„è¿è¡Œæƒé™ï¼ˆåŠ å…¥ docker groupï¼‰</li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host mydocker</span><br><span class="line">HostName 166.189.9.114</span><br><span class="line">User centos</span><br><span class="line">Port 22</span><br><span class="line">IdentityFile ~/.ssh/my_docker_key</span><br></pre></td></tr></table></figure><ul class="lvl-2"><li class="lvl-6">æµ‹è¯•</li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -H ssh://mydocker ps</span><br></pre></td></tr></table></figure></li><li class="lvl-2"><p>æ·»åŠ ç¯å¢ƒå˜é‡é¿å…æ¯æ¬¡éƒ½åŠ ä¸Š <code>-H</code> å‚æ•°</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## åŸºäºå…å¯†è®¤è¯</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export DOCKER_HOST=ssh://user@host&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="comment">## æˆ–è€…åŸºäºconfigçš„æ–¹å¼</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export DOCKER_HOST=ssh://mydocker&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure><h2 id="docker-context-åŒæ—¶è¿æ¥å¤šä¸ªè¿œç¨‹docker"><code>docker context</code>: åŒæ—¶è¿æ¥å¤šä¸ªè¿œç¨‹docker</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢ä»‹ç»çš„ä¸‰ç§æ–¹å¼ï¼Œä¸ºäº†ç®€åŒ–è¿æ¥ï¼Œéƒ½åŠ ä¸Šäº†<code>DOCKER_HOST</code>ç¯å¢ƒå˜é‡ï¼Œä½†æ˜¯<code>DOCKER_HOST</code>åªèƒ½é…ç½®ä¸€ä¸ªï¼Œå¦‚æœæˆ‘ä»¬è¦åŒæ—¶è¿æ¥å¤šä¸ªè¿œç¨‹dockeræœåŠ¡å‘¢ï¼Œæ¯æ¬¡åˆ‡æ¢<code>DOCKER_HOST</code>ç¯å¢ƒå˜é‡å¤ªè¿‡ç¹çï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ä¸ºæ¯ä¸ªè¿œç¨‹dockeræœåŠ¡åˆ›å»ºä¸€ä¸ª <code>context</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TCP</span></span><br><span class="line">docker context create remote-tcp \</span><br><span class="line">    --docker <span class="string">&quot;host=tcp://166.189.9.114:2375&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># TCP + TLS</span></span><br><span class="line">docker context create remote-tls \</span><br><span class="line">  --docker <span class="string">&quot;host=tcp://166.189.9.114:2376,ca=/path/ca.pem,cert=/path/cert.pem,key=/path/key.pem&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sshéš§é“</span></span><br><span class="line">docker context create remote-ssh --docker <span class="string">&quot;host=ssh://mydocker&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨</span></span><br><span class="line">docker context <span class="built_in">ls</span> <span class="comment"># åˆ—å‡ºæ‰€æœ‰context</span></span><br><span class="line">docker context use remote-ssh <span class="comment"># åˆ‡æ¢åˆ°æŒ‡å®šçš„context</span></span><br><span class="line">docker ps <span class="comment"># æŸ¥çœ‹å®¹å™¨</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker context</code> æ˜¯ Docker CLI çš„ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½ï¼Œå®ƒè®©ä½ å¯ä»¥è½»æ¾åœ°åœ¨ å¤šä¸ª Docker åç«¯ç¯å¢ƒä¹‹é—´åˆ‡æ¢ï¼Œæ¯”å¦‚ï¼š</p><ul class="lvl-2"><li class="lvl-6">æœ¬åœ° Dockerï¼ˆé»˜è®¤ï¼‰</li><li class="lvl-6">è¿œç¨‹ä¸»æœºçš„ Dockerï¼ˆé€šè¿‡ SSH æˆ– TCP/TLSï¼‰</li><li class="lvl-6">Docker Desktop</li><li class="lvl-6">Docker Swarm æˆ– Kubernetesï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰</li></ul></li><li class="lvl-2"><p>å°±åƒä½ ç”¨ <code>kubectl config use-context</code> åˆ‡æ¢ Kubernetes é›†ç¾¤ï¼Œ<code>docker context</code> ä¹Ÿå…è®¸ä½ åœ¨å¤šä¸ª Docker åç«¯ä¹‹é—´åˆ‡æ¢ï¼Œè€Œæ— éœ€åå¤è®¾ç½® <code>DOCKER_HOST</code> ç¯å¢ƒå˜é‡æˆ–å†™ç¹ççš„ SSH éš§é“å‘½ä»¤ã€‚</p></li><li class="lvl-2"><p>å¸¸ç”¨å‘½ä»¤ä¸€è§ˆ</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>docker context ls</code></td><td>åˆ—å‡ºæ‰€æœ‰ä¸Šä¸‹æ–‡</td></tr><tr><td><code>docker context use &lt;name&gt;</code></td><td>åˆ‡æ¢åˆ°æŒ‡å®š context</td></tr><tr><td><code>docker context create &lt;name&gt; --docker &quot;Docker endpoint config&quot;</code></td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„ context</td></tr><tr><td><code>docker context rm &lt;name&gt;</code></td><td>åˆ é™¤ context</td></tr><tr><td><code>docker context inspect &lt;name&gt;</code></td><td>æŸ¥çœ‹ context è¯¦æƒ…</td></tr><tr><td><code>docker context update &lt;name&gt; --docker &quot;Docker endpoint config&quot;</code></td><td>æ›´æ–° context å‚æ•°ï¼ˆDocker 24+ æ”¯æŒï¼‰</td></tr><tr><td><code>docker context show</code></td><td>æ˜¾ç¤ºå½“å‰ context</td></tr><tr><td><code>docker context export &lt;name&gt; &lt;file.tar&gt;</code></td><td>å¯¼å‡º context åˆ°taræ–‡ä»¶</td></tr><tr><td><code>docker context import &lt;name&gt; &lt;file.tar&gt;</code></td><td>å¯¼å…¥ context ä»taræ–‡ä»¶</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Docker endpoint config</p></li></ul><table><thead><tr><th>å‚æ•°å</th><th>ä¸­æ–‡æè¿°</th></tr></thead><tbody><tr><td><code>from</code></td><td>å¤åˆ¶æŒ‡å®š context åç§° çš„ Docker ç«¯ç‚¹é…ç½®</td></tr><tr><td><code>host</code></td><td>è¦è¿æ¥çš„ Docker ç«¯ç‚¹åœ°å€</td></tr><tr><td><code>ca</code></td><td>CA ç­¾åçš„è¯ä¹¦çš„è·¯å¾„</td></tr><tr><td><code>cert</code></td><td>TLS è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„</td></tr><tr><td><code>key</code></td><td>TLS å¯†é’¥æ–‡ä»¶çš„è·¯å¾„</td></tr><tr><td><code>skip-tls-verify</code></td><td>è·³è¿‡ TLS è¯ä¹¦éªŒè¯ï¼ˆâš ï¸ ä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰</td></tr></tbody></table><h2 id="ä¸‰ç§è¿œç¨‹è¿æ¥-Docker-çš„æ–¹å¼åŠå…¶ä¼˜ç¼ºç‚¹æ€»ç»“">ä¸‰ç§è¿œç¨‹è¿æ¥ Docker çš„æ–¹å¼åŠå…¶ä¼˜ç¼ºç‚¹æ€»ç»“</h2><table><thead><tr><th>è¿æ¥æ–¹å¼</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>1. SSH æ–¹å¼ (<code>ssh://</code>)</strong></td><td>- é…ç½®ç®€å•ï¼Œæ— éœ€é¢å¤–å¼€å¯ Docker TCP ç«¯å£å’Œ TLS<br>- å®‰å…¨æ€§é«˜ï¼ŒåŸºäº SSH åŠ å¯†å’Œè®¤è¯<br>- ä¸ç”¨å¼€æ”¾é¢å¤–ç«¯å£ï¼Œé˜²ç«å¢™å‹å¥½<br>- æ˜“äºç”¨ SSH ä»£ç†å’Œå¯†é’¥ç®¡ç†</td><td>- éœ€è¦è¿œç¨‹ç”¨æˆ·æœ‰ Docker æƒé™ï¼ˆå¦‚å±äº <code>docker</code> ç»„ï¼‰<br>- è¿æ¥é€Ÿåº¦å¯èƒ½å— SSH è¿æ¥å½±å“<br>- éœ€è¦åœ¨æœ¬åœ°å®‰è£…å¹¶é…ç½® SSH</td><td>å¼€å‘ç¯å¢ƒã€å†…ç½‘ç®¡ç†ã€å°è§„æ¨¡è¿œç¨‹æ“ä½œ</td></tr><tr><td><strong>2. TCP + TLS æ–¹å¼</strong></td><td>- æ ‡å‡†çš„è¿œç¨‹ Docker API è®¿é—®<br>- æ”¯æŒè¯ä¹¦è®¤è¯ï¼Œå®‰å…¨æ€§é«˜<br>- å¯ä»¥é…ç½®å¤šä¸ªå®¢æˆ·ç«¯å’Œæƒé™æ§åˆ¶<br>- é€‚åˆè‡ªåŠ¨åŒ–è„šæœ¬ã€CI/CD è®¿é—®</td><td>- é…ç½®è¾ƒå¤æ‚ï¼Œéœ€è¦ç”Ÿæˆå’Œç®¡ç† CAã€æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¯ä¹¦<br>- éœ€è¦å¼€æ”¾ TCP ç«¯å£ï¼ˆå¦‚ 2376ï¼‰ï¼Œå¢åŠ å®‰å…¨é£é™©<br>- è¯ä¹¦é…ç½®é”™è¯¯å®¹æ˜“å¯¼è‡´è¿æ¥å¤±è´¥</td><td>ç”Ÿäº§ç¯å¢ƒã€è‡ªåŠ¨åŒ–é›†æˆã€éœ€è¦é«˜å®‰å…¨è®¤è¯</td></tr><tr><td><strong>3. TCP æ˜æ–‡è®¿é—®ï¼ˆæ—  TLSï¼‰</strong></td><td>- é…ç½®æœ€ç®€å•ï¼Œåªéœ€ç›‘å¬ TCP ç«¯å£<br>- æ–¹ä¾¿å¿«é€Ÿæµ‹è¯•å’Œè°ƒè¯•</td><td>- æåº¦ä¸å®‰å…¨ï¼Œæ•°æ®æ˜æ–‡ä¼ è¾“<br>- ä»»ä½•äººéƒ½å¯è®¿é—® Docker APIï¼Œææ˜“è¢«æ”»å‡»<br>- ç”Ÿäº§ç¯å¢ƒä¸¥é‡ä¸å»ºè®®ä½¿ç”¨</td><td>ä»…é™å±€åŸŸç½‘å†…æµ‹è¯•æˆ–æç®€ç¯å¢ƒ</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•è¿œç¨‹è¿æ¥Docker&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker å‘½ä»¤ ä¹‹ docker compose</title>
    <link href="https://blog.hanqunfeng.com/2025/06/04/docker-compose/"/>
    <id>https://blog.hanqunfeng.com/2025/06/04/docker-compose/</id>
    <published>2025-06-04T13:30:05.000Z</published>
    <updated>2025-06-28T04:27:36.761Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ <code>docker compose</code> çš„ä½¿ç”¨æ–¹æ³•</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/compose/">docker compose</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/reference/compose-file/">Compose file reference</a></p></li></ul><span id="more"></span><h2 id="docker-compose-æ˜¯ä»€ä¹ˆï¼Ÿ"><code>docker compose</code> æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul class="lvl-0"><li class="lvl-2"><p>Docker Composeæ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚</p></li><li class="lvl-2"><p>Composeç®€åŒ–äº†å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºå †æ ˆçš„æ§åˆ¶ï¼Œä¾¿äºåœ¨å•ä¸ªYAMLé…ç½®æ–‡ä»¶ä¸­ç®¡ç†æœåŠ¡ã€ç½‘ç»œå’Œå·ã€‚ç„¶åï¼Œé€šè¿‡ä¸€ä¸ªå‘½ä»¤ï¼Œæ‚¨ä»é…ç½®æ–‡ä»¶ä¸­åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ã€‚</p></li><li class="lvl-2"><p>Docker Compose çš„ä¼˜åŠ¿ï¼š</p></li></ul><table><thead><tr><th>ä¼˜ç‚¹</th><th>æè¿°</th></tr></thead><tbody><tr><td>ç®€åŒ–æ§åˆ¶</td><td>Docker Compose å…è®¸åœ¨å•ä¸ª YAML æ–‡ä»¶ä¸­å®šä¹‰å’Œç®¡ç†å¤šå®¹å™¨åº”ç”¨ç¨‹åºï¼Œç®€åŒ–äº†æœåŠ¡ç¼–æ’ä¸åè°ƒï¼Œä½¿ç¯å¢ƒç®¡ç†å’Œå¤åˆ¶æ›´å®¹æ˜“ã€‚</td></tr><tr><td>é«˜æ•ˆçš„åä½œ</td><td>é…ç½®æ–‡ä»¶æ˜“äºå…±äº«ï¼Œä¿ƒè¿›å¼€å‘äººå‘˜ã€è¿è¥å›¢é˜Ÿå’Œå…¶ä»–åˆ©ç›Šç›¸å…³è€…ä¹‹é—´çš„åä½œï¼Œä»è€Œæå‡å·¥ä½œæµç¨‹æ•ˆç‡å’Œé—®é¢˜è§£å†³é€Ÿåº¦ã€‚</td></tr><tr><td>å¿«é€Ÿåº”ç”¨ç¨‹åºå¼€å‘</td><td>Compose åˆ©ç”¨ç¼“å­˜é‡å¤ä½¿ç”¨æœªæ›´æ”¹æœåŠ¡çš„å®¹å™¨ï¼ŒåŠ å¿«ç¯å¢ƒå˜æ›´é€Ÿåº¦ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</td></tr><tr><td>è·¨ç¯å¢ƒçš„å¯ç§»æ¤æ€§</td><td>æ”¯æŒåœ¨ Compose æ–‡ä»¶ä¸­ä½¿ç”¨å˜é‡ï¼Œä½¿é…ç½®èƒ½æ ¹æ®ä¸åŒç¯å¢ƒæˆ–ç”¨æˆ·è¿›è¡Œè‡ªå®šä¹‰ï¼Œå¢å¼ºäº†å¯ç§»æ¤æ€§ã€‚</td></tr><tr><td>å¹¿æ³›çš„ç¤¾åŒºå’Œæ”¯æŒ</td><td>æ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºï¼Œæä¾›ä¸°å¯Œçš„èµ„æºã€æ•™ç¨‹å’ŒæŠ€æœ¯æ”¯æŒï¼Œæœ‰åŠ©äºæŒç»­æ”¹è¿›ä¸é«˜æ•ˆæ’éšœã€‚</td></tr></tbody></table><h2 id="docker-compose-å®‰è£…"><code>docker compose</code> å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>åŒdockerä¸€èµ·å®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…dockeråŒæ—¶å®‰è£…docker composeï¼Œè¿™é‡Œ docker-compose-plugin å°±æ˜¯docker compose</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install docker-ce-3:26.1.3-1.el8 docker-ce-cli-3:26.1.3-1.el8 containerd.io docker-buildx-plugin docker-compose-plugin -y</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å•ç‹¬å®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‹¥å®‰è£…dockeræ—¶æ²¡æœ‰å®‰è£… docker-compose-plugin ï¼Œåˆ™éœ€è¦å•ç‹¬å®‰è£…</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install docker-compose-plugin -y</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ç‰ˆæœ¬</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose version</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>ç›´æ¥ä¸‹è½½docker-composeçš„å‘½ä»¤æ–‡ä»¶</strong></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install Docker Composeï¼Œæ³¨æ„é€šè¿‡è¿™ç§æ–¹å¼å®‰è£…çš„composeçš„ä½¿ç”¨æ–¹å¼ä¸º `docker-compose`ï¼Œè€Œéæ ‡å‡†çš„ `docker compose`</span></span><br><span class="line"><span class="built_in">sudo</span> curl -L <span class="string">&quot;https://github.com/docker/compose/releases/latest/download/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="comment"># Make the docker-compose command available</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="comment"># Check Docker Compose version</span></span><br><span class="line">docker-compose version</span><br></pre></td></tr></table></figure></div><h2 id="docker-compose-å‘½ä»¤"><code>docker compose</code> å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä¸­æ–‡è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>attach</td><td>è¿æ¥åˆ°æœåŠ¡çš„è¿è¡Œä¸­å®¹å™¨çš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æµ</td><td><code>docker compose attach web</code></td></tr><tr><td>build</td><td>æ„å»ºæˆ–é‡æ–°æ„å»ºæœåŠ¡</td><td><code>docker compose build</code></td></tr><tr><td>config</td><td>è§£æå¹¶æ ‡å‡†åŒ– Compose æ–‡ä»¶</td><td><code>docker compose config</code></td></tr><tr><td>cp</td><td>åœ¨æœåŠ¡å®¹å™¨ä¸æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹‹é—´å¤åˆ¶æ–‡ä»¶/æ–‡ä»¶å¤¹</td><td><code>docker compose cp web:/app/file.txt ./file.txt</code></td></tr><tr><td>create</td><td>ä¸ºæœåŠ¡åˆ›å»ºå®¹å™¨ï¼Œä½†ä¸å¯åŠ¨</td><td><code>docker compose create</code></td></tr><tr><td>down</td><td>åœæ­¢å¹¶ç§»é™¤å®¹å™¨ã€ç½‘ç»œç­‰èµ„æº</td><td><code>docker compose down</code></td></tr><tr><td>events</td><td>å®æ—¶æ¥æ”¶å®¹å™¨äº‹ä»¶</td><td><code>docker compose events</code></td></tr><tr><td>exec</td><td>åœ¨è¿è¡Œä¸­çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</td><td><code>docker compose exec web ls /app</code></td></tr><tr><td>images</td><td>åˆ—å‡ºå·²åˆ›å»ºå®¹å™¨æ‰€ä½¿ç”¨çš„é•œåƒ</td><td><code>docker compose images</code></td></tr><tr><td>kill</td><td>å¼ºåˆ¶åœæ­¢æœåŠ¡å®¹å™¨</td><td><code>docker compose kill</code></td></tr><tr><td>logs</td><td>æŸ¥çœ‹æœåŠ¡å®¹å™¨çš„æ—¥å¿—è¾“å‡º</td><td><code>docker compose logs</code></td></tr><tr><td>ls</td><td>åˆ—å‡ºå½“å‰è¿è¡Œçš„ Compose é¡¹ç›®</td><td><code>docker compose ls</code></td></tr><tr><td>pause</td><td>æš‚åœæœåŠ¡å®¹å™¨</td><td><code>docker compose pause</code></td></tr><tr><td>port</td><td>æ˜¾ç¤ºæŸç«¯å£æ˜ å°„çš„å…¬ç½‘åœ°å€</td><td><code>docker compose port web 80</code></td></tr><tr><td>ps</td><td>åˆ—å‡ºæœåŠ¡çš„å®¹å™¨</td><td><code>docker compose ps</code></td></tr><tr><td>pull</td><td>æ‹‰å–æœåŠ¡ä½¿ç”¨çš„é•œåƒ</td><td><code>docker compose pull</code></td></tr><tr><td>push</td><td>æ¨é€æœåŠ¡é•œåƒåˆ°ä»“åº“</td><td><code>docker compose push</code></td></tr><tr><td>restart</td><td>é‡å¯æœåŠ¡å®¹å™¨</td><td><code>docker compose restart</code></td></tr><tr><td>rm</td><td>ç§»é™¤å·²åœæ­¢çš„æœåŠ¡å®¹å™¨</td><td><code>docker compose rm</code></td></tr><tr><td>run</td><td>åœ¨æœåŠ¡ä¸Šè¿è¡Œä¸€æ¬¡æ€§å‘½ä»¤</td><td><code>docker compose run web echo Hello</code></td></tr><tr><td>scale</td><td>æ‰©å±•æœåŠ¡å®ä¾‹æ•°é‡</td><td><code>docker compose up --scale web=3</code></td></tr><tr><td>start</td><td>å¯åŠ¨å·²å­˜åœ¨ä½†å·²åœæ­¢çš„æœåŠ¡å®¹å™¨</td><td><code>docker compose start</code></td></tr><tr><td>stats</td><td>å®æ—¶æ˜¾ç¤ºå®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ</td><td><code>docker compose stats</code></td></tr><tr><td>stop</td><td>åœæ­¢è¿è¡Œä¸­çš„æœåŠ¡å®¹å™¨</td><td><code>docker compose stop</code></td></tr><tr><td>top</td><td>æ˜¾ç¤ºå®¹å™¨å†…çš„è¿è¡Œè¿›ç¨‹</td><td><code>docker compose top</code></td></tr><tr><td>unpause</td><td>å–æ¶ˆæš‚åœæœåŠ¡å®¹å™¨</td><td><code>docker compose unpause</code></td></tr><tr><td>up</td><td>åˆ›å»ºå¹¶å¯åŠ¨æœåŠ¡å®¹å™¨</td><td><code>docker compose up</code></td></tr><tr><td>version</td><td>æ˜¾ç¤º Docker Compose ç‰ˆæœ¬ä¿¡æ¯</td><td><code>docker compose version</code></td></tr><tr><td>wait</td><td>é˜»å¡ç›´åˆ°ç¬¬ä¸€ä¸ªæœåŠ¡å®¹å™¨åœæ­¢</td><td><code>docker compose wait</code></td></tr><tr><td>watch</td><td>ç›‘å¬æœåŠ¡æ„å»ºä¸Šä¸‹æ–‡å˜æ›´å¹¶é‡æ–°æ„å»º/åˆ·æ–°å®¹å™¨</td><td><code>docker compose watch</code></td></tr></tbody></table><h3 id="docker-compose-å¸¸ç”¨å‘½ä»¤"><code>docker compose</code> å¸¸ç”¨å‘½ä»¤</h3><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ä¸å…³é—­</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨å¹¶è¿è¡Œï¼Œé»˜è®¤ä½¿ç”¨å½“å‰ç›®å½•çš„ docker-compose.yml æ–‡ä»¶</span></span><br><span class="line">docker compose up</span><br><span class="line"><span class="comment"># åå°è¿è¡Œ</span></span><br><span class="line">docker compose up -d</span><br><span class="line"><span class="comment"># æŒ‡å®šcomposeæ–‡ä»¶</span></span><br><span class="line">docker compose -f docker-compose.yml up -d</span><br><span class="line"><span class="comment"># å¯åŠ¨æ—¶é‡å»ºæœåŠ¡ï¼Œå½“ä¿®æ”¹äº† compose æ–‡ä»¶æ—¶</span></span><br><span class="line">docker compose up --build</span><br><span class="line"><span class="comment"># åœæ­¢service</span></span><br><span class="line">docker compose stop</span><br><span class="line"><span class="comment"># å¼ºåˆ¶åœæ­¢serviceï¼Œå½“ stop å‘½ä»¤æ— æ³•åœæ­¢æ—¶</span></span><br><span class="line">docker compose <span class="built_in">kill</span></span><br><span class="line"><span class="comment"># é‡å¯service</span></span><br><span class="line">docker compose restart</span><br><span class="line"><span class="comment"># åˆ é™¤serviceï¼Œ-s å‚æ•°è¡¨ç¤ºåˆ é™¤å‰å…ˆåœæ­¢å®¹å™¨</span></span><br><span class="line">docker compose <span class="built_in">rm</span> -s</span><br><span class="line"><span class="comment"># åœæ­¢å¹¶åˆ é™¤serviceï¼ŒåŒæ—¶åˆ é™¤ç½‘ç»œï¼Œä½†ä¸ä¼šåˆ é™¤å·</span></span><br><span class="line">docker compose down</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç›‘æ§</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºå½“å‰è¿è¡Œçš„ Compose é¡¹ç›®</span></span><br><span class="line">docker compose <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹serviceçŠ¶æ€ï¼Œ-a æ˜¾ç¤ºæ‰€æœ‰service</span></span><br><span class="line">docker compose ps -a</span><br><span class="line"><span class="comment"># è§£æå¹¶æ ‡å‡†åŒ– compose æ–‡ä»¶ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥æ£€æŸ¥ docker-compose.yml æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œä½†ä¸ä¿è¯é€»è¾‘æ­£ç¡®</span></span><br><span class="line">docker compose config</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä½¿ç”¨çš„é•œåƒ</span></span><br><span class="line">docker compose images</span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¿›ç¨‹</span></span><br><span class="line">docker compose top</span><br><span class="line"><span class="comment"># æŸ¥çœ‹serviceèµ„æºä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">docker compose stats</span><br><span class="line"><span class="comment"># æŸ¥çœ‹serviceæ—¥å¿—ï¼Œ-f è¡¨ç¤ºæŒç»­è·Ÿè¸ª</span></span><br><span class="line">docker compose logs -f</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šserviceçš„æ—¥å¿—</span></span><br><span class="line">docker compose logs -f service_name</span><br><span class="line"><span class="comment"># è¿›å…¥æŒ‡å®šçš„serviceå®¹å™¨</span></span><br><span class="line">docker compose <span class="built_in">exec</span> service_name bash</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‡çº§é•œåƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆåœæ­¢æ‰€æœ‰service</span></span><br><span class="line">docker compose down</span><br><span class="line"><span class="comment"># æ‹‰å–æœ€æ–°é•œåƒ</span></span><br><span class="line">docker compose pull</span><br><span class="line"><span class="comment"># å¯åŠ¨service</span></span><br><span class="line">docker compose up -d --build</span><br></pre></td></tr></table></figure><h2 id="docker-compose-yml-çš„è¯­æ³•"><code>docker-compose.yml</code> çš„è¯­æ³•</h2><ul class="lvl-0"><li class="lvl-2"><p>å¸¸ç”¨æŒ‡ä»¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.8&quot;</span> <span class="comment"># å®šä¹‰ç‰ˆæœ¬ï¼Œè¡¨ç¤ºå½“å‰ä½¿ç”¨çš„ docker compose è¯­æ³•çš„ç‰ˆæœ¬ï¼Œå·²è¿‡æ—¶ ï¼Œæ–°ç‰ˆ Docker ä¼šä½¿ç”¨æœ€æ–°çš„ Compose Specification è‡ªåŠ¨è§£æ</span></span><br><span class="line">name: <span class="string">&quot;project_name&quot;</span> <span class="comment">#  é¡¹ç›®åï¼Œé»˜è®¤ docker-compose.yml æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åï¼Œä¸æ¨èè®¾ç½®</span></span><br><span class="line">services: <span class="comment"># æœåŠ¡åˆ—è¡¨</span></span><br><span class="line">  servicename: <span class="comment"># æœåŠ¡åå­—ï¼Œåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ä¸­åˆ’çº¿ï¼Œå¿…é¡»ä»¥å­—æ¯æˆ–æ•°å­—å¼€å¤´</span></span><br><span class="line">    build: <span class="comment"># åŸºäºDockerfileæ„å»ºç›®å½•ï¼Œå¦‚æœåŒæ—¶è®¾ç½®äº† image é€‰é¡¹ï¼Œåˆ™imageæŒ‡å®šçš„å°±æ˜¯æ„å»ºåçš„é•œåƒåç§°</span></span><br><span class="line">    image: <span class="comment"># é•œåƒçš„åå­—ï¼Œé»˜è®¤ä»è¿œç¨‹ä»“åº“æ‹‰å–ï¼Œå¦‚æœé…ç½®äº† build é€‰é¡¹ï¼Œåˆ™imageæŒ‡å®šçš„å°±æ˜¯æ„å»ºåçš„é•œåƒåç§°</span></span><br><span class="line">    <span class="built_in">command</span>: <span class="comment"># å¯é€‰ï¼Œå¦‚æœè®¾ç½®ï¼Œåˆ™ä¼šè¦†ç›–é»˜è®¤é•œåƒé‡Œçš„ CMD å‘½ä»¤</span></span><br><span class="line">    environment: <span class="comment"># å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ --env é€‰é¡¹è®¾ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">    volumes: <span class="comment"># å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ -v é€‰é¡¹ ç»‘å®šæ•°æ®å·</span></span><br><span class="line">    networks: <span class="comment"># å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ --network é€‰é¡¹æŒ‡å®šç½‘ç»œ</span></span><br><span class="line">    ports: <span class="comment"># å¯é€‰ï¼Œç­‰ä»·äº docker container run é‡Œçš„ -p é€‰é¡¹æŒ‡å®šç«¯å£æ˜ å°„</span></span><br><span class="line">    expose: <span class="comment"># å¯é€‰ï¼ŒæŒ‡å®šå®¹å™¨æš´éœ²çš„ç«¯å£</span></span><br><span class="line">    depends_on: <span class="comment"># æœåŠ¡ä¾èµ–çš„å…¶å®ƒæœåŠ¡</span></span><br><span class="line">    env_file: <span class="comment"># ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒæ›´æ¨èè¿™ç§æ–¹å¼</span></span><br><span class="line">  servicename2:</span><br><span class="line">    image:</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">    networks:</span><br><span class="line">    ports:</span><br><span class="line">  servicename3:</span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line"></span><br><span class="line">volumes: <span class="comment"># å¯é€‰ï¼Œç­‰ä»·äº docker volume create</span></span><br><span class="line">networks: <span class="comment"># å¯é€‰ï¼Œç­‰ä»·äº docker network create</span></span><br></pre></td></tr></table></figure><h3 id="volumes">volumes</h3><ul class="lvl-0"><li class="lvl-2"><p>å·æ˜¯ç”±å®¹å™¨å¼•æ“å®ç°çš„æŒä¹…æ•°æ®å­˜å‚¨ã€‚Compose ä¸ºæœåŠ¡æä¾›äº†ä¸€ç§ä¸­ç«‹çš„æŒ‚è½½å·çš„æ–¹å¼ï¼Œå¹¶é€šè¿‡é…ç½®å‚æ•°å°†å·åˆ†é…ç»™åŸºç¡€æ¶æ„ã€‚é¡¶çº§volumeså£°æ˜å…è®¸æ‚¨é…ç½®å¯åœ¨å¤šä¸ªæœåŠ¡ä¹‹é—´é‡å¤ä½¿ç”¨çš„å‘½åå·ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/database</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># æŒ‚è½½å·æ˜ å°„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db-data:/etc/data</span> <span class="comment"># æŒ‚è½½åˆ°å®¹å™¨çš„/etc/dataç›®å½•</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">backup:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">backup-service</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db-data:/var/lib/backup/data</span> <span class="comment"># ä¸€ä¸ªå·å¯ä»¥è¢«å¤šä¸ªæœåŠ¡ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span> <span class="comment"># å­˜å‚¨å·é…ç½®</span></span><br><span class="line">  <span class="attr">db-data:</span>  <span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸ºdb-dataçš„å·ï¼Œå®é™…çš„ç½‘ç»œåç§°æ˜¯ å®¹å™¨ç»„åç§°_è¿™é‡Œçš„åç§°</span></span><br></pre></td></tr></table></figure><h4 id="volumes-çš„å±æ€§">volumes çš„å±æ€§</h4><ul class="lvl-0"><li class="lvl-2"><p>driver: å·ç±»å‹ï¼Œé»˜è®¤ä¸ºlocalï¼ŒæŒ‡å®šåº”ä½¿ç”¨å“ªä¸ªå·é©±åŠ¨ç¨‹åºã€‚å¦‚æœè¯¥é©±åŠ¨ç¨‹åºä¸å¯ç”¨ï¼ŒCompose å°†è¿”å›é”™è¯¯å¹¶ä¸”ä¸ä¼šéƒ¨ç½²è¯¥åº”ç”¨ç¨‹åºã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span> <span class="comment"># å£°æ˜ä¸€ä¸ªåä¸ºdb-dataçš„å·</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span> <span class="comment"># æŒ‡å®šå·ç±»å‹ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ï¼Œå¯ä»¥ä¸é…ç½®</span></span><br><span class="line">  <span class="attr">db-data2:</span> <span class="comment"># å£°æ˜ä¸€ä¸ªåä¸ºdb-data2çš„å·ï¼Œè¿™æ˜¯æœ€ç®€å•çš„ volumes é…ç½®</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>driver_opts: å·ç±»å‹å‚æ•°ï¼ŒæŒ‡å®šè¦ä¼ é€’ç»™æ­¤å·é©±åŠ¨ç¨‹åºçš„é€‰é¡¹åˆ—è¡¨ï¼ˆä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼‰ã€‚è¿™äº›é€‰é¡¹ä¸é©±åŠ¨ç¨‹åºç›¸å…³ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br><span class="line">    <span class="attr">driver_opts:</span> <span class="comment"># å·ç±»å‹å‚æ•°ï¼ŒæŒ‡å®šè¦ä¼ é€’ç»™æ­¤å·é©±åŠ¨ç¨‹åºçš„é€‰é¡¹åˆ—è¡¨ï¼ˆä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼‰</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">&quot;nfs&quot;</span> <span class="comment"># å·ç±»å‹ï¼ŒæŒ‡å®šåº”ä½¿ç”¨å“ªä¸ªå·é©±åŠ¨ç¨‹åºï¼Œè¿™é‡Œæ˜¯nfs</span></span><br><span class="line">      <span class="attr">o:</span> <span class="string">&quot;addr=10.40.0.199,nolock,soft,rw&quot;</span> <span class="comment"># nfså‚æ•°ï¼Œaddrä¸ºnfsæœåŠ¡å™¨åœ°å€ï¼Œnolockä¸ºä¸é”å®šæ–‡ä»¶ï¼Œsoftä¸ºè½¯é“¾æ¥ï¼Œrwä¸ºè¯»å†™æƒé™</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">&quot;:/docker/example&quot;</span> <span class="comment"># nfsæŒ‚è½½è·¯å¾„</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>external: å·æ˜¯å¦ä¸ºå¤–éƒ¨å·ï¼Œé»˜è®¤ä¸ºfalse</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span> <span class="comment"># true è¡¨ç¤ºä¸ä¼šåˆ›å»ºï¼Œè€Œæ˜¯ä½¿ç”¨å·²å­˜åœ¨çš„ï¼Œå³ä¼šå»volumesä¸­æŸ¥æ‰¾(docker volume ls) å®¹å™¨ç»„åç§°_da-data ï¼Œé»˜è®¤ä¸ºfalse</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>name: å·çš„åç§°ï¼Œé»˜è®¤ä¸º å®¹å™¨ç»„åç§°_å£°æ˜çš„åç§°</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">db-data</span> <span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸ºdb-dataçš„å·ï¼Œå®é™…çš„å·åç§°å°±æ˜¯ db-dataï¼Œä¸ä¼šå†åŠ ä¸Šå®¹å™¨ç»„åç§°å‰ç¼€</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span> <span class="comment"># name å±æ€§ç»å¸¸ä¸  external: true ä¸€èµ·ä½¿ç”¨</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>labels: ç”¨äºå‘å·æ·»åŠ å…ƒæ•°æ®ï¼Œå¯ä»¥æ·»åŠ ä»»æ„çš„é”®å€¼å¯¹</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">com.example.description:</span> <span class="string">&quot;Database volume&quot;</span></span><br><span class="line">      <span class="attr">com.example.department:</span> <span class="string">&quot;IT/Ops&quot;</span></span><br><span class="line">      <span class="attr">com.example.label-with-empty-value:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="networks">networks</h3><ul class="lvl-0"><li class="lvl-2"><p>ç½‘ç»œä½¿æœåŠ¡èƒ½å¤Ÿç›¸äº’é€šä¿¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompose ä¼šä¸ºæ‚¨çš„åº”ç”¨è®¾ç½®å•ä¸ªç½‘ç»œã€‚æœåŠ¡çš„æ¯ä¸ªå®¹å™¨éƒ½ä¼šåŠ å…¥é»˜è®¤ç½‘ç»œï¼Œå¹¶ä¸”è¯¥ç½‘ç»œä¸Šçš„å…¶ä»–å®¹å™¨éƒ½å¯ä»¥è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æœåŠ¡åç§°å‘ç°ã€‚é¡¶çº§networkså…ƒç´ å…è®¸æ‚¨é…ç½®å¯åœ¨å¤šä¸ªæœåŠ¡ä¹‹é—´é‡å¤ä½¿ç”¨çš„å‘½åç½‘ç»œã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/webapp</span></span><br><span class="line">    <span class="attr">networks:</span>  <span class="comment">#  ç½‘ç»œæ˜ å°„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">front-tier</span> <span class="comment">#  åŠ å…¥front-tierç½‘ç»œ</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">back-tier</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span>    <span class="comment"># ç½‘ç»œé…ç½®</span></span><br><span class="line">  <span class="attr">front-tier:</span> <span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸ºfront-tierçš„ç½‘ç»œï¼Œå®é™…çš„ç½‘ç»œåç§°æ˜¯ å®¹å™¨ç»„åç§°_front-tier</span></span><br><span class="line">  <span class="attr">back-tier:</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœ Compose æ–‡ä»¶æœªæ˜¾å¼å£°æ˜ç½‘ç»œï¼ŒCompose å°†ä½¿ç”¨éšå¼defaultç½‘ç»œã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">some-service:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªä¾‹å­å®é™…ä¸Šç­‰åŒäºï¼š</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">some-service:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">foo</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">default:</span> &#123;&#125;</span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h4 id="networks-çš„å±æ€§">networks çš„å±æ€§</h4><ul class="lvl-0"><li class="lvl-2"><p>driver: ç½‘ç»œç±»å‹ï¼Œé»˜è®¤ä¸ºbridge</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>driver_opts: ç½‘ç»œç±»å‹å‚æ•°ï¼ŒæŒ‡å®šè¦ä¼ é€’ç»™æ­¤ç½‘ç»œé©±åŠ¨ç¨‹åºçš„é€‰é¡¹åˆ—è¡¨ï¼ˆä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼‰ã€‚è¿™äº›é€‰é¡¹ä¸é©±åŠ¨ç¨‹åºç›¸å…³ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line">    <span class="attr">driver_opts:</span></span><br><span class="line">      <span class="attr">com.docker.network.bridge.host_binding_ipv4:</span> <span class="string">&quot;127.0.0.1&quot;</span> <span class="comment"># è®¾ç½®å®¹å™¨ç«¯å£ç»‘å®šåˆ°ä¸»æœºçš„å“ªä¸ª IPï¼ˆå¦‚ &quot;127.0.0.1&quot;ï¼Œç»‘å®šåˆ°æœ¬åœ°ï¼‰</span></span><br></pre></td></tr></table></figure><blockquote><p>driver_opts å¸¸è§é…ç½®é¡¹ï¼ˆé’ˆå¯¹ bridge ç½‘ç»œé©±åŠ¨ï¼‰</p></blockquote><table><thead><tr><th>é€‰é¡¹é”®åï¼ˆ<code>driver_opts</code>ï¼‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>com.docker.network.bridge.name</code></td><td>æŒ‡å®šæ¡¥æ¥ç½‘ç»œçš„åç§°ï¼ˆé»˜è®¤æ˜¯éšæœºç”Ÿæˆï¼Œå¦‚ <code>br-xxxxx</code>ï¼‰</td></tr><tr><td><code>com.docker.network.bridge.enable_icc</code></td><td>æ˜¯å¦å…è®¸å®¹å™¨ä¹‹é—´çš„é€šä¿¡ï¼ˆ<code>true</code> æˆ– <code>false</code>ï¼‰</td></tr><tr><td><code>com.docker.network.bridge.enable_ip_masquerade</code></td><td>æ˜¯å¦å¯ç”¨ IP å‡å†’ï¼ˆNATï¼Œé€šå¸¸ç”¨äºå¤–ç½‘è®¿é—®ï¼‰</td></tr><tr><td><code>com.docker.network.bridge.host_binding_ipv4</code></td><td>è®¾ç½®å®¹å™¨ç«¯å£ç»‘å®šåˆ°ä¸»æœºçš„å“ªä¸ª IPï¼ˆå¦‚ <code>&quot;127.0.0.1&quot;</code>ï¼Œç»‘å®šåˆ°æœ¬åœ°ï¼‰</td></tr><tr><td><code>com.docker.network.bridge.default_bridge</code></td><td>æ˜¯å¦å°†è¯¥ç½‘ç»œè®¾ç½®ä¸ºé»˜è®¤ bridge ç½‘ç»œï¼ˆ<code>true</code> æˆ– <code>false</code>ï¼‰</td></tr><tr><td><code>com.docker.network.driver.mtu</code></td><td>è®¾ç½®ç½‘ç»œçš„æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTUï¼Œä¾‹å¦‚ <code>&quot;1500&quot;</code>ï¼‰</td></tr><tr><td><code>com.docker.network.bridge.allow_non_default_bridge</code></td><td>æ˜¯å¦å…è®¸å®¹å™¨åŠ å…¥éé»˜è®¤çš„ bridge ç½‘ç»œï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>attachable: å¦‚æœä¸ºtrueï¼Œåˆ™å…è®¸å°†å…¶å®ƒç‹¬ç«‹å®¹å™¨ä¹ŸåŠ å…¥åˆ°æ­¤ç½‘ç»œã€‚é»˜è®¤å€¼ä¸ºfalseã€‚å¦‚æœç‹¬ç«‹å®¹å™¨è¿æ¥åˆ°æ­¤ç½‘ç»œï¼Œå®ƒå¯ä»¥ä¸åŒæ ·è¿æ¥åˆ°æ­¤ç½‘ç»œçš„æœåŠ¡å’Œå…¶ä»–ç‹¬ç«‹å®¹å™¨è¿›è¡Œé€šä¿¡ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">attachable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>external: true è¡¨ç¤ºä¸ä¼šåˆ›å»ºæ–°çš„ç½‘ç»œï¼Œå›å»networksä¸­æŸ¥æ‰¾ï¼ˆdocker network lsï¼‰ï¼Œé»˜è®¤ä¸ºfalse</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>name: ç½‘ç»œåç§°ï¼Œä¸ä¼šå†åŠ ä¸Šå®¹å™¨ç»„åç§°å‰ç¼€</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span> <span class="comment"># name å±æ€§ç»å¸¸ä¸  external: true ä¸€èµ·ä½¿ç”¨</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>labels: ç”¨äºå‘ç½‘ç»œæ·»åŠ å…ƒæ•°æ®ï¼Œå¯ä»¥æ·»åŠ ä»»æ„çš„é”®å€¼å¯¹</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">mynet1:</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">com.example.description:</span> <span class="string">&quot;Financial transaction network&quot;</span></span><br><span class="line">      <span class="attr">com.example.department:</span> <span class="string">&quot;Finance&quot;</span></span><br><span class="line">      <span class="attr">com.example.label-with-empty-value:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>internal: é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompose æä¾›ç½‘ç»œçš„å¤–éƒ¨è¿æ¥ã€‚internalå½“è®¾ç½®ä¸º æ—¶trueï¼Œå¯è®©æ‚¨åˆ›å»ºä¸å¤–éƒ¨éš”ç¦»çš„ç½‘ç»œã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">internal:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="services">services</h3><ul class="lvl-0"><li class="lvl-2"><p>æœåŠ¡æ˜¯åº”ç”¨ç¨‹åºä¸­è®¡ç®—èµ„æºçš„æŠ½è±¡å®šä¹‰ï¼Œå¯ä»¥ç‹¬ç«‹äºå…¶ä»–ç»„ä»¶è¿›è¡Œæ‰©å±•æˆ–æ›¿æ¢ã€‚æœåŠ¡ç”±ä¸€ç»„å®¹å™¨æ”¯æŒï¼Œç”±å¹³å°æ ¹æ®å¤åˆ¶è¦æ±‚å’Œå¸ƒå±€çº¦æŸè¿è¡Œã€‚ç”±äºæœåŠ¡ç”±å®¹å™¨æ”¯æŒï¼Œå› æ­¤å®ƒä»¬ç”± Docker é•œåƒå’Œä¸€ç»„è¿è¡Œæ—¶å‚æ•°å®šä¹‰ã€‚æœåŠ¡ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½ä½¿ç”¨è¿™äº›å‚æ•°ä»¥ç›¸åŒçš„æ–¹å¼åˆ›å»ºã€‚</p></li><li class="lvl-2"><p>service åŒ…å«çš„å±æ€§éå¸¸å¤šï¼Œå…·ä½“è¯·å‚è€ƒ<a href="https://docs.docker.com/reference/compose-file/services/">servicesé¡¶çº§å…ƒç´ </a>ï¼Œè¿™é‡Œåªä»‹ç»æ¯”è¾ƒå¸¸ç”¨çš„å±æ€§ï¼Œ</p></li><li class="lvl-2"><p>è¿™é‡Œä»¥<a href="https://docs.gitea.com/installation/install-with-docker">Gitea</a>çš„<code>docker-compose.yml</code>ä¸ºä¾‹</p></li></ul><blockquote><p>Gitea æ˜¯ä¸€ç§è½»æ¾ã€è‡ªæ‰˜ç®¡çš„ä¸€ä½“åŒ–è½¯ä»¶å¼€å‘æœåŠ¡ã€‚å®ƒåŒ…æ‹¬ Git æ‰˜ç®¡ã€ä»£ç å®¡æŸ¥ã€å›¢é˜Ÿåä½œã€åŒ…æ³¨å†Œè¡¨å’Œ CI/CDã€‚å®ƒç±»ä¼¼äº GitHubã€Bitbucket å’Œ GitLabã€‚</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># version: &#x27;3.8&#x27; # é…ç½®æ–‡ä»¶ç‰ˆæœ¬ï¼Œå·²è¿‡æ—¶ï¼Œé…ç½®ä¸Šä¼šå‘Šè­¦ä½†ä¸ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment"># name: gitea # å®¹å™¨ç»„åç§°ï¼Œé»˜è®¤ä½¿ç”¨æ‰€åœ¨ç›®å½•çš„åç§°ï¼Œä¸æ¨èä½¿ç”¨</span></span><br><span class="line"><span class="attr">networks:</span> <span class="comment"># ç½‘ç»œé…ç½®</span></span><br><span class="line">  <span class="attr">gitea:</span> <span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸ºgiteaçš„ç½‘ç»œï¼Œå®é™…çš„ç½‘ç»œåç§°æ˜¯ gitea_giteaï¼Œå³ å®¹å™¨ç»„åç§°_è¿™é‡Œçš„åç§°</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">false</span> <span class="comment"># å¦‚æœä¸ºtrueï¼Œåˆ™è¡¨ç¤ºæ­¤ç½‘ç»œä¸ä¼šç”±composeåˆ›å»ºï¼Œè€Œæ˜¯ä½¿ç”¨å·²æœ‰çš„ç½‘ç»œï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span>  <span class="comment"># ç½‘ç»œç±»å‹ï¼Œé»˜è®¤ä¸ºbridge</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span> <span class="comment"># å­˜å‚¨å·é…ç½®</span></span><br><span class="line">  <span class="attr">gitea:</span> <span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸ºgiteaçš„å­˜å‚¨å·ï¼Œå®é™…çš„å·åç§°æ˜¯ gitea_giteaï¼Œå³ å®¹å™¨ç»„åç§°_è¿™é‡Œçš„åç§°</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span> <span class="comment"># å­˜å‚¨å·ç±»å‹ï¼Œé»˜è®¤ä¸ºlocal</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span> <span class="comment"># æœåŠ¡é…ç½®ï¼Œè¿™é‡Œå¯ä»¥å®šä¹‰ä¸€ç»„å®¹å™¨</span></span><br><span class="line">  <span class="attr">server:</span> <span class="comment"># å®šä¹‰ä¸€ä¸ªåä¸ºserverçš„æœåŠ¡ï¼Œæ³¨æ„è¿™ä¸ªä¸æ˜¯å®¹å™¨åç§°</span></span><br><span class="line">    <span class="comment"># build: . # æ„å»ºé•œåƒï¼Œä½¿ç”¨å½“å‰ç›®å½•ä¸‹çš„Dockerfile</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitea/gitea:latest</span> <span class="comment"># é•œåƒåç§°</span></span><br><span class="line">    <span class="comment"># container_name: gitea #  å®¹å™¨åç§°ï¼Œé»˜è®¤ä¸º â€œå®¹å™¨ç»„åç§°-æœåŠ¡åç§°-ç´¢å¼•â€ï¼Œä¸æ¨èé…ç½®ï¼Œå› ä¸º æ°´å¹³æ‰©å±•(--scale) æ—¶,å®¹å™¨åç§°ä¸èƒ½é‡å¤</span></span><br><span class="line">    <span class="attr">environment:</span> <span class="comment"># å®šä¹‰ç¯å¢ƒå˜é‡</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER_UID=1000</span> <span class="comment"># key=value</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER_GID=1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DB_TYPE=mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DB_HOST=db:3306</span> <span class="comment"># è¿™é‡Œé…ç½®çš„ db å°±æ˜¯ ä¸‹é¢çš„æœåŠ¡åç§°ï¼Œç›¸åŒ network ä¸‹çš„æœåŠ¡åç§°ï¼Œdocker composeä¼šè‡ªåŠ¨è§£æä¸ºå®¹å™¨çš„ipåœ°å€</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DB_NAME=gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DB_USER=gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DB_PASSWD=gitea</span></span><br><span class="line">    <span class="comment"># env_file: .gitea.env # ä» .gitea.env æ–‡ä»¶è¯»å–ç¯å¢ƒå˜é‡ï¼Œç”Ÿäº§ç¯å¢ƒæ›´æ¨è</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span> <span class="comment"># å®¹å™¨å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨é‡å¯</span></span><br><span class="line">    <span class="attr">networks:</span> <span class="comment"># ç½‘ç»œå…³è”</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gitea</span> <span class="comment"># ç½‘ç»œåç§°ï¼Œå°±æ˜¯ä¸Šé¢åˆ›å»ºçš„giteaç½‘ç»œ</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment">#  æ•°æ®å·å…³è”</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gitea:/data</span> <span class="comment"># volumeæ˜ å°„ï¼Œæ•°æ®å·åç§°:/å®¹å™¨è·¯å¾„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone:ro</span> <span class="comment"># è·¯å¾„æ˜ å°„ï¼Œå®¿ä¸»æœºè·¯å¾„:/å®¹å™¨è·¯å¾„:è¯»å†™æƒé™</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">    <span class="attr">ports:</span> <span class="comment"># ç«¯å£æ˜ å°„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span> <span class="comment"># å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</span></span><br><span class="line">    <span class="attr">depends_on:</span> <span class="comment"># å¯åŠ¨ä¾èµ–ï¼Œå°±æ˜¯ä¾èµ–çš„æœåŠ¡å¯åŠ¨åæ‰èƒ½å¯åŠ¨æœ¬æœåŠ¡</span></span><br><span class="line">      <span class="attr">db:</span> <span class="comment"># å¯åŠ¨dbæœåŠ¡</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span> <span class="comment"># æœåŠ¡é€šè¿‡å¥åº·æ£€æŸ¥ï¼Œä¹Ÿå¯ä»¥é…ç½®ä¸º service_startedï¼šæœåŠ¡å¯åŠ¨ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">db:</span> <span class="comment"># æ•°æ®åº“æœåŠ¡</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8</span> <span class="comment"># é•œåƒ</span></span><br><span class="line">    <span class="attr">environment:</span> <span class="comment"># ç¯å¢ƒå˜é‡</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=gitea</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span> <span class="comment"># å¯åŠ¨ç­–ç•¥</span></span><br><span class="line">    <span class="attr">networks:</span> <span class="comment"># ç½‘ç»œæ˜ å°„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gitea</span> <span class="comment"># æ˜ å°„åˆ°giteaç½‘ç»œ</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># å·æ˜ å°„</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql:/var/lib/mysql</span> <span class="comment"># å®¿ä¸»æœºè·¯å¾„:/å®¹å™¨è·¯å¾„ï¼Œè¿™é‡Œå®¿ä¸»æœºæ”¯æŒç›¸å¯¹è·¯å¾„</span></span><br><span class="line">    <span class="attr">healthcheck:</span> <span class="comment"># å¥åº·æ£€æŸ¥</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;mysql -u root -pgitea&quot;</span>, <span class="string">&quot;-e &#x27;SELECT 1;&#x27;&quot;</span>] <span class="comment"># æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚æœè¿”å›0ï¼Œåˆ™å¥åº·æ£€æŸ¥é€šè¿‡ï¼Œè¿™é‡Œä¸æ”¯æŒä¸Šé¢çš„ç¯å¢ƒå˜é‡ï¼Œteståªæ”¯æŒ  CMD-SHELL å’Œ CMD</span></span><br><span class="line">      <span class="attr">interval:</span> <span class="string">10s</span> <span class="comment"># å¥åº·æ£€æŸ¥é—´éš”</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span> <span class="comment"># å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span> <span class="comment"># å¥åº·æ£€æŸ¥é‡è¯•æ¬¡æ•°</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>build</code>: æ„å»ºé•œåƒ</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span> <span class="comment"># Dockerfileçš„ç›®å½•ï¼Œâ€œ.â€ è¡¨ç¤ºä½¿ç”¨å½“å‰ç›®å½•ä¸‹çš„Dockerfile</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/webapp</span> <span class="comment"># é•œåƒåç§°ï¼Œå¦‚æœæœ‰buildï¼Œåˆ™è¯¥åç§°å°±æ˜¯buildåçš„é•œåƒåç§°ï¼Œå¦‚æœæ²¡æœ‰buildï¼Œåˆ™å°±ä¼šä»è¿œç¨‹ä»“åº“æ‹‰å–</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./webapp</span> <span class="comment"># Dockerfileçš„ç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span> <span class="comment"># æ„å»ºé•œåƒçš„Dockerfileåç§°ï¼Œé»˜è®¤æ˜¯Dockerfile</span></span><br><span class="line">      <span class="attr">platforms:</span> <span class="comment"># æ„å»ºé•œåƒçš„æ¶æ„</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">linux/amd64</span> <span class="comment"># æ„å»ºé•œåƒçš„æ¶æ„ï¼Œé»˜è®¤æ˜¯å½“å‰æ¶æ„</span></span><br><span class="line">      <span class="attr">args:</span> <span class="comment"># æ„å»ºé•œåƒçš„å‚æ•°</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">FOO=bar</span></span><br><span class="line">      <span class="attr">labels:</span> <span class="comment"># æ„å»ºé•œåƒçš„æ ‡ç­¾</span></span><br><span class="line">        <span class="attr">com.example.description:</span> <span class="string">&quot;Accounting webapp&quot;</span></span><br><span class="line">        <span class="attr">com.example.department:</span> <span class="string">&quot;Finance&quot;</span></span><br><span class="line">        <span class="attr">com.example.label-with-empty-value:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>command</code>: è¦†ç›–å®¹å™¨æ˜ åƒå£°æ˜çš„é»˜è®¤å‘½ä»¤</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;python&quot;</span>, <span class="string">&quot;app.py&quot;</span>]</span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/webapp</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>entrypoint</code>: å£°æ˜æœåŠ¡å®¹å™¨çš„é»˜è®¤å…¥å£ç‚¹ï¼Œè¿™è¦†ç›–äº†æœåŠ¡Dockerfileä¸­çš„ENTRYPOINTæŒ‡ä»¤ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/webapp</span></span><br><span class="line">    <span class="attr">entrypoint:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">php</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">memory_limit=-1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">vendor/bin/phpunit</span></span><br><span class="line">      <span class="comment"># å¦‚æœå€¼ä¸ºnullï¼Œåˆ™ä½¿ç”¨å›¾åƒçš„é»˜è®¤å…¥å£ç‚¹ã€‚ entrypoint: null</span></span><br><span class="line">      <span class="comment"># å¦‚æœå€¼æ˜¯ []ï¼ˆç©ºåˆ—è¡¨ï¼‰æˆ– &#x27;&#x27;ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œå›¾åƒå£°æ˜çš„é»˜è®¤å…¥å£ç‚¹è¢«å¿½ç•¥ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œè¢«è¦†ç›–ä¸ºç©ºã€‚ entrypoint: []</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>depends_on</code>: æœåŠ¡å¯åŠ¨ä¾èµ–ï¼Œå°±æ˜¯ä¾èµ–çš„æœåŠ¡å¯åŠ¨åæ‰èƒ½å¯åŠ¨æœ¬æœåŠ¡</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span> <span class="comment"># çŸ­è¯­æ³•</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">db:</span>  <span class="comment"># é•¿è¯­æ³•</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span> <span class="comment"># æ»¡è¶³çš„æ¡ä»¶</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="literal">true</span>      <span class="comment"># å½“è®¾ç½®ä¸ºtrueï¼ŒComposeåœ¨æ›´æ–°ä¾èµ–æœåŠ¡åé‡æ–°å¯åŠ¨æ­¤æœåŠ¡ã€‚</span></span><br><span class="line">      <span class="attr">redis:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_started</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## conditionï¼šè®¾ç½®ä¾èµ–æ€§è¢«è§†ä¸ºæ»¡è¶³çš„æ¡ä»¶</span></span><br><span class="line"><span class="comment">#   service_startedï¼šç›¸å½“äºä¹‹å‰æè¿°çš„ç®€çŸ­è¯­æ³•</span></span><br><span class="line"><span class="comment">#   service_healthyï¼šæŒ‡å®šåœ¨å¯åŠ¨ä¾èµ–æœåŠ¡ä¹‹å‰ï¼Œä¾èµ–é¢„æœŸä¸ºâ€œå¥åº·â€ï¼ˆå¦‚healthcheckæ‰€ç¤ºï¼‰ã€‚</span></span><br><span class="line"><span class="comment">#   service_completed_successfullyï¼šæŒ‡å®šåœ¨å¯åŠ¨ä¾èµ–æœåŠ¡ä¹‹å‰ï¼Œä¾èµ–é¡¹é¢„è®¡å°†è¿è¡Œåˆ°æˆåŠŸå®Œæˆã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>environment</code>: å®šä¹‰ç¯å¢ƒå˜é‡</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/webapp</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FOO=bar</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">BAZ=qux</span></span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/webapp</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">FOO:</span> <span class="string">bar</span></span><br><span class="line">      <span class="attr">BAZ:</span> <span class="string">qux</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>env_file</code>: ç”¨äºæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªåŒ…å«è¦ä¼ é€’åˆ°å®¹å™¨çš„ç¯å¢ƒå˜é‡çš„æ–‡ä»¶ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/webapp</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./a.env</span> <span class="comment"># åˆ—è¡¨ä¸­çš„æ–‡ä»¶æ˜¯ä»ä¸Šåˆ°ä¸‹å¤„ç†çš„ã€‚å¯¹äºä¸¤ä¸ªç¯å¢ƒæ–‡ä»¶ä¸­æŒ‡å®šçš„ç›¸åŒå˜é‡ï¼Œåˆ—è¡¨ä¸­æœ€åä¸€ä¸ªæ–‡ä»¶çš„å€¼æ˜¯æœ‰æ•ˆçš„ã€‚</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./b.env</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/webapp</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">./default.env</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">true</span> <span class="comment"># default</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">./override.env</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">false</span> <span class="comment"># å½“requiredè®¾ç½®ä¸ºfalseä¸”.envæ–‡ä»¶ç¼ºå¤±æ—¶ï¼ŒComposeä¼šå¿½ç•¥</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>restart</code>: å®šä¹‰å¹³å°åœ¨å®¹å™¨ç»ˆæ­¢æ—¶é€‚ç”¨çš„ç­–ç•¥</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/webapp</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">&quot;no&quot;</span>            <span class="comment"># é»˜è®¤é‡å¯ç­–ç•¥ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå®ƒéƒ½ä¸ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ã€‚</span></span><br><span class="line">    <span class="comment"># restart: always        # ç­–ç•¥æ€»æ˜¯é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œç›´åˆ°å®ƒè¢«ç§»é™¤ã€‚</span></span><br><span class="line">    <span class="comment"># restart: on-failure    # å¦‚æœé€€å‡ºä»£ç è¡¨æ˜é”™è¯¯ï¼Œç­–ç•¥å°†é‡æ–°å¯åŠ¨å®¹å™¨ã€‚</span></span><br><span class="line">    <span class="comment"># restart: on-failure:3  # å¦‚æœé€€å‡ºä»£ç è¡¨æ˜é”™è¯¯ï¼Œç­–ç•¥å°†é‡æ–°å¯åŠ¨å®¹å™¨ã€‚ä½†ä»…å°è¯•é‡å¯3æ¬¡ã€‚</span></span><br><span class="line">    <span class="comment"># restart: unless-stopped # æ— è®ºé€€å‡ºä»£ç å¦‚ä½•ï¼Œç­–ç•¥éƒ½ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ï¼Œä½†å½“æœåŠ¡åœæ­¢æˆ–åˆ é™¤æ—¶ï¼Œç­–ç•¥ä¼šåœæ­¢é‡æ–°å¯åŠ¨ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>healthcheck</code>: å¥åº·æ£€æŸ¥ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/webapp</span></span><br><span class="line">    <span class="attr">healthcheck:</span>  <span class="comment"># å¥åº·æ£€æŸ¥</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost&quot;</span>] <span class="comment"># ç›‘æ§æ£€æŸ¥æ—¶æ‰§è¡Œçš„å‘½ä»¤</span></span><br><span class="line">      <span class="attr">interval:</span> <span class="string">1m30s</span> <span class="comment"># å¥åº·æ£€æŸ¥çš„é—´éš”ï¼Œé»˜è®¤å€¼ä¸º 30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span>    <span class="comment">#  å¥åº·æ£€æŸ¥çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º 30s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span>      <span class="comment"># å¥åº·æ£€æŸ¥çš„å°è¯•æ¬¡æ•°ï¼Œé»˜è®¤å€¼ä¸º 3</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">40s</span> <span class="comment"># å¯åŠ¨å®½é™æœŸï¼šåœ¨æ­¤æœŸé—´ï¼Œå¤±è´¥ä¸ä¼šè®¡å…¥é‡è¯•æ¬¡æ•°ï¼ˆä»…ç”¨äºåˆ¤æ–­æœåŠ¡æ˜¯å¦å¯åŠ¨å®Œæ¯•ï¼‰</span></span><br><span class="line">      <span class="attr">start_interval:</span> <span class="string">5s</span> <span class="comment"># å¯åŠ¨å®½é™æœŸå†…æ£€æŸ¥çš„é¢‘ç‡ï¼Œæœ¬ç¤ºä¾‹ä¸ºåœ¨å‰ 40 ç§’å†…æ¯ 5 ç§’æ£€æŸ¥ä¸€æ¬¡</span></span><br></pre></td></tr></table></figure><blockquote><p>testå®šä¹‰Composeè¿è¡Œçš„å‘½ä»¤æ¥æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶å†µã€‚å®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ—è¡¨ã€‚å¦‚æœæ˜¯åˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªé¡¹ç›®å¿…é¡»æ˜¯NONEã€CMDæˆ–CMD-SHELLã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç­‰åŒäºæŒ‡å®šCMD-SHELLåè·Ÿè¯¥å­—ç¬¦ä¸²ã€‚</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost&quot;</span>]</span><br><span class="line"><span class="comment"># ä½¿ç”¨CMD-SHELLè¿è¡Œé…ç½®ä¸ºå­—ç¬¦ä¸²çš„å‘½ä»¤ï¼Œä½¿ç”¨å®¹å™¨çš„é»˜è®¤å¤–å£³ï¼ˆLinuxçš„/bin/shï¼‰ã€‚ä»¥ä¸‹ä¸¤ç§å½¢å¼æ˜¯ç­‰ä»·çš„</span></span><br><span class="line"><span class="attr">test:</span> [<span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;curl -f http://localhost || exit 1&quot;</span>]</span><br><span class="line"><span class="attr">test:</span> <span class="string">curl</span> <span class="string">-f</span> <span class="string">https://localhost</span> <span class="string">||</span> <span class="string">exit</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><blockquote><p>test ä¸­çš„ CMD å’Œ CMD-SHELL æ˜¯ä¸¤ç§ä¸åŒçš„æ‰§è¡Œæ–¹å¼ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š</p></blockquote><table><thead><tr><th>é¡¹ç›®</th><th><code>CMD</code></th><th><code>CMD-SHELL</code></th></tr></thead><tbody><tr><td>âœ… <strong>ç”¨é€”</strong></td><td>ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼ˆä¸é€šè¿‡ shellï¼‰</td><td>é€šè¿‡ shellï¼ˆå¦‚ <code>/bin/sh -c</code>ï¼‰æ‰§è¡Œå‘½ä»¤</td></tr><tr><td>ğŸ§¾ <strong>å†™æ³•æ ¼å¼</strong></td><td><code>[&quot;CMD&quot;, &quot;executable&quot;, &quot;arg1&quot;, &quot;arg2&quot;]</code></td><td><code>[&quot;CMD-SHELL&quot;, &quot;command string&quot;]</code></td></tr><tr><td>ğŸ”§ <strong>æ˜¯å¦ä½¿ç”¨ shell</strong></td><td>å¦</td><td>æ˜¯</td></tr><tr><td>ğŸ§  <strong>æ˜¯å¦æ”¯æŒ shell è¯­æ³•</strong></td><td>âŒ å¦<br>ï¼ˆä¸èƒ½ä½¿ç”¨ <code>&amp;&amp;</code>ã€ <code>||</code>ã€<code>\$VAR</code> ç­‰ï¼‰</td><td>âœ… æ˜¯<br>ï¼ˆæ”¯æŒç®¡é“ã€é‡å®šå‘ã€å˜é‡ã€å‘½ä»¤ç»„åˆï¼‰</td></tr><tr><td>ğŸ›¡ï¸ <strong>å®‰å…¨æ€§/å¯ç§»æ¤æ€§</strong></td><td>âœ… æ›´å®‰å…¨ï¼Œæ‰§è¡Œæ›´æ˜ç¡®</td><td>âš  ä¾èµ–å®¹å™¨ä¸­å­˜åœ¨ shellï¼ˆå¦‚ <code>/bin/sh</code>ï¼‰</td></tr><tr><td>âš™ï¸ <strong>æ‰§è¡Œæ•ˆç‡</strong></td><td>âœ… ç¨å¿«ï¼Œå› æ— éœ€ shell è§£æ</td><td>âš  ç¨æ…¢ï¼Œéœ€é€šè¿‡ shell å¯åŠ¨</td></tr><tr><td>ğŸ“¦ <strong>æ¨èä½¿ç”¨åœºæ™¯</strong></td><td>- ç®€å•å¥åº·æ£€æŸ¥å‘½ä»¤<br>- å®‰å…¨ç¯å¢ƒ<br>- ç²¾ç®€é•œåƒ</td><td>- éœ€è¦ä½¿ç”¨é€»è¾‘æ§åˆ¶ï¼ˆ<code>||</code>, <code>&amp;&amp;</code>ï¼‰<br>- å¤æ‚æ£€æŸ¥é€»è¾‘</td></tr><tr><td>ğŸ“Œ <strong>ç¤ºä¾‹</strong></td><td><code>[&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;]</code></td><td><code>[&quot;CMD-SHELL&quot;, &quot;curl -f http\://localhost || exit 1&quot;]</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p><code>volumes</code>: æŒ‚è½½æ•°æ®å·ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é•¿è¯­æ³•æ ¼å¼</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/backend</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">volume</span>   <span class="comment"># å®‰è£…ç±»å‹ã€‚å¯ä»¥æ˜¯æ˜¯volumeã€bindã€tmpfsã€imageã€npipeã€cluster</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">db-data</span> <span class="comment"># æŒ‚è½½çš„æºã€ç»‘å®šæŒ‚è½½çš„ä¸»æœºä¸Šçš„è·¯å¾„ã€æ˜ åƒæŒ‚è½½çš„Dockeræ˜ åƒå¼•ç”¨æˆ–é¡¶å±‚volumesé”®ä¸­å®šä¹‰çš„å·åç§°ã€‚ä¸é€‚ç”¨äºtmpfsæ”¯æ¶ã€‚</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/data</span> <span class="comment"># å®¹å™¨ä¸­è£…è½½å·çš„è·¯å¾„ã€‚</span></span><br><span class="line">        <span class="attr">volume:</span>  <span class="comment"># é…ç½®å…¶ä»–å·é€‰é¡¹</span></span><br><span class="line">          <span class="attr">nocopy:</span> <span class="literal">true</span> <span class="comment"># åœ¨åˆ›å»ºå·æ—¶ç¦ç”¨ä»å®¹å™¨å¤åˆ¶æ•°æ®çš„æ ‡å¿—ï¼Œé»˜è®¤å€¼ä¸ºfalseã€‚</span></span><br><span class="line">          <span class="attr">subpath:</span> <span class="string">sub</span> <span class="comment"># æŒ‚è½½å·çš„å­ç›®å½•ã€‚å³ db-data/sub</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">bind</span> <span class="comment"># bind è¡¨ç¤ºæŒ‚è½½ä¸»æœºä¸Šçš„è·¯å¾„</span></span><br><span class="line">        <span class="attr">source:</span> <span class="string">/var/run/postgres/postgres.sock</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/var/run/postgres/postgres.sock</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span> <span class="comment"># å£°æ˜æ•°æ®å·</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çŸ­è¯­æ³•æ ¼å¼</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/backend</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db-data:/data</span> <span class="comment"># è¿™ç§è¯­æ³•ä¸æ”¯æŒ subpath å’Œ nocopy</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>networks</code>: é…ç½®ç½‘ç»œã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">some-service:</span></span><br><span class="line">    <span class="attr">networks:</span>  <span class="comment"># é…ç½®ç½‘ç»œ</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">some-network</span> <span class="comment"># å…³è”ç½‘ç»œ</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">other-network</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span> <span class="comment"># å£°æ˜ç½‘ç»œ</span></span><br><span class="line">  <span class="attr">some-network:</span></span><br><span class="line">  <span class="attr">other-network:</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>cpu å’Œ å†…å­˜é™åˆ¶</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br><span class="line">    <span class="attr">mem_limit:</span> <span class="string">1g</span>           <span class="comment"># é™åˆ¶æœ€å¤šä½¿ç”¨1GBå†…å­˜</span></span><br><span class="line">    <span class="attr">mem_reservation:</span> <span class="string">512m</span>   <span class="comment"># å»ºè®®é¢„ç•™512MBå†…å­˜</span></span><br><span class="line">    <span class="attr">cpus:</span> <span class="number">2.0</span>               <span class="comment"># é™åˆ¶æœ€å¤šä½¿ç”¨2ä¸ªCPUæ ¸</span></span><br><span class="line">    <span class="attr">cpu_shares:</span> <span class="number">1024</span>        <span class="comment"># é»˜è®¤å€¼ï¼Œè¡¨ç¤ºæ ‡å‡†ä¼˜å…ˆçº§</span></span><br><span class="line">    <span class="attr">cpu_quota:</span> <span class="number">100000</span>       <span class="comment"># æ¯ 100ms å®¹å™¨æœ€å¤šå¯è¿è¡Œ 100msï¼ˆ=1æ ¸ï¼‰, ä¸ cpus ä¸èƒ½åŒæ—¶è®¾ç½®</span></span><br><span class="line">    <span class="attr">cpu_period:</span> <span class="number">100000</span>      <span class="comment"># è°ƒåº¦å‘¨æœŸä¸º100ms, ä¸ cpus ä¸èƒ½åŒæ—¶è®¾ç½®</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>å­—æ®µå</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>cpus</code></td><td>float</td><td>é™åˆ¶å®¹å™¨æœ€å¤šä½¿ç”¨å¤šå°‘ CPUï¼ˆé€»è¾‘æ ¸æ•°ï¼‰ï¼›ä¾‹å¦‚ <code>0.5</code> = ä¸€åŠ CPU</td></tr><tr><td><code>mem_limit</code></td><td>string</td><td>å®¹å™¨æœ€å¤§å†…å­˜é™åˆ¶ï¼Œæ”¯æŒå•ä½ï¼š<code>b</code>ã€<code>k</code>ã€<code>m</code>ã€<code>g</code>ï¼ˆå¦‚ <code>256m</code>, <code>1g</code>ï¼‰</td></tr><tr><td><code>mem_reservation</code></td><td>string</td><td>å®¹å™¨å¯åŠ¨æ—¶é¢„ç•™çš„å†…å­˜ï¼Œè¶…è¿‡è¿™ä¸ªå€¼ä¸è¢«é™åˆ¶ï¼ˆä»…æç¤ºè°ƒåº¦å™¨ï¼‰</td></tr><tr><td><code>cpu_shares</code></td><td>int</td><td>CPU æƒé‡ï¼ˆé»˜è®¤ 1024ï¼‰ï¼Œç”¨äºå¤šä¸ªå®¹å™¨æŠ¢å  CPU çš„ä¼˜å…ˆçº§ï¼ˆä»…åœ¨ç«äº‰æ—¶ç”Ÿæ•ˆï¼‰</td></tr><tr><td><code>cpu_quota</code></td><td>int</td><td>æ¯ä¸ªå‘¨æœŸå†…å…è®¸ä½¿ç”¨çš„ CPU æ—¶é—´ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰, ä¸ cpus ä¸èƒ½åŒæ—¶è®¾ç½®</td></tr><tr><td><code>cpu_period</code></td><td>int</td><td>CPU è°ƒåº¦å‘¨æœŸï¼ˆå•ä½ï¼šå¾®ç§’ï¼Œé»˜è®¤ <code>100000</code>ï¼‰, ä¸ cpus ä¸èƒ½åŒæ—¶è®¾ç½®</td></tr></tbody></table><blockquote><p>æŸ¥çœ‹å®¹å™¨çš„ cpu å’Œ å†…å­˜é…ç½®æƒ…å†µ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–å®¹å™¨çš„ cpu_quota å’Œ cpu_period</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;json .HostConfig.CpuQuota&#125;&#125; &#123;&#123;json .HostConfig.CpuPeriod&#125;&#125;&#x27;</span> &lt;container_id&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„ memory_limit</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;json .HostConfig.Memory&#125;&#125;&#x27;</span> &lt;container_id&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„ cpu_shares</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;json .HostConfig.CpuShares&#125;&#125;&#x27;</span> &lt;container_id&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„ cpus</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;json .HostConfig.NanoCpus&#125;&#125;&#x27;</span> &lt;container_id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»„åˆä¸ºä¸€ä¸ªjsonè¾“å‡º</span></span><br><span class="line">docker inspect &lt;container_id&gt; | jq <span class="string">&#x27;.[0].HostConfig | &#123;</span></span><br><span class="line"><span class="string">  cpus: (.NanoCpus / 1000000000),</span></span><br><span class="line"><span class="string">  cpu_shares: .CpuShares,</span></span><br><span class="line"><span class="string">  mem_limit: (.Memory / 1024 / 1024 | tostring + &quot; MB&quot;),</span></span><br><span class="line"><span class="string">  mem_reservation: (.MemoryReservation / 1024 / 1024 | tostring + &quot; MB&quot;),</span></span><br><span class="line"><span class="string">  cpu_quota: .CpuQuota,</span></span><br><span class="line"><span class="string">  cpu_period: .CpuPeriod</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="docker-run-è½¬-docker-compose"><code>docker run</code> è½¬ <code>docker compose</code></h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨çº¿å·¥å…·ï¼š<a href="https://www.composerize.com/">composerize</a></p></li><li class="lvl-2"><p>æœ¬åœ°å®‰è£…ï¼š<a href="https://github.com/composerize/composerize">composerize</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…å‘½ä»¤ï¼Œnpmå®‰è£…ï¼šhttps://nodejs.org/zh-cn/download</span></span><br><span class="line">npm install composerize -g</span><br><span class="line"><span class="comment"># è¿è¡Œå‘½ä»¤</span></span><br><span class="line">composerize docker run -p 80:80 -v /var/run/docker.sock:/tmp/docker.sock:ro --restart always --log-opt max-size=1g nginx</span><br><span class="line"><span class="comment">##  è½¬æ¢ç»“æœ</span></span><br><span class="line">name: &lt;your project name&gt;</span><br><span class="line">services:</span><br><span class="line">  nginx:</span><br><span class="line">    ports:</span><br><span class="line">      - 80:80</span><br><span class="line">    volumes:</span><br><span class="line">      - /var/run/docker.sock:/tmp/docker.sock:ro</span><br><span class="line">    restart: always</span><br><span class="line">    logging:</span><br><span class="line">      options:</span><br><span class="line">        max-size: 1g</span><br><span class="line">    image: nginx</span><br></pre></td></tr></table></figure><h2 id="docker-compose-ç¼–æ’ç®¡ç†å·¥å…·-Dockge"><code>docker compose</code> ç¼–æ’ç®¡ç†å·¥å…· <code>Dockge</code></h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://dockge.kuma.pet">Dockge</a> æ˜¯ä¸€ä¸ªå¼€æºè½»é‡çº§ã€ŒDocker Compose ç®¡ç†å™¨ã€ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ¼‚äº®ã€å“åº”è¿…é€Ÿçš„ Web ç•Œé¢ï¼Œä¸“é—¨é¢å‘ä½¿ç”¨ <code>docker compose</code> çš„ç”¨æˆ·ã€‚</p></li></ul><table><thead><tr><th>åŠŸèƒ½æ¨¡å—</th><th>ä¸»è¦æè¿°</th></tr></thead><tbody><tr><td><strong>Compose å †æ ˆå…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></td><td>å¯ä»¥åˆ›å»ºã€ç¼–è¾‘ã€å¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€åˆ é™¤åŸºäº <code>compose.yaml</code> æ–‡ä»¶çš„ Docker å †æ ˆ</td></tr><tr><td><strong>äº¤äº’å¼ Compose ç¼–è¾‘å™¨ + Web ç»ˆç«¯</strong></td><td>å®æ—¶ç¼–è¾‘ YAML å¹¶æŸ¥çœ‹è¾“å‡ºï¼Œè¿˜å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ“ä½œç»ˆç«¯</td></tr><tr><td><strong>å°† <code>docker run â€¦</code> å‘½ä»¤è½¬æ¢ä¸º Compose æ–‡ä»¶</strong></td><td>å¿«é€Ÿç”Ÿæˆ <code>compose.yaml</code>ï¼Œä¾¿äºç‰ˆæœ¬æ§åˆ¶å’Œç»“æ„ç®¡ç†</td></tr><tr><td><strong>å®æ—¶æ“ä½œåé¦ˆ</strong></td><td>é•œåƒæ‹‰å–ã€å †æ ˆå¯åŠ¨/åœæ­¢ç­‰æ“ä½œå‡å¯å®æ—¶æŸ¥çœ‹è¿›åº¦</td></tr><tr><td><strong>å¤šä¸»æœºä»£ç†æ”¯æŒï¼ˆâ‰¥1.4.0ï¼‰</strong></td><td>èƒ½åœ¨å•ä¸€ UI ä¸­ç®¡ç†å¤šä¸ª Docker ä¸»æœº</td></tr><tr><td><strong>é«˜å…¼å®¹æ€§ &amp; å®‰å…¨è®¾è®¡</strong></td><td>Compose æ–‡ä»¶ä¿å­˜åœ¨æœ¬åœ°ï¼Œä¸ä¼šè¢«ç³»ç»Ÿæ‰˜ç®¡ï¼Œä¾¿äºä½¿ç”¨ CLI æˆ–å…¶ä»–å·¥å…·ç®¡ç†</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create directories that store your stacks and store Dockge&#x27;s stack</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/stacks /opt/dockge</span><br><span class="line"><span class="built_in">cd</span> /opt/dockge</span><br><span class="line"></span><br><span class="line"><span class="comment"># Download your compose.yaml</span></span><br><span class="line">curl <span class="string">&quot;https://dockge.kuma.pet/compose.yaml?port=5001&amp;stacksPath=%2Fopt%2Fstacks&quot;</span> --output compose.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start the Server</span></span><br><span class="line">docker compose up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµè§ˆå™¨è®¿é—® http://localhost:5001</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ &lt;code&gt;docker compose&lt;/code&gt; çš„ä½¿ç”¨æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/compose/&quot;&gt;docker compose&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/reference/compose-file/&quot;&gt;Compose file reference&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker å‘½ä»¤ ä¹‹ ç½‘ç»œ(Network)</title>
    <link href="https://blog.hanqunfeng.com/2025/05/28/docker-command-network/"/>
    <id>https://blog.hanqunfeng.com/2025/05/28/docker-command-network/</id>
    <published>2025-05-28T13:40:05.000Z</published>
    <updated>2025-05-29T09:58:22.618Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ ç½‘ç»œç®¡ç† ç›¸å…³å‘½ä»¤</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="ä»€ä¹ˆæ˜¯Network-ç½‘ç»œ">ä»€ä¹ˆæ˜¯Network(ç½‘ç»œ)?</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ Docker ä¸­ï¼Œ<strong>ç½‘ç»œï¼ˆNetworkï¼‰</strong> æ˜¯å®¹å™¨ä¹‹é—´é€šä¿¡ã€å®¹å™¨ä¸å¤–éƒ¨é€šä¿¡çš„é‡è¦æœºåˆ¶ã€‚Docker æä¾›äº†ä¸€å¥—çµæ´»çš„ç½‘ç»œæ¨¡å‹ï¼Œä½¿å¾—ä½ å¯ä»¥è‡ªç”±é…ç½®å®¹å™¨çš„ç½‘ç»œç¯å¢ƒä»¥é€‚é…ä¸åŒåœºæ™¯ã€‚</p></li><li class="lvl-2"><p>å®‰è£…dockeræ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸Šå®‰è£…ä¸€ä¸ª <code>docker0</code> ç½‘ç»œè®¾å¤‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªç½‘æ¡¥è®¾å¤‡ï¼Œç”¨äº Docker å„å®¹å™¨åŠå®¿ä¸»æœºçš„ç½‘ç»œé€šä¿¡ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å®¿ä¸»æœºç½‘å¡ä¿¡æ¯ï¼Œå¯ä»¥æ‰¾åˆ°docker0</span></span><br><span class="line">$ ip addr</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 0a:6b:88:11:66:39 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.250.0.205/24 brd 10.250.0.255 scope global dynamic noprefixroute eth0</span><br><span class="line">       valid_lft 3076sec preferred_lft 3076sec</span><br><span class="line">    inet6 fe80::86b:88ff:fe11:6639/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:d6:d5:09:b1 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:d6ff:fed5:9b1/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="comment">## è¯´æ˜</span></span><br><span class="line">eth0 å®¿ä¸»æœºçš„ipåœ°å€æ˜¯ 10.250.0.205</span><br><span class="line">docker0 æœ¬èº«çš„ipåœ°å€æ˜¯ 172.17.0.1</span><br><span class="line">docker0 çš„å­ç½‘æ©ç æ˜¯ 255.255.0.0</span><br><span class="line">docker0 çš„å¹¿æ’­åœ°å€æ˜¯ 172.17.255.255</span><br><span class="line">docker0 å¯ä»¥ä¸ºå®¹å™¨åˆ†é…çš„ipåœ°å€èŒƒå›´æ˜¯ 172.17.0.2-172.17.255.254ï¼Œæ€»è®¡65534ä¸ªipåœ°å€</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ—¢ç„¶docker0æ˜¯ä¸€ä¸ªç½‘æ¡¥è®¾å¤‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹ç½‘æ¡¥çš„è¯¦ç»†ä¿¡æ¯ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ brctl show</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">brctl show</span><br><span class="line">bridge name    bridge <span class="built_in">id</span>      STP enabled    interfaces</span><br><span class="line">docker0    8000.0242d6d509b1        no</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨dockeræœåŠ¡åï¼Œdockerå°±ä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºäº†ä¸‰ä¸ªç½‘ç»œï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">4182e112bf34   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">958daf8a8a0d   host      host      <span class="built_in">local</span></span><br><span class="line">4674a17c6617   none      null      <span class="built_in">local</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œ<code>NAME</code>ä¸º<code>bridge</code>çš„ç½‘ç»œå°±æ˜¯ä¸<code>docker0</code>è®¾å¤‡ç›¸å¯¹åº”çš„ç½‘ç»œï¼Œå…¶ä¹Ÿæ˜¯docker<code>é»˜è®¤</code>çš„ç½‘ç»œï¼Œå¦‚æœåˆ›å»ºçš„å®¹å™¨æ²¡æœ‰æŒ‡å®šç½‘ç»œï¼Œé‚£ä¹ˆå®¹å™¨å°±ä¼šåŠ å…¥è¿™ä¸ª <code>bridge</code> ç½‘ç»œã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œæ²¡æœ‰æŒ‡å®šç½‘ç»œ</span></span><br><span class="line">docker run -itd --name ap1 alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶åœ¨å®¿ä¸»æœºä¸ŠæŸ¥çœ‹ç½‘å¡ä¿¡æ¯ï¼Œä¼šçœ‹åˆ°å¤šå‡ºä¸€ä¸ªè®¾å¤‡</span></span><br><span class="line">ip addr</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">10: vethc0e0cc3@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether c6:0d:02:c8:<span class="built_in">df</span>:a4 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::c40d:2ff:fec8:dfa4/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®¹å™¨çš„ç½‘å¡ä¿¡æ¯</span></span><br><span class="line">docker <span class="built_in">exec</span> -it ap1 ip addr</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">9: eth0@if10: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ­¤æ—¶èªæ˜çš„ä½ å·²ç»å‘ç°äº†ï¼šå®¿ä¸»æœºçš„ç½‘å¡ä¸å®¹å™¨çš„ç½‘å¡æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œå¹¶ä¸”åŸºäºåºå·è¿›è¡Œå…³è”</span></span><br><span class="line">å®¿ä¸»æœº: 10 : veth c0e0cc3 @ <span class="keyword">if</span> 9  <span class="comment"># åºå· 10 ä¸ å®¹å™¨åç¼€çš„ 10 åŒ¹é…ï¼Œveth æ˜¯è™šæ‹Ÿç½‘å¡ï¼Œc0e0cc3 æ˜¯éšæœºå­—ç¬¦ä¸²ï¼Œif æ˜¯ interface</span></span><br><span class="line">å®¹å™¨:    9 : eth0         @ <span class="keyword">if</span> 10 <span class="comment"># åºå· 9 ä¸å®¿ä¸»æœºçš„åç¼€ 9 åŒ¹é…ï¼Œeth0 æ˜¯å®¹å™¨çš„ç½‘å¡ï¼Œif æ˜¯ interface</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶æŸ¥çœ‹å®¿ä¸»æœºçš„ç½‘æ¡¥ä¿¡æ¯</span></span><br><span class="line">brctl show</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœï¼Œå¯ä»¥åœ¨ interfaces ä¸­çœ‹åˆ° vethc0e0cc3ï¼Œè¯´æ˜ vethc0e0cc3 å·²ç»åŠ å…¥åˆ°ç½‘æ¡¥ä¸­</span></span><br><span class="line">bridge name  bridge <span class="built_in">id</span>      STP enabled  interfaces</span><br><span class="line">docker0   8000.0242d6d509b1      no  vethc0e0cc3</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç½‘ç»œä¸­çš„å®¹å™¨ä¿¡æ¯ï¼Œè¿™é‡Œ jq æ˜¯ json æ ¼å¼åŒ–ï¼Œå¯ä»¥é€šè¿‡ dnf install jq -y å®‰è£…</span></span><br><span class="line">docker network inspect bridge --format <span class="string">&#x27;&#123;&#123;json .Containers&#125;&#125;&#x27;</span> | jq</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;c2436a1d750cc3de3a6f8ab8a693af25b3371aa8f7f168d5561538dcd4a8ff2d&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;ap1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;75469fddbbdeb8b7a328c1a1c3cc7070bb1a3e102f5fb97cc332dcbc22829af5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">    <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;172.17.0.2/16&quot;</span>,</span><br><span class="line">    <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„ IP åœ°å€</span></span><br><span class="line">docker <span class="built_in">exec</span> ap1 hostname -i</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">172.17.0.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›¸åŒç½‘ç»œè®¾å¤‡ä¸‹çš„å®¹å™¨å¯ä»¥é€šè¿‡ IP åœ°å€é€šä¿¡</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶æŸ¥çœ‹èƒ½å¦æ­£å¸¸é€šä¿¡</span></span><br><span class="line">docker run -itd --name ap2 alpine</span><br><span class="line">docker <span class="built_in">exec</span> -it ap2 ping 172.17.0.2</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœï¼Œè¯´æ˜å¯ä»¥é€šè¿‡IPåœ°å€é€šä¿¡</span></span><br><span class="line">PING 172.17.0.2 (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.2: <span class="built_in">seq</span>=0 ttl=64 time=0.137 ms</span><br><span class="line">64 bytes from 172.17.0.2: <span class="built_in">seq</span>=1 ttl=64 time=0.084 ms</span><br><span class="line">64 bytes from 172.17.0.2: <span class="built_in">seq</span>=2 ttl=64 time=0.081 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç½‘ç»œä¸­çš„å®¹å™¨</span></span><br><span class="line">docker network inspect bridge --format <span class="string">&#x27;&#123;&#123;json .Containers&#125;&#125;&#x27;</span> | jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;9d3ed5be1916b14ec9befe3649c08cc9de247c595de248600f8ef8d0fc16c5cb&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;ap2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;35615a7ec10842401ad8c40187c792555b5089551a8eca39ddff6734aeba549e&quot;</span>,</span><br><span class="line">    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:03&quot;</span>,</span><br><span class="line">    <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;172.17.0.3/16&quot;</span>,</span><br><span class="line">    <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;c2436a1d750cc3de3a6f8ab8a693af25b3371aa8f7f168d5561538dcd4a8ff2d&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;ap1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;75469fddbbdeb8b7a328c1a1c3cc7070bb1a3e102f5fb97cc332dcbc22829af5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">    <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;172.17.0.2/16&quot;</span>,</span><br><span class="line">    <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•æ˜¯å¦å¯ä»¥é€šè¿‡å®¹å™¨åç§°è®¿é—®</span></span><br><span class="line">docker <span class="built_in">exec</span> -it ap2 ping ap1</span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œä¸å¯ä»¥é€šè¿‡å®¹å™¨åç§°è®¿é—®</span></span><br><span class="line">ping: bad address <span class="string">&#x27;ap1&#x27;</span></span><br><span class="line"><span class="comment">## å¦‚æœå¸Œæœ›é€šè¿‡å®¹å™¨åç§°è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ docker network create åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œ</span></span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å¦‚æœæ²¡æœ‰å®‰è£… brctlï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å®‰è£…</strong></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos7:</span></span><br><span class="line">yum install bridge-utils -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos8: ä¸æ”¯æŒyumæºå®‰è£…ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–è¯‘å®‰è£…</span></span><br><span class="line"><span class="comment"># ä¸‹è½½æºç å®‰è£…ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º1.7.1</span></span><br><span class="line">wget https://mirrors.edge.kernel.org/pub/linux/utils/net/bridge-utils/bridge-utils-1.7.1.tar.gz</span><br><span class="line">tar -zxvf bridge-utils-1.7.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> bridge-utils-1.7.1</span><br><span class="line"><span class="comment"># éœ€è¦å…ˆå®‰è£…ç¼–è¯‘æ‰€éœ€çš„å·¥å…·å’Œä¾èµ–</span></span><br><span class="line">dnf install autoconf automake libtool make -y</span><br><span class="line"><span class="comment"># å› ä¸ºæºç ç›®å½•ä¸­æ²¡æœ‰ configure æ–‡ä»¶ï¼ˆä½†æœ‰ configure.acï¼‰ï¼Œæ‰€ä»¥éœ€è¦å…ˆè¿è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ configure æ–‡ä»¶</span></span><br><span class="line">autoreconf -i</span><br><span class="line"><span class="comment"># é…ç½®</span></span><br><span class="line">./configure</span><br><span class="line"><span class="comment"># ç¼–è¯‘ ä¸” å®‰è£…</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment"># æ·»åŠ åˆ°ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=<span class="variable">$PATH</span>:/usr/local/sbin&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">brctl --version</span><br><span class="line"><span class="comment">## è¾“å‡ºç»“æœ</span></span><br><span class="line">bridge-utils, 1.7</span><br></pre></td></tr></table></figure></div><ul class="lvl-0"><li class="lvl-2"><p>Docker é»˜è®¤çš„ bridge ç½‘ç»œå’Œ Linux å†…æ ¸ä¸­çš„ docker0 ç½‘æ¡¥æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚bridge æ˜¯ Docker å¯¹ç½‘ç»œçš„å‘½åï¼Œè€Œ docker0 æ˜¯å†…æ ¸ä¸­ç½‘æ¡¥çš„åå­—ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/wjWiNA.png" alt=""></p></li><li class="lvl-2"><p>docker0è´Ÿè´£ç»™è¿æ¥å…¶ä¸Šçš„å®¹å™¨åˆ†é…ipåœ°å€ï¼Œå¹¶ä¸”æ˜¯æ¯ä¸ªå®¹å™¨çš„é»˜è®¤ç½‘å…³ã€‚å½“å®¹å™¨éœ€è¦è®¿é—®å¤–ç½‘æ—¶ï¼Œä¼šé€šè¿‡docker0è½¬åˆ°å®¿ä¸»æœºçš„eth0ä¸Šï¼Œæ‰€ä»¥åªè¦å®¿ä¸»æœºå¯ä»¥è®¿é—®å¤–ç½‘ï¼Œé‚£ä¹ˆå®¹å™¨ä¹Ÿå¯ä»¥è®¿é—®å¤–ç½‘ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å®¿ä¸»æœºçš„è·¯ç”±è¡¨</span></span><br><span class="line">$ route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.250.0.1      0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">10.250.0.0      0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ap1å®¹å™¨çš„è·¯ç”±è¡¨</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it ap1 route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         172.17.0.1      0.0.0.0         UG    0      0        0 eth0</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 eth0</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Docker Container çš„ bridge æ¡¥æ¥æ¨¡å¼å¯ä»¥å‚è€ƒä¸‹å›¾<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/32fupw.png" alt=""></p></li></ul><h2 id="docker-network-ç›¸å…³å‘½ä»¤"><code>docker network</code> ç›¸å…³å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹è¾“å‡ºï¼ˆç®€ç•¥ï¼‰</th></tr></thead><tbody><tr><td><code>docker network ls</code></td><td>åˆ—å‡ºæ‰€æœ‰ Docker ç½‘ç»œ</td><td><code>docker network ls</code></td><td><code>bridge</code>, <code>host</code>, <code>none</code> ç­‰ç½‘ç»œåç§°</td></tr><tr><td><code>docker network inspect &lt;ç½‘ç»œå&gt;</code></td><td>æŸ¥çœ‹æŒ‡å®šç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚ IP èŒƒå›´ã€è¿æ¥å®¹å™¨ç­‰ï¼‰</td><td><code>docker network inspect bridge</code></td><td>æ˜¾ç¤º JSONï¼Œå«å­ç½‘ã€ç½‘å…³ã€å®¹å™¨ç­‰ä¿¡æ¯</td></tr><tr><td><code>docker network create &lt;ç½‘ç»œå&gt;</code></td><td>åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼ˆé»˜è®¤æ¡¥æ¥ï¼‰</td><td><code>docker network create my-net</code></td><td><code>my-net</code> ç½‘ç»œ ID</td></tr><tr><td><code>docker network rm &lt;ç½‘ç»œå&gt;</code></td><td>åˆ é™¤ç½‘ç»œï¼ˆä¸èƒ½æœ‰å®¹å™¨è¿æ¥ï¼‰</td><td><code>docker network rm my-net</code></td><td>æˆåŠŸåˆ é™¤æ— æç¤ºï¼Œå¤±è´¥ä¼šæœ‰é”™è¯¯ä¿¡æ¯</td></tr><tr><td><code>docker network connect &lt;ç½‘ç»œå&gt; &lt;å®¹å™¨å&gt;</code></td><td>å°†ä¸€ä¸ªå®¹å™¨è¿æ¥åˆ°æŒ‡å®šç½‘ç»œ</td><td><code>docker network connect my-net my-container</code></td><td>æ— è¾“å‡ºï¼Œå®¹å™¨è¿æ¥æˆåŠŸ</td></tr><tr><td><code>docker network disconnect &lt;ç½‘ç»œå&gt; &lt;å®¹å™¨å&gt;</code></td><td>å°†å®¹å™¨ä»ç½‘ç»œä¸­æ–­å¼€è¿æ¥</td><td><code>docker network disconnect my-net my-container</code></td><td>æ— è¾“å‡ºï¼Œæ–­å¼€æˆåŠŸ</td></tr><tr><td><code>docker network prune</code></td><td>åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œï¼ˆæ…ç”¨ï¼‰</td><td><code>docker network prune</code></td><td>ä¼šæç¤ºæ˜¯å¦ç¡®è®¤ï¼Œæ¸…ç†æœªä½¿ç”¨ç½‘ç»œ</td></tr></tbody></table><h3 id="docker-network-create-åˆ›å»ºç½‘ç»œ"><code>docker network create</code> : åˆ›å»ºç½‘ç»œ</h3><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create [OPTIONS] NETWORK_NAME</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¸¸ç”¨å‚æ•°è¯´æ˜è¡¨</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>--driver</code> æˆ– <code>-d</code></td><td>æŒ‡å®šç½‘ç»œé©±åŠ¨ç±»å‹ï¼Œå¦‚ <code>bridge</code>, <code>overlay</code>, <code>macvlan</code>, <code>host</code>, <code>none</code></td><td><code>--driver bridge</code></td></tr><tr><td><code>--subnet</code></td><td>æŒ‡å®šå­ç½‘åœ°å€èŒƒå›´ï¼ˆCIDRï¼‰</td><td><code>--subnet 192.168.100.0/24</code></td></tr><tr><td><code>--gateway</code></td><td>æŒ‡å®šç½‘å…³ IP åœ°å€</td><td><code>--gateway 192.168.100.1</code></td></tr><tr><td><code>--ip-range</code></td><td>æŒ‡å®šå¯åˆ†é…çš„ IP èŒƒå›´</td><td><code>--ip-range 192.168.100.0/25</code></td></tr><tr><td><code>--aux-address</code></td><td>ä¿ç•™æŸäº› IP åœ°å€ä¸è¢«åˆ†é…</td><td><code>--aux-address=&quot;reserved=192.168.100.254&quot;</code></td></tr><tr><td><code>--internal</code></td><td>åˆ›å»ºä¸€ä¸ªå†…éƒ¨ç½‘ç»œï¼ˆä¸èƒ½è®¿é—®å¤–éƒ¨ï¼‰</td><td><code>--internal</code></td></tr><tr><td><code>--attachable</code></td><td>åˆ›å»ºå¯ä¾›å•ç‹¬å®¹å™¨è¿æ¥çš„ç½‘ç»œï¼ˆSwarm ä¸­ï¼‰</td><td><code>--attachable</code></td></tr><tr><td><code>--label</code></td><td>æ·»åŠ æ ‡ç­¾</td><td><code>--label env=dev</code></td></tr><tr><td><code>--opt</code></td><td>æä¾›è‡ªå®šä¹‰é©±åŠ¨é€‰é¡¹</td><td><code>--opt encrypted=true</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p><code>--driver</code> æˆ– <code>-d</code> : å¸¸è§çš„ Docker ç½‘ç»œé©±åŠ¨ç±»å‹</p></li></ul><table><thead><tr><th>ç±»å‹</th><th>å«ä¹‰</th><th>æ˜¯å¦æ”¯æŒç«¯å£æ˜ å°„</th><th>ç‰¹ç‚¹ä¸åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>bridge</code>ï¼ˆé»˜è®¤ï¼‰</td><td>é»˜è®¤çš„æ¡¥æ¥ç½‘ç»œï¼Œå®¹å™¨é€šè¿‡è™šæ‹Ÿç½‘æ¡¥è¿æ¥ï¼Œå…±äº«å®¿ä¸»æœºçš„ç½‘ç»œæ¥å£ã€‚</td><td>âœ… æ˜¯</td><td>é»˜è®¤æ¨¡å¼ï¼Œé€‚ç”¨äºå•ä¸»æœºéƒ¨ç½²ã€å¤šä¸ªå®¹å™¨éœ€è¦äº’é€šçš„åœºæ™¯ã€‚å¯æ˜ å°„ç«¯å£å¯¹å¤–è®¿é—®ã€‚</td></tr><tr><td><code>host</code></td><td>å®¹å™¨ä¸å®¿ä¸»æœºå…±ç”¨ç½‘ç»œå‘½åç©ºé—´ï¼Œå®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ã€‚</td><td>âŒ å¦</td><td>æ— ç½‘ç»œéš”ç¦»ï¼Œæ€§èƒ½é«˜ï¼Œé€‚ç”¨äºé«˜æ€§èƒ½ã€ä½å»¶è¿Ÿåœºæ™¯ï¼ˆå¦‚æ¸¸æˆæœåŠ¡å™¨ï¼‰ã€‚</td></tr><tr><td><code>none</code></td><td>å®¹å™¨æ²¡æœ‰ç½‘ç»œæ¥å£ï¼Œå®Œå…¨éš”ç¦»ã€‚</td><td>âŒ å¦</td><td>ç”¨äºå®‰å…¨æ€§æˆ–æµ‹è¯•ç½‘ç»œä¸å¯è¾¾åœºæ™¯ã€‚</td></tr><tr><td><code>macvlan</code></td><td>ä¸ºå®¹å™¨åˆ†é…ç‹¬ç«‹ MAC å’Œ IPï¼Œå®¹å™¨åƒç‰©ç†ä¸»æœºä¸€æ ·å‡ºç°åœ¨å±€åŸŸç½‘ä¸­ã€‚</td><td>âœ… æ˜¯ï¼ˆå°‘è§ï¼‰</td><td>é€‚ç”¨äºå®¹å™¨å¿…é¡»ç›´æ¥æš´éœ²åœ¨ç‰©ç†ç½‘ç»œä¸­çš„åœºæ™¯ï¼ˆå¦‚ DHCP æœåŠ¡ã€ARP å¹¿æ’­ï¼‰ã€‚</td></tr><tr><td><code>ipvlan</code>ï¼ˆé«˜çº§ï¼‰</td><td>ç±»ä¼¼ macvlanï¼Œä½†ä¸ä½¿ç”¨è™šæ‹Ÿ MAC åœ°å€ã€‚</td><td>âœ… æ˜¯ï¼ˆå°‘è§ï¼‰</td><td>é«˜çº§ç½‘ç»œæ–¹æ¡ˆï¼Œé€‚ç”¨äºå¯¹ç½‘ç»œæ‹“æ‰‘ç²¾ç»†æ§åˆ¶çš„åœºæ™¯ã€‚</td></tr><tr><td><code>overlay</code></td><td>ç”¨äºå¤šä¸»æœºä¹‹é—´å®¹å™¨é€šä¿¡ï¼Œéœ€è¦ Docker Swarm æ”¯æŒã€‚</td><td>âœ… æ˜¯ï¼ˆSwarmï¼‰</td><td>è·¨ä¸»æœºéƒ¨ç½²æœåŠ¡çš„å¿…è¦æ‰‹æ®µï¼Œé€‚åˆå®¹å™¨ç¼–æ’å¹³å°ï¼ˆå¦‚ Swarmã€Kubernetesï¼‰ã€‚</td></tr></tbody></table><blockquote><p>å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒDockerä¼šè‡ªåŠ¨åˆ›å»ºä¸‰ä¸ªç½‘ç»œï¼Œå³ï¼šbridgeã€hostã€noneã€‚å¯¹äºå•å°å®¿ä¸»æœºçš„åœºæ™¯ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½åªä¼šä½¿ç”¨bridgeç½‘ç»œã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸ºmy-networkçš„ç½‘ç»œ</span></span><br><span class="line">$ docker network create my-network</span><br><span class="line"><span class="comment"># ç­‰åŒäºï¼Œå› ä¸ºé»˜è®¤çš„ç½‘ç»œé©±åŠ¨ä¸ºbridge</span></span><br><span class="line">$ docker network create --driver bridge my-network</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç½‘ç»œï¼Œå¯ä»¥çœ‹åˆ°æ–°å»ºçš„ç½‘ç»œçš„é©±åŠ¨ä¸ºbridge</span></span><br><span class="line">$ docker network <span class="built_in">ls</span> -f name=my-network</span><br><span class="line">NETWORK ID     NAME         DRIVER    SCOPE</span><br><span class="line">c2dbe1686790   my-network   bridge    <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®¿ä¸»æœºçš„ç½‘æ¡¥ä¿¡æ¯</span></span><br><span class="line">$ brctl show</span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶æœ‰ä¸€ä¸ªç½‘æ¡¥è®¾å¤‡ br-c2dbe1686790ï¼Œbr: bridgeï¼Œc2dbe1686790ï¼šnetwork id</span></span><br><span class="line">bridge name      bridge <span class="built_in">id</span>          STP enabled    interfaces</span><br><span class="line">br-c2dbe1686790      8000.02425be81fae          no</span><br><span class="line">docker0      8000.0242d6d509b1          no    vethc0e0cc3</span><br><span class="line">            vethf4b7577</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®¿ä¸»æœºçš„ç½‘å¡</span></span><br><span class="line">$ ip addr</span><br><span class="line"><span class="comment">## è¾“å‡ºï¼Œbr-c2dbe1686790 ç½‘å¡åç§°ï¼Œå…¶IPç½‘æ®µä¸º 172.18.0.1/16</span></span><br><span class="line">13: br-c2dbe1686790: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:5b:e8:1f:ae brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-c2dbe1686790</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ä¸¤ä¸ªå®¹å™¨å¹¶æ·»åŠ åˆ°my-networkç½‘ç»œä¸­</span></span><br><span class="line">$ docker run -itd --network my-network --name a1 alpine</span><br><span class="line">$ docker run -itd --network my-network --name a2 alpine</span><br><span class="line"></span><br><span class="line">$ ip addr</span><br><span class="line"><span class="comment">## è¾“å‡º,å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå®¹å™¨éƒ½æ·»åŠ åˆ°äº†my-networkç½‘ç»œä¸­</span></span><br><span class="line">bridge name      bridge <span class="built_in">id</span>        STP enabled    interfaces</span><br><span class="line">br-c2dbe16867908000.02425be81fae    no    veth094946c</span><br><span class="line">            vetha2ba68a</span><br><span class="line">docker0        8000.0242d6d509b1    no    vethc0e0cc3</span><br><span class="line">            vethf4b7577</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•è¿é€šæ€§ï¼Œå¯ä»¥çœ‹åˆ° a1å¯ä»¥pingé€š a2ï¼Œåè¿‡æ¥ a2ä¹Ÿå¯ä»¥pingé€š a1</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it a1 ping a2</span><br><span class="line">PING a2 (172.18.0.4): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.4: <span class="built_in">seq</span>=0 ttl=64 time=2.127 ms</span><br><span class="line">64 bytes from 172.18.0.4: <span class="built_in">seq</span>=1 ttl=64 time=0.119 ms</span><br><span class="line"></span><br><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND     CREATED         STATUS         PORTS     NAMES</span><br><span class="line">e0fb0614591e   alpine    <span class="string">&quot;/bin/sh&quot;</span>   4 minutes ago   Up 4 minutes             a2</span><br><span class="line">fc6e9477d2b7   alpine    <span class="string">&quot;/bin/sh&quot;</span>   4 minutes ago   Up 4 minutes             a1</span><br><span class="line">9d3ed5be1916   alpine    <span class="string">&quot;/bin/sh&quot;</span>   4 hours ago     Up 4 hours               ap2</span><br><span class="line">c2436a1d750c   alpine    <span class="string">&quot;/bin/sh&quot;</span>   4 hours ago     Up 4 hours               ap1</span><br><span class="line"><span class="comment"># ä¸åŒç½‘ç»œä¸­çš„å®¹å™¨ä¹‹é—´ä¸èƒ½ç›¸äº’pingé€š</span></span><br><span class="line"><span class="comment">## é€šè¿‡å®¹å™¨åç§°æ— æ³•pingé€š</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it a1 ping ap1</span><br><span class="line">ping: bad address <span class="string">&#x27;ap1&#x27;</span></span><br><span class="line"><span class="comment">## é€šè¿‡ap1å®¹å™¨IPä¹Ÿæ— æ³•pingé€šï¼Œè¿™å°±å®ç°äº†ä¸åŒç½‘ç»œä¸­çš„ç½‘ç»œéš”ç¦»</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it a1 ping 172.17.0.2</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœåˆ›å»ºç½‘ç»œæ—¶æ²¡æœ‰æŒ‡å®šå­ç½‘ï¼Œåˆ™ä»<code>docker0</code>çš„<code>172.17.0.0/16</code>å¾€åæ’ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šé¢åˆ›å»ºçš„<code>my-network</code>ï¼Œå…¶å­ç½‘å°±æ˜¯<code>172.18.0.0/16</code>ï¼Œå¦‚ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªbridgeç½‘ç»œï¼Œå¹¶æŒ‡å®šå­ç½‘ã€ç½‘å…³ç­‰ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create \</span><br><span class="line">  --driver bridge \</span><br><span class="line">  --subnet 192.168.50.0/24 \</span><br><span class="line">  --gateway 192.168.50.1 \</span><br><span class="line">  my-custom-net</span><br></pre></td></tr></table></figure><h4 id="bridge-æ€»ç»“"><code>bridge</code> æ€»ç»“</h4><ul class="lvl-0"><li class="lvl-2"><p>é»˜è®¤åˆ›å»ºçš„ <code>docker0</code> ç½‘ç»œï¼Œæ˜¯ä¸€ä¸ªæ¡¥æ¥ç½‘ç»œï¼Œåœ¨ docker network ä¸­çš„åç§°ä¸º <code>bridge</code>ï¼Œè¯¥ç½‘ç»œä¸‹çš„å®¹å™¨å¯ä»¥é€šè¿‡IPåœ°å€ç›¸äº’è®¿é—®ï¼Œä½†ä¸èƒ½é€šè¿‡å®¹å™¨åç§°è®¿é—®</p></li><li class="lvl-2"><p>é€šè¿‡<code>docker network create &lt;ç½‘ç»œåç§°&gt;</code>åˆ›å»ºçš„ç½‘ç»œä¹Ÿæ˜¯ä¸€ä¸ªæ¡¥æ¥ç½‘ç»œï¼Œåœ¨è¿™ä¸ªç½‘ç»œä¸‹ï¼Œå®¹å™¨å¯ä»¥é€šè¿‡IPåœ°å€ç›¸äº’è®¿é—®ï¼Œä¹Ÿèƒ½é€šè¿‡å®¹å™¨åç§°è®¿é—®ã€‚</p></li></ul><h3 id="docker-network-ls-åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ"><code>docker network ls</code> : åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ</span></span><br><span class="line">$ docker network <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># è¾“å‡ºæŒ‡å®šçš„ä¿¡æ¯</span></span><br><span class="line">$ docker network <span class="built_in">ls</span> --format <span class="string">&quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Name&#125;&#125;\t&#123;&#123;.Scope&#125;&#125;&quot;</span></span><br><span class="line"><span class="comment"># è¾“å‡ºjsonæ ¼å¼</span></span><br><span class="line">$ docker network <span class="built_in">ls</span> --format <span class="string">&quot;json&quot;</span></span><br><span class="line"><span class="comment"># è¿‡æ»¤</span></span><br><span class="line">$ docker network <span class="built_in">ls</span> -f <span class="string">&quot;driver=bridge&quot;</span></span><br><span class="line"><span class="comment"># ä¸æˆªæ–­è¾“å‡º</span></span><br><span class="line">$ docker network <span class="built_in">ls</span> --no-trunc</span><br><span class="line"><span class="comment"># åªæ˜¾ç¤ºnetwork id</span></span><br><span class="line">$ docker network <span class="built_in">ls</span> -q</span><br></pre></td></tr></table></figure><h3 id="docker-network-inspect-æŸ¥çœ‹ç½‘ç»œè¯¦æƒ…"><code>docker network inspect</code> : æŸ¥çœ‹ç½‘ç»œè¯¦æƒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹åç§°ä¸ºbridgeç½‘ç»œè¯¦æƒ…</span></span><br><span class="line">$ docker network inspect bridge</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç½‘ç»œä¸‹æœ‰å“ªäº›å®¹å™¨</span></span><br><span class="line">$ docker network inspect bridge --format <span class="string">&quot;&#123;&#123;.Containers&#125;&#125;&quot;</span></span><br><span class="line"><span class="comment"># è¾“å‡ºjsonæ ¼å¼</span></span><br><span class="line">$ docker network inspect bridge --format <span class="string">&quot;json&quot;</span></span><br></pre></td></tr></table></figure><h3 id="docker-network-prune-æ¸…ç†æ²¡ç”¨çš„ç½‘ç»œ"><code>docker network prune</code> : æ¸…ç†æ²¡ç”¨çš„ç½‘ç»œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œ</span></span><br><span class="line">$ docker network prune</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œï¼Œæ— éœ€ç¡®è®¤</span></span><br><span class="line">$ docker network prune -f</span><br><span class="line"><span class="comment"># æ¸…ç†24å°æ—¶å†…æœªä½¿ç”¨çš„ç½‘ç»œ</span></span><br><span class="line">$ docker network prune --filter <span class="string">&quot;until=24h&quot;</span></span><br></pre></td></tr></table></figure><h3 id="docker-network-rm-åˆ é™¤ç½‘ç»œ"><code>docker network rm</code> : åˆ é™¤ç½‘ç»œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æŒ‡å®šçš„ç½‘ç»œ</span></span><br><span class="line">$ docker network <span class="built_in">rm</span> &lt;network-name&gt;</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰ç½‘ç»œ</span></span><br><span class="line">$ docker network <span class="built_in">rm</span> $(docker network <span class="built_in">ls</span> -q)</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰bridgeç½‘ç»œï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œdockeré»˜è®¤åˆ›å»ºçš„3ä¸ªç½‘ç»œæ˜¯åˆ é™¤ä¸æ‰çš„</span></span><br><span class="line">$ docker network <span class="built_in">rm</span> $(docker network <span class="built_in">ls</span> -q -f driver=bridge)</span><br></pre></td></tr></table></figure><h3 id="docker-network-connect-å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œ"><code>docker network connect</code> : å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œï¼Œå¦‚æœå®¹å™¨å¯åŠ¨æ—¶å¿˜è®°è¿æ¥ç½‘ç»œï¼Œè¿™é‡Œå¯ä»¥æ‰‹åŠ¨æ·»åŠ </span></span><br><span class="line">$ docker network connect &lt;network-name&gt; &lt;container-name&gt;</span><br></pre></td></tr></table></figure><h3 id="docker-network-disconnect-å°†å®¹å™¨ä»ç½‘ç»œæ–­å¼€"><code>docker network disconnect</code> : å°†å®¹å™¨ä»ç½‘ç»œæ–­å¼€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network disconnect &lt;network-name&gt; &lt;container-name&gt;</span><br></pre></td></tr></table></figure><h2 id="æœ¬æ–‡æ€»ç»“">æœ¬æ–‡æ€»ç»“</h2><ul class="lvl-0"><li class="lvl-2"><p>å®¹å™¨ä¸ç½‘ç»œæ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œå³ä¸€ä¸ªç½‘ç»œå¯ä»¥æœ‰å¤šä¸ªå®¹å™¨ï¼Œä¸€ä¸ªå®¹å™¨ä¹Ÿå¯ä»¥è¿æ¥åˆ°å¤šä¸ªç½‘ç»œã€‚</p></li><li class="lvl-2"><p>docker0 æ˜¯ docker é»˜è®¤åˆ›å»ºçš„ç½‘ç»œï¼Œä¸æŒ‡å®šç½‘ç»œçš„æƒ…å†µä¸‹æ‰€æœ‰å®¹å™¨éƒ½è¿æ¥åˆ° docker0 ç½‘ç»œã€‚</p></li><li class="lvl-2"><p>docker0 æ˜¯ bridge ç½‘ç»œï¼Œè¯¥ç½‘ç»œä¸­çš„å®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ IP äº’ç›¸è®¿é—®ï¼Œä½†ä¸èƒ½é€šè¿‡å®¹å™¨åç§°è®¿é—®ã€‚</p></li><li class="lvl-2"><p>è‡ªå»ºçš„ bridge ç½‘ç»œä¸­çš„å®¹å™¨å¯ä»¥é€šè¿‡å®¹å™¨åç§°ï¼ˆæˆ–å®¹å™¨IDï¼Œä½†ä¸å¸¸ç”¨ï¼‰è®¿é—®ã€‚</p></li><li class="lvl-2"><p>ä¸åŒçš„ bridge ç½‘ç»œä¸­çš„å®¹å™¨ä¸èƒ½äº’ç›¸è®¿é—®ã€‚</p></li></ul><h2 id="link-vs-network"><code>--link</code> vs <code>--network</code></h2><table><thead><tr><th>é¡¹ç›®</th><th><code>--link</code></th><th><code>--network</code></th></tr></thead><tbody><tr><td>åŠŸèƒ½</td><td>å°†ä¸€ä¸ªå®¹å™¨é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶è®¾ç½®ç¯å¢ƒå˜é‡å’Œä¸»æœºåæ˜ å°„</td><td>å°†å®¹å™¨åŠ å…¥åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œä¸­ï¼Œå®ç°çµæ´»ã€éš”ç¦»çš„ç½‘ç»œé€šä¿¡</td></tr><tr><td>æ˜¯å¦æ¨è</td><td>âŒ ä¸æ¨èï¼ˆå·²åºŸå¼ƒï¼‰</td><td>âœ… æ¨èä½¿ç”¨</td></tr><tr><td>ç½‘ç»œéš”ç¦»</td><td>åŸºäºé»˜è®¤ <code>bridge</code> ç½‘ç»œï¼Œéš”ç¦»æ€§å·®</td><td>å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼ˆbridgeã€overlay ç­‰ï¼‰ï¼Œéš”ç¦»æ€§å¼º</td></tr><tr><td>å¯æ‰©å±•æ€§</td><td>åªé€‚ç”¨äºå·²è¿è¡Œçš„å®¹å™¨ï¼Œè¿æ¥å›ºå®š</td><td>æ”¯æŒå¤šä¸ªå®¹å™¨ï¼Œçµæ´»ç»„åˆå’ŒåŠ¨æ€æ‰©å±•</td></tr><tr><td>DNS æ”¯æŒ</td><td>ä»…è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¸æ”¯æŒè‡ªåŠ¨ DNS</td><td>è‡ªå®šä¹‰ç½‘ç»œä¸­æ”¯æŒå®¹å™¨åç§°ä½œä¸º DNS åç§°</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸ</td><td>ä¸€æ–¹å®¹å™¨å…³é—­ï¼Œå¦ä¸€æ–¹ä»ä¿å­˜è¿‡æ—¶é“¾æ¥</td><td>ç½‘ç»œå­˜åœ¨å³å¯ï¼Œå®¹å™¨ç”Ÿå‘½å‘¨æœŸä¸äº’ç›¸å½±å“</td></tr><tr><td>å®‰å…¨æ€§</td><td>æ‰€æœ‰å®¹å™¨å…±äº« bridgeï¼Œå®¹æ˜“ç›¸äº’è®¿é—®</td><td>è‡ªå®šä¹‰ç½‘ç»œé—´é»˜è®¤éš”ç¦»ï¼Œå®‰å…¨æ€§æ›´å¥½</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ ç½‘ç»œç®¡ç† ç›¸å…³å‘½ä»¤&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker å‘½ä»¤ ä¹‹ æ•°æ®å·(Volume)</title>
    <link href="https://blog.hanqunfeng.com/2025/05/28/docker-command-volume/"/>
    <id>https://blog.hanqunfeng.com/2025/05/28/docker-command-volume/</id>
    <published>2025-05-28T13:30:05.000Z</published>
    <updated>2025-05-29T09:27:21.992Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ æ•°æ®å·ç®¡ç† ç›¸å…³å‘½ä»¤</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="ä»€ä¹ˆæ˜¯Volume-æ•°æ®å·">ä»€ä¹ˆæ˜¯Volume(æ•°æ®å·)?</h2><ul class="lvl-0"><li class="lvl-2"><p>Volume æ˜¯ç”± Docker ç®¡ç†çš„ç‰¹æ®Šç›®å½•ï¼Œä½äºå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­(<code>/var/lib/docker/volumes/</code>)ï¼Œç”¨äºå­˜å‚¨å’Œå…±äº«å®¹å™¨çš„æ•°æ®ã€‚</p></li><li class="lvl-2"><p>å½“å®¹å™¨è¢«åˆ é™¤åï¼Œå®¹å™¨å†…çš„æ–‡ä»¶ç³»ç»Ÿä¹Ÿä¼šä¸€èµ·åˆ é™¤ï¼Œä½†æŒ‚è½½åœ¨ Volume ä¸­çš„æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå¯ä¾›å¤šä¸ªå®¹å™¨å…±äº«ã€‚</p></li><li class="lvl-2"><p>Volume çš„ç‰¹ç‚¹</p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ•°æ®æŒä¹…åŒ–</td><td>å³ä½¿å®¹å™¨åˆ é™¤ï¼Œæ•°æ®ä»ä¿ç•™åœ¨å·ä¸­</td></tr><tr><td>å¤šå®¹å™¨å…±äº«è®¿é—®</td><td>å¤šä¸ªå®¹å™¨å¯ä»¥æŒ‚è½½åŒä¸€ä¸ªå·ï¼Œå®ç°æ•°æ®å…±äº«</td></tr><tr><td>ä¸ä¾èµ–å®¹å™¨è·¯å¾„</td><td>å·ä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸè§£è€¦ï¼Œæ”¯æŒçµæ´»çš„å®¹å™¨é‡å»ºå’Œå‡çº§</td></tr><tr><td>ç®¡ç†ç®€ä¾¿</td><td>å¯ç”¨ <code>docker volume</code> å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ã€åˆ›å»ºã€åˆ é™¤ç­‰æ“ä½œ</td></tr><tr><td>å®‰å…¨éš”ç¦»</td><td>Docker ç®¡ç†çš„è·¯å¾„æ¯”ç»‘å®šæŒ‚è½½æ›´å®‰å…¨</td></tr></tbody></table><h2 id="docker-volume-ç›¸å…³å‘½ä»¤"><code>docker volume</code> ç›¸å…³å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>docker volume create</code></td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„å·ï¼Œåç§°å¯é€‰ï¼ˆä¸æŒ‡å®šä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰</td><td><code>docker volume create myvolume</code></td></tr><tr><td><code>docker volume ls</code></td><td>åˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„å·</td><td><code>docker volume ls</code></td></tr><tr><td><code>docker volume inspect &lt;name&gt;</code></td><td>æŸ¥çœ‹æŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æŒ‚è½½ç‚¹ã€é©±åŠ¨ç­‰</td><td><code>docker volume inspect myvolume</code></td></tr><tr><td><code>docker volume rm &lt;name&gt;</code></td><td>åˆ é™¤ä¸€ä¸ªå·ï¼ˆå‰ææ˜¯æ²¡æœ‰å®¹å™¨æ­£åœ¨ä½¿ç”¨è¯¥å·ï¼‰</td><td><code>docker volume rm myvolume</code></td></tr><tr><td><code>docker volume prune</code></td><td>åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„å·ï¼ˆä¼šæœ‰ç¡®è®¤æç¤ºï¼‰</td><td><code>docker volume prune</code></td></tr></tbody></table><h3 id="docker-volume-create-åˆ›å»ºä¸€ä¸ªæ–°çš„å·"><code>docker volume create</code> : åˆ›å»ºä¸€ä¸ªæ–°çš„å·</h3><ul class="lvl-0"><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume create [OPTIONS] [VOLUME]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯¦è§£</p></li></ul><table><thead><tr><th>é€‰é¡¹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>-d, --driver string</code></td><td>æŒ‡å®šå·é©±åŠ¨ç¨‹åºï¼Œé»˜è®¤æ˜¯ <code>local</code>ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰</td><td><code>-d local</code> æˆ– ç¬¬ä¸‰æ–¹é©±åŠ¨åç§°(éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶)</td></tr><tr><td><code>--label list</code></td><td>ç»™å·æ·»åŠ æ ‡ç­¾ï¼ˆå…ƒæ•°æ®ï¼‰ï¼Œå¯ç”¨äºåˆ†ç±»ã€è¿‡æ»¤</td><td><code>--label env=prod</code></td></tr><tr><td><code>-o, --opt map</code></td><td>è®¾ç½®é©±åŠ¨çš„ç‰¹å®šé€‰é¡¹ï¼Œæ ¼å¼ä¸º <code>key=value</code>ï¼Œå¤šä¸ªé€‰é¡¹å¯é‡å¤ä½¿ç”¨</td><td><code>-o type=tmpfs -o device=tmpfs</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªé»˜è®¤å·ï¼ˆlocal é©±åŠ¨ï¼‰</span></span><br><span class="line">docker volume create myvolume</span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥åœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™åˆ›å»ºé»˜è®¤æ•°æ®å·ï¼Œå¦‚ä¸‹å‘½ä»¤ï¼Œè‹¥ myvolume å·ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line">docker run -d -v myvolume:/data nginx</span><br><span class="line">docker run -d --mount <span class="built_in">type</span>=volume,<span class="built_in">source</span>=myvolume,target=/data nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ ‡ç­¾çš„å·</span></span><br><span class="line">docker volume create --label <span class="built_in">env</span>=dev --label team=backend myvolume</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåŒ¿åå·ï¼ˆä¸æŒ‡å®šåç§°ï¼‰</span></span><br><span class="line">docker volume create</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ tmpfs ç±»å‹å·ï¼ˆåªå­˜äºå†…å­˜ä¸­ï¼Œä¸è½ç›˜ï¼‰,é€‚ç”¨äºé«˜é€Ÿè¯»å†™ä½†ä¸éœ€è¦æŒä¹…åŒ–çš„æ•°æ®</span></span><br><span class="line">docker volume create \</span><br><span class="line">  -d <span class="built_in">local</span> \            <span class="comment"># æŒ‡å®šé©±åŠ¨ç¨‹åºä¸º local</span></span><br><span class="line">  -o <span class="built_in">type</span>=tmpfs \       <span class="comment"># æŒ‡å®šåº•å±‚æ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸º tmpfsï¼ˆå†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼‰</span></span><br><span class="line">  -o device=tmpfs \     <span class="comment"># è®¾ç½®æŒ‚è½½è®¾å¤‡ä¸º tmpfsï¼Œç”¨äºä¸ type=tmpfs é…åˆ</span></span><br><span class="line">  -o o=size=100m \      <span class="comment"># è®¾ç½® tmpfs çš„æœ€å¤§å®¹é‡ä¸º 100MB</span></span><br><span class="line">  mytmpfs               <span class="comment"># å·çš„åç§°ï¼Œå¯é€šè¿‡ docker volume ls æŸ¥çœ‹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰é©±åŠ¨çš„å·ï¼ˆå¦‚ nfsï¼‰</span></span><br><span class="line">docker volume create \</span><br><span class="line">  -d <span class="built_in">local</span> \                    <span class="comment"># é»˜è®¤é©±åŠ¨ç¨‹åºä¸º local</span></span><br><span class="line">  -o <span class="built_in">type</span>=nfs \                 <span class="comment"># åº•å±‚æ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸º nfs</span></span><br><span class="line">  -o o=addr=192.168.1.100,rw \  <span class="comment"># è®¾ç½® nfs çš„åœ°å€å’Œè¯»å†™æƒé™ï¼Œè‹¥åªè¯»ä¸º ro</span></span><br><span class="line">  -o device=:/path/to/share \   <span class="comment"># æŒ‚è½½è®¾å¤‡ä¸º nfsï¼Œæ ¼å¼ä¸ºï¼šnfs://192.168.1.100:/path/to/share</span></span><br><span class="line">  mynfs                         <span class="comment"># å·çš„åç§°ï¼Œå¯é€šè¿‡ docker volume ls æŸ¥çœ‹</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºçš„æ•°æ®å·ä¼šä¿å­˜åœ¨ <code>/var/lib/docker/volumes/</code> ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå· myvolumeï¼Œé‚£ä¹ˆè¯¥å·ä¼šä¿å­˜åœ¨ <code>/var/lib/docker/volumes/myvolume/_data</code> ç›®å½•ä¸‹</p></li></ul><h3 id="docker-volume-ls-åˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„å·"><code>docker volume ls</code> : åˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„å·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰å·</span></span><br><span class="line">docker volume <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰å·çš„ID</span></span><br><span class="line">docker volume <span class="built_in">ls</span> -q</span><br><span class="line"><span class="comment"># åˆ—å‡ºæŒ‡å®šé©±åŠ¨çš„å·</span></span><br><span class="line">docker volume <span class="built_in">ls</span> -f driver=<span class="built_in">local</span></span><br><span class="line"><span class="comment"># åˆ—å‡ºæŒ‡å®šæ ‡ç­¾çš„å·</span></span><br><span class="line">docker volume <span class="built_in">ls</span> -f label=<span class="built_in">env</span>=dev</span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰æœªä½¿ç”¨çš„å·ï¼ŒåŒ…æ‹¬åŒ¿åå·å’Œå‘½åå·</span></span><br><span class="line">docker volume <span class="built_in">ls</span> -f dangling=<span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="docker-volume-inspect-name-æŸ¥çœ‹æŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯"><code>docker volume inspect &lt;name&gt;</code> : æŸ¥çœ‹æŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">docker volume inspect myvolume</span><br><span class="line"><span class="comment"># åˆ—å‡ºæŒ‡å®šå·çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨jsonæ ¼å¼è¾“å‡º</span></span><br><span class="line">docker volume inspect -f json myvolume</span><br><span class="line"><span class="comment"># åˆ—å‡ºæŒ‡å®šå·çš„æŒ‚è½½ç‚¹</span></span><br><span class="line">docker volume inspect myvolume --format <span class="string">&quot;&#123;&#123;.Mountpoint&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="docker-volume-prune-åˆ é™¤æ‰€æœ‰æœªè¢«å®¹å™¨ä½¿ç”¨çš„å·"><code>docker volume prune</code> : åˆ é™¤æ‰€æœ‰æœªè¢«å®¹å™¨ä½¿ç”¨çš„å·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„åŒ¿åæ•°æ®å·ï¼Œä¼šæç¤ºç¡®è®¤</span></span><br><span class="line">docker volume prune</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„æ•°æ®å·ï¼Œä¼šæç¤ºç¡®è®¤</span></span><br><span class="line">docker volume prune -a</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„å·ï¼Œæ— éœ€ç¡®è®¤ç«‹åˆ»åˆ é™¤</span></span><br><span class="line">docker volume prune -a -f</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŒ¿åå· vs å‘½åå·</p><ul class="lvl-2"><li class="lvl-4">åŒ¿åå·ï¼šæ²¡æœ‰åç§°ï¼Œåªåœ¨ <code>docker run -v /container/path</code> æ—¶è‡ªåŠ¨åˆ›å»ºï¼›</li><li class="lvl-4">å‘½åå·ï¼šæœ‰åç§°ï¼Œä¾‹å¦‚ <code>docker run -v mydata:/container/path</code>ï¼›</li></ul></li></ul><h3 id="docker-volume-rm-name-åˆ é™¤æ•°æ®å·"><code>docker volume rm &lt;name&gt;</code> : åˆ é™¤æ•°æ®å·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æŒ‡å®šæ•°æ®å·</span></span><br><span class="line">docker volume <span class="built_in">rm</span> myvolume</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æ•°æ®å·</span></span><br><span class="line">docker volume <span class="built_in">rm</span> $(docker volume <span class="built_in">ls</span> -q)</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å·</span></span><br><span class="line">docker volume <span class="built_in">rm</span> $(docker volume <span class="built_in">ls</span> -qf dangling=<span class="literal">true</span>)</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å·ï¼Œæ— éœ€ç¡®è®¤</span></span><br><span class="line">docker volume <span class="built_in">rm</span> $(docker volume <span class="built_in">ls</span> -qf dangling=<span class="literal">true</span>) -f</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ æ•°æ®å·ç®¡ç† ç›¸å…³å‘½ä»¤&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker å‘½ä»¤ ä¹‹ å®¹å™¨(Container)</title>
    <link href="https://blog.hanqunfeng.com/2025/05/27/docker-command-container/"/>
    <id>https://blog.hanqunfeng.com/2025/05/27/docker-command-container/</id>
    <published>2025-05-27T13:30:05.000Z</published>
    <updated>2025-05-29T09:02:17.040Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ å®¹å™¨ç®¡ç† ç›¸å…³å‘½ä»¤</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ">å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ</h2><ul class="lvl-0"><li class="lvl-2"><p>å®¹å™¨å¯èƒ½å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š</p><ul class="lvl-2"><li class="lvl-5">åˆå»ºï¼ˆcreatedï¼‰</li><li class="lvl-5">è¿è¡Œï¼ˆrunningï¼‰</li><li class="lvl-5">æš‚åœï¼ˆpausedï¼‰</li><li class="lvl-5">åœæ­¢ï¼ˆstoppedï¼‰</li><li class="lvl-5">åˆ é™¤ï¼ˆdeletedï¼‰</li></ul></li><li class="lvl-2"><p>å„ç”Ÿå‘½å‘¨æœŸä¹‹é—´çš„è½¬æ¢å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/19n9NJ.png" alt=""></p></li></ul><table><thead><tr><th>å‘½ä»¤/æƒ…å†µ</th><th>è¯´æ˜</th><th>å®¹å™¨çŠ¶æ€å˜æ›´</th></tr></thead><tbody><tr><td><code>docker create</code></td><td>åˆ›å»ºå®¹å™¨åï¼Œä¸ç«‹å³å¯åŠ¨è¿è¡Œï¼Œå®¹å™¨è¿›å…¥åˆå»ºçŠ¶æ€</td><td>åˆå»ºçŠ¶æ€</td></tr><tr><td><code>docker run</code></td><td>åˆ›å»ºå®¹å™¨ï¼Œå¹¶ç«‹å³å¯åŠ¨è¿è¡Œï¼Œè¿›å…¥è¿è¡ŒçŠ¶æ€</td><td>åˆå»º â†’ è¿è¡Œ</td></tr><tr><td><code>docker start</code></td><td>å¯åŠ¨å·²åˆ›å»ºçš„å®¹å™¨ï¼Œå®¹å™¨è½¬ä¸ºè¿è¡ŒçŠ¶æ€</td><td>åœæ­¢ â†’ è¿è¡Œ</td></tr><tr><td><code>docker stop</code></td><td>åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå®¹å™¨è½¬å…¥åœæ­¢çŠ¶æ€</td><td>è¿è¡Œ â†’ åœæ­¢</td></tr><tr><td><code>docker kill</code></td><td>å¼ºåˆ¶ç»ˆæ­¢å®¹å™¨ï¼Œç›¸å½“äºâ€œæ–­ç”µâ€ï¼Œå®¹æ˜“ä¸¢å¤±æ•°æ®ï¼Œä¸å»ºè®®è½»æ˜“ä½¿ç”¨</td><td>è¿è¡Œ â†’ åœæ­¢ï¼ˆéæ­£å¸¸ï¼‰</td></tr><tr><td><code>docker restart</code></td><td>é‡å¯å®¹å™¨ï¼Œå®¹å™¨é‡æ–°è¿›å…¥è¿è¡ŒçŠ¶æ€</td><td>è¿è¡Œ â†’ åœæ­¢ â†’ è¿è¡Œ</td></tr><tr><td><code>docker pause</code></td><td>æš‚åœå®¹å™¨å†…æ‰€æœ‰è¿›ç¨‹ï¼Œå®¹å™¨è¿›å…¥æš‚åœçŠ¶æ€</td><td>è¿è¡Œ â†’ æš‚åœ</td></tr><tr><td><code>docker unpause</code></td><td>å–æ¶ˆæš‚åœçŠ¶æ€ï¼Œå®¹å™¨æ¢å¤è¿è¡Œ</td><td>æš‚åœ â†’ è¿è¡Œ</td></tr><tr><td><code>docker rm</code></td><td>åˆ é™¤å®¹å™¨ï¼Œå®¹å™¨è½¬å…¥åˆ é™¤çŠ¶æ€</td><td>ä»»æ„ â†’ åˆ é™¤</td></tr><tr><td>Killed by out-of-memory (OOM)</td><td>å®¿ä¸»æœºå†…å­˜è€—å°½ï¼Œå®¹å™¨è¢«ç³»ç»Ÿç»ˆæ­¢ï¼Œæ­¤ä¸ºéè®¡åˆ’ç»ˆæ­¢ï¼›å»ºè®®æ€æ­»å†…å­˜å ç”¨æœ€é«˜çš„å®¹å™¨</td><td>è¿è¡Œ â†’ åœæ­¢ï¼ˆå¼‚å¸¸ï¼‰</td></tr><tr><td>Container process exited</td><td>å®¹å™¨è¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢åï¼Œè¿›å…¥â€œæ˜¯å¦é‡å¯â€åˆ¤æ–­æµç¨‹ï¼šæ˜¯åˆ™æ‰§è¡Œ <code>start</code> è¿›å…¥è¿è¡Œï¼›å¦åˆ™ä¿æŒåœæ­¢çŠ¶æ€</td><td>å¼‚å¸¸ â†’ åœæ­¢æˆ–è¿è¡Œ</td></tr></tbody></table><h2 id="docker-container-å®¹å™¨ç®¡ç†"><code>docker container</code> : å®¹å™¨ç®¡ç†</h2><ul class="lvl-0"><li class="lvl-2"><p><code>docker container --help</code></p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>åˆ«å</th></tr></thead><tbody><tr><td>attach</td><td>å°†æœ¬åœ°çš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æµé™„åŠ åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸Š</td><td>docker attach</td></tr><tr><td>commit</td><td>æ ¹æ®å®¹å™¨çš„æ›´æ”¹åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ</td><td>docker commit</td></tr><tr><td>cp</td><td>åœ¨å®¹å™¨å’Œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹‹é—´å¤åˆ¶æ–‡ä»¶/æ–‡ä»¶å¤¹</td><td>docker cp</td></tr><tr><td>create</td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨</td><td>docker create</td></tr><tr><td>diff</td><td>æ£€æŸ¥å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•çš„æ›´æ”¹</td><td>docker diff</td></tr><tr><td>exec</td><td>åœ¨æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</td><td>docker exec</td></tr><tr><td>export</td><td>å°†å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿå¯¼å‡ºä¸º tar å½’æ¡£æ–‡ä»¶</td><td>docker export</td></tr><tr><td>inspect</td><td>æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„è¯¦ç»†ä¿¡æ¯</td><td>å¯ä»¥ä½¿ç”¨ <code>docker inspect</code></td></tr><tr><td>kill</td><td>ç»ˆæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨</td><td>docker kill</td></tr><tr><td>logs</td><td>è·å–å®¹å™¨çš„æ—¥å¿—</td><td>docker logs</td></tr><tr><td>ls</td><td>åˆ—å‡ºå®¹å™¨</td><td>docker ps</td></tr><tr><td>pause</td><td>æš‚åœä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨å†…çš„æ‰€æœ‰è¿›ç¨‹</td><td>docker pause</td></tr><tr><td>port</td><td>åˆ—å‡ºå®¹å™¨çš„ç«¯å£æ˜ å°„æˆ–ç‰¹å®šçš„ç«¯å£æ˜ å°„</td><td>docker port</td></tr><tr><td>prune</td><td>åˆ é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨</td><td></td></tr><tr><td>rename</td><td>é‡å‘½åä¸€ä¸ªå®¹å™¨</td><td>docker rename</td></tr><tr><td>restart</td><td>é‡å¯ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨</td><td>docker restart</td></tr><tr><td>rm</td><td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨</td><td>docker rm</td></tr><tr><td>run</td><td>æ ¹æ®é•œåƒåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨</td><td>docker run</td></tr><tr><td>start</td><td>å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå·²åœæ­¢çš„å®¹å™¨</td><td>docker start</td></tr><tr><td>stats</td><td>å®æ—¶æ˜¾ç¤ºå®¹å™¨èµ„æºä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯</td><td>docker stats</td></tr><tr><td>stop</td><td>åœæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨</td><td>docker stop</td></tr><tr><td>top</td><td>æ˜¾ç¤ºå®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹</td><td>docker top</td></tr><tr><td>unpause</td><td>å–æ¶ˆæš‚åœä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨å†…çš„æ‰€æœ‰è¿›ç¨‹</td><td>docker unpause</td></tr><tr><td>update</td><td>æ›´æ–°ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„é…ç½®</td><td>docker update</td></tr><tr><td>wait</td><td>é˜»å¡ç›´åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨åœæ­¢ï¼Œç„¶åæ‰“å°å…¶é€€å‡ºä»£ç </td><td>docker wait</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œ <code>docker container COMMAND --help</code> å¯è·å–æŸä¸ªå‘½ä»¤çš„æ›´å¤šä¿¡æ¯ã€‚</p></li></ul><h3 id="docker-create-åˆ›å»ºå®¹å™¨ï¼Œä½†ä¸å¯åŠ¨"><code>docker create</code> : åˆ›å»ºå®¹å™¨ï¼Œä½†ä¸å¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker create \</span><br><span class="line">    --name my-container \ <span class="comment"># å®¹å™¨å</span></span><br><span class="line">    -e MY_ENV_VAR=my-value \ <span class="comment"># è®¾ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">    -p 80:80 \ <span class="comment"># æ˜ å°„ç«¯å£ï¼Œæ ¼å¼ï¼šå®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</span></span><br><span class="line">    -v /path/to/my/dir:/path/in/container \ <span class="comment"># æ˜ å°„ç›®å½•ï¼Œæ ¼å¼ï¼šå®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•ï¼Œéƒ½å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„</span></span><br><span class="line">    --restart always \ <span class="comment"># è®¾ç½®é‡å¯ç­–ç•¥</span></span><br><span class="line">    nginx:latest \ <span class="comment"># é•œåƒåï¼Œé•œåƒä¸å­˜åœ¨æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker create</code> ä¸ <code>docker run</code> çš„å‚æ•°åŸºæœ¬ä¸€è‡´ï¼Œå…·ä½“æŸ¥çœ‹ä¸‹é¢ <code>docker run</code> ä¸­çš„ä»‹ç»ã€‚</p></li></ul><h3 id="docker-start-å¯åŠ¨ä¸€ä¸ªå®¹å™¨"><code>docker start</code> : å¯åŠ¨ä¸€ä¸ªå®¹å™¨</h3><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå®¹å™¨å¿…é¡»å·²ç»åˆ›å»ºï¼Œå¹¶ä¸”å¤„äºåœæ­¢çŠ¶æ€ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•ï¼šdocker start &lt;container_id|container_name&gt;</span></span><br><span class="line">$ docker start my-container</span><br></pre></td></tr></table></figure><h3 id="docker-run-åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨"><code>docker run</code> : åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨</h3><ul class="lvl-0"><li class="lvl-2"><p>ç›¸å½“äº<code>docker create</code> + <code>docker start</code></p></li><li class="lvl-2"><p>å¸¸ç”¨å‚æ•°è¯´æ˜</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>-d</code>, <code>--detach</code></td><td>åå°è¿è¡Œå®¹å™¨ï¼ˆå³â€œå®ˆæŠ¤æ€â€ï¼‰ï¼Œ<code>run</code>ç‹¬æœ‰</td><td><code>docker run -d nginx</code></td></tr><tr><td><code>-it</code></td><td>äº¤äº’å¼è¿è¡Œå®¹å™¨å¹¶åˆ†é…ç»ˆç«¯ï¼ˆå¸¸ç”¨äºè°ƒè¯•ï¼‰</td><td><code>docker run -it ubuntu bash</code></td></tr><tr><td><code>--name</code></td><td>æŒ‡å®šå®¹å™¨åç§°</td><td><code>docker run --name my-nginx nginx</code></td></tr><tr><td><code>--rm</code></td><td>å®¹å™¨é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤</td><td><code>docker run --rm ubuntu</code></td></tr><tr><td><code>-p</code>, <code>--publish</code></td><td>ç«¯å£æ˜ å°„ï¼ˆå®¿ä¸»æœº:å®¹å™¨ï¼‰</td><td><code>docker run -p 8080:80 nginx</code></td></tr><tr><td><code>-P</code>, <code>--publish-all</code></td><td>è‡ªåŠ¨éšæœºæ˜ å°„å®¹å™¨å†…éƒ¨æ‰€æœ‰æš´éœ²ç«¯å£åˆ°å®¿ä¸»æœºç«¯å£</td><td><code>docker run -P nginx</code></td></tr><tr><td><code>-v</code>, <code>--volume</code></td><td>æŒ‚è½½å·ï¼ˆå®¿ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•ï¼‰</td><td><code>docker run -v /data:/app/data myapp</code></td></tr><tr><td><code>--mount</code></td><td>æ›´çµæ´»çš„æŒ‚è½½æ–¹å¼ï¼ˆæ¨èæ–°é¡¹ç›®ä½¿ç”¨ï¼‰</td><td><code>docker run --mount type=bind,source=/host,target=/container nginx</code></td></tr><tr><td><code>--env</code>, <code>-e</code></td><td>è®¾ç½®ç¯å¢ƒå˜é‡</td><td><code>docker run -e ENV=prod myapp</code></td></tr><tr><td><code>--env-file</code></td><td>ä»æ–‡ä»¶ä¸­åŠ è½½å¤šä¸ªç¯å¢ƒå˜é‡</td><td><code>docker run --env-file .env myapp</code></td></tr><tr><td><code>--network</code></td><td>è®¾ç½®å®¹å™¨ä½¿ç”¨çš„ç½‘ç»œæ¨¡å¼</td><td><code>docker run --network host myapp</code></td></tr><tr><td><code>--restart</code></td><td>è®¾ç½®å®¹å™¨çš„è‡ªåŠ¨é‡å¯ç­–ç•¥</td><td><code>docker run --restart=always myapp</code></td></tr><tr><td><code>--privileged</code></td><td>ç»™äºˆå®¹å™¨æ›´å¤šçš„æƒé™ï¼ˆå¦‚è®¿é—® host è®¾å¤‡ï¼‰</td><td><code>docker run --privileged myapp</code></td></tr><tr><td><code>--entrypoint</code></td><td>è¦†ç›–é•œåƒé»˜è®¤çš„ ENTRYPOINT</td><td><code>docker run --entrypoint /bin/bash myapp</code></td></tr><tr><td><code>-u</code>, <code>--user</code></td><td>æŒ‡å®šå®¹å™¨å†…è¿è¡Œçš„ç”¨æˆ·ï¼ˆæ ¼å¼ï¼šUID æˆ– UID:GIDï¼‰</td><td><code>docker run --user 1000:1000 myapp</code></td></tr><tr><td><code>-c</code>, <code>--cpu-shares</code></td><td>è®¾ç½® CPU æƒé‡ï¼ˆç›¸å¯¹å€¼ï¼‰</td><td><code>docker run --cpu-shares=512 myapp</code></td></tr><tr><td><code>-m</code>, <code>--memory</code></td><td>é™åˆ¶å®¹å™¨æœ€å¤§å†…å­˜ï¼ˆå¦‚ <code>512m</code>, <code>1g</code>ï¼‰</td><td><code>docker run --memory=512m myapp</code></td></tr><tr><td><code>-h</code>,<code> --hostname</code></td><td>è®¾ç½®å®¹å™¨ä¸»æœºå</td><td><code>docker run -h myhost myapp</code></td></tr><tr><td><code>--link</code>(æ›´æ¨èä½¿ç”¨ <code>--network</code>)</td><td>åˆ›å»ºé“¾æ¥åˆ°å…¶ä»–å®¹å™¨</td><td><code>docker run --link myapp:app myapp2</code></td></tr><tr><td><code>--cpus</code></td><td>é™åˆ¶å®¹å™¨ä½¿ç”¨çš„CPUæ ¸æ•°</td><td><code>docker run --cpus=&quot;1.5&quot;</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p><code>-p</code>, <code>--publish</code> ç«¯å£æ˜ å°„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p [ä¸»æœºIP:]ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£[/åè®®]</span><br></pre></td></tr></table></figure><table><thead><tr><th>ç¤ºä¾‹</th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td><code>-p 8080:80</code></td><td>å°†ä¸»æœºçš„ 8080 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£ï¼ˆé»˜è®¤ TCPï¼‰</td></tr><tr><td><code>-p 127.0.0.1:8080:80</code></td><td>ä»…å°†ä¸»æœºæœ¬åœ° IPï¼ˆ127.0.0.1ï¼‰çš„ 8080 æ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£ï¼ˆå¤–éƒ¨æ— æ³•è®¿é—®ï¼‰</td></tr><tr><td><code>-p 8080:80/tcp</code></td><td>æ˜¾å¼æŒ‡å®šåè®®ä¸º TCPï¼ˆç­‰åŒäºä¸åŠ  <code>/tcp</code>ï¼‰</td></tr><tr><td><code>-p 8080:80/udp</code></td><td>æ˜ å°„ UDP åè®®ç«¯å£ï¼ˆå¦‚ DNS æœåŠ¡ç­‰ï¼‰</td></tr><tr><td><code>-p 8080</code></td><td>å®¿ä¸»æœºéšæœºç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„8080ç«¯å£</td></tr><tr><td><code>-p 3000-3006:4000-4006</code></td><td><strong>èŒƒå›´æ˜ å°„</strong>ï¼Œä¸èƒ½æ˜ å°„éå¯¹ç§°èŒƒå›´ï¼ˆå¦‚ 3000-3006:4000-4006ï¼‰ï¼Œåªèƒ½ä¸€ä¸€å¯¹åº”</td></tr><tr><td>å¤šä¸ª <code>-p</code></td><td>å¯ä»¥å¤šæ¬¡ä½¿ç”¨ <code>-p</code>ï¼Œæ˜ å°„å¤šä¸ªç«¯å£ã€‚ä¾‹å¦‚ï¼š<code>-p 80:80 -p 443:443</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p><code>-v, --volume</code> æ•°æ®å·æ˜ å°„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">docker run -v &lt;æœ¬åœ°è·¯å¾„&gt;:&lt;å®¹å™¨è·¯å¾„&gt;[:æƒé™]</span><br><span class="line">  <span class="comment"># &lt;æœ¬åœ°è·¯å¾„&gt;ä¸»æœºä¸Šçš„è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼Œæˆ–å‘½åå·ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line">  <span class="comment"># &lt;å®¹å™¨è·¯å¾„&gt;å®¹å™¨å†…çš„è·¯å¾„ï¼Œç›®å½•ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line">  <span class="comment"># [:æƒé™]å¯é€‰ï¼šroï¼ˆåªè¯»ï¼‰ æˆ– rwï¼ˆè¯»å†™ï¼Œé»˜è®¤ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># æŒ‚è½½æœ¬åœ°ç›®å½•åˆ°å®¹å™¨</span></span><br><span class="line">docker run -v /data:/app/data myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‚è½½ä¸ºåªè¯»</span></span><br><span class="line">docker run -v /data:/app/data:ro myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‚è½½å¤šä¸ªæ•°æ®å·</span></span><br><span class="line">docker run -v /data1:/app/data1 -v /data2:/app/data2 myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å‘½åå·</span></span><br><span class="line">docker volume create mydata</span><br><span class="line">docker run -v mydata:/app/data myapp</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>--mount</code> æŒ‚è½½å·</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --mount æ˜¯ Docker æ¨èä½¿ç”¨çš„ ç°ä»£æŒ‚è½½æ–¹å¼ï¼ŒåŠŸèƒ½å’Œ -vï¼ˆæˆ– --volumeï¼‰ç±»ä¼¼ï¼Œä½†è¯­æ³•æ›´æ¸…æ™°ã€ç»“æ„æ›´è§„èŒƒï¼Œé€‚ç”¨äºå·ï¼ˆvolumeï¼‰ã€ç»‘å®šæŒ‚è½½ï¼ˆbindï¼‰å’Œä¸´æ—¶æŒ‚è½½ï¼ˆtmpfsï¼‰ã€‚</span></span><br><span class="line">docker run --mount <span class="built_in">type</span>=&lt;ç±»å‹&gt;,<span class="built_in">source</span>=&lt;ä¸»æœºè·¯å¾„æˆ–å·å&gt;,target=&lt;å®¹å™¨è·¯å¾„&gt;[,<span class="built_in">readonly</span>]</span><br></pre></td></tr></table></figure><blockquote><p>ä¸‰ç§æŒ‚è½½ç±»å‹å¯¹æ¯”</p></blockquote><table><thead><tr><th>ç±»å‹ (<code>type</code>)</th><th>ç”¨é€”</th><th>ç¤ºä¾‹ <code>source</code></th></tr></thead><tbody><tr><td><code>volume</code></td><td>ä½¿ç”¨ Docker ç®¡ç†çš„å·</td><td>å·åï¼Œå¦‚ <code>mydata</code></td></tr><tr><td><code>bind</code></td><td>æŒ‚è½½å®¿ä¸»æœºçš„å®é™…è·¯å¾„</td><td>ç»å¯¹è·¯å¾„ï¼Œå¦‚ <code>/home/user/app/config</code></td></tr><tr><td><code>tmpfs</code></td><td>æŒ‚è½½å†…å­˜ä¸­çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ</td><td>æ— éœ€æŒ‡å®š <code>source</code></td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨å‘½åå·æŒ‚è½½ï¼ˆæ¨èæ–¹å¼ï¼‰,è¿™é‡Œ --target æŒ‡å®šå®¹å™¨å†…çš„æŒ‚è½½ç‚¹ï¼Œä¹Ÿå¯ä»¥æ›¿æ¢ä¸º --destination</span></span><br><span class="line">docker run --mount <span class="built_in">type</span>=volume,<span class="built_in">source</span>=mydata,target=/app/data myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æœ¬åœ°è·¯å¾„æŒ‚è½½ï¼ˆç»‘å®šæŒ‚è½½ï¼‰,sourceæŒ‡å®šçš„æœ¬åœ°è·¯å¾„å¿…é¡»å­˜åœ¨</span></span><br><span class="line">docker run --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=/home/user/app/config,target=/app/config myapp</span><br><span class="line"><span class="comment"># åªè¯»æŒ‚è½½ï¼Œreadonly å¯ä»¥ç®€å†™ä¸º ro</span></span><br><span class="line">docker run --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=/home/user/app/config,target=/app/config,<span class="built_in">readonly</span> myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å†…å­˜ä¸­çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼Œæ•°æ®ä¸ä¼šæŒä¹…åŒ–ï¼Œåªå­˜å‚¨åœ¨å®¹å™¨è¿è¡Œæ—¶çš„å†…å­˜ä¸­</span></span><br><span class="line">docker run --mount <span class="built_in">type</span>=tmpfs,target=/app/tmpfs myapp</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>--link</code> å®¹å™¨é—´é“¾æ¥</p></li></ul><blockquote><p>ç”¨äºåœ¨å®¹å™¨ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä½¿ä¸€ä¸ªå®¹å™¨å¯ä»¥é€šè¿‡å¦ä¸€ä¸ªå®¹å™¨çš„åç§°è®¿é—®å…¶ç½‘ç»œä¿¡æ¯ï¼ˆå¦‚ IPã€ç¯å¢ƒå˜é‡ç­‰ï¼‰ã€‚<br>æ³¨æ„ï¼š<code>--link</code> å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨ <code>--network</code> æ¥å®ç°å®¹å™¨é—´é“¾æ¥ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">link</span> &lt;ç›®æ ‡å®¹å™¨å&gt;:&lt;åˆ«å&gt; &lt;å…¶ä»–å‚æ•°&gt; &lt;é•œåƒå&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># åœºæ™¯ï¼šä¸€ä¸ª web å®¹å™¨æƒ³è¦è¿æ¥å¦ä¸€ä¸ªè¿è¡Œä¸­çš„ db å®¹å™¨</span></span><br><span class="line"><span class="comment"># å…ˆå¯åŠ¨æ•°æ®åº“å®¹å™¨</span></span><br><span class="line">docker run -d --name db mysql</span><br><span class="line"><span class="comment"># å¯åŠ¨ web å®¹å™¨å¹¶è¿æ¥åˆ° db å®¹å™¨</span></span><br><span class="line">docker run -it --<span class="built_in">rm</span> --name web --<span class="built_in">link</span> db:mydb ubuntu bash</span><br><span class="line"><span class="comment"># åœ¨ web å®¹å™¨ä¸­ï¼Œç°åœ¨ä½ å¯ä»¥ç”¨ mydb æ¥è®¿é—® db å®¹å™¨ï¼Œä½†åè¿‡æ¥ db å®¹å™¨æ— æ³•è®¿é—® web å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> web ping mydb</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ”¹ç”¨ --network å®ç°</span></span><br><span class="line">docker network create mynet</span><br><span class="line">docker run -d --name db --network mynet mysql</span><br><span class="line">docker run -it --<span class="built_in">rm</span> --name web --network mynet ubuntu bash</span><br><span class="line">docker <span class="built_in">exec</span> web ping db</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>--network</code> ç½‘ç»œæ¨¡å¼ç±»å‹</p></li></ul><table><thead><tr><th>ç±»å‹</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹/é€‚ç”¨åœºæ™¯</th><th>æ˜¯å¦å…è®¸ç«¯å£æ˜ å°„</th></tr></thead><tbody><tr><td><code>bridge</code></td><td>é»˜è®¤ç½‘ç»œç±»å‹ï¼ˆç”¨æˆ·è‡ªå®šä¹‰æˆ– Docker é»˜è®¤æ¡¥æ¥ç½‘ç»œï¼‰</td><td>å®¹å™¨é€šè¿‡è™šæ‹Ÿç½‘æ¡¥è¿æ¥ï¼Œå¯ç›¸äº’é€šä¿¡ï¼›é€‚ç”¨äºå•ä¸»æœºéƒ¨ç½²</td><td>âœ… æ˜¯</td></tr><tr><td><code>host</code></td><td>å®¹å™¨ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œæ ˆ</td><td>æ²¡æœ‰ç½‘ç»œéš”ç¦»ï¼Œå®¹å™¨ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ï¼Œæ€§èƒ½é«˜ï¼Œé€‚åˆå¯¹ç½‘ç»œè¦æ±‚é«˜çš„æœåŠ¡</td><td>âŒ å¦</td></tr><tr><td><code>none</code></td><td>å®¹å™¨æ²¡æœ‰ç½‘ç»œæ¥å£</td><td>å®Œå…¨éš”ç¦»ï¼›é€‚ç”¨äºéœ€è¦å®Œå…¨æ§åˆ¶ç½‘ç»œçš„åœºæ™¯æˆ–æµ‹è¯•ç½‘ç»œä¸å¯è¾¾æ€§</td><td>âŒ å¦</td></tr><tr><td><code>&lt;user-defined&gt;</code></td><td>ç”¨æˆ·è‡ªå®šä¹‰çš„ç½‘ç»œåç§°ï¼Œé€šè¿‡ <code>docker network create</code> åˆ›å»º</td><td>æ”¯æŒå®¹å™¨åç§°äº’è§£æï¼ˆDNSï¼‰ï¼Œé€‚åˆå¤šå®¹å™¨é€šä¿¡åœºæ™¯ï¼Œå¦‚ Docker Compose</td><td>âœ… æ˜¯</td></tr><tr><td><code>container:&lt;name|id&gt;</code></td><td>ä¸å¦ä¸€ä¸ªå®¹å™¨å…±äº«ç½‘ç»œå‘½åç©ºé—´</td><td>ä¸¤ä¸ªå®¹å™¨å…±äº« IP å’Œç«¯å£ï¼Œé€‚ç”¨äºä¸»-è¾…å®¹å™¨æ¨¡å¼ï¼Œå¦‚ sidecar å®¹å™¨å…±äº«ä¸»å®¹å™¨ç½‘ç»œ</td><td>âŒ å¦</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨é»˜è®¤ bridge ç½‘ç»œ</span></span><br><span class="line">docker run -p 8080:80 --network bridge --name my-nginx nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œï¼Œä¸èƒ½ä½¿ç”¨-p</span></span><br><span class="line">docker run --network host nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ä½¿ç”¨ä»»ä½•ç½‘ç»œï¼Œä¸èƒ½ä½¿ç”¨-p</span></span><br><span class="line">docker run --network none nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å·²åˆ›å»ºçš„è‡ªå®šä¹‰ç½‘ç»œï¼Œç›¸åŒç½‘ç»œå‘½åç©ºé—´ä¸‹çš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡å®¹å™¨ åç§°æˆ–ID äº’ç›¸è®¿é—®</span></span><br><span class="line">docker network create nginx_net</span><br><span class="line">docker run -p 8080:80 --network nginx_net nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸å¦ä¸€ä¸ªå®¹å™¨å…±äº«ç½‘ç»œå‘½åç©ºé—´ï¼Œä¸èƒ½ä½¿ç”¨-pï¼Œå¹¶ä¸”æ­¤æ—¶æ–°å¯åŠ¨çš„å®¹å™¨å ç”¨çš„ç«¯å£ä¸èƒ½ä¸è¦è¿æ¥çš„å®¹å™¨ç«¯å£ä¸€è‡´ï¼Œå¦åˆ™å°†å¯åŠ¨å¤±è´¥</span></span><br><span class="line">docker run --network container:my-nginx busybox</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>--restart</code> é‡å¯ç­–ç•¥</p></li></ul><table><thead><tr><th>ç­–ç•¥</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>no</code>ï¼ˆé»˜è®¤ï¼‰</td><td>å®¹å™¨é€€å‡ºåä¸ä¼šè‡ªåŠ¨é‡å¯</td></tr><tr><td><code>always</code></td><td>æ— è®ºé€€å‡ºçŠ¶æ€ç å¦‚ä½•ï¼Œå®¹å™¨æ€»æ˜¯è‡ªåŠ¨é‡å¯</td></tr><tr><td><code>unless-stopped</code></td><td>å®¹å™¨æ€»æ˜¯è‡ªåŠ¨é‡å¯ï¼Œé™¤éç”¨æˆ·æ‰‹åŠ¨åœæ­¢å®ƒ</td></tr><tr><td><code>on-failure[:N]</code></td><td>ä»…åœ¨å®¹å™¨é 0 çŠ¶æ€ç é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯ï¼ˆå¯é€‰è®¾ç½®æœ€å¤§é‡å¯æ¬¡æ•° Nï¼‰</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¹å™¨éæ­£å¸¸é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯</span></span><br><span class="line">docker run --restart on-failure my-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€å¤šé‡å¯ 5 æ¬¡</span></span><br><span class="line">docker run --restart on-failure:5 my-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€»æ˜¯é‡å¯ï¼ˆå³ä½¿ä½ é‡å¯ Docker æœåŠ¡åï¼‰</span></span><br><span class="line">docker run --restart always my-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™ä¸€ç›´é‡å¯</span></span><br><span class="line">docker run --restart unless-stopped my-app</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>--cpu-shares</code> : è®¾ç½®å®¹å™¨çš„ CPU ç›¸å¯¹æƒé‡ï¼Œå³åœ¨ CPU èµ„æºç«äº‰æ—¶çš„ç›¸å¯¹ä¼˜å…ˆçº§ï¼Œé»˜è®¤å€¼ä¸º 1024ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¹å™¨1ï¼Œæƒé‡ 1024ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">docker run -d --name c1 --cpu-shares 1024 nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¹å™¨2ï¼Œæƒé‡ 512ï¼ˆä¼˜å…ˆçº§ä½ï¼‰</span></span><br><span class="line">docker run -d --name c2 --cpu-shares 512 nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">## è¯´æ˜ï¼š</span></span><br><span class="line">  <span class="comment"># c1çš„æƒé‡1024ï¼Œc2çš„æƒé‡512,ä¸æ˜¯ç»å¯¹é™åˆ¶ï¼Œè€Œæ˜¯åˆ†é…æ¯”ä¾‹</span></span><br><span class="line">  <span class="comment"># è¯¥æƒé‡è¡¨ç¤ºå®¹å™¨åœ¨ CPU ç«äº‰ä¸‹ï¼Œæƒé‡è¶Šé«˜åˆ™ä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¼šå°½å¯èƒ½ä½¿ç”¨ CPU èµ„æºã€‚</span></span><br><span class="line">  <span class="comment"># å¦‚æœè¿™ä¸¤ä¸ªå®¹å™¨éƒ½è¿è¡Œåœ¨ CPU å¿™ç¢Œçš„ç¯å¢ƒä¸‹(åªæœ‰åœ¨ å¤šå®¹å™¨å…±äº« CPU ä¸”ç«äº‰èµ„æº çš„æƒ…å†µä¸‹æ‰ç”Ÿæ•ˆ)ï¼š</span></span><br><span class="line">    <span class="comment"># c1 å°†è·å¾—å¤§çº¦ 2/3 çš„ CPU æ—¶é—´</span></span><br><span class="line">    <span class="comment"># c2 å°†è·å¾—å¤§çº¦ 1/3 çš„ CPU æ—¶é—´</span></span><br><span class="line">  <span class="comment"># å¦‚æœç³»ç»Ÿ CPU ç©ºé—²ï¼Œæ‰€æœ‰å®¹å™¨éƒ½å¯ä»¥ä½¿ç”¨ 100% çš„ CPUã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker run</code> ç¤ºä¾‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ä¸€ä¸ªnginx å®¹å™¨</span></span><br><span class="line">docker run -d -p 80:80 --name nginx nginx</span><br><span class="line"><span class="comment"># æ›¿æ¢nginxé•œåƒé»˜è®¤çš„å¯åŠ¨å‘½ä»¤ï¼Œnginx é•œåƒé»˜è®¤å¯åŠ¨ nginx æœåŠ¡ï¼Œæ­¤å‘½ä»¤ä¼šæ”¹ä¸ºæ‰§è¡Œ nginx -v æ˜¾ç¤ºç‰ˆæœ¬å·</span></span><br><span class="line">docker run --name test_nginx --entrypoint <span class="string">&quot;&quot;</span> nginx nginx -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œè„šæœ¬æˆ–å‘½ä»¤ï¼Œè¿™é‡Œæ·»åŠ  --rm å‚æ•°ï¼Œè¡¨ç¤ºè¿è¡Œç»“æŸåè‡ªåŠ¨åˆ é™¤å®¹å™¨ï¼Œè¿™é‡Œæ˜¯å®‰è£… ping å‘½ä»¤</span></span><br><span class="line">docker run --<span class="built_in">rm</span> ubuntu bash -c <span class="string">&quot;apt update &amp;&amp; apt install -y iputils-ping&quot;</span></span><br><span class="line"><span class="comment"># äº¤äº’å¼æ‰§è¡Œ shell å‘½ä»¤ï¼Œæ‰§è¡Œå‘½ä»¤åä¼šè¿›å…¥å®¹å™¨çš„shell</span></span><br><span class="line">docker run --<span class="built_in">rm</span> -it ubuntu /bin/bash</span><br><span class="line"><span class="comment"># è¿™æ ·ä¹Ÿå¯ä»¥ï¼Œå› ä¸º ubuntu çš„é»˜è®¤å¯åŠ¨å‘½ä»¤æ˜¯ /bin/bash</span></span><br><span class="line">docker run --<span class="built_in">rm</span> -it ubuntu</span><br><span class="line"><span class="comment"># è½¬åˆ°åå°è¿è¡Œ</span></span><br><span class="line">docker run --<span class="built_in">rm</span> -itd ubuntu</span><br></pre></td></tr></table></figure><h3 id="docker-stop-åœæ­¢å®¹å™¨ï¼Œå®¹å™¨ä¼˜é›…é€€å‡º"><code>docker stop</code> : åœæ­¢å®¹å™¨ï¼Œå®¹å™¨ä¼˜é›…é€€å‡º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢å®¹å™¨ï¼Œé€šè¿‡å®¹å™¨åç§°</span></span><br><span class="line">docker stop test_nginx</span><br><span class="line"><span class="comment"># åœæ­¢å®¹å™¨ï¼Œé€šè¿‡å®¹å™¨ID</span></span><br><span class="line">docker stop 5d7c0c5d5c0c</span><br><span class="line"><span class="comment"># åœæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">docker stop $(docker ps -q)</span><br><span class="line"><span class="comment"># ç­‰å¾…5ç§’åå¼ºåˆ¶å…³é—­</span></span><br><span class="line">docker stop -t 5 test_nginx</span><br></pre></td></tr></table></figure><h3 id="docker-kill-å¼ºåˆ¶åœæ­¢å®¹å™¨"><code>docker kill</code> : å¼ºåˆ¶åœæ­¢å®¹å™¨</h3><ul class="lvl-0"><li class="lvl-2"><p>å½“å®¹å™¨å®Œå…¨å¡æ­»ã€æŒ‚èµ·ã€ä¸å“åº” <code>stop</code> å‘½ä»¤æ—¶ä½¿ç”¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">kill</span> test_nginx</span><br><span class="line">docker <span class="built_in">kill</span> 5d7c0c5d5c0c</span><br><span class="line">docker <span class="built_in">kill</span> $(docker ps -q)</span><br></pre></td></tr></table></figure><h3 id="docker-restart-é‡å¯å®¹å™¨"><code>docker restart</code> : é‡å¯å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker restart test_nginx</span><br><span class="line">docker restart 5d7c0c5d5c0c</span><br><span class="line">docker restart $(docker ps -q)</span><br></pre></td></tr></table></figure><h3 id="docker-pause-æš‚åœå®¹å™¨"><code>docker pause</code> : æš‚åœå®¹å™¨</h3><ul class="lvl-0"><li class="lvl-2"><p>æš‚åœåå®¿ä¸»æœºå°†ä¸å†ä¸ºå®¹å™¨åˆ†é…CPUæ—¶é—´ç‰‡ï¼Œä½†å†…å­˜ä¾ç„¶æœ‰æ•ˆï¼Œä½ å¯ä»¥ç†è§£ä¸ºæ­¤æ—¶ä¸ºå®¹å™¨ä¿å­˜äº†å¿«ç…§</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pause test_nginx</span><br><span class="line">docker pause 5d7c0c5d5c0c</span><br><span class="line">docker pause $(docker ps -q)</span><br></pre></td></tr></table></figure><h3 id="docker-unpause-æ¢å¤å®¹å™¨"><code>docker unpause</code> : æ¢å¤å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker unpause test_nginx</span><br><span class="line">docker unpause 5d7c0c5d5c0c</span><br><span class="line">docker unpause $(docker ps -q)</span><br></pre></td></tr></table></figure><h3 id="docker-ps-æŸ¥çœ‹å®¹å™¨åˆ—è¡¨"><code>docker ps</code> : æŸ¥çœ‹å®¹å™¨åˆ—è¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨</span></span><br><span class="line">docker ps -a</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„ID</span></span><br><span class="line">docker ps -q</span><br><span class="line"><span class="comment"># ä¸æˆªæ–­è¾“å‡ºï¼Œæ­¤æ—¶ COMMAND åˆ—ä¼šæ˜¾ç¤ºå®Œæ•´çš„å‘½ä»¤</span></span><br><span class="line">docker ps -notrunc</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„5æ¡å®¹å™¨</span></span><br><span class="line">docker ps -n 5</span><br><span class="line"><span class="comment"># è¿‡æ»¤å™¨ï¼Œæ˜¾ç¤ºçŠ¶æ€ä¸ºexitedçš„å®¹å™¨</span></span><br><span class="line">docker ps -a --filter <span class="string">&quot;status=exited&quot;</span></span><br><span class="line"><span class="comment"># æŒ‡å®šæ¨¡æ¿ï¼Œåªæ˜¾ç¤º ID å’Œ Names</span></span><br><span class="line">docker ps --format <span class="string">&quot;&#123;&#123;.ID&#125;&#125;: &#123;&#123;.Names&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="docker-inspect-æŸ¥çœ‹å®¹å™¨ä¿¡æ¯"><code>docker inspect</code> : æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</span></span><br><span class="line">docker inspect &lt;container_id&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨åç§°</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;.Name&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨é•œåƒ</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;.Config.Image&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨ç¯å¢ƒå˜é‡</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;.Config.Env&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çŠ¶æ€ï¼Œå‰é¢çš„ json è¡¨ç¤ºè¾“å‡ºä¸º json æ ¼å¼</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;json .State&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨å†…å­˜é™åˆ¶</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;.HostConfig.Memory&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨label</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;json .Config.Labels&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„ç½‘ç»œä¿¡æ¯</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;json .NetworkSettings&#125;&#125;&#x27;</span> &lt;container_id | container_name&gt;</span><br></pre></td></tr></table></figure><h3 id="docker-logs-è·å–å®¹å™¨æ—¥å¿—"><code>docker logs</code> : è·å–å®¹å™¨æ—¥å¿—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–å®¹å™¨æ—¥å¿—</span></span><br><span class="line">docker logs &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨å®æ—¶æ—¥å¿—</span></span><br><span class="line">docker logs -f &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨æœ€æ–°çš„ 10 è¡Œæ—¥å¿—</span></span><br><span class="line">docker logs -n 10 &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—</span></span><br><span class="line">docker logs -t &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„æ—¥å¿—ï¼Œä» 1 å°æ—¶å‰å¼€å§‹</span></span><br><span class="line">docker logs --since 1h &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„æ—¥å¿—ï¼Œç›´åˆ° 1 å°æ—¶å‰</span></span><br><span class="line">docker logs --<span class="keyword">until</span> 1h &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„è¯¦ç»†æ—¥å¿—</span></span><br><span class="line">docker logs --details &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># è·å–å®¹å™¨çš„æ—¥å¿—ï¼Œä» 2 å°æ—¶å‰å¼€å§‹ï¼Œç›´åˆ° 1 å°æ—¶å‰</span></span><br><span class="line">docker logs --since 2h --<span class="keyword">until</span> 1h &lt;container_id | container_name&gt;</span><br></pre></td></tr></table></figure><h3 id="docker-exec-åœ¨å·²ç»è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤"><code>docker exec</code> : åœ¨å·²ç»è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å·²ç»è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">docker <span class="built_in">exec</span> &lt;container_id | container_name&gt; &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨shell</span></span><br><span class="line">docker <span class="built_in">exec</span> -it &lt;container_id | container_name&gt; bash</span><br></pre></td></tr></table></figure><h3 id="docker-rename-é‡å‘½åå®¹å™¨"><code>docker rename</code> : é‡å‘½åå®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rename &lt;old_container_name&gt; &lt;new_container_name&gt;</span><br></pre></td></tr></table></figure><h3 id="docker-cp-å®¹å™¨ä¸å®¿ä¸»æœºé—´å¤åˆ¶æ–‡ä»¶"><code>docker cp</code> : å®¹å™¨ä¸å®¿ä¸»æœºé—´å¤åˆ¶æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¿ä¸»æœº -&gt; å®¹å™¨</span></span><br><span class="line"><span class="comment"># docker cp &lt;host_path&gt; &lt;container_id | container_name&gt;:&lt;container_path&gt;</span></span><br><span class="line">docker <span class="built_in">cp</span> ./docker-command-container.md nginx:/tmp</span><br><span class="line"><span class="comment"># å®¹å™¨ -&gt; å®¿ä¸»æœº</span></span><br><span class="line"><span class="comment"># docker cp &lt;container_id | container_name&gt;:&lt;container_path&gt; &lt;host_path&gt;</span></span><br><span class="line">docker <span class="built_in">cp</span> nginx:/tmp/docker-command-container.md ./</span><br></pre></td></tr></table></figure><h3 id="docker-rm-åˆ é™¤å®¹å™¨"><code>docker rm</code> : åˆ é™¤å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æŒ‡å®šå®¹å™¨</span></span><br><span class="line">docker <span class="built_in">rm</span> &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">rm</span> $(docker ps -aq)</span><br></pre></td></tr></table></figure><h3 id="docker-container-prune-åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨"><code>docker container prune</code> : åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container prune</span><br></pre></td></tr></table></figure><h3 id="docker-update-æ›´æ–°å®¹å™¨é…ç½®"><code>docker update</code> : æ›´æ–°å®¹å™¨é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ–°æŒ‡å®šå®¹å™¨çš„CPUæ ¸æ•°å’Œå†…å­˜å¤§å°</span></span><br><span class="line">docker update --cpus=2 --memory=2g &lt;container_id | container_name&gt;</span><br><span class="line"><span class="comment"># æ›´æ–°æŒ‡å®šå®¹å™¨è‡ªåŠ¨é‡å¯</span></span><br><span class="line">docker update --restart=always &lt;container_id | container_name&gt;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„é…ç½®éƒ½æ”¯æŒæ›´æ–°ï¼Œupdate å‘½ä»¤åªæ”¯æŒå¦‚ä¸‹é…ç½®ï¼ŒåŸºæœ¬ä¸Šä¹Ÿå°±åªèƒ½è°ƒä¸€ä¸‹cpuå’Œå†…å­˜ï¼Œä»¥åŠè‡ªåŠ¨é‡å¯ç­–ç•¥ï¼Œæ‰€ä»¥åˆ¶ä½œå®¹å™¨æ—¶ä¸€å®šè¦åšå¥½è§„åˆ’ã€‚</p></li></ul><table><thead><tr><th>å‚æ•°å</th><th>è¯´æ˜</th><th>ç¤ºä¾‹å€¼</th></tr></thead><tbody><tr><td><code>--blkio-weight</code></td><td>è®¾ç½® Block IO çš„ç›¸å¯¹æƒé‡ï¼ŒèŒƒå›´æ˜¯ 10 åˆ° 1000ï¼Œè®¾ç½®ä¸º 0 è¡¨ç¤ºç¦ç”¨ï¼ˆé»˜è®¤å€¼ä¸º 0ï¼‰</td><td><code>--blkio-weight=500</code></td></tr><tr><td><code>--cpu-period</code></td><td>è®¾ç½® CPU CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼‰çš„å‘¨æœŸé™åˆ¶ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰</td><td><code>--cpu-period=100000</code></td></tr><tr><td><code>--cpu-quota</code></td><td>è®¾ç½® CPU CFS çš„é…é¢é™åˆ¶ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰</td><td><code>--cpu-quota=50000</code></td></tr><tr><td><code>--cpu-rt-period</code></td><td>è®¾ç½®å®æ—¶ CPU çš„è°ƒåº¦å‘¨æœŸï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰</td><td><code>--cpu-rt-period=1000000</code></td></tr><tr><td><code>--cpu-rt-runtime</code></td><td>è®¾ç½®å®æ—¶ CPU çš„è¿è¡Œæ—¶é—´é™åˆ¶ï¼ˆå•ä½ï¼šå¾®ç§’ï¼‰</td><td><code>--cpu-rt-runtime=950000</code></td></tr><tr><td><code>-c</code>, <code>--cpu-shares</code></td><td>è®¾ç½® CPU å…±äº«æƒé‡ï¼Œé»˜è®¤å€¼ä¸º 1024</td><td><code>--cpu-shares=512</code></td></tr><tr><td><code>--cpus</code></td><td>é™åˆ¶å®¹å™¨ä½¿ç”¨çš„ CPU æ•°é‡ï¼ˆæ”¯æŒå°æ•°ï¼‰</td><td><code>--cpus=1.5</code></td></tr><tr><td><code>--cpuset-cpus</code></td><td>æŒ‡å®šå®¹å™¨å¯ä»¥åœ¨å“ªäº› CPU ä¸Šè¿è¡Œï¼ˆå¦‚ 0-3ã€0,1ï¼‰</td><td><code>--cpuset-cpus=&quot;0,1&quot;</code></td></tr><tr><td><code>--cpuset-mems</code></td><td>æŒ‡å®šå®¹å™¨å¯ä»¥ä½¿ç”¨å“ªäº›å†…å­˜èŠ‚ç‚¹ï¼ˆå¦‚ 0-3ã€0,1ï¼‰ï¼Œé€‚ç”¨äº NUMA ç³»ç»Ÿ</td><td><code>--cpuset-mems=&quot;0&quot;</code></td></tr><tr><td><code>-m</code>, <code>--memory</code></td><td>è®¾ç½®å†…å­˜é™åˆ¶ï¼ˆä¾‹å¦‚ 512mã€2gï¼‰</td><td><code>--memory=1g</code></td></tr><tr><td><code>--memory-reservation</code></td><td>è®¾ç½®å†…å­˜è½¯é™åˆ¶ï¼ˆä½äº <code>--memory</code> çš„å€¼æ—¶ï¼Œå…è®¸ç³»ç»Ÿåœ¨å‹åŠ›è¾ƒå°æ—¶å›æ”¶ï¼‰</td><td><code>--memory-reservation=512m</code></td></tr><tr><td><code>--memory-swap</code></td><td>è®¾ç½® swap é™åˆ¶ï¼ˆå†…å­˜ + swap æ€»å’Œï¼‰ï¼Œè®¾ä¸º -1 è¡¨ç¤ºæ— é™åˆ¶</td><td><code>--memory-swap=2g</code></td></tr><tr><td><code>--pids-limit</code></td><td>è®¾ç½®å®¹å™¨çš„æœ€å¤§è¿›ç¨‹æ•°é‡ï¼Œè®¾ä¸º -1 è¡¨ç¤ºæ— é™åˆ¶</td><td><code>--pids-limit=100</code></td></tr><tr><td><code>--restart</code></td><td>è®¾ç½®å®¹å™¨é€€å‡ºåçš„é‡å¯ç­–ç•¥</td><td><code>--restart=always</code></td></tr></tbody></table><h3 id="docker-stats-æ˜¾ç¤ºå®¹å™¨çš„å®æ—¶èµ„æºä½¿ç”¨æƒ…å†µ"><code>docker stats</code> : æ˜¾ç¤ºå®¹å™¨çš„å®æ—¶èµ„æºä½¿ç”¨æƒ…å†µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨çš„å®æ—¶èµ„æºä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">docker stats</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">CONTAINER ID   NAME         CPU %     MEM USAGE / LIMIT     MEM %     NET I/O           BLOCK I/O     PIDS</span><br><span class="line">15caf520e3a5   nginx        0.00%     10.22MiB / 7.752GiB   0.13%     6.38kB / 2.61kB   0B / 28.7kB   13</span><br><span class="line">b680087420b8   dockge       0.01%     199.5MiB / 7.752GiB   2.51%     6.44kB / 1.48kB   94.8MB / 0B   24</span><br><span class="line">861dd9c1475f   remote-api   0.00%     4.188MiB / 7.752GiB   0.05%     2.77kB / 126B     3.31MB / 0B   1</span><br><span class="line"><span class="comment">### CONTAINER ID ä¸ NAMEï¼šå®¹å™¨ ID ä¸åç§°ã€‚</span></span><br><span class="line"><span class="comment">### CPU % ä¸ MEM %ï¼šå®¹å™¨ä½¿ç”¨çš„ CPU å’Œå†…å­˜çš„ç™¾åˆ†æ¯”ã€‚</span></span><br><span class="line"><span class="comment">### MEM USAGE / LIMITï¼šå®¹å™¨æ­£åœ¨ä½¿ç”¨çš„æ€»å†…å­˜ï¼Œä»¥åŠå…è®¸ä½¿ç”¨çš„å†…å­˜æ€»é‡ã€‚</span></span><br><span class="line"><span class="comment">### NET I/Oï¼šå®¹å™¨é€šè¿‡å…¶ç½‘ç»œæ¥å£å‘é€å’Œæ¥æ”¶çš„æ•°æ®é‡ã€‚</span></span><br><span class="line"><span class="comment">### BLOCK I/Oï¼šå®¹å™¨ä»ä¸»æœºä¸Šçš„å—è®¾å¤‡è¯»å–å’Œå†™å…¥çš„æ•°æ®é‡ã€‚</span></span><br><span class="line"><span class="comment">### PIDsï¼šå®¹å™¨åˆ›å»ºçš„è¿›ç¨‹æˆ–çº¿ç¨‹æ•°ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬è¿è¡Œå’Œåœæ­¢çš„</span></span><br><span class="line">docker stats -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># å±•ç¤ºå½“å‰çŠ¶æ€å°±ç›´æ¥é€€å‡ºäº†ï¼Œä¸å†å®æ—¶æ›´æ–°ã€‚</span></span><br><span class="line">docker stats --no-stream</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šè¾“å‡ºæ¨¡æ¿ï¼Œè¿™é‡ŒåŠ ä¸åŠ  table éƒ½å¯ä»¥</span></span><br><span class="line">docker stats --no-stream --format <span class="string">&quot;table &#123;&#123;.Name&#125;&#125;\t&#123;&#123;.CPUPerc&#125;&#125;\t&#123;&#123;.MemUsage&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºjsonæ ¼å¼</span></span><br><span class="line">docker stats --no-stream --format json</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šå®¹å™¨</span></span><br><span class="line">docker stats &lt;container_id | container_name&gt;</span><br></pre></td></tr></table></figure><h3 id="docker-top-æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹"><code>docker top</code> :  æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker top &lt;container_id | container_name&gt; [ps options]</span></span><br><span class="line">docker top nginx</span><br></pre></td></tr></table></figure><h3 id="docker-port-åˆ—å‡ºæŒ‡å®šçš„å®¹å™¨çš„ç«¯å£æ˜ å°„"><code>docker port</code> : åˆ—å‡ºæŒ‡å®šçš„å®¹å™¨çš„ç«¯å£æ˜ å°„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker port &lt;container_id | container_name&gt;</span></span><br><span class="line">$ docker port nginx</span><br><span class="line">80/tcp -&gt; 0.0.0.0:8081</span><br></pre></td></tr></table></figure><h3 id="docker-diff-åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶å¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹"><code>docker diff</code> : åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶å¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker diff &lt;container_id | container_name&gt;</span></span><br><span class="line">$ docker diff nginx</span><br><span class="line">C /root</span><br><span class="line">A /root/.bash_history</span><br><span class="line">C /run</span><br><span class="line">A /run/nginx.pid</span><br><span class="line">C /tmp</span><br><span class="line">A /tmp/demo.py</span><br><span class="line">C /var</span><br><span class="line">C /var/cache</span><br><span class="line">C /var/cache/nginx</span><br><span class="line">A /var/cache/nginx/client_temp</span><br><span class="line">A /var/cache/nginx/fastcgi_temp</span><br><span class="line">A /var/cache/nginx/proxy_temp</span><br><span class="line">A /var/cache/nginx/scgi_temp</span><br><span class="line">A /var/cache/nginx/uwsgi_temp</span><br><span class="line">C /etc</span><br><span class="line">C /etc/nginx</span><br><span class="line">C /etc/nginx/conf.d</span><br><span class="line">C /etc/nginx/conf.d/default.conf</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‰ç¼€å«ä¹‰è¯´æ˜ï¼š</p></li></ul><table><thead><tr><th>æ ‡å¿—</th><th>å«ä¹‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>A</code></td><td><strong>Addedï¼ˆæ–°å¢ï¼‰</strong></td><td>æ–‡ä»¶æˆ–ç›®å½•æ˜¯å®¹å™¨è¿è¡Œåæ–°å¢çš„</td></tr><tr><td><code>C</code></td><td><strong>Changedï¼ˆä¿®æ”¹ï¼‰</strong></td><td>æ–‡ä»¶æˆ–ç›®å½•æ˜¯å·²æœ‰çš„ï¼Œä½†å†…å®¹æˆ–å…ƒæ•°æ®ï¼ˆå¦‚æƒé™ã€æ—¶é—´æˆ³ç­‰ï¼‰è¢«ä¿®æ”¹äº†</td></tr><tr><td><code>D</code></td><td><strong>Deletedï¼ˆåˆ é™¤ï¼‰</strong></td><td>æ–‡ä»¶æˆ–ç›®å½•æ˜¯å­˜åœ¨äºåŸé•œåƒä¸­çš„ï¼Œä½†åœ¨å®¹å™¨ä¸­è¢«åˆ é™¤</td></tr></tbody></table><h3 id="docker-commit-ä»å®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ"><code>docker commit</code> : ä»å®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker commit &lt;container_id | container_name&gt; [image_name[:tag]]</span></span><br><span class="line">docker commit nginx nginx:v1.0</span><br></pre></td></tr></table></figure><h3 id="docker-export-å¯¼å‡ºå®¹å™¨å†…å®¹ä¸º-tar-æ–‡ä»¶"><code>docker export</code> : å¯¼å‡ºå®¹å™¨å†…å®¹ä¸º tar æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">export</span> nginx &gt; nginx.tar</span><br><span class="line">dcoker <span class="built_in">export</span> -o nginx.tar nginx</span><br><span class="line">docker <span class="built_in">export</span> nginx | gzip &gt; nginx.tar.gz</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Docker Export / Save / Commit å‘½ä»¤å¯¹æ¯”ä¸å¯¼å…¥æ–¹å¼ä¸€è§ˆè¡¨</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>æ“ä½œå¯¹è±¡</th><th>è¾“å‡ºå†…å®¹</th><th>æ˜¯å¦åŒ…å«å†å²å±‚ï¼ˆé•œåƒå±‚ï¼‰</th><th>æ˜¯å¦ä¿ç•™å…ƒæ•°æ®ï¼ˆæ ‡ç­¾ã€å‘½ä»¤ç­‰ï¼‰</th><th>å…¸å‹ç”¨é€”</th><th>å¯¼å…¥å‘½ä»¤</th></tr></thead><tbody><tr><td><code>docker export</code></td><td><strong>å®¹å™¨</strong></td><td>å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆtar å½’æ¡£ï¼‰</td><td>âŒ å¦</td><td>âŒ å¦</td><td>å¤‡ä»½å®¹å™¨æ–‡ä»¶ç³»ç»Ÿæˆ–è¿ç§»å®¹å™¨çŠ¶æ€</td><td><code>docker import &lt;tar&gt; &lt;image:tag&gt;</code></td></tr><tr><td><code>docker save</code></td><td><strong>é•œåƒ</strong></td><td>é•œåƒçš„å®Œæ•´å†…å®¹ï¼ˆå«æ‰€æœ‰å±‚çš„ tarï¼‰</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td>åˆ†å‘æˆ–å¤‡ä»½é•œåƒ</td><td><code>docker load &lt; &lt;tar&gt;</code></td></tr><tr><td><code>docker commit</code></td><td><strong>å®¹å™¨</strong></td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ</td><td>âœ… æ˜¯ï¼ˆä½†åªä¸€å±‚ï¼‰</td><td>âœ… æ˜¯</td><td>å°†å½“å‰å®¹å™¨çŠ¶æ€æ‰“åŒ…æˆæ–°é•œåƒ</td><td>ä¸é€‚ç”¨ï¼ˆç›´æ¥ç”Ÿæˆé•œåƒï¼‰</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ å®¹å™¨ç®¡ç† ç›¸å…³å‘½ä»¤&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker å‘½ä»¤ ä¹‹ Dockerfile</title>
    <link href="https://blog.hanqunfeng.com/2025/05/26/docker-dockerfile/"/>
    <id>https://blog.hanqunfeng.com/2025/05/26/docker-dockerfile/</id>
    <published>2025-05-26T13:30:05.000Z</published>
    <updated>2025-06-12T06:02:38.760Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ Dockerfile çš„ä½¿ç”¨æ–¹æ³•</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/engine/reference/builder/">Dockerfileå®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="Dockerfile-æ˜¯ä»€ä¹ˆï¼Ÿ">Dockerfile æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul class="lvl-0"><li class="lvl-2"><p>Dockerå¯ä»¥é€šè¿‡è¯»å– <code>Dockerfile</code> ä¸­çš„æŒ‡ä»¤æ¥è‡ªåŠ¨æ„å»ºé•œåƒã€‚</p></li><li class="lvl-2"><p><code>Dockerfile</code> æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè°ƒç”¨ä»¥ç»„è£…é•œåƒçš„æ‰€æœ‰æŒ‡ä»¤ã€‚</p></li><li class="lvl-2"><p>å¯ä»¥åœ¨Dockerfileä¸­ä½¿ç”¨çš„æŒ‡ä»¤ï¼š</p></li></ul><table><thead><tr><th>æŒ‡ä»¤</th><th>ä¸­æ–‡æè¿°</th></tr></thead><tbody><tr><td><strong>ADD</strong></td><td>å°†æœ¬åœ°æˆ–è¿œç¨‹çš„æ–‡ä»¶/ç›®å½•æ·»åŠ åˆ°é•œåƒä¸­ï¼Œæ”¯æŒè‡ªåŠ¨è§£å‹ <code>.tar</code> æ–‡ä»¶å’Œä½¿ç”¨ URL ä¸‹è½½è¿œç¨‹èµ„æºã€‚é€šå¸¸æ¨èä½¿ç”¨ <code>COPY</code>ï¼Œé™¤ééœ€è¦è¿™äº›é«˜çº§åŠŸèƒ½ã€‚</td></tr><tr><td><strong>ARG</strong></td><td>å®šä¹‰æ„å»ºé˜¶æ®µä½¿ç”¨çš„å˜é‡ï¼Œå¯åœ¨ <code>docker build</code> å‘½ä»¤ä¸­é€šè¿‡ <code>--build-arg</code> ä¼ å…¥ï¼Œå˜é‡ä»…åœ¨æ„å»ºæ—¶æœ‰æ•ˆï¼Œä¸ä¼šä¿ç•™åœ¨æœ€ç»ˆé•œåƒä¸­ã€‚</td></tr><tr><td><strong>CMD</strong></td><td>æŒ‡å®šå®¹å™¨é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤å’Œå‚æ•°ï¼Œå®¹å™¨è¿è¡Œæ—¶è‹¥æœªæŒ‡å®šå‘½ä»¤ï¼Œåˆ™ä½¿ç”¨è¯¥æŒ‡ä»¤è®¾ç½®çš„å‘½ä»¤ã€‚å¦‚æœé…ç½®äº†å¤šä¸ª<code>CMD</code>ï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚å’Œ<code>ENTRYPOINT</code>å…±åŒä½¿ç”¨æ—¶ï¼Œä½œä¸ºä¼ é€’ç»™<code>ENTRYPOINT</code>çš„å‚æ•°ã€‚å¯è¢« <code>docker run</code> æä¾›çš„å‘½ä»¤è¦†ç›–ã€‚</td></tr><tr><td><strong>COPY</strong></td><td>å°†æ„å»ºä¸Šä¸‹æ–‡ä¸­çš„æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é•œåƒä¸­ã€‚ç›¸æ¯” <code>ADD</code> æ›´ç®€å•ã€å®‰å…¨ï¼Œæ¨èä¼˜å…ˆä½¿ç”¨ã€‚</td></tr><tr><td><strong>ENTRYPOINT</strong></td><td>æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶çš„ä¸»å‘½ä»¤ï¼Œä¸å®¹æ˜“è¢« <code>docker run</code> ä¸­çš„å‘½ä»¤è¦†ç›–ã€‚å¯ä¸ <code>CMD</code> é…åˆä½¿ç”¨ï¼Œç”¨äºæä¾›é»˜è®¤å‚æ•°ã€‚</td></tr><tr><td><strong>ENV</strong></td><td>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå˜é‡å°†åœ¨æ„å»ºå’Œå®¹å™¨è¿è¡Œæ—¶å‡å¯ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼šé…ç½®åº”ç”¨å‚æ•°æˆ–ç³»ç»Ÿè·¯å¾„ç­‰ã€‚</td></tr><tr><td><strong>EXPOSE</strong></td><td>å£°æ˜å®¹å™¨è¿è¡Œæ—¶å°†å¼€æ”¾çš„ç«¯å£ï¼Œä»…ç”¨äºæ–‡æ¡£è¯´æ˜æˆ–ä¸å®¹å™¨ç¼–æ’å·¥å…·é…åˆï¼Œä¸ä¼šè‡ªåŠ¨è¿›è¡Œç«¯å£æ˜ å°„ã€‚</td></tr><tr><td><strong>FROM</strong></td><td>æŒ‡å®šåŸºç¡€é•œåƒï¼Œæ˜¯ Dockerfile çš„èµ·ç‚¹ã€‚ä¹Ÿå¯ä»¥ç”¨äºå¤šé˜¶æ®µæ„å»ºï¼Œé€šè¿‡å¤šæ¬¡ä½¿ç”¨ <code>FROM</code> æŒ‡ä»¤åˆ›å»ºå¤šä¸ªæ„å»ºé˜¶æ®µã€‚</td></tr><tr><td><strong>HEALTHCHECK</strong></td><td>å®šä¹‰å®¹å™¨å¥åº·æ£€æŸ¥å‘½ä»¤ï¼Œç”¨äºå®šæœŸæ£€æµ‹å®¹å™¨å†…éƒ¨æœåŠ¡çš„å¥åº·çŠ¶æ€ï¼Œå¯ç»“åˆå®¹å™¨ç¼–æ’ç³»ç»Ÿå®ç°æ•…éšœè‡ªåŠ¨æ¢å¤ã€‚</td></tr><tr><td><strong>LABEL</strong></td><td>ä¸ºé•œåƒæ·»åŠ é”®å€¼å¯¹å½¢å¼çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚ç‰ˆæœ¬ã€ç»´æŠ¤è€…ã€ç”¨é€”è¯´æ˜ç­‰ï¼Œæ–¹ä¾¿é•œåƒç®¡ç†ä¸è‡ªåŠ¨åŒ–å¤„ç†ã€‚</td></tr><tr><td><strong>MAINTAINER</strong></td><td>ï¼ˆå·²å¼ƒç”¨ï¼‰ç”¨äºæŒ‡å®šé•œåƒç»´æŠ¤è€…ä¿¡æ¯ï¼Œæ¨èæ”¹ç”¨ <code>LABEL</code> æ¥è®¾ç½®ä½œè€…ä¿¡æ¯ã€‚</td></tr><tr><td><strong>ONBUILD</strong></td><td>å®šä¹‰ä¸€ä¸ªè§¦å‘æŒ‡ä»¤ï¼Œå½“å½“å‰é•œåƒä½œä¸ºåŸºç¡€é•œåƒè¢«å…¶ä»– Dockerfile ä½¿ç”¨æ—¶è‡ªåŠ¨æ‰§è¡Œã€‚å¸¸ç”¨äºåŸºç¡€é•œåƒçš„é¢„è®¾è¡Œä¸ºã€‚</td></tr><tr><td><strong>RUN</strong></td><td>æ‰§è¡Œä¸€æ¡å‘½ä»¤å¹¶æäº¤ç»“æœä½œä¸ºæ–°é•œåƒå±‚ï¼Œå¸¸ç”¨äºå®‰è£…è½¯ä»¶åŒ…ã€å¤åˆ¶æ–‡ä»¶ã€è®¾ç½®æƒé™ç­‰æ„å»ºæ“ä½œã€‚</td></tr><tr><td><strong>SHELL</strong></td><td>æ›´æ”¹ Dockerfile ä¸­åç»­ <code>RUN</code>ã€<code>CMD</code>ã€<code>ENTRYPOINT</code> ç­‰æŒ‡ä»¤çš„é»˜è®¤ shellï¼ˆå¦‚ä½¿ç”¨ <code>sh</code> æˆ– <code>powershell</code>ï¼‰ã€‚</td></tr><tr><td><strong>STOPSIGNAL</strong></td><td>è®¾ç½®å®¹å™¨ç»ˆæ­¢æ—¶å‘é€çš„ç³»ç»Ÿä¿¡å·ï¼ˆå¦‚ <code>SIGTERM</code>ï¼‰ï¼Œç”¨äºä¼˜é›…å…³é—­åº”ç”¨ã€‚</td></tr><tr><td><strong>USER</strong></td><td>è®¾ç½®æ‰§è¡Œåç»­å‘½ä»¤æ—¶æ‰€ä½¿ç”¨çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œå¢å¼ºå®¹å™¨çš„å®‰å…¨æ€§ï¼Œé¿å…ä½¿ç”¨ root æƒé™ã€‚</td></tr><tr><td><strong>VOLUME</strong></td><td>å®šä¹‰å®¹å™¨å†…çš„æŒ‚è½½ç‚¹ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®æˆ–ä¸å®¿ä¸»æœº/å…¶ä»–å®¹å™¨å…±äº«æ•°æ®ã€‚è¿è¡Œå®¹å™¨æ—¶å¯æŒ‡å®šæŒ‚è½½è·¯å¾„ã€‚</td></tr><tr><td><strong>WORKDIR</strong></td><td>è®¾ç½®å·¥ä½œç›®å½•ï¼Œç›¸å½“äºæ‰§è¡Œ <code>cd</code>ï¼Œç”¨äºç®€åŒ–åç»­å‘½ä»¤ä¸­çš„è·¯å¾„ã€‚è‹¥ç›®å½•ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ„å»ºé˜¶æ®µæŒ‡ä»¤ï¼šFROM, ARG, ENV, COPY, ADD, RUN, WORKDIR, LABEL, USER, SHELL, ONBUILD</p></li><li class="lvl-2"><p>å¯åŠ¨é…ç½®æŒ‡ä»¤ï¼šCMD, ENTRYPOINT, HEALTHCHECK, EXPOSE, VOLUME, STOPSIGNAL</p></li></ul><h2 id="Dockerfile-æŒ‡ä»¤ä»‹ç»">Dockerfile æŒ‡ä»¤ä»‹ç»</h2><h3 id="FROM">FROM</h3><ul class="lvl-0"><li class="lvl-2"><p>FROM æŒ‡ä»¤ç”¨äºæŒ‡å®šåŸºç¡€é•œåƒï¼ˆbase imageï¼‰ï¼Œæ˜¯æ¯ä¸€ä¸ª Dockerfile ä¸­å¿…é¡»çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚æ‰€æœ‰åç»­æŒ‡ä»¤éƒ½æ˜¯åŸºäºè¿™ä¸ªåŸºç¡€é•œåƒæ„å»ºçš„ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM &lt;image&gt;[:&lt;tag&gt;] [AS &lt;stage-name&gt;]</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">#   &lt;image&gt;ï¼šé•œåƒåç§°ï¼ˆå¯ä»¥æ˜¯æœ¬åœ°å·²æœ‰çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä» Docker Hub æˆ–å…¶ä»–é•œåƒä»“åº“æ‹‰å–çš„ï¼‰</span></span><br><span class="line"><span class="comment">#   [:&lt;tag&gt;]ï¼šé•œåƒæ ‡ç­¾ï¼ˆå¯é€‰ï¼Œé»˜è®¤æ˜¯ latestï¼‰</span></span><br><span class="line"><span class="comment">#   [AS &lt;stage-name&gt;]ï¼šä¸ºè¯¥æ„å»ºé˜¶æ®µæŒ‡å®šåç§°ï¼Œç”¨äºå¤šé˜¶æ®µæ„å»º</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„é•œåƒï¼ˆé»˜è®¤æ ‡ç­¾æ˜¯ latestï¼‰</span></span><br><span class="line"><span class="keyword">FROM</span> node</span><br><span class="line"><span class="comment"># ä½¿ç”¨æŒ‡å®šçš„æ ‡ç­¾</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">16.13</span>.<span class="number">2</span>-alpine</span><br><span class="line"><span class="comment"># ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“</span></span><br><span class="line"><span class="keyword">FROM</span> private.registry.com/my-image:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å¤šé˜¶æ®µæ„å»º</span></span><br><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.20</span> AS builder</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> go build -o myapp</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> alpine:latest</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/myapp /usr/local/bin/myapp</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;myapp&quot;</span>]</span></span><br><span class="line"><span class="comment">## è¿™é‡Œç”¨äº†ä¸¤ä¸ªé˜¶æ®µï¼š</span></span><br><span class="line"><span class="comment">###   builder é˜¶æ®µç”¨æ¥ç¼–è¯‘åº”ç”¨ï¼›</span></span><br><span class="line"><span class="comment">###   alpine é˜¶æ®µç”¨æ¥æ‰“åŒ…æœ€ç»ˆé•œåƒï¼ŒåªåŒ…å«ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå‡å°‘ä½“ç§¯ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="WORKDIR">WORKDIR</h3><ul class="lvl-0"><li class="lvl-2"><p>WORKDIR æŒ‡å®šäº†å·¥ä½œç›®å½•ï¼Œå³åç»­æ‰€æœ‰æŒ‡ä»¤ï¼ˆå¦‚ RUNã€CMDã€ENTRYPOINTã€COPYã€ADD ç­‰ï¼‰æ‰€è¿è¡Œçš„å½“å‰è·¯å¾„ï¼ˆworking directoryï¼‰ã€‚</p></li><li class="lvl-2"><p>å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼ŒDocker ä¼šè‡ªåŠ¨åˆ›å»ºå®ƒã€‚</p></li><li class="lvl-2"><p>æ¯ä¸ª WORKDIR éƒ½ä¼šåˆ›å»ºä¸€å±‚é•œåƒï¼ˆlayerï¼‰ï¼Œæ‰€ä»¥ä¸è¦é‡å¤è®¾ç½®æ— æ„ä¹‰çš„è·¯å¾„ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR &lt;path&gt;</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">#   &lt;path&gt;ï¼šè¦åˆ‡æ¢çš„å·¥ä½œç›®å½•ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿ç»­è®¾ç½®å¤šä¸ªå·¥ä½œç›®å½•ï¼ˆé€å±‚åµŒå¥—ï¼‰</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /var</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> www</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> html</span></span><br><span class="line"><span class="comment"># ç­‰åŒäº:</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /var/www/html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é¿å…åœ¨ RUN cd some_dir åç»§ç»­æ‰§è¡Œä¾èµ–è·¯å¾„çš„å‘½ä»¤ï¼Œå› ä¸º Docker æ¯ä¸€æ¡æŒ‡ä»¤éƒ½æ˜¯æ–°çš„ shell å®ä¾‹ï¼Œcd ä¸ä¼šè·¨æŒ‡ä»¤ä¿ç•™ï¼Œåº”è¯¥æ”¹ç”¨ WORKDIRã€‚</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">cd</span> some_dir  <span class="comment"># é”™è¯¯</span></span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> some_dir <span class="comment"># æ­£ç¡®</span></span></span><br></pre></td></tr></table></figure><h3 id="ARG">ARG</h3><ul class="lvl-0"><li class="lvl-2"><p>ARG ç”¨äºåœ¨ æ„å»ºé•œåƒæ—¶ï¼ˆbuild-timeï¼‰ä¼ å…¥å‚æ•°ã€‚è¿™äº›å‚æ•°åªåœ¨ æ„å»ºé˜¶æ®µæœ‰æ•ˆï¼Œä¸ä¼šå‡ºç°åœ¨æœ€ç»ˆé•œåƒä¸­ï¼Œä¹Ÿä¸ä¼šåœ¨å®¹å™¨è¿è¡Œæ—¶è¢«ä¿ç•™ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ARG &lt;name&gt;[=&lt;default_value&gt;]</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">#   &lt;name&gt;ï¼šå‚æ•°åç§°</span></span><br><span class="line"><span class="comment">#   [=&lt;default_value&gt;]ï¼šå‚æ•°çš„é»˜è®¤å€¼ï¼Œå¦‚æœæœªä¼ å…¥å‚æ•°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼Œå¦‚æœä¸ºè®¾ç½®default_valueï¼Œåˆ™æ„å»ºé•œåƒæ—¶å¿…é¡»ä¼ é€’å‚æ•°ï¼Œ--build-arg</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªå‚æ•°ï¼Œåœ¨æ„å»ºé•œåƒæ—¶å¿…é¡»ä¼ å…¥å‚æ•°ï¼Œ--build-arg APP_ENV=development</span></span><br><span class="line"><span class="keyword">ARG</span> APP_ENV</span><br><span class="line"><span class="comment"># å¸¦é»˜è®¤å€¼çš„ ARG</span></span><br><span class="line"><span class="keyword">ARG</span> APP_ENV=development</span><br><span class="line"><span class="comment"># ä½¿ç”¨å‚æ•°</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;å½“å‰ç¯å¢ƒï¼š<span class="variable">$&#123;APP_ENV&#125;</span>&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ FROM ä¸€èµ·ç”¨ï¼ˆä» Docker 17.05 èµ·ï¼‰</span></span><br><span class="line"><span class="keyword">ARG</span> BASE=ubuntu</span><br><span class="line"><span class="keyword">FROM</span> $&#123;BASE&#125;:<span class="number">22.04</span></span><br></pre></td></tr></table></figure><h3 id="ENV">ENV</h3><ul class="lvl-0"><li class="lvl-2"><p>ENV æŒ‡ä»¤ç”¨äºåœ¨é•œåƒæ„å»ºè¿‡ç¨‹ä¸­å®šä¹‰ç¯å¢ƒå˜é‡ï¼ˆEnvironment Variablesï¼‰ã€‚è¿™äº›å˜é‡å¯ä»¥åœ¨ä¹‹åçš„æ„å»ºæ­¥éª¤ï¼ˆæ¯”å¦‚ RUNã€CMD ç­‰ï¼‰ä¸­ä½¿ç”¨ï¼Œä¹Ÿä¼šåœ¨å®¹å™¨è¿è¡Œæ—¶ç”Ÿæ•ˆã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸¤ç§è¯­æ³•</span></span><br><span class="line">ENV &lt;key&gt; &lt;value&gt;</span><br><span class="line">ENV &lt;key&gt;=&lt;value&gt; ...</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">#   &lt;key&gt;ï¼šç¯å¢ƒå˜é‡çš„åç§°</span></span><br><span class="line"><span class="comment">#   &lt;value&gt;ï¼šç¯å¢ƒå˜é‡çš„å€¼</span></span><br><span class="line"><span class="comment"># å¦‚æœå®šä¹‰å¤šä¸ªå˜é‡ï¼Œæ¨èä½¿ç”¨ key=value çš„å½¢å¼ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">ENV</span> APP_ENV=production</span><br><span class="line"><span class="comment"># å®šä¹‰å¤šä¸ªå˜é‡</span></span><br><span class="line"><span class="keyword">ENV</span> APP_PORT=<span class="number">8080</span> NODE_ENV=production</span><br><span class="line"><span class="comment"># ä½¿ç”¨å¤šè¡Œæ ¼å¼ï¼ˆæé«˜å¯è¯»æ€§ï¼‰</span></span><br><span class="line"><span class="keyword">ENV</span> PATH=<span class="string">&quot;/usr/local/bin:$&#123;PATH&#125;&quot;</span> \</span><br><span class="line">    LANG=<span class="string">&quot;en_US.UTF-8&quot;</span> \</span><br><span class="line">    TZ=<span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥åˆ†å¼€å®šä¹‰</span></span><br><span class="line"><span class="keyword">ENV</span> PATH=<span class="string">&quot;/usr/local/bin:$PATH&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> LANG=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> TZ=<span class="string">&quot;Asia/Shanghai&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ³¨æ„ï¼šENV æŒ‡ä»¤å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨æ„å»ºé˜¶æ®µå’Œè¿è¡Œé˜¶æ®µéƒ½ä¼šç”Ÿæ•ˆï¼Œä½†è¿è¡Œé˜¶æ®µä¼šè¦†ç›–æ„å»ºé˜¶æ®µå®šä¹‰çš„å˜é‡ã€‚</p></li></ul><h3 id="LABEL">LABEL</h3><ul class="lvl-0"><li class="lvl-2"><p>LABEL ç”¨äºä¸ºé•œåƒæ·»åŠ å…ƒæ•°æ®æ ‡ç­¾ï¼Œä»¥ <code>key=value</code> çš„å½¢å¼å­˜åœ¨ã€‚è¿™äº›æ ‡ç­¾å¯ä»¥æ˜¯ä½œè€…ä¿¡æ¯ã€ç‰ˆæœ¬æè¿°ã€ç”¨é€”è¯´æ˜ã€æ„å»ºæ—¶é—´ç­‰ã€‚</p></li><li class="lvl-2"><p>æ—§çš„ <code>MAINTAINER</code> æŒ‡ä»¤ç°åœ¨å·²è¢«åºŸå¼ƒï¼Œæ¨èä½¿ç”¨ <code>LABEL</code> æ¥ä»£æ›¿ã€‚</p></li><li class="lvl-2"><p>æ¯ä¸ª LABEL éƒ½ä¼šåˆ›å»ºä¸€å±‚é•œåƒï¼ˆlayerï¼‰ï¼Œæ¨èä¸€æ¬¡è®¾ç½®å¤šä¸ªã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LABEL &lt;key&gt;=&lt;value&gt; [&lt;key&gt;=&lt;value&gt;...]</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">#   &lt;key&gt;ï¼šæ ‡ç­¾çš„é”®</span></span><br><span class="line"><span class="comment">#   &lt;value&gt;ï¼šæ ‡ç­¾çš„å€¼</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer=<span class="string">&quot;yourname@example.com&quot;</span></span></span><br><span class="line"><span class="comment"># æ¢è¡Œæ ¼å¼ï¼ˆæ¨èï¼‰,ä»¥ä¸‹æ ‡ç­¾ç¬¦åˆ OCIï¼ˆOpen Container Initiativeï¼‰ é•œåƒè§„èŒƒ</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> \</span></span><br><span class="line"><span class="language-bash">    org.opencontainers.image.title=<span class="string">&quot;MyApp&quot;</span> \</span></span><br><span class="line"><span class="language-bash">    org.opencontainers.image.description=<span class="string">&quot;æ¼”ç¤ºé¡¹ç›®&quot;</span> \</span></span><br><span class="line"><span class="language-bash">    org.opencontainers.image.version=<span class="string">&quot;1.0.0&quot;</span> \</span></span><br><span class="line"><span class="language-bash">    org.opencontainers.image.authors=<span class="string">&quot;zhangsan@example.com&quot;</span></span></span><br></pre></td></tr></table></figure><h3 id="USER">USER</h3><ul class="lvl-0"><li class="lvl-2"><p>USER æŒ‡ä»¤ç”¨äºæŒ‡å®šåç»­æŒ‡ä»¤ï¼ˆå¦‚ RUNã€CMDã€ENTRYPOINTã€COPY ç­‰ï¼‰ä»¥å“ªä¸ªç”¨æˆ·èº«ä»½æ¥æ‰§è¡Œã€‚</p></li><li class="lvl-2"><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker å®¹å™¨ä¸­çš„å‘½ä»¤ä»¥ root ç”¨æˆ·è¿è¡Œï¼Œè¿™è™½ç„¶çµæ´»ä½†ä¸å®‰å…¨ã€‚ä½¿ç”¨ USER å¯ä»¥è®©æˆ‘ä»¬åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·ï¼Œä»è€Œæå‡å®¹å™¨çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æ½œåœ¨çš„æƒé™æ»¥ç”¨ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">USER &lt;user&gt;[:&lt;group&gt;]</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">#   &lt;user&gt;ï¼šç”¨æˆ·åæˆ– UID</span></span><br><span class="line"><span class="comment">#   [:&lt;group&gt;]ï¼šå¯é€‰ï¼Œç”¨æˆ·ç»„åæˆ– GID</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">USER</span> appuser</span><br><span class="line"><span class="comment"># è®¾ç½®ç”¨æˆ·ç»„</span></span><br><span class="line"><span class="keyword">USER</span> appuser:appgroup</span><br><span class="line"><span class="comment"># ä½¿ç”¨ UID å’Œ GID</span></span><br><span class="line"><span class="keyword">USER</span> <span class="number">1000</span>:<span class="number">1000</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœåŸºç¡€é•œåƒä¸­æ²¡æœ‰ä½ æƒ³è¦çš„ç”¨æˆ·ï¼Œéœ€è¦åœ¨ Dockerfile ä¸­æ‰‹åŠ¨åˆ›å»º</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç”¨æˆ·å’Œç»„</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> groupadd -r appgroup &amp;&amp; useradd -r -g appgroup appuser</span></span><br><span class="line"><span class="comment"># åˆ‡æ¢ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">USER</span> appuser</span><br></pre></td></tr></table></figure><h3 id="ADD">ADD</h3><ul class="lvl-0"><li class="lvl-2"><p>ADD ç”¨äºå°†æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½•ã€è¿œç¨‹æ–‡ä»¶ï¼ˆURLï¼‰ æˆ– å‹ç¼©åŒ… å¤åˆ¶åˆ°é•œåƒä¸­çš„æŒ‡å®šä½ç½®ã€‚</p></li><li class="lvl-2"><p>å®ƒçš„åŠŸèƒ½ç±»ä¼¼äº COPYï¼Œä½†æ¯” COPY å¤šå‡ ä¸ªåŠŸèƒ½ï¼ˆè§£å‹ã€æ‹‰å–è¿œç¨‹æ–‡ä»¶ç­‰ï¼‰ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ADD &lt;src&gt;... &lt;dest&gt;</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">#   &lt;src&gt;ï¼šè¦å¤åˆ¶çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶ã€è¿œç¨‹ URLã€å‹ç¼©åŒ…ç­‰</span></span><br><span class="line"><span class="comment">#   &lt;dest&gt;ï¼šç›®æ ‡è·¯å¾„</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»æœ¬åœ°æ–‡ä»¶å¤åˆ¶</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> app.jar /app.jar</span></span><br><span class="line"><span class="comment"># å¤åˆ¶å¤šä¸ª</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> app1.jar app2.jar /app/</span></span><br><span class="line"><span class="comment"># é€šé…ç¬¦</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> static-assets/*.html /app/public/</span></span><br><span class="line"><span class="comment"># ä»è¿œç¨‹ URL å¤åˆ¶</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> https://example.com/app.jar /app.jar</span></span><br><span class="line"><span class="comment"># ä»å‹ç¼©åŒ…ä¸­å¤åˆ¶</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> static-assets.tar.gz /app/public/</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æœ€ä½³å®è·µæ˜¯ä¼˜å…ˆä½¿ç”¨ COPYï¼Œåªæœ‰åœ¨éœ€è¦ ADD çš„é¢å¤–åŠŸèƒ½æ—¶æ‰ä½¿ç”¨å®ƒã€‚</p></li></ul><h3 id="COPY">COPY</h3><ul class="lvl-0"><li class="lvl-2"><p>COPY æŒ‡ä»¤ç”¨äºå°†ä¸»æœºä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚å®ƒæ˜¯æ„å»ºé•œåƒè¿‡ç¨‹ä¸­æœ€å¸¸ç”¨çš„æ•°æ®å¼•å…¥æ–¹å¼ä¹‹ä¸€ã€‚</p></li><li class="lvl-2"><p>ä¸ ADD ç±»ä¼¼ï¼Œä½†åŠŸèƒ½æ›´ç®€å•ã€æ˜ç¡®ã€å®‰å…¨</p></li><li class="lvl-2"><p>æ¨èä¼˜å…ˆä½¿ç”¨ COPYï¼Œé™¤éä½ ç¡®å®éœ€è¦ ADD æä¾›çš„è‡ªåŠ¨è§£å‹æˆ–è¿œç¨‹ä¸‹è½½åŠŸèƒ½ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">COPY &lt;src&gt;... &lt;dest&gt;</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">#   &lt;src&gt;ï¼šè¦å¤åˆ¶çš„æ–‡ä»¶æˆ–ç›®å½•</span></span><br><span class="line"><span class="comment">#   &lt;dest&gt;ï¼šç›®æ ‡è·¯å¾„</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤åˆ¶å•ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> app.jar /app.jar</span></span><br><span class="line"><span class="comment"># å¤åˆ¶å¤šä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> app1.jar app2.jar /app/</span></span><br><span class="line"><span class="comment"># å¤åˆ¶ç›®å½•</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> static-assets/ /app/public/</span></span><br><span class="line"><span class="comment"># é€šé…ç¬¦</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> static-assets/*.html /app/public/</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç›®æ ‡æ–‡ä»¶å±ä¸»å±ç»„</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --<span class="built_in">chown</span>=appuser:appgroup app.jar /app.jar</span></span><br></pre></td></tr></table></figure><h3 id="RUN">RUN</h3><ul class="lvl-0"><li class="lvl-2"><p>RUN æŒ‡ä»¤ç”¨äºåœ¨é•œåƒæ„å»ºé˜¶æ®µæ‰§è¡Œå‘½ä»¤ï¼Œç»“æœä¼šè¢«æ‰“åŒ…è¿›é•œåƒå±‚ä¸­ã€‚</p></li><li class="lvl-2"><p>å®ƒå¯ä»¥ç”¨äºå®‰è£…ä¾èµ–ã€ç¼–è¯‘ä»£ç ã€è¿è¡Œå‘½ä»¤ç­‰ã€‚</p></li><li class="lvl-2"><p>æ¯ä¸€æ¡ RUN æŒ‡ä»¤ä¼šåˆ›å»ºä¸€å±‚é•œåƒï¼ˆlayerï¼‰,åˆå¹¶å¤šä¸ªå‘½ä»¤æˆä¸€æ¡ RUNï¼Œå¯ä»¥å‡å°‘é•œåƒå±‚æ•°ï¼ˆä¾‹å¦‚ä½¿ç”¨ &amp;&amp; ä¸²è”ï¼‰ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€ç§æ ¼å¼ï¼šå®é™…è¿è¡Œçš„æ˜¯ï¼š/bin/sh -c &quot;&lt;å‘½ä»¤å­—ç¬¦ä¸²&gt;&quot;</span></span><br><span class="line">RUN &lt;å‘½ä»¤å­—ç¬¦ä¸²&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒç§æ ¼å¼</span></span><br><span class="line">RUN [<span class="string">&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;</span>, <span class="string">&quot;å‚æ•°1&quot;</span>, <span class="string">&quot;å‚æ•°2&quot;</span>, ...]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y curl</span></span><br><span class="line"><span class="comment"># æ„å»ºå¤šä¸ªå‘½ä»¤(ç”¨ &amp;&amp; ä¸²è”)</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    apt-get install -y python3 &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯æ‰§è¡Œæ–‡ä»¶å‚æ•°</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;curl https://example.com/app.jar &gt; app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure><h3 id="CMD">CMD</h3><ul class="lvl-0"><li class="lvl-2"><p>CMD ç”¨äºæŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤åŠå…¶å‚æ•°ã€‚</p></li><li class="lvl-2"><p>å¦‚æœç”¨æˆ·åœ¨è¿è¡Œå®¹å™¨æ—¶æ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šå…¶ä»–å‘½ä»¤ï¼ŒDocker å°±ä¼šä½¿ç”¨ CMD æä¾›çš„å†…å®¹ã€‚</p></li><li class="lvl-2"><p>å®ƒå¯ä»¥å®šä¹‰å¤šä¸ªï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªä¼šè¢«ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Shell å½¢å¼ï¼ˆå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">CMD <span class="built_in">command</span> param1 param2</span><br><span class="line"><span class="comment"># ç­‰ä»·äº /bin/sh -c &quot;command param1 param2&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Exec å½¢å¼ï¼ˆæ•°ç»„ï¼‰</span></span><br><span class="line">CMD [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>, ...]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç®€å• shell å‘½ä»¤</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Hello from container&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Exec å½¢å¼</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;start&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½œä¸º ENTRYPOINT çš„å‚æ•°</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;python3&quot;</span>, <span class="string">&quot;app.py&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;--host=0.0.0.0&quot;</span>, <span class="string">&quot;--port=8080&quot;</span>]</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç”¨æˆ·å¯ä»¥è¦†ç›– CMDï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run &lt;myapp&gt; npm run <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h3 id="ENTRYPOINT">ENTRYPOINT</h3><ul class="lvl-0"><li class="lvl-2"><p>ENTRYPOINT å®šä¹‰å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„ä¸»å‘½ä»¤ï¼Œç›¸æ¯” CMDï¼Œå®ƒä¸å®¹æ˜“è¢«è¦†ç›–ï¼Œæ›´é€‚åˆåˆ¶ä½œâ€œä¸“ç”¨å‹â€å®¹å™¨ï¼ˆå¦‚ nginxã€python è„šæœ¬ç­‰ï¼‰ã€‚</p></li><li class="lvl-2"><p>ä½ å¯ä»¥æŠŠ ENTRYPOINT ç†è§£ä¸ºå®¹å™¨çš„â€œä¸»ç¨‹åºâ€ï¼Œè€Œ CMD æ˜¯ä¸ºå®ƒæä¾›çš„é»˜è®¤â€œå‘½ä»¤è¡Œå‚æ•°â€ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Shell å½¢å¼ï¼ˆå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">ENTRYPOINT <span class="built_in">command</span> param1 param2</span><br><span class="line"><span class="comment">#  ç­‰ä»·äº /bin/sh -c &quot;command param1 param2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Exec å½¢å¼ï¼ˆæ•°ç»„ï¼‰</span></span><br><span class="line">ENTRYPOINT [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>, ...]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç®€å• shell å‘½ä»¤</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Hello from container&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Exec å½¢å¼</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;start&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“åˆ CMD ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;python3&quot;</span>, <span class="string">&quot;app.py&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;--host=0.0.0.0&quot;</span>, <span class="string">&quot;--port=8080&quot;</span>]</span></span><br></pre></td></tr></table></figure><h3 id="EXPOSE">EXPOSE</h3><ul class="lvl-0"><li class="lvl-2"><p>EXPOSE ç”¨äºå£°æ˜å®¹å™¨å°†ä¼šç›‘å¬çš„ç«¯å£ï¼Œè®©ä½¿ç”¨è¯¥é•œåƒçš„äººçŸ¥é“åº”è¯¥å¯¹å¤–å¼€æ”¾å“ªäº›ç«¯å£ã€‚</p></li><li class="lvl-2"><p>âš ï¸ æ³¨æ„ï¼šEXPOSE å¹¶ä¸ä¼šçœŸçš„å¼€æ”¾ç«¯å£ï¼Œåªæ˜¯â€œå£°æ˜â€è¿™ä¸ªå®¹å™¨ç›‘å¬äº†è¿™äº›ç«¯å£ã€‚</p></li><li class="lvl-2"><p>è¦è®©ç«¯å£çœŸæ­£æš´éœ²å‡ºæ¥ï¼Œè¿˜éœ€è¦åœ¨è¿è¡Œå®¹å™¨æ—¶åŠ ä¸Š <code>-p</code> æˆ– <code>--publish</code> å‚æ•°ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE &lt;port&gt; [&lt;port&gt;/&lt;protocol&gt;...]</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">#   &lt;port&gt;ï¼šç«¯å£å·ï¼Œå¯ä»¥æ˜¯å•ä¸ªç«¯å£å·ï¼Œä¹Ÿå¯ä»¥æ˜¯èŒƒå›´ï¼ˆå¦‚ 8080-8085ï¼‰</span></span><br><span class="line"><span class="comment">#   &lt;protocol&gt;ï¼šåè®®ï¼Œå¯ä»¥æ˜¯ tcp æˆ– udpï¼Œé»˜è®¤ä¸º tcp</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span>/udp</span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span>-<span class="number">8085</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span> <span class="number">8081</span> <span class="number">8082</span> <span class="number">8083</span> <span class="number">8084</span> <span class="number">8085</span></span><br></pre></td></tr></table></figure><h3 id="VOLUME">VOLUME</h3><ul class="lvl-0"><li class="lvl-2"><p>VOLUME æŒ‡ä»¤ç”¨äºå£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä¸­çš„æŒ‚è½½ç‚¹ï¼ˆmount pointï¼‰ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®æˆ–ä¸å®¿ä¸»æœº/å…¶ä»–å®¹å™¨å…±äº«æ•°æ®ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">VOLUME [<span class="string">&quot;/path/in/container&quot;</span>, ...]</span><br><span class="line"><span class="comment"># è·¯å¾„å¿…é¡»æ˜¯å®¹å™¨å†…éƒ¨çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="comment"># å¯ä»¥ä¸€æ¬¡å£°æ˜ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å£°æ˜ä¸€ä¸ªæŒ‚è½½ç‚¹</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> /app/public</span></span><br><span class="line"><span class="comment"># å£°æ˜å¤šä¸ªæŒ‚è½½ç‚¹</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;/app/public&quot;</span>, <span class="string">&quot;/app/logs&quot;</span>]</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å½“å®¹å™¨è¿è¡Œæ—¶ï¼Œå¯ä»¥å°†é•œåƒä¸­å£°æ˜çš„æŒ‚è½½ç‚¹æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šï¼Œä»è€Œå®ç°æŒä¹…åŒ–æ•°æ®ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v /host/path:/app/public myimage</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨ç»‘å®šæŒ‚è½½ï¼ŒDocker ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåŒ¿åå·ï¼Œå·çš„å†…å®¹é»˜è®¤ä¿å­˜åœ¨å®¿ä¸»æœºçš„ <code>/var/lib/docker/volumes</code> ä¸‹ã€‚</p></li></ul><h3 id="HEALTHCHECK">HEALTHCHECK</h3><ul class="lvl-0"><li class="lvl-2"><p>HEALTHCHECK ç”¨æ¥å®šä¹‰å®¹å™¨è¿è¡Œæ—¶çš„å¥åº·æ£€æŸ¥å‘½ä»¤ï¼Œå®šæœŸæ£€æµ‹å®¹å™¨å†…æœåŠ¡çš„çŠ¶æ€ï¼Œå¸®åŠ©ç¼–æ’å·¥å…·ï¼ˆDocker Swarmã€Kubernetes ç­‰ï¼‰åˆ¤æ–­å®¹å™¨æ˜¯å¦å¥åº·ã€‚</p></li><li class="lvl-2"><p>å¦‚æœå¥åº·æ£€æŸ¥å¤±è´¥ï¼ŒDocker ä¼šå°†å®¹å™¨æ ‡è®°ä¸º unhealthyï¼Œä¾¿äºè‡ªåŠ¨é‡å¯æˆ–æ›¿æ¢ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HEALTHCHECK &lt;options&gt; CMD &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># &lt;options&gt;ï¼šå¯é€‰é¡¹ï¼Œç”¨äºè®¾ç½®å¥åº·æ£€æŸ¥çš„é€‰é¡¹ï¼Œå¦‚è¶…æ—¶æ—¶é—´ã€é‡è¯•æ¬¡æ•°ç­‰ã€‚</span></span><br><span class="line"><span class="comment"># &lt;command&gt;ï¼šå¥åº·æ£€æŸ¥å‘½ä»¤ï¼Œå¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„ shell å‘½ä»¤ã€‚</span></span><br><span class="line">            <span class="comment"># å¿…é¡»è¿”å›é€€å‡ºç :</span></span><br><span class="line">              <span class="comment"># 0 è¡¨ç¤ºå¥åº·</span></span><br><span class="line">              <span class="comment"># 1 è¡¨ç¤ºä¸å¥åº·</span></span><br><span class="line">              <span class="comment"># 2 è¡¨ç¤ºæœªçŸ¥</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯é€‰å‚æ•°ï¼ˆOPTIONSï¼‰</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>--interval=DURATION</code></td><td>ä¸¤æ¬¡å¥åº·æ£€æŸ¥ä¹‹é—´çš„æ—¶é—´é—´éš”</td><td>30s</td></tr><tr><td><code>--timeout=DURATION</code></td><td>å•æ¬¡æ£€æµ‹å‘½ä»¤çš„è¶…æ—¶æ—¶é—´</td><td>30s</td></tr><tr><td><code>--start-period=DURATION</code></td><td>å®¹å™¨å¯åŠ¨åï¼Œå¼€å§‹å¥åº·æ£€æŸ¥å‰çš„ç­‰å¾…æ—¶é—´</td><td>0s</td></tr><tr><td><code>--retries=N</code></td><td>è¿ç»­å¤±è´¥å‡ æ¬¡ååˆ¤å®šå®¹å™¨ä¸å¥åº·</td><td>3</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ curl æ£€æµ‹ Web æœåŠ¡æ˜¯å¦å“åº”</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> --interval=5s --<span class="built_in">timeout</span>=3s --retries=3 CMD curl -f http://localhost:8080/health || <span class="built_in">exit</span> 1</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œå®¹å™¨åï¼Œå¯ä»¥ç”¨å‘½ä»¤æŸ¥çœ‹å¥åº·çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœé•œåƒä¸­æœ‰å¥åº·æ£€æŸ¥ï¼Œå¯ä»¥æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼ˆSTATUSï¼‰</span></span><br><span class="line">docker ps</span><br><span class="line">  <span class="comment"># STATUS åˆ—ä¼šæ˜¾ç¤ºï¼š</span></span><br><span class="line">  <span class="comment">#   healthy</span></span><br><span class="line">  <span class="comment">#   unhealthy</span></span><br><span class="line">  <span class="comment">#   startingï¼ˆå¯åŠ¨ä¸­ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;json .State.Health&#125;&#125;&#x27;</span> &lt;container-id&gt;</span><br></pre></td></tr></table></figure><h3 id="SHELL">SHELL</h3><ul class="lvl-0"><li class="lvl-2"><p>SHELL æŒ‡ä»¤ç”¨æ¥è‡ªå®šä¹‰åç»­ RUNã€CMD å’Œ ENTRYPOINT æŒ‡ä»¤æ‰€ä½¿ç”¨çš„é»˜è®¤ shell ç¨‹åºå’Œå‚æ•°ã€‚</p></li><li class="lvl-2"><p>é»˜è®¤æƒ…å†µä¸‹ï¼š</p><ul class="lvl-2"><li class="lvl-4">åœ¨ Linux é•œåƒä¸­ï¼ŒDocker ä½¿ç”¨ /bin/sh -c</li><li class="lvl-4">åœ¨ Windows é•œåƒä¸­ï¼Œä½¿ç”¨ cmd /S /C</li></ul></li><li class="lvl-2"><p>ä½¿ç”¨ SHELLï¼Œä½ å¯ä»¥æ›¿æ¢ä¸ºå…¶ä»– shellï¼Œå¦‚ Bashã€PowerShellã€zsh ç­‰ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHELL [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>, ...]</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ° bash</span></span><br><span class="line"><span class="keyword">SHELL</span><span class="language-bash"> [<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šæ¬¡åˆ‡æ¢</span></span><br><span class="line"><span class="keyword">SHELL</span><span class="language-bash"> [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Hello from Bash&quot;</span> <span class="comment"># åœ¨ Bash ä¸­æ‰§è¡Œ</span></span></span><br><span class="line"><span class="keyword">SHELL</span><span class="language-bash"> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Now back to sh&quot;</span> <span class="comment">#  åœ¨ sh ä¸­æ‰§è¡Œ</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line"><span class="keyword">SHELL</span><span class="language-bash"> [<span class="string">&quot;powershell&quot;</span>, <span class="string">&quot;-Command&quot;</span>]</span></span><br></pre></td></tr></table></figure><h3 id="STOPSIGNAL">STOPSIGNAL</h3><ul class="lvl-0"><li class="lvl-2"><p>STOPSIGNAL æŒ‡å®šå½“å®¹å™¨æ”¶åˆ° <code>docker stop</code> å‘½ä»¤æ—¶ï¼Œå‘é€ç»™å®¹å™¨ä¸»è¿›ç¨‹çš„ä¿¡å·ç±»å‹ã€‚</p></li><li class="lvl-2"><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker ä¼šå‘å®¹å™¨çš„ä¸»è¿›ç¨‹å‘é€ <code>SIGTERM</code> ä¿¡å·ï¼Œè®©å®ƒæœ‰æœºä¼šä¼˜é›…åœ°é€€å‡ºï¼ˆåœ¨è¶…æ—¶æ—¶æœªé€€å‡ºåˆ™å‘ <code>SIGKILL</code> å¼ºåˆ¶ç»ˆæ­¢ï¼‰ã€‚</p></li><li class="lvl-2"><p>é»˜è®¤æƒ…å†µï¼Œå¤§å¤šæ•°ç¨‹åºï¼ˆå¦‚ nginxï¼‰ï¼Œä¸éœ€è¦è®¾ç½®ï¼ˆé»˜è®¤ SIGTERMï¼‰</p></li><li class="lvl-2"><p>ä½†æœ‰äº›ç¨‹åºå¯èƒ½éœ€è¦ä½¿ç”¨ä¸åŒçš„ä¿¡å·ï¼Œæ¯”å¦‚ SIGINTã€SIGHUPï¼Œè¿™æ—¶ä½ å¯ä»¥é€šè¿‡ STOPSIGNAL æ¥ä¿®æ”¹ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">STOPSIGNAL &lt;signal&gt;</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># å…¶ä¸­ &lt;signal&gt; å¯ä»¥æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">#   ä¿¡å·åç§°ï¼Œä¾‹å¦‚ï¼šSIGTERMã€SIGKILLã€SIGINTã€SIGHUP</span></span><br><span class="line"><span class="comment">#   æˆ–ä¿¡å·ç¼–å·ï¼Œä¾‹å¦‚ï¼š15ï¼ˆç­‰ä»·äº SIGTERMï¼‰</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼Œä¸å†™ä¹Ÿä¸€æ ·ã€‚</span></span><br><span class="line"><span class="keyword">STOPSIGNAL</span> SIGTERM</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ä¸º SIGINT</span></span><br><span class="line"><span class="keyword">STOPSIGNAL</span> SIGINT</span><br></pre></td></tr></table></figure><h3 id="ONBUILD">ONBUILD</h3><ul class="lvl-0"><li class="lvl-2"><p>ONBUILD ç”¨äºå®šä¹‰å»¶è¿Ÿæ‰§è¡Œçš„æ„å»ºæŒ‡ä»¤ï¼Œå³è¿™äº›å‘½ä»¤ä¸ä¼šåœ¨å½“å‰ Dockerfile æ„å»ºæ—¶æ‰§è¡Œï¼Œè€Œæ˜¯åœ¨ ä»¥å½“å‰é•œåƒä¸ºåŸºç¡€çš„å­é•œåƒä¸­æ„å»ºæ—¶è§¦å‘æ‰§è¡Œã€‚</p></li><li class="lvl-2"><p>å®ƒçš„å…¸å‹ç”¨é€”æ˜¯ï¼šæ„å»ºä¸€ä¸ªâ€œé€šç”¨åŸºç¡€é•œåƒâ€ï¼Œè®©ä½¿ç”¨è€…åœ¨è‡ªå·±çš„ Dockerfile ä¸­ FROM å®ƒæ—¶è‡ªåŠ¨ç»§æ‰¿ä¸€äº›æ“ä½œï¼ˆæ¯”å¦‚ COPYã€RUN ç­‰ï¼‰ã€‚</p></li><li class="lvl-2"><p>ONBUILD æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ–¹ä¾¿åŸºç¡€é•œåƒä½œè€…é¢„å…ˆå®šä¹‰â€œæœªæ¥å­é•œåƒæ„å»ºæ—¶ä¸€å®šè¦æ‰§è¡Œçš„æ­¥éª¤â€ï¼Œè€Œä¸æ˜¯åœ¨åŸºç¡€é•œåƒä¸­â€œç¡¬ç¼–ç â€é‚£äº›æ­¥éª¤ã€‚</p></li><li class="lvl-2"><p>è¯­æ³•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ONBUILD &lt;INSTRUCTION&gt;</span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># &lt;INSTRUCTION&gt;ï¼šå¿…é¡»æ˜¯ä¸€ä¸ªåˆæ³•çš„ Dockerfile æŒ‡ä»¤ï¼Œå¦‚ RUNã€COPYã€ADDã€CMD ç­‰ï¼ˆä½†ä¸èƒ½æ˜¯ FROM, ONBUILD, HEALTHCHECK ç­‰ï¼‰ã€‚</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€é•œåƒä¸­ä½¿ç”¨ ONBUILD</span></span><br><span class="line"><span class="comment"># æ–‡ä»¶ï¼šDockerfile.base</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">COPY</span><span class="language-bash"> . /app</span></span><br><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">RUN</span><span class="language-bash"> npm install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºåŸºç¡€é•œåƒ</span></span><br><span class="line">docker build -t my-node-base -f Dockerfile.base .</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨åŸºç¡€é•œåƒæ„å»ºå­é•œåƒ</span></span><br><span class="line"><span class="comment"># æ–‡ä»¶ï¼šDockerfileï¼ˆå­é•œåƒï¼‰</span></span><br><span class="line"><span class="keyword">FROM</span> my-node-base</span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;node&quot;</span>, <span class="string">&quot;index.js&quot;</span>]</span></span><br><span class="line"><span class="comment"># æ„å»ºå­é•œåƒæ—¶ï¼Œç­‰äºè‡ªåŠ¨æ’å…¥äº†ï¼š</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ONBUILD æ˜¯ä¸€ç§â€œæ„å»ºé’©å­â€æœºåˆ¶</p><ul class="lvl-2"><li class="lvl-4">ONBUILD å¯ä»¥ç†è§£æˆâ€œé’©å­â€æˆ–â€œè§¦å‘å™¨â€ï¼š<ul class="lvl-4"><li class="lvl-6">åœ¨åŸºç¡€é•œåƒæ„å»ºæ—¶ä¸æ‰§è¡Œ</li><li class="lvl-6">ä½†å½“æŸäººä»¥è¿™ä¸ªåŸºç¡€é•œåƒä¸ºèµ·ç‚¹å†™è‡ªå·±çš„ Dockerfileï¼Œå¹¶æ„å»ºæ—¶ï¼Œè¿™äº› ONBUILD é‡Œçš„æŒ‡ä»¤è‡ªåŠ¨æ’å…¥æ‰§è¡Œ</li></ul></li><li class="lvl-4">è¿™æ ·ï¼š<ul class="lvl-4"><li class="lvl-6">åŸºç¡€é•œåƒåªè´Ÿè´£å®šä¹‰ç¯å¢ƒï¼ˆnodeã€npmç‰ˆæœ¬ã€ç³»ç»Ÿä¾èµ–ç­‰ï¼‰ï¼Œä¿æŒè½»é‡</li><li class="lvl-6">ä¸‹æ¸¸é¡¹ç›®å¯ä»¥ä¸ç”¨å†™é‡å¤çš„ä»£ç å¤åˆ¶å’Œå®‰è£…æŒ‡ä»¤ï¼Œè‡ªåŠ¨ç»§æ‰¿åŸºç¡€é•œåƒé¢„å®šä¹‰çš„æ„å»ºæ­¥éª¤</li><li class="lvl-6">ä»£ç å¤åˆ¶å’Œä¾èµ–å®‰è£…åœ¨ä¸‹æ¸¸é•œåƒæ„å»ºæ—¶æ‰§è¡Œï¼Œä½¿ç”¨è‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼ˆä¹Ÿå°±æ˜¯é¡¹ç›®ä»£ç ï¼‰</li></ul></li></ul></li><li class="lvl-2"><p><code>ONBUILD</code> æ€»ç»“</p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>â± å»¶è¿Ÿæ‰§è¡Œ</td><td>æ„å»ºåŸºç¡€é•œåƒæ—¶ä¸ä¼šæ‰§è¡Œï¼Œåœ¨å­é•œåƒæ„å»ºæ—¶è§¦å‘</td></tr><tr><td>âœ… æ”¯æŒæŒ‡ä»¤</td><td>ä¾‹å¦‚ <code>RUN</code>, <code>COPY</code>, <code>ADD</code>, <code>CMD</code>, <code>WORKDIR</code>, <code>ENV</code> ç­‰</td></tr><tr><td>âŒ ä¸æ”¯æŒ</td><td><code>FROM</code>, <code>ONBUILD</code>, <code>HEALTHCHECK</code>, <code>SHELL</code>, <code>STOPSIGNAL</code></td></tr><tr><td>ğŸ‘ ä¸æ¨èæ»¥ç”¨</td><td>ä¼šéšè—æ„å»ºè¡Œä¸ºï¼Œé™ä½å¯ç»´æŠ¤æ€§</td></tr><tr><td>âœ… æ¨èåœºæ™¯</td><td>å›¢é˜Ÿå…±äº«æ¨¡æ¿ã€æ„å»ºâ€œæ ‡å‡†å¼€å‘é•œåƒâ€</td></tr></tbody></table><h2 id="Dockerfile-å“ªäº›-æŒ‡ä»¤-ä¼šåˆ›å»ºæ–°çš„å±‚">Dockerfile å“ªäº› æŒ‡ä»¤ ä¼šåˆ›å»ºæ–°çš„å±‚</h2><ul class="lvl-0"><li class="lvl-2"><p>å½“ Dockerfile ä¸­åˆ›å»ºæ–°å±‚çš„æŒ‡ä»¤å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½¿ç”¨ <code>--no-cache</code> é€‰é¡¹å¯ä»¥ç¡®ä¿è¿™äº›å˜æ›´è¢«æ­£ç¡®åº”ç”¨ã€‚</p></li></ul><table><thead><tr><th>æŒ‡ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>ADD</td><td>ä» <src> å¤åˆ¶æ–‡ä»¶å¹¶è‡ªåŠ¨è§£å‹ï¼ˆå¦‚æœæ˜¯ä¸€ä¸ª tar æ–‡ä»¶ï¼‰åˆ°å®¹å™¨çš„ <dest> è·¯å¾„ã€‚</td></tr><tr><td>COPY</td><td>ä» <src> å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨çš„ <dest> è·¯å¾„ï¼Œä¸ä¼šè‡ªåŠ¨è§£å‹ã€‚</td></tr><tr><td>RUN</td><td>æ‰§è¡Œä»»æ„å‘½ä»¤å¹¶åœ¨å®¹å™¨ä¸­åšå‡ºæ›´æ”¹ã€‚æ¯æ¡ RUN æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚</td></tr><tr><td>ENV</td><td>è®¾ç½®ç¯å¢ƒå˜é‡ã€‚æ¯ä¸€è¡Œ ENV æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚</td></tr><tr><td>WORKDIR</td><td>è®¾ç½®å·¥ä½œç›®å½•ã€‚æ¯ä¸€è¡Œ WORKDIR æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚</td></tr><tr><td>VOLUME</td><td>åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹ã€‚æ¯ä¸€è¡Œ VOLUME æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚</td></tr><tr><td>LABEL</td><td>æ·»åŠ å…ƒæ•°æ®æ ‡ç­¾ã€‚æ¯ä¸€è¡Œ LABEL æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ã€‚</td></tr></tbody></table><h2 id="Dockerfile-ç¤ºä¾‹-Spring-Boot-åº”ç”¨">Dockerfile ç¤ºä¾‹: Spring Boot åº”ç”¨</h2><ul class="lvl-0"><li class="lvl-2"><p>ç›®å½•ç»“æ„</p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">springbootweb/</span><br><span class="line">â”œâ”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ target/</span><br><span class="line">â”‚   â””â”€â”€ app.jar</span><br><span class="line">â”œâ”€â”€ <span class="type">static</span>-assets.tar.gz</span><br><span class="line">â””â”€â”€ ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Dockerfile: æ³¨æ„ Dockerfile ä¸­æ‰€æœ‰å…³é”®å­—éƒ½è¦æ±‚å¤§å†™</p></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨è½»é‡çº§ Alpine ç‰ˆæœ¬çš„ OpenJDK 17 å®˜æ–¹é•œåƒï¼Œé€‚åˆéƒ¨ç½² Spring Boot åº”ç”¨</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">17</span>-alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ„å»ºæ—¶å˜é‡ï¼Œé»˜è®¤ä½¿ç”¨æ„å»ºå¥½çš„ jar æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">ARG</span> JAR_FILE=target/app.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è¿è¡Œæ—¶ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_OPTS=<span class="string">&quot;-Xms1024M -Xmx1024M -XX:MetaspaceSize=128M -XX:MaxMetaspaceSize=128M&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># é•œåƒå…ƒä¿¡æ¯</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer=<span class="string">&quot;yourname@example.com&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> version=<span class="string">&quot;1.0.0&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> description=<span class="string">&quot;ç”¨äºéƒ¨ç½² Spring Boot åº”ç”¨çš„ç”Ÿäº§çº§é•œåƒ&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ RUNï¼šå®‰è£… curlï¼ˆç”¨äºå®¹å™¨å¥åº·æ£€æŸ¥æˆ–è°ƒè¯•ï¼‰</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk add --no-cache curl</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶ Spring Boot æ„å»ºç”Ÿæˆçš„ jar åŒ…</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> <span class="variable">$&#123;JAR_FILE&#125;</span> app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹é™æ€èµ„æºåˆ°å®¹å™¨ä¸­ï¼ˆADD å¯ä»¥è‡ªåŠ¨è§£å‹ tar.gzï¼‰</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> static-assets.tar.gz /app/public/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å£°æ˜æš´éœ²çš„åº”ç”¨ç«¯å£ï¼ˆSpring Boot é»˜è®¤æ˜¯ 8080ï¼‰</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¹å™¨å¥åº·æ£€æŸ¥ï¼šè®¿é—® actuator å¥åº·ç«¯ç‚¹</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> --interval=30s --<span class="built_in">timeout</span>=5s --retries=3 \</span></span><br><span class="line"><span class="language-bash">  CMD curl -f http://localhost:8080/app/actuator/health || <span class="built_in">exit</span> 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¹å™¨ç»ˆæ­¢æ—¶ä¼˜é›…å…³é—­ï¼ˆJava æ¨è SIGTERMï¼‰</span></span><br><span class="line"><span class="keyword">STOPSIGNAL</span> SIGTERM</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶çš„ä¸»å‘½ä»¤ï¼ˆENTRYPOINT ä¸ä¼šè¢« docker run å‚æ•°è¦†ç›–ï¼‰</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;java <span class="variable">$JAVA_OPTS</span> -jar app.jar&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CMD æä¾›é»˜è®¤çš„è¿è¡Œå‚æ•°ï¼Œå¯ä»¥è¢« docker run è¦†ç›–</span></span><br><span class="line"><span class="comment"># è¿™é‡Œé€šè¿‡ Spring Boot å‚æ•°è®¾ç½®å¯åŠ¨ç¯å¢ƒå’Œç«¯å£å·</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;--spring.profiles.active=app&quot;</span>, <span class="string">&quot;--server.port=8080&quot;</span>]</span></span><br><span class="line"><span class="comment"># è¿™é‡Œä½¿ç”¨çš„æ˜¯ ENTRYPOINT + CMD çš„æ··åˆæ¨¡å¼</span></span><br><span class="line"><span class="comment"># å®Œæ•´å‘½ä»¤ï¼š java $JAVA_OPTS -jar app.jar --spring.profiles.active=app --server.port=8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å£°æ˜ä¸€ä¸ªå·æŒ‚è½½ç‚¹ï¼Œè¿è¡Œå®¹å™¨æ—¶å¯å°†è¯¥è·¯å¾„æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œå®ç°æ•°æ®æŒä¹…åŒ–</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;/app/logs&quot;</span>]</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ„å»ºé•œåƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºé•œåƒæ—¶ç”¨ --build-arg æŒ‡å®šæ„å»ºå‚æ•°ï¼Œå¦‚æœéœ€è¦å¤šä¸ªï¼Œå°±é…ç½®å¤šä¸ª --build-arg</span></span><br><span class="line">docker build --build-arg JAR_FILE=target/app.jar -t springbootweb:latest .</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œå®¹å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name springbootweb \</span><br><span class="line">  -p 8080:8080 \</span><br><span class="line">  -e JAVA_OPTS=<span class="string">&quot;-Xms512m -Xmx1024m&quot;</span> \</span><br><span class="line">  -v /home/centos/logs/app/:/app/logs \</span><br><span class="line">  springbootweb:latest</span><br></pre></td></tr></table></figure><h2 id="Dockerfile-ç¤ºä¾‹-å¤šé˜¶æ®µæ„å»º">Dockerfile ç¤ºä¾‹: å¤šé˜¶æ®µæ„å»º</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€é˜¶æ®µï¼šè·å–ä»£ç </span></span><br><span class="line"><span class="keyword">FROM</span> alpine/git AS fetcher</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /workspace/application</span></span><br><span class="line"><span class="comment"># å°†æ›¿æ¢ä¸ºå®é™…çš„Gitä»“åº“URLå’Œåˆ†æ”¯/æ ‡ç­¾</span></span><br><span class="line"><span class="keyword">ARG</span> GIT_REPOSITORY=https://gitee.com/hanqunfeng/springbootweb.git</span><br><span class="line"><span class="keyword">ARG</span> GIT_BRANCH=master</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> git <span class="built_in">clone</span> -b <span class="variable">$&#123;GIT_BRANCH&#125;</span> <span class="variable">$&#123;GIT_REPOSITORY&#125;</span> .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒé˜¶æ®µï¼šä½¿ç”¨Mavenç¯å¢ƒè¿›è¡Œæ„å»º</span></span><br><span class="line"><span class="keyword">FROM</span> maven:<span class="number">3.8</span>.<span class="number">4</span>-openjdk-<span class="number">17</span> AS builder</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /workspace/application</span></span><br><span class="line"><span class="comment"># ä»ç¬¬ä¸€é˜¶æ®µå¤åˆ¶ä»£ç </span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=fetcher /workspace/application .</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨Mavenæ¸…ç†å¹¶æ‰“åŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> mvn clean package -DskipTests</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸‰é˜¶æ®µï¼šåˆ›å»ºæœ€ç»ˆçš„è¿è¡Œç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">17</span>-alpine</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="comment"># è®¾ç½®è¿è¡Œæ—¶ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_OPTS=<span class="string">&quot;-Xms1024M -Xmx1024M -XX:MetaspaceSize=128M -XX:MaxMetaspaceSize=128M&quot;</span></span><br><span class="line"><span class="comment"># å°†ç¬¬äºŒé˜¶æ®µç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å¤åˆ¶åˆ°è¿™é‡Œã€‚æ³¨æ„è¿™é‡Œå‡è®¾ä½ çš„spring bootå·¥ç¨‹æ‰“æˆçš„jaråæ˜¯target/app.jar</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /workspace/application/target/app.jar app.jar</span></span><br><span class="line"><span class="comment"># æš´éœ²ç«¯å£ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰ã€‚è¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ç«¯å£å·</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="comment"># å£°æ˜ä¸€ä¸ªå·æŒ‚è½½ç‚¹ï¼Œè¿è¡Œå®¹å™¨æ—¶å¯å°†è¯¥è·¯å¾„æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œå®ç°æ•°æ®æŒä¹…åŒ–</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;/app/logs&quot;</span>]</span></span><br><span class="line"><span class="comment"># è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶çš„ä¸»å‘½ä»¤ï¼ˆENTRYPOINT ä¸ä¼šè¢« docker run å‚æ•°è¦†ç›–ï¼‰</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;java <span class="variable">$JAVA_OPTS</span> -jar app.jar&quot;</span>]</span></span><br><span class="line"><span class="comment"># CMD æä¾›é»˜è®¤çš„è¿è¡Œå‚æ•°ï¼Œå¯ä»¥è¢« docker run è¦†ç›–</span></span><br><span class="line"><span class="comment"># è¿™é‡Œé€šè¿‡ Spring Boot å‚æ•°è®¾ç½®å¯åŠ¨ç¯å¢ƒå’Œç«¯å£å·</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;--spring.profiles.active=app&quot;</span>, <span class="string">&quot;--server.port=8080&quot;</span>]</span></span><br><span class="line"><span class="comment"># è¿™é‡Œä½¿ç”¨çš„æ˜¯ ENTRYPOINT + CMD çš„æ··åˆæ¨¡å¼</span></span><br><span class="line"><span class="comment"># å®Œæ•´å‘½ä»¤ï¼š java $JAVA_OPTS -jar app.jar --spring.profiles.active=app --server.port=8080</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ„å»ºé•œåƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºé•œåƒï¼Œ--no-cache è¡¨ç¤ºä¸ä½¿ç”¨ç¼“å­˜ï¼Œæ¯æ¬¡æ„å»ºéƒ½ä¼šé‡æ–°æ„å»º</span></span><br><span class="line">docker build --no-cache -t app:latest .</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œå®¹å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name app \</span><br><span class="line">  -p 8080:8080 \</span><br><span class="line">  -e JAVA_OPTS=<span class="string">&quot;-Xms512m -Xmx1024m&quot;</span> \</span><br><span class="line">  -v /home/centos/logs/app/:/app/logs \</span><br><span class="line">  app:latest</span><br></pre></td></tr></table></figure><h2 id="Dockerfile-è¯­æ³•æ£€æµ‹">Dockerfile è¯­æ³•æ£€æµ‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨çº¿æ£€æŸ¥ï¼š<a href="https://hadolint.github.io/hadolint/">Dockerfile Linter</a></p></li><li class="lvl-2"><p>æœ¬åœ°æ£€æŸ¥ï¼š<a href="https://github.com/hadolint/hadolint">Haskell Dockerfile Linter</a>ï¼Œå¯ä»¥å®‰è£…å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥é€šè¿‡dockerè¿è¡Œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…å‘½ä»¤</span></span><br><span class="line">wget -O /usr/local/bin/hadolint https://github.com/hadolint/hadolint/releases/latest/download/hadolint-Linux-x86_64</span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/hadolint</span><br><span class="line">hadolint --version</span><br><span class="line"><span class="comment"># æ£€æŸ¥</span></span><br><span class="line">hadolint Dockerfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker è¿è¡Œ</span></span><br><span class="line">docker run --<span class="built_in">rm</span> -i hadolint/hadolint &lt; Dockerfile</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ Dockerfile çš„ä½¿ç”¨æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/engine/reference/builder/&quot;&gt;Dockerfileå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker å‘½ä»¤ ä¹‹ é•œåƒ(Image)</title>
    <link href="https://blog.hanqunfeng.com/2025/05/22/docker-command-image/"/>
    <id>https://blog.hanqunfeng.com/2025/05/22/docker-command-image/</id>
    <published>2025-05-22T13:30:05.000Z</published>
    <updated>2025-06-12T06:57:51.843Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ é•œåƒç®¡ç† ç›¸å…³å‘½ä»¤</p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/reference/#application-programming-interfaces-apis">Application programming interfaces (APIs)</a></p></li></ul><span id="more"></span><h2 id="docker-search-æœç´¢é•œåƒ"><code>docker search</code> : æœç´¢é•œåƒ</h2><ul class="lvl-0"><li class="lvl-2"><p>æ¨èåœ¨<a href="https://hub.docker.com/">dockerhub</a>ä¸Šæœç´¢é•œåƒï¼Œä»¥è·å–æ›´è¯¦ç»†çš„é•œåƒä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>å›½å†…ä¹Ÿå¯ä»¥é€šè¿‡<a href="https://1ms.run/">æ¯«ç§’é•œåƒ</a>,<a href="https://dockers.xuanyuan.me">è½©è¾• Docker é•œåƒæœç´¢</a>æ¥æœç´¢é•œåƒã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker search --<span class="built_in">help</span></span><br><span class="line">ç”¨æ³•:  docker search [OPTIONS] TERM</span><br><span class="line"></span><br><span class="line">åœ¨ Docker Hub ä¸­æœç´¢é•œåƒ</span><br><span class="line"></span><br><span class="line">é€‰é¡¹:</span><br><span class="line">  -f, --filter filter   æ ¹æ®æä¾›çš„æ¡ä»¶è¿‡æ»¤è¾“å‡ºï¼Œå¸¸è§çš„è¿‡æ»¤æ¡ä»¶åŒ…æ‹¬ï¼šstarsï¼ˆæ˜Ÿçº§ï¼‰ã€is-officialï¼ˆæ˜¯å¦ä¸ºå®˜æ–¹é•œåƒï¼‰</span><br><span class="line">      --format string   ä½¿ç”¨ Go æ¨¡æ¿ç¾åŒ–è¾“å‡ºï¼Œä¸å¤ªå¸¸ç”¨</span><br><span class="line">      --<span class="built_in">limit</span> int       æœç´¢ç»“æœçš„æœ€å¤§æ•°é‡</span><br><span class="line">      --no-trunc        ä¸æˆªæ–­è¾“å‡ºå†…å®¹ï¼Œæ˜¾ç¤ºå®Œæ•´ä¿¡æ¯ï¼ˆé»˜è®¤è¾“å‡ºä¸­æŸäº›å­—æ®µå¦‚æè¿°å¯èƒ½è¢«æˆªæ–­ï¼‰</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœç´¢åç§°ä¸­åŒ…å« nginx çš„é•œåƒ</span></span><br><span class="line">$ docker search nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢åç§°ä¸­åŒ…å« nginx ä¸”æ˜Ÿçº§ä¸å°‘äº 100 çš„é•œåƒã€‚</span></span><br><span class="line">$ docker search -f stars=100 nginx</span><br><span class="line"><span class="comment"># æœç´¢å®˜æ–¹é•œåƒ</span></span><br><span class="line">$ docker search -f is-official=<span class="literal">true</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢ nginxï¼ŒæŒ‰ç…§æŒ‡å®šæ¨¡æ¿æ ¼å¼åŒ–è¾“å‡º</span></span><br><span class="line">$ docker search nginx --format <span class="string">&quot;&#123;&#123;.Name&#125;&#125;: &#123;&#123;.StarCount&#125;&#125; stars:  &#123;&#123;.Description&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢nginxé•œåƒï¼Œå¹¶é™åˆ¶5ä¸ªç»“æœ</span></span><br><span class="line">$ docker search nginx --<span class="built_in">limit</span> 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»„åˆä½¿ç”¨å¤šä¸ªé€‰é¡¹</span></span><br><span class="line">$ docker search -f stars=100 --<span class="built_in">limit</span> 5 --no-trunc nginx</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong><code>docker search</code> å‘½ä»¤æŠ¥é”™çš„è§£å†³æ–¹æ³•</strong></em></p><ul class="lvl-1"><li class="lvl-2">ç›®å‰å›½å†…ä½¿ç”¨<code>docker search</code>æ—¶ä¼šå‡ºç°<code>Error response from daemon: Get &quot;https://index.docker.io/v1/search?q=nginx&amp;n=25&quot;: dial tcp 210.56.51.193:443: i/o timeout</code>çš„é”™è¯¯ï¼Œå³ä¾¿æˆ‘ä»¬é…ç½®äº†å›½å†…çš„é•œåƒæºï¼Œè¿™ä¸ªé”™è¯¯è¿˜æ˜¯ä¼šå­˜åœ¨ã€‚</li><li class="lvl-2">å³ä¾¿ä¸ºå®¿ä¸»æœºå’Œdockeréƒ½é…ç½®ä¸ŠDNSä¹Ÿä¾ç„¶ä¼šæŠ¥é”™ã€‚</li><li class="lvl-2">ä¸è¿‡å¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹é•œåƒä»“åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œæ¯”å¦‚åœ¨æŸ¥è¯¢çš„é•œåƒåç§°å‰åŠ ä¸Š <code>docker.1ms.run/</code>ï¼Œæ¯”å¦‚æŸ¥è¯¢<code>nginx</code>é•œåƒï¼Œåˆ™è¾“å…¥<code>docker search docker.1ms.run/nginx</code>ï¼Œè¿™é‡Œè¦æ³¨æ„å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹é•œåƒä»“åº“éƒ½æ”¯æŒæŸ¥è¯¢ã€‚</li><li class="lvl-2">å¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬<code>docker_search</code>ï¼ŒæŸ¥è¯¢é•œåƒå¹¶è¾“å‡ºç»“æœï¼Œå¦‚ä¸‹ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">&#x27;EOF&#x27;</span> &gt; docker_search</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">QUERY=<span class="variable">$&#123;1&#125;</span>     <span class="comment"># æŸ¥è¯¢å…³é”®è¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯æŸ¥è¯¢å…³é”®è¯</span></span><br><span class="line"><span class="comment"># è·å–é™¤ç¬¬ä¸€ä¸ªå‚æ•°å¤–çš„æ‰€æœ‰å‚æ•°</span></span><br><span class="line">ARGS=<span class="variable">$&#123;@:2&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æŸ¥è¯¢é•œåƒï¼šdocker search docker.1ms.run/<span class="variable">$QUERY</span> <span class="variable">$ARGS</span>&quot;</span></span><br><span class="line">docker search docker.1ms.run/<span class="variable">$QUERY</span> <span class="variable">$ARGS</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> +x docker_search</span><br><span class="line"><span class="comment"># å°†å…¶ç§»åŠ¨åˆ° /usr/local/bin/</span></span><br><span class="line"><span class="built_in">mv</span> docker_search /usr/local/bin/docker_search</span><br><span class="line"><span class="comment"># å¦‚æœ/usr/local/bin/æ²¡æœ‰åœ¨PATHä¸­ï¼Œè¯·æ·»åŠ åˆ°ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=<span class="variable">$PATH</span>:/usr/local/sbin&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line">docker_search redis -f stars=100 --<span class="built_in">limit</span> 5 --no-trunc</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">NAME                DESCRIPTION                                                                                       STARS     OFFICIAL</span><br><span class="line">redis               Redis is the worldâ€™s fastest data platform <span class="keyword">for</span> caching, vector search, and NoSQL databases.      13315     [OK]</span><br><span class="line">redis/redis-stack   redis-stack installs a Redis server with additional database capabilities and the RedisInsight.   149</span><br><span class="line">bitnami/redis       Bitnami container image <span class="keyword">for</span> Redis</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">åŸºäºurlæœç´¢ï¼Œæ”¯æŒåˆ†é¡µï¼Œä½†ä¸èƒ½æ”¯æŒå…¶å®ƒsearchå‚æ•°</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">&#x27;EOF&#x27;</span> &gt; docker_search_by_url</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°å¤„ç†</span></span><br><span class="line">QUERY=<span class="variable">$&#123;1:-nginx&#125;</span>     <span class="comment"># é»˜è®¤æŸ¥è¯¢å…³é”®è¯</span></span><br><span class="line">N=<span class="variable">$&#123;2:-25&#125;</span>            <span class="comment"># é»˜è®¤æ¯é¡µæ¡æ•°</span></span><br><span class="line">PAGE=<span class="variable">$&#123;3:-1&#125;</span>          <span class="comment"># é»˜è®¤é¡µç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é•œåƒæºåˆ—è¡¨ï¼šä¾æ¬¡å°è¯•è®¿é—®è¿™äº›åŸŸåï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„é•œåƒæºéƒ½æ”¯æŒæœç´¢åŠŸèƒ½</span></span><br><span class="line">REGISTRIES=(</span><br><span class="line">  <span class="string">&quot;docker.1ms.run&quot;</span></span><br><span class="line">  <span class="string">&quot;register.librax.org&quot;</span></span><br><span class="line">  <span class="comment"># ä½ å¯ä»¥ç»§ç»­æ·»åŠ å¤‡ç”¨åŸŸå</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æˆåŠŸæ ‡å¿—</span></span><br><span class="line">WORKING_URL=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†åŸŸåï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯è®¿é—®çš„</span></span><br><span class="line"><span class="keyword">for</span> REG <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;REGISTRIES[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">  TEST_URL=<span class="string">&quot;https://<span class="variable">$&#123;REG&#125;</span>/v1/search?q=test&amp;n=1&quot;</span></span><br><span class="line">  <span class="keyword">if</span> curl -s --connect-timeout 2 <span class="string">&quot;<span class="variable">$TEST_URL</span>&quot;</span> | grep -q <span class="string">&#x27;&quot;results&quot;&#x27;</span>; <span class="keyword">then</span></span><br><span class="line">    WORKING_URL=<span class="string">&quot;https://<span class="variable">$&#123;REG&#125;</span>/v1/search?q=<span class="variable">$&#123;QUERY&#125;</span>&amp;n=<span class="variable">$&#123;N&#125;</span>&amp;page=<span class="variable">$&#123;PAGE&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœéƒ½å¤±è´¥ï¼Œé€€å‡º</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$WORKING_URL</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;âŒ æ— æ³•è¿æ¥ä»»ä½•é•œåƒæºï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–å¤‡ç”¨åŸŸåè®¾ç½®ã€‚&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·æ±‚æ•°æ®å¹¶æ ¼å¼åŒ–è¾“å‡º</span></span><br><span class="line">curl -s <span class="string">&quot;<span class="variable">$WORKING_URL</span>&quot;</span> \</span><br><span class="line">| jq -r <span class="string">&#x27;[&quot;NAME&quot;,&quot;STARS&quot;,&quot;OFFICIAL&quot;,&quot;DESCRIPTION&quot;],</span></span><br><span class="line"><span class="string">         (.results[] |</span></span><br><span class="line"><span class="string">         [.name,</span></span><br><span class="line"><span class="string">          (.star_count|tostring),</span></span><br><span class="line"><span class="string">          (if .is_official then &quot;[OK]&quot; else &quot;&quot; end),</span></span><br><span class="line"><span class="string">          .description])</span></span><br><span class="line"><span class="string">         | @tsv&#x27;</span> \</span><br><span class="line">| column -t -s $<span class="string">&#x27;\t&#x27;</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></div><h2 id="docker-image-é•œåƒç®¡ç†"><code>docker image</code> : é•œåƒç®¡ç†</h2><ul class="lvl-0"><li class="lvl-2"><p><code>docker image --help</code></p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>åˆ«å(ç®€å†™)</th></tr></thead><tbody><tr><td>build</td><td>ä» Dockerfile æ„å»ºä¸€ä¸ªé•œåƒ</td><td>docker build</td></tr><tr><td>history</td><td>æ˜¾ç¤ºé•œåƒçš„å†å²è®°å½•</td><td>docker history</td></tr><tr><td>import</td><td>ä» tar åŒ…å¯¼å…¥å†…å®¹ä»¥åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿé•œåƒ</td><td>docker import</td></tr><tr><td>inspect</td><td>æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒçš„è¯¦ç»†ä¿¡æ¯</td><td>å¯ä»¥ä½¿ç”¨ <code>docker inspect</code></td></tr><tr><td>load</td><td>ä» tar å½’æ¡£æˆ–æ ‡å‡†è¾“å…¥ä¸­åŠ è½½é•œåƒ</td><td>docker load</td></tr><tr><td>ls</td><td>åˆ—å‡ºé•œåƒ</td><td>docker images</td></tr><tr><td>prune</td><td>ç§»é™¤æœªä½¿ç”¨çš„é•œåƒ</td><td></td></tr><tr><td>pull</td><td>ä»é•œåƒä»“åº“ä¸‹è½½é•œåƒ</td><td>docker pull</td></tr><tr><td>push</td><td>ä¸Šä¼ é•œåƒåˆ°é•œåƒä»“åº“</td><td>docker push</td></tr><tr><td>rm</td><td>ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ</td><td>docker rmi</td></tr><tr><td>save</td><td>å°†ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒä¿å­˜ä¸º tar å½’æ¡£ï¼ˆé»˜è®¤è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼‰</td><td>docker save</td></tr><tr><td>tag</td><td>åˆ›å»ºä¸€ä¸ªæ ‡ç­¾ TARGET_IMAGE æŒ‡å‘ SOURCE_IMAGE</td><td>docker tag</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œ <code>docker image COMMAND --help</code> å¯è·å–æŸä¸ªå‘½ä»¤çš„æ›´å¤šä¿¡æ¯ã€‚</p></li></ul><h3 id="docker-pull-æ‹‰å–é•œåƒ"><code>docker pull</code> : æ‹‰å–é•œåƒ</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker image pull</code> == <code>docker pull</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼ï¼Œä¸åŠ tagé»˜è®¤æ‹‰å– :latest</span></span><br><span class="line">$ docker pull &lt;image_name&gt;[:&lt;tag&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹‰å–nginxé•œåƒï¼Œé»˜è®¤æ‹‰å–æœ€æ–°ç‰ˆæœ¬ï¼šlatestï¼Œnginxæ˜¯å®˜æ–¹é•œåƒï¼Œå®Œæ•´åç§°å®é™…ä¸Šæ˜¯ library/nginx</span></span><br><span class="line">$ docker pull nginx  ==  docker pull library/nginx  ==  docker pull nginx:latest</span><br><span class="line"><span class="comment"># æ‹‰å–æŒ‡å®štagçš„é•œåƒ</span></span><br><span class="line">$ docker pull nginx:1.28.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹‰å–éå®˜æ–¹é•œåƒï¼Œç”¨æˆ·ä¸Šä¼ çš„</span></span><br><span class="line">$ docker pull hanqunfeng/alpine-jre8-slim:1.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹‰å–æŒ‡å®šå¹³å°çš„é•œåƒï¼Œå¦‚æœä¸æŒ‡å®š --platform å‚æ•°ï¼Œé»˜è®¤ä¼šæ‹‰å–ä¸ä½ å½“å‰ Docker å®¢æˆ·ç«¯è¿è¡Œå¹³å°åŒ¹é…çš„é•œåƒï¼Œé€šè¿‡ docker version æŸ¥çœ‹</span></span><br><span class="line">$ docker pull --platform=linux/amd64 nginx:latest</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ <a href="/2025/05/20/docker-install/" title="Linux å®‰è£… Docker">Linux å®‰è£… Docker</a> ä¸­ä»‹ç»äº†å¦‚é…ç½®å›½å†…çš„é•œåƒåŠ é€Ÿæºæ¥åŠ å¿«é•œåƒçš„æ‹‰å–ï¼Œä½†æ˜¯å›½å†…é•œåƒæºä¸ç¨³å®šï¼Œéšæ—¶éƒ½æœ‰å¯èƒ½ä¸å¯ç”¨ï¼Œè€Œä¸”æ¯æ¬¡é‡æ–°é…ç½®é•œåƒæºè¿˜éœ€è¦é‡å¯Dockerï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥å®Œæˆ<code>pull</code>ï¼Œè¿™æ ·æ¯æ¬¡æ›´æ–°é•œåƒæºæ—¶åªéœ€è¦ä¿®æ”¹è„šæœ¬ï¼Œè€Œä¸éœ€è¦é‡å¯Dockeräº†ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è„šæœ¬åç§°ï¼šdocker_pull</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æ³•æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ç”¨æ³•: <span class="variable">$0</span> &lt;é•œåƒå&gt;ï¼Œä¾‹å¦‚ï¼šdocker_pull redis, docker_pull nginx --platform=linux/arm64&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸå§‹é•œåƒåç§°ï¼Œä¾‹å¦‚ nginx æˆ– someuser/imageï¼Œè¦æ±‚ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯é•œåƒåç§°</span></span><br><span class="line">ORIGINAL_IMAGE_NAME=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é™¤ç¬¬ä¸€ä¸ªå‚æ•°å¤–çš„æ‰€æœ‰å‚æ•°</span></span><br><span class="line">ARGS=<span class="variable">$&#123;@:2&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é•œåƒæºåˆ—è¡¨ï¼Œä¿®æ”¹é•œåƒæºæ—¶åªéœ€è¦ä¿®æ”¹è¯¥åˆ—è¡¨å³å¯</span></span><br><span class="line">MIRROR_LIST=(</span><br><span class="line">  <span class="string">&quot;docker.1ms.run&quot;</span></span><br><span class="line">  <span class="string">&quot;docker.xuanyuan.me&quot;</span></span><br><span class="line">  <span class="string">&quot;docker.m.daocloud.io&quot;</span></span><br><span class="line">  <span class="string">&quot;docker.1panel.live&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœé•œåƒåä¸­ä¸åŒ…å« &quot;/&quot;ï¼ŒåŠ ä¸Š &quot;library/&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$ORIGINAL_IMAGE_NAME</span>&quot;</span> != *<span class="string">&quot;/&quot;</span>* ]]; <span class="keyword">then</span></span><br><span class="line">  IMAGE_NAME=<span class="string">&quot;library/<span class="variable">$ORIGINAL_IMAGE_NAME</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  IMAGE_NAME=<span class="string">&quot;<span class="variable">$ORIGINAL_IMAGE_NAME</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†é•œåƒæº</span></span><br><span class="line"><span class="keyword">for</span> MIRROR <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;MIRROR_LIST[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">  FULL_IMAGE=<span class="string">&quot;<span class="variable">$MIRROR</span>/<span class="variable">$IMAGE_NAME</span>&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;å°è¯•ä» <span class="variable">$FULL_IMAGE</span> <span class="variable">$ARGS</span> æ‹‰å–é•œåƒ...&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;docker pull <span class="variable">$&#123;FULL_IMAGE&#125;</span> <span class="variable">$&#123;ARGS&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">if</span> docker pull <span class="variable">$&#123;FULL_IMAGE&#125;</span> <span class="variable">$&#123;ARGS&#125;</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æˆåŠŸæ‹‰å–é•œåƒï¼š<span class="variable">$FULL_IMAGE</span> <span class="variable">$ARGS</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†é•œåƒé‡å‘½åä¸ºå»é™¤é•œåƒæºå‰ç¼€çš„ç‰ˆæœ¬</span></span><br><span class="line">    docker tag <span class="string">&quot;<span class="variable">$FULL_IMAGE</span>&quot;</span> <span class="string">&quot;<span class="variable">$ORIGINAL_IMAGE_NAME</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;é•œåƒé‡å‘½åä¸ºï¼š<span class="variable">$ORIGINAL_IMAGE_NAME</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯é€‰ï¼šåˆ é™¤å¸¦é•œåƒæºå‰ç¼€çš„é•œåƒ</span></span><br><span class="line">    docker rmi <span class="string">&quot;<span class="variable">$FULL_IMAGE</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ä» <span class="variable">$MIRROR</span> æ‹‰å–å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ªé•œåƒæº...&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ‰€æœ‰é•œåƒæºå°è¯•å¤±è´¥ï¼Œæ— æ³•æ‹‰å–é•œåƒï¼š<span class="variable">$ORIGINAL_IMAGE_NAME</span> <span class="variable">$ARGS</span>&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å¦‚ä½•è·å–é•œåƒtag</strong></em></p><ul class="lvl-1"><li class="lvl-2">docker å‘½ä»¤ä¸­æ²¡æœ‰æä¾›ç›´æ¥è·å–é•œåƒtagçš„å‘½ä»¤ï¼Œå¦‚æœä¸æƒ³åˆ°<code>dockerhub</code>ä¸ŠæŸ¥çœ‹ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è·å–</li><li class="lvl-2">é€šè¿‡dockerhubçš„apiæ¥å£è·å–(éœ€è¦ç§‘å­¦ä¸Šç½‘)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªæ˜¾ç¤ºtagåç§°ï¼Œå®˜æ–¹é•œåƒæ›¿æ¢ nginxï¼Œéå®˜æ–¹é•œåƒæ›¿æ¢ libryary/nginxï¼Œpage_size=5è¡¨ç¤ºæ¯é¡µ5æ¡æ•°æ®ï¼Œpage=1è¡¨ç¤ºç¬¬ä¸€é¡µï¼ˆé»˜è®¤ä¸º1ï¼‰</span></span><br><span class="line">curl -s <span class="string">&quot;https://registry.hub.docker.com/v2/repositories/library/nginx/tags?page_size=5&amp;page=1&quot;</span> | jq <span class="string">&#x27;.results[].name&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹urlï¼Œä¸¤è€…æ•ˆæœç›¸åŒ</span></span><br><span class="line"><span class="comment">## https://hub.docker.com/v2/namespaces/&#123;namespace&#125;/repositories/&#123;repository&#125;/tags?page_size=5&amp;page=1</span></span><br><span class="line"><span class="comment">## ç¤ºä¾‹ï¼šhttps://hub.docker.com/v2/namespaces/library/repositories/nginx/tags?page_size=1&amp;page=1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºjsonæ ¼å¼ï¼Œå¹¶æ˜¾ç¤ºæœ€åæ›´æ–°æ—¶é—´å’Œé•œåƒå¤§å°</span></span><br><span class="line">curl -s <span class="string">&quot;https://registry.hub.docker.com/v2/repositories/library/nginx/tags?page_size=5&amp;page=1&quot;</span> | jq <span class="string">&#x27;.results[] | &#123;name,last_updated,full_size&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºè¡¨æ ¼æ ¼å¼ï¼Œå¹¶æ ¼å¼åŒ–è¾“å‡º</span></span><br><span class="line">curl -s <span class="string">&quot;https://registry.hub.docker.com/v2/repositories/library/nginx/tags?page_size=5&amp;page=1&quot;</span> \</span><br><span class="line">| jq -r <span class="string">&#x27;.results[] |</span></span><br><span class="line"><span class="string">  &quot;\(.name)\t\t\(.last_updated | sub(&quot;T&quot;; &quot; &quot;) | sub(&quot;\\..*&quot;; &quot;&quot;))\t\t\(((.full_size / 1024 / 1024 * 100 | round)/100) | tostring) MB&quot;&#x27;</span> \</span><br><span class="line">  | awk <span class="string">&#x27;&#123;printf &quot;%-30s %-20s %8.2f MB\n&quot;, $1, $2&quot; &quot;$3, $4&#125;&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">é€šè¿‡<a href="https://github.com/containers/skopeo">skopeo</a>å·¥å…·è·å–</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œä½¿ç”¨å®¹å™¨çš„æ–¹å¼(éœ€è¦ç§‘å­¦ä¸Šç½‘)</span></span><br><span class="line">docker run --<span class="built_in">rm</span> quay.io/skopeo/stable:latest inspect --override-os linux  docker://docker.io/nginx | jq <span class="string">&#x27;.RepoTags[]&#x27;</span></span><br><span class="line"><span class="comment"># å°†`docker.io`æ›¿æ¢ä¸ºé•œåƒæº`docker.1ms.run`ï¼Œä¸éœ€è¦ç§‘å­¦ä¸Šç½‘</span></span><br><span class="line">docker run --<span class="built_in">rm</span> quay.io/skopeo/stable:latest inspect --override-os linux  docker://docker.1ms.run/nginx | jq <span class="string">&#x27;.RepoTags[]&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨å¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; docker_tags</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># ç”¨æ³•æç¤º</span></span><br><span class="line"><span class="string">if [ -z &quot;\$1&quot; ]; then</span></span><br><span class="line"><span class="string">  echo &quot;ç”¨æ³•: \$0 &lt;é•œåƒåç§°ï¼Œä¾‹å¦‚ nginx æˆ– library/nginx&gt;&quot;</span></span><br><span class="line"><span class="string">  exit 1</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">IMAGE_NAME=\$1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># ä½¿ç”¨ skopeo è·å–é•œåƒä¿¡æ¯å¹¶è§£ææ ‡ç­¾åˆ—è¡¨</span></span><br><span class="line"><span class="string">docker run --rm quay.io/skopeo/stable:latest \\</span></span><br><span class="line"><span class="string">  inspect --override-os linux docker://docker.1ms.run/\$IMAGE_NAME \\</span></span><br><span class="line"><span class="string">  | jq &#x27;.RepoTags[]&#x27;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">chmod</span> +x docker_tags</span><br><span class="line"><span class="comment"># ä½¿ç”¨</span></span><br><span class="line">docker_tags nginx</span><br></pre></td></tr></table></figure></div><h3 id="docker-images-åˆ—å‡ºé•œåƒ"><code>docker images</code> : åˆ—å‡ºé•œåƒ</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker image ls</code> == <code>docker images</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰é•œåƒï¼Œä¸åŒ…æ‹¬æ‚¬ç©ºé•œåƒï¼Œï¼ˆdangling images:æ²¡æœ‰ tag çš„é•œåƒ,é€šå¸¸æ˜¯æ„å»ºä¸­é—´äº§ç‰©,ä¾‹å¦‚ï¼š&lt;none&gt;:&lt;none&gt; å½¢å¼ã€‚ï¼‰</span></span><br><span class="line">$ docker images</span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰é•œåƒï¼ŒåŒ…æ‹¬æ‚¬ç©ºé•œåƒ</span></span><br><span class="line">$ docker images -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰é•œåƒï¼Œå¹¶æ˜¾ç¤ºé•œåƒçš„æ‘˜è¦ä¿¡æ¯</span></span><br><span class="line">$ docker images --digests</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰é•œåƒï¼Œå¹¶è¾“å‡ºä¸ºjsonæ ¼å¼</span></span><br><span class="line">$ docker images --format json</span><br><span class="line"><span class="comment"># åªæ˜¾ç¤ºé•œåƒåç§°å’Œæ ‡ç­¾</span></span><br><span class="line">$ docker images --format <span class="string">&quot;&#123;&#123;.Repository&#125;&#125;:&#123;&#123;.Tag&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åªæ˜¾ç¤ºé•œåƒID</span></span><br><span class="line">$ docker images -q</span><br></pre></td></tr></table></figure><h3 id="docker-inspect-æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯"><code>docker inspect</code> : æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker image inspect</code> == <code>docker inspect</code></p></li><li class="lvl-2"><p>è¿™é‡Œè¦æ³¨æ„ï¼Œ<code>docker inspect</code>å¦‚æœåŸºäºåç§°æŸ¥æ‰¾ä¼šä¼˜å…ˆæŸ¥æ‰¾å®¹å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼</span></span><br><span class="line">$ docker inspect [OPTIONS] NAME|ID [NAME|ID...]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºé•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œé•œåƒåç§°</span></span><br><span class="line">$ docker inspect nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºé•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œé•œåƒID</span></span><br><span class="line">$ docker inspect 9f0c0d0a0f0f</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºé•œåƒçš„Labelsä¿¡æ¯ï¼Œè·å–jsonä¸­æŒ‡å®šçš„å­—æ®µ</span></span><br><span class="line">$ docker image inspect --format=<span class="string">&#x27;&#123;&#123;json .Config.Labels&#125;&#125;&#x27;</span> nginx</span><br></pre></td></tr></table></figure><h3 id="docker-image-prune-åˆ é™¤æœªä½¿ç”¨çš„é•œåƒ"><code>docker image prune</code> : åˆ é™¤æœªä½¿ç”¨çš„é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ‚¬ç©ºé•œåƒï¼Œï¼ˆdangling images:æ²¡æœ‰ tag çš„é•œåƒ,é€šå¸¸æ˜¯æ„å»ºä¸­é—´äº§ç‰©,ä¾‹å¦‚ï¼š&lt;none&gt;:&lt;none&gt; å½¢å¼ã€‚ï¼‰</span></span><br><span class="line">$ docker image prune</span><br><span class="line"><span class="comment"># åˆ é™¤å…¨éƒ¨æœªä½¿ç”¨é•œåƒ(æœªè¢«ä»»ä½•ä¸€ä¸ªå®¹å™¨å¼•ç”¨)ï¼ŒåŒ…æ‹¬æ‚¬ç©ºé•œåƒ</span></span><br><span class="line">$ docker image prune -a</span><br><span class="line"><span class="comment"># ä¸è¿›è¡Œç¡®è®¤æç¤ºï¼Œç›´æ¥æ‰§è¡Œ</span></span><br><span class="line">$ docker image prune -f</span><br></pre></td></tr></table></figure><h3 id="docker-rmi-åˆ é™¤é•œåƒ"><code>docker rmi</code> : åˆ é™¤é•œåƒ</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker image rm</code> == <code>docker rmi</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼</span></span><br><span class="line">$ docker rmi [OPTIONS] IMAGE [IMAGE...]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤é•œåƒï¼Œé•œåƒåç§°</span></span><br><span class="line">$ docker rmi nginx</span><br><span class="line"><span class="comment"># åˆ é™¤å¤šä¸ªé•œåƒï¼Œç©ºæ ¼åˆ†éš”</span></span><br><span class="line">$ docker rmi nginx mysql</span><br><span class="line"><span class="comment"># åˆ é™¤é•œåƒï¼Œé•œåƒID</span></span><br><span class="line">$ docker rmi 9f0c0d0a0f0f</span><br><span class="line"><span class="comment"># å¼ºåˆ¶åˆ é™¤é•œåƒï¼Œå½“é•œåƒè¢«å®¹å™¨å¼•ç”¨æ—¶ï¼Œä¼šæŠ¥é”™ï¼Œéœ€è¦ä½¿ç”¨-få‚æ•°è¿›è¡Œå¼ºåˆ¶åˆ é™¤</span></span><br><span class="line">$ docker rmi -f nginx</span><br><span class="line"><span class="comment"># åˆ é™¤å…¨éƒ¨é•œåƒ</span></span><br><span class="line">$ docker rmi $(docker images -q)</span><br></pre></td></tr></table></figure><h3 id="docker-history-æŸ¥çœ‹é•œåƒçš„æ„å»ºå†å²"><code>docker history</code> : æŸ¥çœ‹é•œåƒçš„æ„å»ºå†å²</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker image history</code> == <code>docker history</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼</span></span><br><span class="line">$ docker <span class="built_in">history</span> [OPTIONS] IMAGE</span><br><span class="line"><span class="comment"># æŸ¥çœ‹é•œåƒçš„å†å²è®°å½•ï¼Œé•œåƒåç§°</span></span><br><span class="line">$ docker <span class="built_in">history</span> nginx</span><br><span class="line"><span class="comment"># æŸ¥çœ‹é•œåƒçš„å†å²è®°å½•ï¼Œé•œåƒID</span></span><br><span class="line">$ docker <span class="built_in">history</span> 9f0c0d0a0f0f</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå®Œæ•´çš„é•œåƒå†å²è®°å½•ï¼Œé»˜è®¤`CREATED BY`ä¸­çš„ä¿¡æ¯å¤ªé•¿ä¼šè¢«æˆªæ–­</span></span><br><span class="line">$ docker <span class="built_in">history</span> --no-trunc nginx</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºä¸ºjsonæ ¼å¼</span></span><br><span class="line">$ docker <span class="built_in">history</span> --format=json nginx</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker history</code> æ˜¾ç¤ºçš„æ˜¯æ„å»ºå†å²ï¼Œä¼šå°†æ¯ä¸€ä¸ª Dockerfile æŒ‡ä»¤éƒ½ç®—ä¸€å±‚ï¼Œè€Œä¸æ˜¯ç‰©ç†é•œåƒå±‚ï¼ˆlayerï¼‰æ•°é‡ï¼Œè‹¥è¦æŸ¥çœ‹é•œåƒçš„ç‰©ç†å±‚æ•°ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker image inspect --format <span class="string">&#x27;&#123;&#123; len .RootFS.Layers &#125;&#125;&#x27;</span> nginx</span><br></pre></td></tr></table></figure><h3 id="docker-tag-åˆ›å»ºä¸€ä¸ªæ ‡ç­¾"><code>docker tag</code> : åˆ›å»ºä¸€ä¸ªæ ‡ç­¾</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker image tag</code> == <code>docker tag</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼</span></span><br><span class="line">$ docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæ ‡ç­¾</span></span><br><span class="line">$ docker tag nginx:latest hanqunfeng/nginx:latest</span><br><span class="line"><span class="comment"># æŸ¥çœ‹é•œåƒï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªé•œåƒçš„ IMAGE ID ä¸€è‡´</span></span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY         TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">hanqunfeng/nginx   latest    be69f2940aaf   5 weeks ago   192MB</span><br><span class="line">nginx              latest    be69f2940aaf   5 weeks ago   192MB</span><br><span class="line"><span class="comment"># æ­¤æ—¶è‹¥é€šè¿‡ IMAGE ID åˆ é™¤é•œåƒï¼Œä¼šæŠ¥é”™ï¼Œæç¤ºè¢«å¤šä¸ª REPOSITORY å…³è”ï¼Œéœ€è¦ä½¿ç”¨ -f å‚æ•°è¿›è¡Œå¼ºåˆ¶åˆ é™¤</span></span><br><span class="line">$ docker rmi be69f2940aaf</span><br><span class="line">Error response from daemon: conflict: unable to delete be69f2940aaf (must be forced) - image is referenced <span class="keyword">in</span> multiple repositories</span><br></pre></td></tr></table></figure><h3 id="docker-save-å°†é•œåƒä¿å­˜ä¸º-tar-å½’æ¡£"><code>docker save</code> : å°†é•œåƒä¿å­˜ä¸º tar å½’æ¡£</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker image save</code> == <code>docker save</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼</span></span><br><span class="line">$ docker save [OPTIONS] IMAGE [IMAGE...]</span><br><span class="line"><span class="comment"># å°†é•œåƒä¿å­˜ä¸º tar å½’æ¡£ï¼Œ-o  æŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œæ–‡ä»¶åç§°ä»»æ„ï¼Œç”šè‡³éƒ½ä¸éœ€è¦ä»¥ .tar ç»“å°¾</span></span><br><span class="line">$ docker save -o nginx.tar nginx</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">$ docker save nginx &gt; nginx.tar</span><br></pre></td></tr></table></figure><h3 id="docker-load-ä»-tar-å½’æ¡£ä¸­åŠ è½½é•œåƒ"><code>docker load</code> : ä» tar å½’æ¡£ä¸­åŠ è½½é•œåƒ</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker image load</code> == <code>docker load</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼</span></span><br><span class="line">$ docker load [OPTIONS]</span><br><span class="line"><span class="comment"># ä» tar å½’æ¡£ä¸­åŠ è½½é•œåƒï¼Œå¯¼å‡ºtarå½’æ¡£æ—¶çš„é•œåƒåç§°å°±æ˜¯åŠ è½½åçš„é•œåƒåç§°</span></span><br><span class="line">$ docker load -i nginx.tar</span><br><span class="line"><span class="comment"># -q å‚æ•°è¡¨ç¤ºä¸æ˜¾ç¤ºè¿›åº¦æ¡</span></span><br><span class="line">$ docker load -q -i nginx.tar</span><br></pre></td></tr></table></figure><h3 id="docker-import-ä»æ–‡ä»¶åˆ›å»ºé•œåƒ"><code>docker import</code> : ä»æ–‡ä»¶åˆ›å»ºé•œåƒ</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker image import</code> == <code>docker import</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼</span></span><br><span class="line">$ docker import [OPTIONS] FILE|URL|- [REPOSITORY[:TAG]]</span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line">fileæœ¬åœ° tar æ–‡ä»¶ï¼Œä¾‹å¦‚ rootfs.tar</span><br><span class="line">URL    ç½‘ç»œåœ°å€ï¼ˆhttp/httpsï¼‰</span><br><span class="line">-    ä»æ ‡å‡†è¾“å…¥è¯»å–ï¼ˆæ¯”å¦‚é€šè¿‡ç®¡é“ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºé•œåƒåç§°ä¸æ ‡ç­¾</span></span><br><span class="line">REPOSITORY[:TAG]å¯¼å…¥åé•œåƒçš„åç§°ä¸æ ‡ç­¾</span><br><span class="line"></span><br><span class="line"><span class="comment"># OPTIONS</span></span><br><span class="line">--changeåœ¨å¯¼å…¥é•œåƒæ—¶è®¾ç½® Dockerfile æŒ‡ä»¤ï¼Œå¦‚ CMDã€ENVã€EXPOSE ç­‰</span><br><span class="line">--message, -mæ·»åŠ å¯¼å…¥è¯´æ˜ï¼ˆcommit messageï¼‰</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker import</code> ä¸  <code>docker load</code> çš„åŒºåˆ«</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>ç”¨é€”</th><th>æ ¼å¼</th><th>æ˜¯å¦ä¿ç•™å†å²</th></tr></thead><tbody><tr><td><code>docker import</code></td><td>å¯¼å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œåˆ›å»ºé•œåƒ(ç”± <code>docker export</code> ç”Ÿæˆ)</td><td>çº¯æ–‡ä»¶ç³»ç»Ÿ tar åŒ…</td><td>âŒ ä¸ä¿ç•™å†å²ã€æ ‡ç­¾ç­‰å…ƒæ•°æ®</td></tr><tr><td><code>docker load</code></td><td>åŠ è½½é•œåƒï¼ˆé€šå¸¸ç”± <code>docker save</code> ç”Ÿæˆï¼‰</td><td>Docker é•œåƒ tarï¼ˆå«å…ƒæ•°æ®ï¼‰</td><td>âœ… ä¿ç•™ tagã€å±‚ã€å†å²ç­‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹: ä»å®¹å™¨å¯¼å‡ºå†å¯¼å…¥</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ä¸€ä¸ªå®¹å™¨</span></span><br><span class="line">$ docker run -d -p 8080:80 --name nginx nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºå®¹å™¨æ–‡ä»¶ç³»ç»Ÿï¼Œæ­¤æ—¶ nginx å®¹å™¨ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¿å­˜åœ¨ my_nginx.tar æ–‡ä»¶ä¸­</span></span><br><span class="line">$ docker <span class="built_in">export</span> -o my_nginx.tar nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œå¯¼å…¥æ—¶æŒ‡å®š å¯åŠ¨å‘½ä»¤ï¼Œå› ä¸º my_nginx.tar åªæ˜¯æ–‡ä»¶ï¼Œå¹¶ä¸åŒ…å«ä»»ä½•å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">$ docker import --change=<span class="string">&#x27;CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]&#x27;</span> my_nginx.tar nginx:my_tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é•œåƒï¼Œé•œåƒIDä¸ä¸€è‡´</span></span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY         TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">nginx              my_tag    4ab42de31bac   4 seconds ago   191MB</span><br><span class="line">nginx              latest    be69f2940aaf   5 weeks ago     192MB</span><br></pre></td></tr></table></figure><h3 id="docker-build-ä»æŒ‡å®šç›®å½•æˆ–URLä¸­çš„-Dockerfile-æ„å»º-Docker-é•œåƒ"><code>docker build</code> : ä»æŒ‡å®šç›®å½•æˆ–URLä¸­çš„ Dockerfile æ„å»º Docker é•œåƒ</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker image build</code> == <code>docker build</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼</span></span><br><span class="line">docker build [OPTIONS] PATH | URL | -</span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line">PATH  Dockerfile æ‰€åœ¨çš„ç›®å½•</span><br><span class="line">URL      Git ä»“åº“çš„ URL</span><br><span class="line">-      ä»æ ‡å‡†è¾“å…¥è¯»å– Dockerfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºé•œåƒï¼Œ-t: æŒ‡å®šé•œåƒåç§°ï¼Œ.: è¡¨ç¤ºä»å½“å‰ç›®å½•æŸ¥æ‰¾Dockerfileï¼Œé»˜è®¤æ–‡ä»¶åç§°ä¸º Dockerfile</span></span><br><span class="line">docker build -t myimage:latest .</span><br><span class="line"><span class="comment"># æ„å»ºé•œåƒï¼Œ-f: æŒ‡å®š Dockerfile çš„ç›¸å¯¹è·¯å¾„ï¼Œ.: è¡¨ç¤ºåŸºäºå½“å‰ç›®å½•ï¼Œå®é™…çš„ Dockerfile è·¯å¾„å°±æ˜¯ ./path/MyDockerfile</span></span><br><span class="line">docker build -t myimage:latest -f path/MyDockerfile .</span><br><span class="line"><span class="comment"># å®é™…çš„ Dockerfile è·¯å¾„å°±æ˜¯ /usr/local/path/MyDockerfile</span></span><br><span class="line">docker build -t myimage:latest -f path/MyDockerfile /usr/local</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºé•œåƒï¼Œä» Git ä»“åº“ä¸­æ„å»ºï¼Œgit ä»“åº“çš„ Dockerfile å¿…é¡»åœ¨æ ¹ç›®å½•ä¸‹</span></span><br><span class="line">docker build https://github.com/hanqunfeng/docker_test.git -t abc:1.0.0</span><br><span class="line"><span class="comment"># æ„å»ºé•œåƒï¼Œä» Git ä»“åº“ä¸­æ„å»ºï¼ŒæŒ‡å®š Dockerfile çš„ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">docker build -f docker/Dockerfile https://github.com/hanqunfeng/docker_test.git -t abc:1.0.1</span><br><span class="line"><span class="comment"># æ„å»ºé•œåƒï¼Œä» Git ä»“åº“ä¸­æ„å»ºï¼ŒæŒ‡å®šåˆ†æ”¯æˆ– tag</span></span><br><span class="line">docker build -f docker/Dockerfile https://github.com/hanqunfeng/docker_test.git#release -t abc:1.0.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºé•œåƒï¼Œ--no-cache è¡¨ç¤ºä¸ä½¿ç”¨ç¼“å­˜ï¼Œæ¯æ¬¡æ„å»ºéƒ½ä¼šé‡æ–°æ„å»ºï¼Œä½†ä¼šéå¸¸æ…¢ï¼Œä¸€èˆ¬æ²¡æœ‰å¯¼è‡´æŸä¸€ä¸ªå±‚å‘ç”Ÿå˜åŒ–æ—¶ä¸éœ€è¦åŠ ä¸Šè¿™ä¸ªå‚æ•°</span></span><br><span class="line">docker build --no-cache -t app:latest .</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>docker build</code>ä¸­è¿˜æœ‰ä¸€äº›é‡è¦çš„å‚æ•°ï¼Œä»¥åŠ<code>Dockerfile</code>æ–‡ä»¶è¯¥æ€ä¹ˆç¼–å†™ï¼Œè¯·å‚è€ƒ<a href="/2025/05/26/docker-dockerfile/" title="Docker å‘½ä»¤ ä¹‹ Dockerfile">Docker å‘½ä»¤ ä¹‹ Dockerfile</a></p></li></ul><h3 id="docker-push-æ¨é€æœ¬åœ°é•œåƒåˆ°è¿œç¨‹ä»“åº“"><code>docker push</code> : æ¨é€æœ¬åœ°é•œåƒåˆ°è¿œç¨‹ä»“åº“</h3><ul class="lvl-0"><li class="lvl-2"><p><code>docker image push</code> == <code>docker push</code></p></li><li class="lvl-2"><p>è¿™é‡Œä»‹ç»å¦‚ä½•å°†é•œåƒæ¨é€åˆ°<code>docker hub</code>è¿œç¨‹ä»“åº“</p></li><li class="lvl-2"><p>éœ€è¦å…ˆåœ¨<a href="https://hub.docker.com/">docker hub</a>ç½‘ç«™ä¸Šåˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œæ¯”å¦‚æˆ‘çš„ç”¨æˆ·åæ˜¯<code>hanqunfeng</code></p></li><li class="lvl-2"><p>ç„¶åå°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†æœ¬åœ°é•œåƒæ¨é€åˆ°è¿œç¨‹ä»“åº“äº†</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æœ¬åœ°é•œåƒ</span></span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY         TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">nginx              latest    e573c6323878   18 hours ago   191MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹nginxé•œåƒæ‰“tag,å‰ç¼€å¿…é¡»ä¸ç”¨æˆ·åä¸€è‡´</span></span><br><span class="line">$ docker tag nginx hanqunfeng/nginx:1.0.0</span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY         TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hanqunfeng/nginx   1.0.0     be69f2940aaf   5 weeks ago    192MB</span><br><span class="line">nginx              latest    be69f2940aaf   5 weeks ago    192MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½• docker hup</span></span><br><span class="line">$ docker login -u hanqunfeng</span><br><span class="line"></span><br><span class="line">i Info â†’ A Personal Access Token (PAT) can be used instead.</span><br><span class="line">          To create a PAT, visit https://app.docker.com/settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Password: <span class="comment"># è¾“å…¥å¯†ç </span></span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½•åŒæ—¶è¾“å…¥å¯†ç </span></span><br><span class="line"><span class="comment"># docker login -u hanqunfeng -p 12345678</span></span><br><span class="line"><span class="comment"># ç™»å½•å…¶å®ƒä»“åº“</span></span><br><span class="line"><span class="comment"># docker login -u username -p password registry.orther.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨é€åˆ°docker hubï¼Œæ­¤åå°±å¯ä»¥é€šè¿‡ docker pull hanqunfeng/nginx:1.0.0 è·å–äº†</span></span><br><span class="line">$ docker push hanqunfeng/nginx:1.0.0</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">æœªç™»å½•Docker Hubçš„æƒ…å†µä¸‹ï¼Œè¿è¡Œ<code>docker pull</code>ä¼šæœ‰æ‹‰å–é€Ÿç‡å’Œæ•°é‡ä¸Šçš„é™åˆ¶ï¼Œå…·ä½“å¯ä»¥å‚çœ‹<a href="https://docs.docker.com/docker-hub/usage/">Docker Hubçš„ä½¿ç”¨å’Œé™åˆ¶</a></li></ul></div>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Docker å‘½ä»¤ ä¸­ é•œåƒç®¡ç† ç›¸å…³å‘½ä»¤&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/reference/#application-programming-interfaces-apis&quot;&gt;Application programming interfaces (APIs)&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Linux å®‰è£… Docker</title>
    <link href="https://blog.hanqunfeng.com/2025/05/20/docker-install/"/>
    <id>https://blog.hanqunfeng.com/2025/05/20/docker-install/</id>
    <published>2025-05-20T13:30:05.000Z</published>
    <updated>2025-06-29T05:04:42.878Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Linux ä¸‹çš„ Docker å®‰è£…æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p>windowsã€macosã€ubuntuç­‰æ¡Œé¢ç³»ç»Ÿè¯·å®‰è£… <a href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a>ã€‚</p></li><li class="lvl-2"><p>é˜¿é‡Œäº‘ä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼š<a href="https://help.aliyun.com/zh/ecs/use-cases/install-and-use-docker">é˜¿é‡Œäº‘ä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker</a></p></li><li class="lvl-2"><p>è…¾è®¯äº‘ä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼š<a href="https://cloud.tencent.com/document/product/1207/45596">è…¾è®¯äº‘ä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker</a></p></li><li class="lvl-2"><p>AWSä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼š<a href="/2025/05/19/docker-install-aws/" title="AWSä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker">AWSä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com">Dockerå®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p><a href="https://docs.docker.com/engine/install/">å®‰è£…Docker Engine</a></p></li></ul><span id="more"></span><h2 id="Docker-ç®€ä»‹">Docker ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Docker æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨åŒ–å¹³å°ï¼Œç”¨äºæ‰“åŒ…ã€åˆ†å‘å’Œè¿è¡Œåº”ç”¨ç¨‹åºã€‚å®ƒé€šè¿‡å°†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–æ‰“åŒ…åˆ°ä¸€ä¸ªâ€œå®¹å™¨â€ä¸­ï¼Œç¡®ä¿åº”ç”¨åœ¨ä¸åŒç¯å¢ƒä¸­å§‹ç»ˆèƒ½å¤Ÿä¸€è‡´è¿è¡Œã€‚ä¸ä¼ ç»Ÿçš„è™šæ‹Ÿæœºç›¸æ¯”ï¼ŒDocker å®¹å™¨æ›´è½»é‡ã€å¯åŠ¨æ›´å¿«ã€èµ„æºå ç”¨æ›´å°‘ã€‚</p></li><li class="lvl-2"><p>Docker é‡‡ç”¨<code>å®¢æˆ·ç«¯-æœåŠ¡å™¨</code>æ¶æ„ï¼Œæ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ <code>Docker Engine</code>ï¼ˆè´Ÿè´£æ„å»ºå’Œè¿è¡Œå®¹å™¨ï¼‰ã€<code>Dockerfile</code>ï¼ˆå®šä¹‰æ„å»ºé•œåƒçš„æŒ‡ä»¤ï¼‰ã€<code>é•œåƒ</code>ï¼ˆåº”ç”¨å’Œä¾èµ–çš„åªè¯»æ¨¡æ¿ï¼‰å’Œ<code>å®¹å™¨</code>ï¼ˆåŸºäºé•œåƒè¿è¡Œçš„å®ä¾‹ï¼‰ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ Docker Hub å…±äº«æˆ–ä¸‹è½½é•œåƒï¼Œæå¤§ç®€åŒ–äº†éƒ¨ç½²æµç¨‹ã€‚</p></li><li class="lvl-2"><p>æ€»ç»“æ¥è¯´ï¼ŒDocker æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œæ”¯æŒæŒç»­é›†æˆä¸éƒ¨ç½²ï¼ˆCI/CDï¼‰ï¼Œåœ¨å¾®æœåŠ¡æ¶æ„ä¸­å°¤ä¸ºå¸¸ç”¨ï¼Œæ˜¯ç°ä»£ DevOps æµç¨‹çš„é‡è¦å·¥å…·ã€‚</p></li><li class="lvl-2"><p><a href="https://docs.docker.com/get-started/docker-overview/">Dockeræ˜¯ä»€ä¹ˆï¼Ÿ</a><br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/nIdftv.png" alt=""></p></li></ul><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>Docker ä»“åº“ï¼ˆRegistryï¼‰</td><td>Dockerä»“åº“ç”¨äºå­˜å‚¨Dockeré•œåƒã€‚Docker Hubæ˜¯ä¸€ä¸ªä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨çš„å…¬å…±ä»“åº“ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDockeråœ¨Docker Hubä¸ŠæŸ¥æ‰¾å›¾åƒã€‚ä½ ä¹Ÿå¯ä»¥é…ç½®è‡ªå·±çš„ç§äººä»“åº“ã€‚<br>å½“æ‚¨ä½¿ç”¨docker pullæˆ–docker runå‘½ä»¤æ—¶ï¼ŒDockerä¼šä»æ‚¨é…ç½®çš„ä»“åº“ä¸­æå–æ‰€éœ€çš„é•œåƒã€‚å½“æ‚¨ä½¿ç”¨docker pushå‘½ä»¤æ—¶ï¼ŒDockerä¼šå°†æ‚¨çš„é•œåƒæ¨é€åˆ°å·²é…ç½®çš„ä»“åº“ä¸­ã€‚</td></tr><tr><td>Docker å®ˆæŠ¤è¿›ç¨‹ï¼ˆDaemonï¼‰</td><td>ç›‘å¬Docker APIè¯·æ±‚ï¼Œå¹¶ç®¡ç†Dockerå¯¹è±¡ï¼Œå¦‚é•œåƒã€å®¹å™¨ã€ç½‘ç»œå’Œå·ã€‚å®ˆæŠ¤ç¨‹åºè¿˜å¯ä»¥ä¸å…¶ä»–å®ˆæŠ¤ç¨‹åºé€šä¿¡æ¥ç®¡ç†DockeræœåŠ¡ã€‚</td></tr><tr><td>Docker å®¢æˆ·ç«¯ï¼ˆClientï¼‰</td><td>Docker å®¢æˆ·ç«¯ï¼ˆdockerï¼‰æ˜¯è®¸å¤šç”¨æˆ·ä¸ Docker äº¤äº’çš„ä¸»è¦æ–¹å¼ã€‚å½“ä½ ä½¿ç”¨å¦‚ docker run è¿™æ ·çš„å‘½ä»¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå°†è¿™äº›å‘½ä»¤å‘é€ç»™ dockerdï¼ˆDocker å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œç”±å®ƒæ¥æ‰§è¡Œè¿™äº›æ“ä½œã€‚<br>docker å‘½ä»¤æ˜¯é€šè¿‡ Docker API è¿›è¡Œé€šä¿¡çš„ã€‚Docker å®¢æˆ·ç«¯å¯ä»¥ä¸å¤šä¸ªå®ˆæŠ¤è¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚</td></tr><tr><td>Docker ä¸»æœºï¼ˆHostï¼‰</td><td>è¿è¡Œ Docker å®ˆæŠ¤è¿›ç¨‹å’Œå®¹å™¨çš„ç‰©ç†æˆ–è™šæ‹Ÿæœºå™¨ã€‚</td></tr><tr><td>Docker é•œåƒï¼ˆImagesï¼‰</td><td>åˆ›å»ºå®¹å™¨çš„åªè¯»æ¨¡æ¿ï¼ŒåŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶å’Œé…ç½®ã€‚</td></tr><tr><td>Docker å®¹å™¨ï¼ˆContainerï¼‰</td><td>åŸºäºé•œåƒè¿è¡Œçš„å®ä¾‹ï¼Œæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨çš„ç‹¬ç«‹è¿è¡Œç¯å¢ƒã€‚</td></tr></tbody></table><h2 id="Docker-å®‰è£…">Docker å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>å…¨æ–°å®‰è£…å‰éœ€è¦å…ˆå¸è½½æ—§ç‰ˆæœ¬ï¼Œå¸è½½<code>docker</code>ä¹Ÿå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼æ“ä½œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤Dockerç›¸å…³æº</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -f /etc/yum.repos.d/docker*.repo</span><br><span class="line"><span class="comment"># åˆ é™¤Dockerç›¸å…³è½¯ä»¶åŒ…ï¼Œdnfå¯èƒ½ä¼šæŠ¥å‘Šæ‚¨æ²¡æœ‰å®‰è£…è¿™äº›è½¯ä»¶åŒ…ã€‚</span></span><br><span class="line"><span class="comment"># å¸è½½dockeræ—§ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">sudo</span> dnf -y remove \</span><br><span class="line">               docker \</span><br><span class="line">               docker-client \</span><br><span class="line">               docker-client-latest \</span><br><span class="line">               docker-common \</span><br><span class="line">               docker-latest \</span><br><span class="line">               docker-latest-logrotate \</span><br><span class="line">               docker-logrotate \</span><br><span class="line">               docker-engine</span><br><span class="line"><span class="comment"># å¸è½½dockeræ–°ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">sudo</span> dnf -y remove \</span><br><span class="line">            docker-ce \</span><br><span class="line">            containerd.io \</span><br><span class="line">            docker-ce-rootless-extras \</span><br><span class="line">            docker-buildx-plugin \</span><br><span class="line">            docker-ce-cli \</span><br><span class="line">            docker-compose-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤Dockeræ•°æ®,é•œåƒã€å®¹å™¨ã€å·å’Œç½‘ç»œ</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/docker</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/containerd</span><br><span class="line"><span class="comment"># Dockeræ‰§è¡ŒçŠ¶æ€æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/run/docker</span><br><span class="line"><span class="comment"># åˆ é™¤Dockeré…ç½®</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /etc/docker/</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è®¾ç½®dockerå­˜å‚¨åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf -y install dnf-plugins-core</span><br><span class="line"><span class="comment"># æµ·å¤–ï¼Œæ·»åŠ Dockerçš„å®˜æ–¹å­˜å‚¨åº“</span></span><br><span class="line"><span class="built_in">sudo</span> dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment"># å›½å†…ï¼Œæ·»åŠ é˜¿é‡Œäº‘çš„å­˜å‚¨åº“</span></span><br><span class="line"><span class="built_in">sudo</span> dnf config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®‰è£… Docker</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œå‡çº§ docker æ—¶ä¹Ÿæ˜¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span></span><br><span class="line"><span class="built_in">sudo</span> dnf -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"># å…ˆæŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">sudo</span> dnf list docker-ce --showduplicates | <span class="built_in">sort</span> -r</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">docker-ce.x86_64               3:26.1.3-1.el8                  docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:26.1.3-1.el8                  @docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:26.1.2-1.el8                  docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:26.1.1-1.el8                  docker-ce-stable</span><br><span class="line">docker-ce.x86_64               3:26.1.0-1.el8                  docker-ce-stable</span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ VERSION_STRING ä¸ºç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ 3:26.1.3-1.el8</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io docker-buildx-plugin docker-compose-plugin -y</span><br><span class="line"><span class="comment">## æ¯”å¦‚</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install docker-ce-3:26.1.3-1.el8 docker-ce-cli-3:26.1.3-1.el8 containerd.io docker-buildx-plugin docker-compose-plugin -y</span><br><span class="line"></span><br><span class="line"><span class="comment">## å¦‚æœåªå®‰è£…å®¢æˆ·ç«¯ç”¨äºè¿æ¥è¿œç¨‹ Docker ä¸»æœº</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install docker-ce-cli docker-buildx-plugin docker-compose-plugin -y</span><br></pre></td></tr></table></figure><table><thead><tr><th>ç»„ä»¶åç§°</th><th>æ˜¯å¦å¿…éœ€ï¼ˆæœ¬åœ°è¿è¡Œ Dockerï¼‰</th><th>åŠŸèƒ½ç®€ä»‹</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>docker-ce</code></td><td>âœ… æ˜¯</td><td>Docker Engine çš„æ ¸å¿ƒï¼ŒåŒ…æ‹¬ <code>dockerd</code>ï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰å’Œ <code>docker</code>ï¼ˆCLIï¼‰</td><td>å®Œæ•´å®‰è£… Docker æ—¶åŒ…å«æ­¤ç»„ä»¶</td></tr><tr><td><code>docker-ce-cli</code></td><td>âœ… æ˜¯ï¼ˆæˆ–å•ç‹¬ç”¨äºè¿œç¨‹æ§åˆ¶ï¼‰</td><td>Docker å‘½ä»¤è¡Œå·¥å…·ï¼Œå¦‚ <code>docker run</code>, <code>docker ps</code>, <code>docker build</code> ç­‰</td><td>å¯ä»¥ç‹¬ç«‹å®‰è£…ï¼Œåªç”¨äºæ§åˆ¶è¿œç¨‹ Docker ä¸»æœº</td></tr><tr><td><code>containerd.io</code></td><td>âœ… æ˜¯ï¼ˆæœ¬åœ°è¿è¡Œå®¹å™¨ï¼‰</td><td>å®¹å™¨è¿è¡Œæ—¶ï¼ŒDocker åç«¯ç”¨äºçœŸæ­£å¯åŠ¨/ç®¡ç†å®¹å™¨</td><td>å¦‚æœä½ åªä½¿ç”¨ Docker CLIï¼Œä¸è¿è¡Œæœ¬åœ°å®¹å™¨åˆ™ä¸éœ€è¦</td></tr><tr><td><code>docker-buildx-plugin</code></td><td>âŒ å¦</td><td>æä¾› <code>docker buildx</code> å‘½ä»¤ï¼Œæ”¯æŒé«˜çº§æ„å»ºç‰¹æ€§ï¼ˆå¦‚è·¨å¹³å°ã€å¤šé˜¶æ®µæ„å»ºï¼‰</td><td>å¯é€‰ï¼Œé€‚åˆé«˜çº§æ„å»ºéœ€æ±‚</td></tr><tr><td><code>docker-compose-plugin</code></td><td>âŒ å¦</td><td>æä¾› <code>docker compose</code> å‘½ä»¤ï¼Œç”¨äºç¼–æ’å¤šä¸ªæœåŠ¡</td><td>å¦‚æœä½¿ç”¨ Composeï¼Œåˆ™å»ºè®®å®‰è£…æ­¤æ’ä»¶</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ Docker</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®Dockerå®ˆæŠ¤è¿›ç¨‹åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="comment"># å¯åŠ¨Docker</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start docker</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ docker daemon æ—¥å¿—ï¼Œ-f: æŒç»­è·Ÿè¸ª</span></span><br><span class="line"><span class="built_in">sudo</span> journalctl -u docker -f</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç»„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç»„ï¼Œè¿™æ ·å½“å‰ç”¨æˆ·å°±å¯ä»¥ä¸éœ€è¦ä½¿ç”¨sudoå°±èƒ½ä½¿ç”¨dockerå‘½ä»¤</span></span><br><span class="line"><span class="comment"># å½“å‰ç”¨æˆ·æ˜¯centos</span></span><br><span class="line"><span class="built_in">sudo</span> usermod -aG docker centos</span><br><span class="line"><span class="comment"># è®©ç»„æƒé™ç«‹å³ç”Ÿæ•ˆæœ€ç¨³å¦¥çš„åšæ³•æ˜¯ï¼šæ³¨é”€å¹¶é‡æ–°ç™»å½•è¿œç¨‹ä¸»æœºï¼Œä½†ä¹Ÿå¯ä»¥å°è¯•ç”¨ä¸‹é¢å‘½ä»¤ç«‹å³åŠ è½½æ–°ç»„</span></span><br><span class="line">newgrp docker</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>éªŒè¯ Docker å®‰è£…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker version <span class="comment"># æŸ¥çœ‹ Docker version</span></span><br><span class="line"><span class="comment"># æ˜¾ç¤º Docker åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ’ä»¶ä¿¡æ¯ï¼Œé•œåƒåŠ é€Ÿä¿¡æ¯ç­‰ç­‰ã€‚</span></span><br><span class="line">docker info</span><br><span class="line"><span class="comment"># æ‹‰å–hello-worldé•œåƒï¼Œæ­¤æ—¶å›½å†…ä¼šæç¤ºè®¿é—®å¤±è´¥ï¼Œéœ€è¦æ·»åŠ å›½å†…é•œåƒæº</span></span><br><span class="line">docker pull hello-world</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ·»åŠ å›½å†…é•œåƒæº</p></li></ul><blockquote><p>ç›®å‰å›½å†…å¤§éƒ¨åˆ†çš„Dockeré•œåƒæºéƒ½å…³é—­äº†ï¼Œå¦å¤–é˜¿é‡Œäº‘çš„Dockeré•œåƒæºåªå…è®¸åœ¨é˜¿é‡Œäº‘çš„æœºå™¨ä¸Šä½¿ç”¨ã€‚<br>å‚è€ƒï¼š<a href="https://blog.xuanyuan.me/archives/1154">Docker/DockerHub å›½å†…é•œåƒæº/åŠ é€Ÿåˆ—è¡¨</a>,<a href="https://status.1panel.top/status/docker">å›½å†… Docker æœåŠ¡çŠ¶æ€ &amp; é•œåƒåŠ é€Ÿç›‘æ§</a><br>æ³¨æ„ï¼šå›½å†…é•œåƒæºçš„æ›´æ–°ä¼šæ¯”å®˜ç½‘æ»åï¼Œä½†åªè¦ä¸æ˜¯è·å–æœ€æ–°ç‰ˆæœ¬åŸºæœ¬ä¸Šæ˜¯å¤Ÿç”¨çš„ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;registry-mirrors&quot;: [</span></span><br><span class="line"><span class="string">        &quot;https://docker.1ms.run&quot;,</span></span><br><span class="line"><span class="string">        &quot;https://docker.xuanyuan.me&quot;,</span></span><br><span class="line"><span class="string">        &quot;https://docker.m.daocloud.io&quot;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯Docker</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦é…ç½®ç”Ÿæ•ˆï¼ŒæŸ¥çœ‹ Registry Mirrors ä¸­çš„é…ç½®</span></span><br><span class="line">docker info</span><br><span class="line"><span class="comment"># éªŒè¯å›½å†…é•œåƒæº</span></span><br><span class="line">docker pull hello-world</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Dockerå‘½ä»¤è‡ªåŠ¨è¡¥å…¨ï¼Œå‚è€ƒï¼š<a href="https://docs.docker.com/engine/cli/completion/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨çš„bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…bash-completion</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install bash-completion -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è‡ªåŠ¨è¡¥å…¨åˆ°å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOT &gt;&gt; ~/.bashrc</span></span><br><span class="line"><span class="string">if [ -f /etc/bash_completion ]; then</span></span><br><span class="line"><span class="string">    . /etc/bash_completion</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">EOT</span></span><br><span class="line"><span class="comment"># åˆ·æ–°bash</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè‡ªåŠ¨è¡¥å…¨æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/.local/share/bash-completion/completions</span><br><span class="line">docker completion bash &gt; ~/.local/share/bash-completion/completions/docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ä¸€ä¸ªæ–°çš„bash</span></span><br><span class="line"><span class="built_in">exec</span> bash</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¿«é€Ÿæ¸…ç†dockerä¸­æ‰€æœ‰çš„æ— ç”¨èµ„æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨ã€ç½‘ç»œç­‰</span></span><br><span class="line">docker system prune -a -f</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨ã€ç½‘ç»œã€æ•°æ®å·ç­‰</span></span><br><span class="line">docker system prune -a -f --volumes</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>/var/lib/docker</code> ç”¨äºå­˜å‚¨ Docker è¿è¡Œæ—¶ç”Ÿæˆçš„æ•°æ®ï¼Œå¦‚é•œåƒã€å®¹å™¨ã€ç½‘ç»œã€å·ã€é…ç½®æ–‡ä»¶ã€æ—¥å¿—ç­‰ï¼Œå…¶ç›®å½•ç»“æ„è¯´æ˜å¦‚ä¸‹ï¼š</p></li></ul><table><thead><tr><th>ç›®å½•å</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><code>buildkit/</code></td><td>å­˜æ”¾ Docker BuildKit æ„å»ºç¼“å­˜å’ŒçŠ¶æ€ä¿¡æ¯ï¼›æ„å»ºé•œåƒæ—¶çš„ä¸­é—´æ–‡ä»¶å’Œä¸Šä¸‹æ–‡ä¼šå­˜äºæ­¤ï¼Œç©ºé—´å ç”¨å¯èƒ½è¾ƒå¤§ã€‚</td></tr><tr><td><code>containers/</code></td><td>æ¯ä¸ªå®¹å™¨ä¸€ä¸ªå­ç›®å½•ï¼ŒåŒ…å«é…ç½®æ–‡ä»¶å’Œè¿è¡Œæ—¥å¿—ï¼ˆå¦‚ <code>container.log</code>ï¼‰ï¼Œç”¨äºå®¹å™¨çš„è¿è¡ŒçŠ¶æ€è®°å½•å’Œç®¡ç†ã€‚</td></tr><tr><td><code>engine-id</code></td><td>å­˜å‚¨ Docker å¼•æ“çš„å”¯ä¸€ IDï¼ŒDocker å®‰è£…æ—¶ç”Ÿæˆï¼Œå¸¸ç”¨äº swarm èŠ‚ç‚¹è¯†åˆ«ã€‚</td></tr><tr><td><code>image/</code></td><td>é•œåƒçš„å…ƒæ•°æ®ï¼ˆä¸å«å®é™… layer æ•°æ®ï¼‰ï¼Œç»„ç»‡é•œåƒçš„ç»“æ„ã€æ ‡ç­¾ã€é©±åŠ¨ç­‰ä¿¡æ¯ã€‚</td></tr><tr><td><code>network/</code></td><td>ç½‘ç»œé…ç½®åŠçŠ¶æ€ä¿¡æ¯ï¼Œå¦‚é»˜è®¤ <code>bridge</code> ç½‘ç»œã€è‡ªå®šä¹‰ç½‘ç»œé…ç½®ç­‰ã€‚</td></tr><tr><td><code>overlay2/</code></td><td>é•œåƒå’Œå®¹å™¨å®é™…çš„æ•°æ®å±‚ï¼ˆoverlay2 æ˜¯å­˜å‚¨é©±åŠ¨ï¼‰ï¼ŒåŒ…å«æ‰€æœ‰è”åˆæ–‡ä»¶ç³»ç»Ÿå±‚ï¼Œæ˜¯ Docker ä¸­æœ€å¤§çš„ç©ºé—´ä½¿ç”¨è€…ã€‚</td></tr><tr><td><code>plugins/</code></td><td>å­˜æ”¾ Docker æ’ä»¶ï¼ˆå¦‚ç½‘ç»œã€å·æ’ä»¶ï¼‰çš„é…ç½®å’Œæ•°æ®ï¼Œä¸€èˆ¬ä¸ºç©ºï¼Œé™¤éä½¿ç”¨äº†æ‰©å±•æ’ä»¶ã€‚</td></tr><tr><td><code>runtimes/</code></td><td>æ”¯æŒçš„ OCI runtime é…ç½®ç›®å½•ï¼Œå¦‚é»˜è®¤çš„ <code>runc</code>ï¼Œä¹Ÿå¯èƒ½åŒ…å«å…¶ä»– runtimeï¼ˆå¦‚ <code>kata</code>, <code>gvisor</code>ï¼‰ã€‚</td></tr><tr><td><code>swarm/</code></td><td>Docker swarm æ¨¡å¼ä¸‹çš„é›†ç¾¤å…ƒæ•°æ®ä¸èŠ‚ç‚¹çŠ¶æ€ï¼Œä»…åœ¨åˆå§‹åŒ– swarm åå­˜åœ¨å®é™…æ•°æ®ã€‚</td></tr><tr><td><code>tmp/</code></td><td>Docker çš„ä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œå¦‚é•œåƒä¸‹è½½ç¼“å­˜ã€æŒ‚è½½æ“ä½œä¸­çš„ä¸´æ—¶æ–‡ä»¶ï¼Œé€šå¸¸å¯ä»¥æ¸…ç†ä½†éœ€å°å¿ƒã€‚</td></tr><tr><td><code>volumes/</code></td><td>Docker å·çš„æ•°æ®ç›®å½•ï¼Œæ¯ä¸ªå·ä¸€ä¸ªå­ç›®å½•ï¼Œå·ä¸­çš„æŒä¹…åŒ–æ•°æ®å®é™…å­˜æ”¾äºæ­¤ã€‚</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p><code>/var/lib/containerd</code> æ˜¯ Containerd å®ˆæŠ¤è¿›ç¨‹çš„é»˜è®¤æ•°æ®å­˜å‚¨ç›®å½•ã€‚Containerd æ˜¯ Docker å’Œå…¶ä»–å®¹å™¨å¹³å°ï¼ˆå¦‚ Kubernetesï¼‰åº•å±‚çš„ å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰ï¼Œè´Ÿè´£æ‹‰å–é•œåƒã€ç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸã€æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿç­‰æ“ä½œã€‚å…¶ç›®å½•ç»“æ„è¯´æ˜å¦‚ä¸‹ï¼š</p></li></ul><table><thead><tr><th>ç›®å½•å</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><code>io.containerd.content.v1.content/</code></td><td>å­˜å‚¨é•œåƒ layer çš„å®é™…äºŒè¿›åˆ¶å†…å®¹ï¼ˆblobï¼‰ï¼Œéµå¾ª OCI é•œåƒè§„èŒƒï¼Œæ˜¯é•œåƒå’Œå®¹å™¨æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®æ¥æºã€‚</td></tr><tr><td><code>io.containerd.metadata.v1.bolt/</code></td><td>ä½¿ç”¨ BoltDB å­˜å‚¨ containerd çš„å…ƒæ•°æ®ï¼ˆå¦‚é•œåƒä¿¡æ¯ã€å®¹å™¨çŠ¶æ€ã€å¿«ç…§å¼•ç”¨ç­‰ï¼‰ï¼Œæ˜¯ containerd çš„æ ¸å¿ƒå…ƒæ•°æ®æ•°æ®åº“ã€‚</td></tr><tr><td><code>io.containerd.runtime.v1.linux/</code></td><td>å­˜å‚¨æ—§ç‰ˆï¼ˆv1 APIï¼‰è¿è¡Œæ—¶å®¹å™¨ä¿¡æ¯ï¼Œç›®å‰å·²é€æ­¥è¢« <code>v2</code> æ¥å£å–ä»£ï¼Œä»…åœ¨å‘åå…¼å®¹åœºæ™¯ä¸­å­˜åœ¨ã€‚</td></tr><tr><td><code>io.containerd.runtime.v2.task/</code></td><td>å­˜å‚¨ v2 è¿è¡Œæ—¶æ¥å£ä¸‹å®¹å™¨çš„è¿è¡Œæ—¶çŠ¶æ€ï¼Œå¦‚å®¹å™¨è¿›ç¨‹çš„ shimã€PIDã€æ—¥å¿—è·¯å¾„ç­‰ï¼Œæ˜¯å®¹å™¨å®é™…è¿è¡Œæ—¶æ‰€ä¾èµ–çš„ã€‚</td></tr><tr><td><code>io.containerd.snapshotter.v1.native/</code></td><td>ä½¿ç”¨ native æ¨¡å¼å­˜å‚¨çš„å®¹å™¨å¿«ç…§ï¼ˆæ–‡ä»¶ç³»ç»Ÿå±‚ï¼‰ï¼Œç›´æ¥å¤åˆ¶åº•å±‚æ–‡ä»¶ï¼›æ€§èƒ½è¾ƒå·®ï¼Œå ç”¨ç©ºé—´è¾ƒå¤§ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–ç‰¹å®šç”¨é€”ã€‚</td></tr><tr><td><code>io.containerd.snapshotter.v1.overlayfs/</code></td><td>ä½¿ç”¨ overlayfs æ¨¡å¼å­˜å‚¨å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿå¿«ç…§ï¼ˆé•œåƒå±‚å’Œå®¹å™¨å±‚ï¼‰ï¼›è¿™æ˜¯ç”Ÿäº§ç¯å¢ƒé»˜è®¤çš„é«˜æ•ˆå­˜å‚¨é©±åŠ¨ã€‚</td></tr><tr><td><code>tmpmounts/</code></td><td>ä¸´æ—¶æŒ‚è½½ç‚¹ç›®å½•ï¼Œcontainerd ç”¨äºé•œåƒè§£åŒ…ã€ä¸­é—´æ„å»ºè¿‡ç¨‹ä¸­çš„æŒ‚è½½æ“ä½œï¼Œé€šå¸¸æ˜¯æ„å»ºæˆ–è¿è¡Œè¿‡ç¨‹çš„ä¸´æ—¶æ•°æ®ã€‚</td></tr></tbody></table><div class="tips"><p><em><strong>MacOS/Windowsä¸‹æ— æ³•æŸ¥çœ‹<code>/var/lib/docker</code>çš„è§£å†³æ–¹æ³•</strong></em></p><ul class="lvl-1"><li class="lvl-2">åœ¨ MacOS/Windows ä¸Šä½¿ç”¨Dockeræ—¶ï¼Œæ˜¯å¯åŠ¨äº†ä¸€ä¸ªè™šæ‹Ÿæœºæ¥è¿è¡Œdockerçš„ï¼Œç”±äºå…¶è¿è¡Œåœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œç›´æ¥æŸ¥æ‰¾<code>/var/lib/docker</code>è·¯å¾„æ˜¯æ— æ•ˆçš„ã€‚</li><li class="lvl-2">è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ä¸€ä¸ªä¸´æ—¶å®¹å™¨ï¼Œå¹¶è¿›å…¥å…¶å†…éƒ¨</span></span><br><span class="line">docker run --<span class="built_in">rm</span> -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh</span><br><span class="line"><span class="comment">## è¯´æ˜</span></span><br><span class="line">--it</span><br><span class="line">    äº¤äº’å¼åœ°è¿è¡Œå®¹å™¨,å¹¶åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯</span><br><span class="line"></span><br><span class="line">--<span class="built_in">rm</span></span><br><span class="line">    é€€å‡ºå®¹å™¨æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤å®¹å™¨</span><br><span class="line"></span><br><span class="line">--privileged</span><br><span class="line">    ç»™å®¹å™¨ç‰¹æƒæƒé™ï¼Œè¿™æ„å‘³ç€å®¹å™¨å‡ ä¹æ‹¥æœ‰å®¿ä¸»æœºçš„æ‰€æœ‰èƒ½åŠ›ï¼Œèƒ½è®¿é—® /devã€ä¿®æ”¹å†…æ ¸å‚æ•°ç­‰ã€‚éå¸¸å¼ºå¤§ä½†ä¹Ÿå¾ˆå±é™©ã€‚</span><br><span class="line"></span><br><span class="line">--pid=host</span><br><span class="line">    å®¹å™¨å…±äº«å®¿ä¸»æœºçš„è¿›ç¨‹å‘½åç©ºé—´ï¼ˆPID Namespaceï¼‰ã€‚</span><br><span class="line">    è¿™ä½¿å¾—å®¹å™¨å¯ä»¥çœ‹åˆ°å¹¶è®¿é—®å®¿ä¸»æœºçš„æ‰€æœ‰è¿›ç¨‹ï¼ˆåŒ…æ‹¬ PID 1ï¼Œå³ç³»ç»Ÿ init è¿›ç¨‹ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">debian</span><br><span class="line">    ä½¿ç”¨çš„åŸºç¡€é•œåƒæ˜¯ Debianï¼Œå®¹å™¨é‡Œè¿è¡Œçš„æ˜¯è¿™ä¸ªç³»ç»Ÿã€‚</span><br><span class="line"></span><br><span class="line">nsenter -t 1 -m -u -n -i sh</span><br><span class="line">    è¿™æ˜¯å®¹å™¨å†…éƒ¨è¿è¡Œçš„å‘½ä»¤ï¼Œç”¨æ¥è¿›å…¥å®¿ä¸»æœºçš„å‘½åç©ºé—´ï¼š</span><br><span class="line">        nsenterï¼šLinux å·¥å…·ï¼Œç”¨äºè¿›å…¥å…¶ä»–è¿›ç¨‹çš„å‘½åç©ºé—´ã€‚</span><br><span class="line">        -t 1ï¼šæŒ‡å®šç›®æ ‡è¿›ç¨‹çš„ PID æ˜¯ 1ï¼ˆå®¿ä¸»æœºçš„ init æˆ– systemdï¼‰ã€‚</span><br><span class="line">        -mï¼šè¿›å…¥ç›®æ ‡è¿›ç¨‹çš„ Mount Namespaceï¼ˆæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼‰ã€‚</span><br><span class="line">        -uï¼šè¿›å…¥ç›®æ ‡çš„ UTS Namespaceï¼ˆä¸»æœºåç­‰ï¼‰ã€‚</span><br><span class="line">        -nï¼šè¿›å…¥ç›®æ ‡çš„ Network Namespaceï¼ˆç½‘ç»œï¼‰ã€‚</span><br><span class="line">        -iï¼šè¿›å…¥ç›®æ ‡çš„ IPC Namespaceï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰ã€‚</span><br><span class="line">        shï¼šåœ¨è¿™äº›å‘½åç©ºé—´ä¸­æ‰§è¡Œä¸€ä¸ª shellã€‚</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2">è¿™ä¸ªå‘½ä»¤å¯åŠ¨ä¸€ä¸ªåŸºäº Debian çš„å®¹å™¨ï¼Œç»™å®ƒæ‰€æœ‰ç‰¹æƒï¼Œè®©å®ƒèƒ½çœ‹åˆ°å®¿ä¸»æœºçš„è¿›ç¨‹ï¼Œç„¶åä½¿ç”¨ nsenter è¿›å…¥ PID ä¸º 1 çš„æ‰€æœ‰å‘½åç©ºé—´ï¼ˆç›¸å½“äºè¿›å…¥å®¿ä¸»æœºçš„è§†è§’ï¼‰ï¼Œæœ€åå¯åŠ¨ä¸€ä¸ª shï¼Œä½ å°±åœ¨å®¹å™¨é‡Œ â€œå˜æˆäº†å®¿ä¸»æœºâ€ã€‚</li><li class="lvl-2">è¿™æ ·ï¼Œä½ å°±å¯ä»¥åœ¨è¿™ä¸ªå®¹å™¨ä¸­æŸ¥çœ‹<code>/var/lib/docker</code>ç›®å½•äº†ã€‚</li></ul></div><h2 id="Docker-çš„-etc-docker-daemon-json-èƒ½é…ç½®å“ªäº›ä¼˜åŒ–é¡¹">Docker çš„ <code>/etc/docker/daemon.json</code> èƒ½é…ç½®å“ªäº›ä¼˜åŒ–é¡¹</h2><ul class="lvl-0"><li class="lvl-2"><p>é•œåƒåŠ é€Ÿï¼ˆå›½å†…å¸¸ç”¨ï¼‰</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;https://ä½ çš„åŠ é€Ÿåœ°å€&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ§åˆ¶æ—¥å¿—æ–‡ä»¶å¤§å°ä¸æ•°é‡ï¼Œé¿å…æ—¥å¿—æ— é™åˆ¶å¢é•¿å¯¼è‡´ç£ç›˜æ‰“æ»¡ã€‚</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;log-level&quot;</span><span class="punctuation">:</span>  <span class="string">&quot;info&quot;</span><span class="punctuation">,</span> # log-level é…ç½®ä¸º debugã€infoã€warnã€errorã€fatalï¼Œé»˜è®¤ä¸º info</span><br><span class="line">  <span class="attr">&quot;log-driver&quot;</span><span class="punctuation">:</span> <span class="string">&quot;json-file&quot;</span><span class="punctuation">,</span> # log-driver ä¹Ÿå¯ä»¥é…ç½®ä¸º journaldã€syslogã€none ç­‰ã€‚é»˜è®¤ä¸º json-file</span><br><span class="line">  <span class="attr">&quot;log-opts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;max-size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;100m&quot;</span><span class="punctuation">,</span>     #  æ—¥å¿—æ–‡ä»¶å¤§å°</span><br><span class="line">    <span class="attr">&quot;max-file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5&quot;</span>         #  æ—¥å¿—æ–‡ä»¶æ•°é‡</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é»˜è®¤ç½‘æ¡¥ç½‘æ®µé…ç½®ï¼ˆé¿å…å’Œå®¿ä¸»æœºç½‘æ®µå†²çªï¼‰</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;bridge&quot;</span><span class="punctuation">:</span> <span class="string">&quot;docker0&quot;</span><span class="punctuation">,</span>       # è®¾ç½®é»˜è®¤ç½‘æ¡¥åç§°ï¼Œé»˜è®¤docker0</span><br><span class="line">  <span class="attr">&quot;bip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;192.168.100.1/24&quot;</span><span class="punctuation">,</span>  #  é»˜è®¤<span class="number">172.17</span><span class="number">.0</span><span class="number">.1</span>/<span class="number">16</span></span><br><span class="line">  <span class="attr">&quot;fixed-cidr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;192.168.100.0/24&quot;</span> # è®¾ç½®å®¹å™¨IPåœ°å€æ®µ</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é»˜è®¤ ulimit é™åˆ¶æå‡</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;default-ulimits&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>   # é»˜è®¤ulimité™åˆ¶</span><br><span class="line">    <span class="attr">&quot;nofile&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nofile&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Hard&quot;</span><span class="punctuation">:</span> <span class="number">65535</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Soft&quot;</span><span class="punctuation">:</span> <span class="number">65535</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¹¶å‘è¿æ¥ä¼˜åŒ–</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;max-concurrent-downloads&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> # å¹¶å‘ä¸‹è½½æ•°é‡</span><br><span class="line">  <span class="attr">&quot;max-concurrent-uploads&quot;</span><span class="punctuation">:</span> <span class="number">5</span>     # å¹¶å‘ä¸Šä¼ æ•°é‡</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>DNSé…ç½®ï¼ˆæœ‰äº›å…¬å¸å†…ç½‘éœ€è¦ï¼‰</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dns&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;8.8.8.8&quot;</span><span class="punctuation">,</span> <span class="string">&quot;114.114.114.114&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç§æœ‰ä»“åº“å…è®¤è¯é…ç½® (ä¸å»ºè®®ç”Ÿäº§ç”¨)</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;insecure-registries&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;registry.example.com:5000&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é‡å¯Dockeråæ¢å¤å®¹å™¨ï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨å®¹å™¨çš„<code>restart</code>å‚æ•°</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;live-restore&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span>  # å½“è®¾ç½®ä¸º<span class="literal"><span class="keyword">true</span></span>æ—¶ï¼ŒDockerä¼šåœ¨å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨æ—¶å°è¯•é‡å¯æ‰€æœ‰ä¹‹å‰è¿è¡Œä¸­çš„å®¹å™¨ï¼Œé»˜è®¤ä¸º<span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Linux ä¸‹çš„ Docker å®‰è£…æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;windowsã€macosã€ubuntuç­‰æ¡Œé¢ç³»ç»Ÿè¯·å®‰è£… &lt;a href=&quot;https://www.docker.com/products/docker-desktop/&quot;&gt;Docker Desktop&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;é˜¿é‡Œäº‘ä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼š&lt;a href=&quot;https://help.aliyun.com/zh/ecs/use-cases/install-and-use-docker&quot;&gt;é˜¿é‡Œäº‘ä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;è…¾è®¯äº‘ä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼š&lt;a href=&quot;https://cloud.tencent.com/document/product/1207/45596&quot;&gt;è…¾è®¯äº‘ä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;AWSä¸“æœ‰æœåŠ¡å™¨å‚è€ƒï¼š&lt;a href=&quot;/2025/05/19/docker-install-aws/&quot; title=&quot;AWSä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker&quot;&gt;AWSä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com&quot;&gt;Dockerå®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/engine/install/&quot;&gt;å®‰è£…Docker Engine&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>AWSä¸“æœ‰æœåŠ¡å™¨å¦‚ä½•å®‰è£…Docker</title>
    <link href="https://blog.hanqunfeng.com/2025/05/19/docker-install-aws/"/>
    <id>https://blog.hanqunfeng.com/2025/05/19/docker-install-aws/</id>
    <published>2025-05-19T13:30:05.000Z</published>
    <updated>2025-06-05T09:08:14.574Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ AWS ä¸“æœ‰æœåŠ¡å™¨ä¸Šå®‰è£… Docker</p></li></ul><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Update and install Docker</span></span><br><span class="line"><span class="built_in">sudo</span> yum update -y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Amazon Linux 2</span></span><br><span class="line"><span class="built_in">sudo</span> amazon-linux-extras install docker -y</span><br><span class="line"><span class="comment"># Amazon Linux 2023</span></span><br><span class="line"><span class="built_in">sudo</span> yum install docker -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Docker Composeï¼Œæ³¨æ„é€šè¿‡è¿™ç§æ–¹å¼å®‰è£…çš„composeçš„ä½¿ç”¨æ–¹å¼ä¸º `docker-compose`ï¼Œè€Œéæ ‡å‡†çš„ `docker compose`</span></span><br><span class="line"><span class="built_in">sudo</span> curl -L <span class="string">&quot;https://github.com/docker/compose/releases/latest/download/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Make the docker-compose command available</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable Docker service</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="comment"># Start the service</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start docker</span><br><span class="line"><span class="comment"># Add the current user to the docker group</span></span><br><span class="line"><span class="built_in">sudo</span> usermod -aG docker ec2-user</span><br><span class="line"><span class="comment"># è®©ç»„æƒé™ç«‹å³ç”Ÿæ•ˆæœ€ç¨³å¦¥çš„åšæ³•æ˜¯ï¼šæ³¨é”€å¹¶é‡æ–°ç™»å½•è¿œç¨‹ä¸»æœºï¼Œä½†ä¹Ÿå¯ä»¥å°è¯•ç”¨ä¸‹é¢å‘½ä»¤ç«‹å³åŠ è½½æ–°ç»„</span></span><br><span class="line">newgrp docker</span><br><span class="line"><span class="comment"># Check Docker version</span></span><br><span class="line">docker version</span><br><span class="line"><span class="comment"># Test Docker</span></span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ AWS ä¸“æœ‰æœåŠ¡å™¨ä¸Šå®‰è£… Docker&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/docker/"/>
    
    
    <category term="docker" scheme="https://blog.hanqunfeng.com/tags/docker/"/>
    
  </entry>
  
</feed>
