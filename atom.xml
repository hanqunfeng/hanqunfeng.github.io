<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£˜é€¸å³°çš„åšå®¢</title>
  
  <subtitle>Spring--Javaç¨‹åºå‘˜çš„æ˜¥å¤©</subtitle>
  <link href="https://blog.hanqunfeng.com/atom.xml" rel="self"/>
  
  <link href="https://blog.hanqunfeng.com/"/>
  <updated>2025-09-15T09:55:25.485Z</updated>
  <id>https://blog.hanqunfeng.com/</id>
  
  <author>
    <name>é£˜é€¸å³°</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Zookeeper çš„å®‰è£…åŠä½¿ç”¨</title>
    <link href="https://blog.hanqunfeng.com/2025/09/15/zookeeper-study/"/>
    <id>https://blog.hanqunfeng.com/2025/09/15/zookeeper-study/</id>
    <published>2025-09-15T13:30:05.000Z</published>
    <updated>2025-09-15T09:55:25.485Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» CentOS8 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://zookeeper.apache.org">Zookeeperå®˜ç½‘</a></p></li></ul><span id="more"></span><h2 id="Zookeeper-ç®€ä»‹">Zookeeper ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ZooKeeper æ˜¯ä¸€ä¸ªé›†ä¸­å¼æœåŠ¡ï¼Œç”¨äºï¼š</p><ul class="lvl-2"><li class="lvl-4">ç»´æŠ¤é…ç½®ä¿¡æ¯</li><li class="lvl-4">æä¾›å‘½åæœåŠ¡</li><li class="lvl-4">å®ç°åˆ†å¸ƒå¼åŒæ­¥</li><li class="lvl-4">æä¾›é›†ç¾¤ç®¡ç†æœåŠ¡</li></ul></li><li class="lvl-2"><p>ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ª ZNodeã€‚</p></li><li class="lvl-2"><p>ä¸åŒäºæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä¿å­˜æ•°æ®ï¼Œæ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ 1MB çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬(version)ï¼Œç‰ˆæœ¬ä»0å¼€å§‹è®¡æ•°ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/QgdBSR.png" alt=""></p></li></ul><h2 id="Zookeeper-å®‰è£…">Zookeeper å®‰è£…</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œ Zookeeper éœ€è¦å®‰è£… JDK1.8+ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ <a href="https://mirrors.tuna.tsinghua.edu.cn/Adoptium/">OpenJDK11</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /usr/local/jdk</span><br><span class="line"><span class="built_in">cd</span> /usr/local/jdk</span><br><span class="line"><span class="built_in">sudo</span> wget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s jdk-11.0.28+6 jdk11</span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">vim /etc/profile <span class="comment"># æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class="line">  <span class="built_in">export</span> JAVA_HOME=/usr/local/jdk/jdk11</span><br><span class="line">  <span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># æŸ¥çœ‹javaç‰ˆæœ¬</span></span><br><span class="line">java -version</span><br><span class="line">openjdk version <span class="string">&quot;11.0.28&quot;</span> 2025-07-15</span><br><span class="line">OpenJDK Runtime Environment Temurin-11.0.28+6 (build 11.0.28+6)</span><br><span class="line">OpenJDK 64-Bit Server VM Temurin-11.0.28+6 (build 11.0.28+6, mixed mode)</span><br></pre></td></tr></table></figure><h3 id="å•æœºå®‰è£…">å•æœºå®‰è£…</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://zookeeper.apache.org/releases.html">ä¸‹è½½ Zookeeper</a>ï¼Œç›®å‰æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ä¸º <code>3.8.4</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½</span></span><br><span class="line">wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz</span><br><span class="line"><span class="comment"># è§£å‹</span></span><br><span class="line">tar -zxvf apache-zookeeper-3.8.4-bin.tar.gz</span><br><span class="line"><span class="comment"># é…ç½®ä¸ªè½¯è¿æ¥ï¼Œæ–¹ä¾¿ä»¥åå‡çº§</span></span><br><span class="line"><span class="built_in">ln</span> -s apache-zookeeper-3.8.4-bin zookeeper</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> zookeeper/conf</span><br><span class="line"><span class="built_in">cp</span> zoo_sample.cfg zoo.cfg</span><br><span class="line"><span class="comment"># å»ºè®®ä¿®æ”¹ zoo.cfg é…ç½®æ–‡ä»¶ï¼Œå°† dataDir=/tmp/zookeeper ä¿®æ”¹ä¸ºæŒ‡å®šçš„dataç›®å½•</span></span><br><span class="line">vim zoo.cfg</span><br></pre></td></tr></table></figure><blockquote><p>zoo.cfg å‚æ•°è¯´æ˜</p></blockquote><table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th><th>å•ä½ / å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>tickTime</strong></td><td>ZooKeeper æ—¶é—´é…ç½®ä¸­çš„åŸºæœ¬å•ä½</td><td>2000</td><td>æ¯«ç§’</td></tr><tr><td><strong>initLimit</strong></td><td>follower åˆå§‹åŒ–è¿æ¥åˆ° leader çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•°</td><td>10</td><td>10 Ã— tickTime = 20000 ms</td></tr><tr><td><strong>syncLimit</strong></td><td>follower ä¸ leader æ•°æ®åŒæ­¥çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•°</td><td>5</td><td>5 Ã— tickTime = 10000 ms</td></tr><tr><td><strong>dataDir</strong></td><td>æ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•ï¼ˆæœªæŒ‡å®š dataLogDir æ—¶ï¼Œæ—¥å¿—ä¹Ÿä¼šä¿å­˜åœ¨æ­¤ç›®å½•ï¼‰</td><td>/tmp/zookeeper</td><td>ç›®å½•è·¯å¾„</td></tr><tr><td><strong>clientPort</strong></td><td>å®¢æˆ·ç«¯è¿æ¥ ZooKeeper çš„ç«¯å£å·</td><td>2181</td><td>é»˜è®¤ 2181</td></tr><tr><td><strong>maxClientCnxns</strong></td><td>å•ä¸ªå®¢æˆ·ç«¯æœ€å¤§å¹¶å‘è¿æ¥æ•°</td><td>60</td><td>è¶…è¿‡é™åˆ¶åæ–°è¿æ¥ä¼šè¢«æ‹’ç»</td></tr><tr><td><strong>autopurge.snapRetainCount</strong></td><td>å¿«ç…§æ–‡ä»¶ä¿ç•™ä¸ªæ•°ï¼Œè¶…è¿‡æ•°é‡çš„å°†ä¼šè¢«æ¸…ç†</td><td>3</td><td>é»˜è®¤ 3</td></tr><tr><td><strong>autopurge.purgeInterval</strong></td><td>æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš”æ—¶é—´ï¼Œå•ä½å°æ—¶ï¼Œ0 è¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†</td><td>1</td><td>1 å°æ—¶</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ zookeeper</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> zookeeper</span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">bin/zkServer.sh start</span><br><span class="line"><span class="comment"># æŒ‡å®šé…ç½®æ–‡ä»¶</span></span><br><span class="line">bin/zkServer.sh start conf/zoo.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">bin/zkServer.sh stop</span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">bin/zkServer.sh status</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line">./bin/zkServer.sh version</span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤å®‰è£…">é›†ç¾¤å®‰è£…</h3><h4 id="ZooKeeper-é›†ç¾¤è§’è‰²">ZooKeeper é›†ç¾¤è§’è‰²</h4><h5 id="1-Leaderï¼ˆé¢†å¯¼è€…ï¼‰">1. Leaderï¼ˆé¢†å¯¼è€…ï¼‰</h5><ul class="lvl-0"><li class="lvl-2"><p><strong>èŒè´£ï¼š</strong></p><ul class="lvl-2"><li class="lvl-4">äº‹åŠ¡è¯·æ±‚ï¼ˆå†™æ“ä½œï¼‰çš„å”¯ä¸€è°ƒåº¦è€…å’Œå¤„ç†è€…ï¼Œä¿è¯é›†ç¾¤äº‹åŠ¡å¤„ç†çš„é¡ºåºæ€§ï¼›</li><li class="lvl-4">é›†ç¾¤å†…éƒ¨å„ä¸ªæœåŠ¡å™¨çš„è°ƒåº¦è€…ï¼›</li><li class="lvl-4">å¯¹äº <code>create</code>ã€<code>setData</code>ã€<code>delete</code> ç­‰å†™æ“ä½œè¯·æ±‚ï¼Œç»Ÿä¸€è½¬å‘ç»™ Leader å¤„ç†ï¼›</li><li class="lvl-4">Leader è´Ÿè´£å†³å®šç¼–å·ã€æ‰§è¡Œæ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º <strong>äº‹åŠ¡</strong>ã€‚</li></ul></li></ul><ul class="lvl-0"><li class="lvl-2"><p>ä¸‰å°è™šæ‹Ÿæœº zoo.cfg æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é€‰ä¸¾å‡º Leader è§’è‰²ï¼Œåˆ™å…¶ä½™å°±æ˜¯ Follower è§’è‰²ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.1=10.250.0.229:2888:3888</span><br><span class="line">server.2=10.250.0.152:2888:3888</span><br><span class="line">server.3=10.250.0.36:2888:3888</span><br></pre></td></tr></table></figure><h5 id="2-Followerï¼ˆè·Ÿéšè€…ï¼‰">2. Followerï¼ˆè·Ÿéšè€…ï¼‰</h5><ul class="lvl-0"><li class="lvl-2"><p><strong>èŒè´£ï¼š</strong></p><ul class="lvl-2"><li class="lvl-4">å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡ï¼ˆè¯»æ“ä½œï¼‰è¯·æ±‚ï¼ˆå¯ä»¥ç›´æ¥å“åº”ï¼‰ï¼›</li><li class="lvl-4">è½¬å‘äº‹åŠ¡è¯·æ±‚ç»™ Leaderï¼›</li><li class="lvl-4">å‚ä¸é›†ç¾¤ Leader é€‰ä¸¾æŠ•ç¥¨ã€‚</li></ul></li></ul><blockquote><p>leaderèŠ‚ç‚¹å¯ä»¥å¤„ç†è¯»å†™è¯·æ±‚ï¼Œfolloweråªå¯ä»¥å¤„ç†è¯»è¯·æ±‚ã€‚followeråœ¨æ¥åˆ°å†™è¯·æ±‚æ—¶ä¼šæŠŠå†™è¯·æ±‚è½¬å‘ç»™leaderæ¥å¤„ç†ã€‚</p></blockquote><h5 id="3-Observerï¼ˆè§‚å¯Ÿè€…ï¼‰">3. Observerï¼ˆè§‚å¯Ÿè€…ï¼‰</h5><ul class="lvl-0"><li class="lvl-2"><p><strong>èŒè´£ï¼š</strong></p><ul class="lvl-2"><li class="lvl-4">å¯¹äºéäº‹åŠ¡è¯·æ±‚ï¼ˆè¯»æ“ä½œï¼‰å¯ä»¥ç‹¬ç«‹å¤„ç†ï¼›</li><li class="lvl-4">å¯¹äºäº‹åŠ¡è¯·æ±‚ä¼šè½¬å‘ç»™ Leader å¤„ç†ï¼›</li><li class="lvl-4">æ¥æ”¶æ¥è‡ª Leader çš„ <code>inform</code> ä¿¡æ¯ï¼Œæ›´æ–°æœ¬åœ°å­˜å‚¨ï¼›</li><li class="lvl-4">ä¸å‚ä¸æäº¤å’Œé€‰ä¸¾æŠ•ç¥¨ï¼›</li><li class="lvl-4">é€šå¸¸ç”¨äº <strong>æå‡é›†ç¾¤éäº‹åŠ¡å¤„ç†èƒ½åŠ›</strong>ï¼Œä¸å½±å“é›†ç¾¤äº‹åŠ¡å¤„ç†æ€§èƒ½ã€‚</li></ul></li></ul><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®ä¸€ä¸ª ID ä¸º 4 çš„è§‚å¯Ÿè€…èŠ‚ç‚¹ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.4=10.250.0.56:2888:3888:observer</span><br></pre></td></tr></table></figure><h4 id="é›†ç¾¤æ­å»º">é›†ç¾¤æ­å»º</h4><ul class="lvl-0"><li class="lvl-2"><p>ç¯å¢ƒå‡†å¤‡ï¼š4å°æœåŠ¡å™¨ï¼ŒæŒ‰ç…§ <code>å•æœºå®‰è£…</code> çš„æ–¹å¼å‡†å¤‡å¥½ Zookeeper ç¯å¢ƒ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">10.250.0.229</span><br><span class="line">10.250.0.152</span><br><span class="line">10.250.0.36</span><br><span class="line">10.250.0.56</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>zoo.cfg</code> æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server.1=10.250.0.229:2888:3888</span><br><span class="line">server.2=10.250.0.152:2888:3888</span><br><span class="line">server.3=10.250.0.36:2888:3888</span><br><span class="line">server.4=10.250.0.56:2888:3888:observer</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åˆ«åœ¨ <code>dataDir</code> ç›®å½•ä¸‹åˆ›å»º <code>myid</code> æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸ server å¯¹åº”çš„ç¼–å·ï¼ˆæ³¨æ„ï¼šä¸Šä¸‹ä¸è¦æœ‰ç©ºè¡Œï¼Œå·¦å³ä¸è¦æœ‰ç©ºæ ¼ï¼‰</p></li><li class="lvl-2"><p>åˆ†åˆ«å¯åŠ¨ Zookeeper æœåŠ¡å™¨</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†åˆ«å¯åŠ¨4ä¸ªèŠ‚ç‚¹çš„zookeeper server</span></span><br><span class="line">bin/zkServer.sh start</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°èŠ‚ç‚¹è§’è‰²ç±»å‹</span></span><br><span class="line">bin/zkServer.sh status</span><br></pre></td></tr></table></figure><h2 id="ZooKeeper-é»˜è®¤ç«¯å£è¯´æ˜">ZooKeeper é»˜è®¤ç«¯å£è¯´æ˜</h2><table><thead><tr><th>ç«¯å£</th><th>ç”¨é€”</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>2181</td><td>å®¢æˆ·ç«¯è¿æ¥ç«¯å£</td><td>å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªç«¯å£è®¿é—® ZooKeeper</td></tr><tr><td>2888</td><td>é›†ç¾¤å†…éƒ¨é€šä¿¡</td><td>follower ä¸ leader ä¹‹é—´åŒæ­¥æ•°æ®</td></tr><tr><td>3888</td><td>leader é€‰ä¸¾ç«¯å£</td><td>é›†ç¾¤é€‰ä¸¾ leader ä½¿ç”¨</td></tr><tr><td>8080 (å¯é€‰)</td><td>admin/metrics webç«¯å£</td><td>å¦‚æœå¼€å¯äº† adminServer</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ°¸ä¹…å¼€å¯ç«¯å£</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=2181/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=2888/tcp</span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=3888/tcp</span><br><span class="line"><span class="comment"># å¦‚æœä½¿ç”¨ adminServer</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --permanent --add-port=8080/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½®</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦å¼€æ”¾æˆåŠŸ</span></span><br><span class="line"><span class="built_in">sudo</span> firewall-cmd --list-all</span><br></pre></td></tr></table></figure><h2 id="å®¢æˆ·ç«¯è¿æ¥">å®¢æˆ·ç«¯è¿æ¥</h2><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤è¿æ¥ 127.0.0.1:2181</span></span><br><span class="line">bin/zkCli.sh</span><br><span class="line"><span class="comment"># æŒ‡å®š -server ip:portï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œåˆ™è¿æ¥ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒZooKeeper ä¼šè‡ªåŠ¨å¤„ç†ä¸ Leader/Follower çš„äº¤äº’</span></span><br><span class="line">bin/zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure><blockquote><p>å®¢æˆ·ç«¯å‘½ä»¤ç®€ä»‹ï¼š<a href="https://zookeeper.apache.org/doc/r3.8.4/zookeeperCLI.html">å‚è€ƒå®˜ç½‘</a></p></blockquote><table><thead><tr><th>å‘½ä»¤</th><th>è¯­æ³•ç¤ºä¾‹</th><th>åŠŸèƒ½æè¿°</th><th>å¸¸ç”¨å‚æ•°åŠè¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>help</strong></td><td><code>help</code></td><td>æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤</td><td>æ— </td><td><code>help</code></td></tr><tr><td><strong>quit</strong></td><td><code>quit</code></td><td>é€€å‡ºå®¢æˆ·ç«¯</td><td>æ— </td><td><code>quit</code></td></tr><tr><td><strong>ls</strong></td><td><code>ls [-s] [-w] [-R] path</code></td><td>æŸ¥çœ‹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</td><td>- <code>-w</code>: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–<br>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-R</code>: é€’å½’æŸ¥çœ‹</td><td><code>ls -s -w /zk_test</code></td></tr><tr><td><strong>create</strong></td><td><code>create [-s] [-e] [-c] [-t ttl] path [data] [acl]</code></td><td>åˆ›å»ºèŠ‚ç‚¹</td><td>- <code>-s</code>: é¡ºåºèŠ‚ç‚¹<br>- <code>-e</code>: ä¸´æ—¶èŠ‚ç‚¹<br>- <code>-c</code>: å®¹å™¨èŠ‚ç‚¹<br>- <code>-t ttl</code>: TTLèŠ‚ç‚¹ï¼Œå•ä½æ¯«ç§’</td><td><code>create -e /zk_test_ephemeral &quot;temp_data&quot;</code></td></tr><tr><td><strong>get</strong></td><td><code>get [-s] [-w] path</code></td><td>è·å–èŠ‚ç‚¹æ•°æ®ä¿¡æ¯</td><td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-w</code>: ç›‘å¬èŠ‚ç‚¹å˜åŒ–</td><td><code>get -s -w /zk_test</code></td></tr><tr><td><strong>set</strong></td><td><code>set [-s] [-v version] path data</code></td><td>è®¾ç½®èŠ‚ç‚¹æ•°æ®</td><td>- <code>-s</code>: é¡ºåºèŠ‚ç‚¹<br>- <code>-v</code>: æŒ‡å®šç‰ˆæœ¬å·</td><td><code>set /zk_test &quot;new_data&quot;</code></td></tr><tr><td><strong>getAcl</strong></td><td><code>getAcl [-s] path</code></td><td>è·å–èŠ‚ç‚¹è®¿é—®æ§åˆ¶ä¿¡æ¯</td><td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</td><td><code>getAcl /zk_test</code></td></tr><tr><td><strong>setAcl</strong></td><td><code>setAcl [-s] [-v version] [-R] path acl</code></td><td>è®¾ç½®èŠ‚ç‚¹è®¿é—®æ§åˆ¶åˆ—è¡¨</td><td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-v</code>: æŒ‡å®šç‰ˆæœ¬å·<br>- <code>-R</code>: é€’å½’è®¾ç½®</td><td><code>setAcl /zk_test world:anyone:r</code></td></tr><tr><td><strong>stat</strong></td><td><code>stat [-w] path</code></td><td>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</td><td>- <code>-w</code>: ç›‘å¬èŠ‚ç‚¹å˜åŒ–</td><td><code>stat -w /zk_test</code></td></tr><tr><td><strong>delete</strong></td><td><code>delete [-v version] path</code></td><td>åˆ é™¤æŸä¸€èŠ‚ç‚¹ï¼ˆæ— å­èŠ‚ç‚¹ï¼‰</td><td>- <code>-v</code>: èŠ‚ç‚¹ç‰ˆæœ¬å·</td><td><code>delete /zk_test</code></td></tr><tr><td><strong>deleteall</strong></td><td><code>deleteall path</code></td><td>é€’å½’åˆ é™¤æŸä¸€èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹</td><td>æ— </td><td><code>deleteall /zk_test</code></td></tr><tr><td><strong>setquota</strong></td><td><code>setquota [-n] [-b] val path</code></td><td>å¯¹èŠ‚ç‚¹å¢åŠ é™åˆ¶</td><td>- <code>-n</code>: å­èŠ‚ç‚¹æœ€å¤§ä¸ªæ•°<br>- <code>-b</code>: æ•°æ®å€¼æœ€å¤§é•¿åº¦ï¼Œ-1 è¡¨ç¤ºæ— é™åˆ¶</td><td><code>setquota -n 5 /zk_test</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>GUI å·¥å…·</p></li></ul><table><thead><tr><th>åç§°</th><th>ç±»å‹ / è¿è¡Œæ–¹å¼</th><th>ä¼˜ç‚¹</th><th>æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td><strong>PrettyZoo</strong></td><td>æ¡Œé¢åº”ç”¨ï¼ˆJavaFXï¼‰(<a href="https://github.com/vran-dev/PrettyZoo" title="vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...">GitHub</a>)</td><td>æ”¯æŒ Mac/Windows/Linuxï¼Œç•Œé¢å‹å¥½ï¼›æ”¯æŒèŠ‚ç‚¹åˆ›å»º/åˆ é™¤/æ›´æ–°/æŸ¥è¯¢ï¼ŒACL ç®¡ç†ï¼Œå¤š ZK å®ä¾‹ç®¡ç†ï¼ŒSSH éš§é“ç­‰åŠŸèƒ½ã€‚(<a href="https://github.com/vran-dev/PrettyZoo" title="vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...">GitHub</a>)</td><td>é¡¹ç›®å·²ç» archivedï¼Œç»´æŠ¤å¯èƒ½ä¸æ´»è·ƒã€‚æœ€æ–°ç‰ˆå¯èƒ½åœ¨å…¼å®¹æ€§æˆ– Bug ä¿®å¤æ–¹é¢ä¸å¦‚æ´»è·ƒé¡¹ç›®ã€‚ä¹Ÿå¯èƒ½éœ€è¦è‡ªå·±æ„å»ºæˆ–è°ƒè¯•ã€‚(<a href="https://github.com/vran-dev/PrettyZoo" title="vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...">GitHub</a>)</td></tr><tr><td><strong>ZooNavigator</strong></td><td>Web ç•Œé¢ + å¯ Docker éƒ¨ç½²æˆ–æœ¬åœ°å¯åŠ¨(<a href="https://github.com/elkozmon/zoonavigator" title="elkozmon/zoonavigator: Web-based ZooKeeper UI">GitHub</a>)</td><td>åŠŸèƒ½ä¸°å¯Œï¼›æ”¯æŒå¤šä¸ª Zookeeper ç‰ˆæœ¬ï¼ˆå¦‚ 3.5.x ï½ 3.9.xï¼‰ï¼›æµè§ˆ / ç¼–è¾‘ /æœç´¢èŠ‚ç‚¹ï¼›å¯¼å…¥å¯¼å‡ºé…ç½®ï¼›æ”¯æŒæµè§ˆå™¨è®¿é—®ï¼Œæ— éœ€æœ¬åœ° heavy GUIã€‚(<a href="https://github.com/elkozmon/zoonavigator" title="elkozmon/zoonavigator: Web-based ZooKeeper UI">GitHub</a>)</td><td>å› ä¸º Web åº”ç”¨ï¼Œå¯èƒ½å¯¹æµè§ˆå™¨å®‰å…¨ç­–ç•¥ä¸ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿï¼›éœ€è¦éƒ¨ç½²è‡ªå·±ç‰ˆæœ¬æˆ– Dockerï¼›å¦‚æœè¦æ±‚æœ¬åœ°è„±æœºæ“ä½œæ—¶ï¼Œæœ‰äº›åŠŸèƒ½å¯èƒ½ç¨ä¸å¦‚æ¡Œé¢åº”ç”¨ã€‚</td></tr><tr><td><strong>ZooKeeper Assistant</strong></td><td>æ¡Œé¢ï¼ç®¡ç†å‘˜é¢æ¿ç±»å‹ï¼ˆæ”¯æŒç›‘æ§ç•Œé¢ç­‰ï¼‰(<a href="https://dev.to/redisant/an-exciting-apache-zookeeper-desktop-gui-1fdo" title="An exciting Apache ZooKeeper Desktop GUI">DEV Community</a>)</td><td>é™¤äº†æµè§ˆèŠ‚ç‚¹æ ‘ä»¥å¤–ï¼Œè¿˜æä¾›å¥åº·çŠ¶æ€ç›‘æ§ï¼ˆå»¶è¿Ÿã€è¯·æ±‚æ•°ç­‰ï¼‰ã€ä¸åŒæ•°æ®æ ¼å¼æ”¯æŒï¼ˆJSON/XML ç­‰ï¼‰ã€å¯¼å…¥/å¯¼å‡ºèŠ‚ç‚¹æ•°æ®ã€å‘½ä»¤è¡Œæ“ä½œé›†æˆã€‚(<a href="https://dev.to/redisant/an-exciting-apache-zookeeper-desktop-gui-1fdo" title="An exciting Apache ZooKeeper Desktop GUI">DEV Community</a>)</td><td>æœ‰äº›åŠŸèƒ½å¯èƒ½åœ¨ Mac ä¸Šå…¼å®¹æ€§æˆ–è§†è§‰ä½“éªŒéœ€è¦è°ƒè¯•ï¼›å…·ä½“ç‰ˆæœ¬æ”¯æŒæƒ…å†µè¦çœ‹æœ€è¿‘æ›´æ–°ã€‚æŸäº›ç›‘æ§ç•Œé¢å¯èƒ½ä¾èµ–äº ZK çš„æŒ‡æ ‡æˆ–æ’ä»¶ã€‚</td></tr></tbody></table><h2 id="Zookeeper-èŠ‚ç‚¹ç±»å‹">Zookeeper èŠ‚ç‚¹ç±»å‹</h2><table><thead><tr><th>èŠ‚ç‚¹ç±»å‹</th><th>ç”Ÿå‘½å‘¨æœŸè¯´æ˜</th><th>åˆ›å»ºå‘½ä»¤ç¤ºä¾‹</th><th>ç‰¹ç‚¹è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æŒä¹…èŠ‚ç‚¹</strong> (Persistent)</td><td>èŠ‚ç‚¹ä¸€ç›´å­˜åœ¨ï¼Œé™¤éæ‰‹åŠ¨åˆ é™¤ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ŒèŠ‚ç‚¹ä¹Ÿä¸ä¼šæ¶ˆå¤±</td><td><code>create /locks</code></td><td>é€‚åˆå­˜å‚¨é…ç½®ä¿¡æ¯ã€å…ƒæ•°æ®ç­‰æŒä¹…æ•°æ®</td></tr><tr><td><strong>ä¸´æ—¶èŠ‚ç‚¹</strong> (Ephemeral)</td><td>å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ˆå¼‚å¸¸æˆ–è¶…æ—¶ï¼‰æ—¶ï¼ŒèŠ‚ç‚¹è‡ªåŠ¨è¢«åˆ é™¤</td><td><code>create -e /locks/DBLock</code></td><td>å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€ä¸´æ—¶ä¼šè¯æ•°æ®</td></tr><tr><td><strong>æœ‰åºèŠ‚ç‚¹</strong> (Sequential)</td><td>åœ¨æŒä¹…æˆ–ä¸´æ—¶èŠ‚ç‚¹åŸºç¡€ä¸Šï¼Œå¢åŠ æœ‰åºç¼–å·ï¼ŒZooKeeper è‡ªåŠ¨åœ¨èŠ‚ç‚¹åååŠ é€’å¢åºå·</td><td><code>create -e -s /jobs/job</code></td><td>å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€é˜Ÿåˆ—ç­‰éœ€è¦é¡ºåºçš„åœºæ™¯</td></tr><tr><td><strong>å®¹å™¨èŠ‚ç‚¹</strong> (Container)</td><td>V3.5.3+ï¼Œå½“å®¹å™¨èŠ‚ç‚¹ä¸‹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œå®¹å™¨èŠ‚ç‚¹ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤</td><td><code>create -c /work</code></td><td>é€‚åˆåˆ†å¸ƒå¼ä»»åŠ¡ä¸´æ—¶ç›®å½•ã€åŠ¨æ€æ•°æ®ç›®å½•</td></tr><tr><td><strong>TTL èŠ‚ç‚¹</strong> (TTL)</td><td>åœ¨æŒ‡å®š TTL æ—¶é—´å†…æœªä¿®æ”¹ä¸”æ— å­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆéœ€å¼€å¯ <code>extendedTypesEnabled=true</code> é…ç½®ï¼‰</td><td><code>create -t 3000 /ttl_node</code></td><td>é€‚åˆä¸´æ—¶ç¼“å­˜ã€ä¸´æ—¶çŠ¶æ€æ•°æ®ï¼Œè¿‡æœŸè‡ªåŠ¨æ¸…ç†</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ³¨æ„</p><ul class="lvl-2"><li class="lvl-4">åŒä¸€çº§èŠ‚ç‚¹ key åç§°æ˜¯å”¯ä¸€çš„</li><li class="lvl-4">åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå¿…é¡»è¦å¸¦ä¸Šå…¨è·¯å¾„</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» CentOS8 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://zookeeper.apache.org&quot;&gt;Zookeeperå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="zookeeper" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/zookeeper/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/zookeeper/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="zookeeper" scheme="https://blog.hanqunfeng.com/tags/zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>ShardingSphere-Proxy5.5.2 DistSQL</title>
    <link href="https://blog.hanqunfeng.com/2025/09/11/springboot3-shardingsphere-proxy-distsql/"/>
    <id>https://blog.hanqunfeng.com/2025/09/11/springboot3-shardingsphere-proxy-distsql/</id>
    <published>2025-09-11T13:30:05.000Z</published>
    <updated>2025-09-15T02:14:23.413Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» ShardingSphere-Proxy5.5.2 DistSQL çš„ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/index_zh.html">ShardingSphereå®˜ç½‘</a></p></li></ul><span id="more"></span><h2 id="DistSQL">DistSQL</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/">DistSQL</a>ï¼ˆDistributed SQLï¼‰æ˜¯ Apache ShardingSphere ç‰¹æœ‰çš„æ“ä½œè¯­è¨€ã€‚ å®ƒä¸æ ‡å‡† SQL çš„ä½¿ç”¨æ–¹å¼å®Œå…¨ä¸€è‡´ï¼Œç”¨äºæä¾›å¢é‡åŠŸèƒ½çš„ SQL çº§åˆ«æ“ä½œèƒ½åŠ›ã€‚</p></li><li class="lvl-2"><p>çµæ´»çš„è§„åˆ™é…ç½®å’Œèµ„æºç®¡æ§èƒ½åŠ›æ˜¯ Apache ShardingSphere çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚</p></li><li class="lvl-2"><p>åœ¨ä½¿ç”¨ 4.x åŠå…¶ä¹‹å‰ç‰ˆæœ¬æ—¶ï¼Œå¼€å‘è€…è™½ç„¶å¯ä»¥åƒä½¿ç”¨åŸç”Ÿæ•°æ®åº“ä¸€æ ·æ“ä½œæ•°æ®ï¼Œä½†å´éœ€è¦é€šè¿‡æœ¬åœ°æ–‡ä»¶æˆ–æ³¨å†Œä¸­å¿ƒé…ç½®èµ„æºå’Œè§„åˆ™ã€‚ç„¶è€Œï¼Œæ“ä½œä¹ æƒ¯å˜æ›´ï¼Œå¯¹äºè¿ç»´å·¥ç¨‹å¸ˆå¹¶ä¸å‹å¥½ã€‚</p></li><li class="lvl-2"><p>ä» 5.x ç‰ˆæœ¬å¼€å§‹ï¼ŒDistSQLï¼ˆDistributed SQLï¼‰è®©ç”¨æˆ·å¯ä»¥åƒæ“ä½œæ•°æ®åº“ä¸€æ ·æ“ä½œ Apache ShardingSphereï¼Œä½¿å…¶ä»é¢å‘å¼€å‘äººå‘˜çš„æ¡†æ¶å’Œä¸­é—´ä»¶è½¬å˜ä¸ºé¢å‘è¿ç»´äººå‘˜çš„æ•°æ®åº“äº§å“ã€‚</p></li><li class="lvl-2"><p>DistSQL ç»†åˆ†ä¸º RDLã€RQLã€RAL å’Œ RUL å››ç§ç±»å‹ã€‚</p><ul class="lvl-2"><li class="lvl-4">RDL: Resource &amp; Rule Definition Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤ã€‚</li><li class="lvl-4">RQL: Resource &amp; Rule Query Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„æŸ¥è¯¢å’Œå±•ç°ã€‚</li><li class="lvl-4">RAL: Resource &amp; Rule Administration Languageï¼Œè´Ÿè´£å¼ºåˆ¶è·¯ç”±ã€ç†”æ–­ã€é…ç½®å¯¼å…¥å¯¼å‡ºã€æ•°æ®è¿ç§»æ§åˆ¶ç­‰ç®¡ç†åŠŸèƒ½ã€‚</li><li class="lvl-4">RUL: Resource &amp; Rule Utility Languageï¼Œè´Ÿè´£ SQL è§£æã€SQL æ ¼å¼åŒ–ã€æ‰§è¡Œè®¡åˆ’é¢„è§ˆç­‰åŠŸèƒ½ã€‚</li></ul></li><li class="lvl-2"><p>DistSQL ä»…å¯ä»¥åœ¨ ShardingSphere-Proxy ä¸­ä½¿ç”¨ï¼Œä¸èƒ½åœ¨ ShardingSphere-JDBC ä¸­ä½¿ç”¨ã€‚</p></li></ul><h2 id="ç¤ºä¾‹å‡†å¤‡">ç¤ºä¾‹å‡†å¤‡</h2><ul class="lvl-0"><li class="lvl-2"><p>å…·ä½“çš„è¯­æ³•ï¼Œå®˜ç½‘ä»‹ç»çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡ŒåŸºäº <a href="/2025/09/04/springboot3-shardingsphere-proxy/" title="SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨">SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨</a> ä¸­çš„é…ç½®è¿›è¡Œç¤ºä¾‹è¯´æ˜ã€‚</p></li><li class="lvl-2"><p>ä¸ºäº†å°½å¯èƒ½å¤šçš„ä½¿ç”¨ DistSQL è¯­æ³•ï¼Œè¿™é‡Œä»…åœ¨ <code>global.yaml</code> ä¸­é…ç½®å¦‚ä¸‹å†…å®¹:</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®ä¸ºåŸºäº zookeeper é›†ç¾¤æ¨¡å¼ï¼Œä¸ºäº†æ¼”ç¤º DistSQL è¯­æ³•ï¼Œè¿™é‡Œéœ€è¦å°†é…ç½®æŒä¹…åŒ–ï¼Œä½¿ç”¨ JDBC çš„å•æœºæ¨¡å¼ä¹Ÿå¯ä»¥</span></span><br><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Cluster</span>                 <span class="comment"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ZooKeeper</span>             <span class="comment"># æ³¨å†Œä¸­å¿ƒç±»å‹</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">governance_ds</span>  <span class="comment"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class="line">      <span class="attr">server-lists:</span> <span class="string">localhost:2181</span> <span class="comment"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class="line">      <span class="attr">retryIntervalMilliseconds:</span> <span class="number">500</span> <span class="comment"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class="line">      <span class="attr">timeToLiveSeconds:</span> <span class="number">60</span>     <span class="comment"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class="line">      <span class="attr">maxRetries:</span> <span class="number">3</span>             <span class="comment"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class="line">      <span class="attr">operationTimeoutMilliseconds:</span> <span class="number">500</span>  <span class="comment"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç”¨æˆ·å’Œæƒé™ï¼Œå› ä¸º DistSQL æš‚ä¸æ”¯æŒ ç”¨æˆ·å’Œæƒé™ç®¡ç†ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å…ˆé…ç½®ç”¨æˆ·å’Œæƒé™</span></span><br><span class="line"><span class="attr">authority:</span></span><br><span class="line">  <span class="attr">users:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">user:</span> <span class="string">root@127.0.0.1</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">admin:</span> <span class="literal">true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">user:</span> <span class="string">sharding@%</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">sharding</span></span><br><span class="line">  <span class="attr">privilege:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">DATABASE_PERMITTED</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">user-database-mappings:</span> <span class="string">root@127.0.0.1=*,sharding@%=sharding_db</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ ShardingSphere-Proxy æœåŠ¡ï¼Œå¹¶ç™»å½•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ ShardingSphere-Proxy</span></span><br><span class="line">./shardingsphere-proxy-bin/bin/start.sh</span><br><span class="line"><span class="comment"># ä½¿ç”¨ç®¡ç†å‘˜ç™»å½•</span></span><br><span class="line">mysql -h127.0.0.1 -uroot -proot -P3307</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™</span></span><br><span class="line">mysql&gt; SHOW AUTHORITY RULE;</span><br><span class="line">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class="line">| <span class="built_in">users</span>                      | provider           | props                                                                |</span><br><span class="line">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class="line">| root@127.0.0.1; sharding@% | DATABASE_PERMITTED | &#123;<span class="string">&quot;user-database-mappings&quot;</span>:<span class="string">&quot;root@127.0.0.1=*,sharding@%=sharding_db&quot;</span>&#125; |</span><br><span class="line">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.49 sec)</span><br></pre></td></tr></table></figure><h2 id="å…¨å±€é…ç½®ï¼Œå³global-yamlä¸­çš„é…ç½®">å…¨å±€é…ç½®ï¼Œå³<code>global.yaml</code>ä¸­çš„é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>å…¨å±€é…ç½®å¯¹æ‰€æœ‰é€»è¾‘æ•°æ®åº“æœ‰æ•ˆ</p></li></ul><h3 id="å±æ€§é…ç½®">å±æ€§é…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span> <span class="comment"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure><h4 id="DistSQL-è¯­æ³•">DistSQL è¯­æ³•</h4><ul class="lvl-0"><li class="lvl-2"><p>è®¾ç½®å±æ€§ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/set-dist-vairable/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œè¦æ³¨æ„ï¼Œå±æ€§åéœ€è¦ä½¿ç”¨ä¸‹åˆ’çº¿æ ¼å¼</span></span><br><span class="line">SET DIST VARIABLE sql_show = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å±æ€§ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/show-dist-variable/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW DIST VARIABLES;</span><br><span class="line">+-----------------------------------------+-----------------+</span><br><span class="line">| variable_name                           | variable_value  |</span><br><span class="line">+-----------------------------------------+-----------------+</span><br><span class="line">| agent_plugins_enabled                   | <span class="literal">true</span>            |</span><br><span class="line">| cached_connections                      | 0               |</span><br><span class="line">| cdc_server_port                         | 33071           |</span><br><span class="line">| check_table_metadata_enabled            | <span class="literal">false</span>           |</span><br><span class="line">| kernel_executor_size                    | 0               |</span><br><span class="line">| load_table_metadata_batch_size          | 1000            |</span><br><span class="line">| max_connections_size_per_query          | 1               |</span><br><span class="line">| proxy_backend_query_fetch_size          | -1              |</span><br><span class="line">| proxy_default_port                      | 3307            |</span><br><span class="line">| proxy_frontend_database_protocol_type   |                 |</span><br><span class="line">| proxy_frontend_executor_size            | 0               |</span><br><span class="line">| proxy_frontend_flush_threshold          | 128             |</span><br><span class="line">| proxy_frontend_max_connections          | 0               |</span><br><span class="line">| proxy_frontend_ssl_cipher               |                 |</span><br><span class="line">| proxy_frontend_ssl_enabled              | <span class="literal">false</span>           |</span><br><span class="line">| proxy_frontend_ssl_version              | TLSv1.2,TLSv1.3 |</span><br><span class="line">| proxy_meta_data_collector_enabled       | <span class="literal">false</span>           |</span><br><span class="line">| proxy_netty_backlog                     | 1024            |</span><br><span class="line">| sql_show                                | <span class="literal">true</span>            |</span><br><span class="line">| sql_simple                              | <span class="literal">false</span>           |</span><br><span class="line">| system_log_level                        | INFO            |</span><br><span class="line">| system_schema_metadata_assembly_enabled | <span class="literal">true</span>            |</span><br><span class="line">+-----------------------------------------+-----------------+</span><br></pre></td></tr></table></figure><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡é…ç½®">åˆ†å¸ƒå¼äº‹åŠ¡é…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">transaction:</span></span><br><span class="line">  <span class="attr">defaultType:</span> <span class="string">XA</span></span><br><span class="line">  <span class="attr">providerType:</span> <span class="string">Atomikos</span></span><br></pre></td></tr></table></figure><h4 id="DistSQL-è¯­æ³•-2">DistSQL è¯­æ³•</h4><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹äº‹åŠ¡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/global-rule/show-transaction-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW TRANSACTION RULE;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹äº‹åŠ¡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/global-rule/alter-transaction-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TRANSACTION RULE(</span><br><span class="line">  DEFAULT=<span class="string">&quot;XA&quot;</span>, TYPE(NAME=<span class="string">&quot;Atomikos&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="è§„åˆ™é…ç½®ï¼Œå³database-xxx-yamlä¸­çš„é…ç½®">è§„åˆ™é…ç½®ï¼Œå³<code>database-xxx.yaml</code>ä¸­çš„é…ç½®</h2><ul class="lvl-0"><li class="lvl-2"><p>ä»¥ä¸‹ DistSQL ä»…å¯ä»¥åœ¨é€»è¾‘åº“ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªé€»è¾‘æ•°æ®åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE sharding_db;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use sharding_db;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®æºé…ç½®">æ•°æ®æºé…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ DistSQLä¸­ï¼Œå®˜æ–¹å°†æ•°æ®æºå«åš<code>å­˜å‚¨å•å…ƒ(STORAGE UNIT)</code></p></li><li class="lvl-2"><p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_0:</span> <span class="comment"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>  <span class="comment"># æ³¨æ„è¿™é‡Œå±æ€§ä¸º url</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ds_1:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br></pre></td></tr></table></figure><h4 id="DistSQL-è¯­æ³•-3">DistSQL è¯­æ³•</h4><ul class="lvl-0"><li class="lvl-2"><p>æ³¨å†Œå­˜å‚¨å•å…ƒï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/register-storage-unit/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">REGISTER STORAGE UNIT ds_0 (</span><br><span class="line">    URL=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class="line">    USER=<span class="string">&quot;root&quot;</span>,</span><br><span class="line">    PASSWORD=<span class="string">&quot;newpwd&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">REGISTER STORAGE UNIT ds_1 (</span><br><span class="line">    URL=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class="line">    USER=<span class="string">&quot;root&quot;</span>,</span><br><span class="line">    PASSWORD=<span class="string">&quot;newpwd&quot;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢å­˜å‚¨å•å…ƒï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/storage-unit-query/show-storage-units/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW STORAGE UNITS FROM sharding_db \G;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹å­˜å‚¨å•å…ƒï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/alter-storage-unit/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ALTER STORAGE UNIT ds_1 (</span><br><span class="line">    URL=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class="line">    USER=<span class="string">&quot;root&quot;</span>,</span><br><span class="line">    PASSWORD=<span class="string">&quot;newpwd&quot;</span>,</span><br><span class="line">    PROPERTIES(<span class="string">&quot;maximumPoolSize&quot;</span>=10,<span class="string">&quot;idleTimeout&quot;</span>=30000)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å–æ¶ˆæ³¨å†Œå­˜å‚¨å•å…ƒï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/unregister-storage-unit/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ— æ³•ç§»é™¤å·²ç»è¢«è§„åˆ™ä½¿ç”¨çš„å­˜å‚¨å•å…ƒ</span></span><br><span class="line">UNREGISTER STORAGE UNIT ds_0;</span><br></pre></td></tr></table></figure><h3 id="å•è¡¨é…ç½®">å•è¡¨é…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SINGLE</span> <span class="comment"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="comment"># MySQL é£æ ¼</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ds_0.t_address</span> <span class="comment"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br></pre></td></tr></table></figure><h4 id="DistSQL-è¯­æ³•-4">DistSQL è¯­æ³•</h4><ul class="lvl-0"><li class="lvl-2"><p>åŠ è½½å•è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/single-table/load-single-table/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD SINGLE TABLE ds_0.t_address;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢å•è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/single-table/show-single-table/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW SINGLE TABLES;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¸è½½å•è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/single-table/unload-single-table/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNLOAD SINGLE TABLE ds_0.t_address;</span><br></pre></td></tr></table></figure><h3 id="å¹¿æ’­è¡¨é…ç½®">å¹¿æ’­è¡¨é…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!BROADCAST</span>  <span class="comment"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dict</span>    <span class="comment"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure><h4 id="DistSQL-è¯­æ³•-5">DistSQL è¯­æ³•</h4><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºå¹¿æ’­è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/broadcast-table/create-broadcast-table-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE BROADCAST TABLE RULE dict;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤å¹¿æ’­è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/broadcast-table/drop-broadcast-table-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP BROADCAST TABLE RULE dict;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢å¹¿æ’­è¡¨ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/broadcast-table/show-broadcast-table-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨</span></span><br><span class="line">SHOW BROADCAST TABLE RULES;</span><br><span class="line"><span class="comment"># æŸ¥è¯¢æŒ‡å®šæ•°æ®åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨</span></span><br><span class="line">SHOW BROADCAST TABLE RULES FROM sharding_db;</span><br></pre></td></tr></table></figure><h3 id="åˆ†åº“åˆ†è¡¨é…ç½®">åˆ†åº“åˆ†è¡¨é…ç½®</h3><h4 id="å•åˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹">å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">course:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">cid</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_inline</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">cid</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">course_inline:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># å±æ€§</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">course_$&#123;cid</span> <span class="string">%</span> <span class="number">2</span> <span class="string">+</span> <span class="number">1</span><span class="string">&#125;</span> <span class="comment"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class="line">          <span class="attr">allow-range-query-with-inline-sharding:</span> <span class="literal">true</span> <span class="comment"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">      <span class="attr">course_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span> <span class="comment"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-6">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/create-sharding-table-rule/#1%E6%A0%87%E5%87%86%E5%88%86%E7%89%87%E8%A7%84%E5%88%99">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE SHARDING TABLE RULE course (</span><br><span class="line">  DATANODES(<span class="string">&quot;ds_<span class="variable">$&#123;0..1&#125;</span>.course_<span class="variable">$&#123;1..2&#125;</span>&quot;</span>),</span><br><span class="line">  DATABASE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;ds_<span class="variable">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class="line">  TABLE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=cid,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;course_<span class="variable">$&#123;cid % 2 + 1&#125;</span>&quot;</span>,<span class="string">&quot;allow-range-query-with-inline-sharding&quot;</span>=<span class="literal">true</span> )))),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=cid,TYPE(NAME=<span class="string">&quot;snowflake&quot;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="å•åˆ†ç‰‡é”®ï¼ŒString-ç±»å‹">å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_user:</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">id</span> <span class="comment"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line"><span class="comment">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">custom_snowflake_string</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_user_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span> <span class="comment"># åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®—</span></span><br><span class="line">      <span class="attr">t_user_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span> <span class="comment"># åˆ†è¡¨ï¼Œt_user_0, t_user_1</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</span></span><br><span class="line">      <span class="attr">uuid:</span>    <span class="comment"># å®šä¹‰åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">UUID</span> <span class="comment"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class="line">      <span class="attr">custom_snowflake_string:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CUSTOM_SNOWFLAKE_STRING</span> <span class="comment"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">workerId:</span> <span class="number">2</span></span><br><span class="line">          <span class="attr">datacenterId:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-7">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE SHARDING TABLE RULE t_user (</span><br><span class="line">  DATANODES(<span class="string">&quot;ds_<span class="variable">$&#123;0..1&#125;</span>.t_user_<span class="variable">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class="line">  DATABASE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=<span class="built_in">id</span>,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;ds_<span class="variable">$&#123;Math.abs(id.hashCode()%2)&#125;</span>&quot;</span>)))),</span><br><span class="line">  TABLE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=<span class="built_in">id</span>,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;t_user_<span class="variable">$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span>&quot;</span>)))),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=<span class="built_in">id</span>,TYPE(NAME=<span class="string">&quot;CUSTOM_SNOWFLAKE_STRING&quot;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="å¤šåˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹">å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order-complex-algorithm</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class="line"><span class="comment">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_item-class-based-algorithm_spi</span> <span class="comment"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_order_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order-complex-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">COMPLEX_INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_order_complex_$&#123;(user_id</span> <span class="string">+</span> <span class="string">order_id</span> <span class="string">+</span> <span class="number">1</span><span class="string">)</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm_spi:</span> <span class="comment"># SPI</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">T_ORDER_ITEM_COMPLEX</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-8">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE SHARDING TABLE RULE t_order_complex (</span><br><span class="line">  DATANODES(<span class="string">&quot;ds_<span class="variable">$&#123;0..1&#125;</span>.t_order_complex_<span class="variable">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class="line">  DATABASE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;ds_<span class="variable">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class="line">  TABLE_STRATEGY(TYPE=<span class="string">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;complex_inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;t_order_complex_<span class="variable">$&#123;(user_id + order_id + 1) % 2&#125;</span>&quot;</span>)))),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=<span class="string">&quot;snowflake&quot;</span>))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE SHARDING TABLE RULE t_order_item_complex (</span><br><span class="line">  DATANODES(<span class="string">&quot;ds_<span class="variable">$&#123;0..1&#125;</span>.t_order_item_complex_<span class="variable">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class="line">  DATABASE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;ds_<span class="variable">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class="line">  TABLE_STRATEGY(TYPE=<span class="string">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;T_ORDER_ITEM_COMPLEX&quot;</span>))),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class="string">&quot;SNOWFLAKE&quot;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™">è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</h4><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">   <span class="comment"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class="line">    <span class="attr">bindingTables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t_order,t_order_item</span></span><br><span class="line">    <span class="attr">autoTables:</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">mod_2:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MOD</span> <span class="comment"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">sharding-count:</span> <span class="number">2</span> <span class="comment"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-9">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE SHARDING TABLE RULE t_order (</span><br><span class="line">  STORAGE_UNITS(ds_0,ds_1),</span><br><span class="line">  SHARDING_COLUMN=user_id,TYPE(NAME=<span class="string">&quot;mod&quot;</span>,PROPERTIES(<span class="string">&quot;sharding-count&quot;</span>=<span class="string">&quot;2&quot;</span>)),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=<span class="string">&quot;snowflake&quot;</span>))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE SHARDING TABLE RULE t_order_item (</span><br><span class="line">  STORAGE_UNITS(ds_0,ds_1),</span><br><span class="line">  SHARDING_COLUMN=user_id,TYPE(NAME=<span class="string">&quot;mod&quot;</span>,PROPERTIES(<span class="string">&quot;sharding-count&quot;</span>=<span class="string">&quot;2&quot;</span>)),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class="string">&quot;snowflake&quot;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="å…¶å®ƒåˆ†ç‰‡æ“ä½œè¯­å¥">å…¶å®ƒåˆ†ç‰‡æ“ä½œè¯­å¥</h4><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢åˆ†ç‰‡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/sharding/show-sharding-table-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰é€»è¾‘åº“ä¸‹çš„æ‰€æœ‰åˆ†ç‰‡è§„åˆ™</span></span><br><span class="line">SHOW SHARDING TABLE RULES \G;</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šé€»è¾‘åº“ä¸‹çš„åˆ†ç‰‡è§„åˆ™</span></span><br><span class="line">SHOW SHARDING TABLE RULES FROM sharding_db; \G;</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šåˆ†ç‰‡è§„åˆ™</span></span><br><span class="line">SHOW SHARDING TABLE RULE t_user \G;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹åˆ†ç‰‡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/alter-sharding-table-rule/">å®˜ç½‘æ–‡æ¡£</a>ï¼Œä¸åˆ›å»ºåˆ†ç‰‡è§„åˆ™ç±»ä¼¼ï¼Œå°†<code>CREATE</code>æ”¹ä¸º<code>ALTER</code>å³å¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ALTER SHARDING TABLE RULE t_order_item_complex (</span><br><span class="line">  DATANODES(<span class="string">&quot;ds_<span class="variable">$&#123;0..1&#125;</span>.t_order_item_complex_<span class="variable">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class="line">  DATABASE_STRATEGY(TYPE=<span class="string">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;inline&quot;</span>,PROPERTIES(<span class="string">&quot;algorithm-expression&quot;</span>=<span class="string">&quot;ds_<span class="variable">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class="line">  TABLE_STRATEGY(TYPE=<span class="string">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class="string">&quot;T_ORDER_ITEM_COMPLEX&quot;</span>))),</span><br><span class="line">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class="string">&quot;SNOWFLAKE&quot;</span>))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤åˆ†ç‰‡è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/drop-sharding-table-rule/">å®˜ç½‘æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DROP SHARDING TABLE RULE t_order;</span><br><span class="line"><span class="comment"># åˆ é™¤å¤šä¸ªè¡¨</span></span><br><span class="line">DROP SHARDING TABLE RULE t_order,t_order_item;</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åŠ å¯†è§„åˆ™">æ•°æ®åŠ å¯†è§„åˆ™</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!ENCRYPT</span>    <span class="comment"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># åŠ å¯†è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># åŠ å¯†åˆ—åç§°</span></span><br><span class="line">            <span class="attr">cipher:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">password</span> <span class="comment"># å¯†æ–‡åˆ—åç§°</span></span><br><span class="line">              <span class="attr">encryptorName:</span> <span class="string">aes_encryptor</span> <span class="comment"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class="line">    <span class="comment"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class="line">    <span class="attr">encryptors:</span></span><br><span class="line">      <span class="attr">aes_encryptor:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">AES</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line">          <span class="attr">aes-key-value:</span> <span class="string">123456abc</span>     <span class="comment"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class="line">          <span class="attr">digest-algorithm-name:</span> <span class="string">SHA-1</span> <span class="comment"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-10">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåŠ å¯†è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/encrypt/create-encrypt-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE ENCRYPT RULE t_user (</span><br><span class="line">COLUMNS(</span><br><span class="line">  (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=<span class="string">&#x27;AES&#x27;</span>,PROPERTIES(<span class="string">&#x27;aes-key-value&#x27;</span>=<span class="string">&#x27;123456abc&#x27;</span>, <span class="string">&#x27;digest-algorithm-name&#x27;</span>=<span class="string">&#x27;SHA-1&#x27;</span>))))</span><br><span class="line">));</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹åŠ å¯†è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER ENCRYPT RULE t_user (</span><br><span class="line">COLUMNS(</span><br><span class="line">  (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=<span class="string">&#x27;AES&#x27;</span>,PROPERTIES(<span class="string">&#x27;aes-key-value&#x27;</span>=<span class="string">&#x27;123456abc&#x27;</span>, <span class="string">&#x27;digest-algorithm-name&#x27;</span>=<span class="string">&#x27;SHA-1&#x27;</span>))))</span><br><span class="line">));</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤åŠ å¯†è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP ENCRYPT RULE t_user;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢åŠ å¯†è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/encrypt/show-encrypt-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰åŠ å¯†è§„åˆ™</span></span><br><span class="line">SHOW ENCRYPT RULES \G;</span><br><span class="line"><span class="comment"># è·å–æŒ‡å®šé€»è¾‘åº“ä¸­çš„åŠ å¯†è§„åˆ™</span></span><br><span class="line">SHOW ENCRYPT RULES FROM sharding_db \G;</span><br><span class="line"><span class="comment"># è·å–æŒ‡å®šé€»è¾‘è¡¨ä¸­çš„åŠ å¯†è§„åˆ™</span></span><br><span class="line">SHOW ENCRYPT RULE t_user \G;</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®è„±æ•è§„åˆ™">æ•°æ®è„±æ•è§„åˆ™</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!MASK</span>  <span class="comment"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># è„±æ•è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span>  <span class="comment"># è„±æ•åˆ—é…ç½®</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># è„±æ•åˆ—åç§°</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">md5_mask</span> <span class="comment"># è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">email:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">mask_before_special_chars_mask</span></span><br><span class="line">          <span class="attr">telephone:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">keep_first_n_last_m_mask</span></span><br><span class="line">          <span class="attr">name:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">my_mask</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">maskAlgorithms:</span> <span class="comment"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class="line">      <span class="attr">md5_mask:</span> <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span>  <span class="comment"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class="line">      <span class="attr">mask_before_special_chars_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MASK_BEFORE_SPECIAL_CHARS</span> <span class="comment"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">special-chars:</span> <span class="string">&#x27;@&#x27;</span>  <span class="comment"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span>   <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">keep_first_n_last_m_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">KEEP_FIRST_N_LAST_M</span> <span class="comment"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">first-n:</span> <span class="number">3</span>     <span class="comment"># ä¿ç•™å‰ 3 ä½</span></span><br><span class="line">          <span class="attr">last-m:</span> <span class="number">4</span>      <span class="comment"># ä¿ç•™å 4 ä½</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">my_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MY_CUSTOM_MASK</span>  <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&quot;#&quot;</span></span><br></pre></td></tr></table></figure><h5 id="DistSQL-è¯­æ³•-11">DistSQL è¯­æ³•</h5><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºè„±æ•è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/mask/create-mask-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE MASK RULE t_user (</span><br><span class="line">  COLUMNS(</span><br><span class="line">    (NAME=password, TYPE(NAME=<span class="string">&#x27;MD5&#x27;</span>)),</span><br><span class="line">    (NAME=email, TYPE(NAME=<span class="string">&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;</span>, PROPERTIES(<span class="string">&quot;special-chars&quot;</span>=<span class="string">&quot;@&quot;</span>,  <span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;*&quot;</span>))),</span><br><span class="line">    (NAME=telephone, TYPE(NAME=<span class="string">&#x27;KEEP_FIRST_N_LAST_M&#x27;</span>, PROPERTIES(<span class="string">&quot;first-n&quot;</span>=3, <span class="string">&quot;last-m&quot;</span>=4, <span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;*&quot;</span>))),</span><br><span class="line">    (NAME=`name`, TYPE(NAME=<span class="string">&#x27;MY_CUSTOM_MASK&#x27;</span>, PROPERTIES(<span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;#&quot;</span>)))</span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"><span class="comment"># è¿™é‡Œæ³¨æ„ name æ˜¯å…³é”®å­—ï¼Œæ‰€ä»¥éœ€è¦ç”¨ `` åŒ…èµ·æ¥</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹è„±æ•è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ALTER MASK RULE t_user (</span><br><span class="line">  COLUMNS(</span><br><span class="line">    (NAME=password, TYPE(NAME=<span class="string">&#x27;MD5&#x27;</span>)),</span><br><span class="line">    (NAME=email, TYPE(NAME=<span class="string">&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;</span>, PROPERTIES(<span class="string">&quot;special-chars&quot;</span>=<span class="string">&quot;@&quot;</span>,  <span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;*&quot;</span>))),</span><br><span class="line">    (NAME=telephone, TYPE(NAME=<span class="string">&#x27;KEEP_FIRST_N_LAST_M&#x27;</span>, PROPERTIES(<span class="string">&quot;first-n&quot;</span>=3, <span class="string">&quot;last-m&quot;</span>=4, <span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;*&quot;</span>))),</span><br><span class="line">    (NAME=`name`, TYPE(NAME=<span class="string">&#x27;MY_CUSTOM_MASK&#x27;</span>, PROPERTIES(<span class="string">&quot;replace-char&quot;</span>=<span class="string">&quot;#&quot;</span>)))</span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤è„±æ•è§„åˆ™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP MASK RULE t_user;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥è¯¢è„±æ•è§„åˆ™ï¼Œ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/mask/show-mask-rule/">å®˜æ–¹æ–‡æ¡£</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰è„±æ•è§„åˆ™</span></span><br><span class="line">SHOW MASK RULES;</span><br><span class="line"><span class="comment"># ä»…æŸ¥è¯¢æŒ‡å®šé€»è¾‘åº“ä¸­çš„è„±æ•è§„åˆ™</span></span><br><span class="line">SHOW MASK RULES FROM sharding_db;</span><br><span class="line"><span class="comment"># æŸ¥è¯¢æŒ‡å®šè§„åˆ™</span></span><br><span class="line">mysql&gt; SHOW MASK RULE t_user;</span><br><span class="line">+--------+-----------+---------------------------+-------------------------------------------------+</span><br><span class="line">| table  | column    | algorithm_type            | algorithm_props                                 |</span><br><span class="line">+--------+-----------+---------------------------+-------------------------------------------------+</span><br><span class="line">| t_user | password  | MD5                       |                                                 |</span><br><span class="line">| t_user | email     | MASK_BEFORE_SPECIAL_CHARS | &#123;<span class="string">&quot;replace-char&quot;</span>:<span class="string">&quot;*&quot;</span>,<span class="string">&quot;special-chars&quot;</span>:<span class="string">&quot;@&quot;</span>&#125;        |</span><br><span class="line">| t_user | telephone | KEEP_FIRST_N_LAST_M       | &#123;<span class="string">&quot;first-n&quot;</span>:<span class="string">&quot;3&quot;</span>,<span class="string">&quot;last-m&quot;</span>:<span class="string">&quot;4&quot;</span>,<span class="string">&quot;replace-char&quot;</span>:<span class="string">&quot;*&quot;</span>&#125; |</span><br><span class="line">| t_user | name      | MY_CUSTOM_MASK            | &#123;<span class="string">&quot;replace-char&quot;</span>:<span class="string">&quot;#&quot;</span>&#125;                            |</span><br><span class="line">+--------+-----------+---------------------------+-------------------------------------------------+</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» ShardingSphere-Proxy5.5.2 DistSQL çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://shardingsphere.apache.org/index_zh.html&quot;&gt;ShardingSphereå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/sharding-sphere/"/>
    
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/tags/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/tags/sharding-sphere/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot3 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼</title>
    <link href="https://blog.hanqunfeng.com/2025/09/10/springboot3-shardingsphere-proxy-mode/"/>
    <id>https://blog.hanqunfeng.com/2025/09/10/springboot3-shardingsphere-proxy-mode/</id>
    <published>2025-09-10T13:30:05.000Z</published>
    <updated>2025-09-15T06:26:28.238Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/index_zh.html">ShardingSphereå®˜ç½‘</a></p></li><li class="lvl-2"><p>æœ¬æ–‡åœ¨ <a href="/2025/09/04/springboot3-shardingsphere-proxy/" title="SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨">SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨</a> çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚</p></li></ul><span id="more"></span><h2 id="è¿è¡Œæ¨¡å¼è¯´æ˜">è¿è¡Œæ¨¡å¼è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/document/5.5.2/cn/dev-manual/mode/">è¿è¡Œæ¨¡å¼</a></p></li><li class="lvl-2"><p>ShardingSphere-Proxy è¿è¡Œæ¨¡å¼åˆ†ä¸ºä¸¤ç§ï¼šå•æœºæ¨¡å¼(Standalone) å’Œ é›†ç¾¤æ¨¡å¼(Cluster)ã€‚</p></li><li class="lvl-2"><p>è¿è¡Œæ¨¡å¼å°±æ˜¯æŒ‡å®šå°†<code>å…ƒæ•°æ®</code>(è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ç­‰)æŒä¹…åŒ–çš„å­˜å‚¨æ–¹å¼ã€‚</p></li><li class="lvl-2"><p>é»˜è®¤è¿è¡Œæ¨¡å¼ä¸ºå•æœºæ¨¡å¼ï¼Œä½¿ç”¨<code>H2</code>çš„å†…å­˜æ–¹å¼ã€‚</p></li></ul><h2 id="å•æœºæ¨¡å¼-Standalone">å•æœºæ¨¡å¼(Standalone)</h2><ul class="lvl-0"><li class="lvl-2"><p>å•æœºæ¨¡å¼èƒ½å¤Ÿå°†æ•°æ®æºå’Œè§„åˆ™ç­‰å…ƒæ•°æ®ä¿¡æ¯æŒä¹…åŒ–ï¼Œä½†æ— æ³•å°†å…ƒæ•°æ®åŒæ­¥è‡³å¤šä¸ª Apache ShardingSphere å®ä¾‹ï¼Œæ— æ³•åœ¨é›†ç¾¤ç¯å¢ƒä¸­ç›¸äº’æ„ŸçŸ¥ã€‚ é€šè¿‡æŸä¸€å®ä¾‹æ›´æ–°å…ƒæ•°æ®ä¹‹åï¼Œä¼šå¯¼è‡´å…¶ä»–å®ä¾‹ç”±äºè·å–ä¸åˆ°æœ€æ–°çš„å…ƒæ•°æ®è€Œäº§ç”Ÿä¸ä¸€è‡´çš„é”™è¯¯ã€‚</p></li><li class="lvl-2"><p>é€‚ç”¨äºå·¥ç¨‹å¸ˆåœ¨æœ¬åœ°æ­å»º Apache ShardingSphere ç¯å¢ƒã€‚</p></li><li class="lvl-2"><p>å•æœºæ¨¡å¼ç›®å‰ä»…æ”¯æŒä¸€ç§ï¼šJDBCï¼Œå³æ•°æ®åº“æŒä¹…åŒ–ã€‚ä»¥ä¸‹ä¸ºé»˜è®¤å€¼(<code>JDBCRepositoryPropertyKey</code>)ã€‚</p></li></ul><table><thead><tr><th>åç§°</th><th>æ•°æ®ç±»å‹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>provider</td><td>String</td><td>å…ƒæ•°æ®å­˜å‚¨ç±»å‹ï¼Œå¯é€‰å€¼ä¸º <code>H2</code>ã€<code>MySQL</code> ã€<code>EmbeddedDerby</code>ã€<code>DerbyNetworkServer</code>ã€<code>HSQLDB</code></td><td>H2</td></tr><tr><td>jdbc_url</td><td>String</td><td>JDBC URL</td><td><code>jdbc:h2:mem:config;DB_CLOSE_DELAY=0;DATABASE_TO_UPPER=false;MODE=MYSQL</code></td></tr><tr><td>username</td><td>String</td><td>è´¦å·</td><td>sa</td></tr><tr><td>password</td><td>String</td><td>å¯†ç </td><td>ç©ºï¼ˆæ— é»˜è®¤å€¼ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œä»¥ Mysql å­˜å‚¨å…ƒæ•°æ®ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/common-config/builtin-algorithm/metadata-repository/#jdbc-%E6%8C%81%E4%B9%85%E5%8C%96">å®˜ç½‘è¯´æ˜</a></p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">JDBC</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">provider:</span> <span class="string">MySQL</span></span><br><span class="line">      <span class="attr">jdbc_url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">newpwd</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ­¤æ—¶éœ€è¦å°† mysql çš„é©±åŠ¨ jar åŒ… æ·»åŠ åˆ° <code>ext-lib</code> ç›®å½•ä¸‹</p></li><li class="lvl-2"><p>å¯åŠ¨ ShardingSphere Proxy æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ä¸Šé¢çš„æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¼ è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„ä¸­çš„å…ƒæ•°æ®å­˜å‚¨è¿›å»</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `repository` (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">COLLATE</span> utf8mb4_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `key` text <span class="keyword">COLLATE</span> utf8mb4_bin,</span><br><span class="line">  `<span class="keyword">value</span>` text <span class="keyword">COLLATE</span> utf8mb4_bin,</span><br><span class="line">  `parent` text <span class="keyword">COLLATE</span> utf8mb4_bin,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_bin;</span><br></pre></td></tr></table></figure><h3 id="é‡ç‚¹è¯´æ˜">é‡ç‚¹è¯´æ˜</h3><ul class="lvl-0"><li class="lvl-2"><p>å½“æ•°æ®åº“ä¸­ä¸å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¯¥è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„å…ƒæ•°æ®æ’å…¥è¯¥è¡¨ä¸­ã€‚</p></li><li class="lvl-2"><p>å½“æ•°æ®åº“ä¸­å·²å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè¯»å–è¯¥è¡¨ä¸­çš„æ•°æ®å¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ï¼Œè€Œä¸ä¼šè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚å³æ­¤æ—¶é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ä¸ä¼šç”Ÿæ•ˆã€‚</p></li><li class="lvl-2"><p>è‹¥æ­¤æ—¶æƒ³ä¿®æ”¹é…ç½®è§„åˆ™ï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š</p><ul class="lvl-2"><li class="lvl-4">1.åˆ é™¤è¯¥è¡¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åé‡æ–°å¯åŠ¨Proxyï¼Œæ­¤æ—¶ä¼šé‡æ–°åˆ›å»ºè¯¥è¡¨å¹¶åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚</li><li class="lvl-4">2.æ‰‹å·¥ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„å…ƒæ•°æ®ï¼Œä½†ä¿®æ”¹åéœ€è¦é‡æ–°å¯åŠ¨Proxyæ‰ä¼šåŠ è½½æ–°çš„å…ƒæ•°æ®ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚</li><li class="lvl-4">3.<code>[æ¨è]</code>ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ <a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/">DistSQL</a> åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œä¿®æ”¹åçš„é…ç½®ä¼šè¢«ä¿å­˜åœ¨è¯¥è¡¨ä¸­ï¼Œå¹¶ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯Proxyã€‚</li></ul></li><li class="lvl-2"><p>å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒå¯ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤çš„ H2 å†…å­˜æ•°æ®åº“ï¼Œç”Ÿäº§ç¯å¢ƒå¯ä»¥ä½¿ç”¨ MySQLç­‰æ•°æ®åº“å¯¹å…ƒæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„é›†ç¾¤æ¨¡å¼ã€‚</p></li></ul><h2 id="é›†ç¾¤æ¨¡å¼-Cluster">é›†ç¾¤æ¨¡å¼(Cluster)</h2><ul class="lvl-0"><li class="lvl-2"><p>é›†ç¾¤æ¨¡å¼æä¾›äº†å¤šä¸ª Apache ShardingSphere å®ä¾‹ä¹‹é—´çš„å…ƒæ•°æ®å…±äº«å’Œåˆ†å¸ƒå¼åœºæ™¯ä¸‹çŠ¶æ€åè°ƒçš„èƒ½åŠ›ã€‚ å®ƒèƒ½å¤Ÿæä¾›è®¡ç®—èƒ½åŠ›æ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨ç­‰åˆ†å¸ƒå¼ç³»ç»Ÿå¿…å¤‡çš„èƒ½åŠ›ï¼Œé›†ç¾¤ç¯å¢ƒéœ€è¦é€šè¿‡ç‹¬ç«‹éƒ¨ç½²çš„æ³¨å†Œä¸­å¿ƒæ¥å­˜å‚¨å…ƒæ•°æ®å’Œåè°ƒèŠ‚ç‚¹çŠ¶æ€ã€‚</p></li><li class="lvl-2"><p>åœ¨ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨é›†ç¾¤æ¨¡å¼ã€‚</p></li><li class="lvl-2"><p>è¿™é‡Œä»¥ zookeeper é›†ç¾¤æ¨¡å¼ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒ<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/common-config/builtin-algorithm/metadata-repository/#zookeeper-%E6%8C%81%E4%B9%85%E5%8C%96">å®˜ç½‘è¯´æ˜</a></p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Cluster</span>                 <span class="comment"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ZooKeeper</span>             <span class="comment"># æ³¨å†Œä¸­å¿ƒç±»å‹ï¼Œå½“å‰ç‰ˆæœ¬ä»…æ”¯æŒ ZooKeeper å’Œ etcd</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">governance_ds</span>  <span class="comment"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class="line">      <span class="attr">server-lists:</span> <span class="string">localhost:2181</span> <span class="comment"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class="line">      <span class="attr">retryIntervalMilliseconds:</span> <span class="number">500</span> <span class="comment"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class="line">      <span class="attr">timeToLiveSeconds:</span> <span class="number">60</span>     <span class="comment"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class="line">      <span class="attr">maxRetries:</span> <span class="number">3</span>             <span class="comment"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class="line">      <span class="attr">operationTimeoutMilliseconds:</span> <span class="number">500</span>  <span class="comment"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="é‡ç‚¹è¯´æ˜-2">é‡ç‚¹è¯´æ˜</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸è¦æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­çš„ namespace ä¸‹çš„é…ç½®ä¿¡æ¯!</p></li><li class="lvl-2"><p>æ—¢ç„¶æ˜¯é›†ç¾¤ï¼Œå°±éœ€è¦å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ã€‚ å½“ç¬¬ä¸€ä¸ª ShardingSphere-Proxy å®ä¾‹ å¯åŠ¨åï¼Œå…¶å®ƒç›¸åŒé…ç½®çš„ ShardingSphere-Proxy å®ä¾‹ä»…éœ€è¦ä¸€ä¸ª <code>global.yaml</code> å…¨å±€é…ç½®æ–‡ä»¶å³å¯ï¼Œå¹¶ä»…éœ€åœ¨å…¶ä¸­é…ç½®ä¸Šé¢çš„<code>è¿è¡Œæ¨¡å¼</code>ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å†é…ç½®å…¶å®ƒé…ç½®ï¼Œæ¯”å¦‚è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šé€šè¿‡ Zookeeper é›†ç¾¤ä¸­çš„ namespace è·å–å¹¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ä¸­ã€‚</p></li><li class="lvl-2"><p>æ¯ä¸ª ShardingSphere-Proxy å®ä¾‹å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨å°†è‡ªå·±æ³¨å†Œåˆ° Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹ï¼Œå¹¶è‡ªåŠ¨è·å–è¯¥ namespace ä¸‹çš„é…ç½®ä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>å½“ Zookeeper é›†ç¾¤ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶ç¬¬ä¸€æ¬¡å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨åœ¨ Zookeeper ä¸­åˆ›å»º namespaceï¼Œå¹¶å†™å…¥é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯åˆ° Zookeeper ä¸­ã€‚</p></li><li class="lvl-2"><p>å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶å†å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨ä» Zookeeper ä¸­è¯»å– namespace ä¸‹çš„é…ç½®ä¿¡æ¯ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä¸ä¼šå†è¯»å–æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ ¹æ®ä¸Šé¢çš„è§„åˆ™ï¼Œæ­¤æ—¶ä¿®æ”¹æœ¬åœ°çš„é…ç½®æ–‡ä»¶ä¸­çš„åˆ†ç‰‡è§„åˆ™åé‡å¯ShardingSphere-Proxy å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚</p><ul class="lvl-2"><li class="lvl-4">æ­¤æ—¶æœ‰ä¸‰ç§æ–¹æ³•ï¼š<ul class="lvl-4"><li class="lvl-6"><ol><li class="lvl-9">åˆ é™¤ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespaceï¼Œç„¶åé‡å¯ ShardingSphere-Proxyã€‚è¿™ç§æ–¹æ³•æœ‰ä¸ªå¼Šç«¯ï¼Œå³ä¼šå¯¼è‡´è¿æ¥åˆ°ç›¸åŒ ZooKeeper é›†ç¾¤çš„ namespace çš„å…¶å®ƒ ShardingSphere-Proxy å®ä¾‹æ•°æ®ä¸¢å¤±(å®Œå…¨ä¸å¯ç”¨)ï¼Œä¹Ÿéœ€è¦é‡å¯æ‰èƒ½é‡æ–°è·å–åˆ°æ•°æ®ã€‚</li></ol></li><li class="lvl-6"><ol start="2"><li class="lvl-9">æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹çš„åˆ†ç‰‡è§„åˆ™ï¼Œä¿®æ”¹åä¼šç«‹å³åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚</li></ol></li><li class="lvl-6"><ol start="3"><li class="lvl-9"><code>[æ¨è]</code>ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ <a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/">DistSQL</a> åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚æ‰€ä»¥ï¼Œçµæ´»æŒæ¡ <code>DistSQL</code> æ˜¯ç»´æŠ¤ ShardingSphere-Proxy é›†ç¾¤çš„å…³é”®ã€‚</li></ol></li></ul></li></ul></li><li class="lvl-2"><p>å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ å¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡å™¨ï¼Œæ¯”å¦‚ Nginxï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„ ShardingSphere-Proxy å®ä¾‹ã€‚æ¯”å¦‚ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">stream&#123;</span><br><span class="line">    upstream shardingsphere_proxy&#123;</span><br><span class="line">        server  10.10.21.35:3307;</span><br><span class="line">        server  10.10.21.36:3307;</span><br><span class="line">    &#125;</span><br><span class="line">    server&#123;</span><br><span class="line">        listen 3310;</span><br><span class="line">        proxy_connect_timeout 20s;</span><br><span class="line">        proxy_timeout 5m;</span><br><span class="line">        proxy_pass shardingsphere_proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸-Spring-Boot3-æ•´åˆ">ä¸ Spring Boot3 æ•´åˆ</h2><ul class="lvl-0"><li class="lvl-2"><p>æ— è®ºæ˜¯ <code>å•æœºæ¨¡å¼</code> è¿˜æ˜¯ <code>é›†ç¾¤æ¨¡å¼</code>ï¼Œå…¶ç›®çš„éƒ½æ˜¯å°† <code>é…ç½®</code> ä¿å­˜åˆ°ç‹¬ç«‹çš„ <code>é…ç½®ä¸­å¿ƒ(æ•°æ®åº“ æˆ– Zookeeper)</code>ä¸­ï¼Œå¹¶è®©å…¶å®ƒ <code>ShardingSphere-Proxy</code> å®ä¾‹ä»è¯¥é…ç½®ä¸­å¿ƒä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚</p></li><li class="lvl-2"><p>å‰æ–‡æˆ‘ä»¬ä»‹ç»è¿‡ <code>Spring Boot3</code> + <code>ShardingSphere-Proxy</code> å°±ç›¸å½“äºæ˜¯é›†æˆæ™®é€šçš„MySqlæ•°æ®åº“ï¼Œè€Œ <code>Spring Boot3</code> + <code>ShardingSphere-JDBC</code> å°±éœ€è¦å•ç‹¬åœ¨æœ¬åœ°é…ç½®å„ç§è§„åˆ™ã€‚</p></li><li class="lvl-2"><p>å®é™…ä¸Š <code>ShardingSphere-JDBC</code> ä¹Ÿå¯ä»¥ä» <code>é…ç½®ä¸­å¿ƒ</code> ä¸­è¯»å–é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦åœ¨æœ¬åœ°é…ç½®ä»»ä½•è§„åˆ™äº†ï¼Œæˆ‘ä»¬ä»…éœ€è¦åœ¨ <code>sharding.yaml</code> ä¸­é…ç½®å¥½<code>è¿è¡Œæ¨¡å¼</code>ï¼Œå¹¶é…ç½®å¥½ <code>databaseName</code> çš„åç§°å³å¯ã€‚æ³¨æ„ï¼Œæ­¤æ—¶é…ç½®ä¸­å¿ƒçš„çš„äº‹åŠ¡ä¸èƒ½æ˜¯ <code>XA</code>ï¼Œå› ä¸º<code>Spring Boot3</code> + <code>ShardingSphere-JDBC</code>ç›®å‰ä¸æ”¯æŒ <code>XA</code> äº‹åŠ¡ã€‚</p></li><li class="lvl-2"><p>æ­¤æ—¶ï¼Œspringbooté¡¹ç›®å¯åŠ¨åä¼šæ‹‰å–<code>é…ç½®ä¸­å¿ƒ</code>ä¸­çš„é…ç½®ä¿¡æ¯å¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„å…¶å®ƒé…ç½®ä¿¡æ¯ä¼šè¢«å¿½ç•¥ã€‚<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/G3kESF.png" alt=""></p></li></ul><h3 id="å•æœºæ¨¡å¼">å•æœºæ¨¡å¼</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-03">ä»£ç ç¤ºä¾‹</a></p></li><li class="lvl-2"><p>é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œå¿…é¡»é‡å¯åº”ç”¨æ‰èƒ½ç”Ÿæ•ˆ</p></li><li class="lvl-2"><p>sharding.yaml</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">JDBC</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">provider:</span> <span class="string">MySQL</span></span><br><span class="line">      <span class="attr">jdbc_url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"><span class="comment"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class="line"><span class="attr">databaseName:</span> <span class="string">sharding_db</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Maven ä¾èµ–</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MySQL Connector/J --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hanqf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>algorithm-swapper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤æ¨¡å¼">é›†ç¾¤æ¨¡å¼</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-04">ä»£ç ç¤ºä¾‹</a></p></li><li class="lvl-2"><p>é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œç«‹å³æ¨é€åˆ°æ‰€æœ‰å®ä¾‹ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚</p></li><li class="lvl-2"><p>sharding.yamlï¼Œæ³¨æ„è¿™é‡Œä¸€å®šè¦é…ç½® <code>databaseName</code></p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # å¼€å¯é›†ç¾¤æ¨¡å¼</span></span><br><span class="line"><span class="attr">mode:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">Cluster</span>                 <span class="comment"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class="line">  <span class="attr">repository:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ZooKeeper</span>             <span class="comment"># æ³¨å†Œä¸­å¿ƒç±»å‹</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">governance_ds</span>  <span class="comment"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class="line">      <span class="attr">server-lists:</span> <span class="string">localhost:2181</span> <span class="comment"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class="line">      <span class="attr">retryIntervalMilliseconds:</span> <span class="number">500</span> <span class="comment"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class="line">      <span class="attr">timeToLiveSeconds:</span> <span class="number">60</span>     <span class="comment"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class="line">      <span class="attr">maxRetries:</span> <span class="number">3</span>             <span class="comment"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class="line">      <span class="attr">operationTimeoutMilliseconds:</span> <span class="number">500</span>  <span class="comment"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class="line"><span class="attr">databaseName:</span> <span class="string">sharding_db</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Maven ä¾èµ–ï¼Œæ³¨æ„è¦åŠ ä¸Š <code>shardingsphere-cluster-mode-repository-zookeeper</code> çš„ä¾èµ–</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MySQL Connector/J --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hanqf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>algorithm-swapper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- shardingsphere-cluster-mode-repository-zookeeper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-cluster-mode-repository-zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•é€‰æ‹©">å¦‚ä½•é€‰æ‹©</h3><ul class="lvl-0"><li class="lvl-2"><p>å½“æˆ‘ä½¿ç”¨<code>springboot3+shardingSphere-JDBC5.5.2</code>æ—¶ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨æœ¬åœ°<code>é…ç½®æ–‡ä»¶</code>çš„æ–¹å¼è¿˜æ˜¯ä½¿ç”¨<code>é…ç½®ä¸­å¿ƒ</code>ï¼ˆæ¯”å¦‚ï¼šzookeeperï¼‰çš„æ–¹å¼å‘¢ï¼Ÿ</p></li></ul><table><thead><tr><th>æ–¹å¼</th><th>éƒ¨ç½²å¤æ‚åº¦</th><th>é…ç½®åŠ¨æ€æ›´æ–°</th><th>å¤šå®ä¾‹å…±äº«é…ç½®</th><th>çƒ­æ›´æ–°æ”¯æŒ</th><th>é€‚ç”¨ç¯å¢ƒ</th></tr></thead><tbody><tr><td>æœ¬åœ°é…ç½®æ–‡ä»¶</td><td>ç®€å•</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>å¦</td><td>å¼€å‘/æµ‹è¯•/å°å‹é¡¹ç›®</td></tr><tr><td>é…ç½®ä¸­å¿ƒï¼ˆZooKeeper/etcdï¼‰</td><td>ç•¥é«˜</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ˜¯</td><td>ç”Ÿäº§/åˆ†å¸ƒå¼ç¯å¢ƒ</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æ³¨æ„</p><ul class="lvl-2"><li class="lvl-4">DistSQL ç›®å‰ç¡®å®åªæ”¯æŒåœ¨ ShardingSphere-Proxy ä¸Šæ‰§è¡Œï¼Œå¹¶ä¸” Proxy åªæ”¯æŒ MySQL å’Œ PostgreSQL åè®®ã€‚</li><li class="lvl-4">å¦‚æœä½ åœ¨ Spring Boot + ShardingSphere-JDBC é‡Œç”¨ å…¶å®ƒæ•°æ®åº“ï¼ˆæ¯”å¦‚ SQL Serverã€Oracleã€DB2 ç­‰ï¼‰ï¼Œå°±æ— æ³•ç›´æ¥é€šè¿‡ DistSQL å»åŠ¨æ€æ”¹é…ç½®ã€‚</li><li class="lvl-4">æ­¤æ—¶ä½ å¯ä»¥é€‰æ‹©é€šè¿‡ Zookeeper çš„å®¢æˆ·ç«¯ç›´æ¥ä¿®æ”¹æˆ–é…ç½®è§„åˆ™ï¼Œä¹Ÿå¯ä»¥ä¸é€‰æ‹© <code>é…ç½®ä¸­å¿ƒ</code> çš„æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨ <code>æœ¬åœ°é…ç½®æ–‡ä»¶</code>ã€‚</li></ul></li></ul><h2 id="ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†åº“åˆ†è¡¨">ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†åº“åˆ†è¡¨</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åº“åˆ†è¡¨çš„ä¸»è¦ç›®çš„æ˜¯ <strong>è§£å†³æ•°æ®é‡å¤§å¸¦æ¥çš„æ€§èƒ½ã€å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§é—®é¢˜</strong>ã€‚é€šå¸¸éœ€è¦è€ƒè™‘çš„å‡ ä¸ªå…³é”®æŒ‡æ ‡ï¼š</p></li></ul><h3 id="1-æ•°æ®é‡æŒ‡æ ‡">1. æ•°æ®é‡æŒ‡æ ‡</h3><ul class="lvl-0"><li class="lvl-2"><p><strong>å•è¡¨æ•°æ®é‡è¿‡å¤§</strong>ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå•è¡¨æ•°æ®é‡åœ¨ <strong>åƒä¸‡çº§</strong> ä»¥ä¸Šæ—¶ï¼ŒæŸ¥è¯¢ã€å†™å…¥å’Œç´¢å¼•çš„æ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ã€‚</p></li><li class="lvl-2"><p>ä¾‹å¦‚ï¼šä¸€ä¸ªè®¢å•è¡¨ä¸€å¤©æœ‰ä¸Šç™¾ä¸‡æ¡æ•°æ®ï¼Œä¸€å¹´ä¸‹æ¥å¯èƒ½æœ‰ä¸Šäº¿æ¡ï¼Œå•è¡¨æ€§èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚</p></li></ul><h3 id="2-è®¿é—®é‡æŒ‡æ ‡">2. è®¿é—®é‡æŒ‡æ ‡</h3><ul class="lvl-0"><li class="lvl-2"><p><strong>é«˜å¹¶å‘å†™å…¥æˆ–æŸ¥è¯¢</strong>ï¼šæ•°æ®åº“è¿æ¥ã€äº‹åŠ¡é”ã€IO ç­‰èµ„æºä¼šæˆä¸ºç“¶é¢ˆã€‚</p></li><li class="lvl-2"><p>å¦‚æœä½ çš„ç³»ç»Ÿæ¯å¤©æœ‰ä¸Šåƒä¸‡çš„è¯·æ±‚ï¼Œæ•°æ®åº“å¯èƒ½æ— æ³•æ‰¿å—ã€‚</p></li></ul><h3 id="3-ä¸šåŠ¡éš”ç¦»éœ€æ±‚">3. ä¸šåŠ¡éš”ç¦»éœ€æ±‚</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸åŒä¸šåŠ¡çš„æ•°æ®åˆ†ç¦»ï¼Œé¿å…å•ä¸ªä¸šåŠ¡å½±å“æ•´ä¸ªæ•°æ®åº“çš„ç¨³å®šæ€§ã€‚</p></li><li class="lvl-2"><p>ä¾‹å¦‚ï¼šç”µå•†ç³»ç»Ÿä¸­çš„è®¢å•å’Œæ—¥å¿—æ•°æ®ï¼Œæ—¥å¿—é‡éå¸¸å¤§ï¼Œå’Œè®¢å•åˆ†å¼€å­˜å‚¨æ›´åˆç†ã€‚</p></li></ul><h3 id="4-è¿è¥ä¸æˆæœ¬å› ç´ ">4. è¿è¥ä¸æˆæœ¬å› ç´ </h3><ul class="lvl-0"><li class="lvl-2"><p>åˆ†åº“åˆ†è¡¨åï¼Œå¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸Šï¼Œæ”¯æŒ <strong>æ°´å¹³æ‰©å±•</strong>ï¼Œè€Œä¸å¿…ä¾èµ–æ˜‚è´µçš„å•æœºæ•°æ®åº“ã€‚</p></li></ul><h2 id="ä½¿ç”¨-ShardingSphere-å¯èƒ½å¸¦æ¥çš„é—®é¢˜">ä½¿ç”¨ ShardingSphere å¯èƒ½å¸¦æ¥çš„é—®é¢˜</h2><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨ <strong>ShardingSphere</strong> å¯ä»¥æ–¹ä¾¿åœ°è§£å†³åˆ†åº“åˆ†è¡¨é—®é¢˜ï¼Œä½†åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œå®ƒä¼šå¸¦æ¥ä¸€äº›æ–°çš„å¤æ‚æ€§å’Œæ½œåœ¨é—®é¢˜ï¼Œä¸»è¦ä½“ç°åœ¨æ€§èƒ½ã€è¿ç»´ã€åŠŸèƒ½é™åˆ¶ç­‰æ–¹é¢ã€‚</p></li></ul><h3 id="1-æ€§èƒ½ä¸å»¶è¿Ÿ">1. æ€§èƒ½ä¸å»¶è¿Ÿ</h3><ul class="lvl-0"><li class="lvl-2"><p><strong>è·¨åº“ JOIN æ€§èƒ½å·®</strong><br>åˆ†åº“åˆ†è¡¨åï¼Œè·¨åº“çš„ <code>JOIN</code> æŸ¥è¯¢ä¼šåœ¨å„ä¸ªåˆ†ç‰‡ä¸Šåˆ†åˆ«æ‰§è¡Œï¼Œç„¶ååœ¨ ShardingSphere å±‚åˆå¹¶ç»“æœï¼Œæ€§èƒ½æ˜æ˜¾ä¸‹é™ã€‚</p><ul class="lvl-2"><li class="lvl-4">ä¾‹å¦‚ï¼šè®¢å•è¡¨åœ¨å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢è®¢å• + ç”¨æˆ·ä¿¡æ¯æ—¶å¿…é¡»è·¨åº“ JOINï¼Œæ‰§è¡Œæ•ˆç‡æ¯”å•åº“ä½å¾ˆå¤šã€‚</li></ul></li><li class="lvl-2"><p><strong>åˆ†é¡µæŸ¥è¯¢æ…¢</strong><br>åˆ†åº“åˆ†è¡¨åï¼Œå¦‚æœè¦å…¨å±€æ’åº + åˆ†é¡µï¼Œéœ€è¦æ‰€æœ‰åˆ†ç‰‡æŸ¥å‡ºæ•°æ®å†åˆå¹¶ï¼Œä»£ä»·éå¸¸å¤§ã€‚</p><ul class="lvl-2"><li class="lvl-4">è§£å†³æ–¹å¼ï¼šä½¿ç”¨åˆ†ç‰‡é”®èŒƒå›´åˆ†é¡µï¼Œæˆ–å¼•å…¥ ElasticSearch/ClickHouse åšæœç´¢å’Œç»Ÿè®¡ã€‚</li></ul></li><li class="lvl-2"><p><strong>å¹¿æ’­è¡¨å‹åŠ›</strong><br>é…ç½®äº†å¹¿æ’­è¡¨ï¼ˆæ¯ä¸ªåº“ä¸€ä»½å®Œæ•´æ•°æ®ï¼‰åï¼Œæ›´æ–°éœ€è¦åŒæ­¥æ‰€æœ‰åº“ï¼Œå†™å…¥æ€§èƒ½ä¸‹é™ã€‚</p></li></ul><h3 id="2-SQL-å…¼å®¹æ€§é™åˆ¶">2. SQL å…¼å®¹æ€§é™åˆ¶</h3><ul class="lvl-0"><li class="lvl-2"><p><strong>å¤æ‚ SQL æ”¯æŒä¸å®Œæ•´</strong><br>ShardingSphere å¯¹æŸäº›å¤æ‚ SQLï¼ˆå¦‚å­æŸ¥è¯¢ã€çª—å£å‡½æ•°ï¼‰æ”¯æŒæœ‰é™ï¼Œå¯èƒ½æŠ¥é”™æˆ–æ€§èƒ½æå·®ã€‚</p></li><li class="lvl-2"><p><strong>å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨å—é™</strong><br>åˆ†åº“åˆ†è¡¨åï¼Œå­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨åœ¨åˆ†ç‰‡æ•°æ®åº“æ‰§è¡Œå¯èƒ½ä¸ä¸€è‡´ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚</p></li></ul><h3 id="3-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜">3. åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h3><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere æ”¯æŒ <strong>XA åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼Œä½†æ€§èƒ½ä¸å¦‚å•æœºäº‹åŠ¡ï¼Œå‡ºç°ç½‘ç»œæŠ–åŠ¨æ—¶å¯èƒ½ä¼šå¡ä½ã€‚</p></li><li class="lvl-2"><p>å¦‚æœä¸šåŠ¡éœ€è¦å¼ºä¸€è‡´æ€§ï¼Œå¿…é¡»ç»“åˆå¯é æ¶ˆæ¯æˆ– TCCã€SAGA ç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼ï¼Œæ¶æ„ä¼šæ›´å¤æ‚ã€‚</p></li></ul><h3 id="4-è¿ç»´ä¸ç®¡ç†å¤æ‚åº¦">4. è¿ç»´ä¸ç®¡ç†å¤æ‚åº¦</h3><ul class="lvl-0"><li class="lvl-2"><p><strong>åˆ†ç‰‡è§„åˆ™å˜æ›´å›°éš¾</strong><br>ä¾‹å¦‚ï¼Œæœ€åˆæŒ‰ <code>user_id % 2</code> åˆ†æˆä¸¤ä¸ªåº“ï¼Œåç»­æƒ³å¢åŠ åˆ° 4 ä¸ªåº“ï¼Œéœ€è¦è¿ç§»æ•°æ®ï¼Œéå¸¸éº»çƒ¦ã€‚</p></li><li class="lvl-2"><p><strong>ç›‘æ§ä¸è°ƒä¼˜</strong><br>ShardingSphere å¢åŠ äº†ä¸­é—´å±‚ï¼ŒSQL è·¯ç”±ã€æ‰§è¡Œè®¡åˆ’ã€æ•°æ®èŠ‚ç‚¹çŠ¶æ€éƒ½éœ€è¦é¢å¤–çš„ç›‘æ§å·¥å…·æ”¯æŒã€‚</p></li></ul><h3 id="5-æˆæœ¬ä¸å­¦ä¹ æ›²çº¿">5. æˆæœ¬ä¸å­¦ä¹ æ›²çº¿</h3><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®ç›¸å¯¹å¤æ‚ï¼šåˆ†ç‰‡è§„åˆ™ã€è¯»å†™åˆ†ç¦»ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€å¼¹æ€§æ‰©å®¹éƒ½éœ€è¦ä»”ç»†è®¾è®¡ã€‚</p></li><li class="lvl-2"><p>å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼šå¼€å‘å’Œè¿ç»´äººå‘˜å¿…é¡»äº†è§£ ShardingSphere çš„å·¥ä½œæœºåˆ¶ï¼Œå¦åˆ™å®šä½é—®é¢˜å¾ˆå›°éš¾ã€‚</p></li></ul><h3 id="6-é«˜å¯ç”¨ä¸æ‰©å±•é—®é¢˜">6. é«˜å¯ç”¨ä¸æ‰©å±•é—®é¢˜</h3><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere-JDBC æ˜¯åº”ç”¨å†…åº“ï¼Œæ— æ³•ç‹¬ç«‹æ‰©å±•ï¼Œéœ€è¦ä¾èµ–åº”ç”¨æ‰©å®¹ã€‚</p></li><li class="lvl-2"><p>ShardingSphere-Proxy æ”¯æŒé›†ç¾¤ï¼Œä½†éœ€è¦è‡ªå·±æ­å»ºé«˜å¯ç”¨æ¶æ„ï¼Œæ¶‰åŠè´Ÿè½½å‡è¡¡ã€æ•…éšœåˆ‡æ¢ç­‰é—®é¢˜ã€‚</p></li></ul><h2 id="å…¶å®ƒæŠ€æœ¯æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼æ•°æ®åº“">å…¶å®ƒæŠ€æœ¯æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼æ•°æ®åº“</h2><ul class="lvl-0"><li class="lvl-2"><p>å¼€æºäº§å“: æ ¸å¿ƒåŠŸèƒ½å®Œå…¨å¼€æºï¼Œä¼ä¸šç‰ˆæä¾›é¢å¤–å•†ä¸šç‰¹æ€§</p></li></ul><table><thead><tr><th>æ•°æ®åº“</th><th>æ¶æ„ç±»å‹</th><th>SQL å…¼å®¹æ€§</th><th>åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ</th><th>æ•°æ®å­˜å‚¨æ¨¡å‹</th><th>ä¸»è¦ç‰¹ç‚¹</th><th>å…¸å‹åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong><a href="https://www.pingcap.com/">TiDB</a></strong></td><td>åˆ†å¸ƒå¼ HTAP</td><td>MySQL åè®®å…¼å®¹</td><td>æ”¯æŒï¼ˆPercolator æ¨¡å‹ï¼‰</td><td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td><td>å¼€æºã€äº‘åŸç”Ÿã€å¼ºä¸€è‡´æ€§ã€å¼¹æ€§æ‰©å±•</td><td>åœ¨çº¿äº‹åŠ¡å¤„ç† + å®æ—¶åˆ†æ</td></tr><tr><td><strong><a href="https://en.oceanbase.com/">OceanBase</a></strong></td><td>åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td><td>MySQL/Oracle å…¼å®¹</td><td>æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</td><td>è¡Œå­˜</td><td>é«˜æ€§èƒ½ã€é‡‘èçº§äº‹åŠ¡ã€é˜¿é‡Œèš‚èšé‡‘æœæ ¸å¿ƒç³»ç»Ÿä½¿ç”¨</td><td>é‡‘èã€ç”µå•†ã€æ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿ</td></tr><tr><td><strong><a href="https://www.cockroachlabs.com/">CockroachDB</a></strong></td><td>åˆ†å¸ƒå¼ NewSQL</td><td>PostgreSQL å…¼å®¹</td><td>æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td><td>è¡Œå­˜</td><td>ç±» Spanner æ¶æ„ï¼Œå…¨çƒåˆ†å¸ƒï¼Œå¼ºä¸€è‡´æ€§</td><td>å…¨çƒåŒ–åˆ†å¸ƒå¼åº”ç”¨</td></tr><tr><td><strong><a href="https://www.citusdata.com/">Citus</a> (PostgreSQL)</strong></td><td>PostgreSQL æ‰©å±•</td><td>PostgreSQL å…¼å®¹</td><td>éƒ¨åˆ†æ”¯æŒï¼ˆåŸºäºé€»è¾‘åˆ†ç‰‡ï¼‰</td><td>è¡Œå­˜</td><td>åŸºäº PostgreSQL çš„åˆ†å¸ƒå¼æ‰©å±•ï¼Œæ”¯æŒå¤§è§„æ¨¡ OLAP</td><td>å¤§æ•°æ®å®æ—¶åˆ†æã€BI åœºæ™¯</td></tr><tr><td><strong><a href="https://vitess.io/">Vitess</a></strong></td><td>åˆ†å¸ƒå¼ä¸­é—´ä»¶ + å­˜å‚¨</td><td>MySQL åè®®å…¼å®¹</td><td>å¼±äº‹åŠ¡ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</td><td>è¡Œå­˜</td><td>YouTube å¼€æºï¼ŒK8s å‹å¥½ï¼Œåˆ†åº“åˆ†è¡¨è‡ªåŠ¨åŒ–</td><td>å¤§è§„æ¨¡ Web åº”ç”¨ï¼Œåœ¨çº¿æœåŠ¡</td></tr><tr><td><strong><a href="https://www.yugabyte.com/">YugabyteDB</a></strong></td><td>åˆ†å¸ƒå¼ SQL + NoSQL</td><td>PostgreSQL å…¼å®¹</td><td>æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</td><td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td><td>èåˆ NewSQL å’Œ NoSQLï¼Œå¼ºä¸€è‡´æ€§ï¼Œè·¨åŒºåŸŸéƒ¨ç½²</td><td>é‡‘èçº§äº‹åŠ¡ + åˆ†ææ··åˆåœºæ™¯</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å•†ä¸šäº§å“</p></li></ul><table><thead><tr><th>æ•°æ®åº“</th><th>æ¶æ„ç±»å‹</th><th>SQL å…¼å®¹æ€§</th><th>åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ</th><th>æ•°æ®å­˜å‚¨æ¨¡å‹</th><th>ä¸»è¦ç‰¹ç‚¹</th><th>å…¸å‹åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong><a href="https://www.alibabacloud.com/product/polardb">PolarDB</a></strong></td><td>äº‘åŸç”Ÿåˆ†å¸ƒå¼æ•°æ®åº“</td><td>MySQL/PostgreSQL å…¼å®¹</td><td>æ”¯æŒï¼ˆäº‘ç«¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td><td>è¡Œå­˜</td><td>é˜¿é‡Œäº‘äº§å“ï¼Œå¼¹æ€§æ‰©å®¹ï¼Œå­˜å‚¨è®¡ç®—åˆ†ç¦»</td><td>äº‘ä¸Šä¼ä¸šæ•°æ®åº“è§£å†³æ–¹æ¡ˆ</td></tr><tr><td><strong><a href="https://www.huaweicloud.com/product/gaussdb.html">GaussDB</a></strong></td><td>åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td><td>MySQL/Oracle å…¼å®¹</td><td>æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td><td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td><td>åä¸ºæ¨å‡ºï¼Œåˆ†å¸ƒå¼ HTAPï¼Œäº‘åŸç”Ÿæ¶æ„</td><td>ä¼ä¸šçº§ OLTP + OLAP æ··åˆè´Ÿè½½</td></tr><tr><td><strong><a href="https://cloud.google.com/spanner">Spanner</a></strong></td><td>å…¨çƒåˆ†å¸ƒå¼æ•°æ®åº“</td><td>ç±» SQL</td><td>æ”¯æŒï¼ˆTrueTime åè®®ï¼‰</td><td>è¡Œå­˜</td><td>Google äº‘äº§å“ï¼Œå…¨çƒåˆ†å¸ƒå¼å¼ºä¸€è‡´äº‹åŠ¡</td><td>å…¨çƒåŒ–åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé‡‘èåœºæ™¯</td></tr><tr><td><strong><a href="https://aws.amazon.com/rds/aurora/">Amazon Aurora</a></strong></td><td>äº‘åŸç”Ÿåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td><td>MySQL/PostgreSQL å…¼å®¹</td><td>æ”¯æŒï¼ˆå•å®ä¾‹äº‹åŠ¡ï¼Œå¤š AZ é«˜å¯ç”¨ï¼‰</td><td>è¡Œå­˜</td><td>AWS æ‰˜ç®¡ï¼Œè‡ªåŠ¨æ‰©å±•å­˜å‚¨ï¼Œå¤šå¯ç”¨åŒºé«˜å¯ç”¨</td><td>OLTPã€ä¼ä¸šçº§ä¸šåŠ¡</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://shardingsphere.apache.org/index_zh.html&quot;&gt;ShardingSphereå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åœ¨ &lt;a href=&quot;/2025/09/04/springboot3-shardingsphere-proxy/&quot; title=&quot;SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨&quot;&gt;SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨&lt;/a&gt; çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/sharding-sphere/"/>
    
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/tags/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/tags/sharding-sphere/"/>
    
  </entry>
  
  <entry>
    <title>Maven ç§æœ Nexus å‡çº§å®å½•</title>
    <link href="https://blog.hanqunfeng.com/2025/09/08/maven-nexus-upgrade/"/>
    <id>https://blog.hanqunfeng.com/2025/09/08/maven-nexus-upgrade/</id>
    <published>2025-09-08T13:30:05.000Z</published>
    <updated>2025-09-15T06:26:27.872Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» Mavne ç§æœ Nexus å‡çº§çš„å…¨è¿‡ç¨‹ï¼Œä» <code>3.29.2-02</code> å‡çº§åˆ° <code>3.83.2-01</code></p></li><li class="lvl-2"><p><a href="https://help.sonatype.com/en/sonatype-nexus-repository.html">Nexuså®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://mirrors.tuna.tsinghua.edu.cn/Adoptium/">OpenJdkä¸‹è½½åœ°å€</a></p></li><li class="lvl-2"><p><a href="https://help.sonatype.com/en/sonatype-nexus-repository-system-requirements.html">Nexusç³»ç»Ÿé…ç½®è¦æ±‚</a></p></li></ul><span id="more"></span><h2 id="å‡çº§è¿‡ç¨‹è¯´æ˜">å‡çº§è¿‡ç¨‹è¯´æ˜</h2><ul class="lvl-0"><li class="lvl-2"><p>Nexus ä» <code>3.71.x</code> å¼€å§‹ï¼Œä¸å†æ”¯æŒ <code>OrientDB</code>ï¼Œåç»­ç‰ˆæœ¬ä»…æ”¯æŒ <code>H2</code> å’Œ <code>PostgreSQL</code> ï¼Œæ ¹æ®<a href="https://help.sonatype.com/en/upgrading-to-nexus-repository-3-71-0-and-beyond.html">å®˜ç½‘è¯´æ˜</a>ï¼Œ<code>3.70.x</code> ä»¥ä¸‹çš„ç‰ˆæœ¬éœ€è¦å°† Nexus å…ˆå‡çº§åˆ° <code>3.70.x</code> çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç„¶åä½¿ç”¨å®˜æ–¹æä¾›çš„æ•°æ®åº“è¿ç§»å·¥å…·ï¼Œå°†æ•°æ®åº“è¿ç§»åˆ° <code>H2</code> åï¼Œå†å‡çº§åˆ° <code>3.71.x</code> ä»¥åçš„ç‰ˆæœ¬</p></li></ul><h2 id="ä»-3-29-2-02-å‡çº§åˆ°-nexus-3-70-4-02">ä» <code>3.29.2-02</code> å‡çº§åˆ° <code>nexus-3.70.4-02</code></h2><h3 id="å®‰è£…-OpenJDK">å®‰è£… <code>OpenJDK</code></h3><ul class="lvl-0"><li class="lvl-2"><p>éœ€è¦å…ˆå®‰è£…å¥½ <code>OpenJDK</code>ï¼ŒåŸå› æ˜¯<code>Nexusçš„æ•°æ®åº“è¿ç§»å·¥å…·</code>ä»…æ”¯æŒ <code>OpenJDK</code>ï¼Œä¸æ”¯æŒ <code>Oracle JDK</code>ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©å®‰è£… <code>OpenJDK11</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local</span><br><span class="line">curl -O https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class="line">tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/jdk-11.0.28+6/bin/java /usr/bin/java</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk-11.0.28+6</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…-nexus-3-70-x">å®‰è£… <code>nexus-3.70.x</code></h3><ul class="lvl-0"><li class="lvl-2"><p>ç›®å‰å®˜ç½‘å‘å¸ƒçš„<code>nexus-3.70.x</code>çš„æœ€æ–°ç‰ˆæœ¬ä¸º <code>nexus-3.70.4-02</code>ï¼Œ<a href="https://help.sonatype.com/en/orientdb-downloads.html">ä¸‹è½½é¡µé¢</a>ï¼Œå…¶å¯¹åº”çš„æ•°æ®åº“è¿ç§»å·¥å…·ä¹Ÿå¯ä»¥ä»è¯¥é¡µé¢ä¸‹è½½ã€‚</p></li><li class="lvl-2"><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹© <a href="https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gz">Java 11 çš„ç‰ˆæœ¬</a>ï¼Œå‡çº§å®‰è£…ä¸ç¬¬ä¸€æ¬¡å®‰è£…æ–¹å¼ä¸€æ ·ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ° nexus ç”¨æˆ·ï¼ŒåŸ nexus-3.29.2-02 å°±å®‰è£…åœ¨ è¯¥ç”¨æˆ·çš„ `home` ç›®å½•ä¸‹</span></span><br><span class="line">su - nexus</span><br><span class="line"><span class="comment"># å…³é—­ åŸ nexus æœåŠ¡ï¼Œå…³äºå¦‚ä½•å°† Nexus é…ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://help.sonatype.com/en/run-as-a-service.html</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop nexus</span><br><span class="line"><span class="comment">#~/nexus3/bin/nexus stop</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éœ€è¦ç§‘å­¦ä¸Šç½‘</span></span><br><span class="line">curl -O https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gz</span><br><span class="line">tar -zxvf nexus-3.70.4-02-java11-unix.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -f ~/nexus3</span><br><span class="line"><span class="built_in">ln</span> -s /usr/local/nexus-3.70.4-02 ~/nexus3</span><br><span class="line"><span class="comment"># å¯åŠ¨ nexus</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start nexus</span><br><span class="line"><span class="comment"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure><h3 id="è¿ç§»æ•°æ®åˆ°-H2">è¿ç§»æ•°æ®åˆ° H2</h3><ul class="lvl-0"><li class="lvl-2"><p>ä¸‹è½½æ•°æ®åº“è¿ç§»å·¥å…·</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/backup</span><br><span class="line"><span class="built_in">cd</span> ~/backup</span><br><span class="line"><span class="comment"># ä¸ nexus ç‰ˆæœ¬ä¸€è‡´</span></span><br><span class="line">curl -O https://download.sonatype.com/nexus/nxrm3-migrator/nexus-db-migrator-3.70.4-02.jar</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç™»å½• Nexus å¯¼å‡ºæ•°æ®: è®¾ç½® -&gt; System -&gt; Tasks -&gt; Create task -&gt; Admin - Export databases for backup<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/MS26e5.png" alt=""></p></li><li class="lvl-2"><p>ä»»åŠ¡åˆ›å»ºåç‚¹å‡»<code>Run</code>ï¼Œå³å¯åœ¨ <code>/home/nexus/backup</code> ç›®å½•ä¸‹çœ‹åˆ°å¤‡ä»½æ–‡ä»¶</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ll /home/nexus/backup</span><br><span class="line">-rw-rw-r-- 1 nexus nexus   121066 Sep  8 07:25 analytics-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class="line">-rw-rw-r-- 1 nexus nexus 19349428 Sep  8 07:25 component-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class="line">-rw-rw-r-- 1 nexus nexus   266208 Sep  8 07:25 config-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class="line">-rw-r--r-- 1 nexus nexus 56809625 Sep  8 06:41 nexus-db-migrator-3.70.4-02.jar</span><br><span class="line">-rw-rw-r-- 1 nexus nexus   132802 Sep  8 07:25 security-2025-09-08-07-25-57-3.70.4-02.bak</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä½¿ç”¨è¿ç§»å·¥å…·ç”ŸæˆH2æ•°æ®åº“æ–‡ä»¶ï¼Œå®˜ç½‘å‚è€ƒèµ„æ–™: <a href="https://help.sonatype.com/en/migrating-to-a-new-database.html#migrating-from-orientdb-to-h2">Migrating From OrientDB to H2</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å§‹è¿ç§»å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop nexus</span><br><span class="line"><span class="comment"># ~/nexus3/bin/nexus stop</span></span><br><span class="line"><span class="comment"># è¿›å…¥å¤‡ä»½ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /home/nexus/backup</span><br><span class="line"><span class="comment"># è¿™é‡Œè¦ä½¿ç”¨ OpenJDK 11 è¿è¡Œï¼Œæ ¹æ®éœ€è¦é€‚å½“è°ƒæ•´å†…å­˜å‚æ•°</span></span><br><span class="line">java -Xmx2G -Xms2G -XX:+UseG1GC -jar nexus-db-migrator-3.70.4-02.jar --migration_type=h2</span><br><span class="line"><span class="comment"># è¿è¡Œåä¼šæç¤ºä½ è¿ç§»æ•°æ®åº“å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡ï¼Œæˆ‘ä»¬è¾“å…¥ y ç»§ç»­</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡ŒæˆåŠŸåä¼šç”Ÿæˆ <code>nexus.mv.db</code>ï¼Œå°†å…¶ç§»åŠ¨åˆ° <code>/home/nexus/sonatype-work/nexus3/db/</code> ç›®å½•ä¸‹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> nexus.mv.db /home/nexus/sonatype-work/nexus3/db/</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ç¼–è¾‘<code>/home/nexus/sonatype-work/nexus3/etc/nexus.properties</code> æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># enable db h2</span></span><br><span class="line">nexus.datastore.enabled=<span class="literal">true</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¯åŠ¨ nexusï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å®Œæˆäº† ä» <code>3.29.2-02</code> åˆ° <code>nexus-3.70.4-02</code> çš„å‡çº§</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start nexus</span><br><span class="line"><span class="comment"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure><h2 id="ä»-nexus-3-70-4-02-å‡çº§åˆ°-nexus-3-83-2-01">ä» <code>nexus-3.70.4-02</code> å‡çº§åˆ° <code>nexus-3.83.2-01</code></h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™ä¸ªå‡çº§å°±æ¯”è¾ƒç®€å•äº†ï¼Œå’Œæˆ‘ä»¬æ­¤å‰çš„å‡çº§æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œä¸‹è½½è§£å‹åæ›¿æ¢å®‰è£…ç›®å½•å³å¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œä»<code>nexus-3.71.0+</code>å¼€å§‹ä»…æ”¯æŒ<code>jdk17</code>ï¼Œæ‰€ä»¥éœ€è¦æå‰å®‰è£…å¥½<code>jdk17</code>ï¼Œå¦å¤–ä»<code>nexus-3.78.0</code>å¼€å§‹ï¼ŒNexus å†…ç½®äº†<code>openjdk17</code>ï¼Œæ‰€ä»¥ä¸éœ€è¦å†é¢å¤–å®‰è£…jdkã€‚</p></li><li class="lvl-2"><p><code>nexus-3.83.2-01</code> æ˜¯ç›®å‰çš„æœ€æ–°ç‰ˆï¼Œ<a href="https://help.sonatype.com/en/download.html">æœ€æ–°ç‰ˆä¸‹è½½é¡µé¢</a>ï¼Œ<a href="https://help.sonatype.com/en/download-archives---repository-manager-3.html">å†å²ç‰ˆæœ¬ä¸‹è½½é¡µé¢åœ°å€</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­ Nexus æœåŠ¡</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop nexus</span><br><span class="line"><span class="comment"># ~/nexus3/bin/nexus stop</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">curl -O https://download.sonatype.com/nexus/3/nexus-3.83.2-01-linux-x86_64.tar.gz</span><br><span class="line">tar -zxvf nexus-3.83.2-01-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -f nexus3</span><br><span class="line"><span class="built_in">ln</span> -s nexus-3.83.2-01 nexus3</span><br><span class="line"><span class="comment"># å¯åŠ¨ Nexusï¼Œnexus-3.83.2-01 è‡ªå¸¦ openjdk17ï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬å®‰è£… openjdk</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start nexus</span><br><span class="line"><span class="comment"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/rgLwWf.png" alt=""><br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/mdWh22.png" alt="" width="1400" height="1000"><br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/56aOWz.png" alt=""></p>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» Mavne ç§æœ Nexus å‡çº§çš„å…¨è¿‡ç¨‹ï¼Œä» &lt;code&gt;3.29.2-02&lt;/code&gt; å‡çº§åˆ° &lt;code&gt;3.83.2-01&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://help.sonatype.com/en/sonatype-nexus-repository.html&quot;&gt;Nexuså®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://mirrors.tuna.tsinghua.edu.cn/Adoptium/&quot;&gt;OpenJdkä¸‹è½½åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://help.sonatype.com/en/sonatype-nexus-repository-system-requirements.html&quot;&gt;Nexusç³»ç»Ÿé…ç½®è¦æ±‚&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="maven" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/maven/"/>
    
    <category term="nexus" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/maven/nexus/"/>
    
    
    <category term="mavne" scheme="https://blog.hanqunfeng.com/tags/mavne/"/>
    
    <category term="nexus" scheme="https://blog.hanqunfeng.com/tags/nexus/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨</title>
    <link href="https://blog.hanqunfeng.com/2025/09/04/springboot3-shardingsphere-proxy/"/>
    <id>https://blog.hanqunfeng.com/2025/09/04/springboot3-shardingsphere-proxy/</id>
    <published>2025-09-04T13:30:05.000Z</published>
    <updated>2025-09-15T06:26:28.249Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/index_zh.html">ShardingSphereå®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy">æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€</a></p></li><li class="lvl-2"><p>æœ¬æ–‡å°† <a href="/2025/09/01/springboot3-shardingsphere/" title="SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨">SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨</a> ä¿®æ”¹ä¸º <code>ShardingSphere-Proxy</code> çš„æ¨¡å¼</p></li></ul><span id="more"></span><h2 id="ShardingSphere-Proxy-ç®€ä»‹">ShardingSphere-Proxy ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere-Proxy å®šä½ä¸ºé€æ˜åŒ–çš„æ•°æ®åº“ä»£ç†ç«¯ï¼Œé€šè¿‡å®ç°æ•°æ®åº“äºŒè¿›åˆ¶åè®®ï¼Œå¯¹å¼‚æ„è¯­è¨€æä¾›æ”¯æŒã€‚ ç›®å‰æä¾› MySQL å’Œ PostgreSQL åè®®ï¼Œé€æ˜åŒ–æ•°æ®åº“æ“ä½œï¼Œå¯¹ DBA æ›´åŠ å‹å¥½ã€‚</p><ul class="lvl-2"><li class="lvl-4">å‘åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ï¼Œå¯ç›´æ¥å½“åš MySQL/PostgreSQL ä½¿ç”¨ï¼›</li><li class="lvl-4">å…¼å®¹ MariaDB ç­‰åŸºäº MySQL åè®®çš„æ•°æ®åº“ï¼Œä»¥åŠ openGauss ç­‰åŸºäº PostgreSQL åè®®çš„æ•°æ®åº“ï¼›</li><li class="lvl-4">é€‚ç”¨äºä»»ä½•å…¼å®¹ MySQL/PostgreSQL åè®®çš„çš„å®¢æˆ·ç«¯ï¼Œå¦‚ï¼šMySQL Command Client, MySQL Workbench, Navicat ç­‰ã€‚</li></ul></li><li class="lvl-2"><p>ShardingSphere-Proxy ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/AMn2pu.png" alt=""></p></li><li class="lvl-2"><p>ShardingSphere-Proxy ä¸ ShardingSphere-JDBC çš„ç‰¹æ€§æ¯”è¾ƒ</p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>ShardingSphere-JDBC</th><th>ShardingSphere-Proxy</th></tr></thead><tbody><tr><td><strong>æ•°æ®åº“æ”¯æŒ</strong></td><td>ä»»æ„æ•°æ®åº“</td><td>MySQL / PostgreSQL</td></tr><tr><td><strong>è¿æ¥æ¶ˆè€—æ•°</strong></td><td>é«˜</td><td>ä½</td></tr><tr><td><strong>å¼‚æ„è¯­è¨€æ”¯æŒ</strong></td><td>ä»…æ”¯æŒ Java</td><td>æ”¯æŒä»»æ„è¯­è¨€</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>æŸè€—ä½</td><td>æŸè€—ç•¥é«˜</td></tr><tr><td><strong>æ— ä¸­å¿ƒåŒ–</strong></td><td>æ˜¯</td><td>å¦</td></tr><tr><td><strong>é™æ€å…¥å£</strong></td><td>æ— </td><td>æœ‰</td></tr></tbody></table><h2 id="éƒ¨ç½²-ShardingSphere-Proxy">éƒ¨ç½² ShardingSphere-Proxy</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿è¡Œ ShardingSphere-Proxy è¦æ±‚ JDK 1.8+</p></li><li class="lvl-2"><p>ä¸‹è½½ <a href="https://shardingsphere.apache.org/document/current/cn/downloads/">ShardingSphere-Proxy5.5.2</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.apache.org/dyn/closer.lua/shardingsphere/5.5.2/apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxvf apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gz</span><br><span class="line"><span class="built_in">cd</span> apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-ShardingSphere-Proxy">é…ç½® ShardingSphere-Proxy</h2><ul class="lvl-0"><li class="lvl-2"><p><code>conf/global.yaml</code>: å…¨å±€é…ç½®ï¼Œæ‰€è°“å…¨å±€ï¼Œå°±æ˜¯å¯¹æ‰€æœ‰é€»è¾‘åº“éƒ½ç”Ÿæ•ˆçš„é…ç½®</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/authority/</span></span><br><span class="line"><span class="attr">authority:</span></span><br><span class="line"> <span class="attr">users:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">user:</span> <span class="string">root@127.0.0.1</span> <span class="comment"># æ ¼å¼ï¼šç”¨æˆ·å@IP</span></span><br><span class="line">     <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">     <span class="attr">admin:</span> <span class="literal">true</span>          <span class="comment"># æ˜¯å¦æ˜¯ç®¡ç†å‘˜</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">user:</span> <span class="string">sharding@%</span>     <span class="comment"># æ‰€æœ‰IPéƒ½å¯ä»¥è®¿é—®</span></span><br><span class="line">     <span class="attr">password:</span> <span class="string">sharding</span></span><br><span class="line"> <span class="attr">privilege:</span></span><br><span class="line">   <span class="attr">type:</span> <span class="string">DATABASE_PERMITTED</span> <span class="comment"># æƒé™ç±»å‹</span></span><br><span class="line">   <span class="attr">props:</span></span><br><span class="line">      <span class="attr">user-database-mappings:</span> <span class="string">root@127.0.0.1=*,sharding@%=sharding_db</span> <span class="comment"># ç”¨æˆ·æƒé™æ˜ å°„ï¼Œ*è¡¨ç¤ºæ‰€æœ‰æ•°æ®åº“</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯XAäº‹åŠ¡ï¼Œå¦‚æœæ˜¯ springbooté¡¹ç›®ï¼Œåªéœ€è¦åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Š @Transactional æ³¨è§£å³å¯å¼€å¯äº‹åŠ¡(ä» MySQL 5.7 å¼€å§‹å°±å…¨é¢æ”¯æŒ XA åˆ†å¸ƒå¼äº‹åŠ¡)</span></span><br><span class="line"><span class="comment"># https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/</span></span><br><span class="line"><span class="attr">transaction:</span>  <span class="comment"># é…ç½®äº‹åŠ¡</span></span><br><span class="line">  <span class="attr">defaultType:</span> <span class="string">XA</span>        <span class="comment"># äº‹åŠ¡ç±»å‹ï¼Œé»˜è®¤ LOCAL</span></span><br><span class="line">  <span class="attr">providerType:</span> <span class="string">Atomikos</span> <span class="comment"># äº‹åŠ¡ç®¡ç†å™¨å…·ä½“å®ç°ï¼Œé»˜è®¤å°±æ˜¯ Atomikos</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/props/</span></span><br><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span> <span class="comment"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class="line">  <span class="attr">check-table-metadata-enabled:</span> <span class="literal">false</span> <span class="comment"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>conf/database-my.yaml</code>: è‡ªå®šä¹‰åˆ†é…è§„åˆ™é…ç½®</p></li></ul><blockquote><p>æ³¨æ„:<br>1.åç§°å¿…é¡»ä»¥ <code>database-</code>å¼€å¤´ï¼Œå®é™…ä¸Š<code>conf</code>ç›®å½•ä¸‹æœ‰å¾ˆå¤šç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®<br>2.<code>global.yaml</code>ä¸­çš„é…ç½®é¡¹ä¸èƒ½é…ç½®åˆ° <code>database-my.yaml</code>ä¸­</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class="line"><span class="attr">databaseName:</span> <span class="string">sharding_db</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/</span></span><br><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_0:</span> <span class="comment"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class="line">    <span class="comment"># dataSourceClassName: com.zaxxer.hikari.HikariDataSource # ä¸è¦æŒ‡å®š</span></span><br><span class="line">    <span class="comment"># driverClassName: com.mysql.cj.jdbc.Driver               # ä¸è¦æŒ‡å®š</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>  <span class="comment"># æ³¨æ„è¿™é‡Œå±æ€§ä¸º url</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ds_1:</span></span><br><span class="line">    <span class="comment"># dataSourceClassName: com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="comment"># driverClassName: com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹è§„åˆ™ä¸å‰æ–‡ä¸­çš„ shardingsphere-jdbc ä¸­çš„ rules ç›¸åŒ</span></span><br><span class="line"><span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="comment"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class="line">    <span class="attr">bindingTables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t_order,t_order_item</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">course:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">cid</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_inline</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">cid</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order-complex-algorithm</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_item-class-based-algorithm_spi</span> <span class="comment"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">t_user:</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">id</span> <span class="comment"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">          <span class="comment">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">custom_snowflake_string</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#       t_address:      # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜</span></span><br><span class="line">    <span class="comment">#         actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">autoTables:</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/</span></span><br><span class="line">      <span class="attr">course_inline:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># å±æ€§</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">course_$&#123;cid</span> <span class="string">%</span> <span class="number">2</span> <span class="string">+</span> <span class="number">1</span><span class="string">&#125;</span> <span class="comment"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class="line">          <span class="attr">allow-range-query-with-inline-sharding:</span> <span class="literal">true</span> <span class="comment"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">      <span class="attr">course_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span> <span class="comment"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class="line">      <span class="attr">mod_2:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MOD</span> <span class="comment"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">sharding-count:</span> <span class="number">2</span> <span class="comment"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class="line">      <span class="attr">t_order_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order-complex-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">COMPLEX_INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_order_complex_$&#123;(user_id</span> <span class="string">+</span> <span class="string">order_id</span> <span class="string">+</span> <span class="number">1</span><span class="string">)</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm_spi:</span> <span class="comment"># SPI</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">T_ORDER_ITEM_COMPLEX</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_user_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span></span><br><span class="line">      <span class="attr">t_user_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br><span class="line">      <span class="attr">uuid:</span> <span class="comment"># å®šä¹‰åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">UUID</span> <span class="comment"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class="line">      <span class="attr">custom_snowflake_string:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CUSTOM_SNOWFLAKE_STRING</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">workerId:</span> <span class="number">2</span></span><br><span class="line">          <span class="attr">datacenterId:</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!BROADCAST</span>  <span class="comment"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dict</span>    <span class="comment"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!ENCRYPT</span>    <span class="comment"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span> <span class="comment"># åŠ å¯†è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># åŠ å¯†åˆ—åç§°</span></span><br><span class="line">            <span class="attr">cipher:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">password</span> <span class="comment"># å¯†æ–‡åˆ—åç§°</span></span><br><span class="line">              <span class="attr">encryptorName:</span> <span class="string">aes_encryptor</span> <span class="comment"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class="line">    <span class="comment"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class="line">    <span class="attr">encryptors:</span></span><br><span class="line">      <span class="attr">aes_encryptor:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">AES</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line">          <span class="attr">aes-key-value:</span> <span class="string">123456abc</span>     <span class="comment"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class="line">          <span class="attr">digest-algorithm-name:</span> <span class="string">SHA-1</span> <span class="comment"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class="line">      <span class="attr">md5_encryptor:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">salt:</span> <span class="number">123456</span>  <span class="comment"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!MASK</span>  <span class="comment"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span> <span class="comment"># è„±æ•è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span> <span class="comment"># è„±æ•åˆ—é…ç½®</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># è„±æ•åˆ—åç§°</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">md5_mask</span> <span class="comment"># è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">email:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">mask_before_special_chars_mask</span></span><br><span class="line">          <span class="attr">telephone:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">keep_first_n_last_m_mask</span></span><br><span class="line">          <span class="attr">name:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">my_mask</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">maskAlgorithms:</span> <span class="comment"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class="line">      <span class="attr">md5_mask:</span> <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span>  <span class="comment"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class="line">      <span class="attr">mask_before_special_chars_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MASK_BEFORE_SPECIAL_CHARS</span> <span class="comment"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">special-chars:</span> <span class="string">&#x27;@&#x27;</span>  <span class="comment"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span>   <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">keep_first_n_last_m_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">KEEP_FIRST_N_LAST_M</span> <span class="comment"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">first-n:</span> <span class="number">3</span>     <span class="comment"># ä¿ç•™å‰ 3 ä½</span></span><br><span class="line">          <span class="attr">last-m:</span> <span class="number">4</span>      <span class="comment"># ä¿ç•™å 4 ä½</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">my_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MY_CUSTOM_MASK</span>  <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&quot;#&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SINGLE</span> <span class="comment"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="comment"># MySQL é£æ ¼</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ds_0.t_address</span> <span class="comment"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br><span class="line"><span class="comment">#       - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨</span></span><br><span class="line"><span class="comment">#       - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢çš„<code>rules</code>ä¸­ä½¿ç”¨çš„æ˜¯<code>mysql</code>æ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥<code>mysql</code>æ•°æ®åº“çš„ä¾èµ–</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/</span><br><span class="line"><span class="built_in">mkdir</span> ext-lib</span><br><span class="line"><span class="built_in">cd</span> ext-lib</span><br><span class="line">wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åŒæ—¶<code>rules</code>ä¸­åŒ…å«ä¸€äº›è‡ªå®šä¹‰çš„ç®—æ³•ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†è¿™äº›ç®—æ³•ä½œä¸ºä¾èµ–è¿›è¡Œå¼•å…¥ï¼Œå°†è¿™äº›ç®—æ³•ç±»æ‰“æˆ<code>jar</code>ï¼Œç„¶åä¹Ÿæ‹·è´åˆ°<code>ext-lib</code>ç›®å½•ä¸‹ï¼Œæˆ‘å·²ç»å°†å…¶å‘å¸ƒåˆ°äº†githubä¸Šï¼Œå®é™…ä¸Šå’Œå‰æ–‡ä¸­çš„ <code>shardingsphere-jdbc</code> é¡¹ç›®ä¸­å°†ç®—æ³•é…ç½®ä¸º <code>spi</code> çš„æ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. åªå…‹éš†ä»“åº“çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¸ä¸‹è½½æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">git <span class="built_in">clone</span> --filter=blob:none --sparse https://github.com/hanqunfeng/springbootchapter.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è¿›å…¥ä»“åº“ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> springbootchapter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è®¾ç½®åªæ£€å‡ºä½ éœ€è¦çš„ç›®å½•</span></span><br><span class="line">git sparse-checkout <span class="built_in">set</span> springboot3-demo/shardingsphere-demo/algorithm-swapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. ç¼–è¯‘æ‰“åŒ…</span></span><br><span class="line"><span class="built_in">cd</span> springboot3-demo/shardingsphere-demo/algorithm-swapper</span><br><span class="line">mvn clean package -DskipTests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. å°†æ‰“å¥½çš„åŒ…å¤åˆ¶åˆ° shardingsphere-proxy çš„ ext-lib ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">cp</span> target/algorithm-swapper-1.0.0.jar <span class="variable">$shardingsphere</span>-proxy$/ext-lib</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨ä¸å…³é—­-ShardingSphere-Proxy">å¯åŠ¨ä¸å…³é—­ ShardingSphere Proxy</h2><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere Proxy è¦æ±‚ JDK 1.8 æˆ–ä»¥ä¸Šç‰ˆæœ¬</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$shardingsphere</span>-proxy$/bin</span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">./start.sh</span><br><span class="line"><span class="comment"># å…³é—­</span></span><br><span class="line">./stop.sh</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‚æ•°è¯´æ˜</p></li></ul><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>-a</code></td><td>ç»‘å®šåœ°å€ï¼Œå¯ä»¥æ˜¯ IPv4ã€IPv6 æˆ–ä¸»æœºåï¼Œå¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”ã€‚</td><td><code>0.0.0.0</code></td></tr><tr><td><code>-p</code></td><td>ç»‘å®šç«¯å£å·ï¼Œå¯ä»¥åœ¨ <code>global.yaml</code> ä¸­ä¿®æ”¹ã€‚<code>-p</code> ä¼˜å…ˆçº§æ›´é«˜</td><td><code>3307</code></td></tr><tr><td><code>-c</code></td><td>ShardingSphere-Proxy é…ç½®ç›®å½•è·¯å¾„ã€‚</td><td><code>conf</code></td></tr><tr><td><code>-f</code></td><td>å¼ºåˆ¶å¯åŠ¨ ShardingSphere-Proxyã€‚</td><td>æ— </td></tr><tr><td><code>-g</code></td><td>å¦‚æœåœ¨ <code>agent</code> ç›®å½•ä¸‹éƒ¨ç½²äº† <code>shardingsphere-agent</code>ï¼Œå¯ç”¨ agent åŠŸèƒ½ã€‚</td><td>æ— </td></tr><tr><td><code>-s</code></td><td>æŒ‡å®šç”¨äºè¿æ¥çš„ socket æ–‡ä»¶è·¯å¾„ã€‚</td><td>æ— </td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere-Proxy å¯åŠ¨å‘½ä»¤é€ŸæŸ¥è¡¨</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>å‘½ä»¤ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>é»˜è®¤å¯åŠ¨</strong></td><td><code>./start.sh</code></td><td>é»˜è®¤ç«¯å£ <code>3307</code>ï¼Œé…ç½®ç›®å½• <code>conf</code></td></tr><tr><td><strong>æŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½•</strong></td><td><code>./start.sh 3308 /opt/shardingsphere-proxy/conf</code></td><td>ç®€å†™æ¨¡å¼ï¼ŒæŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½•</td></tr><tr><td><strong>å‚æ•°å½¢å¼å¯åŠ¨</strong></td><td><code>./start.sh -p 3308 -c /opt/shardingsphere-proxy/conf</code></td><td>ä¸ä¸Šé¢ç­‰æ•ˆï¼Œä½†æ›´æ˜ç¡®</td></tr><tr><td><strong>æŒ‡å®šç›‘å¬åœ°å€</strong></td><td><code>./start.sh -a 192.168.1.100 -p 3307 -c conf</code></td><td>æŒ‡å®šå•ä¸ª IP åœ°å€</td></tr><tr><td><strong>æŒ‡å®šå¤šä¸ªç›‘å¬åœ°å€</strong></td><td><code>./start.sh -a 192.168.1.100,127.0.0.1 -p 3307 -c conf</code></td><td>å¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”</td></tr><tr><td><strong>å¼ºåˆ¶å¯åŠ¨</strong></td><td><code>./start.sh -p 3307 -c conf -f</code></td><td>é‡åˆ°æ®‹ç•™ PID æ–‡ä»¶æ—¶ä½¿ç”¨</td></tr><tr><td><strong>å¯ç”¨ agent</strong></td><td><code>./start.sh -p 3307 -c conf -g</code></td><td>å¯åŠ¨ ShardingSphere-Agent</td></tr><tr><td><strong>ä½¿ç”¨ Unix Socket</strong></td><td><code>./start.sh -p 3307 -c conf -s /tmp/sharding-proxy.sock</code></td><td>é€šè¿‡ Socket æ–‡ä»¶è¿›è¡Œè¿æ¥</td></tr><tr><td><strong>å¤šé€‰é¡¹ç»„åˆ</strong></td><td><code>./start.sh -a 127.0.0.1 -p 3310 -c /opt/proxy/conf -f -g -s /tmp/proxy.sock</code></td><td>ä¸€æ¬¡æ€§æŒ‡å®šå¤šä¸ªé€‰é¡¹</td></tr></tbody></table><h2 id="é¡¹ç›®è¿æ¥-ShardingSphere-Proxy-æ—¶ï¼Œå°±åƒè¿æ¥æ™®é€šçš„-mysql-æœåŠ¡ä¸€æ ·">é¡¹ç›®è¿æ¥ ShardingSphere-Proxy æ—¶ï¼Œå°±åƒè¿æ¥æ™®é€šçš„ mysql æœåŠ¡ä¸€æ ·</h2><ul class="lvl-0"><li class="lvl-2"><p>ç¤ºä¾‹é¡¹ç›®ï¼š<a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy">https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy</a></p></li></ul><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ <code>ShardingSphere-JDBC</code> å’Œ <code>ShardingSphere-Proxy</code> ä¸­ï¼Œå­˜åœ¨éƒ¨åˆ† MySQL(å…¶å®ƒæ•°æ®åº“ä¹Ÿç±»ä¼¼) çš„ SQL è¯­æ³•æˆ–åŠŸèƒ½ç›®å‰è¿˜ä¸å®Œå…¨æ”¯æŒçš„æƒ…å†µã€‚<code>ShardingSphere</code> åœ¨åš SQL è·¯ç”±ã€æ”¹å†™ã€æ‰§è¡Œæ—¶ï¼Œå¿…é¡»èƒ½è§£æ SQL å¹¶ç†è§£å…¶è¯­ä¹‰ï¼Œä½†å¹¶ä¸æ˜¯ MySQL çš„ 100% å®Œå…¨ä»£ç†ã€‚å› æ­¤ï¼Œæœ‰äº›å¤æ‚æˆ–ç‰¹å®šåœºæ™¯ä¸‹çš„ SQL å¯èƒ½æ— æ³•è¢«æ­£ç¡®è§£ææˆ–æ‰§è¡Œã€‚</p></li><li class="lvl-2"><p>æ”¯æŒè‰¯å¥½çš„ SQL è¯­æ³•</p><ul class="lvl-2"><li class="lvl-4">åŸºç¡€ DML<br>SELECTã€INSERTã€UPDATEã€DELETE<br>åŸºæœ¬çš„æ¡ä»¶æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µã€åˆ†ç»„ã€èšåˆå‡½æ•°ï¼ˆå¦‚ COUNTã€SUMã€AVGï¼‰</li><li class="lvl-4">DCL<br>åŸºæœ¬çš„äº‹åŠ¡è¯­å¥ï¼šBEGINã€COMMITã€ROLLBACK</li><li class="lvl-4">DDL<br>éƒ¨åˆ†è¡¨ç»“æ„ç®¡ç†è¯­å¥ï¼šCREATE TABLEã€ALTER TABLEã€DROP TABLE</li><li class="lvl-4">å‡½æ•°æ”¯æŒ<br>å¤§éƒ¨åˆ†å¸¸ç”¨çš„ MySQL å†…ç½®å‡½æ•°ï¼Œå¦‚å­—ç¬¦ä¸²ã€æ•°å­¦ã€æ—¥æœŸå‡½æ•°</li></ul></li></ul><h3 id="åœ¨-ShardingSphere-MySQL-ä¸‹å»ºè®®é¿å…æˆ–è°¨æ…ä½¿ç”¨çš„-SQL-æ¸…å•">åœ¨ ShardingSphere + MySQL ä¸‹å»ºè®®é¿å…æˆ–è°¨æ…ä½¿ç”¨çš„ SQL æ¸…å•</h3><ul class="lvl-0"><li class="lvl-2"><ol><li class="lvl-5">è·¨åˆ†ç‰‡å¤æ‚æŸ¥è¯¢</li></ol></li></ul><table><thead><tr><th>SQL åœºæ™¯</th><th>åŸå› </th><th>å»ºè®®å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td>å¤šè¡¨å¤æ‚ JOINï¼ˆç‰¹åˆ«æ˜¯è·¨åˆ†ç‰‡ï¼‰</td><td>éœ€è¦è·¨åº“æ•°æ®èšåˆï¼Œæ€§èƒ½å·®ï¼Œå¯èƒ½æŠ¥é”™</td><td>ä½¿ç”¨å¹¿æ’­è¡¨/ç»‘å®šè¡¨ï¼Œæˆ–åœ¨åº”ç”¨å±‚å®Œæˆ</td></tr><tr><td>è·¨åˆ†ç‰‡å­æŸ¥è¯¢</td><td>SQL è·¯ç”±å›°éš¾ï¼Œå¯èƒ½ä¸æ”¯æŒ</td><td>å°½é‡æ”¹æˆå•è¡¨æŸ¥è¯¢æˆ–åˆ†æ­¥æŸ¥è¯¢</td></tr><tr><td>è·¨åˆ†ç‰‡çš„ GROUP BY / ORDER BY</td><td>åœ¨ Proxy å±‚èšåˆï¼Œæ€§èƒ½å¾ˆå·®</td><td>å°½é‡é¿å…ï¼Œæˆ–æ§åˆ¶æ•°æ®é‡</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><ol start="2"><li class="lvl-5">DDL ç›¸å…³</li></ol></li></ul><table><thead><tr><th>SQL åœºæ™¯</th><th>åŸå› </th><th>å»ºè®®å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td><code>ALTER TABLE</code> å¤æ‚å˜æ›´</td><td>éœ€åœ¨æ‰€æœ‰åˆ†ç‰‡æ‰§è¡Œï¼Œå¯èƒ½æ‰§è¡Œå¤±è´¥</td><td>æ‰‹åŠ¨åœ¨æ¯ä¸ªåˆ†ç‰‡åº“æ‰§è¡Œ</td></tr><tr><td><code>CREATE TRIGGER</code>ã€<code>PROCEDURE</code></td><td>Proxy ä¸è§£æè¿™äº›è¯­æ³•ï¼Œç›´æ¥é€ä¼ ä¸å®‰å…¨</td><td>å°½é‡åœ¨å•åº“æ‰‹åŠ¨åˆ›å»º</td></tr><tr><td><code>CREATE FUNCTION</code></td><td>åŒä¸Š</td><td>å•åº“æ‰§è¡Œæˆ–åº”ç”¨å±‚æ›¿ä»£</td></tr><tr><td><code>FULLTEXT INDEX</code>ã€<code>SPATIAL INDEX</code></td><td>åˆ†ç‰‡ç¯å¢ƒä¸‹æ— æ³•è‡ªåŠ¨ç»´æŠ¤ç´¢å¼•</td><td>å•åº“æ‰‹åŠ¨ç»´æŠ¤æˆ–é¿å…ä½¿ç”¨</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><ol start="3"><li class="lvl-5">æ–‡ä»¶å¯¼å…¥å¯¼å‡º</li></ol></li></ul><table><thead><tr><th>SQL åœºæ™¯</th><th>åŸå› </th><th>å»ºè®®å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td><code>LOAD DATA INFILE</code></td><td>Proxy ä¸æ”¯æŒæ–‡ä»¶ç³»ç»Ÿç›´æ¥è®¿é—®</td><td>åœ¨åˆ†ç‰‡åº“æ‰‹åŠ¨æ‰§è¡Œæˆ–é€šè¿‡åº”ç”¨å¯¼å…¥</td></tr><tr><td><code>SELECT ... INTO OUTFILE</code></td><td>åŒä¸Š</td><td>åº”ç”¨å±‚å¤„ç†å¯¼å‡º</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><ol start="4"><li class="lvl-5">MySQL ç‰¹æœ‰åŠŸèƒ½</li></ol></li></ul><table><thead><tr><th>åŠŸèƒ½</th><th>æ”¯æŒæƒ…å†µ</th><th>å»ºè®®</th></tr></thead><tbody><tr><td>MySQL 8.0 å…¬å…±è¡¨è¡¨è¾¾å¼ï¼ˆCTEï¼‰</td><td>éƒ¨åˆ†æ”¯æŒ</td><td>é¿å…è·¨åˆ†ç‰‡ä½¿ç”¨</td></tr><tr><td>çª—å£å‡½æ•°ï¼ˆ<code>OVER() PARTITION BY</code>ï¼‰</td><td>éƒ¨åˆ†æ”¯æŒ</td><td>é¿å…è·¨åˆ†ç‰‡å¤§æ•°æ®é‡ä½¿ç”¨</td></tr><tr><td>JSON å‡½æ•°</td><td>åŸºæœ¬æ”¯æŒ</td><td>å•è¡¨åœºæ™¯å¯ç”¨ï¼Œè·¨åˆ†ç‰‡éœ€è°¨æ…</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>åˆ†å¸ƒå¼äº‹åŠ¡</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>é—®é¢˜åŸå› </th><th>å»ºè®®å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td>è·¨åˆ†ç‰‡åŸç”Ÿäº‹åŠ¡</td><td>MySQL åŸç”Ÿäº‹åŠ¡ä¸æ”¯æŒè·¨åº“</td><td>ä½¿ç”¨ ShardingSphere XA / BASE</td></tr><tr><td>å¤§äº‹åŠ¡ + åˆ†å¸ƒå¼äº‹åŠ¡</td><td>æ€§èƒ½å¼€é”€å¤§</td><td>å°½é‡æ§åˆ¶äº‹åŠ¡èŒƒå›´</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://shardingsphere.apache.org/index_zh.html&quot;&gt;ShardingSphereå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy&quot;&gt;æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡å°† &lt;a href=&quot;/2025/09/01/springboot3-shardingsphere/&quot; title=&quot;SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨&quot;&gt;SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨&lt;/a&gt; ä¿®æ”¹ä¸º &lt;code&gt;ShardingSphere-Proxy&lt;/code&gt; çš„æ¨¡å¼&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/sharding-sphere/"/>
    
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/tags/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/tags/sharding-sphere/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨</title>
    <link href="https://blog.hanqunfeng.com/2025/09/01/springboot3-shardingsphere/"/>
    <id>https://blog.hanqunfeng.com/2025/09/01/springboot3-shardingsphere/</id>
    <published>2025-09-01T13:30:05.000Z</published>
    <updated>2025-09-15T06:26:28.263Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚</p></li><li class="lvl-2"><p><a href="https://shardingsphere.apache.org/index_zh.html">ShardingSphereå®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-01">æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€</a></p></li></ul><span id="more"></span><h2 id="ShardingSphere-JDBC-ç®€ä»‹">ShardingSphere-JDBC ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ShardingSphere-JDBC å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p><ul class="lvl-2"><li class="lvl-4">é€‚ç”¨äºä»»ä½•åŸºäº JDBC çš„ ORM æ¡†æ¶ï¼Œå¦‚ï¼šJPA, Hibernate, Mybatis, Spring JDBC Template æˆ–ç›´æ¥ä½¿ç”¨ JDBCï¼›</li><li class="lvl-4">æ”¯æŒä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, HikariCP ç­‰ï¼›</li><li class="lvl-4">æ”¯æŒä»»æ„å®ç° JDBC è§„èŒƒçš„æ•°æ®åº“ï¼Œç›®å‰æ”¯æŒ MySQLï¼ŒPostgreSQLï¼ŒOracleï¼ŒSQLServer ä»¥åŠä»»ä½•å¯ä½¿ç”¨ JDBC è®¿é—®çš„æ•°æ®åº“ã€‚</li></ul></li><li class="lvl-2"><p>ShardingSphere-JDBC ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾<br><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/RgXClY.png" alt=""></p></li></ul><h2 id="mavenä¾èµ–">mavenä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æœ¬é¡¹ç›® åŸºäº mysql --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="application-yml">application.yml</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">org.apache.shardingsphere.driver.ShardingSphereDriver</span></span><br><span class="line">    <span class="comment"># æŒ‡å‘ç±»è·¯å¾„ä¸‹çš„ sharding.yamlï¼ˆä¹Ÿå¯ absolute path / file: / http: ç­‰ï¼Œè§å®˜æ–¹è¯´æ˜ï¼‰</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:shardingsphere:classpath:sharding.yaml</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¹Ÿå¯ä»¥ä¸åœ¨ <code>application.yml</code> ä¸­é…ç½®ï¼Œè€Œæ˜¯é€šè¿‡ <code>@Configuration</code> åˆ›å»º <code>@Bean</code>ï¼Œè¿™æ ·å°±å¯ä»¥é…ç½®å¤šæ•°æ®æºäº†ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;shardingDataSource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">shardingDataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, IOException &#123;</span><br><span class="line">        <span class="comment">// ShardingSphere æä¾›çš„å·¥å‚æ–¹æ³•ï¼Œæ ¹æ®é…ç½®æ„å»º DataSource</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;sharding.yaml&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputStream == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Cannot find sharding.yaml in classpath&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">byte</span>[] yamlBytes = inputStream.readAllBytes();</span><br><span class="line">            <span class="keyword">return</span> YamlShardingSphereDataSourceFactory.createDataSource(yamlBytes);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="sharding-yaml">sharding.yaml</h2><ul class="lvl-0"><li class="lvl-2"><p>å®Œæ•´é…ç½®ï¼Œä¸‹æ–‡ä¼šä»‹ç»éƒ¨åˆ†é…ç½®</p></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/</span></span><br><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_0:</span> <span class="comment"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ds_1:</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="comment"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class="line">    <span class="attr">bindingTables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t_order,t_order_item</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">course:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">cid</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_inline</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">cid</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order-complex-algorithm</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class="line"><span class="comment">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_item-class-based-algorithm_spi</span> <span class="comment"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">t_user:</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">id</span> <span class="comment"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line"><span class="comment">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">custom_snowflake_string</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#       t_address:      # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜</span></span><br><span class="line"><span class="comment">#         actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">autoTables:</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/</span></span><br><span class="line">      <span class="attr">course_inline:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># å±æ€§</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">course_$&#123;cid</span> <span class="string">%</span> <span class="number">2</span> <span class="string">+</span> <span class="number">1</span><span class="string">&#125;</span> <span class="comment"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class="line">          <span class="attr">allow-range-query-with-inline-sharding:</span> <span class="literal">true</span> <span class="comment"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">      <span class="attr">course_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span> <span class="comment"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class="line">      <span class="attr">mod_2:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MOD</span> <span class="comment"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">sharding-count:</span> <span class="number">2</span> <span class="comment"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class="line">      <span class="attr">t_order_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order-complex-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">COMPLEX_INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_order_complex_$&#123;(user_id</span> <span class="string">+</span> <span class="string">order_id</span> <span class="string">+</span> <span class="number">1</span><span class="string">)</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CLASS_BASED</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">strategy:</span> <span class="string">COMPLEX</span> <span class="comment"># æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥</span></span><br><span class="line">          <span class="attr">algorithmClassName:</span> <span class="string">com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm</span> <span class="comment"># æŒ‡å®šç®—æ³•ç±»</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm_spi:</span> <span class="comment"># SPI</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">T_ORDER_ITEM_COMPLEX</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_user_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span></span><br><span class="line">      <span class="attr">t_user_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br><span class="line">      <span class="attr">uuid:</span>    <span class="comment"># å®šä¹‰åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">UUID</span> <span class="comment"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class="line">      <span class="attr">custom_snowflake_string:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CUSTOM_SNOWFLAKE_STRING</span>  <span class="comment"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒString</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">workerId:</span> <span class="number">2</span></span><br><span class="line">          <span class="attr">datacenterId:</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!BROADCAST</span>  <span class="comment"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dict</span>    <span class="comment"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!ENCRYPT</span>    <span class="comment"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># åŠ å¯†è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># åŠ å¯†åˆ—åç§°</span></span><br><span class="line">            <span class="attr">cipher:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">password</span> <span class="comment"># å¯†æ–‡åˆ—åç§°</span></span><br><span class="line">              <span class="attr">encryptorName:</span> <span class="string">aes_encryptor</span> <span class="comment"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class="line">    <span class="comment"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class="line">    <span class="attr">encryptors:</span></span><br><span class="line">      <span class="attr">aes_encryptor:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">AES</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line">          <span class="attr">aes-key-value:</span> <span class="string">123456abc</span>     <span class="comment"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class="line">          <span class="attr">digest-algorithm-name:</span> <span class="string">SHA-1</span> <span class="comment"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class="line">      <span class="attr">md5_encryptor:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">salt:</span> <span class="number">123456</span>  <span class="comment"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!MASK</span>  <span class="comment"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># è„±æ•è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span>  <span class="comment"># è„±æ•åˆ—é…ç½®</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># è„±æ•åˆ—åç§°</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">md5_mask</span> <span class="comment"># è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">email:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">mask_before_special_chars_mask</span></span><br><span class="line">          <span class="attr">telephone:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">keep_first_n_last_m_mask</span></span><br><span class="line">          <span class="attr">name:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">my_mask</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">maskAlgorithms:</span> <span class="comment"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class="line">      <span class="attr">md5_mask:</span> <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span>  <span class="comment"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class="line">      <span class="attr">mask_before_special_chars_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MASK_BEFORE_SPECIAL_CHARS</span> <span class="comment"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">special-chars:</span> <span class="string">&#x27;@&#x27;</span>  <span class="comment"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span>   <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">keep_first_n_last_m_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">KEEP_FIRST_N_LAST_M</span> <span class="comment"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">first-n:</span> <span class="number">3</span>     <span class="comment"># ä¿ç•™å‰ 3 ä½</span></span><br><span class="line">          <span class="attr">last-m:</span> <span class="number">4</span>      <span class="comment"># ä¿ç•™å 4 ä½</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">my_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MY_CUSTOM_MASK</span>  <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&quot;#&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SINGLE</span> <span class="comment"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="comment"># MySQL é£æ ¼</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ds_0.t_address</span> <span class="comment"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br><span class="line"><span class="comment">#       - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨</span></span><br><span class="line"><span class="comment">#       - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/</span></span><br><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span> <span class="comment"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class="line">  <span class="attr">check-table-metadata-enabled:</span> <span class="literal">false</span> <span class="comment"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure><h3 id="æ•°æ®æºé…ç½®">æ•°æ®æºé…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>hikari + mysql</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_0:</span> <span class="comment"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ds_1:</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>druid + mysql</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_1:</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line">    <span class="comment"># Druid ç‰¹æœ‰é…ç½®</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>druid + mysql + p6spy</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="attr">ds_0:</span> <span class="comment"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class="line">    <span class="attr">dataSourceClassName:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.p6spy.engine.spy.P6SpyDriver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:p6spy:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">newpwd</span></span><br><span class="line">    <span class="comment"># Druid ç‰¹æœ‰é…ç½®</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br></pre></td></tr></table></figure><h3 id="åˆ†åº“åˆ†è¡¨é…ç½®">åˆ†åº“åˆ†è¡¨é…ç½®</h3><h4 id="å•åˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹">å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">course:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">cid</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">course_inline</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">cid</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">course_inline:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># å±æ€§</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">course_$&#123;cid</span> <span class="string">%</span> <span class="number">2</span> <span class="string">+</span> <span class="number">1</span><span class="string">&#125;</span> <span class="comment"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class="line">          <span class="attr">allow-range-query-with-inline-sharding:</span> <span class="literal">true</span> <span class="comment"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">      <span class="attr">course_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span> <span class="comment"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ä¸åŒçš„å­—æ®µï¼Œåˆ†åº“ä½¿ç”¨ user_idï¼Œåˆ†è¡¨ä½¿ç”¨ cid</p></li><li class="lvl-2"><p>allow-range-query-with-inline-sharding: true ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå…è®¸èŒƒå›´æŸ¥è¯¢ï¼Œé»˜è®¤å€¼æ˜¯ falseï¼Œä¸å…è®¸ between æŸ¥è¯¢</p></li></ul><h4 id="å•åˆ†ç‰‡é”®ï¼ŒString-ç±»å‹">å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_user:</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_user_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">id</span> <span class="comment"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line"><span class="comment">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">custom_snowflake_string</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_user_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span> <span class="comment"># åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®—</span></span><br><span class="line">      <span class="attr">t_user_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span> <span class="comment"># åˆ†è¡¨ï¼Œt_user_0, t_user_1</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</span></span><br><span class="line">      <span class="attr">uuid:</span>    <span class="comment"># å®šä¹‰åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">UUID</span> <span class="comment"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class="line">      <span class="attr">custom_snowflake_string:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CUSTOM_SNOWFLAKE_STRING</span> <span class="comment"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">workerId:</span> <span class="number">2</span></span><br><span class="line">          <span class="attr">datacenterId:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ç›¸åŒçš„å­—æ®µï¼Œå³ä¸»é”®idï¼Œå› å…¶ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ hashCode() è·å–æ•°å­—ï¼Œå†è¿›è¡Œè¿ç®—</p></li><li class="lvl-2"><p>ä¸»é”®è·å–è§„åˆ™ä½¿ç”¨çš„è‡ªå®šä¹‰çš„é›ªèŠ±ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.infra.algorithm.keygen.core.KeyGenerateAlgorithm</code>ï¼Œè¿™é‡Œæ³¨æ„ï¼Œä» <code>5.5.3</code> å¼€å§‹ä¼šæ›´æ¢ä¸º <code>org.apache.shardingsphere.infra.algorithm.keygen.spi.KeyGenerateAlgorithm</code></p></li></ul><h4 id="å¤šåˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹">å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span> <span class="comment"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order-complex-algorithm</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item_complex:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataNodes:</span> <span class="string">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class="comment"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">        <span class="attr">databaseStrategy:</span> <span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_db_inline</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">tableStrategy:</span> <span class="comment"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class="line">          <span class="attr">complex:</span> <span class="comment"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumns:</span> <span class="string">user_id,order_id</span>  <span class="comment"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class="line"><span class="comment">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">t_order_item-class-based-algorithm_spi</span> <span class="comment"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">t_order_db_inline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">ds_$&#123;user_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order-complex-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">COMPLEX_INLINE</span> <span class="comment"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">algorithm-expression:</span> <span class="string">t_order_complex_$&#123;(user_id</span> <span class="string">+</span> <span class="string">order_id</span> <span class="string">+</span> <span class="number">1</span><span class="string">)</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">CLASS_BASED</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">strategy:</span> <span class="string">COMPLEX</span> <span class="comment"># æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥</span></span><br><span class="line">          <span class="attr">algorithmClassName:</span> <span class="string">com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm</span> <span class="comment"># æŒ‡å®šç®—æ³•ç±»</span></span><br><span class="line">      <span class="attr">t_order_item-class-based-algorithm_spi:</span> <span class="comment"># SPI</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">T_ORDER_ITEM_COMPLEX</span> <span class="comment"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¤šä¸ªåˆ†ç‰‡é”®ï¼Œ<code>t_order_complex</code>è¡¨ä½¿ç”¨äº†å†…ç½®çš„<code>COMPLEX_INLINE</code>ç®—æ³•ï¼Œè€Œ<code>t_order_item_complex</code>è¡¨ä½¿ç”¨äº†è‡ªå®šä¹‰çš„çš„åˆ†ç‰‡ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.sharding.spi.ShardingAlgorithm</code></p></li></ul><h4 id="è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™">è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</h4><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SHARDING</span> <span class="comment"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">   <span class="comment"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class="line">    <span class="attr">bindingTables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">t_order,t_order_item</span></span><br><span class="line">    <span class="attr">autoTables:</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class="line">      <span class="attr">t_order:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">order_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line">      <span class="attr">t_order_item:</span> <span class="comment"># é€»è¾‘è¡¨åç§°</span></span><br><span class="line">        <span class="attr">actualDataSources:</span> <span class="string">ds_$&#123;0..1&#125;</span> <span class="comment"># æ•°æ®æºåç§°</span></span><br><span class="line">        <span class="attr">shardingStrategy:</span> <span class="comment"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class="line">          <span class="attr">standard:</span> <span class="comment"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class="line">            <span class="attr">shardingColumn:</span> <span class="string">user_id</span> <span class="comment"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class="line">            <span class="attr">shardingAlgorithmName:</span> <span class="string">mod_2</span> <span class="comment"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">keyGenerateStrategy:</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class="line">          <span class="attr">column:</span> <span class="string">item_id</span> <span class="comment"># è‡ªå¢åˆ—åç§°</span></span><br><span class="line">          <span class="attr">keyGeneratorName:</span> <span class="string">snowflake</span> <span class="comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">shardingAlgorithms:</span> <span class="comment"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">      <span class="attr">mod_2:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MOD</span> <span class="comment"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">sharding-count:</span> <span class="number">2</span> <span class="comment"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">keyGenerators:</span> <span class="comment"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class="line">      <span class="attr">snowflake:</span> <span class="comment"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SNOWFLAKE</span> <span class="comment"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™éœ€è¦å£°æ˜æ•°æ®åº“ï¼Œä½†ä¸éœ€è¦å£°æ˜è¡¨åˆ†é…è§„åˆ™ï¼Œå…¶æ ¹æ®åˆ†ç‰‡ç®—æ³•è‡ªåŠ¨ç¡®å®šå…·ä½“çš„æ•°æ®è¡¨ã€‚</p></li><li class="lvl-2"><p>åŒæ—¶è¿™é‡Œè¿˜é…ç½®äº†<code>bindingTables</code>ï¼Œç”¨æ¥æŒ‡å®šå…¶åˆ†ç‰‡è·¯ç”±ä¸€è‡´ã€‚</p></li></ul><h3 id="å¹¿æ’­è¡¨é…ç½®">å¹¿æ’­è¡¨é…ç½®</h3><ul class="lvl-0"><li class="lvl-2"><p>å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!BROADCAST</span>  <span class="comment"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dict</span>    <span class="comment"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åŠ å¯†è§„åˆ™">æ•°æ®åŠ å¯†è§„åˆ™</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!ENCRYPT</span>    <span class="comment"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># åŠ å¯†è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># åŠ å¯†åˆ—åç§°</span></span><br><span class="line">            <span class="attr">cipher:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">password</span> <span class="comment"># å¯†æ–‡åˆ—åç§°</span></span><br><span class="line">              <span class="attr">encryptorName:</span> <span class="string">aes_encryptor</span> <span class="comment"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class="line">    <span class="comment"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class="line">    <span class="attr">encryptors:</span></span><br><span class="line">      <span class="attr">aes_encryptor:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">AES</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class="line">        <span class="attr">props:</span> <span class="comment"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class="line">          <span class="attr">aes-key-value:</span> <span class="string">123456abc</span>     <span class="comment"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class="line">          <span class="attr">digest-algorithm-name:</span> <span class="string">SHA-1</span> <span class="comment"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class="line">      <span class="attr">md5_encryptor:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">salt:</span> <span class="number">123456</span>  <span class="comment"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>é…ç½®åŠ å¯†å­—æ®µè§„åˆ™åï¼Œæ–°å¢æ•°æ®æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¹åŠ å¯†å­—æ®µåŠ å¯†åå­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶ä¹Ÿä¼šåŠ å¯†åè¿›è¡Œæ¯”è¾ƒæŸ¥è¯¢ã€‚</p></li></ul><h3 id="æ•°æ®è„±æ•è§„åˆ™">æ•°æ®è„±æ•è§„åˆ™</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!MASK</span>  <span class="comment"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="attr">t_user:</span>  <span class="comment"># è„±æ•è¡¨åç§°</span></span><br><span class="line">        <span class="attr">columns:</span>  <span class="comment"># è„±æ•åˆ—é…ç½®</span></span><br><span class="line">          <span class="attr">password:</span> <span class="comment"># è„±æ•åˆ—åç§°</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">md5_mask</span> <span class="comment"># è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">          <span class="attr">email:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">mask_before_special_chars_mask</span></span><br><span class="line">          <span class="attr">telephone:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">keep_first_n_last_m_mask</span></span><br><span class="line">          <span class="attr">name:</span></span><br><span class="line">            <span class="attr">maskAlgorithm:</span> <span class="string">my_mask</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">maskAlgorithms:</span> <span class="comment"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class="line">      <span class="attr">md5_mask:</span> <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MD5</span>  <span class="comment"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class="line">      <span class="attr">mask_before_special_chars_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MASK_BEFORE_SPECIAL_CHARS</span> <span class="comment"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">special-chars:</span> <span class="string">&#x27;@&#x27;</span>  <span class="comment"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span>   <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">keep_first_n_last_m_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">KEEP_FIRST_N_LAST_M</span> <span class="comment"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">first-n:</span> <span class="number">3</span>     <span class="comment"># ä¿ç•™å‰ 3 ä½</span></span><br><span class="line">          <span class="attr">last-m:</span> <span class="number">4</span>      <span class="comment"># ä¿ç•™å 4 ä½</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class="line">      <span class="attr">my_mask:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">MY_CUSTOM_MASK</span>  <span class="comment"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">replace-char:</span> <span class="string">&quot;#&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¢«è„±æ•çš„å­—æ®µåœ¨æŸ¥è¯¢æ—¶ä¼šè¿›è¡Œè„±æ•å±•ç¤ºã€‚</p></li><li class="lvl-2"><p>è¿™é‡Œè¿˜è‡ªå®šä¹‰äº†è„±æ•ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.mask.spi.MaskAlgorithm</code></p></li></ul><h3 id="å•è¡¨è§„åˆ™">å•è¡¨è§„åˆ™</h3><ul class="lvl-0"><li class="lvl-2"><p>å³ä¸éœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨çš„è¡¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="type">!SINGLE</span> <span class="comment"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class="line">    <span class="attr">tables:</span></span><br><span class="line">      <span class="comment"># MySQL é£æ ¼</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ds_0.t_address</span> <span class="comment"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br></pre></td></tr></table></figure><h3 id="å±æ€§é…ç½®">å±æ€§é…ç½®</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/</span></span><br><span class="line"><span class="attr">props:</span></span><br><span class="line">  <span class="attr">sql-show:</span> <span class="literal">true</span> <span class="comment"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class="line">  <span class="attr">check-table-metadata-enabled:</span> <span class="literal">false</span> <span class="comment"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure><h3 id="äº‹åŠ¡é…ç½®">äº‹åŠ¡é…ç½®</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/</span></span><br><span class="line"><span class="attr">transaction:</span></span><br><span class="line">  <span class="attr">defaultType:</span> <span class="string">LOCAL</span> <span class="comment"># é»˜è®¤äº‹åŠ¡ç±»å‹å°±æ˜¯ LOCAL</span></span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ä¸ springboot2 ä¸åŒï¼Œä¸å†æä¾› <code>springboot-starter-shardingsphere</code>ï¼Œç›¸å…³é…ç½®ä¹Ÿé‡‡ç”¨äº†ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ã€‚</p></li><li class="lvl-2"><p>ä»£ç ä¸­åŒ…å«ä¸¤ä¸ªåº“ä¸­ä½¿ç”¨åˆ°çš„æ•°æ®åº“è„šæœ¬ï¼Œ<code>shardingsphere-demo/shardingsphere-demo-01/sql</code></p></li><li class="lvl-2"><p>å…·ä½“ä½¿ç”¨æ•ˆæœå¯ä»¥é€šè¿‡é¡¹ç›®ä¸­æä¾›çš„å•å…ƒæµ‹è¯•ç±»è¿›è¡ŒéªŒè¯ã€‚</p></li><li class="lvl-2"><p>springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ç›®å‰<a href="https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/jdbc-driver/spring-boot/">å°šä¸æ”¯æŒ <code>XA</code> åˆ†å¸ƒå¼äº‹åŠ¡</a>ï¼Œè¿™æ˜¯å› ä¸ºä» <code>Spring Boot 3.x</code> å¼€å§‹ï¼Œå°±å…¨é¢è¿ç§»åˆ°äº† <code>Jakarta EE 9+</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ <code>javax.*</code> çš„ç±»éƒ½è¿ç§»åˆ° <code>jakarta.*</code> å‘½åç©ºé—´(äº‹åŠ¡ã€JPAã€Servlet ç­‰ API éƒ½å—å½±å“)ï¼Œè€Œ <code>ShardingSphere 5.5</code> ä¸­çš„ XA äº‹åŠ¡ä¸»è¦ä¾èµ– <code>Atomikos</code> æˆ– <code>Narayana</code> ç­‰ç¬¬ä¸‰æ–¹åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†å™¨ï¼Œè¿™äº›åº“ç›®å‰å¤§éƒ¨åˆ†è¿˜æ˜¯åŸºäº <code>javax.transaction.*</code> çš„ APIã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://shardingsphere.apache.org/index_zh.html&quot;&gt;ShardingSphereå®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-01&quot;&gt;æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/springboot/sharding-sphere/"/>
    
    
    <category term="springboot" scheme="https://blog.hanqunfeng.com/tags/springboot/"/>
    
    <category term="sharding-sphere" scheme="https://blog.hanqunfeng.com/tags/sharding-sphere/"/>
    
  </entry>
  
  <entry>
    <title>K8S UI ä¹‹ Rancher</title>
    <link href="https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/"/>
    <id>https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/</id>
    <published>2025-07-25T14:33:05.000Z</published>
    <updated>2025-09-15T06:26:27.684Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://ranchermanager.docs.rancher.com/zh/">Rancher å®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/rancher/rancher">Rancher Github</a></p></li></ul><span id="more"></span><h2 id="Rancher-ç®€ä»‹">Rancher ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Rancher æ˜¯ä¸€ä¸ª å¼€æºçš„ Kubernetes ç®¡ç†å¹³å°ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·éƒ¨ç½²ã€ç®¡ç†å’Œè¿ç»´å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œå…·æœ‰æ˜“ç”¨çš„ Web UIã€æƒé™æ§åˆ¶ã€é›†ç¾¤ç›‘æ§ã€åº”ç”¨ç®¡ç†ç­‰åŠŸèƒ½ï¼Œå¹¿æ³›åº”ç”¨äºä¼ä¸šçš„äº‘åŸç”Ÿå¹³å°å»ºè®¾ä¸­ã€‚</p></li></ul><h2 id="éƒ¨ç½²-Rancher">éƒ¨ç½² Rancher</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://ranchermanager.docs.rancher.com/zh/getting-started/quick-start-guides/deploy-rancher-manager/helm-cli#%E4%BD%BF%E7%94%A8-helm-%E6%9D%A5%E5%AE%89%E8%A3%85-rancher">ä½¿ç”¨ Helm å®‰è£… Rancher</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  rancher çš„ Helm ä»“åº“</span></span><br><span class="line">helm repo add rancher-latest https://releases.rancher.com/server-charts/latest</span><br><span class="line"><span class="comment"># æ›´æ–° rancher çš„ Helm ä»“åº“</span></span><br><span class="line">helm repo update</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ rancher çš„ç‰ˆæœ¬</span></span><br><span class="line">$ helm search repo rancher -l | <span class="built_in">head</span></span><br><span class="line">NAME                  CHART VERSIONAPP VERSIONDESCRIPTION</span><br><span class="line">rancher-latest/rancher2.11.3       v2.11.3    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.11.2       v2.11.2    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.11.1       v2.11.1    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.11.0       v2.11.0    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.3       v2.10.3    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.2       v2.10.2    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.1       v2.10.1    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.10.0       v2.10.0    Install Rancher Server to manage Kubernetes clu...</span><br><span class="line">rancher-latest/rancher2.9.3        v2.9.3     Install Rancher Server to manage Kubernetes clu...</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">kubectl create namespace cattle-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¯ä¹¦ï¼Œè¯ä¹¦æ˜¯æœºæ„é¢å‘çš„</span></span><br><span class="line">kubectl create secret tls tls-rancher-ingress \</span><br><span class="line">  --key=nginx_ssl/nginx.hanqunfeng.com.key \</span><br><span class="line">  --cert=nginx_ssl/nginx.hanqunfeng.com.pem \</span><br><span class="line">  -n cattle-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Rancher  --version v2.11.3 å¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼Œé»˜è®¤æœ€æ–°ç‰ˆ</span></span><br><span class="line">helm install rancher rancher-latest/rancher \</span><br><span class="line">  --namespace cattle-system \</span><br><span class="line">  --create-namespace \</span><br><span class="line">  --<span class="built_in">set</span> hostname=rancher.hanqunfeng.com \</span><br><span class="line">  --<span class="built_in">set</span> ingress.tls.source=secret \</span><br><span class="line">  --<span class="built_in">set</span> replicas=3 \</span><br><span class="line">  --<span class="built_in">set</span> bootstrapPassword=rancher#2025</span><br><span class="line"></span><br><span class="line"><span class="comment">## å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"># --set hostname=rancher.hanqunfeng.com è®¾ç½® rancher çš„åŸŸå</span></span><br><span class="line"><span class="comment"># --set ingress.tls.source=secret é…ç½® rancher çš„è¯ä¹¦ï¼Œåç§°ä¸º tls-rancher-ingress</span></span><br><span class="line"><span class="comment"># --set replicas=3 è®¾ç½® rancher çš„å‰¯æœ¬æ•°</span></span><br><span class="line"><span class="comment"># --set bootstrapPassword=rancher#2025 è®¾ç½® rancher çš„åˆå§‹å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ä¸è¿‡æ‰§è¡Œä¸Šé¢çš„å®‰è£…å‘½ä»¤ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯å½“å‰çš„ rancher ç‰ˆæœ¬ä¸æ”¯æŒ Kubernetes v1.33.2</span></span><br><span class="line">Error: INSTALLATION FAILED: chart requires kubeVersion: &lt; 1.33.0-0 <span class="built_in">which</span> is incompatible with Kubernetes v1.33.2</span><br><span class="line"></span><br><span class="line"><span class="comment">## è§£å†³åŠæ³•</span></span><br><span class="line"><span class="comment"># ä¸‹è½½å¹¶è§£å‹ rancher å®‰è£…åŒ…</span></span><br><span class="line">helm pull rancher-latest/rancher --untar --untardir ./</span><br><span class="line"><span class="comment"># ä¿®æ”¹å…¶ä¸­çš„ Chart.yaml æ–‡ä»¶</span></span><br><span class="line">kubeVersion: &lt; 1.33.0-0 ==&gt; kubeVersion: &lt; 1.34.0-0</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… rancher</span></span><br><span class="line">helm install rancher rancher \</span><br><span class="line">  --namespace cattle-system \</span><br><span class="line">  --create-namespace \</span><br><span class="line">  --<span class="built_in">set</span> hostname=rancher.hanqunfeng.com \</span><br><span class="line">  --<span class="built_in">set</span> ingress.tls.source=secret \</span><br><span class="line">  --<span class="built_in">set</span> replicas=3 \</span><br><span class="line">  --<span class="built_in">set</span> bootstrapPassword=rancher#2025</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">NAME: rancher</span><br><span class="line">LAST DEPLOYED: Thu Jul 24 23:55:24 2025</span><br><span class="line">NAMESPACE: cattle-system</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">Rancher Server has been installed.</span><br><span class="line"></span><br><span class="line">NOTE: Rancher may take several minutes to fully initialize. Please standby <span class="keyword">while</span> Certificates are being issued, Containers are started and the Ingress rule comes up.</span><br><span class="line"></span><br><span class="line">Check out our docs at https://rancher.com/docs/</span><br><span class="line"></span><br><span class="line">If you provided your own bootstrap password during installation, browse to https://rancher.hanqunfeng.com to get started.</span><br><span class="line"></span><br><span class="line">If this is the first time you installed Rancher, get started by running this <span class="built_in">command</span> and clicking the URL it generates:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> https://rancher.hanqunfeng.com/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class="string">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">To get just the bootstrap password on its own, run:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class="string">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123; &quot;\n&quot; &#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Happy Containering!</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹åˆ›å»ºçš„èµ„æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ k get all,ing -n cattle-system</span><br><span class="line">NAME                                   READY   STATUS      RESTARTS   AGE</span><br><span class="line">pod/helm-operation-8257k               0/2     Completed   0          11m</span><br><span class="line">pod/helm-operation-g8blp               0/2     Completed   0          12m</span><br><span class="line">pod/helm-operation-hwpbp               0/2     Completed   0          10m</span><br><span class="line">pod/helm-operation-qbs5n               0/2     Completed   0          10m</span><br><span class="line">pod/helm-operation-wlptb               0/2     Completed   0          13m</span><br><span class="line">pod/rancher-56689b7d8c-v7hpd           1/1     Running     0          21m</span><br><span class="line">pod/rancher-56689b7d8c-xnrbf           1/1     Running     0          21m</span><br><span class="line">pod/rancher-56689b7d8c-xvqgs           1/1     Running     0          21m</span><br><span class="line">pod/rancher-webhook-5fd5fc44f9-8xwjk   1/1     Running     0          11m</span><br><span class="line"></span><br><span class="line">NAME                               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">service/imperative-api-extension   ClusterIP   10.96.188.28   &lt;none&gt;        6666/TCP         15m</span><br><span class="line">service/rancher                    ClusterIP   10.96.21.41    &lt;none&gt;        80/TCP,443/TCP   21m</span><br><span class="line">service/rancher-webhook            ClusterIP   10.96.85.153   &lt;none&gt;        443/TCP          11m</span><br><span class="line"></span><br><span class="line">NAME                              READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/rancher           3/3     3            3           21m</span><br><span class="line">deployment.apps/rancher-webhook   1/1     1            1           11m</span><br><span class="line"></span><br><span class="line">NAME                                         DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/rancher-56689b7d8c           3         3         3       21m</span><br><span class="line">replicaset.apps/rancher-webhook-5fd5fc44f9   1         1         1       11m</span><br><span class="line"></span><br><span class="line">NAME                                CLASS   HOSTS                    ADDRESS         PORTS     AGE</span><br><span class="line">ingress.networking.k8s.io/rancher   nginx   rancher.hanqunfeng.com   10.211.55.201   80, 443   21m</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµè§ˆå™¨è®¿é—®ï¼š<a href="https://rancher.hanqunfeng.com">https://rancher.hanqunfeng.com</a>ï¼Œè¾“å…¥ä¸Šé¢è®¾ç½®çš„å¯†ç å³å¯ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœå¿˜è®°åˆå§‹å¯†ç å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯†ç </span></span><br><span class="line">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class="string">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123;&quot;\n&quot;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/rHDDMN.png" alt=""></p><h2 id="å¸è½½-Rancher">å¸è½½ Rancher</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸è½½ Rancher</span></span><br><span class="line">helm uninstall rancher -n cattle-system</span><br><span class="line"><span class="comment"># åˆ é™¤ cattle-system å‘½åç©ºé—´</span></span><br><span class="line">kubectl delete namespace cattle-system</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://ranchermanager.docs.rancher.com/zh/&quot;&gt;Rancher å®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/rancher/rancher&quot;&gt;Rancher Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S UI ä¹‹ Kubesphere</title>
    <link href="https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/"/>
    <id>https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/</id>
    <published>2025-07-24T14:33:05.000Z</published>
    <updated>2025-07-24T13:38:25.076Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubesphere.io/zh/">Kubesphere å®˜ç½‘</a></p></li></ul><span id="more"></span><h2 id="Kubesphere-ç®€ä»‹">Kubesphere ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>KubeSphere æ˜¯ä¸€ä¸ªåŸºäº Kubernetes æ„å»ºçš„ ä¼ä¸šçº§å¤šç§Ÿæˆ·å®¹å™¨ç®¡ç†å¹³å°ï¼Œæä¾›äº†ä¸€å¥—å®Œæ•´çš„å®¹å™¨å¹³å°è§£å†³æ–¹æ¡ˆï¼Œè®©ç”¨æˆ·ä»¥å›¾å½¢åŒ–æ–¹å¼è½»æ¾ä½¿ç”¨ Kubernetes å’Œ DevOps èƒ½åŠ›ï¼Œä¸éœ€è¦æ·±å…¥ç†è§£å¤æ‚çš„åº•å±‚æ¶æ„ã€‚</p></li><li class="lvl-2"><p>ä¸ K8S çš„ Dashboard ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p></li></ul><table><thead><tr><th>åŠŸèƒ½ / ç‰¹æ€§</th><th>Kubernetes Dashboard</th><th><strong>KubeSphere</strong></th></tr></thead><tbody><tr><td>âœ… åŸºç¡€èµ„æºç®¡ç†</td><td>âœ… æ”¯æŒ</td><td>âœ… æ›´ä¸°å¯Œï¼Œæ”¯æŒæ›´å¤šç»†ç²’åº¦æ§åˆ¶</td></tr><tr><td>ğŸ‘¥ å¤šç§Ÿæˆ·æ”¯æŒ</td><td>âŒ æ— </td><td>âœ… å†…å»ºä¼ä¸šçº§å¤šç§Ÿæˆ·ã€ç©ºé—´ï¼ˆWorkspaceï¼‰éš”ç¦»</td></tr><tr><td>ğŸ” èº«ä»½è®¤è¯ä¸æƒé™æ§åˆ¶</td><td>âš ï¸ éœ€æ‰‹åŠ¨æ•´åˆ RBAC</td><td>âœ… å†…å»ºç”¨æˆ·ç®¡ç†ã€è§’è‰²ã€å›¢é˜Ÿã€ä¼ä¸šç»„ç»‡æ¶æ„</td></tr><tr><td>ğŸŒ å¤šé›†ç¾¤æ”¯æŒ</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒè·¨åŒºåŸŸå¤šé›†ç¾¤ç»Ÿä¸€ç®¡ç†</td></tr><tr><td>ğŸš€ DevOpsï¼ˆCI/CD æµæ°´çº¿ï¼‰</td><td>âŒ æ— </td><td>âœ… å†…ç½®å›¾å½¢åŒ–æµæ°´çº¿ï¼ˆJenkins é©±åŠ¨ï¼‰</td></tr><tr><td>ğŸ“Š ç›‘æ§ä¸æŒ‡æ ‡ï¼ˆPrometheusï¼‰</td><td>âŒ æ‰‹åŠ¨å®‰è£…</td><td>âœ… å†…ç½®ï¼Œå›¾å½¢åŒ–å±•ç¤º Pod/Node/æœåŠ¡ç­‰ç›‘æ§æ•°æ®</td></tr><tr><td>ğŸ“ æ—¥å¿—æŸ¥è¯¢ä¸åˆ†æï¼ˆEFKï¼‰</td><td>âŒ æ— </td><td>âœ… å†…å»º Fluent Bit + Elasticsearch + Kibana</td></tr><tr><td>ğŸ’¡ å¾®æœåŠ¡æ²»ç†ï¼ˆIstioï¼‰</td><td>âŒ æ— </td><td>âœ… å¯é€‰å¯ç”¨ï¼Œæ”¯æŒæœåŠ¡æ‹“æ‰‘ã€ç°åº¦å‘å¸ƒã€æµé‡æ²»ç†ç­‰</td></tr><tr><td>ğŸ§° åº”ç”¨å•†åº—ï¼ˆHelm å¯è§†åŒ–éƒ¨ç½²ï¼‰</td><td>âŒ æ— </td><td>âœ… æ”¯æŒ Helm åº”ç”¨å¸‚åœºï¼Œç‚¹å‡»å³å¯å®‰è£…å¸¸è§ä¸­é—´ä»¶</td></tr><tr><td>ğŸ”Œ æ’ä»¶æ¶æ„</td><td>âŒ æ— </td><td>âœ… æ”¯æŒæ¨¡å—æŒ‰éœ€å¯ç”¨/å…³é—­</td></tr><tr><td>ğŸ§ª å®¹å™¨é•œåƒä»“åº“ï¼ˆHarborï¼‰</td><td>âŒ æ— </td><td>âœ… å¯é›†æˆæˆ–å†…å»º Harbor å®¹å™¨ä»“åº“</td></tr><tr><td>ğŸ“¦ å®‰è£…å¤æ‚åº¦</td><td>âœ… ç®€å•</td><td>âš ï¸ ç•¥å¤æ‚ï¼Œä½†å¯æŒ‰éœ€å¯ç”¨æ¨¡å—</td></tr></tbody></table><h2 id="éƒ¨ç½²-Kubesphere">éƒ¨ç½² Kubesphere</h2><ul class="lvl-0"><li class="lvl-2"><p>Kubesphere å¯¹ç³»ç»Ÿèµ„æºæœ‰æœ€ä½è¦æ±‚ï¼Œå…·ä½“å‚è€ƒ<a href="https://kubesphere.io/zh/docs/v4.1/03-installation-and-upgrade/01-preparations/01-supported-k8s/">å®˜ç½‘:ç¯å¢ƒè¦æ±‚</a></p></li><li class="lvl-2"><p>éƒ¨ç½²</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæ— æ³•è®¿é—® charts.kubesphere.io, å¯å°† charts.kubesphere.io æ›¿æ¢ä¸º charts.kubesphere.com.cn</span></span><br><span class="line">helm upgrade --install -n kubesphere-system --create-namespace ks-core https://charts.kubesphere.io/main/ks-core-1.1.4.tgz --debug --<span class="built_in">wait</span></span><br><span class="line"><span class="comment">## å®‰è£…æˆåŠŸåä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</span></span><br><span class="line">NOTES:</span><br><span class="line">Thank you <span class="keyword">for</span> choosing KubeSphere Helm Chart.</span><br><span class="line"></span><br><span class="line">Please be patient and <span class="built_in">wait</span> <span class="keyword">for</span> several seconds <span class="keyword">for</span> the KubeSphere deployment to complete.</span><br><span class="line"></span><br><span class="line">1. Wait <span class="keyword">for</span> Deployment Completion</span><br><span class="line"></span><br><span class="line">    Confirm that all KubeSphere components are running by executing the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    kubectl get pods -n kubesphere-system</span><br><span class="line">2. Access the KubeSphere Console</span><br><span class="line"></span><br><span class="line">    Once the deployment is complete, you can access the KubeSphere console using the following URL:</span><br><span class="line"></span><br><span class="line">    http://10.211.55.11:30880</span><br><span class="line"></span><br><span class="line">3. Login to KubeSphere Console</span><br><span class="line"></span><br><span class="line">    Use the following credentials to <span class="built_in">log</span> <span class="keyword">in</span>:</span><br><span class="line"></span><br><span class="line">    Account: admin</span><br><span class="line">    Password: P@88w0rd</span><br><span class="line"></span><br><span class="line">NOTE: It is highly recommended to change the default password immediately after the first login.</span><br><span class="line">For additional information and details, please visit https://kubesphere.io.</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶</span></span><br><span class="line">$ kubectl get pod,deploy,svc -n kubesphere-system</span><br><span class="line">NAME                                         READY   STATUS    RESTARTS       AGE</span><br><span class="line">pod/extensions-museum-ffd8bd9d8-fvcw4        1/1     Running   1 (28m ago)    5h5m</span><br><span class="line">pod/ks-apiserver-7b4479d5f5-2k4c9            1/1     Running   2 (27m ago)    5h5m</span><br><span class="line">pod/ks-console-6bd9b9f5d9-xqlzs              1/1     Running   0              26m</span><br><span class="line">pod/ks-controller-manager-547f9fc8c9-5b88z   1/1     Running   10 (27m ago)   5h5m</span><br><span class="line"></span><br><span class="line">NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/extensions-museum       1/1     1            1           5h14m</span><br><span class="line">deployment.apps/ks-apiserver            1/1     1            1           5h14m</span><br><span class="line">deployment.apps/ks-console              1/1     1            1           5h14m</span><br><span class="line">deployment.apps/ks-controller-manager   1/1     1            1           5h14m</span><br><span class="line"></span><br><span class="line">NAME                            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">service/extensions-museum       ClusterIP   10.96.95.71    &lt;none&gt;        443/TCP        5h14m</span><br><span class="line">service/ks-apiserver            ClusterIP   10.96.12.106   &lt;none&gt;        80/TCP         5h14m</span><br><span class="line">service/ks-console              NodePort    10.96.55.165   &lt;none&gt;        80:30880/TCP   5h14m</span><br><span class="line">service/ks-controller-manager   ClusterIP   10.96.13.243   &lt;none&gt;        443/TCP        5h14m</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµè§ˆå™¨è®¿é—®ï¼š<a href="http://10.211.55.11:30880">http://10.211.55.11:30880</a>ï¼Œè¾“å…¥è´¦å·å¯†ç ï¼šadmin/P@88w0rdï¼Œé¦–æ¬¡ç™»å½•éœ€è¦ä¿®æ”¹å¯†ç ã€‚</p></li></ul><h2 id="é…ç½®-ingress">é…ç½® ingress</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºè¯ä¹¦</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret tls nginx-tls \</span><br><span class="line">    --key=nginx_ssl/nginx.hanqunfeng.com.key \</span><br><span class="line">    --cert=nginx_ssl/nginx.hanqunfeng.com.pem \</span><br><span class="line">    -n kubesphere-system</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º ingress</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubesphere-ingress.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubesphere-nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubesphere-system</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kubesphere.hanqunfeng.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">nginx-tls</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">kubesphere.hanqunfeng.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">ks-console</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h2 id="å¸è½½-Kubesphere">å¸è½½ Kubesphere</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm uninstall ks-core -n kubesphere-system</span><br><span class="line">kubectl delete namespace kubesphere-system</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubesphere.io/zh/&quot;&gt;Kubesphere å®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S UI ä¹‹ Dashboard</title>
    <link href="https://blog.hanqunfeng.com/2025/07/24/k8s-ui-dashboard/"/>
    <id>https://blog.hanqunfeng.com/2025/07/24/k8s-ui-dashboard/</id>
    <published>2025-07-24T13:33:05.000Z</published>
    <updated>2025-07-24T13:37:46.313Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/">Dashboard k8sä»‹ç»</a></p></li></ul><span id="more"></span><h2 id="Dashboard-ç®€ä»‹">Dashboard ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Dashboard æ˜¯åŸºäºç½‘é¡µçš„ Kubernetes ç”¨æˆ·ç•Œé¢ã€‚</p></li><li class="lvl-2"><p>ä½ å¯ä»¥ä½¿ç”¨ Dashboard å°†å®¹å™¨åº”ç”¨éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œä¹Ÿå¯ä»¥å¯¹å®¹å™¨åº”ç”¨æ’é”™ï¼Œè¿˜èƒ½ç®¡ç†é›†ç¾¤èµ„æºã€‚</p></li><li class="lvl-2"><p>ä½ å¯ä»¥ä½¿ç”¨ Dashboard è·å–è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„åº”ç”¨çš„æ¦‚è§ˆä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæˆ–è€…ä¿®æ”¹ Kubernetes èµ„æº ï¼ˆå¦‚ Deploymentã€Jobã€DaemonSet ç­‰ç­‰ï¼‰ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥å¯¹ Deployment å®ç°å¼¹æ€§ä¼¸ç¼©ã€å‘èµ·æ»šåŠ¨å‡çº§ã€é‡å¯ Pod æˆ–è€…ä½¿ç”¨å‘å¯¼åˆ›å»ºæ–°çš„åº”ç”¨ã€‚</p></li><li class="lvl-2"><p>Dashboard åŒæ—¶å±•ç¤ºäº† Kubernetes é›†ç¾¤ä¸­çš„èµ„æºçŠ¶æ€ä¿¡æ¯å’Œæ‰€æœ‰æŠ¥é”™ä¿¡æ¯ã€‚</p></li></ul><h2 id="éƒ¨ç½²-Dashboard">éƒ¨ç½² Dashboard</h2><ul class="lvl-0"><li class="lvl-2"><p>Kubernetes Dashboard ç›®å‰ä»…æ”¯æŒåŸºäº Helm çš„å®‰è£…ï¼Œå› ä¸ºå®ƒé€Ÿåº¦æ›´å¿«ï¼Œ å¹¶ä¸”å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°æ§åˆ¶ Dashboard è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  kubernetes-dashboard ä»“åº“</span></span><br><span class="line">helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/</span><br><span class="line"><span class="comment"># ä½¿ç”¨ kubernetes-dashboard Chart éƒ¨ç½²åä¸º `kubernetes-dashboard` çš„ Helm Release</span></span><br><span class="line">$ helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \</span><br><span class="line">    --create-namespace \</span><br><span class="line">    --namespace kubernetes-dashboard</span><br><span class="line"><span class="comment">## è¾“å‡º</span></span><br><span class="line">Release <span class="string">&quot;kubernetes-dashboard&quot;</span> does not exist. Installing it now.</span><br><span class="line">NAME: kubernetes-dashboard</span><br><span class="line">LAST DEPLOYED: Sun Jul  6 00:40:02 2025</span><br><span class="line">NAMESPACE: kubernetes-dashboard</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">*************************************************************************************************</span><br><span class="line">*** PLEASE BE PATIENT: Kubernetes Dashboard may need a few minutes to get up and become ready ***</span><br><span class="line">*************************************************************************************************</span><br><span class="line"></span><br><span class="line">Congratulations! You have just installed Kubernetes Dashboard <span class="keyword">in</span> your cluster.</span><br><span class="line"></span><br><span class="line">To access Dashboard run:</span><br><span class="line">  kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443</span><br><span class="line"></span><br><span class="line">NOTE: In <span class="keyword">case</span> port-forward <span class="built_in">command</span> does not work, make sure that kong service name is correct.</span><br><span class="line">      Check the services <span class="keyword">in</span> Kubernetes Dashboard namespace using:</span><br><span class="line">        kubectl -n kubernetes-dashboard get svc</span><br><span class="line"></span><br><span class="line">Dashboard will be available at:</span><br><span class="line">  https://localhost:8443</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ helm å®‰è£…çš„åŒ…ï¼Œæ³¨æ„æŒ‡å®š å‘½åç©ºé—´</span></span><br><span class="line">$ helm list -n kubernetes-dashboard</span><br><span class="line">NAME                NAMESPACE           REVISIONUPDATED                                STATUS  CHART                      APP VERSION</span><br><span class="line">kubernetes-dashboardkubernetes-dashboard1       2025-07-24 14:01:06.678570212 +0800 CSTdeployedkubernetes-dashboard-7.13.0</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å¯åŠ¨çš„èµ„æº</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n kubernetes-dashboard get all</span><br><span class="line">NAME                                                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/kubernetes-dashboard-api-568f47ddd7-tx6f8              1/1     Running   0          20m</span><br><span class="line">pod/kubernetes-dashboard-auth-645b944589-t6v2m             1/1     Running   0          20m</span><br><span class="line">pod/kubernetes-dashboard-kong-648658d45f-7qsm9             1/1     Running   0          20m</span><br><span class="line">pod/kubernetes-dashboard-metrics-scraper-547874fcf-87mrv   1/1     Running   0          20m</span><br><span class="line">pod/kubernetes-dashboard-web-7796b9fbbb-xsdlw              1/1     Running   0          20m</span><br><span class="line"></span><br><span class="line">NAME                                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">service/kubernetes-dashboard-api               ClusterIP   10.96.149.59    &lt;none&gt;        8000/TCP   20m</span><br><span class="line">service/kubernetes-dashboard-auth              ClusterIP   10.96.145.120   &lt;none&gt;        8000/TCP   20m</span><br><span class="line">service/kubernetes-dashboard-kong-proxy        ClusterIP   10.96.171.40    &lt;none&gt;        443/TCP    20m</span><br><span class="line">service/kubernetes-dashboard-metrics-scraper   ClusterIP   10.96.79.48     &lt;none&gt;        8000/TCP   20m</span><br><span class="line">service/kubernetes-dashboard-web               ClusterIP   10.96.247.143   &lt;none&gt;        8000/TCP   20m</span><br><span class="line"></span><br><span class="line">NAME                                                   READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/kubernetes-dashboard-api               1/1     1            1           20m</span><br><span class="line">deployment.apps/kubernetes-dashboard-auth              1/1     1            1           20m</span><br><span class="line">deployment.apps/kubernetes-dashboard-kong              1/1     1            1           20m</span><br><span class="line">deployment.apps/kubernetes-dashboard-metrics-scraper   1/1     1            1           20m</span><br><span class="line">deployment.apps/kubernetes-dashboard-web               1/1     1            1           20m</span><br><span class="line"></span><br><span class="line">NAME                                                             DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/kubernetes-dashboard-api-568f47ddd7              1         1         1       20m</span><br><span class="line">replicaset.apps/kubernetes-dashboard-auth-645b944589             1         1         1       20m</span><br><span class="line">replicaset.apps/kubernetes-dashboard-kong-648658d45f             1         1         1       20m</span><br><span class="line">replicaset.apps/kubernetes-dashboard-metrics-scraper-547874fcf   1         1         1       20m</span><br><span class="line">replicaset.apps/kubernetes-dashboard-web-7796b9fbbb              1         1         1       20m</span><br></pre></td></tr></table></figure><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">ç¬¬ä¸€æ¬¡åˆ›å»ºkubernetes-dashboardæ—¶ï¼Œæœ‰å‡ ä¸ª pod ä¸€ç›´å¤„äº ContainerCreating çŠ¶æ€ï¼Œé€šè¿‡ describe å‘½ä»¤ï¼ŒæŸ¥çœ‹ pod çš„çŠ¶æ€å‘ç°æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning  FailedCreatePodSandBox  4m52s                kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network <span class="keyword">for</span> sandbox <span class="string">&quot;cfa0b6062fabd77353e6d832ab0e62f96787b4d59346d9e57c28dbc0e19a3127&quot;</span>: plugin <span class="built_in">type</span>=<span class="string">&quot;calico&quot;</span> failed (add): error getting ClusterInformation: connection is unauthorized: Unauthorized</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2"><p>è¿™æ¡é”™è¯¯è¯´æ˜ï¼š</p><ul class="lvl-3"><li class="lvl-6">å®¹å™¨ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰ä½¿ç”¨çš„æ˜¯ Calico</li><li class="lvl-6">Calico åœ¨å°è¯•è·å– Kubernetes é›†ç¾¤çš„ ClusterInformation æ—¶ è®¤è¯å¤±è´¥</li><li class="lvl-6">é”™è¯¯å…³é”®è¯ï¼šconnection is unauthorized: Unauthorized</li></ul></li><li class="lvl-2"><p>ä¸ç¡®å®šå¯¼è‡´è¿™ä¸€é—®é¢˜çš„åŸå› ï¼Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯é‡æ–°å®‰è£… Calico</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f calico.yaml</span><br><span class="line">kubectl apply -f calico.yaml</span><br></pre></td></tr></table></figure></div><ul class="lvl-0"><li class="lvl-2"><p>å¼€æ”¾ä»£ç†ç«¯å£</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å“ªä¸ªæœºå™¨ä¸Šè¿è¡Œçš„å‘½ä»¤ï¼Œå¼€æ”¾çš„å°±æ˜¯å“ªä¸ªæœºå™¨çš„ç«¯å£</span></span><br><span class="line">kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è®¿é—®ï¼šåœ¨å¼€æ”¾ä»£ç†ç«¯å£çš„æœºå™¨ä¸Šä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼š<a href="https://localhost:8443">https://localhost:8443</a></p></li></ul><h2 id="ç™»å½•å¸å·">ç™»å½•å¸å·</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dashboard-adminuser.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span>                    <span class="comment"># åˆ›å»º ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span>                      <span class="comment"># SA åç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span>       <span class="comment"># SA æ‰€åœ¨å‘½åç©ºé—´</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span>                <span class="comment"># é›†ç¾¤è§’è‰²ç»‘å®š</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span>   <span class="comment"># é›†ç¾¤è§’è‰²ç»„ï¼Œè¿™ä¸ªæ˜¯ k8s å†…ç½®çš„</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span>                     <span class="comment"># é›†ç¾¤è§’è‰²</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-admin</span>                   <span class="comment"># é›†ç¾¤ç®¡ç†å‘˜è§’è‰²</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span>                  <span class="comment"># æœåŠ¡è´¦å·</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span>                      <span class="comment"># æœåŠ¡è´¦å·åç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span>       <span class="comment"># æœåŠ¡è´¦å·å‘½åç©ºé—´</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºå¹¶è·å–token</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f dashboard-adminuser.yaml</span><br><span class="line"><span class="comment"># è·å–tokenï¼Œè¯¥ token æœ‰æ•ˆæœŸä¸º 1 å°æ—¶ï¼Œtokenæ ¼å¼ä¸º jwtï¼Œå¯ä»¥é€šè¿‡ jwt.io è§£æ</span></span><br><span class="line">kubectl -n kubernetes-dashboard create token admin-user</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è·å–é•¿æ•ˆtoken</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dashboard-secret.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/service-account.name:</span> <span class="string">&quot;admin-user&quot;</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">kubernetes.io/service-account-token</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f dashboard-secret.yaml</span><br><span class="line"><span class="comment"># è¯¥å‘½ä»¤è·å–tokenï¼Œæ°¸ä¸è¿‡æœŸï¼Œå°†å…¶ä¿å­˜ä¸‹æ¥</span></span><br><span class="line">kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath=<span class="string">&quot;&#123;.data.token&#125;&quot;</span> | <span class="built_in">base64</span> -d</span><br></pre></td></tr></table></figure><h2 id="å¸è½½-kubernetes-dashboard">å¸è½½ kubernetes-dashboard</h2><ul class="lvl-0"><li class="lvl-2"><p>å¸è½½ kubernetes-dashboard</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm uninstall kubernetes-dashboard --namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ¸…ç†ç”¨æˆ·ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kubernetes-dashboard delete serviceaccount admin-user</span><br><span class="line">kubectl -n kubernetes-dashboard delete clusterrolebinding admin-user</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ å‘½åç©ºé—´ï¼Œåˆ é™¤å‘½åç©ºé—´ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰èµ„æº</span></span><br><span class="line">kubectl delete namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/&quot;&gt;Dashboard k8sä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ Tools</title>
    <link href="https://blog.hanqunfeng.com/2025/07/24/k8s-tools/"/>
    <id>https://blog.hanqunfeng.com/2025/07/24/k8s-tools/</id>
    <published>2025-07-24T13:30:05.000Z</published>
    <updated>2025-08-26T02:21:30.959Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-3"><p>K8S çš„ Tools: crictlã€nerdctlã€helm ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li></ul><span id="more"></span><h2 id="crictl-å‘½ä»¤">crictl å‘½ä»¤</h2><ul class="lvl-0"><li class="lvl-2"><p><code>crictl</code> æ˜¯k8så®˜æ–¹å‡ºå“çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ containerd è¿›è¡Œé€šä¿¡ã€‚</p></li><li class="lvl-2"><p><code>crictl</code> å‘½ä»¤é»˜è®¤éœ€è¦ sudo æƒé™ï¼Œå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ  sudoï¼Œå¯ä»¥å°†ç”¨æˆ·åŠ å…¥ containerd çš„ socket æƒé™ç»„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># containerd çš„é»˜è®¤ socket æ˜¯ /var/run/containerd/containerd.sock</span></span><br><span class="line">$ <span class="built_in">ls</span> -l /var/run/containerd/containerd.sock</span><br><span class="line">srw-rw---- 1 root root 0 7æœˆ   1 10:57 /var/run/containerd/containerd.sock</span><br><span class="line"><span class="comment"># å¦‚æœ group æ˜¯ rootï¼šä½ å¯ä»¥æ”¹ä¸ºå…¶å®ƒç»„ï¼Œæ¯”å¦‚ docker</span></span><br><span class="line"><span class="comment"># å¦‚æœ docker ç»„ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line"><span class="built_in">sudo</span> groupadd docker</span><br><span class="line"><span class="comment"># ä¿®æ”¹æ–‡ä»¶æ‰€å±ç»„ä¸º docker</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chgrp</span> docker /var/run/containerd/containerd.sock</span><br><span class="line"><span class="comment"># ä¸ºç»„æ·»åŠ è¯»å†™æƒé™</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> g+rw /var/run/containerd/containerd.sock</span><br><span class="line"><span class="comment"># æ·»åŠ ç”¨æˆ·åˆ° docker ç»„</span></span><br><span class="line"><span class="built_in">sudo</span> usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"><span class="comment"># åˆ·æ–°æƒé™</span></span><br><span class="line">newgrp docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶è™½ç„¶å·²ç»å¯ä»¥ä¸ç”¨ sudo äº†ï¼Œä½†æ˜¯ä¸€æ—¦é‡å¯ containerd å°±ä¼šé‡æ–°å›åˆ° root æƒé™ï¼Œå› æ­¤éœ€è¦æ·»åŠ å¦‚ä¸‹é…ç½®</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/systemd/system/containerd.service.d/</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/systemd/system/containerd.service.d/override.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">ExecStartPost=/bin/bash -c &#x27;chmod 660 /run/containerd/containerd.sock &amp;&amp; chgrp docker /run/containerd/containerd.sock&#x27;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart containerd</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>crictl</code> å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç±»ä¼¼<code>docker</code>å‘½ä»¤</p></li></ul><table><thead><tr><th>æ“ä½œ</th><th><code>docker</code> å‘½ä»¤</th><th><code>crictl</code> å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</td><td><code>docker ps</code></td><td><code>crictl ps</code></td><td></td></tr><tr><td>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢ï¼‰</td><td><code>docker ps -a</code></td><td><code>crictl ps -a</code></td><td></td></tr><tr><td>æŸ¥çœ‹é•œåƒ</td><td><code>docker images</code></td><td><code>crictl images</code></td><td></td></tr><tr><td>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</td><td><code>docker logs &lt;container_id&gt;</code></td><td><code>crictl logs &lt;container_id&gt;</code></td><td></td></tr><tr><td>è¿›å…¥å®¹å™¨äº¤äº’</td><td><code>docker exec -it &lt;id&gt; sh</code></td><td><code>crictl exec -it &lt;id&gt; sh</code></td><td></td></tr><tr><td>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</td><td><code>docker inspect &lt;container_id&gt;</code></td><td><code>crictl inspect &lt;container_id&gt;</code></td><td></td></tr><tr><td>æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯</td><td>âŒï¼ˆä¸æ”¯æŒï¼‰</td><td><code>crictl inspectp &lt;pod_id&gt;</code></td><td>K8s ä¸“å±</td></tr><tr><td>åˆ é™¤å®¹å™¨</td><td><code>docker rm &lt;container_id&gt;</code></td><td><code>crictl rm &lt;container_id&gt;</code></td><td></td></tr><tr><td>åˆ é™¤é•œåƒ</td><td><code>docker rmi &lt;image_id&gt;</code></td><td><code>crictl rmi &lt;image_id&gt;</code></td><td></td></tr><tr><td>æ‹‰å–é•œåƒ</td><td><code>docker pull nginx</code></td><td><code>crictl pull nginx</code></td><td></td></tr><tr><td>è¿è¡Œå®¹å™¨ï¼ˆé K8s åœºæ™¯ï¼‰</td><td><code>docker run -it nginx</code></td><td>âŒï¼ˆä¸æ”¯æŒï¼‰</td><td><code>crictl</code> ä¸è¿è¡Œå®¹å™¨ï¼Œä»…è°ƒè¯•ç°æœ‰å®¹å™¨</td></tr><tr><td>åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶ä¿¡æ¯</td><td><code>docker info</code></td><td><code>crictl info</code></td><td></td></tr><tr><td>æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€</td><td><code>docker stats</code></td><td><code>crictl stats</code></td><td>ç®€è¦ç‰ˆ</td></tr><tr><td>è®¾ç½®é…ç½®æ–‡ä»¶</td><td><code>~/.docker/config.json</code></td><td><code>/etc/crictl.yaml</code></td><td>å¦‚è®¾ç½® endpoint</td></tr></tbody></table><h2 id="nerdctl">nerdctl</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://github.com/containerd/nerdctl">nerdctl</a> æ˜¯ä¸€ä¸ª å…¼å®¹ Docker CLI çš„å®¹å™¨å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† containerd å®¹å™¨è¿è¡Œæ—¶ã€‚</p></li><li class="lvl-2"><p>å®ƒæ˜¯ containerd å®˜æ–¹å­é¡¹ç›®ï¼Œç”± CNCF ç»´æŠ¤ï¼Œå…¶å‘½ä»¤è¯­æ³•ä¸ Docker CLI å…¼å®¹ï¼Œç›®æ ‡æ˜¯è®©ä¹ æƒ¯ Docker çš„ç”¨æˆ·ä¹Ÿèƒ½è½»æ¾ä½¿ç”¨ containerdã€‚</p></li><li class="lvl-2"><p>å®‰è£… nerdctl</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line">VERSION=2.1.3</span><br><span class="line">wget https://github.com/containerd/nerdctl/releases/download/v<span class="variable">$&#123;VERSION&#125;</span>/nerdctl-<span class="variable">$&#123;VERSION&#125;</span>-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è§£å‹</span></span><br><span class="line">tar -xvf nerdctl-<span class="variable">$&#123;VERSION&#125;</span>-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ç§»åŠ¨åˆ°ç³»ç»Ÿ PATH</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> nerdctl /usr/local/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># nerdctl éœ€è¦ sudo æƒé™</span></span><br><span class="line"><span class="comment">## ä¸º sudo æ·»åŠ  PATH</span></span><br><span class="line"><span class="built_in">sudo</span> visudo</span><br><span class="line"><span class="comment">## æ‰¾åˆ°è¿™ä¸€è¡Œ</span></span><br><span class="line">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line"><span class="comment">## ä¿®æ”¹ä¸ºï¼Œå³å°† nerdctl æ‰€åœ¨çš„ç›®å½•åŠ å…¥ PATH</span></span><br><span class="line">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin:/usr/local/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æµ‹è¯•</span></span><br><span class="line"><span class="comment">## æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">sudo</span> nerdctl version</span><br><span class="line"><span class="comment">## åˆ—å‡ºå®¹å™¨ï¼Œ--namespace k8s.io è¡¨ç¤ºæŸ¥çœ‹ k8s ä¸­çš„å®¹å™¨</span></span><br><span class="line"><span class="built_in">sudo</span> nerdctl ps --namespace k8s.io</span><br><span class="line"></span><br><span class="line"><span class="comment">## å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ ä¸Š --namespace k8s.ioï¼Œå¯ä»¥è®¾ç½®åˆ«å</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;alias kps=&#x27;sudo nerdctl --namespace=k8s.io ps&#x27;&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="comment">## æµ‹è¯•</span></span><br><span class="line">kps</span><br></pre></td></tr></table></figure><h2 id="Helm">Helm</h2><ul class="lvl-0"><li class="lvl-2"><p><a href="https://helm.sh/zh/docs/">å®˜ç½‘æ–‡æ¡£</a></p></li><li class="lvl-2"><p>Helm æ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼äº Linux ä¸‹çš„åŒ…ç®¡ç†å·¥å…·å¦‚ yumã€apt ç­‰ã€‚å¯ä»¥æ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„ yaml æ–‡ä»¶éƒ¨ç½²åˆ° Kunernetes ä¸Šã€‚</p></li></ul><h3 id="Helmçš„å®‰è£…">Helmçš„å®‰è£…</h3><ul class="lvl-0"><li class="lvl-2"><p>å®˜ç½‘<a href="https://helm.sh/zh/docs/intro/install/">å®‰è£…æ–¹æ³•</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://get.helm.sh/helm-v3.17.4-linux-amd64.tar.gz</span><br><span class="line">tar -zxvf helm-v3.17.4-linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> linux-amd64/helm /usr/local/bin/helm</span><br><span class="line">$ helm version</span><br><span class="line">version.BuildInfo&#123;Version:<span class="string">&quot;v3.17.4&quot;</span>, GitCommit:<span class="string">&quot;595a05da6166037d0abebaa27ac8a498fa4d7ed2&quot;</span>, GitTreeState:<span class="string">&quot;clean&quot;</span>, GoVersion:<span class="string">&quot;go1.23.10&quot;</span>&#125;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Helm<a href="https://helm.sh/zh/docs/helm/helm_completion_bash/">è‡ªåŠ¨è¡¥å…¨</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… helm çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</span></span><br><span class="line"><span class="comment"># 1 å½“å‰ç”¨æˆ·</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;source &lt;(helm completion bash)&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line">helm completion bash | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/bash_completion.d/helm &gt; /dev/null</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> a+r /etc/bash_completion.d/helm</span><br></pre></td></tr></table></figure><h3 id="Helmçš„ä½¿ç”¨">Helmçš„ä½¿ç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>å¯ä»¥å‚è€ƒ <a href="/2023/07/10/aws-eks14-helm/" title="AWS-EKS-14--Helm">AWS-EKS-14--Helm</a></p></li></ul><h4 id="ä»“åº“ç®¡ç†">ä»“åº“ç®¡ç†</h4><ul class="lvl-0"><li class="lvl-2"><p>addï¼šæ·»åŠ å›¾è¡¨å­˜å‚¨åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>listï¼šåˆ—å‡ºå›¾è¡¨å­˜å‚¨åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo list</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>removeï¼šåˆ é™¤å›¾è¡¨å­˜å‚¨åº“</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo remove bitnami</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>updateï¼šä»å›¾è¡¨å­˜å‚¨åº“æ›´æ–°æœ¬åœ°å¯ç”¨å›¾è¡¨çš„ä¿¡æ¯</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ–°æ‰€æœ‰ä»“åº“</span></span><br><span class="line">helm repo update</span><br><span class="line"><span class="comment"># æ›´æ–°æŒ‡å®šçš„ä»“åº“</span></span><br><span class="line">helm repo update bitnami</span><br></pre></td></tr></table></figure><h4 id="åœ¨ä»“åº“ä¸­æœç´¢">åœ¨ä»“åº“ä¸­æœç´¢</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨æ‰€æœ‰ä»“åº“ä¸­æœç´¢ï¼Œé»˜è®¤åªå±•ç¤ºæœ€æ–°çš„ç‰ˆæœ¬</span></span><br><span class="line">helm search repo nginx</span><br><span class="line"><span class="comment"># åœ¨æŒ‡å®šçš„ä»“åº“ä¸­æœç´¢</span></span><br><span class="line">helm search repo bitnami/wordpress</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰ç‰ˆæœ¬</span></span><br><span class="line">helm search repo nginx -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å…¨éƒ¨ç‰ˆæœ¬ä¸­æœç´¢å¤§äºç­‰äºæŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">$ helm search repo nginx --version ^21.0.0 -l</span><br><span class="line">NAME         CHART VERSIONAPP VERSIONDESCRIPTION</span><br><span class="line">bitnami/nginx21.0.8       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.7       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.6       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.4       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.3       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.2       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.1       1.29.0     NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx21.0.0       1.29.0     NGINX Open Source is a web server that can be a...</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…åŒ…">å®‰è£…åŒ…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…æœ€æ–°ç‰ˆ</span></span><br><span class="line">helm install nginx bitnami/nginx</span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">helm install nginx bitnami/nginx --version 21.0.3</span><br><span class="line"><span class="comment"># å®‰è£…åŒ…åˆ°æŒ‡å®šå‘½åç©ºé—´</span></span><br><span class="line">helm install nginx bitnami/nginx -n &lt;namespace&gt;</span><br><span class="line"><span class="comment"># å®‰è£…åŒ…å¹¶åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">helm install nginx bitnami/nginx -n &lt;namespace&gt; --create-namespace</span><br><span class="line"><span class="comment"># ociï¼š ä» docker ä»“åº“ä¸­å®‰è£…</span></span><br><span class="line">helm pull oci://registry-1.docker.io/bitnamicharts/nginx --version 21.0.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æœ¬åœ° chart ç›®å½•</span></span><br><span class="line">helm install my-release ./nginx</span><br><span class="line"><span class="comment"># å®‰è£… .tgz æ ¼å¼çš„æ‰“åŒ… chart</span></span><br><span class="line">helm install my-release ./nginx-1.2.3.tgz</span><br><span class="line"><span class="comment"># ä»è¿œç¨‹tgzå®‰è£…</span></span><br><span class="line">helm install my-release https://example.com/charts/nginx-1.2.3.tgz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Git ä»“åº“ä¸­çš„ chartï¼ˆç»“åˆ pluginï¼‰</span></span><br><span class="line">helm plugin install https://github.com/aslafy-z/helm-git</span><br><span class="line">helm repo add mychart <span class="string">&#x27;git+https://github.com/myorg/mychart.git&#x27;</span></span><br><span class="line">helm install my-release mychart/nginx</span><br><span class="line"><span class="comment"># å¸è½½helm-gitæ’ä»¶</span></span><br><span class="line">helm plugin remove helm-git</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ --set ä¼ é€’å•ä¸ªæˆ–å¤šä¸ªå€¼</span></span><br><span class="line">helm install my-release bitnami/nginx --<span class="built_in">set</span> service.type=NodePort</span><br><span class="line"><span class="comment"># ä½¿ç”¨ --values æˆ– -f åŠ è½½ YAML é…ç½®æ–‡ä»¶</span></span><br><span class="line">helm install my-release bitnami/nginx -f custom-values.yaml</span><br><span class="line"><span class="comment"># åŒæ—¶ä½¿ç”¨å¤šç§ values æ–‡ä»¶ + --set</span></span><br><span class="line">helm install my-release bitnami/nginx -f base.yaml -f prod.yaml --<span class="built_in">set</span> replicaCount=3</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…">æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´å·²å®‰è£…çš„åŒ…</span></span><br><span class="line">helm list -n &lt;namespace&gt;</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„åŒ…</span></span><br><span class="line">helm list -A</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…çŠ¶æ€</span></span><br><span class="line">helm status ngxin -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure><h4 id="å¸è½½åŒ…">å¸è½½åŒ…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm uninstall nginx -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-3&quot;&gt;
&lt;p&gt;K8S çš„ Tools: crictlã€nerdctlã€helm ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ è¿œç¨‹è¿æ¥</title>
    <link href="https://blog.hanqunfeng.com/2025/07/24/k8s-connection/"/>
    <id>https://blog.hanqunfeng.com/2025/07/24/k8s-connection/</id>
    <published>2025-07-24T12:30:05.000Z</published>
    <updated>2025-07-24T02:27:51.050Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç»  K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li></ul><span id="more"></span><h2 id="è¿œç¨‹è¿æ¥-k8s-é›†ç¾¤">è¿œç¨‹è¿æ¥ k8s é›†ç¾¤</h2><h3 id="æœ¬åœ°ä¸å­˜åœ¨-kubeconfig-æ–‡ä»¶">æœ¬åœ°ä¸å­˜åœ¨ kubeconfig æ–‡ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>è·å– kubeconfig æ–‡ä»¶ï¼Œä½äº Master èŠ‚ç‚¹ï¼š/etc/kubernetes/admin.confï¼Œå°†å…¶æ‹·è´åˆ°æœ¬åœ°</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/config</span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°å·²å­˜åœ¨-kubeconfig-æ–‡ä»¶">æœ¬åœ°å·²å­˜åœ¨ kubeconfig æ–‡ä»¶</h3><ul class="lvl-0"><li class="lvl-2"><p>å·²ç»é…ç½®äº†ä¸€ä¸ªé›†ç¾¤çš„è¿æ¥ï¼Œè¿˜æƒ³å†æ·»åŠ ä¸€ä¸ªé›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡é€šè¿‡åˆå¹¶çš„æ–¹å¼æ·»åŠ </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æ–°é›†ç¾¤çš„ kubeconfig æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°</span></span><br><span class="line">scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/new-cluster.conf</span><br><span class="line"><span class="comment"># åˆå¹¶</span></span><br><span class="line">KUBECONFIG=~/.kube/config:new-cluster.conf kubectl config view --flatten &gt; merged-config.yaml</span><br><span class="line"><span class="comment"># æ›¿æ¢</span></span><br><span class="line"><span class="built_in">mv</span> merged-config.yaml ~/.kube/config</span><br></pre></td></tr></table></figure><h3 id="é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤">é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤</h3><ul class="lvl-0"><li class="lvl-2"><p>è·å–é›†ç¾¤é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å–æ‰€æœ‰é›†ç¾¤é…ç½®</span></span><br><span class="line">kubectl config get-contexts</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰é»˜è®¤çš„ context</span></span><br><span class="line">kubectl config current-context</span><br><span class="line"><span class="comment"># åˆ‡æ¢ context</span></span><br><span class="line">kubectl config use-context &lt;context_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é›†ç¾¤åç§°</span></span><br><span class="line">kubectl config get-clusters</span><br><span class="line"><span class="comment"># è·å–ç”¨æˆ·åç§°</span></span><br><span class="line">kubectl config get-users</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æµ‹è¯•</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤é›†ç¾¤é…ç½®</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤ context</span></span><br><span class="line">kubectl config delete-context &lt;context_name&gt;</span><br><span class="line"><span class="comment"># åˆ é™¤ cluster</span></span><br><span class="line">kubectl config delete-cluster &lt;cluster_name&gt;</span><br><span class="line"><span class="comment"># åˆ é™¤ user</span></span><br><span class="line">kubectl config delete-user &lt;user_name&gt;</span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘ kubeconfigï¼ˆ~/.kube/configï¼‰ æ–‡ä»¶ï¼Œæ·»åŠ æˆ–åˆ é™¤ä¸éœ€è¦çš„é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»  K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ Secret</title>
    <link href="https://blog.hanqunfeng.com/2025/07/23/k8s-secret/"/>
    <id>https://blog.hanqunfeng.com/2025/07/23/k8s-secret/</id>
    <published>2025-07-23T13:35:15.000Z</published>
    <updated>2025-07-23T09:36:36.272Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/">k8s Secret å®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="Secret-ä»‹ç»">Secret ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>Secret æ˜¯ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€ä»¤ç‰Œæˆ–å¯†é’¥çš„å¯¹è±¡ã€‚ è¿™æ ·çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«æ”¾åœ¨ Pod è§„çº¦ä¸­æˆ–è€…é•œåƒä¸­ã€‚ ä½¿ç”¨ Secret æ„å‘³ç€ä½ ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­åŒ…å«æœºå¯†æ•°æ®ã€‚</p></li><li class="lvl-2"><p>ç”±äºåˆ›å»º Secret å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„ Podï¼Œ å› æ­¤åœ¨åˆ›å»ºã€æŸ¥çœ‹å’Œç¼–è¾‘ Pod çš„å·¥ä½œæµç¨‹ä¸­æš´éœ² Secretï¼ˆåŠå…¶æ•°æ®ï¼‰çš„é£é™©è¾ƒå°ã€‚ Kubernetes å’Œåœ¨é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å¯¹ Secret é‡‡å–é¢å¤–çš„é¢„é˜²æªæ–½ï¼Œ ä¾‹å¦‚é¿å…å°†æ•æ„Ÿæ•°æ®å†™å…¥éæ˜“å¤±æ€§å­˜å‚¨ã€‚</p></li><li class="lvl-2"><p>Secret ç±»ä¼¼äº ConfigMap ä½†ä¸“é—¨ç”¨äºä¿å­˜æœºå¯†æ•°æ®ã€‚</p></li><li class="lvl-2"><p>æ¯ä¸ª Secret çš„å°ºå¯¸æœ€å¤šä¸º 1MiB</p></li><li class="lvl-2"><p>åœ¨ K8S ä¸­ï¼ŒSecret æœ‰å¤šç§ç±»å‹ï¼šæœ¬æ–‡åªè®²è§£ <code>Opaque</code> ç±»å‹ï¼Œå…¶ä½™ç±»å‹å‚è€ƒ[å®˜ç½‘]((<a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/">https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/</a>)ã€‚</p></li></ul><table><thead><tr><th>å†…ç½®ç±»å‹</th><th>ç”¨æ³•æè¿°</th></tr></thead><tbody><tr><td><code>Opaque</code></td><td>ç”¨æˆ·è‡ªå®šä¹‰çš„ä»»æ„æ•°æ®ï¼ˆé»˜è®¤ç±»å‹ï¼‰</td></tr><tr><td><code>kubernetes.io/service-account-token</code></td><td>è‡ªåŠ¨æŒ‚è½½çš„æœåŠ¡è´¦å·ä»¤ç‰Œï¼Œä¾› Pod è®¿é—® API ä½¿ç”¨</td></tr><tr><td><code>kubernetes.io/dockercfg</code></td><td>åºåˆ—åŒ–çš„ <code>~/.dockercfg</code> æ–‡ä»¶ï¼Œç”¨äºç§æœ‰ä»“åº“è®¤è¯ï¼ˆæ—§æ ¼å¼ï¼‰</td></tr><tr><td><code>kubernetes.io/dockerconfigjson</code></td><td>åºåˆ—åŒ–çš„ <code>~/.docker/config.json</code> æ–‡ä»¶ï¼ˆæ¨èï¼‰</td></tr><tr><td><code>kubernetes.io/basic-auth</code></td><td>å­˜å‚¨ç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨äº HTTP åŸºæœ¬è®¤è¯</td></tr><tr><td><code>kubernetes.io/ssh-auth</code></td><td>å­˜å‚¨ SSH ç§é’¥ï¼Œç”¨äº SSH èº«ä»½è®¤è¯</td></tr><tr><td><code>kubernetes.io/tls</code></td><td>å­˜å‚¨ TLS å¯†é’¥å’Œè¯ä¹¦ï¼Œç”¨äº HTTPS æˆ–æœåŠ¡åŠ å¯†é€šä¿¡</td></tr><tr><td><code>bootstrap.kubernetes.io/token</code></td><td>ç”¨äº kubelet åŠ å…¥é›†ç¾¤çš„å¼•å¯¼ä»¤ç‰Œ</td></tr></tbody></table><h2 id="Secret-åˆ›å»ºåŠä½¿ç”¨">Secret åˆ›å»ºåŠä½¿ç”¨</h2><ul class="lvl-0"><li class="lvl-2"><p>Secret ä¸ ConfigMap åˆ›å»ºåŠä½¿ç”¨ç±»ä¼¼ï¼Œéƒ½æ˜¯å­˜å‚¨é”®å€¼å¯¹ï¼Œä½†å­˜å‚¨å†…å®¹ä¸åŒï¼ŒSecret å­˜å‚¨çš„æ˜¯ Base64 ç¼–ç åçš„å†…å®¹ã€‚</p></li></ul><h3 id="ç¯å¢ƒå˜é‡å¼•ç”¨">ç¯å¢ƒå˜é‡å¼•ç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>yamlåˆ›å»º</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysevret.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span>                  <span class="comment"># é»˜è®¤ç±»å‹ ï¼Œå¯ä»¥çœç•¥</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">YWRtaW4=</span>          <span class="comment"># &quot;admin&quot; çš„ base64 ç¼–ç </span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">MWYyZDFlMmU2N2Rm</span>  <span class="comment"># &quot;1f2d1e2e67df&quot; çš„ base64 ç¼–ç </span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œåˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># keyï¼švalue æ–¹å¼åˆ›å»ºï¼Œè¿™é‡Œ value å€¼æ˜¯ æ˜æ–‡ï¼Œk8s ä¼šè¿›è¡Œ base64 ç¼–ç </span></span><br><span class="line">kubectl create secret generic my-secret \</span><br><span class="line">  --from-literal=username=admin \</span><br><span class="line">  --from-literal=password=1f2d1e2e67df</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶æ–¹å¼åˆ›å»º</span></span><br><span class="line"><span class="comment"># --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ Secret ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚</span></span><br><span class="line">kubectl create secret generic my-secret \</span><br><span class="line">  --from-env-file=username.env \</span><br><span class="line">  --from-env-file=password.env</span><br><span class="line"></span><br><span class="line"><span class="comment"># username.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># username=admin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># password.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># password=1f2d1e2e67df</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ Secret çš„å†…å®¹</span></span><br><span class="line">$ k get secrets my-secret -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  password: MWYyZDFlMmU2N2Rm</span><br><span class="line">  username: YWRtaW4=</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">&quot;2025-07-05T13:21:22Z&quot;</span></span><br><span class="line">  name: my-secret</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: <span class="string">&quot;747355&quot;</span></span><br><span class="line">  uid: 4f77269d-d4c3-4ae8-aafc-7cfa56b84a5d</span><br><span class="line"><span class="built_in">type</span>: Opaque</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">env-secret</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;printenv&quot;</span>] <span class="comment"># æ‰“å°ç¯å¢ƒå˜é‡</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">      <span class="attr">envFrom:</span>                  <span class="comment"># ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€ Secret ï¼Œç­‰ç­‰</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">secretRef:</span>            <span class="comment"># è¿™é‡Œå¼•ç”¨ Secret ï¼Œæ­¤å¤„å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">my-secret</span>     <span class="comment"># Secret åç§°</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°† Secret ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod2.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">env-secret2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line">    <span class="attr">args:</span>                       <span class="comment"># å®¹å™¨å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        echo &quot;username: $&#123;SECRET_USERNAME&#125;&quot;</span></span><br><span class="line"><span class="string">        echo &quot;password: $&#123;SECRET_PASSWORD&#125;&quot;</span></span><br><span class="line"><span class="string"></span>    <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">    <span class="attr">env:</span>                        <span class="comment"># ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SECRET_USERNAME</span>     <span class="comment"># è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key</span></span><br><span class="line">      <span class="attr">valueFrom:</span>                <span class="comment"># value æ¥æº</span></span><br><span class="line">        <span class="attr">secretKeyRef:</span>           <span class="comment"># å¼•ç”¨ Secret ä¸­çš„ key</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">my-secret</span>       <span class="comment"># Secret åç§°</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">username</span>         <span class="comment"># Secret ä¸­ key çš„åç§°</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SECRET_PASSWORD</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">secretKeyRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">password</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹podæ—¥å¿—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ k logs pods/env-secret</span><br><span class="line">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br><span class="line">KUBERNETES_SERVICE_PORT=443</span><br><span class="line">HOSTNAME=env-secret</span><br><span class="line">SHLVL=1</span><br><span class="line">username=admin</span><br><span class="line">HOME=/root</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class="line">password=1f2d1e2e67df</span><br><span class="line">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class="line">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br><span class="line">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class="line">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br><span class="line">PWD=/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ k logs pods/env-secret2</span><br><span class="line">username: admin</span><br><span class="line">password: 1f2d1e2e67df</span><br></pre></td></tr></table></figure><h3 id="å­˜å‚¨å·å¼•ç”¨">å­˜å‚¨å·å¼•ç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>yamlåˆ›å»º</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># secret-configfile.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">stringData:</span>                          <span class="comment"># ä½¿ç”¨ stringDataï¼ŒK8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç </span></span><br><span class="line">  <span class="attr">app.properties:</span> <span class="string">|</span>                  <span class="comment"># æ–‡ä»¶å</span></span><br><span class="line">    <span class="string">server.port=8080</span></span><br><span class="line">    <span class="string">log.level=INFO</span></span><br><span class="line">  <span class="attr">db.properties:</span> <span class="string">|</span>                   <span class="comment"># æ–‡ä»¶å</span></span><br><span class="line">    <span class="string">db.host=localhost</span></span><br><span class="line">    <span class="string">db.port=5432</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œåˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment"># æ–‡ä»¶å†…å®¹æ˜¯æ˜æ–‡ï¼Œk8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç </span></span><br><span class="line">kubectl create secret generic my-secret \</span><br><span class="line">  --from-file=app.properties \</span><br><span class="line">  --from-file=db.properties</span><br><span class="line"><span class="comment"># app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># server.port=8080</span></span><br><span class="line"><span class="comment"># log.level=INFO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># db.host=localhost</span></span><br><span class="line"><span class="comment"># db.port=5432</span></span><br><span class="line"></span><br><span class="line">$ k get secrets my-secret -oyaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  app.properties: c2VydmVyLnBvcnQ9ODA4MApsb2cubGV2ZWw9SU5GTwo=</span><br><span class="line">  db.properties: ZGIuaG9zdD1sb2NhbGhvc3QKZGIucG9ydD0xMjU0MzIK</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">&quot;2025-07-05T13:45:14Z&quot;</span></span><br><span class="line">  name: my-secret</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: <span class="string">&quot;750742&quot;</span></span><br><span class="line">  uid: 35ffcdd6-d70a-4f3a-9246-5c56da630bc1</span><br><span class="line"><span class="built_in">type</span>: Opaque</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Pod æŒ‚è½½ Secret ä¸ºæ–‡ä»¶</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># secret-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sleep&quot;</span>, <span class="string">&quot;3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/etc/config</span>              <span class="comment"># æŒ‚è½½è·¯å¾„</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span>                   <span class="comment"># å­˜å‚¨å· åç§°</span></span><br><span class="line">    <span class="attr">secret:</span>                               <span class="comment"># å­˜å‚¨å·ç±»å‹ä¸º Secret</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">my-secret</span>               <span class="comment"># æŒ‚è½½çš„ Secret åç§°ï¼Œæœ¬åˆ©ä¸­å°† Secret ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®¹å™¨å†…çš„ <code>/etc/config/</code> ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/config/app.properties</span><br><span class="line">/etc/config/db.properties</span><br><span class="line"></span><br><span class="line">$ k <span class="built_in">exec</span> -it secret-demo -- <span class="built_in">ls</span> /etc/config/</span><br><span class="line">app.properties  db.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœåªæƒ³æŒ‚è½½ Secret ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>items</code> å­—æ®µæŒ‡å®šï¼š</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># secret-pod2.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret-demo2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sleep&quot;</span>, <span class="string">&quot;3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/etc/config</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">    <span class="attr">secret:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">my-secret</span></span><br><span class="line">      <span class="attr">items:</span>                   <span class="comment"># æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app.properties</span>    <span class="comment"># secret ä¸­çš„key</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">app.properties</span>   <span class="comment"># æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties</span></span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>Secret çš„ç‰¹ç‚¹ä¸ä½¿ç”¨æ–¹æ³•ä¸ ConfigMap éå¸¸ç±»ä¼¼ã€‚</p></li><li class="lvl-2"><p>ğŸ” ConfigMap vs Secret å¯¹æ¯”è¡¨ï¼š</p></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>ConfigMap</th><th>Secret</th></tr></thead><tbody><tr><td><strong>ç”¨é€”</strong></td><td>å­˜å‚¨éæ•æ„Ÿé…ç½®ä¿¡æ¯ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ï¼‰</td><td>å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€è¯ä¹¦ã€tokenï¼‰</td></tr><tr><td><strong>æ•°æ®æ˜¯å¦åŠ å¯†</strong></td><td>å¦ï¼Œæ˜æ–‡å­˜å‚¨ï¼ˆBase64 ç¼–ç å¯è¯»ï¼‰</td><td>å¦ï¼ˆé»˜è®¤ Base64 ç¼–ç ï¼‰ï¼Œå¯é…ç½®åŠ å¯†å­˜å‚¨ï¼ˆå¦‚ä½¿ç”¨ KMSï¼‰</td></tr><tr><td><strong>å­—æ®µå</strong></td><td><code>data</code> / <code>binaryData</code></td><td><code>data</code>ï¼ˆéœ€ base64ï¼‰ / <code>stringData</code>ï¼ˆæ˜æ–‡ï¼‰</td></tr><tr><td><strong>å¯å­˜å‚¨çš„æœ€å¤§å¤§å°</strong></td><td>æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB</td><td>æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB</td></tr><tr><td><strong>æ”¯æŒçš„æŒ‚è½½æ–¹å¼</strong></td><td>- ç¯å¢ƒå˜é‡<br>- å·ï¼ˆæ–‡ä»¶ï¼‰</td><td>- ç¯å¢ƒå˜é‡<br>- å·ï¼ˆæ–‡ä»¶ï¼‰</td></tr><tr><td><strong>é»˜è®¤ç±»å‹ï¼ˆtypeï¼‰</strong></td><td>æ— ç±»å‹å­—æ®µ</td><td>é»˜è®¤ä¸º <code>Opaque</code></td></tr><tr><td><strong>å¯å®šä¹‰ä¸ºå¤šä¸ªæ–‡ä»¶æŒ‚è½½</strong></td><td>âœ…</td><td>âœ…</td></tr><tr><td><strong>é»˜è®¤ RBAC è®¿é—®æ§åˆ¶å¼ºåº¦</strong></td><td>å¼±ï¼ˆå¤šæ•°ç”¨æˆ·/Pod å¯è¯»å–ï¼‰</td><td>å¼ºï¼ˆé»˜è®¤å—é™è®¿é—®ï¼‰</td></tr><tr><td><strong>æ”¯æŒçš„å†…ç½®ç±»å‹</strong></td><td>æ— </td><td>âœ… å¦‚ï¼š<code>kubernetes.io/tls</code>ã€<code>kubernetes.io/basic-auth</code> ç­‰</td></tr><tr><td><strong>æ˜¯å¦é€‚åˆå­˜å‚¨å¯†é’¥/å¯†ç </strong></td><td>âŒ ä¸æ¨è</td><td>âœ… æ¨è</td></tr><tr><td><strong>å¯è§†åŒ–æ˜æ–‡è¯»å–</strong></td><td>âœ… ç›´æ¥è¯»å–</td><td>âœ… ä½† Base64 ç¼–ç åéœ€è¦è§£ç </td></tr><tr><td><strong>å¸¸è§ç”¨é€”ç¤ºä¾‹</strong></td><td>App é…ç½®ã€æ—¥å¿—çº§åˆ«ã€è¿æ¥å‚æ•°ç­‰</td><td>æ•°æ®åº“å¯†ç ã€TLS è¯ä¹¦ã€API Token ç­‰</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/&quot;&gt;k8s Secret å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ ConfigMap</title>
    <link href="https://blog.hanqunfeng.com/2025/07/23/k8s-configmap/"/>
    <id>https://blog.hanqunfeng.com/2025/07/23/k8s-configmap/</id>
    <published>2025-07-23T12:35:15.000Z</published>
    <updated>2025-07-23T09:14:54.663Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/">k8s ConfigMap å®˜æ–¹æ–‡æ¡£</a></p></li></ul><span id="more"></span><h2 id="ConfigMap-åˆ«åcm-ä»‹ç»">ConfigMap(åˆ«åcm) ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>ConfigMap æ˜¯ä¸€ç§ API å¯¹è±¡ï¼Œç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚</p></li><li class="lvl-2"><p>ä½¿ç”¨æ—¶ï¼Œ Pod å¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚</p></li><li class="lvl-2"><p>ConfigMap å°†ä½ çš„ç¯å¢ƒé…ç½®ä¿¡æ¯å’Œå®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹ã€‚</p></li><li class="lvl-2"><p>å¤šä¸ª Pod å¯ä»¥å…³è”åŒä¸€ä¸ª ConfigMap</p></li></ul><h2 id="ConfigMap-åˆ›å»ºåŠä½¿ç”¨">ConfigMap åˆ›å»ºåŠä½¿ç”¨</h2><h3 id="ç¯å¢ƒå˜é‡å¼•ç”¨">ç¯å¢ƒå˜é‡å¼•ç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>yamlåˆ›å»º</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configmap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span>       <span class="comment"># ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myconfigmap</span>   <span class="comment"># configmap åç§°</span></span><br><span class="line"><span class="attr">data:</span>                 <span class="comment"># data å­—æ®µè®¾è®¡ç”¨æ¥ä¿å­˜ UTF-8 å­—ç¬¦ä¸²ï¼Œæœ€å¤§å€¼ä¸º 1M</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">k8s-admin</span> <span class="comment"># key: value</span></span><br><span class="line">  <span class="attr">access_level:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;123456&quot;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œåˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># keyï¼švalue æ–¹å¼åˆ›å»º</span></span><br><span class="line">kubectl create configmap myconfigmap --from-literal=username=k8s-admin --from-literal=access_level=1 --from-literal=password=123456</span><br><span class="line"><span class="comment"># æ–‡ä»¶æ–¹å¼åˆ›å»º</span></span><br><span class="line"><span class="comment"># --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ ConfigMap ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚</span></span><br><span class="line">kubectl create configmap myconfigmap --from-env-file=app.env --from-env-file=other.env</span><br><span class="line"><span class="comment"># app.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># username=k8s-admin</span></span><br><span class="line"><span class="comment"># access_level=1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># other.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># password=123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ ConfigMap çš„å†…å®¹</span></span><br><span class="line">$ k get cm myconfigmap -oyaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  access_level: <span class="string">&quot;1&quot;</span></span><br><span class="line">  password: <span class="string">&quot;123456&quot;</span></span><br><span class="line">  username: k8s-admin</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">&quot;2025-07-05T10:29:15Z&quot;</span></span><br><span class="line">  name: myconfigmap</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: <span class="string">&quot;723770&quot;</span></span><br><span class="line">  uid: ee850cf9-9014-4be2-97d8-5d1840e78d54</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">env-configmap</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;printenv&quot;</span>] <span class="comment"># æ‰“å°ç¯å¢ƒå˜é‡</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">      <span class="attr">envFrom:</span>                  <span class="comment"># ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€configMapï¼Œç­‰ç­‰</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">configMapRef:</span>         <span class="comment"># è¿™é‡Œå¼•ç”¨ ConfigMapï¼Œæ­¤å¤„å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">myconfigmap</span>   <span class="comment"># configMap åç§°</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å°† ConfigMap ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod2.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">env-configmap2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line">    <span class="attr">args:</span>                       <span class="comment"># å®¹å™¨å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        echo &quot;username: $&#123;CONFIGMAP_USERNAME&#125;&quot;</span></span><br><span class="line"><span class="string">        echo &quot;password: $&#123;CONFIGMAP_PASSWORD&#125;&quot;</span></span><br><span class="line"><span class="string"></span>    <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">    <span class="attr">env:</span>                        <span class="comment"># ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CONFIGMAP_USERNAME</span>  <span class="comment"># è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key</span></span><br><span class="line">      <span class="attr">valueFrom:</span>                <span class="comment"># value æ¥æº</span></span><br><span class="line">        <span class="attr">configMapKeyRef:</span>        <span class="comment"># å¼•ç”¨ ConfigMap ä¸­çš„ key</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">myconfigmap</span>     <span class="comment"># configMap åç§°</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">username</span>         <span class="comment"># configMap ä¸­ key çš„åç§°</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CONFIGMAP_PASSWORD</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">configMapKeyRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">myconfigmap</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">password</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹podæ—¥å¿—</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl logs pods/env-configmap</span><br><span class="line">access_level=1</span><br><span class="line">KUBERNETES_SERVICE_PORT=443</span><br><span class="line">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br><span class="line">HOSTNAME=env-configmap</span><br><span class="line">SHLVL=1</span><br><span class="line">username=k8s-admin</span><br><span class="line">HOME=/root</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class="line">password=123456</span><br><span class="line">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class="line">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br><span class="line">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class="line">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br><span class="line">PWD=/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ kubectl logs pods/env-configmap2</span><br><span class="line">username: k8s-admin</span><br><span class="line">password: 123456</span><br></pre></td></tr></table></figure><h3 id="å­˜å‚¨å·å¼•ç”¨">å­˜å‚¨å·å¼•ç”¨</h3><ul class="lvl-0"><li class="lvl-2"><p>yamlåˆ›å»º</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configmap-configfile.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">app.properties:</span> <span class="string">|</span>  <span class="comment"># æ–‡ä»¶åç§° ï¼Œä½¿ç”¨ | åˆ›å»ºå¤šè¡Œ</span></span><br><span class="line">    <span class="string">server.port=8080</span></span><br><span class="line">    <span class="string">log.level=INFO</span></span><br><span class="line">  <span class="attr">db.properties:</span> <span class="string">|</span>   <span class="comment"># æ–‡ä»¶åç§°</span></span><br><span class="line">    <span class="string">db.host=localhost</span></span><br><span class="line">    <span class="string">db.port=5432</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å‘½ä»¤è¡Œåˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡</span></span><br><span class="line">kubectl create configmap app-config \</span><br><span class="line">  --from-file=app.properties \</span><br><span class="line">  --from-file=db.properties</span><br><span class="line"><span class="comment"># app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># server.port=8080</span></span><br><span class="line"><span class="comment"># log.level=INFO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"># db.host=localhost</span></span><br><span class="line"><span class="comment"># db.port=5432</span></span><br><span class="line"></span><br><span class="line">$ k get cm app-config -oyaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  app.properties: |</span><br><span class="line">    server.port=8080</span><br><span class="line">    log.level=INFO</span><br><span class="line">  db.properties: |</span><br><span class="line">    db.host=localhost</span><br><span class="line">    db.port=5432</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">&quot;2025-07-05T10:49:00Z&quot;</span></span><br><span class="line">  name: app-config</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: <span class="string">&quot;726507&quot;</span></span><br><span class="line">  uid: 05c9a228-ec69-4e88-b8d8-63f97eff2651</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>Pod æŒ‚è½½ ConfigMap ä¸ºæ–‡ä»¶</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configmap-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configmap-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sleep&quot;</span>, <span class="string">&quot;3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/etc/config</span>              <span class="comment"># æŒ‚è½½è·¯å¾„</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span>                   <span class="comment"># å­˜å‚¨å· åç§°</span></span><br><span class="line">    <span class="attr">configMap:</span>                            <span class="comment"># å­˜å‚¨å·ç±»å‹ä¸º ConfigMap</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">app-config</span>                    <span class="comment"># æŒ‚è½½çš„ ConfigMap åç§°ï¼Œæœ¬åˆ©ä¸­å°† configMap ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®¹å™¨å†…çš„ <code>/etc/config/</code> ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/config/app.properties</span><br><span class="line">/etc/config/db.properties</span><br><span class="line"></span><br><span class="line">$ k <span class="built_in">exec</span> -it configmap-demo -- <span class="built_in">ls</span> /etc/config/</span><br><span class="line">app.properties  db.properties</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¦‚æœåªæƒ³æŒ‚è½½ ConfigMap ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>items</code> å­—æ®µæŒ‡å®šï¼š</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configmap-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sleep&quot;</span>, <span class="string">&quot;3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/etc/config</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">    <span class="attr">configMap:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">      <span class="attr">items:</span>                   <span class="comment"># æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app.properties</span>    <span class="comment"># configMapä¸­çš„key</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">app.properties</span>   <span class="comment"># æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties</span></span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p><code>--from-env-file=app.env</code> ä¸ <code>--from-file=app.env</code> çš„åŒºåˆ«</p></li></ul><table><thead><tr><th>é¡¹ç›®</th><th><code>--from-env-file=app.env</code></th><th><code>--from-file=app.env</code></th></tr></thead><tbody><tr><td>ç”¨é€”</td><td>è§£æä¸ºç¯å¢ƒå˜é‡å½¢å¼é”®å€¼å¯¹</td><td>æŒ‰æ–‡ä»¶æ•´ä½“è¯»å…¥ä¸ºå†…å®¹</td></tr><tr><td>é€‚åˆåœºæ™¯</td><td>æƒ³æŠŠæ¯ä¸ªå˜é‡éƒ½å•ç‹¬ç”¨æ‰</td><td>æŒ‚è½½ä¸ºé…ç½®æ–‡ä»¶ä½¿ç”¨</td></tr><tr><td>data ç»“æ„</td><td>æ¯ä¸€è¡Œå˜ä¸€ä¸ªé”®å€¼å¯¹</td><td>æ–‡ä»¶åä¸º keyï¼Œå†…å®¹ä¸ºå€¼</td></tr><tr><td>è¯»å–æ–¹å¼</td><td>ç”¨ <code>envFrom</code> æ³¨å…¥ç¯å¢ƒå˜é‡</td><td>ç”¨ <code>volumeMount</code> æŒ‚è½½æ•´ä¸ªæ–‡ä»¶</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ConfigMap ä¹Ÿæ”¯æŒ <code>äºŒè¿›åˆ¶</code> æ•°æ®ï¼Œä½†éœ€è¦ç”¨ <code>base64</code> ç¼–ç </p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">config.txt:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    Hello, world!</span></span><br><span class="line"><span class="string"></span><span class="attr">binaryData:</span></span><br><span class="line">  <span class="attr">config.bin:</span> <span class="string">aGVsbG8gd29ybGQK</span>   <span class="comment"># è¿™æ˜¯ &quot;hello world&quot; çš„ base64 ç¼–ç </span></span><br></pre></td></tr></table></figure><blockquote><p>binaryData å’Œ data çš„åŒºåˆ«</p></blockquote><table><thead><tr><th>å­—æ®µ</th><th>å†…å®¹ç±»å‹</th><th>ç¼–ç æ–¹å¼</th><th>é€‚åˆå­˜å‚¨</th></tr></thead><tbody><tr><td><code>data</code></td><td>æ–‡æœ¬ï¼ˆUTF-8ï¼‰</td><td>æ˜æ–‡</td><td>é…ç½®æ–‡ä»¶ã€å‚æ•°ã€è„šæœ¬ç­‰</td></tr><tr><td><code>binaryData</code></td><td>ä»»æ„äºŒè¿›åˆ¶æ•°æ®</td><td>base64 ç¼–ç </td><td>å›¾ç‰‡ã€è¯ä¹¦ã€éUTF-8æ–‡ä»¶ç­‰</td></tr></tbody></table><blockquote><p>â—æ³¨æ„äº‹é¡¹</p></blockquote><table><thead><tr><th>é¡¹ç›®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>base64 ç¼–ç æ ¼å¼</td><td><code>binaryData</code> ä¸­çš„å€¼å¿…é¡»æ˜¯æ ‡å‡† base64ï¼Œä¸æ”¯æŒæ¢è¡Œ</td></tr><tr><td>è§£ç åå¤§å°é™åˆ¶</td><td>ConfigMap å•ä¸ªå¯¹è±¡æœ€å¤§ 1MBï¼ˆæ— è®º data è¿˜æ˜¯ binaryDataï¼‰</td></tr><tr><td>äºŒè€…å¯å…±å­˜</td><td><code>data</code> ä¸ <code>binaryData</code> å¯ä»¥åŒæ—¶å‡ºç°åœ¨åŒä¸€ä¸ª ConfigMap ä¸­ï¼ˆå­—æ®µåä¸èƒ½é‡å¤ï¼‰</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>ä¿®æ”¹ ConfigMap å ï¼š<code>k edit configmap &lt;configmap-name&gt;</code></p><ul class="lvl-2"><li class="lvl-4">å¦‚æœ Pod æ˜¯ä½œä¸º ç¯å¢ƒå˜é‡ å…³è”çš„ï¼ŒPod ä¸ä¼šæ›´æ–°ï¼Œåªèƒ½é‡æ–°åˆ›å»º</li><li class="lvl-4">å¦‚æœ Pod æ˜¯ä½œä¸º volume æŒ‚è½½çš„ï¼ŒPod ä¼šè‡ªåŠ¨æ›´æ–°(å¤§çº¦å‡ ç§’å)</li></ul></li><li class="lvl-2"><p>åˆ é™¤ ConfigMap åï¼š<code>k delete configmap &lt;configmap-name&gt;</code></p></li></ul><table><thead><tr><th>Pod çŠ¶æ€</th><th>ConfigMap åˆ é™¤åå½±å“</th></tr></thead><tbody><tr><td>æ­£åœ¨è¿è¡Œ</td><td>ä¸å—å½±å“</td></tr><tr><td>é‡å¯ / æ‰©å®¹</td><td><strong>å¤±è´¥</strong>ï¼šæ‰¾ä¸åˆ° ConfigMapï¼Œæ— æ³•åˆ›å»ºå®¹å™¨</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/&quot;&gt;k8s ConfigMap å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ StorageClass</title>
    <link href="https://blog.hanqunfeng.com/2025/07/22/k8s-storageclass/"/>
    <id>https://blog.hanqunfeng.com/2025/07/22/k8s-storageclass/</id>
    <published>2025-07-22T12:35:15.000Z</published>
    <updated>2025-09-15T06:26:27.650Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/">k8s StorageClass å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p>æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS</p></li></ul><span id="more"></span><h2 id="StorageClass-åˆ«åsc-ä»‹ç»">StorageClass(åˆ«åsc) ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>K8s çš„å­˜å‚¨èµ„æºåˆ†ä¸ºä¸¤ç§ä¾›åº”æ¨¡å¼ï¼šé™æ€ä¾›åº”æ¨¡å¼ å’Œ åŠ¨æ€ä¾›åº”æ¨¡å¼ã€‚</p><ul class="lvl-2"><li class="lvl-4">é™æ€æ¨¡å¼ä¸‹ï¼Œç®¡ç†å‘˜éœ€è¦é¢„å…ˆåˆ›å»ºè®¸å¤šPVï¼Œç­‰å¾… PVC  æ¥ç»‘å®šã€‚</li><li class="lvl-4">åŠ¨æ€æ¨¡å¼ä¸‹ï¼ŒKubernetes ä¼šé€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»º PVï¼Œå¹¶å®Œæˆä¸ PVC çš„ç»‘å®šã€‚</li></ul></li><li class="lvl-2"><p>StorageClass æ˜¯ Kubernetes ä¸­ç”¨æ¥å®šä¹‰ <code>å­˜å‚¨åç«¯ç±»å‹å’Œé…ç½®å‚æ•°</code> çš„èµ„æº</p></li><li class="lvl-2"><p>ä½œç”¨ï¼š è‡ªåŠ¨åˆ›å»º PVï¼ˆPersistentVolumeï¼‰çš„â€œæ¨¡æ¿â€æˆ–â€œè§„åˆ™â€</p></li><li class="lvl-2"><p>ä½¿ç”¨åœºæ™¯ï¼š é…åˆ PVC ä½¿ç”¨æ—¶ï¼ŒKubernetes å¯ä»¥æ ¹æ® StorageClass è‡ªåŠ¨ åŠ¨æ€åˆ›å»º å¯¹åº”çš„æŒä¹…å·ã€‚</p></li><li class="lvl-2"><p>âœ… æ ¸å¿ƒä¼˜åŠ¿ï¼š</p><ul class="lvl-2"><li class="lvl-4">æ— éœ€æ‰‹åŠ¨åˆ›å»º PV</li><li class="lvl-4">æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆNFSã€äº‘ç›˜ã€Cephã€GlusterFSã€iSCSIâ€¦ï¼‰</li></ul></li></ul><p><img src="https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/OGGWYb.png" alt=""></p><h2 id="åˆ›å»º-StorageClass">åˆ›å»º StorageClass</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ª NFS çš„ StorageClass çš„ yaml ç¤ºä¾‹</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs-storage.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-csi</span>                                           <span class="comment"># å­˜å‚¨ç±»åç§°</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">nfs.csi.k8s.io</span>                               <span class="comment"># æŒ‡å®šå­˜å‚¨æ’ä»¶çš„ CSI é©±åŠ¨åç§°ï¼Œéœ€è¦å®‰è£… nfs-csi-driver</span></span><br><span class="line"><span class="attr">reclaimPolicy:</span> <span class="string">Delete</span>                                     <span class="comment"># Retainï¼šPVC åˆ é™¤åï¼ŒPV ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆæ•°æ®ä¿ç•™ï¼‰ï¼Œé»˜è®¤æ˜¯ Delete,ç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚</span></span><br><span class="line"><span class="attr">allowVolumeExpansion:</span> <span class="literal">true</span>                                <span class="comment"># æ˜¯å¦å…è®¸ PVC è‡ªåŠ¨æ‰©å®¹ï¼Œnfs æ”¯æŒæ‰©å®¹</span></span><br><span class="line"><span class="attr">mountOptions:</span>                                             <span class="comment"># æŒ‚è½½é€‰é¡¹ï¼Œcsiæ’ä»¶ä¸åŒï¼Œé€‰é¡¹ä¸åŒã€‚è¿™é‡Œæ˜¯ nfsçš„</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">hard</span>                                                  <span class="comment"># æœåŠ¡å™¨å¼‚å¸¸æ—¶å®¢æˆ·ç«¯ä¼šä¸€ç›´å‘è¯·æ±‚ç›´åˆ°æŒ‚è½½æˆåŠŸ</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nfsvers=4.1</span>                                           <span class="comment"># nfsç‰ˆæœ¬    nfs4.1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nolock</span>                                                <span class="comment"># å…è®¸å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®</span></span><br><span class="line"><span class="attr">volumeBindingMode:</span> <span class="string">Immediate</span>                              <span class="comment"># é»˜è®¤å€¼ï¼šImmediate: åˆ›å»ºPVCæ—¶ç«‹å³ç»‘å®š ,WaitForFirstConsumerï¼šç­‰åˆ° Pod è°ƒåº¦åˆ°èŠ‚ç‚¹åå†åˆ†é…å·ï¼Œé€‚åˆå¤šå¯ç”¨åŒºåœºæ™¯</span></span><br><span class="line"><span class="attr">parameters:</span>                                               <span class="comment"># å‚æ•°é…ç½®</span></span><br><span class="line">  <span class="attr">server:</span> <span class="number">10.211</span><span class="number">.55</span><span class="number">.88</span>                                    <span class="comment"># nfsæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">  <span class="attr">share:</span> <span class="string">/nfs-server/data</span>                                 <span class="comment"># nfs-serverä¸Šçš„å­˜å‚¨ç›®å½•</span></span><br></pre></td></tr></table></figure><blockquote><p>csi-driver-nfs ä» v4.x èµ·ï¼Œå·²ç»æ”¯æŒ Delete reclaimPolicy å’Œ allowVolumeExpansion è‡ªåŠ¨æ‰©å®¹ã€‚<br>ç”Ÿäº§ç¯å¢ƒæ…ç”¨ Delete reclaimPolicyï¼Œå› ä¸ºæ­¤æ—¶åˆ é™¤ PVC åï¼Œnfs-server ä¸Šçš„å­˜å‚¨ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</p></blockquote><ul class="lvl-0"><li class="lvl-2"><p>æ¯ä¸ª StorageClass é…ç½®ä¸­æœ‰ä¸‰ä¸ªå¿…å¡«çš„å‚æ•°ï¼š<code>provisioner</code>ã€<code>parameters</code> å’Œ <code>reclaimPolicy</code> å­—æ®µï¼Œ è¿™äº›å­—æ®µä¼šåœ¨ StorageClass éœ€è¦åŠ¨æ€åˆ¶å¤‡ PersistentVolume (PV) ä»¥æ»¡è¶³ PersistentVolumeClaim (PVC) æ—¶ä½¿ç”¨åˆ°ã€‚</p></li></ul><h3 id="provisioner-å­˜å‚¨åˆ¶å¤‡å™¨">provisioner: å­˜å‚¨åˆ¶å¤‡å™¨</h3><ul class="lvl-0"><li class="lvl-2"><p>æ¯ä¸ª StorageClass éƒ½æœ‰ä¸€ä¸ªåˆ¶å¤‡å™¨ï¼ˆProvisionerï¼‰ï¼Œç”¨æ¥å†³å®šä½¿ç”¨å“ªä¸ªå·æ’ä»¶åˆ¶å¤‡ PVã€‚ è¯¥å­—æ®µå¿…é¡»æŒ‡å®šã€‚</p></li><li class="lvl-2"><p>æ¯”å¦‚ NFS å­˜å‚¨åˆ¶å¤‡å™¨ï¼š<code>provisioner: nfs.csi.k8s.io</code>ï¼Œæ˜¯ K8S å®˜æ–¹ç»´æŠ¤çš„ NFS CSI æ’ä»¶ã€‚<a href="https://github.com/kubernetes-csi/csi-driver-nfs">Github</a>ã€‚</p></li><li class="lvl-2"><p>å®‰è£… NFS CSI æ’ä»¶ï¼š<a href="https://github.com/kubernetes-csi/csi-driver-nfs/blob/master/docs/install-csi-driver-master.md">Install NFS CSI Driver</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨çº¿å®‰è£…</span></span><br><span class="line">curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/install-driver.sh | bash -s master --</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯</span></span><br><span class="line">kubectl -n kube-system get pod -o wide -l app=csi-nfs-controller</span><br><span class="line">kubectl -n kube-system get pod -o wide -l app=csi-nfs-node</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å¸è½½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/uninstall-driver.sh | bash -s master --</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º StorageClass</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nfs-storage.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹ storageclass</span></span><br><span class="line">$ k get sc</span><br><span class="line">NAME      PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class="line">nfs-csi   nfs.csi.k8s.io   Delete          Immediate           <span class="literal">true</span>                   5s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º PVC æ—¶æŒ‡å®š storageclassï¼ŒStorageClass ä¼šè‡ªåŠ¨åˆ›å»º PV</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs-pvc.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-pvc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs-csi</span>  <span class="comment"># æŒ‡å®š StorageClass çš„åç§°ï¼Œå¦‚æœè®¾ç½®äº†é»˜è®¤çš„scï¼Œæ­¤å¤„å¯ä»¥åˆ é™¤è¯¥é…ç½®</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span>          <span class="comment"># æŒ‡å®šè®¿é—®æ¨¡å¼</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">800Mi</span>         <span class="comment"># ç”³è¯·çš„å®¹é‡</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º PVC</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º PVC</span></span><br><span class="line">$ k apply -f nfs-pvc.yaml</span><br><span class="line">persistentvolumeclaim/nfs-pvc created</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ PVå’ŒPVCï¼Œå¯ä»¥çœ‹åˆ° PV è‡ªåŠ¨åˆ›å»ºäº†</span></span><br><span class="line">$ k get pv,pvc</span><br><span class="line">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">persistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907   800Mi      RWX            Delete           Bound    default/nfs-pvc   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          2m4s</span><br><span class="line"></span><br><span class="line">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class="line">persistentvolumeclaim/nfs-pvc   Bound    pvc-c1d33fec-5e16-4156-8405-1af4fc171907   800Mi      RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 2m4s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è‡ªåŠ¨æ‰©å®¹ï¼Œä¿®æ”¹ PVC å®¹é‡åˆ° 1Gi</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit pvc nfs-pvc</span><br><span class="line"><span class="comment"># ä¿®æ”¹å¦‚ä¸‹</span></span><br><span class="line"><span class="comment"># &quot;storage&quot;:&quot;1Gi&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° è‡ªåŠ¨æ‰©å®¹æˆåŠŸ</span></span><br><span class="line">$ k get pv,pvc</span><br><span class="line">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">persistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907   1Gi        RWX            Delete           Bound    default/nfs-pvc   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          4m50s</span><br><span class="line"></span><br><span class="line">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class="line">persistentvolumeclaim/nfs-pvc   Bound    pvc-c1d33fec-5e16-4156-8405-1af4fc171907   1Gi        RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 4m50s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤PVCï¼Œè‡ªåŠ¨åˆ é™¤PV</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pvc nfs-pvc</span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° PV å·²ç»è¢«è‡ªåŠ¨åˆ é™¤ï¼Œ reclaimPolicy: Delete</span></span><br><span class="line">$ k get pv,pvc</span><br><span class="line">No resources found</span><br><span class="line"><span class="comment"># æ­¤æ—¶ nfs-server çš„ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨</span></span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®é»˜è®¤çš„-StorageClass">è®¾ç½®é»˜è®¤çš„ StorageClass</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢æˆ‘ä»¬åˆ›å»º PVC çš„æ—¶å€™éœ€è¦æŒ‡å®š StorageClassï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œé‚£ä¹ˆåœ¨PVCé‡Œå°±å¯ä»¥çœç•¥æ‰ StorageClass çš„è®¾ç½®ã€‚</p></li><li class="lvl-2"><p>K8S ä¸­åªèƒ½è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚</p></li><li class="lvl-2"><p>è®¾ç½®é»˜è®¤çš„ StorageClass</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸º sc æ·»åŠ  `é»˜è®¤` æ³¨è§£ï¼Œå»æ‰è¯¥æ³¨è§£ æˆ–è€… è®¾ç½®ä¸º false å°±å–æ¶ˆé»˜è®¤äº†ã€‚</span></span><br><span class="line">$ kubectl patch storageclass nfs-csi -p <span class="string">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class="line">storageclass.storage.k8s.io/nfs-csi patched</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹scï¼Œæ­¤æ—¶çœ‹åˆ°åç§°åé¢å¤šäº†ä¸€ä¸ª (default) ï¼Œè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ StorageClass</span></span><br><span class="line">$ k get sc</span><br><span class="line">NAME                PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class="line">nfs-csi (default)   nfs.csi.k8s.io   Delete          Immediate           <span class="literal">true</span>                   14m</span><br></pre></td></tr></table></figure><h2 id="StatefulSet-è‡ªåŠ¨åˆ›å»º-PVC">StatefulSet: è‡ªåŠ¨åˆ›å»º PVC</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸Šé¢çš„æ–¹å¼è¿˜æ˜¯è¦æ±‚æˆ‘ä»¬å¿…é¡»åˆ›å»º PVCï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä¸ç”¨åˆ›å»º PVC ï¼Œè€Œæ˜¯åœ¨åˆ›å»ºæ§åˆ¶å™¨çš„æ—¶å€™å°±ä¸€èµ·æŠŠ PVC åˆ›å»ºå¥½å‘¢ï¼Ÿ</p></li><li class="lvl-2"><p>ç›®å‰åªæœ‰ <code>StatefulSet</code>æ§åˆ¶å™¨ æ‰æ”¯æŒè‡ªåŠ¨åˆ›å»º PVC</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis-statefulset.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>                  <span class="comment"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æº</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span>                    <span class="comment"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-sts</span>                    <span class="comment"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">sts-ns</span></span><br><span class="line"><span class="attr">spec:</span>                                <span class="comment"># é…ç½®é¡¹</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span>           <span class="comment"># ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚</span></span><br><span class="line">  <span class="attr">selector:</span>                          <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>                     <span class="comment"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">redis</span>                     <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class="line">  <span class="attr">updateStrategy:</span>                    <span class="comment"># æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ ·</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span>              <span class="comment"># 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚</span></span><br><span class="line">                                     <span class="comment"># 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span>                   <span class="comment"># æ»šåŠ¨å‡çº§çš„é…ç½®</span></span><br><span class="line">      <span class="attr">partition:</span> <span class="number">0</span>                   <span class="comment"># ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">redis-svc</span>             <span class="comment"># æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹ï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºå¥½</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span>                        <span class="comment"># å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1</span></span><br><span class="line">  <span class="attr">template:</span>                          <span class="comment"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">redis</span>                   <span class="comment"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">redis:6.2</span>             <span class="comment"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis</span>                  <span class="comment"># å®¹å™¨çš„åç§°</span></span><br><span class="line">        <span class="attr">volumeMounts:</span>                <span class="comment"># æŒ‚è½½æ•°æ®å·</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/data</span>           <span class="comment"># Redis æŒä¹…åŒ–æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span>              <span class="comment"># é…ç½® PVC æ¨¡æ¿</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">redis-data</span>               <span class="comment"># PVC åç§°</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">ReadWriteMany</span>              <span class="comment"># è®¿é—®æ¨¡å¼ï¼šå¤šèŠ‚ç‚¹è¯»å†™</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">500Mi</span>             <span class="comment"># è¯·æ±‚çš„å­˜å‚¨å®¹é‡ï¼Œæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´</span></span><br><span class="line">      <span class="attr">storageClassName:</span> <span class="string">nfs-csi</span>      <span class="comment"># å­˜å‚¨ç±»åç§°ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤å­˜å‚¨ç±»ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®š</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º StatefulSetï¼Œå¹¶æŸ¥çœ‹ PV,PVC</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º StatefulSet</span></span><br><span class="line">$ kubectl apply -f redis-statefulset.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ PV,PVC</span></span><br><span class="line">$ k get pv,pvc -n sts-ns</span><br><span class="line">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">persistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-1   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          19s</span><br><span class="line">persistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-0   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          22s</span><br><span class="line"></span><br><span class="line">NAME                                           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class="line">persistentvolumeclaim/redis-data-redis-sts-0   Bound    pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 22s</span><br><span class="line">persistentvolumeclaim/redis-data-redis-sts-1   Bound    pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 20s</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>StatefulSet çš„ volumeClaimTemplates æ¯ä¸ª Pod å•ç‹¬åˆ›å»º PVCï¼ŒPod å’Œ PVC ä¸€ä¸€å¯¹åº”ï¼Œå³æœ‰å‡ ä¸ªå‰¯æœ¬å°±åˆ›å»ºå‡ ä¸ª PVCã€‚PVC åç§°æ˜¯ï¼š<code>&lt;volumeClaimTemplates.metadata.name&gt;-&lt;statefulset-name&gt;-&lt;pod-ordinal&gt;</code></p></li><li class="lvl-2"><p>åˆ é™¤ StatefulSet</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f redis-statefulset.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ PV,PVCï¼Œå‘ç°åˆ é™¤ StatefulSet åï¼ŒPV å’Œ PVC æ˜¯ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ PVC</span></span><br><span class="line">$ k get pv,pvc -n sts-ns</span><br><span class="line">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">persistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-1   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          6m30s</span><br><span class="line">persistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-0   nfs-csi        &lt;<span class="built_in">unset</span>&gt;                          6m33s</span><br><span class="line"></span><br><span class="line">NAME                                           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class="line">persistentvolumeclaim/redis-data-redis-sts-0   Bound    pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 6m33s</span><br><span class="line">persistentvolumeclaim/redis-data-redis-sts-1   Bound    pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            nfs-csi        &lt;<span class="built_in">unset</span>&gt;                 6m31s</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨åˆ é™¤ PVCï¼Œå› ä¸ºscé…ç½®çš„å›æ”¶ç­–ç•¥ä¸º Deleteï¼Œæ‰€ä»¥ PV ä¹Ÿä¼šè¢«åˆ é™¤</span></span><br><span class="line">k delete pvc -n sts-ns redis-data-redis-sts-0</span><br><span class="line">k delete pvc -n sts-ns redis-data-redis-sts-1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®é™…ä¸Šï¼Œæ— è®ºæ˜¯åˆ é™¤ statefulset è¿˜æ˜¯ç¼©å®¹ statefulsetï¼ŒPVC éƒ½ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/&quot;&gt;k8s StorageClass å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ æŒä¹…å· PV å’Œ PVC</title>
    <link href="https://blog.hanqunfeng.com/2025/07/21/k8s-storage-pv-pvc/"/>
    <id>https://blog.hanqunfeng.com/2025/07/21/k8s-storage-pv-pvc/</id>
    <published>2025-07-21T15:35:15.000Z</published>
    <updated>2025-07-22T08:52:10.994Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/">k8s PV/PVC å®˜æ–¹æ–‡æ¡£</a></p></li><li class="lvl-2"><p>æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS</p></li></ul><span id="more"></span><h2 id="PV-å’Œ-PVC-ä»‹ç»">PV å’Œ PVC ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>PV(PersistentVolume) æ˜¯ Kubernetes ä¸­çš„ä¸€ç§å­˜å‚¨èµ„æºï¼Œç”¨äºå°†åº•å±‚çš„ç‰©ç†å­˜å‚¨ï¼ˆå¦‚ NFSã€iSCSIã€Cephã€äº‘å­˜å‚¨ç­‰ï¼‰æŠ½è±¡æˆ Kubernetes èµ„æºï¼Œä¾› Pod ä½¿ç”¨ã€‚å®ƒæ˜¯å¯¹å­˜å‚¨çš„ä¸€ç§â€œå£°æ˜å¼â€ç®¡ç†ï¼Œç±»ä¼¼äº Pod å£°æ˜è®¡ç®—èµ„æºã€‚PV æ˜¯é›†ç¾¤çº§åˆ«çš„å­˜å‚¨èµ„æºï¼Œä¸æ”¯æŒ Namespaceã€‚</p></li><li class="lvl-2"><p>PVC(PersistentVolumeClaim)ï¼ŒæŒä¹…å·å£°æ˜ï¼Œ æ˜¯ Kubernetes ä¸­ç”¨äºç”³è¯·å­˜å‚¨èµ„æºçš„å¯¹è±¡ã€‚PVC æ˜¯ Namespace çº§åˆ«çš„èµ„æºã€‚</p></li><li class="lvl-2"><p>ç®€è€Œè¨€ä¹‹ï¼š</p><ul class="lvl-2"><li class="lvl-4">PV æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œç”±ç®¡ç†å‘˜æå‰é…ç½®æˆ–åŠ¨æ€åˆ›å»ºã€‚</li><li class="lvl-4">PVCï¼ˆPersistentVolumeClaimï¼‰ æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„ç”³è¯·ã€‚</li><li class="lvl-4">Pod é€šè¿‡ PVC ç»‘å®šåˆ° PVï¼Œä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ã€‚</li><li class="lvl-4">å¼€å‘è€…ç”¨ PVC æ¥ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œä¸å…³å¿ƒå­˜å‚¨çš„å…·ä½“å®ç°æ–¹å¼ã€‚</li><li class="lvl-4">PVC é€šè¿‡ Kubernetes è‡ªåŠ¨åŒ¹é…ä¸€ä¸ªåˆé€‚çš„ PersistentVolumeï¼ˆPVï¼‰è¿›è¡Œç»‘å®šã€‚</li></ul></li><li class="lvl-2"><p>PV ä¸ PVC çš„åŸºæœ¬æµç¨‹</p><ul class="lvl-2"><li class="lvl-4">ç®¡ç†å‘˜åˆ›å»º PVï¼ˆæˆ–è€…é›†ç¾¤é€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚</li><li class="lvl-4">ç”¨æˆ·æäº¤ PVCï¼Œå£°æ˜è‡ªå·±éœ€è¦å¤šå°‘å®¹é‡ã€ä»€ä¹ˆè®¿é—®æ¨¡å¼ã€‚</li><li class="lvl-4">Kubernetes æŸ¥æ‰¾å¯ç”¨çš„ PVï¼Œæ¡ä»¶ç¬¦åˆï¼ˆå®¹é‡ã€è®¿é—®æ¨¡å¼ã€StorageClassï¼‰å°±è‡ªåŠ¨ç»‘å®šã€‚</li><li class="lvl-4">Pod æŒ‚è½½ PVCï¼Œå®ç°æŒä¹…åŒ–å­˜å‚¨ã€‚</li></ul></li></ul><h2 id="PV-ç¤ºä¾‹">PV ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ PV ç¤ºä¾‹</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pv-nfs.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv-nfs-1g</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span>                 <span class="comment"># å­˜å‚¨å·æ¨¡å¼ï¼Œé»˜è®¤ä¸º Filesystem</span></span><br><span class="line">  <span class="attr">capacity:</span>                              <span class="comment"># å­˜å‚¨èƒ½åŠ›</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span>                         <span class="comment"># å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi</span></span><br><span class="line">  <span class="attr">accessModes:</span>                           <span class="comment"># è®¿é—®æ¨¡å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span>                      <span class="comment"># è®¿é—®æ¨¡å¼</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span>  <span class="comment"># å›æ”¶ç­–ç•¥</span></span><br><span class="line">  <span class="attr">nfs:</span>                                   <span class="comment"># æŒä¹…å·ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs-server/data/pv-nfs-1g</span>     <span class="comment"># å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">10.211</span><span class="number">.55</span><span class="number">.88</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv-nfs-2g</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span>                              <span class="comment"># å­˜å‚¨èƒ½åŠ›</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">2Gi</span>                         <span class="comment"># å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi</span></span><br><span class="line">  <span class="attr">accessModes:</span>                           <span class="comment"># è®¿é—®æ¨¡å¼</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span>                      <span class="comment"># è®¿é—®æ¨¡å¼</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span>  <span class="comment"># å›æ”¶ç­–ç•¥</span></span><br><span class="line">  <span class="attr">nfs:</span>                                   <span class="comment"># å­˜å‚¨ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs-server/data/pv-nfs-2g</span>     <span class="comment"># å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">10.211</span><span class="number">.55</span><span class="number">.88</span></span><br></pre></td></tr></table></figure><h3 id="å­˜å‚¨å·æ¨¡å¼">å­˜å‚¨å·æ¨¡å¼</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#volume-mode">å®˜ç½‘æ–‡æ¡£:å­˜å‚¨å·æ¨¡å¼</a></p></li><li class="lvl-2"><p>Kubernetes æ”¯æŒä¸¤ç§å·æ¨¡å¼ï¼ˆvolumeModesï¼‰ï¼šFilesystemï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ å’Œ Blockï¼ˆå—ï¼‰ã€‚</p></li><li class="lvl-2"><p>å¦‚æœè¯¥å‚æ•°è¢«çœç•¥ï¼Œé»˜è®¤çš„å·æ¨¡å¼æ˜¯ Filesystemã€‚</p></li><li class="lvl-2"><p>volumeMode å±æ€§è®¾ç½®ä¸º Filesystem çš„å·ä¼šè¢« Pod æŒ‚è½½ï¼ˆMountï¼‰ åˆ°æŸä¸ªç›®å½•ã€‚</p></li></ul><h3 id="æŒä¹…å·ç±»å‹">æŒä¹…å·ç±»å‹</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes">å®˜ç½‘æ–‡æ¡£:æŒä¹…å·ç±»å‹</a></p></li><li class="lvl-2"><p>âœ… å½“å‰æ”¯æŒçš„æ’ä»¶</p></li></ul><table><thead><tr><th>æ’ä»¶ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>csi</strong></td><td><strong>å®¹å™¨å­˜å‚¨æ¥å£ï¼ˆCSIï¼‰</strong>ï¼Œæ¨èçš„ç°ä»£å­˜å‚¨æ¥å£</td></tr><tr><td><strong>fc</strong></td><td>Fibre Channel å­˜å‚¨</td></tr><tr><td><strong>hostPath</strong></td><td>HostPath å·ï¼ˆä»…ä¾›å•èŠ‚ç‚¹æµ‹è¯•ä½¿ç”¨ï¼›å¤šèŠ‚ç‚¹ä¸æ¨èï¼Œæ¨èä½¿ç”¨ local å·æ›¿ä»£ï¼‰</td></tr><tr><td><strong>iscsi</strong></td><td>iSCSIï¼ˆåŸºäº IP çš„ SCSI å­˜å‚¨ï¼‰</td></tr><tr><td><strong>local</strong></td><td>èŠ‚ç‚¹æœ¬åœ°å­˜å‚¨è®¾å¤‡</td></tr><tr><td><strong>nfs</strong></td><td>ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰å­˜å‚¨</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>âš ï¸ å·²å¼ƒç”¨ä½†ä»å¯ç”¨ï¼ˆéœ€ CSI è¿ç§»ï¼‰</p></li></ul><table><thead><tr><th>æ’ä»¶ç±»å‹</th><th>æè¿°</th><th>CSI è¿ç§»çŠ¶æ€</th></tr></thead><tbody><tr><td><strong>awsElasticBlockStore</strong></td><td>AWS EBS å—å­˜å‚¨</td><td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>azureDisk</strong></td><td>Azure ç£ç›˜å­˜å‚¨</td><td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>azureFile</strong></td><td>Azure æ–‡ä»¶å­˜å‚¨</td><td>ä» v1.24 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>cinder</strong></td><td>OpenStack å—å­˜å‚¨</td><td>ä» v1.21 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>flexVolume</strong></td><td>FlexVolumeï¼ˆæ— è¿ç§»è®¡åˆ’ï¼Œä½†æœªè®¡åˆ’ç§»é™¤ï¼‰</td><td>ä» v1.23 å¼€å§‹å¼ƒç”¨</td></tr><tr><td><strong>gcePersistentDisk</strong></td><td>GCP æŒä¹…ç£ç›˜</td><td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>portworxVolume</strong></td><td>Portworx å­˜å‚¨å·</td><td>ä» v1.31 å¼€å§‹é»˜è®¤è¿ç§»</td></tr><tr><td><strong>vsphereVolume</strong></td><td>vSphere VMDK å·</td><td>ä» v1.25 å¼€å§‹é»˜è®¤è¿ç§»</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>âŒ å·²åºŸå¼ƒ/å³å°†ç§»é™¤çš„ In-Tree æ’ä»¶</p></li></ul><table><thead><tr><th>æ’ä»¶ç±»å‹</th><th>æè¿°</th><th>å¼ƒç”¨/ç§»é™¤ç‰ˆæœ¬</th></tr></thead><tbody><tr><td><strong>cephfs</strong></td><td>Ceph æ–‡ä»¶ç³»ç»Ÿå·</td><td>v1.31 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>flocker</strong></td><td>Flocker å­˜å‚¨</td><td>v1.25 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>glusterfs</strong></td><td>GlusterFS å­˜å‚¨</td><td>v1.26 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>photonPersistentDisk</strong></td><td>Photon æŒä¹…ç£ç›˜</td><td>v1.15 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>quobyte</strong></td><td>Quobyte å·</td><td>v1.25 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>rbd</strong></td><td>Rados å—è®¾å¤‡ï¼ˆCeph RBDï¼‰</td><td>v1.31 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>scaleIO</strong></td><td>ScaleIO å·</td><td>v1.21 ä¹‹åä¸å¯ç”¨</td></tr><tr><td><strong>storageos</strong></td><td>StorageOS å·</td><td>v1.25 ä¹‹åä¸å¯ç”¨</td></tr></tbody></table><h3 id="accessModes-è®¿é—®æ¨¡å¼">accessModes è®¿é—®æ¨¡å¼</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#access-modes">å®˜ç½‘æ–‡æ¡£:è®¿é—®æ¨¡å¼</a></p></li></ul><table><thead><tr><th>è®¿é—®æ¨¡å¼</th><th>è¯´æ˜</th><th>æ˜¯å¦è·¨èŠ‚ç‚¹æŒ‚è½½</th><th>æ˜¯å¦æ”¯æŒå¤š Pod æŒ‚è½½</th><th>æ˜¯å¦æ”¯æŒè¯»å†™</th></tr></thead><tbody><tr><td><strong>ReadWriteOnce (RWO)</strong></td><td>å·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼ŒåŒä¸€èŠ‚ç‚¹å†…å¤šä¸ª Pod å¯å…±äº«ä½¿ç”¨ã€‚</td><td>âŒ å¦</td><td>âœ… æ˜¯ï¼ˆåŒä¸€èŠ‚ç‚¹ï¼‰</td><td>âœ… æ˜¯</td></tr><tr><td><strong>ReadOnlyMany (ROX)</strong></td><td>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æŒ‚è½½ã€‚</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td>âŒ å¦ï¼ˆåªè¯»ï¼‰</td></tr><tr><td><strong>ReadWriteMany (RWX)</strong></td><td>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ã€‚</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td></tr><tr><td><strong>ReadWriteOncePod (RWOP)</strong></td><td>å·åªèƒ½è¢«å•ä¸ª Pod ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼Œç¡®ä¿é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª Pod ä½¿ç”¨è¯¥å·ï¼ˆv1.29+ç¨³å®šï¼‰ã€‚</td><td>âŒ å¦</td><td>âŒ å¦ï¼ˆåªèƒ½ä¸€ä¸ª Podï¼‰</td><td>âœ… æ˜¯</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>NFS æ”¯æŒå‰ä¸‰ç§è®¿é—®æ¨¡å¼ï¼ŒhostPath åªæ”¯æŒ ReadWriteOnceã€‚</p></li></ul><h3 id="persistentVolumeReclaimPolicy-å›æ”¶ç­–ç•¥">persistentVolumeReclaimPolicy å›æ”¶ç­–ç•¥</h3><ul class="lvl-0"><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy">å®˜æ–¹æ–‡æ¡£:å›æ”¶ç­–ç•¥</a></p></li></ul><table><thead><tr><th>å›æ”¶ç­–ç•¥</th><th>å«ä¹‰</th><th>å›æ”¶è¡Œä¸º</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Retain</strong></td><td><strong>ä¿ç•™</strong>ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨ä»ç„¶ä¿ç•™</td><td>æ‰‹åŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤å PV çŠ¶æ€ä¸º <code>Released</code>ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†æˆ–é‡æ–°ç»‘å®š</td><td>é‡è¦æ•°æ®ï¼Œé¿å…è¯¯åˆ ï¼›å¦‚æ•°æ®åº“æ•°æ®ç›˜</td></tr><tr><td><strong>Delete</strong></td><td><strong>åˆ é™¤</strong>ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨éƒ½ä¼šè¢«åˆ é™¤</td><td>è‡ªåŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤æ—¶è‡ªåŠ¨åˆ é™¤ PV å’Œåç«¯å­˜å‚¨èµ„æºï¼ˆå¦‚äº‘ç›˜ï¼‰</td><td>ä¸´æ—¶æ•°æ®ã€ä¸é‡è¦çš„å­˜å‚¨</td></tr><tr><td><strong>Recycle</strong></td><td><strong>å›æ”¶</strong>ï¼šç®€å•æ¸…ç©ºæ•°æ®</td><td>è‡ªåŠ¨æ‰§è¡Œ <code>rm -rf /thevolume/*</code>ï¼Œç„¶å PV å˜å› <code>Available</code> çŠ¶æ€</td><td>æ—§ç‰ˆæœ¬é›†ç¾¤çš„å°æ–‡ä»¶ä¸´æ—¶å­˜å‚¨</td></tr></tbody></table><div class="warning"><ul class="lvl-1"><li class="lvl-2"><p><strong>æ³¨æ„</strong>: åˆ›å»º <strong>Recycle</strong> çš„ PV æ—¶ï¼Œä¼šæç¤ºå¦‚ä¸‹å†…å®¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: spec.persistentVolumeReclaimPolicy: The Recycle reclaim policy is deprecated. Instead, the recommended approach is to use dynamic provisioning.</span><br></pre></td></tr></table></figure><ul class="lvl-1"><li class="lvl-2"><p>æ„æ€å°±æ˜¯ <strong>Recycle</strong> ç­–ç•¥å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨<code>åŠ¨æ€ä¾›åº”æ¨¡å¼</code>ã€‚ä½†<a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy">å®˜æ–¹æ–‡æ¡£</a>ä¸­å´æç¤º <code>å¯¹äº Kubernetes 1.33 æ¥è¯´ï¼Œåªæœ‰ nfs å’Œ hostPath å·ç±»å‹æ”¯æŒå›æ”¶ï¼ˆRecycleï¼‰ã€‚</code></p></li><li class="lvl-2"><p>æœ¬äººåœ¨ Kubernetes 1.33.2 ä¸­æµ‹è¯•ï¼ŒNFS æ”¯æŒ Recycleï¼Œåˆ é™¤ PVC å PV çŠ¶æ€ä¼šå˜ä¸º <strong>Available</strong></p></li></ul></div><h3 id="ç®¡ç†-PV">ç®¡ç† PV</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º</span></span><br><span class="line">kubectl create -f pv-nfs.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">$ k get pv</span><br><span class="line">NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">pv-nfs-1g   1Gi        RWO            Retain           Available                          &lt;<span class="built_in">unset</span>&gt;                          80s</span><br><span class="line">pv-nfs-2g   2Gi        RWX            Retain           Available                          &lt;<span class="built_in">unset</span>&gt;                          80s</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line">kubectl delete pv pv-nfs-1g</span><br><span class="line">k delete -f pv-nfs.yaml</span><br></pre></td></tr></table></figure><h2 id="PVC-ç¤ºä¾‹">PVC ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Pod é€šè¿‡ PVC å‘ PV ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœ PVC ä¸€ç›´æ— æ³•åŒ¹é…åˆ° PVï¼Œåˆ™ PVC å¤„äº Pending çŠ¶æ€ã€‚</p></li><li class="lvl-2"><p>Pod å¿…é¡»ä¸ PVC å¤„äºåŒä¸€å‘½åç©ºé—´ã€‚</p></li><li class="lvl-2"><p>PVC ä¸ PV æ˜¯ 1:1 çš„å…³ç³»ã€‚ä¸€æ—¦ PV ç»‘å®šåˆ° PVCï¼Œåˆ™ PVC çŠ¶æ€å˜ä¸º Boundã€‚è¯¥ PV å°†ä¸å†è¢«å…¶ä»– PVC ç»‘å®šã€‚</p></li><li class="lvl-2"><p>PVC ä¸ PV åŒ¹é…çš„æ¡ä»¶</p></li></ul><table><thead><tr><th>åŒ¹é…æ¡ä»¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å®¹é‡</strong></td><td><strong>PVC è¯·æ±‚çš„å®¹é‡ â‰¤ PV æä¾›çš„å®¹é‡</strong>ã€‚PV å¿…é¡»è‡³å°‘æ»¡è¶³ PVC çš„å®¹é‡è¯·æ±‚ã€‚</td></tr><tr><td><strong>è®¿é—®æ¨¡å¼</strong></td><td><strong>PV æ”¯æŒ PVC è¯·æ±‚çš„è®¿é—®æ¨¡å¼</strong>ã€‚PVC è¦æ±‚çš„æ‰€æœ‰è®¿é—®æ¨¡å¼ï¼ŒPV éƒ½å¿…é¡»å…·å¤‡ã€‚ä¾‹å¦‚ï¼šPVC è¦æ±‚ <code>ReadWriteOnce</code>ï¼ŒPV è‡³å°‘è¦æ”¯æŒ <code>ReadWriteOnce</code>ã€‚</td></tr><tr><td><strong>StorageClass</strong></td><td><strong>PVC å’Œ PV çš„ <code>storageClassName</code> å¿…é¡»ä¸€è‡´</strong>ã€‚å¦‚æœ PVC æŒ‡å®šäº† <code>storageClassName</code>ï¼Œåªèƒ½ç»‘å®šåŒåçš„ PVã€‚</td></tr><tr><td><strong>Selectorï¼ˆå¯é€‰ï¼‰</strong></td><td>å¦‚æœ PVC æœ‰è®¾ç½® <code>selector</code>ï¼ˆåŸºäºæ ‡ç­¾ï¼‰ï¼ŒPV çš„æ ‡ç­¾ä¹Ÿå¿…é¡»åŒ¹é…ã€‚</td></tr></tbody></table><div class="tips"><p><em><strong>å°è´´å£«</strong></em></p><ul class="lvl-1"><li class="lvl-2">PV ä¸­å£°æ˜çš„ <code>accessModes</code> ä»…ä½œä¸ºä¸ PVC çš„è®¿é—®æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå®é™…æŒ‚è½½åˆ° Pod åï¼Œä¸ä¼šé™åˆ¶ Pod çš„è¯»å†™è®¿é—®</li></ul></div><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ªç®€å•çš„ yaml</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pvc.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mypvc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span>   <span class="comment"># ç”³è¯·åŒ¹é…çš„è®¿é—®æ¨¡å¼</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">500Mi</span>  <span class="comment"># ç”³è¯·çš„å®¹é‡ï¼Œå®é™…å®¹é‡ä»¥åŒ¹é…çš„ PV ä¸ºå‡†</span></span><br><span class="line">  <span class="comment"># selector:         # åŒ¹é…çš„ PV æ ‡ç­¾</span></span><br><span class="line">  <span class="comment">#   matchLabels:</span></span><br><span class="line">  <span class="comment">#     pv: nfs-pv1   # pv çš„æ ‡ç­¾ï¼Œåˆ›å»º pv æ—¶è¦æŒ‡å®š</span></span><br></pre></td></tr></table></figure><h3 id="ç®¡ç†-PVC">ç®¡ç† PVC</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º PVC</span></span><br><span class="line">kubectl apply -f pvc.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹PVCï¼Œæ­¤æ—¶çœ‹åˆ° pv-nfs-1g ç»‘å®šäº† PVC</span></span><br><span class="line">$ k get pv,pvc</span><br><span class="line">NAME                         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">persistentvolume/pv-nfs-1g   1Gi        RWO            Retain           Available                                  &lt;<span class="built_in">unset</span>&gt;                          16s</span><br><span class="line">persistentvolume/pv-nfs-2g   2Gi        RWX            Retain           Bound       default/mypvc                  &lt;<span class="built_in">unset</span>&gt;                          16s</span><br><span class="line"></span><br><span class="line">NAME                          STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class="line">persistentvolumeclaim/mypvc   Bound    pv-nfs-2g   2Gi        RWX                           &lt;<span class="built_in">unset</span>&gt;                 9s</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ PVC</span></span><br><span class="line">kubectl delete pvc mypvc</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶å†æ¬¡æŸ¥çœ‹ PVï¼Œpv-nfs-1g çŠ¶æ€å˜æ›´ä¸º Releasedï¼Œè¡¨ç¤ºå·²ç»é‡Šæ”¾ï¼Œä½†æ˜¯ä¸èƒ½å†è¢«å…¶å®ƒ PVC ç»‘å®šäº†ï¼Œåªèƒ½åˆ é™¤é‡å»ºäº†</span></span><br><span class="line">$ k get pv</span><br><span class="line">NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class="line">pv-nfs-1g   1Gi        RWO            Retain           Available                                              &lt;<span class="built_in">unset</span>&gt;                          18m</span><br><span class="line">pv-nfs-2g   2Gi        RWX            Retain           Released     default/mypvc                             &lt;<span class="built_in">unset</span>&gt;                          18m</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ PV</span></span><br><span class="line">k delete pv pv-nfs-1g</span><br></pre></td></tr></table></figure><h2 id="Pod-ç»‘å®š-PVC">Pod ç»‘å®š PVC</h2><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œä»¥ nginx deployment ä¸ºä¾‹</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx-pvc-deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-pvc-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span>                              <span class="comment"># 3ä¸ª podä¼šå…±äº«ä¸€ä¸ª PVC</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pvc</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pvc</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-storage</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span>  <span class="comment"># æŒ‚è½½åˆ° nginx çš„é»˜è®¤ç½‘é¡µç›®å½•</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-storage</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span>              <span class="comment"># æŒ‡å®šå­˜å‚¨å·ç±»å‹æ˜¯ PVC</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">mypvc</span>                  <span class="comment"># å¯¹åº”ä½ åˆ›å»ºçš„ PVC åç§°</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ª PVC å¯¹åº”ä¸€ä¸ª PVï¼Œä½†æ˜¯ä¸€ä¸ª PVC å¯ä»¥å¯¹åº”å¤šä¸ª Deployment ç­‰æ§åˆ¶å™¨ã€‚ä¸‹é¢æˆ‘ä»¬å°±å†åˆ›å»ºä¸€ä¸ª Deploymentï¼Œå°† ç›¸åŒçš„ PVC æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œå¹¶ä¸”æ¯éš”5ç§’ä¿®æ”¹ä¸€æ¬¡ PVC æŒ‚è½½çš„ç½‘é¡µï¼Œå¹¶é€šè¿‡ nginx å®¹å™¨æŸ¥çœ‹ç»“æœ</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># busybox-deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;while true; do echo $(date) &gt; /data/index.html; sleep 5; done&quot;</span>]</span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-volume</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">mypvc</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»ºåæŸ¥çœ‹ pod ip</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ k get pod -o wide</span><br><span class="line">NAME                                    READY   STATUS    RESTARTS   AGE     IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">busybox-deployment-d7589665d-dx2rs      1/1     Running   0          2m59s   10.244.126.6     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-pvc-deployment-775b8c4f8b-89cw7   1/1     Running   0          44s     10.244.126.8     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-pvc-deployment-775b8c4f8b-fszlf   1/1     Running   0          44s     10.244.194.123   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx-pvc-deployment-775b8c4f8b-w9qkt   1/1     Running   0          44s     10.244.126.7     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è®¿é—®ä»»æ„ä¸€ä¸ª nginx pod</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­¤æ—¶ä¼šçœ‹åˆ°é¡µé¢å†…å®¹åœ¨å˜åŒ–</span></span><br><span class="line">watch -n 5 curl 10.244.194.123</span><br></pre></td></tr></table></figure><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸º pod ç»‘å®š pvcæ—¶ï¼Œæ¯æ¬¡éƒ½è¦å…ˆåˆ›å»º pv å’Œ pvcï¼Œéå¸¸éº»çƒ¦ã€‚æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ</p><blockquote><p>ä½¿ç”¨ StorageClass å®ç°è‡ªåŠ¨åˆ›å»º PVï¼Œæˆ‘ä»¬ä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•å®ç°ã€‚</p></blockquote></li><li class="lvl-2"><p>å¦‚æœ PVC è¢« Pod ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PVC å—ï¼Ÿ</p><blockquote><p>ä¸å¯ä»¥ï¼ŒPVC è¢« Pod ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… Pod åˆ é™¤åæ‰èƒ½åˆ é™¤ PVCã€‚<br>è‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PVC å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PVC çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PVC çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“å­˜Podå¯¹å‚¨å·çš„ä½¿ç”¨ã€‚<br>æ­¤æ—¶ä¸€æ—¦Pod åˆ é™¤ï¼ŒPVC å°±ä¼šè¢«åˆ é™¤ã€‚</p></blockquote></li><li class="lvl-2"><p>å¦‚æœPV è¢« PVC ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PV å—ï¼Ÿ</p><blockquote><p>ä¸å¯ä»¥ï¼ŒPV è¢« PVC ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… PVC åˆ é™¤åæ‰èƒ½åˆ é™¤ PVã€‚<br>è‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PV å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PV çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PV çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“Podå¯¹å­˜å‚¨å·çš„ä½¿ç”¨ã€‚<br>æ­¤æ—¶ä¸€æ—¦ PVC åˆ é™¤ï¼ŒPV å°±ä¼šè¢«åˆ é™¤ã€‚</p></blockquote></li></ul>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/&quot;&gt;k8s PV/PVC å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ å­˜å‚¨å· NFS</title>
    <link href="https://blog.hanqunfeng.com/2025/07/21/k8s-storage-nfs/"/>
    <id>https://blog.hanqunfeng.com/2025/07/21/k8s-storage-nfs/</id>
    <published>2025-07-21T15:34:15.000Z</published>
    <updated>2025-07-21T08:34:49.791Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· NFS ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li></ul><span id="more"></span><h2 id="å­˜å‚¨å·-NFS-ä»‹ç»">å­˜å‚¨å· NFS ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>åœ¨ Kubernetes ä¸­ï¼ŒNFS (Network File System) æ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œå°†è¿œç¨‹å­˜å‚¨æŒ‚è½½åˆ° Pod çš„æ–¹å¼ã€‚å®ƒå…è®¸å¤šä¸ª Pod è·¨èŠ‚ç‚¹å…±äº«ç›¸åŒçš„å­˜å‚¨ç›®å½•ï¼Œå¸¸ç”¨äº ReadWriteManyï¼ˆRWXï¼‰ åœºæ™¯ã€‚</p></li><li class="lvl-2"><p>æˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªNFS æœåŠ¡å™¨ï¼Œå¹¶é…ç½® NFS å­˜å‚¨å·ã€‚å…·ä½“å¯ä»¥å‚è€ƒ <a href="/2025/07/21/linux-nfs/" title="Linux å®‰è£… NFS">Linux å®‰è£… NFS</a></p></li><li class="lvl-2"><p>k8sä¸­æ¯ä¸ªworkerèŠ‚ç‚¹éƒ½éœ€è¦å®‰è£… NFS å®¢æˆ·ç«¯ï¼Œä½†æ˜¯ä¸éœ€è¦æŒ‚è½½ NFS å­˜å‚¨å·ï¼Œè¿™ä¸ªä¼šåœ¨podä¸­è¿›è¡Œã€‚</p></li></ul><h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ pod ç¤ºä¾‹</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs-direct-pod.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-direct-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data</span>          <span class="comment"># å®¹å™¨å†…æŒ‚è½½ç‚¹</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volume</span></span><br><span class="line">    <span class="attr">nfs:</span></span><br><span class="line">      <span class="attr">server:</span> <span class="number">10.211</span><span class="number">.55</span><span class="number">.88</span>      <span class="comment"># NFS æœåŠ¡ç«¯åœ°å€</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/nfs-server/data</span>    <span class="comment"># NFS æœåŠ¡ç«¯å…±äº«ç›®å½•</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">false</span>           <span class="comment"># æ˜¯å¦åªè¯»æŒ‚è½½ï¼Œfalse è¡¨ç¤ºå¯è¯»å†™</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º Pod</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nfs-direct-pod.yaml</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹ Pod æŒ‚è½½ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹podéƒ¨ç½²åˆ°å“ªä¸ªèŠ‚ç‚¹</span></span><br><span class="line">$ kubectl get pod nfs-direct-pod -o wide</span><br><span class="line">NAME             READY   STATUS    RESTARTS   AGE   IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">nfs-direct-pod   1/1     Running   0          12m   10.244.194.115   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½• k8s-worker1 èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹ nfs æŒ‚è½½ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ åˆ›å»º podæ—¶ä¼šè‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸ŠæŒ‚è½½ nfs</span></span><br><span class="line">$ <span class="built_in">df</span> -t nfs4</span><br><span class="line">Filesystem                    1K-blocks    Used Available Use% Mounted on</span><br><span class="line">10.211.55.88:/nfs-server/data  42872832 3630080  39242752   9% /var/lib/kubelet/pods/e44786a9-fbd9-4ee8-bb28-84eb074fb7d9/volumes/kubernetes.io~nfs/nfs-volume</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹podæŒ‚è½½çš„ç›®å½•</span></span><br><span class="line">$ k <span class="built_in">exec</span> -it nfs-direct-pod -- <span class="built_in">df</span> -t nfs4</span><br><span class="line">Filesystem           1K-blocks      Used Available Use% Mounted on</span><br><span class="line">10.211.55.88:/nfs-server/data</span><br><span class="line">                      42872832   3630080  39242752   8% /data</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘nfsæŒ‚è½½ç›®å½•ä¸­å†™å…¥æ•°æ®</span></span><br><span class="line">k <span class="built_in">exec</span> -it nfs-direct-pod -- sh -c <span class="string">&#x27;echo &quot;hello world&quot; &gt; /data/test.txt&#x27;</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤pod</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">k delete pod nfs-direct-pod</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡ç™»å½• å®¿ä¸»æœºèŠ‚ç‚¹ï¼Œå‘ç° nfs æŒ‚è½½ç‚¹ä¹Ÿè¢«å¸è½½äº†ï¼Œä½†æ˜¯ nfs-server ä¸­çš„æ–‡ä»¶ä»ç„¶å­˜åœ¨</span></span><br><span class="line">$ <span class="built_in">df</span> -t nfs4</span><br><span class="line"><span class="built_in">df</span>: no file systems processed</span><br></pre></td></tr></table></figure><h2 id="å­˜å‚¨å·ç±»å‹-emptyDirã€hostPathã€NFS-çš„å¯¹æ¯”è¡¨">å­˜å‚¨å·ç±»å‹ emptyDirã€hostPathã€NFS çš„å¯¹æ¯”è¡¨</h2><table><thead><tr><th>ç‰¹æ€§</th><th><code>emptyDir</code></th><th><code>hostPath</code></th><th><code>nfs</code></th></tr></thead><tbody><tr><td><strong>æ•°æ®ç”Ÿå‘½å‘¨æœŸ</strong></td><td>Pod ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆï¼ŒPod åˆ é™¤æ•°æ®ä¸¢å¤±</td><td>ç»‘å®šèŠ‚ç‚¹ä¸Šçš„ç›®å½•ï¼ŒPod åˆ äº†æ•°æ®ä»ä¿ç•™</td><td>å­˜å‚¨åœ¨è¿œç¨‹ NFS Serverï¼ŒPod åˆ é™¤æ•°æ®ä¸ä¸¢å¤±</td></tr><tr><td><strong>å…±äº«èŒƒå›´</strong></td><td><strong>åŒä¸€ä¸ª Pod çš„å¤šä¸ªå®¹å™¨å¯å…±äº«</strong></td><td>åŒä¸€èŠ‚ç‚¹ä¸Šå¤šä¸ª Pod å¯å…±äº«</td><td>é›†ç¾¤å†…å¤šä¸ª Pod è·¨èŠ‚ç‚¹å¯å…±äº«</td></tr><tr><td><strong>æŒä¹…åŒ–èƒ½åŠ›</strong></td><td>âŒ ä¸æŒä¹…åŒ–ï¼Œéš Pod ç”Ÿå‘½å‘¨æœŸç»“æŸæ¶ˆå¤±</td><td>âœ… æŒä¹…åŒ–ï¼Œåªè¦å®¿ä¸»æœºç›®å½•å­˜åœ¨æ•°æ®å°±åœ¨</td><td>âœ… æŒä¹…åŒ–ï¼ŒNFS å­˜å‚¨ç‹¬ç«‹äº Pod å­˜åœ¨</td></tr><tr><td><strong>è·¨èŠ‚ç‚¹å…±äº«</strong></td><td>âŒ ä¸èƒ½</td><td>âŒ ä¸èƒ½</td><td>âœ… æ”¯æŒè·¨èŠ‚ç‚¹å…±äº«</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>ä¸´æ—¶ç¼“å­˜ã€è¿›ç¨‹é—´å…±äº«æ•°æ®</td><td>å®¿ä¸»æœºç‰¹å®šç›®å½•æŒ‚è½½ï¼Œæ—¥å¿—å­˜å‚¨ã€å®¿ä¸»æœºæ’ä»¶å¯¹æ¥</td><td>å¤šå‰¯æœ¬æœåŠ¡å…±äº«å­˜å‚¨ã€æŒä¹…åŒ–æ•°æ®ã€å…±äº«é…ç½®æ–‡ä»¶</td></tr><tr><td><strong>æ•°æ®å®‰å…¨æ€§</strong></td><td>éš Pod åˆ é™¤ï¼Œ<strong>æ•°æ®æ˜“ä¸¢å¤±</strong></td><td>å®¹å™¨æœ‰æƒé™å¯ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ï¼Œå­˜åœ¨é£é™©</td><td>ä¾èµ– NFS Server ç¨³å®šæ€§ï¼Œé…ç½®ä¸å½“å¯èƒ½è¢«æ‰€æœ‰èŠ‚ç‚¹è¯»å†™</td></tr><tr><td><strong>å…¸å‹ç”¨ä¾‹</strong></td><td>Redis ç¼“å­˜ç›®å½•ã€Sidecar å®¹å™¨å…±äº«æ—¥å¿—</td><td>æŒ‚è½½å®¿ä¸»æœº docker.sockã€å®¿ä¸»æœºæ—¥å¿—ç›®å½•</td><td>è·¨ Pod æ–‡ä»¶å…±äº«ã€Web é™æ€èµ„æºã€Tensorflow å¤šå‰¯æœ¬è®­ç»ƒå…±äº«æ•°æ®</td></tr></tbody></table><h2 id="ä¸ºä»€ä¹ˆå·²ç»æœ‰-NFSï¼Œè¿˜æ¨èç”¨-PV-PVCï¼Ÿ">ä¸ºä»€ä¹ˆå·²ç»æœ‰ NFSï¼Œè¿˜æ¨èç”¨ PV/PVCï¼Ÿ</h2><ul class="lvl-0"><li class="lvl-2"><p>âœ… ç®€çŸ­å›ç­”ï¼šPV/PVC æ˜¯å¯¹åº•å±‚å­˜å‚¨ï¼ˆå¦‚ NFSï¼‰çš„æŠ½è±¡å’Œæ ‡å‡†åŒ–ç®¡ç†ã€‚</p></li></ul><table><thead><tr><th>åŸå› </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>âœ… <strong>Kubernetes æ ‡å‡†èµ„æº</strong></td><td>ç”¨ PVC å£°æ˜å­˜å‚¨éœ€æ±‚ï¼Œç”± K8s ç»Ÿä¸€è°ƒåº¦å’Œç®¡ç†ã€‚</td></tr><tr><td>âœ… <strong>å­˜å‚¨ä¸ Pod è§£è€¦</strong></td><td>Pod ä¸“æ³¨äºåº”ç”¨é€»è¾‘ï¼ŒPVC ä¸“æ³¨äºå£°æ˜â€œæˆ‘è¦ä¸€ä¸ª 10Gi çš„ RWX å­˜å‚¨â€ï¼ŒèƒŒåæ˜¯ NFSã€Ceph è¿˜æ˜¯åˆ«çš„ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒã€‚</td></tr><tr><td>âœ… <strong>åŠ¨æ€ä¾›åº”</strong></td><td>æ­é… StorageClass å¯ä»¥å®ç° <strong>è‡ªåŠ¨åˆ›å»º PV</strong>ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ PVã€‚</td></tr><tr><td>âœ… <strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></td><td>PVC è¢«åˆ é™¤æ—¶å¯è§¦å‘ PV å›æ”¶ã€ä¿ç•™æˆ–åˆ é™¤ç­–ç•¥ï¼ˆ<code>Retain</code>ã€<code>Recycle</code>ã€<code>Delete</code>ï¼‰ã€‚ç›´æ¥æŒ‚è½½ NFS æ²¡æœ‰è¿™äº›æœºåˆ¶ã€‚</td></tr><tr><td>âœ… <strong>æƒé™éš”ç¦»</strong></td><td>PV/PVC å¯ä»¥é€šè¿‡ <code>accessModes</code> æ§åˆ¶è®¿é—®çº§åˆ«ï¼Œæ¯”å¦‚åªå…è®¸ç‰¹å®š Pod è®¿é—®ã€‚ç›´æ¥æŒ‚è½½ NFS å®¹æ˜“æƒé™æ··ä¹±ã€‚</td></tr><tr><td>âœ… <strong>æ›´å¥½å…¼å®¹æ€§</strong></td><td>æŸäº›å·¥ä½œè´Ÿè½½ï¼ˆå¦‚ StatefulSetï¼‰<strong>åªèƒ½ç”¨ PVC</strong>ï¼Œä¸æ”¯æŒç›´æ¥ <code>nfs</code> å·ã€‚</td></tr><tr><td>âœ… <strong>æ›´çµæ´»çš„åˆ‡æ¢å­˜å‚¨æ–¹æ¡ˆ</strong></td><td>åæœŸå¦‚æœæ¢æˆ Cephã€EBSã€GlusterFSï¼Œåªéœ€æ”¹ PV/PVCï¼Œä¸éœ€è¦æ”¹ Pod é…ç½®ã€‚</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· NFS ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>Linux å®‰è£… NFS</title>
    <link href="https://blog.hanqunfeng.com/2025/07/21/linux-nfs/"/>
    <id>https://blog.hanqunfeng.com/2025/07/21/linux-nfs/</id>
    <published>2025-07-21T15:34:05.000Z</published>
    <updated>2025-07-21T07:58:09.351Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote % --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» linux ä¸‹ nfs æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ä¸ä½¿ç”¨</p></li><li class="lvl-2"><p>æœ¬æ–‡åŸºäº<code>CentOS8(x86_64)</code></p></li></ul><span id="more"></span><h2 id="NFS-ç®€ä»‹">NFS ç®€ä»‹</h2><ul class="lvl-0"><li class="lvl-2"><p>NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ŒNetwork File Systemï¼‰æ˜¯ä¸€ä¸ªé€šè¿‡ç½‘ç»œå…±äº«æ–‡ä»¶çš„åè®®ï¼Œå…è®¸ä¸åŒæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯åƒæŒ‚è½½æœ¬åœ°ç£ç›˜ä¸€æ ·è®¿é—®è¿œç«¯çš„å…±äº«æ–‡ä»¶ç›®å½•ã€‚</p></li></ul><h2 id="å‡†å¤‡ä¸€å°æœåŠ¡å™¨">å‡†å¤‡ä¸€å°æœåŠ¡å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½® hostname</span></span><br><span class="line">hostnamectl set-hostname nfs-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç½‘å¡</span></span><br><span class="line">ip a</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®IP åˆ†é…æ–¹å¼ï¼Œmanual: æ‰‹åŠ¨æŒ‡å®šIPï¼Œauto: DHCPè‡ªåŠ¨è·å–ï¼Œdisabled: å…³é—­IP</span></span><br><span class="line">nmcli con mod enp0s5 ipv4.method manual</span><br><span class="line"><span class="comment"># è®¾ç½® IP</span></span><br><span class="line">nmcli con mod enp0s5 ipv4.addresses 10.211.55.88/24</span><br><span class="line"><span class="comment"># è®¾ç½® gateway</span></span><br><span class="line">nmcli con mod enp0s5 ipv4.gateway 10.211.55.1</span><br><span class="line"><span class="comment"># è®¾ç½® dns</span></span><br><span class="line">nmcli con mod enp0s5 ipv4.dns <span class="string">&quot;10.211.55.1,8.8.8.8&quot;</span></span><br><span class="line"><span class="comment"># é‡æ–°å¯åŠ¨ç½‘å¡</span></span><br><span class="line">nmcli con up enp0s5</span><br></pre></td></tr></table></figure><h2 id="NFS-å®‰è£…ï¼šæœåŠ¡ç«¯">NFS å®‰è£…ï¼šæœåŠ¡ç«¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… nfs-utils å’Œ rpcbind</span></span><br><span class="line">dnf install rpcbind nfs-utils -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º nfs-server å­˜å‚¨ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /nfs-server/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½® nfs-serverï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªç›®å½•</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/nfs-server/data *(insecure,rw,sync,no_root_squash,no_all_squash)&quot;</span> &gt;&gt; /etc/exports</span><br><span class="line"><span class="comment">## é…ç½®é¡¹è¯´æ˜</span></span><br><span class="line"><span class="comment"># * ï¼šå…è®¸æ‰€æœ‰å®¢æˆ·ç«¯è®¿é—®ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“çš„å®¢æˆ·ç«¯ IP åœ°å€ï¼Œæ¯”å¦‚ï¼š192.168.0.0/24(rw,sync,no_root_squash,no_all_squash)</span></span><br><span class="line"><span class="comment"># insecure ï¼šå…è®¸ä»»æ„ç«¯å£ï¼ˆå…¼å®¹æ€§å¥½,æ”¯æŒk8sï¼‰ï¼Œé»˜è®¤å€¼æ˜¯ secureï¼šåªå…è®¸ 1024 ä»¥ä¸‹ç«¯å£ï¼Œé€‚åˆä¼ ç»ŸæœåŠ¡å™¨</span></span><br><span class="line"><span class="comment"># rw ï¼šè¯»å†™æƒé™ï¼Œroï¼šåªè¯»æƒé™</span></span><br><span class="line"><span class="comment"># sync ï¼šåŒæ­¥æ¨¡å¼ï¼Œå¼ºä¸€è‡´æ€§ï¼Œasyncï¼šå¼‚æ­¥æ¨¡å¼ï¼Œæ€§èƒ½é«˜ï¼Œä½†å­˜åœ¨ä¸¢æ•°æ®é£é™©</span></span><br><span class="line"><span class="comment"># no_root_squash ï¼šå…è®¸ root ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œroot ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·</span></span><br><span class="line"><span class="comment"># no_all_squash ï¼šå…è®¸æ‰€æœ‰ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå¯ä»¥çœç•¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ rpcbindã€nfs æœåŠ¡</span></span><br><span class="line">systemctl start rpcbind &amp;&amp; systemctl start nfs-server</span><br><span class="line"><span class="comment"># å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">systemctl <span class="built_in">enable</span> rpcbind &amp;&amp; systemctl <span class="built_in">enable</span> nfs-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/exportsï¼Œéœ€è¦é‡è½½ nfs é…ç½®</span></span><br><span class="line">systemctl reload nfs-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ nfs æœåŠ¡çŠ¶æ€</span></span><br><span class="line">systemctl status nfs-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ nfs æœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 2049</span></span><br><span class="line">$ rpcinfo -p | grep nfs</span><br><span class="line">    100003    3   tcp   2049  nfs</span><br><span class="line">    100003    4   tcp   2049  nfs</span><br><span class="line">    100227    3   tcp   2049  nfs_acl</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å¯¼å‡ºçš„å…±äº«ç›®å½•</span></span><br><span class="line">$ exportfs -v</span><br><span class="line">/nfs-server/data</span><br><span class="line">                &lt;world&gt;(<span class="built_in">sync</span>,wdelay,hide,no_subtree_check,sec=sys,rw,insecure,no_root_squash,no_all_squash)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¼€æ”¾ç«¯å£">å¼€æ”¾ç«¯å£</h3><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ç«¯å£</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ rpcinfo -p 10.211.55.88</span><br><span class="line">   program vers proto   port  service</span><br><span class="line">    100000    4   tcp    111  portmapper</span><br><span class="line">    100000    3   tcp    111  portmapper</span><br><span class="line">    100000    2   tcp    111  portmapper</span><br><span class="line">    100000    4   udp    111  portmapper</span><br><span class="line">    100000    3   udp    111  portmapper</span><br><span class="line">    100000    2   udp    111  portmapper</span><br><span class="line">    100024    1   udp  36578  status</span><br><span class="line">    100024    1   tcp  46973  status</span><br><span class="line">    100005    1   udp  20048  mountd</span><br><span class="line">    100005    1   tcp  20048  mountd</span><br><span class="line">    100005    2   udp  20048  mountd</span><br><span class="line">    100005    2   tcp  20048  mountd</span><br><span class="line">    100005    3   udp  20048  mountd</span><br><span class="line">    100005    3   tcp  20048  mountd</span><br><span class="line">    100003    3   tcp   2049  nfs</span><br><span class="line">    100003    4   tcp   2049  nfs</span><br><span class="line">    100227    3   tcp   2049  nfs_acl</span><br><span class="line">    100021    1   udp  36529  nlockmgr</span><br><span class="line">    100021    3   udp  36529  nlockmgr</span><br><span class="line">    100021    4   udp  36529  nlockmgr</span><br><span class="line">    100021    1   tcp  45917  nlockmgr</span><br><span class="line">    100021    3   tcp  45917  nlockmgr</span><br><span class="line">    100021    4   tcp  45917  nlockmgr</span><br></pre></td></tr></table></figure><table><thead><tr><th>Program (ç¼–å·)</th><th>æœåŠ¡åç§°</th><th>ç”¨é€”</th><th>ç«¯å£</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>100000</code></td><td>portmapper</td><td>RPC æœåŠ¡æ³¨å†Œè¡¨</td><td>111/tcp, 111/udp</td><td><strong>å¿…é¡»å¼€æ”¾</strong>ï¼Œå®¢æˆ·ç«¯é€šè¿‡å®ƒæŸ¥æ‰¾å…¶å®ƒæœåŠ¡ç«¯å£</td></tr><tr><td><code>100024</code></td><td>status (rpc.statd)</td><td>æ–‡ä»¶é”å®šçŠ¶æ€ç®¡ç†</td><td>36578/udp, 46973/tcp</td><td>å¸¸é…åˆ nlockmgr ä½¿ç”¨ï¼Œéå¿…éœ€</td></tr><tr><td><code>100005</code></td><td>mountd</td><td>æŒ‚è½½æœåŠ¡</td><td>20048/tcp, 20048/udp</td><td><strong>æŒ‚è½½æ—¶å¿…éœ€</strong></td></tr><tr><td><code>100003</code></td><td>nfs</td><td>NFS ä¸»æœåŠ¡</td><td>2049/tcp</td><td><strong>æ ¸å¿ƒæœåŠ¡ï¼Œå¿…éœ€</strong></td></tr><tr><td><code>100227</code></td><td>nfs_acl</td><td>NFS çš„ ACL æƒé™æ§åˆ¶</td><td>2049/tcp</td><td>é€šå¸¸ä¸ nfs ä¸€èµ·</td></tr><tr><td><code>100021</code></td><td>nlockmgr</td><td>æ–‡ä»¶é”ç®¡ç†</td><td>36529/udp, 45917/tcp</td><td>Stateful åº”ç”¨æ¶‰åŠæ–‡ä»¶é”æ—¶éœ€è¦</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æœ€å°ç«¯å£è¦æ±‚ï¼ˆåŸºæœ¬æŒ‚è½½ç”¨ï¼‰</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>éœ€è¦å¼€æ”¾çš„ç«¯å£</th></tr></thead><tbody><tr><td>âœ… <strong>åŸºæœ¬ NFS æŒ‚è½½è¯»å†™</strong></td><td><code>2049/tcp</code> + <code>111/tcp/udp</code></td></tr><tr><td>âœ… <strong>å®¹å™¨æˆ– K8s æŒ‚è½½</strong></td><td>åŒä¸Šï¼Œä¸€èˆ¬è¿˜æ¨è <code>20048/tcp/udp</code></td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>å¼€æ”¾å¿…é¡»ç«¯å£</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=2049/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=111/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=111/udp</span><br><span class="line">firewall-cmd --permanent --add-port=20048/tcp</span><br><span class="line">firewall-cmd --permanent --add-port=20048/udp</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h2 id="NFS-å®‰è£…ï¼šå®¢æˆ·ç«¯">NFS å®‰è£…ï¼šå®¢æˆ·ç«¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… nfs-utils å’Œ rpcbindï¼Œå®‰è£…åä¸éœ€è¦å¯åŠ¨ nfs-server æœåŠ¡ï¼Œåªéœ€è¦å¯åŠ¨ rpcbind æœåŠ¡ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½è¦è¿è¡Œ</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install rpcbind nfs-utils -y</span><br><span class="line"><span class="built_in">sudo</span> systemctl start rpcbind &amp;&amp; systemctl <span class="built_in">enable</span> rpcbind</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœåŠ¡å™¨çš„å…±äº«èµ„æºåˆ—è¡¨</span></span><br><span class="line"><span class="comment"># showmount -e &lt;nfs-server-ip&gt;</span></span><br><span class="line">$ showmount -e 10.211.55.88</span><br><span class="line">Export list <span class="keyword">for</span> 10.211.55.88:</span><br><span class="line">/nfs-server/data *</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º å®¢æˆ·ç«¯æŒ‚è½½ç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /nfs/data</span><br><span class="line"><span class="comment"># æŒ‚è½½</span></span><br><span class="line">mount -t nfs 10.211.55.88:/nfs-server/data /nfs/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‚è½½ç‚¹</span></span><br><span class="line">$ mount | grep nfs/data</span><br><span class="line">10.211.55.88:/nfs-server/data on /nfs/data <span class="built_in">type</span> nfs4 (rw,relatime,vers=4.2,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.211.55.11,local_lock=none,addr=10.211.55.88)</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‚è½½ç‚¹ä¿¡æ¯ï¼Œè¿™ç§æ–¹å¼æ›´å‹å¥½</span></span><br><span class="line">$ <span class="built_in">df</span> -t nfs4</span><br><span class="line">Filesystem                    1K-blocks    Used Available Use% Mounted on</span><br><span class="line">10.211.55.88:/nfs-server/data  42872832 3630080  39242752   9% /nfs/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®è‡ªåŠ¨æŒ‚è½½</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;10.211.55.88:/nfs-server/data /nfs/data nfs defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line"><span class="comment"># æ ¹æ® /etc/fstab æ–‡ä»¶çš„é…ç½®ï¼Œå°è¯•æŒ‚è½½æ‰€æœ‰æœªæŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿã€‚ä¿®æ”¹ /etc/fstab åæ‰§è¡Œ mount -a ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å®¢æˆ·ç«¯æŒ‚è½½çš„ç›®å½•ä¸èƒ½åˆ é™¤ï¼Œéœ€è¦å…ˆå¸è½½</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -f å¼ºåˆ¶å¸è½½</span></span><br><span class="line">umount -f /nfs/data</span><br><span class="line"></span><br><span class="line">vim /etc/fstab</span><br><span class="line"><span class="comment"># åˆ é™¤æˆ–æ³¨é‡Šæ‰å¯¹åº”çš„ NFS æŒ‚è½½è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /nfs/data</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» linux ä¸‹ nfs æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ä¸ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡åŸºäº&lt;code&gt;CentOS8(x86_64)&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="linux" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/linux/"/>
    
    <category term="nfs" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/linux/nfs/"/>
    
    
    <category term="linux" scheme="https://blog.hanqunfeng.com/tags/linux/"/>
    
    <category term="nfs" scheme="https://blog.hanqunfeng.com/tags/nfs/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ å­˜å‚¨å· hostPath</title>
    <link href="https://blog.hanqunfeng.com/2025/07/21/k8s-storage-hostpath/"/>
    <id>https://blog.hanqunfeng.com/2025/07/21/k8s-storage-hostpath/</id>
    <published>2025-07-21T15:33:05.000Z</published>
    <updated>2025-07-21T08:25:15.741Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· hostPath ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li></ul><span id="more"></span><h2 id="å­˜å‚¨å·-hostPath-ä»‹ç»">å­˜å‚¨å· hostPath ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>hostPath æ˜¯ä¸€ç§ç›´æ¥æŠŠ Node èŠ‚ç‚¹æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½• æŒ‚è½½åˆ° Pod å®¹å™¨é‡Œçš„å­˜å‚¨å·ã€‚</p></li><li class="lvl-2"><p>å®¹æ˜“ç ´åèŠ‚ç‚¹ç¯å¢ƒï¼Œä¸å»ºè®®ç”Ÿäº§ä½¿ç”¨</p></li><li class="lvl-2"><p>åŒä¸€ä¸ª Deployment çš„å¤šä¸ª Pod è¢«è°ƒåº¦åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”å®ƒä»¬çš„ hostPath é…ç½®æŒ‡å‘ç›¸åŒçš„å®¿ä¸»æœºè·¯å¾„ï¼Œè¿™äº› Pod ä¹‹é—´æ˜¯å¯ä»¥å…±äº«è¯¥ç›®å½•ä¸­æ–‡ä»¶çš„ã€‚</p></li><li class="lvl-2"><p>å…¸å‹ä½¿ç”¨åœºæ™¯</p></li></ul><table><thead><tr><th>åœºæ™¯</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>æ—¥å¿—æ”¶é›†</td><td>æŒ‚è½½ <code>/var/log</code> åˆ° Pod å†…éƒ¨</td></tr><tr><td>æŒ‚è½½å®¿ä¸»æœºé…ç½®æ–‡ä»¶</td><td>å¦‚æŒ‚è½½ <code>/etc/hosts</code>ã€<code>/etc/localtime</code></td></tr><tr><td>ä½¿ç”¨å®¿ä¸»æœº docker.sock</td><td>æŒ‚è½½ <code>/var/run/docker.sock</code> è¿è¡Œ Docker-in-Docker</td></tr><tr><td>å­˜å‚¨è°ƒè¯•ä¸´æ—¶æ–‡ä»¶</td><td>Pod è°ƒè¯•æ—¶è®¿é—®å®¿ä¸»æœºç‰¹å®šç›®å½•</td></tr></tbody></table><h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>Pod å†…éƒ¨ /mnt/hostdata æ˜ å°„åˆ°å®¿ä¸»æœº /data ç›®å½•</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hostpath-example</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span>                   <span class="comment"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/mnt/hostdata</span>      <span class="comment"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /mnt/hostdata ç›®å½•</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">myvolume</span>                <span class="comment"># å­˜å‚¨å·åç§° ï¼Œä¸ volumes ä¸­å®šä¹‰çš„ volume é…ç½®åç§°ä¸€è‡´</span></span><br><span class="line">  <span class="attr">volumes:</span>                          <span class="comment"># å­˜å‚¨å·å£°æ˜</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myvolume</span>                  <span class="comment"># å­˜å‚¨å·åç§°</span></span><br><span class="line">    <span class="attr">hostPath:</span>                       <span class="comment"># å­˜å‚¨å·ç±»å‹ï¼Œè¿™é‡Œæ˜¯ hostPath</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/data</span>                   <span class="comment"># ä¸»æœºç›®å½•</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">Directory</span>               <span class="comment"># å¯é€‰å­—æ®µï¼Œä¸»è¦ç”¨äºæŒ‚è½½å‰éªŒè¯</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p><code>hostPath.type</code> å¯ä»¥é…ç½®çš„å€¼å¦‚ä¸‹ï¼Œé»˜è®¤ä¸º ç©ºã€‚</p></li></ul><table><thead><tr><th>type</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>DirectoryOrCreate</code></td><td>å¦‚æœ <code>/data</code> ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º ï¼Œæƒé™ä¸º 0755</td></tr><tr><td><code>Directory</code></td><td>å¿…é¡»å­˜åœ¨ä¸”ä¸ºç›®å½•</td></tr><tr><td><code>File</code></td><td>å¿…é¡»å­˜åœ¨ä¸”ä¸ºæ–‡ä»¶</td></tr><tr><td><code>Socket</code></td><td>å¿…é¡»æ˜¯ socket</td></tr><tr><td><code>CharDevice</code></td><td>å­—ç¬¦è®¾å¤‡</td></tr><tr><td><code>BlockDevice</code></td><td>å—è®¾å¤‡</td></tr><tr><td><code>FileOrCreate</code></td><td>ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºç©ºæ–‡ä»¶ï¼Œæƒé™è®¾ç½®ä¸º 0644</td></tr><tr><td><code>ä¸è®¾ç½®</code></td><td>é»˜è®¤å€¼æ˜¯ç©ºï¼Œä¸»æœºä¸Šçš„è·¯å¾„æ— è®ºæ˜¯æ–‡ä»¶ã€ç›®å½•ã€ç”šè‡³ä¸å­˜åœ¨ï¼Œéƒ½ä¼šç›´æ¥æŒ‚è½½ ,å®¹æ˜“å¼•èµ·é¢„æœŸä¹‹å¤–çš„æŒ‚è½½é—®é¢˜</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>Kubernetes åœ¨åˆ é™¤ Pod æ—¶ï¼Œä¸ä¼šåˆ é™¤ hostPath æ‰€æŒ‚è½½çš„å®¿ä¸»æœºç›®å½•æˆ–æ–‡ä»¶</p></li></ul><table><thead><tr><th>å­˜å‚¨å·ç±»å‹</th><th>åˆ é™¤ Pod åç›®å½•ä¼šè¢«åˆ é™¤å—ï¼Ÿ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>emptyDir</code></td><td>âœ… <strong>ä¼šè¢«åˆ é™¤</strong></td><td>ä¸´æ—¶ç›®å½•ï¼ŒPod ç”Ÿå‘½å‘¨æœŸç»“æŸè‡ªåŠ¨æ¸…ç†</td></tr><tr><td><code>hostPath</code></td><td>âŒ <strong>ä¸ä¼šåˆ é™¤</strong></td><td>å®¿ä¸»æœºè·¯å¾„ç‹¬ç«‹äº Pod ç”Ÿå‘½å‘¨æœŸï¼Œ<strong>ä¸ä¼šæ¸…ç†</strong></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· hostPath ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ å­˜å‚¨å· emptyDir</title>
    <link href="https://blog.hanqunfeng.com/2025/07/21/k8s-storage-emptydir/"/>
    <id>https://blog.hanqunfeng.com/2025/07/21/k8s-storage-emptydir/</id>
    <published>2025-07-21T15:30:05.000Z</published>
    <updated>2025-07-21T03:30:08.434Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· emptyDir ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li></ul><span id="more"></span><h2 id="å­˜å‚¨å·-emptyDir-ä»‹ç»">å­˜å‚¨å· emptyDir ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>emptyDir æ˜¯ Kubernetes ä¸­æœ€ç®€å•çš„ä¸€ç§ Pod çº§åˆ«çš„ä¸´æ—¶å­˜å‚¨å·ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼šPod ç”Ÿå‘½å‘¨æœŸå†…å…±äº«ä¸´æ—¶å­˜å‚¨ï¼ŒPod åˆ é™¤åæ•°æ®è‡ªåŠ¨ä¸¢å¼ƒã€‚</p></li><li class="lvl-2"><p>åŒä¸€ä¸ª Pod å†…çš„å¤šä¸ªå®¹å™¨å¯ä»¥é€šè¿‡ emptyDir å…±äº«æ•°æ®ã€‚è·¨ Pod ä¸å…±äº«ï¼Œé€‚ç”¨äºä¸´æ—¶æ•°æ®ã€‚</p></li><li class="lvl-2"><p>emptyDir åªèƒ½æŒ‚è½½ç›®å½•ã€‚</p></li></ul><h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2><ul class="lvl-0"><li class="lvl-2"><p>ä¸¤ä¸ªå®¹å™¨ app å’Œ sidecar é€šè¿‡ /data å…±äº«ä¸€ä¸ª emptyDir å·ã€‚</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shared-emptydir-pod.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">shared-emptydir-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.sto:</span> <span class="string">emptydir</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo Hello &gt; /data1/hello; sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span>               <span class="comment"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-data</span>         <span class="comment"># æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸‹é¢ volumes ä¸­å®šä¹‰çš„ volume åç§°ä¸€è‡´</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data1</span>          <span class="comment"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data1 ç›®å½•</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sidecar</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;sleep 3600&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span>               <span class="comment"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-data</span>         <span class="comment"># æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸Šé¢å®¹å™¨ä¸­çš„ volume é…ç½®åç§°ä¸€è‡´</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/data2</span>         <span class="comment"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data2 ç›®å½•</span></span><br><span class="line">  <span class="attr">volumes:</span>                      <span class="comment"># å­˜å‚¨å·å£°æ˜</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shared-data</span>           <span class="comment"># å­˜å‚¨å·åç§°</span></span><br><span class="line">    <span class="attr">emptyDir:</span> &#123;&#125;                <span class="comment"># å£°æ˜ä¸º emptyDir å­˜å‚¨å·</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">k apply -f shared-emptydir-pod.yaml</span><br><span class="line"><span class="comment"># æŸ¥çœ‹podæ‰€åœ¨èŠ‚ç‚¹</span></span><br><span class="line">$ k get pod -l app.sto=emptydir</span><br><span class="line">NAME                  READY   STATUS    RESTARTS   AGE   IP              NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">shared-emptydir-pod   2/2     Running   0          22m   10.244.126.59   k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ pod-uid</span></span><br><span class="line">$ kubectl get pod shared-emptydir-pod -o jsonpath=<span class="string">&#x27;&#123;.metadata.uid&#125;&#x27;</span></span><br><span class="line">d597b4d7-e6b6-4522-887e-73d3f4c01006</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>emptyDir å­˜å‚¨å· é»˜è®¤ä½¿ç”¨èŠ‚ç‚¹æœ¬åœ°ç£ç›˜ï¼Œè·¯å¾„ä¸º <code>/var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt;</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç™»å½• k8s-worker2 èŠ‚ç‚¹</span></span><br><span class="line"><span class="built_in">export</span> POD_UID=d597b4d7-e6b6-4522-887e-73d3f4c01006</span><br><span class="line"><span class="built_in">export</span> POD_UID=6ea6636c-4a24-4dc5-af2a-2448825913b6</span><br><span class="line"><span class="built_in">export</span> VOLUME_NAME=shared-data</span><br><span class="line"><span class="built_in">cd</span> /var/lib/kubelet/pods/<span class="variable">$POD_UID</span>/volumes/kubernetes.io~empty-dir/<span class="variable">$VOLUME_NAME</span></span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">hello</span><br><span class="line">$ <span class="built_in">cat</span> hello</span><br><span class="line">Hello</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿›å…¥å®¹å™¨æŸ¥çœ‹å­˜å‚¨å·å†…å®¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl <span class="built_in">exec</span> -it shared-emptydir-pod -c app -- <span class="built_in">cat</span> /data1/hello</span><br><span class="line">Hello</span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it shared-emptydir-pod -c sidecar -- <span class="built_in">cat</span> /data2/hello</span><br><span class="line">Hello</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹å†…å®¹ï¼Œå®é™…ä¸Šåœ¨å®¹å™¨å†…éƒ¨å’Œå¤–éƒ¨éƒ½å¯ä»¥ä¿®æ”¹å­˜å‚¨å·å†…å®¹ï¼Œä¿®æ”¹åç«‹åˆ»ç”Ÿæ•ˆ</span></span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it shared-emptydir-pod -c sidecar -- sh -c <span class="string">&quot;echo &#x27;Hello World&#x27; &gt; /data2/hello&quot;</span></span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it shared-emptydir-pod -c app -- <span class="built_in">cat</span> /data1/hello</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åˆ é™¤PODåemptydirå­˜å‚¨å·ä¼šç«‹åˆ»åˆ é™¤</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod shared-emptydir-pod</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½• k8s-worker2 èŠ‚ç‚¹æŸ¥çœ‹ emptydir å­˜å‚¨å·</span></span><br><span class="line">$ <span class="built_in">ls</span> /var/lib/kubelet/pods/<span class="variable">$POD_UID</span></span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;/var/lib/kubelet/pods/d597b4d7-e6b6-4522-887e-73d3f4c01006&#x27;</span>: No such file or directory</span><br></pre></td></tr></table></figure><h2 id="å°†-emptydir-å­˜å‚¨å·æ”¹ç”¨-å†…å­˜-å­˜å‚¨">å°† emptydir å­˜å‚¨å·æ”¹ç”¨ å†…å­˜ å­˜å‚¨</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">emptyDir:</span></span><br><span class="line">  <span class="attr">medium:</span> <span class="string">Memory</span>        <span class="comment"># ä½¿ç”¨ å†…å­˜ å­˜å‚¨ï¼ˆtmpfsï¼‰ï¼Œé€‚åˆé«˜ IO ä¸´æ—¶ç¼“å­˜</span></span><br><span class="line">  <span class="attr">sizeLimit:</span> <span class="string">512Mi</span>      <span class="comment"># é™åˆ¶å­˜å‚¨å¤§å°</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>è¿™é‡Œè¦æ³¨æ„ï¼Œå³ä½¿è¿™é‡Œä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œä½†æ˜¯ <code>/var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt;</code> ä¾ç„¶å­˜åœ¨ï¼Œä½†å®ƒæŒ‚è½½çš„æ˜¯ tmpfs æ–‡ä»¶ç³»ç»Ÿ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç™»å½•podæ‰€åœ¨èŠ‚ç‚¹æŸ¥çœ‹æŒ‚è½½ç‚¹</span></span><br><span class="line">$ mount | grep <span class="variable">$POD_UID</span></span><br><span class="line">tmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~empty-dir/shared-data <span class="built_in">type</span> tmpfs (rw,relatime,size=524288k)</span><br><span class="line">tmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~projected/kube-api-access-5nk7d <span class="built_in">type</span> tmpfs (rw,relatime,size=3903212k)</span><br></pre></td></tr></table></figure><table><thead><tr><th>å·ç±»å‹</th><th>æ¥æº</th><th>æŒ‚è½½è·¯å¾„</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>emptyDir</td><td>ä½ é…ç½®çš„</td><td><code>/data1</code>, <code>/data2</code></td><td>Pod å†…éƒ¨å®¹å™¨å…±äº«ä¸´æ—¶å†…å­˜å­˜å‚¨</td></tr><tr><td>projected</td><td>ç³»ç»Ÿè‡ªåŠ¨</td><td><code>/var/run/secrets/kubernetes.io/serviceaccount/</code></td><td>æŒ‚è½½ serviceaccount tokenï¼ŒCA è¯ä¹¦</td></tr></tbody></table><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å®¹å™¨å†…æŒ‚è½½ç‚¹</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl <span class="built_in">exec</span> shared-emptydir-pod -c app -- mount | grep /data1</span><br><span class="line">tmpfs on /data1 <span class="built_in">type</span> tmpfs (rw,relatime,size=524288k)</span><br><span class="line">$ kubectl <span class="built_in">exec</span> shared-emptydir-pod -c app -- mount | grep serviceaccount</span><br><span class="line">tmpfs on /var/run/secrets/kubernetes.io/serviceaccount <span class="built_in">type</span> tmpfs (ro,relatime,size=3903212k)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· emptyDir ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>K8S ä¹‹ Statefulset</title>
    <link href="https://blog.hanqunfeng.com/2025/07/20/k8s-statefulset/"/>
    <id>https://blog.hanqunfeng.com/2025/07/20/k8s-statefulset/</id>
    <published>2025-07-20T15:30:05.000Z</published>
    <updated>2025-07-22T08:48:12.925Z</updated>
    
    <content type="html"><![CDATA[<!-- **åŠ ç²—** *æ–œä½“* ***åŠ ç²—å¹¶æ–œä½“*** ~~åˆ é™¤çº¿~~ ==çªå‡ºæ˜¾ç¤º== `çªå‡ºæ˜¾ç¤º(æ¨è)` ++ä¸‹åˆ’çº¿++ ~ä¸‹æ ‡~ ^ä¸Šæ ‡^ è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference. å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600) +++ **ç‚¹å‡»æŠ˜å ** è¿™æ˜¯è¢«éšè—çš„å†…å®¹ +++::: tips success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹:::% note info % success warning dangerè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹% endnote %å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{} å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ --><h2 id="æ‘˜è¦">æ‘˜è¦</h2><ul class="lvl-0"><li class="lvl-2"><p>æœ¬æ–‡ä»‹ç» K8S çš„ Statefulset ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/">K8Så®˜ç½‘</a></p></li><li class="lvl-2"><p><a href="https://github.com/kubernetes/kubernetes">k8s Github</a></p></li><li class="lvl-2"><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/">k8s Statefulset ä»‹ç»</a></p></li></ul><span id="more"></span><h2 id="Statefulset-ä»‹ç»">Statefulset ä»‹ç»</h2><ul class="lvl-0"><li class="lvl-2"><p>Statefulset(ç¼©å†™ä¸º sts) æ˜¯ K8S å®˜æ–¹æä¾›çš„ä¸€ç§æ§åˆ¶å™¨ï¼Œç”¨äºç®¡ç†æœ‰çŠ¶æ€åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“åº”ç”¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç­‰ç­‰ã€‚</p></li><li class="lvl-2"><p>Statefulset(æœ‰çŠ¶æ€) ä¸ Deployment(æ— çŠ¶æ€) çš„åŒºåˆ«æ˜¯ï¼š</p><ul class="lvl-2"><li class="lvl-4">Statefulset åˆ›å»ºçš„ Pod ä¼šæœ‰ç›¸åŒçš„åç§°ï¼Œå¹¶ä¸”ä¼šåˆ†é…ç›¸åŒçš„æŒä¹…å·ã€‚</li><li class="lvl-4">Statefulset åˆ›å»ºçš„ Pod ä½¿ç”¨ Headless Service(æ— å¤´æœåŠ¡ï¼Œæ²¡æœ‰ClusterIP)è¿›è¡Œé€šä¿¡ã€‚</li></ul></li></ul><h2 id="Statefulset-ç®¡ç†">Statefulset ç®¡ç†</h2><h3 id="Statefulset-åˆ›å»º">Statefulset åˆ›å»º</h3><ul class="lvl-0"><li class="lvl-2"><p>Statefulset åªèƒ½ é€šè¿‡ <code>yaml</code> åˆ›å»ºï¼Œä¸æ”¯æŒ <code>create</code> åˆ›å»º</p></li><li class="lvl-2"><p>ä¸€ä¸ªç®€å•çš„ <code>redis-statefulset.yaml</code> æ–‡ä»¶è¯´æ˜</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                      <span class="comment"># apiç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>                       <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line"><span class="attr">metadata:</span>                           <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-svc</span>                   <span class="comment"># serviceåç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">sts-ns</span></span><br><span class="line"><span class="attr">spec:</span>                               <span class="comment"># é…ç½®</span></span><br><span class="line">  <span class="attr">ports:</span>                            <span class="comment"># ç«¯å£</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">6379</span>                      <span class="comment"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span>                   <span class="comment"># åè®®</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">6379</span>                <span class="comment"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class="line">  <span class="attr">selector:</span>                         <span class="comment"># é€‰æ‹©å™¨</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis</span>                      <span class="comment"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span>                   <span class="comment"># é›†ç¾¤IPè®¾ç½®ä¸ºNoneï¼Œå³ä¸ºâ€œHeadless Serviceâ€</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span>                   <span class="comment"># æœåŠ¡ç±»å‹ï¼Œé»˜è®¤ä¸ºClusterIP</span></span><br><span class="line"><span class="string">---</span>                                 <span class="comment"># åˆ†å‰²çº¿</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>                  <span class="comment"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æº</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span>                    <span class="comment"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-sts</span>                    <span class="comment"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">sts-ns</span></span><br><span class="line"><span class="attr">spec:</span>                                <span class="comment"># é…ç½®é¡¹</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span>           <span class="comment"># ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚</span></span><br><span class="line">  <span class="attr">selector:</span>                          <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>                     <span class="comment"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">redis</span>                     <span class="comment"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class="line">  <span class="attr">updateStrategy:</span>                    <span class="comment"># æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ ·</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span>              <span class="comment"># 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚</span></span><br><span class="line">                                     <span class="comment"># 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span>                   <span class="comment"># æ»šåŠ¨å‡çº§çš„é…ç½®</span></span><br><span class="line">      <span class="attr">partition:</span> <span class="number">0</span>                    <span class="comment"># ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">redis-svc</span>             <span class="comment"># æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span>                        <span class="comment"># å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1</span></span><br><span class="line">  <span class="attr">template:</span>                          <span class="comment"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">redis</span>                   <span class="comment"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">redis:6.2</span>             <span class="comment"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis</span>                  <span class="comment"># å®¹å™¨çš„åç§°ï¼Œå®é™…çš„åç§°ä¸º sts-redis-&lt;number&gt;ï¼Œä» 0 å¼€å§‹é€’å¢</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰§è¡Œåˆ›å»º</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">kubectl create namespace sts-ns</span><br><span class="line"><span class="comment"># åˆ›å»º StatefulSet</span></span><br><span class="line">kubectl apply -f redis-statefulset.yaml</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-Statefulset">æŸ¥çœ‹ Statefulset</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ k get all -n sts-ns</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/redis-sts-0   1/1     Running   0          40s</span><br><span class="line">pod/redis-sts-1   1/1     Running   0          24s</span><br><span class="line"></span><br><span class="line">NAME                TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">service/redis-svc   ClusterIP   None         &lt;none&gt;        6379/TCP   40s</span><br><span class="line"></span><br><span class="line">NAME                         READY   AGE</span><br><span class="line">statefulset.apps/redis-sts   2/2     40s</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®podä¸­çš„redisæœåŠ¡">è®¿é—®podä¸­çš„redisæœåŠ¡</h3><ul class="lvl-0"><li class="lvl-2"><p>æ—¢ç„¶æ˜¯Headless Serviceï¼Œå°±åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®</p></li><li class="lvl-2"><p>åœ¨ç›¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>serviceName</code> ç›´æ¥è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ <code>&lt;pod-name&gt;.&lt;service-name&gt;</code></p></li><li class="lvl-2"><p>åœ¨ä¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>&lt;serviceName&gt;.&lt;namespace&gt;</code> æˆ–è€… <code>&lt;serviceName&gt;.&lt;namespace&gt;.svc.cluster.local</code> è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ <code>&lt;pod-name&gt;.&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</code> è®¿é—®ï¼Œå› ä¸º pod-name æ˜¯å›ºå®šä¸”å”¯ä¸€çš„</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ k <span class="built_in">exec</span> -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-svc</span><br><span class="line">10.244.126.55   redis-svc.sts-ns.svc.cluster.local</span><br><span class="line">10.244.194.110  redis-svc.sts-ns.svc.cluster.local</span><br><span class="line"></span><br><span class="line">$ k <span class="built_in">exec</span> -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-sts-1.redis-svc</span><br><span class="line">10.244.126.55   redis-sts-1.redis-svc.sts-ns.svc.cluster.local</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ Serviceï¼Œç±»å‹ä¸º NodePort æˆ–è€… LoadBalancerï¼Œå°†redisæœåŠ¡æš´éœ²å‡ºå»</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>                      <span class="comment"># apiç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>                       <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line"><span class="attr">metadata:</span>                           <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-svc-out</span>               <span class="comment"># serviceåç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">sts-ns</span></span><br><span class="line"><span class="attr">spec:</span>                               <span class="comment"># é…ç½®</span></span><br><span class="line">  <span class="attr">ports:</span>                            <span class="comment"># ç«¯å£</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">6379</span>                      <span class="comment"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span>                   <span class="comment"># åè®®</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">6379</span>                <span class="comment"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class="line">  <span class="attr">selector:</span>                         <span class="comment"># é€‰æ‹©å™¨</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis</span>                      <span class="comment"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span>                <span class="comment"># è´Ÿè½½å‡è¡¡</span></span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æ‰§è¡Œ</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º</span></span><br><span class="line">$ k create -f redis-svc-out.yaml</span><br><span class="line"><span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">$ k get svc -n sts-ns</span><br><span class="line">NAME            TYPE           CLUSTER-IP    EXTERNAL-IP     PORT(S)          AGE</span><br><span class="line">redis-svc       ClusterIP      None          &lt;none&gt;          6379/TCP         70m</span><br><span class="line">redis-svc-out   LoadBalancer   10.96.21.96   10.211.55.202   6379:31806/TCP   54m</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨é›†ç¾¤å¤–çš„æœºå™¨ä¸Šè®¿é—® redisï¼Œæ¯æ¬¡è¿æ¥ä¼šè½®è¯¢è®¿é—®å„ä¸ªpod</span></span><br><span class="line">$ redis-cli -h 10.211.55.202 info server | grep redis_version</span><br><span class="line">redis_version:8.0.3</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-Statefulset-è¯¦æƒ…">æŸ¥çœ‹ Statefulset è¯¦æƒ…</h3><ul class="lvl-0"><li class="lvl-2"><p>å½“ Statefulset è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ Statefulset çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå› </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe sts &lt;sts-name&gt;</span><br><span class="line">kubectl describe sts &lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤-Statefulset">åˆ é™¤ Statefulset</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete sts &lt;sts-name&gt;</span><br><span class="line">kubectl delete sts &lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡ yaml æ–‡ä»¶åˆ é™¤</span></span><br><span class="line">kubectl delete -f &lt;yaml-file&gt;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-Statefulset-æ—¥å¿—">æŸ¥çœ‹ Statefulset æ—¥å¿—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs sts/&lt;sts-name&gt;</span><br><span class="line">kubectl logs sts/&lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure><h3 id="æ»šåŠ¨å‡çº§ä¸å›æ»š-Statefulset">æ»šåŠ¨å‡çº§ä¸å›æ»š Statefulset</h3><ul class="lvl-0"><li class="lvl-2"><p>å¯¹ <code>RollingUpdate</code> ç±»å‹çš„ <code>Statefulset</code> çš„ <code>.spec.template</code> çš„ä»»ä½•æ›´æ–°éƒ½å°†è§¦å‘æ»šåŠ¨æ›´æ–°ã€‚</p></li><li class="lvl-2"><p>æˆ‘ä»¬ä¿®æ”¹è¿‡ <code>Statefulset</code> çš„ <code>.spec.template</code>ï¼Œå¹¶ä¿å­˜åï¼Œé‡æ–°è¿è¡Œ <code>kubectl apply -f &lt;yaml-file&gt;</code>å³å¯è§¦å‘æ»šåŠ¨å‡çº§ã€‚</p></li><li class="lvl-2"><p>å¦‚æœåªæ˜¯æ›´æ–°å®¹å™¨çš„é•œåƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è§¦å‘æ»šåŠ¨å‡çº§</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ k <span class="built_in">exec</span> -it pod/redis-sts-0 -n sts-ns -- redis-server -v</span><br><span class="line">Redis server v=6.2.19 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=c51c65e7ae83f735</span><br><span class="line"></span><br><span class="line"><span class="comment"># kubectl set image sts/&lt;sts-name&gt; &lt;container-name&gt;=&lt;image&gt;:&lt;tag&gt; --record=true</span></span><br><span class="line">kubectl <span class="built_in">set</span> image sts redis-sts redis=redis:8.0 --record=<span class="literal">true</span> -n sts-ns</span><br><span class="line"></span><br><span class="line">$ k <span class="built_in">exec</span> -it pod/redis-sts-0 -n sts-ns -- redis-server -v</span><br><span class="line">Redis server v=8.0.3 sha=00000000:1 malloc=jemalloc-5.3.0 bits=64 build=d4cb0aa008da4ca9</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹æ»šåŠ¨å‡çº§çŠ¶æ€</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl rollout status sts/&lt;sts-name&gt;</span></span><br><span class="line">$ kubectl rollout status sts redis-sts -n sts-ns</span><br><span class="line">partitioned roll out complete: 2 new pods have been updated...</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>æŸ¥çœ‹å†å²ç‰ˆæœ¬</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰é¢çš„åºå·è¡¨ç¤ºç‰ˆæœ¬å·</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> sts redis-sts -n sts-ns</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„è¯¦æƒ…</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> sts redis-sts -n sts-ns --revision=1</span><br></pre></td></tr></table></figure><ul class="lvl-0"><li class="lvl-2"><p>å›æ»š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å›é€€åˆ°å‰ä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class="line">kubectl rollout undo sts redis-sts -n sts-ns</span><br><span class="line"><span class="comment"># å›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ --to-revision=1 è¡¨ç¤ºå›åˆ°ç‰ˆæœ¬1</span></span><br><span class="line">kubectl rollout undo sts redis-sts -n sts-nsx --to-revision=1</span><br></pre></td></tr></table></figure><h2 id="Deployment-å’Œ-StatefulSet-çš„å¯¹æ¯”æ€»ç»“">Deployment å’Œ StatefulSet çš„å¯¹æ¯”æ€»ç»“</h2><table><thead><tr><th>ç‰¹æ€§</th><th><strong>Deployment</strong></th><th><strong>StatefulSet</strong></th></tr></thead><tbody><tr><td><strong>ç”¨é€”</strong></td><td>æ— çŠ¶æ€åº”ç”¨ï¼ˆå¦‚ Web æœåŠ¡ã€API æœåŠ¡ï¼‰</td><td>æœ‰çŠ¶æ€åº”ç”¨ï¼ˆå¦‚æ•°æ®åº“ã€ç¼“å­˜ï¼šRedisã€MySQLã€Kafkaï¼‰</td></tr><tr><td><strong>Pod åç§°</strong></td><td>Pod åå­—éšæœºç”Ÿæˆï¼Œå¦‚ <code>nginx-abc123</code></td><td>Pod åå­—æœ‰åºï¼Œæ ¼å¼ä¸º <code>name-0</code>ã€<code>name-1</code>ã€<code>name-2</code></td></tr><tr><td><strong>ç¨³å®šçš„æ ‡è¯†</strong></td><td><strong>ä¸æä¾›</strong>ï¼Œæ¯æ¬¡é‡å»º Pod åå­—å¯èƒ½ä¸åŒ</td><td><strong>æä¾›</strong>ï¼Œæ¯ä¸ª Pod çš„åå­—ã€ç½‘ç»œ IDã€å­˜å‚¨æŒä¹…åŒ–ä¸å˜</td></tr><tr><td><strong>å­˜å‚¨å·</strong></td><td>é€šå¸¸é…åˆ PVCï¼Œä½† Pod é‡å»ºæ—¶æŒ‚è½½å·å¯èƒ½å˜åŒ–</td><td>é…ç½® <code>volumeClaimTemplates</code>ï¼Œæ¯ä¸ª Pod ç‹¬ç«‹æŒä¹…å·</td></tr><tr><td><strong>æ»šåŠ¨æ›´æ–°ç­–ç•¥</strong></td><td>æ”¯æŒ <code>maxSurge</code>ã€<code>maxUnavailable</code>ï¼Œå¯å¹¶è¡Œæ›´æ–° Pod</td><td>é»˜è®¤ <strong>é€ä¸ªé¡ºåºæ›´æ–°</strong> Podï¼ˆå¯ç”¨ <code>partition</code> æ§åˆ¶åˆ†æ‰¹æ›´æ–°ï¼‰</td></tr><tr><td><strong>å¯ç”¨æ€§</strong></td><td>é€šå¸¸è®¾è®¡ä¸º <strong>æ— çŠ¶æ€å¤šå‰¯æœ¬é«˜å¯ç”¨</strong>ï¼Œä¸ä¿è¯ Pod å¯åŠ¨é¡ºåºæˆ–å›ºå®š IP</td><td><strong>æœ‰çŠ¶æ€ä¸”æœ‰åºéƒ¨ç½²ã€åˆ é™¤ã€æ›´æ–°</strong>ï¼Œé€šå¸¸å•å‰¯æœ¬é€ä¸ªç»´æŠ¤å¯ç”¨æ€§</td></tr><tr><td><strong>æœåŠ¡è®¿é—®</strong></td><td>é€šè¿‡ ClusterIPã€NodePortã€LoadBalancer è®¿é—®</td><td>æ¨èç”¨ <strong>Headless Service (clusterIP: None)</strong>ï¼ŒPod æœ‰å›ºå®š DNS</td></tr><tr><td><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></td><td>Web åº”ç”¨ã€REST APIã€æ— çŠ¶æ€å¾®æœåŠ¡</td><td>æ•°æ®åº“ï¼ˆMySQLã€PostgreSQLï¼‰ã€ç¼“å­˜ï¼ˆRedisï¼‰ã€é˜Ÿåˆ—ï¼ˆKafkaã€RabbitMQï¼‰</td></tr><tr><td><strong>Pod ä¼¸ç¼©ç‰¹æ€§</strong></td><td><strong>çµæ´»ä¼¸ç¼©</strong>ï¼Œå¢åŠ /å‡å°‘å‰¯æœ¬æ— ç‰¹å®šé¡ºåº</td><td><strong>æœ‰åºä¼¸ç¼©</strong>ï¼Œ<code>name-0</code> -&gt; <code>name-1</code> -&gt; <code>name-2</code>â€¦</td></tr><tr><td><strong>é‡å»ºç­–ç•¥</strong></td><td>Pod å´©æºƒåé‡å»ºçš„æ˜¯æ–° Podï¼Œæ— æŒä¹…å­˜å‚¨æ•°æ®å¯èƒ½ä¸¢å¤±</td><td>Pod å´©æºƒåé‡å»ºçš„æ˜¯ç›¸åŒ Pod åå­—ï¼ŒæŒ‚è½½ç›¸åŒ PVCï¼Œä¸ä¸¢æ•°æ®</td></tr></tbody></table><h2 id="åè®°">åè®°</h2><ul class="lvl-0"><li class="lvl-2"><p>StatefulSet ç±»ä¼¼äº Deploymentï¼ŒåŒæ ·æ”¯æŒæ‰©ç¼©å®¹ï¼ˆscale æˆ–è€… hpaï¼‰ï¼Œä½†å› ä¸ºå…¶æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæ‰€ä»¥éœ€è°¨æ…</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scale</span></span><br><span class="line">kubectl scale sts redis-sts --replicas=5 -n sts-ns</span><br><span class="line"></span><br><span class="line"><span class="comment"># hpaï¼Œè¦æ±‚podé…ç½®ä¸­æœ‰èµ„æºé™åˆ¶</span></span><br><span class="line">kubectl autoscale sts redis-sts --name=<span class="string">&quot;hpa-redis&quot;</span> --cpu-percent=50 --min=3 --max=10 -n sts-ns</span><br></pre></td></tr></table></figure><table><thead><tr><th>æ“ä½œ</th><th><strong>å¯è¡Œæ€§</strong></th><th><strong>æ¨èæƒ…å†µ</strong></th></tr></thead><tbody><tr><td><strong>æ‰©å®¹ï¼ˆå¢åŠ å‰¯æœ¬æ•°ï¼‰</strong></td><td>âœ… <strong>æ¨è</strong></td><td>å®‰å…¨ï¼Œæ–°å¢ Pod æŒ‰åºä» N-1 å¼€å§‹åˆ›å»ºï¼ˆ<code>sts-name-0</code> -&gt; <code>sts-name-1</code> -&gt; <code>sts-name-2</code>ï¼‰</td></tr><tr><td><strong>ç¼©å®¹ï¼ˆå‡å°‘å‰¯æœ¬æ•°ï¼‰</strong></td><td>âš ï¸ <strong>å°å¿ƒä½¿ç”¨</strong></td><td>å¯èƒ½å¯¼è‡´ Pod åŠå…¶å…³è” PVC è¢«åºŸå¼ƒï¼Œ<strong>æ•°æ®å¯èƒ½ä¸¢å¤±</strong></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;!--
 **åŠ ç²—**
 *æ–œä½“*
 ***åŠ ç²—å¹¶æ–œä½“***
 ~~åˆ é™¤çº¿~~
 ==çªå‡ºæ˜¾ç¤º==
 `çªå‡ºæ˜¾ç¤º(æ¨è)`
 ++ä¸‹åˆ’çº¿++
 ~ä¸‹æ ‡~
 ^ä¸Šæ ‡^
 è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.
 å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)

 +++ **ç‚¹å‡»æŠ˜å **
 è¿™æ˜¯è¢«éšè—çš„å†…å®¹
 +++

::: tips success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
:::

% note info % success warning danger
è¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹
% endnote %

å¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}
 å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ
 --&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ul class=&quot;lvl-0&quot;&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç» K8S çš„ Statefulset ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/&quot;&gt;K8Så®˜ç½‘&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes&quot;&gt;k8s Github&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li class=&quot;lvl-2&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/&quot;&gt;k8s Statefulset ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://blog.hanqunfeng.com/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="K8S" scheme="https://blog.hanqunfeng.com/tags/K8S/"/>
    
  </entry>
  
</feed>
