<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.hanqunfeng.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"default"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="摘要  本文介绍 Redis 扩展模块 – RediSearch 的使用方法 本文基于redis-7.4.7，springboot-3.5.8 操作系统：Amazon Linux 2023(内核 6.1) Redis官网：https:&#x2F;&#x2F;redis.io&#x2F; Redis 命令文档：https:&#x2F;&#x2F;redis.io&#x2F;docs&#x2F;latest&#x2F;commands&#x2F; RediSearch 的安装参见 Redi">
<meta property="og:type" content="article">
<meta property="og:title" content="RediSearch 开发实战">
<meta property="og:url" content="https://blog.hanqunfeng.com/2026/01/05/redis7-module-RediSearch-study/index.html">
<meta property="og:site_name" content="飘逸峰的博客">
<meta property="og:description" content="摘要  本文介绍 Redis 扩展模块 – RediSearch 的使用方法 本文基于redis-7.4.7，springboot-3.5.8 操作系统：Amazon Linux 2023(内核 6.1) Redis官网：https:&#x2F;&#x2F;redis.io&#x2F; Redis 命令文档：https:&#x2F;&#x2F;redis.io&#x2F;docs&#x2F;latest&#x2F;commands&#x2F; RediSearch 的安装参见 Redi">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2026-01-05T13:30:05.000Z">
<meta property="article:modified_time" content="2026-01-07T07:30:53.062Z">
<meta property="article:author" content="飘逸峰">
<meta property="article:tag" content="redis">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.hanqunfeng.com/2026/01/05/redis7-module-RediSearch-study/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.hanqunfeng.com/2026/01/05/redis7-module-RediSearch-study/","path":"2026/01/05/redis7-module-RediSearch-study/","title":"RediSearch 开发实战"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>RediSearch 开发实战 | 飘逸峰的博客</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GWTEYMZ5M8"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-GWTEYMZ5M8","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?e5cd6c30fc944bddf6ed6ae96edc722b"></script>






<META http-equiv="Pragma" content="no-cache">
<META http-equiv="Cache-Control" content="no-cache">
<META http-equiv="Expire" content="0">

<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="/js-expand/httpToHttps.js"></script>
<meta name="keywords" content="hanqf,hanqunfeng,飘逸峰的博客,Java,Spring,SpringBoot,linux,Mysql">

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><script> let HEXO_MMEDIA_DATA = { js: [], css: [], aplayerData: [], metingData: [], artPlayerData: [], dplayerData: []}; </script><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="飘逸峰的博客" type="application/atom+xml">
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">飘逸峰的博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Spring--Java程序员的春天</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa-solid fa-house fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa-solid fa-table-cells fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa-solid fa-box-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa-solid fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-book"><a href="/book/" rel="section"><i class="fa-solid fa-book fa-fw"></i>资料</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa-solid fa-rss fa-fw"></i>RSS</a></li><li class="menu-item menu-item-hot"><a href="/hot/" rel="section"><i class="fa-solid fa-signal fa-fw"></i>阅读排行榜</a></li><li class="menu-item menu-item-charts"><a href="/charts/" rel="section"><i class="fa-solid fa-chart-bar fa-fw"></i>统计图</a></li><li class="menu-item menu-item-lastmod"><a href="/lastmod/" rel="section"><i class="fa-solid fa-pen-to-square fa-fw"></i>最新更新列表</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

<link rel="stylesheet" href="/calendar/calendar.css">
<script src="/calendar/calendar.js"></script>


<style>
#img_css {
    cursor:pointer;
    width: 100%;
    text-align:center;
    margin: 0 auto;
    padding: 0px 0px 0px 0px;
}



.calendar-ct ul,.calendar-ct ol,.calendar-ct li {
    list-style: none;
    padding: 0;
    margin: 0;
}

#calendarDiv {
    width: 200px;
    margin: 0px auto;
}

#toast{
    padding: 4px;
    width: 800px;
    background-color: rgb(255, 128, 142);
    
    position: fixed;
    z-index: 25;
    display: block;
    left: 0;
    right: 0;
    top: 400px;
    margin: auto;
    white-space: nowrap;
    overflow: hidden;
    border-top-right-radius: 0px;
    border-bottom-right-radius:40px;
    border-bottom-left-radius:0px;
    border-top-left-radius:40px;
}
.titleContent {
    text-decoration:none;
    border-bottom-color:#fff;
    
    color: #fff;
    font-size: 20px;
    margin-left:4px;
}
.titleIco {
    margin-left:40px;
}

.over {
    position: absolute;
    left: 0;
    right: 0;
    top: 0px;
    margin: auto;
}

.month-items {
    padding-left:4px;
}

.have.have2.have3.have4{
    color: #69dbdc!important;
}

.month-now {
    background: none !important;
    padding: 4px 0px 4px 3px; /* 上（top）、右（right）、下（bottom）、左（left） */
    font:  500 14px sans-serif !important;
}

i.xiu {
    position: absolute;
    left: 0;
    top: 0;
    font-size: 8px;
    color: #F43;
    padding: 0 0;
    margin: 0 0;
}
i.ban {
    position: absolute;
    left: 0;
    top: 0;
    font-size: 8px;
    color: #999;
    padding: 0 0;
    margin: 0 0;
}

.xiu-ban {
    font-size: 12px;
}
</style>

<div id="img_css">





<img src="/images_glob/jiaoshijie.jpeg" id="img_910" style="display: none !important;"/>
<img src="/images_glob/9_18.png" id="img_918" style="display: none !important;"/>
<img src="/images_glob/10_1.png" id="img_101" style="display: none !important;"/>
<img src="/images_glob/zhongqiujie.jpg" id="img_zqj" style="display: none !important;"/>
<img src="/images_glob/duanwujie.jpg" id="img_dwj" style="display: none !important;"/>
<img src="/images_glob/yuanxiaojie.jpeg" id="img_yxj" style="display: none !important;"/>
<img src="/images_glob/yuandan.jpeg" id="img_yd" style="display: none !important;"/>
<img src="/images_glob/qingmingjie.jpeg" id="img_qmj" style="display: none !important;"/>
<img src="/images_glob/5_1.jpeg" id="img_51" style="display: none !important;"/>
<img src="/images_glob/9_3.png" id="img_93" style="display: none !important;"/>
<img src="/images_glob/new_year.png" id="img_new_year" style="display: none !important;" />


<img src="/images_glob/2024.png" id="img_year" style="display: none !important;" />




</div>

<div id="calendarDiv">
    <div id="ca" style="margin-bottom: 10px;">
    </div>
</div>


<script type="text/javascript">
    jQuery(function ($) {
	  $('#img_css').click(function(){
                location.href = "/404";
      });

    let date = new Date();
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    console.log(year,month,day);

     // 显示当前年份图片
    $("#img_year").attr("src", "/images_glob/" + year + ".png");
    $("#img_year").show();

    // 阳历节日、纪念日
    // 显示9月3日抗战胜利纪念日图片
    if(month==9 && day==3){
        $("#img_93").show();
    }
    // 显示918图片
    if(month==9 && day==18){
        $("#img_918").show();
    }
    // 显示9月10日教师节图片
    else if(month==9 && day==10){
        $("#img_910").show();
    }
    // 显示10月1日国庆节图片
    else if(month==10 && (day >= 1 && day <= 7)){
        $("#img_101").show();
    }
    // 显示5月1日劳动节图片
    else if(month==5 && (day >= 1 && day <= 5)){
        $("#img_51").show();
    }
    // 显示清明节图片
    else if(month==4 && (day >= 4 && day <= 6)){
        $("#img_qmj").show();
    }
    // 显示元旦图片
    else if(month==1 && day==1){
        $("#img_yd").show();
    }
    // 其它日期不显示任何图片
    else{
        $("#img_93").hide();
        $("#img_918").hide();
        $("#img_910").hide();
        $("#img_101").hide();
        $("#img_qmj").hide();
        $("#img_yd").hide();
        $("#img_51").hide();
    }

    // 农历节日、纪念日
    // 将“初一”“初二”…“十五”映射成数字 1~15
    const dayMap = {
        "初一": 1, "初二": 2, "初三": 3, "初四": 4, "初五": 5,
        "初六": 6, "初七": 7, "初八": 8, "初九": 9, "初十": 10,
        "十一": 11, "十二": 12, "十三": 13, "十四": 14, "十五": 15
    };
    let monthStr = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
    let dayStr = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
    var fulltime = year + "-" + monthStr + "-" + dayStr;
    $.ajax({
        url: 'https://wannianli.hanqunfeng.com/get_data?date='+fulltime,
        type: 'GET',
        async: false,  // 设置 async 参数为 false
        success: function(data) {
            
            
            // 中秋节
            if(data.wnl_nl_month == "八月" && data.wnl_nl_day == "十五"){
                $("#img_zqj").show();
            }
            // 端午节
            else if(data.wnl_nl_month == "五月" && data.wnl_nl_day == "初五"){
                $("#img_dwj").show();
            }
            // 元宵节
            else if(data.wnl_nl_month == "正月" && data.wnl_nl_day == "十五"){
                $("#img_yxj").show();
            }
            // 农历新年
            else if(data.wnl_nl_month == "正月" && (dayMap[data.wnl_nl_day] >=1 && dayMap[data.wnl_nl_day] <=14)){
                $("#img_new_year").show();
            }
            // 其它日期不显示任何图片
            else {
                $("#img_zqj").hide();
                $("#img_dwj").hide();
                $("#img_yxj").hide();
                $("#img_new_year").hide();
            }
        },
        error: function(xhr, status, error) {
            console.error('请求失败:', status, error);
        }
    });



      function coverLayer(tag) {
        var overContainer = $('<div class=over></div>');//蒙层
        with (overContainer) {
            if (tag == 1) {
                appendTo("body");
                css('height', $(document).height());
                css('display', 'block');
                css('opacity', 1);
                css("background-color", "#FFFFFF");
                css("background-color", "rgba(0,0,0,0.7)");  //蒙层透明度
            } else {
                css('display', 'none');

            }
        }

      overContainer.click(function(){
        coverLayer(0);
        $(".over").remove();
        $(".toast").hide(transtime);
        $("#toast").html("");
      });
    }


      //获取当前网址，如： http://localhost:8083/uimcardprj/share/meun.jsp
      var curWwwPath = window.document.location.href;
      //获取主机地址之后的目录，如： uimcardprj/share/meun.jsp
      var pathName = window.document.location.pathname;
      var pos = curWwwPath.indexOf(pathName);
      //获取主机地址，如： http://localhost:8083
      var localhostPaht = curWwwPath.substring(0, pos);
      head = localhostPaht;
      transtime=300; // dong

      function getCountByDate(date,view){
        var dateObj = new Date(date);
        var keytime = dateObj.getFullYear() + "-" + (dateObj.getMonth() + 1);
        
        
        let mycalendarElement = mycalendar[keytime];
        
        let n = 0;
        if(view=="month"){
            if (mycalendarElement && mycalendarElement.length !== undefined) {
                n = mycalendarElement.length;
            }
        }else{
            if (mycalendarElement && mycalendarElement.length !== undefined) {
                for (var i = 0; i < mycalendarElement.length; i++) {
                    let ordertime = mycalendarElement[i]["date"].substring(0, 10);
                    if (date == ordertime) {
                        n++;
                    }
                }
            }
        }
        
        return n;
      }
       // 初始化班休数据
       ban_xiu_data = null;
       // 获取当前时间戳（毫秒级）
       const timestamp = Date.now();
       if(!ban_xiu_data){
          $.ajax({
            url: '/ban_xiu.json?timestamp='+ timestamp,
            type: 'GET',
            async: false,  // 设置 async 参数为 false
            dataType: "json",
            success: function(data) {
                ban_xiu_data = data;
                //console.log(ban_xiu_data)
                //console.log(ban_xiu_data['2021-01-01'])
            },
            error: function(xhr, status, error) {
                console.error('请求失败:', status, error);
            }
        });
       }


       $('#ca').calendar({
        width: 200,
        height: 200,
        onMouseenter: function (view, date, data) {
          

          let year = date.getFullYear();
          let month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
          let day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
          var fulltime = year + "-" + month + "-" + day;
          let n = 0;

          let self = this;

          if (view == "month") {
                n = getCountByDate(fulltime,view);
                if(n>0){
                  $(this).attr('title','创作[' + n + ']篇');
                }else if(n==0){
                  $(this).attr('title','');
                }
            } else {

                let this_title = $(self).attr('title')
                if(this_title){
                    fulltime = this_title.substring(0,10);
                }
                n = getCountByDate(fulltime,view);
                if(n==0){

                    // 发送同步 GET 请求
                    //$.ajax({
                    //    url: 'https://yinli.hanqunfeng.com/lunar?date='+fulltime,
                    //    type: 'GET',
                    //   async: false,  // 设置 async 参数为 false
                    //    success: function(data) {
                    //        
                    //        
                    //        $(self).attr('title',fulltime + "," + '农历[' + data.data.gzYear + '年' + data.data.IMonthCn + data.data.IDayCn + '#' + data.data.Animal + ']');

                    //    },
                    //    error: function(xhr, status, error) {
                    //        console.error('请求失败:', status, error);
                    //    }
                    //});

                    $.ajax({
                        url: 'https://wannianli.hanqunfeng.com/get_data?date='+fulltime,
                        type: 'GET',
                        async: false,  // 设置 async 参数为 false
                        success: function(data) {
                            
                            
                            if(data.wnl_holidays=='None'){
                                $(self).attr('title',fulltime + "," + '农历[' + data.wnl_nl_year  + data.wnl_nl_month + data.wnl_nl_day + '#' + data.wnl_animal_year + ']');
                            }else{
                                $(self).attr('title',fulltime + "[" + data.wnl_holidays + "]" + "," + '农历[' + data.wnl_nl_year  + data.wnl_nl_month + data.wnl_nl_day + '#' + data.wnl_animal_year + ']');
                            }


                        },
                        error: function(xhr, status, error) {
                            console.error('请求失败:', status, error);
                        }
                    });
                }
                else if(n>0){
                  $(this).attr('title',fulltime + "," + '创作[' + n + ']篇->点击查看');
                }


            }
        },
        onSelected: function (view, date, data) {   // 点击事件
            //console.log(view, date, data);
            //if(date == 'Invalid Date'){
              //  date = new Date();
            //}
            //console.log(view, date, data);

            if (view == "month") {
                
                let fullYear = date.getFullYear();
                monthTag(fullYear, date.getMonth() + 1);
            } else {
                let year = date.getFullYear();
                let month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                let day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                var fulltime = year + "-" + month + "-" + day;
                var keytime = year + "-" + (date.getMonth() + 1);
                let mycalendarElement = mycalendar[keytime];
                $(".toast").hide(transtime);
                $("#toast").html("");

                coverLayer(0);
                $(".over").remove();

                //创建一个空数组，用于存放有文章的日期
                let mycalendar_ordertimes = [];

                let n = 0;
                if (mycalendarElement && mycalendarElement.length !== undefined) {
                    for (var i = 0; i < mycalendarElement.length; i++) {
                        let ordertime = mycalendarElement[i]["date"].substring(0, 10);
                        //将ordertime添加到mycalendar_ordertimes数组中
                        mycalendar_ordertimes.push(ordertime);

                        if (fulltime == ordertime) {
                            n++;
                            if(n==1){
                            coverLayer(1);
                            autoWidth();
                            $(".toast").show(transtime);
                            }
                            

                            var title = mycalendarElement[i]["title"];
                            var link = head + mycalendarElement[i]["link"];
                            $("#toast").append('<i class="fas fa-circle titleIco"></i> <a class="titleContent"' + 'href="' + link + '">' + title + '</a><br/>');
                            
                        }
                    }
                }
                n = 0;

                //判断mycalendar_ordertimes数组中是否包含fulltime，不包含就打开万年历页面
                if(mycalendar_ordertimes.indexOf(fulltime) == -1){
                    window.open("https://www.wnl.cc/"+year+"/"+month+day+".html", "_new");
                }
            }
        }
    });
    });

    function autoWidth(){
      var windowWidth = $(document).width();
      if(windowWidth <= 1000){
        $(".toast").css('width','80%');
      }
    }

    function resolveyear() { // 准备数据
        var currentyear = getCurrentyear();
        var currentmonth = getCurrentmonth();
        
        gblmonth = currentmonth;
        if (currentmonth == 13) { // 首次加载，需要延时
            setCurrentmonth(1); // 首次以后不延时直接执行
            setTimeout(function () {
                $("#ca").append('<div id="toast" class="toast"></div>');
                $(".toast").hide();
                if (mycalendar) {
                    monthTag(currentyear);
                } else {
                    
                }
            }, 2000);
        } else {
            monthTag(currentyear, null);
        }
    }

    // 对月份进行设置，json文件中存在的才显示
    function monthTag(currentyear, date) {
        

        // 此处对当前月份下的日子进行匹配
        if (date) {
            var month = date;
        } else {
            var currentData = new Date();
            var month = currentData.getMonth() + 1;
        }

        removeHaveClass();
        // debugger;
        var flag = true;
        var mycalValue = new Array()
        for (let i = 1; i <= 12; i++) {
            if (mycalendar[currentyear + "-" + i]) {
                
                addHaveClass(i);


                if (flag) { // 只在内部循环一次，当前页的数据后就不再管了
                    flag = false;
                    if (mycalendar[currentyear + "-" + month]) {
                        for (var j = 0; j < mycalendar[currentyear + "-" + month].length; j++) {
                            var pagedata = mycalendar[currentyear + "-" + month][j];
                            var needdate = pagedata["date"].substring(8, 10);
                            if (needdate < 10) {
                                needdate = needdate.replace(0, "");
                            }
                            mycalValue[j] = needdate; // 存到一个数组中备用
                            
                        }
                    }
                }
            }
        }
        
        resolveday(month, mycalValue, currentyear);
    }

    function formatDate(year, month, day) {
        // 检查 month 是否为 1
        if (month < 10) {
            month = "0" + month;
        }
        // 检查 day 是否为 1
        if (day < 10) {
            day = "0" + day;
        }
        // 返回格式化后的日期
        
        return year + "-" + month + "-" + day;
    }


    // 对月份下的日期进行渲染
    function resolveday(month, mycalValue, currentyear) {
        $(".toast").hide("transtime");

        var precurrentyear=currentyear;
        var nextcurrentyear=currentyear;
        
        //当前月份及之后的月份都是 undefined
        if(month === undefined){
            //这里只初始化了当前月份，之后的月份还是不能初始化，就会导致后面获取不到对应的 $("#cal" + month) 对象
            month = new Date().getMonth()+1;
        }
        var preMonth = month - 1 > 0 ? month - 1 : 12;
        var nextMonth = month + 1 > 12 ? 1 : month + 1;
        if (preMonth==12) {
            precurrentyear = currentyear - 1;
        }
        if(nextMonth==1){
            nextcurrentyear = currentyear + 1;
        }
        

        let attr = $("#cal" + month).children("li");

        // if (preMonth != 1 && nextMonth != 1) { // 没有年份的跳跃
            var prevalue =judgeMonth(precurrentyear,preMonth); // 前一个月存在的数据
            var nextvalue =judgeMonth(nextcurrentyear,nextMonth); // 后一个月存在的数据
            jQuery.each(attr, function () {
                let emptclass = jQuery(this).attr("class");
                //console.log("emptclass",emptclass);
                if (emptclass) {
                    if(emptclass=="old"){ // 前一个月的数据
                     var dayVal = jQuery(this).text().replace("休", "").replace("班", "");
                     if (prevalue.indexOf(dayVal) > -1) { // 存在于数组之中,给当天的日期加一个样式
                         jQuery(this).css("color","#FF808E");
                     }
                     dateStr = formatDate(precurrentyear,preMonth,dayVal);
                     jQuery(this).attr('title',dateStr);

                     if(ban_xiu_data){
                        if(ban_xiu_data[dateStr] == '班'){
                            if(jQuery(this).find('i').length == 0){
                                jQuery(this).addClass('xiu-ban');
                                jQuery(this).prepend('<i class="ban">班</i>');
                            }
                        }
                        if(ban_xiu_data[dateStr] == '休'){
                            if(jQuery(this).find('i').length == 0){
                                jQuery(this).addClass('xiu-ban');
                                jQuery(this).prepend('<i class="xiu">休</i>');
                            }
                        }
                    }

                 } else if(emptclass=="new"){
                    var dayVal = jQuery(this).text().replace("休", "").replace("班", "");
                    if (nextvalue.indexOf(dayVal) > -1) { // 存在于数组之中,给当天的日期加一个样式
                        jQuery(this).css("color","#FF808E");
                    }
                    dateStr = formatDate(nextcurrentyear,nextMonth,dayVal);
                    jQuery(this).attr('title',dateStr);

                    if(ban_xiu_data){
                        if(ban_xiu_data[dateStr] == '班'){
                            if(jQuery(this).find('i').length == 0){
                                jQuery(this).addClass('xiu-ban');
                                jQuery(this).prepend('<i class="ban">班</i>');
                            }
                        }
                        if(ban_xiu_data[dateStr] == '休'){
                            if(jQuery(this).find('i').length == 0){
                                jQuery(this).addClass('xiu-ban');
                                jQuery(this).prepend('<i class="xiu">休</i>');
                            }
                        }
                    }

                 }else if(emptclass.includes("now")){
                    var dayVal = jQuery(this).text().replace("休", "").replace("班", "");
                    if (mycalValue.indexOf(dayVal) > -1) { // 存在于数组之中,给当天的日期加一个样式
                        jQuery(this).css("color","#0088FF");
                    }
                    //console.log(currentyear,month,dayVal)
                    dateStr = formatDate(currentyear,month,dayVal);

                    jQuery(this).attr('title',dateStr);

                    if(ban_xiu_data){
                        if(ban_xiu_data[dateStr] == '班'){
                            if(jQuery(this).find('i').length == 0){
                                jQuery(this).addClass('xiu-ban');
                                jQuery(this).prepend('<i class="ban">班</i>');
                            }
                        }
                        if(ban_xiu_data[dateStr] == '休'){
                            if(jQuery(this).find('i').length == 0){
                                jQuery(this).addClass('xiu-ban');
                                jQuery(this).prepend('<i class="xiu">休</i>');
                            }
                        }
                    }

                 }

                }else {
                    var dayVal = jQuery(this).text().replace("休", "").replace("班", "");
                    if (mycalValue.indexOf(dayVal) > -1) { // 存在于数组之中,给当天的日期加一个样式
                        jQuery(this).css("color","#FF808E");
                    }
                    dateStr = formatDate(currentyear,month,dayVal);
                    //console.log(dateStr);
                    jQuery(this).attr('title',dateStr);
                    if(ban_xiu_data){
                        if(ban_xiu_data[dateStr] == '班'){
                            if(jQuery(this).find('i').length == 0){
                                jQuery(this).addClass('xiu-ban');
                                jQuery(this).prepend('<i class="ban">班</i>');
                            }
                        }
                        if(ban_xiu_data[dateStr] == '休'){
                            if(jQuery(this).find('i').length == 0){
                                jQuery(this).addClass('xiu-ban');
                                jQuery(this).prepend('<i class="xiu">休</i>');
                            }
                        }
                    }

                }
            });
        // }
    }

    function judgeMonth(currentyear,month) { // 解析当前年份与月份中存在的文章
        
        var Value = new Array();
        if (mycalendar[currentyear + "-" + month]) {
            for (var j = 0; j < mycalendar[currentyear + "-" + month].length; j++) {
                var pagedata = mycalendar[currentyear + "-" + month][j];
                var needdate = pagedata["date"].substring(8, 10);
                if (needdate < 10) {
                    needdate = needdate.replace(0, "");
                }
                Value[j] = needdate; // 存到一个数组中备用
            }
        }
        
        return Value;
    }

    // 相对当前月份的上一月与下一月判断解析
    function nextMonth() {
        $(".toast").hide("transtime");
        monthTag(getCurrentyear(), getCurrentmonth());
    }

    function preMonth() {
        $(".toast").hide("transtime");
        monthTag(getCurrentyear(), getCurrentmonth());
    }

    function retuenday() {
        if (mycalendar) {
            monthTag(getCurrentyear(), getCurrentmonth());
        }
    }

    // 日历控件自适应窗口大小
      var tid;
      var refreshRem = function () {
        var windowWidth = $(document).width();
        if (windowWidth >= 992) {
            $('#calendarDiv').show();
        } else {
            $('#calendarDiv').hide();
        }
      };
      addEventListener('resize', function () {
               clearTimeout(tid);
               tid = setTimeout(refreshRem, 300);
           }, false);
      addEventListener('pageshow', function (e) {
               if (e.persisted) {
                   clearTimeout(tid);
                   tid = setTimeout(refreshRem, 300);
               }
           }, false);
      refreshRem();

</script>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%91%98%E8%A6%81"><span class="nav-number">1.</span> <span class="nav-text">摘要</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RediSearch-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">RediSearch 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E7%B4%A2%E5%BC%95%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86%E7%B1%BB"><span class="nav-number">2.1.</span> <span class="nav-text">一、索引生命周期管理类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%B8%8F%E2%83%A3-FT-CREATE"><span class="nav-number">2.1.1.</span> <span class="nav-text">1️⃣ FT.CREATE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%B8%8F%E2%83%A3-FT-ALTER"><span class="nav-number">2.1.2.</span> <span class="nav-text">2️⃣ FT.ALTER</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%B8%8F%E2%83%A3-FT-DROPINDEX"><span class="nav-number">2.1.3.</span> <span class="nav-text">3️⃣ FT.DROPINDEX</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%B8%8F%E2%83%A3-FT-INFO"><span class="nav-number">2.1.4.</span> <span class="nav-text">4️⃣ FT.INFO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%EF%B8%8F%E2%83%A3-FT-LIST"><span class="nav-number">2.1.5.</span> <span class="nav-text">5️⃣ FT._LIST</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%9F%A5%E8%AF%A2%E7%B1%BB%EF%BC%88%E6%A0%B8%E5%BF%83%EF%BC%89"><span class="nav-number">2.2.</span> <span class="nav-text">二、查询类（核心）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%B8%8F%E2%83%A3-FT-SEARCH"><span class="nav-number">2.2.1.</span> <span class="nav-text">1️⃣ FT.SEARCH</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SQL-WHERE-%E4%B8%8E-RediSearch-%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95%E5%AF%B9%E7%85%A7%E8%A1%A8"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">SQL WHERE 与 RediSearch 查询语法对照表</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%B8%8F%E2%83%A3-FT-AGGREGATE"><span class="nav-number">2.2.2.</span> <span class="nav-text">2️⃣ FT.AGGREGATE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%B8%8F%E2%83%A3-FT-EXPLAIN-FT-EXPLAINCLI"><span class="nav-number">2.2.3.</span> <span class="nav-text">3️⃣ FT.EXPLAIN&#x2F;FT.EXPLAINCLI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%B8%8F%E2%83%A3-FT-PROFILE"><span class="nav-number">2.2.4.</span> <span class="nav-text">4️⃣ FT.PROFILE</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B3%E6%B3%A8%E6%8C%87%E6%A0%87"><span class="nav-number">2.2.4.1.</span> <span class="nav-text">关注指标</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%88%AB%E5%90%8D%E7%AE%A1%E7%90%86%EF%BC%88%E7%94%9F%E4%BA%A7%E5%BF%85%E5%A4%87%EF%BC%89"><span class="nav-number">2.3.</span> <span class="nav-text">三、别名管理（生产必备）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%88%AB%E5%90%8D%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BB%B7%E5%80%BC"><span class="nav-number">2.3.1.</span> <span class="nav-text">索引别名的核心价值</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%B8%B8%E6%A0%87%EF%BC%88%E5%A4%A7%E7%BB%93%E6%9E%9C%E9%9B%86%EF%BC%89"><span class="nav-number">2.4.</span> <span class="nav-text">四、游标（大结果集）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E8%AF%8D%E5%85%B8-%E5%90%8C%E4%B9%89%E8%AF%8D%EF%BC%88%E6%90%9C%E7%B4%A2%E5%A2%9E%E5%BC%BA%EF%BC%89"><span class="nav-number">2.5.</span> <span class="nav-text">五、词典 &amp; 同义词（搜索增强）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%8D%E5%85%B8"><span class="nav-number">2.5.1.</span> <span class="nav-text">词典</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8C%E4%B9%89%E8%AF%8D"><span class="nav-number">2.5.2.</span> <span class="nav-text">同义词</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AD%E3%80%81FT-SPELLCHECK%EF%BC%88%E6%8B%BC%E5%86%99%E7%BA%A0%E9%94%99%EF%BC%89"><span class="nav-number">2.6.</span> <span class="nav-text">六、FT.SPELLCHECK（拼写纠错）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%B2%E5%BA%9F%E5%BC%83%E5%91%BD%E4%BB%A4%EF%BC%88%E4%B8%8D%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8%EF%BC%89"><span class="nav-number">2.7.</span> <span class="nav-text">已废弃命令（不建议使用）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#FT-CONFIG-GET-%E5%92%8C-CONFIG-GET-search-%E5%AF%B9%E5%BA%94%E5%8F%82%E6%95%B0%E6%95%B4%E7%90%86"><span class="nav-number">2.7.1.</span> <span class="nav-text">FT.CONFIG GET * 和 CONFIG GET search-* 对应参数整理</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="飘逸峰"
      src="/uploads/me.png">
  <p class="site-author-name" itemprop="name">飘逸峰</p>
  <div class="site-description" itemprop="description">分享成长与快乐的地方</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">279</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">52</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags">
        <span class="site-state-item-count">58</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/13320506/qunfeng-han" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;13320506&#x2F;qunfeng-han" rel="noopener me" target="_blank"><i class="fa-brands fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/hanqunfeng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hanqunfeng" rel="noopener me" target="_blank"><i class="fa-brands fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/hanqunfeng/" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;hanqunfeng&#x2F;" rel="noopener me" target="_blank"><i class="fa-brands fa-git fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://hanqunfeng.coding.net/" title="Coding → https:&#x2F;&#x2F;hanqunfeng.coding.net" rel="noopener me" target="_blank"><i class="fa-solid fa-code fa-fw"></i>Coding</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>
<div class="toBottom">
<i class="fa-solid fa-circle-arrow-down" aria-hidden="true"></i>
直达底部
<i class="fa-solid fa-circle-arrow-down" aria-hidden="true"></i>
</div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa-solid fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="http://tongji.baidu.com/web/welcome/login" title="http:&#x2F;&#x2F;tongji.baidu.com&#x2F;web&#x2F;welcome&#x2F;login" rel="noopener" target="_blank">百度统计</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://zhanzhang.baidu.com/" title="http:&#x2F;&#x2F;zhanzhang.baidu.com" rel="noopener" target="_blank">百度站长</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://search.google.com/search-console" title="https:&#x2F;&#x2F;search.google.com&#x2F;search-console" rel="noopener" target="_blank">Google Search Console</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://www.aliyun.com/" title="https:&#x2F;&#x2F;www.aliyun.com" rel="noopener" target="_blank">阿里云</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://leancloud.cn/" title="https:&#x2F;&#x2F;leancloud.cn" rel="noopener" target="_blank">Leancloud</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://www.fontawesome.com.cn/faicons/" title="http:&#x2F;&#x2F;www.fontawesome.com.cn&#x2F;faicons&#x2F;" rel="noopener" target="_blank">FontAwsome</a>
            </li>
        </ul>
      </div>
    </div>
        <div class="sidebar-inner sidebar-post-related">
          <div class="animated">
              <div class="links-of-blogroll-title"><i class="fa-solid fa-signs-post fa-fw"></i>
    相关文章
  </div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2025/12/26/redis7-module-RediSearch/" rel="bookmark">
        <time class="popular-posts-time">2025-12-26</time>
        <br>
      Redis 扩展模块 -- RediSearch 的安装方法
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2024/03/07/mongodb7-springboot-aggregate/" rel="bookmark">
        <time class="popular-posts-time">2024-03-07</time>
        <br>
      MongoDB7.0--SpringBoot聚合操作
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2025/12/16/redis7-datatype-06-zset/" rel="bookmark">
        <time class="popular-posts-time">2025-12-16</time>
        <br>
      Redis 命令及数据类型 -- ZSet
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2025/12/15/redis7-datatype-03-hash/" rel="bookmark">
        <time class="popular-posts-time">2025-12-15</time>
        <br>
      Redis 命令及数据类型 -- Hash
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2026/01/06/redis7-datatype-17-AutoSuggest/" rel="bookmark">
        <time class="popular-posts-time">2026-01-06</time>
        <br>
      Redis 命令及数据类型 -- AutoSuggest
      </a>
    </li>
  </ul>

          </div>
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.hanqunfeng.com/2026/01/05/redis7-module-RediSearch-study/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/me.png">
      <meta itemprop="name" content="飘逸峰">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飘逸峰的博客">
      <meta itemprop="description" content="分享成长与快乐的地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="RediSearch 开发实战 | 飘逸峰的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RediSearch 开发实战
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-05 21:30:05" itemprop="dateCreated datePublished" datetime="2026-01-05T21:30:05+08:00">2026-01-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-07 15:30:53" itemprop="dateModified" datetime="2026-01-07T15:30:53+08:00">2026-01-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a>
        </span>
    </span>

  
  
<!-- 置顶，精品 -->
    <span class="post-meta-item">
    <span>
    <span class="post-meta-item-icon">
      <i class="fa-solid fa-thumbtack zhidingtop">置顶</i>
    </span>
    <span class="post-meta-item">
    <span>
    <span class="post-meta-item-icon">
            <i class="fa-regular fa-newspaper jingping">精品</i>
    </span>


    <span class="post-meta-break"></span>

</div>


    <span id="/2026/01/05/redis7-module-RediSearch-study/" class="leancloud_visitors" data-flag-title="RediSearch 开发实战" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>32 分钟</span>
    </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="摘要">摘要</h2>
<ul class="lvl-0">
<li class="lvl-2">本文介绍 Redis 扩展模块 – RediSearch 的使用方法</li>
<li class="lvl-2">本文基于<code>redis-7.4.7</code>，<code>springboot-3.5.8</code></li>
<li class="lvl-2">操作系统：<code>Amazon Linux 2023(内核 6.1)</code></li>
<li class="lvl-2">Redis官网：<a target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/</a></li>
<li class="lvl-2">Redis 命令文档：<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/commands/">https://redis.io/docs/latest/commands/</a></li>
<li class="lvl-2">RediSearch 的安装参见 <a href="/2025/12/26/redis7-module-RediSearch/" title="Redis 扩展模块 -- RediSearch 的安装方法">Redis 扩展模块 -- RediSearch 的安装方法</a></li>
<li class="lvl-2">示例代码：<a target="_blank" rel="noopener" href="https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo">GitHub</a></li>
</ul>
<span id="more"></span>
<h2 id="RediSearch-命令">RediSearch 命令</h2>
<ul class="lvl-0">
<li class="lvl-2">
<p>为了展示命令的使用方法，这里以JSON文档进行索引，初始化数据如下：</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">JSON.SET user:10001 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Alice Bob&quot;,&quot;age&quot;:28,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:199.99,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:59.9,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a phone&quot;,&quot;items&quot;:[&quot;SpringCloud技术指南&quot;,&quot;Shell脚本基础&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10002 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Bob Frank&quot;,&quot;age&quot;:35,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:899.0,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a iphone&quot;,&quot;items&quot;:[&quot;Linux必知必会&quot;,&quot;Java多线程详解&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10003 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Carol&quot;,&quot;age&quot;:22,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:19.9,&quot;status&quot;:&quot;CANCELLED&quot;&#125;],&quot;comment&quot;: &quot;I have a mobile&quot;,&quot;items&quot;:[&quot;MySQL从删库到跑路&quot;,&quot;Oracle开发实践&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10004 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;David Bob&quot;,&quot;age&quot;:41,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:1200,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:300,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a car&quot;,&quot;items&quot;:[&quot;Spring技术指南&quot;,&quot;RocketMQ由浅入深&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10005 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Eve&quot;,&quot;age&quot;:30,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:88.8,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a pencil&quot;,&quot;items&quot;:[&quot;Kafka从零开始&quot;,&quot;Java由浅入深&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10006 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Frank&quot;,&quot;age&quot;:27,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:499,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:129,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a phone&quot;,&quot;items&quot;:[&quot;Redis开发实战&quot;,&quot;MongoDB从入门到实战&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10007 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Grace&quot;,&quot;age&quot;:33,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:999.9,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a book&quot;,&quot;items&quot;:[&quot;Android开发手册&quot;,&quot;Gradle从零开始&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10008 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Henry&quot;,&quot;age&quot;:45,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:59.9,&quot;status&quot;:&quot;CANCELLED&quot;&#125;],&quot;comment&quot;: &quot;I have a macbook&quot;,&quot;items&quot;:[&quot;SpringBoot技术指南&quot;,&quot;Maven由浅入深&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10009 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Ivy&quot;,&quot;age&quot;:26,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:299,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:199,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a watch&quot;,&quot;items&quot;:[&quot;Spring融会贵通&quot;,&quot;Java技术开发指南&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">JSON.SET user:10010 $ <span class="string">&#x27;&#123;&quot;name&quot;:&quot;Jack&quot;,&quot;age&quot;:38,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:150,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a apple&quot;,&quot;items&quot;:[&quot;Spring技术指南&quot;,&quot;Java由浅入深&quot;]&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>SpringBoot暂时没有支持 RediSearch ，你可以编写Lua脚本来实现相应的功能，另外 <a target="_blank" rel="noopener" href="https://redisson.pro/docs/data-and-services/services/#redisearch-service">Redisson</a>已经提供了对 RediSearch 的支持，下面结合命令给出代码示例。</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 Redisson ，这里要注意，现在最新版是 4.0.0，需要 springboot 4.x --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.52.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>通用代码</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line"><span class="type">RSearch</span> <span class="variable">rSearch</span> <span class="operator">=</span> redissonClient.getSearch(StringCodec.INSTANCE);</span><br></pre></td></tr></table></figure>
<h3 id="一、索引生命周期管理类">一、索引生命周期管理类</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
<th>核心参数</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FT.CREATE</code></td>
<td>创建索引</td>
<td>索引名、ON、PREFIX、SCHEMA</td>
<td>见下</td>
</tr>
<tr>
<td><code>FT.ALTER</code></td>
<td>给已有索引新增字段</td>
<td>索引名、SCHEMA ADD</td>
<td>见下</td>
</tr>
<tr>
<td><code>FT.DROPINDEX</code></td>
<td>删除索引</td>
<td>索引名、DD</td>
<td>见下</td>
</tr>
<tr>
<td><code>FT.INFO</code></td>
<td>查看索引信息</td>
<td>索引名</td>
<td>见下</td>
</tr>
<tr>
<td><code>FT._LIST</code></td>
<td>列出所有索引</td>
<td>无</td>
<td>见下</td>
</tr>
</tbody>
</table>
<h4 id="1️⃣-FT-CREATE">1️⃣ FT.CREATE</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>FT.CREATE 基本语法</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FT.CREATE index_name</span><br><span class="line">[ON HASH | JSON]</span><br><span class="line">[PREFIX count prefix ...]</span><br><span class="line">[FILTER filter]</span><br><span class="line">[LANGUAGE default_lang]</span><br><span class="line">[LANGUAGE_FIELD lang_attribute]</span><br><span class="line">[SCORE default_score]</span><br><span class="line">[SCORE_FIELD score_attribute]</span><br><span class="line">[PAYLOAD_FIELD payload_attribute]</span><br><span class="line">[MAXTEXTFIELDS]</span><br><span class="line">[TEMPORARY seconds]</span><br><span class="line">[NOOFFSETS] [NOHL] [NOFIELDS] [NOFREQS]</span><br><span class="line">[STOPWORDS count stopword ...]</span><br><span class="line">[SKIPINITIALSCAN]</span><br><span class="line">SCHEMA</span><br><span class="line">  field_name [AS <span class="built_in">alias</span>] TEXT | TAG | NUMERIC | GEO | VECTOR</span><br><span class="line">  [SORTABLE [UNF]]</span><br><span class="line">  [NOINDEX]</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>FT.CREATE 参数说明表</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>index_name</code></td>
<td>索引名称</td>
</tr>
<tr>
<td><code>ON HASH | JSON</code></td>
<td>指定索引数据来源类型，默认 <code>HASH</code></td>
</tr>
<tr>
<td><code>PREFIX count prefix...</code></td>
<td>指定索引 Key 前缀</td>
</tr>
<tr>
<td><code>FILTER filter</code></td>
<td>对索引数据设置过滤表达式</td>
</tr>
<tr>
<td><code>LANGUAGE</code></td>
<td>指定默认分词语言（默认 english，中文是 chinese）</td>
</tr>
<tr>
<td><code>LANGUAGE_FIELD</code></td>
<td>指定文档中的语言字段</td>
</tr>
<tr>
<td><code>SCORE</code></td>
<td>设置文档默认评分</td>
</tr>
<tr>
<td><code>SCORE_FIELD</code></td>
<td>从字段中读取评分</td>
</tr>
<tr>
<td><code>PAYLOAD_FIELD</code></td>
<td>指定存储的二进制负载字段</td>
</tr>
<tr>
<td><code>MAXTEXTFIELDS</code></td>
<td>允许更多 TEXT 字段（消耗更多内存）</td>
</tr>
<tr>
<td><code>TEMPORARY seconds</code></td>
<td>创建临时索引，超时后自动删除</td>
</tr>
<tr>
<td><code>NOOFFSETS</code></td>
<td>不存储文本偏移量（节省内存）</td>
</tr>
<tr>
<td><code>NOHL</code></td>
<td>禁用高亮</td>
</tr>
<tr>
<td><code>NOFIELDS</code></td>
<td>不保存字段内容</td>
</tr>
<tr>
<td><code>NOFREQS</code></td>
<td>不保存词频信息</td>
</tr>
<tr>
<td><code>STOPWORDS count ...</code></td>
<td>指定停用词</td>
</tr>
<tr>
<td><code>SKIPINITIALSCAN</code></td>
<td>创建索引时不扫描已有数据</td>
</tr>
<tr>
<td><code>SCHEMA</code></td>
<td>索引字段定义起始</td>
</tr>
<tr>
<td><code>AS alias</code></td>
<td>字段别名</td>
</tr>
<tr>
<td><code>TEXT</code></td>
<td>全文索引字段</td>
</tr>
<tr>
<td><code>TAG</code></td>
<td>精确匹配字段</td>
</tr>
<tr>
<td><code>NUMERIC</code></td>
<td>数值字段</td>
</tr>
<tr>
<td><code>GEO</code></td>
<td>地理位置字段</td>
</tr>
<tr>
<td><code>VECTOR</code></td>
<td>向量字段</td>
</tr>
<tr>
<td><code>SORTABLE</code></td>
<td>允许排序</td>
</tr>
<tr>
<td><code>UNF</code></td>
<td>不规范化排序</td>
</tr>
<tr>
<td><code>NOINDEX</code></td>
<td>字段不参与索引</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>FT.CREATE 的核心语法</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FT.CREATE &lt;index&gt;</span><br><span class="line">[ON HASH | JSON]</span><br><span class="line">[PREFIX count prefix ...]</span><br><span class="line">[LANGUAGE default_lang]</span><br><span class="line">SCHEMA</span><br><span class="line">  field_name [AS <span class="built_in">alias</span>] TEXT | TAG | NUMERIC | GEO | VECTOR</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>创建索引示例</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">FT.CREATE idx:user</span><br><span class="line">  ON JSON</span><br><span class="line">  PREFIX 1 user:</span><br><span class="line">  LANGUAGE chinese</span><br><span class="line">  SCHEMA</span><br><span class="line">    $.name AS name TEXT</span><br><span class="line">    $.age AS age NUMERIC SORTABLE</span><br><span class="line">    $.orders[*].amount AS amount NUMERIC</span><br><span class="line">    $.orders[*].status AS status TAG</span><br><span class="line">    $.comment AS comment TEXT</span><br><span class="line">    $.items[*] AS items TEXT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数说明</span></span><br><span class="line">  <span class="comment"># idx:user：索引名</span></span><br><span class="line">  <span class="comment"># ON JSON：索引 JSON 文档，RediSearch 仅支持对 HASH 和 JSON 进行索引</span></span><br><span class="line">  <span class="comment"># PREFIX 1 user: ：索引指定 key 前缀，1 表示索引一个，user: 表示索引的 key 前缀，如果索引两个：PREFIX 2 user: order:</span></span><br><span class="line">  <span class="comment"># LANGUAGE chinese：指定默认分词语言，默认是英文 english，中文是 chinese，如果索引中有中文，则必须指定 LANGUAGE 为 chinese</span></span><br><span class="line">  <span class="comment"># SCHEMA：索引字段</span></span><br><span class="line">  <span class="comment"># $.name AS name TEXT：索引字段 $.name(注意：JSON类型以 $. 开头，Hash类型就不需要了)，字段别名为 name，字段类型为 TEXT</span></span><br><span class="line">  <span class="comment"># AS：字段别名（查询时使用）</span></span><br><span class="line">  <span class="comment"># TEXT / NUMERIC / TAG：字段类型，这几个是最常用的</span></span><br><span class="line">  <span class="comment"># SORTABLE：NUMERIC、TAG、TEXT 或 GEO 类型的字段可以带有一个可选的 SORTABLE 参数，表示为字段建立专门的排序数据结构（类似列式存储），从而避免在查询阶段对大量结果进行临时排序。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rSearch.createIndex(</span><br><span class="line">    <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">    IndexOptions.defaults()</span><br><span class="line">            .on(IndexType.JSON)</span><br><span class="line">            .prefix(List.of(<span class="string">&quot;user:&quot;</span>))</span><br><span class="line">            .language(<span class="string">&quot;chinese&quot;</span>),</span><br><span class="line">    FieldIndex.text(<span class="string">&quot;$.name&quot;</span>).as(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">    FieldIndex.numeric(<span class="string">&quot;$.age&quot;</span>).as(<span class="string">&quot;age&quot;</span>),</span><br><span class="line">    FieldIndex.numeric(<span class="string">&quot;$.orders[*].amount&quot;</span>).as(<span class="string">&quot;amount&quot;</span>),</span><br><span class="line">    FieldIndex.tag(<span class="string">&quot;$.orders[*].status&quot;</span>).as(<span class="string">&quot;status&quot;</span>),</span><br><span class="line">    FieldIndex.text(<span class="string">&quot;$.comment&quot;</span>).as(<span class="string">&quot;comment&quot;</span>),</span><br><span class="line">    FieldIndex.text(<span class="string">&quot;$.items[*]&quot;</span>).as(<span class="string">&quot;items&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>索引字段的类型</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>字段类型</th>
<th>中文名称</th>
<th>功能说明</th>
<th>典型使用场景</th>
<th>备注 / 限制</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>TEXT</strong></td>
<td>全文文本字段</td>
<td>支持对字段值进行全文检索（分词、相关度计算、模糊匹配等）</td>
<td>文章内容、用户名、描述信息</td>
<td>支持权重（WEIGHT）、排序（SORTABLE）等选项</td>
</tr>
<tr>
<td><strong>TAG</strong></td>
<td>标签字段 / 精确匹配字段</td>
<td>支持精确匹配查询，适用于枚举值或离散分类</td>
<td>分类、状态、主键、类型字段</td>
<td>不分词；可自定义分隔符</td>
</tr>
<tr>
<td><strong>NUMERIC</strong></td>
<td>数值字段</td>
<td>支持数值范围查询</td>
<td>年龄、价格、分数、时间戳</td>
<td>支持区间查询（<code>[min max]</code>）</td>
</tr>
<tr>
<td><strong>GEO</strong></td>
<td>地理位置字段（点）</td>
<td>支持以“点”为中心的半径范围查询</td>
<td>门店位置、用户位置</td>
<td>值格式必须为 <code>&quot;经度,纬度&quot;</code></td>
</tr>
<tr>
<td><strong>VECTOR</strong></td>
<td>向量字段</td>
<td>支持向量相似度搜索（KNN 等）</td>
<td>语义搜索、推荐系统、Embedding 向量</td>
<td>需要 <strong>Query Dialect ≥ 2</strong>（RediSearch ≥ 2.4）</td>
</tr>
<tr>
<td><strong>GEOSHAPE</strong></td>
<td>地理形状字段（多边形）</td>
<td>支持多边形空间查询</td>
<td>行政区、商圈、地图区域</td>
<td>使用 WKT 格式；不支持 JSON 多值和 SORTABLE</td>
</tr>
</tbody>
</table>
<blockquote>
<p>GEOSHAPE 字段补充说明</p>
</blockquote>
<table>
<thead>
<tr>
<th>项目</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据格式</td>
<td>WKT（Well-Known Text）格式，如：<code>POLYGON((x1 y1, x2 y2, ...))</code></td>
</tr>
<tr>
<td>坐标系统</td>
<td><code>SPHERICAL</code>（球面坐标，经纬度）<br><code>FLAT</code>（平面坐标，笛卡尔 X/Y）</td>
</tr>
<tr>
<td>默认坐标系统</td>
<td><code>SPHERICAL</code></td>
</tr>
<tr>
<td>当前限制</td>
<td>❌ 不支持 JSON 多值<br>❌ 不支持 <code>SORTABLE</code> 选项</td>
</tr>
</tbody>
</table>
<blockquote>
<p>索引字段类型选型建议</p>
</blockquote>
<table>
<thead>
<tr>
<th>使用场景</th>
<th>推荐字段类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>全文检索</td>
<td><strong>TEXT</strong></td>
<td>支持分词、相关度计算、模糊匹配等全文搜索能力</td>
</tr>
<tr>
<td>精确过滤 / 分类</td>
<td><strong>TAG</strong></td>
<td>精确匹配，不分词，适合枚举值、状态、类型等字段</td>
</tr>
<tr>
<td>区间筛选 / 排序</td>
<td><strong>NUMERIC</strong></td>
<td>支持数值区间查询与排序，适合价格、时间、分数等</td>
</tr>
<tr>
<td>附近的人 / 门店</td>
<td><strong>GEO</strong></td>
<td>基于经纬度点进行半径范围查询</td>
</tr>
<tr>
<td>语义搜索 / 向量召回</td>
<td><strong>VECTOR</strong></td>
<td>基于向量相似度（KNN）的语义搜索，需要 Dialect ≥ 2</td>
</tr>
<tr>
<td>复杂地理区域判断</td>
<td><strong>GEOSHAPE</strong></td>
<td>支持多边形（Polygon）区域查询，适合行政区、商圈等</td>
</tr>
</tbody>
</table>
<blockquote>
<p>哪些字段适合使用 SORTABLE</p>
</blockquote>
<table>
<thead>
<tr>
<th>字段类型</th>
<th>是否适合 SORTABLE</th>
<th>原因</th>
</tr>
</thead>
<tbody>
<tr>
<td>NUMERIC</td>
<td>✅ 强烈推荐</td>
<td>数值排序最常见，如价格、时间、评分</td>
</tr>
<tr>
<td>TAG</td>
<td>⚠️ 视情况</td>
<td>一般用于过滤，排序意义不大</td>
</tr>
<tr>
<td>TEXT</td>
<td>⚠️ 谨慎</td>
<td>文本可能很大，内存开销高</td>
</tr>
<tr>
<td>GEO</td>
<td>⚠️ 特殊场景</td>
<td>通常按距离排序，更多依赖 <code>GEOFILTER</code></td>
</tr>
</tbody>
</table>
<div class="tips">
<p><em><strong>小贴士：如何在redis终端输入多行的命令？</strong></em></p>
<ul class="lvl-1">
<li class="lvl-2">先说结论：redis终端 不支持多行输入，但可以通过如下方式输入多行命令：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis-cli &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">HSET user:1 \</span></span><br><span class="line"><span class="string">name Tom \</span></span><br><span class="line"><span class="string">age 18 \</span></span><br><span class="line"><span class="string">city Beijing</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<ul class="lvl-1">
<li class="lvl-2">这种方法是利用了 Bash 的能力，即 <code>&lt;&lt;EOF</code> 后面的内容会作为标准输入，直到 <code>EOF</code> 为止，并通过 <code>\</code> 符换行。</li>
<li class="lvl-2">如果在VSCode中，可以选中要合并的多行内容，然后通过 <code>Ctrl + Shift + J</code> 快捷键将多行合并到一行。</li>
</ul>
</div>
<h4 id="2️⃣-FT-ALTER">2️⃣ FT.ALTER</h4>
<blockquote>
<p>⚠️ 只能 新增字段，不能修改或删除已有字段</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FT.ALTER idx:user SCHEMA ADD $.vip AS vip TAG</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rSearch.alter(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        FieldIndex.tag(<span class="string">&quot;$.vip&quot;</span>).as(<span class="string">&quot;vip&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="3️⃣-FT-DROPINDEX">3️⃣ FT.DROPINDEX</h4>
<blockquote>
<p>⚠️ 删除索引</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FT.DROPINDEX idx:user</span><br><span class="line"><span class="comment"># ⚠️ DD：删除索引的同时删除被索引数据，谨慎使用</span></span><br><span class="line">FT.DROPINDEX idx:user DD</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rSearch.dropIndex(<span class="string">&quot;idx:user&quot;</span>);</span><br><span class="line">rSearch.dropIndexAndDocuments(<span class="string">&quot;idx:user&quot;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="4️⃣-FT-INFO">4️⃣ <a target="_blank" rel="noopener" href="http://FT.INFO">FT.INFO</a></h4>
<blockquote>
<p>查看索引信息</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FT.INFO idx:user</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">IndexInfo</span> <span class="variable">info</span> <span class="operator">=</span> rSearch.info(<span class="string">&quot;idx:user&quot;</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>重点关注字段</p>
</blockquote>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>num_docs</code></td>
<td><strong>当前被索引、可被搜索的文档数量</strong></td>
<td>user:10001 ~ user:10010，10条文档</td>
</tr>
<tr>
<td><code>num_terms</code></td>
<td><strong>词典中唯一词项 term 的数量</strong><br><strong>主要来源于 TEXT（name） 和 TAG（vip, status） 字段去重之后的数量</strong></td>
<td>name: alice, bob, carol, …<br>vip: yes, no<br>status: PAID, CREATED, CANCELLED<br></td>
</tr>
<tr>
<td><code>num_records</code></td>
<td><strong>倒排索引中的记录条目总数</strong><br><strong>所有 term 在所有文档中的出现次数之和</strong></td>
<td>JSON 数组字段 orders[],每个 order 都会生成独立的索引 entry<br>多值字段 × 多文档 = record 爆炸式增长<br><br>num_records 真正影响：内存、查询速度、聚合成本</td>
</tr>
</tbody>
</table>
<h4 id="5️⃣-FT-LIST">5️⃣ FT._LIST</h4>
<blockquote>
<p>列出所有索引</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FT._LIST</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; indexes = rSearch.getIndexes();</span><br></pre></td></tr></table></figure>
<h3 id="二、查询类（核心）">二、查询类（核心）</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FT.SEARCH</code></td>
<td>标准搜索</td>
<td>90% 场景</td>
</tr>
<tr>
<td><code>FT.AGGREGATE</code></td>
<td>分组 / 统计 / 聚合</td>
<td>报表、分析</td>
</tr>
<tr>
<td><code>FT.HYBRID</code></td>
<td>文本 + 向量混合</td>
<td>向量搜索</td>
</tr>
<tr>
<td><code>FT.EXPLAIN</code></td>
<td>查询执行计划</td>
<td>调优</td>
</tr>
<tr>
<td><code>FT.EXPLAINCLI</code></td>
<td>CLI 可读执行计划</td>
<td>调试</td>
</tr>
<tr>
<td><code>FT.PROFILE</code></td>
<td>性能分析</td>
<td>慢查询</td>
</tr>
</tbody>
</table>
<h4 id="1️⃣-FT-SEARCH">1️⃣ FT.SEARCH</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>FT.SEARCH 基本语法</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">FT.SEARCH index query</span><br><span class="line">[NOCOENTENT] [VERBATIM] [NOSTOPWORDS]</span><br><span class="line">[WITHSCORES] [WITHPAYLOADS] [WITHSORTKEYS]</span><br><span class="line">[FILTER numeric_field min max ...]</span><br><span class="line">[GEOFILTER geo_field lon lat radius m|km|mi|ft]</span><br><span class="line">[INKEYS count key ...]</span><br><span class="line">[INFIELDS count field ...]</span><br><span class="line">[RETURN count identifier [AS property] ...]</span><br><span class="line">[SUMMARIZE FIELDS count field ... FRAGS num LEN fragsize SEPARATOR sep]</span><br><span class="line">[HIGHLIGHT FIELDS count field ... TAGS open close]</span><br><span class="line">[SLOP slop] [TIMEOUT <span class="built_in">timeout</span>] [INORDER]</span><br><span class="line">[LANGUAGE language]</span><br><span class="line">[EXPANDER expander]</span><br><span class="line">[SCORER scorer]</span><br><span class="line">[EXPLAINSCORE]</span><br><span class="line">[PAYLOAD payload]</span><br><span class="line">[SORTBY sortby ASC|DESC]</span><br><span class="line">[LIMIT offset num]</span><br><span class="line">[PARAMS nargs name value ...]</span><br><span class="line">[DIALECT dialect]</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>FT.SEARCH 参数说明表</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>index</code></td>
<td>索引名称</td>
</tr>
<tr>
<td><code>query</code></td>
<td>查询条件（类似 SQL WHERE）</td>
</tr>
<tr>
<td><code>NOCONTENT</code></td>
<td>仅返回文档 ID，不返回内容</td>
</tr>
<tr>
<td><code>VERBATIM</code></td>
<td>禁用查询优化，完全按原查询执行</td>
</tr>
<tr>
<td><code>NOSTOPWORDS</code></td>
<td>查询时不忽略停用词</td>
</tr>
<tr>
<td><code>WITHSCORES</code></td>
<td>返回匹配文档的相关性评分</td>
</tr>
<tr>
<td><code>WITHPAYLOADS</code></td>
<td>返回文档的 payload 数据</td>
</tr>
<tr>
<td><code>WITHSORTKEYS</code></td>
<td>返回排序使用的 key</td>
</tr>
<tr>
<td><code>FILTER</code></td>
<td>数值字段过滤（范围查询）</td>
</tr>
<tr>
<td><code>GEOFILTER</code></td>
<td>地理位置范围查询</td>
</tr>
<tr>
<td><code>INKEYS</code></td>
<td>仅在指定的 key 集合中搜索</td>
</tr>
<tr>
<td><code>INFIELDS</code></td>
<td>仅在指定字段中搜索</td>
</tr>
<tr>
<td><code>RETURN</code></td>
<td>指定返回的字段</td>
</tr>
<tr>
<td><code>SUMMARIZE</code></td>
<td>返回字段内容摘要</td>
</tr>
<tr>
<td><code>HIGHLIGHT</code></td>
<td>高亮匹配的关键词</td>
</tr>
<tr>
<td><code>SLOP</code></td>
<td>设置短语查询中允许的词距</td>
</tr>
<tr>
<td><code>TIMEOUT</code></td>
<td>设置查询超时时间</td>
</tr>
<tr>
<td><code>INORDER</code></td>
<td>短语必须按顺序匹配</td>
</tr>
<tr>
<td><code>LANGUAGE</code></td>
<td>指定查询语言</td>
</tr>
<tr>
<td><code>EXPANDER</code></td>
<td>使用自定义查询扩展器</td>
</tr>
<tr>
<td><code>SCORER</code></td>
<td>使用自定义评分函数</td>
</tr>
<tr>
<td><code>EXPLAINSCORE</code></td>
<td>返回评分计算详情</td>
</tr>
<tr>
<td><code>PAYLOAD</code></td>
<td>给评分函数传入自定义参数</td>
</tr>
<tr>
<td><code>SORTBY</code></td>
<td>按指定字段排序</td>
</tr>
<tr>
<td><code>ASC / DESC</code></td>
<td>排序方向</td>
</tr>
<tr>
<td><code>LIMIT</code></td>
<td>分页控制</td>
</tr>
<tr>
<td><code>PARAMS</code></td>
<td>参数化查询</td>
</tr>
<tr>
<td><code>DIALECT</code></td>
<td>指定查询语法版本</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>FT.SEARCH 核心语法</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FT.SEARCH index</span><br><span class="line">query</span><br><span class="line">[RETURN count identifier [AS property] ...]</span><br><span class="line">[SORTBY sortby ASC|DESC]</span><br><span class="line">[LIMIT offset num]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>标准搜索</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">FT.SEARCH idx:user</span><br><span class="line">  <span class="string">&#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27;</span></span><br><span class="line">  RETURN 3 name status amount</span><br><span class="line">  SORTBY amount DESC</span><br><span class="line">  LIMIT 0 10</span><br><span class="line"><span class="comment">## 参数说明</span></span><br><span class="line">  <span class="comment"># 查询条件：&#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27;</span></span><br><span class="line">  <span class="comment"># 查询条件语法：</span></span><br><span class="line">  <span class="comment"># &#x27;xxx&#x27;: 全文检索包含 xxx 的数据，会从 TEXT 字段中匹配</span></span><br><span class="line">  <span class="comment"># &#x27;@field:value&#x27;: 匹配字段 field 的值是 value，要求 field 的类型为 TEXT，全文检索</span></span><br><span class="line">  <span class="comment"># &#x27;@field:&#123;xxx&#125;&#x27;:精确匹配，&#123;xxx*&#125;:匹配前缀，&#123;xxx|yyy&#125;:匹配任意一个，要求 field 的类型为 TAG</span></span><br><span class="line">  <span class="comment"># &#x27;@field:[min max]&#x27;: 范围匹配，这里 +inf 表示正无穷大，要求 field 的类型为 NUMERIC</span></span><br><span class="line">  <span class="comment"># 多个条件空格分隔</span></span><br><span class="line">  <span class="comment"># 模糊匹配：* 表示任意字符，即匹配所有</span></span><br><span class="line"><span class="comment"># RETURN 3 name status amount 返回字段，3:表示返回 3 个字段</span></span><br><span class="line"><span class="comment"># LIMIT 0 10 分页，0:表示从第 0 条开始，10:表示返回 10 条数据</span></span><br><span class="line"><span class="comment"># SORTBY amount DESC 排序，amount:表示排序字段，DESC:表示降序</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SearchResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.search(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@status:&#123;PAID&#125; @amount:[50 +inf]&quot;</span>,</span><br><span class="line">        QueryOptions.defaults()</span><br><span class="line">        .returnAttributes(<span class="keyword">new</span> <span class="title class_">ReturnAttribute</span>(<span class="string">&quot;name&quot;</span>), <span class="keyword">new</span> <span class="title class_">ReturnAttribute</span>(<span class="string">&quot;status&quot;</span>),<span class="keyword">new</span> <span class="title class_">ReturnAttribute</span>(<span class="string">&quot;amount&quot;</span>))</span><br><span class="line">                .sortBy(<span class="string">&quot;amount&quot;</span>)</span><br><span class="line">                .sortOrder(SortOrder.DESC)</span><br><span class="line">                .limit(<span class="number">0</span>, <span class="number">10</span>));</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> result.getTotal();</span><br><span class="line">System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line">List&lt;Document&gt; docs = result.getDocuments();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Document doc: docs) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> doc.getId();</span><br><span class="line">    Map&lt;String, Object&gt; attrs = doc.getAttributes();</span><br><span class="line">    System.out.println(<span class="string">&quot;id = &quot;</span> + id + <span class="string">&quot; attrs = &quot;</span> + attrs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全文检索，从 所有 TEXT 字段中匹配，不区分大小写，即 phone/Phone/PHONE 都匹配</span></span><br><span class="line">FT.SEARCH idx:user <span class="string">&#x27;phone&#x27;</span></span><br><span class="line"><span class="comment">## 示例结果</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 2</span><br><span class="line">2) <span class="string">&quot;user:10006&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Frank\&quot;,\&quot;age\&quot;:27,\&quot;vip\&quot;:\&quot;no\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:499,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;,&#123;\&quot;amount\&quot;:129,\&quot;status\&quot;:\&quot;CREATED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a phone\&quot;,\&quot;items\&quot;:[\&quot;Redis\xe5\xbc\x80\xe5\x8f\x91\xe5\xae\x9e\xe6\x88\x98\&quot;,\&quot;MongoDB\xe4\xbb\x8e\xe5\x85\xa5\xe9\x97\xa8\xe5\x88\xb0\xe5\xae\x9e\xe6\x88\x98\&quot;]&#125;&quot;</span></span><br><span class="line">4) <span class="string">&quot;user:10001&quot;</span></span><br><span class="line">5) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Alice Bob\&quot;,\&quot;age\&quot;:28,\&quot;vip\&quot;:\&quot;yes\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:199.99,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;,&#123;\&quot;amount\&quot;:59.9,\&quot;status\&quot;:\&quot;CREATED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a phone\&quot;,\&quot;items\&quot;:[\&quot;SpringCloud\xe6\x8a\x80\xe6\x9c\xaf\xe6\x8c\x87\xe5\x8d\x97\&quot;,\&quot;Shell\xe8\x84\x9a\xe6\x9c\xac\xe5\x9f\xba\xe7\xa1\x80\&quot;]&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SearchResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.search(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;phone&quot;</span>,</span><br><span class="line">        QueryOptions.defaults()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 中文检索</span></span><br><span class="line">FT.SEARCH idx:user <span class="string">&#x27;开始&#x27;</span></span><br><span class="line"><span class="comment">## 示例结果</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 2</span><br><span class="line">2) <span class="string">&quot;user:10005&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Eve\&quot;,\&quot;age\&quot;:30,\&quot;vip\&quot;:\&quot;no\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:88.8,\&quot;status\&quot;:\&quot;CREATED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a pencil\&quot;,\&quot;items\&quot;:[\&quot;Kafka\xe4\xbb\x8e\xe9\x9b\xb6\xe5\xbc\x80\xe5\xa7\x8b\&quot;,\&quot;Java\xe7\x94\xb1\xe6\xb5\x85\xe5\x85\xa5\xe6\xb7\xb1\&quot;]&#125;&quot;</span></span><br><span class="line">4) <span class="string">&quot;user:10007&quot;</span></span><br><span class="line">5) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Grace\&quot;,\&quot;age\&quot;:33,\&quot;vip\&quot;:\&quot;yes\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:999.9,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a book\&quot;,\&quot;items\&quot;:[\&quot;Android\xe5\xbc\x80\xe5\x8f\x91\xe6\x89\x8b\xe5\x86\x8c\&quot;,\&quot;Gradle\xe4\xbb\x8e\xe9\x9b\xb6\xe5\xbc\x80\xe5\xa7\x8b\&quot;]&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SearchResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.search(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;开始&quot;</span>,</span><br><span class="line">        QueryOptions.defaults()</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<div class="tips">
<p><em><strong>小贴士</strong></em></p>
<ul class="lvl-1">
<li class="lvl-2">看到中文输出是乱码，可以在登录客户端时加上 --raw</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --user admin -a 123456 --raw</span><br><span class="line">127.0.0.1:6379&gt; FT.SEARCH idx:user <span class="string">&#x27;开始&#x27;</span></span><br><span class="line">2</span><br><span class="line">user:10005</span><br><span class="line">$</span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Eve&quot;</span>,<span class="string">&quot;age&quot;</span>:30,<span class="string">&quot;vip&quot;</span>:<span class="string">&quot;no&quot;</span>,<span class="string">&quot;orders&quot;</span>:[&#123;<span class="string">&quot;amount&quot;</span>:88.8,<span class="string">&quot;status&quot;</span>:<span class="string">&quot;CREATED&quot;</span>&#125;],<span class="string">&quot;comment&quot;</span>:<span class="string">&quot;I have a pencil&quot;</span>,<span class="string">&quot;items&quot;</span>:[<span class="string">&quot;Kafka从零开始&quot;</span>,<span class="string">&quot;Java由浅入深&quot;</span>]&#125;</span><br><span class="line">user:10007</span><br><span class="line">$</span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Grace&quot;</span>,<span class="string">&quot;age&quot;</span>:33,<span class="string">&quot;vip&quot;</span>:<span class="string">&quot;yes&quot;</span>,<span class="string">&quot;orders&quot;</span>:[&#123;<span class="string">&quot;amount&quot;</span>:999.9,<span class="string">&quot;status&quot;</span>:<span class="string">&quot;PAID&quot;</span>&#125;],<span class="string">&quot;comment&quot;</span>:<span class="string">&quot;I have a book&quot;</span>,<span class="string">&quot;items&quot;</span>:[<span class="string">&quot;Android开发手册&quot;</span>,<span class="string">&quot;Gradle从零开始&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>
</div>
<h5 id="SQL-WHERE-与-RediSearch-查询语法对照表">SQL WHERE 与 RediSearch 查询语法对照表</h5>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>x/y/name</code> → <code>TEXT/TAG(要加上&#123;&#125;)</code> 字段，<code>num</code>→<code>NUMERIC</code> 字段，查询语法用于 <code>FT.SEARCH</code>/<code>FT.AGGREGATE</code> 的查询字符串部分</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>ID</th>
<th>SQL 条件</th>
<th>RediSearch 对等写法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><code>WHERE x = 'book' AND y = 'phone'</code></td>
<td><code>@x:book @y:phone</code></td>
<td>AND 为默认关系（空格）</td>
</tr>
<tr>
<td>2</td>
<td><code>WHERE x = 'book' AND y != 'phone'</code></td>
<td><code>@x:book -@y:phone</code></td>
<td><code>-</code> 表示 NOT</td>
</tr>
<tr>
<td>3</td>
<td><code>WHERE x = 'book' OR y = 'phone'</code></td>
<td><code>(@x:book) | (@y:phone)</code></td>
<td>OR 必须显式写 <code>|</code></td>
</tr>
<tr>
<td>4</td>
<td><code>WHERE x IN ('book','phone','hello world')</code></td>
<td><code>@x:(book|phone|&quot;hello world&quot;)</code></td>
<td>多值 OR，短语需加引号</td>
</tr>
<tr>
<td>5</td>
<td><code>WHERE y='book' AND x NOT IN ('book','phone')</code></td>
<td><code>@y:book -(@x:book|@x:phone)</code></td>
<td>NOT IN = NOT + OR</td>
</tr>
<tr>
<td>6</td>
<td><code>WHERE x NOT IN ('book','phone')</code></td>
<td><code>-@x:(book|phone)</code></td>
<td>整体否定</td>
</tr>
<tr>
<td>7</td>
<td><code>WHERE num BETWEEN 10 AND 20</code></td>
<td><code>@num:[10 20]</code></td>
<td>数值区间（闭区间）</td>
</tr>
<tr>
<td>8</td>
<td><code>WHERE num &gt;= 10</code></td>
<td><code>@num:[10 +inf]</code></td>
<td><code>+inf</code> 表示正无穷</td>
</tr>
<tr>
<td>9</td>
<td><code>WHERE num &gt; 10</code></td>
<td><code>@num:[(10 +inf]</code></td>
<td><code>(</code> 表示不包含</td>
</tr>
<tr>
<td>10</td>
<td><code>WHERE num &lt; 10</code></td>
<td><code>@num:[-inf (10]</code></td>
<td>小于（不含 10）</td>
</tr>
<tr>
<td>11</td>
<td><code>WHERE num &lt;= 10</code></td>
<td><code>@num:[-inf 10]</code></td>
<td>小于等于</td>
</tr>
<tr>
<td>12</td>
<td><code>WHERE num &lt; 10 OR num &gt; 20</code></td>
<td><code>@num:[-inf (10] | @num:[(20 +inf]</code></td>
<td>数值 OR</td>
</tr>
<tr>
<td>13</td>
<td><code>WHERE name LIKE 'Li%'</code></td>
<td><code>@name:Li*</code></td>
<td>前缀匹配</td>
</tr>
</tbody>
</table>
<h4 id="2️⃣-FT-AGGREGATE">2️⃣ FT.AGGREGATE</h4>
<blockquote>
<p>分组 / 统计 / 聚合，语法</p>
</blockquote>
<ul class="lvl-0">
<li class="lvl-2">
<p>FT.AGGREGATE 基本语法</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE index query</span><br><span class="line">[VERBATIM]</span><br><span class="line">[LOAD count field ... | LOAD *]</span><br><span class="line">[TIMEOUT <span class="built_in">timeout</span>]</span><br><span class="line">[GROUPBY nargs property ...</span><br><span class="line">   REDUCE <span class="keyword">function</span> nargs arg ... [AS name] ...]</span><br><span class="line">[SORTBY nargs property ASC|DESC ... [MAX num]]</span><br><span class="line">[APPLY expression AS name]</span><br><span class="line">[LIMIT offset num]</span><br><span class="line">[FILTER filter]</span><br><span class="line">[WITHCURSOR [COUNT read_size]]</span><br><span class="line">[MAXIDLE idle_time]</span><br><span class="line">[PARAMS nargs name value ...]</span><br><span class="line">[DIALECT dialect]</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>FT.AGGREGATE 参数说明表</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>index</code></td>
<td>索引名称</td>
</tr>
<tr>
<td><code>query</code></td>
<td>查询条件（类似 WHERE）</td>
</tr>
<tr>
<td><code>VERBATIM</code></td>
<td>禁用查询优化</td>
</tr>
<tr>
<td><code>LOAD</code></td>
<td>加载原始字段</td>
</tr>
<tr>
<td><code>TIMEOUT</code></td>
<td>查询超时时间</td>
</tr>
<tr>
<td><code>GROUPBY</code></td>
<td>分组字段（类似 SQL GROUP BY）</td>
</tr>
<tr>
<td><code>REDUCE</code></td>
<td>聚合函数（COUNT / SUM / AVG / MIN / MAX 等）</td>
</tr>
<tr>
<td><code>AS</code></td>
<td>聚合结果别名</td>
</tr>
<tr>
<td><code>SORTBY</code></td>
<td>对聚合结果排序</td>
</tr>
<tr>
<td><code>ASC / DESC</code></td>
<td>排序方向</td>
</tr>
<tr>
<td><code>MAX</code></td>
<td>最大返回条数</td>
</tr>
<tr>
<td><code>APPLY</code></td>
<td>对结果字段进行表达式计算</td>
</tr>
<tr>
<td><code>LIMIT</code></td>
<td>分页控制</td>
</tr>
<tr>
<td><code>FILTER</code></td>
<td>结果过滤（WHERE / HAVING）</td>
</tr>
<tr>
<td><code>WITHCURSOR</code></td>
<td>使用游标（大结果集）</td>
</tr>
<tr>
<td><code>COUNT</code></td>
<td>每次读取数量</td>
</tr>
<tr>
<td><code>MAXIDLE</code></td>
<td>游标最大空闲时间</td>
</tr>
<tr>
<td><code>PARAMS</code></td>
<td>参数化查询</td>
</tr>
<tr>
<td><code>DIALECT</code></td>
<td>查询语法版本</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>FT.AGGREGATE 的核心语法</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE &lt;index&gt; &lt;query&gt;</span><br><span class="line">  [GROUPBY ...]</span><br><span class="line">  [REDUCE ...]</span><br><span class="line">  [SORTBY ...]</span><br><span class="line">  [LIMIT ...]</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>示例 1：按 status 分组统计数量</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE idx:user</span><br><span class="line">  <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE COUNT 0 AS cnt</span><br><span class="line"><span class="comment">## 参数说明</span></span><br><span class="line"><span class="comment"># *: 查询条件，* 表示匹配索引中的 所有文档，也可以是 FT.SEARCH 中的查询条件，比如：&#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27;</span></span><br><span class="line"><span class="comment"># GROUPBY 1 @status: 分组字段</span></span><br><span class="line">  <span class="comment"># 1:表示分组字段数量</span></span><br><span class="line">  <span class="comment"># @status:表示分组字段</span></span><br><span class="line"><span class="comment"># REDUCE COUNT 0 AS cnt: 聚合字段</span></span><br><span class="line">  <span class="comment"># COUNT:聚合函数：计数</span></span><br><span class="line">  <span class="comment"># 0:参数个数（COUNT 不需要参数）</span></span><br><span class="line">  <span class="comment"># AS cnt:表示聚合字段别名</span></span><br><span class="line"><span class="comment">## 返回结果示例</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 3</span><br><span class="line">2) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CANCELLED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;2&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;PAID&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;6&quot;</span></span><br><span class="line">4) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CREATED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应SQL 语句：</span></span><br><span class="line">SELECT status, COUNT(*) AS cnt</span><br><span class="line">  FROM user</span><br><span class="line">  GROUP BY status;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AggregationResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.aggregate(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        AggregationOptions.defaults()</span><br><span class="line">                .groupBy(GroupBy.fieldNames(<span class="string">&quot;@status&quot;</span>).reducers(Reducer.count().as(<span class="string">&quot;cnt&quot;</span>)))</span><br><span class="line">);</span><br><span class="line"><span class="keyword">final</span> <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> result.getTotal();</span><br><span class="line">System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line"><span class="keyword">final</span> List&lt;Map&lt;String, Object&gt;&gt; attributes = result.getAttributes();</span><br><span class="line"><span class="keyword">for</span> (Map&lt;String, Object&gt; attribute : attributes) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;attribute = &quot;</span> + attribute);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>示例 2：按 status 分组统计金额总和</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE idx:user <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE SUM 1 @amount AS total_amount</span><br><span class="line">  SORTBY 2 @total_amount DESC</span><br><span class="line">  LIMIT 0 3</span><br><span class="line"></span><br><span class="line"><span class="comment">## 参数说明</span></span><br><span class="line"><span class="comment"># SUM:聚合函数：求和</span></span><br><span class="line"><span class="comment"># 1:参数个数</span></span><br><span class="line"><span class="comment"># @amount:要参与求和的字段</span></span><br><span class="line"><span class="comment"># total_amount:表示聚合字段别名</span></span><br><span class="line"><span class="comment"># SORTBY 2 @total_amount DESC: 排序</span></span><br><span class="line">  <span class="comment"># 2: 表示后面跟 2 个参数（字段 + 排序方向）</span></span><br><span class="line">  <span class="comment"># @total_amount: 表示排序字段（REDUCE 产生的别名），DESC:表示降序</span></span><br><span class="line"><span class="comment"># LIMIT 0 3: 分页，0:表示从第 0 条开始，3:表示返回 3 条数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 示例结果</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 3</span><br><span class="line">2) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;PAID&quot;</span></span><br><span class="line">   3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   4) <span class="string">&quot;4096.89&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CREATED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   4) <span class="string">&quot;238.8&quot;</span></span><br><span class="line">4) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CANCELLED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   4) <span class="string">&quot;79.8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应SQL 语句：</span></span><br><span class="line">SELECT status, SUM(amount) AS total_amount</span><br><span class="line">  FROM user</span><br><span class="line">  GROUP BY status</span><br><span class="line">  ORDER BY total_amount DESC</span><br><span class="line">  LIMIT 0 3;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AggregationResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.aggregate(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        AggregationOptions.defaults()</span><br><span class="line">                .groupBy(GroupBy.fieldNames(<span class="string">&quot;@status&quot;</span>)</span><br><span class="line">                        .reducers(</span><br><span class="line">                                Reducer.sum(<span class="string">&quot;@amount&quot;</span>).as(<span class="string">&quot;total_amount&quot;</span>)</span><br><span class="line">                        )</span><br><span class="line">                )</span><br><span class="line">                .sortBy(<span class="keyword">new</span> <span class="title class_">SortedField</span>(<span class="string">&quot;@total_amount&quot;</span>, SortOrder.DESC))</span><br><span class="line">                .limit(<span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>示例 3：同时输出数量 + 金额，并按金额降序，数量升序</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE idx:user <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE COUNT 0 AS cnt</span><br><span class="line">  REDUCE SUM 1 @amount AS total_amount</span><br><span class="line">  SORTBY 4 @total_amount DESC @cnt ASC</span><br><span class="line"></span><br><span class="line"><span class="comment">## 示例结果</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 3</span><br><span class="line">2) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;PAID&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;6&quot;</span></span><br><span class="line">   5) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   6) <span class="string">&quot;4096.89&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CREATED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;2&quot;</span></span><br><span class="line">   5) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   6) <span class="string">&quot;238.8&quot;</span></span><br><span class="line">4) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">   2) <span class="string">&quot;CANCELLED&quot;</span></span><br><span class="line">   3) <span class="string">&quot;cnt&quot;</span></span><br><span class="line">   4) <span class="string">&quot;2&quot;</span></span><br><span class="line">   5) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">   6) <span class="string">&quot;79.8&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AggregationResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.aggregate(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        AggregationOptions.defaults()</span><br><span class="line">                .groupBy(GroupBy.fieldNames(<span class="string">&quot;@status&quot;</span>)</span><br><span class="line">                        .reducers(</span><br><span class="line">                                Reducer.count().as(<span class="string">&quot;cnt&quot;</span>),</span><br><span class="line">                                Reducer.sum(<span class="string">&quot;@amount&quot;</span>).as(<span class="string">&quot;total_amount&quot;</span>)</span><br><span class="line">                        )</span><br><span class="line">                )</span><br><span class="line">                .sortBy(<span class="keyword">new</span> <span class="title class_">SortedField</span>(<span class="string">&quot;@total_amount&quot;</span>, SortOrder.DESC))</span><br><span class="line">                .sortBy(<span class="keyword">new</span> <span class="title class_">SortedField</span>(<span class="string">&quot;@cnt&quot;</span>, SortOrder.ASC))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>示例 4：按状态分组，筛选总金额 &gt; 200</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE idx:user <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE SUM 1 @amount AS total_amount</span><br><span class="line">  FILTER @total_amount &gt; 200</span><br><span class="line">  SORTBY 2 @total_amount DESC</span><br><span class="line"><span class="comment">## 参数说明</span></span><br><span class="line"><span class="comment"># FILTER: 过滤器，作用在 GROUPBY + REDUCE 之后，语义等价于 SQL 的：HAVING SUM(amount) &gt; 1000</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AggregationResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.aggregate(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        AggregationOptions.defaults()</span><br><span class="line">                .groupBy(GroupBy.fieldNames(<span class="string">&quot;@status&quot;</span>)</span><br><span class="line">                        .reducers(</span><br><span class="line">                                Reducer.sum(<span class="string">&quot;@amount&quot;</span>).as(<span class="string">&quot;total_amount&quot;</span>)</span><br><span class="line">                        )</span><br><span class="line">                )</span><br><span class="line">                .filter(<span class="string">&quot;@total_amount &gt; 200&quot;</span>)</span><br><span class="line">                .sortBy(<span class="keyword">new</span> <span class="title class_">SortedField</span>(<span class="string">&quot;@total_amount&quot;</span>, SortOrder.DESC))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>语义执行顺序： SCAN → GROUPBY → REDUCE → FILTER (HAVING) → SORTBY → LIMIT</p>
</blockquote>
<ul class="lvl-0">
<li class="lvl-2">
<p>常见可用 REDUCE 函数</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>函数</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>COUNT</td>
<td>行数</td>
</tr>
<tr>
<td>SUM</td>
<td>求和</td>
</tr>
<tr>
<td>AVG</td>
<td>平均</td>
</tr>
<tr>
<td>MIN / MAX</td>
<td>极值</td>
</tr>
<tr>
<td>TO_LIST</td>
<td>收集字段</td>
</tr>
</tbody>
</table>
<h4 id="3️⃣-FT-EXPLAIN-FT-EXPLAINCLI">3️⃣ FT.EXPLAIN/FT.EXPLAINCLI</h4>
<blockquote>
<p>查询执行计划， 不会考虑分组聚合，只看查询条件，它的定位是：看“会不会用索引、怎么用索引”，而不是看“跑得慢不慢”。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FT.EXPLAINCLI idx:user <span class="string">&#x27;@status:&#123;PAID&#125;  @amount:[100 +inf]&#x27;</span></span><br><span class="line"><span class="comment">## 示例结果</span></span><br><span class="line">1) INTERSECT &#123;</span><br><span class="line">2)   TAG:@status &#123;</span><br><span class="line">3)     paid</span><br><span class="line">4)   &#125;</span><br><span class="line">5)   NUMERIC &#123;100.000000 &lt;= @amount &lt;= inf&#125;</span><br><span class="line">6) &#125;</span><br><span class="line">7)</span><br></pre></td></tr></table></figure>
<h4 id="4️⃣-FT-PROFILE">4️⃣ FT.PROFILE</h4>
<blockquote>
<p>性能分析，看“跑得慢不慢”。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FT.PROFILE idx:user</span><br><span class="line">  SEARCH</span><br><span class="line">  QUERY <span class="string">&#x27;@status:&#123;PAID&#125;  @amount:[100 +inf]&#x27;</span></span><br><span class="line"><span class="comment">## 参数说明</span></span><br><span class="line"><span class="comment"># SEARCH: 标准查询，AGGREGATE: 聚合查询</span></span><br><span class="line"><span class="comment"># QUERY: 查询条件</span></span><br><span class="line"></span><br><span class="line">FT.PROFILE idx:user</span><br><span class="line">  AGGREGATE</span><br><span class="line">  QUERY <span class="string">&quot;@status:&#123;PAID&#125; @amount:[100 +inf]&quot;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE SUM 1 @amount AS total_amount</span><br></pre></td></tr></table></figure>
<h5 id="关注指标">关注指标</h5>
<ul class="lvl-0">
<li class="lvl-2">
<p>第一优先级指标（直接决定查询是否慢）</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>指标</th>
<th>所在位置</th>
<th>含义</th>
<th>健康阈值</th>
<th>需要警惕</th>
<th>常见优化手段</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Total profile time</strong></td>
<td>Shards → Total profile time</td>
<td>查询在搜索引擎层面的总耗时（不含网络）</td>
<td><strong>&lt; 1 ms：优秀</strong><br>1–10 ms：可接受</td>
<td>&gt; 20 ms：需要优化<br>&gt; 50 ms：结构性问题</td>
<td>减少结果集、拆分查询、优化索引字段</td>
</tr>
<tr>
<td><strong>Iterator Type</strong></td>
<td>Iterators profile → Type</td>
<td>查询执行策略</td>
<td><strong>INTERSECT / UNION</strong></td>
<td><strong>SCAN / WILDCARD</strong></td>
<td>增加可索引字段、避免模糊前缀</td>
</tr>
<tr>
<td><strong>Estimated number of matches</strong></td>
<td>Child iterators</td>
<td>索引层估算的候选文档数</td>
<td><strong>&lt; 1k：理想</strong><br>1k–10k：可接受</td>
<td>&gt; 50k：过滤条件过宽</td>
<td>改用 TAG / NUMERIC / 冗余字段</td>
</tr>
<tr>
<td><strong>Loader Time</strong></td>
<td>Result processors → Loader</td>
<td>从 Redis 加载并反序列化文档</td>
<td>&lt; 30% Total time</td>
<td>&gt; 40% Total time</td>
<td>RETURN 精简字段、NOCONTENT、缩小 JSON</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>第二优先级指标（判断索引或模型是否合理）</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>指标</th>
<th>所在位置</th>
<th>含义</th>
<th>健康阈值</th>
<th>需要警惕</th>
<th>常见优化手段</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Number of reading operations</strong></td>
<td>Iterators profile</td>
<td>实际扫描的倒排表条目数</td>
<td>≈ Estimated matches</td>
<td>明显大于结果数</td>
<td>提高字段选择性、拆分条件</td>
</tr>
<tr>
<td><strong>Estimated matches vs 实际结果数</strong></td>
<td>Iterator + Result</td>
<td>索引估算精度</td>
<td>估算值略大于实际</td>
<td>估算 &gt;&gt; 实际（10x+）</td>
<td>调整 schema，避免低基数字段</td>
</tr>
<tr>
<td><strong>Parsing time</strong></td>
<td>Shards → Parsing time</td>
<td>查询语法解析耗时</td>
<td>&lt; 0.1 ms</td>
<td>&gt; 1 ms</td>
<td>减少动态拼接、简化语法</td>
</tr>
<tr>
<td><strong>Pipeline creation time</strong></td>
<td>Shards → Pipeline creation</td>
<td>执行计划构建时间</td>
<td>&lt; 0.05 ms</td>
<td>&gt; 0.5 ms</td>
<td>减少子句、避免复杂嵌套</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>经验型“红线判断”速查表（非常实用）</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>现象</th>
<th>含义</th>
<th>是否必须处理</th>
</tr>
</thead>
<tbody>
<tr>
<td>Estimated matches &gt; 100k</td>
<td>索引字段选择错误</td>
<td>必须</td>
</tr>
<tr>
<td>Iterator Type = SCAN</td>
<td>全表扫描</td>
<td>必须</td>
</tr>
<tr>
<td>Loader &gt; 50% 总耗时</td>
<td>返回数据过重</td>
<td>强烈建议</td>
</tr>
<tr>
<td>reading ops ≫ results</td>
<td>倒排效率低</td>
<td>建议</td>
</tr>
<tr>
<td>Total time &gt; 20 ms</td>
<td>在线查询风险</td>
<td>必须</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>核心执行策略型 Iterator（最重要）</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>语义</th>
<th>典型触发场景</th>
<th>性能特征</th>
<th>调优结论</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>INTERSECT</strong></td>
<td>多条件取交集（AND）</td>
<td><code>@a:&#123;x&#125; @b:[1 10]</code></td>
<td>基于最小倒排表，效率最高</td>
<td><strong>理想状态，优先使用</strong></td>
</tr>
<tr>
<td><strong>UNION</strong></td>
<td>多条件取并集（OR）</td>
<td><code>@a:&#123;x|y&#125;</code></td>
<td>候选集扩大，随 OR 数量线性增长</td>
<td>可接受，避免过多 OR</td>
</tr>
<tr>
<td><strong>SCAN</strong></td>
<td>全量扫描</td>
<td>字段未索引 / JSON Path 不可索引</td>
<td>O(N)，文档越多越慢</td>
<td><strong>必须消灭</strong></td>
</tr>
<tr>
<td><strong>WILDCARD</strong></td>
<td>无过滤条件</td>
<td><code>&quot;*&quot;</code>、<code>@field:*</code></td>
<td>候选集=全部文档</td>
<td>仅限分析，线上慎用</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>索引访问型 Iterator（INTERSECT / UNION 的子节点）</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>对应字段类型</th>
<th>示例查询</th>
<th>性能特征</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>TAG</strong></td>
<td>TAG</td>
<td><code>@status:&#123;PAID&#125;</code></td>
<td>哈希倒排，最快</td>
<td>强烈推荐</td>
</tr>
<tr>
<td><strong>NUMERIC</strong></td>
<td>NUMERIC</td>
<td><code>@amount:[100 +inf]</code></td>
<td>跳表范围扫描</td>
<td>范围越窄越快</td>
</tr>
<tr>
<td><strong>TEXT</strong></td>
<td>TEXT</td>
<td><code>@name:alice</code></td>
<td>分词匹配</td>
<td>分词数影响性能</td>
</tr>
<tr>
<td><strong>GEO</strong></td>
<td>GEO</td>
<td><code>@loc:[13.4 52.5 10 km]</code></td>
<td>空间索引</td>
<td>半径影响结果数</td>
</tr>
<tr>
<td><strong>VECTOR</strong></td>
<td>VECTOR</td>
<td><code>=&gt;[KNN 10 @v $q]</code></td>
<td>向量搜索</td>
<td>常与 FILTER 联用</td>
</tr>
<tr>
<td><strong>IDLIST</strong></td>
<td>内部</td>
<td>小结果集</td>
<td>枚举 ID</td>
<td>自动优化</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>逻辑 / 结构型 Iterator</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>含义</th>
<th>触发示例</th>
<th>性能影响</th>
<th>是否常见</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>NOT</strong></td>
<td>取反</td>
<td><code>-@status:&#123;PAID&#125;</code></td>
<td>依赖全集</td>
<td>较少</td>
</tr>
<tr>
<td><strong>OPTIONAL</strong></td>
<td>可选子句</td>
<td><code>( @a:&#123;x&#125; )?</code></td>
<td>增加候选集</td>
<td>少见</td>
</tr>
<tr>
<td><strong>EMPTY</strong></td>
<td>无匹配</td>
<td>条件不可能满足</td>
<td>极快</td>
<td>偶发</td>
</tr>
<tr>
<td><strong>PHRASE</strong></td>
<td>短语匹配</td>
<td><code>&quot;hello world&quot;</code></td>
<td>比 TEXT 慢</td>
<td>低频</td>
</tr>
<tr>
<td><strong>PREFIX</strong></td>
<td>前缀匹配</td>
<td><code>abc*</code></td>
<td>可能退化</td>
<td>需谨慎</td>
</tr>
</tbody>
</table>
<h3 id="三、别名管理（生产必备）">三、别名管理（生产必备）</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FT.ALIASADD</code></td>
<td>添加别名</td>
</tr>
<tr>
<td><code>FT.ALIASDEL</code></td>
<td>删除别名</td>
</tr>
<tr>
<td><code>FT.ALIASUPDATE</code></td>
<td>更新别名指向</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>一个索引可以有多个别名，一旦创建别名，所有 FT.SEARCH / FT.AGGREGATE / <a target="_blank" rel="noopener" href="http://FT.INFO">FT.INFO</a> 等命令都可以直接使用 alias</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加别名: FT.ALIASADD alias index</span></span><br><span class="line">FT.ALIASADD <span class="built_in">alias</span>:user idx:user</span><br><span class="line"><span class="comment"># 更新别名指向: FT.ALIASUPDATE alias index</span></span><br><span class="line">FT.ALIASUPDATE <span class="built_in">alias</span>:user idx:user:v2</span><br><span class="line"><span class="comment"># 删除别名: FT.ALIASDEL alias</span></span><br><span class="line">FT.ALIASDEL <span class="built_in">alias</span>:user</span><br><span class="line"><span class="comment"># 判断索引名称是否为别名</span></span><br><span class="line">FT.INFO <span class="built_in">alias</span>:user</span><br><span class="line"> 1) index_name</span><br><span class="line"> 2) idx:user  <span class="comment"># 真实索引名称</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rSearch.addAlias(<span class="string">&quot;alias:user&quot;</span>, <span class="string">&quot;idx:user&quot;</span>);</span><br><span class="line">rSearch.updateAlias(<span class="string">&quot;alias:user&quot;</span>, <span class="string">&quot;idx:user:v2&quot;</span>);</span><br><span class="line">rSearch.delAlias(<span class="string">&quot;alias:user&quot;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="索引别名的核心价值">索引别名的核心价值</h4>
<ul class="lvl-0">
<li class="lvl-2">
<ol>
<li class="lvl-5">索引无损重建（最典型场景）</li>
</ol>
<ul class="lvl-2">
<li class="lvl-4">RediSearch 不支持在线修改 schema，字段变更通常需要重建索引，索引重建时业务将不可用。</li>
<li class="lvl-4">有了别名，我们可以创建一个新的索引，创建好后将别名指向新的索引，旧索引不再使用，业务无影响。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. 旧索引</span><br><span class="line"> FT.ALIASADD user_idx user_idx_v1</span><br><span class="line"></span><br><span class="line">2. 新建索引</span><br><span class="line">  FT.CREATE user_idx_v2 ...</span><br><span class="line"></span><br><span class="line">3. 数据回填完成后，原子切换</span><br><span class="line">  FT.ALIASUPDATE user_idx user_idx_v2</span><br><span class="line"></span><br><span class="line">4. 删除旧索引（可选）</span><br><span class="line">  FT.DROPINDEX user_idx_v1</span><br></pre></td></tr></table></figure>
</li>
<li class="lvl-2">
<ol start="2">
<li class="lvl-5">灰度 / 多版本并存</li>
</ol>
<ul class="lvl-2">
<li class="lvl-4">不同环境（dev / staging / prod）</li>
<li class="lvl-4">不同 schema 版本</li>
</ul>
</li>
<li class="lvl-2">
<ol start="3">
<li class="lvl-5">运维与发布规范化（强烈推荐）</li>
</ol>
<ul class="lvl-2">
<li class="lvl-4">在生产环境中：永远不要让业务代码直接使用物理索引名</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">索引真实名: 业务名_版本_时间戳</span><br><span class="line">索引别名 : 业务名</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="四、游标（大结果集）">四、游标（大结果集）</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FT.CURSOR READ</code></td>
<td>分批读取</td>
</tr>
<tr>
<td><code>FT.CURSOR DEL</code></td>
<td>删除游标</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>游标用于聚合查询（AGGREGATE）的大结果集分页/分批拉取，典型场景包括：</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GROUPBY / REDUCE 后结果集很大</span><br><span class="line">需要流式处理聚合结果，避免一次性返回占用大量内存</span><br><span class="line">客户端按批消费结果（类似数据库的 server-side cursor）</span><br><span class="line">注意：游标主要用于 FT.AGGREGATE，普通 FT.SEARCH 不支持游标分页。</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>通过 <code>FT.AGGREGATE ... WITHCURSOR</code> 创建游标，通过 <code>FT.CURSOR READ</code> 获取结果。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE idx:user <span class="string">&quot;*&quot;</span></span><br><span class="line">  GROUPBY 1 @status</span><br><span class="line">  REDUCE SUM 1 @amount AS total_amount</span><br><span class="line">  WITHCURSOR COUNT 2 MAXIDLE 60000</span><br><span class="line"><span class="comment">## 参数说明</span></span><br><span class="line"><span class="comment"># WITHCURSOR : 启用游标</span></span><br><span class="line"><span class="comment"># COUNT 2 : 每次从游标中返回的行数（批大小）</span></span><br><span class="line"><span class="comment"># MAXIDLE 60000 : 游标最大空闲时间（毫秒），超时后自动销毁</span></span><br><span class="line"><span class="comment">## 返回结果</span></span><br><span class="line">1) 1) (<span class="built_in">integer</span>) 3   <span class="comment"># GROUP BY 后，一共会产生 3 行聚合结果，这里返回的是实际查询的总行数，不受COUNT 参数限制</span></span><br><span class="line">   2) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">      2) <span class="string">&quot;CANCELLED&quot;</span></span><br><span class="line">      3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">      4) <span class="string">&quot;79.8&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">      2) <span class="string">&quot;PAID&quot;</span></span><br><span class="line">      3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">      4) <span class="string">&quot;4096.89&quot;</span></span><br><span class="line">2) (<span class="built_in">integer</span>) 116452546  <span class="comment"># 游标ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取游标</span></span><br><span class="line">FT.CURSOR READ idx:user 116452546 COUNT 2</span><br><span class="line"><span class="comment"># 参数说明</span></span><br><span class="line"><span class="comment"># 116452546 : 游标ID</span></span><br><span class="line"><span class="comment"># COUNT 2 : 每次从游标中返回的行数(可覆盖初始游标中的 COUNT）</span></span><br><span class="line"><span class="comment">## 返回结果</span></span><br><span class="line">1) 1) (<span class="built_in">integer</span>) 0   <span class="comment"># 当前游标中“剩余可读的行数”为 0</span></span><br><span class="line">   2) 1) <span class="string">&quot;status&quot;</span></span><br><span class="line">      2) <span class="string">&quot;CREATED&quot;</span></span><br><span class="line">      3) <span class="string">&quot;total_amount&quot;</span></span><br><span class="line">      4) <span class="string">&quot;238.8&quot;</span></span><br><span class="line">2) (<span class="built_in">integer</span>) 0 <span class="comment"># 0 表示没有更多结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 销毁游标，如果设置了 MAXIDLE 参数，则该游标在 MAXIDLE 时间内自动销毁，所以无需手工销毁</span></span><br><span class="line">FT.CURSOR DEL idx:user 116452546</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AggregationResult</span> <span class="variable">result</span> <span class="operator">=</span> rSearch.aggregate(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        AggregationOptions.defaults()</span><br><span class="line">                .groupBy(GroupBy.fieldNames(<span class="string">&quot;@status&quot;</span>)</span><br><span class="line">                        .reducers(</span><br><span class="line">                                Reducer.sum(<span class="string">&quot;@amount&quot;</span>).as(<span class="string">&quot;total_amount&quot;</span>)</span><br><span class="line">                        )</span><br><span class="line">                )</span><br><span class="line">                .withCursor(<span class="number">2</span>, <span class="number">60000</span>)</span><br><span class="line">);</span><br><span class="line"><span class="type">long</span> total;</span><br><span class="line"><span class="type">long</span> cursorId;</span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; attributes;</span><br><span class="line"></span><br><span class="line">total = result.getTotal();</span><br><span class="line">cursorId = result.getCursorId();</span><br><span class="line">System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line">System.out.println(<span class="string">&quot;cursorId = &quot;</span> + cursorId);</span><br><span class="line">attributes = result.getAttributes();</span><br><span class="line"><span class="keyword">for</span> (Map&lt;String, Object&gt; attribute : attributes) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;attribute = &quot;</span> + attribute);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (cursorId != <span class="number">0</span>) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">    <span class="comment">// 游标读取，Redisson的readCursor方法有bug，无法继续读取游标数据</span></span><br><span class="line">    <span class="comment">// result = rSearch.readCursor(&quot;idx:user&quot;, cursorId, 2);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里游标读取可以自己编写一个基于Lua 的实现</span></span><br><span class="line">    result = readCursor(<span class="string">&quot;idx:user&quot;</span>, cursorId, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    total = result.getTotal();</span><br><span class="line">    cursorId = result.getCursorId();</span><br><span class="line">    System.out.println(<span class="string">&quot;total = &quot;</span> + total);</span><br><span class="line">    System.out.println(<span class="string">&quot;cursorId = &quot;</span> + cursorId);</span><br><span class="line">    attributes = result.getAttributes();</span><br><span class="line">    <span class="keyword">for</span> (Map&lt;String, Object&gt; attribute : attributes) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;attribute = &quot;</span> + attribute);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cursorId=0 或 到期 时会自动删除游标，此处无需删除</span></span><br><span class="line"><span class="comment">// rSearch.delCursor(&quot;idx:user&quot;, cursorId);</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AggregationResult <span class="title function_">readCursor</span><span class="params">(String indexName, <span class="type">long</span> cursorId, <span class="type">int</span> count)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;return redis.call(&#x27;FT.CURSOR&#x27;, &#x27;READ&#x27;, KEYS[1], ARGV[1], &#x27;COUNT&#x27;, ARGV[2])&quot;</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Object&gt; results = stringRedisTemplate.execute(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class="line">            Collections.singletonList(indexName),</span><br><span class="line">            String.valueOf(cursorId),</span><br><span class="line">            String.valueOf(count)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    cursorId = (<span class="type">long</span>) results.get(<span class="number">1</span>);</span><br><span class="line">    List&lt;Object&gt; lo = (List) results.get(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AggregationResult</span>(</span><br><span class="line">            (<span class="type">long</span>) lo.get(<span class="number">0</span>),</span><br><span class="line">            toListOfMap(lo),</span><br><span class="line">            cursorId</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">toListOfMap</span><span class="params">(List&lt;Object&gt; lo)</span> &#123;</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lo == <span class="literal">null</span> || lo.size() &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从索引 1 开始，跳过聚合总数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; lo.size(); i++) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">rowObj</span> <span class="operator">=</span> lo.get(i);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!(rowObj <span class="keyword">instanceof</span> List&lt;?&gt; row)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; row.size() - <span class="number">1</span>; j += <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> String.valueOf(row.get(j));</span><br><span class="line">            <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> row.get(j + <span class="number">1</span>);</span><br><span class="line">            map.put(key, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result.add(map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>完整生命周期总结</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FT.AGGREGATE ... WITHCURSOR      <span class="comment"># 创建游标（并返回第一批 + cursorId）</span></span><br><span class="line">        ↓</span><br><span class="line">FT.CURSOR READ                  <span class="comment"># 读取第 N 批</span></span><br><span class="line">        ↓</span><br><span class="line">FT.CURSOR READ                  <span class="comment"># 继续读取</span></span><br><span class="line">        ↓</span><br><span class="line">FT.CURSOR DEL（可选）           <span class="comment"># 提前释放资源</span></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>游标与 OFFSET/LIMIT 的区别</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>对比项</th>
<th>游标</th>
<th>OFFSET / LIMIT</th>
</tr>
</thead>
<tbody>
<tr>
<td>性能</td>
<td>高（流式）</td>
<td>大 OFFSET 性能差</td>
</tr>
<tr>
<td>适合大结果集</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>服务器状态</td>
<td>有</td>
<td>无</td>
</tr>
<tr>
<td>适用命令</td>
<td>FT.AGGREGATE</td>
<td>FT.SEARCH</td>
</tr>
</tbody>
</table>
<h3 id="五、词典-同义词（搜索增强）">五、词典 &amp; 同义词（搜索增强）</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>词典（DICT）和同义词（SYNONYM）只对 TEXT / TAG 搜索生效</p>
</li>
<li class="lvl-2">
<p>与 <code>FT.AGGREGATE</code> 无关，但与 <code>FT.SEARCH</code> 强相关。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FT.DICTADD</code></td>
<td>添加词</td>
</tr>
<tr>
<td><code>FT.DICTDEL</code></td>
<td>删除词</td>
</tr>
<tr>
<td><code>FT.DICTDUMP</code></td>
<td>查看词典</td>
</tr>
<tr>
<td><code>FT.SYNUPDATE</code></td>
<td>更新同义词</td>
</tr>
<tr>
<td><code>FT.SYNDUMP</code></td>
<td>查看同义词</td>
</tr>
</tbody>
</table>
<h4 id="词典">词典</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>词典作用：控制“合法搜索词”，比如将词典的内容发送给用户，让用户只能搜索这些词。</p>
<ul class="lvl-2">
<li class="lvl-4">⚠️ 词典本身不参与搜索匹配</li>
<li class="lvl-4">⚠️ 只是为搜索增强提供数据来源</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例：添加商品相关词</span></span><br><span class="line">FT.DICTADD product_dict iphone mobile phone android huawei</span><br><span class="line"><span class="comment"># 查看词典内容（FT.DICTDUMP）</span></span><br><span class="line">FT.DICTDUMP product_dict</span><br><span class="line"><span class="comment"># 删除词典中的词（FT.DICTDEL）</span></span><br><span class="line">FT.DICTDEL product_dict iphone</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rSearch.addDict(<span class="string">&quot;product_dict&quot;</span>, <span class="string">&quot;iphone&quot;</span>, <span class="string">&quot;mobile&quot;</span>,<span class="string">&quot;phone&quot;</span>,<span class="string">&quot;android&quot;</span>,<span class="string">&quot;huawei&quot;</span>);</span><br><span class="line">List&lt;String&gt; productDict = rSearch.dumpDict(<span class="string">&quot;product_dict&quot;</span>);</span><br><span class="line">rSearch.delDict(<span class="string">&quot;product_dict&quot;</span>, <span class="string">&quot;iphone&quot;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="同义词">同义词</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>同义词的作用: 让不同的搜索词 命中同一批文档</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">例如：</span><br><span class="line">  搜 iphone</span><br><span class="line">  搜 mobile</span><br><span class="line">  搜 phone</span><br><span class="line"></span><br><span class="line">  👉 命中同一批订单</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>添加 / 更新同义词（FT.SYNUPDATE）</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义“手机”的同义词集合，注意同义词是绑定到 索引 的</span></span><br><span class="line">FT.SYNUPDATE idx:user</span><br><span class="line">  phone_group</span><br><span class="line">  iphone mobile phone</span><br><span class="line"><span class="comment">## 参数说明</span></span><br><span class="line"><span class="comment"># phone_group: 同义词集合名称（你自己定义）</span></span><br><span class="line"><span class="comment"># iphone mobile phone: 添加同义词，多个词用空格隔开</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看同义词集合</span></span><br><span class="line">FT.SYNDUMP idx:user</span><br><span class="line"><span class="comment">## 输出</span></span><br><span class="line">1) <span class="string">&quot;phone&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;phone_group&quot;</span></span><br><span class="line">3) <span class="string">&quot;iphone&quot;</span></span><br><span class="line">4) 1) <span class="string">&quot;phone_group&quot;</span></span><br><span class="line">5) <span class="string">&quot;mobile&quot;</span></span><br><span class="line">6) 1) <span class="string">&quot;phone_group&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rSearch.updateSynonyms(<span class="string">&quot;idx:user&quot;</span>, <span class="string">&quot;phone_group&quot;</span>, <span class="string">&quot;iphone&quot;</span>, <span class="string">&quot;mobile&quot;</span>, <span class="string">&quot;phone&quot;</span>);</span><br><span class="line">Map&lt;String, List&lt;String&gt;&gt; synonyms = rSearch.dumpSynonyms(<span class="string">&quot;idx:user&quot;</span>);</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>此时我们再进行搜索，就会命中所有同义词</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FT.SEARCH idx:user <span class="string">&#x27;phone&#x27;</span></span><br><span class="line"><span class="comment"># 搜索结果</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 4</span><br><span class="line">2) <span class="string">&quot;user:10001&quot;</span></span><br><span class="line">3) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Alice Bob\&quot;,\&quot;age\&quot;:28,\&quot;vip\&quot;:\&quot;yes\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:199.99,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;,&#123;\&quot;amount\&quot;:59.9,\&quot;status\&quot;:\&quot;CREATED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a phone\&quot;,\&quot;items\&quot;:[\&quot;SpringCloud\xe6\x8a\x80\xe6\x9c\xaf\xe6\x8c\x87\xe5\x8d\x97\&quot;,\&quot;Shell\xe8\x84\x9a\xe6\x9c\xac\xe5\x9f\xba\xe7\xa1\x80\&quot;]&#125;&quot;</span></span><br><span class="line">4) <span class="string">&quot;user:10006&quot;</span></span><br><span class="line">5) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Frank\&quot;,\&quot;age\&quot;:27,\&quot;vip\&quot;:\&quot;no\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:499,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;,&#123;\&quot;amount\&quot;:129,\&quot;status\&quot;:\&quot;CREATED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a phone\&quot;,\&quot;items\&quot;:[\&quot;Redis\xe5\xbc\x80\xe5\x8f\x91\xe5\xae\x9e\xe6\x88\x98\&quot;,\&quot;MongoDB\xe4\xbb\x8e\xe5\x85\xa5\xe9\x97\xa8\xe5\x88\xb0\xe5\xae\x9e\xe6\x88\x98\&quot;]&#125;&quot;</span></span><br><span class="line">6) <span class="string">&quot;user:10002&quot;</span></span><br><span class="line">7) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Bob Frank\&quot;,\&quot;age\&quot;:35,\&quot;vip\&quot;:\&quot;no\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:899.0,\&quot;status\&quot;:\&quot;PAID\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a iphone\&quot;,\&quot;items\&quot;:[\&quot;Linux\xe5\xbf\x85\xe7\x9f\xa5\xe5\xbf\x85\xe4\xbc\x9a\&quot;,\&quot;Java\xe5\xa4\x9a\xe7\xba\xbf\xe7\xa8\x8b\xe8\xaf\xa6\xe8\xa7\xa3\&quot;]&#125;&quot;</span></span><br><span class="line">8) <span class="string">&quot;user:10003&quot;</span></span><br><span class="line">9) 1) <span class="string">&quot;$&quot;</span></span><br><span class="line">   2) <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Carol\&quot;,\&quot;age\&quot;:22,\&quot;vip\&quot;:\&quot;no\&quot;,\&quot;orders\&quot;:[&#123;\&quot;amount\&quot;:19.9,\&quot;status\&quot;:\&quot;CANCELLED\&quot;&#125;],\&quot;comment\&quot;:\&quot;I have a mobile\&quot;,\&quot;items\&quot;:[\&quot;MySQL\xe4\xbb\x8e\xe5\x88\xa0\xe5\xba\x93\xe5\x88\xb0\xe8\xb7\x91\xe8\xb7\xaf\&quot;,\&quot;Oracle\xe5\xbc\x80\xe5\x8f\x91\xe5\xae\x9e\xe8\xb7\xb5\&quot;]&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>词典 + 同义词的组合使用</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 用户输入: 手机</span><br><span class="line">2. 前端 / 服务端 → 从 product_dict 给提示</span><br><span class="line">3. 搜索请求 → FT.SEARCH</span><br><span class="line">4. RediSearch → 同义词扩展</span><br><span class="line">5. 返回统一结果</span><br></pre></td></tr></table></figure>
<h3 id="六、FT-SPELLCHECK（拼写纠错）">六、FT.SPELLCHECK（拼写纠错）</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>FT.SPELLCHECK 用于对用户输入的搜索词进行拼写纠错与相似词推荐</p>
</li>
<li class="lvl-2">
<p>它并不会真正执行搜索，而是：<br>
✅ 分析输入词是否存在于索引词典<br>
✅ 如果不存在，基于编辑距离（Levenshtein）给出候选纠错词<br>
✅ 支持自定义词典（Dictionary）增强效果</p>
</li>
<li class="lvl-2">
<p>🎯 核心目标</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>能力</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>拼写纠错</td>
<td>iphone → ipohne</td>
</tr>
<tr>
<td>模糊推荐</td>
<td>用户拼错关键词</td>
</tr>
<tr>
<td>搜索前置纠错</td>
<td>提升召回率</td>
</tr>
<tr>
<td>自动学习索引词</td>
<td>自动从索引词库构建词典</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>基本语法</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FT.SPELLCHECK index query</span><br><span class="line">  [DISTANCE maxDistance]</span><br><span class="line">  [TERMS &#123;INCLUDE | EXCLUDE&#125; dictionary ...]</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>参数说明表</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>index</td>
<td>索引名称</td>
<td>必填</td>
</tr>
<tr>
<td>query</td>
<td>用户输入词</td>
<td>必填</td>
</tr>
<tr>
<td>DISTANCE</td>
<td>最大编辑距离（1~4）</td>
<td>1</td>
</tr>
<tr>
<td>TERMS INCLUDE</td>
<td>仅使用指定词典</td>
<td>全部</td>
</tr>
<tr>
<td>TERMS EXCLUDE</td>
<td>排除指定词典</td>
<td>无</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>示例</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">FT.SPELLCHECK idx:user <span class="string">&#x27;iphnoe&#x27;</span> DISTANCE 2</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">1) 1) TERM         <span class="comment"># 固定标识，表示这是一个被分析的词</span></span><br><span class="line">   2) <span class="string">&quot;iphnoe&quot;</span>     <span class="comment"># 用户输入词</span></span><br><span class="line">   3) 1) 1) <span class="string">&quot;0.4&quot;</span>  <span class="comment"># 相似度评分，越小越相似</span></span><br><span class="line">         2) <span class="string">&quot;iphone&quot;</span> <span class="comment"># 推荐词，建议替换词</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索多个词</span></span><br><span class="line">FT.SPELLCHECK idx:user <span class="string">&#x27;iphnoe linu&#x27;</span> DISTANCE 2</span><br><span class="line">1) 1) TERM</span><br><span class="line">   2) <span class="string">&quot;iphnoe&quot;</span></span><br><span class="line">   3) 1) 1) <span class="string">&quot;0.4&quot;</span></span><br><span class="line">         2) <span class="string">&quot;iphone&quot;</span></span><br><span class="line">2) 1) TERM</span><br><span class="line">   2) <span class="string">&quot;linu&quot;</span></span><br><span class="line">   3) 1) 1) <span class="string">&quot;0.4&quot;</span></span><br><span class="line">         2) <span class="string">&quot;linux&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加编辑距离会显示更多的候选词</span></span><br><span class="line">FT.SPELLCHECK idx:user <span class="string">&#x27;phnoe&#x27;</span> DISTANCE 3</span><br><span class="line">1) 1) TERM</span><br><span class="line">   2) <span class="string">&quot;phnoe&quot;</span></span><br><span class="line">   3) 1) 1) <span class="string">&quot;4&quot;</span></span><br><span class="line">         2) <span class="string">&quot;have&quot;</span></span><br><span class="line">      2) 1) <span class="string">&quot;0.8&quot;</span></span><br><span class="line">         2) <span class="string">&quot;phone&quot;</span></span><br><span class="line">      3) 1) <span class="string">&quot;0.4&quot;</span></span><br><span class="line">         2) <span class="string">&quot;iphone&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Map&lt;String, Double&gt;&gt; spellcheck = rSearch.spellcheck(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iphnoe linu&quot;</span>,</span><br><span class="line">        SpellcheckOptions.defaults().distance(<span class="number">2</span>));</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>score = 编辑距离 / max(len(用户输入词), len(候选词))，但并不是总是这样</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>输入</th>
<th>候选</th>
<th>编辑距离</th>
<th>maxLen</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>phnoe</td>
<td>iphone</td>
<td>2</td>
<td>6</td>
<td>2/6 = 0.333 ≈ 0.4</td>
</tr>
<tr>
<td>phnoe</td>
<td>phone</td>
<td>1</td>
<td>5</td>
<td>0.2 → ~0.8（内部权重可能反转或调整）</td>
</tr>
<tr>
<td>phnoe</td>
<td>have</td>
<td></td>
<td></td>
<td>“4” → 表示 phnoe 与 have 的编辑距离是 4</td>
</tr>
</tbody>
</table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">phnoe → have</span><br><span class="line">p → h (1)</span><br><span class="line">h → a (2)</span><br><span class="line">n → v (3)</span><br><span class="line">o → e (4)</span><br><span class="line">e → (删除) (5)   （不同算法可能计为 4 或 5）</span><br><span class="line">该词明显是低质量候选，只是 DISTANCE=3/4 时被勉强收录。</span><br><span class="line"></span><br><span class="line">业务侧做合理过滤</span><br><span class="line">如果 score &gt;= 2     → 直接丢弃（明显噪声）</span><br><span class="line">如果 score &lt;= 1.0   → 可信候选</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>建议策略</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>场景</th>
<th>建议</th>
</tr>
</thead>
<tbody>
<tr>
<td>搜索框实时提示</td>
<td>1</td>
</tr>
<tr>
<td>搜索提交后纠错</td>
<td>2</td>
</tr>
<tr>
<td>模糊容错系统</td>
<td>2~3</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>词典增强（Dictionary Integration）</p>
</li>
</ul>
<blockquote>
<p>通过 FT.DICTADD / FT.DICTDEL 人工维护一个或多个词典，把“业务词汇”主动注入到 SpellCheck 的候选词空间中。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">默认情况下：</span><br><span class="line">SpellCheck 只能从 索引倒排词典（Inverted Index Terms） 中生成候选词。</span><br><span class="line"></span><br><span class="line">如果某些词：</span><br><span class="line">  不在索引里</span><br><span class="line">  出现频率极低</span><br><span class="line">  属于专有名词</span><br><span class="line">  新词、品牌词</span><br><span class="line">那么 SpellCheck 很可能无法正确纠错。</span><br><span class="line"></span><br><span class="line">词典增强解决的正是这个问题。</span><br><span class="line"></span><br><span class="line">用户输入 → Tokenizer → 拆词 →</span><br><span class="line">  ↓</span><br><span class="line">候选源合并：</span><br><span class="line">  - 倒排索引词典</span><br><span class="line">  - 自定义词典（FT.DICTADD）</span><br><span class="line">  ↓</span><br><span class="line">编辑距离计算</span><br><span class="line">  ↓</span><br><span class="line">候选排序</span><br><span class="line">  ↓</span><br><span class="line">返回纠错词</span><br><span class="line"></span><br><span class="line">✅ SpellCheck 的候选空间被人为扩大。</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FT.DICTADD dict:tech iphone ipad macbook airpods</span><br><span class="line"><span class="comment"># 使用指定词典纠错，白名单</span></span><br><span class="line">FT.SPELLCHECK idx:user <span class="string">&quot;macboo&quot;</span> TERMS INCLUDE dict:tech</span><br><span class="line">1) 1) TERM</span><br><span class="line">   2) <span class="string">&quot;macboo&quot;</span></span><br><span class="line">   3) 1) 1) <span class="string">&quot;0.4&quot;</span></span><br><span class="line">         2) <span class="string">&quot;macbook&quot;</span></span><br><span class="line"><span class="comment"># 排除词典，黑名单</span></span><br><span class="line">FT.SPELLCHECK idx:user <span class="string">&quot;iphnoe&quot;</span> TERMS EXCLUDE dict:noise</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Map&lt;String, Double&gt;&gt; spellcheck = rSearch.spellcheck(</span><br><span class="line">        <span class="string">&quot;idx:user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;macboo&quot;</span>,</span><br><span class="line">        SpellcheckOptions.defaults()</span><br><span class="line">                .distance(<span class="number">2</span>)</span><br><span class="line">                .includedTerms(<span class="string">&quot;dict:tech&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ul class="lvl-0">
<li class="lvl-2">
<p>FT.SPELLCHECK 与 Suggest 的差异对比（关键）</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>维度</th>
<th>FT.SPELLCHECK</th>
<th>FT.SUGGET</th>
</tr>
</thead>
<tbody>
<tr>
<td>目标</td>
<td>拼写纠错</td>
<td>前缀联想</td>
</tr>
<tr>
<td>输入</td>
<td>完整词</td>
<td>前缀</td>
</tr>
<tr>
<td>返回</td>
<td>相似词</td>
<td>补全词</td>
</tr>
<tr>
<td>数据来源</td>
<td>索引词典</td>
<td>独立 Trie</td>
</tr>
<tr>
<td>是否排序</td>
<td>否（距离优先）</td>
<td>是（score）</td>
</tr>
<tr>
<td>是否模糊</td>
<td>编辑距离</td>
<td>前缀 + FUZZY</td>
</tr>
<tr>
<td>使用阶段</td>
<td>搜索前修正</td>
<td>输入过程中</td>
</tr>
</tbody>
</table>
<h3 id="已废弃命令（不建议使用）">已废弃命令（不建议使用）</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>状态</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FT.CONFIG GET</code></td>
<td>Reids8 将其标记为 Deprecated</td>
<td>使用 <code>CONFIG GET search-*</code></td>
</tr>
<tr>
<td><code>FT.CONFIG SET</code></td>
<td>Reids8 将其标记为 Deprecated</td>
<td>同上</td>
</tr>
<tr>
<td><code>FT.TAGVALS</code></td>
<td>已经标记为 Deprecated</td>
<td>改用 AGGREGATE</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>⚠️ 这里要注意，只有 <code>Redis 8.0.0</code> 以上版本支持 <code>CONFIG GET search-*</code>。</p>
</li>
</ul>
<h4 id="FT-CONFIG-GET-和-CONFIG-GET-search-对应参数整理"><code>FT.CONFIG GET *</code> 和 <code>CONFIG GET search-*</code> 对应参数整理</h4>
<ul class="lvl-0">
<li class="lvl-2">
<p>1️⃣ 索引基本 / 文档表配置</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>FT.CONFIG 参数</th>
<th>FT.CONFIG 值</th>
<th>CONFIG search-* 参数</th>
<th>CONFIG 值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>MINPREFIX</td>
<td>2</td>
<td>search-min-prefix</td>
<td>2</td>
<td>自动补全最小前缀长度</td>
</tr>
<tr>
<td>MINSTEMLEN</td>
<td>4</td>
<td>search-min-stem-len</td>
<td>4</td>
<td>最小词干长度</td>
</tr>
<tr>
<td>MAXDOCTABLESIZE</td>
<td>1000000</td>
<td>search-max-doctablesize</td>
<td>1000000</td>
<td>最大文档表大小</td>
</tr>
<tr>
<td>MAXSEARCHRESULTS</td>
<td>1000000</td>
<td>search-max-search-results</td>
<td>1000000</td>
<td>搜索结果限制</td>
</tr>
<tr>
<td>MAXAGGREGATERESULTS</td>
<td>unlimited</td>
<td>search-max-aggregate-results</td>
<td>2147483648</td>
<td>聚合结果限制</td>
</tr>
<tr>
<td>MAXEXPANSIONS</td>
<td>200</td>
<td>search-max-prefix-expansions</td>
<td>200</td>
<td>前缀扩展限制</td>
</tr>
<tr>
<td>MAXPREFIXEXPANSIONS</td>
<td>200</td>
<td>search-max-prefix-expansions</td>
<td>200</td>
<td>前缀扩展限制（兼容）</td>
</tr>
<tr>
<td>RAW_DOCID_ENCODING</td>
<td>false</td>
<td>search-raw-docid-encoding</td>
<td>no</td>
<td>文档ID是否原始编码</td>
</tr>
<tr>
<td>UPGRADE_INDEX</td>
<td>Upgrade config for upgrading</td>
<td>N/A</td>
<td>N/A</td>
<td>升级索引配置提示</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>2️⃣ 查询 / 评分相关配置</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>FT.CONFIG 参数</th>
<th>FT.CONFIG 值</th>
<th>CONFIG search-* 参数</th>
<th>CONFIG 值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>TIMEOUT</td>
<td>500</td>
<td>search-timeout</td>
<td>500</td>
<td>查询超时（ms）</td>
</tr>
<tr>
<td>ON_TIMEOUT</td>
<td>return</td>
<td>search-on-timeout</td>
<td>return</td>
<td>超时策略</td>
</tr>
<tr>
<td>DEFAULT_SCORER</td>
<td>TFIDF</td>
<td>search-default-scorer</td>
<td>BM25STD</td>
<td>默认评分算法</td>
</tr>
<tr>
<td>BM25STD_TANH_FACTOR</td>
<td>4</td>
<td>search-bm25std-tanh-factor</td>
<td>4</td>
<td>BM25 调整因子</td>
</tr>
<tr>
<td>MULTI_TEXT_SLOP</td>
<td>100</td>
<td>search-multi-text-slop</td>
<td>100</td>
<td>多字段查询 slop</td>
</tr>
<tr>
<td>DEFAULT_DIALECT</td>
<td>1</td>
<td>search-default-dialect</td>
<td>1</td>
<td>查询方言</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>3️⃣ GC / 后台索引配置</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>FT.CONFIG 参数</th>
<th>FT.CONFIG 值</th>
<th>CONFIG search-* 参数</th>
<th>CONFIG 值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>NOGC</td>
<td>false</td>
<td>search-no-gc</td>
<td>no</td>
<td>禁用 GC</td>
</tr>
<tr>
<td>GC_POLICY</td>
<td>fork</td>
<td>search-fork-gc-policy (implicit)</td>
<td>fork</td>
<td>GC 策略</td>
</tr>
<tr>
<td>FORKGC_SLEEP_BEFORE_EXIT</td>
<td>0</td>
<td>search-fork-gc-sleep-before-exit</td>
<td>0</td>
<td>fork GC 退出前睡眠</td>
</tr>
<tr>
<td>FORK_GC_RUN_INTERVAL</td>
<td>30</td>
<td>search-fork-gc-run-interval</td>
<td>30</td>
<td>fork GC 执行间隔（秒）</td>
</tr>
<tr>
<td>FORK_GC_CLEAN_THRESHOLD</td>
<td>100</td>
<td>search-fork-gc-clean-threshold</td>
<td>100</td>
<td>fork GC 清理阈值</td>
</tr>
<tr>
<td>FORK_GC_RETRY_INTERVAL</td>
<td>5</td>
<td>search-fork-gc-retry-interval</td>
<td>5</td>
<td>fork GC 重试间隔</td>
</tr>
<tr>
<td>FORK_GC_CLEAN_NUMERIC_EMPTY_NODES</td>
<td>true</td>
<td>search-_numeric-compress</td>
<td>no</td>
<td>清理空数值节点</td>
</tr>
<tr>
<td>GCSCANSIZE</td>
<td>100</td>
<td>search-gc-scan-size</td>
<td>100</td>
<td>GC 每次扫描大小</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>4️⃣ 游标 / 线程 / 并发配置</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>FT.CONFIG 参数</th>
<th>FT.CONFIG 值</th>
<th>CONFIG search-* 参数</th>
<th>CONFIG 值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>CURSOR_MAX_IDLE</td>
<td>300000</td>
<td>search-cursor-max-idle</td>
<td>300000</td>
<td>游标最大空闲时间</td>
</tr>
<tr>
<td>INDEX_CURSOR_LIMIT</td>
<td>128</td>
<td>search-index-cursor-limit</td>
<td>128</td>
<td>单索引游标限制</td>
</tr>
<tr>
<td>UNION_ITERATOR_HEAP</td>
<td>20</td>
<td>search-union-iterator-heap</td>
<td>20</td>
<td>UNION 查询堆大小</td>
</tr>
<tr>
<td>NO_MEM_POOLS</td>
<td>false</td>
<td>search-no-mem-pools</td>
<td>no</td>
<td>禁用内存池</td>
</tr>
<tr>
<td>_FREE_RESOURCE_ON_THREAD</td>
<td>true</td>
<td>search-_free-resource-on-thread</td>
<td>yes</td>
<td>线程释放资源</td>
</tr>
<tr>
<td>search_min_operation_workers</td>
<td>N/A</td>
<td>search-min-operation-workers</td>
<td>4</td>
<td>最小操作线程数</td>
</tr>
<tr>
<td>search-workers</td>
<td>N/A</td>
<td>search-workers</td>
<td>0</td>
<td>工作线程数</td>
</tr>
<tr>
<td>search-workers-priority-bias-threshold</td>
<td>N/A</td>
<td>search-workers-priority-bias-threshold</td>
<td>1</td>
<td>线程优先级偏置</td>
</tr>
<tr>
<td>INDEXER_YIELD_EVERY_OPS</td>
<td>1000</td>
<td>search-indexer-yield-every-ops</td>
<td>1000</td>
<td>索引器 yield 每操作数</td>
</tr>
</tbody>
</table>
<ul class="lvl-0">
<li class="lvl-2">
<p>5️⃣ 实验 / 内部 /其他</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>FT.CONFIG 参数</th>
<th>FT.CONFIG 值</th>
<th>CONFIG search-* 参数</th>
<th>CONFIG 值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>EXTLOAD</td>
<td>nil</td>
<td>search-ext-load</td>
<td>“”</td>
<td>外部加载模块</td>
</tr>
<tr>
<td>FRISOINI</td>
<td>nil</td>
<td>search-friso-ini</td>
<td>“”</td>
<td>中文分词初始化</td>
</tr>
<tr>
<td>ENABLE_UNSTABLE_FEATURES</td>
<td>false</td>
<td>search-enable-unstable-features</td>
<td>no</td>
<td>启用实验特性</td>
</tr>
<tr>
<td>_PRINT_PROFILE_CLOCK</td>
<td>true</td>
<td>search-_print-profile-clock</td>
<td>yes</td>
<td>Profiling 开关</td>
</tr>
<tr>
<td>_NUMERIC_RANGES_PARENTS</td>
<td>0</td>
<td>search-_numeric-ranges-parents</td>
<td>0</td>
<td>数值范围父节点数</td>
</tr>
<tr>
<td>VSS_MAX_RESIZE</td>
<td>0</td>
<td>search-vss-max-resize</td>
<td>1024</td>
<td>向量索引最大重分配</td>
</tr>
<tr>
<td>PARTIAL_INDEXED_DOCS</td>
<td>false</td>
<td>search-partial-indexed-docs</td>
<td>no</td>
<td>部分索引文档标记</td>
</tr>
<tr>
<td>_PRIORITIZE_INTERSECT_UNION_CHILDREN</td>
<td>false</td>
<td>search-_prioritize-intersect-union-children</td>
<td>no</td>
<td>优先处理 INTERSECT/UNION 子节点</td>
</tr>
<tr>
<td>_BG_INDEX_MEM_PCT_THR</td>
<td>100</td>
<td>search-_bg-index-mem-pct-thr</td>
<td>100</td>
<td>后台索引内存阈值</td>
</tr>
<tr>
<td>_NUMERIC_COMPRESS</td>
<td>false</td>
<td>search-_numeric-compress</td>
<td>no</td>
<td>数值压缩</td>
</tr>
<tr>
<td>_BG_INDEX_OOM_PAUSE_TIME</td>
<td>0</td>
<td>search-_bg-index-oom-pause-time</td>
<td>0</td>
<td>后台索引 OOM 暂停时间</td>
</tr>
</tbody>
</table>

    </div>

    
    
    

    <footer class="post-footer">
<div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>

<div>
    <!-- 分享 css & js 此处会被Meting.js干扰，暂时关闭-->
    <link rel="stylesheet" href="/social-share/share.min.css">
    <script src="/social-share/share.min.js"></script>
    <div class="social-share" style="float:right">分享到：</div>
</div>

          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/uploads/wechatpay.jpg" alt="飘逸峰 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/uploads/alipay.jpg" alt="飘逸峰 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>飘逸峰
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://blog.hanqunfeng.com/2026/01/05/redis7-module-RediSearch-study/" title="RediSearch 开发实战">https://blog.hanqunfeng.com/2026/01/05/redis7-module-RediSearch-study/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="http://www.jianshu.com/users/763c53661578/latest_articles">
            <span class="icon">
              <i class="fa-solid fa-book-open"></i>
            </span>

            <span class="label">简书</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="http://blog.csdn.net/hanqunfeng">
            <span class="icon">
              <i class="fa-solid fa-c"></i>
            </span>

            <span class="label">CSDN</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa-solid fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/redis/" rel="tag"><i class="fa fa-tag"></i> redis</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/12/26/redis7-module-RediSearch/" rel="prev" title="Redis 扩展模块 -- RediSearch 的安装方法">
                  <i class="fa fa-angle-left"></i> Redis 扩展模块 -- RediSearch 的安装方法
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2026/01/06/redis7-datatype-17-AutoSuggest/" rel="next" title="Redis 命令及数据类型 -- AutoSuggest">
                  Redis 命令及数据类型 -- AutoSuggest <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备2021006748号-1 </a>
  </div>
  <div class="copyright">
    &copy; 2016 – 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa-solid fa-user"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">飘逸峰</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">768k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">46:34</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa-solid fa-circle-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa-solid fa-chart-area"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
<span id="show_hidden">🇨🇳</span>

<style>

  .toBottomClass {
    color:#333333;
    font-size:38px;
    background: #ffffff;
    width: 3rem;
    height: 3rem;
    position: fixed;
    border-radius: 50%;
    border: none;
    right: 32px;
    bottom: 116px;
    left: unset;
    cursor: pointer;
    transition: all 0.5s ease;
    display: flex;
    justify-content: center;
    align-items: center;
}

 .hover {
            color: #FF9966;
            cursor:pointer;
        }
</style>


<script type="text/javascript">
          jQuery(function ($) {

            // 控制黑暗和白天按钮旋转180度
            var current = 0;
						$('#taiji').click(function(){
                current = (current+180)%360;
                this.style.transform = 'rotate('+current+'deg)';
            });

            $('.darkmode-toggle').before('<div class="toBottom toBottomClass" title="直达底部"><i class="fa fa-arrow-circle-down" aria-hidden="true"/><div>');
          });
</script>

<script type="text/javascript">

    let a = true;

    let gao=0;

    let no_clear = true;
    var timer;

    jQuery(function ($) {

        $(".toBottom").bind("mouseover", function () {
            $(this).addClass("hover");
        });


        $(".toBottom").bind("mouseout", function () {
            $(this).removeClass("hover");
        });

        $(".toBottom").on("click",function () {
            //只有在非最底部时才能触发事件，避免最底部连续点击造成无法向上滚动
            if(a){
                if(gao == 0){
                    //设置定时器
                    timer=setInterval("scrollwindow()",10);
                }else{
                    no_clear = false;
                    $("html,body").animate({ scrollTop: gao }, 1000);//gao为滚动条的位置，1000为滚动的时延
                }

            }

        });
    });

    //滚动函数

    function scrollwindow(){
        gao=gao+100;
        window.scroll(0,gao);
    }

    //清除定时器
    function clear(){
        if(no_clear){
            clearInterval(timer);
        }
    }

    //滚动到底部触发函数
    window.onscroll = function(){
        //变量scrollTop是滚动条滚动时，距离顶部的距离
        var scrollTop = document.documentElement.scrollTop||document.body.scrollTop;
        //变量windowHeight是可视区的高度
        var windowHeight = document.documentElement.clientHeight || document.body.clientHeight;
        //变量scrollHeight是滚动条的总高度
        var scrollHeight = document.documentElement.scrollHeight||document.body.scrollHeight;
               //滚动条到底部的条件
            if(scrollTop+windowHeight==scrollHeight){
                
                
                clear();
                a = false;
             }else{
                a = true;
             }
        }


</script>


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/hanqunfeng" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"dark","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"OGMvTuds9s7tzvWNopJHAJ5W-gzGzoHsz","app_key":"A0HB73VDqWDODaRS4yyiW6V8","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin="anonymous">
  <script class="next-config" data-name="katex" type="application/json">{"copy_tex_js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js","integrity":"sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="}}</script>
  <script src="/js/third-party/math/katex.js"></script>


<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: '32px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '<img id="taiji" src="/images_glob/yin-yang_262f.png" title="外观切换"/>',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"hanqunfeng/blog_comments","issue_term":"title","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

<style>
#divcss5{
    margin:0 auto;
    border:0px solid #000;
    width: 100%;
    text-align:center;
    }
</style>

<div id="divcss5">



</div>
<!-- hexo injector body_end start --><script src="/assets/mmedia/mmedia-loader.js"></script><!-- hexo injector body_end end --></body>
</html>
