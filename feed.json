{"version":"https://jsonfeed.org/version/1","name":"é£˜é€¸å³°çš„åšå®¢","home_page_url":"https://blog.hanqunfeng.com","feed_url":"https://blog.hanqunfeng.com/feed.json","author":{"name":"é£˜é€¸å³°"},"items":[{"id":"https://blog.hanqunfeng.com/2026/01/10/redis7-command-01-transaction/","url":"https://blog.hanqunfeng.com/2026/01/10/redis7-command-01-transaction/","title":"Redis å‘½ä»¤è¯¦è§£ï¼šäº‹åŠ¡ Transaction","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"äº‹åŠ¡-Transaction-å‘½ä»¤\">äº‹åŠ¡ Transaction å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redis äº‹åŠ¡å‘½ä»¤æ€»è§ˆè¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>æ‰€å¤„é˜¶æ®µ</th>\n<th>è¿”å›å€¼</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>MULTI</strong></td>\n<td>å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œä¹‹åçš„å‘½ä»¤è¿›å…¥é˜Ÿåˆ—</td>\n<td>äº‹åŠ¡å¼€å§‹</td>\n<td><code>OK</code></td>\n<td>æ‰¹é‡åŸå­æ‰§è¡Œå¤šä¸ªå‘½ä»¤</td>\n</tr>\n<tr>\n<td><strong>EXEC</strong></td>\n<td>æ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤</td>\n<td>äº‹åŠ¡æäº¤</td>\n<td>æ•°ç»„ï¼ˆæ¯ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœï¼‰æˆ– <code>nil</code></td>\n<td>æäº¤äº‹åŠ¡</td>\n</tr>\n<tr>\n<td><strong>DISCARD</strong></td>\n<td>æ”¾å¼ƒäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤</td>\n<td>äº‹åŠ¡å–æ¶ˆ</td>\n<td><code>OK</code></td>\n<td>å›æ»šæœªæ‰§è¡Œçš„äº‹åŠ¡</td>\n</tr>\n<tr>\n<td><strong>WATCH key [key â€¦]</strong></td>\n<td>ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ª key æ˜¯å¦è¢«ä¿®æ”¹ï¼ˆä¹è§‚é”ï¼‰</td>\n<td>äº‹åŠ¡å‰</td>\n<td><code>OK</code></td>\n<td>å¹¶å‘æ§åˆ¶ã€é˜²æ­¢è¦†ç›–æ›´æ–°</td>\n</tr>\n<tr>\n<td><strong>UNWATCH</strong></td>\n<td>å–æ¶ˆå¯¹æ‰€æœ‰ key çš„ç›‘æ§</td>\n<td>äº‹åŠ¡å‰ / ä¸­</td>\n<td><code>OK</code></td>\n<td>ä¸»åŠ¨é‡Šæ”¾ç›‘æ§</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"MULTI-EXEC-â€”â€”-åŸºæœ¬äº‹åŠ¡ç¤ºä¾‹\">MULTI / EXEC â€”â€” åŸºæœ¬äº‹åŠ¡ç¤ºä¾‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šåŸå­é€’å¢ä¸¤ä¸ªè®¡æ•°å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; MULTI</span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; INCR counter:a</span><br><span class=\"line\">QUEUED</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; INCR counter:b</span><br><span class=\"line\">QUEUED</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; EXEC</span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">MULTI åï¼Œæ‰€æœ‰å‘½ä»¤åªä¼šè¿›å…¥é˜Ÿåˆ—ï¼Œè¿”å› QUEUEDï¼Œä¸ä¼šç«‹å³æ‰§è¡Œã€‚</li>\n<li class=\"lvl-6\">EXEC æ—¶æ‰çœŸæ­£æ‰§è¡Œã€‚</li>\n<li class=\"lvl-6\">Redis ä¿è¯ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-10\">å‘½ä»¤é¡ºåºæ‰§è¡Œ</li>\n<li class=\"lvl-10\">æ‰§è¡ŒæœŸé—´ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯æ’å…¥å‘½ä»¤</li>\n</ul>\n</li>\n<li class=\"lvl-6\">ä½†ä¸æ”¯æŒå›æ»šï¼ˆæŸæ¡å‘½ä»¤å¤±è´¥ï¼Œä¸ä¼šè‡ªåŠ¨æ’¤é”€å·²æ‰§è¡Œçš„å‘½ä»¤ï¼‰ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"DISCARD-â€”â€”-æ”¾å¼ƒäº‹åŠ¡\">DISCARD â€”â€” æ”¾å¼ƒäº‹åŠ¡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå–æ¶ˆäº‹åŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; MULTI</span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; SET k1 v1</span><br><span class=\"line\">QUEUED</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; SET k2 v2</span><br><span class=\"line\">QUEUED</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; DISCARD</span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; GET k1</span><br><span class=\"line\">(nil)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">DISCARD ä¼šï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-10\">æ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—</li>\n<li class=\"lvl-10\">é€€å‡ºäº‹åŠ¡çŠ¶æ€</li>\n</ul>\n</li>\n<li class=\"lvl-6\">é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ ä¸ä¼šè¢«æ‰§è¡Œã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"WATCH-EXEC-â€”â€”-ä¹è§‚é”ç¤ºä¾‹\">WATCH / EXEC â€”â€” ä¹è§‚é”ç¤ºä¾‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹è§‚é”äº‹åŠ¡æ¨¡æ¿</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WATCH key</span><br><span class=\"line\">è¯»å–å¹¶æ ¡éªŒæ•°æ®</span><br><span class=\"line\">MULTI</span><br><span class=\"line\">  å†™æ“ä½œ...</span><br><span class=\"line\">EXEC</span><br><span class=\"line\">å¦‚æœè¿”å› nil â†’ é‡è¯•</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯ï¼šå®ç°ä¸€ä¸ªå®‰å…¨çš„ä½™é¢æ‰£å‡é€»è¾‘ï¼Œå¦‚æœä½™é¢åœ¨äº‹åŠ¡æ‰§è¡Œå‰è¢«åˆ«äººä¿®æ”¹ï¼Œåˆ™æ”¾å¼ƒæœ¬æ¬¡äº‹åŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®¢æˆ·ç«¯ A</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SET balance 100</span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; WATCH balance</span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; GET balance</span><br><span class=\"line\"><span class=\"string\">&quot;100&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; MULTI</span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; DECRBY balance 30</span><br><span class=\"line\">QUEUED</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¢æˆ·ç«¯ Bï¼ˆå¹¶å‘ä¿®æ”¹ï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; INCRBY balance 50</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 150</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¢æˆ·ç«¯ A æäº¤äº‹åŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; EXEC</span><br><span class=\"line\">(nil)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å› ä¸º balance åœ¨ WATCH ä¹‹åè¢«å®¢æˆ·ç«¯ B ä¿®æ”¹è¿‡ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-10\">Redis åˆ¤å®šç›‘æ§å¤±è´¥</li>\n<li class=\"lvl-10\">EXEC è¿”å› nil</li>\n<li class=\"lvl-10\">äº‹åŠ¡ä¸ä¼šæ‰§è¡Œ</li>\n</ul>\n</li>\n<li class=\"lvl-6\">è¿™æ˜¯å…¸å‹çš„ ä¹è§‚é”ï¼ˆCASï¼‰æœºåˆ¶ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"UNWATCH-â€”â€”-å–æ¶ˆç›‘æ§\">UNWATCH â€”â€” å–æ¶ˆç›‘æ§</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå–æ¶ˆ WATCH ç›‘æ§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; WATCH k1 k2</span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; UNWATCH</span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å–æ¶ˆæ‰€æœ‰è¢«ç›‘æ§çš„ keyã€‚</li>\n<li class=\"lvl-6\">å¸¸è§ç”¨é€”ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-10\">é€»è¾‘åˆ¤æ–­å¤±è´¥ï¼Œä¸å†ç»§ç»­äº‹åŠ¡</li>\n<li class=\"lvl-10\">ä¸»åŠ¨é‡Šæ”¾ç›‘æ§ï¼Œé¿å…è¯¯è§¦å‘äº‹åŠ¡å¤±è´¥</li>\n</ul>\n</li>\n<li class=\"lvl-6\">å¦‚æœæ‰§è¡Œäº† EXEC æˆ– DISCARDï¼ŒRedis ä¼šè‡ªåŠ¨ UNWATCHã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"å…³é”®è¡Œä¸ºæ€»ç»“ï¼ˆå·¥ç¨‹è§†è§’ï¼‰\">å…³é”®è¡Œä¸ºæ€»ç»“ï¼ˆå·¥ç¨‹è§†è§’ï¼‰</h2>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>è¡Œä¸º</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åŸå­æ€§</td>\n<td><code>EXEC</code> å†…å‘½ä»¤é¡ºåºæ‰§è¡Œï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯æ’å…¥</td>\n</tr>\n<tr>\n<td>éš”ç¦»æ€§</td>\n<td>ä¸æ˜¯æ•°æ®åº“çº§äº‹åŠ¡éš”ç¦»ï¼Œä»…ä¿è¯æ‰§è¡ŒæœŸä¸²è¡Œ</td>\n</tr>\n<tr>\n<td>å›æ»šèƒ½åŠ›</td>\n<td>âŒ ä¸æ”¯æŒå›æ»š</td>\n</tr>\n<tr>\n<td>å¹¶å‘æ§åˆ¶</td>\n<td>é€šè¿‡ <code>WATCH</code> å®ç°ä¹è§‚é”</td>\n</tr>\n<tr>\n<td>å¤±è´¥è¡Œä¸º</td>\n<td>WATCH å†²çª â†’ <code>EXEC</code> è¿”å› <code>nil</code></td>\n</tr>\n<tr>\n<td>æ€§èƒ½</td>\n<td>é˜Ÿåˆ—å…¥å†…å­˜ï¼Œæ‰§è¡Œéå¸¸å¿«</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"SpringBoot-ä¸­ä½¿ç”¨-Redis-äº‹åŠ¡\">SpringBoot ä¸­ä½¿ç”¨ Redis äº‹åŠ¡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®é™…é¡¹ç›®ä¸­Redisäº‹åŠ¡å¾ˆå°‘ä½¿ç”¨ï¼Œå› ä¸º<code>WATCH + MULTI</code> çš„æ€§èƒ½ä¸å¦‚ <code>Lua</code> æˆ– <code>INCR</code> ç­‰åŸå­æŒ‡ä»¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŒä¸€äº‹åŠ¡ä»£ç å¿…é¡»åœ¨åŒä¸€çº¿ç¨‹å†…å®Œæˆï¼Œæ¨èä½¿ç”¨ <code>SessionCallback</code></p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;stock:1001&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// åˆå§‹åŒ–åº“å­˜</span></span><br><span class=\"line\">redisTemplate.opsForValue().set(key, <span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ‰§è¡Œäº‹åŠ¡æ“ä½œ</span></span><br><span class=\"line\">List&lt;Object&gt; result = redisTemplate.execute(<span class=\"keyword\">new</span> <span class=\"title class_\">SessionCallback</span>&lt;&gt;() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Object&gt; <span class=\"title function_\">execute</span><span class=\"params\">(RedisOperations operations)</span> <span class=\"keyword\">throws</span> DataAccessException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// ç›‘è§†keyçš„å˜åŒ–</span></span><br><span class=\"line\">            operations.watch(key);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// å®‰å…¨è·å–å½“å‰åº“å­˜å€¼</span></span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">stock</span> <span class=\"operator\">=</span> operations.opsForValue().get(key);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (stock == <span class=\"literal\">null</span> || (Integer) stock &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                operations.unwatch(); <span class=\"comment\">// å–æ¶ˆç›‘è§†</span></span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;åº“å­˜ä¸è¶³ï¼Œæ— æ³•æ‰£å‡&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// å¼€å§‹äº‹åŠ¡</span></span><br><span class=\"line\">            operations.multi();</span><br><span class=\"line\">            operations.opsForValue().decrement(key);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// æ‰§è¡Œäº‹åŠ¡å¹¶è¿”å›ç»“æœ</span></span><br><span class=\"line\">            List&lt;Object&gt; execResult = operations.exec();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œæ‰£å‡åº“å­˜åç»“æœ: &quot;</span> + execResult);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> execResult;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å‘ç”Ÿå¼‚å¸¸æ—¶å–æ¶ˆç›‘è§†</span></span><br><span class=\"line\">            operations.unwatch();</span><br><span class=\"line\">            System.err.println(<span class=\"string\">&quot;äº‹åŠ¡æ‰§è¡Œå¼‚å¸¸: &quot;</span> + e.getMessage());</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DataAccessException</span>(<span class=\"string\">&quot;Redisäº‹åŠ¡æ‰§è¡Œå¤±è´¥&quot;</span>, e) &#123;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (result != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;æœ€ç»ˆäº‹åŠ¡ç»“æœ: &quot;</span> + result);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;äº‹åŠ¡æœªæ‰§è¡Œæˆ–æ‰§è¡Œå¤±è´¥&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éªŒè¯äº‹åŠ¡æ˜¯å¦ç”Ÿæ•ˆï¼Œå¯ä»¥åœ¨ redis ç»ˆç«¯æ‰§è¡Œ <code>MONITOR</code> å‘½ä»¤æŸ¥è¯¢</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; MONITOR</span><br><span class=\"line\">OK</span><br><span class=\"line\">1768054048.497866 [0 127.0.0.1:53634] <span class=\"string\">&quot;HELLO&quot;</span> <span class=\"string\">&quot;3&quot;</span> <span class=\"string\">&quot;AUTH&quot;</span> <span class=\"string\">&quot;(redacted)&quot;</span> <span class=\"string\">&quot;(redacted)&quot;</span></span><br><span class=\"line\">1768054048.510741 [0 127.0.0.1:53634] <span class=\"string\">&quot;CLIENT&quot;</span> <span class=\"string\">&quot;SETINFO&quot;</span> <span class=\"string\">&quot;lib-name&quot;</span> <span class=\"string\">&quot;Lettuce&quot;</span></span><br><span class=\"line\">1768054048.510759 [0 127.0.0.1:53634] <span class=\"string\">&quot;CLIENT&quot;</span> <span class=\"string\">&quot;SETINFO&quot;</span> <span class=\"string\">&quot;lib-ver&quot;</span> <span class=\"string\">&quot;6.6.0.RELEASE/643bd47&quot;</span></span><br><span class=\"line\">1768054048.538458 [0 127.0.0.1:53634] <span class=\"string\">&quot;SET&quot;</span> <span class=\"string\">&quot;stock:1001&quot;</span> <span class=\"string\">&quot;10&quot;</span></span><br><span class=\"line\">1768054048.557699 [0 127.0.0.1:53635] <span class=\"string\">&quot;HELLO&quot;</span> <span class=\"string\">&quot;3&quot;</span> <span class=\"string\">&quot;AUTH&quot;</span> <span class=\"string\">&quot;(redacted)&quot;</span> <span class=\"string\">&quot;(redacted)&quot;</span></span><br><span class=\"line\">1768054048.559907 [0 127.0.0.1:53635] <span class=\"string\">&quot;CLIENT&quot;</span> <span class=\"string\">&quot;SETINFO&quot;</span> <span class=\"string\">&quot;lib-name&quot;</span> <span class=\"string\">&quot;Lettuce&quot;</span></span><br><span class=\"line\">1768054048.559918 [0 127.0.0.1:53635] <span class=\"string\">&quot;CLIENT&quot;</span> <span class=\"string\">&quot;SETINFO&quot;</span> <span class=\"string\">&quot;lib-ver&quot;</span> <span class=\"string\">&quot;6.6.0.RELEASE/643bd47&quot;</span></span><br><span class=\"line\">1768054048.562642 [0 127.0.0.1:53635] <span class=\"string\">&quot;WATCH&quot;</span> <span class=\"string\">&quot;stock:1001&quot;</span></span><br><span class=\"line\">1768054048.566201 [0 127.0.0.1:53634] <span class=\"string\">&quot;GET&quot;</span> <span class=\"string\">&quot;stock:1001&quot;</span></span><br><span class=\"line\">1768054048.583727 [0 127.0.0.1:53635] <span class=\"string\">&quot;MULTI&quot;</span></span><br><span class=\"line\">1768054048.645412 [0 127.0.0.1:53635] <span class=\"string\">&quot;DECR&quot;</span> <span class=\"string\">&quot;stock:1001&quot;</span></span><br><span class=\"line\">1768054048.645421 [0 127.0.0.1:53635] <span class=\"string\">&quot;EXEC&quot;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>é‡ç‚¹çœ‹ï¼š<code>WATCH</code> ä»¥åŠ <code>MULTI</code> å’Œ <code>EXEC</code>ä¹‹é—´çš„è¾“å‡ºï¼Œè¦åœ¨ä¸€ä¸ªè¿æ¥ä¸­æ‰èƒ½ç”Ÿæ•ˆ</p>\n</blockquote>\n","content_text":"æ‘˜è¦ æœ¬æ–‡åŸºäºredis-7.4.7 Rediså®˜ç½‘ï¼šhttps://redis.io/ äº‹åŠ¡ Transaction å‘½ä»¤ Redis äº‹åŠ¡å‘½ä»¤æ€»è§ˆè¡¨ å‘½ä»¤ ä½œç”¨ æ‰€å¤„é˜¶æ®µ è¿”å›å€¼ å…¸å‹ä½¿ç”¨åœºæ™¯ MULTI å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œä¹‹åçš„å‘½ä»¤è¿›å…¥é˜Ÿåˆ— äº‹åŠ¡å¼€å§‹ OK æ‰¹é‡åŸå­æ‰§è¡Œå¤šä¸ªå‘½ä»¤ EXEC æ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤ äº‹åŠ¡æäº¤ æ•°ç»„ï¼ˆæ¯ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœï¼‰æˆ– nil æäº¤äº‹åŠ¡ DISCARD æ”¾å¼ƒäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤ äº‹åŠ¡å–æ¶ˆ OK å›æ»šæœªæ‰§è¡Œçš„äº‹åŠ¡ WATCH key [key â€¦] ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ª key æ˜¯å¦è¢«ä¿®æ”¹ï¼ˆä¹è§‚é”ï¼‰ äº‹åŠ¡å‰ OK å¹¶å‘æ§åˆ¶ã€é˜²æ­¢è¦†ç›–æ›´æ–° UNWATCH å–æ¶ˆå¯¹æ‰€æœ‰ key çš„ç›‘æ§ äº‹åŠ¡å‰ / ä¸­ OK ä¸»åŠ¨é‡Šæ”¾ç›‘æ§ MULTI / EXEC â€”â€” åŸºæœ¬äº‹åŠ¡ç¤ºä¾‹ ç¤ºä¾‹ï¼šåŸå­é€’å¢ä¸¤ä¸ªè®¡æ•°å™¨ 123456789101112127.0.0.1:6379&gt; MULTIOK127.0.0.1:6379&gt; INCR counter:aQUEUED127.0.0.1:6379&gt; INCR counter:bQUEUED127.0.0.1:6379&gt; EXEC1) (integer) 12) (integer) 1 è¯´æ˜ MULTI åï¼Œæ‰€æœ‰å‘½ä»¤åªä¼šè¿›å…¥é˜Ÿåˆ—ï¼Œè¿”å› QUEUEDï¼Œä¸ä¼šç«‹å³æ‰§è¡Œã€‚ EXEC æ—¶æ‰çœŸæ­£æ‰§è¡Œã€‚ Redis ä¿è¯ï¼š å‘½ä»¤é¡ºåºæ‰§è¡Œ æ‰§è¡ŒæœŸé—´ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯æ’å…¥å‘½ä»¤ ä½†ä¸æ”¯æŒå›æ»šï¼ˆæŸæ¡å‘½ä»¤å¤±è´¥ï¼Œä¸ä¼šè‡ªåŠ¨æ’¤é”€å·²æ‰§è¡Œçš„å‘½ä»¤ï¼‰ã€‚ DISCARD â€”â€” æ”¾å¼ƒäº‹åŠ¡ ç¤ºä¾‹ï¼šå–æ¶ˆäº‹åŠ¡ 1234567891011121314127.0.0.1:6379&gt; MULTIOK127.0.0.1:6379&gt; SET k1 v1QUEUED127.0.0.1:6379&gt; SET k2 v2QUEUED127.0.0.1:6379&gt; DISCARDOK127.0.0.1:6379&gt; GET k1(nil) è¯´æ˜ DISCARD ä¼šï¼š æ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ— é€€å‡ºäº‹åŠ¡çŠ¶æ€ é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ ä¸ä¼šè¢«æ‰§è¡Œã€‚ WATCH / EXEC â€”â€” ä¹è§‚é”ç¤ºä¾‹ ä¹è§‚é”äº‹åŠ¡æ¨¡æ¿ 123456WATCH keyè¯»å–å¹¶æ ¡éªŒæ•°æ®MULTI å†™æ“ä½œ...EXECå¦‚æœè¿”å› nil â†’ é‡è¯• åœºæ™¯ï¼šå®ç°ä¸€ä¸ªå®‰å…¨çš„ä½™é¢æ‰£å‡é€»è¾‘ï¼Œå¦‚æœä½™é¢åœ¨äº‹åŠ¡æ‰§è¡Œå‰è¢«åˆ«äººä¿®æ”¹ï¼Œåˆ™æ”¾å¼ƒæœ¬æ¬¡äº‹åŠ¡ã€‚ å®¢æˆ·ç«¯ A 1234567891011121314127.0.0.1:6379&gt; SET balance 100OK127.0.0.1:6379&gt; WATCH balanceOK127.0.0.1:6379&gt; GET balance&quot;100&quot;127.0.0.1:6379&gt; MULTIOK127.0.0.1:6379&gt; DECRBY balance 30QUEUED å®¢æˆ·ç«¯ Bï¼ˆå¹¶å‘ä¿®æ”¹ï¼‰ 12127.0.0.1:6379&gt; INCRBY balance 50(integer) 150 å®¢æˆ·ç«¯ A æäº¤äº‹åŠ¡ 12127.0.0.1:6379&gt; EXEC(nil) è¯´æ˜ å› ä¸º balance åœ¨ WATCH ä¹‹åè¢«å®¢æˆ·ç«¯ B ä¿®æ”¹è¿‡ï¼š Redis åˆ¤å®šç›‘æ§å¤±è´¥ EXEC è¿”å› nil äº‹åŠ¡ä¸ä¼šæ‰§è¡Œ è¿™æ˜¯å…¸å‹çš„ ä¹è§‚é”ï¼ˆCASï¼‰æœºåˆ¶ã€‚ UNWATCH â€”â€” å–æ¶ˆç›‘æ§ ç¤ºä¾‹ï¼šå–æ¶ˆ WATCH ç›‘æ§ 12345127.0.0.1:6379&gt; WATCH k1 k2OK127.0.0.1:6379&gt; UNWATCHOK è¯´æ˜ å–æ¶ˆæ‰€æœ‰è¢«ç›‘æ§çš„ keyã€‚ å¸¸è§ç”¨é€”ï¼š é€»è¾‘åˆ¤æ–­å¤±è´¥ï¼Œä¸å†ç»§ç»­äº‹åŠ¡ ä¸»åŠ¨é‡Šæ”¾ç›‘æ§ï¼Œé¿å…è¯¯è§¦å‘äº‹åŠ¡å¤±è´¥ å¦‚æœæ‰§è¡Œäº† EXEC æˆ– DISCARDï¼ŒRedis ä¼šè‡ªåŠ¨ UNWATCHã€‚ å…³é”®è¡Œä¸ºæ€»ç»“ï¼ˆå·¥ç¨‹è§†è§’ï¼‰ ç»´åº¦ è¡Œä¸º åŸå­æ€§ EXEC å†…å‘½ä»¤é¡ºåºæ‰§è¡Œï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯æ’å…¥ éš”ç¦»æ€§ ä¸æ˜¯æ•°æ®åº“çº§äº‹åŠ¡éš”ç¦»ï¼Œä»…ä¿è¯æ‰§è¡ŒæœŸä¸²è¡Œ å›æ»šèƒ½åŠ› âŒ ä¸æ”¯æŒå›æ»š å¹¶å‘æ§åˆ¶ é€šè¿‡ WATCH å®ç°ä¹è§‚é” å¤±è´¥è¡Œä¸º WATCH å†²çª â†’ EXEC è¿”å› nil æ€§èƒ½ é˜Ÿåˆ—å…¥å†…å­˜ï¼Œæ‰§è¡Œéå¸¸å¿« SpringBoot ä¸­ä½¿ç”¨ Redis äº‹åŠ¡ å®é™…é¡¹ç›®ä¸­Redisäº‹åŠ¡å¾ˆå°‘ä½¿ç”¨ï¼Œå› ä¸ºWATCH + MULTI çš„æ€§èƒ½ä¸å¦‚ Lua æˆ– INCR ç­‰åŸå­æŒ‡ä»¤ã€‚ åŒä¸€äº‹åŠ¡ä»£ç å¿…é¡»åœ¨åŒä¸€çº¿ç¨‹å†…å®Œæˆï¼Œæ¨èä½¿ç”¨ SessionCallback 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647String key = &quot;stock:1001&quot;;// åˆå§‹åŒ–åº“å­˜redisTemplate.opsForValue().set(key, 10);// æ‰§è¡Œäº‹åŠ¡æ“ä½œList&lt;Object&gt; result = redisTemplate.execute(new SessionCallback&lt;&gt;() &#123; @Override public List&lt;Object&gt; execute(RedisOperations operations) throws DataAccessException &#123; try &#123; // ç›‘è§†keyçš„å˜åŒ– operations.watch(key); // å®‰å…¨è·å–å½“å‰åº“å­˜å€¼ Object stock = operations.opsForValue().get(key); // æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³ if (stock == null || (Integer) stock &lt;= 0) &#123; operations.unwatch(); // å–æ¶ˆç›‘è§† System.out.println(&quot;åº“å­˜ä¸è¶³ï¼Œæ— æ³•æ‰£å‡&quot;); return null; &#125; // å¼€å§‹äº‹åŠ¡ operations.multi(); operations.opsForValue().decrement(key); // æ‰§è¡Œäº‹åŠ¡å¹¶è¿”å›ç»“æœ List&lt;Object&gt; execResult = operations.exec(); System.out.println(&quot;äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œæ‰£å‡åº“å­˜åç»“æœ: &quot; + execResult); return execResult; &#125; catch (Exception e) &#123; // å‘ç”Ÿå¼‚å¸¸æ—¶å–æ¶ˆç›‘è§† operations.unwatch(); System.err.println(&quot;äº‹åŠ¡æ‰§è¡Œå¼‚å¸¸: &quot; + e.getMessage()); throw new DataAccessException(&quot;Redisäº‹åŠ¡æ‰§è¡Œå¤±è´¥&quot;, e) &#123; &#125;; &#125; &#125;&#125;);if (result != null) &#123; System.out.println(&quot;æœ€ç»ˆäº‹åŠ¡ç»“æœ: &quot; + result);&#125; else &#123; System.out.println(&quot;äº‹åŠ¡æœªæ‰§è¡Œæˆ–æ‰§è¡Œå¤±è´¥&quot;);&#125; éªŒè¯äº‹åŠ¡æ˜¯å¦ç”Ÿæ•ˆï¼Œå¯ä»¥åœ¨ redis ç»ˆç«¯æ‰§è¡Œ MONITOR å‘½ä»¤æŸ¥è¯¢ 1234567891011121314127.0.0.1:6379&gt; MONITOROK1768054048.497866 [0 127.0.0.1:53634] &quot;HELLO&quot; &quot;3&quot; &quot;AUTH&quot; &quot;(redacted)&quot; &quot;(redacted)&quot;1768054048.510741 [0 127.0.0.1:53634] &quot;CLIENT&quot; &quot;SETINFO&quot; &quot;lib-name&quot; &quot;Lettuce&quot;1768054048.510759 [0 127.0.0.1:53634] &quot;CLIENT&quot; &quot;SETINFO&quot; &quot;lib-ver&quot; &quot;6.6.0.RELEASE/643bd47&quot;1768054048.538458 [0 127.0.0.1:53634] &quot;SET&quot; &quot;stock:1001&quot; &quot;10&quot;1768054048.557699 [0 127.0.0.1:53635] &quot;HELLO&quot; &quot;3&quot; &quot;AUTH&quot; &quot;(redacted)&quot; &quot;(redacted)&quot;1768054048.559907 [0 127.0.0.1:53635] &quot;CLIENT&quot; &quot;SETINFO&quot; &quot;lib-name&quot; &quot;Lettuce&quot;1768054048.559918 [0 127.0.0.1:53635] &quot;CLIENT&quot; &quot;SETINFO&quot; &quot;lib-ver&quot; &quot;6.6.0.RELEASE/643bd47&quot;1768054048.562642 [0 127.0.0.1:53635] &quot;WATCH&quot; &quot;stock:1001&quot;1768054048.566201 [0 127.0.0.1:53634] &quot;GET&quot; &quot;stock:1001&quot;1768054048.583727 [0 127.0.0.1:53635] &quot;MULTI&quot;1768054048.645412 [0 127.0.0.1:53635] &quot;DECR&quot; &quot;stock:1001&quot;1768054048.645421 [0 127.0.0.1:53635] &quot;EXEC&quot; é‡ç‚¹çœ‹ï¼šWATCH ä»¥åŠ MULTI å’Œ EXECä¹‹é—´çš„è¾“å‡ºï¼Œè¦åœ¨ä¸€ä¸ªè¿æ¥ä¸­æ‰èƒ½ç”Ÿæ•ˆ","summary":"æ‘˜è¦ æœ¬æ–‡åŸºäºredis-7.4.7 Rediså®˜ç½‘ï¼šhttps://redis.io/","date_published":"2026-01-10T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2026/01/09/redis-Redisson-02-datatype/","url":"https://blog.hanqunfeng.com/2026/01/09/redis-Redisson-02-datatype/","title":"Redisson å®æˆ˜","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redisson çš„ä½¿ç”¨æ–¹æ³•</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\"><a href=\"https://redisson.pro/docs/getting-started/\">Redisson å®˜æ–¹æ–‡æ¡£</a></li>\n<li class=\"lvl-2\">æœ¬æ–‡ä»¥Springbooté¡¹ç›®ä¸ºä¾‹ï¼Œä»‹ç»Redissonçš„ä½¿ç”¨æ–¹æ³•</li>\n<li class=\"lvl-2\">ç¤ºä¾‹ä»£ç ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo\">GitHub</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä¸Springbooté›†æˆ\">ä¸Springbooté›†æˆ</h2>\n<h3 id=\"æ·»åŠ ä¾èµ–\">æ·»åŠ ä¾èµ–</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">Redissonæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯<code>Community Edition</code>ï¼Œä¸€ä¸ªæ˜¯<code>Redisson PRO</code>ï¼Œå‰è€…ç¤¾åŒºç‰ˆï¼Œåè€…ä»˜è´¹ç‰ˆï¼Œä¸¤ä¸ªç‰ˆæœ¬çš„åŒºåˆ«å‚è§<a href=\"https://redisson.pro/feature-comparison.html\">Redisson PRO vs. Community Edition</a></li>\n<li class=\"lvl-2\">Springboot é›†æˆçš„æ˜¯ Redisson Community Editionï¼Œ<a href=\"https://redisson.pro/docs/integration-with-spring/#spring-boot-starter\">Redisson Spring Boot Starter</a></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.redisson&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;redisson-spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;3.52.0&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>PS: ç›®å‰<code>redisson-spring-boot-starte</code>æœ€æ–°ç‰ˆæ˜¯<code>4.1.0</code>ï¼Œå…¶å¯¹åº”çš„æ˜¯ Springboot 4.x ç‰ˆæœ¬ï¼Œæœ¬æ–‡åŸºäº<code>springboot-3.5.8</code>ï¼Œæ‰€ä»¥è¿™é‡Œç”¨çš„æ˜¯<code>3.52.0</code>è¿™ä¸ªç‰ˆæœ¬ã€‚</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>Redisson æ¨¡å—</th>\n<th>å¯¹åº” Spring Boot</th>\n<th>å¯¹åº” Spring Data Redis</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>redisson-spring-data-16</td>\n<td>Spring Boot <strong>1.3.x</strong></td>\n<td>Spring Data Redis <strong>1.6.x</strong></td>\n</tr>\n<tr>\n<td>redisson-spring-data-17</td>\n<td>Spring Boot <strong>1.4.x</strong></td>\n<td>Spring Data Redis <strong>1.7.x</strong></td>\n</tr>\n<tr>\n<td>redisson-spring-data-18</td>\n<td>Spring Boot <strong>1.5.x</strong></td>\n<td>Spring Data Redis <strong>1.8.x</strong></td>\n</tr>\n<tr>\n<td>redisson-spring-data-2x</td>\n<td>Spring Boot <strong>2.x</strong></td>\n<td>Spring Data Redis <strong>2.x</strong></td>\n</tr>\n<tr>\n<td>redisson-spring-data-3x</td>\n<td>Spring Boot <strong>3.x</strong></td>\n<td>Spring Data Redis <strong>3.x</strong></td>\n</tr>\n<tr>\n<td>redisson-spring-data-4x</td>\n<td>Spring Boot <strong>4.x</strong></td>\n<td>Spring Data Redis <strong>4.x</strong></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"é…ç½®æ–‡ä»¶\">é…ç½®æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®æ–‡ä»¶<code>application.properties</code> ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># redis config</span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.host</span>=<span class=\"string\">localhost</span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.port</span>=<span class=\"string\">6379</span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.username</span>=<span class=\"string\">admin</span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.password</span>=<span class=\"string\">123456</span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.database</span>=<span class=\"string\">0</span></span><br><span class=\"line\"><span class=\"comment\"># è¶…æ—¶æ—¶é—´</span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.timeout</span>=<span class=\"string\">3s</span></span><br><span class=\"line\"><span class=\"comment\"># è¿æ¥æ± é…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ç”¨è¿æ¥æ± </span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.lettuce.pool.enabled</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•°</span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.lettuce.pool.max-active</span>=<span class=\"string\">8</span></span><br><span class=\"line\"><span class=\"comment\"># è·å–è¿æ¥æœ€å¤§ç­‰å¾…æ—¶é—´</span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.lettuce.pool.max-wait</span>=<span class=\"string\">2s</span></span><br><span class=\"line\"><span class=\"comment\"># æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.lettuce.pool.max-idle</span>=<span class=\"string\">8</span></span><br><span class=\"line\"><span class=\"comment\"># æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.lettuce.pool.min-idle</span>=<span class=\"string\">0</span></span><br><span class=\"line\"><span class=\"comment\"># å…³é—­è¶…æ—¶æ—¶é—´</span></span><br><span class=\"line\"><span class=\"attr\">spring.data.redis.lettuce.shutdown-timeout</span>=<span class=\"string\">5s</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è·å–RedissonClient\">è·å–RedissonClient</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redisson æä¾›äº†3ä¸ª Clientï¼Œæœ¬è´¨ä¸Šæ˜¯åŒä¸€å¥—åº•å±‚è¿æ¥ä¸å‘½ä»¤èƒ½åŠ›çš„ä¸åŒç¼–ç¨‹æ¨¡å‹å°è£…ï¼Œä¸»è¦åŒºåˆ«åœ¨äºï¼š</p>\n</li>\n</ul>\n<blockquote>\n<p>è°ƒç”¨æ–¹å¼ï¼ˆåŒæ­¥ / å¼‚æ­¥ / Reactive / RxJavaï¼‰ã€çº¿ç¨‹æ¨¡å‹ã€èƒŒå‹èƒ½åŠ›ã€é€‚ç”¨åœºæ™¯ã€‚</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Sync and Async API</span></span><br><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\">RedissonClient redisson;</span><br><span class=\"line\"><span class=\"comment\">// Reactive API</span></span><br><span class=\"line\"><span class=\"type\">RedissonReactiveClient</span> <span class=\"variable\">redissonReactive</span> <span class=\"operator\">=</span> redisson.reactive();</span><br><span class=\"line\"><span class=\"comment\">// RxJava3 API</span></span><br><span class=\"line\"><span class=\"type\">RedissonRxClient</span> <span class=\"variable\">redissonRx</span> <span class=\"operator\">=</span> redisson.rxJava();</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‰ä¸ª Client çš„å®šä½æ¦‚è§ˆ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Client</th>\n<th>ç±»å‹</th>\n<th>ç¼–ç¨‹æ¨¡å‹</th>\n<th>è¿”å›å€¼</th>\n<th>æ˜¯å¦é˜»å¡</th>\n<th>èƒŒå‹æ”¯æŒ</th>\n<th>å…¸å‹ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>RedissonClient</code></td>\n<td>åŒæ­¥ / å¼‚æ­¥</td>\n<td>Imperative</td>\n<td>T / RFuture<T></td>\n<td>åŒæ­¥ä¼šé˜»å¡</td>\n<td>âŒ</td>\n<td>ä¼ ç»ŸæœåŠ¡ã€ç®€å•ä¸šåŠ¡</td>\n</tr>\n<tr>\n<td><code>RedissonReactiveClient</code></td>\n<td>Reactive Streams</td>\n<td>Reactor / Flow</td>\n<td>Mono / Flux</td>\n<td>âŒ</td>\n<td>âœ…</td>\n<td>WebFluxã€é«˜å¹¶å‘</td>\n</tr>\n<tr>\n<td><code>RedissonRxClient</code></td>\n<td>RxJava3</td>\n<td>RxJava3</td>\n<td>Observable / Single / Flowable</td>\n<td>âŒ</td>\n<td>âœ…</td>\n<td>RxJava é¡¹ç›®</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ğŸ“Š Redisson Client é€‰å‹å¯¹ç…§è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>æŠ€æœ¯æ¶æ„ç‰¹å¾</th>\n<th>æ¨è Client</th>\n<th>ç¼–ç¨‹æ¨¡å‹</th>\n<th>æ ¸å¿ƒç†ç”±</th>\n<th>å…¸å‹åº”ç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ™®é€š Spring Bootï¼ˆMVCï¼‰</td>\n<td>åŒæ­¥è¯·æ±‚æ¨¡å‹<br>çº¿ç¨‹æ± å¯æ§<br>é˜»å¡ IO å¯æ¥å—</td>\n<td><strong>RedissonClientï¼ˆåŒæ­¥ / Asyncï¼‰</strong></td>\n<td>Imperative + Future</td>\n<td>- ç¼–ç ç®€å•ï¼Œç»´æŠ¤æˆæœ¬ä½<br>- ä¸ JDBC / äº‹åŠ¡æ¨¡å‹ä¸€è‡´<br>- æ˜“äºçº¿ç¨‹ä¸è¿æ¥æ± æ²»ç†<br>- è°ƒè¯•ä¸æ’éšœæˆæœ¬ä½</td>\n<td>ä¸šåŠ¡ç³»ç»Ÿã€ç®¡ç†åå°ã€å†…éƒ¨æœåŠ¡</td>\n</tr>\n<tr>\n<td>é«˜å¹¶å‘ IO æœåŠ¡ï¼ˆWebFlux / ç½‘å…³ï¼‰</td>\n<td>éé˜»å¡æ¶æ„<br>äº‹ä»¶é©±åŠ¨<br>é«˜å¹¶å‘è¿æ¥æ•°</td>\n<td><strong>RedissonReactiveClient</strong></td>\n<td>Reactive Streamsï¼ˆMono / Fluxï¼‰</td>\n<td>- å…¨é“¾è·¯éé˜»å¡<br>- æ”¯æŒèƒŒå‹æ§åˆ¶<br>- ä¸ Reactor ç”Ÿæ€å¤©ç„¶å…¼å®¹<br>- æœ€å¤§åŒ–ååä¸èµ„æºåˆ©ç”¨ç‡</td>\n<td>API ç½‘å…³ã€å®æ—¶æœåŠ¡ã€æ¨é€ç³»ç»Ÿ</td>\n</tr>\n<tr>\n<td>å·²æœ‰ RxJava æŠ€æœ¯æ ˆ</td>\n<td>å·²å¹¿æ³›ä½¿ç”¨ RxJava3<br>æˆç†Ÿæµå¼ç®¡é“</td>\n<td><strong>RedissonRxClient</strong></td>\n<td>RxJavaï¼ˆSingle / Flowableï¼‰</td>\n<td>- æ— éœ€å¼•å…¥ Reactor ç”Ÿæ€<br>- ä¸ç°æœ‰æµå¼æ¨¡å‹æ— ç¼é›†æˆ<br>- æ”¯æŒèƒŒå‹ï¼ˆFlowableï¼‰<br>- æ”¹é€ æˆæœ¬æœ€ä½</td>\n<td>Android åç«¯ã€å†å²ç³»ç»Ÿ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ğŸ“Š-Redis-æ•°æ®ç±»å‹-â†”-Redisson-å¯¹è±¡æ˜ å°„è¡¨\">ğŸ“Š Redis æ•°æ®ç±»å‹ â†” Redisson å¯¹è±¡æ˜ å°„è¡¨</h2>\n<h3 id=\"1ï¸âƒ£-String\">1ï¸âƒ£ String</h3>\n<table>\n<thead>\n<tr>\n<th>Redis</th>\n<th>Redisson å¯¹è±¡</th>\n<th>Java è¯­ä¹‰</th>\n<th>å¸¸ç”¨ API</th>\n<th>åº•å±‚æ˜ å°„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>String</td>\n<td><code>RBucket&lt;T&gt;</code></td>\n<td>å•å€¼å¯¹è±¡</td>\n<td>get / set / delete</td>\n<td>GET / SET</td>\n<td>æœ€å¸¸ç”¨</td>\n</tr>\n<tr>\n<td>String</td>\n<td><code>RAtomicLong</code></td>\n<td>åŸå­è®¡æ•°å™¨</td>\n<td>incrementAndGet</td>\n<td>INCRBY</td>\n<td>å¼ºè¯­ä¹‰</td>\n</tr>\n<tr>\n<td>String</td>\n<td><code>RAtomicDouble</code></td>\n<td>åŸå­æµ®ç‚¹</td>\n<td>addAndGet</td>\n<td>è‡ªå®ç°</td>\n<td>Lua</td>\n</tr>\n<tr>\n<td>String</td>\n<td><code>RLongAdder</code></td>\n<td>é«˜å¹¶å‘è®¡æ•°</td>\n<td>increment</td>\n<td>Hash + Lua</td>\n<td>åˆ†ç‰‡</td>\n</tr>\n<tr>\n<td>String</td>\n<td><code>RBitSet</code></td>\n<td>ä½é›†åˆ</td>\n<td>set / get</td>\n<td>SETBIT / GETBIT</td>\n<td>ä½å›¾</td>\n</tr>\n<tr>\n<td>String</td>\n<td><code>RBinaryStream</code></td>\n<td>äºŒè¿›åˆ¶æµ</td>\n<td>read / write</td>\n<td>GETRANGE</td>\n<td>å¤§å¯¹è±¡</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"2ï¸âƒ£-Hash\">2ï¸âƒ£ Hash</h3>\n<table>\n<thead>\n<tr>\n<th>Redis</th>\n<th>Redisson å¯¹è±¡</th>\n<th>Java è¯­ä¹‰</th>\n<th>å¸¸ç”¨ API</th>\n<th>åº•å±‚æ˜ å°„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Hash</td>\n<td><code>RMap&lt;K,V&gt;</code></td>\n<td>Map</td>\n<td>get / put / remove</td>\n<td>HGET / HSET</td>\n<td>æ ¸å¿ƒ</td>\n</tr>\n<tr>\n<td>Hash</td>\n<td><code>RMapCache&lt;K,V&gt;</code></td>\n<td>å¸¦ TTL Map</td>\n<td>put(key,val,ttl)</td>\n<td>Hash + ZSet</td>\n<td>è¿‡æœŸæ§åˆ¶</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"3ï¸âƒ£-List\">3ï¸âƒ£ List</h3>\n<table>\n<thead>\n<tr>\n<th>Redis</th>\n<th>Redisson å¯¹è±¡</th>\n<th>Java è¯­ä¹‰</th>\n<th>å¸¸ç”¨ API</th>\n<th>åº•å±‚æ˜ å°„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>List</td>\n<td><code>RList&lt;V&gt;</code></td>\n<td>List</td>\n<td>add / get / remove</td>\n<td>LPUSH / LRANGE</td>\n<td>é¡ºåº</td>\n</tr>\n<tr>\n<td>List</td>\n<td><code>RQueue&lt;V&gt;</code></td>\n<td>Queue</td>\n<td>offer / poll</td>\n<td>RPUSH / LPOP</td>\n<td>é˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td>List</td>\n<td><code>RDeque&lt;V&gt;</code></td>\n<td>Deque</td>\n<td>addFirst / addLast</td>\n<td>LPUSH / RPUSH</td>\n<td>åŒç«¯</td>\n</tr>\n<tr>\n<td>List</td>\n<td><code>RBlockingQueue&lt;V&gt;</code></td>\n<td>BlockingQueue</td>\n<td>take</td>\n<td>BLPOP</td>\n<td>é˜»å¡æ¶ˆè´¹</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"4ï¸âƒ£-Set\">4ï¸âƒ£ Set</h3>\n<table>\n<thead>\n<tr>\n<th>Redis</th>\n<th>Redisson å¯¹è±¡</th>\n<th>Java è¯­ä¹‰</th>\n<th>å¸¸ç”¨ API</th>\n<th>åº•å±‚æ˜ å°„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Set</td>\n<td><code>RSet&lt;V&gt;</code></td>\n<td>Set</td>\n<td>add / contains</td>\n<td>SADD / SISMEMBER</td>\n<td>æ— åº</td>\n</tr>\n<tr>\n<td>Set</td>\n<td><code>RSetCache&lt;V&gt;</code></td>\n<td>TTL Set</td>\n<td>add(ttl)</td>\n<td>Set + ZSet</td>\n<td>è‡ªåŠ¨è¿‡æœŸ</td>\n</tr>\n<tr>\n<td>Set</td>\n<td><code>RSortedSet&lt;V&gt;</code></td>\n<td>SortedSet</td>\n<td>add / first</td>\n<td>ZSet</td>\n<td>æœ‰åº</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"5ï¸âƒ£-ZSet\">5ï¸âƒ£ ZSet</h3>\n<table>\n<thead>\n<tr>\n<th>Redis</th>\n<th>Redisson å¯¹è±¡</th>\n<th>Java è¯­ä¹‰</th>\n<th>å¸¸ç”¨ API</th>\n<th>åº•å±‚æ˜ å°„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ZSet</td>\n<td><code>RScoredSortedSet&lt;V&gt;</code></td>\n<td>å¸¦ score é›†åˆ</td>\n<td>add(score)</td>\n<td>ZADD</td>\n<td>æ’è¡Œæ¦œ</td>\n</tr>\n<tr>\n<td>ZSet</td>\n<td><code>RLexSortedSet</code></td>\n<td>å­—å…¸æ’åºé›†åˆ</td>\n<td>add</td>\n<td>ZRANGEBYLEX</td>\n<td>å­—å…¸åº</td>\n</tr>\n<tr>\n<td>ZSet</td>\n<td><code>RPriorityQueue&lt;V&gt;</code></td>\n<td>ä¼˜å…ˆé˜Ÿåˆ—</td>\n<td>poll</td>\n<td>ZSet</td>\n<td>å †è¯­ä¹‰</td>\n</tr>\n<tr>\n<td>ZSet</td>\n<td><code>RPriorityDeque&lt;V&gt;</code></td>\n<td>åŒç«¯ä¼˜å…ˆé˜Ÿåˆ—</td>\n<td>pollFirst</td>\n<td>ZSet</td>\n<td>æ‰©å±•</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"6ï¸âƒ£-Bitmap\">6ï¸âƒ£ Bitmap</h3>\n<table>\n<thead>\n<tr>\n<th>Redis</th>\n<th>Redisson å¯¹è±¡</th>\n<th>Java è¯­ä¹‰</th>\n<th>å¸¸ç”¨ API</th>\n<th>åº•å±‚æ˜ å°„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Bitmap</td>\n<td><code>RBitSet</code></td>\n<td>BitSet</td>\n<td>set / get</td>\n<td>SETBIT</td>\n<td>ä½å›¾</td>\n</tr>\n<tr>\n<td>Bitmap</td>\n<td><code>RLongAdder</code></td>\n<td>è®¡æ•°ä½</td>\n<td>increment</td>\n<td>Bitmap åˆ†ç‰‡</td>\n<td>é«˜å¹¶å‘</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"7ï¸âƒ£-HyperLogLog\">7ï¸âƒ£ HyperLogLog</h3>\n<table>\n<thead>\n<tr>\n<th>Redis</th>\n<th>Redisson å¯¹è±¡</th>\n<th>Java è¯­ä¹‰</th>\n<th>å¸¸ç”¨ API</th>\n<th>åº•å±‚æ˜ å°„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>HyperLogLog</td>\n<td><code>RHyperLogLog&lt;V&gt;</code></td>\n<td>å»é‡è®¡æ•°</td>\n<td>add / count</td>\n<td>PFADD / PFCOUNT</td>\n<td>UVç»Ÿè®¡</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"8ï¸âƒ£-Geo\">8ï¸âƒ£ Geo</h3>\n<table>\n<thead>\n<tr>\n<th>Redis</th>\n<th>Redisson å¯¹è±¡</th>\n<th>Java è¯­ä¹‰</th>\n<th>å¸¸ç”¨ API</th>\n<th>åº•å±‚æ˜ å°„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Geo</td>\n<td><code>RGeo&lt;V&gt;</code></td>\n<td>åœ°ç†ç´¢å¼•</td>\n<td>add / radius</td>\n<td>GEOADD</td>\n<td>LBS</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"9ï¸âƒ£-Stream\">9ï¸âƒ£ Stream</h3>\n<table>\n<thead>\n<tr>\n<th>Redis</th>\n<th>Redisson å¯¹è±¡</th>\n<th>Java è¯­ä¹‰</th>\n<th>å¸¸ç”¨ API</th>\n<th>åº•å±‚æ˜ å°„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Stream</td>\n<td><code>RStream&lt;K,V&gt;</code></td>\n<td>æ¶ˆæ¯æµ</td>\n<td>add / read</td>\n<td>XADD / XREAD</td>\n<td>æ¶ˆæ¯é˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td>Stream</td>\n<td><code>RStreamReactive</code></td>\n<td>Reactive Stream</td>\n<td>subscribe</td>\n<td>XREADGROUP</td>\n<td>æµå¼</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ğŸ”Ÿ-Pub-Sub\">ğŸ”Ÿ Pub/Sub</h3>\n<table>\n<thead>\n<tr>\n<th>Redis</th>\n<th>Redisson å¯¹è±¡</th>\n<th>Java è¯­ä¹‰</th>\n<th>å¸¸ç”¨ API</th>\n<th>åº•å±‚æ˜ å°„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>PubSub</td>\n<td><code>RTopic</code></td>\n<td>Topic</td>\n<td>publish / addListener</td>\n<td>PUBLISH</td>\n<td>å¹¿æ’­</td>\n</tr>\n<tr>\n<td>PubSub</td>\n<td><code>RPatternTopic</code></td>\n<td>Pattern</td>\n<td>subscribe</td>\n<td>PSUBSCRIBE</td>\n<td>æ¨¡å¼è®¢é˜…</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redisson çš„ä½¿ç”¨æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ Redisson å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡ä»¥Springbooté¡¹ç›®ä¸ºä¾‹ï¼Œä»‹ç»Redissonçš„ä½¿ç”¨æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub ä¸Springbooté›†æˆ æ·»åŠ ä¾èµ– Redissonæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯Community Editionï¼Œä¸€ä¸ªæ˜¯Redisson PROï¼Œå‰è€…ç¤¾åŒºç‰ˆï¼Œåè€…ä»˜è´¹ç‰ˆï¼Œä¸¤ä¸ªç‰ˆæœ¬çš„åŒºåˆ«å‚è§Redisson PRO vs. Community Edition Springboot é›†æˆçš„æ˜¯ Redisson Community Editionï¼ŒRedisson Spring Boot Starter 12345&lt;dependency&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.52.0&lt;/version&gt;&lt;/dependency&gt; PS: ç›®å‰redisson-spring-boot-starteæœ€æ–°ç‰ˆæ˜¯4.1.0ï¼Œå…¶å¯¹åº”çš„æ˜¯ Springboot 4.x ç‰ˆæœ¬ï¼Œæœ¬æ–‡åŸºäºspringboot-3.5.8ï¼Œæ‰€ä»¥è¿™é‡Œç”¨çš„æ˜¯3.52.0è¿™ä¸ªç‰ˆæœ¬ã€‚ Redisson æ¨¡å— å¯¹åº” Spring Boot å¯¹åº” Spring Data Redis redisson-spring-data-16 Spring Boot 1.3.x Spring Data Redis 1.6.x redisson-spring-data-17 Spring Boot 1.4.x Spring Data Redis 1.7.x redisson-spring-data-18 Spring Boot 1.5.x Spring Data Redis 1.8.x redisson-spring-data-2x Spring Boot 2.x Spring Data Redis 2.x redisson-spring-data-3x Spring Boot 3.x Spring Data Redis 3.x redisson-spring-data-4x Spring Boot 4.x Spring Data Redis 4.x é…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶application.properties ç¤ºä¾‹ 123456789101112131415161718192021# redis configspring.data.redis.host=localhostspring.data.redis.port=6379spring.data.redis.username=adminspring.data.redis.password=123456spring.data.redis.database=0# è¶…æ—¶æ—¶é—´spring.data.redis.timeout=3s# è¿æ¥æ± é…ç½®# å¯ç”¨è¿æ¥æ± spring.data.redis.lettuce.pool.enabled=true# è¿æ¥æ± æœ€å¤§è¿æ¥æ•°spring.data.redis.lettuce.pool.max-active=8# è·å–è¿æ¥æœ€å¤§ç­‰å¾…æ—¶é—´spring.data.redis.lettuce.pool.max-wait=2s# æœ€å¤§ç©ºé—²è¿æ¥spring.data.redis.lettuce.pool.max-idle=8# æœ€å°ç©ºé—²è¿æ¥spring.data.redis.lettuce.pool.min-idle=0# å…³é—­è¶…æ—¶æ—¶é—´spring.data.redis.lettuce.shutdown-timeout=5s è·å–RedissonClient Redisson æä¾›äº†3ä¸ª Clientï¼Œæœ¬è´¨ä¸Šæ˜¯åŒä¸€å¥—åº•å±‚è¿æ¥ä¸å‘½ä»¤èƒ½åŠ›çš„ä¸åŒç¼–ç¨‹æ¨¡å‹å°è£…ï¼Œä¸»è¦åŒºåˆ«åœ¨äºï¼š è°ƒç”¨æ–¹å¼ï¼ˆåŒæ­¥ / å¼‚æ­¥ / Reactive / RxJavaï¼‰ã€çº¿ç¨‹æ¨¡å‹ã€èƒŒå‹èƒ½åŠ›ã€é€‚ç”¨åœºæ™¯ã€‚ 1234567// Sync and Async API@AutowiredRedissonClient redisson;// Reactive APIRedissonReactiveClient redissonReactive = redisson.reactive();// RxJava3 APIRedissonRxClient redissonRx = redisson.rxJava(); ä¸‰ä¸ª Client çš„å®šä½æ¦‚è§ˆ Client ç±»å‹ ç¼–ç¨‹æ¨¡å‹ è¿”å›å€¼ æ˜¯å¦é˜»å¡ èƒŒå‹æ”¯æŒ å…¸å‹ç”¨é€” RedissonClient åŒæ­¥ / å¼‚æ­¥ Imperative T / RFuture åŒæ­¥ä¼šé˜»å¡ âŒ ä¼ ç»ŸæœåŠ¡ã€ç®€å•ä¸šåŠ¡ RedissonReactiveClient Reactive Streams Reactor / Flow Mono / Flux âŒ âœ… WebFluxã€é«˜å¹¶å‘ RedissonRxClient RxJava3 RxJava3 Observable / Single / Flowable âŒ âœ… RxJava é¡¹ç›® ğŸ“Š Redisson Client é€‰å‹å¯¹ç…§è¡¨ åœºæ™¯ æŠ€æœ¯æ¶æ„ç‰¹å¾ æ¨è Client ç¼–ç¨‹æ¨¡å‹ æ ¸å¿ƒç†ç”± å…¸å‹åº”ç”¨ æ™®é€š Spring Bootï¼ˆMVCï¼‰ åŒæ­¥è¯·æ±‚æ¨¡å‹çº¿ç¨‹æ± å¯æ§é˜»å¡ IO å¯æ¥å— RedissonClientï¼ˆåŒæ­¥ / Asyncï¼‰ Imperative + Future - ç¼–ç ç®€å•ï¼Œç»´æŠ¤æˆæœ¬ä½- ä¸ JDBC / äº‹åŠ¡æ¨¡å‹ä¸€è‡´- æ˜“äºçº¿ç¨‹ä¸è¿æ¥æ± æ²»ç†- è°ƒè¯•ä¸æ’éšœæˆæœ¬ä½ ä¸šåŠ¡ç³»ç»Ÿã€ç®¡ç†åå°ã€å†…éƒ¨æœåŠ¡ é«˜å¹¶å‘ IO æœåŠ¡ï¼ˆWebFlux / ç½‘å…³ï¼‰ éé˜»å¡æ¶æ„äº‹ä»¶é©±åŠ¨é«˜å¹¶å‘è¿æ¥æ•° RedissonReactiveClient Reactive Streamsï¼ˆMono / Fluxï¼‰ - å…¨é“¾è·¯éé˜»å¡- æ”¯æŒèƒŒå‹æ§åˆ¶- ä¸ Reactor ç”Ÿæ€å¤©ç„¶å…¼å®¹- æœ€å¤§åŒ–ååä¸èµ„æºåˆ©ç”¨ç‡ API ç½‘å…³ã€å®æ—¶æœåŠ¡ã€æ¨é€ç³»ç»Ÿ å·²æœ‰ RxJava æŠ€æœ¯æ ˆ å·²å¹¿æ³›ä½¿ç”¨ RxJava3æˆç†Ÿæµå¼ç®¡é“ RedissonRxClient RxJavaï¼ˆSingle / Flowableï¼‰ - æ— éœ€å¼•å…¥ Reactor ç”Ÿæ€- ä¸ç°æœ‰æµå¼æ¨¡å‹æ— ç¼é›†æˆ- æ”¯æŒèƒŒå‹ï¼ˆFlowableï¼‰- æ”¹é€ æˆæœ¬æœ€ä½ Android åç«¯ã€å†å²ç³»ç»Ÿ ğŸ“Š Redis æ•°æ®ç±»å‹ â†” Redisson å¯¹è±¡æ˜ å°„è¡¨ 1ï¸âƒ£ String Redis Redisson å¯¹è±¡ Java è¯­ä¹‰ å¸¸ç”¨ API åº•å±‚æ˜ å°„ è¯´æ˜ String RBucket&lt;T&gt; å•å€¼å¯¹è±¡ get / set / delete GET / SET æœ€å¸¸ç”¨ String RAtomicLong åŸå­è®¡æ•°å™¨ incrementAndGet INCRBY å¼ºè¯­ä¹‰ String RAtomicDouble åŸå­æµ®ç‚¹ addAndGet è‡ªå®ç° Lua String RLongAdder é«˜å¹¶å‘è®¡æ•° increment Hash + Lua åˆ†ç‰‡ String RBitSet ä½é›†åˆ set / get SETBIT / GETBIT ä½å›¾ String RBinaryStream äºŒè¿›åˆ¶æµ read / write GETRANGE å¤§å¯¹è±¡ 2ï¸âƒ£ Hash Redis Redisson å¯¹è±¡ Java è¯­ä¹‰ å¸¸ç”¨ API åº•å±‚æ˜ å°„ è¯´æ˜ Hash RMap&lt;K,V&gt; Map get / put / remove HGET / HSET æ ¸å¿ƒ Hash RMapCache&lt;K,V&gt; å¸¦ TTL Map put(key,val,ttl) Hash + ZSet è¿‡æœŸæ§åˆ¶ 3ï¸âƒ£ List Redis Redisson å¯¹è±¡ Java è¯­ä¹‰ å¸¸ç”¨ API åº•å±‚æ˜ å°„ è¯´æ˜ List RList&lt;V&gt; List add / get / remove LPUSH / LRANGE é¡ºåº List RQueue&lt;V&gt; Queue offer / poll RPUSH / LPOP é˜Ÿåˆ— List RDeque&lt;V&gt; Deque addFirst / addLast LPUSH / RPUSH åŒç«¯ List RBlockingQueue&lt;V&gt; BlockingQueue take BLPOP é˜»å¡æ¶ˆè´¹ 4ï¸âƒ£ Set Redis Redisson å¯¹è±¡ Java è¯­ä¹‰ å¸¸ç”¨ API åº•å±‚æ˜ å°„ è¯´æ˜ Set RSet&lt;V&gt; Set add / contains SADD / SISMEMBER æ— åº Set RSetCache&lt;V&gt; TTL Set add(ttl) Set + ZSet è‡ªåŠ¨è¿‡æœŸ Set RSortedSet&lt;V&gt; SortedSet add / first ZSet æœ‰åº 5ï¸âƒ£ ZSet Redis Redisson å¯¹è±¡ Java è¯­ä¹‰ å¸¸ç”¨ API åº•å±‚æ˜ å°„ è¯´æ˜ ZSet RScoredSortedSet&lt;V&gt; å¸¦ score é›†åˆ add(score) ZADD æ’è¡Œæ¦œ ZSet RLexSortedSet å­—å…¸æ’åºé›†åˆ add ZRANGEBYLEX å­—å…¸åº ZSet RPriorityQueue&lt;V&gt; ä¼˜å…ˆé˜Ÿåˆ— poll ZSet å †è¯­ä¹‰ ZSet RPriorityDeque&lt;V&gt; åŒç«¯ä¼˜å…ˆé˜Ÿåˆ— pollFirst ZSet æ‰©å±• 6ï¸âƒ£ Bitmap Redis Redisson å¯¹è±¡ Java è¯­ä¹‰ å¸¸ç”¨ API åº•å±‚æ˜ å°„ è¯´æ˜ Bitmap RBitSet BitSet set / get SETBIT ä½å›¾ Bitmap RLongAdder è®¡æ•°ä½ increment Bitmap åˆ†ç‰‡ é«˜å¹¶å‘ 7ï¸âƒ£ HyperLogLog Redis Redisson å¯¹è±¡ Java è¯­ä¹‰ å¸¸ç”¨ API åº•å±‚æ˜ å°„ è¯´æ˜ HyperLogLog RHyperLogLog&lt;V&gt; å»é‡è®¡æ•° add / count PFADD / PFCOUNT UVç»Ÿè®¡ 8ï¸âƒ£ Geo Redis Redisson å¯¹è±¡ Java è¯­ä¹‰ å¸¸ç”¨ API åº•å±‚æ˜ å°„ è¯´æ˜ Geo RGeo&lt;V&gt; åœ°ç†ç´¢å¼• add / radius GEOADD LBS 9ï¸âƒ£ Stream Redis Redisson å¯¹è±¡ Java è¯­ä¹‰ å¸¸ç”¨ API åº•å±‚æ˜ å°„ è¯´æ˜ Stream RStream&lt;K,V&gt; æ¶ˆæ¯æµ add / read XADD / XREAD æ¶ˆæ¯é˜Ÿåˆ— Stream RStreamReactive Reactive Stream subscribe XREADGROUP æµå¼ ğŸ”Ÿ Pub/Sub Redis Redisson å¯¹è±¡ Java è¯­ä¹‰ å¸¸ç”¨ API åº•å±‚æ˜ å°„ è¯´æ˜ PubSub RTopic Topic publish / addListener PUBLISH å¹¿æ’­ PubSub RPatternTopic Pattern subscribe PSUBSCRIBE æ¨¡å¼è®¢é˜…","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redisson çš„ä½¿ç”¨æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ Redisson å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡ä»¥Springbooté¡¹ç›®ä¸ºä¾‹ï¼Œä»‹ç»Redissonçš„ä½¿ç”¨æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub","date_published":"2026-01-09T14:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2026/01/09/redis-Redisson-01-base/","url":"https://blog.hanqunfeng.com/2026/01/09/redis-Redisson-01-base/","title":"Redisson ç®€ä»‹","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redisson</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\"><a href=\"https://redisson.pro/docs/getting-started/\">Redisson å®˜æ–¹æ–‡æ¡£</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Redisson-çš„å®˜æ–¹å®šä½\">Redisson çš„å®˜æ–¹å®šä½</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âœ… é¢å‘ Valkey / Redis çš„ Java å®¢æˆ·ç«¯</p>\n</li>\n<li class=\"lvl-2\">\n<p>âœ… åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª å®æ—¶æ•°æ®å¹³å°ï¼ˆReal-Time Data Platformï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>âœ… æä¾› é«˜çº§æŠ½è±¡ + åˆ†å¸ƒå¼èƒ½åŠ›æ‰©å±•</p>\n</li>\n</ul>\n<blockquote>\n<p>å¯ä»¥ç†è§£ä¸ºï¼šRedisson = Redis Java Client + åˆ†å¸ƒå¼å¯¹è±¡å¹³å° + é«˜çº§å¹¶å‘è¯­ä¹‰</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®ƒå¹¶ä¸æ˜¯ç®€å•æ›¿ä»£ Jedis / Lettuceï¼Œè€Œæ˜¯ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åœ¨ Redis ä¹‹ä¸Šæ„å»ºäº†ä¸€å±‚ é¢å‘å¯¹è±¡çš„åˆ†å¸ƒå¼æŠ½è±¡æ¨¡å‹</li>\n<li class=\"lvl-6\">æŠŠ Redis ä»â€œå‘½ä»¤å‹æ•°æ®åº“â€æå‡ä¸ºâ€œåˆ†å¸ƒå¼æ•°æ®ç»“æ„ä¸æœåŠ¡å¹³å°â€ã€‚</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p><a href=\"https://redisson.pro/blog/feature-comparison-redisson-vs-jedis.html\">Redisson vs Jedis</a><br>\n<a href=\"https://redisson.pro/blog/feature-comparison-redisson-vs-lettuce.html\">Redisson vs Lettuce</a></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redisson åœ¨ Java ä»£ç ä¸ Redis å‘½ä»¤ä¹‹é—´å¢åŠ äº†ä¸€å±‚æŠ½è±¡ï¼Œå…¶å¸¦æ¥çš„ä»·å€¼:</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ä»·å€¼</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å±è”½å‘½ä»¤ç»†èŠ‚</td>\n<td>ä¸å†ç›´æ¥æ‹¼ Redis å‘½ä»¤</td>\n</tr>\n<tr>\n<td>é¢å‘å¯¹è±¡å»ºæ¨¡</td>\n<td>Map / Set / Lock / Queue</td>\n</tr>\n<tr>\n<td>è¯­ä¹‰æ›´ç¨³å®š</td>\n<td>ä¸ä¾èµ–å‘½ä»¤ç»†èŠ‚</td>\n</tr>\n<tr>\n<td>é™ä½å­¦ä¹ æˆæœ¬</td>\n<td>Java å¼€å‘è€…æ— éœ€æ·±åº¦ç†è§£ Redis åè®®</td>\n</tr>\n<tr>\n<td>æå‡å¯ç»´æŠ¤æ€§</td>\n<td>ä¸šåŠ¡ä»£ç æ›´æ¸…æ™°</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Redisson-æ‰©å±•çš„èƒ½åŠ›\">Redisson æ‰©å±•çš„èƒ½åŠ›</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†å¸ƒå¼é›†åˆï¼ˆDistributed Collectionsï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ç‰¹ç‚¹ï¼š</span><br><span class=\"line\">    æ•°æ®å­˜å‚¨åœ¨ Redis</span><br><span class=\"line\">    è¯­ä¹‰ä¸ Java é›†åˆä¸€è‡´</span><br><span class=\"line\">    æ”¯æŒåˆ†å¸ƒå¼å¹¶å‘è®¿é—®</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>Redisson å¯¹è±¡</th>\n<th>ç±»æ¯” Java</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>RMap</td>\n<td>Map</td>\n</tr>\n<tr>\n<td>RSet</td>\n<td>Set</td>\n</tr>\n<tr>\n<td>RList</td>\n<td>List</td>\n</tr>\n<tr>\n<td>RQueue</td>\n<td>Queue</td>\n</tr>\n<tr>\n<td>RDeque</td>\n<td>Deque</td>\n</tr>\n<tr>\n<td>RSortedSet</td>\n<td>SortedSet</td>\n</tr>\n<tr>\n<td>RBlockingQueue</td>\n<td>BlockingQueue</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†å¸ƒå¼å¯¹è±¡ï¼ˆDistributed Objectsï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å¯¹è±¡</th>\n<th>è¯­ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>RAtomicLong</td>\n<td>åˆ†å¸ƒå¼åŸå­è®¡æ•°</td>\n</tr>\n<tr>\n<td>RBucket</td>\n<td>å•å€¼å¯¹è±¡ï¼Œå¦‚ï¼šRedissonBucketï¼ŒRedissonJsonBucket</td>\n</tr>\n<tr>\n<td>RBitSet</td>\n<td>ä½é›†åˆ</td>\n</tr>\n<tr>\n<td>RBloomFilter</td>\n<td>å¸ƒéš†è¿‡æ»¤å™¨</td>\n</tr>\n<tr>\n<td>RHyperLogLog</td>\n<td>åŸºæ•°ç»Ÿè®¡</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†å¸ƒå¼æœåŠ¡ï¼ˆDistributed Servicesï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¿™æ˜¯ Redisson çœŸæ­£çš„æ ¸å¿ƒç«äº‰åŠ›ã€‚</span><br><span class=\"line\">è¿™äº›èƒ½åŠ›ï¼š</span><br><span class=\"line\">    Redis åŸç”Ÿå¹¶ä¸ç›´æ¥æä¾›</span><br><span class=\"line\">    Redisson é€šè¿‡ Lua + çŠ¶æ€æœº + Watchdog å®ç°</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>æœåŠ¡</th>\n<th>è§£å†³é—®é¢˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>RLock</td>\n<td>åˆ†å¸ƒå¼é”</td>\n</tr>\n<tr>\n<td>RFairLock</td>\n<td>å…¬å¹³é”</td>\n</tr>\n<tr>\n<td>RReadWriteLock</td>\n<td>è¯»å†™é”</td>\n</tr>\n<tr>\n<td>RSemaphore</td>\n<td>ä¿¡å·é‡</td>\n</tr>\n<tr>\n<td>RCountDownLatch</td>\n<td>é—­é”</td>\n</tr>\n<tr>\n<td>RRateLimiter</td>\n<td>é™æµ</td>\n</tr>\n<tr>\n<td>RDelayedQueue</td>\n<td>å»¶è¿Ÿé˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td>RExecutorService</td>\n<td>åˆ†å¸ƒå¼çº¿ç¨‹æ± </td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤æ˜ å°„èƒ½åŠ›ï¼ˆCommand Mappingï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Redisson æä¾›ï¼š</span><br><span class=\"line\">    Redis Command â†’ Redisson API æ˜ å°„è¡¨</span><br><span class=\"line\"></span><br><span class=\"line\">ç”¨é€”ï¼š</span><br><span class=\"line\">    ä»å‘½ä»¤å¼æ€ç»´è¿‡æ¸¡åˆ°å¯¹è±¡å¼ API</span><br><span class=\"line\">    å¿«é€Ÿå®šä½åŠŸèƒ½æ¥å£</span><br><span class=\"line\">    éªŒè¯åº•å±‚å®ç°æœºåˆ¶</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>Redis ç±»å‹</th>\n<th>Redisson å¯¹è±¡</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>String</td>\n<td>RBucket, RAtomicLong, RBitSet</td>\n</tr>\n<tr>\n<td>Hash</td>\n<td>RMap, RMapCache</td>\n</tr>\n<tr>\n<td>List</td>\n<td>RList, RQueue, RBlockingQueue</td>\n</tr>\n<tr>\n<td>Set</td>\n<td>RSet, RSetCache</td>\n</tr>\n<tr>\n<td>ZSet</td>\n<td>RScoredSortedSet, RPriorityQueue</td>\n</tr>\n<tr>\n<td>Bitmap</td>\n<td>RBitSet</td>\n</tr>\n<tr>\n<td>HyperLogLog</td>\n<td>RHyperLogLog</td>\n</tr>\n<tr>\n<td>Geo</td>\n<td>RGeo</td>\n</tr>\n<tr>\n<td>Stream</td>\n<td>RStream</td>\n</tr>\n<tr>\n<td>PubSub</td>\n<td>RTopic</td>\n</tr>\n<tr>\n<td>JSON</td>\n<td>RJSONBucket</td>\n</tr>\n<tr>\n<td>Vector<code>(Redis8+) </code></td>\n<td>RVectorSet</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RedisTemplate-VS-Redisson\">RedisTemplate VS Redisson</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»“è®ºå…ˆè¡Œï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ… å¦‚æœä½ åªæ˜¯æŠŠ Redis å½“ä½œ KV / Cache / ç®€å•æ•°æ®ç»“æ„å­˜å‚¨ â†’ ä¼˜å…ˆä½¿ç”¨ RedisTemplate</span><br><span class=\"line\">âœ… å¦‚æœä½ éœ€è¦åˆ†å¸ƒå¼èƒ½åŠ›ï¼ˆé”ã€é™æµã€é˜Ÿåˆ—ã€åŒæ­¥å™¨ã€åŸå­å¯¹è±¡ï¼‰ â†’ ä¼˜å…ˆä½¿ç”¨ RedissonClient</span><br><span class=\"line\">â—åœ¨å¤æ‚ç³»ç»Ÿä¸­ï¼Œä¸¤è€…å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œå„å¸å…¶èŒ</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ¸å¿ƒå®šä½å·®å¼‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>RedisTemplate</th>\n<th>RedissonClient</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æŠ½è±¡å±‚çº§</td>\n<td>Redis åŸç”Ÿå‘½ä»¤å°è£…</td>\n<td>åˆ†å¸ƒå¼å¯¹è±¡ä¸åŒæ­¥å™¨</td>\n</tr>\n<tr>\n<td>ç¼–ç¨‹æ¨¡å‹</td>\n<td>Command-oriented</td>\n<td>Object-oriented</td>\n</tr>\n<tr>\n<td>å…³æ³¨ç‚¹</td>\n<td>æ•°æ®è®¿é—®</td>\n<td>åˆ†å¸ƒå¼åè°ƒ</td>\n</tr>\n<tr>\n<td>åŠŸèƒ½ç²’åº¦</td>\n<td>String / Hash / List / ZSet</td>\n<td>Map / Lock / Semaphore / Queue</td>\n</tr>\n<tr>\n<td>ä¸€è‡´æ€§ä¿éšœ</td>\n<td>éœ€è¦è‡ªå·±è®¾è®¡</td>\n<td>å†…ç½®å®ç°</td>\n</tr>\n<tr>\n<td>ä¸šåŠ¡è¯­ä¹‰</td>\n<td>ååº•å±‚</td>\n<td>åä¸šåŠ¡</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ€§èƒ½ä¸ç¨³å®šæ€§å¯¹æ¯”</p>\n</li>\n</ul>\n<blockquote>\n<p>åœ¨â€œçº¯ KV è®¿é—®â€åœºæ™¯ä¸‹ï¼ŒRedisTemplate çš„æ€§èƒ½é€šå¸¸ä¼˜äº Redissonã€‚</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>RedisTemplate</th>\n<th>Redisson</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å»¶è¿Ÿ</td>\n<td>æ›´ä½</td>\n<td>ç•¥é«˜ï¼ˆå¯¹è±¡å°è£…ï¼‰</td>\n</tr>\n<tr>\n<td>åå</td>\n<td>æ›´é«˜</td>\n<td>ç•¥ä½</td>\n</tr>\n<tr>\n<td>å†…å­˜å¼€é”€</td>\n<td>æœ€å°</td>\n<td>è¾ƒé«˜</td>\n</tr>\n<tr>\n<td>ç½‘ç»œè¯·æ±‚</td>\n<td>ç²¾ç®€</td>\n<td>å¯èƒ½å¤šæ¬¡äº¤äº’</td>\n</tr>\n<tr>\n<td>ç¨³å®šæ€§</td>\n<td>æé«˜</td>\n<td>é«˜ï¼ˆä¾èµ–å†…éƒ¨çŠ¶æ€æœºï¼‰</td>\n</tr>\n<tr>\n<td>æ’éšœå¤æ‚åº¦</td>\n<td>ä½</td>\n<td>ä¸­~é«˜</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âœ… å®é™…ç”Ÿäº§ä¸­çš„æœ€ä½³å®è·µ: âœ”ï¸ ä¸¤è€…å…±å­˜ï¼Œè€Œä¸æ˜¯äºŒé€‰ä¸€ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŠŸèƒ½</th>\n<th>æŠ€æœ¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ç¼“å­˜ / æŸ¥è¯¢</td>\n<td>RedisTemplate</td>\n</tr>\n<tr>\n<td>åˆ†å¸ƒå¼é”</td>\n<td>Redisson</td>\n</tr>\n<tr>\n<td>å»¶è¿Ÿé˜Ÿåˆ—</td>\n<td>Redisson</td>\n</tr>\n<tr>\n<td>åŸå­è®¡æ•°</td>\n<td>RedisTemplate æˆ– Redisson Atomic</td>\n</tr>\n<tr>\n<td>æœç´¢ / æ—¶åº</td>\n<td>RedisTemplate</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redisson æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ Redisson å®˜æ–¹æ–‡æ¡£ Redisson çš„å®˜æ–¹å®šä½ âœ… é¢å‘ Valkey / Redis çš„ Java å®¢æˆ·ç«¯ âœ… åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª å®æ—¶æ•°æ®å¹³å°ï¼ˆReal-Time Data Platformï¼‰ âœ… æä¾› é«˜çº§æŠ½è±¡ + åˆ†å¸ƒå¼èƒ½åŠ›æ‰©å±• å¯ä»¥ç†è§£ä¸ºï¼šRedisson = Redis Java Client + åˆ†å¸ƒå¼å¯¹è±¡å¹³å° + é«˜çº§å¹¶å‘è¯­ä¹‰ å®ƒå¹¶ä¸æ˜¯ç®€å•æ›¿ä»£ Jedis / Lettuceï¼Œè€Œæ˜¯ï¼š åœ¨ Redis ä¹‹ä¸Šæ„å»ºäº†ä¸€å±‚ é¢å‘å¯¹è±¡çš„åˆ†å¸ƒå¼æŠ½è±¡æ¨¡å‹ æŠŠ Redis ä»â€œå‘½ä»¤å‹æ•°æ®åº“â€æå‡ä¸ºâ€œåˆ†å¸ƒå¼æ•°æ®ç»“æ„ä¸æœåŠ¡å¹³å°â€ã€‚ Redisson vs Jedis Redisson vs Lettuce Redisson åœ¨ Java ä»£ç ä¸ Redis å‘½ä»¤ä¹‹é—´å¢åŠ äº†ä¸€å±‚æŠ½è±¡ï¼Œå…¶å¸¦æ¥çš„ä»·å€¼: ä»·å€¼ è¯´æ˜ å±è”½å‘½ä»¤ç»†èŠ‚ ä¸å†ç›´æ¥æ‹¼ Redis å‘½ä»¤ é¢å‘å¯¹è±¡å»ºæ¨¡ Map / Set / Lock / Queue è¯­ä¹‰æ›´ç¨³å®š ä¸ä¾èµ–å‘½ä»¤ç»†èŠ‚ é™ä½å­¦ä¹ æˆæœ¬ Java å¼€å‘è€…æ— éœ€æ·±åº¦ç†è§£ Redis åè®® æå‡å¯ç»´æŠ¤æ€§ ä¸šåŠ¡ä»£ç æ›´æ¸…æ™° Redisson æ‰©å±•çš„èƒ½åŠ› åˆ†å¸ƒå¼é›†åˆï¼ˆDistributed Collectionsï¼‰ 1234ç‰¹ç‚¹ï¼š æ•°æ®å­˜å‚¨åœ¨ Redis è¯­ä¹‰ä¸ Java é›†åˆä¸€è‡´ æ”¯æŒåˆ†å¸ƒå¼å¹¶å‘è®¿é—® Redisson å¯¹è±¡ ç±»æ¯” Java RMap Map RSet Set RList List RQueue Queue RDeque Deque RSortedSet SortedSet RBlockingQueue BlockingQueue åˆ†å¸ƒå¼å¯¹è±¡ï¼ˆDistributed Objectsï¼‰ å¯¹è±¡ è¯­ä¹‰ RAtomicLong åˆ†å¸ƒå¼åŸå­è®¡æ•° RBucket å•å€¼å¯¹è±¡ï¼Œå¦‚ï¼šRedissonBucketï¼ŒRedissonJsonBucket RBitSet ä½é›†åˆ RBloomFilter å¸ƒéš†è¿‡æ»¤å™¨ RHyperLogLog åŸºæ•°ç»Ÿè®¡ åˆ†å¸ƒå¼æœåŠ¡ï¼ˆDistributed Servicesï¼‰ 1234è¿™æ˜¯ Redisson çœŸæ­£çš„æ ¸å¿ƒç«äº‰åŠ›ã€‚è¿™äº›èƒ½åŠ›ï¼š Redis åŸç”Ÿå¹¶ä¸ç›´æ¥æä¾› Redisson é€šè¿‡ Lua + çŠ¶æ€æœº + Watchdog å®ç° æœåŠ¡ è§£å†³é—®é¢˜ RLock åˆ†å¸ƒå¼é” RFairLock å…¬å¹³é” RReadWriteLock è¯»å†™é” RSemaphore ä¿¡å·é‡ RCountDownLatch é—­é” RRateLimiter é™æµ RDelayedQueue å»¶è¿Ÿé˜Ÿåˆ— RExecutorService åˆ†å¸ƒå¼çº¿ç¨‹æ±  å‘½ä»¤æ˜ å°„èƒ½åŠ›ï¼ˆCommand Mappingï¼‰ 1234567Redisson æä¾›ï¼š Redis Command â†’ Redisson API æ˜ å°„è¡¨ç”¨é€”ï¼š ä»å‘½ä»¤å¼æ€ç»´è¿‡æ¸¡åˆ°å¯¹è±¡å¼ API å¿«é€Ÿå®šä½åŠŸèƒ½æ¥å£ éªŒè¯åº•å±‚å®ç°æœºåˆ¶ Redis ç±»å‹ Redisson å¯¹è±¡ String RBucket, RAtomicLong, RBitSet Hash RMap, RMapCache List RList, RQueue, RBlockingQueue Set RSet, RSetCache ZSet RScoredSortedSet, RPriorityQueue Bitmap RBitSet HyperLogLog RHyperLogLog Geo RGeo Stream RStream PubSub RTopic JSON RJSONBucket Vector(Redis8+) RVectorSet RedisTemplate VS Redisson ç»“è®ºå…ˆè¡Œï¼š 123âœ… å¦‚æœä½ åªæ˜¯æŠŠ Redis å½“ä½œ KV / Cache / ç®€å•æ•°æ®ç»“æ„å­˜å‚¨ â†’ ä¼˜å…ˆä½¿ç”¨ RedisTemplateâœ… å¦‚æœä½ éœ€è¦åˆ†å¸ƒå¼èƒ½åŠ›ï¼ˆé”ã€é™æµã€é˜Ÿåˆ—ã€åŒæ­¥å™¨ã€åŸå­å¯¹è±¡ï¼‰ â†’ ä¼˜å…ˆä½¿ç”¨ RedissonClientâ—åœ¨å¤æ‚ç³»ç»Ÿä¸­ï¼Œä¸¤è€…å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œå„å¸å…¶èŒ æ ¸å¿ƒå®šä½å·®å¼‚ ç»´åº¦ RedisTemplate RedissonClient æŠ½è±¡å±‚çº§ Redis åŸç”Ÿå‘½ä»¤å°è£… åˆ†å¸ƒå¼å¯¹è±¡ä¸åŒæ­¥å™¨ ç¼–ç¨‹æ¨¡å‹ Command-oriented Object-oriented å…³æ³¨ç‚¹ æ•°æ®è®¿é—® åˆ†å¸ƒå¼åè°ƒ åŠŸèƒ½ç²’åº¦ String / Hash / List / ZSet Map / Lock / Semaphore / Queue ä¸€è‡´æ€§ä¿éšœ éœ€è¦è‡ªå·±è®¾è®¡ å†…ç½®å®ç° ä¸šåŠ¡è¯­ä¹‰ ååº•å±‚ åä¸šåŠ¡ æ€§èƒ½ä¸ç¨³å®šæ€§å¯¹æ¯” åœ¨â€œçº¯ KV è®¿é—®â€åœºæ™¯ä¸‹ï¼ŒRedisTemplate çš„æ€§èƒ½é€šå¸¸ä¼˜äº Redissonã€‚ ç»´åº¦ RedisTemplate Redisson å»¶è¿Ÿ æ›´ä½ ç•¥é«˜ï¼ˆå¯¹è±¡å°è£…ï¼‰ åå æ›´é«˜ ç•¥ä½ å†…å­˜å¼€é”€ æœ€å° è¾ƒé«˜ ç½‘ç»œè¯·æ±‚ ç²¾ç®€ å¯èƒ½å¤šæ¬¡äº¤äº’ ç¨³å®šæ€§ æé«˜ é«˜ï¼ˆä¾èµ–å†…éƒ¨çŠ¶æ€æœºï¼‰ æ’éšœå¤æ‚åº¦ ä½ ä¸­~é«˜ âœ… å®é™…ç”Ÿäº§ä¸­çš„æœ€ä½³å®è·µ: âœ”ï¸ ä¸¤è€…å…±å­˜ï¼Œè€Œä¸æ˜¯äºŒé€‰ä¸€ã€‚ åŠŸèƒ½ æŠ€æœ¯ ç¼“å­˜ / æŸ¥è¯¢ RedisTemplate åˆ†å¸ƒå¼é” Redisson å»¶è¿Ÿé˜Ÿåˆ— Redisson åŸå­è®¡æ•° RedisTemplate æˆ– Redisson Atomic æœç´¢ / æ—¶åº RedisTemplate","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redisson æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ Redisson å®˜æ–¹æ–‡æ¡£","date_published":"2026-01-09T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2026/01/08/redis7-datatype-19-RoaringBitmap/","url":"https://blog.hanqunfeng.com/2026/01/08/redis7-datatype-19-RoaringBitmap/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- RoaringBitmap","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisRoaring ä¸­ RoaringBitmap æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\">RedisRoaring çš„å®‰è£…å‚è§ <a href=\"/2026/01/08/redis7-module-RedisRoaring/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisRoaring çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisRoaring çš„å®‰è£…æ–¹æ³•</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RoaringBitmap-å‘½ä»¤\">RoaringBitmap å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥åœ¨ redis-cli ä¸­æ‰§è¡Œ <code>help @module</code>ï¼Œæ‰¾å‡ºæ‰€æœ‰ <code>R.*</code> å’Œ <code>R64.*</code> çš„å‘½ä»¤è¯´æ˜</p>\n</li>\n<li class=\"lvl-2\">\n<p>R.*ï¼šæ“ä½œçš„æ˜¯ 32 ä½æ— ç¬¦å·æ•´æ•°ï¼ˆæœ€å¤§çº¦ 2^32-1ï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>R64.*ï¼šæ“ä½œçš„æ˜¯ 64 ä½æ— ç¬¦å·æ•´æ•°ï¼ˆæœ€å¤§çº¦ 2^64-1ï¼‰ï¼Œé€‚åˆè¶…å¤§ ID ç©ºé—´ï¼Œå¦‚ Snowflake / æ—¶é—´æˆ³æ˜ å°„</p>\n<blockquote>\n<p>R64.* æ”¯æŒçš„æ•´æ•°ç†è®ºä¸Šæ˜¯ 0 ~ 2â¶â´-1ï¼ˆçº¦ 1.84e19ï¼‰ï¼Œä½†å·¥ç¨‹ä¸Šåº”è°¨æ…ä½¿ç”¨è¶…å¤§ offsetï¼Œé¿å…ç¨€ç–çˆ†ç‚¸å’Œæ€§èƒ½é€€åŒ–ã€‚</p>\n</blockquote>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">high 32 bits  -&gt; container key å¤§æ¡¶</span><br><span class=\"line\">low  32 bits  -&gt; container offset å°æ¡¶</span><br><span class=\"line\"></span><br><span class=\"line\">å½“ä½ å†™å…¥ä¸€ä¸ªéå¸¸å¤§çš„å€¼ï¼Œä¾‹å¦‚ 10^18</span><br><span class=\"line\">   è™½ç„¶ Roaring åªä¸ºå­˜åœ¨æ•°æ®çš„ container åˆ†é…å†…å­˜ã€‚</span><br><span class=\"line\">   ä½† container çš„ key æœ¬èº«æ˜¯ä¸€ä¸ª map / array ç´¢å¼•ç»“æ„ã€‚</span><br><span class=\"line\">   æç«¯ç¨€ç–ã€è¶…å¤§ offset ä¼šå¢åŠ ç´¢å¼•ç®¡ç†æˆæœ¬ï¼Œä¼šå¯¼è‡´æŸäº›å‘½ä»¤æ“ä½œä¼šå˜å¾—å¾ˆæ…¢ã€‚</span><br><span class=\"line\">   å¦å¤–ï¼Œä¸€ä¸ªå®¹å™¨è‡³å°‘è¦ å‡ åå­—èŠ‚ ~ å‡ ç™¾å­—èŠ‚çº§åˆ«ï¼Œå®¹å™¨çš„æ•°é‡è¿‡å¤šï¼Œå•æœºå†…å­˜ä¹Ÿæ— æ³•æ»¡è¶³</span><br><span class=\"line\">   å¦‚æœä½ åˆ›å»º 10 äº¿ä¸ª containerï¼Œå‡è®¾æ¯ä¸ª container å ç”¨ 100 å­—èŠ‚ï¼Œé‚£ä¹ˆå†…å­˜å ç”¨ä¸ºï¼š</span><br><span class=\"line\">   10^9 containers Ã— 100 bytes â‰ˆ 100 GB å†…å­˜</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¤è€…è¯­ä¹‰å®Œå…¨ä¸€è‡´ï¼Œä»…æ”¯æŒçš„ offset èŒƒå›´ä¸åŒï¼Œä»¥ä¸‹ç¤ºä¾‹ä»¥ R.* ä¸ºä¸»ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯¹æ¯” R ä¸ R64</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>R.*</th>\n<th>R64.*</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Offset ç±»å‹</td>\n<td>uint32</td>\n<td>uint64</td>\n</tr>\n<tr>\n<td>æœ€å¤§å€¼</td>\n<td>4,294,967,295 (~4.29e9)</td>\n<td>18,446,744,073,709,551,615 (~1.84e19)</td>\n</tr>\n<tr>\n<td>å¯è¡¨è¾¾è§„æ¨¡</td>\n<td>åäº¿çº§</td>\n<td>ä¸‡äº¿äº¿çº§</td>\n</tr>\n<tr>\n<td>å…¸å‹ç”¨é€”</td>\n<td>ç”¨æˆ·IDã€ç´¢å¼•</td>\n<td>æ—¶é—´æˆ³ã€é›ªèŠ±IDã€å…¨å±€å”¯ä¸€ID</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ä¸€ã€æ•°æ®å†™å…¥-ä¿®æ”¹ç±»\">ä¸€ã€æ•°æ®å†™å…¥ / ä¿®æ”¹ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>å…¸å‹ç”¨é€”</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>R.SETBIT</td>\n<td>è®¾ç½®å•ä¸ª bitï¼ˆ0/1ï¼‰ï¼Œè¿”å›æ—§å€¼</td>\n<td>å•ç‚¹æ ‡è®°</td>\n<td><code>R.SETBIT users 1001 1</code></td>\n</tr>\n<tr>\n<td>R.SETRANGE</td>\n<td>æ‰¹é‡è®¾ç½®åŒºé—´ bit=1</td>\n<td>è¿ç»­åŒºé—´æ‰“æ ‡</td>\n<td><code>R.SETRANGE users 3000 3999</code>ï¼Œä¸åŒ…å«3999</td>\n</tr>\n<tr>\n<td>R.APPENDINTARRAY</td>\n<td>è¿½åŠ å¤šä¸ªæ•´æ•°ï¼ˆbit=1ï¼‰</td>\n<td>æ‰¹é‡æ’å…¥ ID</td>\n<td><code>R.APPENDINTARRAY users 1001 1002 1003</code></td>\n</tr>\n<tr>\n<td>R.SETINTARRAY</td>\n<td>ç”¨æ•´æ•°æ•°ç»„é‡å»º bitmap</td>\n<td>åˆå§‹åŒ–æ•°æ®</td>\n<td><code>R.SETINTARRAY users 1 3 5 7</code></td>\n</tr>\n<tr>\n<td>R.SETBITARRAY</td>\n<td>ç”¨ bit å­—ç¬¦ä¸²é‡å»º bitmap</td>\n<td>å¤–éƒ¨å¯¼å…¥</td>\n<td><code>R.SETBITARRAY users &quot;101001&quot;</code></td>\n</tr>\n<tr>\n<td>R.DELETEINTARRAY</td>\n<td>åˆ é™¤å¤šä¸ªæ•´æ•°ï¼ˆbit=0ï¼‰</td>\n<td>æ‰¹é‡åˆ é™¤</td>\n<td><code>R.DELETEINTARRAY users 1002 2000</code></td>\n</tr>\n<tr>\n<td>R.CLEARBITS</td>\n<td>æ¸…é™¤æŒ‡å®š offset</td>\n<td>ç²¾ç¡®æ¸…ç†</td>\n<td><code>R.CLEARBITS users 1001 1003</code></td>\n</tr>\n<tr>\n<td>R.SETFULL</td>\n<td>å¡«å……æ•´ä¸ª bitmap</td>\n<td>å…¨é‡åˆå§‹åŒ–</td>\n<td><code>R.SETFULL users</code></td>\n</tr>\n<tr>\n<td>R.CLEAR</td>\n<td>åˆ é™¤æ•´ä¸ª bitmap</td>\n<td>é‡Šæ”¾èµ„æº</td>\n<td><code>R.CLEAR users</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"äºŒã€æ•°æ®è¯»å–-æŸ¥è¯¢ç±»\">äºŒã€æ•°æ®è¯»å– / æŸ¥è¯¢ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>å…¸å‹ç”¨é€”</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>R.GETBIT</td>\n<td>è·å–å•ä¸ª bit</td>\n<td>åˆ¤æ–­æ˜¯å¦å­˜åœ¨</td>\n<td><code>R.GETBIT users 1001</code></td>\n</tr>\n<tr>\n<td>R.GETBITS</td>\n<td>æ‰¹é‡è·å– bit</td>\n<td>å¤šç‚¹æŸ¥è¯¢</td>\n<td><code>R.GETBITS users 1001 1002 1003</code></td>\n</tr>\n<tr>\n<td>R.GETBITARRAY</td>\n<td>è¿”å›å®Œæ•´ bit å­—ç¬¦ä¸²</td>\n<td>è°ƒè¯• / å¯¼å‡º</td>\n<td><code>R.GETBITARRAY users</code></td>\n</tr>\n<tr>\n<td>R.GETINTARRAY</td>\n<td>è¿”å›æ‰€æœ‰ä¸º 1 çš„æ•´æ•°</td>\n<td>å…¨é‡éå†</td>\n<td><code>R.GETINTARRAY users</code></td>\n</tr>\n<tr>\n<td>R.RANGEINTARRAY</td>\n<td>è¿”å›åŒºé—´å†…æ•´æ•°ï¼Œæ³¨æ„è¿™é‡Œå‚æ•°æ˜¯<code>ç´¢å¼•ä¸‹æ ‡</code>ï¼Œä¸æ˜¯<code>æ•°å€¼</code></td>\n<td>åˆ†é¡µæ‰«æ</td>\n<td><code>R.RANGEINTARRAY users 1 5</code></td>\n</tr>\n<tr>\n<td>R.MIN</td>\n<td>æœ€å° offset</td>\n<td>æœ€å° ID æŸ¥è¯¢</td>\n<td><code>R.MIN users</code></td>\n</tr>\n<tr>\n<td>R.MAX</td>\n<td>æœ€å¤§ offset</td>\n<td>æœ€å¤§ ID æŸ¥è¯¢</td>\n<td><code>R.MAX users</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ä¸‰ã€ç»Ÿè®¡ç±»\">ä¸‰ã€ç»Ÿè®¡ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>å…¸å‹ç”¨é€”</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>R.BITCOUNT</td>\n<td>bit=1 æ•°é‡ç»Ÿè®¡</td>\n<td>é›†åˆåŸºæ•°</td>\n<td><code>R.BITCOUNT users</code></td>\n</tr>\n<tr>\n<td>R.BITPOS</td>\n<td>æŸ¥æ‰¾ç¬¬ä¸€ä¸ª 1 æˆ– 0</td>\n<td>ç¨€ç–åˆ†æ</td>\n<td><code>R.BITPOS users 1</code></td>\n</tr>\n<tr>\n<td>R.MIN</td>\n<td>æœ€å° bit ä½ç½®</td>\n<td>è¾¹ç•Œæ£€æµ‹</td>\n<td><code>R.MIN users</code></td>\n</tr>\n<tr>\n<td>R.MAX</td>\n<td>æœ€å¤§ bit ä½ç½®</td>\n<td>è¾¹ç•Œæ£€æµ‹</td>\n<td><code>R.MAX users</code></td>\n</tr>\n<tr>\n<td>R.STAT</td>\n<td>å®¹å™¨ / å†…å­˜ç»Ÿè®¡</td>\n<td>æ€§èƒ½è°ƒä¼˜</td>\n<td><code>R.STAT users TEXT</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å››ã€é›†åˆè¿ç®—ç±»\">å››ã€é›†åˆè¿ç®—ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>é›†åˆè¯­ä¹‰</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>R.BITOP AND</td>\n<td>ä½å›¾äº¤é›†</td>\n<td>A âˆ© B</td>\n<td><code>R.BITOP AND res a b</code></td>\n</tr>\n<tr>\n<td>R.BITOP OR</td>\n<td>ä½å›¾å¹¶é›†</td>\n<td>A âˆª B</td>\n<td><code>R.BITOP OR res a b</code></td>\n</tr>\n<tr>\n<td>R.BITOP XOR</td>\n<td>å¯¹ç§°å·®é›†</td>\n<td>A âŠ• B</td>\n<td><code>R.BITOP XOR res a b</code></td>\n</tr>\n<tr>\n<td>R.DIFF</td>\n<td>å·®é›†</td>\n<td>A - B</td>\n<td><code>R.DIFF res a b</code></td>\n</tr>\n<tr>\n<td>R.CONTAINS</td>\n<td>åŒ…å«å…³ç³»åˆ¤æ–­</td>\n<td>å­é›†æ£€æµ‹</td>\n<td><code>R.CONTAINS a b ALL</code></td>\n</tr>\n<tr>\n<td>R.JACCARD</td>\n<td>ç›¸ä¼¼åº¦è®¡ç®—</td>\n<td>J(A,B)</td>\n<td><code>R.JACCARD a b</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"äº”ã€ç»´æŠ¤-ä¼˜åŒ–ç±»\">äº”ã€ç»´æŠ¤ / ä¼˜åŒ–ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>å…¸å‹ç”¨é€”</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>R.OPTIMIZE</td>\n<td>å®¹å™¨é‡æ•´ / å‹ç¼©</td>\n<td>é™ä½å†…å­˜</td>\n<td><code>R.OPTIMIZE users MEM</code></td>\n</tr>\n<tr>\n<td>R.CLEAR</td>\n<td>æ¸…ç† bitmap</td>\n<td>å›æ”¶èµ„æº</td>\n<td><code>R.CLEAR users</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å…­ã€R-R64-å¯¹ç…§è¡¨ï¼ˆå«ç¤ºä¾‹ï¼‰\">å…­ã€R / R64 å¯¹ç…§è¡¨ï¼ˆå«ç¤ºä¾‹ï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>åŠŸèƒ½</th>\n<th>R (32bit)</th>\n<th>R64 (64bit)</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>è®¾ç½® bit</td>\n<td>R.SETBIT</td>\n<td>R64.SETBIT</td>\n<td><code>R64.SETBIT users64 90000000000 1</code></td>\n</tr>\n<tr>\n<td>æ‰¹é‡æ’å…¥</td>\n<td>R.APPENDINTARRAY</td>\n<td>R64.APPENDINTARRAY</td>\n<td><code>R64.APPENDINTARRAY users64 90000000001 90000000002</code></td>\n</tr>\n<tr>\n<td>æŸ¥è¯¢ bit</td>\n<td>R.GETBIT</td>\n<td>R64.GETBIT</td>\n<td><code>R64.GETBIT users64 90000000001</code></td>\n</tr>\n<tr>\n<td>ç»Ÿè®¡</td>\n<td>R.BITCOUNT</td>\n<td>R64.BITCOUNT</td>\n<td><code>R64.BITCOUNT users64</code></td>\n</tr>\n<tr>\n<td>é›†åˆè¿ç®—</td>\n<td>R.BITOP</td>\n<td>R64.BITOP</td>\n<td><code>R64.BITOP OR res64 a64 b64</code></td>\n</tr>\n<tr>\n<td>ä¼˜åŒ–</td>\n<td>R.OPTIMIZE</td>\n<td>R64.OPTIMIZE</td>\n<td><code>R64.OPTIMIZE users64 MEM</code></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"çœŸå®æ¡ˆä¾‹\">çœŸå®æ¡ˆä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”µå•†å¹³å°ï¼Œéœ€è¦ç»Ÿè®¡ä»¥ä¸‹æŒ‡æ ‡ï¼š</span><br><span class=\"line\">   VIP ç”¨æˆ·ï¼ˆè´­ä¹°é‡‘é¢è¶…è¿‡ 1000 çš„ç”¨æˆ·ï¼‰</span><br><span class=\"line\">   ä»˜è´¹ç”¨æˆ·ï¼ˆè‡³å°‘è´­ä¹°ä¸€æ¬¡çš„ç”¨æˆ·ï¼‰</span><br><span class=\"line\">   æœ€è¿‘æ´»è·ƒç”¨æˆ·ï¼ˆè¿‡å» 7 å¤©å†…ç™»å½•è¿‡çš„ç”¨æˆ·ï¼‰</span><br><span class=\"line\"></span><br><span class=\"line\">æˆ‘ä»¬æƒ³è¦è®¡ç®—ï¼š</span><br><span class=\"line\">   VIP ç”¨æˆ·äººæ•°</span><br><span class=\"line\">   VIP ä¸”æœ€è¿‘æ´»è·ƒçš„ç”¨æˆ·äººæ•°</span><br><span class=\"line\">   VIP ä¸”ä»˜è´¹ç”¨æˆ·ä¸”æœ€è¿‘æ´»è·ƒçš„äººæ•°</span><br><span class=\"line\">   ä»˜è´¹ç”¨æˆ·ä¸æœ€è¿‘æ´»è·ƒç”¨æˆ·çš„ Jaccard ç›¸ä¼¼åº¦</span><br><span class=\"line\"></span><br><span class=\"line\">å‡è®¾ç”¨æˆ· ID ä¸ºæ•´æ•°ï¼ˆæœ€å¤§å€¼ &lt; 2^32ï¼Œä½¿ç”¨ R.* å³å¯ï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol>\n<li class=\"lvl-5\">å†™å…¥æ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># VIP ç”¨æˆ·</span></span><br><span class=\"line\">R.APPENDINTARRAY vip_users 1001 1002 1003 1004 1005</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»˜è´¹ç”¨æˆ·</span></span><br><span class=\"line\">R.APPENDINTARRAY paid_users 1002 1003 1005 1006 1007</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æœ€è¿‘æ´»è·ƒç”¨æˆ·</span></span><br><span class=\"line\">R.APPENDINTARRAY active_users 1001 1003 1005 1008</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ•°æ®ç±»å‹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">type</span> active_users</span><br><span class=\"line\">reroaring</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"2\">\n<li class=\"lvl-5\">æŸ¥è¯¢åŸºç¡€ç»Ÿè®¡</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># VIP ç”¨æˆ·äººæ•°</span></span><br><span class=\"line\">R.BITCOUNT vip_users</span><br><span class=\"line\"><span class=\"comment\"># è¿”å› 5</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æœ€è¿‘æ´»è·ƒç”¨æˆ·äººæ•°</span></span><br><span class=\"line\">R.BITCOUNT active_users</span><br><span class=\"line\"><span class=\"comment\"># è¿”å› 4</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»˜è´¹ç”¨æˆ·äººæ•°</span></span><br><span class=\"line\">R.BITCOUNT paid_users</span><br><span class=\"line\"><span class=\"comment\"># è¿”å› 5</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"3\">\n<li class=\"lvl-5\">è®¡ç®—äº¤é›† / å­é›†</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.VIP ä¸”æœ€è¿‘æ´»è·ƒç”¨æˆ·</span></span><br><span class=\"line\">R.BITOP AND vip_active vip_users active_users</span><br><span class=\"line\">R.BITCOUNT vip_active</span><br><span class=\"line\"><span class=\"comment\"># è¿”å› 3</span></span><br><span class=\"line\"><span class=\"comment\"># è§£é‡Šï¼šç”¨æˆ· 1001, 1003, 1005 åŒæ—¶æ˜¯ VIP ä¸”æœ€è¿‘æ´»è·ƒã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.VIP ä¸”ä»˜è´¹ç”¨æˆ·ä¸”æœ€è¿‘æ´»è·ƒ</span></span><br><span class=\"line\"><span class=\"comment\"># å…ˆè®¡ç®— VIP ä¸ä»˜è´¹äº¤é›†</span></span><br><span class=\"line\">R.BITOP AND vip_paid vip_users paid_users</span><br><span class=\"line\"><span class=\"comment\"># å†è®¡ç®— vip_paid ä¸æ´»è·ƒç”¨æˆ·äº¤é›†</span></span><br><span class=\"line\">R.BITOP AND vip_paid_active vip_paid active_users</span><br><span class=\"line\">R.BITCOUNT vip_paid_active</span><br><span class=\"line\"><span class=\"comment\"># è¿”å› 2</span></span><br><span class=\"line\"><span class=\"comment\"># è§£é‡Šï¼šç”¨æˆ· 1003, 1005 åŒæ—¶æ»¡è¶³ä¸‰æ¡ä»¶ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"4\">\n<li class=\"lvl-5\">è®¡ç®— Jaccard ç›¸ä¼¼åº¦</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¡ç®— ä»˜è´¹ç”¨æˆ· ä¸ æœ€è¿‘æ´»è·ƒç”¨æˆ· çš„ç›¸ä¼¼åº¦</span></span><br><span class=\"line\">R.JACCARD paid_users active_users</span><br><span class=\"line\"><span class=\"comment\"># è¿”å› &quot;0.2857142857142857&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># Jaccard ç›¸ä¼¼åº¦è®¡ç®—å…¬å¼ï¼š</span></span><br><span class=\"line\">   J(A, B) = |A âˆ© B| / |A âˆª B| = äº¤é›† / å¹¶é›†</span><br><span class=\"line\">   0.2857142857142857 = |1003, 1005| / |1001, 1002, 1003, 1005, 1006, 1007, 1008| = 2 / 7 = 0.2857142857142857</span><br></pre></td></tr></table></figure>\n<p class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>J</mi><mo stretchy=\"false\">(</mo><mi>A</mi><mo separator=\"true\">,</mo><mi>B</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi>A</mi><mo>âˆ©</mo><mi>B</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi>A</mi><mo>âˆª</mo><mi>B</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">J(A, B) = \\frac{|A \\cap B|}{|A \\cup B|}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.09618em;\">J</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">A</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.363em;vertical-align:-0.936em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆª</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">âˆ£</span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ©</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord\">âˆ£</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"5\">\n<li class=\"lvl-5\">èŒƒå›´ / ID æŸ¥è¯¢</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.è·å– VIP ç”¨æˆ· ID åˆ—è¡¨</span></span><br><span class=\"line\">R.GETINTARRAY vip_users</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1001  <span class=\"comment\"># 1 æ˜¯ç´¢å¼•ï¼Œ1001 æ˜¯å€¼</span></span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 1002</span><br><span class=\"line\">3) (<span class=\"built_in\">integer</span>) 1003</span><br><span class=\"line\">4) (<span class=\"built_in\">integer</span>) 1004</span><br><span class=\"line\">5) (<span class=\"built_in\">integer</span>) 1005</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.è·å–æœ€è¿‘æ´»è·ƒç”¨æˆ· IDï¼Œç´¢å¼•èŒƒå›´ åœ¨ 1~3 èŒƒå›´ï¼Œæ³¨æ„è¿™é‡Œçš„ç´¢å¼•æ˜¯ R.GETINTARRAY è¿”å›çš„ç´¢å¼•ä¸‹æ ‡ï¼Œä¸æ˜¯å€¼ã€‚</span></span><br><span class=\"line\">R.RANGEINTARRAY active_users 1 3</span><br><span class=\"line\"><span class=\"comment\"># è¿”å› 1003, 1005, 1008</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1003</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 1005</span><br><span class=\"line\">3) (<span class=\"built_in\">integer</span>) 1008</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"6\">\n<li class=\"lvl-5\">ä¼˜åŒ–å­˜å‚¨</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœæ•°æ®é‡éå¸¸å¤§ï¼Œå¯ä»¥ä¼˜åŒ–å†…å­˜</span></span><br><span class=\"line\">R.OPTIMIZE vip_users MEM</span><br><span class=\"line\">R.OPTIMIZE paid_users MEM</span><br><span class=\"line\">R.OPTIMIZE active_users MEM</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisRoaring ä¸­ RoaringBitmap æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisRoaring çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisRoaring çš„å®‰è£…æ–¹æ³• RoaringBitmap å‘½ä»¤ å¯ä»¥åœ¨ redis-cli ä¸­æ‰§è¡Œ help @moduleï¼Œæ‰¾å‡ºæ‰€æœ‰ R.* å’Œ R64.* çš„å‘½ä»¤è¯´æ˜ R.*ï¼šæ“ä½œçš„æ˜¯ 32 ä½æ— ç¬¦å·æ•´æ•°ï¼ˆæœ€å¤§çº¦ 2^32-1ï¼‰ R64.*ï¼šæ“ä½œçš„æ˜¯ 64 ä½æ— ç¬¦å·æ•´æ•°ï¼ˆæœ€å¤§çº¦ 2^64-1ï¼‰ï¼Œé€‚åˆè¶…å¤§ ID ç©ºé—´ï¼Œå¦‚ Snowflake / æ—¶é—´æˆ³æ˜ å°„ R64.* æ”¯æŒçš„æ•´æ•°ç†è®ºä¸Šæ˜¯ 0 ~ 2â¶â´-1ï¼ˆçº¦ 1.84e19ï¼‰ï¼Œä½†å·¥ç¨‹ä¸Šåº”è°¨æ…ä½¿ç”¨è¶…å¤§ offsetï¼Œé¿å…ç¨€ç–çˆ†ç‚¸å’Œæ€§èƒ½é€€åŒ–ã€‚ 12345678910high 32 bits -&gt; container key å¤§æ¡¶low 32 bits -&gt; container offset å°æ¡¶å½“ä½ å†™å…¥ä¸€ä¸ªéå¸¸å¤§çš„å€¼ï¼Œä¾‹å¦‚ 10^18 è™½ç„¶ Roaring åªä¸ºå­˜åœ¨æ•°æ®çš„ container åˆ†é…å†…å­˜ã€‚ ä½† container çš„ key æœ¬èº«æ˜¯ä¸€ä¸ª map / array ç´¢å¼•ç»“æ„ã€‚ æç«¯ç¨€ç–ã€è¶…å¤§ offset ä¼šå¢åŠ ç´¢å¼•ç®¡ç†æˆæœ¬ï¼Œä¼šå¯¼è‡´æŸäº›å‘½ä»¤æ“ä½œä¼šå˜å¾—å¾ˆæ…¢ã€‚ å¦å¤–ï¼Œä¸€ä¸ªå®¹å™¨è‡³å°‘è¦ å‡ åå­—èŠ‚ ~ å‡ ç™¾å­—èŠ‚çº§åˆ«ï¼Œå®¹å™¨çš„æ•°é‡è¿‡å¤šï¼Œå•æœºå†…å­˜ä¹Ÿæ— æ³•æ»¡è¶³ å¦‚æœä½ åˆ›å»º 10 äº¿ä¸ª containerï¼Œå‡è®¾æ¯ä¸ª container å ç”¨ 100 å­—èŠ‚ï¼Œé‚£ä¹ˆå†…å­˜å ç”¨ä¸ºï¼š 10^9 containers Ã— 100 bytes â‰ˆ 100 GB å†…å­˜ ä¸¤è€…è¯­ä¹‰å®Œå…¨ä¸€è‡´ï¼Œä»…æ”¯æŒçš„ offset èŒƒå›´ä¸åŒï¼Œä»¥ä¸‹ç¤ºä¾‹ä»¥ R.* ä¸ºä¸»ã€‚ å¯¹æ¯” R ä¸ R64 ç»´åº¦ R.* R64.* Offset ç±»å‹ uint32 uint64 æœ€å¤§å€¼ 4,294,967,295 (~4.29e9) 18,446,744,073,709,551,615 (~1.84e19) å¯è¡¨è¾¾è§„æ¨¡ åäº¿çº§ ä¸‡äº¿äº¿çº§ å…¸å‹ç”¨é€” ç”¨æˆ·IDã€ç´¢å¼• æ—¶é—´æˆ³ã€é›ªèŠ±IDã€å…¨å±€å”¯ä¸€ID ä¸€ã€æ•°æ®å†™å…¥ / ä¿®æ”¹ç±» å‘½ä»¤ åŠŸèƒ½ å…¸å‹ç”¨é€” ç¤ºä¾‹ R.SETBIT è®¾ç½®å•ä¸ª bitï¼ˆ0/1ï¼‰ï¼Œè¿”å›æ—§å€¼ å•ç‚¹æ ‡è®° R.SETBIT users 1001 1 R.SETRANGE æ‰¹é‡è®¾ç½®åŒºé—´ bit=1 è¿ç»­åŒºé—´æ‰“æ ‡ R.SETRANGE users 3000 3999ï¼Œä¸åŒ…å«3999 R.APPENDINTARRAY è¿½åŠ å¤šä¸ªæ•´æ•°ï¼ˆbit=1ï¼‰ æ‰¹é‡æ’å…¥ ID R.APPENDINTARRAY users 1001 1002 1003 R.SETINTARRAY ç”¨æ•´æ•°æ•°ç»„é‡å»º bitmap åˆå§‹åŒ–æ•°æ® R.SETINTARRAY users 1 3 5 7 R.SETBITARRAY ç”¨ bit å­—ç¬¦ä¸²é‡å»º bitmap å¤–éƒ¨å¯¼å…¥ R.SETBITARRAY users &quot;101001&quot; R.DELETEINTARRAY åˆ é™¤å¤šä¸ªæ•´æ•°ï¼ˆbit=0ï¼‰ æ‰¹é‡åˆ é™¤ R.DELETEINTARRAY users 1002 2000 R.CLEARBITS æ¸…é™¤æŒ‡å®š offset ç²¾ç¡®æ¸…ç† R.CLEARBITS users 1001 1003 R.SETFULL å¡«å……æ•´ä¸ª bitmap å…¨é‡åˆå§‹åŒ– R.SETFULL users R.CLEAR åˆ é™¤æ•´ä¸ª bitmap é‡Šæ”¾èµ„æº R.CLEAR users äºŒã€æ•°æ®è¯»å– / æŸ¥è¯¢ç±» å‘½ä»¤ åŠŸèƒ½ å…¸å‹ç”¨é€” ç¤ºä¾‹ R.GETBIT è·å–å•ä¸ª bit åˆ¤æ–­æ˜¯å¦å­˜åœ¨ R.GETBIT users 1001 R.GETBITS æ‰¹é‡è·å– bit å¤šç‚¹æŸ¥è¯¢ R.GETBITS users 1001 1002 1003 R.GETBITARRAY è¿”å›å®Œæ•´ bit å­—ç¬¦ä¸² è°ƒè¯• / å¯¼å‡º R.GETBITARRAY users R.GETINTARRAY è¿”å›æ‰€æœ‰ä¸º 1 çš„æ•´æ•° å…¨é‡éå† R.GETINTARRAY users R.RANGEINTARRAY è¿”å›åŒºé—´å†…æ•´æ•°ï¼Œæ³¨æ„è¿™é‡Œå‚æ•°æ˜¯ç´¢å¼•ä¸‹æ ‡ï¼Œä¸æ˜¯æ•°å€¼ åˆ†é¡µæ‰«æ R.RANGEINTARRAY users 1 5 R.MIN æœ€å° offset æœ€å° ID æŸ¥è¯¢ R.MIN users R.MAX æœ€å¤§ offset æœ€å¤§ ID æŸ¥è¯¢ R.MAX users ä¸‰ã€ç»Ÿè®¡ç±» å‘½ä»¤ åŠŸèƒ½ å…¸å‹ç”¨é€” ç¤ºä¾‹ R.BITCOUNT bit=1 æ•°é‡ç»Ÿè®¡ é›†åˆåŸºæ•° R.BITCOUNT users R.BITPOS æŸ¥æ‰¾ç¬¬ä¸€ä¸ª 1 æˆ– 0 ç¨€ç–åˆ†æ R.BITPOS users 1 R.MIN æœ€å° bit ä½ç½® è¾¹ç•Œæ£€æµ‹ R.MIN users R.MAX æœ€å¤§ bit ä½ç½® è¾¹ç•Œæ£€æµ‹ R.MAX users R.STAT å®¹å™¨ / å†…å­˜ç»Ÿè®¡ æ€§èƒ½è°ƒä¼˜ R.STAT users TEXT å››ã€é›†åˆè¿ç®—ç±» å‘½ä»¤ åŠŸèƒ½ é›†åˆè¯­ä¹‰ ç¤ºä¾‹ R.BITOP AND ä½å›¾äº¤é›† A âˆ© B R.BITOP AND res a b R.BITOP OR ä½å›¾å¹¶é›† A âˆª B R.BITOP OR res a b R.BITOP XOR å¯¹ç§°å·®é›† A âŠ• B R.BITOP XOR res a b R.DIFF å·®é›† A - B R.DIFF res a b R.CONTAINS åŒ…å«å…³ç³»åˆ¤æ–­ å­é›†æ£€æµ‹ R.CONTAINS a b ALL R.JACCARD ç›¸ä¼¼åº¦è®¡ç®— J(A,B) R.JACCARD a b äº”ã€ç»´æŠ¤ / ä¼˜åŒ–ç±» å‘½ä»¤ åŠŸèƒ½ å…¸å‹ç”¨é€” ç¤ºä¾‹ R.OPTIMIZE å®¹å™¨é‡æ•´ / å‹ç¼© é™ä½å†…å­˜ R.OPTIMIZE users MEM R.CLEAR æ¸…ç† bitmap å›æ”¶èµ„æº R.CLEAR users å…­ã€R / R64 å¯¹ç…§è¡¨ï¼ˆå«ç¤ºä¾‹ï¼‰ åŠŸèƒ½ R (32bit) R64 (64bit) ç¤ºä¾‹ è®¾ç½® bit R.SETBIT R64.SETBIT R64.SETBIT users64 90000000000 1 æ‰¹é‡æ’å…¥ R.APPENDINTARRAY R64.APPENDINTARRAY R64.APPENDINTARRAY users64 90000000001 90000000002 æŸ¥è¯¢ bit R.GETBIT R64.GETBIT R64.GETBIT users64 90000000001 ç»Ÿè®¡ R.BITCOUNT R64.BITCOUNT R64.BITCOUNT users64 é›†åˆè¿ç®— R.BITOP R64.BITOP R64.BITOP OR res64 a64 b64 ä¼˜åŒ– R.OPTIMIZE R64.OPTIMIZE R64.OPTIMIZE users64 MEM çœŸå®æ¡ˆä¾‹ åœºæ™¯è¯´æ˜ 123456789101112å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”µå•†å¹³å°ï¼Œéœ€è¦ç»Ÿè®¡ä»¥ä¸‹æŒ‡æ ‡ï¼š VIP ç”¨æˆ·ï¼ˆè´­ä¹°é‡‘é¢è¶…è¿‡ 1000 çš„ç”¨æˆ·ï¼‰ ä»˜è´¹ç”¨æˆ·ï¼ˆè‡³å°‘è´­ä¹°ä¸€æ¬¡çš„ç”¨æˆ·ï¼‰ æœ€è¿‘æ´»è·ƒç”¨æˆ·ï¼ˆè¿‡å» 7 å¤©å†…ç™»å½•è¿‡çš„ç”¨æˆ·ï¼‰æˆ‘ä»¬æƒ³è¦è®¡ç®—ï¼š VIP ç”¨æˆ·äººæ•° VIP ä¸”æœ€è¿‘æ´»è·ƒçš„ç”¨æˆ·äººæ•° VIP ä¸”ä»˜è´¹ç”¨æˆ·ä¸”æœ€è¿‘æ´»è·ƒçš„äººæ•° ä»˜è´¹ç”¨æˆ·ä¸æœ€è¿‘æ´»è·ƒç”¨æˆ·çš„ Jaccard ç›¸ä¼¼åº¦å‡è®¾ç”¨æˆ· ID ä¸ºæ•´æ•°ï¼ˆæœ€å¤§å€¼ &lt; 2^32ï¼Œä½¿ç”¨ R.* å³å¯ï¼‰ã€‚ å†™å…¥æ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰ 123456789101112# VIP ç”¨æˆ·R.APPENDINTARRAY vip_users 1001 1002 1003 1004 1005# ä»˜è´¹ç”¨æˆ·R.APPENDINTARRAY paid_users 1002 1003 1005 1006 1007# æœ€è¿‘æ´»è·ƒç”¨æˆ·R.APPENDINTARRAY active_users 1001 1003 1005 1008# æŸ¥çœ‹æ•°æ®ç±»å‹127.0.0.1:6379&gt; type active_usersreroaring æŸ¥è¯¢åŸºç¡€ç»Ÿè®¡ 1234567891011# VIP ç”¨æˆ·äººæ•°R.BITCOUNT vip_users# è¿”å› 5# æœ€è¿‘æ´»è·ƒç”¨æˆ·äººæ•°R.BITCOUNT active_users# è¿”å› 4# ä»˜è´¹ç”¨æˆ·äººæ•°R.BITCOUNT paid_users# è¿”å› 5 è®¡ç®—äº¤é›† / å­é›† 123456789101112131415# 1.VIP ä¸”æœ€è¿‘æ´»è·ƒç”¨æˆ·R.BITOP AND vip_active vip_users active_usersR.BITCOUNT vip_active# è¿”å› 3# è§£é‡Šï¼šç”¨æˆ· 1001, 1003, 1005 åŒæ—¶æ˜¯ VIP ä¸”æœ€è¿‘æ´»è·ƒã€‚# 2.VIP ä¸”ä»˜è´¹ç”¨æˆ·ä¸”æœ€è¿‘æ´»è·ƒ# å…ˆè®¡ç®— VIP ä¸ä»˜è´¹äº¤é›†R.BITOP AND vip_paid vip_users paid_users# å†è®¡ç®— vip_paid ä¸æ´»è·ƒç”¨æˆ·äº¤é›†R.BITOP AND vip_paid_active vip_paid active_usersR.BITCOUNT vip_paid_active# è¿”å› 2# è§£é‡Šï¼šç”¨æˆ· 1003, 1005 åŒæ—¶æ»¡è¶³ä¸‰æ¡ä»¶ã€‚ è®¡ç®— Jaccard ç›¸ä¼¼åº¦ 123456# è®¡ç®— ä»˜è´¹ç”¨æˆ· ä¸ æœ€è¿‘æ´»è·ƒç”¨æˆ· çš„ç›¸ä¼¼åº¦R.JACCARD paid_users active_users# è¿”å› &quot;0.2857142857142857&quot;# Jaccard ç›¸ä¼¼åº¦è®¡ç®—å…¬å¼ï¼š J(A, B) = |A âˆ© B| / |A âˆª B| = äº¤é›† / å¹¶é›† 0.2857142857142857 = |1003, 1005| / |1001, 1002, 1003, 1005, 1006, 1007, 1008| = 2 / 7 = 0.2857142857142857 J(A,B)=âˆ£Aâˆ©Bâˆ£âˆ£AâˆªBâˆ£J(A, B) = \\frac{|A \\cap B|}{|A \\cup B|} J(A,B)=âˆ£AâˆªBâˆ£âˆ£Aâˆ©Bâˆ£â€‹ èŒƒå›´ / ID æŸ¥è¯¢ 12345678910111213141516# 1.è·å– VIP ç”¨æˆ· ID åˆ—è¡¨R.GETINTARRAY vip_users# è¾“å‡º1) (integer) 1001 # 1 æ˜¯ç´¢å¼•ï¼Œ1001 æ˜¯å€¼2) (integer) 10023) (integer) 10034) (integer) 10045) (integer) 1005# 2.è·å–æœ€è¿‘æ´»è·ƒç”¨æˆ· IDï¼Œç´¢å¼•èŒƒå›´ åœ¨ 1~3 èŒƒå›´ï¼Œæ³¨æ„è¿™é‡Œçš„ç´¢å¼•æ˜¯ R.GETINTARRAY è¿”å›çš„ç´¢å¼•ä¸‹æ ‡ï¼Œä¸æ˜¯å€¼ã€‚R.RANGEINTARRAY active_users 1 3# è¿”å› 1003, 1005, 10081) (integer) 10032) (integer) 10053) (integer) 1008 ä¼˜åŒ–å­˜å‚¨ 1234# å¦‚æœæ•°æ®é‡éå¸¸å¤§ï¼Œå¯ä»¥ä¼˜åŒ–å†…å­˜R.OPTIMIZE vip_users MEMR.OPTIMIZE paid_users MEMR.OPTIMIZE active_users MEM","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisRoaring ä¸­ RoaringBitmap æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisRoaring çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisRoaring çš„å®‰è£…æ–¹æ³•","date_published":"2026-01-08T14:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2026/01/08/redis7-module-RedisRoaring/","url":"https://blog.hanqunfeng.com/2026/01/08/redis7-module-RedisRoaring/","title":"Redis æ‰©å±•æ¨¡å— -- RedisRoaring çš„å®‰è£…æ–¹æ³•","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisRoaring çš„å®‰è£…æ–¹æ³•</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RedisRoaring-ç®€ä»‹\">RedisRoaring ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/aviggiano/redis-roaring\">RedisRoaring</a>æ˜¯ä¸€ä¸ªå¼€æºçš„ Redis æ¨¡å—ï¼ˆRedis Moduleï¼‰ï¼Œç”± Antonio Guilherme Ferreira Viggiano ç»´æŠ¤ï¼Œç›®çš„æ˜¯å°† Roaring Bitmap æ•°æ®ç»“æ„åŸç”Ÿé›†æˆåˆ° Redis ä¸­ä½œä¸ºæ–°çš„æ•°æ®ç±»å‹ä¸å‘½ä»¤é›†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒåŸºäº CRoaring åº“å®ç°å‹ç¼©ä½å›¾ï¼ˆRoaring Bitmapï¼‰åŠŸèƒ½ï¼Œè¿™æ˜¯ä¸€ç§é«˜æ•ˆã€å‹ç¼©çš„ä½å›¾æ•°æ®ç»“æ„ï¼Œé€‚åˆå¤„ç†å¤§è§„æ¨¡æ•´æ•°é›†åˆã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…¼å®¹ Redis 6.0 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œåœ¨ä¸åŒç‰ˆæœ¬ä¸­å¯¹å‘½ä»¤å…ƒæ•°æ®ã€ACL åˆ†ç±»ç­‰åŠŸèƒ½æœ‰è‡ªåŠ¨é€‚é…æ”¯æŒã€‚</p>\n</li>\n</ul>\n<h2 id=\"åŸç”Ÿçš„redis-bitmapæœ‰å“ªäº›é—®é¢˜\">åŸç”Ÿçš„<code>redis bitmap</code>æœ‰å“ªäº›é—®é¢˜?</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»“è®ºå…ˆè¡Œï¼šRedis åŸç”Ÿ Bitmap çš„æ ¸å¿ƒé—®é¢˜æ˜¯ã€Œç©ºé—´ä¸å¯æ§ + å¤§è§„æ¨¡ä½è¿ç®—æ€§èƒ½éšæœ€å¤§åç§»çº¿æ€§å¢é•¿ã€ï¼Œè€Œ redis-roaring é€šè¿‡ Roaring Bitmap è§£å†³äº†ç¨€ç–æ•°æ®å†…å­˜æµªè´¹å’Œå¤§èŒƒå›´æ‰«ææ•ˆç‡é—®é¢˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Bitmap æ˜¯è¿ç»­æ•°ç»„ï¼Œä¸æ”¯æŒç¨€ç–å‹ç¼©ï¼Œ å…¶å¿…é¡» ä» 0 åˆ°æœ€å¤§ bit offset å…¨éƒ¨è¿ç»­åˆ†é…å†…å­˜ã€‚ä½ åªè¦è®¾ç½®äº† bit=1 çš„æœ€å¤§ä¸‹æ ‡æ˜¯ Nï¼Œé‚£ä¹ˆ Redis è‡³å°‘è¦åˆ†é… N/8 å­—èŠ‚å†…å­˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‡è®¾ä½ è¦å­˜å‚¨ç”¨æˆ·IDé›†åˆï¼Œä½†æ˜¯å­˜å‚¨çš„IDèŒƒå›´è¾ƒå¤§ï¼Œæ¯”å¦‚ 1-2000000000ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´Bitmapçš„bit offsetéå¸¸å¤§ï¼Œå¯¼è‡´Bitmapçš„å­˜å‚¨ç©ºé—´éå¸¸å¤§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦å¤–å¦‚æœæ•°æ®æ¯”è¾ƒç¨€ç–ï¼Œæç«¯æƒ…å†µä¸‹åªå­˜å‚¨äº†2ä¸ªIDï¼ŒID1:1ï¼ŒID2:2000000000ï¼Œé‚£ä¹ˆBitmapå°±è¦æŒ‰ç…§æœ€å¤§çš„ offsetè¿›è¡Œåˆ†é…ç©ºé—´ï¼Œå¯¼è‡´Bitmapçš„å­˜å‚¨ç©ºé—´éå¸¸å¤§ï¼Œä½†æ˜¯ä¸­é—´çš„ç©ºé—´åˆè¢«æµªè´¹äº†ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SETBIT user:bitmap 1 1</span><br><span class=\"line\">SETBIT user:bitmap 2000000000 1</span><br><span class=\"line\"><span class=\"comment\"># 2_000_000_000 bits â‰ˆ 250 MB</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Redis å†…éƒ¨å¿…é¡»æ‰«æï¼š0 ... max_offsetï¼Œå³ä½¿åªæœ‰ 2 ä¸ª bit ä¸º 1ï¼Œä¹Ÿå¿…é¡»æ‰«æ 250MB å†…å­˜ã€‚</span></span><br><span class=\"line\">BITCOUNT user:bitmap</span><br></pre></td></tr></table></figure>\n<h2 id=\"Roaring-Bitmapå®ç°æ€è·¯\">Roaring Bitmapå®ç°æ€è·¯</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†32ä½çš„intç±»å‹æ•°æ®è¿›è¡Œ<code>é«˜16ä½</code>ã€<code>ä½16ä½</code>åˆ’åˆ†ï¼Œé«˜16ä½å°±è¢«åˆ’åˆ†æˆ<code>2^16=65536ä¸ªå¤§æ¡¶ï¼ˆå®¹å™¨ï¼‰</code>ï¼Œä½16ä½æœ€å¤šè¢«åˆ’åˆ†æˆ<code>2^16=65536ä¸ªå°æ¡¶ï¼ˆå…ƒç´ ï¼‰</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>æŠŠè¦ç»Ÿè®¡çš„æ•°å­—æ‹†åˆ†ä½é«˜16ä½å’Œä½16ä½ï¼Œé«˜16ä½ç”¨ä½œå®¹å™¨çš„ç´¢å¼•ã€ç”¨äºå®šä½æ•°å­—åœ¨å“ªä¸ªå®¹å™¨ï¼›ä½16ä½ç”¨ä½œå®¹å™¨å†…å…ƒç´ çš„ç´¢å¼•ã€ç”¨ä½œå®šä½æ•°å­—åœ¨å®¹å™¨å†…çš„ä½ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é«˜16ä½å’Œä½16ä½çš„è®¡ç®—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å…¬å¼ï¼šx = high * 2^16 + low</span><br><span class=\"line\">å¯¹ä¸€ä¸ªæ•´æ•° xï¼š</span><br><span class=\"line\">é«˜ 16 ä½ï¼ˆHighï¼‰ = x / 2^16ï¼ˆæ•´æ•°é™¤æ³•ï¼‰</span><br><span class=\"line\">ä½ 16 ä½ï¼ˆLowï¼‰ = x % 2^16</span><br><span class=\"line\"></span><br><span class=\"line\">é«˜ 16 ä½ç”¨äºå®šä½â€œå®¹å™¨ï¼ˆcontainerï¼‰â€ï¼Œä½ 16 ä½ç”¨äºå®šä½å®¹å™¨å†…éƒ¨çš„ä½ç½®ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å‡è®¾ä¸€ä¸ª 32 ä½æ•´æ•°ï¼šx = 305419896 = 0x12345678 ï¼ˆåå…­è¿›åˆ¶ï¼‰</span><br><span class=\"line\">é«˜ 16 ä½ï¼ˆHighï¼‰ = x / 2^16 = 305419896 / 65536 = 4660</span><br><span class=\"line\">ä½ 16 ä½ï¼ˆLowï¼‰ = x % 2^16  = 305419896 % 65536 = 22136</span><br><span class=\"line\">å±äºï¼šcontainer 4660, offset 22136</span><br><span class=\"line\"></span><br><span class=\"line\">è½¬ä¸ºäºŒè¿›åˆ¶ï¼ˆ32 ä½ï¼‰è¿›è¡ŒéªŒè¯ï¼š</span><br><span class=\"line\">0001 0010 0011 0100 | 0101 0110 0111 1000</span><br><span class=\"line\">   â†‘ é«˜ 16 ä½       |    â†‘ ä½ 16 ä½</span><br><span class=\"line\"></span><br><span class=\"line\">| éƒ¨åˆ†   | äºŒè¿›åˆ¶              | åå…­è¿›åˆ¶   | åè¿›åˆ¶   |</span><br><span class=\"line\">| ---- | ------------------- | ------ | ----- |</span><br><span class=\"line\">| é«˜16ä½ | 0001 0010 0011 0100 | 0x1234 | 4660  |</span><br><span class=\"line\">| ä½16ä½ | 0101 0110 0111 1000 | 0x5678 | 22136 |</span><br><span class=\"line\"></span><br><span class=\"line\">è¾¹ç•Œä¾‹å­ï¼ˆå®¹å™¨åˆ‡æ¢ç‚¹ï¼‰</span><br><span class=\"line\">x = 65535</span><br><span class=\"line\">high = 65535 / 65536 = 0</span><br><span class=\"line\">low  = 65535 % 65536 = 65535</span><br><span class=\"line\">å±äºï¼šcontainer 0, offset 65535 ï¼ˆå®¹å™¨0çš„æœ€åä¸€ä¸ªä½ç½®ï¼‰</span><br><span class=\"line\"></span><br><span class=\"line\">x = 65536</span><br><span class=\"line\">high = 65536 / 65536 = 1</span><br><span class=\"line\">low  = 65536 % 65536 = 0</span><br><span class=\"line\">å±äºï¼šcontainer 1, offset 0 ï¼ˆå®¹å™¨1çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼‰</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å™¨æœ‰ä¸‰ç§ä¸åŒç±»å‹: <code>ArrayContainer</code>ã€<code>BitmapContainer</code>å’Œ<code>RunContainer</code>ï¼Œæ ¹æ®è¦ç»Ÿè®¡çš„æ•°å­—çš„æ•°é‡å’Œæ•°å­—çš„è¿ç»­æ€§è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å®¹å™¨ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ArrayContainer</td>\n<td>ç¨€ç–ï¼ˆå°‘é‡æ•´æ•°ï¼‰ï¼Œå…ƒç´ ä¸ºshortç±»å‹çš„æœ‰åºæ•°ç»„<br>æœ€å¤šå­˜å‚¨ 65536 ä¸ª short å…ƒç´ ï¼Œå ç”¨ 128 KB å†…å­˜</td>\n</tr>\n<tr>\n<td>BitmapContainer</td>\n<td>å¯†é›† ï¼Œä½¿ç”¨bitmapå­˜å‚¨æ•°æ®ï¼Œå›ºå®šå ç”¨ 8kB å†…å­˜</td>\n</tr>\n<tr>\n<td>RunContainer</td>\n<td>è¿ç»­åŒºé—´ï¼Œä½¿ç”¨Run-Length Encodingæ–¹å¼å‹ç¼©å­˜å‚¨çš„å…ƒç´ ï¼Œå¯¹è¿ç»­æ•°æ®çš„å‹ç¼©æ•ˆæœç‰¹åˆ«å¥½ã€‚<br>å®ƒçš„åŸç†æ˜¯ï¼Œå¯¹äºè¿ç»­å‡ºç°çš„æ•°å­—ï¼Œåªè®°å½•åˆå§‹æ•°å­—å’Œåç»­æ•°é‡ã€‚å³ï¼š<br>å¯¹äºæ•°æ®é›†ï¼š5ï¼Œä¼šå‹ç¼©ä¸º5, 0<br>å¯¹äºæ•°æ®é›†ï¼š5, 6, 7, 8, 9, 10ï¼Œä¼šå‹ç¼©ä¸º5, 5<br>å¯¹äºæ•°æ®é›†ï¼š5, 7, 9, 11, 12ï¼Œä¼šå‹ç¼©ä¸º5, 0, 7, 0, 9, 0, 11, 1 <br>æœ€å¥½æƒ…å†µï¼šå…¨éƒ¨æ˜¯è¿ç»­æ•°å­—ï¼Œåªä¼šå­˜å‚¨ 2 ä¸ª short ï¼Œå ç”¨ 4 bytes<br>æœ€åæƒ…å†µï¼š0~65535çš„èŒƒå›´å†…å¡«å……æ‰€æœ‰çš„å¥‡æ•°ä½æˆ–å¶æ•°ä½ï¼Œéœ€è¦ 65536 ä¸ªshortï¼Œå ç”¨ 128 KB</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å®¹å™¨çš„ä½¿ç”¨åŠå®¹å™¨ä¹‹é—´çš„è½¬æ¢\">å®¹å™¨çš„ä½¿ç”¨åŠå®¹å™¨ä¹‹é—´çš„è½¬æ¢</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Roaring çš„ç›®æ ‡æ˜¯ï¼šåœ¨ä¿è¯æ“ä½œæ€§èƒ½çš„å‰æä¸‹ï¼Œä½¿å†…å­˜å ç”¨æœ€å°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å› æ­¤ï¼šæ’å…¥ã€åˆ é™¤ã€åˆå¹¶ã€è¿ç®—åï¼Œä¼šè¯„ä¼°å½“å‰ container çš„â€œæœ€ä¼˜ç±»å‹â€ï¼Œå¿…è¦æ—¶è‡ªåŠ¨è½¬æ¢</p>\n</li>\n<li class=\"lvl-2\">\n<p>âœ… Array â†’ Bitmapï¼Œè§¦å‘æ¡ä»¶ï¼šå®¹å™¨ä¸­å…ƒç´ æ•°é‡ &gt; 4096</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">åŸå› ï¼š</span><br><span class=\"line\">   Array æ¯ä¸ªå…ƒç´ å  2 bytes</span><br><span class=\"line\">   4096 Ã— 2 = 8192 bytes</span><br><span class=\"line\">   Bitmap å›ºå®š 8192 bytes</span><br><span class=\"line\"></span><br><span class=\"line\">è¶…è¿‡è¿™ä¸ªç‚¹ï¼ŒBitmap æ›´çœå†…å­˜ + æŸ¥è¯¢æ›´å¿«ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âœ… Bitmap â†’ Arrayï¼Œè§¦å‘æ¡ä»¶ï¼šå®¹å™¨ä¸­å…ƒç´ æ•°é‡ &lt;= 4096ï¼Œä¸€èˆ¬åœ¨å¤§é‡åˆ é™¤æˆ– AND è¿ç®—åè§¦å‘ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>âœ… RunContainer â†” Array / Bitmapï¼ŒRun æ²¡æœ‰å›ºå®šé˜ˆå€¼ï¼Œè€Œæ˜¯ åŠ¨æ€è¯„ä¼°å†…å­˜æ¨¡å‹ï¼ŒåŸºäºå¦‚ä¸‹ä¸‰ä¸ªæŒ‡æ ‡ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\">run_count : å½“å‰ RunContainer ä¸­æœ‰å¤šå°‘ä¸ªè¿ç»­åŒºé—´</li>\n</ul>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ä¾‹å¦‚é›†åˆï¼š&#123;1,2,3,4,5,  10,11,12,  100&#125;</span><br><span class=\"line\">è¿ç»­åŒºé—´ï¼š[1..5], [10..12], [100..100]</span><br><span class=\"line\">å› æ­¤ï¼šrun_count = 3</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>run_count</th>\n<th>æ•°æ®å½¢æ€</th>\n<th>é€‚åˆ Run å—</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å¾ˆå°ï¼ˆ1~å‡ åï¼‰</td>\n<td>å¤§æ®µè¿ç»­</td>\n<td>æå…¶é€‚åˆ</td>\n</tr>\n<tr>\n<td>ä¸­ç­‰ï¼ˆå‡ ç™¾ï¼‰</td>\n<td>ç¨ç¢</td>\n<td>å¯èƒ½é€‚åˆ</td>\n</tr>\n<tr>\n<td>å¾ˆå¤§ï¼ˆä¸Šåƒï¼‰</td>\n<td>é«˜åº¦ç¢ç‰‡åŒ–</td>\n<td>ä¸é€‚åˆ</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-5\">\n<p>run_total_coverage : run è¦†ç›–çš„æ€»å…ƒç´ æ•°é‡(æœ¬è´¨å°±æ˜¯å…ƒç´ çš„æ•°é‡)</p>\n</li>\n</ul>\n   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[1..5]  â†’ 5 ä¸ª</span><br><span class=\"line\">[10..12] â†’ 3 ä¸ª</span><br><span class=\"line\">[100..100] â†’ 1 ä¸ª</span><br><span class=\"line\"></span><br><span class=\"line\">run_total_coverage = 9</span><br><span class=\"line\"></span><br><span class=\"line\">å®é™…ä¸Šæ›´é‡è¦çš„æŒ‡æ ‡æ˜¯ å¹³å‡ run é•¿åº¦</span><br><span class=\"line\">å¹³å‡ run é•¿åº¦ = run_total_coverage / run_count = 9 / 3 = 3</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>run_count</th>\n<th>coverage</th>\n<th>å¹³å‡é•¿åº¦</th>\n<th>å½¢æ€</th>\n<th>é€‚åˆ Run å—</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>60,000</td>\n<td>60,000</td>\n<td>è¶…é•¿è¿ç»­</td>\n<td>æé€‚åˆ</td>\n</tr>\n<tr>\n<td>10</td>\n<td>50,000</td>\n<td>5,000</td>\n<td>å¤§æ®µè¿ç»­</td>\n<td>é€‚åˆ</td>\n</tr>\n<tr>\n<td>5,000</td>\n<td>50,000</td>\n<td>10</td>\n<td>ç¢ç‰‡è¿ç»­</td>\n<td>éå¸¸ä¸é€‚åˆ</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-5\">\n<p>estimated_memory : ä¼°ç®—å†…å­˜å ç”¨ï¼Œè¿™æ˜¯æ ¸å¿ƒå†³ç­–æŒ‡æ ‡</p>\n</li>\n</ul>\n   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">memory_run: å¦‚æœç”¨ RunContainerï¼Œéœ€è¦å¤šå°‘å†…å­˜ï¼Œ â‰ˆ run_count Ã— RUN_ENTRY_SIZE(4 bytes)</span><br><span class=\"line\">memory_array: å¦‚æœç”¨ ArrayContainerï¼Œéœ€è¦å¤šå°‘å†…å­˜ï¼Œ â‰ˆ å…ƒç´ æ•°é‡ Ã— 2 bytes</span><br><span class=\"line\">memory_bitmap: å¦‚æœç”¨ BitmapContainerï¼Œéœ€è¦å¤šå°‘å†…å­˜ï¼Œå›ºå®šå†…å­˜ = 8192 bytes</span><br><span class=\"line\"></span><br><span class=\"line\">â–¶ é€‰æ‹©é€»è¾‘ï¼ˆç®€åŒ–ï¼‰</span><br><span class=\"line\"><span class=\"keyword\">if</span> memory_run &lt; min(memory_array, memory_bitmap):</span><br><span class=\"line\">   use RunContainer</span><br><span class=\"line\"><span class=\"keyword\">else</span> <span class=\"keyword\">if</span> memory_array &lt; memory_bitmap:</span><br><span class=\"line\">   use ArrayContainer</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">   use BitmapContainer</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>è½¬æ¢æ–¹å‘</th>\n<th>è§¦å‘æ¡ä»¶</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Array â†’ Bitmap</td>\n<td>å…ƒç´ æ•°é‡ &gt; 4096</td>\n</tr>\n<tr>\n<td>Bitmap â†’ Array</td>\n<td>å…ƒç´ æ•°é‡ â‰¤ 4096</td>\n</tr>\n<tr>\n<td>ä»»æ„ â†’ Run</td>\n<td>è¿ç»­åŒºé—´å‹ç¼©æ˜æ˜¾</td>\n</tr>\n<tr>\n<td>Run â†’ Array / Bitmap</td>\n<td>run ç¢ç‰‡åŒ–æˆ–å†…å­˜åŠ£åŒ–</td>\n</tr>\n<tr>\n<td>æ‰¹é‡è¿ç®—</td>\n<td>æ ¹æ®ç»“æœè‡ªåŠ¨é€‰æ‹©</td>\n</tr>\n<tr>\n<td>optimize</td>\n<td>å¼ºåˆ¶é‡æ–°è¯„ä¼°</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âœ… åœ¨ Roaring çš„è‡ªåŠ¨é€‰æ‹©æœºåˆ¶ä¸‹ï¼Œæ­£å¸¸æƒ…å†µä¸‹å•ä¸ª container çš„å†…å­˜å ç”¨ä¼šè¢«æ§åˆ¶åœ¨ â‰ˆ 8KB å·¦å³æˆ–æ›´å°ï¼Œåœ¨â€œç†è®ºæé™å®Œå…¨å¡«æ»¡65535ä¸ª containerâ€æƒ…å†µä¸‹ï¼Œå¤§çº¦å  520 MB å†…å­˜(é™¤äº†æ•°æ®æœ¬èº«è¿˜æœ‰ä¸€äº›å…ƒæ•°æ®)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é¡¹ç›®</th>\n<th>ä¼°ç®—</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Bitmap æ•°æ®</td>\n<td>~512 MB</td>\n</tr>\n<tr>\n<td>Container å…ƒæ•°æ®</td>\n<td>~4 MB</td>\n</tr>\n<tr>\n<td>ç´¢å¼•ç»“æ„</td>\n<td>~1 MB</td>\n</tr>\n<tr>\n<td>Redis Key è‡ªèº«</td>\n<td>~0.1 MB</td>\n</tr>\n<tr>\n<td><strong>åˆè®¡</strong></td>\n<td><strong>çº¦ 517 MB</strong></td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/Vw540M.png\" alt=\"\" width=\"1000\" height=\"500\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›´è§‚å¯¹æ¯”è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>Redis Bitmap</th>\n<th>redis-roaring</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å­˜å‚¨ç»“æ„</td>\n<td>è¿ç»­ bit array</td>\n<td>å‹ç¼© bitmapï¼ˆåˆ†å—ï¼‰</td>\n</tr>\n<tr>\n<td>ç¨€ç–æ•°æ®å†…å­˜</td>\n<td>æå·®</td>\n<td>æä¼˜</td>\n</tr>\n<tr>\n<td>æœ€å¤§ offset</td>\n<td>è¶Šå¤§å†…å­˜è¶Šçˆ†</td>\n<td>å‡ ä¹æ— å½±å“</td>\n</tr>\n<tr>\n<td>BITCOUNT / BITOP</td>\n<td>æ‰«ææ•´ä¸ª bitmap</td>\n<td>åªæ‰«ææœ‰æ•ˆ container</td>\n</tr>\n<tr>\n<td>æ‰©å®¹æˆæœ¬</td>\n<td>å¯èƒ½å¤§è§„æ¨¡ realloc</td>\n<td>å±€éƒ¨ container æ‰©å±•</td>\n</tr>\n<tr>\n<td>å• bit è¯»å†™</td>\n<td>æå¿«</td>\n<td>ç•¥æ…¢ï¼ˆç»“æ„å±‚ï¼‰</td>\n</tr>\n<tr>\n<td>æ¨¡å—ä¾èµ–</td>\n<td>åŸç”Ÿ</td>\n<td>Redis Module</td>\n</tr>\n<tr>\n<td>è¿ç»´å¤æ‚åº¦</td>\n<td>æœ€ä½</td>\n<td>ç¨é«˜</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RedisRoaringæ ¸å¿ƒä»·å€¼ä¸ä¼˜åŠ¿\">RedisRoaringæ ¸å¿ƒä»·å€¼ä¸ä¼˜åŠ¿</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol>\n<li class=\"lvl-5\">å†…å­˜æ•ˆç‡æ›´é«˜</li>\n</ol>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\">Roaring Bitmap ä¼šæ ¹æ®æ•°æ®ç¨€ç–/å¯†é›†è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜è¡¨ç¤ºæ–¹å¼ï¼ˆæ•°ç»„ã€ä½å›¾æˆ–è¿è¡Œé•¿åº¦ç¼–ç ï¼‰ï¼Œæ˜¾è‘—å‡å°‘å†…å­˜å ç”¨ï¼Œç›¸æ¯”ä¼ ç»Ÿ Redis Bitmap åœ¨ç¨€ç–æ•°æ®ä¸Šèƒ½èŠ‚çœå¤§é‡ç©ºé—´ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<ol start=\"2\">\n<li class=\"lvl-5\">é«˜æ€§èƒ½ä½æ“ä½œ</li>\n</ol>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\">å¯¹å•ä¸ªä½çš„æ“ä½œä¿æŒ O(1) æ€§èƒ½ï¼Œä¸ Redis åŸç”Ÿä½å›¾æ“ä½œä¸€è‡´ã€‚</li>\n<li class=\"lvl-5\">å¯¹äºå¤§è§„æ¨¡æ“ä½œï¼ˆä¾‹å¦‚ BITOP AND/OR/XORï¼‰æ€§èƒ½æ˜¾è‘—ä¼˜äºåŸç”Ÿä½å›¾ï¼ŒæŸäº›æ“ä½œå¯è¾¾åˆ° 8 å€æ€§èƒ½æå‡ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<ol start=\"3\">\n<li class=\"lvl-5\">ç»“æ„ä¸°å¯Œçš„å‘½ä»¤é›†</li>\n</ol>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\">é™¤äº†ä¼ ç»Ÿä½å›¾å‘½ä»¤ä¹‹å¤–ï¼Œredis-roaring æä¾›æ›´ä¸°å¯Œçš„æ•°æ®æ“ä½œå‘½ä»¤ï¼Œæ”¯æŒæ‰¹é‡å’Œåˆ†æå‹ç”¨ä¾‹ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"å®‰è£…-RedisRoaring\">å®‰è£… RedisRoaring</h2>\n<blockquote>\n<p>å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚<br>\nå¯ä»¥åœ¨æµ·å¤–çš„<code>ç›¸åŒé…ç½®</code>çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„<code>redistimeseries.so</code>ä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /usr/local/soft/modules/</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/soft/modules</span><br><span class=\"line\"><span class=\"comment\"># clone ä»£ç </span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/aviggiano/redis-roaring.git</span><br><span class=\"line\"><span class=\"built_in\">cd</span> redis-roaring/</span><br><span class=\"line\"><span class=\"comment\"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class=\"line\">git checkout v1.7.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘æ„å»ºï¼Œä½œè€…å°†ä¸‹è½½å­æ¨¡å—ã€ç¼–è¯‘å®‰è£…ç­‰å‘½ä»¤éƒ½å°è£…åˆ°ä¸€ä¸ªè„šæœ¬ä¸­ï¼Œè¿™é‡Œç›´æ¥æ‰§è¡Œè„šæœ¬å³å¯</span></span><br><span class=\"line\">./configure.sh</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œè¾“å‡º: dist/libredis-roaring.so</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š<code>redis-roaring</code>åœ¨æ„å»ºåä¼šåœ¨<code>dist</code>ç›®å½•ä¸‹ç”Ÿæˆå¥½ Redis ç›¸å…³å‘½ä»¤å’Œé…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…Redisåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚<code>v1.7.1</code>ç‰ˆæœ¬æä¾›çš„Redisçš„ç‰ˆæœ¬ä¸º<code>8.2.1</code>ï¼Œä½†æ­¤æ—¶æ˜¯ä¸å¸¦ Stack ç›¸å…³æ¨¡å—çš„ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Redis-å¯ç”¨æ¨¡å—\">Redis å¯ç”¨æ¨¡å—</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†ç”Ÿæˆçš„ <code>libredis-roaring.so</code> æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> dist/libredis-roaring.so /usr/local/soft/redis-7.4.7/modules/libredis-roaring.so</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡é‡‡ç”¨ <code>loadmodule</code> åŠ è½½æ¨¡å—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°† libredis-roaring.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class=\"line\">loadmodule /usr/local/soft/redis-7.4.7/modules/libredis-roaring.so</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨redis</span></span><br><span class=\"line\">redis-server redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•æµ‹è¯•</span></span><br><span class=\"line\">redis-cli --user admin --pass 123456</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ¨¡å—</span></span><br><span class=\"line\">127.0.0.1:6379&gt; MODULE LIST</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;ReJSON&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 20816</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;timeseries&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 11209</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/redistimeseries.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;search&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 21025</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/redisearch.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">4) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;bf&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 20817</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">5) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;REDIS-ROARING&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 10700</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/libredis-roaring.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisRoaring çš„å®‰è£…æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisRoaring ç®€ä»‹ RedisRoaringæ˜¯ä¸€ä¸ªå¼€æºçš„ Redis æ¨¡å—ï¼ˆRedis Moduleï¼‰ï¼Œç”± Antonio Guilherme Ferreira Viggiano ç»´æŠ¤ï¼Œç›®çš„æ˜¯å°† Roaring Bitmap æ•°æ®ç»“æ„åŸç”Ÿé›†æˆåˆ° Redis ä¸­ä½œä¸ºæ–°çš„æ•°æ®ç±»å‹ä¸å‘½ä»¤é›†ã€‚ å®ƒåŸºäº CRoaring åº“å®ç°å‹ç¼©ä½å›¾ï¼ˆRoaring Bitmapï¼‰åŠŸèƒ½ï¼Œè¿™æ˜¯ä¸€ç§é«˜æ•ˆã€å‹ç¼©çš„ä½å›¾æ•°æ®ç»“æ„ï¼Œé€‚åˆå¤„ç†å¤§è§„æ¨¡æ•´æ•°é›†åˆã€‚ å…¼å®¹ Redis 6.0 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œåœ¨ä¸åŒç‰ˆæœ¬ä¸­å¯¹å‘½ä»¤å…ƒæ•°æ®ã€ACL åˆ†ç±»ç­‰åŠŸèƒ½æœ‰è‡ªåŠ¨é€‚é…æ”¯æŒã€‚ åŸç”Ÿçš„redis bitmapæœ‰å“ªäº›é—®é¢˜? ç»“è®ºå…ˆè¡Œï¼šRedis åŸç”Ÿ Bitmap çš„æ ¸å¿ƒé—®é¢˜æ˜¯ã€Œç©ºé—´ä¸å¯æ§ + å¤§è§„æ¨¡ä½è¿ç®—æ€§èƒ½éšæœ€å¤§åç§»çº¿æ€§å¢é•¿ã€ï¼Œè€Œ redis-roaring é€šè¿‡ Roaring Bitmap è§£å†³äº†ç¨€ç–æ•°æ®å†…å­˜æµªè´¹å’Œå¤§èŒƒå›´æ‰«ææ•ˆç‡é—®é¢˜ã€‚ Bitmap æ˜¯è¿ç»­æ•°ç»„ï¼Œä¸æ”¯æŒç¨€ç–å‹ç¼©ï¼Œ å…¶å¿…é¡» ä» 0 åˆ°æœ€å¤§ bit offset å…¨éƒ¨è¿ç»­åˆ†é…å†…å­˜ã€‚ä½ åªè¦è®¾ç½®äº† bit=1 çš„æœ€å¤§ä¸‹æ ‡æ˜¯ Nï¼Œé‚£ä¹ˆ Redis è‡³å°‘è¦åˆ†é… N/8 å­—èŠ‚å†…å­˜ã€‚ å‡è®¾ä½ è¦å­˜å‚¨ç”¨æˆ·IDé›†åˆï¼Œä½†æ˜¯å­˜å‚¨çš„IDèŒƒå›´è¾ƒå¤§ï¼Œæ¯”å¦‚ 1-2000000000ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´Bitmapçš„bit offsetéå¸¸å¤§ï¼Œå¯¼è‡´Bitmapçš„å­˜å‚¨ç©ºé—´éå¸¸å¤§ã€‚ å¦å¤–å¦‚æœæ•°æ®æ¯”è¾ƒç¨€ç–ï¼Œæç«¯æƒ…å†µä¸‹åªå­˜å‚¨äº†2ä¸ªIDï¼ŒID1:1ï¼ŒID2:2000000000ï¼Œé‚£ä¹ˆBitmapå°±è¦æŒ‰ç…§æœ€å¤§çš„ offsetè¿›è¡Œåˆ†é…ç©ºé—´ï¼Œå¯¼è‡´Bitmapçš„å­˜å‚¨ç©ºé—´éå¸¸å¤§ï¼Œä½†æ˜¯ä¸­é—´çš„ç©ºé—´åˆè¢«æµªè´¹äº†ã€‚ 123456SETBIT user:bitmap 1 1SETBIT user:bitmap 2000000000 1# 2_000_000_000 bits â‰ˆ 250 MB# Redis å†…éƒ¨å¿…é¡»æ‰«æï¼š0 ... max_offsetï¼Œå³ä½¿åªæœ‰ 2 ä¸ª bit ä¸º 1ï¼Œä¹Ÿå¿…é¡»æ‰«æ 250MB å†…å­˜ã€‚BITCOUNT user:bitmap Roaring Bitmapå®ç°æ€è·¯ å°†32ä½çš„intç±»å‹æ•°æ®è¿›è¡Œé«˜16ä½ã€ä½16ä½åˆ’åˆ†ï¼Œé«˜16ä½å°±è¢«åˆ’åˆ†æˆ2^16=65536ä¸ªå¤§æ¡¶ï¼ˆå®¹å™¨ï¼‰ï¼Œä½16ä½æœ€å¤šè¢«åˆ’åˆ†æˆ2^16=65536ä¸ªå°æ¡¶ï¼ˆå…ƒç´ ï¼‰ æŠŠè¦ç»Ÿè®¡çš„æ•°å­—æ‹†åˆ†ä½é«˜16ä½å’Œä½16ä½ï¼Œé«˜16ä½ç”¨ä½œå®¹å™¨çš„ç´¢å¼•ã€ç”¨äºå®šä½æ•°å­—åœ¨å“ªä¸ªå®¹å™¨ï¼›ä½16ä½ç”¨ä½œå®¹å™¨å†…å…ƒç´ çš„ç´¢å¼•ã€ç”¨ä½œå®šä½æ•°å­—åœ¨å®¹å™¨å†…çš„ä½ç½®ã€‚ é«˜16ä½å’Œä½16ä½çš„è®¡ç®— 12345678910111213141516171819202122232425262728293031å…¬å¼ï¼šx = high * 2^16 + lowå¯¹ä¸€ä¸ªæ•´æ•° xï¼šé«˜ 16 ä½ï¼ˆHighï¼‰ = x / 2^16ï¼ˆæ•´æ•°é™¤æ³•ï¼‰ä½ 16 ä½ï¼ˆLowï¼‰ = x % 2^16é«˜ 16 ä½ç”¨äºå®šä½â€œå®¹å™¨ï¼ˆcontainerï¼‰â€ï¼Œä½ 16 ä½ç”¨äºå®šä½å®¹å™¨å†…éƒ¨çš„ä½ç½®ã€‚å‡è®¾ä¸€ä¸ª 32 ä½æ•´æ•°ï¼šx = 305419896 = 0x12345678 ï¼ˆåå…­è¿›åˆ¶ï¼‰é«˜ 16 ä½ï¼ˆHighï¼‰ = x / 2^16 = 305419896 / 65536 = 4660ä½ 16 ä½ï¼ˆLowï¼‰ = x % 2^16 = 305419896 % 65536 = 22136å±äºï¼šcontainer 4660, offset 22136è½¬ä¸ºäºŒè¿›åˆ¶ï¼ˆ32 ä½ï¼‰è¿›è¡ŒéªŒè¯ï¼š0001 0010 0011 0100 | 0101 0110 0111 1000 â†‘ é«˜ 16 ä½ | â†‘ ä½ 16 ä½| éƒ¨åˆ† | äºŒè¿›åˆ¶ | åå…­è¿›åˆ¶ | åè¿›åˆ¶ || ---- | ------------------- | ------ | ----- || é«˜16ä½ | 0001 0010 0011 0100 | 0x1234 | 4660 || ä½16ä½ | 0101 0110 0111 1000 | 0x5678 | 22136 |è¾¹ç•Œä¾‹å­ï¼ˆå®¹å™¨åˆ‡æ¢ç‚¹ï¼‰x = 65535high = 65535 / 65536 = 0low = 65535 % 65536 = 65535å±äºï¼šcontainer 0, offset 65535 ï¼ˆå®¹å™¨0çš„æœ€åä¸€ä¸ªä½ç½®ï¼‰x = 65536high = 65536 / 65536 = 1low = 65536 % 65536 = 0å±äºï¼šcontainer 1, offset 0 ï¼ˆå®¹å™¨1çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼‰ å®¹å™¨æœ‰ä¸‰ç§ä¸åŒç±»å‹: ArrayContainerã€BitmapContainerå’ŒRunContainerï¼Œæ ¹æ®è¦ç»Ÿè®¡çš„æ•°å­—çš„æ•°é‡å’Œæ•°å­—çš„è¿ç»­æ€§è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å®¹å™¨ã€‚ ç±»å‹ è¯´æ˜ ArrayContainer ç¨€ç–ï¼ˆå°‘é‡æ•´æ•°ï¼‰ï¼Œå…ƒç´ ä¸ºshortç±»å‹çš„æœ‰åºæ•°ç»„æœ€å¤šå­˜å‚¨ 65536 ä¸ª short å…ƒç´ ï¼Œå ç”¨ 128 KB å†…å­˜ BitmapContainer å¯†é›† ï¼Œä½¿ç”¨bitmapå­˜å‚¨æ•°æ®ï¼Œå›ºå®šå ç”¨ 8kB å†…å­˜ RunContainer è¿ç»­åŒºé—´ï¼Œä½¿ç”¨Run-Length Encodingæ–¹å¼å‹ç¼©å­˜å‚¨çš„å…ƒç´ ï¼Œå¯¹è¿ç»­æ•°æ®çš„å‹ç¼©æ•ˆæœç‰¹åˆ«å¥½ã€‚å®ƒçš„åŸç†æ˜¯ï¼Œå¯¹äºè¿ç»­å‡ºç°çš„æ•°å­—ï¼Œåªè®°å½•åˆå§‹æ•°å­—å’Œåç»­æ•°é‡ã€‚å³ï¼šå¯¹äºæ•°æ®é›†ï¼š5ï¼Œä¼šå‹ç¼©ä¸º5, 0å¯¹äºæ•°æ®é›†ï¼š5, 6, 7, 8, 9, 10ï¼Œä¼šå‹ç¼©ä¸º5, 5å¯¹äºæ•°æ®é›†ï¼š5, 7, 9, 11, 12ï¼Œä¼šå‹ç¼©ä¸º5, 0, 7, 0, 9, 0, 11, 1 æœ€å¥½æƒ…å†µï¼šå…¨éƒ¨æ˜¯è¿ç»­æ•°å­—ï¼Œåªä¼šå­˜å‚¨ 2 ä¸ª short ï¼Œå ç”¨ 4 bytesæœ€åæƒ…å†µï¼š0~65535çš„èŒƒå›´å†…å¡«å……æ‰€æœ‰çš„å¥‡æ•°ä½æˆ–å¶æ•°ä½ï¼Œéœ€è¦ 65536 ä¸ªshortï¼Œå ç”¨ 128 KB å®¹å™¨çš„ä½¿ç”¨åŠå®¹å™¨ä¹‹é—´çš„è½¬æ¢ Roaring çš„ç›®æ ‡æ˜¯ï¼šåœ¨ä¿è¯æ“ä½œæ€§èƒ½çš„å‰æä¸‹ï¼Œä½¿å†…å­˜å ç”¨æœ€å°ã€‚ å› æ­¤ï¼šæ’å…¥ã€åˆ é™¤ã€åˆå¹¶ã€è¿ç®—åï¼Œä¼šè¯„ä¼°å½“å‰ container çš„â€œæœ€ä¼˜ç±»å‹â€ï¼Œå¿…è¦æ—¶è‡ªåŠ¨è½¬æ¢ âœ… Array â†’ Bitmapï¼Œè§¦å‘æ¡ä»¶ï¼šå®¹å™¨ä¸­å…ƒç´ æ•°é‡ &gt; 4096 123456åŸå› ï¼š Array æ¯ä¸ªå…ƒç´ å  2 bytes 4096 Ã— 2 = 8192 bytes Bitmap å›ºå®š 8192 bytesè¶…è¿‡è¿™ä¸ªç‚¹ï¼ŒBitmap æ›´çœå†…å­˜ + æŸ¥è¯¢æ›´å¿«ã€‚ âœ… Bitmap â†’ Arrayï¼Œè§¦å‘æ¡ä»¶ï¼šå®¹å™¨ä¸­å…ƒç´ æ•°é‡ &lt;= 4096ï¼Œä¸€èˆ¬åœ¨å¤§é‡åˆ é™¤æˆ– AND è¿ç®—åè§¦å‘ã€‚ âœ… RunContainer â†” Array / Bitmapï¼ŒRun æ²¡æœ‰å›ºå®šé˜ˆå€¼ï¼Œè€Œæ˜¯ åŠ¨æ€è¯„ä¼°å†…å­˜æ¨¡å‹ï¼ŒåŸºäºå¦‚ä¸‹ä¸‰ä¸ªæŒ‡æ ‡ï¼š run_count : å½“å‰ RunContainer ä¸­æœ‰å¤šå°‘ä¸ªè¿ç»­åŒºé—´ 123ä¾‹å¦‚é›†åˆï¼š&#123;1,2,3,4,5, 10,11,12, 100&#125;è¿ç»­åŒºé—´ï¼š[1..5], [10..12], [100..100]å› æ­¤ï¼šrun_count = 3 run_count æ•°æ®å½¢æ€ é€‚åˆ Run å— å¾ˆå°ï¼ˆ1~å‡ åï¼‰ å¤§æ®µè¿ç»­ æå…¶é€‚åˆ ä¸­ç­‰ï¼ˆå‡ ç™¾ï¼‰ ç¨ç¢ å¯èƒ½é€‚åˆ å¾ˆå¤§ï¼ˆä¸Šåƒï¼‰ é«˜åº¦ç¢ç‰‡åŒ– ä¸é€‚åˆ run_total_coverage : run è¦†ç›–çš„æ€»å…ƒç´ æ•°é‡(æœ¬è´¨å°±æ˜¯å…ƒç´ çš„æ•°é‡) 12345678[1..5] â†’ 5 ä¸ª[10..12] â†’ 3 ä¸ª[100..100] â†’ 1 ä¸ªrun_total_coverage = 9å®é™…ä¸Šæ›´é‡è¦çš„æŒ‡æ ‡æ˜¯ å¹³å‡ run é•¿åº¦å¹³å‡ run é•¿åº¦ = run_total_coverage / run_count = 9 / 3 = 3 run_count coverage å¹³å‡é•¿åº¦ å½¢æ€ é€‚åˆ Run å— 1 60,000 60,000 è¶…é•¿è¿ç»­ æé€‚åˆ 10 50,000 5,000 å¤§æ®µè¿ç»­ é€‚åˆ 5,000 50,000 10 ç¢ç‰‡è¿ç»­ éå¸¸ä¸é€‚åˆ estimated_memory : ä¼°ç®—å†…å­˜å ç”¨ï¼Œè¿™æ˜¯æ ¸å¿ƒå†³ç­–æŒ‡æ ‡ 1234567891011memory_run: å¦‚æœç”¨ RunContainerï¼Œéœ€è¦å¤šå°‘å†…å­˜ï¼Œ â‰ˆ run_count Ã— RUN_ENTRY_SIZE(4 bytes)memory_array: å¦‚æœç”¨ ArrayContainerï¼Œéœ€è¦å¤šå°‘å†…å­˜ï¼Œ â‰ˆ å…ƒç´ æ•°é‡ Ã— 2 bytesmemory_bitmap: å¦‚æœç”¨ BitmapContainerï¼Œéœ€è¦å¤šå°‘å†…å­˜ï¼Œå›ºå®šå†…å­˜ = 8192 bytesâ–¶ é€‰æ‹©é€»è¾‘ï¼ˆç®€åŒ–ï¼‰if memory_run &lt; min(memory_array, memory_bitmap): use RunContainerelse if memory_array &lt; memory_bitmap: use ArrayContainerelse: use BitmapContainer è½¬æ¢æ–¹å‘ è§¦å‘æ¡ä»¶ Array â†’ Bitmap å…ƒç´ æ•°é‡ &gt; 4096 Bitmap â†’ Array å…ƒç´ æ•°é‡ â‰¤ 4096 ä»»æ„ â†’ Run è¿ç»­åŒºé—´å‹ç¼©æ˜æ˜¾ Run â†’ Array / Bitmap run ç¢ç‰‡åŒ–æˆ–å†…å­˜åŠ£åŒ– æ‰¹é‡è¿ç®— æ ¹æ®ç»“æœè‡ªåŠ¨é€‰æ‹© optimize å¼ºåˆ¶é‡æ–°è¯„ä¼° âœ… åœ¨ Roaring çš„è‡ªåŠ¨é€‰æ‹©æœºåˆ¶ä¸‹ï¼Œæ­£å¸¸æƒ…å†µä¸‹å•ä¸ª container çš„å†…å­˜å ç”¨ä¼šè¢«æ§åˆ¶åœ¨ â‰ˆ 8KB å·¦å³æˆ–æ›´å°ï¼Œåœ¨â€œç†è®ºæé™å®Œå…¨å¡«æ»¡65535ä¸ª containerâ€æƒ…å†µä¸‹ï¼Œå¤§çº¦å  520 MB å†…å­˜(é™¤äº†æ•°æ®æœ¬èº«è¿˜æœ‰ä¸€äº›å…ƒæ•°æ®) é¡¹ç›® ä¼°ç®— Bitmap æ•°æ® ~512 MB Container å…ƒæ•°æ® ~4 MB ç´¢å¼•ç»“æ„ ~1 MB Redis Key è‡ªèº« ~0.1 MB åˆè®¡ çº¦ 517 MB ç›´è§‚å¯¹æ¯”è¡¨ ç»´åº¦ Redis Bitmap redis-roaring å­˜å‚¨ç»“æ„ è¿ç»­ bit array å‹ç¼© bitmapï¼ˆåˆ†å—ï¼‰ ç¨€ç–æ•°æ®å†…å­˜ æå·® æä¼˜ æœ€å¤§ offset è¶Šå¤§å†…å­˜è¶Šçˆ† å‡ ä¹æ— å½±å“ BITCOUNT / BITOP æ‰«ææ•´ä¸ª bitmap åªæ‰«ææœ‰æ•ˆ container æ‰©å®¹æˆæœ¬ å¯èƒ½å¤§è§„æ¨¡ realloc å±€éƒ¨ container æ‰©å±• å• bit è¯»å†™ æå¿« ç•¥æ…¢ï¼ˆç»“æ„å±‚ï¼‰ æ¨¡å—ä¾èµ– åŸç”Ÿ Redis Module è¿ç»´å¤æ‚åº¦ æœ€ä½ ç¨é«˜ RedisRoaringæ ¸å¿ƒä»·å€¼ä¸ä¼˜åŠ¿ å†…å­˜æ•ˆç‡æ›´é«˜ Roaring Bitmap ä¼šæ ¹æ®æ•°æ®ç¨€ç–/å¯†é›†è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜è¡¨ç¤ºæ–¹å¼ï¼ˆæ•°ç»„ã€ä½å›¾æˆ–è¿è¡Œé•¿åº¦ç¼–ç ï¼‰ï¼Œæ˜¾è‘—å‡å°‘å†…å­˜å ç”¨ï¼Œç›¸æ¯”ä¼ ç»Ÿ Redis Bitmap åœ¨ç¨€ç–æ•°æ®ä¸Šèƒ½èŠ‚çœå¤§é‡ç©ºé—´ã€‚ é«˜æ€§èƒ½ä½æ“ä½œ å¯¹å•ä¸ªä½çš„æ“ä½œä¿æŒ O(1) æ€§èƒ½ï¼Œä¸ Redis åŸç”Ÿä½å›¾æ“ä½œä¸€è‡´ã€‚ å¯¹äºå¤§è§„æ¨¡æ“ä½œï¼ˆä¾‹å¦‚ BITOP AND/OR/XORï¼‰æ€§èƒ½æ˜¾è‘—ä¼˜äºåŸç”Ÿä½å›¾ï¼ŒæŸäº›æ“ä½œå¯è¾¾åˆ° 8 å€æ€§èƒ½æå‡ã€‚ ç»“æ„ä¸°å¯Œçš„å‘½ä»¤é›† é™¤äº†ä¼ ç»Ÿä½å›¾å‘½ä»¤ä¹‹å¤–ï¼Œredis-roaring æä¾›æ›´ä¸°å¯Œçš„æ•°æ®æ“ä½œå‘½ä»¤ï¼Œæ”¯æŒæ‰¹é‡å’Œåˆ†æå‹ç”¨ä¾‹ã€‚ å®‰è£… RedisRoaring å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚ å¯ä»¥åœ¨æµ·å¤–çš„ç›¸åŒé…ç½®çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„redistimeseries.soä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚ 1234567891011mkdir -p /usr/local/soft/modules/cd /usr/local/soft/modules# clone ä»£ç git clone https://github.com/aviggiano/redis-roaring.gitcd redis-roaring/# æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬git checkout v1.7.1# ç¼–è¯‘æ„å»ºï¼Œä½œè€…å°†ä¸‹è½½å­æ¨¡å—ã€ç¼–è¯‘å®‰è£…ç­‰å‘½ä»¤éƒ½å°è£…åˆ°ä¸€ä¸ªè„šæœ¬ä¸­ï¼Œè¿™é‡Œç›´æ¥æ‰§è¡Œè„šæœ¬å³å¯./configure.sh# å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œè¾“å‡º: dist/libredis-roaring.so å®é™…ä¸Šredis-roaringåœ¨æ„å»ºåä¼šåœ¨distç›®å½•ä¸‹ç”Ÿæˆå¥½ Redis ç›¸å…³å‘½ä»¤å’Œé…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…Redisåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚v1.7.1ç‰ˆæœ¬æä¾›çš„Redisçš„ç‰ˆæœ¬ä¸º8.2.1ï¼Œä½†æ­¤æ—¶æ˜¯ä¸å¸¦ Stack ç›¸å…³æ¨¡å—çš„ã€‚ Redis å¯ç”¨æ¨¡å— å°†ç”Ÿæˆçš„ libredis-roaring.so æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º 12# æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™cp dist/libredis-roaring.so /usr/local/soft/redis-7.4.7/modules/libredis-roaring.so æœ¬æ–‡é‡‡ç”¨ loadmodule åŠ è½½æ¨¡å— 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051# å°† libredis-roaring.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redisloadmodule /usr/local/soft/redis-7.4.7/modules/libredis-roaring.so# å¯åŠ¨redisredis-server redis.conf# ç™»å½•æµ‹è¯•redis-cli --user admin --pass 123456# æŸ¥çœ‹æ¨¡å—127.0.0.1:6379&gt; MODULE LIST# è¾“å‡º1) 1) &quot;name&quot; 2) &quot;ReJSON&quot; 3) &quot;ver&quot; 4) (integer) 20816 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot; 7) &quot;args&quot; 8) (empty array)2) 1) &quot;name&quot; 2) &quot;timeseries&quot; 3) &quot;ver&quot; 4) (integer) 11209 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/redistimeseries.so&quot; 7) &quot;args&quot; 8) (empty array)3) 1) &quot;name&quot; 2) &quot;search&quot; 3) &quot;ver&quot; 4) (integer) 21025 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/redisearch.so&quot; 7) &quot;args&quot; 8) (empty array)4) 1) &quot;name&quot; 2) &quot;bf&quot; 3) &quot;ver&quot; 4) (integer) 20817 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot; 7) &quot;args&quot; 8) (empty array)5) 1) &quot;name&quot; 2) &quot;REDIS-ROARING&quot; 3) &quot;ver&quot; 4) (integer) 10700 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/libredis-roaring.so&quot; 7) &quot;args&quot; 8) (empty array)","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisRoaring çš„å®‰è£…æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/","date_published":"2026-01-08T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2026/01/07/redis7-datatype-18-TimeSeries/","url":"https://blog.hanqunfeng.com/2026/01/07/redis7-datatype-18-TimeSeries/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TimeSeries","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisTimeSeries ä¸­ TimeSeries æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\">RedisTimeSeries çš„å®‰è£…å‚è§ <a href=\"/2026/01/07/redis7-module-RedisTimeSeries/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"TimeSeries-ç®€ä»‹\">TimeSeries ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>TimeSeries æ˜¯ Redis çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œç”¨äºå¤„ç†æ—¶é—´åºåˆ—æ•°æ®ï¼Œ<a href=\"https://redis.io/modules/redis-timeseries/?utm_source=chatgpt.com\">RedisTimeSeries | A NoSQL Time Series Database</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æ ¸å¿ƒè®¾è®¡ä¸æ•°æ®æ¨¡å‹</p>\n</li>\n</ul>\n<blockquote>\n<p>ä¸€ä¸ª Redis æ—¶é—´åºåˆ—ï¼ˆTime Seriesï¼‰ æ˜¯æœ‰åºçš„ä¸€ç³»åˆ—é‡‡æ ·æ•°æ®ç‚¹ï¼š</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>ç»„æˆéƒ¨åˆ†</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ—¶é—´æˆ³ï¼ˆtimestampï¼‰</strong></td>\n<td>æ¯«ç§’çº§æ—¶é—´æ ‡ç­¾ï¼Œå¯å®¢æˆ·ç«¯æŒ‡å®šæˆ–ç”±æœåŠ¡å™¨å¡«å……</td>\n</tr>\n<tr>\n<td><strong>å€¼ï¼ˆvalueï¼‰</strong></td>\n<td>64 ä½æµ®ç‚¹æ•°</td>\n</tr>\n<tr>\n<td><strong>å…ƒæ•°æ®ï¼ˆlabelsï¼‰</strong></td>\n<td>ä¸€ç»„é”®å€¼å¯¹ï¼Œå¯ç”¨äºè¿‡æ»¤ä¸èšåˆæŸ¥è¯¢</td>\n</tr>\n<tr>\n<td><strong>ä¿ç•™ç­–ç•¥ï¼ˆretentionï¼‰</strong></td>\n<td>æ•°æ®ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ï¼Œè¿‡æœŸè‡ªåŠ¨ä¸¢å¼ƒ</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸»è¦åŠŸèƒ½ä¸ç‰¹æ€§</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>é«˜ååå†™å…¥</strong></td>\n<td>æ”¯æŒæ¯ç§’æ¥æ”¶å¤§é‡æ•°æ®ç‚¹ï¼Œå»¶è¿Ÿæä½</td>\n</tr>\n<tr>\n<td><strong>åŒºé—´æŸ¥è¯¢</strong></td>\n<td>å¯æŒ‰æ—¶é—´èŒƒå›´æ£€ç´¢æ•°æ®ï¼Œå¦‚ <code>TS.RANGE</code> / <code>TS.MRANGE</code></td>\n</tr>\n<tr>\n<td><strong>èšåˆæŸ¥è¯¢</strong></td>\n<td>å†…å»º minã€maxã€avgã€sumã€countã€firstã€last ç­‰èšåˆåŠŸèƒ½</td>\n</tr>\n<tr>\n<td><strong>è‡ªåŠ¨ä¸‹é‡‡æ · &amp; ç´¯ç§¯è§„åˆ™</strong></td>\n<td>é€šè¿‡ aggregation rules è‡ªåŠ¨ç”Ÿæˆæ›´ç²—ç²’åº¦æŒ‡æ ‡</td>\n</tr>\n<tr>\n<td><strong>ä¿ç•™ç­–ç•¥ï¼ˆRetentionï¼‰</strong></td>\n<td>è®¾ç½®æœ€å¤§ä¿å­˜æ—¶é—´æˆ–æ ·æœ¬æ•°é‡</td>\n</tr>\n<tr>\n<td><strong>æ ‡ç­¾ç´¢å¼•ï¼ˆLabelsï¼‰</strong></td>\n<td>æ”¯æŒåŸºäºæ ‡ç­¾çš„è·¨åºåˆ—æŸ¥è¯¢</td>\n</tr>\n<tr>\n<td><strong>é«˜æ•ˆå­˜å‚¨</strong></td>\n<td>ä½¿ç”¨å‹ç¼©ä¸å†…å­˜ç»“æ„ä¼˜åŒ–ç©ºé—´æˆæœ¬</td>\n</tr>\n<tr>\n<td><strong>å·¥å…·æ•´åˆ</strong></td>\n<td>æ”¯æŒ Grafanaã€Prometheusã€Telegraf ç­‰ç”Ÿæ€é›†æˆ</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åº”ç”¨åœºæ™¯</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç‰©è”ç½‘ï¼ˆIoTï¼‰ç›‘æ§</strong></td>\n<td>æ¸©åº¦ã€æ¹¿åº¦ã€è®¾å¤‡çŠ¶æ€ç­‰</td>\n</tr>\n<tr>\n<td><strong>ç³»ç»Ÿç›‘æ§ä¸æŒ‡æ ‡æ”¶é›†</strong></td>\n<td>CPUã€å†…å­˜ã€ç½‘ç»œæŒ‡æ ‡çš„å®æ—¶å­˜å‚¨ä¸åˆ†æ</td>\n</tr>\n<tr>\n<td><strong>ä¸šåŠ¡æŒ‡æ ‡åˆ†æ</strong></td>\n<td>æ¯æ—¥/æ¯å°æ—¶æ´»è·ƒç”¨æˆ·æ•°é‡ã€è¯·æ±‚å»¶è¿Ÿç­‰</td>\n</tr>\n<tr>\n<td><strong>é‡‘èæ—¶é—´åºåˆ—</strong></td>\n<td>è‚¡ç¥¨ä»·æ ¼ã€äº¤æ˜“é‡çš„å¿«é€Ÿå†™å…¥å’Œåˆ†æ</td>\n</tr>\n<tr>\n<td><strong>å®æ—¶å‘Šè­¦</strong></td>\n<td>æ•°æ®è¶Šç•Œæ—¶è§¦å‘å‘Šè­¦é€»è¾‘</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"TimeSeries-å‘½ä»¤è¯´æ˜\">TimeSeries å‘½ä»¤è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰â€œç”Ÿå‘½å‘¨æœŸâ€è§†è§’çš„å¿«é€Ÿç´¢å¼•</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é˜¶æ®µ</th>\n<th>å¯¹åº”å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åˆ›å»º</td>\n<td>TS.CREATE</td>\n</tr>\n<tr>\n<td>ä¿®æ”¹ç»“æ„</td>\n<td>TS.ALTER</td>\n</tr>\n<tr>\n<td>å»ºç«‹èšåˆ</td>\n<td>TS.CREATERULE / TS.DELETERULE</td>\n</tr>\n<tr>\n<td>å†™å…¥</td>\n<td>TS.ADD / TS.MADD / TS.INCRBY / TS.DECRBY</td>\n</tr>\n<tr>\n<td>æŸ¥è¯¢å•åºåˆ—</td>\n<td>TS.GET / TS.RANGE / TS.REVRANGE</td>\n</tr>\n<tr>\n<td>æŸ¥è¯¢å¤šåºåˆ—</td>\n<td>TS.MGET / TS.MRANGE / TS.MREVRANGE / TS.QUERYINDEX</td>\n</tr>\n<tr>\n<td>æ¸…ç†æ•°æ®</td>\n<td>TS.DEL</td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹çŠ¶æ€</td>\n<td><a href=\"http://TS.INFO\">TS.INFO</a></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ä¸€ã€æ—¶é—´åºåˆ—åˆ›å»ºä¸ç»“æ„ç®¡ç†ç±»\">ä¸€ã€æ—¶é—´åºåˆ—åˆ›å»ºä¸ç»“æ„ç®¡ç†ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>TS.CREATE</strong></td>\n<td>åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¶é—´åºåˆ—ï¼ˆå¯æŒ‡å®šä¿ç•™ç­–ç•¥ã€æ ‡ç­¾ã€chunk å¤§å°ç­‰ï¼‰</td>\n<td>åˆå§‹åŒ–æŒ‡æ ‡ï¼Œå¦‚åˆ›å»º CPUã€QPSã€å»¶è¿Ÿç­‰æŒ‡æ ‡åºåˆ—</td>\n</tr>\n<tr>\n<td><strong>TS.ALTER</strong></td>\n<td>ä¿®æ”¹å·²æœ‰æ—¶é—´åºåˆ—çš„é…ç½®ï¼ˆretentionã€chunk sizeã€duplicate policyã€labelsï¼‰</td>\n<td>åŠ¨æ€è°ƒæ•´æ•°æ®ä¿ç•™å‘¨æœŸã€æ ‡ç­¾ä¿¡æ¯</td>\n</tr>\n<tr>\n<td><strong>TS.CREATERULE</strong></td>\n<td>åˆ›å»ºå‹ç¼© / èšåˆè§„åˆ™ï¼ˆä» source series è‡ªåŠ¨èšåˆåˆ° dest seriesï¼‰</td>\n<td>åŸå§‹æ•°æ® â†’ æŒ‰åˆ†é’Ÿ / å°æ—¶èšåˆ</td>\n</tr>\n<tr>\n<td><strong>TS.DELETERULE</strong></td>\n<td>åˆ é™¤å·²æœ‰çš„å‹ç¼© / èšåˆè§„åˆ™</td>\n<td>åœæ­¢æŸæ¡è‡ªåŠ¨èšåˆè§„åˆ™</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1ï¸âƒ£-TS-CREATE-åˆ›å»ºæ—¶é—´åºåˆ—\">1ï¸âƒ£ TS.CREATE : åˆ›å»ºæ—¶é—´åºåˆ—</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.CREATE key</span><br><span class=\"line\">  [RETENTION retentionPeriod]</span><br><span class=\"line\">  [ENCODING &lt;COMPRESSED|UNCOMPRESSED&gt;]</span><br><span class=\"line\">  [CHUNK_SIZE size]</span><br><span class=\"line\">  [DUPLICATE_POLICY policy]</span><br><span class=\"line\">  [IGNORE ignoreMaxTimediff ignoreMaxValDiff]</span><br><span class=\"line\">  [LABELS [label value ...]]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ä½œç”¨</th>\n<th>å¯é€‰å€¼ / çº¦æŸ</th>\n<th>é»˜è®¤å€¼</th>\n<th>å…¸å‹ä½¿ç”¨å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>key</strong></td>\n<td>æ—¶é—´åºåˆ—çš„ Redis Key</td>\n<td>ä»»æ„åˆæ³• Redis key</td>\n<td>æ— </td>\n<td>å»ºè®®åŒ…å«ä¸šåŠ¡è¯­ä¹‰ï¼Œå¦‚ <code>ts:cpu:node1</code></td>\n</tr>\n<tr>\n<td><strong>RETENTION</strong></td>\n<td>æ•°æ®ä¿ç•™æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…è¿‡è‡ªåŠ¨åˆ é™¤</td>\n<td>â‰¥ 0ï¼Œ0 è¡¨ç¤ºæ°¸ä¹…ä¿ç•™</td>\n<td>0</td>\n<td>é«˜é¢‘æŒ‡æ ‡å¿…é¡»è®¾ç½®ï¼Œé¿å…å†…å­˜æ— é™å¢é•¿</td>\n</tr>\n<tr>\n<td><strong>ENCODING</strong></td>\n<td>æ•°æ®å­˜å‚¨ç¼–ç æ–¹å¼</td>\n<td><code>COMPRESSED</code>: å†…å­˜å ç”¨ä½ï¼ŒCPU æœ‰è½»å¾®å¼€é”€<br>  <code>UNCOMPRESSED</code>:æŸ¥è¯¢å¿«ï¼Œå ç”¨å†…å­˜é«˜</td>\n<td><code>COMPRESSED</code></td>\n<td>ç»å¤§å¤šæ•°åœºæ™¯ä¿æŒé»˜è®¤</td>\n</tr>\n<tr>\n<td><strong>CHUNK_SIZE</strong></td>\n<td>æ¯ä¸ªæ•°æ®å—çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œå½±å“å†…å­˜ç¢ç‰‡ä¸å‹ç¼©æ•ˆç‡</td>\n<td>â‰¥ 128 bytesï¼ˆé€šå¸¸ 1KBâ€“64KBï¼‰</td>\n<td>4096</td>\n<td>å†™å…¥é¢‘ç¹æ—¶é€‚å½“è°ƒå¤§</td>\n</tr>\n<tr>\n<td><strong>DUPLICATE_POLICY</strong></td>\n<td>åŒä¸€ timestamp é‡å¤å†™å…¥æ—¶çš„å¤„ç†ç­–ç•¥</td>\n<td>è§ä¸‹è¡¨</td>\n<td>å…¨å±€é…ç½®</td>\n<td>æ˜ç¡®æŒ‡å®šï¼Œé¿å…é»˜è®¤è¡Œä¸ºå˜åŒ–</td>\n</tr>\n<tr>\n<td><strong>IGNORE</strong></td>\n<td>å¿½ç•¥ä¸ä¸Šä¸€ç‚¹å·®å¼‚è¿‡å°çš„æ•°æ®</td>\n<td><code>ignoreMaxTimediff</code>: æœ€å¤§å…è®¸æ—¶é—´å·®ï¼ˆæ¯«ç§’ï¼‰<br> <code>ignoreMaxValDiff</code>: æœ€å¤§å…è®¸çš„æ•°å€¼å·®</td>\n<td>å…³é—­</td>\n<td>ç”¨äºé™å™ªå’Œé™é‡‡æ · <br>ç¤ºä¾‹ï¼š<code>IGNORE 1000 0.01</code>ï¼š 1 ç§’å†…ï¼Œå˜åŒ–å°äº 0.01 çš„æ•°æ®å°†è¢«å¿½ç•¥</td>\n</tr>\n<tr>\n<td><strong>LABELS</strong></td>\n<td>æ ‡ç­¾é”®å€¼å¯¹ï¼Œç”¨äºç´¢å¼•å’Œè¿‡æ»¤</td>\n<td>ä»»æ„å­—ç¬¦ä¸²å¯¹<br><code>LABELS key1 value1 key2 value2 ... </code></td>\n<td>æ— </td>\n<td>å¼ºçƒˆå»ºè®®ç”¨äºæŸ¥è¯¢</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>DUPLICATE_POLICYï¼ˆé‡å¤æ—¶é—´æˆ³ç­–ç•¥ï¼‰</p>\n</li>\n</ul>\n<blockquote>\n<p>å½“åŒä¸€ä¸ª timestamp è¢«å¤šæ¬¡å†™å…¥æ—¶ç”Ÿæ•ˆ</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>ç­–ç•¥</th>\n<th>å¤„ç†é€»è¾‘</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>BLOCK</strong></td>\n<td>é»˜è®¤ï¼Œé‡å¤æ—¶é—´æˆ³ç›´æ¥å¤±è´¥</td>\n</tr>\n<tr>\n<td><strong>FIRST</strong></td>\n<td>ä¿ç•™å·²æœ‰å€¼ï¼Œå¿½ç•¥æ–°å€¼</td>\n</tr>\n<tr>\n<td><strong>LAST</strong></td>\n<td>è¦†ç›–å·²æœ‰å€¼ï¼Œç”¨æ–°å€¼æ›¿ä»£</td>\n</tr>\n<tr>\n<td><strong>MIN</strong></td>\n<td>ä»…å½“æ–°å€¼æ›´å°æ‰è¦†ç›–</td>\n</tr>\n<tr>\n<td><strong>MAX</strong></td>\n<td>ä»…å½“æ–°å€¼æ›´å¤§æ‰è¦†ç›–</td>\n</tr>\n<tr>\n<td><strong>SUM</strong></td>\n<td>ç´¯åŠ å€¼ï¼ˆå·²æœ‰å€¼ + æ–°å€¼ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹: åˆ›å»ºä¸€ä¸ª CPU æŒ‡æ ‡æ—¶é—´åºåˆ—ï¼Œè‡ªåŠ¨è¿‡æœŸ 1 å°æ—¶ä¹‹å‰çš„æ•°æ®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.CREATE ts:cpu:server1</span><br><span class=\"line\">  RETENTION 3600000</span><br><span class=\"line\">  ENCODING COMPRESSED</span><br><span class=\"line\">  CHUNK_SIZE 8192</span><br><span class=\"line\">  DUPLICATE_POLICY LAST</span><br><span class=\"line\">  IGNORE 1000 0.1</span><br><span class=\"line\">  LABELS host server1 metric cpu</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ•°æ®ç±»å‹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">type</span> ts:cpu:server1</span><br><span class=\"line\">TSDB-TYPE</span><br></pre></td></tr></table></figure>\n<h4 id=\"2ï¸âƒ£-TS-ALTER-ä¿®æ”¹æ—¶é—´åºåˆ—é…ç½®\">2ï¸âƒ£ TS.ALTER : ä¿®æ”¹æ—¶é—´åºåˆ—é…ç½®</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.ALTER key</span><br><span class=\"line\">  [RETENTION retentionPeriod]</span><br><span class=\"line\">  [CHUNK_SIZE size]</span><br><span class=\"line\">  [DUPLICATE_POLICY policy]</span><br><span class=\"line\">  [LABELS [label value ...]]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šä¿®æ”¹ä¿ç•™å‘¨æœŸå’Œæ ‡ç­¾</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.ALTER ts:cpu:server1</span><br><span class=\"line\">  RETENTION 7200000</span><br><span class=\"line\">  LABELS host server1 metric cpu <span class=\"built_in\">env</span> prod</span><br></pre></td></tr></table></figure>\n<h4 id=\"3ï¸âƒ£-TS-CREATERULE-åˆ›å»ºè‡ªåŠ¨èšåˆè§„åˆ™\">3ï¸âƒ£ TS.CREATERULE : åˆ›å»ºè‡ªåŠ¨èšåˆè§„åˆ™</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯è¯´æ˜</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åŸå§‹åºåˆ—ï¼šts:cpu:server1ï¼ˆç§’çº§æ•°æ®ï¼‰</li>\n<li class=\"lvl-6\">èšåˆç›®æ ‡ï¼šts:cpu:server1:avg1mï¼ˆæŒ‰ 1 åˆ†é’Ÿå¹³å‡å€¼èšåˆï¼‰</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.CREATERULE sourceKey destKey</span><br><span class=\"line\">  AGGREGATION aggregator bucketDuration</span><br><span class=\"line\">  [alignTimestamp]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ä½œç”¨</th>\n<th>å¯é€‰å€¼ / çº¦æŸ</th>\n<th>æ˜¯å¦å¿…å¡«</th>\n<th>è¡Œä¸ºè¯´æ˜</th>\n<th>ä½¿ç”¨æ³¨æ„äº‹é¡¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>sourceKey</strong></td>\n<td>æºæ—¶é—´åºåˆ— Key</td>\n<td>å¿…é¡»æ˜¯å·²å­˜åœ¨çš„ TS key</td>\n<td>æ˜¯</td>\n<td>æ–°å†™å…¥æ•°æ®ä»è¯¥åºåˆ—è§¦å‘èšåˆ</td>\n<td>å¿…é¡»å…ˆåˆ›å»º</td>\n</tr>\n<tr>\n<td><strong>destKey</strong></td>\n<td>ç›®æ ‡èšåˆæ—¶é—´åºåˆ— Key</td>\n<td>å¿…é¡»æ˜¯å·²å­˜åœ¨çš„ TS key</td>\n<td>æ˜¯</td>\n<td>èšåˆç»“æœå†™å…¥è¯¥åºåˆ—</td>\n<td>é€šå¸¸ retention æ›´é•¿</td>\n</tr>\n<tr>\n<td><strong>aggregator</strong></td>\n<td>èšåˆå‡½æ•°</td>\n<td>è§ä¸‹è¡¨</td>\n<td>æ˜¯</td>\n<td>å®šä¹‰æ¯ä¸ª bucket å†…å¦‚ä½•è®¡ç®—</td>\n<td>ä¸åŒå‡½æ•°è®¡ç®—æˆæœ¬ä¸åŒ</td>\n</tr>\n<tr>\n<td><strong>bucketDuration</strong></td>\n<td>èšåˆæ—¶é—´æ¡¶å®½åº¦ï¼ˆæ¯«ç§’ï¼‰</td>\n<td>&gt; 0</td>\n<td>æ˜¯</td>\n<td>æ§åˆ¶èšåˆç²’åº¦</td>\n<td>å†³å®šæ•°æ®é™é‡‡æ ·ç¨‹åº¦</td>\n</tr>\n<tr>\n<td><strong>alignTimestamp</strong></td>\n<td>å¯¹é½æ—¶é—´æˆ³åŸºå‡†</td>\n<td>æ¯«ç§’æ—¶é—´æˆ³</td>\n<td>å¦</td>\n<td>æ§åˆ¶ bucket èµ·å§‹å¯¹é½æ–¹å¼</td>\n<td>è·¨ç³»ç»Ÿå¯¹é½æ—¶éå¸¸é‡è¦</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>aggregatorï¼ˆèšåˆå‡½æ•°ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>èšåˆå™¨</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>AVG</strong></td>\n<td>å¹³å‡å€¼</td>\n</tr>\n<tr>\n<td><strong>SUM</strong></td>\n<td>æ±‚å’Œ</td>\n</tr>\n<tr>\n<td><strong>MIN</strong></td>\n<td>æœ€å°å€¼</td>\n</tr>\n<tr>\n<td><strong>MAX</strong></td>\n<td>æœ€å¤§å€¼</td>\n</tr>\n<tr>\n<td><strong>COUNT</strong></td>\n<td>æ ·æœ¬æ•°é‡</td>\n</tr>\n<tr>\n<td><strong>FIRST</strong></td>\n<td>ç¬¬ä¸€ä¸ªæ ·æœ¬</td>\n</tr>\n<tr>\n<td><strong>LAST</strong></td>\n<td>æœ€åä¸€ä¸ªæ ·æœ¬</td>\n</tr>\n<tr>\n<td><strong>RANGE</strong></td>\n<td>MAX - MIN</td>\n</tr>\n<tr>\n<td><strong>STD.P</strong></td>\n<td>æ€»ä½“æ ‡å‡†å·®</td>\n</tr>\n<tr>\n<td><strong>STD.S</strong></td>\n<td>æ ·æœ¬æ ‡å‡†å·®</td>\n</tr>\n<tr>\n<td><strong>VAR.P</strong></td>\n<td>æ€»ä½“æ–¹å·®</td>\n</tr>\n<tr>\n<td><strong>VAR.S</strong></td>\n<td>æ ·æœ¬æ–¹å·®</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>alignTimestampï¼ˆå¯¹é½æ—¶é—´æˆ³åŸºå‡†ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>ç¤ºä¾‹å€¼</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>0ï¼ˆUnix Epochï¼‰</strong>ï¼ˆæ¨èåšæ³•ï¼‰</td>\n<td><code>0</code></td>\n<td>ä» 1970-01-01 00:00:00 UTC å¯¹é½</td>\n</tr>\n<tr>\n<td><strong>ä»»æ„å›ºå®šæ—¶é—´æˆ³</strong></td>\n<td><code>1700000000000</code></td>\n<td>ä»æŒ‡å®šæ—¶é—´ç‚¹å¯¹é½</td>\n</tr>\n<tr>\n<td><strong>å½“å‰æ—¶é—´æˆ³</strong></td>\n<td><code>$(date +%s%3N)</code></td>\n<td>ä»åˆ›å»ºè§„åˆ™æ—¶åˆ»å¯¹é½</td>\n</tr>\n<tr>\n<td><strong>ä¸šåŠ¡æ—¶é—´è¾¹ç•Œ</strong></td>\n<td>æŸå¤© 00:00 çš„æ¯«ç§’å€¼</td>\n<td>å¯¹é½åˆ°ä¸šåŠ¡å‘¨æœŸ</td>\n</tr>\n<tr>\n<td><strong>ä¸æŒ‡å®š</strong></td>\n<td>ï¼ˆå‚æ•°çœç•¥ï¼‰</td>\n<td>è‡ªåŠ¨ä½¿ç”¨é¦–æ¡å†™å…¥æ—¶é—´</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹: æ¯ 60,000msï¼ˆ1åˆ†é’Ÿï¼‰åšä¸€æ¬¡å¹³å‡èšåˆ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.åˆ›å»ºç›®æ ‡èšåˆåºåˆ—</span></span><br><span class=\"line\">TS.CREATE ts:cpu:server1:avg1m</span><br><span class=\"line\">  RETENTION 86400000</span><br><span class=\"line\">  LABELS host server1 metric cpu_1m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.åˆ›å»ºè‡ªåŠ¨èšåˆè§„åˆ™</span></span><br><span class=\"line\">TS.CREATERULE ts:cpu:server1 ts:cpu:server1:avg1m</span><br><span class=\"line\">  AGGREGATION AVG 60000</span><br><span class=\"line\"><span class=\"comment\">## å¦‚æœæœªè®¾ç½® alignTimestampï¼Œåˆ™ä»¥åˆ›å»ºçš„ç¬¬ä¸€æ¡è®°å½•çš„æ—¶é—´ä¸ºåŸºå‡†</span></span><br><span class=\"line\"><span class=\"comment\">## æ¯”å¦‚ç¬¬ä¸€æ¡è®°å½•çš„æ—¶é—´ä¸ºï¼š12:00:23</span></span><br><span class=\"line\"><span class=\"comment\">## bucket ä¼šå¯¹é½åˆ°:</span></span><br><span class=\"line\">    <span class=\"comment\"># 12:00:23 ~ 12:01:23</span></span><br><span class=\"line\">    <span class=\"comment\"># 12:01:23 ~ 12:02:23</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š alignTimestamp å¯¹é½åˆ°æ•´åˆ†é’Ÿ</span></span><br><span class=\"line\">TS.CREATERULE ts:cpu:server1 ts:cpu:server1:avg1m</span><br><span class=\"line\">  AGGREGATION AVG 60000 0</span><br><span class=\"line\"><span class=\"comment\">## bucket ä¼šä¸¥æ ¼å¯¹é½:</span></span><br><span class=\"line\">    <span class=\"comment\"># 12:00:00 ~ 12:01:00</span></span><br><span class=\"line\">    <span class=\"comment\"># 12:01:00 ~ 12:02:00</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"4ï¸âƒ£-TS-DELETERULE-åˆ é™¤è‡ªåŠ¨èšåˆè§„åˆ™\">4ï¸âƒ£ TS.DELETERULE : åˆ é™¤è‡ªåŠ¨èšåˆè§„åˆ™</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.DELETERULE sourceKey destKey</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šåˆ é™¤è‡ªåŠ¨èšåˆè§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.DELETERULE ts:cpu:server1 ts:cpu:server1:avg1m</span><br></pre></td></tr></table></figure>\n<h3 id=\"äºŒã€æ•°æ®å†™å…¥ä¸æ›´æ–°ç±»\">äºŒã€æ•°æ®å†™å…¥ä¸æ›´æ–°ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>TS.ADD</strong></td>\n<td>å‘æ—¶é—´åºåˆ—è¿½åŠ ä¸€ä¸ªæ ·æœ¬ç‚¹ï¼ˆtimestamp, valueï¼‰</td>\n<td>å®æ—¶å†™å…¥ç›‘æ§æ•°æ®</td>\n</tr>\n<tr>\n<td><strong>TS.MADD</strong></td>\n<td>æ‰¹é‡å‘å¤šä¸ªæ—¶é—´åºåˆ—è¿½åŠ æ ·æœ¬</td>\n<td>é«˜åååœºæ™¯ï¼Œå‡å°‘ç½‘ç»œ RTT</td>\n</tr>\n<tr>\n<td><strong>TS.INCRBY</strong></td>\n<td>å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå¢ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰</td>\n<td>è®¡æ•°å™¨ã€ç´¯è®¡æŒ‡æ ‡</td>\n</tr>\n<tr>\n<td><strong>TS.DECRBY</strong></td>\n<td>å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå‡ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰</td>\n<td>åº“å­˜ã€ä½™é¢ç±»é€’å‡æŒ‡æ ‡</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1ï¸âƒ£-TS-ADD-å‘æ—¶é—´åºåˆ—è¿½åŠ ä¸€ä¸ªæ ·æœ¬ç‚¹\">1ï¸âƒ£ TS.ADD : å‘æ—¶é—´åºåˆ—è¿½åŠ ä¸€ä¸ªæ ·æœ¬ç‚¹</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.ADD key timestamp value</span><br><span class=\"line\">  [RETENTION retentionPeriod]</span><br><span class=\"line\">  [ENCODING &lt;COMPRESSED|UNCOMPRESSED&gt;]</span><br><span class=\"line\">  [CHUNK_SIZE size]</span><br><span class=\"line\">  [DUPLICATE_POLICY policy]</span><br><span class=\"line\">  [ON_DUPLICATE policy_ovr]</span><br><span class=\"line\">  [IGNORE ignoreMaxTimediff ignoreMaxValDiff]</span><br><span class=\"line\">  [LABELS [label value ...]]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœ key ä¸å­˜åœ¨ï¼ŒTS.ADD ä¼š éšå¼åˆ›å»ºæ—¶é—´åºåˆ—ï¼ˆç±»ä¼¼ TS.CREATEï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ä½œç”¨</th>\n<th>å¯é€‰å€¼ / çº¦æŸ</th>\n<th>æ˜¯å¦è¦†ç›–å·²æœ‰é…ç½®</th>\n<th>ç”Ÿæ•ˆèŒƒå›´</th>\n<th>ä½¿ç”¨æ³¨æ„äº‹é¡¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>key</strong></td>\n<td>æ—¶é—´åºåˆ— Key</td>\n<td>åˆæ³• Redis key</td>\n<td>â€”</td>\n<td>â€”</td>\n<td>ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º</td>\n</tr>\n<tr>\n<td><strong>timestamp</strong></td>\n<td>æ ·æœ¬æ—¶é—´æˆ³</td>\n<td>æ¯«ç§’æ•´æ•° / <code>*</code></td>\n<td>â€”</td>\n<td>å½“å‰å†™å…¥</td>\n<td><code>*</code> è¡¨ç¤ºæœåŠ¡å™¨å½“å‰æ—¶é—´</td>\n</tr>\n<tr>\n<td><strong>value</strong></td>\n<td>æ ·æœ¬å€¼</td>\n<td>æµ®ç‚¹æ•°</td>\n<td>â€”</td>\n<td>å½“å‰å†™å…¥</td>\n<td>NaN / Inf ä¸å…è®¸</td>\n</tr>\n<tr>\n<td><strong>RETENTION</strong></td>\n<td>è®¾ç½®ä¿ç•™å‘¨æœŸ</td>\n<td>â‰¥ 0ï¼ˆæ¯«ç§’ï¼‰</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>å·²å­˜åœ¨ key ä¸ä¼šè¢«ä¿®æ”¹</td>\n</tr>\n<tr>\n<td><strong>ENCODING</strong></td>\n<td>å­˜å‚¨ç¼–ç </td>\n<td>COMPRESSED / UNCOMPRESSED</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>ç”Ÿäº§æ¨è COMPRESSED</td>\n</tr>\n<tr>\n<td><strong>CHUNK_SIZE</strong></td>\n<td>æ•°æ®å—å¤§å°</td>\n<td>â‰¥ 128 bytes</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>ä¸å½±å“å·²æœ‰ chunk</td>\n</tr>\n<tr>\n<td><strong>DUPLICATE_POLICY</strong></td>\n<td>è®¾ç½®é»˜è®¤é‡å¤ç­–ç•¥</td>\n<td>BLOCK / FIRST / LAST / MIN / MAX / SUM</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>ä¸ ON_DUPLICATE æœ‰ä¼˜å…ˆçº§å…³ç³»</td>\n</tr>\n<tr>\n<td><strong>ON_DUPLICATE</strong></td>\n<td>æœ¬æ¬¡å†™å…¥çš„é‡å¤ç­–ç•¥</td>\n<td>åŒä¸Š</td>\n<td>è¦†ç›–åºåˆ—çº§ç­–ç•¥</td>\n<td>å½“å‰å†™å…¥</td>\n<td>æ¨èç”¨äºä¸´æ—¶è¦†ç›–</td>\n</tr>\n<tr>\n<td><strong>IGNORE</strong></td>\n<td>å¿½ç•¥å¾®å°å˜åŒ–å†™å…¥</td>\n<td>ä¸¤ä¸ªé˜ˆå€¼</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>ç”¨äºé™å™ª</td>\n</tr>\n<tr>\n<td><strong>LABELS</strong></td>\n<td>è®¾ç½®æ ‡ç­¾</td>\n<td>é”®å€¼å¯¹</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>å·²å­˜åœ¨ key ä¸ä¼šä¿®æ”¹</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå†™å…¥ä¸€ä¸ªæ—¶é—´åºåˆ—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.ADD ts:cpu:server1 * 80.5</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1767777655255 <span class=\"comment\"># å½“å‰æ—¶é—´æˆ³</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"2ï¸âƒ£-TS-MADD-æ‰¹é‡å‘å¤šä¸ªæ—¶é—´åºåˆ—è¿½åŠ æ ·æœ¬\">2ï¸âƒ£ TS.MADD : æ‰¹é‡å‘å¤šä¸ªæ—¶é—´åºåˆ—è¿½åŠ æ ·æœ¬</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.MADD key timestamp value [key timestamp value ...]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæ‰¹é‡å†™å…¥å¤šä¸ªæ—¶é—´åºåˆ—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ‰¹é‡å†™å…¥ä¸‰ä¸ªæ—¶é—´åºåˆ—ï¼Œæ—¶é—´åºåˆ—å¿…é¡»å­˜åœ¨</span></span><br><span class=\"line\">TS.MADD ts:cpu:server1 * 80.5 ts:cpu:server2 * 90.5 ts:cpu:server3 * 70.5</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1767777807933</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 1767777807933</span><br><span class=\"line\">3) (<span class=\"built_in\">integer</span>) 1767777807933</span><br></pre></td></tr></table></figure>\n<h4 id=\"3ï¸âƒ£-TS-INCRBY-å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå¢ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰\">3ï¸âƒ£ TS.INCRBY : å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå¢ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.INCRBY key addend</span><br><span class=\"line\">  [TIMESTAMP timestamp]</span><br><span class=\"line\">  [RETENTION retentionPeriod]</span><br><span class=\"line\">  [ENCODING &lt;COMPRESSED|UNCOMPRESSED&gt;]</span><br><span class=\"line\">  [CHUNK_SIZE size]</span><br><span class=\"line\">  [DUPLICATE_POLICY policy]</span><br><span class=\"line\">  [IGNORE ignoreMaxTimediff ignoreMaxValDiff]</span><br><span class=\"line\">  [LABELS [label value ...]]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ä½œç”¨</th>\n<th>å¯é€‰å€¼ / çº¦æŸ</th>\n<th>æ˜¯å¦è¦†ç›–å·²æœ‰é…ç½®</th>\n<th>ç”Ÿæ•ˆèŒƒå›´</th>\n<th>ä½¿ç”¨æ³¨æ„äº‹é¡¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>key</strong></td>\n<td>æ—¶é—´åºåˆ— Key</td>\n<td>åˆæ³• Redis key</td>\n<td>â€”</td>\n<td>â€”</td>\n<td>ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</td>\n</tr>\n<tr>\n<td><strong>addend</strong></td>\n<td>å¢é‡å€¼</td>\n<td>æµ®ç‚¹æ•°</td>\n<td>â€”</td>\n<td>å½“å‰å†™å…¥</td>\n<td>æ”¯æŒè´Ÿæ•°ï¼ˆç­‰ä»· DECRï¼‰</td>\n</tr>\n<tr>\n<td><strong>TIMESTAMP</strong></td>\n<td>æŒ‡å®šå†™å…¥æ—¶é—´æˆ³</td>\n<td>æ¯«ç§’æ•´æ•°</td>\n<td>â€”</td>\n<td>å½“å‰å†™å…¥</td>\n<td>é»˜è®¤ä½¿ç”¨æœåŠ¡å™¨æ—¶é—´</td>\n</tr>\n<tr>\n<td><strong>RETENTION</strong></td>\n<td>è®¾ç½®ä¿ç•™å‘¨æœŸ</td>\n<td>â‰¥ 0ï¼ˆæ¯«ç§’ï¼‰</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>å·²å­˜åœ¨ key ä¸ç”Ÿæ•ˆ</td>\n</tr>\n<tr>\n<td><strong>ENCODING</strong></td>\n<td>å­˜å‚¨ç¼–ç </td>\n<td>COMPRESSED / UNCOMPRESSED</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>æ¨è COMPRESSED</td>\n</tr>\n<tr>\n<td><strong>CHUNK_SIZE</strong></td>\n<td>æ•°æ®å—å¤§å°</td>\n<td>â‰¥ 128 bytes</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>é«˜é¢‘å†™å…¥å¯è°ƒå¤§</td>\n</tr>\n<tr>\n<td><strong>DUPLICATE_POLICY</strong></td>\n<td>é»˜è®¤é‡å¤æ—¶é—´æˆ³ç­–ç•¥</td>\n<td>BLOCK / FIRST / LAST / MIN / MAX / SUM</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>å¯¹è®¡æ•°å™¨é€šå¸¸è®¾ SUM</td>\n</tr>\n<tr>\n<td><strong>IGNORE</strong></td>\n<td>å¿½ç•¥å¾®å°å˜åŒ–</td>\n<td>ä¸¤ä¸ªé˜ˆå€¼</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>è®¡æ•°å™¨ä¸€èˆ¬ä¸ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><strong>LABELS</strong></td>\n<td>æ ‡ç­¾</td>\n<td>é”®å€¼å¯¹</td>\n<td>ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ</td>\n<td>åºåˆ—çº§</td>\n<td>ç”¨äº MGET / MRANGE</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœ key ä¸å­˜åœ¨ï¼ŒTS.INCRBY ä¼š éšå¼åˆ›å»ºæ—¶é—´åºåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœæ²¡æœ‰æŒ‡å®š TIMESTAMPï¼Œåˆ™è‡ªåŠ¨ä½¿ç”¨æœåŠ¡å™¨å½“å‰æ—¶é—´ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å†™å…¥é€»è¾‘ç­‰ä»·äºï¼šè¯»å–æœ€æ–°å€¼ + addend â†’ å†™å›ä¸€ä¸ªæ–°æ ·æœ¬ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå¢</span></span><br><span class=\"line\">TS.INCRBY ts:cpu:server1 10</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1767778308125</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šæ—¶é—´æˆ³ï¼ŒTIMESTAMP å¿…é¡»å¤§äºæˆ–ç­‰äºå½“å‰æ—¶é—´åºåˆ—ä¸­æœ€å¤§çš„æ—¶é—´æˆ³</span></span><br><span class=\"line\">TS.INCRBY ts:cpu:server1 5 TIMESTAMP 1767778308126</span><br></pre></td></tr></table></figure>\n<h4 id=\"4ï¸âƒ£-TS-DECRBY-å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå‡ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰\">4ï¸âƒ£ TS.DECRBY : å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå‡ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ <code>TS.INCRBY</code> ç›¸ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š <code>TS.INCRBY</code> ä¸­è®¾ç½® <code>addend</code> ä¸ºè´Ÿæ•° å°±æ˜¯ <code>TS.DECR</code></p>\n</li>\n</ul>\n<h3 id=\"ä¸‰ã€æ•°æ®æŸ¥è¯¢ï¼ˆå•åºåˆ—ï¼‰ç±»\">ä¸‰ã€æ•°æ®æŸ¥è¯¢ï¼ˆå•åºåˆ—ï¼‰ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>TS.GET</strong></td>\n<td>è·å–æŸä¸ªæ—¶é—´åºåˆ—æœ€æ–°ï¼ˆæœ€å¤§ timestampï¼‰çš„æ ·æœ¬</td>\n<td>è·å–å½“å‰æœ€æ–°æŒ‡æ ‡å€¼</td>\n</tr>\n<tr>\n<td><strong>TS.RANGE</strong></td>\n<td>æŒ‰æ—¶é—´æ­£åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</td>\n<td>ç»˜å›¾ã€è¶‹åŠ¿åˆ†æ</td>\n</tr>\n<tr>\n<td><strong>TS.REVRANGE</strong></td>\n<td>æŒ‰æ—¶é—´é€†åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</td>\n<td>è·å–æœ€è¿‘ N æ¡æ•°æ®</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1ï¸âƒ£-TS-GET-è·å–æŸä¸ªæ—¶é—´åºåˆ—æœ€æ–°ï¼ˆæœ€å¤§-timestampï¼‰çš„æ ·æœ¬\">1ï¸âƒ£ TS.GET : è·å–æŸä¸ªæ—¶é—´åºåˆ—æœ€æ–°ï¼ˆæœ€å¤§ timestampï¼‰çš„æ ·æœ¬</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.GET key [LATEST]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>key</strong></td>\n<td>æ—¶é—´åºåˆ— Key</td>\n</tr>\n<tr>\n<td><strong>LATEST</strong></td>\n<td>è·å–æœ€æ–°æ ·æœ¬</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>LATEST è¯´æ˜</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å½“ä¸€ä¸ªæ—¶é—´åºåˆ—æ˜¯ç»è¿‡èšåˆï¼ˆcompactionï¼‰å¤„ç†çš„æ—¶ï¼ŒLATEST å‚æ•°ä¼šç”Ÿæ•ˆã€‚ä½¿ç”¨ LATEST æ—¶ï¼ŒTS.GET ä¼šè¿”å›æœ€æ–°ï¼ˆå¯èƒ½æ˜¯éƒ¨åˆ†çš„ï¼‰æ¡¶çš„èšåˆå€¼ã€‚ä¸ä½¿ç”¨ LATEST æ—¶ï¼ŒTS.GET ä¸ä¼šè¿”å›æœ€æ–°ï¼ˆå¯èƒ½æ˜¯éƒ¨åˆ†çš„ï¼‰æ¡¶çš„å€¼ã€‚å½“æ—¶é—´åºåˆ—ä¸æ˜¯èšåˆçš„æ—¶ï¼ŒLATEST ä¼šè¢«å¿½ç•¥ã€‚</li>\n<li class=\"lvl-6\">æœ€æ–°æ¡¶ä¸­çš„æ•°æ®å¯èƒ½æ˜¯ä¸å®Œæ•´çš„ã€‚åªæœ‰å½“æœ‰æ–°çš„æ ·æœ¬åˆ°æ¥å¹¶å¼€å¯ä¸€ä¸ªæ–°çš„æœ€æ–°æ¡¶æ—¶ï¼ŒåŸæ¡¶æ‰ä¼šè¢«å…³é—­å¹¶è¿›è¡Œèšåˆã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿéœ€è¦è·å–æœ€æ–°ï¼ˆå¯èƒ½æ˜¯éƒ¨åˆ†çš„ï¼‰æ¡¶çš„èšåˆå€¼ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ LATESTã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.GET ts:cpu:server1 LATEST</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1767778308126</span><br><span class=\"line\">2) 115.5</span><br></pre></td></tr></table></figure>\n<h4 id=\"2ï¸âƒ£-TS-RANGE-æŒ‰æ—¶é—´æ­£åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®\">2ï¸âƒ£ TS.RANGE : æŒ‰æ—¶é—´æ­£åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.RANGE key fromTimestamp toTimestamp</span><br><span class=\"line\">  [LATEST]</span><br><span class=\"line\">  [FILTER_BY_TS ts...]</span><br><span class=\"line\">  [FILTER_BY_VALUE min max]</span><br><span class=\"line\">  [COUNT count]</span><br><span class=\"line\">  [[ALIGN align] AGGREGATION aggregator bucketDuration [BUCKETTIMESTAMP bt] [EMPTY]]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n<th>å¯é€‰å€¼ / è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>key</code></td>\n<td>string</td>\n<td>æ—¶é—´åºåˆ—çš„é”®å</td>\n<td>å¿…é€‰</td>\n</tr>\n<tr>\n<td><code>fromTimestamp</code></td>\n<td>integer</td>\n<td>æŸ¥è¯¢èµ·å§‹æ—¶é—´æˆ³ï¼Œ<code>-</code>: æœ€å°å€¼</td>\n<td>å¿…é€‰</td>\n</tr>\n<tr>\n<td><code>toTimestamp</code></td>\n<td>integer</td>\n<td>æŸ¥è¯¢ç»“æŸæ—¶é—´æˆ³ ï¼Œ<code>+</code>: æœ€å¤§å€¼</td>\n<td>å¿…é€‰</td>\n</tr>\n<tr>\n<td><code>LATEST</code></td>\n<td>flag</td>\n<td>å½“æ—¶é—´åºåˆ—æ˜¯ compaction æ—¶ï¼Œè¿”å›æœ€æ–°ï¼ˆå¯èƒ½éƒ¨åˆ†ï¼‰çš„æ¡¶çš„èšåˆå€¼</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>FILTER_BY_TS ts...</code></td>\n<td>list of integers</td>\n<td>åªè¿”å›æŒ‡å®šæ—¶é—´æˆ³çš„æ ·æœ¬</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>FILTER_BY_VALUE min max</code></td>\n<td>range</td>\n<td>åªè¿”å›å€¼åœ¨ <code>[min, max]</code> åŒºé—´çš„æ ·æœ¬</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>COUNT count</code></td>\n<td>integer</td>\n<td>é™åˆ¶è¿”å›çš„æ ·æœ¬æ•°é‡ï¼ˆæœ€å¤š <code>count</code> ä¸ªï¼‰</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>ALIGN align</code></td>\n<td>string</td>\n<td>å¯¹é½èšåˆæ¡¶çš„æ—¶é—´æˆ³ï¼ˆå¦‚ <code>start</code>ã€<code>end</code>ã€è‡ªå®šä¹‰æ—¶é—´æˆ³ï¼‰</td>\n<td>å¯é€‰ï¼Œéœ€ä¸ <code>AGGREGATION</code> ä¸€èµ·ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><code>AGGREGATION aggregator bucketDuration</code></td>\n<td>aggregation</td>\n<td>å¯¹æ•°æ®è¿›è¡Œèšåˆè®¡ç®—ï¼Œ<code>aggregator</code> ä¸ºèšåˆå‡½æ•°ï¼ˆå¦‚ <code>avg</code>, <code>sum</code>, <code>min</code>, <code>max</code> ç­‰ï¼‰ï¼Œ<code>bucketDuration</code> ä¸ºæ¡¶çš„æ—¶é•¿</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>BUCKETTIMESTAMP bt</code></td>\n<td>string</td>\n<td>èšåˆæ¡¶æ—¶é—´æˆ³é€‰æ‹©ï¼Œ<code>bt</code> å¯ä¸º <code>start</code> æˆ– <code>end</code></td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>EMPTY</code></td>\n<td>flag</td>\n<td>å³ä½¿æ¡¶ä¸ºç©ºä¹Ÿè¿”å›ç»“æœ</td>\n<td>å¯é€‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æ—¶é—´åºåˆ— ts:cpu:server1 çš„åŒºé—´æ•°æ®</span></span><br><span class=\"line\">TS.RANGE ts:cpu:server1 0 1767778308126</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) 1) (<span class=\"built_in\">integer</span>) 1767777655255</span><br><span class=\"line\">   2) 80.5</span><br><span class=\"line\">2) 1) (<span class=\"built_in\">integer</span>) 1767777807933</span><br><span class=\"line\">   2) 70.5</span><br><span class=\"line\">3) 1) (<span class=\"built_in\">integer</span>) 1767777873866</span><br><span class=\"line\">   2) 80.5</span><br><span class=\"line\">4) 1) (<span class=\"built_in\">integer</span>) 1767777965870</span><br><span class=\"line\">   2) 80.5</span><br><span class=\"line\">5) 1) (<span class=\"built_in\">integer</span>) 1767778300909</span><br><span class=\"line\">   2) 90.5</span><br><span class=\"line\">6) 1) (<span class=\"built_in\">integer</span>) 1767778308125</span><br><span class=\"line\">   2) 105.5</span><br><span class=\"line\">7) 1) (<span class=\"built_in\">integer</span>) 1767778308126</span><br><span class=\"line\">   2) 115.5</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æ—¶é—´åºåˆ— ts:cpu:server1 çš„åŒºé—´æ•°æ®ï¼Œå¹¶è¿”å›èšåˆç»“æœï¼Œæ±‚1000mså†…å¹³å‡å€¼</span></span><br><span class=\"line\">TS.RANGE ts:cpu:server1 - + AGGREGATION avg 1000</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) 1) (<span class=\"built_in\">integer</span>) 1767777655000</span><br><span class=\"line\">   2) 80.5</span><br><span class=\"line\">2) 1) (<span class=\"built_in\">integer</span>) 1767777807000</span><br><span class=\"line\">   2) 70.5</span><br><span class=\"line\">3) 1) (<span class=\"built_in\">integer</span>) 1767777873000</span><br><span class=\"line\">   2) 80.5</span><br><span class=\"line\">4) 1) (<span class=\"built_in\">integer</span>) 1767777965000</span><br><span class=\"line\">   2) 80.5</span><br><span class=\"line\">5) 1) (<span class=\"built_in\">integer</span>) 1767778300000</span><br><span class=\"line\">   2) 90.5</span><br><span class=\"line\">6) 1) (<span class=\"built_in\">integer</span>) 1767778308000</span><br><span class=\"line\">   2) 110.5</span><br></pre></td></tr></table></figure>\n<h4 id=\"3ï¸âƒ£-TS-REVRANGE-æŒ‰æ—¶é—´é€†åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®\">3ï¸âƒ£ TS.REVRANGE : æŒ‰æ—¶é—´é€†åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ TS.RANGE ç±»ä¼¼ï¼Œåªæ˜¯è¿”å›ç»“æœæ˜¯å€’åºçš„</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.REVRANGE ts:cpu:server1 0 1767778308126</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) 1) (<span class=\"built_in\">integer</span>) 1767778308126</span><br><span class=\"line\">   2) 115.5</span><br><span class=\"line\">2) 1) (<span class=\"built_in\">integer</span>) 1767778308125</span><br><span class=\"line\">   2) 105.5</span><br><span class=\"line\">3) 1) (<span class=\"built_in\">integer</span>) 1767778300909</span><br><span class=\"line\">   2) 90.5</span><br><span class=\"line\">4) 1) (<span class=\"built_in\">integer</span>) 1767777965870</span><br><span class=\"line\">   2) 80.5</span><br><span class=\"line\">5) 1) (<span class=\"built_in\">integer</span>) 1767777873866</span><br><span class=\"line\">   2) 80.5</span><br><span class=\"line\">6) 1) (<span class=\"built_in\">integer</span>) 1767777807933</span><br><span class=\"line\">   2) 70.5</span><br><span class=\"line\">7) 1) (<span class=\"built_in\">integer</span>) 1767777655255</span><br><span class=\"line\">   2) 80.5</span><br></pre></td></tr></table></figure>\n<h3 id=\"å››ã€æ•°æ®æŸ¥è¯¢ï¼ˆå¤šåºåˆ—-èšåˆï¼‰ç±»\">å››ã€æ•°æ®æŸ¥è¯¢ï¼ˆå¤šåºåˆ— / èšåˆï¼‰ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>TS.MGET</strong></td>\n<td>æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè·å–å¤šä¸ªæ—¶é—´åºåˆ—çš„æœ€æ–°å€¼</td>\n<td>æ‰¹é‡è·å–å¤šä¸ªå®ä¾‹çš„å½“å‰æŒ‡æ ‡</td>\n</tr>\n<tr>\n<td><strong>TS.MRANGE</strong></td>\n<td>æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œæ­£åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</td>\n<td>å¤šç»´æŒ‡æ ‡åˆ†æã€èšåˆ</td>\n</tr>\n<tr>\n<td><strong>TS.MREVRANGE</strong></td>\n<td>æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œé€†åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</td>\n<td>æœ€è¿‘æ•°æ®èšåˆåˆ†æ</td>\n</tr>\n<tr>\n<td><strong>TS.QUERYINDEX</strong></td>\n<td>æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè¿”å›åŒ¹é…çš„æ—¶é—´åºåˆ— key åˆ—è¡¨</td>\n<td>å‘ç°æœ‰å“ªäº›æŒ‡æ ‡ç¬¦åˆæ¡ä»¶</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1ï¸âƒ£-TS-MGET-æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè·å–å¤šä¸ªæ—¶é—´åºåˆ—çš„æœ€æ–°å€¼\">1ï¸âƒ£ TS.MGET : æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè·å–å¤šä¸ªæ—¶é—´åºåˆ—çš„æœ€æ–°å€¼</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.MGET [LATEST] [WITHLABELS | &lt;SELECTED_LABELS label...&gt;] FILTER filterExpr...</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n<th>å¯é€‰å€¼ / è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>LATEST</code></td>\n<td>flag</td>\n<td>å¯¹ compaction ç±»å‹çš„æ—¶é—´åºåˆ—ï¼Œè¿”å›æœ€æ–°ï¼ˆå¯èƒ½éƒ¨åˆ†ï¼‰çš„æ ·æœ¬å€¼</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>WITHLABELS</code></td>\n<td>flag</td>\n<td>è¿”å›æ ·æœ¬çš„åŒæ—¶é™„å¸¦æ—¶é—´åºåˆ—çš„æ‰€æœ‰æ ‡ç­¾</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>&lt;SELECTED_LABELS label...&gt;</code></td>\n<td>list</td>\n<td>è¿”å›æ ·æœ¬æ—¶åªé™„å¸¦æŒ‡å®šæ ‡ç­¾</td>\n<td>å¯é€‰ï¼Œä¸èƒ½ä¸ <code>WITHLABELS</code> ä¸€èµ·ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><code>FILTER filterExpr...</code></td>\n<td>list of expressions</td>\n<td>è¿‡æ»¤æ—¶é—´åºåˆ—ï¼Œæ ¹æ®æ ‡ç­¾åŒ¹é…è§„åˆ™ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„åºåˆ—</td>\n<td>å¿…é€‰ï¼Œæ”¯æŒæ ‡ç­¾åŒ¹é…è¡¨è¾¾å¼ï¼Œå¦‚ <code>sensor=temperature</code> æˆ– <code>region=*</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–æ‰€æœ‰æ—¶é—´åºåˆ—çš„æœ€æ–°å€¼ï¼Œæ ¹æ®æ ‡ç­¾è¿‡æ»¤</span></span><br><span class=\"line\">TS.MGET WITHLABELS FILTER metric=cpu</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;ts:cpu:server1&quot;</span></span><br><span class=\"line\">   2) 1) 1) <span class=\"string\">&quot;host&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;server1&quot;</span></span><br><span class=\"line\">      2) 1) <span class=\"string\">&quot;metric&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;cpu&quot;</span></span><br><span class=\"line\">      3) 1) <span class=\"string\">&quot;env&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;prod&quot;</span></span><br><span class=\"line\">   3) 1) (<span class=\"built_in\">integer</span>) 1767778308126</span><br><span class=\"line\">      2) 115.5</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;ts:cpu:server2&quot;</span></span><br><span class=\"line\">   2) 1) 1) <span class=\"string\">&quot;host&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;server1&quot;</span></span><br><span class=\"line\">      2) 1) <span class=\"string\">&quot;metric&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;cpu&quot;</span></span><br><span class=\"line\">   3) 1) (<span class=\"built_in\">integer</span>) 1767777965870</span><br><span class=\"line\">      2) 90.5</span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;ts:cpu:server3&quot;</span></span><br><span class=\"line\">   2) 1) 1) <span class=\"string\">&quot;host&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;server1&quot;</span></span><br><span class=\"line\">      2) 1) <span class=\"string\">&quot;metric&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;cpu&quot;</span></span><br><span class=\"line\">   3) 1) (<span class=\"built_in\">integer</span>) 1767777965870</span><br><span class=\"line\">      2) 70.5</span><br></pre></td></tr></table></figure>\n<h4 id=\"2ï¸âƒ£-TS-MRANGE-æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œæ­£åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®\">2ï¸âƒ£ TS.MRANGE : æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œæ­£åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.MRANGE fromTimestamp toTimestamp</span><br><span class=\"line\">  [LATEST]</span><br><span class=\"line\">  [FILTER_BY_TS ts...]</span><br><span class=\"line\">  [FILTER_BY_VALUE min max]</span><br><span class=\"line\">  [WITHLABELS | &lt;SELECTED_LABELS label...&gt;]</span><br><span class=\"line\">  [COUNT count]</span><br><span class=\"line\">  [[ALIGN align] AGGREGATION aggregator bucketDuration [BUCKETTIMESTAMP bt] [EMPTY]]</span><br><span class=\"line\">  FILTER filterExpr...</span><br><span class=\"line\">  [GROUPBY label REDUCE reducer]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n<th>å¯é€‰å€¼ / è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>fromTimestamp</code></td>\n<td>integer</td>\n<td>æŸ¥è¯¢èµ·å§‹æ—¶é—´æˆ³ï¼Œ<code>-</code>: æœ€å°å€¼</td>\n<td>å¿…é€‰</td>\n</tr>\n<tr>\n<td><code>toTimestamp</code></td>\n<td>integer</td>\n<td>æŸ¥è¯¢ç»“æŸæ—¶é—´æˆ³ï¼Œ<code>+</code>: æœ€å¤§å€¼</td>\n<td>å¿…é€‰</td>\n</tr>\n<tr>\n<td><code>LATEST</code></td>\n<td>flag</td>\n<td>å¯¹ compaction ç±»å‹çš„æ—¶é—´åºåˆ—ï¼Œè¿”å›æœ€æ–°ï¼ˆå¯èƒ½éƒ¨åˆ†ï¼‰çš„æ¡¶çš„èšåˆå€¼</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>FILTER_BY_TS ts...</code></td>\n<td>list of integers</td>\n<td>åªè¿”å›æŒ‡å®šæ—¶é—´æˆ³çš„æ ·æœ¬</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>FILTER_BY_VALUE min max</code></td>\n<td>range</td>\n<td>åªè¿”å›å€¼åœ¨ <code>[min, max]</code> åŒºé—´çš„æ ·æœ¬</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>WITHLABELS</code></td>\n<td>flag</td>\n<td>è¿”å›æ ·æœ¬çš„åŒæ—¶é™„å¸¦æ—¶é—´åºåˆ—çš„æ‰€æœ‰æ ‡ç­¾</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>&lt;SELECTED_LABELS label...&gt;</code></td>\n<td>list</td>\n<td>è¿”å›æ ·æœ¬æ—¶åªé™„å¸¦æŒ‡å®šæ ‡ç­¾</td>\n<td>å¯é€‰ï¼Œä¸èƒ½ä¸ <code>WITHLABELS</code> ä¸€èµ·ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><code>COUNT count</code></td>\n<td>integer</td>\n<td>é™åˆ¶è¿”å›çš„æ ·æœ¬æ•°é‡ï¼ˆæœ€å¤š <code>count</code> ä¸ªï¼‰</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>ALIGN align</code></td>\n<td>string</td>\n<td>å¯¹é½èšåˆæ¡¶çš„æ—¶é—´æˆ³ï¼ˆå¦‚ <code>start</code>ã€<code>end</code> æˆ–è‡ªå®šä¹‰æ—¶é—´æˆ³ï¼‰</td>\n<td>å¯é€‰ï¼Œéœ€ä¸ <code>AGGREGATION</code> ä¸€èµ·ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><code>AGGREGATION aggregator bucketDuration</code></td>\n<td>aggregation</td>\n<td>å¯¹æ•°æ®è¿›è¡Œèšåˆè®¡ç®—ï¼Œ<code>aggregator</code> ä¸ºèšåˆå‡½æ•°ï¼ˆå¦‚ <code>avg</code>, <code>sum</code>, <code>min</code>, <code>max</code> ç­‰ï¼‰ï¼Œ<code>bucketDuration</code> ä¸ºæ¡¶çš„æ—¶é•¿</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>BUCKETTIMESTAMP bt</code></td>\n<td>string</td>\n<td>èšåˆæ¡¶æ—¶é—´æˆ³é€‰æ‹©ï¼Œ<code>bt</code> å¯ä¸º <code>start</code> æˆ– <code>end</code></td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>EMPTY</code></td>\n<td>flag</td>\n<td>å³ä½¿æ¡¶ä¸ºç©ºä¹Ÿè¿”å›ç»“æœ</td>\n<td>å¯é€‰</td>\n</tr>\n<tr>\n<td><code>FILTER filterExpr...</code></td>\n<td>list of expressions</td>\n<td>è¿‡æ»¤æ—¶é—´åºåˆ—ï¼Œæ ¹æ®æ ‡ç­¾åŒ¹é…è§„åˆ™ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„åºåˆ—</td>\n<td>å¿…é€‰</td>\n</tr>\n<tr>\n<td><code>GROUPBY label REDUCE reducer</code></td>\n<td>aggregation</td>\n<td>å¯¹è¿”å›ç»“æœæŒ‰æŒ‡å®šæ ‡ç­¾åˆ†ç»„å¹¶åº”ç”¨ reducer èšåˆå‡½æ•°ï¼ˆå¦‚ <code>SUM</code>, <code>MIN</code>, <code>MAX</code> ç­‰ï¼‰</td>\n<td>å¯é€‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.MRANGE - + FILTER metric=cpu</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;ts:cpu:server1&quot;</span></span><br><span class=\"line\">   2) (empty array)</span><br><span class=\"line\">   3) 1) 1) (<span class=\"built_in\">integer</span>) 1767777655255</span><br><span class=\"line\">         2) 80.5</span><br><span class=\"line\">      2) 1) (<span class=\"built_in\">integer</span>) 1767777807933</span><br><span class=\"line\">         2) 70.5</span><br><span class=\"line\">      3) 1) (<span class=\"built_in\">integer</span>) 1767777873866</span><br><span class=\"line\">         2) 80.5</span><br><span class=\"line\">      4) 1) (<span class=\"built_in\">integer</span>) 1767777965870</span><br><span class=\"line\">         2) 80.5</span><br><span class=\"line\">      5) 1) (<span class=\"built_in\">integer</span>) 1767778300909</span><br><span class=\"line\">         2) 90.5</span><br><span class=\"line\">      6) 1) (<span class=\"built_in\">integer</span>) 1767778308125</span><br><span class=\"line\">         2) 105.5</span><br><span class=\"line\">      7) 1) (<span class=\"built_in\">integer</span>) 1767778308126</span><br><span class=\"line\">         2) 115.5</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;ts:cpu:server2&quot;</span></span><br><span class=\"line\">   2) (empty array)</span><br><span class=\"line\">   3) 1) 1) (<span class=\"built_in\">integer</span>) 1767777965870</span><br><span class=\"line\">         2) 90.5</span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;ts:cpu:server3&quot;</span></span><br><span class=\"line\">   2) (empty array)</span><br><span class=\"line\">   3) 1) 1) (<span class=\"built_in\">integer</span>) 1767777965870</span><br><span class=\"line\">         2) 70.5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‰æ ‡ç­¾èšåˆ</span></span><br><span class=\"line\">TS.MRANGE - +</span><br><span class=\"line\">    AGGREGATION avg 1000</span><br><span class=\"line\">    FILTER metric=cpu</span><br><span class=\"line\">    GROUPBY host REDUCE avg</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;host=server1&quot;</span></span><br><span class=\"line\">   2) (empty array)</span><br><span class=\"line\">   3) 1) 1) (<span class=\"built_in\">integer</span>) 1767777655000</span><br><span class=\"line\">         2) 80.5</span><br><span class=\"line\">      2) 1) (<span class=\"built_in\">integer</span>) 1767777807000</span><br><span class=\"line\">         2) 70.5</span><br><span class=\"line\">      3) 1) (<span class=\"built_in\">integer</span>) 1767777873000</span><br><span class=\"line\">         2) 80.5</span><br><span class=\"line\">      4) 1) (<span class=\"built_in\">integer</span>) 1767777965000</span><br><span class=\"line\">         2) 80.5</span><br><span class=\"line\">      5) 1) (<span class=\"built_in\">integer</span>) 1767778300000</span><br><span class=\"line\">         2) 90.5</span><br><span class=\"line\">      6) 1) (<span class=\"built_in\">integer</span>) 1767778308000</span><br><span class=\"line\">         2) 110.5</span><br></pre></td></tr></table></figure>\n<h4 id=\"3ï¸âƒ£-TS-MREVRANGE-æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œé€†åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®\">3ï¸âƒ£ TS.MREVRANGE : æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œé€†åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ®</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ TS.MRANGE ç±»ä¼¼ï¼Œåªæ˜¯æŸ¥è¯¢ç»“æœæ˜¯é€†åºçš„</p>\n</li>\n</ul>\n<h4 id=\"4ï¸âƒ£-TS-QUERYINDEX-æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè¿”å›åŒ¹é…çš„æ—¶é—´åºåˆ—-key-åˆ—è¡¨\">4ï¸âƒ£ TS.QUERYINDEX : æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè¿”å›åŒ¹é…çš„æ—¶é—´åºåˆ— key åˆ—è¡¨</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">S.QUERYINDEX filterExpr...</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.QUERYINDEX metric=cpu host=server1</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) <span class=\"string\">&quot;ts:cpu:server1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;ts:cpu:server2&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;ts:cpu:server3&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"äº”ã€æ•°æ®åˆ é™¤ä¸ç»´æŠ¤ç±»\">äº”ã€æ•°æ®åˆ é™¤ä¸ç»´æŠ¤ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>TS.DEL</strong></td>\n<td>åˆ é™¤æŸä¸ªæ—¶é—´åºåˆ—åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ ·æœ¬</td>\n<td>æ¸…ç†å¼‚å¸¸æ•°æ®ã€å†å²æ•°æ®ä¿®æ­£</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.DEL key fromTimestamp toTimestamp</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.DEL ts:cpu:server1 0 1767777965870</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4 <span class=\"comment\"># åˆ é™¤äº† 4 ä¸ªæ ·æœ¬</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å…­ã€å…ƒæ•°æ®ä¸çŠ¶æ€æŸ¥è¯¢ç±»\">å…­ã€å…ƒæ•°æ®ä¸çŠ¶æ€æŸ¥è¯¢ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><a href=\"http://TS.INFO\">TS.INFO</a></strong></td>\n<td>è¿”å›æ—¶é—´åºåˆ—çš„å…ƒä¿¡æ¯ä¸ç»Ÿè®¡ä¿¡æ¯</td>\n<td>æ’æŸ¥é—®é¢˜ã€å®¹é‡è¯„ä¼°ã€ç›‘æ§çŠ¶æ€</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.INFO key [DEBUG]</span><br><span class=\"line\"><span class=\"comment\"># DEBUG: æ˜¾ç¤ºæ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TS.INFO ts:cpu:server1</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) totalSamples</span><br><span class=\"line\"> 2) (<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\"> 3) memoryUsage</span><br><span class=\"line\"> 4) (<span class=\"built_in\">integer</span>) 9184</span><br><span class=\"line\"> 5) firstTimestamp</span><br><span class=\"line\"> 6) (<span class=\"built_in\">integer</span>) 1767778300909</span><br><span class=\"line\"> 7) lastTimestamp</span><br><span class=\"line\"> 8) (<span class=\"built_in\">integer</span>) 1767778308126</span><br><span class=\"line\"> 9) retentionTime</span><br><span class=\"line\">10) (<span class=\"built_in\">integer</span>) 7200000</span><br><span class=\"line\">11) chunkCount</span><br><span class=\"line\">12) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">13) chunkSize</span><br><span class=\"line\">14) (<span class=\"built_in\">integer</span>) 8192</span><br><span class=\"line\">15) chunkType</span><br><span class=\"line\">16) compressed</span><br><span class=\"line\">17) duplicatePolicy</span><br><span class=\"line\">18) last</span><br><span class=\"line\">19) labels</span><br><span class=\"line\">20) 1) 1) <span class=\"string\">&quot;host&quot;</span></span><br><span class=\"line\">       2) <span class=\"string\">&quot;server1&quot;</span></span><br><span class=\"line\">    2) 1) <span class=\"string\">&quot;metric&quot;</span></span><br><span class=\"line\">       2) <span class=\"string\">&quot;cpu&quot;</span></span><br><span class=\"line\">    3) 1) <span class=\"string\">&quot;env&quot;</span></span><br><span class=\"line\">       2) <span class=\"string\">&quot;prod&quot;</span></span><br><span class=\"line\">21) sourceKey</span><br><span class=\"line\">22) (nil)</span><br><span class=\"line\">23) rules</span><br><span class=\"line\">24) (empty array)</span><br><span class=\"line\">25) ignoreMaxTimeDiff</span><br><span class=\"line\">26) (<span class=\"built_in\">integer</span>) 1000</span><br><span class=\"line\">27) ignoreMaxValDiff</span><br><span class=\"line\">28) <span class=\"string\">&quot;0.1&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"çœŸå®æ¡ˆä¾‹\">çœŸå®æ¡ˆä¾‹</h2>\n<h3 id=\"åœºæ™¯è¯´æ˜\">åœºæ™¯è¯´æ˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª IoT è®¾å¤‡ç›‘æ§ç³»ç»Ÿï¼Œæ¯å°è®¾å¤‡æ¯åˆ†é’Ÿä¼šä¸ŠæŠ¥ä¸€æ¬¡æ¸©åº¦å’Œæ¹¿åº¦æ•°æ®ã€‚æˆ‘ä»¬å¸Œæœ›ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å­˜å‚¨æ¯å°è®¾å¤‡çš„æ—¶é—´åºåˆ—æ•°æ®ã€‚</li>\n<li class=\"lvl-6\">æŸ¥è¯¢æœ€è¿‘ä¸€å°æ—¶çš„æ•°æ®ã€‚</li>\n<li class=\"lvl-6\">ç»Ÿè®¡æ¯ 5 åˆ†é’Ÿçš„å¹³å‡æ¸©åº¦å’Œæ¹¿åº¦ã€‚</li>\n<li class=\"lvl-6\">è·å–æœ€æ–°çš„æ¸©åº¦å€¼ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"æ­¥éª¤\">æ­¥éª¤</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol>\n<li class=\"lvl-5\">åˆ›å»ºæ—¶é—´åºåˆ—</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè®¾å¤‡ device:1001 çš„æ¸©åº¦æ—¶é—´åºåˆ—</span></span><br><span class=\"line\">TS.CREATE device:1001:temperature RETENTION 86400000 LABELS device_id 1001 <span class=\"built_in\">type</span> temperature</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè®¾å¤‡ device:1001 çš„æ¹¿åº¦æ—¶é—´åºåˆ—</span></span><br><span class=\"line\">TS.CREATE device:1001:humidity RETENTION 86400000 LABELS device_id 1001 <span class=\"built_in\">type</span> humidity</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜ï¼š</span></span><br><span class=\"line\">    <span class=\"comment\"># RETENTION 86400000ï¼šæ•°æ®ä¿ç•™ 24 å°æ—¶ï¼ˆå•ä½æ¯«ç§’ï¼‰ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\"># LABELSï¼šæ–¹ä¾¿åç»­æŒ‰æ ‡ç­¾èšåˆæŸ¥è¯¢ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\"># TS.CREATE ç”¨äºåˆ›å»ºæ—¶é—´åºåˆ— keyã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"2\">\n<li class=\"lvl-5\">æ’å…¥æ•°æ®</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡è®¾æ—¶é—´æˆ³ä¸ºå½“å‰æ¯«ç§’</span></span><br><span class=\"line\">TS.ADD device:1001:temperature * 26.5</span><br><span class=\"line\">TS.ADD device:1001:humidity * 60.2</span><br><span class=\"line\"><span class=\"comment\"># æ­¤å¤„å‡è®¾ä¼šæ¯åˆ†é’Ÿæ’å…¥ä¸€æ¬¡æ•°æ®</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"3\">\n<li class=\"lvl-5\">æŸ¥è¯¢æ—¶é—´èŒƒå›´æ•°æ®</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å– è¿‡å»ä¸€å°æ—¶çš„æ¸©åº¦æ•°æ®ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># è¿‡å»ä¸€å°æ—¶çš„æ—¶é—´æˆ³å¯ä»¥è¿™æ ·è·å¾—</span></span><br><span class=\"line\">EVAL <span class=\"string\">&quot;return redis.call(&#x27;TIME&#x27;)[1]*1000 - 3600000&quot;</span> 0</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1767777794000</span><br><span class=\"line\"></span><br><span class=\"line\">TS.RANGE device:1001:temperature 1767777794000 +</span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜</span></span><br><span class=\"line\">    <span class=\"comment\"># -3600000 è¡¨ç¤ºä¸€å°æ—¶å‰ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\"># + è¡¨ç¤ºåˆ°ç°åœ¨ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›ç»“æœä¸º [timestamp, value] æ•°ç»„ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) 1) (<span class=\"built_in\">integer</span>) 1767781256846</span><br><span class=\"line\">   2) 26.5</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"4\">\n<li class=\"lvl-5\">èšåˆæŸ¥è¯¢ï¼ˆDownsamplingï¼‰</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç»Ÿè®¡ æ¯ 5 åˆ†é’Ÿå¹³å‡æ¸©åº¦ï¼š</span></span><br><span class=\"line\">TS.RANGE device:1001:temperature 1767777794000 + AGGREGATION avg 300000</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\">    <span class=\"comment\"># AGGREGATION avg 300000 è¡¨ç¤ºæ¯ 300,000 msï¼ˆ5 åˆ†é’Ÿï¼‰èšåˆä¸€æ¬¡ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\"># RedisTimeSeries æ”¯æŒå¤šç§èšåˆå‡½æ•°ï¼šavg, sum, min, max, countã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"5\">\n<li class=\"lvl-5\">è·å–æœ€æ–°å€¼</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–æœ€æ–°çš„æ¸©åº¦å€¼ï¼š</span></span><br><span class=\"line\">TS.GET device:1001:temperature</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜</span></span><br><span class=\"line\">    <span class=\"comment\"># TS.GET ä¼šè¿”å›æœ€æ–°ä¸€ä¸ªæ•°æ®ç‚¹ [timestamp, value]ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\"># å¦‚æœä½¿ç”¨äº†å‹ç¼©ç­–ç•¥ LATESTï¼Œè¿”å›çš„å€¼å¯èƒ½æ˜¯å½“å‰èšåˆæ¡¶çš„å€¼ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"6\">\n<li class=\"lvl-5\">æŒ‰æ ‡ç­¾æŸ¥è¯¢</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœæˆ‘ä»¬æƒ³è·å– æ‰€æœ‰è®¾å¤‡çš„æ¸©åº¦å¹³å‡å€¼ï¼ˆå‡è®¾æœ‰å¾ˆå¤šè®¾å¤‡ï¼‰ï¼š</span></span><br><span class=\"line\">TS.MRANGE - + AGGREGATION avg 300000 FILTER <span class=\"built_in\">type</span>=temperature</span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜ï¼š</span></span><br><span class=\"line\">    <span class=\"comment\"># TS.MRANGE æ”¯æŒå¤š key æŸ¥è¯¢ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰æ ‡ç­¾è¿‡æ»¤ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\"># èšåˆå‡½æ•°å¯ä»¥å¯¹æ¯ä¸ªåŒ¹é… key å•ç‹¬è®¡ç®—ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;device:1001:temperature&quot;</span></span><br><span class=\"line\">   2) (empty array)</span><br><span class=\"line\">   3) 1) 1) (<span class=\"built_in\">integer</span>) 1767781200000</span><br><span class=\"line\">         2) 26.5</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisTimeSeries ä¸­ TimeSeries æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisTimeSeries çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³• TimeSeries ç®€ä»‹ TimeSeries æ˜¯ Redis çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œç”¨äºå¤„ç†æ—¶é—´åºåˆ—æ•°æ®ï¼ŒRedisTimeSeries | A NoSQL Time Series Database æ ¸å¿ƒè®¾è®¡ä¸æ•°æ®æ¨¡å‹ ä¸€ä¸ª Redis æ—¶é—´åºåˆ—ï¼ˆTime Seriesï¼‰ æ˜¯æœ‰åºçš„ä¸€ç³»åˆ—é‡‡æ ·æ•°æ®ç‚¹ï¼š ç»„æˆéƒ¨åˆ† è¯´æ˜ æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ æ¯«ç§’çº§æ—¶é—´æ ‡ç­¾ï¼Œå¯å®¢æˆ·ç«¯æŒ‡å®šæˆ–ç”±æœåŠ¡å™¨å¡«å…… å€¼ï¼ˆvalueï¼‰ 64 ä½æµ®ç‚¹æ•° å…ƒæ•°æ®ï¼ˆlabelsï¼‰ ä¸€ç»„é”®å€¼å¯¹ï¼Œå¯ç”¨äºè¿‡æ»¤ä¸èšåˆæŸ¥è¯¢ ä¿ç•™ç­–ç•¥ï¼ˆretentionï¼‰ æ•°æ®ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ï¼Œè¿‡æœŸè‡ªåŠ¨ä¸¢å¼ƒ ä¸»è¦åŠŸèƒ½ä¸ç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ é«˜ååå†™å…¥ æ”¯æŒæ¯ç§’æ¥æ”¶å¤§é‡æ•°æ®ç‚¹ï¼Œå»¶è¿Ÿæä½ åŒºé—´æŸ¥è¯¢ å¯æŒ‰æ—¶é—´èŒƒå›´æ£€ç´¢æ•°æ®ï¼Œå¦‚ TS.RANGE / TS.MRANGE èšåˆæŸ¥è¯¢ å†…å»º minã€maxã€avgã€sumã€countã€firstã€last ç­‰èšåˆåŠŸèƒ½ è‡ªåŠ¨ä¸‹é‡‡æ · &amp; ç´¯ç§¯è§„åˆ™ é€šè¿‡ aggregation rules è‡ªåŠ¨ç”Ÿæˆæ›´ç²—ç²’åº¦æŒ‡æ ‡ ä¿ç•™ç­–ç•¥ï¼ˆRetentionï¼‰ è®¾ç½®æœ€å¤§ä¿å­˜æ—¶é—´æˆ–æ ·æœ¬æ•°é‡ æ ‡ç­¾ç´¢å¼•ï¼ˆLabelsï¼‰ æ”¯æŒåŸºäºæ ‡ç­¾çš„è·¨åºåˆ—æŸ¥è¯¢ é«˜æ•ˆå­˜å‚¨ ä½¿ç”¨å‹ç¼©ä¸å†…å­˜ç»“æ„ä¼˜åŒ–ç©ºé—´æˆæœ¬ å·¥å…·æ•´åˆ æ”¯æŒ Grafanaã€Prometheusã€Telegraf ç­‰ç”Ÿæ€é›†æˆ åº”ç”¨åœºæ™¯ åœºæ™¯ æè¿° ç‰©è”ç½‘ï¼ˆIoTï¼‰ç›‘æ§ æ¸©åº¦ã€æ¹¿åº¦ã€è®¾å¤‡çŠ¶æ€ç­‰ ç³»ç»Ÿç›‘æ§ä¸æŒ‡æ ‡æ”¶é›† CPUã€å†…å­˜ã€ç½‘ç»œæŒ‡æ ‡çš„å®æ—¶å­˜å‚¨ä¸åˆ†æ ä¸šåŠ¡æŒ‡æ ‡åˆ†æ æ¯æ—¥/æ¯å°æ—¶æ´»è·ƒç”¨æˆ·æ•°é‡ã€è¯·æ±‚å»¶è¿Ÿç­‰ é‡‘èæ—¶é—´åºåˆ— è‚¡ç¥¨ä»·æ ¼ã€äº¤æ˜“é‡çš„å¿«é€Ÿå†™å…¥å’Œåˆ†æ å®æ—¶å‘Šè­¦ æ•°æ®è¶Šç•Œæ—¶è§¦å‘å‘Šè­¦é€»è¾‘ TimeSeries å‘½ä»¤è¯´æ˜ æŒ‰â€œç”Ÿå‘½å‘¨æœŸâ€è§†è§’çš„å¿«é€Ÿç´¢å¼• é˜¶æ®µ å¯¹åº”å‘½ä»¤ åˆ›å»º TS.CREATE ä¿®æ”¹ç»“æ„ TS.ALTER å»ºç«‹èšåˆ TS.CREATERULE / TS.DELETERULE å†™å…¥ TS.ADD / TS.MADD / TS.INCRBY / TS.DECRBY æŸ¥è¯¢å•åºåˆ— TS.GET / TS.RANGE / TS.REVRANGE æŸ¥è¯¢å¤šåºåˆ— TS.MGET / TS.MRANGE / TS.MREVRANGE / TS.QUERYINDEX æ¸…ç†æ•°æ® TS.DEL æŸ¥çœ‹çŠ¶æ€ TS.INFO ä¸€ã€æ—¶é—´åºåˆ—åˆ›å»ºä¸ç»“æ„ç®¡ç†ç±» å‘½ä»¤ åŠŸèƒ½è¯´æ˜ å…¸å‹ä½¿ç”¨åœºæ™¯ TS.CREATE åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¶é—´åºåˆ—ï¼ˆå¯æŒ‡å®šä¿ç•™ç­–ç•¥ã€æ ‡ç­¾ã€chunk å¤§å°ç­‰ï¼‰ åˆå§‹åŒ–æŒ‡æ ‡ï¼Œå¦‚åˆ›å»º CPUã€QPSã€å»¶è¿Ÿç­‰æŒ‡æ ‡åºåˆ— TS.ALTER ä¿®æ”¹å·²æœ‰æ—¶é—´åºåˆ—çš„é…ç½®ï¼ˆretentionã€chunk sizeã€duplicate policyã€labelsï¼‰ åŠ¨æ€è°ƒæ•´æ•°æ®ä¿ç•™å‘¨æœŸã€æ ‡ç­¾ä¿¡æ¯ TS.CREATERULE åˆ›å»ºå‹ç¼© / èšåˆè§„åˆ™ï¼ˆä» source series è‡ªåŠ¨èšåˆåˆ° dest seriesï¼‰ åŸå§‹æ•°æ® â†’ æŒ‰åˆ†é’Ÿ / å°æ—¶èšåˆ TS.DELETERULE åˆ é™¤å·²æœ‰çš„å‹ç¼© / èšåˆè§„åˆ™ åœæ­¢æŸæ¡è‡ªåŠ¨èšåˆè§„åˆ™ 1ï¸âƒ£ TS.CREATE : åˆ›å»ºæ—¶é—´åºåˆ— è¯­æ³•ï¼š 1234567TS.CREATE key [RETENTION retentionPeriod] [ENCODING &lt;COMPRESSED|UNCOMPRESSED&gt;] [CHUNK_SIZE size] [DUPLICATE_POLICY policy] [IGNORE ignoreMaxTimediff ignoreMaxValDiff] [LABELS [label value ...]] å‚æ•°è¯´æ˜ï¼š å‚æ•° ä½œç”¨ å¯é€‰å€¼ / çº¦æŸ é»˜è®¤å€¼ å…¸å‹ä½¿ç”¨å»ºè®® key æ—¶é—´åºåˆ—çš„ Redis Key ä»»æ„åˆæ³• Redis key æ—  å»ºè®®åŒ…å«ä¸šåŠ¡è¯­ä¹‰ï¼Œå¦‚ ts:cpu:node1 RETENTION æ•°æ®ä¿ç•™æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…è¿‡è‡ªåŠ¨åˆ é™¤ â‰¥ 0ï¼Œ0 è¡¨ç¤ºæ°¸ä¹…ä¿ç•™ 0 é«˜é¢‘æŒ‡æ ‡å¿…é¡»è®¾ç½®ï¼Œé¿å…å†…å­˜æ— é™å¢é•¿ ENCODING æ•°æ®å­˜å‚¨ç¼–ç æ–¹å¼ COMPRESSED: å†…å­˜å ç”¨ä½ï¼ŒCPU æœ‰è½»å¾®å¼€é”€ UNCOMPRESSED:æŸ¥è¯¢å¿«ï¼Œå ç”¨å†…å­˜é«˜ COMPRESSED ç»å¤§å¤šæ•°åœºæ™¯ä¿æŒé»˜è®¤ CHUNK_SIZE æ¯ä¸ªæ•°æ®å—çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œå½±å“å†…å­˜ç¢ç‰‡ä¸å‹ç¼©æ•ˆç‡ â‰¥ 128 bytesï¼ˆé€šå¸¸ 1KBâ€“64KBï¼‰ 4096 å†™å…¥é¢‘ç¹æ—¶é€‚å½“è°ƒå¤§ DUPLICATE_POLICY åŒä¸€ timestamp é‡å¤å†™å…¥æ—¶çš„å¤„ç†ç­–ç•¥ è§ä¸‹è¡¨ å…¨å±€é…ç½® æ˜ç¡®æŒ‡å®šï¼Œé¿å…é»˜è®¤è¡Œä¸ºå˜åŒ– IGNORE å¿½ç•¥ä¸ä¸Šä¸€ç‚¹å·®å¼‚è¿‡å°çš„æ•°æ® ignoreMaxTimediff: æœ€å¤§å…è®¸æ—¶é—´å·®ï¼ˆæ¯«ç§’ï¼‰ ignoreMaxValDiff: æœ€å¤§å…è®¸çš„æ•°å€¼å·® å…³é—­ ç”¨äºé™å™ªå’Œé™é‡‡æ · ç¤ºä¾‹ï¼šIGNORE 1000 0.01ï¼š 1 ç§’å†…ï¼Œå˜åŒ–å°äº 0.01 çš„æ•°æ®å°†è¢«å¿½ç•¥ LABELS æ ‡ç­¾é”®å€¼å¯¹ï¼Œç”¨äºç´¢å¼•å’Œè¿‡æ»¤ ä»»æ„å­—ç¬¦ä¸²å¯¹LABELS key1 value1 key2 value2 ... æ—  å¼ºçƒˆå»ºè®®ç”¨äºæŸ¥è¯¢ DUPLICATE_POLICYï¼ˆé‡å¤æ—¶é—´æˆ³ç­–ç•¥ï¼‰ å½“åŒä¸€ä¸ª timestamp è¢«å¤šæ¬¡å†™å…¥æ—¶ç”Ÿæ•ˆ ç­–ç•¥ å¤„ç†é€»è¾‘ BLOCK é»˜è®¤ï¼Œé‡å¤æ—¶é—´æˆ³ç›´æ¥å¤±è´¥ FIRST ä¿ç•™å·²æœ‰å€¼ï¼Œå¿½ç•¥æ–°å€¼ LAST è¦†ç›–å·²æœ‰å€¼ï¼Œç”¨æ–°å€¼æ›¿ä»£ MIN ä»…å½“æ–°å€¼æ›´å°æ‰è¦†ç›– MAX ä»…å½“æ–°å€¼æ›´å¤§æ‰è¦†ç›– SUM ç´¯åŠ å€¼ï¼ˆå·²æœ‰å€¼ + æ–°å€¼ï¼‰ ç¤ºä¾‹: åˆ›å»ºä¸€ä¸ª CPU æŒ‡æ ‡æ—¶é—´åºåˆ—ï¼Œè‡ªåŠ¨è¿‡æœŸ 1 å°æ—¶ä¹‹å‰çš„æ•°æ® 1234567891011TS.CREATE ts:cpu:server1 RETENTION 3600000 ENCODING COMPRESSED CHUNK_SIZE 8192 DUPLICATE_POLICY LAST IGNORE 1000 0.1 LABELS host server1 metric cpu# æŸ¥çœ‹æ•°æ®ç±»å‹127.0.0.1:6379&gt; type ts:cpu:server1TSDB-TYPE 2ï¸âƒ£ TS.ALTER : ä¿®æ”¹æ—¶é—´åºåˆ—é…ç½® è¯­æ³•ï¼š 12345TS.ALTER key [RETENTION retentionPeriod] [CHUNK_SIZE size] [DUPLICATE_POLICY policy] [LABELS [label value ...]] ç¤ºä¾‹ï¼šä¿®æ”¹ä¿ç•™å‘¨æœŸå’Œæ ‡ç­¾ 123TS.ALTER ts:cpu:server1 RETENTION 7200000 LABELS host server1 metric cpu env prod 3ï¸âƒ£ TS.CREATERULE : åˆ›å»ºè‡ªåŠ¨èšåˆè§„åˆ™ åœºæ™¯è¯´æ˜ åŸå§‹åºåˆ—ï¼šts:cpu:server1ï¼ˆç§’çº§æ•°æ®ï¼‰ èšåˆç›®æ ‡ï¼šts:cpu:server1:avg1mï¼ˆæŒ‰ 1 åˆ†é’Ÿå¹³å‡å€¼èšåˆï¼‰ è¯­æ³•ï¼š 123TS.CREATERULE sourceKey destKey AGGREGATION aggregator bucketDuration [alignTimestamp] å‚æ•°è¯´æ˜ å‚æ•° ä½œç”¨ å¯é€‰å€¼ / çº¦æŸ æ˜¯å¦å¿…å¡« è¡Œä¸ºè¯´æ˜ ä½¿ç”¨æ³¨æ„äº‹é¡¹ sourceKey æºæ—¶é—´åºåˆ— Key å¿…é¡»æ˜¯å·²å­˜åœ¨çš„ TS key æ˜¯ æ–°å†™å…¥æ•°æ®ä»è¯¥åºåˆ—è§¦å‘èšåˆ å¿…é¡»å…ˆåˆ›å»º destKey ç›®æ ‡èšåˆæ—¶é—´åºåˆ— Key å¿…é¡»æ˜¯å·²å­˜åœ¨çš„ TS key æ˜¯ èšåˆç»“æœå†™å…¥è¯¥åºåˆ— é€šå¸¸ retention æ›´é•¿ aggregator èšåˆå‡½æ•° è§ä¸‹è¡¨ æ˜¯ å®šä¹‰æ¯ä¸ª bucket å†…å¦‚ä½•è®¡ç®— ä¸åŒå‡½æ•°è®¡ç®—æˆæœ¬ä¸åŒ bucketDuration èšåˆæ—¶é—´æ¡¶å®½åº¦ï¼ˆæ¯«ç§’ï¼‰ &gt; 0 æ˜¯ æ§åˆ¶èšåˆç²’åº¦ å†³å®šæ•°æ®é™é‡‡æ ·ç¨‹åº¦ alignTimestamp å¯¹é½æ—¶é—´æˆ³åŸºå‡† æ¯«ç§’æ—¶é—´æˆ³ å¦ æ§åˆ¶ bucket èµ·å§‹å¯¹é½æ–¹å¼ è·¨ç³»ç»Ÿå¯¹é½æ—¶éå¸¸é‡è¦ aggregatorï¼ˆèšåˆå‡½æ•°ï¼‰ èšåˆå™¨ è¯´æ˜ AVG å¹³å‡å€¼ SUM æ±‚å’Œ MIN æœ€å°å€¼ MAX æœ€å¤§å€¼ COUNT æ ·æœ¬æ•°é‡ FIRST ç¬¬ä¸€ä¸ªæ ·æœ¬ LAST æœ€åä¸€ä¸ªæ ·æœ¬ RANGE MAX - MIN STD.P æ€»ä½“æ ‡å‡†å·® STD.S æ ·æœ¬æ ‡å‡†å·® VAR.P æ€»ä½“æ–¹å·® VAR.S æ ·æœ¬æ–¹å·® alignTimestampï¼ˆå¯¹é½æ—¶é—´æˆ³åŸºå‡†ï¼‰ ç±»å‹ ç¤ºä¾‹å€¼ å«ä¹‰ 0ï¼ˆUnix Epochï¼‰ï¼ˆæ¨èåšæ³•ï¼‰ 0 ä» 1970-01-01 00:00:00 UTC å¯¹é½ ä»»æ„å›ºå®šæ—¶é—´æˆ³ 1700000000000 ä»æŒ‡å®šæ—¶é—´ç‚¹å¯¹é½ å½“å‰æ—¶é—´æˆ³ $(date +%s%3N) ä»åˆ›å»ºè§„åˆ™æ—¶åˆ»å¯¹é½ ä¸šåŠ¡æ—¶é—´è¾¹ç•Œ æŸå¤© 00:00 çš„æ¯«ç§’å€¼ å¯¹é½åˆ°ä¸šåŠ¡å‘¨æœŸ ä¸æŒ‡å®š ï¼ˆå‚æ•°çœç•¥ï¼‰ è‡ªåŠ¨ä½¿ç”¨é¦–æ¡å†™å…¥æ—¶é—´ ç¤ºä¾‹: æ¯ 60,000msï¼ˆ1åˆ†é’Ÿï¼‰åšä¸€æ¬¡å¹³å‡èšåˆ 1234567891011121314151617181920# 1.åˆ›å»ºç›®æ ‡èšåˆåºåˆ—TS.CREATE ts:cpu:server1:avg1m RETENTION 86400000 LABELS host server1 metric cpu_1m# 2.åˆ›å»ºè‡ªåŠ¨èšåˆè§„åˆ™TS.CREATERULE ts:cpu:server1 ts:cpu:server1:avg1m AGGREGATION AVG 60000## å¦‚æœæœªè®¾ç½® alignTimestampï¼Œåˆ™ä»¥åˆ›å»ºçš„ç¬¬ä¸€æ¡è®°å½•çš„æ—¶é—´ä¸ºåŸºå‡†## æ¯”å¦‚ç¬¬ä¸€æ¡è®°å½•çš„æ—¶é—´ä¸ºï¼š12:00:23## bucket ä¼šå¯¹é½åˆ°: # 12:00:23 ~ 12:01:23 # 12:01:23 ~ 12:02:23# æŒ‡å®š alignTimestamp å¯¹é½åˆ°æ•´åˆ†é’ŸTS.CREATERULE ts:cpu:server1 ts:cpu:server1:avg1m AGGREGATION AVG 60000 0## bucket ä¼šä¸¥æ ¼å¯¹é½: # 12:00:00 ~ 12:01:00 # 12:01:00 ~ 12:02:00 4ï¸âƒ£ TS.DELETERULE : åˆ é™¤è‡ªåŠ¨èšåˆè§„åˆ™ è¯­æ³•ï¼š 1TS.DELETERULE sourceKey destKey ç¤ºä¾‹ï¼šåˆ é™¤è‡ªåŠ¨èšåˆè§„åˆ™ 1TS.DELETERULE ts:cpu:server1 ts:cpu:server1:avg1m äºŒã€æ•°æ®å†™å…¥ä¸æ›´æ–°ç±» å‘½ä»¤ åŠŸèƒ½è¯´æ˜ å…¸å‹ä½¿ç”¨åœºæ™¯ TS.ADD å‘æ—¶é—´åºåˆ—è¿½åŠ ä¸€ä¸ªæ ·æœ¬ç‚¹ï¼ˆtimestamp, valueï¼‰ å®æ—¶å†™å…¥ç›‘æ§æ•°æ® TS.MADD æ‰¹é‡å‘å¤šä¸ªæ—¶é—´åºåˆ—è¿½åŠ æ ·æœ¬ é«˜åååœºæ™¯ï¼Œå‡å°‘ç½‘ç»œ RTT TS.INCRBY å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå¢ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰ è®¡æ•°å™¨ã€ç´¯è®¡æŒ‡æ ‡ TS.DECRBY å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå‡ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰ åº“å­˜ã€ä½™é¢ç±»é€’å‡æŒ‡æ ‡ 1ï¸âƒ£ TS.ADD : å‘æ—¶é—´åºåˆ—è¿½åŠ ä¸€ä¸ªæ ·æœ¬ç‚¹ è¯­æ³•ï¼š 12345678TS.ADD key timestamp value [RETENTION retentionPeriod] [ENCODING &lt;COMPRESSED|UNCOMPRESSED&gt;] [CHUNK_SIZE size] [DUPLICATE_POLICY policy] [ON_DUPLICATE policy_ovr] [IGNORE ignoreMaxTimediff ignoreMaxValDiff] [LABELS [label value ...]] å¦‚æœ key ä¸å­˜åœ¨ï¼ŒTS.ADD ä¼š éšå¼åˆ›å»ºæ—¶é—´åºåˆ—ï¼ˆç±»ä¼¼ TS.CREATEï¼‰ã€‚ å‚æ•°è¯´æ˜ å‚æ•° ä½œç”¨ å¯é€‰å€¼ / çº¦æŸ æ˜¯å¦è¦†ç›–å·²æœ‰é…ç½® ç”Ÿæ•ˆèŒƒå›´ ä½¿ç”¨æ³¨æ„äº‹é¡¹ key æ—¶é—´åºåˆ— Key åˆæ³• Redis key â€” â€” ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º timestamp æ ·æœ¬æ—¶é—´æˆ³ æ¯«ç§’æ•´æ•° / * â€” å½“å‰å†™å…¥ * è¡¨ç¤ºæœåŠ¡å™¨å½“å‰æ—¶é—´ value æ ·æœ¬å€¼ æµ®ç‚¹æ•° â€” å½“å‰å†™å…¥ NaN / Inf ä¸å…è®¸ RETENTION è®¾ç½®ä¿ç•™å‘¨æœŸ â‰¥ 0ï¼ˆæ¯«ç§’ï¼‰ ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ å·²å­˜åœ¨ key ä¸ä¼šè¢«ä¿®æ”¹ ENCODING å­˜å‚¨ç¼–ç  COMPRESSED / UNCOMPRESSED ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ ç”Ÿäº§æ¨è COMPRESSED CHUNK_SIZE æ•°æ®å—å¤§å° â‰¥ 128 bytes ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ ä¸å½±å“å·²æœ‰ chunk DUPLICATE_POLICY è®¾ç½®é»˜è®¤é‡å¤ç­–ç•¥ BLOCK / FIRST / LAST / MIN / MAX / SUM ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ ä¸ ON_DUPLICATE æœ‰ä¼˜å…ˆçº§å…³ç³» ON_DUPLICATE æœ¬æ¬¡å†™å…¥çš„é‡å¤ç­–ç•¥ åŒä¸Š è¦†ç›–åºåˆ—çº§ç­–ç•¥ å½“å‰å†™å…¥ æ¨èç”¨äºä¸´æ—¶è¦†ç›– IGNORE å¿½ç•¥å¾®å°å˜åŒ–å†™å…¥ ä¸¤ä¸ªé˜ˆå€¼ ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ ç”¨äºé™å™ª LABELS è®¾ç½®æ ‡ç­¾ é”®å€¼å¯¹ ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ å·²å­˜åœ¨ key ä¸ä¼šä¿®æ”¹ ç¤ºä¾‹ï¼šå†™å…¥ä¸€ä¸ªæ—¶é—´åºåˆ— 123TS.ADD ts:cpu:server1 * 80.5## è¾“å‡º(integer) 1767777655255 # å½“å‰æ—¶é—´æˆ³ 2ï¸âƒ£ TS.MADD : æ‰¹é‡å‘å¤šä¸ªæ—¶é—´åºåˆ—è¿½åŠ æ ·æœ¬ è¯­æ³• 1TS.MADD key timestamp value [key timestamp value ...] ç¤ºä¾‹ï¼šæ‰¹é‡å†™å…¥å¤šä¸ªæ—¶é—´åºåˆ— 123456# æ‰¹é‡å†™å…¥ä¸‰ä¸ªæ—¶é—´åºåˆ—ï¼Œæ—¶é—´åºåˆ—å¿…é¡»å­˜åœ¨TS.MADD ts:cpu:server1 * 80.5 ts:cpu:server2 * 90.5 ts:cpu:server3 * 70.5## è¾“å‡º1) (integer) 17677778079332) (integer) 17677778079333) (integer) 1767777807933 3ï¸âƒ£ TS.INCRBY : å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå¢ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰ è¯­æ³•ï¼š 12345678TS.INCRBY key addend [TIMESTAMP timestamp] [RETENTION retentionPeriod] [ENCODING &lt;COMPRESSED|UNCOMPRESSED&gt;] [CHUNK_SIZE size] [DUPLICATE_POLICY policy] [IGNORE ignoreMaxTimediff ignoreMaxValDiff] [LABELS [label value ...]] å‚æ•°è¯´æ˜ å‚æ•° ä½œç”¨ å¯é€‰å€¼ / çº¦æŸ æ˜¯å¦è¦†ç›–å·²æœ‰é…ç½® ç”Ÿæ•ˆèŒƒå›´ ä½¿ç”¨æ³¨æ„äº‹é¡¹ key æ—¶é—´åºåˆ— Key åˆæ³• Redis key â€” â€” ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º addend å¢é‡å€¼ æµ®ç‚¹æ•° â€” å½“å‰å†™å…¥ æ”¯æŒè´Ÿæ•°ï¼ˆç­‰ä»· DECRï¼‰ TIMESTAMP æŒ‡å®šå†™å…¥æ—¶é—´æˆ³ æ¯«ç§’æ•´æ•° â€” å½“å‰å†™å…¥ é»˜è®¤ä½¿ç”¨æœåŠ¡å™¨æ—¶é—´ RETENTION è®¾ç½®ä¿ç•™å‘¨æœŸ â‰¥ 0ï¼ˆæ¯«ç§’ï¼‰ ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ å·²å­˜åœ¨ key ä¸ç”Ÿæ•ˆ ENCODING å­˜å‚¨ç¼–ç  COMPRESSED / UNCOMPRESSED ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ æ¨è COMPRESSED CHUNK_SIZE æ•°æ®å—å¤§å° â‰¥ 128 bytes ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ é«˜é¢‘å†™å…¥å¯è°ƒå¤§ DUPLICATE_POLICY é»˜è®¤é‡å¤æ—¶é—´æˆ³ç­–ç•¥ BLOCK / FIRST / LAST / MIN / MAX / SUM ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ å¯¹è®¡æ•°å™¨é€šå¸¸è®¾ SUM IGNORE å¿½ç•¥å¾®å°å˜åŒ– ä¸¤ä¸ªé˜ˆå€¼ ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ è®¡æ•°å™¨ä¸€èˆ¬ä¸ä½¿ç”¨ LABELS æ ‡ç­¾ é”®å€¼å¯¹ ä»…é¦–æ¬¡åˆ›å»ºç”Ÿæ•ˆ åºåˆ—çº§ ç”¨äº MGET / MRANGE å¦‚æœ key ä¸å­˜åœ¨ï¼ŒTS.INCRBY ä¼š éšå¼åˆ›å»ºæ—¶é—´åºåˆ—ã€‚ å¦‚æœæ²¡æœ‰æŒ‡å®š TIMESTAMPï¼Œåˆ™è‡ªåŠ¨ä½¿ç”¨æœåŠ¡å™¨å½“å‰æ—¶é—´ã€‚ å†™å…¥é€»è¾‘ç­‰ä»·äºï¼šè¯»å–æœ€æ–°å€¼ + addend â†’ å†™å›ä¸€ä¸ªæ–°æ ·æœ¬ã€‚ ç¤ºä¾‹ 1234567# å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå¢TS.INCRBY ts:cpu:server1 10## è¾“å‡º(integer) 1767778308125# æŒ‡å®šæ—¶é—´æˆ³ï¼ŒTIMESTAMP å¿…é¡»å¤§äºæˆ–ç­‰äºå½“å‰æ—¶é—´åºåˆ—ä¸­æœ€å¤§çš„æ—¶é—´æˆ³TS.INCRBY ts:cpu:server1 5 TIMESTAMP 1767778308126 4ï¸âƒ£ TS.DECRBY : å¯¹æœ€æ–°æ—¶é—´æˆ³çš„å€¼åšè‡ªå‡ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºæ–°æ ·æœ¬ï¼‰ ä¸ TS.INCRBY ç›¸ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚ å®é™…ä¸Š TS.INCRBY ä¸­è®¾ç½® addend ä¸ºè´Ÿæ•° å°±æ˜¯ TS.DECR ä¸‰ã€æ•°æ®æŸ¥è¯¢ï¼ˆå•åºåˆ—ï¼‰ç±» å‘½ä»¤ åŠŸèƒ½è¯´æ˜ å…¸å‹ä½¿ç”¨åœºæ™¯ TS.GET è·å–æŸä¸ªæ—¶é—´åºåˆ—æœ€æ–°ï¼ˆæœ€å¤§ timestampï¼‰çš„æ ·æœ¬ è·å–å½“å‰æœ€æ–°æŒ‡æ ‡å€¼ TS.RANGE æŒ‰æ—¶é—´æ­£åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ® ç»˜å›¾ã€è¶‹åŠ¿åˆ†æ TS.REVRANGE æŒ‰æ—¶é—´é€†åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ® è·å–æœ€è¿‘ N æ¡æ•°æ® 1ï¸âƒ£ TS.GET : è·å–æŸä¸ªæ—¶é—´åºåˆ—æœ€æ–°ï¼ˆæœ€å¤§ timestampï¼‰çš„æ ·æœ¬ è¯­æ³•ï¼š 1TS.GET key [LATEST] å‚æ•°è¯´æ˜ï¼š å‚æ•° ä½œç”¨ key æ—¶é—´åºåˆ— Key LATEST è·å–æœ€æ–°æ ·æœ¬ LATEST è¯´æ˜ å½“ä¸€ä¸ªæ—¶é—´åºåˆ—æ˜¯ç»è¿‡èšåˆï¼ˆcompactionï¼‰å¤„ç†çš„æ—¶ï¼ŒLATEST å‚æ•°ä¼šç”Ÿæ•ˆã€‚ä½¿ç”¨ LATEST æ—¶ï¼ŒTS.GET ä¼šè¿”å›æœ€æ–°ï¼ˆå¯èƒ½æ˜¯éƒ¨åˆ†çš„ï¼‰æ¡¶çš„èšåˆå€¼ã€‚ä¸ä½¿ç”¨ LATEST æ—¶ï¼ŒTS.GET ä¸ä¼šè¿”å›æœ€æ–°ï¼ˆå¯èƒ½æ˜¯éƒ¨åˆ†çš„ï¼‰æ¡¶çš„å€¼ã€‚å½“æ—¶é—´åºåˆ—ä¸æ˜¯èšåˆçš„æ—¶ï¼ŒLATEST ä¼šè¢«å¿½ç•¥ã€‚ æœ€æ–°æ¡¶ä¸­çš„æ•°æ®å¯èƒ½æ˜¯ä¸å®Œæ•´çš„ã€‚åªæœ‰å½“æœ‰æ–°çš„æ ·æœ¬åˆ°æ¥å¹¶å¼€å¯ä¸€ä¸ªæ–°çš„æœ€æ–°æ¡¶æ—¶ï¼ŒåŸæ¡¶æ‰ä¼šè¢«å…³é—­å¹¶è¿›è¡Œèšåˆã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿéœ€è¦è·å–æœ€æ–°ï¼ˆå¯èƒ½æ˜¯éƒ¨åˆ†çš„ï¼‰æ¡¶çš„èšåˆå€¼ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ LATESTã€‚ ç¤ºä¾‹ï¼š 1234TS.GET ts:cpu:server1 LATEST## è¾“å‡º1) (integer) 17677783081262) 115.5 2ï¸âƒ£ TS.RANGE : æŒ‰æ—¶é—´æ­£åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ® è¯­æ³•ï¼š 123456TS.RANGE key fromTimestamp toTimestamp [LATEST] [FILTER_BY_TS ts...] [FILTER_BY_VALUE min max] [COUNT count] [[ALIGN align] AGGREGATION aggregator bucketDuration [BUCKETTIMESTAMP bt] [EMPTY]] å‚æ•°è¯´æ˜ï¼š å‚æ•° ç±»å‹ è¯´æ˜ å¯é€‰å€¼ / è¯´æ˜ key string æ—¶é—´åºåˆ—çš„é”®å å¿…é€‰ fromTimestamp integer æŸ¥è¯¢èµ·å§‹æ—¶é—´æˆ³ï¼Œ-: æœ€å°å€¼ å¿…é€‰ toTimestamp integer æŸ¥è¯¢ç»“æŸæ—¶é—´æˆ³ ï¼Œ+: æœ€å¤§å€¼ å¿…é€‰ LATEST flag å½“æ—¶é—´åºåˆ—æ˜¯ compaction æ—¶ï¼Œè¿”å›æœ€æ–°ï¼ˆå¯èƒ½éƒ¨åˆ†ï¼‰çš„æ¡¶çš„èšåˆå€¼ å¯é€‰ FILTER_BY_TS ts... list of integers åªè¿”å›æŒ‡å®šæ—¶é—´æˆ³çš„æ ·æœ¬ å¯é€‰ FILTER_BY_VALUE min max range åªè¿”å›å€¼åœ¨ [min, max] åŒºé—´çš„æ ·æœ¬ å¯é€‰ COUNT count integer é™åˆ¶è¿”å›çš„æ ·æœ¬æ•°é‡ï¼ˆæœ€å¤š count ä¸ªï¼‰ å¯é€‰ ALIGN align string å¯¹é½èšåˆæ¡¶çš„æ—¶é—´æˆ³ï¼ˆå¦‚ startã€endã€è‡ªå®šä¹‰æ—¶é—´æˆ³ï¼‰ å¯é€‰ï¼Œéœ€ä¸ AGGREGATION ä¸€èµ·ä½¿ç”¨ AGGREGATION aggregator bucketDuration aggregation å¯¹æ•°æ®è¿›è¡Œèšåˆè®¡ç®—ï¼Œaggregator ä¸ºèšåˆå‡½æ•°ï¼ˆå¦‚ avg, sum, min, max ç­‰ï¼‰ï¼ŒbucketDuration ä¸ºæ¡¶çš„æ—¶é•¿ å¯é€‰ BUCKETTIMESTAMP bt string èšåˆæ¡¶æ—¶é—´æˆ³é€‰æ‹©ï¼Œbt å¯ä¸º start æˆ– end å¯é€‰ EMPTY flag å³ä½¿æ¡¶ä¸ºç©ºä¹Ÿè¿”å›ç»“æœ å¯é€‰ ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132# æŸ¥è¯¢æ—¶é—´åºåˆ— ts:cpu:server1 çš„åŒºé—´æ•°æ®TS.RANGE ts:cpu:server1 0 1767778308126## è¾“å‡º1) 1) (integer) 1767777655255 2) 80.52) 1) (integer) 1767777807933 2) 70.53) 1) (integer) 1767777873866 2) 80.54) 1) (integer) 1767777965870 2) 80.55) 1) (integer) 1767778300909 2) 90.56) 1) (integer) 1767778308125 2) 105.57) 1) (integer) 1767778308126 2) 115.5# æŸ¥è¯¢æ—¶é—´åºåˆ— ts:cpu:server1 çš„åŒºé—´æ•°æ®ï¼Œå¹¶è¿”å›èšåˆç»“æœï¼Œæ±‚1000mså†…å¹³å‡å€¼TS.RANGE ts:cpu:server1 - + AGGREGATION avg 1000## è¾“å‡º1) 1) (integer) 1767777655000 2) 80.52) 1) (integer) 1767777807000 2) 70.53) 1) (integer) 1767777873000 2) 80.54) 1) (integer) 1767777965000 2) 80.55) 1) (integer) 1767778300000 2) 90.56) 1) (integer) 1767778308000 2) 110.5 3ï¸âƒ£ TS.REVRANGE : æŒ‰æ—¶é—´é€†åºæŸ¥è¯¢ä¸€ä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ® ä¸ TS.RANGE ç±»ä¼¼ï¼Œåªæ˜¯è¿”å›ç»“æœæ˜¯å€’åºçš„ ç¤ºä¾‹ 12345678910111213141516TS.REVRANGE ts:cpu:server1 0 1767778308126## è¾“å‡º1) 1) (integer) 1767778308126 2) 115.52) 1) (integer) 1767778308125 2) 105.53) 1) (integer) 1767778300909 2) 90.54) 1) (integer) 1767777965870 2) 80.55) 1) (integer) 1767777873866 2) 80.56) 1) (integer) 1767777807933 2) 70.57) 1) (integer) 1767777655255 2) 80.5 å››ã€æ•°æ®æŸ¥è¯¢ï¼ˆå¤šåºåˆ— / èšåˆï¼‰ç±» å‘½ä»¤ åŠŸèƒ½è¯´æ˜ å…¸å‹ä½¿ç”¨åœºæ™¯ TS.MGET æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè·å–å¤šä¸ªæ—¶é—´åºåˆ—çš„æœ€æ–°å€¼ æ‰¹é‡è·å–å¤šä¸ªå®ä¾‹çš„å½“å‰æŒ‡æ ‡ TS.MRANGE æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œæ­£åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ® å¤šç»´æŒ‡æ ‡åˆ†æã€èšåˆ TS.MREVRANGE æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œé€†åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ® æœ€è¿‘æ•°æ®èšåˆåˆ†æ TS.QUERYINDEX æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè¿”å›åŒ¹é…çš„æ—¶é—´åºåˆ— key åˆ—è¡¨ å‘ç°æœ‰å“ªäº›æŒ‡æ ‡ç¬¦åˆæ¡ä»¶ 1ï¸âƒ£ TS.MGET : æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè·å–å¤šä¸ªæ—¶é—´åºåˆ—çš„æœ€æ–°å€¼ è¯­æ³•ï¼š 1TS.MGET [LATEST] [WITHLABELS | &lt;SELECTED_LABELS label...&gt;] FILTER filterExpr... å‚æ•°è¯´æ˜ï¼š å‚æ•° ç±»å‹ è¯´æ˜ å¯é€‰å€¼ / è¯´æ˜ LATEST flag å¯¹ compaction ç±»å‹çš„æ—¶é—´åºåˆ—ï¼Œè¿”å›æœ€æ–°ï¼ˆå¯èƒ½éƒ¨åˆ†ï¼‰çš„æ ·æœ¬å€¼ å¯é€‰ WITHLABELS flag è¿”å›æ ·æœ¬çš„åŒæ—¶é™„å¸¦æ—¶é—´åºåˆ—çš„æ‰€æœ‰æ ‡ç­¾ å¯é€‰ &lt;SELECTED_LABELS label...&gt; list è¿”å›æ ·æœ¬æ—¶åªé™„å¸¦æŒ‡å®šæ ‡ç­¾ å¯é€‰ï¼Œä¸èƒ½ä¸ WITHLABELS ä¸€èµ·ä½¿ç”¨ FILTER filterExpr... list of expressions è¿‡æ»¤æ—¶é—´åºåˆ—ï¼Œæ ¹æ®æ ‡ç­¾åŒ¹é…è§„åˆ™ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„åºåˆ— å¿…é€‰ï¼Œæ”¯æŒæ ‡ç­¾åŒ¹é…è¡¨è¾¾å¼ï¼Œå¦‚ sensor=temperature æˆ– region=* ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526# è·å–æ‰€æœ‰æ—¶é—´åºåˆ—çš„æœ€æ–°å€¼ï¼Œæ ¹æ®æ ‡ç­¾è¿‡æ»¤TS.MGET WITHLABELS FILTER metric=cpu## è¾“å‡º1) 1) &quot;ts:cpu:server1&quot; 2) 1) 1) &quot;host&quot; 2) &quot;server1&quot; 2) 1) &quot;metric&quot; 2) &quot;cpu&quot; 3) 1) &quot;env&quot; 2) &quot;prod&quot; 3) 1) (integer) 1767778308126 2) 115.52) 1) &quot;ts:cpu:server2&quot; 2) 1) 1) &quot;host&quot; 2) &quot;server1&quot; 2) 1) &quot;metric&quot; 2) &quot;cpu&quot; 3) 1) (integer) 1767777965870 2) 90.53) 1) &quot;ts:cpu:server3&quot; 2) 1) 1) &quot;host&quot; 2) &quot;server1&quot; 2) 1) &quot;metric&quot; 2) &quot;cpu&quot; 3) 1) (integer) 1767777965870 2) 70.5 2ï¸âƒ£ TS.MRANGE : æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œæ­£åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ® è¯­æ³•ï¼š 123456789TS.MRANGE fromTimestamp toTimestamp [LATEST] [FILTER_BY_TS ts...] [FILTER_BY_VALUE min max] [WITHLABELS | &lt;SELECTED_LABELS label...&gt;] [COUNT count] [[ALIGN align] AGGREGATION aggregator bucketDuration [BUCKETTIMESTAMP bt] [EMPTY]] FILTER filterExpr... [GROUPBY label REDUCE reducer] å‚æ•°è¯´æ˜ï¼š å‚æ•° ç±»å‹ è¯´æ˜ å¯é€‰å€¼ / è¯´æ˜ fromTimestamp integer æŸ¥è¯¢èµ·å§‹æ—¶é—´æˆ³ï¼Œ-: æœ€å°å€¼ å¿…é€‰ toTimestamp integer æŸ¥è¯¢ç»“æŸæ—¶é—´æˆ³ï¼Œ+: æœ€å¤§å€¼ å¿…é€‰ LATEST flag å¯¹ compaction ç±»å‹çš„æ—¶é—´åºåˆ—ï¼Œè¿”å›æœ€æ–°ï¼ˆå¯èƒ½éƒ¨åˆ†ï¼‰çš„æ¡¶çš„èšåˆå€¼ å¯é€‰ FILTER_BY_TS ts... list of integers åªè¿”å›æŒ‡å®šæ—¶é—´æˆ³çš„æ ·æœ¬ å¯é€‰ FILTER_BY_VALUE min max range åªè¿”å›å€¼åœ¨ [min, max] åŒºé—´çš„æ ·æœ¬ å¯é€‰ WITHLABELS flag è¿”å›æ ·æœ¬çš„åŒæ—¶é™„å¸¦æ—¶é—´åºåˆ—çš„æ‰€æœ‰æ ‡ç­¾ å¯é€‰ &lt;SELECTED_LABELS label...&gt; list è¿”å›æ ·æœ¬æ—¶åªé™„å¸¦æŒ‡å®šæ ‡ç­¾ å¯é€‰ï¼Œä¸èƒ½ä¸ WITHLABELS ä¸€èµ·ä½¿ç”¨ COUNT count integer é™åˆ¶è¿”å›çš„æ ·æœ¬æ•°é‡ï¼ˆæœ€å¤š count ä¸ªï¼‰ å¯é€‰ ALIGN align string å¯¹é½èšåˆæ¡¶çš„æ—¶é—´æˆ³ï¼ˆå¦‚ startã€end æˆ–è‡ªå®šä¹‰æ—¶é—´æˆ³ï¼‰ å¯é€‰ï¼Œéœ€ä¸ AGGREGATION ä¸€èµ·ä½¿ç”¨ AGGREGATION aggregator bucketDuration aggregation å¯¹æ•°æ®è¿›è¡Œèšåˆè®¡ç®—ï¼Œaggregator ä¸ºèšåˆå‡½æ•°ï¼ˆå¦‚ avg, sum, min, max ç­‰ï¼‰ï¼ŒbucketDuration ä¸ºæ¡¶çš„æ—¶é•¿ å¯é€‰ BUCKETTIMESTAMP bt string èšåˆæ¡¶æ—¶é—´æˆ³é€‰æ‹©ï¼Œbt å¯ä¸º start æˆ– end å¯é€‰ EMPTY flag å³ä½¿æ¡¶ä¸ºç©ºä¹Ÿè¿”å›ç»“æœ å¯é€‰ FILTER filterExpr... list of expressions è¿‡æ»¤æ—¶é—´åºåˆ—ï¼Œæ ¹æ®æ ‡ç­¾åŒ¹é…è§„åˆ™ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„åºåˆ— å¿…é€‰ GROUPBY label REDUCE reducer aggregation å¯¹è¿”å›ç»“æœæŒ‰æŒ‡å®šæ ‡ç­¾åˆ†ç»„å¹¶åº”ç”¨ reducer èšåˆå‡½æ•°ï¼ˆå¦‚ SUM, MIN, MAX ç­‰ï¼‰ å¯é€‰ ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647TS.MRANGE - + FILTER metric=cpu## è¾“å‡º1) 1) &quot;ts:cpu:server1&quot; 2) (empty array) 3) 1) 1) (integer) 1767777655255 2) 80.5 2) 1) (integer) 1767777807933 2) 70.5 3) 1) (integer) 1767777873866 2) 80.5 4) 1) (integer) 1767777965870 2) 80.5 5) 1) (integer) 1767778300909 2) 90.5 6) 1) (integer) 1767778308125 2) 105.5 7) 1) (integer) 1767778308126 2) 115.52) 1) &quot;ts:cpu:server2&quot; 2) (empty array) 3) 1) 1) (integer) 1767777965870 2) 90.53) 1) &quot;ts:cpu:server3&quot; 2) (empty array) 3) 1) 1) (integer) 1767777965870 2) 70.5# æŒ‰æ ‡ç­¾èšåˆTS.MRANGE - + AGGREGATION avg 1000 FILTER metric=cpu GROUPBY host REDUCE avg## è¾“å‡º1) 1) &quot;host=server1&quot; 2) (empty array) 3) 1) 1) (integer) 1767777655000 2) 80.5 2) 1) (integer) 1767777807000 2) 70.5 3) 1) (integer) 1767777873000 2) 80.5 4) 1) (integer) 1767777965000 2) 80.5 5) 1) (integer) 1767778300000 2) 90.5 6) 1) (integer) 1767778308000 2) 110.5 3ï¸âƒ£ TS.MREVRANGE : æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œé€†åºæŸ¥è¯¢å¤šä¸ªæ—¶é—´åºåˆ—çš„åŒºé—´æ•°æ® ä¸ TS.MRANGE ç±»ä¼¼ï¼Œåªæ˜¯æŸ¥è¯¢ç»“æœæ˜¯é€†åºçš„ 4ï¸âƒ£ TS.QUERYINDEX : æ ¹æ®æ ‡ç­¾è¿‡æ»¤ï¼Œè¿”å›åŒ¹é…çš„æ—¶é—´åºåˆ— key åˆ—è¡¨ è¯­æ³•ï¼š 1S.QUERYINDEX filterExpr... ç¤ºä¾‹ï¼š 12345TS.QUERYINDEX metric=cpu host=server1## è¾“å‡º1) &quot;ts:cpu:server1&quot;2) &quot;ts:cpu:server2&quot;3) &quot;ts:cpu:server3&quot; äº”ã€æ•°æ®åˆ é™¤ä¸ç»´æŠ¤ç±» å‘½ä»¤ åŠŸèƒ½è¯´æ˜ å…¸å‹ä½¿ç”¨åœºæ™¯ TS.DEL åˆ é™¤æŸä¸ªæ—¶é—´åºåˆ—åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ ·æœ¬ æ¸…ç†å¼‚å¸¸æ•°æ®ã€å†å²æ•°æ®ä¿®æ­£ è¯­æ³• 1TS.DEL key fromTimestamp toTimestamp ç¤ºä¾‹ï¼š 123TS.DEL ts:cpu:server1 0 1767777965870## è¾“å‡º(integer) 4 # åˆ é™¤äº† 4 ä¸ªæ ·æœ¬ å…­ã€å…ƒæ•°æ®ä¸çŠ¶æ€æŸ¥è¯¢ç±» å‘½ä»¤ åŠŸèƒ½è¯´æ˜ å…¸å‹ä½¿ç”¨åœºæ™¯ TS.INFO è¿”å›æ—¶é—´åºåˆ—çš„å…ƒä¿¡æ¯ä¸ç»Ÿè®¡ä¿¡æ¯ æ’æŸ¥é—®é¢˜ã€å®¹é‡è¯„ä¼°ã€ç›‘æ§çŠ¶æ€ è¯­æ³• 12TS.INFO key [DEBUG]# DEBUG: æ˜¾ç¤ºæ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯ ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435TS.INFO ts:cpu:server1## è¾“å‡º1) totalSamples 2) (integer) 3 3) memoryUsage 4) (integer) 9184 5) firstTimestamp 6) (integer) 1767778300909 7) lastTimestamp 8) (integer) 1767778308126 9) retentionTime10) (integer) 720000011) chunkCount12) (integer) 113) chunkSize14) (integer) 819215) chunkType16) compressed17) duplicatePolicy18) last19) labels20) 1) 1) &quot;host&quot; 2) &quot;server1&quot; 2) 1) &quot;metric&quot; 2) &quot;cpu&quot; 3) 1) &quot;env&quot; 2) &quot;prod&quot;21) sourceKey22) (nil)23) rules24) (empty array)25) ignoreMaxTimeDiff26) (integer) 100027) ignoreMaxValDiff28) &quot;0.1&quot; çœŸå®æ¡ˆä¾‹ åœºæ™¯è¯´æ˜ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª IoT è®¾å¤‡ç›‘æ§ç³»ç»Ÿï¼Œæ¯å°è®¾å¤‡æ¯åˆ†é’Ÿä¼šä¸ŠæŠ¥ä¸€æ¬¡æ¸©åº¦å’Œæ¹¿åº¦æ•°æ®ã€‚æˆ‘ä»¬å¸Œæœ›ï¼š å­˜å‚¨æ¯å°è®¾å¤‡çš„æ—¶é—´åºåˆ—æ•°æ®ã€‚ æŸ¥è¯¢æœ€è¿‘ä¸€å°æ—¶çš„æ•°æ®ã€‚ ç»Ÿè®¡æ¯ 5 åˆ†é’Ÿçš„å¹³å‡æ¸©åº¦å’Œæ¹¿åº¦ã€‚ è·å–æœ€æ–°çš„æ¸©åº¦å€¼ã€‚ æ­¥éª¤ åˆ›å»ºæ—¶é—´åºåˆ— 12345678910# åˆ›å»ºè®¾å¤‡ device:1001 çš„æ¸©åº¦æ—¶é—´åºåˆ—TS.CREATE device:1001:temperature RETENTION 86400000 LABELS device_id 1001 type temperature# åˆ›å»ºè®¾å¤‡ device:1001 çš„æ¹¿åº¦æ—¶é—´åºåˆ—TS.CREATE device:1001:humidity RETENTION 86400000 LABELS device_id 1001 type humidity## è¯´æ˜ï¼š # RETENTION 86400000ï¼šæ•°æ®ä¿ç•™ 24 å°æ—¶ï¼ˆå•ä½æ¯«ç§’ï¼‰ã€‚ # LABELSï¼šæ–¹ä¾¿åç»­æŒ‰æ ‡ç­¾èšåˆæŸ¥è¯¢ã€‚ # TS.CREATE ç”¨äºåˆ›å»ºæ—¶é—´åºåˆ— keyã€‚ æ’å…¥æ•°æ® 1234# å‡è®¾æ—¶é—´æˆ³ä¸ºå½“å‰æ¯«ç§’TS.ADD device:1001:temperature * 26.5TS.ADD device:1001:humidity * 60.2# æ­¤å¤„å‡è®¾ä¼šæ¯åˆ†é’Ÿæ’å…¥ä¸€æ¬¡æ•°æ® æŸ¥è¯¢æ—¶é—´èŒƒå›´æ•°æ® 1234567891011121314# è·å– è¿‡å»ä¸€å°æ—¶çš„æ¸©åº¦æ•°æ®ï¼š# è¿‡å»ä¸€å°æ—¶çš„æ—¶é—´æˆ³å¯ä»¥è¿™æ ·è·å¾—EVAL &quot;return redis.call(&#x27;TIME&#x27;)[1]*1000 - 3600000&quot; 0## è¾“å‡º(integer) 1767777794000TS.RANGE device:1001:temperature 1767777794000 +## è¯´æ˜ # -3600000 è¡¨ç¤ºä¸€å°æ—¶å‰ã€‚ # + è¡¨ç¤ºåˆ°ç°åœ¨ã€‚ # è¿”å›ç»“æœä¸º [timestamp, value] æ•°ç»„ã€‚## è¾“å‡º1) 1) (integer) 1767781256846 2) 26.5 èšåˆæŸ¥è¯¢ï¼ˆDownsamplingï¼‰ 12345# ç»Ÿè®¡ æ¯ 5 åˆ†é’Ÿå¹³å‡æ¸©åº¦ï¼šTS.RANGE device:1001:temperature 1767777794000 + AGGREGATION avg 300000# è¯´æ˜ï¼š # AGGREGATION avg 300000 è¡¨ç¤ºæ¯ 300,000 msï¼ˆ5 åˆ†é’Ÿï¼‰èšåˆä¸€æ¬¡ã€‚ # RedisTimeSeries æ”¯æŒå¤šç§èšåˆå‡½æ•°ï¼šavg, sum, min, max, countã€‚ è·å–æœ€æ–°å€¼ 12345# è·å–æœ€æ–°çš„æ¸©åº¦å€¼ï¼šTS.GET device:1001:temperature# è¯´æ˜ # TS.GET ä¼šè¿”å›æœ€æ–°ä¸€ä¸ªæ•°æ®ç‚¹ [timestamp, value]ã€‚ # å¦‚æœä½¿ç”¨äº†å‹ç¼©ç­–ç•¥ LATESTï¼Œè¿”å›çš„å€¼å¯èƒ½æ˜¯å½“å‰èšåˆæ¡¶çš„å€¼ã€‚ æŒ‰æ ‡ç­¾æŸ¥è¯¢ 12345678910# å¦‚æœæˆ‘ä»¬æƒ³è·å– æ‰€æœ‰è®¾å¤‡çš„æ¸©åº¦å¹³å‡å€¼ï¼ˆå‡è®¾æœ‰å¾ˆå¤šè®¾å¤‡ï¼‰ï¼šTS.MRANGE - + AGGREGATION avg 300000 FILTER type=temperature# è¯´æ˜ï¼š # TS.MRANGE æ”¯æŒå¤š key æŸ¥è¯¢ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰æ ‡ç­¾è¿‡æ»¤ã€‚ # èšåˆå‡½æ•°å¯ä»¥å¯¹æ¯ä¸ªåŒ¹é… key å•ç‹¬è®¡ç®—ã€‚# è¾“å‡º1) 1) &quot;device:1001:temperature&quot; 2) (empty array) 3) 1) 1) (integer) 1767781200000 2) 26.5","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisTimeSeries ä¸­ TimeSeries æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisTimeSeries çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•","date_published":"2026-01-07T14:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2026/01/07/redis7-module-RedisTimeSeries/","url":"https://blog.hanqunfeng.com/2026/01/07/redis7-module-RedisTimeSeries/","title":"Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisTimeSeries çš„å®‰è£…æ–¹æ³•</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RedisTimeSeries-ç®€ä»‹\">RedisTimeSeries ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/RedisTimeSeries/RedisTimeSeries\">RedisTimeSeries</a> æ˜¯ Redis å®˜æ–¹æä¾›çš„ä¸€ä¸ª æ—¶åºæ•°æ®æ¨¡å—ï¼ˆTime Series Moduleï¼‰ï¼Œç”¨äºé«˜æ•ˆåœ°å­˜å‚¨ã€æŸ¥è¯¢å’Œåˆ†ææ—¶é—´åºåˆ—æ•°æ®ã€‚å®ƒå¯ä»¥ä½œä¸º Redis çš„ä¸€ä¸ªæ¨¡å—åŠ è½½ä½¿ç”¨ï¼ˆåœ¨ Redis Stack ä¸­å†…ç½®æ”¯æŒï¼‰ï¼Œå°†æ—¶åºæ•°æ®å»ºæ¨¡ã€å­˜å‚¨å’Œèšåˆèƒ½åŠ›æ‰©å±•åˆ° Redis ä¹‹å¤–ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯¥æ¨¡å—ä»¥ <code>Redis Module</code> æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Redis8+ï¼ŒRedisTimeSeries å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å®‰è£…-RedisTimeSeries\">å®‰è£… RedisTimeSeries</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è™½ç„¶<a href=\"https://cloud.redis.io\">Redis Cloud</a>çš„<code>Download Center</code>ä¸­æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„<code>.so</code>æ–‡ä»¶ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚<br>\nå¯ä»¥åœ¨æµ·å¤–çš„<code>ç›¸åŒé…ç½®</code>çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„<code>redistimeseries.so</code>ä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install -y \\</span><br><span class=\"line\">  gcc \\</span><br><span class=\"line\">  gcc-c++ \\</span><br><span class=\"line\">  make \\</span><br><span class=\"line\">  cmake \\</span><br><span class=\"line\">  autoconf \\</span><br><span class=\"line\">  automake \\</span><br><span class=\"line\">  libtool \\</span><br><span class=\"line\">  pkgconfig \\</span><br><span class=\"line\">  openssl-devel</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¯‘ RedisTimeSeries</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /usr/local/soft/modules/</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/soft/modules</span><br><span class=\"line\"><span class=\"comment\"># clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> --recursive https://github.com/RedisTimeSeries/RedisTimeSeries.git</span><br><span class=\"line\"><span class=\"built_in\">cd</span> RedisTimeSeries</span><br><span class=\"line\"><span class=\"comment\"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class=\"line\">git checkout v1.12.9</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥</span></span><br><span class=\"line\">git submodule update --init --recursive</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥å¹¶å®‰è£…éœ€è¦çš„ä¾èµ–</span></span><br><span class=\"line\">./sbin/setup</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\"># readies version: af92230</span></span><br><span class=\"line\">dnf install -q -y ca-certificates</span><br><span class=\"line\">dnf install -q -y wget unzip</span><br><span class=\"line\">dnf install -q -y git jq</span><br><span class=\"line\">/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/enable-utf8</span><br><span class=\"line\">dnf install -q -y autoconf libtool m4 automake</span><br><span class=\"line\">dnf install -q -y openssl</span><br><span class=\"line\">dnf install -q -y <span class=\"built_in\">which</span></span><br><span class=\"line\">/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getepel</span><br><span class=\"line\">dnf install -q -y openssl-devel</span><br><span class=\"line\">/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getgcc --modern</span><br><span class=\"line\">dnf install -q -y valgrind</span><br><span class=\"line\">/usr/bin/python3 /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getcmake --usr</span><br><span class=\"line\">dnf install -q -y lcov</span><br><span class=\"line\">/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getaws</span><br><span class=\"line\">/usr/bin/python3 /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getrmpytools --reinstall --modern</span><br><span class=\"line\">/usr/bin/python3 -m pip install --disable-pip-version-check --user  -r /usr/local/soft/modules/RedisTimeSeries/tests/flow/requirements.txt</span><br><span class=\"line\">NO_PY2=1 /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getpudb</span><br><span class=\"line\">amazon_linux_2023</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘ RedisTimeSeries</span></span><br><span class=\"line\">make</span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘è¿‡ç¨‹æœªæŠ¥é”™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œç¼–è¯‘åçš„æ–‡ä»¶ä½äº `bin/linux-x64-release/redistimeseries.so`</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong><code>./sbin/setup</code> æŠ¥é”™</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æœ¬äººä½¿ç”¨çš„æ˜¯ Amazon Linux 2023(å†…æ ¸ 6.1)ï¼Œå³ <code>EL9</code>ï¼Œç±»ä¼¼äºCentOS 9ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œä¼šæŠ¥é”™ï¼Œå¤§è‡´æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./sbin/setup</span><br><span class=\"line\"><span class=\"comment\">## é”™è¯¯ä¿¡æ¯</span></span><br><span class=\"line\">â€¦â€¦</span><br><span class=\"line\">Status code: 403 <span class=\"keyword\">for</span> https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 172.67.157.246)</span><br><span class=\"line\"></span><br><span class=\"line\">In /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getepel:</span><br><span class=\"line\">346      \t\t<span class=\"comment\"># xinstall --allowerasing https://dl.fedoraproject.org/pub/epel/epel-release-latest-$&#123;EPEL&#125;.noarch.rpm</span></span><br><span class=\"line\">347      \t<span class=\"keyword\">fi</span></span><br><span class=\"line\">348</span><br><span class=\"line\">349  &gt;&gt;&gt; \tinstall_raven</span><br><span class=\"line\">350      \tinstall_remi</span><br><span class=\"line\">351      \t<span class=\"comment\"># install_centos_stream_repos</span></span><br><span class=\"line\">352</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">command</span> failed: /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getepel</span><br><span class=\"line\"></span><br><span class=\"line\">In /usr/local/soft/modules/RedisTimeSeries/sbin/setup:</span><br><span class=\"line\">18       \tpython3 -m pip list</span><br><span class=\"line\">19       <span class=\"keyword\">fi</span></span><br><span class=\"line\">20</span><br><span class=\"line\">21   &gt;&gt;&gt; <span class=\"variable\">$ROOT</span>/sbin/system-setup.py <span class=\"variable\">$SETUP_ARGS</span></span><br><span class=\"line\">22       <span class=\"keyword\">if</span> [[ <span class=\"variable\">$VERBOSE</span> == 1 ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">23       \tpython3 -m pip list</span><br><span class=\"line\">24       <span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">é”™è¯¯åˆ†æä¸è§£å†³æ–¹æ³•ï¼š\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">è¿™ä¸ªé”™è¯¯ä¸å®‰è£… RedisBloom æ—¶ä¸€æ ·ï¼Œç¦ç”¨æ‰ <code>install_raven</code> å³å¯ï¼Œå…·ä½“å‚è§ <a href=\"/2025/12/21/redis7-module-RedisBloom/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a> è¿›è¡Œä¿®æ”¹ã€‚</li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"Redis-å¯ç”¨æ¨¡å—\">Redis å¯ç”¨æ¨¡å—</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†ç”Ÿæˆçš„ <code>redistimeseries.so</code> æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> bin/linux-x64-release/redistimeseries.so /usr/local/soft/redis-7.4.7/modules/redistimeseries.so</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡é‡‡ç”¨ <code>loadmodule</code> åŠ è½½æ¨¡å—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°† redistimeseries.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class=\"line\">loadmodule /usr/local/soft/redis-7.4.7/modules/redistimeseries.so</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨redis</span></span><br><span class=\"line\">redis-server redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•æµ‹è¯•</span></span><br><span class=\"line\">redis-cli --user admin --pass 123456</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ¨¡å—</span></span><br><span class=\"line\">127.0.0.1:6379&gt; MODULE LIST</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;timeseries&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 11209</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/redistimeseries.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;ReJSON&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 20816</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;bf&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 20817</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">4) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;search&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 21025</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/redisearch.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisTimeSeries çš„å®‰è£…æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisTimeSeries ç®€ä»‹ RedisTimeSeries æ˜¯ Redis å®˜æ–¹æä¾›çš„ä¸€ä¸ª æ—¶åºæ•°æ®æ¨¡å—ï¼ˆTime Series Moduleï¼‰ï¼Œç”¨äºé«˜æ•ˆåœ°å­˜å‚¨ã€æŸ¥è¯¢å’Œåˆ†ææ—¶é—´åºåˆ—æ•°æ®ã€‚å®ƒå¯ä»¥ä½œä¸º Redis çš„ä¸€ä¸ªæ¨¡å—åŠ è½½ä½¿ç”¨ï¼ˆåœ¨ Redis Stack ä¸­å†…ç½®æ”¯æŒï¼‰ï¼Œå°†æ—¶åºæ•°æ®å»ºæ¨¡ã€å­˜å‚¨å’Œèšåˆèƒ½åŠ›æ‰©å±•åˆ° Redis ä¹‹å¤–ã€‚ è¯¥æ¨¡å—ä»¥ Redis Module æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚ Redis8+ï¼ŒRedisTimeSeries å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚ å®‰è£… RedisTimeSeries è™½ç„¶Redis Cloudçš„Download Centerä¸­æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„.soæ–‡ä»¶ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚ å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚ å¯ä»¥åœ¨æµ·å¤–çš„ç›¸åŒé…ç½®çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„redistimeseries.soä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚ å®‰è£…ä¾èµ– 12345678910sudo dnf install -y \\ gcc \\ gcc-c++ \\ make \\ cmake \\ autoconf \\ automake \\ libtool \\ pkgconfig \\ openssl-devel ç¼–è¯‘ RedisTimeSeries 1234567891011121314151617181920212223242526272829303132333435363738mkdir -p /usr/local/soft/modules/cd /usr/local/soft/modules# clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—git clone --recursive https://github.com/RedisTimeSeries/RedisTimeSeries.gitcd RedisTimeSeries# æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬git checkout v1.12.9# æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥git submodule update --init --recursive# æ£€æŸ¥å¹¶å®‰è£…éœ€è¦çš„ä¾èµ–./sbin/setup## è¾“å‡º# readies version: af92230dnf install -q -y ca-certificatesdnf install -q -y wget unzipdnf install -q -y git jq/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/enable-utf8dnf install -q -y autoconf libtool m4 automakednf install -q -y openssldnf install -q -y which/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getepeldnf install -q -y openssl-devel/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getgcc --moderndnf install -q -y valgrind/usr/bin/python3 /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getcmake --usrdnf install -q -y lcov/usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getaws/usr/bin/python3 /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getrmpytools --reinstall --modern/usr/bin/python3 -m pip install --disable-pip-version-check --user -r /usr/local/soft/modules/RedisTimeSeries/tests/flow/requirements.txtNO_PY2=1 /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getpudbamazon_linux_2023# ç¼–è¯‘ RedisTimeSeriesmake# ç¼–è¯‘è¿‡ç¨‹æœªæŠ¥é”™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œç¼–è¯‘åçš„æ–‡ä»¶ä½äº `bin/linux-x64-release/redistimeseries.so` ./sbin/setup æŠ¥é”™ æœ¬äººä½¿ç”¨çš„æ˜¯ Amazon Linux 2023(å†…æ ¸ 6.1)ï¼Œå³ EL9ï¼Œç±»ä¼¼äºCentOS 9ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œä¼šæŠ¥é”™ï¼Œå¤§è‡´æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324./sbin/setup## é”™è¯¯ä¿¡æ¯â€¦â€¦Status code: 403 for https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 172.67.157.246)In /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getepel:346 # xinstall --allowerasing https://dl.fedoraproject.org/pub/epel/epel-release-latest-$&#123;EPEL&#125;.noarch.rpm347 fi348349 &gt;&gt;&gt; install_raven350 install_remi351 # install_centos_stream_repos352command failed: /usr/local/soft/modules/RedisTimeSeries/deps/readies/bin/getepelIn /usr/local/soft/modules/RedisTimeSeries/sbin/setup:18 python3 -m pip list19 fi2021 &gt;&gt;&gt; $ROOT/sbin/system-setup.py $SETUP_ARGS22 if [[ $VERBOSE == 1 ]]; then23 python3 -m pip list24 fi é”™è¯¯åˆ†æä¸è§£å†³æ–¹æ³•ï¼š è¿™ä¸ªé”™è¯¯ä¸å®‰è£… RedisBloom æ—¶ä¸€æ ·ï¼Œç¦ç”¨æ‰ install_raven å³å¯ï¼Œå…·ä½“å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³• è¿›è¡Œä¿®æ”¹ã€‚ Redis å¯ç”¨æ¨¡å— å°†ç”Ÿæˆçš„ redistimeseries.so æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º 12# æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™cp bin/linux-x64-release/redistimeseries.so /usr/local/soft/redis-7.4.7/modules/redistimeseries.so æœ¬æ–‡é‡‡ç”¨ loadmodule åŠ è½½æ¨¡å— 12345678910111213141516171819202122232425262728293031323334353637383940414243# å°† redistimeseries.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redisloadmodule /usr/local/soft/redis-7.4.7/modules/redistimeseries.so# å¯åŠ¨redisredis-server redis.conf# ç™»å½•æµ‹è¯•redis-cli --user admin --pass 123456# æŸ¥çœ‹æ¨¡å—127.0.0.1:6379&gt; MODULE LIST# è¾“å‡º1) 1) &quot;name&quot; 2) &quot;timeseries&quot; 3) &quot;ver&quot; 4) (integer) 11209 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/redistimeseries.so&quot; 7) &quot;args&quot; 8) (empty array)2) 1) &quot;name&quot; 2) &quot;ReJSON&quot; 3) &quot;ver&quot; 4) (integer) 20816 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot; 7) &quot;args&quot; 8) (empty array)3) 1) &quot;name&quot; 2) &quot;bf&quot; 3) &quot;ver&quot; 4) (integer) 20817 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot; 7) &quot;args&quot; 8) (empty array)4) 1) &quot;name&quot; 2) &quot;search&quot; 3) &quot;ver&quot; 4) (integer) 21025 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/redisearch.so&quot; 7) &quot;args&quot; 8) (empty array)","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisTimeSeries çš„å®‰è£…æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/","date_published":"2026-01-07T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2026/01/06/redis7-datatype-17-AutoSuggest/","url":"https://blog.hanqunfeng.com/2026/01/06/redis7-datatype-17-AutoSuggest/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- AutoSuggest","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch ä¸­ AutoSuggest æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\">RediSearch çš„å®‰è£…å‚è§ <a href=\"/2025/12/26/redis7-module-RediSearch/\" title=\"Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•</a></li>\n<li class=\"lvl-2\">ç¤ºä¾‹ä»£ç ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo\">GitHub</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"AutoSuggest-æœç´¢å»ºè®®ï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰\">AutoSuggest æœç´¢å»ºè®®ï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Suggest æœ¬è´¨è§£å†³çš„é—®é¢˜ï¼šâ€œå½“ç”¨æˆ·åªè¾“å…¥éƒ¨åˆ†å‰ç¼€æ—¶ï¼Œå¦‚ä½•é«˜æ€§èƒ½åœ°ç»™å‡ºå€™é€‰è¯ï¼Œè€Œä¸æ˜¯å…¨æ–‡æœç´¢ç»“æœã€‚â€</p>\n</li>\n<li class=\"lvl-2\">\n<p>Suggest èƒ½è§£å†³ä»€ä¹ˆä¸šåŠ¡é—®é¢˜?</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ä¸šåŠ¡ç—›ç‚¹</th>\n<th>ä¼ ç»Ÿæ–¹æ¡ˆé—®é¢˜</th>\n<th>Suggest çš„ä»·å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æœç´¢æ¡†è‡ªåŠ¨è¡¥å…¨</td>\n<td>LIKE / æ¨¡ç³ŠæŸ¥è¯¢æ€§èƒ½å·®</td>\n<td>O(logN) çº§å‰ç¼€åŒ¹é…</td>\n</tr>\n<tr>\n<td>çƒ­é—¨è¯æ¨è</td>\n<td>éœ€è¦é¢å¤–ç»Ÿè®¡ç³»ç»Ÿ</td>\n<td>å†…ç½® score æ’åº</td>\n</tr>\n<tr>\n<td>æ‹¼å†™ä¸å‡†ç¡®</td>\n<td>æ™®é€šå‰ç¼€æ— æ³•å‘½ä¸­</td>\n<td>FUZZY æ¨¡ç³ŠåŒ¹é…</td>\n</tr>\n<tr>\n<td>è”æƒ³æç¤º</td>\n<td>æœç´¢ç´¢å¼•è¿‡é‡</td>\n<td>Suggest ç‹¬ç«‹ç»“æ„ï¼Œè½»é‡</td>\n</tr>\n<tr>\n<td>é«˜å¹¶å‘æç¤º</td>\n<td>æ•°æ®åº“å‹åŠ›å¤§</td>\n<td>Redis å†…å­˜çº§åå</td>\n</tr>\n<tr>\n<td>å®æ—¶æ›´æ–°</td>\n<td>ç¦»çº¿è¯åº“å¤æ‚</td>\n<td>åŠ¨æ€å¢åˆ </td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Suggest å‘½ä»¤ä¸ä½¿ç”¨åœºæ™¯å¯¹ç…§è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n<th>æ˜¯å¦é«˜é¢‘</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>FT.SUGADD</strong></td>\n<td>æ·»åŠ  / æ›´æ–°è¡¥å…¨è¯</td>\n<td>æ„å»ºè¯åº“ã€åŠ¨æ€çƒ­è¯æ›´æ–°</td>\n<td>â­â­â­â­</td>\n</tr>\n<tr>\n<td><strong>FT.SUGGET</strong></td>\n<td>æŸ¥è¯¢è¡¥å…¨å»ºè®®</td>\n<td>ç”¨æˆ·è¾“å…¥è”æƒ³æç¤º</td>\n<td>â­â­â­â­â­</td>\n</tr>\n<tr>\n<td><strong>FT.SUGDEL</strong></td>\n<td>åˆ é™¤è¡¥å…¨è¯</td>\n<td>è¯ä¸‹æ¶ã€æ¸…ç†è„æ•°æ®</td>\n<td>â­â­</td>\n</tr>\n<tr>\n<td><strong>FT.SUGLEN</strong></td>\n<td>ç»Ÿè®¡è¡¥å…¨è¯æ•°é‡</td>\n<td>ç›‘æ§ã€å®¹é‡è¯„ä¼°</td>\n<td>â­</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯ â†’ å‘½ä»¤æ˜ å°„æ€»ç»“è¡¨ï¼ˆæ¨èæ”¶è—ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ä¸šåŠ¡ç›®æ ‡</th>\n<th>æ¨èå‘½ä»¤ç»„åˆ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>è‡ªåŠ¨è¡¥å…¨</td>\n<td>SUGADD + SUGGET</td>\n<td>åŸºç¡€èƒ½åŠ›</td>\n</tr>\n<tr>\n<td>çƒ­è¯æ’è¡Œ</td>\n<td>SUGADD(INCR) + SUGGET(WITHSCORES)</td>\n<td>æƒé‡é©±åŠ¨</td>\n</tr>\n<tr>\n<td>æ‹¼å†™çº é”™</td>\n<td>SUGGET(FUZZY)</td>\n<td>å®¹é”™</td>\n</tr>\n<tr>\n<td>åˆ†ç±»æ¨è</td>\n<td>SUGADD(PAYLOAD) + SUGGET(WITHPAYLOADS)</td>\n<td>æºå¸¦ä¸šåŠ¡ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>è¯åº“æ²»ç†</td>\n<td>SUGDEL + SUGLEN</td>\n<td>è¿ç»´</td>\n</tr>\n<tr>\n<td>å®¹é‡ç›‘æ§</td>\n<td>SUGLEN</td>\n<td>è§„æ¨¡è¯„ä¼°</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ğŸ‘‰ åŸåˆ™ï¼šè¾“å…¥æ¡†æç¤ºç”¨ Suggestï¼Œæœç´¢ç»“æœç”¨ FT.SEARCHã€‚</p>\n</li>\n</ul>\n<h3 id=\"1ï¸âƒ£-FT-SUGADD-â€”â€”-æ·»åŠ -æ›´æ–°è¡¥å…¨è¯\">1ï¸âƒ£ FT.SUGADD â€”â€” æ·»åŠ  / æ›´æ–°è¡¥å…¨è¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘è¡¥å…¨è¯åº“ä¸­æ·»åŠ ä¸€ä¸ªå€™é€‰è¯</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯è®¾ç½® æƒé‡ã€payload</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ç”¨äº çƒ­è¯æ’åº</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SUGADD key string score</span><br><span class=\"line\">  [INCR]</span><br><span class=\"line\">  [PAYLOAD payload]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>key</code></td>\n<td>Suggestion è¯åº“ Keyï¼Œç´¢å¼•åç§°</td>\n</tr>\n<tr>\n<td><code>string</code></td>\n<td>è¡¥å…¨æ–‡æœ¬</td>\n</tr>\n<tr>\n<td><code>score</code></td>\n<td>æƒé‡ï¼ˆè¶Šå¤§è¶Šé å‰ï¼‰</td>\n</tr>\n<tr>\n<td><code>INCR</code></td>\n<td>é€’å¢ï¼Œç´¯åŠ æƒé‡</td>\n</tr>\n<tr>\n<td><code>PAYLOAD</code></td>\n<td>é™„åŠ å…ƒæ•°æ®</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SUGADD sug:search <span class=\"string\">&quot;iphone&quot;</span> 100</span><br><span class=\"line\">FT.SUGADD sug:search <span class=\"string\">&quot;iphone 15&quot;</span> 200</span><br><span class=\"line\">FT.SUGADD sug:search <span class=\"string\">&quot;ipad&quot;</span> 50 PAYLOAD <span class=\"string\">&quot;category=tablet&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç±»å‹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">type</span> sug:search</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">trietype0</span><br></pre></td></tr></table></figure>\n<h3 id=\"2ï¸âƒ£-FT-SUGGET-â€”â€”-è·å–è¡¥å…¨å»ºè®®\">2ï¸âƒ£ FT.SUGGET â€”â€” è·å–è¡¥å…¨å»ºè®®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ¹æ® å‰ç¼€ è¿”å›æœ€ç›¸å…³çš„å€™é€‰è¯</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ”¯æŒæ¨¡ç³ŠåŒ¹é…</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯è¿”å› payload / score</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ç”¨äº æœç´¢æ¡†è¾“å…¥è”æƒ³ã€æ‹¼å†™çº é”™</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SUGGET key prefix</span><br><span class=\"line\">  [FUZZY]</span><br><span class=\"line\">  [WITHSCORES]</span><br><span class=\"line\">  [WITHPAYLOADS]</span><br><span class=\"line\">  [MAX num]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>prefix</code></td>\n<td>ç”¨æˆ·è¾“å…¥å‰ç¼€</td>\n</tr>\n<tr>\n<td><code>FUZZY</code></td>\n<td>æ¨¡ç³ŠåŒ¹é…ï¼ˆå…è®¸æ‹¼å†™é”™è¯¯ï¼‰</td>\n</tr>\n<tr>\n<td><code>WITHSCORES</code></td>\n<td>è¿”å›æƒé‡</td>\n</tr>\n<tr>\n<td><code>WITHPAYLOADS</code></td>\n<td>è¿”å› payload</td>\n</tr>\n<tr>\n<td><code>MAX</code></td>\n<td>æœ€å¤§è¿”å›æ•°é‡</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SUGGET sug:search <span class=\"string\">&quot;ip&quot;</span> MAX 5</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) <span class=\"string\">&quot;iphone 15&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;iphone&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;ipad&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">FT.SUGGET sug:search <span class=\"string\">&quot;iphne&quot;</span> FUZZY</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) <span class=\"string\">&quot;iphone 15&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;iphone&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">FT.SUGGET sug:search <span class=\"string\">&quot;ip&quot;</span> WITHSCORES WITHPAYLOADS</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) <span class=\"string\">&quot;iphone 15&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;70.71067810058594&quot;</span></span><br><span class=\"line\">3) (nil)</span><br><span class=\"line\">4) <span class=\"string\">&quot;iphone&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;44.72135925292969&quot;</span></span><br><span class=\"line\">6) (nil)</span><br><span class=\"line\">7) <span class=\"string\">&quot;ipad&quot;</span></span><br><span class=\"line\">8) <span class=\"string\">&quot;28.86751365661621&quot;</span></span><br><span class=\"line\">9) <span class=\"string\">&quot;category=tablet&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3ï¸âƒ£-FT-SUGDEL-â€”â€”-åˆ é™¤è¡¥å…¨è¯\">3ï¸âƒ£ FT.SUGDEL â€”â€” åˆ é™¤è¡¥å…¨è¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»è¡¥å…¨è¯åº“ä¸­ç§»é™¤æŒ‡å®šè¯æ¡</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ç”¨äº å•†å“ä¸‹æ¶ã€æ•æ„Ÿè¯ç§»é™¤ã€è¿‡æœŸå…³é”®è¯æ¸…ç†</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SUGDEL key string</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SUGDEL sug:search <span class=\"string\">&quot;iphone&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"4ï¸âƒ£-FT-SUGLEN-â€”â€”-æŸ¥çœ‹è¯åº“è§„æ¨¡\">4ï¸âƒ£ FT.SUGLEN â€”â€” æŸ¥çœ‹è¯åº“è§„æ¨¡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å–å½“å‰è¯åº“çš„è¯æ¡æ•°é‡</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SUGLEN key</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SUGLEN sug:search</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¤ºä¾‹ä»£ç \">ç¤ºä¾‹ä»£ç </h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SpringBoot çš„ RedisTemplate ä¸­æ²¡æœ‰æä¾›å¯¹<code>AutoSuggest</code>çš„å°è£…ï¼Œéœ€è¦è‡ªå·±å°è£…ï¼Œæˆ‘è¿™é‡Œå°è£…äº†ä¸€ä¸ªç®€æ˜“çš„<code>RedisSuggestTool</code></p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.example.demo.redissug;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * è¡¥å…¨å»ºè®®å·¥å…·ç±»</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisSuggestTool</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> &lt;T&gt; T <span class=\"title function_\">executeLua</span><span class=\"params\">(String script, List&lt;String&gt; keys, Object... args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (T) stringRedisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, Object.class),</span><br><span class=\"line\">                keys,</span><br><span class=\"line\">                Arrays.stream(args)</span><br><span class=\"line\">                        .map(String::valueOf)</span><br><span class=\"line\">                        .toArray(String[]::<span class=\"keyword\">new</span>)</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ·»åŠ  / æ›´æ–°è¡¥å…¨è¯</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * FT.SUGADD key string score</span></span><br><span class=\"line\"><span class=\"comment\">     * [INCR]</span></span><br><span class=\"line\"><span class=\"comment\">     * [PAYLOAD payload]</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key     ç´¢å¼•åç§°</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value   è¡¥å…¨æ–‡æœ¬</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> score   åˆ†æ•°</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> incr    æ˜¯å¦é€’å¢ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> payload è¡¥å…¨è¯çš„é™„åŠ ä¿¡æ¯ï¼Œé»˜è®¤ä¸ºç©º</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Long <span class=\"title function_\">sugAdd</span><span class=\"params\">(String key,</span></span><br><span class=\"line\"><span class=\"params\">                       String value,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"type\">double</span> score,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"type\">boolean</span> incr,</span></span><br><span class=\"line\"><span class=\"params\">                       String payload)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">lua</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">                local args = &#123;&#x27;FT.SUGADD&#x27;, KEYS[1], ARGV[1], ARGV[2]&#125;</span></span><br><span class=\"line\"><span class=\"string\">                if ARGV[3] == &#x27;1&#x27; then table.insert(args, &#x27;INCR&#x27;) end</span></span><br><span class=\"line\"><span class=\"string\">                if ARGV[4] ~= &#x27;&#x27; then table.insert(args, &#x27;PAYLOAD&#x27;); table.insert(args, ARGV[4]) end</span></span><br><span class=\"line\"><span class=\"string\">                return redis.call(unpack(args))</span></span><br><span class=\"line\"><span class=\"string\">                &quot;&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> executeLua(</span><br><span class=\"line\">                lua,</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                value,</span><br><span class=\"line\">                score,</span><br><span class=\"line\">                incr ? <span class=\"string\">&quot;1&quot;</span> : <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">                payload == <span class=\"literal\">null</span> ? <span class=\"string\">&quot;&quot;</span> : payload</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Long <span class=\"title function_\">sugAdd</span><span class=\"params\">(String key,</span></span><br><span class=\"line\"><span class=\"params\">                       String value,</span></span><br><span class=\"line\"><span class=\"params\">                       <span class=\"type\">double</span> score)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sugAdd(key, value, score, <span class=\"literal\">false</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æŸ¥è¯¢è¡¥å…¨å»ºè®®</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * FT.SUGGET key prefix</span></span><br><span class=\"line\"><span class=\"comment\">     * [FUZZY]</span></span><br><span class=\"line\"><span class=\"comment\">     * [WITHSCORES]</span></span><br><span class=\"line\"><span class=\"comment\">     * [WITHPAYLOADS]</span></span><br><span class=\"line\"><span class=\"comment\">     * [MAX num]</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key          ç´¢å¼•åç§°</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> prefix       å‰ç¼€</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> fuzzy        æ˜¯å¦æ¨¡ç³ŠåŒ¹é…ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> withScores   æ˜¯å¦è¿”å›åˆ†æ•°ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> withPayloads æ˜¯å¦è¿”å›é™„åŠ ä¿¡æ¯ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> max           æœ€å¤§è¿”å›æ•°é‡ï¼Œé»˜è®¤ä¸º5</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Suggestion&gt; <span class=\"title function_\">sugGet</span><span class=\"params\">(String key,</span></span><br><span class=\"line\"><span class=\"params\">                                   String prefix,</span></span><br><span class=\"line\"><span class=\"params\">                                   <span class=\"type\">boolean</span> fuzzy,</span></span><br><span class=\"line\"><span class=\"params\">                                   <span class=\"type\">boolean</span> withScores,</span></span><br><span class=\"line\"><span class=\"params\">                                   <span class=\"type\">boolean</span> withPayloads,</span></span><br><span class=\"line\"><span class=\"params\">                                   <span class=\"type\">int</span> max)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">lua</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">                local args = &#123;&#x27;FT.SUGGET&#x27;, KEYS[1], ARGV[1]&#125;</span></span><br><span class=\"line\"><span class=\"string\">                if ARGV[2] == &#x27;1&#x27; then table.insert(args, &#x27;FUZZY&#x27;) end</span></span><br><span class=\"line\"><span class=\"string\">                if ARGV[3] == &#x27;1&#x27; then table.insert(args, &#x27;WITHSCORES&#x27;) end</span></span><br><span class=\"line\"><span class=\"string\">                if ARGV[4] == &#x27;1&#x27; then table.insert(args, &#x27;WITHPAYLOADS&#x27;) end</span></span><br><span class=\"line\"><span class=\"string\">                if tonumber(ARGV[5]) &gt; 0 then table.insert(args, &#x27;MAX&#x27;); table.insert(args, ARGV[5]) end</span></span><br><span class=\"line\"><span class=\"string\">                return redis.call(unpack(args))</span></span><br><span class=\"line\"><span class=\"string\">                &quot;&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;Object&gt; raw = executeLua(</span><br><span class=\"line\">                lua,</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                prefix,</span><br><span class=\"line\">                fuzzy ? <span class=\"string\">&quot;1&quot;</span> : <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">                withScores ? <span class=\"string\">&quot;1&quot;</span> : <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">                withPayloads ? <span class=\"string\">&quot;1&quot;</span> : <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">                max</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> parseSuggestionResult(raw, withScores, withPayloads);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ç»“æœè§£æå™¨</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;Suggestion&gt; <span class=\"title function_\">parseSuggestionResult</span><span class=\"params\">(List&lt;Object&gt; raw,</span></span><br><span class=\"line\"><span class=\"params\">                                                   <span class=\"type\">boolean</span> withScores,</span></span><br><span class=\"line\"><span class=\"params\">                                                   <span class=\"type\">boolean</span> withPayloads)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (raw == <span class=\"literal\">null</span> || raw.isEmpty()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;Suggestion&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">step</span> <span class=\"operator\">=</span> <span class=\"number\">1</span></span><br><span class=\"line\">                + (withScores ? <span class=\"number\">1</span> : <span class=\"number\">0</span>)</span><br><span class=\"line\">                + (withPayloads ? <span class=\"number\">1</span> : <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; raw.size(); i += step) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">idx</span> <span class=\"operator\">=</span> i;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> String.valueOf(raw.get(idx++));</span><br><span class=\"line\">            <span class=\"type\">Double</span> <span class=\"variable\">score</span> <span class=\"operator\">=</span> withScores ? Double.valueOf(String.valueOf(raw.get(idx++))) : <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">payload</span> <span class=\"operator\">=</span> withPayloads ? String.valueOf(raw.get(idx++)) : <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            list.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Suggestion</span>(value, score, payload));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> list;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆ é™¤è¡¥å…¨è¯</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * FT.SUGDEL key string</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key   ç´¢å¼•åç§°</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value è¡¥å…¨è¯</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Boolean <span class=\"title function_\">sugDel</span><span class=\"params\">(String key, String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">lua</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;FT.SUGDEL&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> executeLua(</span><br><span class=\"line\">                lua,</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                value</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> Long.valueOf(<span class=\"number\">1</span>).equals(result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * è·å–è¡¥å…¨è¯æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * FT.SUGLEN key</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key ç´¢å¼•åç§°</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Long <span class=\"title function_\">sugLen</span><span class=\"params\">(String key)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">lua</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;FT.SUGLEN&#x27;, KEYS[1])&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> executeLua(</span><br><span class=\"line\">                lua,</span><br><span class=\"line\">                Collections.singletonList(key)</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Suggestion</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String value;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double score;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String payload;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch ä¸­ AutoSuggest æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RediSearch çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub AutoSuggest æœç´¢å»ºè®®ï¼ˆè‡ªåŠ¨è¡¥å…¨ï¼‰ Suggest æœ¬è´¨è§£å†³çš„é—®é¢˜ï¼šâ€œå½“ç”¨æˆ·åªè¾“å…¥éƒ¨åˆ†å‰ç¼€æ—¶ï¼Œå¦‚ä½•é«˜æ€§èƒ½åœ°ç»™å‡ºå€™é€‰è¯ï¼Œè€Œä¸æ˜¯å…¨æ–‡æœç´¢ç»“æœã€‚â€ Suggest èƒ½è§£å†³ä»€ä¹ˆä¸šåŠ¡é—®é¢˜? ä¸šåŠ¡ç—›ç‚¹ ä¼ ç»Ÿæ–¹æ¡ˆé—®é¢˜ Suggest çš„ä»·å€¼ æœç´¢æ¡†è‡ªåŠ¨è¡¥å…¨ LIKE / æ¨¡ç³ŠæŸ¥è¯¢æ€§èƒ½å·® O(logN) çº§å‰ç¼€åŒ¹é… çƒ­é—¨è¯æ¨è éœ€è¦é¢å¤–ç»Ÿè®¡ç³»ç»Ÿ å†…ç½® score æ’åº æ‹¼å†™ä¸å‡†ç¡® æ™®é€šå‰ç¼€æ— æ³•å‘½ä¸­ FUZZY æ¨¡ç³ŠåŒ¹é… è”æƒ³æç¤º æœç´¢ç´¢å¼•è¿‡é‡ Suggest ç‹¬ç«‹ç»“æ„ï¼Œè½»é‡ é«˜å¹¶å‘æç¤º æ•°æ®åº“å‹åŠ›å¤§ Redis å†…å­˜çº§åå å®æ—¶æ›´æ–° ç¦»çº¿è¯åº“å¤æ‚ åŠ¨æ€å¢åˆ  Suggest å‘½ä»¤ä¸ä½¿ç”¨åœºæ™¯å¯¹ç…§è¡¨ å‘½ä»¤ ä½œç”¨ å…¸å‹ä½¿ç”¨åœºæ™¯ æ˜¯å¦é«˜é¢‘ FT.SUGADD æ·»åŠ  / æ›´æ–°è¡¥å…¨è¯ æ„å»ºè¯åº“ã€åŠ¨æ€çƒ­è¯æ›´æ–° â­â­â­â­ FT.SUGGET æŸ¥è¯¢è¡¥å…¨å»ºè®® ç”¨æˆ·è¾“å…¥è”æƒ³æç¤º â­â­â­â­â­ FT.SUGDEL åˆ é™¤è¡¥å…¨è¯ è¯ä¸‹æ¶ã€æ¸…ç†è„æ•°æ® â­â­ FT.SUGLEN ç»Ÿè®¡è¡¥å…¨è¯æ•°é‡ ç›‘æ§ã€å®¹é‡è¯„ä¼° â­ åœºæ™¯ â†’ å‘½ä»¤æ˜ å°„æ€»ç»“è¡¨ï¼ˆæ¨èæ”¶è—ï¼‰ ä¸šåŠ¡ç›®æ ‡ æ¨èå‘½ä»¤ç»„åˆ è¯´æ˜ è‡ªåŠ¨è¡¥å…¨ SUGADD + SUGGET åŸºç¡€èƒ½åŠ› çƒ­è¯æ’è¡Œ SUGADD(INCR) + SUGGET(WITHSCORES) æƒé‡é©±åŠ¨ æ‹¼å†™çº é”™ SUGGET(FUZZY) å®¹é”™ åˆ†ç±»æ¨è SUGADD(PAYLOAD) + SUGGET(WITHPAYLOADS) æºå¸¦ä¸šåŠ¡ä¿¡æ¯ è¯åº“æ²»ç† SUGDEL + SUGLEN è¿ç»´ å®¹é‡ç›‘æ§ SUGLEN è§„æ¨¡è¯„ä¼° ğŸ‘‰ åŸåˆ™ï¼šè¾“å…¥æ¡†æç¤ºç”¨ Suggestï¼Œæœç´¢ç»“æœç”¨ FT.SEARCHã€‚ 1ï¸âƒ£ FT.SUGADD â€”â€” æ·»åŠ  / æ›´æ–°è¡¥å…¨è¯ å‘è¡¥å…¨è¯åº“ä¸­æ·»åŠ ä¸€ä¸ªå€™é€‰è¯ å¯è®¾ç½® æƒé‡ã€payload å¯ç”¨äº çƒ­è¯æ’åº è¯­æ³• 123FT.SUGADD key string score [INCR] [PAYLOAD payload] å‚æ•°è¯´æ˜ å‚æ•° å«ä¹‰ key Suggestion è¯åº“ Keyï¼Œç´¢å¼•åç§° string è¡¥å…¨æ–‡æœ¬ score æƒé‡ï¼ˆè¶Šå¤§è¶Šé å‰ï¼‰ INCR é€’å¢ï¼Œç´¯åŠ æƒé‡ PAYLOAD é™„åŠ å…ƒæ•°æ® ç¤ºä¾‹ 12345678FT.SUGADD sug:search &quot;iphone&quot; 100FT.SUGADD sug:search &quot;iphone 15&quot; 200FT.SUGADD sug:search &quot;ipad&quot; 50 PAYLOAD &quot;category=tablet&quot;# æŸ¥çœ‹ç±»å‹127.0.0.1:6379&gt; type sug:search## è¾“å‡ºtrietype0 2ï¸âƒ£ FT.SUGGET â€”â€” è·å–è¡¥å…¨å»ºè®® æ ¹æ® å‰ç¼€ è¿”å›æœ€ç›¸å…³çš„å€™é€‰è¯ æ”¯æŒæ¨¡ç³ŠåŒ¹é… å¯è¿”å› payload / score å¯ç”¨äº æœç´¢æ¡†è¾“å…¥è”æƒ³ã€æ‹¼å†™çº é”™ è¯­æ³• 12345FT.SUGGET key prefix [FUZZY] [WITHSCORES] [WITHPAYLOADS] [MAX num] å‚æ•°è¯´æ˜ å‚æ•° å«ä¹‰ prefix ç”¨æˆ·è¾“å…¥å‰ç¼€ FUZZY æ¨¡ç³ŠåŒ¹é…ï¼ˆå…è®¸æ‹¼å†™é”™è¯¯ï¼‰ WITHSCORES è¿”å›æƒé‡ WITHPAYLOADS è¿”å› payload MAX æœ€å¤§è¿”å›æ•°é‡ ç¤ºä¾‹ 12345678910111213141516171819202122FT.SUGGET sug:search &quot;ip&quot; MAX 5## è¾“å‡º1) &quot;iphone 15&quot;2) &quot;iphone&quot;3) &quot;ipad&quot;FT.SUGGET sug:search &quot;iphne&quot; FUZZY## è¾“å‡º1) &quot;iphone 15&quot;2) &quot;iphone&quot;FT.SUGGET sug:search &quot;ip&quot; WITHSCORES WITHPAYLOADS## è¾“å‡º1) &quot;iphone 15&quot;2) &quot;70.71067810058594&quot;3) (nil)4) &quot;iphone&quot;5) &quot;44.72135925292969&quot;6) (nil)7) &quot;ipad&quot;8) &quot;28.86751365661621&quot;9) &quot;category=tablet&quot; 3ï¸âƒ£ FT.SUGDEL â€”â€” åˆ é™¤è¡¥å…¨è¯ ä»è¡¥å…¨è¯åº“ä¸­ç§»é™¤æŒ‡å®šè¯æ¡ å¯ç”¨äº å•†å“ä¸‹æ¶ã€æ•æ„Ÿè¯ç§»é™¤ã€è¿‡æœŸå…³é”®è¯æ¸…ç† è¯­æ³• 1FT.SUGDEL key string ç¤ºä¾‹ 1FT.SUGDEL sug:search &quot;iphone&quot; 4ï¸âƒ£ FT.SUGLEN â€”â€” æŸ¥çœ‹è¯åº“è§„æ¨¡ è·å–å½“å‰è¯åº“çš„è¯æ¡æ•°é‡ è¯­æ³• 1FT.SUGLEN key ç¤ºä¾‹ 123FT.SUGLEN sug:search## è¾“å‡º(integer) 3 ç¤ºä¾‹ä»£ç  SpringBoot çš„ RedisTemplate ä¸­æ²¡æœ‰æä¾›å¯¹AutoSuggestçš„å°è£…ï¼Œéœ€è¦è‡ªå·±å°è£…ï¼Œæˆ‘è¿™é‡Œå°è£…äº†ä¸€ä¸ªç®€æ˜“çš„RedisSuggestTool 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193package com.example.demo.redissug;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.data.redis.core.StringRedisTemplate;import org.springframework.data.redis.core.script.DefaultRedisScript;import org.springframework.stereotype.Component;import java.util.ArrayList;import java.util.Arrays;import java.util.Collections;import java.util.List;/** * è¡¥å…¨å»ºè®®å·¥å…·ç±» */@Componentpublic class RedisSuggestTool &#123; @Autowired private StringRedisTemplate stringRedisTemplate; @SuppressWarnings(&quot;unchecked&quot;) private &lt;T&gt; T executeLua(String script, List&lt;String&gt; keys, Object... args) &#123; return (T) stringRedisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, Object.class), keys, Arrays.stream(args) .map(String::valueOf) .toArray(String[]::new) ); &#125; /** * æ·»åŠ  / æ›´æ–°è¡¥å…¨è¯ * &lt;p&gt; * FT.SUGADD key string score * [INCR] * [PAYLOAD payload] * * @param key ç´¢å¼•åç§° * @param value è¡¥å…¨æ–‡æœ¬ * @param score åˆ†æ•° * @param incr æ˜¯å¦é€’å¢ï¼Œé»˜è®¤ä¸ºfalse * @param payload è¡¥å…¨è¯çš„é™„åŠ ä¿¡æ¯ï¼Œé»˜è®¤ä¸ºç©º */ public Long sugAdd(String key, String value, double score, boolean incr, String payload) &#123; String lua = &quot;&quot;&quot; local args = &#123;&#x27;FT.SUGADD&#x27;, KEYS[1], ARGV[1], ARGV[2]&#125; if ARGV[3] == &#x27;1&#x27; then table.insert(args, &#x27;INCR&#x27;) end if ARGV[4] ~= &#x27;&#x27; then table.insert(args, &#x27;PAYLOAD&#x27;); table.insert(args, ARGV[4]) end return redis.call(unpack(args)) &quot;&quot;&quot;; return executeLua( lua, Collections.singletonList(key), value, score, incr ? &quot;1&quot; : &quot;0&quot;, payload == null ? &quot;&quot; : payload ); &#125; public Long sugAdd(String key, String value, double score) &#123; return sugAdd(key, value, score, false, &quot;&quot;); &#125; /** * æŸ¥è¯¢è¡¥å…¨å»ºè®® * &lt;p&gt; * FT.SUGGET key prefix * [FUZZY] * [WITHSCORES] * [WITHPAYLOADS] * [MAX num] * * @param key ç´¢å¼•åç§° * @param prefix å‰ç¼€ * @param fuzzy æ˜¯å¦æ¨¡ç³ŠåŒ¹é…ï¼Œé»˜è®¤ä¸ºfalse * @param withScores æ˜¯å¦è¿”å›åˆ†æ•°ï¼Œé»˜è®¤ä¸ºfalse * @param withPayloads æ˜¯å¦è¿”å›é™„åŠ ä¿¡æ¯ï¼Œé»˜è®¤ä¸ºfalse * @param max æœ€å¤§è¿”å›æ•°é‡ï¼Œé»˜è®¤ä¸º5 */ public List&lt;Suggestion&gt; sugGet(String key, String prefix, boolean fuzzy, boolean withScores, boolean withPayloads, int max) &#123; String lua = &quot;&quot;&quot; local args = &#123;&#x27;FT.SUGGET&#x27;, KEYS[1], ARGV[1]&#125; if ARGV[2] == &#x27;1&#x27; then table.insert(args, &#x27;FUZZY&#x27;) end if ARGV[3] == &#x27;1&#x27; then table.insert(args, &#x27;WITHSCORES&#x27;) end if ARGV[4] == &#x27;1&#x27; then table.insert(args, &#x27;WITHPAYLOADS&#x27;) end if tonumber(ARGV[5]) &gt; 0 then table.insert(args, &#x27;MAX&#x27;); table.insert(args, ARGV[5]) end return redis.call(unpack(args)) &quot;&quot;&quot;; List&lt;Object&gt; raw = executeLua( lua, Collections.singletonList(key), prefix, fuzzy ? &quot;1&quot; : &quot;0&quot;, withScores ? &quot;1&quot; : &quot;0&quot;, withPayloads ? &quot;1&quot; : &quot;0&quot;, max ); return parseSuggestionResult(raw, withScores, withPayloads); &#125; // ç»“æœè§£æå™¨ private List&lt;Suggestion&gt; parseSuggestionResult(List&lt;Object&gt; raw, boolean withScores, boolean withPayloads) &#123; if (raw == null || raw.isEmpty()) &#123; return Collections.emptyList(); &#125; List&lt;Suggestion&gt; list = new ArrayList&lt;&gt;(); int step = 1 + (withScores ? 1 : 0) + (withPayloads ? 1 : 0); for (int i = 0; i &lt; raw.size(); i += step) &#123; int idx = i; String value = String.valueOf(raw.get(idx++)); Double score = withScores ? Double.valueOf(String.valueOf(raw.get(idx++))) : null; String payload = withPayloads ? String.valueOf(raw.get(idx++)) : null; list.add(new Suggestion(value, score, payload)); &#125; return list; &#125; /** * åˆ é™¤è¡¥å…¨è¯ * &lt;p&gt; * FT.SUGDEL key string * * @param key ç´¢å¼•åç§° * @param value è¡¥å…¨è¯ */ public Boolean sugDel(String key, String value) &#123; String lua = &quot;return redis.call(&#x27;FT.SUGDEL&#x27;, KEYS[1], ARGV[1])&quot;; Object result = executeLua( lua, Collections.singletonList(key), value ); return Long.valueOf(1).equals(result); &#125; /** * è·å–è¡¥å…¨è¯æ•°é‡ * &lt;p&gt; * FT.SUGLEN key * * @param key ç´¢å¼•åç§° */ public Long sugLen(String key) &#123; String lua = &quot;return redis.call(&#x27;FT.SUGLEN&#x27;, KEYS[1])&quot;; return executeLua( lua, Collections.singletonList(key) ); &#125;&#125;@Data@AllArgsConstructor@NoArgsConstructorpublic class Suggestion &#123; private String value; private Double score; private String payload;&#125;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch ä¸­ AutoSuggest æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RediSearch çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub","date_published":"2026-01-06T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2026/01/05/redis7-module-RediSearch-study/","url":"https://blog.hanqunfeng.com/2026/01/05/redis7-module-RediSearch-study/","title":"RediSearch å¼€å‘å®æˆ˜","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch çš„ä½¿ç”¨æ–¹æ³•</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\">RediSearch çš„å®‰è£…å‚è§ <a href=\"/2025/12/26/redis7-module-RediSearch/\" title=\"Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•</a></li>\n<li class=\"lvl-2\">ç¤ºä¾‹ä»£ç ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo\">GitHub</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RediSearch-å‘½ä»¤\">RediSearch å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºäº†å±•ç¤ºå‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•ï¼Œè¿™é‡Œä»¥JSONæ–‡æ¡£è¿›è¡Œç´¢å¼•ï¼Œåˆå§‹åŒ–æ•°æ®å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JSON.SET user:10001 $ <span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;Alice Bob&quot;,&quot;age&quot;:28,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:199.99,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:59.9,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a phone&quot;,&quot;items&quot;:[&quot;SpringCloudæŠ€æœ¯æŒ‡å—&quot;,&quot;Shellè„šæœ¬åŸºç¡€&quot;]&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">JSON.SET user:10002 $ <span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;Bob Frank&quot;,&quot;age&quot;:35,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:899.0,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a iphone&quot;,&quot;items&quot;:[&quot;Linuxå¿…çŸ¥å¿…ä¼š&quot;,&quot;Javaå¤šçº¿ç¨‹è¯¦è§£&quot;]&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">JSON.SET user:10003 $ <span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;Carol&quot;,&quot;age&quot;:22,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:19.9,&quot;status&quot;:&quot;CANCELLED&quot;&#125;],&quot;comment&quot;: &quot;I have a mobile&quot;,&quot;items&quot;:[&quot;MySQLä»åˆ åº“åˆ°è·‘è·¯&quot;,&quot;Oracleå¼€å‘å®è·µ&quot;]&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">JSON.SET user:10004 $ <span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;David Bob&quot;,&quot;age&quot;:41,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:1200,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:300,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a car&quot;,&quot;items&quot;:[&quot;SpringæŠ€æœ¯æŒ‡å—&quot;,&quot;RocketMQç”±æµ…å…¥æ·±&quot;]&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">JSON.SET user:10005 $ <span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;Eve&quot;,&quot;age&quot;:30,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:88.8,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a pencil&quot;,&quot;items&quot;:[&quot;Kafkaä»é›¶å¼€å§‹&quot;,&quot;Javaç”±æµ…å…¥æ·±&quot;]&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">JSON.SET user:10006 $ <span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;Frank&quot;,&quot;age&quot;:27,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:499,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:129,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a phone&quot;,&quot;items&quot;:[&quot;Rediså¼€å‘å®æˆ˜&quot;,&quot;MongoDBä»å…¥é—¨åˆ°å®æˆ˜&quot;]&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">JSON.SET user:10007 $ <span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;Grace&quot;,&quot;age&quot;:33,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:999.9,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a book&quot;,&quot;items&quot;:[&quot;Androidå¼€å‘æ‰‹å†Œ&quot;,&quot;Gradleä»é›¶å¼€å§‹&quot;]&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">JSON.SET user:10008 $ <span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;Henry&quot;,&quot;age&quot;:45,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:59.9,&quot;status&quot;:&quot;CANCELLED&quot;&#125;],&quot;comment&quot;: &quot;I have a macbook&quot;,&quot;items&quot;:[&quot;SpringBootæŠ€æœ¯æŒ‡å—&quot;,&quot;Mavenç”±æµ…å…¥æ·±&quot;]&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">JSON.SET user:10009 $ <span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;Ivy&quot;,&quot;age&quot;:26,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:299,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:199,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a watch&quot;,&quot;items&quot;:[&quot;Springèä¼šè´µé€š&quot;,&quot;JavaæŠ€æœ¯å¼€å‘æŒ‡å—&quot;]&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">JSON.SET user:10010 $ <span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;Jack&quot;,&quot;age&quot;:38,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:150,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a apple&quot;,&quot;items&quot;:[&quot;SpringæŠ€æœ¯æŒ‡å—&quot;,&quot;Javaç”±æµ…å…¥æ·±&quot;]&#125;&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SpringBootæš‚æ—¶æ²¡æœ‰æ”¯æŒ RediSearch ï¼Œä½ å¯ä»¥ç¼–å†™Luaè„šæœ¬æ¥å®ç°ç›¸åº”çš„åŠŸèƒ½ï¼Œå¦å¤– <a href=\"https://redisson.pro/docs/data-and-services/services/#redisearch-service\">Redisson</a>å·²ç»æä¾›äº†å¯¹ RediSearch çš„æ”¯æŒï¼Œä¸‹é¢ç»“åˆå‘½ä»¤ç»™å‡ºä»£ç ç¤ºä¾‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- å¼•å…¥ Redisson ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œç°åœ¨æœ€æ–°ç‰ˆæ˜¯ 4.0.0ï¼Œéœ€è¦ springboot 4.x --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.redisson<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.52.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šç”¨ä»£ç </p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> RedissonClient redissonClient;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">RSearch</span> <span class=\"variable\">rSearch</span> <span class=\"operator\">=</span> redissonClient.getSearch(StringCodec.INSTANCE);</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¸€ã€ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ç±»\">ä¸€ã€ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>æ ¸å¿ƒå‚æ•°</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>FT.CREATE</code></td>\n<td>åˆ›å»ºç´¢å¼•</td>\n<td>ç´¢å¼•åã€ONã€PREFIXã€SCHEMA</td>\n<td>è§ä¸‹</td>\n</tr>\n<tr>\n<td><code>FT.ALTER</code></td>\n<td>ç»™å·²æœ‰ç´¢å¼•æ–°å¢å­—æ®µ</td>\n<td>ç´¢å¼•åã€SCHEMA ADD</td>\n<td>è§ä¸‹</td>\n</tr>\n<tr>\n<td><code>FT.DROPINDEX</code></td>\n<td>åˆ é™¤ç´¢å¼•</td>\n<td>ç´¢å¼•åã€DD</td>\n<td>è§ä¸‹</td>\n</tr>\n<tr>\n<td><code>FT.INFO</code></td>\n<td>æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</td>\n<td>ç´¢å¼•å</td>\n<td>è§ä¸‹</td>\n</tr>\n<tr>\n<td><code>FT._LIST</code></td>\n<td>åˆ—å‡ºæ‰€æœ‰ç´¢å¼•</td>\n<td>æ— </td>\n<td>è§ä¸‹</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1ï¸âƒ£-FT-CREATE\">1ï¸âƒ£ FT.CREATE</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FT.CREATE åŸºæœ¬è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.CREATE index_name</span><br><span class=\"line\">[ON HASH | JSON]</span><br><span class=\"line\">[PREFIX count prefix ...]</span><br><span class=\"line\">[FILTER filter]</span><br><span class=\"line\">[LANGUAGE default_lang]</span><br><span class=\"line\">[LANGUAGE_FIELD lang_attribute]</span><br><span class=\"line\">[SCORE default_score]</span><br><span class=\"line\">[SCORE_FIELD score_attribute]</span><br><span class=\"line\">[PAYLOAD_FIELD payload_attribute]</span><br><span class=\"line\">[MAXTEXTFIELDS]</span><br><span class=\"line\">[TEMPORARY seconds]</span><br><span class=\"line\">[NOOFFSETS] [NOHL] [NOFIELDS] [NOFREQS]</span><br><span class=\"line\">[STOPWORDS count stopword ...]</span><br><span class=\"line\">[SKIPINITIALSCAN]</span><br><span class=\"line\">SCHEMA</span><br><span class=\"line\">  field_name [AS <span class=\"built_in\">alias</span>] TEXT | TAG | NUMERIC | GEO | VECTOR</span><br><span class=\"line\">  [SORTABLE [UNF]]</span><br><span class=\"line\">  [NOINDEX]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FT.CREATE å‚æ•°è¯´æ˜è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ä½œç”¨è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>index_name</code></td>\n<td>ç´¢å¼•åç§°</td>\n</tr>\n<tr>\n<td><code>ON HASH | JSON</code></td>\n<td>æŒ‡å®šç´¢å¼•æ•°æ®æ¥æºç±»å‹ï¼Œé»˜è®¤ <code>HASH</code></td>\n</tr>\n<tr>\n<td><code>PREFIX count prefix...</code></td>\n<td>æŒ‡å®šç´¢å¼• Key å‰ç¼€</td>\n</tr>\n<tr>\n<td><code>FILTER filter</code></td>\n<td>å¯¹ç´¢å¼•æ•°æ®è®¾ç½®è¿‡æ»¤è¡¨è¾¾å¼</td>\n</tr>\n<tr>\n<td><code>LANGUAGE</code></td>\n<td>æŒ‡å®šé»˜è®¤åˆ†è¯è¯­è¨€ï¼ˆé»˜è®¤ englishï¼Œä¸­æ–‡æ˜¯ chineseï¼‰</td>\n</tr>\n<tr>\n<td><code>LANGUAGE_FIELD</code></td>\n<td>æŒ‡å®šæ–‡æ¡£ä¸­çš„è¯­è¨€å­—æ®µ</td>\n</tr>\n<tr>\n<td><code>SCORE</code></td>\n<td>è®¾ç½®æ–‡æ¡£é»˜è®¤è¯„åˆ†</td>\n</tr>\n<tr>\n<td><code>SCORE_FIELD</code></td>\n<td>ä»å­—æ®µä¸­è¯»å–è¯„åˆ†</td>\n</tr>\n<tr>\n<td><code>PAYLOAD_FIELD</code></td>\n<td>æŒ‡å®šå­˜å‚¨çš„äºŒè¿›åˆ¶è´Ÿè½½å­—æ®µ</td>\n</tr>\n<tr>\n<td><code>MAXTEXTFIELDS</code></td>\n<td>å…è®¸æ›´å¤š TEXT å­—æ®µï¼ˆæ¶ˆè€—æ›´å¤šå†…å­˜ï¼‰</td>\n</tr>\n<tr>\n<td><code>TEMPORARY seconds</code></td>\n<td>åˆ›å»ºä¸´æ—¶ç´¢å¼•ï¼Œè¶…æ—¶åè‡ªåŠ¨åˆ é™¤</td>\n</tr>\n<tr>\n<td><code>NOOFFSETS</code></td>\n<td>ä¸å­˜å‚¨æ–‡æœ¬åç§»é‡ï¼ˆèŠ‚çœå†…å­˜ï¼‰</td>\n</tr>\n<tr>\n<td><code>NOHL</code></td>\n<td>ç¦ç”¨é«˜äº®</td>\n</tr>\n<tr>\n<td><code>NOFIELDS</code></td>\n<td>ä¸ä¿å­˜å­—æ®µå†…å®¹</td>\n</tr>\n<tr>\n<td><code>NOFREQS</code></td>\n<td>ä¸ä¿å­˜è¯é¢‘ä¿¡æ¯</td>\n</tr>\n<tr>\n<td><code>STOPWORDS count ...</code></td>\n<td>æŒ‡å®šåœç”¨è¯</td>\n</tr>\n<tr>\n<td><code>SKIPINITIALSCAN</code></td>\n<td>åˆ›å»ºç´¢å¼•æ—¶ä¸æ‰«æå·²æœ‰æ•°æ®</td>\n</tr>\n<tr>\n<td><code>SCHEMA</code></td>\n<td>ç´¢å¼•å­—æ®µå®šä¹‰èµ·å§‹</td>\n</tr>\n<tr>\n<td><code>AS alias</code></td>\n<td>å­—æ®µåˆ«å</td>\n</tr>\n<tr>\n<td><code>TEXT</code></td>\n<td>å…¨æ–‡ç´¢å¼•å­—æ®µ</td>\n</tr>\n<tr>\n<td><code>TAG</code></td>\n<td>ç²¾ç¡®åŒ¹é…å­—æ®µ</td>\n</tr>\n<tr>\n<td><code>NUMERIC</code></td>\n<td>æ•°å€¼å­—æ®µ</td>\n</tr>\n<tr>\n<td><code>GEO</code></td>\n<td>åœ°ç†ä½ç½®å­—æ®µ</td>\n</tr>\n<tr>\n<td><code>VECTOR</code></td>\n<td>å‘é‡å­—æ®µ</td>\n</tr>\n<tr>\n<td><code>SORTABLE</code></td>\n<td>å…è®¸æ’åº</td>\n</tr>\n<tr>\n<td><code>UNF</code></td>\n<td>ä¸è§„èŒƒåŒ–æ’åº</td>\n</tr>\n<tr>\n<td><code>NOINDEX</code></td>\n<td>å­—æ®µä¸å‚ä¸ç´¢å¼•</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FT.CREATE çš„æ ¸å¿ƒè¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.CREATE &lt;index&gt;</span><br><span class=\"line\">[ON HASH | JSON]</span><br><span class=\"line\">[PREFIX count prefix ...]</span><br><span class=\"line\">[LANGUAGE default_lang]</span><br><span class=\"line\">SCHEMA</span><br><span class=\"line\">  field_name [AS <span class=\"built_in\">alias</span>] TEXT | TAG | NUMERIC | GEO | VECTOR</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç´¢å¼•ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.CREATE idx:user</span><br><span class=\"line\">  ON JSON</span><br><span class=\"line\">  PREFIX 1 user:</span><br><span class=\"line\">  LANGUAGE chinese</span><br><span class=\"line\">  SCHEMA</span><br><span class=\"line\">    $.name AS name TEXT</span><br><span class=\"line\">    $.age AS age NUMERIC SORTABLE</span><br><span class=\"line\">    $.orders[*].amount AS amount NUMERIC</span><br><span class=\"line\">    $.orders[*].status AS status TAG</span><br><span class=\"line\">    $.comment AS comment TEXT</span><br><span class=\"line\">    $.items[*] AS items TEXT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">  <span class=\"comment\"># idx:userï¼šç´¢å¼•å</span></span><br><span class=\"line\">  <span class=\"comment\"># ON JSONï¼šç´¢å¼• JSON æ–‡æ¡£ï¼ŒRediSearch ä»…æ”¯æŒå¯¹ HASH å’Œ JSON è¿›è¡Œç´¢å¼•</span></span><br><span class=\"line\">  <span class=\"comment\"># PREFIX 1 user: ï¼šç´¢å¼•æŒ‡å®š key å‰ç¼€ï¼Œ1 è¡¨ç¤ºç´¢å¼•ä¸€ä¸ªï¼Œuser: è¡¨ç¤ºç´¢å¼•çš„ key å‰ç¼€ï¼Œå¦‚æœç´¢å¼•ä¸¤ä¸ªï¼šPREFIX 2 user: order:</span></span><br><span class=\"line\">  <span class=\"comment\"># LANGUAGE chineseï¼šæŒ‡å®šé»˜è®¤åˆ†è¯è¯­è¨€ï¼Œé»˜è®¤æ˜¯è‹±æ–‡ englishï¼Œä¸­æ–‡æ˜¯ chineseï¼Œå¦‚æœç´¢å¼•ä¸­æœ‰ä¸­æ–‡ï¼Œåˆ™å¿…é¡»æŒ‡å®š LANGUAGE ä¸º chinese</span></span><br><span class=\"line\">  <span class=\"comment\"># SCHEMAï¼šç´¢å¼•å­—æ®µ</span></span><br><span class=\"line\">  <span class=\"comment\"># $.name AS name TEXTï¼šç´¢å¼•å­—æ®µ $.name(æ³¨æ„ï¼šJSONç±»å‹ä»¥ $. å¼€å¤´ï¼ŒHashç±»å‹å°±ä¸éœ€è¦äº†)ï¼Œå­—æ®µåˆ«åä¸º nameï¼Œå­—æ®µç±»å‹ä¸º TEXT</span></span><br><span class=\"line\">  <span class=\"comment\"># ASï¼šå­—æ®µåˆ«åï¼ˆæŸ¥è¯¢æ—¶ä½¿ç”¨ï¼‰</span></span><br><span class=\"line\">  <span class=\"comment\"># TEXT / NUMERIC / TAGï¼šå­—æ®µç±»å‹ï¼Œè¿™å‡ ä¸ªæ˜¯æœ€å¸¸ç”¨çš„</span></span><br><span class=\"line\">  <span class=\"comment\"># SORTABLEï¼šNUMERICã€TAGã€TEXT æˆ– GEO ç±»å‹çš„å­—æ®µå¯ä»¥å¸¦æœ‰ä¸€ä¸ªå¯é€‰çš„ SORTABLE å‚æ•°ï¼Œè¡¨ç¤ºä¸ºå­—æ®µå»ºç«‹ä¸“é—¨çš„æ’åºæ•°æ®ç»“æ„ï¼ˆç±»ä¼¼åˆ—å¼å­˜å‚¨ï¼‰ï¼Œä»è€Œé¿å…åœ¨æŸ¥è¯¢é˜¶æ®µå¯¹å¤§é‡ç»“æœè¿›è¡Œä¸´æ—¶æ’åºã€‚</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rSearch.createIndex(</span><br><span class=\"line\">    <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">    IndexOptions.defaults()</span><br><span class=\"line\">            .on(IndexType.JSON)</span><br><span class=\"line\">            .prefix(List.of(<span class=\"string\">&quot;user:&quot;</span>))</span><br><span class=\"line\">            .language(<span class=\"string\">&quot;chinese&quot;</span>),</span><br><span class=\"line\">    FieldIndex.text(<span class=\"string\">&quot;$.name&quot;</span>).as(<span class=\"string\">&quot;name&quot;</span>),</span><br><span class=\"line\">    FieldIndex.numeric(<span class=\"string\">&quot;$.age&quot;</span>).as(<span class=\"string\">&quot;age&quot;</span>),</span><br><span class=\"line\">    FieldIndex.numeric(<span class=\"string\">&quot;$.orders[*].amount&quot;</span>).as(<span class=\"string\">&quot;amount&quot;</span>),</span><br><span class=\"line\">    FieldIndex.tag(<span class=\"string\">&quot;$.orders[*].status&quot;</span>).as(<span class=\"string\">&quot;status&quot;</span>),</span><br><span class=\"line\">    FieldIndex.text(<span class=\"string\">&quot;$.comment&quot;</span>).as(<span class=\"string\">&quot;comment&quot;</span>),</span><br><span class=\"line\">    FieldIndex.text(<span class=\"string\">&quot;$.items[*]&quot;</span>).as(<span class=\"string\">&quot;items&quot;</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç´¢å¼•å­—æ®µçš„ç±»å‹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µç±»å‹</th>\n<th>ä¸­æ–‡åç§°</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n<th>å¤‡æ³¨ / é™åˆ¶</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>TEXT</strong></td>\n<td>å…¨æ–‡æ–‡æœ¬å­—æ®µ</td>\n<td>æ”¯æŒå¯¹å­—æ®µå€¼è¿›è¡Œå…¨æ–‡æ£€ç´¢ï¼ˆåˆ†è¯ã€ç›¸å…³åº¦è®¡ç®—ã€æ¨¡ç³ŠåŒ¹é…ç­‰ï¼‰</td>\n<td>æ–‡ç« å†…å®¹ã€ç”¨æˆ·åã€æè¿°ä¿¡æ¯</td>\n<td>æ”¯æŒæƒé‡ï¼ˆWEIGHTï¼‰ã€æ’åºï¼ˆSORTABLEï¼‰ç­‰é€‰é¡¹</td>\n</tr>\n<tr>\n<td><strong>TAG</strong></td>\n<td>æ ‡ç­¾å­—æ®µ / ç²¾ç¡®åŒ¹é…å­—æ®µ</td>\n<td>æ”¯æŒç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼Œé€‚ç”¨äºæšä¸¾å€¼æˆ–ç¦»æ•£åˆ†ç±»</td>\n<td>åˆ†ç±»ã€çŠ¶æ€ã€ä¸»é”®ã€ç±»å‹å­—æ®µ</td>\n<td>ä¸åˆ†è¯ï¼›å¯è‡ªå®šä¹‰åˆ†éš”ç¬¦</td>\n</tr>\n<tr>\n<td><strong>NUMERIC</strong></td>\n<td>æ•°å€¼å­—æ®µ</td>\n<td>æ”¯æŒæ•°å€¼èŒƒå›´æŸ¥è¯¢</td>\n<td>å¹´é¾„ã€ä»·æ ¼ã€åˆ†æ•°ã€æ—¶é—´æˆ³</td>\n<td>æ”¯æŒåŒºé—´æŸ¥è¯¢ï¼ˆ<code>[min max]</code>ï¼‰</td>\n</tr>\n<tr>\n<td><strong>GEO</strong></td>\n<td>åœ°ç†ä½ç½®å­—æ®µï¼ˆç‚¹ï¼‰</td>\n<td>æ”¯æŒä»¥â€œç‚¹â€ä¸ºä¸­å¿ƒçš„åŠå¾„èŒƒå›´æŸ¥è¯¢</td>\n<td>é—¨åº—ä½ç½®ã€ç”¨æˆ·ä½ç½®</td>\n<td>å€¼æ ¼å¼å¿…é¡»ä¸º <code>&quot;ç»åº¦,çº¬åº¦&quot;</code></td>\n</tr>\n<tr>\n<td><strong>VECTOR</strong></td>\n<td>å‘é‡å­—æ®µ</td>\n<td>æ”¯æŒå‘é‡ç›¸ä¼¼åº¦æœç´¢ï¼ˆKNN ç­‰ï¼‰</td>\n<td>è¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿã€Embedding å‘é‡</td>\n<td>éœ€è¦ <strong>Query Dialect â‰¥ 2</strong>ï¼ˆRediSearch â‰¥ 2.4ï¼‰</td>\n</tr>\n<tr>\n<td><strong>GEOSHAPE</strong></td>\n<td>åœ°ç†å½¢çŠ¶å­—æ®µï¼ˆå¤šè¾¹å½¢ï¼‰</td>\n<td>æ”¯æŒå¤šè¾¹å½¢ç©ºé—´æŸ¥è¯¢</td>\n<td>è¡Œæ”¿åŒºã€å•†åœˆã€åœ°å›¾åŒºåŸŸ</td>\n<td>ä½¿ç”¨ WKT æ ¼å¼ï¼›ä¸æ”¯æŒ JSON å¤šå€¼å’Œ SORTABLE</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>GEOSHAPE å­—æ®µè¡¥å……è¯´æ˜</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>é¡¹ç›®</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ•°æ®æ ¼å¼</td>\n<td>WKTï¼ˆWell-Known Textï¼‰æ ¼å¼ï¼Œå¦‚ï¼š<code>POLYGON((x1 y1, x2 y2, ...))</code></td>\n</tr>\n<tr>\n<td>åæ ‡ç³»ç»Ÿ</td>\n<td><code>SPHERICAL</code>ï¼ˆçƒé¢åæ ‡ï¼Œç»çº¬åº¦ï¼‰<br><code>FLAT</code>ï¼ˆå¹³é¢åæ ‡ï¼Œç¬›å¡å°” X/Yï¼‰</td>\n</tr>\n<tr>\n<td>é»˜è®¤åæ ‡ç³»ç»Ÿ</td>\n<td><code>SPHERICAL</code></td>\n</tr>\n<tr>\n<td>å½“å‰é™åˆ¶</td>\n<td>âŒ ä¸æ”¯æŒ JSON å¤šå€¼<br>âŒ ä¸æ”¯æŒ <code>SORTABLE</code> é€‰é¡¹</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ç´¢å¼•å­—æ®µç±»å‹é€‰å‹å»ºè®®</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>ä½¿ç”¨åœºæ™¯</th>\n<th>æ¨èå­—æ®µç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å…¨æ–‡æ£€ç´¢</td>\n<td><strong>TEXT</strong></td>\n<td>æ”¯æŒåˆ†è¯ã€ç›¸å…³åº¦è®¡ç®—ã€æ¨¡ç³ŠåŒ¹é…ç­‰å…¨æ–‡æœç´¢èƒ½åŠ›</td>\n</tr>\n<tr>\n<td>ç²¾ç¡®è¿‡æ»¤ / åˆ†ç±»</td>\n<td><strong>TAG</strong></td>\n<td>ç²¾ç¡®åŒ¹é…ï¼Œä¸åˆ†è¯ï¼Œé€‚åˆæšä¸¾å€¼ã€çŠ¶æ€ã€ç±»å‹ç­‰å­—æ®µ</td>\n</tr>\n<tr>\n<td>åŒºé—´ç­›é€‰ / æ’åº</td>\n<td><strong>NUMERIC</strong></td>\n<td>æ”¯æŒæ•°å€¼åŒºé—´æŸ¥è¯¢ä¸æ’åºï¼Œé€‚åˆä»·æ ¼ã€æ—¶é—´ã€åˆ†æ•°ç­‰</td>\n</tr>\n<tr>\n<td>é™„è¿‘çš„äºº / é—¨åº—</td>\n<td><strong>GEO</strong></td>\n<td>åŸºäºç»çº¬åº¦ç‚¹è¿›è¡ŒåŠå¾„èŒƒå›´æŸ¥è¯¢</td>\n</tr>\n<tr>\n<td>è¯­ä¹‰æœç´¢ / å‘é‡å¬å›</td>\n<td><strong>VECTOR</strong></td>\n<td>åŸºäºå‘é‡ç›¸ä¼¼åº¦ï¼ˆKNNï¼‰çš„è¯­ä¹‰æœç´¢ï¼Œéœ€è¦ Dialect â‰¥ 2</td>\n</tr>\n<tr>\n<td>å¤æ‚åœ°ç†åŒºåŸŸåˆ¤æ–­</td>\n<td><strong>GEOSHAPE</strong></td>\n<td>æ”¯æŒå¤šè¾¹å½¢ï¼ˆPolygonï¼‰åŒºåŸŸæŸ¥è¯¢ï¼Œé€‚åˆè¡Œæ”¿åŒºã€å•†åœˆç­‰</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>å“ªäº›å­—æ®µé€‚åˆä½¿ç”¨ SORTABLE</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µç±»å‹</th>\n<th>æ˜¯å¦é€‚åˆ SORTABLE</th>\n<th>åŸå› </th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NUMERIC</td>\n<td>âœ… å¼ºçƒˆæ¨è</td>\n<td>æ•°å€¼æ’åºæœ€å¸¸è§ï¼Œå¦‚ä»·æ ¼ã€æ—¶é—´ã€è¯„åˆ†</td>\n</tr>\n<tr>\n<td>TAG</td>\n<td>âš ï¸ è§†æƒ…å†µ</td>\n<td>ä¸€èˆ¬ç”¨äºè¿‡æ»¤ï¼Œæ’åºæ„ä¹‰ä¸å¤§</td>\n</tr>\n<tr>\n<td>TEXT</td>\n<td>âš ï¸ è°¨æ…</td>\n<td>æ–‡æœ¬å¯èƒ½å¾ˆå¤§ï¼Œå†…å­˜å¼€é”€é«˜</td>\n</tr>\n<tr>\n<td>GEO</td>\n<td>âš ï¸ ç‰¹æ®Šåœºæ™¯</td>\n<td>é€šå¸¸æŒ‰è·ç¦»æ’åºï¼Œæ›´å¤šä¾èµ– <code>GEOFILTER</code></td>\n</tr>\n</tbody>\n</table>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«ï¼šå¦‚ä½•åœ¨redisç»ˆç«¯è¾“å…¥å¤šè¡Œçš„å‘½ä»¤ï¼Ÿ</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">å…ˆè¯´ç»“è®ºï¼šredisç»ˆç«¯ ä¸æ”¯æŒå¤šè¡Œè¾“å…¥ï¼Œä½†å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¾“å…¥å¤šè¡Œå‘½ä»¤ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">HSET user:1 \\</span></span><br><span class=\"line\"><span class=\"string\">name Tom \\</span></span><br><span class=\"line\"><span class=\"string\">age 18 \\</span></span><br><span class=\"line\"><span class=\"string\">city Beijing</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">è¿™ç§æ–¹æ³•æ˜¯åˆ©ç”¨äº† Bash çš„èƒ½åŠ›ï¼Œå³ <code>&lt;&lt;EOF</code> åé¢çš„å†…å®¹ä¼šä½œä¸ºæ ‡å‡†è¾“å…¥ï¼Œç›´åˆ° <code>EOF</code> ä¸ºæ­¢ï¼Œå¹¶é€šè¿‡ <code>\\</code> ç¬¦æ¢è¡Œã€‚</li>\n<li class=\"lvl-2\">å¦‚æœåœ¨VSCodeä¸­ï¼Œå¯ä»¥é€‰ä¸­è¦åˆå¹¶çš„å¤šè¡Œå†…å®¹ï¼Œç„¶åé€šè¿‡ <code>Ctrl + Shift + J</code> å¿«æ·é”®å°†å¤šè¡Œåˆå¹¶åˆ°ä¸€è¡Œã€‚</li>\n</ul>\n</div>\n<h4 id=\"2ï¸âƒ£-FT-ALTER\">2ï¸âƒ£ FT.ALTER</h4>\n<blockquote>\n<p>âš ï¸ åªèƒ½ æ–°å¢å­—æ®µï¼Œä¸èƒ½ä¿®æ”¹æˆ–åˆ é™¤å·²æœ‰å­—æ®µ</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.ALTER idx:user SCHEMA ADD $.vip AS vip TAG</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rSearch.alter(</span><br><span class=\"line\">        <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">        <span class=\"literal\">false</span>,</span><br><span class=\"line\">        FieldIndex.tag(<span class=\"string\">&quot;$.vip&quot;</span>).as(<span class=\"string\">&quot;vip&quot;</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h4 id=\"3ï¸âƒ£-FT-DROPINDEX\">3ï¸âƒ£ FT.DROPINDEX</h4>\n<blockquote>\n<p>âš ï¸ åˆ é™¤ç´¢å¼•</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.DROPINDEX idx:user</span><br><span class=\"line\"><span class=\"comment\"># âš ï¸ DDï¼šåˆ é™¤ç´¢å¼•çš„åŒæ—¶åˆ é™¤è¢«ç´¢å¼•æ•°æ®ï¼Œè°¨æ…ä½¿ç”¨</span></span><br><span class=\"line\">FT.DROPINDEX idx:user DD</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rSearch.dropIndex(<span class=\"string\">&quot;idx:user&quot;</span>);</span><br><span class=\"line\">rSearch.dropIndexAndDocuments(<span class=\"string\">&quot;idx:user&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"4ï¸âƒ£-FT-INFO\">4ï¸âƒ£ <a href=\"http://FT.INFO\">FT.INFO</a></h4>\n<blockquote>\n<p>æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.INFO idx:user</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">IndexInfo</span> <span class=\"variable\">info</span> <span class=\"operator\">=</span> rSearch.info(<span class=\"string\">&quot;idx:user&quot;</span>);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>é‡ç‚¹å…³æ³¨å­—æ®µ</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>å«ä¹‰</th>\n<th>è§£é‡Š</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>num_docs</code></td>\n<td><strong>å½“å‰è¢«ç´¢å¼•ã€å¯è¢«æœç´¢çš„æ–‡æ¡£æ•°é‡</strong></td>\n<td>user:10001 ~ user:10010ï¼Œ10æ¡æ–‡æ¡£</td>\n</tr>\n<tr>\n<td><code>num_terms</code></td>\n<td><strong>è¯å…¸ä¸­å”¯ä¸€è¯é¡¹ term çš„æ•°é‡</strong><br><strong>ä¸»è¦æ¥æºäº TEXTï¼ˆnameï¼‰ å’Œ TAGï¼ˆvip, statusï¼‰ å­—æ®µå»é‡ä¹‹åçš„æ•°é‡</strong></td>\n<td>name: alice, bob, carol, â€¦<br>vip: yes, no<br>status: PAID, CREATED, CANCELLED<br></td>\n</tr>\n<tr>\n<td><code>num_records</code></td>\n<td><strong>å€’æ’ç´¢å¼•ä¸­çš„è®°å½•æ¡ç›®æ€»æ•°</strong><br><strong>æ‰€æœ‰ term åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­çš„å‡ºç°æ¬¡æ•°ä¹‹å’Œ</strong></td>\n<td>JSON æ•°ç»„å­—æ®µ orders[],æ¯ä¸ª order éƒ½ä¼šç”Ÿæˆç‹¬ç«‹çš„ç´¢å¼• entry<br>å¤šå€¼å­—æ®µ Ã— å¤šæ–‡æ¡£ = record çˆ†ç‚¸å¼å¢é•¿<br><br>num_records çœŸæ­£å½±å“ï¼šå†…å­˜ã€æŸ¥è¯¢é€Ÿåº¦ã€èšåˆæˆæœ¬</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"5ï¸âƒ£-FT-LIST\">5ï¸âƒ£ FT._LIST</h4>\n<blockquote>\n<p>åˆ—å‡ºæ‰€æœ‰ç´¢å¼•</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT._LIST</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;String&gt; indexes = rSearch.getIndexes();</span><br></pre></td></tr></table></figure>\n<h3 id=\"äºŒã€æŸ¥è¯¢ç±»ï¼ˆæ ¸å¿ƒï¼‰\">äºŒã€æŸ¥è¯¢ç±»ï¼ˆæ ¸å¿ƒï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>é€‚ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>FT.SEARCH</code></td>\n<td>æ ‡å‡†æœç´¢</td>\n<td>90% åœºæ™¯</td>\n</tr>\n<tr>\n<td><code>FT.AGGREGATE</code></td>\n<td>åˆ†ç»„ / ç»Ÿè®¡ / èšåˆ</td>\n<td>æŠ¥è¡¨ã€åˆ†æ</td>\n</tr>\n<tr>\n<td><code>FT.HYBRID</code></td>\n<td>æ–‡æœ¬ + å‘é‡æ··åˆ</td>\n<td>å‘é‡æœç´¢</td>\n</tr>\n<tr>\n<td><code>FT.EXPLAIN</code></td>\n<td>æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’</td>\n<td>è°ƒä¼˜</td>\n</tr>\n<tr>\n<td><code>FT.EXPLAINCLI</code></td>\n<td>CLI å¯è¯»æ‰§è¡Œè®¡åˆ’</td>\n<td>è°ƒè¯•</td>\n</tr>\n<tr>\n<td><code>FT.PROFILE</code></td>\n<td>æ€§èƒ½åˆ†æ</td>\n<td>æ…¢æŸ¥è¯¢</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1ï¸âƒ£-FT-SEARCH\">1ï¸âƒ£ FT.SEARCH</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FT.SEARCH åŸºæœ¬è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SEARCH index query</span><br><span class=\"line\">[NOCOENTENT] [VERBATIM] [NOSTOPWORDS]</span><br><span class=\"line\">[WITHSCORES] [WITHPAYLOADS] [WITHSORTKEYS]</span><br><span class=\"line\">[FILTER numeric_field min max ...]</span><br><span class=\"line\">[GEOFILTER geo_field lon lat radius m|km|mi|ft]</span><br><span class=\"line\">[INKEYS count key ...]</span><br><span class=\"line\">[INFIELDS count field ...]</span><br><span class=\"line\">[RETURN count identifier [AS property] ...]</span><br><span class=\"line\">[SUMMARIZE FIELDS count field ... FRAGS num LEN fragsize SEPARATOR sep]</span><br><span class=\"line\">[HIGHLIGHT FIELDS count field ... TAGS open close]</span><br><span class=\"line\">[SLOP slop] [TIMEOUT <span class=\"built_in\">timeout</span>] [INORDER]</span><br><span class=\"line\">[LANGUAGE language]</span><br><span class=\"line\">[EXPANDER expander]</span><br><span class=\"line\">[SCORER scorer]</span><br><span class=\"line\">[EXPLAINSCORE]</span><br><span class=\"line\">[PAYLOAD payload]</span><br><span class=\"line\">[SORTBY sortby ASC|DESC]</span><br><span class=\"line\">[LIMIT offset num]</span><br><span class=\"line\">[PARAMS nargs name value ...]</span><br><span class=\"line\">[DIALECT dialect]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FT.SEARCH å‚æ•°è¯´æ˜è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ä½œç”¨è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>index</code></td>\n<td>ç´¢å¼•åç§°</td>\n</tr>\n<tr>\n<td><code>query</code></td>\n<td>æŸ¥è¯¢æ¡ä»¶ï¼ˆç±»ä¼¼ SQL WHEREï¼‰</td>\n</tr>\n<tr>\n<td><code>NOCONTENT</code></td>\n<td>ä»…è¿”å›æ–‡æ¡£ IDï¼Œä¸è¿”å›å†…å®¹</td>\n</tr>\n<tr>\n<td><code>VERBATIM</code></td>\n<td>ç¦ç”¨æŸ¥è¯¢ä¼˜åŒ–ï¼Œå®Œå…¨æŒ‰åŸæŸ¥è¯¢æ‰§è¡Œ</td>\n</tr>\n<tr>\n<td><code>NOSTOPWORDS</code></td>\n<td>æŸ¥è¯¢æ—¶ä¸å¿½ç•¥åœç”¨è¯</td>\n</tr>\n<tr>\n<td><code>WITHSCORES</code></td>\n<td>è¿”å›åŒ¹é…æ–‡æ¡£çš„ç›¸å…³æ€§è¯„åˆ†</td>\n</tr>\n<tr>\n<td><code>WITHPAYLOADS</code></td>\n<td>è¿”å›æ–‡æ¡£çš„ payload æ•°æ®</td>\n</tr>\n<tr>\n<td><code>WITHSORTKEYS</code></td>\n<td>è¿”å›æ’åºä½¿ç”¨çš„ key</td>\n</tr>\n<tr>\n<td><code>FILTER</code></td>\n<td>æ•°å€¼å­—æ®µè¿‡æ»¤ï¼ˆèŒƒå›´æŸ¥è¯¢ï¼‰</td>\n</tr>\n<tr>\n<td><code>GEOFILTER</code></td>\n<td>åœ°ç†ä½ç½®èŒƒå›´æŸ¥è¯¢</td>\n</tr>\n<tr>\n<td><code>INKEYS</code></td>\n<td>ä»…åœ¨æŒ‡å®šçš„ key é›†åˆä¸­æœç´¢</td>\n</tr>\n<tr>\n<td><code>INFIELDS</code></td>\n<td>ä»…åœ¨æŒ‡å®šå­—æ®µä¸­æœç´¢</td>\n</tr>\n<tr>\n<td><code>RETURN</code></td>\n<td>æŒ‡å®šè¿”å›çš„å­—æ®µ</td>\n</tr>\n<tr>\n<td><code>SUMMARIZE</code></td>\n<td>è¿”å›å­—æ®µå†…å®¹æ‘˜è¦</td>\n</tr>\n<tr>\n<td><code>HIGHLIGHT</code></td>\n<td>é«˜äº®åŒ¹é…çš„å…³é”®è¯</td>\n</tr>\n<tr>\n<td><code>SLOP</code></td>\n<td>è®¾ç½®çŸ­è¯­æŸ¥è¯¢ä¸­å…è®¸çš„è¯è·</td>\n</tr>\n<tr>\n<td><code>TIMEOUT</code></td>\n<td>è®¾ç½®æŸ¥è¯¢è¶…æ—¶æ—¶é—´</td>\n</tr>\n<tr>\n<td><code>INORDER</code></td>\n<td>çŸ­è¯­å¿…é¡»æŒ‰é¡ºåºåŒ¹é…</td>\n</tr>\n<tr>\n<td><code>LANGUAGE</code></td>\n<td>æŒ‡å®šæŸ¥è¯¢è¯­è¨€</td>\n</tr>\n<tr>\n<td><code>EXPANDER</code></td>\n<td>ä½¿ç”¨è‡ªå®šä¹‰æŸ¥è¯¢æ‰©å±•å™¨</td>\n</tr>\n<tr>\n<td><code>SCORER</code></td>\n<td>ä½¿ç”¨è‡ªå®šä¹‰è¯„åˆ†å‡½æ•°</td>\n</tr>\n<tr>\n<td><code>EXPLAINSCORE</code></td>\n<td>è¿”å›è¯„åˆ†è®¡ç®—è¯¦æƒ…</td>\n</tr>\n<tr>\n<td><code>PAYLOAD</code></td>\n<td>ç»™è¯„åˆ†å‡½æ•°ä¼ å…¥è‡ªå®šä¹‰å‚æ•°</td>\n</tr>\n<tr>\n<td><code>SORTBY</code></td>\n<td>æŒ‰æŒ‡å®šå­—æ®µæ’åº</td>\n</tr>\n<tr>\n<td><code>ASC / DESC</code></td>\n<td>æ’åºæ–¹å‘</td>\n</tr>\n<tr>\n<td><code>LIMIT</code></td>\n<td>åˆ†é¡µæ§åˆ¶</td>\n</tr>\n<tr>\n<td><code>PARAMS</code></td>\n<td>å‚æ•°åŒ–æŸ¥è¯¢</td>\n</tr>\n<tr>\n<td><code>DIALECT</code></td>\n<td>æŒ‡å®šæŸ¥è¯¢è¯­æ³•ç‰ˆæœ¬</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FT.SEARCH æ ¸å¿ƒè¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SEARCH index</span><br><span class=\"line\">query</span><br><span class=\"line\">[RETURN count identifier [AS property] ...]</span><br><span class=\"line\">[SORTBY sortby ASC|DESC]</span><br><span class=\"line\">[LIMIT offset num]</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æ ‡å‡†æœç´¢</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SEARCH idx:user</span><br><span class=\"line\">  <span class=\"string\">&#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27;</span></span><br><span class=\"line\">  RETURN 3 name status amount</span><br><span class=\"line\">  SORTBY amount DESC</span><br><span class=\"line\">  LIMIT 0 10</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\">  <span class=\"comment\"># æŸ¥è¯¢æ¡ä»¶ï¼š&#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27;</span></span><br><span class=\"line\">  <span class=\"comment\"># æŸ¥è¯¢æ¡ä»¶è¯­æ³•ï¼š</span></span><br><span class=\"line\">  <span class=\"comment\"># &#x27;xxx&#x27;: å…¨æ–‡æ£€ç´¢åŒ…å« xxx çš„æ•°æ®ï¼Œä¼šä» TEXT å­—æ®µä¸­åŒ¹é…</span></span><br><span class=\"line\">  <span class=\"comment\"># &#x27;@field:value&#x27;: åŒ¹é…å­—æ®µ field çš„å€¼æ˜¯ valueï¼Œè¦æ±‚ field çš„ç±»å‹ä¸º TEXTï¼Œå…¨æ–‡æ£€ç´¢</span></span><br><span class=\"line\">  <span class=\"comment\"># &#x27;@field:&#123;xxx&#125;&#x27;:ç²¾ç¡®åŒ¹é…ï¼Œ&#123;xxx*&#125;:åŒ¹é…å‰ç¼€ï¼Œ&#123;xxx|yyy&#125;:åŒ¹é…ä»»æ„ä¸€ä¸ªï¼Œè¦æ±‚ field çš„ç±»å‹ä¸º TAG</span></span><br><span class=\"line\">  <span class=\"comment\"># &#x27;@field:[min max]&#x27;: èŒƒå›´åŒ¹é…ï¼Œè¿™é‡Œ +inf è¡¨ç¤ºæ­£æ— ç©·å¤§ï¼Œè¦æ±‚ field çš„ç±»å‹ä¸º NUMERIC</span></span><br><span class=\"line\">  <span class=\"comment\"># å¤šä¸ªæ¡ä»¶ç©ºæ ¼åˆ†éš”</span></span><br><span class=\"line\">  <span class=\"comment\"># æ¨¡ç³ŠåŒ¹é…ï¼š* è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œå³åŒ¹é…æ‰€æœ‰</span></span><br><span class=\"line\"><span class=\"comment\"># RETURN 3 name status amount è¿”å›å­—æ®µï¼Œ3:è¡¨ç¤ºè¿”å› 3 ä¸ªå­—æ®µ</span></span><br><span class=\"line\"><span class=\"comment\"># LIMIT 0 10 åˆ†é¡µï¼Œ0:è¡¨ç¤ºä»ç¬¬ 0 æ¡å¼€å§‹ï¼Œ10:è¡¨ç¤ºè¿”å› 10 æ¡æ•°æ®</span></span><br><span class=\"line\"><span class=\"comment\"># SORTBY amount DESC æ’åºï¼Œamount:è¡¨ç¤ºæ’åºå­—æ®µï¼ŒDESC:è¡¨ç¤ºé™åº</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">SearchResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> rSearch.search(</span><br><span class=\"line\">        <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;@status:&#123;PAID&#125; @amount:[50 +inf]&quot;</span>,</span><br><span class=\"line\">        QueryOptions.defaults()</span><br><span class=\"line\">        .returnAttributes(<span class=\"keyword\">new</span> <span class=\"title class_\">ReturnAttribute</span>(<span class=\"string\">&quot;name&quot;</span>), <span class=\"keyword\">new</span> <span class=\"title class_\">ReturnAttribute</span>(<span class=\"string\">&quot;status&quot;</span>),<span class=\"keyword\">new</span> <span class=\"title class_\">ReturnAttribute</span>(<span class=\"string\">&quot;amount&quot;</span>))</span><br><span class=\"line\">                .sortBy(<span class=\"string\">&quot;amount&quot;</span>)</span><br><span class=\"line\">                .sortOrder(SortOrder.DESC)</span><br><span class=\"line\">                .limit(<span class=\"number\">0</span>, <span class=\"number\">10</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">total</span> <span class=\"operator\">=</span> result.getTotal();</span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;total = &quot;</span> + total);</span><br><span class=\"line\">List&lt;Document&gt; docs = result.getDocuments();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (Document doc: docs) &#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">id</span> <span class=\"operator\">=</span> doc.getId();</span><br><span class=\"line\">    Map&lt;String, Object&gt; attrs = doc.getAttributes();</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;id = &quot;</span> + id + <span class=\"string\">&quot; attrs = &quot;</span> + attrs);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…¨æ–‡æ£€ç´¢ï¼Œä» æ‰€æœ‰ TEXT å­—æ®µä¸­åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œå³ phone/Phone/PHONE éƒ½åŒ¹é…</span></span><br><span class=\"line\">FT.SEARCH idx:user <span class=\"string\">&#x27;phone&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">## ç¤ºä¾‹ç»“æœ</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">2) <span class=\"string\">&quot;user:10006&quot;</span></span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;$&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;&#123;\\&quot;name\\&quot;:\\&quot;Frank\\&quot;,\\&quot;age\\&quot;:27,\\&quot;vip\\&quot;:\\&quot;no\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:499,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;,&#123;\\&quot;amount\\&quot;:129,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a phone\\&quot;,\\&quot;items\\&quot;:[\\&quot;Redis\\xe5\\xbc\\x80\\xe5\\x8f\\x91\\xe5\\xae\\x9e\\xe6\\x88\\x98\\&quot;,\\&quot;MongoDB\\xe4\\xbb\\x8e\\xe5\\x85\\xa5\\xe9\\x97\\xa8\\xe5\\x88\\xb0\\xe5\\xae\\x9e\\xe6\\x88\\x98\\&quot;]&#125;&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;user:10001&quot;</span></span><br><span class=\"line\">5) 1) <span class=\"string\">&quot;$&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;&#123;\\&quot;name\\&quot;:\\&quot;Alice Bob\\&quot;,\\&quot;age\\&quot;:28,\\&quot;vip\\&quot;:\\&quot;yes\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;,&#123;\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a phone\\&quot;,\\&quot;items\\&quot;:[\\&quot;SpringCloud\\xe6\\x8a\\x80\\xe6\\x9c\\xaf\\xe6\\x8c\\x87\\xe5\\x8d\\x97\\&quot;,\\&quot;Shell\\xe8\\x84\\x9a\\xe6\\x9c\\xac\\xe5\\x9f\\xba\\xe7\\xa1\\x80\\&quot;]&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">SearchResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> rSearch.search(</span><br><span class=\"line\">        <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;phone&quot;</span>,</span><br><span class=\"line\">        QueryOptions.defaults()</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸­æ–‡æ£€ç´¢</span></span><br><span class=\"line\">FT.SEARCH idx:user <span class=\"string\">&#x27;å¼€å§‹&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">## ç¤ºä¾‹ç»“æœ</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">2) <span class=\"string\">&quot;user:10005&quot;</span></span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;$&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;&#123;\\&quot;name\\&quot;:\\&quot;Eve\\&quot;,\\&quot;age\\&quot;:30,\\&quot;vip\\&quot;:\\&quot;no\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:88.8,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a pencil\\&quot;,\\&quot;items\\&quot;:[\\&quot;Kafka\\xe4\\xbb\\x8e\\xe9\\x9b\\xb6\\xe5\\xbc\\x80\\xe5\\xa7\\x8b\\&quot;,\\&quot;Java\\xe7\\x94\\xb1\\xe6\\xb5\\x85\\xe5\\x85\\xa5\\xe6\\xb7\\xb1\\&quot;]&#125;&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;user:10007&quot;</span></span><br><span class=\"line\">5) 1) <span class=\"string\">&quot;$&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;&#123;\\&quot;name\\&quot;:\\&quot;Grace\\&quot;,\\&quot;age\\&quot;:33,\\&quot;vip\\&quot;:\\&quot;yes\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:999.9,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a book\\&quot;,\\&quot;items\\&quot;:[\\&quot;Android\\xe5\\xbc\\x80\\xe5\\x8f\\x91\\xe6\\x89\\x8b\\xe5\\x86\\x8c\\&quot;,\\&quot;Gradle\\xe4\\xbb\\x8e\\xe9\\x9b\\xb6\\xe5\\xbc\\x80\\xe5\\xa7\\x8b\\&quot;]&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">SearchResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> rSearch.search(</span><br><span class=\"line\">        <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;å¼€å§‹&quot;</span>,</span><br><span class=\"line\">        QueryOptions.defaults()</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">çœ‹åˆ°ä¸­æ–‡è¾“å‡ºæ˜¯ä¹±ç ï¼Œå¯ä»¥åœ¨ç™»å½•å®¢æˆ·ç«¯æ—¶åŠ ä¸Š --raw</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli --user admin -a 123456 --raw</span><br><span class=\"line\">127.0.0.1:6379&gt; FT.SEARCH idx:user <span class=\"string\">&#x27;å¼€å§‹&#x27;</span></span><br><span class=\"line\">2</span><br><span class=\"line\">user:10005</span><br><span class=\"line\">$</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;Eve&quot;</span>,<span class=\"string\">&quot;age&quot;</span>:30,<span class=\"string\">&quot;vip&quot;</span>:<span class=\"string\">&quot;no&quot;</span>,<span class=\"string\">&quot;orders&quot;</span>:[&#123;<span class=\"string\">&quot;amount&quot;</span>:88.8,<span class=\"string\">&quot;status&quot;</span>:<span class=\"string\">&quot;CREATED&quot;</span>&#125;],<span class=\"string\">&quot;comment&quot;</span>:<span class=\"string\">&quot;I have a pencil&quot;</span>,<span class=\"string\">&quot;items&quot;</span>:[<span class=\"string\">&quot;Kafkaä»é›¶å¼€å§‹&quot;</span>,<span class=\"string\">&quot;Javaç”±æµ…å…¥æ·±&quot;</span>]&#125;</span><br><span class=\"line\">user:10007</span><br><span class=\"line\">$</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;Grace&quot;</span>,<span class=\"string\">&quot;age&quot;</span>:33,<span class=\"string\">&quot;vip&quot;</span>:<span class=\"string\">&quot;yes&quot;</span>,<span class=\"string\">&quot;orders&quot;</span>:[&#123;<span class=\"string\">&quot;amount&quot;</span>:999.9,<span class=\"string\">&quot;status&quot;</span>:<span class=\"string\">&quot;PAID&quot;</span>&#125;],<span class=\"string\">&quot;comment&quot;</span>:<span class=\"string\">&quot;I have a book&quot;</span>,<span class=\"string\">&quot;items&quot;</span>:[<span class=\"string\">&quot;Androidå¼€å‘æ‰‹å†Œ&quot;</span>,<span class=\"string\">&quot;Gradleä»é›¶å¼€å§‹&quot;</span>]&#125;</span><br></pre></td></tr></table></figure>\n</div>\n<h5 id=\"SQL-WHERE-ä¸-RediSearch-æŸ¥è¯¢è¯­æ³•å¯¹ç…§è¡¨\">SQL WHERE ä¸ RediSearch æŸ¥è¯¢è¯­æ³•å¯¹ç…§è¡¨</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>x/y/name</code> â†’ <code>TEXT/TAG(è¦åŠ ä¸Š&#123;&#125;)</code> å­—æ®µï¼Œ<code>num</code>â†’<code>NUMERIC</code> å­—æ®µï¼ŒæŸ¥è¯¢è¯­æ³•ç”¨äº <code>FT.SEARCH</code>/<code>FT.AGGREGATE</code> çš„æŸ¥è¯¢å­—ç¬¦ä¸²éƒ¨åˆ†</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ID</th>\n<th>SQL æ¡ä»¶</th>\n<th>RediSearch å¯¹ç­‰å†™æ³•</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td><code>WHERE x = 'book' AND y = 'phone'</code></td>\n<td><code>@x:book @y:phone</code></td>\n<td>AND ä¸ºé»˜è®¤å…³ç³»ï¼ˆç©ºæ ¼ï¼‰</td>\n</tr>\n<tr>\n<td>2</td>\n<td><code>WHERE x = 'book' AND y != 'phone'</code></td>\n<td><code>@x:book -@y:phone</code></td>\n<td><code>-</code> è¡¨ç¤º NOT</td>\n</tr>\n<tr>\n<td>3</td>\n<td><code>WHERE x = 'book' OR y = 'phone'</code></td>\n<td><code>(@x:book) | (@y:phone)</code></td>\n<td>OR å¿…é¡»æ˜¾å¼å†™ <code>|</code></td>\n</tr>\n<tr>\n<td>4</td>\n<td><code>WHERE x IN ('book','phone','hello world')</code></td>\n<td><code>@x:(book|phone|&quot;hello world&quot;)</code></td>\n<td>å¤šå€¼ ORï¼ŒçŸ­è¯­éœ€åŠ å¼•å·</td>\n</tr>\n<tr>\n<td>5</td>\n<td><code>WHERE y='book' AND x NOT IN ('book','phone')</code></td>\n<td><code>@y:book -(@x:book|@x:phone)</code></td>\n<td>NOT IN = NOT + OR</td>\n</tr>\n<tr>\n<td>6</td>\n<td><code>WHERE x NOT IN ('book','phone')</code></td>\n<td><code>-@x:(book|phone)</code></td>\n<td>æ•´ä½“å¦å®š</td>\n</tr>\n<tr>\n<td>7</td>\n<td><code>WHERE num BETWEEN 10 AND 20</code></td>\n<td><code>@num:[10 20]</code></td>\n<td>æ•°å€¼åŒºé—´ï¼ˆé—­åŒºé—´ï¼‰</td>\n</tr>\n<tr>\n<td>8</td>\n<td><code>WHERE num &gt;= 10</code></td>\n<td><code>@num:[10 +inf]</code></td>\n<td><code>+inf</code> è¡¨ç¤ºæ­£æ— ç©·</td>\n</tr>\n<tr>\n<td>9</td>\n<td><code>WHERE num &gt; 10</code></td>\n<td><code>@num:[(10 +inf]</code></td>\n<td><code>(</code> è¡¨ç¤ºä¸åŒ…å«</td>\n</tr>\n<tr>\n<td>10</td>\n<td><code>WHERE num &lt; 10</code></td>\n<td><code>@num:[-inf (10]</code></td>\n<td>å°äºï¼ˆä¸å« 10ï¼‰</td>\n</tr>\n<tr>\n<td>11</td>\n<td><code>WHERE num &lt;= 10</code></td>\n<td><code>@num:[-inf 10]</code></td>\n<td>å°äºç­‰äº</td>\n</tr>\n<tr>\n<td>12</td>\n<td><code>WHERE num &lt; 10 OR num &gt; 20</code></td>\n<td><code>@num:[-inf (10] | @num:[(20 +inf]</code></td>\n<td>æ•°å€¼ OR</td>\n</tr>\n<tr>\n<td>13</td>\n<td><code>WHERE name LIKE 'Li%'</code></td>\n<td><code>@name:Li*</code></td>\n<td>å‰ç¼€åŒ¹é…</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"2ï¸âƒ£-FT-AGGREGATE\">2ï¸âƒ£ FT.AGGREGATE</h4>\n<blockquote>\n<p>åˆ†ç»„ / ç»Ÿè®¡ / èšåˆï¼Œè¯­æ³•</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FT.AGGREGATE åŸºæœ¬è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.AGGREGATE index query</span><br><span class=\"line\">[VERBATIM]</span><br><span class=\"line\">[LOAD count field ... | LOAD *]</span><br><span class=\"line\">[TIMEOUT <span class=\"built_in\">timeout</span>]</span><br><span class=\"line\">[GROUPBY nargs property ...</span><br><span class=\"line\">   REDUCE <span class=\"keyword\">function</span> nargs arg ... [AS name] ...]</span><br><span class=\"line\">[SORTBY nargs property ASC|DESC ... [MAX num]]</span><br><span class=\"line\">[APPLY expression AS name]</span><br><span class=\"line\">[LIMIT offset num]</span><br><span class=\"line\">[FILTER filter]</span><br><span class=\"line\">[WITHCURSOR [COUNT read_size]]</span><br><span class=\"line\">[MAXIDLE idle_time]</span><br><span class=\"line\">[PARAMS nargs name value ...]</span><br><span class=\"line\">[DIALECT dialect]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FT.AGGREGATE å‚æ•°è¯´æ˜è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ä½œç”¨è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>index</code></td>\n<td>ç´¢å¼•åç§°</td>\n</tr>\n<tr>\n<td><code>query</code></td>\n<td>æŸ¥è¯¢æ¡ä»¶ï¼ˆç±»ä¼¼ WHEREï¼‰</td>\n</tr>\n<tr>\n<td><code>VERBATIM</code></td>\n<td>ç¦ç”¨æŸ¥è¯¢ä¼˜åŒ–</td>\n</tr>\n<tr>\n<td><code>LOAD</code></td>\n<td>åŠ è½½åŸå§‹å­—æ®µ</td>\n</tr>\n<tr>\n<td><code>TIMEOUT</code></td>\n<td>æŸ¥è¯¢è¶…æ—¶æ—¶é—´</td>\n</tr>\n<tr>\n<td><code>GROUPBY</code></td>\n<td>åˆ†ç»„å­—æ®µï¼ˆç±»ä¼¼ SQL GROUP BYï¼‰</td>\n</tr>\n<tr>\n<td><code>REDUCE</code></td>\n<td>èšåˆå‡½æ•°ï¼ˆCOUNT / SUM / AVG / MIN / MAX ç­‰ï¼‰</td>\n</tr>\n<tr>\n<td><code>AS</code></td>\n<td>èšåˆç»“æœåˆ«å</td>\n</tr>\n<tr>\n<td><code>SORTBY</code></td>\n<td>å¯¹èšåˆç»“æœæ’åº</td>\n</tr>\n<tr>\n<td><code>ASC / DESC</code></td>\n<td>æ’åºæ–¹å‘</td>\n</tr>\n<tr>\n<td><code>MAX</code></td>\n<td>æœ€å¤§è¿”å›æ¡æ•°</td>\n</tr>\n<tr>\n<td><code>APPLY</code></td>\n<td>å¯¹ç»“æœå­—æ®µè¿›è¡Œè¡¨è¾¾å¼è®¡ç®—</td>\n</tr>\n<tr>\n<td><code>LIMIT</code></td>\n<td>åˆ†é¡µæ§åˆ¶</td>\n</tr>\n<tr>\n<td><code>FILTER</code></td>\n<td>ç»“æœè¿‡æ»¤ï¼ˆWHERE / HAVINGï¼‰</td>\n</tr>\n<tr>\n<td><code>WITHCURSOR</code></td>\n<td>ä½¿ç”¨æ¸¸æ ‡ï¼ˆå¤§ç»“æœé›†ï¼‰</td>\n</tr>\n<tr>\n<td><code>COUNT</code></td>\n<td>æ¯æ¬¡è¯»å–æ•°é‡</td>\n</tr>\n<tr>\n<td><code>MAXIDLE</code></td>\n<td>æ¸¸æ ‡æœ€å¤§ç©ºé—²æ—¶é—´</td>\n</tr>\n<tr>\n<td><code>PARAMS</code></td>\n<td>å‚æ•°åŒ–æŸ¥è¯¢</td>\n</tr>\n<tr>\n<td><code>DIALECT</code></td>\n<td>æŸ¥è¯¢è¯­æ³•ç‰ˆæœ¬</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FT.AGGREGATE çš„æ ¸å¿ƒè¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.AGGREGATE &lt;index&gt; &lt;query&gt;</span><br><span class=\"line\">  [GROUPBY ...]</span><br><span class=\"line\">  [REDUCE ...]</span><br><span class=\"line\">  [SORTBY ...]</span><br><span class=\"line\">  [LIMIT ...]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ 1ï¼šæŒ‰ status åˆ†ç»„ç»Ÿè®¡æ•°é‡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.AGGREGATE idx:user</span><br><span class=\"line\">  <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  GROUPBY 1 @status</span><br><span class=\"line\">  REDUCE COUNT 0 AS cnt</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># *: æŸ¥è¯¢æ¡ä»¶ï¼Œ* è¡¨ç¤ºåŒ¹é…ç´¢å¼•ä¸­çš„ æ‰€æœ‰æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥æ˜¯ FT.SEARCH ä¸­çš„æŸ¥è¯¢æ¡ä»¶ï¼Œæ¯”å¦‚ï¼š&#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># GROUPBY 1 @status: åˆ†ç»„å­—æ®µ</span></span><br><span class=\"line\">  <span class=\"comment\"># 1:è¡¨ç¤ºåˆ†ç»„å­—æ®µæ•°é‡</span></span><br><span class=\"line\">  <span class=\"comment\"># @status:è¡¨ç¤ºåˆ†ç»„å­—æ®µ</span></span><br><span class=\"line\"><span class=\"comment\"># REDUCE COUNT 0 AS cnt: èšåˆå­—æ®µ</span></span><br><span class=\"line\">  <span class=\"comment\"># COUNT:èšåˆå‡½æ•°ï¼šè®¡æ•°</span></span><br><span class=\"line\">  <span class=\"comment\"># 0:å‚æ•°ä¸ªæ•°ï¼ˆCOUNT ä¸éœ€è¦å‚æ•°ï¼‰</span></span><br><span class=\"line\">  <span class=\"comment\"># AS cnt:è¡¨ç¤ºèšåˆå­—æ®µåˆ«å</span></span><br><span class=\"line\"><span class=\"comment\">## è¿”å›ç»“æœç¤ºä¾‹</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;CANCELLED&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;cnt&quot;</span></span><br><span class=\"line\">   4) <span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;PAID&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;cnt&quot;</span></span><br><span class=\"line\">   4) <span class=\"string\">&quot;6&quot;</span></span><br><span class=\"line\">4) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;CREATED&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;cnt&quot;</span></span><br><span class=\"line\">   4) <span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¹åº”SQL è¯­å¥ï¼š</span></span><br><span class=\"line\">SELECT status, COUNT(*) AS cnt</span><br><span class=\"line\">  FROM user</span><br><span class=\"line\">  GROUP BY status;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">AggregationResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> rSearch.aggregate(</span><br><span class=\"line\">        <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;*&quot;</span>,</span><br><span class=\"line\">        AggregationOptions.defaults()</span><br><span class=\"line\">                .groupBy(GroupBy.fieldNames(<span class=\"string\">&quot;@status&quot;</span>).reducers(Reducer.count().as(<span class=\"string\">&quot;cnt&quot;</span>)))</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">long</span> <span class=\"variable\">total</span> <span class=\"operator\">=</span> result.getTotal();</span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;total = &quot;</span> + total);</span><br><span class=\"line\"><span class=\"keyword\">final</span> List&lt;Map&lt;String, Object&gt;&gt; attributes = result.getAttributes();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (Map&lt;String, Object&gt; attribute : attributes) &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;attribute = &quot;</span> + attribute);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ 2ï¼šæŒ‰ status åˆ†ç»„ç»Ÿè®¡é‡‘é¢æ€»å’Œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.AGGREGATE idx:user <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  GROUPBY 1 @status</span><br><span class=\"line\">  REDUCE SUM 1 @amount AS total_amount</span><br><span class=\"line\">  SORTBY 2 @total_amount DESC</span><br><span class=\"line\">  LIMIT 0 3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># SUM:èšåˆå‡½æ•°ï¼šæ±‚å’Œ</span></span><br><span class=\"line\"><span class=\"comment\"># 1:å‚æ•°ä¸ªæ•°</span></span><br><span class=\"line\"><span class=\"comment\"># @amount:è¦å‚ä¸æ±‚å’Œçš„å­—æ®µ</span></span><br><span class=\"line\"><span class=\"comment\"># total_amount:è¡¨ç¤ºèšåˆå­—æ®µåˆ«å</span></span><br><span class=\"line\"><span class=\"comment\"># SORTBY 2 @total_amount DESC: æ’åº</span></span><br><span class=\"line\">  <span class=\"comment\"># 2: è¡¨ç¤ºåé¢è·Ÿ 2 ä¸ªå‚æ•°ï¼ˆå­—æ®µ + æ’åºæ–¹å‘ï¼‰</span></span><br><span class=\"line\">  <span class=\"comment\"># @total_amount: è¡¨ç¤ºæ’åºå­—æ®µï¼ˆREDUCE äº§ç”Ÿçš„åˆ«åï¼‰ï¼ŒDESC:è¡¨ç¤ºé™åº</span></span><br><span class=\"line\"><span class=\"comment\"># LIMIT 0 3: åˆ†é¡µï¼Œ0:è¡¨ç¤ºä»ç¬¬ 0 æ¡å¼€å§‹ï¼Œ3:è¡¨ç¤ºè¿”å› 3 æ¡æ•°æ®</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ç¤ºä¾‹ç»“æœ</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;PAID&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;total_amount&quot;</span></span><br><span class=\"line\">   4) <span class=\"string\">&quot;4096.89&quot;</span></span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;CREATED&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;total_amount&quot;</span></span><br><span class=\"line\">   4) <span class=\"string\">&quot;238.8&quot;</span></span><br><span class=\"line\">4) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;CANCELLED&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;total_amount&quot;</span></span><br><span class=\"line\">   4) <span class=\"string\">&quot;79.8&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯¹åº”SQL è¯­å¥ï¼š</span></span><br><span class=\"line\">SELECT status, SUM(amount) AS total_amount</span><br><span class=\"line\">  FROM user</span><br><span class=\"line\">  GROUP BY status</span><br><span class=\"line\">  ORDER BY total_amount DESC</span><br><span class=\"line\">  LIMIT 0 3;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">AggregationResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> rSearch.aggregate(</span><br><span class=\"line\">        <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;*&quot;</span>,</span><br><span class=\"line\">        AggregationOptions.defaults()</span><br><span class=\"line\">                .groupBy(GroupBy.fieldNames(<span class=\"string\">&quot;@status&quot;</span>)</span><br><span class=\"line\">                        .reducers(</span><br><span class=\"line\">                                Reducer.sum(<span class=\"string\">&quot;@amount&quot;</span>).as(<span class=\"string\">&quot;total_amount&quot;</span>)</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .sortBy(<span class=\"keyword\">new</span> <span class=\"title class_\">SortedField</span>(<span class=\"string\">&quot;@total_amount&quot;</span>, SortOrder.DESC))</span><br><span class=\"line\">                .limit(<span class=\"number\">0</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ 3ï¼šåŒæ—¶è¾“å‡ºæ•°é‡ + é‡‘é¢ï¼Œå¹¶æŒ‰é‡‘é¢é™åºï¼Œæ•°é‡å‡åº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.AGGREGATE idx:user <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  GROUPBY 1 @status</span><br><span class=\"line\">  REDUCE COUNT 0 AS cnt</span><br><span class=\"line\">  REDUCE SUM 1 @amount AS total_amount</span><br><span class=\"line\">  SORTBY 4 @total_amount DESC @cnt ASC</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ç¤ºä¾‹ç»“æœ</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;PAID&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;cnt&quot;</span></span><br><span class=\"line\">   4) <span class=\"string\">&quot;6&quot;</span></span><br><span class=\"line\">   5) <span class=\"string\">&quot;total_amount&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;4096.89&quot;</span></span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;CREATED&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;cnt&quot;</span></span><br><span class=\"line\">   4) <span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\">   5) <span class=\"string\">&quot;total_amount&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;238.8&quot;</span></span><br><span class=\"line\">4) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;CANCELLED&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;cnt&quot;</span></span><br><span class=\"line\">   4) <span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\">   5) <span class=\"string\">&quot;total_amount&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;79.8&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">AggregationResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> rSearch.aggregate(</span><br><span class=\"line\">        <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;*&quot;</span>,</span><br><span class=\"line\">        AggregationOptions.defaults()</span><br><span class=\"line\">                .groupBy(GroupBy.fieldNames(<span class=\"string\">&quot;@status&quot;</span>)</span><br><span class=\"line\">                        .reducers(</span><br><span class=\"line\">                                Reducer.count().as(<span class=\"string\">&quot;cnt&quot;</span>),</span><br><span class=\"line\">                                Reducer.sum(<span class=\"string\">&quot;@amount&quot;</span>).as(<span class=\"string\">&quot;total_amount&quot;</span>)</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .sortBy(<span class=\"keyword\">new</span> <span class=\"title class_\">SortedField</span>(<span class=\"string\">&quot;@total_amount&quot;</span>, SortOrder.DESC))</span><br><span class=\"line\">                .sortBy(<span class=\"keyword\">new</span> <span class=\"title class_\">SortedField</span>(<span class=\"string\">&quot;@cnt&quot;</span>, SortOrder.ASC))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ 4ï¼šæŒ‰çŠ¶æ€åˆ†ç»„ï¼Œç­›é€‰æ€»é‡‘é¢ &gt; 200</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.AGGREGATE idx:user <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  GROUPBY 1 @status</span><br><span class=\"line\">  REDUCE SUM 1 @amount AS total_amount</span><br><span class=\"line\">  FILTER @total_amount &gt; 200</span><br><span class=\"line\">  SORTBY 2 @total_amount DESC</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># FILTER: è¿‡æ»¤å™¨ï¼Œä½œç”¨åœ¨ GROUPBY + REDUCE ä¹‹åï¼Œè¯­ä¹‰ç­‰ä»·äº SQL çš„ï¼šHAVING SUM(amount) &gt; 1000</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">AggregationResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> rSearch.aggregate(</span><br><span class=\"line\">        <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;*&quot;</span>,</span><br><span class=\"line\">        AggregationOptions.defaults()</span><br><span class=\"line\">                .groupBy(GroupBy.fieldNames(<span class=\"string\">&quot;@status&quot;</span>)</span><br><span class=\"line\">                        .reducers(</span><br><span class=\"line\">                                Reducer.sum(<span class=\"string\">&quot;@amount&quot;</span>).as(<span class=\"string\">&quot;total_amount&quot;</span>)</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .filter(<span class=\"string\">&quot;@total_amount &gt; 200&quot;</span>)</span><br><span class=\"line\">                .sortBy(<span class=\"keyword\">new</span> <span class=\"title class_\">SortedField</span>(<span class=\"string\">&quot;@total_amount&quot;</span>, SortOrder.DESC))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>è¯­ä¹‰æ‰§è¡Œé¡ºåºï¼š SCAN â†’ GROUPBY â†’ REDUCE â†’ FILTER (HAVING) â†’ SORTBY â†’ LIMIT</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸è§å¯ç”¨ REDUCE å‡½æ•°</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‡½æ•°</th>\n<th>ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>COUNT</td>\n<td>è¡Œæ•°</td>\n</tr>\n<tr>\n<td>SUM</td>\n<td>æ±‚å’Œ</td>\n</tr>\n<tr>\n<td>AVG</td>\n<td>å¹³å‡</td>\n</tr>\n<tr>\n<td>MIN / MAX</td>\n<td>æå€¼</td>\n</tr>\n<tr>\n<td>TO_LIST</td>\n<td>æ”¶é›†å­—æ®µ</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"3ï¸âƒ£-FT-EXPLAIN-FT-EXPLAINCLI\">3ï¸âƒ£ FT.EXPLAIN/FT.EXPLAINCLI</h4>\n<blockquote>\n<p>æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œ ä¸ä¼šè€ƒè™‘åˆ†ç»„èšåˆï¼Œåªçœ‹æŸ¥è¯¢æ¡ä»¶ï¼Œå®ƒçš„å®šä½æ˜¯ï¼šçœ‹â€œä¼šä¸ä¼šç”¨ç´¢å¼•ã€æ€ä¹ˆç”¨ç´¢å¼•â€ï¼Œè€Œä¸æ˜¯çœ‹â€œè·‘å¾—æ…¢ä¸æ…¢â€ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.EXPLAINCLI idx:user <span class=\"string\">&#x27;@status:&#123;PAID&#125;  @amount:[100 +inf]&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">## ç¤ºä¾‹ç»“æœ</span></span><br><span class=\"line\">1) INTERSECT &#123;</span><br><span class=\"line\">2)   TAG:@status &#123;</span><br><span class=\"line\">3)     paid</span><br><span class=\"line\">4)   &#125;</span><br><span class=\"line\">5)   NUMERIC &#123;100.000000 &lt;= @amount &lt;= inf&#125;</span><br><span class=\"line\">6) &#125;</span><br><span class=\"line\">7)</span><br></pre></td></tr></table></figure>\n<h4 id=\"4ï¸âƒ£-FT-PROFILE\">4ï¸âƒ£ FT.PROFILE</h4>\n<blockquote>\n<p>æ€§èƒ½åˆ†æï¼Œçœ‹â€œè·‘å¾—æ…¢ä¸æ…¢â€ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.PROFILE idx:user</span><br><span class=\"line\">  SEARCH</span><br><span class=\"line\">  QUERY <span class=\"string\">&#x27;@status:&#123;PAID&#125;  @amount:[100 +inf]&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># SEARCH: æ ‡å‡†æŸ¥è¯¢ï¼ŒAGGREGATE: èšåˆæŸ¥è¯¢</span></span><br><span class=\"line\"><span class=\"comment\"># QUERY: æŸ¥è¯¢æ¡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\">FT.PROFILE idx:user</span><br><span class=\"line\">  AGGREGATE</span><br><span class=\"line\">  QUERY <span class=\"string\">&quot;@status:&#123;PAID&#125; @amount:[100 +inf]&quot;</span></span><br><span class=\"line\">  GROUPBY 1 @status</span><br><span class=\"line\">  REDUCE SUM 1 @amount AS total_amount</span><br></pre></td></tr></table></figure>\n<h5 id=\"å…³æ³¨æŒ‡æ ‡\">å…³æ³¨æŒ‡æ ‡</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¬¬ä¸€ä¼˜å…ˆçº§æŒ‡æ ‡ï¼ˆç›´æ¥å†³å®šæŸ¥è¯¢æ˜¯å¦æ…¢ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æŒ‡æ ‡</th>\n<th>æ‰€åœ¨ä½ç½®</th>\n<th>å«ä¹‰</th>\n<th>å¥åº·é˜ˆå€¼</th>\n<th>éœ€è¦è­¦æƒ•</th>\n<th>å¸¸è§ä¼˜åŒ–æ‰‹æ®µ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Total profile time</strong></td>\n<td>Shards â†’ Total profile time</td>\n<td>æŸ¥è¯¢åœ¨æœç´¢å¼•æ“å±‚é¢çš„æ€»è€—æ—¶ï¼ˆä¸å«ç½‘ç»œï¼‰</td>\n<td><strong>&lt; 1 msï¼šä¼˜ç§€</strong><br>1â€“10 msï¼šå¯æ¥å—</td>\n<td>&gt; 20 msï¼šéœ€è¦ä¼˜åŒ–<br>&gt; 50 msï¼šç»“æ„æ€§é—®é¢˜</td>\n<td>å‡å°‘ç»“æœé›†ã€æ‹†åˆ†æŸ¥è¯¢ã€ä¼˜åŒ–ç´¢å¼•å­—æ®µ</td>\n</tr>\n<tr>\n<td><strong>Iterator Type</strong></td>\n<td>Iterators profile â†’ Type</td>\n<td>æŸ¥è¯¢æ‰§è¡Œç­–ç•¥</td>\n<td><strong>INTERSECT / UNION</strong></td>\n<td><strong>SCAN / WILDCARD</strong></td>\n<td>å¢åŠ å¯ç´¢å¼•å­—æ®µã€é¿å…æ¨¡ç³Šå‰ç¼€</td>\n</tr>\n<tr>\n<td><strong>Estimated number of matches</strong></td>\n<td>Child iterators</td>\n<td>ç´¢å¼•å±‚ä¼°ç®—çš„å€™é€‰æ–‡æ¡£æ•°</td>\n<td><strong>&lt; 1kï¼šç†æƒ³</strong><br>1kâ€“10kï¼šå¯æ¥å—</td>\n<td>&gt; 50kï¼šè¿‡æ»¤æ¡ä»¶è¿‡å®½</td>\n<td>æ”¹ç”¨ TAG / NUMERIC / å†—ä½™å­—æ®µ</td>\n</tr>\n<tr>\n<td><strong>Loader Time</strong></td>\n<td>Result processors â†’ Loader</td>\n<td>ä» Redis åŠ è½½å¹¶ååºåˆ—åŒ–æ–‡æ¡£</td>\n<td>&lt; 30% Total time</td>\n<td>&gt; 40% Total time</td>\n<td>RETURN ç²¾ç®€å­—æ®µã€NOCONTENTã€ç¼©å° JSON</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¬¬äºŒä¼˜å…ˆçº§æŒ‡æ ‡ï¼ˆåˆ¤æ–­ç´¢å¼•æˆ–æ¨¡å‹æ˜¯å¦åˆç†ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æŒ‡æ ‡</th>\n<th>æ‰€åœ¨ä½ç½®</th>\n<th>å«ä¹‰</th>\n<th>å¥åº·é˜ˆå€¼</th>\n<th>éœ€è¦è­¦æƒ•</th>\n<th>å¸¸è§ä¼˜åŒ–æ‰‹æ®µ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Number of reading operations</strong></td>\n<td>Iterators profile</td>\n<td>å®é™…æ‰«æçš„å€’æ’è¡¨æ¡ç›®æ•°</td>\n<td>â‰ˆ Estimated matches</td>\n<td>æ˜æ˜¾å¤§äºç»“æœæ•°</td>\n<td>æé«˜å­—æ®µé€‰æ‹©æ€§ã€æ‹†åˆ†æ¡ä»¶</td>\n</tr>\n<tr>\n<td><strong>Estimated matches vs å®é™…ç»“æœæ•°</strong></td>\n<td>Iterator + Result</td>\n<td>ç´¢å¼•ä¼°ç®—ç²¾åº¦</td>\n<td>ä¼°ç®—å€¼ç•¥å¤§äºå®é™…</td>\n<td>ä¼°ç®— &gt;&gt; å®é™…ï¼ˆ10x+ï¼‰</td>\n<td>è°ƒæ•´ schemaï¼Œé¿å…ä½åŸºæ•°å­—æ®µ</td>\n</tr>\n<tr>\n<td><strong>Parsing time</strong></td>\n<td>Shards â†’ Parsing time</td>\n<td>æŸ¥è¯¢è¯­æ³•è§£æè€—æ—¶</td>\n<td>&lt; 0.1 ms</td>\n<td>&gt; 1 ms</td>\n<td>å‡å°‘åŠ¨æ€æ‹¼æ¥ã€ç®€åŒ–è¯­æ³•</td>\n</tr>\n<tr>\n<td><strong>Pipeline creation time</strong></td>\n<td>Shards â†’ Pipeline creation</td>\n<td>æ‰§è¡Œè®¡åˆ’æ„å»ºæ—¶é—´</td>\n<td>&lt; 0.05 ms</td>\n<td>&gt; 0.5 ms</td>\n<td>å‡å°‘å­å¥ã€é¿å…å¤æ‚åµŒå¥—</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»éªŒå‹â€œçº¢çº¿åˆ¤æ–­â€é€ŸæŸ¥è¡¨ï¼ˆéå¸¸å®ç”¨ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç°è±¡</th>\n<th>å«ä¹‰</th>\n<th>æ˜¯å¦å¿…é¡»å¤„ç†</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Estimated matches &gt; 100k</td>\n<td>ç´¢å¼•å­—æ®µé€‰æ‹©é”™è¯¯</td>\n<td>å¿…é¡»</td>\n</tr>\n<tr>\n<td>Iterator Type = SCAN</td>\n<td>å…¨è¡¨æ‰«æ</td>\n<td>å¿…é¡»</td>\n</tr>\n<tr>\n<td>Loader &gt; 50% æ€»è€—æ—¶</td>\n<td>è¿”å›æ•°æ®è¿‡é‡</td>\n<td>å¼ºçƒˆå»ºè®®</td>\n</tr>\n<tr>\n<td>reading ops â‰« results</td>\n<td>å€’æ’æ•ˆç‡ä½</td>\n<td>å»ºè®®</td>\n</tr>\n<tr>\n<td>Total time &gt; 20 ms</td>\n<td>åœ¨çº¿æŸ¥è¯¢é£é™©</td>\n<td>å¿…é¡»</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ¸å¿ƒæ‰§è¡Œç­–ç•¥å‹ Iteratorï¼ˆæœ€é‡è¦ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Type</th>\n<th>è¯­ä¹‰</th>\n<th>å…¸å‹è§¦å‘åœºæ™¯</th>\n<th>æ€§èƒ½ç‰¹å¾</th>\n<th>è°ƒä¼˜ç»“è®º</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>INTERSECT</strong></td>\n<td>å¤šæ¡ä»¶å–äº¤é›†ï¼ˆANDï¼‰</td>\n<td><code>@a:&#123;x&#125; @b:[1 10]</code></td>\n<td>åŸºäºæœ€å°å€’æ’è¡¨ï¼Œæ•ˆç‡æœ€é«˜</td>\n<td><strong>ç†æƒ³çŠ¶æ€ï¼Œä¼˜å…ˆä½¿ç”¨</strong></td>\n</tr>\n<tr>\n<td><strong>UNION</strong></td>\n<td>å¤šæ¡ä»¶å–å¹¶é›†ï¼ˆORï¼‰</td>\n<td><code>@a:&#123;x|y&#125;</code></td>\n<td>å€™é€‰é›†æ‰©å¤§ï¼Œéš OR æ•°é‡çº¿æ€§å¢é•¿</td>\n<td>å¯æ¥å—ï¼Œé¿å…è¿‡å¤š OR</td>\n</tr>\n<tr>\n<td><strong>SCAN</strong></td>\n<td>å…¨é‡æ‰«æ</td>\n<td>å­—æ®µæœªç´¢å¼• / JSON Path ä¸å¯ç´¢å¼•</td>\n<td>O(N)ï¼Œæ–‡æ¡£è¶Šå¤šè¶Šæ…¢</td>\n<td><strong>å¿…é¡»æ¶ˆç­</strong></td>\n</tr>\n<tr>\n<td><strong>WILDCARD</strong></td>\n<td>æ— è¿‡æ»¤æ¡ä»¶</td>\n<td><code>&quot;*&quot;</code>ã€<code>@field:*</code></td>\n<td>å€™é€‰é›†=å…¨éƒ¨æ–‡æ¡£</td>\n<td>ä»…é™åˆ†æï¼Œçº¿ä¸Šæ…ç”¨</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç´¢å¼•è®¿é—®å‹ Iteratorï¼ˆINTERSECT / UNION çš„å­èŠ‚ç‚¹ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Type</th>\n<th>å¯¹åº”å­—æ®µç±»å‹</th>\n<th>ç¤ºä¾‹æŸ¥è¯¢</th>\n<th>æ€§èƒ½ç‰¹å¾</th>\n<th>å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>TAG</strong></td>\n<td>TAG</td>\n<td><code>@status:&#123;PAID&#125;</code></td>\n<td>å“ˆå¸Œå€’æ’ï¼Œæœ€å¿«</td>\n<td>å¼ºçƒˆæ¨è</td>\n</tr>\n<tr>\n<td><strong>NUMERIC</strong></td>\n<td>NUMERIC</td>\n<td><code>@amount:[100 +inf]</code></td>\n<td>è·³è¡¨èŒƒå›´æ‰«æ</td>\n<td>èŒƒå›´è¶Šçª„è¶Šå¿«</td>\n</tr>\n<tr>\n<td><strong>TEXT</strong></td>\n<td>TEXT</td>\n<td><code>@name:alice</code></td>\n<td>åˆ†è¯åŒ¹é…</td>\n<td>åˆ†è¯æ•°å½±å“æ€§èƒ½</td>\n</tr>\n<tr>\n<td><strong>GEO</strong></td>\n<td>GEO</td>\n<td><code>@loc:[13.4 52.5 10 km]</code></td>\n<td>ç©ºé—´ç´¢å¼•</td>\n<td>åŠå¾„å½±å“ç»“æœæ•°</td>\n</tr>\n<tr>\n<td><strong>VECTOR</strong></td>\n<td>VECTOR</td>\n<td><code>=&gt;[KNN 10 @v $q]</code></td>\n<td>å‘é‡æœç´¢</td>\n<td>å¸¸ä¸ FILTER è”ç”¨</td>\n</tr>\n<tr>\n<td><strong>IDLIST</strong></td>\n<td>å†…éƒ¨</td>\n<td>å°ç»“æœé›†</td>\n<td>æšä¸¾ ID</td>\n<td>è‡ªåŠ¨ä¼˜åŒ–</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€»è¾‘ / ç»“æ„å‹ Iterator</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Type</th>\n<th>å«ä¹‰</th>\n<th>è§¦å‘ç¤ºä¾‹</th>\n<th>æ€§èƒ½å½±å“</th>\n<th>æ˜¯å¦å¸¸è§</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>NOT</strong></td>\n<td>å–å</td>\n<td><code>-@status:&#123;PAID&#125;</code></td>\n<td>ä¾èµ–å…¨é›†</td>\n<td>è¾ƒå°‘</td>\n</tr>\n<tr>\n<td><strong>OPTIONAL</strong></td>\n<td>å¯é€‰å­å¥</td>\n<td><code>( @a:&#123;x&#125; )?</code></td>\n<td>å¢åŠ å€™é€‰é›†</td>\n<td>å°‘è§</td>\n</tr>\n<tr>\n<td><strong>EMPTY</strong></td>\n<td>æ— åŒ¹é…</td>\n<td>æ¡ä»¶ä¸å¯èƒ½æ»¡è¶³</td>\n<td>æå¿«</td>\n<td>å¶å‘</td>\n</tr>\n<tr>\n<td><strong>PHRASE</strong></td>\n<td>çŸ­è¯­åŒ¹é…</td>\n<td><code>&quot;hello world&quot;</code></td>\n<td>æ¯” TEXT æ…¢</td>\n<td>ä½é¢‘</td>\n</tr>\n<tr>\n<td><strong>PREFIX</strong></td>\n<td>å‰ç¼€åŒ¹é…</td>\n<td><code>abc*</code></td>\n<td>å¯èƒ½é€€åŒ–</td>\n<td>éœ€è°¨æ…</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ä¸‰ã€åˆ«åç®¡ç†ï¼ˆç”Ÿäº§å¿…å¤‡ï¼‰\">ä¸‰ã€åˆ«åç®¡ç†ï¼ˆç”Ÿäº§å¿…å¤‡ï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>FT.ALIASADD</code></td>\n<td>æ·»åŠ åˆ«å</td>\n</tr>\n<tr>\n<td><code>FT.ALIASDEL</code></td>\n<td>åˆ é™¤åˆ«å</td>\n</tr>\n<tr>\n<td><code>FT.ALIASUPDATE</code></td>\n<td>æ›´æ–°åˆ«åæŒ‡å‘</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªç´¢å¼•å¯ä»¥æœ‰å¤šä¸ªåˆ«åï¼Œä¸€æ—¦åˆ›å»ºåˆ«åï¼Œæ‰€æœ‰ FT.SEARCH / FT.AGGREGATE / <a href=\"http://FT.INFO\">FT.INFO</a> ç­‰å‘½ä»¤éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ alias</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ åˆ«å: FT.ALIASADD alias index</span></span><br><span class=\"line\">FT.ALIASADD <span class=\"built_in\">alias</span>:user idx:user</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°åˆ«åæŒ‡å‘: FT.ALIASUPDATE alias index</span></span><br><span class=\"line\">FT.ALIASUPDATE <span class=\"built_in\">alias</span>:user idx:user:v2</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤åˆ«å: FT.ALIASDEL alias</span></span><br><span class=\"line\">FT.ALIASDEL <span class=\"built_in\">alias</span>:user</span><br><span class=\"line\"><span class=\"comment\"># åˆ¤æ–­ç´¢å¼•åç§°æ˜¯å¦ä¸ºåˆ«å</span></span><br><span class=\"line\">FT.INFO <span class=\"built_in\">alias</span>:user</span><br><span class=\"line\"> 1) index_name</span><br><span class=\"line\"> 2) idx:user  <span class=\"comment\"># çœŸå®ç´¢å¼•åç§°</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rSearch.addAlias(<span class=\"string\">&quot;alias:user&quot;</span>, <span class=\"string\">&quot;idx:user&quot;</span>);</span><br><span class=\"line\">rSearch.updateAlias(<span class=\"string\">&quot;alias:user&quot;</span>, <span class=\"string\">&quot;idx:user:v2&quot;</span>);</span><br><span class=\"line\">rSearch.delAlias(<span class=\"string\">&quot;alias:user&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç´¢å¼•åˆ«åçš„æ ¸å¿ƒä»·å€¼\">ç´¢å¼•åˆ«åçš„æ ¸å¿ƒä»·å€¼</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol>\n<li class=\"lvl-5\">ç´¢å¼•æ— æŸé‡å»ºï¼ˆæœ€å…¸å‹åœºæ™¯ï¼‰</li>\n</ol>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">RediSearch ä¸æ”¯æŒåœ¨çº¿ä¿®æ”¹ schemaï¼Œå­—æ®µå˜æ›´é€šå¸¸éœ€è¦é‡å»ºç´¢å¼•ï¼Œç´¢å¼•é‡å»ºæ—¶ä¸šåŠ¡å°†ä¸å¯ç”¨ã€‚</li>\n<li class=\"lvl-4\">æœ‰äº†åˆ«åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼Œåˆ›å»ºå¥½åå°†åˆ«åæŒ‡å‘æ–°çš„ç´¢å¼•ï¼Œæ—§ç´¢å¼•ä¸å†ä½¿ç”¨ï¼Œä¸šåŠ¡æ— å½±å“ã€‚</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. æ—§ç´¢å¼•</span><br><span class=\"line\"> FT.ALIASADD user_idx user_idx_v1</span><br><span class=\"line\"></span><br><span class=\"line\">2. æ–°å»ºç´¢å¼•</span><br><span class=\"line\">  FT.CREATE user_idx_v2 ...</span><br><span class=\"line\"></span><br><span class=\"line\">3. æ•°æ®å›å¡«å®Œæˆåï¼ŒåŸå­åˆ‡æ¢</span><br><span class=\"line\">  FT.ALIASUPDATE user_idx user_idx_v2</span><br><span class=\"line\"></span><br><span class=\"line\">4. åˆ é™¤æ—§ç´¢å¼•ï¼ˆå¯é€‰ï¼‰</span><br><span class=\"line\">  FT.DROPINDEX user_idx_v1</span><br></pre></td></tr></table></figure>\n</li>\n<li class=\"lvl-2\">\n<ol start=\"2\">\n<li class=\"lvl-5\">ç°åº¦ / å¤šç‰ˆæœ¬å¹¶å­˜</li>\n</ol>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ä¸åŒç¯å¢ƒï¼ˆdev / staging / prodï¼‰</li>\n<li class=\"lvl-4\">ä¸åŒ schema ç‰ˆæœ¬</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<ol start=\"3\">\n<li class=\"lvl-5\">è¿ç»´ä¸å‘å¸ƒè§„èŒƒåŒ–ï¼ˆå¼ºçƒˆæ¨èï¼‰</li>\n</ol>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼šæ°¸è¿œä¸è¦è®©ä¸šåŠ¡ä»£ç ç›´æ¥ä½¿ç”¨ç‰©ç†ç´¢å¼•å</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ç´¢å¼•çœŸå®å: ä¸šåŠ¡å_ç‰ˆæœ¬_æ—¶é—´æˆ³</span><br><span class=\"line\">ç´¢å¼•åˆ«å : ä¸šåŠ¡å</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"å››ã€æ¸¸æ ‡ï¼ˆå¤§ç»“æœé›†ï¼‰\">å››ã€æ¸¸æ ‡ï¼ˆå¤§ç»“æœé›†ï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>FT.CURSOR READ</code></td>\n<td>åˆ†æ‰¹è¯»å–</td>\n</tr>\n<tr>\n<td><code>FT.CURSOR DEL</code></td>\n<td>åˆ é™¤æ¸¸æ ‡</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¸¸æ ‡ç”¨äºèšåˆæŸ¥è¯¢ï¼ˆAGGREGATEï¼‰çš„å¤§ç»“æœé›†åˆ†é¡µ/åˆ†æ‰¹æ‹‰å–ï¼Œå…¸å‹åœºæ™¯åŒ…æ‹¬ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GROUPBY / REDUCE åç»“æœé›†å¾ˆå¤§</span><br><span class=\"line\">éœ€è¦æµå¼å¤„ç†èšåˆç»“æœï¼Œé¿å…ä¸€æ¬¡æ€§è¿”å›å ç”¨å¤§é‡å†…å­˜</span><br><span class=\"line\">å®¢æˆ·ç«¯æŒ‰æ‰¹æ¶ˆè´¹ç»“æœï¼ˆç±»ä¼¼æ•°æ®åº“çš„ server-side cursorï¼‰</span><br><span class=\"line\">æ³¨æ„ï¼šæ¸¸æ ‡ä¸»è¦ç”¨äº FT.AGGREGATEï¼Œæ™®é€š FT.SEARCH ä¸æ”¯æŒæ¸¸æ ‡åˆ†é¡µã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡ <code>FT.AGGREGATE ... WITHCURSOR</code> åˆ›å»ºæ¸¸æ ‡ï¼Œé€šè¿‡ <code>FT.CURSOR READ</code> è·å–ç»“æœã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.AGGREGATE idx:user <span class=\"string\">&quot;*&quot;</span></span><br><span class=\"line\">  GROUPBY 1 @status</span><br><span class=\"line\">  REDUCE SUM 1 @amount AS total_amount</span><br><span class=\"line\">  WITHCURSOR COUNT 2 MAXIDLE 60000</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># WITHCURSOR : å¯ç”¨æ¸¸æ ‡</span></span><br><span class=\"line\"><span class=\"comment\"># COUNT 2 : æ¯æ¬¡ä»æ¸¸æ ‡ä¸­è¿”å›çš„è¡Œæ•°ï¼ˆæ‰¹å¤§å°ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># MAXIDLE 60000 : æ¸¸æ ‡æœ€å¤§ç©ºé—²æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶åè‡ªåŠ¨é”€æ¯</span></span><br><span class=\"line\"><span class=\"comment\">## è¿”å›ç»“æœ</span></span><br><span class=\"line\">1) 1) (<span class=\"built_in\">integer</span>) 3   <span class=\"comment\"># GROUP BY åï¼Œä¸€å…±ä¼šäº§ç”Ÿ 3 è¡Œèšåˆç»“æœï¼Œè¿™é‡Œè¿”å›çš„æ˜¯å®é™…æŸ¥è¯¢çš„æ€»è¡Œæ•°ï¼Œä¸å—COUNT å‚æ•°é™åˆ¶</span></span><br><span class=\"line\">   2) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">      2) <span class=\"string\">&quot;CANCELLED&quot;</span></span><br><span class=\"line\">      3) <span class=\"string\">&quot;total_amount&quot;</span></span><br><span class=\"line\">      4) <span class=\"string\">&quot;79.8&quot;</span></span><br><span class=\"line\">   3) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">      2) <span class=\"string\">&quot;PAID&quot;</span></span><br><span class=\"line\">      3) <span class=\"string\">&quot;total_amount&quot;</span></span><br><span class=\"line\">      4) <span class=\"string\">&quot;4096.89&quot;</span></span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 116452546  <span class=\"comment\"># æ¸¸æ ‡ID</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¯»å–æ¸¸æ ‡</span></span><br><span class=\"line\">FT.CURSOR READ idx:user 116452546 COUNT 2</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># 116452546 : æ¸¸æ ‡ID</span></span><br><span class=\"line\"><span class=\"comment\"># COUNT 2 : æ¯æ¬¡ä»æ¸¸æ ‡ä¸­è¿”å›çš„è¡Œæ•°(å¯è¦†ç›–åˆå§‹æ¸¸æ ‡ä¸­çš„ COUNTï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">## è¿”å›ç»“æœ</span></span><br><span class=\"line\">1) 1) (<span class=\"built_in\">integer</span>) 0   <span class=\"comment\"># å½“å‰æ¸¸æ ‡ä¸­â€œå‰©ä½™å¯è¯»çš„è¡Œæ•°â€ä¸º 0</span></span><br><span class=\"line\">   2) 1) <span class=\"string\">&quot;status&quot;</span></span><br><span class=\"line\">      2) <span class=\"string\">&quot;CREATED&quot;</span></span><br><span class=\"line\">      3) <span class=\"string\">&quot;total_amount&quot;</span></span><br><span class=\"line\">      4) <span class=\"string\">&quot;238.8&quot;</span></span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 0 <span class=\"comment\"># 0 è¡¨ç¤ºæ²¡æœ‰æ›´å¤šç»“æœ</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é”€æ¯æ¸¸æ ‡ï¼Œå¦‚æœè®¾ç½®äº† MAXIDLE å‚æ•°ï¼Œåˆ™è¯¥æ¸¸æ ‡åœ¨ MAXIDLE æ—¶é—´å†…è‡ªåŠ¨é”€æ¯ï¼Œæ‰€ä»¥æ— éœ€æ‰‹å·¥é”€æ¯</span></span><br><span class=\"line\">FT.CURSOR DEL idx:user 116452546</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">AggregationResult</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> rSearch.aggregate(</span><br><span class=\"line\">        <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;*&quot;</span>,</span><br><span class=\"line\">        AggregationOptions.defaults()</span><br><span class=\"line\">                .groupBy(GroupBy.fieldNames(<span class=\"string\">&quot;@status&quot;</span>)</span><br><span class=\"line\">                        .reducers(</span><br><span class=\"line\">                                Reducer.sum(<span class=\"string\">&quot;@amount&quot;</span>).as(<span class=\"string\">&quot;total_amount&quot;</span>)</span><br><span class=\"line\">                        )</span><br><span class=\"line\">                )</span><br><span class=\"line\">                .withCursor(<span class=\"number\">2</span>, <span class=\"number\">60000</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"type\">long</span> total;</span><br><span class=\"line\"><span class=\"type\">long</span> cursorId;</span><br><span class=\"line\">List&lt;Map&lt;String, Object&gt;&gt; attributes;</span><br><span class=\"line\"></span><br><span class=\"line\">total = result.getTotal();</span><br><span class=\"line\">cursorId = result.getCursorId();</span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;total = &quot;</span> + total);</span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;cursorId = &quot;</span> + cursorId);</span><br><span class=\"line\">attributes = result.getAttributes();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (Map&lt;String, Object&gt; attribute : attributes) &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;attribute = &quot;</span> + attribute);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">while</span> (cursorId != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;===============================================&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">// æ¸¸æ ‡è¯»å–ï¼ŒRedissonçš„readCursoræ–¹æ³•æœ‰bugï¼Œæ— æ³•ç»§ç»­è¯»å–æ¸¸æ ‡æ•°æ®</span></span><br><span class=\"line\">    <span class=\"comment\">// result = rSearch.readCursor(&quot;idx:user&quot;, cursorId, 2);</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è¿™é‡Œæ¸¸æ ‡è¯»å–å¯ä»¥è‡ªå·±ç¼–å†™ä¸€ä¸ªåŸºäºLua çš„å®ç°</span></span><br><span class=\"line\">    result = readCursor(<span class=\"string\">&quot;idx:user&quot;</span>, cursorId, <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    total = result.getTotal();</span><br><span class=\"line\">    cursorId = result.getCursorId();</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;total = &quot;</span> + total);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;cursorId = &quot;</span> + cursorId);</span><br><span class=\"line\">    attributes = result.getAttributes();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (Map&lt;String, Object&gt; attribute : attributes) &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;attribute = &quot;</span> + attribute);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// cursorId=0 æˆ– åˆ°æœŸ æ—¶ä¼šè‡ªåŠ¨åˆ é™¤æ¸¸æ ‡ï¼Œæ­¤å¤„æ— éœ€åˆ é™¤</span></span><br><span class=\"line\"><span class=\"comment\">// rSearch.delCursor(&quot;idx:user&quot;, cursorId);</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> AggregationResult <span class=\"title function_\">readCursor</span><span class=\"params\">(String indexName, <span class=\"type\">long</span> cursorId, <span class=\"type\">int</span> count)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;FT.CURSOR&#x27;, &#x27;READ&#x27;, KEYS[1], ARGV[1], &#x27;COUNT&#x27;, ARGV[2])&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    List&lt;Object&gt; results = stringRedisTemplate.execute(</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class=\"line\">            Collections.singletonList(indexName),</span><br><span class=\"line\">            String.valueOf(cursorId),</span><br><span class=\"line\">            String.valueOf(count)</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    cursorId = (<span class=\"type\">long</span>) results.get(<span class=\"number\">1</span>);</span><br><span class=\"line\">    List&lt;Object&gt; lo = (List) results.get(<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AggregationResult</span>(</span><br><span class=\"line\">            (<span class=\"type\">long</span>) lo.get(<span class=\"number\">0</span>),</span><br><span class=\"line\">            toListOfMap(lo),</span><br><span class=\"line\">            cursorId</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> List&lt;Map&lt;String, Object&gt;&gt; <span class=\"title function_\">toListOfMap</span><span class=\"params\">(List&lt;Object&gt; lo)</span> &#123;</span><br><span class=\"line\">    List&lt;Map&lt;String, Object&gt;&gt; result = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (lo == <span class=\"literal\">null</span> || lo.size() &lt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ä»ç´¢å¼• 1 å¼€å§‹ï¼Œè·³è¿‡èšåˆæ€»æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; i &lt; lo.size(); i++) &#123;</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">rowObj</span> <span class=\"operator\">=</span> lo.get(i);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!(rowObj <span class=\"keyword\">instanceof</span> List&lt;?&gt; row)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        Map&lt;String, Object&gt; map = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; j &lt; row.size() - <span class=\"number\">1</span>; j += <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> String.valueOf(row.get(j));</span><br><span class=\"line\">            <span class=\"type\">Object</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> row.get(j + <span class=\"number\">1</span>);</span><br><span class=\"line\">            map.put(key, value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        result.add(map);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®Œæ•´ç”Ÿå‘½å‘¨æœŸæ€»ç»“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.AGGREGATE ... WITHCURSOR      <span class=\"comment\"># åˆ›å»ºæ¸¸æ ‡ï¼ˆå¹¶è¿”å›ç¬¬ä¸€æ‰¹ + cursorIdï¼‰</span></span><br><span class=\"line\">        â†“</span><br><span class=\"line\">FT.CURSOR READ                  <span class=\"comment\"># è¯»å–ç¬¬ N æ‰¹</span></span><br><span class=\"line\">        â†“</span><br><span class=\"line\">FT.CURSOR READ                  <span class=\"comment\"># ç»§ç»­è¯»å–</span></span><br><span class=\"line\">        â†“</span><br><span class=\"line\">FT.CURSOR DELï¼ˆå¯é€‰ï¼‰           <span class=\"comment\"># æå‰é‡Šæ”¾èµ„æº</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¸¸æ ‡ä¸ OFFSET/LIMIT çš„åŒºåˆ«</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å¯¹æ¯”é¡¹</th>\n<th>æ¸¸æ ‡</th>\n<th>OFFSET / LIMIT</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ€§èƒ½</td>\n<td>é«˜ï¼ˆæµå¼ï¼‰</td>\n<td>å¤§ OFFSET æ€§èƒ½å·®</td>\n</tr>\n<tr>\n<td>é€‚åˆå¤§ç»“æœé›†</td>\n<td>æ˜¯</td>\n<td>å¦</td>\n</tr>\n<tr>\n<td>æœåŠ¡å™¨çŠ¶æ€</td>\n<td>æœ‰</td>\n<td>æ— </td>\n</tr>\n<tr>\n<td>é€‚ç”¨å‘½ä»¤</td>\n<td>FT.AGGREGATE</td>\n<td>FT.SEARCH</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"äº”ã€è¯å…¸-åŒä¹‰è¯ï¼ˆæœç´¢å¢å¼ºï¼‰\">äº”ã€è¯å…¸ &amp; åŒä¹‰è¯ï¼ˆæœç´¢å¢å¼ºï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯å…¸ï¼ˆDICTï¼‰å’ŒåŒä¹‰è¯ï¼ˆSYNONYMï¼‰åªå¯¹ TEXT / TAG æœç´¢ç”Ÿæ•ˆ</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ <code>FT.AGGREGATE</code> æ— å…³ï¼Œä½†ä¸ <code>FT.SEARCH</code> å¼ºç›¸å…³ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>FT.DICTADD</code></td>\n<td>æ·»åŠ è¯</td>\n</tr>\n<tr>\n<td><code>FT.DICTDEL</code></td>\n<td>åˆ é™¤è¯</td>\n</tr>\n<tr>\n<td><code>FT.DICTDUMP</code></td>\n<td>æŸ¥çœ‹è¯å…¸</td>\n</tr>\n<tr>\n<td><code>FT.SYNUPDATE</code></td>\n<td>æ›´æ–°åŒä¹‰è¯</td>\n</tr>\n<tr>\n<td><code>FT.SYNDUMP</code></td>\n<td>æŸ¥çœ‹åŒä¹‰è¯</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"è¯å…¸\">è¯å…¸</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯å…¸ä½œç”¨ï¼šæ§åˆ¶â€œåˆæ³•æœç´¢è¯â€ï¼Œæ¯”å¦‚å°†è¯å…¸çš„å†…å®¹å‘é€ç»™ç”¨æˆ·ï¼Œè®©ç”¨æˆ·åªèƒ½æœç´¢è¿™äº›è¯ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">âš ï¸ è¯å…¸æœ¬èº«ä¸å‚ä¸æœç´¢åŒ¹é…</li>\n<li class=\"lvl-4\">âš ï¸ åªæ˜¯ä¸ºæœç´¢å¢å¼ºæä¾›æ•°æ®æ¥æº</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹ï¼šæ·»åŠ å•†å“ç›¸å…³è¯</span></span><br><span class=\"line\">FT.DICTADD product_dict iphone mobile phone android huawei</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹è¯å…¸å†…å®¹ï¼ˆFT.DICTDUMPï¼‰</span></span><br><span class=\"line\">FT.DICTDUMP product_dict</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤è¯å…¸ä¸­çš„è¯ï¼ˆFT.DICTDELï¼‰</span></span><br><span class=\"line\">FT.DICTDEL product_dict iphone</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rSearch.addDict(<span class=\"string\">&quot;product_dict&quot;</span>, <span class=\"string\">&quot;iphone&quot;</span>, <span class=\"string\">&quot;mobile&quot;</span>,<span class=\"string\">&quot;phone&quot;</span>,<span class=\"string\">&quot;android&quot;</span>,<span class=\"string\">&quot;huawei&quot;</span>);</span><br><span class=\"line\">List&lt;String&gt; productDict = rSearch.dumpDict(<span class=\"string\">&quot;product_dict&quot;</span>);</span><br><span class=\"line\">rSearch.delDict(<span class=\"string\">&quot;product_dict&quot;</span>, <span class=\"string\">&quot;iphone&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"åŒä¹‰è¯\">åŒä¹‰è¯</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒä¹‰è¯çš„ä½œç”¨: è®©ä¸åŒçš„æœç´¢è¯ å‘½ä¸­åŒä¸€æ‰¹æ–‡æ¡£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ä¾‹å¦‚ï¼š</span><br><span class=\"line\">  æœ iphone</span><br><span class=\"line\">  æœ mobile</span><br><span class=\"line\">  æœ phone</span><br><span class=\"line\"></span><br><span class=\"line\">  ğŸ‘‰ å‘½ä¸­åŒä¸€æ‰¹è®¢å•</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ  / æ›´æ–°åŒä¹‰è¯ï¼ˆFT.SYNUPDATEï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®šä¹‰â€œæ‰‹æœºâ€çš„åŒä¹‰è¯é›†åˆï¼Œæ³¨æ„åŒä¹‰è¯æ˜¯ç»‘å®šåˆ° ç´¢å¼• çš„</span></span><br><span class=\"line\">FT.SYNUPDATE idx:user</span><br><span class=\"line\">  phone_group</span><br><span class=\"line\">  iphone mobile phone</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># phone_group: åŒä¹‰è¯é›†åˆåç§°ï¼ˆä½ è‡ªå·±å®šä¹‰ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># iphone mobile phone: æ·»åŠ åŒä¹‰è¯ï¼Œå¤šä¸ªè¯ç”¨ç©ºæ ¼éš”å¼€</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åŒä¹‰è¯é›†åˆ</span></span><br><span class=\"line\">FT.SYNDUMP idx:user</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) <span class=\"string\">&quot;phone&quot;</span></span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;phone_group&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;iphone&quot;</span></span><br><span class=\"line\">4) 1) <span class=\"string\">&quot;phone_group&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;mobile&quot;</span></span><br><span class=\"line\">6) 1) <span class=\"string\">&quot;phone_group&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rSearch.updateSynonyms(<span class=\"string\">&quot;idx:user&quot;</span>, <span class=\"string\">&quot;phone_group&quot;</span>, <span class=\"string\">&quot;iphone&quot;</span>, <span class=\"string\">&quot;mobile&quot;</span>, <span class=\"string\">&quot;phone&quot;</span>);</span><br><span class=\"line\">Map&lt;String, List&lt;String&gt;&gt; synonyms = rSearch.dumpSynonyms(<span class=\"string\">&quot;idx:user&quot;</span>);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶æˆ‘ä»¬å†è¿›è¡Œæœç´¢ï¼Œå°±ä¼šå‘½ä¸­æ‰€æœ‰åŒä¹‰è¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SEARCH idx:user <span class=\"string\">&#x27;phone&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># æœç´¢ç»“æœ</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\">2) <span class=\"string\">&quot;user:10001&quot;</span></span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;$&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;&#123;\\&quot;name\\&quot;:\\&quot;Alice Bob\\&quot;,\\&quot;age\\&quot;:28,\\&quot;vip\\&quot;:\\&quot;yes\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;,&#123;\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a phone\\&quot;,\\&quot;items\\&quot;:[\\&quot;SpringCloud\\xe6\\x8a\\x80\\xe6\\x9c\\xaf\\xe6\\x8c\\x87\\xe5\\x8d\\x97\\&quot;,\\&quot;Shell\\xe8\\x84\\x9a\\xe6\\x9c\\xac\\xe5\\x9f\\xba\\xe7\\xa1\\x80\\&quot;]&#125;&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;user:10006&quot;</span></span><br><span class=\"line\">5) 1) <span class=\"string\">&quot;$&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;&#123;\\&quot;name\\&quot;:\\&quot;Frank\\&quot;,\\&quot;age\\&quot;:27,\\&quot;vip\\&quot;:\\&quot;no\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:499,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;,&#123;\\&quot;amount\\&quot;:129,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a phone\\&quot;,\\&quot;items\\&quot;:[\\&quot;Redis\\xe5\\xbc\\x80\\xe5\\x8f\\x91\\xe5\\xae\\x9e\\xe6\\x88\\x98\\&quot;,\\&quot;MongoDB\\xe4\\xbb\\x8e\\xe5\\x85\\xa5\\xe9\\x97\\xa8\\xe5\\x88\\xb0\\xe5\\xae\\x9e\\xe6\\x88\\x98\\&quot;]&#125;&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;user:10002&quot;</span></span><br><span class=\"line\">7) 1) <span class=\"string\">&quot;$&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;&#123;\\&quot;name\\&quot;:\\&quot;Bob Frank\\&quot;,\\&quot;age\\&quot;:35,\\&quot;vip\\&quot;:\\&quot;no\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:899.0,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a iphone\\&quot;,\\&quot;items\\&quot;:[\\&quot;Linux\\xe5\\xbf\\x85\\xe7\\x9f\\xa5\\xe5\\xbf\\x85\\xe4\\xbc\\x9a\\&quot;,\\&quot;Java\\xe5\\xa4\\x9a\\xe7\\xba\\xbf\\xe7\\xa8\\x8b\\xe8\\xaf\\xa6\\xe8\\xa7\\xa3\\&quot;]&#125;&quot;</span></span><br><span class=\"line\">8) <span class=\"string\">&quot;user:10003&quot;</span></span><br><span class=\"line\">9) 1) <span class=\"string\">&quot;$&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;&#123;\\&quot;name\\&quot;:\\&quot;Carol\\&quot;,\\&quot;age\\&quot;:22,\\&quot;vip\\&quot;:\\&quot;no\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:19.9,\\&quot;status\\&quot;:\\&quot;CANCELLED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a mobile\\&quot;,\\&quot;items\\&quot;:[\\&quot;MySQL\\xe4\\xbb\\x8e\\xe5\\x88\\xa0\\xe5\\xba\\x93\\xe5\\x88\\xb0\\xe8\\xb7\\x91\\xe8\\xb7\\xaf\\&quot;,\\&quot;Oracle\\xe5\\xbc\\x80\\xe5\\x8f\\x91\\xe5\\xae\\x9e\\xe8\\xb7\\xb5\\&quot;]&#125;&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯å…¸ + åŒä¹‰è¯çš„ç»„åˆä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. ç”¨æˆ·è¾“å…¥: æ‰‹æœº</span><br><span class=\"line\">2. å‰ç«¯ / æœåŠ¡ç«¯ â†’ ä» product_dict ç»™æç¤º</span><br><span class=\"line\">3. æœç´¢è¯·æ±‚ â†’ FT.SEARCH</span><br><span class=\"line\">4. RediSearch â†’ åŒä¹‰è¯æ‰©å±•</span><br><span class=\"line\">5. è¿”å›ç»Ÿä¸€ç»“æœ</span><br></pre></td></tr></table></figure>\n<h3 id=\"å…­ã€FT-SPELLCHECKï¼ˆæ‹¼å†™çº é”™ï¼‰\">å…­ã€FT.SPELLCHECKï¼ˆæ‹¼å†™çº é”™ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FT.SPELLCHECK ç”¨äºå¯¹ç”¨æˆ·è¾“å…¥çš„æœç´¢è¯è¿›è¡Œæ‹¼å†™çº é”™ä¸ç›¸ä¼¼è¯æ¨è</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒå¹¶ä¸ä¼šçœŸæ­£æ‰§è¡Œæœç´¢ï¼Œè€Œæ˜¯ï¼š<br>\nâœ… åˆ†æè¾“å…¥è¯æ˜¯å¦å­˜åœ¨äºç´¢å¼•è¯å…¸<br>\nâœ… å¦‚æœä¸å­˜åœ¨ï¼ŒåŸºäºç¼–è¾‘è·ç¦»ï¼ˆLevenshteinï¼‰ç»™å‡ºå€™é€‰çº é”™è¯<br>\nâœ… æ”¯æŒè‡ªå®šä¹‰è¯å…¸ï¼ˆDictionaryï¼‰å¢å¼ºæ•ˆæœ</p>\n</li>\n<li class=\"lvl-2\">\n<p>ğŸ¯ æ ¸å¿ƒç›®æ ‡</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>èƒ½åŠ›</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ‹¼å†™çº é”™</td>\n<td>iphone â†’ ipohne</td>\n</tr>\n<tr>\n<td>æ¨¡ç³Šæ¨è</td>\n<td>ç”¨æˆ·æ‹¼é”™å…³é”®è¯</td>\n</tr>\n<tr>\n<td>æœç´¢å‰ç½®çº é”™</td>\n<td>æå‡å¬å›ç‡</td>\n</tr>\n<tr>\n<td>è‡ªåŠ¨å­¦ä¹ ç´¢å¼•è¯</td>\n<td>è‡ªåŠ¨ä»ç´¢å¼•è¯åº“æ„å»ºè¯å…¸</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŸºæœ¬è¯­æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SPELLCHECK index query</span><br><span class=\"line\">  [DISTANCE maxDistance]</span><br><span class=\"line\">  [TERMS &#123;INCLUDE | EXCLUDE&#125; dictionary ...]</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index</td>\n<td>ç´¢å¼•åç§°</td>\n<td>å¿…å¡«</td>\n</tr>\n<tr>\n<td>query</td>\n<td>ç”¨æˆ·è¾“å…¥è¯</td>\n<td>å¿…å¡«</td>\n</tr>\n<tr>\n<td>DISTANCE</td>\n<td>æœ€å¤§ç¼–è¾‘è·ç¦»ï¼ˆ1~4ï¼‰</td>\n<td>1</td>\n</tr>\n<tr>\n<td>TERMS INCLUDE</td>\n<td>ä»…ä½¿ç”¨æŒ‡å®šè¯å…¸</td>\n<td>å…¨éƒ¨</td>\n</tr>\n<tr>\n<td>TERMS EXCLUDE</td>\n<td>æ’é™¤æŒ‡å®šè¯å…¸</td>\n<td>æ— </td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.SPELLCHECK idx:user <span class=\"string\">&#x27;iphnoe&#x27;</span> DISTANCE 2</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) TERM         <span class=\"comment\"># å›ºå®šæ ‡è¯†ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¢«åˆ†æçš„è¯</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;iphnoe&quot;</span>     <span class=\"comment\"># ç”¨æˆ·è¾“å…¥è¯</span></span><br><span class=\"line\">   3) 1) 1) <span class=\"string\">&quot;0.4&quot;</span>  <span class=\"comment\"># ç›¸ä¼¼åº¦è¯„åˆ†ï¼Œè¶Šå°è¶Šç›¸ä¼¼</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;iphone&quot;</span> <span class=\"comment\"># æ¨èè¯ï¼Œå»ºè®®æ›¿æ¢è¯</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æœç´¢å¤šä¸ªè¯</span></span><br><span class=\"line\">FT.SPELLCHECK idx:user <span class=\"string\">&#x27;iphnoe linu&#x27;</span> DISTANCE 2</span><br><span class=\"line\">1) 1) TERM</span><br><span class=\"line\">   2) <span class=\"string\">&quot;iphnoe&quot;</span></span><br><span class=\"line\">   3) 1) 1) <span class=\"string\">&quot;0.4&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;iphone&quot;</span></span><br><span class=\"line\">2) 1) TERM</span><br><span class=\"line\">   2) <span class=\"string\">&quot;linu&quot;</span></span><br><span class=\"line\">   3) 1) 1) <span class=\"string\">&quot;0.4&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;linux&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¢åŠ ç¼–è¾‘è·ç¦»ä¼šæ˜¾ç¤ºæ›´å¤šçš„å€™é€‰è¯</span></span><br><span class=\"line\">FT.SPELLCHECK idx:user <span class=\"string\">&#x27;phnoe&#x27;</span> DISTANCE 3</span><br><span class=\"line\">1) 1) TERM</span><br><span class=\"line\">   2) <span class=\"string\">&quot;phnoe&quot;</span></span><br><span class=\"line\">   3) 1) 1) <span class=\"string\">&quot;4&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;have&quot;</span></span><br><span class=\"line\">      2) 1) <span class=\"string\">&quot;0.8&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;phone&quot;</span></span><br><span class=\"line\">      3) 1) <span class=\"string\">&quot;0.4&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;iphone&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Map&lt;String, Map&lt;String, Double&gt;&gt; spellcheck = rSearch.spellcheck(</span><br><span class=\"line\">        <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;iphnoe linu&quot;</span>,</span><br><span class=\"line\">        SpellcheckOptions.defaults().distance(<span class=\"number\">2</span>));</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>score = ç¼–è¾‘è·ç¦» / max(len(ç”¨æˆ·è¾“å…¥è¯), len(å€™é€‰è¯))ï¼Œä½†å¹¶ä¸æ˜¯æ€»æ˜¯è¿™æ ·</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>è¾“å…¥</th>\n<th>å€™é€‰</th>\n<th>ç¼–è¾‘è·ç¦»</th>\n<th>maxLen</th>\n<th>score</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>phnoe</td>\n<td>iphone</td>\n<td>2</td>\n<td>6</td>\n<td>2/6 = 0.333 â‰ˆ 0.4</td>\n</tr>\n<tr>\n<td>phnoe</td>\n<td>phone</td>\n<td>1</td>\n<td>5</td>\n<td>0.2 â†’ ~0.8ï¼ˆå†…éƒ¨æƒé‡å¯èƒ½åè½¬æˆ–è°ƒæ•´ï¼‰</td>\n</tr>\n<tr>\n<td>phnoe</td>\n<td>have</td>\n<td></td>\n<td></td>\n<td>â€œ4â€ â†’ è¡¨ç¤º phnoe ä¸ have çš„ç¼–è¾‘è·ç¦»æ˜¯ 4</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">phnoe â†’ have</span><br><span class=\"line\">p â†’ h (1)</span><br><span class=\"line\">h â†’ a (2)</span><br><span class=\"line\">n â†’ v (3)</span><br><span class=\"line\">o â†’ e (4)</span><br><span class=\"line\">e â†’ (åˆ é™¤) (5)   ï¼ˆä¸åŒç®—æ³•å¯èƒ½è®¡ä¸º 4 æˆ– 5ï¼‰</span><br><span class=\"line\">è¯¥è¯æ˜æ˜¾æ˜¯ä½è´¨é‡å€™é€‰ï¼Œåªæ˜¯ DISTANCE=3/4 æ—¶è¢«å‹‰å¼ºæ”¶å½•ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ä¸šåŠ¡ä¾§åšåˆç†è¿‡æ»¤</span><br><span class=\"line\">å¦‚æœ score &gt;= 2     â†’ ç›´æ¥ä¸¢å¼ƒï¼ˆæ˜æ˜¾å™ªå£°ï¼‰</span><br><span class=\"line\">å¦‚æœ score &lt;= 1.0   â†’ å¯ä¿¡å€™é€‰</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å»ºè®®ç­–ç•¥</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æœç´¢æ¡†å®æ—¶æç¤º</td>\n<td>1</td>\n</tr>\n<tr>\n<td>æœç´¢æäº¤åçº é”™</td>\n<td>2</td>\n</tr>\n<tr>\n<td>æ¨¡ç³Šå®¹é”™ç³»ç»Ÿ</td>\n<td>2~3</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯å…¸å¢å¼ºï¼ˆDictionary Integrationï¼‰</p>\n</li>\n</ul>\n<blockquote>\n<p>é€šè¿‡ FT.DICTADD / FT.DICTDEL äººå·¥ç»´æŠ¤ä¸€ä¸ªæˆ–å¤šä¸ªè¯å…¸ï¼ŒæŠŠâ€œä¸šåŠ¡è¯æ±‡â€ä¸»åŠ¨æ³¨å…¥åˆ° SpellCheck çš„å€™é€‰è¯ç©ºé—´ä¸­ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">é»˜è®¤æƒ…å†µä¸‹ï¼š</span><br><span class=\"line\">SpellCheck åªèƒ½ä» ç´¢å¼•å€’æ’è¯å…¸ï¼ˆInverted Index Termsï¼‰ ä¸­ç”Ÿæˆå€™é€‰è¯ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">å¦‚æœæŸäº›è¯ï¼š</span><br><span class=\"line\">  ä¸åœ¨ç´¢å¼•é‡Œ</span><br><span class=\"line\">  å‡ºç°é¢‘ç‡æä½</span><br><span class=\"line\">  å±äºä¸“æœ‰åè¯</span><br><span class=\"line\">  æ–°è¯ã€å“ç‰Œè¯</span><br><span class=\"line\">é‚£ä¹ˆ SpellCheck å¾ˆå¯èƒ½æ— æ³•æ­£ç¡®çº é”™ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">è¯å…¸å¢å¼ºè§£å†³çš„æ­£æ˜¯è¿™ä¸ªé—®é¢˜ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">ç”¨æˆ·è¾“å…¥ â†’ Tokenizer â†’ æ‹†è¯ â†’</span><br><span class=\"line\">  â†“</span><br><span class=\"line\">å€™é€‰æºåˆå¹¶ï¼š</span><br><span class=\"line\">  - å€’æ’ç´¢å¼•è¯å…¸</span><br><span class=\"line\">  - è‡ªå®šä¹‰è¯å…¸ï¼ˆFT.DICTADDï¼‰</span><br><span class=\"line\">  â†“</span><br><span class=\"line\">ç¼–è¾‘è·ç¦»è®¡ç®—</span><br><span class=\"line\">  â†“</span><br><span class=\"line\">å€™é€‰æ’åº</span><br><span class=\"line\">  â†“</span><br><span class=\"line\">è¿”å›çº é”™è¯</span><br><span class=\"line\"></span><br><span class=\"line\">âœ… SpellCheck çš„å€™é€‰ç©ºé—´è¢«äººä¸ºæ‰©å¤§ã€‚</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FT.DICTADD dict:tech iphone ipad macbook airpods</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨æŒ‡å®šè¯å…¸çº é”™ï¼Œç™½åå•</span></span><br><span class=\"line\">FT.SPELLCHECK idx:user <span class=\"string\">&quot;macboo&quot;</span> TERMS INCLUDE dict:tech</span><br><span class=\"line\">1) 1) TERM</span><br><span class=\"line\">   2) <span class=\"string\">&quot;macboo&quot;</span></span><br><span class=\"line\">   3) 1) 1) <span class=\"string\">&quot;0.4&quot;</span></span><br><span class=\"line\">         2) <span class=\"string\">&quot;macbook&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æ’é™¤è¯å…¸ï¼Œé»‘åå•</span></span><br><span class=\"line\">FT.SPELLCHECK idx:user <span class=\"string\">&quot;iphnoe&quot;</span> TERMS EXCLUDE dict:noise</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Map&lt;String, Map&lt;String, Double&gt;&gt; spellcheck = rSearch.spellcheck(</span><br><span class=\"line\">        <span class=\"string\">&quot;idx:user&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;macboo&quot;</span>,</span><br><span class=\"line\">        SpellcheckOptions.defaults()</span><br><span class=\"line\">                .distance(<span class=\"number\">2</span>)</span><br><span class=\"line\">                .includedTerms(<span class=\"string\">&quot;dict:tech&quot;</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FT.SPELLCHECK ä¸ Suggest çš„å·®å¼‚å¯¹æ¯”ï¼ˆå…³é”®ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>FT.SPELLCHECK</th>\n<th>FT.SUGGET</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ç›®æ ‡</td>\n<td>æ‹¼å†™çº é”™</td>\n<td>å‰ç¼€è”æƒ³</td>\n</tr>\n<tr>\n<td>è¾“å…¥</td>\n<td>å®Œæ•´è¯</td>\n<td>å‰ç¼€</td>\n</tr>\n<tr>\n<td>è¿”å›</td>\n<td>ç›¸ä¼¼è¯</td>\n<td>è¡¥å…¨è¯</td>\n</tr>\n<tr>\n<td>æ•°æ®æ¥æº</td>\n<td>ç´¢å¼•è¯å…¸</td>\n<td>ç‹¬ç«‹ Trie</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ’åº</td>\n<td>å¦ï¼ˆè·ç¦»ä¼˜å…ˆï¼‰</td>\n<td>æ˜¯ï¼ˆscoreï¼‰</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ¨¡ç³Š</td>\n<td>ç¼–è¾‘è·ç¦»</td>\n<td>å‰ç¼€ + FUZZY</td>\n</tr>\n<tr>\n<td>ä½¿ç”¨é˜¶æ®µ</td>\n<td>æœç´¢å‰ä¿®æ­£</td>\n<td>è¾“å…¥è¿‡ç¨‹ä¸­</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å·²åºŸå¼ƒå‘½ä»¤ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰\">å·²åºŸå¼ƒå‘½ä»¤ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>çŠ¶æ€</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>FT.CONFIG GET</code></td>\n<td>Reids8 å°†å…¶æ ‡è®°ä¸º Deprecated</td>\n<td>ä½¿ç”¨ <code>CONFIG GET search-*</code></td>\n</tr>\n<tr>\n<td><code>FT.CONFIG SET</code></td>\n<td>Reids8 å°†å…¶æ ‡è®°ä¸º Deprecated</td>\n<td>åŒä¸Š</td>\n</tr>\n<tr>\n<td><code>FT.TAGVALS</code></td>\n<td>å·²ç»æ ‡è®°ä¸º Deprecated</td>\n<td>æ”¹ç”¨ AGGREGATE</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âš ï¸ è¿™é‡Œè¦æ³¨æ„ï¼Œåªæœ‰ <code>Redis 8.0.0</code> ä»¥ä¸Šç‰ˆæœ¬æ”¯æŒ <code>CONFIG GET search-*</code>ã€‚</p>\n</li>\n</ul>\n<h4 id=\"FT-CONFIG-GET-å’Œ-CONFIG-GET-search-å¯¹åº”å‚æ•°æ•´ç†\"><code>FT.CONFIG GET *</code> å’Œ <code>CONFIG GET search-*</code> å¯¹åº”å‚æ•°æ•´ç†</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1ï¸âƒ£ ç´¢å¼•åŸºæœ¬ / æ–‡æ¡£è¡¨é…ç½®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>FT.CONFIG å‚æ•°</th>\n<th>FT.CONFIG å€¼</th>\n<th>CONFIG search-* å‚æ•°</th>\n<th>CONFIG å€¼</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>MINPREFIX</td>\n<td>2</td>\n<td>search-min-prefix</td>\n<td>2</td>\n<td>è‡ªåŠ¨è¡¥å…¨æœ€å°å‰ç¼€é•¿åº¦</td>\n</tr>\n<tr>\n<td>MINSTEMLEN</td>\n<td>4</td>\n<td>search-min-stem-len</td>\n<td>4</td>\n<td>æœ€å°è¯å¹²é•¿åº¦</td>\n</tr>\n<tr>\n<td>MAXDOCTABLESIZE</td>\n<td>1000000</td>\n<td>search-max-doctablesize</td>\n<td>1000000</td>\n<td>æœ€å¤§æ–‡æ¡£è¡¨å¤§å°</td>\n</tr>\n<tr>\n<td>MAXSEARCHRESULTS</td>\n<td>1000000</td>\n<td>search-max-search-results</td>\n<td>1000000</td>\n<td>æœç´¢ç»“æœé™åˆ¶</td>\n</tr>\n<tr>\n<td>MAXAGGREGATERESULTS</td>\n<td>unlimited</td>\n<td>search-max-aggregate-results</td>\n<td>2147483648</td>\n<td>èšåˆç»“æœé™åˆ¶</td>\n</tr>\n<tr>\n<td>MAXEXPANSIONS</td>\n<td>200</td>\n<td>search-max-prefix-expansions</td>\n<td>200</td>\n<td>å‰ç¼€æ‰©å±•é™åˆ¶</td>\n</tr>\n<tr>\n<td>MAXPREFIXEXPANSIONS</td>\n<td>200</td>\n<td>search-max-prefix-expansions</td>\n<td>200</td>\n<td>å‰ç¼€æ‰©å±•é™åˆ¶ï¼ˆå…¼å®¹ï¼‰</td>\n</tr>\n<tr>\n<td>RAW_DOCID_ENCODING</td>\n<td>false</td>\n<td>search-raw-docid-encoding</td>\n<td>no</td>\n<td>æ–‡æ¡£IDæ˜¯å¦åŸå§‹ç¼–ç </td>\n</tr>\n<tr>\n<td>UPGRADE_INDEX</td>\n<td>Upgrade config for upgrading</td>\n<td>N/A</td>\n<td>N/A</td>\n<td>å‡çº§ç´¢å¼•é…ç½®æç¤º</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2ï¸âƒ£ æŸ¥è¯¢ / è¯„åˆ†ç›¸å…³é…ç½®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>FT.CONFIG å‚æ•°</th>\n<th>FT.CONFIG å€¼</th>\n<th>CONFIG search-* å‚æ•°</th>\n<th>CONFIG å€¼</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>TIMEOUT</td>\n<td>500</td>\n<td>search-timeout</td>\n<td>500</td>\n<td>æŸ¥è¯¢è¶…æ—¶ï¼ˆmsï¼‰</td>\n</tr>\n<tr>\n<td>ON_TIMEOUT</td>\n<td>return</td>\n<td>search-on-timeout</td>\n<td>return</td>\n<td>è¶…æ—¶ç­–ç•¥</td>\n</tr>\n<tr>\n<td>DEFAULT_SCORER</td>\n<td>TFIDF</td>\n<td>search-default-scorer</td>\n<td>BM25STD</td>\n<td>é»˜è®¤è¯„åˆ†ç®—æ³•</td>\n</tr>\n<tr>\n<td>BM25STD_TANH_FACTOR</td>\n<td>4</td>\n<td>search-bm25std-tanh-factor</td>\n<td>4</td>\n<td>BM25 è°ƒæ•´å› å­</td>\n</tr>\n<tr>\n<td>MULTI_TEXT_SLOP</td>\n<td>100</td>\n<td>search-multi-text-slop</td>\n<td>100</td>\n<td>å¤šå­—æ®µæŸ¥è¯¢ slop</td>\n</tr>\n<tr>\n<td>DEFAULT_DIALECT</td>\n<td>1</td>\n<td>search-default-dialect</td>\n<td>1</td>\n<td>æŸ¥è¯¢æ–¹è¨€</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>3ï¸âƒ£ GC / åå°ç´¢å¼•é…ç½®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>FT.CONFIG å‚æ•°</th>\n<th>FT.CONFIG å€¼</th>\n<th>CONFIG search-* å‚æ•°</th>\n<th>CONFIG å€¼</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NOGC</td>\n<td>false</td>\n<td>search-no-gc</td>\n<td>no</td>\n<td>ç¦ç”¨ GC</td>\n</tr>\n<tr>\n<td>GC_POLICY</td>\n<td>fork</td>\n<td>search-fork-gc-policy (implicit)</td>\n<td>fork</td>\n<td>GC ç­–ç•¥</td>\n</tr>\n<tr>\n<td>FORKGC_SLEEP_BEFORE_EXIT</td>\n<td>0</td>\n<td>search-fork-gc-sleep-before-exit</td>\n<td>0</td>\n<td>fork GC é€€å‡ºå‰ç¡çœ </td>\n</tr>\n<tr>\n<td>FORK_GC_RUN_INTERVAL</td>\n<td>30</td>\n<td>search-fork-gc-run-interval</td>\n<td>30</td>\n<td>fork GC æ‰§è¡Œé—´éš”ï¼ˆç§’ï¼‰</td>\n</tr>\n<tr>\n<td>FORK_GC_CLEAN_THRESHOLD</td>\n<td>100</td>\n<td>search-fork-gc-clean-threshold</td>\n<td>100</td>\n<td>fork GC æ¸…ç†é˜ˆå€¼</td>\n</tr>\n<tr>\n<td>FORK_GC_RETRY_INTERVAL</td>\n<td>5</td>\n<td>search-fork-gc-retry-interval</td>\n<td>5</td>\n<td>fork GC é‡è¯•é—´éš”</td>\n</tr>\n<tr>\n<td>FORK_GC_CLEAN_NUMERIC_EMPTY_NODES</td>\n<td>true</td>\n<td>search-_numeric-compress</td>\n<td>no</td>\n<td>æ¸…ç†ç©ºæ•°å€¼èŠ‚ç‚¹</td>\n</tr>\n<tr>\n<td>GCSCANSIZE</td>\n<td>100</td>\n<td>search-gc-scan-size</td>\n<td>100</td>\n<td>GC æ¯æ¬¡æ‰«æå¤§å°</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>4ï¸âƒ£ æ¸¸æ ‡ / çº¿ç¨‹ / å¹¶å‘é…ç½®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>FT.CONFIG å‚æ•°</th>\n<th>FT.CONFIG å€¼</th>\n<th>CONFIG search-* å‚æ•°</th>\n<th>CONFIG å€¼</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CURSOR_MAX_IDLE</td>\n<td>300000</td>\n<td>search-cursor-max-idle</td>\n<td>300000</td>\n<td>æ¸¸æ ‡æœ€å¤§ç©ºé—²æ—¶é—´</td>\n</tr>\n<tr>\n<td>INDEX_CURSOR_LIMIT</td>\n<td>128</td>\n<td>search-index-cursor-limit</td>\n<td>128</td>\n<td>å•ç´¢å¼•æ¸¸æ ‡é™åˆ¶</td>\n</tr>\n<tr>\n<td>UNION_ITERATOR_HEAP</td>\n<td>20</td>\n<td>search-union-iterator-heap</td>\n<td>20</td>\n<td>UNION æŸ¥è¯¢å †å¤§å°</td>\n</tr>\n<tr>\n<td>NO_MEM_POOLS</td>\n<td>false</td>\n<td>search-no-mem-pools</td>\n<td>no</td>\n<td>ç¦ç”¨å†…å­˜æ± </td>\n</tr>\n<tr>\n<td>_FREE_RESOURCE_ON_THREAD</td>\n<td>true</td>\n<td>search-_free-resource-on-thread</td>\n<td>yes</td>\n<td>çº¿ç¨‹é‡Šæ”¾èµ„æº</td>\n</tr>\n<tr>\n<td>search_min_operation_workers</td>\n<td>N/A</td>\n<td>search-min-operation-workers</td>\n<td>4</td>\n<td>æœ€å°æ“ä½œçº¿ç¨‹æ•°</td>\n</tr>\n<tr>\n<td>search-workers</td>\n<td>N/A</td>\n<td>search-workers</td>\n<td>0</td>\n<td>å·¥ä½œçº¿ç¨‹æ•°</td>\n</tr>\n<tr>\n<td>search-workers-priority-bias-threshold</td>\n<td>N/A</td>\n<td>search-workers-priority-bias-threshold</td>\n<td>1</td>\n<td>çº¿ç¨‹ä¼˜å…ˆçº§åç½®</td>\n</tr>\n<tr>\n<td>INDEXER_YIELD_EVERY_OPS</td>\n<td>1000</td>\n<td>search-indexer-yield-every-ops</td>\n<td>1000</td>\n<td>ç´¢å¼•å™¨ yield æ¯æ“ä½œæ•°</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>5ï¸âƒ£ å®éªŒ / å†…éƒ¨ /å…¶ä»–</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>FT.CONFIG å‚æ•°</th>\n<th>FT.CONFIG å€¼</th>\n<th>CONFIG search-* å‚æ•°</th>\n<th>CONFIG å€¼</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>EXTLOAD</td>\n<td>nil</td>\n<td>search-ext-load</td>\n<td>â€œâ€</td>\n<td>å¤–éƒ¨åŠ è½½æ¨¡å—</td>\n</tr>\n<tr>\n<td>FRISOINI</td>\n<td>nil</td>\n<td>search-friso-ini</td>\n<td>â€œâ€</td>\n<td>ä¸­æ–‡åˆ†è¯åˆå§‹åŒ–</td>\n</tr>\n<tr>\n<td>ENABLE_UNSTABLE_FEATURES</td>\n<td>false</td>\n<td>search-enable-unstable-features</td>\n<td>no</td>\n<td>å¯ç”¨å®éªŒç‰¹æ€§</td>\n</tr>\n<tr>\n<td>_PRINT_PROFILE_CLOCK</td>\n<td>true</td>\n<td>search-_print-profile-clock</td>\n<td>yes</td>\n<td>Profiling å¼€å…³</td>\n</tr>\n<tr>\n<td>_NUMERIC_RANGES_PARENTS</td>\n<td>0</td>\n<td>search-_numeric-ranges-parents</td>\n<td>0</td>\n<td>æ•°å€¼èŒƒå›´çˆ¶èŠ‚ç‚¹æ•°</td>\n</tr>\n<tr>\n<td>VSS_MAX_RESIZE</td>\n<td>0</td>\n<td>search-vss-max-resize</td>\n<td>1024</td>\n<td>å‘é‡ç´¢å¼•æœ€å¤§é‡åˆ†é…</td>\n</tr>\n<tr>\n<td>PARTIAL_INDEXED_DOCS</td>\n<td>false</td>\n<td>search-partial-indexed-docs</td>\n<td>no</td>\n<td>éƒ¨åˆ†ç´¢å¼•æ–‡æ¡£æ ‡è®°</td>\n</tr>\n<tr>\n<td>_PRIORITIZE_INTERSECT_UNION_CHILDREN</td>\n<td>false</td>\n<td>search-_prioritize-intersect-union-children</td>\n<td>no</td>\n<td>ä¼˜å…ˆå¤„ç† INTERSECT/UNION å­èŠ‚ç‚¹</td>\n</tr>\n<tr>\n<td>_BG_INDEX_MEM_PCT_THR</td>\n<td>100</td>\n<td>search-_bg-index-mem-pct-thr</td>\n<td>100</td>\n<td>åå°ç´¢å¼•å†…å­˜é˜ˆå€¼</td>\n</tr>\n<tr>\n<td>_NUMERIC_COMPRESS</td>\n<td>false</td>\n<td>search-_numeric-compress</td>\n<td>no</td>\n<td>æ•°å€¼å‹ç¼©</td>\n</tr>\n<tr>\n<td>_BG_INDEX_OOM_PAUSE_TIME</td>\n<td>0</td>\n<td>search-_bg-index-oom-pause-time</td>\n<td>0</td>\n<td>åå°ç´¢å¼• OOM æš‚åœæ—¶é—´</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch çš„ä½¿ç”¨æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RediSearch çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub RediSearch å‘½ä»¤ ä¸ºäº†å±•ç¤ºå‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•ï¼Œè¿™é‡Œä»¥JSONæ–‡æ¡£è¿›è¡Œç´¢å¼•ï¼Œåˆå§‹åŒ–æ•°æ®å¦‚ä¸‹ï¼š 1234567891011121314151617181920JSON.SET user:10001 $ &#x27;&#123;&quot;name&quot;:&quot;Alice Bob&quot;,&quot;age&quot;:28,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:199.99,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:59.9,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a phone&quot;,&quot;items&quot;:[&quot;SpringCloudæŠ€æœ¯æŒ‡å—&quot;,&quot;Shellè„šæœ¬åŸºç¡€&quot;]&#125;&#x27;JSON.SET user:10002 $ &#x27;&#123;&quot;name&quot;:&quot;Bob Frank&quot;,&quot;age&quot;:35,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:899.0,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a iphone&quot;,&quot;items&quot;:[&quot;Linuxå¿…çŸ¥å¿…ä¼š&quot;,&quot;Javaå¤šçº¿ç¨‹è¯¦è§£&quot;]&#125;&#x27;JSON.SET user:10003 $ &#x27;&#123;&quot;name&quot;:&quot;Carol&quot;,&quot;age&quot;:22,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:19.9,&quot;status&quot;:&quot;CANCELLED&quot;&#125;],&quot;comment&quot;: &quot;I have a mobile&quot;,&quot;items&quot;:[&quot;MySQLä»åˆ åº“åˆ°è·‘è·¯&quot;,&quot;Oracleå¼€å‘å®è·µ&quot;]&#125;&#x27;JSON.SET user:10004 $ &#x27;&#123;&quot;name&quot;:&quot;David Bob&quot;,&quot;age&quot;:41,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:1200,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:300,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a car&quot;,&quot;items&quot;:[&quot;SpringæŠ€æœ¯æŒ‡å—&quot;,&quot;RocketMQç”±æµ…å…¥æ·±&quot;]&#125;&#x27;JSON.SET user:10005 $ &#x27;&#123;&quot;name&quot;:&quot;Eve&quot;,&quot;age&quot;:30,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:88.8,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a pencil&quot;,&quot;items&quot;:[&quot;Kafkaä»é›¶å¼€å§‹&quot;,&quot;Javaç”±æµ…å…¥æ·±&quot;]&#125;&#x27;JSON.SET user:10006 $ &#x27;&#123;&quot;name&quot;:&quot;Frank&quot;,&quot;age&quot;:27,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:499,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:129,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a phone&quot;,&quot;items&quot;:[&quot;Rediså¼€å‘å®æˆ˜&quot;,&quot;MongoDBä»å…¥é—¨åˆ°å®æˆ˜&quot;]&#125;&#x27;JSON.SET user:10007 $ &#x27;&#123;&quot;name&quot;:&quot;Grace&quot;,&quot;age&quot;:33,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:999.9,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a book&quot;,&quot;items&quot;:[&quot;Androidå¼€å‘æ‰‹å†Œ&quot;,&quot;Gradleä»é›¶å¼€å§‹&quot;]&#125;&#x27;JSON.SET user:10008 $ &#x27;&#123;&quot;name&quot;:&quot;Henry&quot;,&quot;age&quot;:45,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:59.9,&quot;status&quot;:&quot;CANCELLED&quot;&#125;],&quot;comment&quot;: &quot;I have a macbook&quot;,&quot;items&quot;:[&quot;SpringBootæŠ€æœ¯æŒ‡å—&quot;,&quot;Mavenç”±æµ…å…¥æ·±&quot;]&#125;&#x27;JSON.SET user:10009 $ &#x27;&#123;&quot;name&quot;:&quot;Ivy&quot;,&quot;age&quot;:26,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:299,&quot;status&quot;:&quot;PAID&quot;&#125;,&#123;&quot;amount&quot;:199,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;: &quot;I have a watch&quot;,&quot;items&quot;:[&quot;Springèä¼šè´µé€š&quot;,&quot;JavaæŠ€æœ¯å¼€å‘æŒ‡å—&quot;]&#125;&#x27;JSON.SET user:10010 $ &#x27;&#123;&quot;name&quot;:&quot;Jack&quot;,&quot;age&quot;:38,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:150,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;: &quot;I have a apple&quot;,&quot;items&quot;:[&quot;SpringæŠ€æœ¯æŒ‡å—&quot;,&quot;Javaç”±æµ…å…¥æ·±&quot;]&#125;&#x27; SpringBootæš‚æ—¶æ²¡æœ‰æ”¯æŒ RediSearch ï¼Œä½ å¯ä»¥ç¼–å†™Luaè„šæœ¬æ¥å®ç°ç›¸åº”çš„åŠŸèƒ½ï¼Œå¦å¤– Redissonå·²ç»æä¾›äº†å¯¹ RediSearch çš„æ”¯æŒï¼Œä¸‹é¢ç»“åˆå‘½ä»¤ç»™å‡ºä»£ç ç¤ºä¾‹ã€‚ 123456&lt;!-- å¼•å…¥ Redisson ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œç°åœ¨æœ€æ–°ç‰ˆæ˜¯ 4.0.0ï¼Œéœ€è¦ springboot 4.x --&gt;&lt;dependency&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.52.0&lt;/version&gt;&lt;/dependency&gt; é€šç”¨ä»£ç  1234@Autowiredprivate RedissonClient redissonClient;RSearch rSearch = redissonClient.getSearch(StringCodec.INSTANCE); ä¸€ã€ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ç±» å‘½ä»¤ ä½œç”¨ æ ¸å¿ƒå‚æ•° ç¤ºä¾‹ FT.CREATE åˆ›å»ºç´¢å¼• ç´¢å¼•åã€ONã€PREFIXã€SCHEMA è§ä¸‹ FT.ALTER ç»™å·²æœ‰ç´¢å¼•æ–°å¢å­—æ®µ ç´¢å¼•åã€SCHEMA ADD è§ä¸‹ FT.DROPINDEX åˆ é™¤ç´¢å¼• ç´¢å¼•åã€DD è§ä¸‹ FT.INFO æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ ç´¢å¼•å è§ä¸‹ FT._LIST åˆ—å‡ºæ‰€æœ‰ç´¢å¼• æ—  è§ä¸‹ 1ï¸âƒ£ FT.CREATE FT.CREATE åŸºæœ¬è¯­æ³• 123456789101112131415161718FT.CREATE index_name[ON HASH | JSON][PREFIX count prefix ...][FILTER filter][LANGUAGE default_lang][LANGUAGE_FIELD lang_attribute][SCORE default_score][SCORE_FIELD score_attribute][PAYLOAD_FIELD payload_attribute][MAXTEXTFIELDS][TEMPORARY seconds][NOOFFSETS] [NOHL] [NOFIELDS] [NOFREQS][STOPWORDS count stopword ...][SKIPINITIALSCAN]SCHEMA field_name [AS alias] TEXT | TAG | NUMERIC | GEO | VECTOR [SORTABLE [UNF]] [NOINDEX] FT.CREATE å‚æ•°è¯´æ˜è¡¨ å‚æ•° ä½œç”¨è¯´æ˜ index_name ç´¢å¼•åç§° ON HASH | JSON æŒ‡å®šç´¢å¼•æ•°æ®æ¥æºç±»å‹ï¼Œé»˜è®¤ HASH PREFIX count prefix... æŒ‡å®šç´¢å¼• Key å‰ç¼€ FILTER filter å¯¹ç´¢å¼•æ•°æ®è®¾ç½®è¿‡æ»¤è¡¨è¾¾å¼ LANGUAGE æŒ‡å®šé»˜è®¤åˆ†è¯è¯­è¨€ï¼ˆé»˜è®¤ englishï¼Œä¸­æ–‡æ˜¯ chineseï¼‰ LANGUAGE_FIELD æŒ‡å®šæ–‡æ¡£ä¸­çš„è¯­è¨€å­—æ®µ SCORE è®¾ç½®æ–‡æ¡£é»˜è®¤è¯„åˆ† SCORE_FIELD ä»å­—æ®µä¸­è¯»å–è¯„åˆ† PAYLOAD_FIELD æŒ‡å®šå­˜å‚¨çš„äºŒè¿›åˆ¶è´Ÿè½½å­—æ®µ MAXTEXTFIELDS å…è®¸æ›´å¤š TEXT å­—æ®µï¼ˆæ¶ˆè€—æ›´å¤šå†…å­˜ï¼‰ TEMPORARY seconds åˆ›å»ºä¸´æ—¶ç´¢å¼•ï¼Œè¶…æ—¶åè‡ªåŠ¨åˆ é™¤ NOOFFSETS ä¸å­˜å‚¨æ–‡æœ¬åç§»é‡ï¼ˆèŠ‚çœå†…å­˜ï¼‰ NOHL ç¦ç”¨é«˜äº® NOFIELDS ä¸ä¿å­˜å­—æ®µå†…å®¹ NOFREQS ä¸ä¿å­˜è¯é¢‘ä¿¡æ¯ STOPWORDS count ... æŒ‡å®šåœç”¨è¯ SKIPINITIALSCAN åˆ›å»ºç´¢å¼•æ—¶ä¸æ‰«æå·²æœ‰æ•°æ® SCHEMA ç´¢å¼•å­—æ®µå®šä¹‰èµ·å§‹ AS alias å­—æ®µåˆ«å TEXT å…¨æ–‡ç´¢å¼•å­—æ®µ TAG ç²¾ç¡®åŒ¹é…å­—æ®µ NUMERIC æ•°å€¼å­—æ®µ GEO åœ°ç†ä½ç½®å­—æ®µ VECTOR å‘é‡å­—æ®µ SORTABLE å…è®¸æ’åº UNF ä¸è§„èŒƒåŒ–æ’åº NOINDEX å­—æ®µä¸å‚ä¸ç´¢å¼• FT.CREATE çš„æ ¸å¿ƒè¯­æ³• 123456FT.CREATE &lt;index&gt;[ON HASH | JSON][PREFIX count prefix ...][LANGUAGE default_lang]SCHEMA field_name [AS alias] TEXT | TAG | NUMERIC | GEO | VECTOR åˆ›å»ºç´¢å¼•ç¤ºä¾‹ 12345678910111213141516171819202122FT.CREATE idx:user ON JSON PREFIX 1 user: LANGUAGE chinese SCHEMA $.name AS name TEXT $.age AS age NUMERIC SORTABLE $.orders[*].amount AS amount NUMERIC $.orders[*].status AS status TAG $.comment AS comment TEXT $.items[*] AS items TEXT# å‚æ•°è¯´æ˜ # idx:userï¼šç´¢å¼•å # ON JSONï¼šç´¢å¼• JSON æ–‡æ¡£ï¼ŒRediSearch ä»…æ”¯æŒå¯¹ HASH å’Œ JSON è¿›è¡Œç´¢å¼• # PREFIX 1 user: ï¼šç´¢å¼•æŒ‡å®š key å‰ç¼€ï¼Œ1 è¡¨ç¤ºç´¢å¼•ä¸€ä¸ªï¼Œuser: è¡¨ç¤ºç´¢å¼•çš„ key å‰ç¼€ï¼Œå¦‚æœç´¢å¼•ä¸¤ä¸ªï¼šPREFIX 2 user: order: # LANGUAGE chineseï¼šæŒ‡å®šé»˜è®¤åˆ†è¯è¯­è¨€ï¼Œé»˜è®¤æ˜¯è‹±æ–‡ englishï¼Œä¸­æ–‡æ˜¯ chineseï¼Œå¦‚æœç´¢å¼•ä¸­æœ‰ä¸­æ–‡ï¼Œåˆ™å¿…é¡»æŒ‡å®š LANGUAGE ä¸º chinese # SCHEMAï¼šç´¢å¼•å­—æ®µ # $.name AS name TEXTï¼šç´¢å¼•å­—æ®µ $.name(æ³¨æ„ï¼šJSONç±»å‹ä»¥ $. å¼€å¤´ï¼ŒHashç±»å‹å°±ä¸éœ€è¦äº†)ï¼Œå­—æ®µåˆ«åä¸º nameï¼Œå­—æ®µç±»å‹ä¸º TEXT # ASï¼šå­—æ®µåˆ«åï¼ˆæŸ¥è¯¢æ—¶ä½¿ç”¨ï¼‰ # TEXT / NUMERIC / TAGï¼šå­—æ®µç±»å‹ï¼Œè¿™å‡ ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ # SORTABLEï¼šNUMERICã€TAGã€TEXT æˆ– GEO ç±»å‹çš„å­—æ®µå¯ä»¥å¸¦æœ‰ä¸€ä¸ªå¯é€‰çš„ SORTABLE å‚æ•°ï¼Œè¡¨ç¤ºä¸ºå­—æ®µå»ºç«‹ä¸“é—¨çš„æ’åºæ•°æ®ç»“æ„ï¼ˆç±»ä¼¼åˆ—å¼å­˜å‚¨ï¼‰ï¼Œä»è€Œé¿å…åœ¨æŸ¥è¯¢é˜¶æ®µå¯¹å¤§é‡ç»“æœè¿›è¡Œä¸´æ—¶æ’åºã€‚ 12345678910111213rSearch.createIndex( &quot;idx:user&quot;, IndexOptions.defaults() .on(IndexType.JSON) .prefix(List.of(&quot;user:&quot;)) .language(&quot;chinese&quot;), FieldIndex.text(&quot;$.name&quot;).as(&quot;name&quot;), FieldIndex.numeric(&quot;$.age&quot;).as(&quot;age&quot;), FieldIndex.numeric(&quot;$.orders[*].amount&quot;).as(&quot;amount&quot;), FieldIndex.tag(&quot;$.orders[*].status&quot;).as(&quot;status&quot;), FieldIndex.text(&quot;$.comment&quot;).as(&quot;comment&quot;), FieldIndex.text(&quot;$.items[*]&quot;).as(&quot;items&quot;)); ç´¢å¼•å­—æ®µçš„ç±»å‹ å­—æ®µç±»å‹ ä¸­æ–‡åç§° åŠŸèƒ½è¯´æ˜ å…¸å‹ä½¿ç”¨åœºæ™¯ å¤‡æ³¨ / é™åˆ¶ TEXT å…¨æ–‡æ–‡æœ¬å­—æ®µ æ”¯æŒå¯¹å­—æ®µå€¼è¿›è¡Œå…¨æ–‡æ£€ç´¢ï¼ˆåˆ†è¯ã€ç›¸å…³åº¦è®¡ç®—ã€æ¨¡ç³ŠåŒ¹é…ç­‰ï¼‰ æ–‡ç« å†…å®¹ã€ç”¨æˆ·åã€æè¿°ä¿¡æ¯ æ”¯æŒæƒé‡ï¼ˆWEIGHTï¼‰ã€æ’åºï¼ˆSORTABLEï¼‰ç­‰é€‰é¡¹ TAG æ ‡ç­¾å­—æ®µ / ç²¾ç¡®åŒ¹é…å­—æ®µ æ”¯æŒç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼Œé€‚ç”¨äºæšä¸¾å€¼æˆ–ç¦»æ•£åˆ†ç±» åˆ†ç±»ã€çŠ¶æ€ã€ä¸»é”®ã€ç±»å‹å­—æ®µ ä¸åˆ†è¯ï¼›å¯è‡ªå®šä¹‰åˆ†éš”ç¬¦ NUMERIC æ•°å€¼å­—æ®µ æ”¯æŒæ•°å€¼èŒƒå›´æŸ¥è¯¢ å¹´é¾„ã€ä»·æ ¼ã€åˆ†æ•°ã€æ—¶é—´æˆ³ æ”¯æŒåŒºé—´æŸ¥è¯¢ï¼ˆ[min max]ï¼‰ GEO åœ°ç†ä½ç½®å­—æ®µï¼ˆç‚¹ï¼‰ æ”¯æŒä»¥â€œç‚¹â€ä¸ºä¸­å¿ƒçš„åŠå¾„èŒƒå›´æŸ¥è¯¢ é—¨åº—ä½ç½®ã€ç”¨æˆ·ä½ç½® å€¼æ ¼å¼å¿…é¡»ä¸º &quot;ç»åº¦,çº¬åº¦&quot; VECTOR å‘é‡å­—æ®µ æ”¯æŒå‘é‡ç›¸ä¼¼åº¦æœç´¢ï¼ˆKNN ç­‰ï¼‰ è¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿã€Embedding å‘é‡ éœ€è¦ Query Dialect â‰¥ 2ï¼ˆRediSearch â‰¥ 2.4ï¼‰ GEOSHAPE åœ°ç†å½¢çŠ¶å­—æ®µï¼ˆå¤šè¾¹å½¢ï¼‰ æ”¯æŒå¤šè¾¹å½¢ç©ºé—´æŸ¥è¯¢ è¡Œæ”¿åŒºã€å•†åœˆã€åœ°å›¾åŒºåŸŸ ä½¿ç”¨ WKT æ ¼å¼ï¼›ä¸æ”¯æŒ JSON å¤šå€¼å’Œ SORTABLE GEOSHAPE å­—æ®µè¡¥å……è¯´æ˜ é¡¹ç›® è¯´æ˜ æ•°æ®æ ¼å¼ WKTï¼ˆWell-Known Textï¼‰æ ¼å¼ï¼Œå¦‚ï¼šPOLYGON((x1 y1, x2 y2, ...)) åæ ‡ç³»ç»Ÿ SPHERICALï¼ˆçƒé¢åæ ‡ï¼Œç»çº¬åº¦ï¼‰FLATï¼ˆå¹³é¢åæ ‡ï¼Œç¬›å¡å°” X/Yï¼‰ é»˜è®¤åæ ‡ç³»ç»Ÿ SPHERICAL å½“å‰é™åˆ¶ âŒ ä¸æ”¯æŒ JSON å¤šå€¼âŒ ä¸æ”¯æŒ SORTABLE é€‰é¡¹ ç´¢å¼•å­—æ®µç±»å‹é€‰å‹å»ºè®® ä½¿ç”¨åœºæ™¯ æ¨èå­—æ®µç±»å‹ è¯´æ˜ å…¨æ–‡æ£€ç´¢ TEXT æ”¯æŒåˆ†è¯ã€ç›¸å…³åº¦è®¡ç®—ã€æ¨¡ç³ŠåŒ¹é…ç­‰å…¨æ–‡æœç´¢èƒ½åŠ› ç²¾ç¡®è¿‡æ»¤ / åˆ†ç±» TAG ç²¾ç¡®åŒ¹é…ï¼Œä¸åˆ†è¯ï¼Œé€‚åˆæšä¸¾å€¼ã€çŠ¶æ€ã€ç±»å‹ç­‰å­—æ®µ åŒºé—´ç­›é€‰ / æ’åº NUMERIC æ”¯æŒæ•°å€¼åŒºé—´æŸ¥è¯¢ä¸æ’åºï¼Œé€‚åˆä»·æ ¼ã€æ—¶é—´ã€åˆ†æ•°ç­‰ é™„è¿‘çš„äºº / é—¨åº— GEO åŸºäºç»çº¬åº¦ç‚¹è¿›è¡ŒåŠå¾„èŒƒå›´æŸ¥è¯¢ è¯­ä¹‰æœç´¢ / å‘é‡å¬å› VECTOR åŸºäºå‘é‡ç›¸ä¼¼åº¦ï¼ˆKNNï¼‰çš„è¯­ä¹‰æœç´¢ï¼Œéœ€è¦ Dialect â‰¥ 2 å¤æ‚åœ°ç†åŒºåŸŸåˆ¤æ–­ GEOSHAPE æ”¯æŒå¤šè¾¹å½¢ï¼ˆPolygonï¼‰åŒºåŸŸæŸ¥è¯¢ï¼Œé€‚åˆè¡Œæ”¿åŒºã€å•†åœˆç­‰ å“ªäº›å­—æ®µé€‚åˆä½¿ç”¨ SORTABLE å­—æ®µç±»å‹ æ˜¯å¦é€‚åˆ SORTABLE åŸå›  NUMERIC âœ… å¼ºçƒˆæ¨è æ•°å€¼æ’åºæœ€å¸¸è§ï¼Œå¦‚ä»·æ ¼ã€æ—¶é—´ã€è¯„åˆ† TAG âš ï¸ è§†æƒ…å†µ ä¸€èˆ¬ç”¨äºè¿‡æ»¤ï¼Œæ’åºæ„ä¹‰ä¸å¤§ TEXT âš ï¸ è°¨æ… æ–‡æœ¬å¯èƒ½å¾ˆå¤§ï¼Œå†…å­˜å¼€é”€é«˜ GEO âš ï¸ ç‰¹æ®Šåœºæ™¯ é€šå¸¸æŒ‰è·ç¦»æ’åºï¼Œæ›´å¤šä¾èµ– GEOFILTER å°è´´å£«ï¼šå¦‚ä½•åœ¨redisç»ˆç«¯è¾“å…¥å¤šè¡Œçš„å‘½ä»¤ï¼Ÿ å…ˆè¯´ç»“è®ºï¼šredisç»ˆç«¯ ä¸æ”¯æŒå¤šè¡Œè¾“å…¥ï¼Œä½†å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¾“å…¥å¤šè¡Œå‘½ä»¤ï¼š 123456redis-cli &lt;&lt;EOFHSET user:1 \\name Tom \\age 18 \\city BeijingEOF è¿™ç§æ–¹æ³•æ˜¯åˆ©ç”¨äº† Bash çš„èƒ½åŠ›ï¼Œå³ &lt;&lt;EOF åé¢çš„å†…å®¹ä¼šä½œä¸ºæ ‡å‡†è¾“å…¥ï¼Œç›´åˆ° EOF ä¸ºæ­¢ï¼Œå¹¶é€šè¿‡ \\ ç¬¦æ¢è¡Œã€‚ å¦‚æœåœ¨VSCodeä¸­ï¼Œå¯ä»¥é€‰ä¸­è¦åˆå¹¶çš„å¤šè¡Œå†…å®¹ï¼Œç„¶åé€šè¿‡ Ctrl + Shift + J å¿«æ·é”®å°†å¤šè¡Œåˆå¹¶åˆ°ä¸€è¡Œã€‚ 2ï¸âƒ£ FT.ALTER âš ï¸ åªèƒ½ æ–°å¢å­—æ®µï¼Œä¸èƒ½ä¿®æ”¹æˆ–åˆ é™¤å·²æœ‰å­—æ®µ 1FT.ALTER idx:user SCHEMA ADD $.vip AS vip TAG 12345rSearch.alter( &quot;idx:user&quot;, false, FieldIndex.tag(&quot;$.vip&quot;).as(&quot;vip&quot;)); 3ï¸âƒ£ FT.DROPINDEX âš ï¸ åˆ é™¤ç´¢å¼• 123FT.DROPINDEX idx:user# âš ï¸ DDï¼šåˆ é™¤ç´¢å¼•çš„åŒæ—¶åˆ é™¤è¢«ç´¢å¼•æ•°æ®ï¼Œè°¨æ…ä½¿ç”¨FT.DROPINDEX idx:user DD 12rSearch.dropIndex(&quot;idx:user&quot;);rSearch.dropIndexAndDocuments(&quot;idx:user&quot;); 4ï¸âƒ£ FT.INFO æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ 1FT.INFO idx:user 1IndexInfo info = rSearch.info(&quot;idx:user&quot;); é‡ç‚¹å…³æ³¨å­—æ®µ å­—æ®µ å«ä¹‰ è§£é‡Š num_docs å½“å‰è¢«ç´¢å¼•ã€å¯è¢«æœç´¢çš„æ–‡æ¡£æ•°é‡ user:10001 ~ user:10010ï¼Œ10æ¡æ–‡æ¡£ num_terms è¯å…¸ä¸­å”¯ä¸€è¯é¡¹ term çš„æ•°é‡ä¸»è¦æ¥æºäº TEXTï¼ˆnameï¼‰ å’Œ TAGï¼ˆvip, statusï¼‰ å­—æ®µå»é‡ä¹‹åçš„æ•°é‡ name: alice, bob, carol, â€¦vip: yes, nostatus: PAID, CREATED, CANCELLED num_records å€’æ’ç´¢å¼•ä¸­çš„è®°å½•æ¡ç›®æ€»æ•°æ‰€æœ‰ term åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­çš„å‡ºç°æ¬¡æ•°ä¹‹å’Œ JSON æ•°ç»„å­—æ®µ orders[],æ¯ä¸ª order éƒ½ä¼šç”Ÿæˆç‹¬ç«‹çš„ç´¢å¼• entryå¤šå€¼å­—æ®µ Ã— å¤šæ–‡æ¡£ = record çˆ†ç‚¸å¼å¢é•¿num_records çœŸæ­£å½±å“ï¼šå†…å­˜ã€æŸ¥è¯¢é€Ÿåº¦ã€èšåˆæˆæœ¬ 5ï¸âƒ£ FT._LIST åˆ—å‡ºæ‰€æœ‰ç´¢å¼• 1FT._LIST 1List&lt;String&gt; indexes = rSearch.getIndexes(); äºŒã€æŸ¥è¯¢ç±»ï¼ˆæ ¸å¿ƒï¼‰ å‘½ä»¤ ä½œç”¨ é€‚ç”¨åœºæ™¯ FT.SEARCH æ ‡å‡†æœç´¢ 90% åœºæ™¯ FT.AGGREGATE åˆ†ç»„ / ç»Ÿè®¡ / èšåˆ æŠ¥è¡¨ã€åˆ†æ FT.HYBRID æ–‡æœ¬ + å‘é‡æ··åˆ å‘é‡æœç´¢ FT.EXPLAIN æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ è°ƒä¼˜ FT.EXPLAINCLI CLI å¯è¯»æ‰§è¡Œè®¡åˆ’ è°ƒè¯• FT.PROFILE æ€§èƒ½åˆ†æ æ…¢æŸ¥è¯¢ 1ï¸âƒ£ FT.SEARCH FT.SEARCH åŸºæœ¬è¯­æ³• 1234567891011121314151617181920FT.SEARCH index query[NOCOENTENT] [VERBATIM] [NOSTOPWORDS][WITHSCORES] [WITHPAYLOADS] [WITHSORTKEYS][FILTER numeric_field min max ...][GEOFILTER geo_field lon lat radius m|km|mi|ft][INKEYS count key ...][INFIELDS count field ...][RETURN count identifier [AS property] ...][SUMMARIZE FIELDS count field ... FRAGS num LEN fragsize SEPARATOR sep][HIGHLIGHT FIELDS count field ... TAGS open close][SLOP slop] [TIMEOUT timeout] [INORDER][LANGUAGE language][EXPANDER expander][SCORER scorer][EXPLAINSCORE][PAYLOAD payload][SORTBY sortby ASC|DESC][LIMIT offset num][PARAMS nargs name value ...][DIALECT dialect] FT.SEARCH å‚æ•°è¯´æ˜è¡¨ å‚æ•° ä½œç”¨è¯´æ˜ index ç´¢å¼•åç§° query æŸ¥è¯¢æ¡ä»¶ï¼ˆç±»ä¼¼ SQL WHEREï¼‰ NOCONTENT ä»…è¿”å›æ–‡æ¡£ IDï¼Œä¸è¿”å›å†…å®¹ VERBATIM ç¦ç”¨æŸ¥è¯¢ä¼˜åŒ–ï¼Œå®Œå…¨æŒ‰åŸæŸ¥è¯¢æ‰§è¡Œ NOSTOPWORDS æŸ¥è¯¢æ—¶ä¸å¿½ç•¥åœç”¨è¯ WITHSCORES è¿”å›åŒ¹é…æ–‡æ¡£çš„ç›¸å…³æ€§è¯„åˆ† WITHPAYLOADS è¿”å›æ–‡æ¡£çš„ payload æ•°æ® WITHSORTKEYS è¿”å›æ’åºä½¿ç”¨çš„ key FILTER æ•°å€¼å­—æ®µè¿‡æ»¤ï¼ˆèŒƒå›´æŸ¥è¯¢ï¼‰ GEOFILTER åœ°ç†ä½ç½®èŒƒå›´æŸ¥è¯¢ INKEYS ä»…åœ¨æŒ‡å®šçš„ key é›†åˆä¸­æœç´¢ INFIELDS ä»…åœ¨æŒ‡å®šå­—æ®µä¸­æœç´¢ RETURN æŒ‡å®šè¿”å›çš„å­—æ®µ SUMMARIZE è¿”å›å­—æ®µå†…å®¹æ‘˜è¦ HIGHLIGHT é«˜äº®åŒ¹é…çš„å…³é”®è¯ SLOP è®¾ç½®çŸ­è¯­æŸ¥è¯¢ä¸­å…è®¸çš„è¯è· TIMEOUT è®¾ç½®æŸ¥è¯¢è¶…æ—¶æ—¶é—´ INORDER çŸ­è¯­å¿…é¡»æŒ‰é¡ºåºåŒ¹é… LANGUAGE æŒ‡å®šæŸ¥è¯¢è¯­è¨€ EXPANDER ä½¿ç”¨è‡ªå®šä¹‰æŸ¥è¯¢æ‰©å±•å™¨ SCORER ä½¿ç”¨è‡ªå®šä¹‰è¯„åˆ†å‡½æ•° EXPLAINSCORE è¿”å›è¯„åˆ†è®¡ç®—è¯¦æƒ… PAYLOAD ç»™è¯„åˆ†å‡½æ•°ä¼ å…¥è‡ªå®šä¹‰å‚æ•° SORTBY æŒ‰æŒ‡å®šå­—æ®µæ’åº ASC / DESC æ’åºæ–¹å‘ LIMIT åˆ†é¡µæ§åˆ¶ PARAMS å‚æ•°åŒ–æŸ¥è¯¢ DIALECT æŒ‡å®šæŸ¥è¯¢è¯­æ³•ç‰ˆæœ¬ FT.SEARCH æ ¸å¿ƒè¯­æ³• 12345FT.SEARCH indexquery[RETURN count identifier [AS property] ...][SORTBY sortby ASC|DESC][LIMIT offset num] æ ‡å‡†æœç´¢ 1234567891011121314151617FT.SEARCH idx:user &#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27; RETURN 3 name status amount SORTBY amount DESC LIMIT 0 10## å‚æ•°è¯´æ˜ # æŸ¥è¯¢æ¡ä»¶ï¼š&#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27; # æŸ¥è¯¢æ¡ä»¶è¯­æ³•ï¼š # &#x27;xxx&#x27;: å…¨æ–‡æ£€ç´¢åŒ…å« xxx çš„æ•°æ®ï¼Œä¼šä» TEXT å­—æ®µä¸­åŒ¹é… # &#x27;@field:value&#x27;: åŒ¹é…å­—æ®µ field çš„å€¼æ˜¯ valueï¼Œè¦æ±‚ field çš„ç±»å‹ä¸º TEXTï¼Œå…¨æ–‡æ£€ç´¢ # &#x27;@field:&#123;xxx&#125;&#x27;:ç²¾ç¡®åŒ¹é…ï¼Œ&#123;xxx*&#125;:åŒ¹é…å‰ç¼€ï¼Œ&#123;xxx|yyy&#125;:åŒ¹é…ä»»æ„ä¸€ä¸ªï¼Œè¦æ±‚ field çš„ç±»å‹ä¸º TAG # &#x27;@field:[min max]&#x27;: èŒƒå›´åŒ¹é…ï¼Œè¿™é‡Œ +inf è¡¨ç¤ºæ­£æ— ç©·å¤§ï¼Œè¦æ±‚ field çš„ç±»å‹ä¸º NUMERIC # å¤šä¸ªæ¡ä»¶ç©ºæ ¼åˆ†éš” # æ¨¡ç³ŠåŒ¹é…ï¼š* è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œå³åŒ¹é…æ‰€æœ‰# RETURN 3 name status amount è¿”å›å­—æ®µï¼Œ3:è¡¨ç¤ºè¿”å› 3 ä¸ªå­—æ®µ# LIMIT 0 10 åˆ†é¡µï¼Œ0:è¡¨ç¤ºä»ç¬¬ 0 æ¡å¼€å§‹ï¼Œ10:è¡¨ç¤ºè¿”å› 10 æ¡æ•°æ®# SORTBY amount DESC æ’åºï¼Œamount:è¡¨ç¤ºæ’åºå­—æ®µï¼ŒDESC:è¡¨ç¤ºé™åº 123456789101112131415161718SearchResult result = rSearch.search( &quot;idx:user&quot;, &quot;@status:&#123;PAID&#125; @amount:[50 +inf]&quot;, QueryOptions.defaults() .returnAttributes(new ReturnAttribute(&quot;name&quot;), new ReturnAttribute(&quot;status&quot;),new ReturnAttribute(&quot;amount&quot;)) .sortBy(&quot;amount&quot;) .sortOrder(SortOrder.DESC) .limit(0, 10));long total = result.getTotal();System.out.println(&quot;total = &quot; + total);List&lt;Document&gt; docs = result.getDocuments();for (Document doc: docs) &#123; String id = doc.getId(); Map&lt;String, Object&gt; attrs = doc.getAttributes(); System.out.println(&quot;id = &quot; + id + &quot; attrs = &quot; + attrs);&#125; 12345678910# å…¨æ–‡æ£€ç´¢ï¼Œä» æ‰€æœ‰ TEXT å­—æ®µä¸­åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œå³ phone/Phone/PHONE éƒ½åŒ¹é…FT.SEARCH idx:user &#x27;phone&#x27;## ç¤ºä¾‹ç»“æœ1) (integer) 22) &quot;user:10006&quot;3) 1) &quot;$&quot; 2) &quot;&#123;\\&quot;name\\&quot;:\\&quot;Frank\\&quot;,\\&quot;age\\&quot;:27,\\&quot;vip\\&quot;:\\&quot;no\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:499,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;,&#123;\\&quot;amount\\&quot;:129,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a phone\\&quot;,\\&quot;items\\&quot;:[\\&quot;Redis\\xe5\\xbc\\x80\\xe5\\x8f\\x91\\xe5\\xae\\x9e\\xe6\\x88\\x98\\&quot;,\\&quot;MongoDB\\xe4\\xbb\\x8e\\xe5\\x85\\xa5\\xe9\\x97\\xa8\\xe5\\x88\\xb0\\xe5\\xae\\x9e\\xe6\\x88\\x98\\&quot;]&#125;&quot;4) &quot;user:10001&quot;5) 1) &quot;$&quot; 2) &quot;&#123;\\&quot;name\\&quot;:\\&quot;Alice Bob\\&quot;,\\&quot;age\\&quot;:28,\\&quot;vip\\&quot;:\\&quot;yes\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;,&#123;\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a phone\\&quot;,\\&quot;items\\&quot;:[\\&quot;SpringCloud\\xe6\\x8a\\x80\\xe6\\x9c\\xaf\\xe6\\x8c\\x87\\xe5\\x8d\\x97\\&quot;,\\&quot;Shell\\xe8\\x84\\x9a\\xe6\\x9c\\xac\\xe5\\x9f\\xba\\xe7\\xa1\\x80\\&quot;]&#125;&quot; 12345SearchResult result = rSearch.search( &quot;idx:user&quot;, &quot;phone&quot;, QueryOptions.defaults()); 12345678910# ä¸­æ–‡æ£€ç´¢FT.SEARCH idx:user &#x27;å¼€å§‹&#x27;## ç¤ºä¾‹ç»“æœ1) (integer) 22) &quot;user:10005&quot;3) 1) &quot;$&quot; 2) &quot;&#123;\\&quot;name\\&quot;:\\&quot;Eve\\&quot;,\\&quot;age\\&quot;:30,\\&quot;vip\\&quot;:\\&quot;no\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:88.8,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a pencil\\&quot;,\\&quot;items\\&quot;:[\\&quot;Kafka\\xe4\\xbb\\x8e\\xe9\\x9b\\xb6\\xe5\\xbc\\x80\\xe5\\xa7\\x8b\\&quot;,\\&quot;Java\\xe7\\x94\\xb1\\xe6\\xb5\\x85\\xe5\\x85\\xa5\\xe6\\xb7\\xb1\\&quot;]&#125;&quot;4) &quot;user:10007&quot;5) 1) &quot;$&quot; 2) &quot;&#123;\\&quot;name\\&quot;:\\&quot;Grace\\&quot;,\\&quot;age\\&quot;:33,\\&quot;vip\\&quot;:\\&quot;yes\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:999.9,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a book\\&quot;,\\&quot;items\\&quot;:[\\&quot;Android\\xe5\\xbc\\x80\\xe5\\x8f\\x91\\xe6\\x89\\x8b\\xe5\\x86\\x8c\\&quot;,\\&quot;Gradle\\xe4\\xbb\\x8e\\xe9\\x9b\\xb6\\xe5\\xbc\\x80\\xe5\\xa7\\x8b\\&quot;]&#125;&quot; 12345SearchResult result = rSearch.search( &quot;idx:user&quot;, &quot;å¼€å§‹&quot;, QueryOptions.defaults()); å°è´´å£« çœ‹åˆ°ä¸­æ–‡è¾“å‡ºæ˜¯ä¹±ç ï¼Œå¯ä»¥åœ¨ç™»å½•å®¢æˆ·ç«¯æ—¶åŠ ä¸Š --raw 123456789redis-cli --user admin -a 123456 --raw127.0.0.1:6379&gt; FT.SEARCH idx:user &#x27;å¼€å§‹&#x27;2user:10005$&#123;&quot;name&quot;:&quot;Eve&quot;,&quot;age&quot;:30,&quot;vip&quot;:&quot;no&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:88.8,&quot;status&quot;:&quot;CREATED&quot;&#125;],&quot;comment&quot;:&quot;I have a pencil&quot;,&quot;items&quot;:[&quot;Kafkaä»é›¶å¼€å§‹&quot;,&quot;Javaç”±æµ…å…¥æ·±&quot;]&#125;user:10007$&#123;&quot;name&quot;:&quot;Grace&quot;,&quot;age&quot;:33,&quot;vip&quot;:&quot;yes&quot;,&quot;orders&quot;:[&#123;&quot;amount&quot;:999.9,&quot;status&quot;:&quot;PAID&quot;&#125;],&quot;comment&quot;:&quot;I have a book&quot;,&quot;items&quot;:[&quot;Androidå¼€å‘æ‰‹å†Œ&quot;,&quot;Gradleä»é›¶å¼€å§‹&quot;]&#125; SQL WHERE ä¸ RediSearch æŸ¥è¯¢è¯­æ³•å¯¹ç…§è¡¨ x/y/name â†’ TEXT/TAG(è¦åŠ ä¸Š&#123;&#125;) å­—æ®µï¼Œnumâ†’NUMERIC å­—æ®µï¼ŒæŸ¥è¯¢è¯­æ³•ç”¨äº FT.SEARCH/FT.AGGREGATE çš„æŸ¥è¯¢å­—ç¬¦ä¸²éƒ¨åˆ† ID SQL æ¡ä»¶ RediSearch å¯¹ç­‰å†™æ³• è¯´æ˜ 1 WHERE x = 'book' AND y = 'phone' @x:book @y:phone AND ä¸ºé»˜è®¤å…³ç³»ï¼ˆç©ºæ ¼ï¼‰ 2 WHERE x = 'book' AND y != 'phone' @x:book -@y:phone - è¡¨ç¤º NOT 3 WHERE x = 'book' OR y = 'phone' (@x:book) | (@y:phone) OR å¿…é¡»æ˜¾å¼å†™ | 4 WHERE x IN ('book','phone','hello world') @x:(book|phone|&quot;hello world&quot;) å¤šå€¼ ORï¼ŒçŸ­è¯­éœ€åŠ å¼•å· 5 WHERE y='book' AND x NOT IN ('book','phone') @y:book -(@x:book|@x:phone) NOT IN = NOT + OR 6 WHERE x NOT IN ('book','phone') -@x:(book|phone) æ•´ä½“å¦å®š 7 WHERE num BETWEEN 10 AND 20 @num:[10 20] æ•°å€¼åŒºé—´ï¼ˆé—­åŒºé—´ï¼‰ 8 WHERE num &gt;= 10 @num:[10 +inf] +inf è¡¨ç¤ºæ­£æ— ç©· 9 WHERE num &gt; 10 @num:[(10 +inf] ( è¡¨ç¤ºä¸åŒ…å« 10 WHERE num &lt; 10 @num:[-inf (10] å°äºï¼ˆä¸å« 10ï¼‰ 11 WHERE num &lt;= 10 @num:[-inf 10] å°äºç­‰äº 12 WHERE num &lt; 10 OR num &gt; 20 @num:[-inf (10] | @num:[(20 +inf] æ•°å€¼ OR 13 WHERE name LIKE 'Li%' @name:Li* å‰ç¼€åŒ¹é… 2ï¸âƒ£ FT.AGGREGATE åˆ†ç»„ / ç»Ÿè®¡ / èšåˆï¼Œè¯­æ³• FT.AGGREGATE åŸºæœ¬è¯­æ³• 1234567891011121314FT.AGGREGATE index query[VERBATIM][LOAD count field ... | LOAD *][TIMEOUT timeout][GROUPBY nargs property ... REDUCE function nargs arg ... [AS name] ...][SORTBY nargs property ASC|DESC ... [MAX num]][APPLY expression AS name][LIMIT offset num][FILTER filter][WITHCURSOR [COUNT read_size]][MAXIDLE idle_time][PARAMS nargs name value ...][DIALECT dialect] FT.AGGREGATE å‚æ•°è¯´æ˜è¡¨ å‚æ•° ä½œç”¨è¯´æ˜ index ç´¢å¼•åç§° query æŸ¥è¯¢æ¡ä»¶ï¼ˆç±»ä¼¼ WHEREï¼‰ VERBATIM ç¦ç”¨æŸ¥è¯¢ä¼˜åŒ– LOAD åŠ è½½åŸå§‹å­—æ®µ TIMEOUT æŸ¥è¯¢è¶…æ—¶æ—¶é—´ GROUPBY åˆ†ç»„å­—æ®µï¼ˆç±»ä¼¼ SQL GROUP BYï¼‰ REDUCE èšåˆå‡½æ•°ï¼ˆCOUNT / SUM / AVG / MIN / MAX ç­‰ï¼‰ AS èšåˆç»“æœåˆ«å SORTBY å¯¹èšåˆç»“æœæ’åº ASC / DESC æ’åºæ–¹å‘ MAX æœ€å¤§è¿”å›æ¡æ•° APPLY å¯¹ç»“æœå­—æ®µè¿›è¡Œè¡¨è¾¾å¼è®¡ç®— LIMIT åˆ†é¡µæ§åˆ¶ FILTER ç»“æœè¿‡æ»¤ï¼ˆWHERE / HAVINGï¼‰ WITHCURSOR ä½¿ç”¨æ¸¸æ ‡ï¼ˆå¤§ç»“æœé›†ï¼‰ COUNT æ¯æ¬¡è¯»å–æ•°é‡ MAXIDLE æ¸¸æ ‡æœ€å¤§ç©ºé—²æ—¶é—´ PARAMS å‚æ•°åŒ–æŸ¥è¯¢ DIALECT æŸ¥è¯¢è¯­æ³•ç‰ˆæœ¬ FT.AGGREGATE çš„æ ¸å¿ƒè¯­æ³• 12345FT.AGGREGATE &lt;index&gt; &lt;query&gt; [GROUPBY ...] [REDUCE ...] [SORTBY ...] [LIMIT ...] ç¤ºä¾‹ 1ï¼šæŒ‰ status åˆ†ç»„ç»Ÿè®¡æ•°é‡ 1234567891011121314151617181920212223242526272829303132FT.AGGREGATE idx:user &#x27;*&#x27; GROUPBY 1 @status REDUCE COUNT 0 AS cnt## å‚æ•°è¯´æ˜# *: æŸ¥è¯¢æ¡ä»¶ï¼Œ* è¡¨ç¤ºåŒ¹é…ç´¢å¼•ä¸­çš„ æ‰€æœ‰æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥æ˜¯ FT.SEARCH ä¸­çš„æŸ¥è¯¢æ¡ä»¶ï¼Œæ¯”å¦‚ï¼š&#x27;@status:&#123;PAID&#125; @amount:[50 +inf]&#x27;# GROUPBY 1 @status: åˆ†ç»„å­—æ®µ # 1:è¡¨ç¤ºåˆ†ç»„å­—æ®µæ•°é‡ # @status:è¡¨ç¤ºåˆ†ç»„å­—æ®µ# REDUCE COUNT 0 AS cnt: èšåˆå­—æ®µ # COUNT:èšåˆå‡½æ•°ï¼šè®¡æ•° # 0:å‚æ•°ä¸ªæ•°ï¼ˆCOUNT ä¸éœ€è¦å‚æ•°ï¼‰ # AS cnt:è¡¨ç¤ºèšåˆå­—æ®µåˆ«å## è¿”å›ç»“æœç¤ºä¾‹1) (integer) 32) 1) &quot;status&quot; 2) &quot;CANCELLED&quot; 3) &quot;cnt&quot; 4) &quot;2&quot;3) 1) &quot;status&quot; 2) &quot;PAID&quot; 3) &quot;cnt&quot; 4) &quot;6&quot;4) 1) &quot;status&quot; 2) &quot;CREATED&quot; 3) &quot;cnt&quot; 4) &quot;2&quot;# å¯¹åº”SQL è¯­å¥ï¼šSELECT status, COUNT(*) AS cnt FROM user GROUP BY status; 123456789101112AggregationResult result = rSearch.aggregate( &quot;idx:user&quot;, &quot;*&quot;, AggregationOptions.defaults() .groupBy(GroupBy.fieldNames(&quot;@status&quot;).reducers(Reducer.count().as(&quot;cnt&quot;))));final long total = result.getTotal();System.out.println(&quot;total = &quot; + total);final List&lt;Map&lt;String, Object&gt;&gt; attributes = result.getAttributes();for (Map&lt;String, Object&gt; attribute : attributes) &#123; System.out.println(&quot;attribute = &quot; + attribute);&#125; ç¤ºä¾‹ 2ï¼šæŒ‰ status åˆ†ç»„ç»Ÿè®¡é‡‘é¢æ€»å’Œ 12345678910111213141516171819202122232425262728293031323334353637FT.AGGREGATE idx:user &#x27;*&#x27; GROUPBY 1 @status REDUCE SUM 1 @amount AS total_amount SORTBY 2 @total_amount DESC LIMIT 0 3## å‚æ•°è¯´æ˜# SUM:èšåˆå‡½æ•°ï¼šæ±‚å’Œ# 1:å‚æ•°ä¸ªæ•°# @amount:è¦å‚ä¸æ±‚å’Œçš„å­—æ®µ# total_amount:è¡¨ç¤ºèšåˆå­—æ®µåˆ«å# SORTBY 2 @total_amount DESC: æ’åº # 2: è¡¨ç¤ºåé¢è·Ÿ 2 ä¸ªå‚æ•°ï¼ˆå­—æ®µ + æ’åºæ–¹å‘ï¼‰ # @total_amount: è¡¨ç¤ºæ’åºå­—æ®µï¼ˆREDUCE äº§ç”Ÿçš„åˆ«åï¼‰ï¼ŒDESC:è¡¨ç¤ºé™åº# LIMIT 0 3: åˆ†é¡µï¼Œ0:è¡¨ç¤ºä»ç¬¬ 0 æ¡å¼€å§‹ï¼Œ3:è¡¨ç¤ºè¿”å› 3 æ¡æ•°æ®## ç¤ºä¾‹ç»“æœ1) (integer) 32) 1) &quot;status&quot; 2) &quot;PAID&quot; 3) &quot;total_amount&quot; 4) &quot;4096.89&quot;3) 1) &quot;status&quot; 2) &quot;CREATED&quot; 3) &quot;total_amount&quot; 4) &quot;238.8&quot;4) 1) &quot;status&quot; 2) &quot;CANCELLED&quot; 3) &quot;total_amount&quot; 4) &quot;79.8&quot;# å¯¹åº”SQL è¯­å¥ï¼šSELECT status, SUM(amount) AS total_amount FROM user GROUP BY status ORDER BY total_amount DESC LIMIT 0 3; 123456789101112AggregationResult result = rSearch.aggregate( &quot;idx:user&quot;, &quot;*&quot;, AggregationOptions.defaults() .groupBy(GroupBy.fieldNames(&quot;@status&quot;) .reducers( Reducer.sum(&quot;@amount&quot;).as(&quot;total_amount&quot;) ) ) .sortBy(new SortedField(&quot;@total_amount&quot;, SortOrder.DESC)) .limit(0, 3)); ç¤ºä¾‹ 3ï¼šåŒæ—¶è¾“å‡ºæ•°é‡ + é‡‘é¢ï¼Œå¹¶æŒ‰é‡‘é¢é™åºï¼Œæ•°é‡å‡åº 1234567891011121314151617181920212223242526FT.AGGREGATE idx:user &#x27;*&#x27; GROUPBY 1 @status REDUCE COUNT 0 AS cnt REDUCE SUM 1 @amount AS total_amount SORTBY 4 @total_amount DESC @cnt ASC## ç¤ºä¾‹ç»“æœ1) (integer) 32) 1) &quot;status&quot; 2) &quot;PAID&quot; 3) &quot;cnt&quot; 4) &quot;6&quot; 5) &quot;total_amount&quot; 6) &quot;4096.89&quot;3) 1) &quot;status&quot; 2) &quot;CREATED&quot; 3) &quot;cnt&quot; 4) &quot;2&quot; 5) &quot;total_amount&quot; 6) &quot;238.8&quot;4) 1) &quot;status&quot; 2) &quot;CANCELLED&quot; 3) &quot;cnt&quot; 4) &quot;2&quot; 5) &quot;total_amount&quot; 6) &quot;79.8&quot; 12345678910111213AggregationResult result = rSearch.aggregate( &quot;idx:user&quot;, &quot;*&quot;, AggregationOptions.defaults() .groupBy(GroupBy.fieldNames(&quot;@status&quot;) .reducers( Reducer.count().as(&quot;cnt&quot;), Reducer.sum(&quot;@amount&quot;).as(&quot;total_amount&quot;) ) ) .sortBy(new SortedField(&quot;@total_amount&quot;, SortOrder.DESC)) .sortBy(new SortedField(&quot;@cnt&quot;, SortOrder.ASC))); ç¤ºä¾‹ 4ï¼šæŒ‰çŠ¶æ€åˆ†ç»„ï¼Œç­›é€‰æ€»é‡‘é¢ &gt; 200 1234567FT.AGGREGATE idx:user &#x27;*&#x27; GROUPBY 1 @status REDUCE SUM 1 @amount AS total_amount FILTER @total_amount &gt; 200 SORTBY 2 @total_amount DESC## å‚æ•°è¯´æ˜# FILTER: è¿‡æ»¤å™¨ï¼Œä½œç”¨åœ¨ GROUPBY + REDUCE ä¹‹åï¼Œè¯­ä¹‰ç­‰ä»·äº SQL çš„ï¼šHAVING SUM(amount) &gt; 1000 123456789101112AggregationResult result = rSearch.aggregate( &quot;idx:user&quot;, &quot;*&quot;, AggregationOptions.defaults() .groupBy(GroupBy.fieldNames(&quot;@status&quot;) .reducers( Reducer.sum(&quot;@amount&quot;).as(&quot;total_amount&quot;) ) ) .filter(&quot;@total_amount &gt; 200&quot;) .sortBy(new SortedField(&quot;@total_amount&quot;, SortOrder.DESC))); è¯­ä¹‰æ‰§è¡Œé¡ºåºï¼š SCAN â†’ GROUPBY â†’ REDUCE â†’ FILTER (HAVING) â†’ SORTBY â†’ LIMIT å¸¸è§å¯ç”¨ REDUCE å‡½æ•° å‡½æ•° ç”¨é€” COUNT è¡Œæ•° SUM æ±‚å’Œ AVG å¹³å‡ MIN / MAX æå€¼ TO_LIST æ”¶é›†å­—æ®µ 3ï¸âƒ£ FT.EXPLAIN/FT.EXPLAINCLI æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œ ä¸ä¼šè€ƒè™‘åˆ†ç»„èšåˆï¼Œåªçœ‹æŸ¥è¯¢æ¡ä»¶ï¼Œå®ƒçš„å®šä½æ˜¯ï¼šçœ‹â€œä¼šä¸ä¼šç”¨ç´¢å¼•ã€æ€ä¹ˆç”¨ç´¢å¼•â€ï¼Œè€Œä¸æ˜¯çœ‹â€œè·‘å¾—æ…¢ä¸æ…¢â€ã€‚ 123456789FT.EXPLAINCLI idx:user &#x27;@status:&#123;PAID&#125; @amount:[100 +inf]&#x27;## ç¤ºä¾‹ç»“æœ1) INTERSECT &#123;2) TAG:@status &#123;3) paid4) &#125;5) NUMERIC &#123;100.000000 &lt;= @amount &lt;= inf&#125;6) &#125;7) 4ï¸âƒ£ FT.PROFILE æ€§èƒ½åˆ†æï¼Œçœ‹â€œè·‘å¾—æ…¢ä¸æ…¢â€ã€‚ 123456789101112FT.PROFILE idx:user SEARCH QUERY &#x27;@status:&#123;PAID&#125; @amount:[100 +inf]&#x27;## å‚æ•°è¯´æ˜# SEARCH: æ ‡å‡†æŸ¥è¯¢ï¼ŒAGGREGATE: èšåˆæŸ¥è¯¢# QUERY: æŸ¥è¯¢æ¡ä»¶FT.PROFILE idx:user AGGREGATE QUERY &quot;@status:&#123;PAID&#125; @amount:[100 +inf]&quot; GROUPBY 1 @status REDUCE SUM 1 @amount AS total_amount å…³æ³¨æŒ‡æ ‡ ç¬¬ä¸€ä¼˜å…ˆçº§æŒ‡æ ‡ï¼ˆç›´æ¥å†³å®šæŸ¥è¯¢æ˜¯å¦æ…¢ï¼‰ æŒ‡æ ‡ æ‰€åœ¨ä½ç½® å«ä¹‰ å¥åº·é˜ˆå€¼ éœ€è¦è­¦æƒ• å¸¸è§ä¼˜åŒ–æ‰‹æ®µ Total profile time Shards â†’ Total profile time æŸ¥è¯¢åœ¨æœç´¢å¼•æ“å±‚é¢çš„æ€»è€—æ—¶ï¼ˆä¸å«ç½‘ç»œï¼‰ &lt; 1 msï¼šä¼˜ç§€1â€“10 msï¼šå¯æ¥å— &gt; 20 msï¼šéœ€è¦ä¼˜åŒ–&gt; 50 msï¼šç»“æ„æ€§é—®é¢˜ å‡å°‘ç»“æœé›†ã€æ‹†åˆ†æŸ¥è¯¢ã€ä¼˜åŒ–ç´¢å¼•å­—æ®µ Iterator Type Iterators profile â†’ Type æŸ¥è¯¢æ‰§è¡Œç­–ç•¥ INTERSECT / UNION SCAN / WILDCARD å¢åŠ å¯ç´¢å¼•å­—æ®µã€é¿å…æ¨¡ç³Šå‰ç¼€ Estimated number of matches Child iterators ç´¢å¼•å±‚ä¼°ç®—çš„å€™é€‰æ–‡æ¡£æ•° &lt; 1kï¼šç†æƒ³1kâ€“10kï¼šå¯æ¥å— &gt; 50kï¼šè¿‡æ»¤æ¡ä»¶è¿‡å®½ æ”¹ç”¨ TAG / NUMERIC / å†—ä½™å­—æ®µ Loader Time Result processors â†’ Loader ä» Redis åŠ è½½å¹¶ååºåˆ—åŒ–æ–‡æ¡£ &lt; 30% Total time &gt; 40% Total time RETURN ç²¾ç®€å­—æ®µã€NOCONTENTã€ç¼©å° JSON ç¬¬äºŒä¼˜å…ˆçº§æŒ‡æ ‡ï¼ˆåˆ¤æ–­ç´¢å¼•æˆ–æ¨¡å‹æ˜¯å¦åˆç†ï¼‰ æŒ‡æ ‡ æ‰€åœ¨ä½ç½® å«ä¹‰ å¥åº·é˜ˆå€¼ éœ€è¦è­¦æƒ• å¸¸è§ä¼˜åŒ–æ‰‹æ®µ Number of reading operations Iterators profile å®é™…æ‰«æçš„å€’æ’è¡¨æ¡ç›®æ•° â‰ˆ Estimated matches æ˜æ˜¾å¤§äºç»“æœæ•° æé«˜å­—æ®µé€‰æ‹©æ€§ã€æ‹†åˆ†æ¡ä»¶ Estimated matches vs å®é™…ç»“æœæ•° Iterator + Result ç´¢å¼•ä¼°ç®—ç²¾åº¦ ä¼°ç®—å€¼ç•¥å¤§äºå®é™… ä¼°ç®— &gt;&gt; å®é™…ï¼ˆ10x+ï¼‰ è°ƒæ•´ schemaï¼Œé¿å…ä½åŸºæ•°å­—æ®µ Parsing time Shards â†’ Parsing time æŸ¥è¯¢è¯­æ³•è§£æè€—æ—¶ &lt; 0.1 ms &gt; 1 ms å‡å°‘åŠ¨æ€æ‹¼æ¥ã€ç®€åŒ–è¯­æ³• Pipeline creation time Shards â†’ Pipeline creation æ‰§è¡Œè®¡åˆ’æ„å»ºæ—¶é—´ &lt; 0.05 ms &gt; 0.5 ms å‡å°‘å­å¥ã€é¿å…å¤æ‚åµŒå¥— ç»éªŒå‹â€œçº¢çº¿åˆ¤æ–­â€é€ŸæŸ¥è¡¨ï¼ˆéå¸¸å®ç”¨ï¼‰ ç°è±¡ å«ä¹‰ æ˜¯å¦å¿…é¡»å¤„ç† Estimated matches &gt; 100k ç´¢å¼•å­—æ®µé€‰æ‹©é”™è¯¯ å¿…é¡» Iterator Type = SCAN å…¨è¡¨æ‰«æ å¿…é¡» Loader &gt; 50% æ€»è€—æ—¶ è¿”å›æ•°æ®è¿‡é‡ å¼ºçƒˆå»ºè®® reading ops â‰« results å€’æ’æ•ˆç‡ä½ å»ºè®® Total time &gt; 20 ms åœ¨çº¿æŸ¥è¯¢é£é™© å¿…é¡» æ ¸å¿ƒæ‰§è¡Œç­–ç•¥å‹ Iteratorï¼ˆæœ€é‡è¦ï¼‰ Type è¯­ä¹‰ å…¸å‹è§¦å‘åœºæ™¯ æ€§èƒ½ç‰¹å¾ è°ƒä¼˜ç»“è®º INTERSECT å¤šæ¡ä»¶å–äº¤é›†ï¼ˆANDï¼‰ @a:&#123;x&#125; @b:[1 10] åŸºäºæœ€å°å€’æ’è¡¨ï¼Œæ•ˆç‡æœ€é«˜ ç†æƒ³çŠ¶æ€ï¼Œä¼˜å…ˆä½¿ç”¨ UNION å¤šæ¡ä»¶å–å¹¶é›†ï¼ˆORï¼‰ @a:&#123;x|y&#125; å€™é€‰é›†æ‰©å¤§ï¼Œéš OR æ•°é‡çº¿æ€§å¢é•¿ å¯æ¥å—ï¼Œé¿å…è¿‡å¤š OR SCAN å…¨é‡æ‰«æ å­—æ®µæœªç´¢å¼• / JSON Path ä¸å¯ç´¢å¼• O(N)ï¼Œæ–‡æ¡£è¶Šå¤šè¶Šæ…¢ å¿…é¡»æ¶ˆç­ WILDCARD æ— è¿‡æ»¤æ¡ä»¶ &quot;*&quot;ã€@field:* å€™é€‰é›†=å…¨éƒ¨æ–‡æ¡£ ä»…é™åˆ†æï¼Œçº¿ä¸Šæ…ç”¨ ç´¢å¼•è®¿é—®å‹ Iteratorï¼ˆINTERSECT / UNION çš„å­èŠ‚ç‚¹ï¼‰ Type å¯¹åº”å­—æ®µç±»å‹ ç¤ºä¾‹æŸ¥è¯¢ æ€§èƒ½ç‰¹å¾ å¤‡æ³¨ TAG TAG @status:&#123;PAID&#125; å“ˆå¸Œå€’æ’ï¼Œæœ€å¿« å¼ºçƒˆæ¨è NUMERIC NUMERIC @amount:[100 +inf] è·³è¡¨èŒƒå›´æ‰«æ èŒƒå›´è¶Šçª„è¶Šå¿« TEXT TEXT @name:alice åˆ†è¯åŒ¹é… åˆ†è¯æ•°å½±å“æ€§èƒ½ GEO GEO @loc:[13.4 52.5 10 km] ç©ºé—´ç´¢å¼• åŠå¾„å½±å“ç»“æœæ•° VECTOR VECTOR =&gt;[KNN 10 @v $q] å‘é‡æœç´¢ å¸¸ä¸ FILTER è”ç”¨ IDLIST å†…éƒ¨ å°ç»“æœé›† æšä¸¾ ID è‡ªåŠ¨ä¼˜åŒ– é€»è¾‘ / ç»“æ„å‹ Iterator Type å«ä¹‰ è§¦å‘ç¤ºä¾‹ æ€§èƒ½å½±å“ æ˜¯å¦å¸¸è§ NOT å–å -@status:&#123;PAID&#125; ä¾èµ–å…¨é›† è¾ƒå°‘ OPTIONAL å¯é€‰å­å¥ ( @a:&#123;x&#125; )? å¢åŠ å€™é€‰é›† å°‘è§ EMPTY æ— åŒ¹é… æ¡ä»¶ä¸å¯èƒ½æ»¡è¶³ æå¿« å¶å‘ PHRASE çŸ­è¯­åŒ¹é… &quot;hello world&quot; æ¯” TEXT æ…¢ ä½é¢‘ PREFIX å‰ç¼€åŒ¹é… abc* å¯èƒ½é€€åŒ– éœ€è°¨æ… ä¸‰ã€åˆ«åç®¡ç†ï¼ˆç”Ÿäº§å¿…å¤‡ï¼‰ å‘½ä»¤ ä½œç”¨ FT.ALIASADD æ·»åŠ åˆ«å FT.ALIASDEL åˆ é™¤åˆ«å FT.ALIASUPDATE æ›´æ–°åˆ«åæŒ‡å‘ ä¸€ä¸ªç´¢å¼•å¯ä»¥æœ‰å¤šä¸ªåˆ«åï¼Œä¸€æ—¦åˆ›å»ºåˆ«åï¼Œæ‰€æœ‰ FT.SEARCH / FT.AGGREGATE / FT.INFO ç­‰å‘½ä»¤éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ alias 12345678910# æ·»åŠ åˆ«å: FT.ALIASADD alias indexFT.ALIASADD alias:user idx:user# æ›´æ–°åˆ«åæŒ‡å‘: FT.ALIASUPDATE alias indexFT.ALIASUPDATE alias:user idx:user:v2# åˆ é™¤åˆ«å: FT.ALIASDEL aliasFT.ALIASDEL alias:user# åˆ¤æ–­ç´¢å¼•åç§°æ˜¯å¦ä¸ºåˆ«åFT.INFO alias:user 1) index_name 2) idx:user # çœŸå®ç´¢å¼•åç§° 123rSearch.addAlias(&quot;alias:user&quot;, &quot;idx:user&quot;);rSearch.updateAlias(&quot;alias:user&quot;, &quot;idx:user:v2&quot;);rSearch.delAlias(&quot;alias:user&quot;); ç´¢å¼•åˆ«åçš„æ ¸å¿ƒä»·å€¼ ç´¢å¼•æ— æŸé‡å»ºï¼ˆæœ€å…¸å‹åœºæ™¯ï¼‰ RediSearch ä¸æ”¯æŒåœ¨çº¿ä¿®æ”¹ schemaï¼Œå­—æ®µå˜æ›´é€šå¸¸éœ€è¦é‡å»ºç´¢å¼•ï¼Œç´¢å¼•é‡å»ºæ—¶ä¸šåŠ¡å°†ä¸å¯ç”¨ã€‚ æœ‰äº†åˆ«åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼Œåˆ›å»ºå¥½åå°†åˆ«åæŒ‡å‘æ–°çš„ç´¢å¼•ï¼Œæ—§ç´¢å¼•ä¸å†ä½¿ç”¨ï¼Œä¸šåŠ¡æ— å½±å“ã€‚ 12345678910111. æ—§ç´¢å¼• FT.ALIASADD user_idx user_idx_v12. æ–°å»ºç´¢å¼• FT.CREATE user_idx_v2 ...3. æ•°æ®å›å¡«å®Œæˆåï¼ŒåŸå­åˆ‡æ¢ FT.ALIASUPDATE user_idx user_idx_v24. åˆ é™¤æ—§ç´¢å¼•ï¼ˆå¯é€‰ï¼‰ FT.DROPINDEX user_idx_v1 ç°åº¦ / å¤šç‰ˆæœ¬å¹¶å­˜ ä¸åŒç¯å¢ƒï¼ˆdev / staging / prodï¼‰ ä¸åŒ schema ç‰ˆæœ¬ è¿ç»´ä¸å‘å¸ƒè§„èŒƒåŒ–ï¼ˆå¼ºçƒˆæ¨èï¼‰ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼šæ°¸è¿œä¸è¦è®©ä¸šåŠ¡ä»£ç ç›´æ¥ä½¿ç”¨ç‰©ç†ç´¢å¼•å 12ç´¢å¼•çœŸå®å: ä¸šåŠ¡å_ç‰ˆæœ¬_æ—¶é—´æˆ³ç´¢å¼•åˆ«å : ä¸šåŠ¡å å››ã€æ¸¸æ ‡ï¼ˆå¤§ç»“æœé›†ï¼‰ å‘½ä»¤ ä½œç”¨ FT.CURSOR READ åˆ†æ‰¹è¯»å– FT.CURSOR DEL åˆ é™¤æ¸¸æ ‡ æ¸¸æ ‡ç”¨äºèšåˆæŸ¥è¯¢ï¼ˆAGGREGATEï¼‰çš„å¤§ç»“æœé›†åˆ†é¡µ/åˆ†æ‰¹æ‹‰å–ï¼Œå…¸å‹åœºæ™¯åŒ…æ‹¬ï¼š 1234GROUPBY / REDUCE åç»“æœé›†å¾ˆå¤§éœ€è¦æµå¼å¤„ç†èšåˆç»“æœï¼Œé¿å…ä¸€æ¬¡æ€§è¿”å›å ç”¨å¤§é‡å†…å­˜å®¢æˆ·ç«¯æŒ‰æ‰¹æ¶ˆè´¹ç»“æœï¼ˆç±»ä¼¼æ•°æ®åº“çš„ server-side cursorï¼‰æ³¨æ„ï¼šæ¸¸æ ‡ä¸»è¦ç”¨äº FT.AGGREGATEï¼Œæ™®é€š FT.SEARCH ä¸æ”¯æŒæ¸¸æ ‡åˆ†é¡µã€‚ é€šè¿‡ FT.AGGREGATE ... WITHCURSOR åˆ›å»ºæ¸¸æ ‡ï¼Œé€šè¿‡ FT.CURSOR READ è·å–ç»“æœã€‚ 1234567891011121314151617181920212223242526272829303132333435FT.AGGREGATE idx:user &quot;*&quot; GROUPBY 1 @status REDUCE SUM 1 @amount AS total_amount WITHCURSOR COUNT 2 MAXIDLE 60000## å‚æ•°è¯´æ˜# WITHCURSOR : å¯ç”¨æ¸¸æ ‡# COUNT 2 : æ¯æ¬¡ä»æ¸¸æ ‡ä¸­è¿”å›çš„è¡Œæ•°ï¼ˆæ‰¹å¤§å°ï¼‰# MAXIDLE 60000 : æ¸¸æ ‡æœ€å¤§ç©ºé—²æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶åè‡ªåŠ¨é”€æ¯## è¿”å›ç»“æœ1) 1) (integer) 3 # GROUP BY åï¼Œä¸€å…±ä¼šäº§ç”Ÿ 3 è¡Œèšåˆç»“æœï¼Œè¿™é‡Œè¿”å›çš„æ˜¯å®é™…æŸ¥è¯¢çš„æ€»è¡Œæ•°ï¼Œä¸å—COUNT å‚æ•°é™åˆ¶ 2) 1) &quot;status&quot; 2) &quot;CANCELLED&quot; 3) &quot;total_amount&quot; 4) &quot;79.8&quot; 3) 1) &quot;status&quot; 2) &quot;PAID&quot; 3) &quot;total_amount&quot; 4) &quot;4096.89&quot;2) (integer) 116452546 # æ¸¸æ ‡ID# è¯»å–æ¸¸æ ‡FT.CURSOR READ idx:user 116452546 COUNT 2# å‚æ•°è¯´æ˜# 116452546 : æ¸¸æ ‡ID# COUNT 2 : æ¯æ¬¡ä»æ¸¸æ ‡ä¸­è¿”å›çš„è¡Œæ•°(å¯è¦†ç›–åˆå§‹æ¸¸æ ‡ä¸­çš„ COUNTï¼‰## è¿”å›ç»“æœ1) 1) (integer) 0 # å½“å‰æ¸¸æ ‡ä¸­â€œå‰©ä½™å¯è¯»çš„è¡Œæ•°â€ä¸º 0 2) 1) &quot;status&quot; 2) &quot;CREATED&quot; 3) &quot;total_amount&quot; 4) &quot;238.8&quot;2) (integer) 0 # 0 è¡¨ç¤ºæ²¡æœ‰æ›´å¤šç»“æœ# é”€æ¯æ¸¸æ ‡ï¼Œå¦‚æœè®¾ç½®äº† MAXIDLE å‚æ•°ï¼Œåˆ™è¯¥æ¸¸æ ‡åœ¨ MAXIDLE æ—¶é—´å†…è‡ªåŠ¨é”€æ¯ï¼Œæ‰€ä»¥æ— éœ€æ‰‹å·¥é”€æ¯FT.CURSOR DEL idx:user 116452546 1234567891011121314151617181920212223242526272829303132333435363738394041424344AggregationResult result = rSearch.aggregate( &quot;idx:user&quot;, &quot;*&quot;, AggregationOptions.defaults() .groupBy(GroupBy.fieldNames(&quot;@status&quot;) .reducers( Reducer.sum(&quot;@amount&quot;).as(&quot;total_amount&quot;) ) ) .withCursor(2, 60000));long total;long cursorId;List&lt;Map&lt;String, Object&gt;&gt; attributes;total = result.getTotal();cursorId = result.getCursorId();System.out.println(&quot;total = &quot; + total);System.out.println(&quot;cursorId = &quot; + cursorId);attributes = result.getAttributes();for (Map&lt;String, Object&gt; attribute : attributes) &#123; System.out.println(&quot;attribute = &quot; + attribute);&#125;while (cursorId != 0) &#123; System.out.println(&quot;===============================================&quot;); // æ¸¸æ ‡è¯»å–ï¼ŒRedissonçš„readCursoræ–¹æ³•æœ‰bugï¼Œæ— æ³•ç»§ç»­è¯»å–æ¸¸æ ‡æ•°æ® // result = rSearch.readCursor(&quot;idx:user&quot;, cursorId, 2); // è¿™é‡Œæ¸¸æ ‡è¯»å–å¯ä»¥è‡ªå·±ç¼–å†™ä¸€ä¸ªåŸºäºLua çš„å®ç° result = readCursor(&quot;idx:user&quot;, cursorId, 2); total = result.getTotal(); cursorId = result.getCursorId(); System.out.println(&quot;total = &quot; + total); System.out.println(&quot;cursorId = &quot; + cursorId); attributes = result.getAttributes(); for (Map&lt;String, Object&gt; attribute : attributes) &#123; System.out.println(&quot;attribute = &quot; + attribute); &#125;&#125;// cursorId=0 æˆ– åˆ°æœŸ æ—¶ä¼šè‡ªåŠ¨åˆ é™¤æ¸¸æ ‡ï¼Œæ­¤å¤„æ— éœ€åˆ é™¤// rSearch.delCursor(&quot;idx:user&quot;, cursorId); 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public AggregationResult readCursor(String indexName, long cursorId, int count) &#123; String script = &quot;return redis.call(&#x27;FT.CURSOR&#x27;, &#x27;READ&#x27;, KEYS[1], ARGV[1], &#x27;COUNT&#x27;, ARGV[2])&quot;; List&lt;Object&gt; results = stringRedisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, List.class), Collections.singletonList(indexName), String.valueOf(cursorId), String.valueOf(count) ); cursorId = (long) results.get(1); List&lt;Object&gt; lo = (List) results.get(0); return new AggregationResult( (long) lo.get(0), toListOfMap(lo), cursorId );&#125;public static List&lt;Map&lt;String, Object&gt;&gt; toListOfMap(List&lt;Object&gt; lo) &#123; List&lt;Map&lt;String, Object&gt;&gt; result = new ArrayList&lt;&gt;(); if (lo == null || lo.size() &lt;= 1) &#123; return result; &#125; // ä»ç´¢å¼• 1 å¼€å§‹ï¼Œè·³è¿‡èšåˆæ€»æ•° for (int i = 1; i &lt; lo.size(); i++) &#123; Object rowObj = lo.get(i); if (!(rowObj instanceof List&lt;?&gt; row)) &#123; continue; &#125; Map&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;(); for (int j = 0; j &lt; row.size() - 1; j += 2) &#123; String key = String.valueOf(row.get(j)); Object value = row.get(j + 1); map.put(key, value); &#125; result.add(map); &#125; return result;&#125; å®Œæ•´ç”Ÿå‘½å‘¨æœŸæ€»ç»“ 1234567FT.AGGREGATE ... WITHCURSOR # åˆ›å»ºæ¸¸æ ‡ï¼ˆå¹¶è¿”å›ç¬¬ä¸€æ‰¹ + cursorIdï¼‰ â†“FT.CURSOR READ # è¯»å–ç¬¬ N æ‰¹ â†“FT.CURSOR READ # ç»§ç»­è¯»å– â†“FT.CURSOR DELï¼ˆå¯é€‰ï¼‰ # æå‰é‡Šæ”¾èµ„æº æ¸¸æ ‡ä¸ OFFSET/LIMIT çš„åŒºåˆ« å¯¹æ¯”é¡¹ æ¸¸æ ‡ OFFSET / LIMIT æ€§èƒ½ é«˜ï¼ˆæµå¼ï¼‰ å¤§ OFFSET æ€§èƒ½å·® é€‚åˆå¤§ç»“æœé›† æ˜¯ å¦ æœåŠ¡å™¨çŠ¶æ€ æœ‰ æ—  é€‚ç”¨å‘½ä»¤ FT.AGGREGATE FT.SEARCH äº”ã€è¯å…¸ &amp; åŒä¹‰è¯ï¼ˆæœç´¢å¢å¼ºï¼‰ è¯å…¸ï¼ˆDICTï¼‰å’ŒåŒä¹‰è¯ï¼ˆSYNONYMï¼‰åªå¯¹ TEXT / TAG æœç´¢ç”Ÿæ•ˆ ä¸ FT.AGGREGATE æ— å…³ï¼Œä½†ä¸ FT.SEARCH å¼ºç›¸å…³ã€‚ å‘½ä»¤ ä½œç”¨ FT.DICTADD æ·»åŠ è¯ FT.DICTDEL åˆ é™¤è¯ FT.DICTDUMP æŸ¥çœ‹è¯å…¸ FT.SYNUPDATE æ›´æ–°åŒä¹‰è¯ FT.SYNDUMP æŸ¥çœ‹åŒä¹‰è¯ è¯å…¸ è¯å…¸ä½œç”¨ï¼šæ§åˆ¶â€œåˆæ³•æœç´¢è¯â€ï¼Œæ¯”å¦‚å°†è¯å…¸çš„å†…å®¹å‘é€ç»™ç”¨æˆ·ï¼Œè®©ç”¨æˆ·åªèƒ½æœç´¢è¿™äº›è¯ã€‚ âš ï¸ è¯å…¸æœ¬èº«ä¸å‚ä¸æœç´¢åŒ¹é… âš ï¸ åªæ˜¯ä¸ºæœç´¢å¢å¼ºæä¾›æ•°æ®æ¥æº 123456# ç¤ºä¾‹ï¼šæ·»åŠ å•†å“ç›¸å…³è¯FT.DICTADD product_dict iphone mobile phone android huawei# æŸ¥çœ‹è¯å…¸å†…å®¹ï¼ˆFT.DICTDUMPï¼‰FT.DICTDUMP product_dict# åˆ é™¤è¯å…¸ä¸­çš„è¯ï¼ˆFT.DICTDELï¼‰FT.DICTDEL product_dict iphone 123rSearch.addDict(&quot;product_dict&quot;, &quot;iphone&quot;, &quot;mobile&quot;,&quot;phone&quot;,&quot;android&quot;,&quot;huawei&quot;);List&lt;String&gt; productDict = rSearch.dumpDict(&quot;product_dict&quot;);rSearch.delDict(&quot;product_dict&quot;, &quot;iphone&quot;); åŒä¹‰è¯ åŒä¹‰è¯çš„ä½œç”¨: è®©ä¸åŒçš„æœç´¢è¯ å‘½ä¸­åŒä¸€æ‰¹æ–‡æ¡£ 123456ä¾‹å¦‚ï¼š æœ iphone æœ mobile æœ phone ğŸ‘‰ å‘½ä¸­åŒä¸€æ‰¹è®¢å• æ·»åŠ  / æ›´æ–°åŒä¹‰è¯ï¼ˆFT.SYNUPDATEï¼‰ 1234567891011121314151617# å®šä¹‰â€œæ‰‹æœºâ€çš„åŒä¹‰è¯é›†åˆï¼Œæ³¨æ„åŒä¹‰è¯æ˜¯ç»‘å®šåˆ° ç´¢å¼• çš„FT.SYNUPDATE idx:user phone_group iphone mobile phone## å‚æ•°è¯´æ˜# phone_group: åŒä¹‰è¯é›†åˆåç§°ï¼ˆä½ è‡ªå·±å®šä¹‰ï¼‰# iphone mobile phone: æ·»åŠ åŒä¹‰è¯ï¼Œå¤šä¸ªè¯ç”¨ç©ºæ ¼éš”å¼€# æŸ¥çœ‹åŒä¹‰è¯é›†åˆFT.SYNDUMP idx:user## è¾“å‡º1) &quot;phone&quot;2) 1) &quot;phone_group&quot;3) &quot;iphone&quot;4) 1) &quot;phone_group&quot;5) &quot;mobile&quot;6) 1) &quot;phone_group&quot; 12rSearch.updateSynonyms(&quot;idx:user&quot;, &quot;phone_group&quot;, &quot;iphone&quot;, &quot;mobile&quot;, &quot;phone&quot;);Map&lt;String, List&lt;String&gt;&gt; synonyms = rSearch.dumpSynonyms(&quot;idx:user&quot;); æ­¤æ—¶æˆ‘ä»¬å†è¿›è¡Œæœç´¢ï¼Œå°±ä¼šå‘½ä¸­æ‰€æœ‰åŒä¹‰è¯ 123456789101112131415FT.SEARCH idx:user &#x27;phone&#x27;# æœç´¢ç»“æœ1) (integer) 42) &quot;user:10001&quot;3) 1) &quot;$&quot; 2) &quot;&#123;\\&quot;name\\&quot;:\\&quot;Alice Bob\\&quot;,\\&quot;age\\&quot;:28,\\&quot;vip\\&quot;:\\&quot;yes\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;,&#123;\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a phone\\&quot;,\\&quot;items\\&quot;:[\\&quot;SpringCloud\\xe6\\x8a\\x80\\xe6\\x9c\\xaf\\xe6\\x8c\\x87\\xe5\\x8d\\x97\\&quot;,\\&quot;Shell\\xe8\\x84\\x9a\\xe6\\x9c\\xac\\xe5\\x9f\\xba\\xe7\\xa1\\x80\\&quot;]&#125;&quot;4) &quot;user:10006&quot;5) 1) &quot;$&quot; 2) &quot;&#123;\\&quot;name\\&quot;:\\&quot;Frank\\&quot;,\\&quot;age\\&quot;:27,\\&quot;vip\\&quot;:\\&quot;no\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:499,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;,&#123;\\&quot;amount\\&quot;:129,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a phone\\&quot;,\\&quot;items\\&quot;:[\\&quot;Redis\\xe5\\xbc\\x80\\xe5\\x8f\\x91\\xe5\\xae\\x9e\\xe6\\x88\\x98\\&quot;,\\&quot;MongoDB\\xe4\\xbb\\x8e\\xe5\\x85\\xa5\\xe9\\x97\\xa8\\xe5\\x88\\xb0\\xe5\\xae\\x9e\\xe6\\x88\\x98\\&quot;]&#125;&quot;6) &quot;user:10002&quot;7) 1) &quot;$&quot; 2) &quot;&#123;\\&quot;name\\&quot;:\\&quot;Bob Frank\\&quot;,\\&quot;age\\&quot;:35,\\&quot;vip\\&quot;:\\&quot;no\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:899.0,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a iphone\\&quot;,\\&quot;items\\&quot;:[\\&quot;Linux\\xe5\\xbf\\x85\\xe7\\x9f\\xa5\\xe5\\xbf\\x85\\xe4\\xbc\\x9a\\&quot;,\\&quot;Java\\xe5\\xa4\\x9a\\xe7\\xba\\xbf\\xe7\\xa8\\x8b\\xe8\\xaf\\xa6\\xe8\\xa7\\xa3\\&quot;]&#125;&quot;8) &quot;user:10003&quot;9) 1) &quot;$&quot; 2) &quot;&#123;\\&quot;name\\&quot;:\\&quot;Carol\\&quot;,\\&quot;age\\&quot;:22,\\&quot;vip\\&quot;:\\&quot;no\\&quot;,\\&quot;orders\\&quot;:[&#123;\\&quot;amount\\&quot;:19.9,\\&quot;status\\&quot;:\\&quot;CANCELLED\\&quot;&#125;],\\&quot;comment\\&quot;:\\&quot;I have a mobile\\&quot;,\\&quot;items\\&quot;:[\\&quot;MySQL\\xe4\\xbb\\x8e\\xe5\\x88\\xa0\\xe5\\xba\\x93\\xe5\\x88\\xb0\\xe8\\xb7\\x91\\xe8\\xb7\\xaf\\&quot;,\\&quot;Oracle\\xe5\\xbc\\x80\\xe5\\x8f\\x91\\xe5\\xae\\x9e\\xe8\\xb7\\xb5\\&quot;]&#125;&quot; è¯å…¸ + åŒä¹‰è¯çš„ç»„åˆä½¿ç”¨ 123451. ç”¨æˆ·è¾“å…¥: æ‰‹æœº2. å‰ç«¯ / æœåŠ¡ç«¯ â†’ ä» product_dict ç»™æç¤º3. æœç´¢è¯·æ±‚ â†’ FT.SEARCH4. RediSearch â†’ åŒä¹‰è¯æ‰©å±•5. è¿”å›ç»Ÿä¸€ç»“æœ å…­ã€FT.SPELLCHECKï¼ˆæ‹¼å†™çº é”™ï¼‰ FT.SPELLCHECK ç”¨äºå¯¹ç”¨æˆ·è¾“å…¥çš„æœç´¢è¯è¿›è¡Œæ‹¼å†™çº é”™ä¸ç›¸ä¼¼è¯æ¨è å®ƒå¹¶ä¸ä¼šçœŸæ­£æ‰§è¡Œæœç´¢ï¼Œè€Œæ˜¯ï¼š âœ… åˆ†æè¾“å…¥è¯æ˜¯å¦å­˜åœ¨äºç´¢å¼•è¯å…¸ âœ… å¦‚æœä¸å­˜åœ¨ï¼ŒåŸºäºç¼–è¾‘è·ç¦»ï¼ˆLevenshteinï¼‰ç»™å‡ºå€™é€‰çº é”™è¯ âœ… æ”¯æŒè‡ªå®šä¹‰è¯å…¸ï¼ˆDictionaryï¼‰å¢å¼ºæ•ˆæœ ğŸ¯ æ ¸å¿ƒç›®æ ‡ èƒ½åŠ› è¯´æ˜ æ‹¼å†™çº é”™ iphone â†’ ipohne æ¨¡ç³Šæ¨è ç”¨æˆ·æ‹¼é”™å…³é”®è¯ æœç´¢å‰ç½®çº é”™ æå‡å¬å›ç‡ è‡ªåŠ¨å­¦ä¹ ç´¢å¼•è¯ è‡ªåŠ¨ä»ç´¢å¼•è¯åº“æ„å»ºè¯å…¸ åŸºæœ¬è¯­æ³• 123FT.SPELLCHECK index query [DISTANCE maxDistance] [TERMS &#123;INCLUDE | EXCLUDE&#125; dictionary ...] å‚æ•°è¯´æ˜è¡¨ å‚æ•° è¯´æ˜ é»˜è®¤å€¼ index ç´¢å¼•åç§° å¿…å¡« query ç”¨æˆ·è¾“å…¥è¯ å¿…å¡« DISTANCE æœ€å¤§ç¼–è¾‘è·ç¦»ï¼ˆ1~4ï¼‰ 1 TERMS INCLUDE ä»…ä½¿ç”¨æŒ‡å®šè¯å…¸ å…¨éƒ¨ TERMS EXCLUDE æ’é™¤æŒ‡å®šè¯å…¸ æ—  ç¤ºä¾‹ 12345678910111213141516171819202122232425262728FT.SPELLCHECK idx:user &#x27;iphnoe&#x27; DISTANCE 2# è¾“å‡º1) 1) TERM # å›ºå®šæ ‡è¯†ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¢«åˆ†æçš„è¯ 2) &quot;iphnoe&quot; # ç”¨æˆ·è¾“å…¥è¯ 3) 1) 1) &quot;0.4&quot; # ç›¸ä¼¼åº¦è¯„åˆ†ï¼Œè¶Šå°è¶Šç›¸ä¼¼ 2) &quot;iphone&quot; # æ¨èè¯ï¼Œå»ºè®®æ›¿æ¢è¯# æœç´¢å¤šä¸ªè¯FT.SPELLCHECK idx:user &#x27;iphnoe linu&#x27; DISTANCE 21) 1) TERM 2) &quot;iphnoe&quot; 3) 1) 1) &quot;0.4&quot; 2) &quot;iphone&quot;2) 1) TERM 2) &quot;linu&quot; 3) 1) 1) &quot;0.4&quot; 2) &quot;linux&quot;# å¢åŠ ç¼–è¾‘è·ç¦»ä¼šæ˜¾ç¤ºæ›´å¤šçš„å€™é€‰è¯FT.SPELLCHECK idx:user &#x27;phnoe&#x27; DISTANCE 31) 1) TERM 2) &quot;phnoe&quot; 3) 1) 1) &quot;4&quot; 2) &quot;have&quot; 2) 1) &quot;0.8&quot; 2) &quot;phone&quot; 3) 1) &quot;0.4&quot; 2) &quot;iphone&quot; 1234Map&lt;String, Map&lt;String, Double&gt;&gt; spellcheck = rSearch.spellcheck( &quot;idx:user&quot;, &quot;iphnoe linu&quot;, SpellcheckOptions.defaults().distance(2)); score = ç¼–è¾‘è·ç¦» / max(len(ç”¨æˆ·è¾“å…¥è¯), len(å€™é€‰è¯))ï¼Œä½†å¹¶ä¸æ˜¯æ€»æ˜¯è¿™æ · è¾“å…¥ å€™é€‰ ç¼–è¾‘è·ç¦» maxLen score phnoe iphone 2 6 2/6 = 0.333 â‰ˆ 0.4 phnoe phone 1 5 0.2 â†’ ~0.8ï¼ˆå†…éƒ¨æƒé‡å¯èƒ½åè½¬æˆ–è°ƒæ•´ï¼‰ phnoe have â€œ4â€ â†’ è¡¨ç¤º phnoe ä¸ have çš„ç¼–è¾‘è·ç¦»æ˜¯ 4 1234567891011phnoe â†’ havep â†’ h (1)h â†’ a (2)n â†’ v (3)o â†’ e (4)e â†’ (åˆ é™¤) (5) ï¼ˆä¸åŒç®—æ³•å¯èƒ½è®¡ä¸º 4 æˆ– 5ï¼‰è¯¥è¯æ˜æ˜¾æ˜¯ä½è´¨é‡å€™é€‰ï¼Œåªæ˜¯ DISTANCE=3/4 æ—¶è¢«å‹‰å¼ºæ”¶å½•ã€‚ä¸šåŠ¡ä¾§åšåˆç†è¿‡æ»¤å¦‚æœ score &gt;= 2 â†’ ç›´æ¥ä¸¢å¼ƒï¼ˆæ˜æ˜¾å™ªå£°ï¼‰å¦‚æœ score &lt;= 1.0 â†’ å¯ä¿¡å€™é€‰ å»ºè®®ç­–ç•¥ åœºæ™¯ å»ºè®® æœç´¢æ¡†å®æ—¶æç¤º 1 æœç´¢æäº¤åçº é”™ 2 æ¨¡ç³Šå®¹é”™ç³»ç»Ÿ 2~3 è¯å…¸å¢å¼ºï¼ˆDictionary Integrationï¼‰ é€šè¿‡ FT.DICTADD / FT.DICTDEL äººå·¥ç»´æŠ¤ä¸€ä¸ªæˆ–å¤šä¸ªè¯å…¸ï¼ŒæŠŠâ€œä¸šåŠ¡è¯æ±‡â€ä¸»åŠ¨æ³¨å…¥åˆ° SpellCheck çš„å€™é€‰è¯ç©ºé—´ä¸­ã€‚ 12345678910111213141516171819202122232425é»˜è®¤æƒ…å†µä¸‹ï¼šSpellCheck åªèƒ½ä» ç´¢å¼•å€’æ’è¯å…¸ï¼ˆInverted Index Termsï¼‰ ä¸­ç”Ÿæˆå€™é€‰è¯ã€‚å¦‚æœæŸäº›è¯ï¼š ä¸åœ¨ç´¢å¼•é‡Œ å‡ºç°é¢‘ç‡æä½ å±äºä¸“æœ‰åè¯ æ–°è¯ã€å“ç‰Œè¯é‚£ä¹ˆ SpellCheck å¾ˆå¯èƒ½æ— æ³•æ­£ç¡®çº é”™ã€‚è¯å…¸å¢å¼ºè§£å†³çš„æ­£æ˜¯è¿™ä¸ªé—®é¢˜ã€‚ç”¨æˆ·è¾“å…¥ â†’ Tokenizer â†’ æ‹†è¯ â†’ â†“å€™é€‰æºåˆå¹¶ï¼š - å€’æ’ç´¢å¼•è¯å…¸ - è‡ªå®šä¹‰è¯å…¸ï¼ˆFT.DICTADDï¼‰ â†“ç¼–è¾‘è·ç¦»è®¡ç®— â†“å€™é€‰æ’åº â†“è¿”å›çº é”™è¯âœ… SpellCheck çš„å€™é€‰ç©ºé—´è¢«äººä¸ºæ‰©å¤§ã€‚ 123456789FT.DICTADD dict:tech iphone ipad macbook airpods# ä½¿ç”¨æŒ‡å®šè¯å…¸çº é”™ï¼Œç™½åå•FT.SPELLCHECK idx:user &quot;macboo&quot; TERMS INCLUDE dict:tech1) 1) TERM 2) &quot;macboo&quot; 3) 1) 1) &quot;0.4&quot; 2) &quot;macbook&quot;# æ’é™¤è¯å…¸ï¼Œé»‘åå•FT.SPELLCHECK idx:user &quot;iphnoe&quot; TERMS EXCLUDE dict:noise 1234567Map&lt;String, Map&lt;String, Double&gt;&gt; spellcheck = rSearch.spellcheck( &quot;idx:user&quot;, &quot;macboo&quot;, SpellcheckOptions.defaults() .distance(2) .includedTerms(&quot;dict:tech&quot;)); FT.SPELLCHECK ä¸ Suggest çš„å·®å¼‚å¯¹æ¯”ï¼ˆå…³é”®ï¼‰ ç»´åº¦ FT.SPELLCHECK FT.SUGGET ç›®æ ‡ æ‹¼å†™çº é”™ å‰ç¼€è”æƒ³ è¾“å…¥ å®Œæ•´è¯ å‰ç¼€ è¿”å› ç›¸ä¼¼è¯ è¡¥å…¨è¯ æ•°æ®æ¥æº ç´¢å¼•è¯å…¸ ç‹¬ç«‹ Trie æ˜¯å¦æ’åº å¦ï¼ˆè·ç¦»ä¼˜å…ˆï¼‰ æ˜¯ï¼ˆscoreï¼‰ æ˜¯å¦æ¨¡ç³Š ç¼–è¾‘è·ç¦» å‰ç¼€ + FUZZY ä½¿ç”¨é˜¶æ®µ æœç´¢å‰ä¿®æ­£ è¾“å…¥è¿‡ç¨‹ä¸­ å·²åºŸå¼ƒå‘½ä»¤ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰ å‘½ä»¤ çŠ¶æ€ è¯´æ˜ FT.CONFIG GET Reids8 å°†å…¶æ ‡è®°ä¸º Deprecated ä½¿ç”¨ CONFIG GET search-* FT.CONFIG SET Reids8 å°†å…¶æ ‡è®°ä¸º Deprecated åŒä¸Š FT.TAGVALS å·²ç»æ ‡è®°ä¸º Deprecated æ”¹ç”¨ AGGREGATE âš ï¸ è¿™é‡Œè¦æ³¨æ„ï¼Œåªæœ‰ Redis 8.0.0 ä»¥ä¸Šç‰ˆæœ¬æ”¯æŒ CONFIG GET search-*ã€‚ FT.CONFIG GET * å’Œ CONFIG GET search-* å¯¹åº”å‚æ•°æ•´ç† 1ï¸âƒ£ ç´¢å¼•åŸºæœ¬ / æ–‡æ¡£è¡¨é…ç½® FT.CONFIG å‚æ•° FT.CONFIG å€¼ CONFIG search-* å‚æ•° CONFIG å€¼ è¯´æ˜ MINPREFIX 2 search-min-prefix 2 è‡ªåŠ¨è¡¥å…¨æœ€å°å‰ç¼€é•¿åº¦ MINSTEMLEN 4 search-min-stem-len 4 æœ€å°è¯å¹²é•¿åº¦ MAXDOCTABLESIZE 1000000 search-max-doctablesize 1000000 æœ€å¤§æ–‡æ¡£è¡¨å¤§å° MAXSEARCHRESULTS 1000000 search-max-search-results 1000000 æœç´¢ç»“æœé™åˆ¶ MAXAGGREGATERESULTS unlimited search-max-aggregate-results 2147483648 èšåˆç»“æœé™åˆ¶ MAXEXPANSIONS 200 search-max-prefix-expansions 200 å‰ç¼€æ‰©å±•é™åˆ¶ MAXPREFIXEXPANSIONS 200 search-max-prefix-expansions 200 å‰ç¼€æ‰©å±•é™åˆ¶ï¼ˆå…¼å®¹ï¼‰ RAW_DOCID_ENCODING false search-raw-docid-encoding no æ–‡æ¡£IDæ˜¯å¦åŸå§‹ç¼–ç  UPGRADE_INDEX Upgrade config for upgrading N/A N/A å‡çº§ç´¢å¼•é…ç½®æç¤º 2ï¸âƒ£ æŸ¥è¯¢ / è¯„åˆ†ç›¸å…³é…ç½® FT.CONFIG å‚æ•° FT.CONFIG å€¼ CONFIG search-* å‚æ•° CONFIG å€¼ è¯´æ˜ TIMEOUT 500 search-timeout 500 æŸ¥è¯¢è¶…æ—¶ï¼ˆmsï¼‰ ON_TIMEOUT return search-on-timeout return è¶…æ—¶ç­–ç•¥ DEFAULT_SCORER TFIDF search-default-scorer BM25STD é»˜è®¤è¯„åˆ†ç®—æ³• BM25STD_TANH_FACTOR 4 search-bm25std-tanh-factor 4 BM25 è°ƒæ•´å› å­ MULTI_TEXT_SLOP 100 search-multi-text-slop 100 å¤šå­—æ®µæŸ¥è¯¢ slop DEFAULT_DIALECT 1 search-default-dialect 1 æŸ¥è¯¢æ–¹è¨€ 3ï¸âƒ£ GC / åå°ç´¢å¼•é…ç½® FT.CONFIG å‚æ•° FT.CONFIG å€¼ CONFIG search-* å‚æ•° CONFIG å€¼ è¯´æ˜ NOGC false search-no-gc no ç¦ç”¨ GC GC_POLICY fork search-fork-gc-policy (implicit) fork GC ç­–ç•¥ FORKGC_SLEEP_BEFORE_EXIT 0 search-fork-gc-sleep-before-exit 0 fork GC é€€å‡ºå‰ç¡çœ  FORK_GC_RUN_INTERVAL 30 search-fork-gc-run-interval 30 fork GC æ‰§è¡Œé—´éš”ï¼ˆç§’ï¼‰ FORK_GC_CLEAN_THRESHOLD 100 search-fork-gc-clean-threshold 100 fork GC æ¸…ç†é˜ˆå€¼ FORK_GC_RETRY_INTERVAL 5 search-fork-gc-retry-interval 5 fork GC é‡è¯•é—´éš” FORK_GC_CLEAN_NUMERIC_EMPTY_NODES true search-_numeric-compress no æ¸…ç†ç©ºæ•°å€¼èŠ‚ç‚¹ GCSCANSIZE 100 search-gc-scan-size 100 GC æ¯æ¬¡æ‰«æå¤§å° 4ï¸âƒ£ æ¸¸æ ‡ / çº¿ç¨‹ / å¹¶å‘é…ç½® FT.CONFIG å‚æ•° FT.CONFIG å€¼ CONFIG search-* å‚æ•° CONFIG å€¼ è¯´æ˜ CURSOR_MAX_IDLE 300000 search-cursor-max-idle 300000 æ¸¸æ ‡æœ€å¤§ç©ºé—²æ—¶é—´ INDEX_CURSOR_LIMIT 128 search-index-cursor-limit 128 å•ç´¢å¼•æ¸¸æ ‡é™åˆ¶ UNION_ITERATOR_HEAP 20 search-union-iterator-heap 20 UNION æŸ¥è¯¢å †å¤§å° NO_MEM_POOLS false search-no-mem-pools no ç¦ç”¨å†…å­˜æ±  _FREE_RESOURCE_ON_THREAD true search-_free-resource-on-thread yes çº¿ç¨‹é‡Šæ”¾èµ„æº search_min_operation_workers N/A search-min-operation-workers 4 æœ€å°æ“ä½œçº¿ç¨‹æ•° search-workers N/A search-workers 0 å·¥ä½œçº¿ç¨‹æ•° search-workers-priority-bias-threshold N/A search-workers-priority-bias-threshold 1 çº¿ç¨‹ä¼˜å…ˆçº§åç½® INDEXER_YIELD_EVERY_OPS 1000 search-indexer-yield-every-ops 1000 ç´¢å¼•å™¨ yield æ¯æ“ä½œæ•° 5ï¸âƒ£ å®éªŒ / å†…éƒ¨ /å…¶ä»– FT.CONFIG å‚æ•° FT.CONFIG å€¼ CONFIG search-* å‚æ•° CONFIG å€¼ è¯´æ˜ EXTLOAD nil search-ext-load â€œâ€ å¤–éƒ¨åŠ è½½æ¨¡å— FRISOINI nil search-friso-ini â€œâ€ ä¸­æ–‡åˆ†è¯åˆå§‹åŒ– ENABLE_UNSTABLE_FEATURES false search-enable-unstable-features no å¯ç”¨å®éªŒç‰¹æ€§ _PRINT_PROFILE_CLOCK true search-_print-profile-clock yes Profiling å¼€å…³ _NUMERIC_RANGES_PARENTS 0 search-_numeric-ranges-parents 0 æ•°å€¼èŒƒå›´çˆ¶èŠ‚ç‚¹æ•° VSS_MAX_RESIZE 0 search-vss-max-resize 1024 å‘é‡ç´¢å¼•æœ€å¤§é‡åˆ†é… PARTIAL_INDEXED_DOCS false search-partial-indexed-docs no éƒ¨åˆ†ç´¢å¼•æ–‡æ¡£æ ‡è®° _PRIORITIZE_INTERSECT_UNION_CHILDREN false search-_prioritize-intersect-union-children no ä¼˜å…ˆå¤„ç† INTERSECT/UNION å­èŠ‚ç‚¹ _BG_INDEX_MEM_PCT_THR 100 search-_bg-index-mem-pct-thr 100 åå°ç´¢å¼•å†…å­˜é˜ˆå€¼ _NUMERIC_COMPRESS false search-_numeric-compress no æ•°å€¼å‹ç¼© _BG_INDEX_OOM_PAUSE_TIME 0 search-_bg-index-oom-pause-time 0 åå°ç´¢å¼• OOM æš‚åœæ—¶é—´","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch çš„ä½¿ç”¨æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RediSearch çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub","date_published":"2026-01-05T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/26/redis7-module-RediSearch/","url":"https://blog.hanqunfeng.com/2025/12/26/redis7-module-RediSearch/","title":"Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch çš„å®‰è£…æ–¹æ³•</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RediSearch-ç®€ä»‹\">RediSearch ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/RediSearch/RediSearch\">RediSearch</a> æ˜¯ Redis å®˜æ–¹æ¨å‡ºçš„ <code>å…¨æ–‡æœç´¢</code>ä¸<code>äºŒçº§ç´¢å¼•</code>æ¨¡å—ï¼Œç”¨äºåœ¨ Redis ä¹‹ä¸Šæä¾›ç±»ä¼¼<code>æœç´¢å¼•æ“</code>çš„èƒ½åŠ›ï¼Œè§£å†³â€œåªèƒ½æŒ‰ key æŸ¥ã€æ— æ³•é«˜æ•ˆæŒ‰å­—æ®µæŸ¥è¯¢â€çš„é—®é¢˜ã€‚å®ƒæ˜¯ Redis Stack çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œå¸¸ç”¨äºæœç´¢ã€è¿‡æ»¤ã€æ’åºå’Œèšåˆåœºæ™¯ã€‚ä»…æ”¯æŒå¯¹ Hash å’Œ RedisJSON ç±»å‹è¿›è¡Œç´¢å¼•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯¥æ¨¡å—ä»¥ <code>Redis Module</code> æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Redis8+ï¼ŒRediSearch å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RediSearch é€šè¿‡ <code>ç´¢å¼•ç»“æ„</code> + <code>æŸ¥è¯¢è¯­è¨€</code>ï¼Œæä¾›ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å…¨æ–‡æœç´¢ï¼ˆText Searchï¼‰</li>\n<li class=\"lvl-4\">äºŒçº§ç´¢å¼•ï¼ˆæŒ‰å­—æ®µæŸ¥è¯¢ï¼‰</li>\n<li class=\"lvl-4\">å¤šæ¡ä»¶è¿‡æ»¤ / æ’åº</li>\n<li class=\"lvl-4\">èšåˆåˆ†æï¼ˆGROUP BYã€COUNTã€SUM ç­‰ï¼‰</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ€§èƒ½ä¸è®¾è®¡ç‰¹ç‚¹</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ç´¢å¼•åœ¨å†…å­˜ä¸­ï¼ŒæŸ¥è¯¢å»¶è¿Ÿä½ï¼ˆæ¯«ç§’çº§ï¼‰</li>\n<li class=\"lvl-4\">å†™å…¥æ—¶åŒæ­¥æ›´æ–°ç´¢å¼•ï¼ˆå†™å…¥æˆæœ¬ç•¥é«˜ï¼‰</li>\n<li class=\"lvl-4\">é€‚åˆ è¯»å¤šå†™å°‘ / æŸ¥è¯¢å¤æ‚ çš„ä¸šåŠ¡</li>\n<li class=\"lvl-4\">éäº‹åŠ¡å‹æœç´¢å¼•æ“ï¼ˆä¸æ›¿ä»£ ESï¼Œè€Œæ˜¯äº’è¡¥ï¼‰</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸åŸç”Ÿ Redis çš„å¯¹æ¯”</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>Redis åŸç”Ÿ</th>\n<th>RediSearch</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æŸ¥è¯¢æ–¹å¼</td>\n<td>key ç²¾ç¡®</td>\n<td>å¤šå­—æ®µæŸ¥è¯¢</td>\n</tr>\n<tr>\n<td>å…¨æ–‡æœç´¢</td>\n<td>ä¸æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n</tr>\n<tr>\n<td>èŒƒå›´æŸ¥è¯¢</td>\n<td>æœ‰é™</td>\n<td>å¼º</td>\n</tr>\n<tr>\n<td>èšåˆç»Ÿè®¡</td>\n<td>åŸºæœ¬æ²¡æœ‰</td>\n<td>ç±» SQL</td>\n</tr>\n<tr>\n<td>æ€§èƒ½</td>\n<td>æå¿«</td>\n<td>è¿‘å®æ—¶ï¼Œå†…å­˜æ¢æ€§èƒ½</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RediSearch-vs-Elasticsearch\">RediSearch vs Elasticsearch</h2>\n<table>\n<thead>\n<tr>\n<th>å¯¹æ¯”ç‚¹</th>\n<th>RediSearch</th>\n<th>Elasticsearch</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>éƒ¨ç½²å¤æ‚åº¦</td>\n<td>ä½</td>\n<td>é«˜</td>\n</tr>\n<tr>\n<td>å»¶è¿Ÿ</td>\n<td>æä½</td>\n<td>è¾ƒé«˜</td>\n</tr>\n<tr>\n<td>æ•°æ®è§„æ¨¡</td>\n<td>ä¸­å°è§„æ¨¡</td>\n<td>è¶…å¤§è§„æ¨¡</td>\n</tr>\n<tr>\n<td>å®æ—¶æ€§</td>\n<td>å¼º</td>\n<td>è¿‘å®æ—¶</td>\n</tr>\n<tr>\n<td>åœºæ™¯</td>\n<td>ä¸šåŠ¡å†…æœç´¢</td>\n<td>æœç´¢å¹³å°</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å®‰è£…-RediSearch\">å®‰è£… RediSearch</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä»<a href=\"https://cloud.redis.io\">Redis Cloud</a>çš„<code>Download Center</code>ä¸­è¿›è¡Œä¸‹è½½ï¼Œå…¶æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„<code>.so</code>æ–‡ä»¶ï¼Œå¯ä»¥ä¼˜å…ˆè¿›è¡Œå°è¯•ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/rguEIA.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æºç ç¼–è¯‘</p>\n</li>\n</ul>\n<blockquote>\n<p>å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚<br>\nå¯ä»¥åœ¨æµ·å¤–çš„<code>ç›¸åŒé…ç½®</code>çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„<code>redisearch.so</code>ä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install -y \\</span><br><span class=\"line\">  gcc \\</span><br><span class=\"line\">  gcc-c++ \\</span><br><span class=\"line\">  make \\</span><br><span class=\"line\">  cmake \\</span><br><span class=\"line\">  autoconf \\</span><br><span class=\"line\">  automake \\</span><br><span class=\"line\">  libtool \\</span><br><span class=\"line\">  pkgconfig \\</span><br><span class=\"line\">  openssl-devel \\</span><br><span class=\"line\">  libstdc++ \\</span><br><span class=\"line\">  libstdc++-devel</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RediSearch æœ€æ–°ç‰ˆæœ¬ ä¾èµ– CMake 3.25+ï¼Œdnfæºä¸­çš„ç‰ˆæœ¬è¾ƒä½ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ‰‹åŠ¨å®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CMAKE_VERSION=3.25.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/src</span><br><span class=\"line\">wget https://github.com/Kitware/CMake/releases/download/v<span class=\"variable\">$&#123;CMAKE_VERSION&#125;</span>/cmake-<span class=\"variable\">$&#123;CMAKE_VERSION&#125;</span>.tar.gz</span><br><span class=\"line\">tar -xf cmake-<span class=\"variable\">$&#123;CMAKE_VERSION&#125;</span>.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> cmake-<span class=\"variable\">$&#123;CMAKE_VERSION&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">./bootstrap --prefix=/usr/local</span><br><span class=\"line\">make -j$(<span class=\"built_in\">nproc</span>)</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> make install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯ç‰ˆæœ¬ /usr/local/bin/cmake</span></span><br><span class=\"line\">/usr/local/bin/cmake --version</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¯‘RediSearch</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /usr/local/soft/modules/</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/soft/modules</span><br><span class=\"line\"><span class=\"comment\"># clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> --recursive https://github.com/RediSearch/RediSearch.git</span><br><span class=\"line\"><span class=\"built_in\">cd</span> RediSearch</span><br><span class=\"line\"><span class=\"comment\"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class=\"line\">git checkout v2.10.25</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥</span></span><br><span class=\"line\">git submodule update --init --recursive</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º build_dir ç›®å½•ï¼Œç¼–è¯‘å¤±è´¥è¦å…ˆåˆ é™¤è¯¥ç›®å½•åœ¨é‡æ–°åˆ›å»º</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> build_dir &amp;&amp; <span class=\"built_in\">cd</span> build_dir</span><br><span class=\"line\"><span class=\"comment\"># ç”Ÿæˆ Makefile</span></span><br><span class=\"line\">/usr/local/bin/cmake .. \\</span><br><span class=\"line\">  -DCMAKE_BUILD_TYPE=Release \\</span><br><span class=\"line\">  -DCMAKE_C_COMPILER=gcc \\</span><br><span class=\"line\">  -DCMAKE_CXX_COMPILER=g++</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘ RediSearch</span></span><br><span class=\"line\">make -j$(<span class=\"built_in\">nproc</span>)</span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘è¿‡ç¨‹ä¼šæŠ¥é”™ï¼ŒåŒæ ·åœ¨ Rocky9 ä¸Šä¹Ÿä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜</span></span><br><span class=\"line\">[100%] Linking CXX shared library redisearch.so</span><br><span class=\"line\">/usr/bin/ld: cannot find -lstdc++: No such file or directory</span><br><span class=\"line\">collect2: error: ld returned 1 <span class=\"built_in\">exit</span> status</span><br><span class=\"line\">make[2]: *** [CMakeFiles/redisearch.dir/build.make:557: redisearch.so] Error 1</span><br><span class=\"line\">make[1]: *** [CMakeFiles/Makefile2:2958: CMakeFiles/redisearch.dir/all] Error 2</span><br><span class=\"line\">make: *** [Makefile:136: all] Error 2</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¯‘é”™è¯¯åŸå› åˆ†æ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RediSearch 2.10.x åœ¨é“¾æ¥ redisearch.so æ—¶ å¼ºåˆ¶ ä½¿ç”¨ -static-libstdc++ï¼Œè€Œ libstdc++.a é™æ€æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯¼è‡´ç¼–è¯‘å¤±è´¥</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å†³æ–¹æ³•æ˜¯å®‰è£…é™æ€åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install -y libstdc++-static</span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯é™æ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> /usr/lib/gcc/x86_64-amazon-linux/*/libstdc++.a</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">/usr/lib/gcc/x86_64-amazon-linux/11/libstdc++.a</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…åé‡æ–°ç¼–è¯‘RediSearch</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/soft/modules</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ build_dir ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf build_dir</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º build_dir ç›®å½•ï¼Œç¼–è¯‘å¤±è´¥è¦å…ˆåˆ é™¤è¯¥ç›®å½•å†é‡æ–°åˆ›å»º</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> build_dir &amp;&amp; <span class=\"built_in\">cd</span> build_dir</span><br><span class=\"line\"><span class=\"comment\"># ç”Ÿæˆ Makefile</span></span><br><span class=\"line\">/usr/local/bin/cmake .. \\</span><br><span class=\"line\">  -DCMAKE_BUILD_TYPE=Release \\</span><br><span class=\"line\">  -DCMAKE_C_COMPILER=gcc \\</span><br><span class=\"line\">  -DCMAKE_CXX_COMPILER=g++</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘ RediSearchï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œè¾“å‡º: build_dir/redisearch.so</span></span><br><span class=\"line\">make -j$(<span class=\"built_in\">nproc</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"Redis-å¯ç”¨æ¨¡å—\">Redis å¯ç”¨æ¨¡å—</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†ç”Ÿæˆçš„ <code>redisearch.so</code> æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> build_dir/redisearch.so /usr/local/soft/redis-7.4.7/modules/redisearch.so</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡é‡‡ç”¨ <code>loadmodule</code> åŠ è½½æ¨¡å—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°† redisearch.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class=\"line\">loadmodule /usr/local/soft/redis-7.4.7/modules/redisearch.so</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨redis</span></span><br><span class=\"line\">redis-server redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•æµ‹è¯•</span></span><br><span class=\"line\">redis-cli --user admin --pass 123456</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ¨¡å—</span></span><br><span class=\"line\">127.0.0.1:6379&gt; MODULE LIST</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;ReJSON&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 20816</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;bf&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 20817</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;search&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 21025</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/redisearch.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br></pre></td></tr></table></figure>\n<h2 id=\"Rocky9-ç¼–è¯‘å®‰è£…-RediSearch\">Rocky9 ç¼–è¯‘å®‰è£… RediSearch</h2>\n<blockquote>\n<p>ç³»ç»Ÿç‰ˆæœ¬ï¼š<code>Rocky Linux release 9.4 (Blue Onyx)</code></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install -y \\</span><br><span class=\"line\">  gcc \\</span><br><span class=\"line\">  gcc-c++ \\</span><br><span class=\"line\">  make \\</span><br><span class=\"line\">  cmake \\</span><br><span class=\"line\">  autoconf \\</span><br><span class=\"line\">  automake \\</span><br><span class=\"line\">  libtool \\</span><br><span class=\"line\">  pkgconfig \\</span><br><span class=\"line\">  openssl-devel \\</span><br><span class=\"line\">  libstdc++ \\</span><br><span class=\"line\">  libstdc++-devel</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ç”¨ CRB</p>\n</li>\n</ul>\n<blockquote>\n<p>åœ¨ Rocky Linux 9 ä¸­ï¼Œ<code>libstdc++-static</code> ä¸åœ¨é»˜è®¤ä»“åº“é‡Œï¼Œå®ƒä½äº CRBï¼ˆCodeReady Builderï¼‰ä»“åº“ï¼Œé»˜è®¤æ˜¯ å…³é—­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå¯ç”¨å®ƒ</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœä½ ç³»ç»Ÿé‡Œæ²¡æœ‰ config-managerï¼Œéœ€è¦å…ˆå…ˆè£…</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install -y dnf-plugins-core</span><br><span class=\"line\"><span class=\"comment\"># å¯ç”¨ CRB</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf config-manager --set-enabled crb</span><br><span class=\"line\"><span class=\"comment\"># åˆ·æ–°ç¼“å­˜</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf makecache</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…é™æ€åº“ï¼Œè§£å†³<code>/usr/bin/ld: cannot find -lstdc++: No such file or directory</code>çš„é—®é¢˜</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install -y libstdc++-static</span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯é™æ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> /usr/lib/gcc/x86_64-redhat-linux/*/libstdc++.a</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¯‘RediSearch</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /usr/local/soft/modules/</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/soft/modules</span><br><span class=\"line\"><span class=\"comment\"># clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> --recursive https://github.com/RediSearch/RediSearch.git</span><br><span class=\"line\"><span class=\"built_in\">cd</span> RediSearch</span><br><span class=\"line\"><span class=\"comment\"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class=\"line\">git checkout v2.10.25</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥</span></span><br><span class=\"line\">git submodule update --init --recursive</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º build_dir ç›®å½•ï¼Œç¼–è¯‘å¤±è´¥è¦å…ˆåˆ é™¤è¯¥ç›®å½•å†é‡æ–°åˆ›å»º</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> build_dir &amp;&amp; <span class=\"built_in\">cd</span> build_dir</span><br><span class=\"line\"><span class=\"comment\"># ç”Ÿæˆ Makefile</span></span><br><span class=\"line\">cmake .. \\</span><br><span class=\"line\">  -DCMAKE_BUILD_TYPE=Release \\</span><br><span class=\"line\">  -DCMAKE_C_COMPILER=gcc \\</span><br><span class=\"line\">  -DCMAKE_CXX_COMPILER=g++</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘ RediSearchï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œè¾“å‡º: build_dir/redisearch.so</span></span><br><span class=\"line\">make -j$(<span class=\"built_in\">nproc</span>)</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch çš„å®‰è£…æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RediSearch ç®€ä»‹ RediSearch æ˜¯ Redis å®˜æ–¹æ¨å‡ºçš„ å…¨æ–‡æœç´¢ä¸äºŒçº§ç´¢å¼•æ¨¡å—ï¼Œç”¨äºåœ¨ Redis ä¹‹ä¸Šæä¾›ç±»ä¼¼æœç´¢å¼•æ“çš„èƒ½åŠ›ï¼Œè§£å†³â€œåªèƒ½æŒ‰ key æŸ¥ã€æ— æ³•é«˜æ•ˆæŒ‰å­—æ®µæŸ¥è¯¢â€çš„é—®é¢˜ã€‚å®ƒæ˜¯ Redis Stack çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œå¸¸ç”¨äºæœç´¢ã€è¿‡æ»¤ã€æ’åºå’Œèšåˆåœºæ™¯ã€‚ä»…æ”¯æŒå¯¹ Hash å’Œ RedisJSON ç±»å‹è¿›è¡Œç´¢å¼•ã€‚ è¯¥æ¨¡å—ä»¥ Redis Module æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚ Redis8+ï¼ŒRediSearch å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚ RediSearch é€šè¿‡ ç´¢å¼•ç»“æ„ + æŸ¥è¯¢è¯­è¨€ï¼Œæä¾›ï¼š å…¨æ–‡æœç´¢ï¼ˆText Searchï¼‰ äºŒçº§ç´¢å¼•ï¼ˆæŒ‰å­—æ®µæŸ¥è¯¢ï¼‰ å¤šæ¡ä»¶è¿‡æ»¤ / æ’åº èšåˆåˆ†æï¼ˆGROUP BYã€COUNTã€SUM ç­‰ï¼‰ æ€§èƒ½ä¸è®¾è®¡ç‰¹ç‚¹ ç´¢å¼•åœ¨å†…å­˜ä¸­ï¼ŒæŸ¥è¯¢å»¶è¿Ÿä½ï¼ˆæ¯«ç§’çº§ï¼‰ å†™å…¥æ—¶åŒæ­¥æ›´æ–°ç´¢å¼•ï¼ˆå†™å…¥æˆæœ¬ç•¥é«˜ï¼‰ é€‚åˆ è¯»å¤šå†™å°‘ / æŸ¥è¯¢å¤æ‚ çš„ä¸šåŠ¡ éäº‹åŠ¡å‹æœç´¢å¼•æ“ï¼ˆä¸æ›¿ä»£ ESï¼Œè€Œæ˜¯äº’è¡¥ï¼‰ ä¸åŸç”Ÿ Redis çš„å¯¹æ¯” ç»´åº¦ Redis åŸç”Ÿ RediSearch æŸ¥è¯¢æ–¹å¼ key ç²¾ç¡® å¤šå­—æ®µæŸ¥è¯¢ å…¨æ–‡æœç´¢ ä¸æ”¯æŒ æ”¯æŒ èŒƒå›´æŸ¥è¯¢ æœ‰é™ å¼º èšåˆç»Ÿè®¡ åŸºæœ¬æ²¡æœ‰ ç±» SQL æ€§èƒ½ æå¿« è¿‘å®æ—¶ï¼Œå†…å­˜æ¢æ€§èƒ½ RediSearch vs Elasticsearch å¯¹æ¯”ç‚¹ RediSearch Elasticsearch éƒ¨ç½²å¤æ‚åº¦ ä½ é«˜ å»¶è¿Ÿ æä½ è¾ƒé«˜ æ•°æ®è§„æ¨¡ ä¸­å°è§„æ¨¡ è¶…å¤§è§„æ¨¡ å®æ—¶æ€§ å¼º è¿‘å®æ—¶ åœºæ™¯ ä¸šåŠ¡å†…æœç´¢ æœç´¢å¹³å° å®‰è£… RediSearch æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä»Redis Cloudçš„Download Centerä¸­è¿›è¡Œä¸‹è½½ï¼Œå…¶æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„.soæ–‡ä»¶ï¼Œå¯ä»¥ä¼˜å…ˆè¿›è¡Œå°è¯•ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚ æºç ç¼–è¯‘ å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚ å¯ä»¥åœ¨æµ·å¤–çš„ç›¸åŒé…ç½®çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„redisearch.soä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚ å®‰è£…ä¾èµ– 123456789101112sudo dnf install -y \\ gcc \\ gcc-c++ \\ make \\ cmake \\ autoconf \\ automake \\ libtool \\ pkgconfig \\ openssl-devel \\ libstdc++ \\ libstdc++-devel RediSearch æœ€æ–°ç‰ˆæœ¬ ä¾èµ– CMake 3.25+ï¼Œdnfæºä¸­çš„ç‰ˆæœ¬è¾ƒä½ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ‰‹åŠ¨å®‰è£… 12345678910111213CMAKE_VERSION=3.25.1cd /usr/local/srcwget https://github.com/Kitware/CMake/releases/download/v$&#123;CMAKE_VERSION&#125;/cmake-$&#123;CMAKE_VERSION&#125;.tar.gztar -xf cmake-$&#123;CMAKE_VERSION&#125;.tar.gzcd cmake-$&#123;CMAKE_VERSION&#125;./bootstrap --prefix=/usr/localmake -j$(nproc)sudo make install# éªŒè¯ç‰ˆæœ¬ /usr/local/bin/cmake/usr/local/bin/cmake --version ç¼–è¯‘RediSearch 12345678910111213141516171819202122232425262728mkdir -p /usr/local/soft/modules/cd /usr/local/soft/modules# clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—git clone --recursive https://github.com/RediSearch/RediSearch.gitcd RediSearch# æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬git checkout v2.10.25# æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥git submodule update --init --recursive# åˆ›å»º build_dir ç›®å½•ï¼Œç¼–è¯‘å¤±è´¥è¦å…ˆåˆ é™¤è¯¥ç›®å½•åœ¨é‡æ–°åˆ›å»ºmkdir build_dir &amp;&amp; cd build_dir# ç”Ÿæˆ Makefile/usr/local/bin/cmake .. \\ -DCMAKE_BUILD_TYPE=Release \\ -DCMAKE_C_COMPILER=gcc \\ -DCMAKE_CXX_COMPILER=g++# ç¼–è¯‘ RediSearchmake -j$(nproc)# ç¼–è¯‘è¿‡ç¨‹ä¼šæŠ¥é”™ï¼ŒåŒæ ·åœ¨ Rocky9 ä¸Šä¹Ÿä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜[100%] Linking CXX shared library redisearch.so/usr/bin/ld: cannot find -lstdc++: No such file or directorycollect2: error: ld returned 1 exit statusmake[2]: *** [CMakeFiles/redisearch.dir/build.make:557: redisearch.so] Error 1make[1]: *** [CMakeFiles/Makefile2:2958: CMakeFiles/redisearch.dir/all] Error 2make: *** [Makefile:136: all] Error 2 ç¼–è¯‘é”™è¯¯åŸå› åˆ†æ 1RediSearch 2.10.x åœ¨é“¾æ¥ redisearch.so æ—¶ å¼ºåˆ¶ ä½¿ç”¨ -static-libstdc++ï¼Œè€Œ libstdc++.a é™æ€æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯¼è‡´ç¼–è¯‘å¤±è´¥ è§£å†³æ–¹æ³•æ˜¯å®‰è£…é™æ€åº“ 12345sudo dnf install -y libstdc++-static# éªŒè¯é™æ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨ls /usr/lib/gcc/x86_64-amazon-linux/*/libstdc++.a# è¾“å‡º/usr/lib/gcc/x86_64-amazon-linux/11/libstdc++.a å®‰è£…åé‡æ–°ç¼–è¯‘RediSearch 12345678910111213cd /usr/local/soft/modules# åˆ é™¤ build_dir ç›®å½•rm -rf build_dir# åˆ›å»º build_dir ç›®å½•ï¼Œç¼–è¯‘å¤±è´¥è¦å…ˆåˆ é™¤è¯¥ç›®å½•å†é‡æ–°åˆ›å»ºmkdir build_dir &amp;&amp; cd build_dir# ç”Ÿæˆ Makefile/usr/local/bin/cmake .. \\ -DCMAKE_BUILD_TYPE=Release \\ -DCMAKE_C_COMPILER=gcc \\ -DCMAKE_CXX_COMPILER=g++# ç¼–è¯‘ RediSearchï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œè¾“å‡º: build_dir/redisearch.somake -j$(nproc) Redis å¯ç”¨æ¨¡å— å°†ç”Ÿæˆçš„ redisearch.so æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º 12# æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™cp build_dir/redisearch.so /usr/local/soft/redis-7.4.7/modules/redisearch.so æœ¬æ–‡é‡‡ç”¨ loadmodule åŠ è½½æ¨¡å— 1234567891011121314151617181920212223242526272829303132333435# å°† redisearch.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redisloadmodule /usr/local/soft/redis-7.4.7/modules/redisearch.so# å¯åŠ¨redisredis-server redis.conf# ç™»å½•æµ‹è¯•redis-cli --user admin --pass 123456# æŸ¥çœ‹æ¨¡å—127.0.0.1:6379&gt; MODULE LIST# è¾“å‡º1) 1) &quot;name&quot; 2) &quot;ReJSON&quot; 3) &quot;ver&quot; 4) (integer) 20816 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot; 7) &quot;args&quot; 8) (empty array)2) 1) &quot;name&quot; 2) &quot;bf&quot; 3) &quot;ver&quot; 4) (integer) 20817 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot; 7) &quot;args&quot; 8) (empty array)3) 1) &quot;name&quot; 2) &quot;search&quot; 3) &quot;ver&quot; 4) (integer) 21025 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/redisearch.so&quot; 7) &quot;args&quot; 8) (empty array) Rocky9 ç¼–è¯‘å®‰è£… RediSearch ç³»ç»Ÿç‰ˆæœ¬ï¼šRocky Linux release 9.4 (Blue Onyx) å®‰è£…ä¾èµ– 123456789101112sudo dnf install -y \\ gcc \\ gcc-c++ \\ make \\ cmake \\ autoconf \\ automake \\ libtool \\ pkgconfig \\ openssl-devel \\ libstdc++ \\ libstdc++-devel å¯ç”¨ CRB åœ¨ Rocky Linux 9 ä¸­ï¼Œlibstdc++-static ä¸åœ¨é»˜è®¤ä»“åº“é‡Œï¼Œå®ƒä½äº CRBï¼ˆCodeReady Builderï¼‰ä»“åº“ï¼Œé»˜è®¤æ˜¯ å…³é—­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå¯ç”¨å®ƒ 123456# å¦‚æœä½ ç³»ç»Ÿé‡Œæ²¡æœ‰ config-managerï¼Œéœ€è¦å…ˆå…ˆè£…sudo dnf install -y dnf-plugins-core# å¯ç”¨ CRBsudo dnf config-manager --set-enabled crb# åˆ·æ–°ç¼“å­˜sudo dnf makecache å®‰è£…é™æ€åº“ï¼Œè§£å†³/usr/bin/ld: cannot find -lstdc++: No such file or directoryçš„é—®é¢˜ 123sudo dnf install -y libstdc++-static# éªŒè¯é™æ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨ls /usr/lib/gcc/x86_64-redhat-linux/*/libstdc++.a ç¼–è¯‘RediSearch 1234567891011121314151617181920mkdir -p /usr/local/soft/modules/cd /usr/local/soft/modules# clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—git clone --recursive https://github.com/RediSearch/RediSearch.gitcd RediSearch# æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬git checkout v2.10.25# æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥git submodule update --init --recursive# åˆ›å»º build_dir ç›®å½•ï¼Œç¼–è¯‘å¤±è´¥è¦å…ˆåˆ é™¤è¯¥ç›®å½•å†é‡æ–°åˆ›å»ºmkdir build_dir &amp;&amp; cd build_dir# ç”Ÿæˆ Makefilecmake .. \\ -DCMAKE_BUILD_TYPE=Release \\ -DCMAKE_C_COMPILER=gcc \\ -DCMAKE_CXX_COMPILER=g++# ç¼–è¯‘ RediSearchï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œè¾“å‡º: build_dir/redisearch.somake -j$(nproc)","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RediSearch çš„å®‰è£…æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/","date_published":"2025-12-26T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/25/redis8-install-amazon-linux-2023/","url":"https://blog.hanqunfeng.com/2025/12/25/redis8-install-amazon-linux-2023/","title":"Amazon Linux 2023(å†…æ ¸ 6.1) å®‰è£… Redis8","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Linux å®‰è£… Redis8 çš„æ–¹æ³•</li>\n<li class=\"lvl-2\">Linux ç‰ˆæœ¬ï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code>ã€‚</li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\"><a href=\"https://redis.io/docs/latest/operate/oss_and_stack/install/install-stack/rpm/\">Rediså®˜ç½‘å®‰è£…æ‰‹å†Œ</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Yum-å®‰è£…\">Yum å®‰è£…</h2>\n<blockquote>\n<p>æœ€çœäº‹ï¼Œå›½å†…ç¯å¢ƒä¹Ÿå¯ä»¥é¡ºåˆ©å®Œæˆå®‰è£…ã€‚<br>\n<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code> å’Œ <code>Rocky Linux release 9.4 (Blue Onyx)</code> å‡æˆåŠŸå®‰è£…ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1.æ·»åŠ ä»“åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/yum.repos.d/redis.repo &gt; /dev/null &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">[Redis]</span></span><br><span class=\"line\"><span class=\"string\">name=Redis</span></span><br><span class=\"line\"><span class=\"string\">baseurl=http://packages.redis.io/rpm/rockylinux9</span></span><br><span class=\"line\"><span class=\"string\">enabled=1</span></span><br><span class=\"line\"><span class=\"string\">gpgcheck=1</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2.å®‰è£… Redis</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://packages.redis.io/gpg &gt; /tmp/redis.key</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rpm --import /tmp/redis.key</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> yum install redis -y</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>3.æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„redisç‰ˆæœ¬</span></span><br><span class=\"line\">$ rpm -qa | grep redis</span><br><span class=\"line\">redis-8.4.0-1.x86_64</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯</span></span><br><span class=\"line\">$ rpm -qi redis-8.4.0-1.x86_64</span><br><span class=\"line\">Name        : redis</span><br><span class=\"line\">Version     : 8.4.0</span><br><span class=\"line\">Release     : 1</span><br><span class=\"line\">Architecture: x86_64</span><br><span class=\"line\">Install Date: Wed 24 Dec 2025 06:05:22 AM UTC</span><br><span class=\"line\">Group       : Applications/Databases</span><br><span class=\"line\">Size        : 83034075</span><br><span class=\"line\">License     :</span><br><span class=\"line\">Signature   : RSA/SHA512, Mon 01 Dec 2025 12:05:10 PM UTC, Key ID 5f4349d6bf53aa0c</span><br><span class=\"line\">Source RPM  : redis-8.4.0-1.src.rpm</span><br><span class=\"line\">Build Date  : Tue 18 Nov 2025 04:41:58 PM UTC</span><br><span class=\"line\">Build Host  : 331d5099e900</span><br><span class=\"line\">Packager    : Redis Labs &lt;redis@redis.io&gt;</span><br><span class=\"line\">URL         : https://redis.io/</span><br><span class=\"line\">Summary     : Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.</span><br><span class=\"line\">Description :</span><br><span class=\"line\">Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹rediså®‰è£…çš„æ–‡ä»¶</span></span><br><span class=\"line\">$ rpm -ql redis-8.4.0-1.x86_64</span><br><span class=\"line\">/etc/redis</span><br><span class=\"line\">/etc/redis/redis.conf</span><br><span class=\"line\">/etc/redis/sentinel</span><br><span class=\"line\">/etc/redis/sentinel/sentinel.conf</span><br><span class=\"line\">/run/redis</span><br><span class=\"line\">/run/redis/redis-server.pid</span><br><span class=\"line\">/usr/bin/redis-benchmark</span><br><span class=\"line\">/usr/bin/redis-check-aof</span><br><span class=\"line\">/usr/bin/redis-check-rdb</span><br><span class=\"line\">/usr/bin/redis-cli</span><br><span class=\"line\">/usr/bin/redis-sentinel</span><br><span class=\"line\">/usr/bin/redis-server</span><br><span class=\"line\">/usr/lib/redis</span><br><span class=\"line\">/usr/lib/redis/modules</span><br><span class=\"line\">/usr/lib/redis/modules/redisbloom.so</span><br><span class=\"line\">/usr/lib/redis/modules/redisearch.so</span><br><span class=\"line\">/usr/lib/redis/modules/redistimeseries.so</span><br><span class=\"line\">/usr/lib/redis/modules/rejson.so</span><br><span class=\"line\">/usr/lib/redis/redisbloom.so</span><br><span class=\"line\">/usr/lib/redis/redisearch.so</span><br><span class=\"line\">/usr/lib/redis/redistimeseries.so</span><br><span class=\"line\">/usr/lib/redis/rejson.so</span><br><span class=\"line\">/usr/lib/systemd/system/redis-sentinel.service</span><br><span class=\"line\">/usr/lib/systemd/system/redis.service</span><br><span class=\"line\">/usr/share/selinux/packages/redis-ce.fc</span><br><span class=\"line\">/usr/share/selinux/packages/redis-ce.te</span><br><span class=\"line\">/var/lib/redis</span><br><span class=\"line\">/var/log/redis</span><br><span class=\"line\">/var/log/redis/redis-sentinel.log</span><br><span class=\"line\">/var/log/redis/redis-server.log</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>4.å¯åŠ¨redis</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl <span class=\"built_in\">enable</span> redis</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start redis</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl status redis</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>5.ç™»å½•redis</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ redis-cli</span><br><span class=\"line\">127.0.0.1:6379&gt; MODULE LIST</span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;bf&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80400</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/lib/redis/modules/redisbloom.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;timeseries&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80400</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/lib/redis/modules/redistimeseries.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;ReJSON&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80400</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/lib/redis/modules/rejson.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">4) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;vectorset&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">5) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;search&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80402</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/lib/redis/modules/redisearch.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br></pre></td></tr></table></figure>\n<h2 id=\"æºç å®‰è£…\">æºç å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1.æ›´æ–°ç¯å¢ƒ(éå¿…é¡»)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf update -y</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2.å®‰è£…ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install -y --nobest --skip-broken \\</span><br><span class=\"line\">    pkg-config \\</span><br><span class=\"line\">    xz \\</span><br><span class=\"line\">    wget \\</span><br><span class=\"line\">    <span class=\"built_in\">which</span> \\</span><br><span class=\"line\">    git \\</span><br><span class=\"line\">    make \\</span><br><span class=\"line\">    openssl \\</span><br><span class=\"line\">    openssl-devel \\</span><br><span class=\"line\">    python3 \\</span><br><span class=\"line\">    python3-pip \\</span><br><span class=\"line\">    python3-devel \\</span><br><span class=\"line\">    unzip \\</span><br><span class=\"line\">    rsync \\</span><br><span class=\"line\">    clang \\</span><br><span class=\"line\">    llvm \\</span><br><span class=\"line\">    curl \\</span><br><span class=\"line\">    libtool \\</span><br><span class=\"line\">    automake \\</span><br><span class=\"line\">    autoconf \\</span><br><span class=\"line\">    jq \\</span><br><span class=\"line\">    systemd-devel</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>3.ä¸‹è½½å¹¶æå–Redisæºä»£ç </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/src</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> wget -O redis-8.4.0.tar.gz https://github.com/redis/redis/archive/refs/tags/8.4.0.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> tar -xzf redis-8.4.0.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>4.ç¼–è¯‘Redis</p>\n</li>\n</ul>\n<blockquote>\n<p>è¿™é‡Œè¦æ³¨æ„ï¼Œä¸ä¼šè‡ªåŠ¨å®‰è£…æ¨¡å—ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯ç”¨GCCå·¥å…·é›†</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/src/redis-8.4.0</span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºTLS</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_TLS=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºRedisæ¨¡å—ï¼Œé…ä¸é…éƒ½ä¸ä¼šè‡ªåŠ¨å®‰è£…æ¨¡å—</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_WITH_MODULES=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…Rustå·¥å…·é“¾</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> INSTALL_RUST_TOOLCHAIN=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># å…³é—­è­¦å‘Š</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> DISABLE_WERRORS=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># å¼€å§‹ç¼–è¯‘</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> make -j <span class=\"string\">&quot;<span class=\"subst\">$(nproc)</span>&quot;</span> all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯</span></span><br><span class=\"line\">./src/redis-server --version</span><br><span class=\"line\">./src/redis-cli --version</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>5.å¯åŠ¨Redis</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> ./src/redis-server redis.conf</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>6.ç™»å½•Redis</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ./src/redis-cli</span><br><span class=\"line\">127.0.0.1:6379&gt; MODULE LIST</span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;vectorset&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>7.å®‰è£…æ¨¡å—ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–‡ç« ä¸­çš„ä»‹ç»</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\">\n<a href=\"/2025/12/24/redis7-module-RedisJSON/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•</a>\n</li>\n<li class=\"lvl-5\">\n<a href=\"/2025/12/21/redis7-module-RedisBloom/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a>\n</li>\n<li class=\"lvl-5\">\n<a href=\"/2025/12/26/redis7-module-RediSearch/\" title=\"Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³•</a>\n</li>\n<li class=\"lvl-5\">\n<a href=\"/2026/01/07/redis7-module-RedisTimeSeries/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•</a>\n</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Linux å®‰è£… Redis8 çš„æ–¹æ³• Linux ç‰ˆæœ¬ï¼šAmazon Linux 2023(å†…æ ¸ 6.1)ã€‚ Rediså®˜ç½‘ï¼šhttps://redis.io/ Rediså®˜ç½‘å®‰è£…æ‰‹å†Œ Yum å®‰è£… æœ€çœäº‹ï¼Œå›½å†…ç¯å¢ƒä¹Ÿå¯ä»¥é¡ºåˆ©å®Œæˆå®‰è£…ã€‚ Amazon Linux 2023(å†…æ ¸ 6.1) å’Œ Rocky Linux release 9.4 (Blue Onyx) å‡æˆåŠŸå®‰è£…ã€‚ 1.æ·»åŠ ä»“åº“ 1234567sudo tee /etc/yum.repos.d/redis.repo &gt; /dev/null &lt;&lt;EOF[Redis]name=Redisbaseurl=http://packages.redis.io/rpm/rockylinux9enabled=1gpgcheck=1EOF 2.å®‰è£… Redis 123curl -fsSL https://packages.redis.io/gpg &gt; /tmp/redis.keysudo rpm --import /tmp/redis.keysudo yum install redis -y 3.æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556# æŸ¥çœ‹å·²å®‰è£…çš„redisç‰ˆæœ¬$ rpm -qa | grep redisredis-8.4.0-1.x86_64# æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯$ rpm -qi redis-8.4.0-1.x86_64Name : redisVersion : 8.4.0Release : 1Architecture: x86_64Install Date: Wed 24 Dec 2025 06:05:22 AM UTCGroup : Applications/DatabasesSize : 83034075License :Signature : RSA/SHA512, Mon 01 Dec 2025 12:05:10 PM UTC, Key ID 5f4349d6bf53aa0cSource RPM : redis-8.4.0-1.src.rpmBuild Date : Tue 18 Nov 2025 04:41:58 PM UTCBuild Host : 331d5099e900Packager : Redis Labs &lt;redis@redis.io&gt;URL : https://redis.io/Summary : Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.Description :Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.# æŸ¥çœ‹rediså®‰è£…çš„æ–‡ä»¶$ rpm -ql redis-8.4.0-1.x86_64/etc/redis/etc/redis/redis.conf/etc/redis/sentinel/etc/redis/sentinel/sentinel.conf/run/redis/run/redis/redis-server.pid/usr/bin/redis-benchmark/usr/bin/redis-check-aof/usr/bin/redis-check-rdb/usr/bin/redis-cli/usr/bin/redis-sentinel/usr/bin/redis-server/usr/lib/redis/usr/lib/redis/modules/usr/lib/redis/modules/redisbloom.so/usr/lib/redis/modules/redisearch.so/usr/lib/redis/modules/redistimeseries.so/usr/lib/redis/modules/rejson.so/usr/lib/redis/redisbloom.so/usr/lib/redis/redisearch.so/usr/lib/redis/redistimeseries.so/usr/lib/redis/rejson.so/usr/lib/systemd/system/redis-sentinel.service/usr/lib/systemd/system/redis.service/usr/share/selinux/packages/redis-ce.fc/usr/share/selinux/packages/redis-ce.te/var/lib/redis/var/log/redis/var/log/redis/redis-sentinel.log/var/log/redis/redis-server.log 4.å¯åŠ¨redis 123sudo systemctl enable redissudo systemctl start redissudo systemctl status redis 5.ç™»å½•redis 123456789101112131415161718192021222324252627282930313233343536373839404142$ redis-cli127.0.0.1:6379&gt; MODULE LIST1) 1) &quot;name&quot; 2) &quot;bf&quot; 3) &quot;ver&quot; 4) (integer) 80400 5) &quot;path&quot; 6) &quot;/usr/lib/redis/modules/redisbloom.so&quot; 7) &quot;args&quot; 8) (empty array)2) 1) &quot;name&quot; 2) &quot;timeseries&quot; 3) &quot;ver&quot; 4) (integer) 80400 5) &quot;path&quot; 6) &quot;/usr/lib/redis/modules/redistimeseries.so&quot; 7) &quot;args&quot; 8) (empty array)3) 1) &quot;name&quot; 2) &quot;ReJSON&quot; 3) &quot;ver&quot; 4) (integer) 80400 5) &quot;path&quot; 6) &quot;/usr/lib/redis/modules/rejson.so&quot; 7) &quot;args&quot; 8) (empty array)4) 1) &quot;name&quot; 2) &quot;vectorset&quot; 3) &quot;ver&quot; 4) (integer) 1 5) &quot;path&quot; 6) &quot;&quot; 7) &quot;args&quot; 8) (empty array)5) 1) &quot;name&quot; 2) &quot;search&quot; 3) &quot;ver&quot; 4) (integer) 80402 5) &quot;path&quot; 6) &quot;/usr/lib/redis/modules/redisearch.so&quot; 7) &quot;args&quot; 8) (empty array) æºç å®‰è£… 1.æ›´æ–°ç¯å¢ƒ(éå¿…é¡») 1sudo dnf update -y 2.å®‰è£…ä¾èµ–åŒ… 12345678910111213141516171819202122sudo dnf install -y --nobest --skip-broken \\ pkg-config \\ xz \\ wget \\ which \\ git \\ make \\ openssl \\ openssl-devel \\ python3 \\ python3-pip \\ python3-devel \\ unzip \\ rsync \\ clang \\ llvm \\ curl \\ libtool \\ automake \\ autoconf \\ jq \\ systemd-devel 3.ä¸‹è½½å¹¶æå–Redisæºä»£ç  123cd /usr/srcsudo wget -O redis-8.4.0.tar.gz https://github.com/redis/redis/archive/refs/tags/8.4.0.tar.gzsudo tar -xzf redis-8.4.0.tar.gz 4.ç¼–è¯‘Redis è¿™é‡Œè¦æ³¨æ„ï¼Œä¸ä¼šè‡ªåŠ¨å®‰è£…æ¨¡å—ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ã€‚ 1234567891011121314151617# å¯ç”¨GCCå·¥å…·é›†cd /usr/src/redis-8.4.0# æ„å»ºTLSexport BUILD_TLS=yes# æ„å»ºRedisæ¨¡å—ï¼Œé…ä¸é…éƒ½ä¸ä¼šè‡ªåŠ¨å®‰è£…æ¨¡å—export BUILD_WITH_MODULES=yes# å®‰è£…Rustå·¥å…·é“¾export INSTALL_RUST_TOOLCHAIN=yes# å…³é—­è­¦å‘Šexport DISABLE_WERRORS=yes# å¼€å§‹ç¼–è¯‘sudo make -j &quot;$(nproc)&quot; all# éªŒè¯./src/redis-server --version./src/redis-cli --version 5.å¯åŠ¨Redis 1sudo ./src/redis-server redis.conf 6.ç™»å½•Redis 12345678910$ ./src/redis-cli127.0.0.1:6379&gt; MODULE LIST1) 1) &quot;name&quot; 2) &quot;vectorset&quot; 3) &quot;ver&quot; 4) (integer) 1 5) &quot;path&quot; 6) &quot;&quot; 7) &quot;args&quot; 8) (empty array) 7.å®‰è£…æ¨¡å—ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–‡ç« ä¸­çš„ä»‹ç» Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³• Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³• Redis æ‰©å±•æ¨¡å— -- RediSearch çš„å®‰è£…æ–¹æ³• Redis æ‰©å±•æ¨¡å— -- RedisTimeSeries çš„å®‰è£…æ–¹æ³•","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Linux å®‰è£… Redis8 çš„æ–¹æ³• Linux ç‰ˆæœ¬ï¼šAmazon Linux 2023(å†…æ ¸ 6.1)ã€‚ Rediså®˜ç½‘ï¼šhttps://redis.io/ Rediså®˜ç½‘å®‰è£…æ‰‹å†Œ","date_published":"2025-12-25T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/25/redis8-install-rocky9/","url":"https://blog.hanqunfeng.com/2025/12/25/redis8-install-rocky9/","title":"Rcoky9 å®‰è£… Redis8","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Linux å®‰è£… Redis8 çš„æ–¹æ³•</li>\n<li class=\"lvl-2\">Linux ç‰ˆæœ¬ï¼š<code>Rocky Linux release 9.4 (Blue Onyx)</code>ã€‚</li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\"><a href=\"https://redis.io/docs/latest/operate/oss_and_stack/install/install-stack/rpm/\">Rediså®˜ç½‘å®‰è£…æ‰‹å†Œ</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Yum-å®‰è£…\">Yum å®‰è£…</h2>\n<blockquote>\n<p>æœ€çœäº‹ï¼Œå›½å†…ç¯å¢ƒä¹Ÿå¯ä»¥é¡ºåˆ©å®Œæˆå®‰è£…ã€‚<br>\n<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code> å’Œ <code>Rocky Linux release 9.4 (Blue Onyx)</code> å‡æˆåŠŸå®‰è£…ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1.æ·»åŠ ä»“åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/yum.repos.d/redis.repo &gt; /dev/null &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">[Redis]</span></span><br><span class=\"line\"><span class=\"string\">name=Redis</span></span><br><span class=\"line\"><span class=\"string\">baseurl=http://packages.redis.io/rpm/rockylinux9</span></span><br><span class=\"line\"><span class=\"string\">enabled=1</span></span><br><span class=\"line\"><span class=\"string\">gpgcheck=1</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2.å®‰è£… Redis</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://packages.redis.io/gpg &gt; /tmp/redis.key</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rpm --import /tmp/redis.key</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> yum install redis -y</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>3.æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„redisç‰ˆæœ¬</span></span><br><span class=\"line\">$ rpm -qa | grep redis</span><br><span class=\"line\">redis-8.4.0-1.x86_64</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯</span></span><br><span class=\"line\">$ rpm -qi redis-8.4.0-1.x86_64</span><br><span class=\"line\">Name        : redis</span><br><span class=\"line\">Version     : 8.4.0</span><br><span class=\"line\">Release     : 1</span><br><span class=\"line\">Architecture: x86_64</span><br><span class=\"line\">Install Date: Wed 24 Dec 2025 06:05:22 AM UTC</span><br><span class=\"line\">Group       : Applications/Databases</span><br><span class=\"line\">Size        : 83034075</span><br><span class=\"line\">License     :</span><br><span class=\"line\">Signature   : RSA/SHA512, Mon 01 Dec 2025 12:05:10 PM UTC, Key ID 5f4349d6bf53aa0c</span><br><span class=\"line\">Source RPM  : redis-8.4.0-1.src.rpm</span><br><span class=\"line\">Build Date  : Tue 18 Nov 2025 04:41:58 PM UTC</span><br><span class=\"line\">Build Host  : 331d5099e900</span><br><span class=\"line\">Packager    : Redis Labs &lt;redis@redis.io&gt;</span><br><span class=\"line\">URL         : https://redis.io/</span><br><span class=\"line\">Summary     : Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.</span><br><span class=\"line\">Description :</span><br><span class=\"line\">Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹rediså®‰è£…çš„æ–‡ä»¶</span></span><br><span class=\"line\">$ rpm -ql redis-8.4.0-1.x86_64</span><br><span class=\"line\">/etc/redis</span><br><span class=\"line\">/etc/redis/redis.conf</span><br><span class=\"line\">/etc/redis/sentinel</span><br><span class=\"line\">/etc/redis/sentinel/sentinel.conf</span><br><span class=\"line\">/run/redis</span><br><span class=\"line\">/run/redis/redis-server.pid</span><br><span class=\"line\">/usr/bin/redis-benchmark</span><br><span class=\"line\">/usr/bin/redis-check-aof</span><br><span class=\"line\">/usr/bin/redis-check-rdb</span><br><span class=\"line\">/usr/bin/redis-cli</span><br><span class=\"line\">/usr/bin/redis-sentinel</span><br><span class=\"line\">/usr/bin/redis-server</span><br><span class=\"line\">/usr/lib/redis</span><br><span class=\"line\">/usr/lib/redis/modules</span><br><span class=\"line\">/usr/lib/redis/modules/redisbloom.so</span><br><span class=\"line\">/usr/lib/redis/modules/redisearch.so</span><br><span class=\"line\">/usr/lib/redis/modules/redistimeseries.so</span><br><span class=\"line\">/usr/lib/redis/modules/rejson.so</span><br><span class=\"line\">/usr/lib/redis/redisbloom.so</span><br><span class=\"line\">/usr/lib/redis/redisearch.so</span><br><span class=\"line\">/usr/lib/redis/redistimeseries.so</span><br><span class=\"line\">/usr/lib/redis/rejson.so</span><br><span class=\"line\">/usr/lib/systemd/system/redis-sentinel.service</span><br><span class=\"line\">/usr/lib/systemd/system/redis.service</span><br><span class=\"line\">/usr/share/selinux/packages/redis-ce.fc</span><br><span class=\"line\">/usr/share/selinux/packages/redis-ce.te</span><br><span class=\"line\">/var/lib/redis</span><br><span class=\"line\">/var/log/redis</span><br><span class=\"line\">/var/log/redis/redis-sentinel.log</span><br><span class=\"line\">/var/log/redis/redis-server.log</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>4.å¯åŠ¨redis</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl <span class=\"built_in\">enable</span> redis</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start redis</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl status redis</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>5.ç™»å½•redis</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ redis-cli</span><br><span class=\"line\">127.0.0.1:6379&gt; MODULE LIST</span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;bf&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80400</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/lib/redis/modules/redisbloom.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;timeseries&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80400</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/lib/redis/modules/redistimeseries.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;ReJSON&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80400</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/lib/redis/modules/rejson.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">4) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;vectorset&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">5) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;search&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80402</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/lib/redis/modules/redisearch.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br></pre></td></tr></table></figure>\n<h2 id=\"æºç å®‰è£…\">æºç å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1.æ·»åŠ ä»“åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/yum.repos.d/goreleaser.repo &gt; /dev/null &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">[goreleaser]</span></span><br><span class=\"line\"><span class=\"string\">name=GoReleaser</span></span><br><span class=\"line\"><span class=\"string\">baseurl=https://repo.goreleaser.com/yum/</span></span><br><span class=\"line\"><span class=\"string\">enabled=1</span></span><br><span class=\"line\"><span class=\"string\">gpgcheck=0</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf clean all</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf makecache</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf update -y</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2.å®‰è£…ä¾èµ–åŒ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install -y --nobest --skip-broken \\</span><br><span class=\"line\">    pkg-config \\</span><br><span class=\"line\">    xz \\</span><br><span class=\"line\">    wget \\</span><br><span class=\"line\">    <span class=\"built_in\">which</span> \\</span><br><span class=\"line\">    gcc-toolset-13-gcc \\</span><br><span class=\"line\">    gcc-toolset-13-gcc-c++ \\</span><br><span class=\"line\">    git \\</span><br><span class=\"line\">    make \\</span><br><span class=\"line\">    openssl \\</span><br><span class=\"line\">    openssl-devel \\</span><br><span class=\"line\">    python3 \\</span><br><span class=\"line\">    python3-pip \\</span><br><span class=\"line\">    python3-devel \\</span><br><span class=\"line\">    unzip \\</span><br><span class=\"line\">    rsync \\</span><br><span class=\"line\">    clang \\</span><br><span class=\"line\">    curl \\</span><br><span class=\"line\">    libtool \\</span><br><span class=\"line\">    automake \\</span><br><span class=\"line\">    autoconf \\</span><br><span class=\"line\">    jq \\</span><br><span class=\"line\">    systemd-devel</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>3.åˆ›å»ºä¸€ä¸ªPythonè™šæ‹Ÿç¯å¢ƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> python3 -m venv /opt/venv</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>4.å¯ç”¨GCCå·¥å…·é›†</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">cp</span> /opt/rh/gcc-toolset-13/enable /etc/profile.d/gcc-toolset-13.sh</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;source /etc/profile.d/gcc-toolset-13.sh&quot;</span> | <span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> -a /etc/bashrc</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>5.å®‰è£…CMake</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CMAKE_VERSION=3.25.1</span><br><span class=\"line\">ARCH=$(<span class=\"built_in\">uname</span> -m)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$ARCH</span>&quot;</span> = <span class=\"string\">&quot;x86_64&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  CMAKE_FILE=cmake-<span class=\"variable\">$&#123;CMAKE_VERSION&#125;</span>-linux-x86_64.sh</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  CMAKE_FILE=cmake-<span class=\"variable\">$&#123;CMAKE_VERSION&#125;</span>-linux-aarch64.sh</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> wget https://github.com/Kitware/CMake/releases/download/v<span class=\"variable\">$&#123;CMAKE_VERSION&#125;</span>/<span class=\"variable\">$&#123;CMAKE_FILE&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> +x <span class=\"variable\">$&#123;CMAKE_FILE&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> ./<span class=\"variable\">$&#123;CMAKE_FILE&#125;</span> --skip-license --prefix=/usr/local --exclude-subdir</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">rm</span> <span class=\"variable\">$&#123;CMAKE_FILE&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$PATH</span>:/usr/local/bin</span><br><span class=\"line\">cmake --version</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>6.ä¸‹è½½å¹¶æå–Redisæºä»£ç </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/src</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> wget -O redis-8.4.0.tar.gz https://github.com/redis/redis/archive/refs/tags/8.4.0.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> tar -xzf redis-8.4.0.tar.gz</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>7.ç¼–è¯‘Redis</p>\n</li>\n</ul>\n<blockquote>\n<p>å›½å†…ç¯å¢ƒå®‰è£…æ—¶å› ä¸ºéœ€è¦ä»GitHubä¸‹è½½æ¨¡å—ï¼Œé€Ÿåº¦å¾ˆæ…¢ï¼Œè€Œä¸”ç»å¸¸å¤±è´¥ï¼Œå»ºè®®å®‰è£…æ—¶å…ˆä¸è¦å®‰è£…æ¨¡å—ï¼Œå®‰è£…å¥½redisåå†æŒ‰éœ€å®‰è£…æ¨¡å—ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯ç”¨GCCå·¥å…·é›†</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile.d/gcc-toolset-13.sh</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/src/redis-8.4.0</span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºTLS</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_TLS=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºRedisæ¨¡å—ï¼Œå¦‚æœä¸å®‰è£…æ¨¡å—ï¼Œåˆ™ä¸éœ€è¦æ­¤å‚æ•°</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> BUILD_WITH_MODULES=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…Rustå·¥å…·é“¾</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> INSTALL_RUST_TOOLCHAIN=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># å…³é—­è­¦å‘Š</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> DISABLE_WERRORS=<span class=\"built_in\">yes</span></span><br><span class=\"line\"><span class=\"comment\"># å¼€å§‹ç¼–è¯‘</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> make -j <span class=\"string\">&quot;<span class=\"subst\">$(nproc)</span>&quot;</span> all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯</span></span><br><span class=\"line\">./src/redis-server --version</span><br><span class=\"line\">./src/redis-cli --version</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>8.å¯åŠ¨Redis</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> ./src/redis-server redis-full.conf</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>9.ç™»å½•Redis</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ./src/redis-cli</span><br><span class=\"line\">127.0.0.1:6379&gt; MODULE LIST</span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;search&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80402</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;./modules/redisearch/redisearch.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;vectorset&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">3) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;ReJSON&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80400</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;./modules/redisjson/rejson.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">4) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;bf&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80400</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;./modules/redisbloom/redisbloom.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">5) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;timeseries&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 80400</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;./modules/redistimeseries/redistimeseries.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>10.å®‰è£…æ¨¡å—ï¼Œå¦‚æœå®‰è£…æ—¶æ²¡æœ‰å®‰è£…æ¨¡å—ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–‡ç« ä¸­çš„ä»‹ç»</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-5\">\n<a href=\"/2025/12/24/redis7-module-RedisJSON/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•</a>\n</li>\n<li class=\"lvl-5\">\n<a href=\"/2025/12/21/redis7-module-RedisBloom/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a>\n</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Linux å®‰è£… Redis8 çš„æ–¹æ³• Linux ç‰ˆæœ¬ï¼šRocky Linux release 9.4 (Blue Onyx)ã€‚ Rediså®˜ç½‘ï¼šhttps://redis.io/ Rediså®˜ç½‘å®‰è£…æ‰‹å†Œ Yum å®‰è£… æœ€çœäº‹ï¼Œå›½å†…ç¯å¢ƒä¹Ÿå¯ä»¥é¡ºåˆ©å®Œæˆå®‰è£…ã€‚ Amazon Linux 2023(å†…æ ¸ 6.1) å’Œ Rocky Linux release 9.4 (Blue Onyx) å‡æˆåŠŸå®‰è£…ã€‚ 1.æ·»åŠ ä»“åº“ 1234567sudo tee /etc/yum.repos.d/redis.repo &gt; /dev/null &lt;&lt;EOF[Redis]name=Redisbaseurl=http://packages.redis.io/rpm/rockylinux9enabled=1gpgcheck=1EOF 2.å®‰è£… Redis 123curl -fsSL https://packages.redis.io/gpg &gt; /tmp/redis.keysudo rpm --import /tmp/redis.keysudo yum install redis -y 3.æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556# æŸ¥çœ‹å·²å®‰è£…çš„redisç‰ˆæœ¬$ rpm -qa | grep redisredis-8.4.0-1.x86_64# æŸ¥çœ‹rediså®‰è£…ä¿¡æ¯$ rpm -qi redis-8.4.0-1.x86_64Name : redisVersion : 8.4.0Release : 1Architecture: x86_64Install Date: Wed 24 Dec 2025 06:05:22 AM UTCGroup : Applications/DatabasesSize : 83034075License :Signature : RSA/SHA512, Mon 01 Dec 2025 12:05:10 PM UTC, Key ID 5f4349d6bf53aa0cSource RPM : redis-8.4.0-1.src.rpmBuild Date : Tue 18 Nov 2025 04:41:58 PM UTCBuild Host : 331d5099e900Packager : Redis Labs &lt;redis@redis.io&gt;URL : https://redis.io/Summary : Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.Description :Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps.# æŸ¥çœ‹rediså®‰è£…çš„æ–‡ä»¶$ rpm -ql redis-8.4.0-1.x86_64/etc/redis/etc/redis/redis.conf/etc/redis/sentinel/etc/redis/sentinel/sentinel.conf/run/redis/run/redis/redis-server.pid/usr/bin/redis-benchmark/usr/bin/redis-check-aof/usr/bin/redis-check-rdb/usr/bin/redis-cli/usr/bin/redis-sentinel/usr/bin/redis-server/usr/lib/redis/usr/lib/redis/modules/usr/lib/redis/modules/redisbloom.so/usr/lib/redis/modules/redisearch.so/usr/lib/redis/modules/redistimeseries.so/usr/lib/redis/modules/rejson.so/usr/lib/redis/redisbloom.so/usr/lib/redis/redisearch.so/usr/lib/redis/redistimeseries.so/usr/lib/redis/rejson.so/usr/lib/systemd/system/redis-sentinel.service/usr/lib/systemd/system/redis.service/usr/share/selinux/packages/redis-ce.fc/usr/share/selinux/packages/redis-ce.te/var/lib/redis/var/log/redis/var/log/redis/redis-sentinel.log/var/log/redis/redis-server.log 4.å¯åŠ¨redis 123sudo systemctl enable redissudo systemctl start redissudo systemctl status redis 5.ç™»å½•redis 123456789101112131415161718192021222324252627282930313233343536373839404142$ redis-cli127.0.0.1:6379&gt; MODULE LIST1) 1) &quot;name&quot; 2) &quot;bf&quot; 3) &quot;ver&quot; 4) (integer) 80400 5) &quot;path&quot; 6) &quot;/usr/lib/redis/modules/redisbloom.so&quot; 7) &quot;args&quot; 8) (empty array)2) 1) &quot;name&quot; 2) &quot;timeseries&quot; 3) &quot;ver&quot; 4) (integer) 80400 5) &quot;path&quot; 6) &quot;/usr/lib/redis/modules/redistimeseries.so&quot; 7) &quot;args&quot; 8) (empty array)3) 1) &quot;name&quot; 2) &quot;ReJSON&quot; 3) &quot;ver&quot; 4) (integer) 80400 5) &quot;path&quot; 6) &quot;/usr/lib/redis/modules/rejson.so&quot; 7) &quot;args&quot; 8) (empty array)4) 1) &quot;name&quot; 2) &quot;vectorset&quot; 3) &quot;ver&quot; 4) (integer) 1 5) &quot;path&quot; 6) &quot;&quot; 7) &quot;args&quot; 8) (empty array)5) 1) &quot;name&quot; 2) &quot;search&quot; 3) &quot;ver&quot; 4) (integer) 80402 5) &quot;path&quot; 6) &quot;/usr/lib/redis/modules/redisearch.so&quot; 7) &quot;args&quot; 8) (empty array) æºç å®‰è£… 1.æ·»åŠ ä»“åº“ 1234567891011sudo tee /etc/yum.repos.d/goreleaser.repo &gt; /dev/null &lt;&lt;EOF[goreleaser]name=GoReleaserbaseurl=https://repo.goreleaser.com/yum/enabled=1gpgcheck=0EOFsudo dnf clean allsudo dnf makecachesudo dnf update -y 2.å®‰è£…ä¾èµ–åŒ… 1234567891011121314151617181920212223sudo dnf install -y --nobest --skip-broken \\ pkg-config \\ xz \\ wget \\ which \\ gcc-toolset-13-gcc \\ gcc-toolset-13-gcc-c++ \\ git \\ make \\ openssl \\ openssl-devel \\ python3 \\ python3-pip \\ python3-devel \\ unzip \\ rsync \\ clang \\ curl \\ libtool \\ automake \\ autoconf \\ jq \\ systemd-devel 3.åˆ›å»ºä¸€ä¸ªPythonè™šæ‹Ÿç¯å¢ƒ 1sudo python3 -m venv /opt/venv 4.å¯ç”¨GCCå·¥å…·é›† 12sudo cp /opt/rh/gcc-toolset-13/enable /etc/profile.d/gcc-toolset-13.shecho &quot;source /etc/profile.d/gcc-toolset-13.sh&quot; | sudo tee -a /etc/bashrc 5.å®‰è£…CMake 12345678910111213141516CMAKE_VERSION=3.25.1ARCH=$(uname -m)if [ &quot;$ARCH&quot; = &quot;x86_64&quot; ]; then CMAKE_FILE=cmake-$&#123;CMAKE_VERSION&#125;-linux-x86_64.shelse CMAKE_FILE=cmake-$&#123;CMAKE_VERSION&#125;-linux-aarch64.shfisudo wget https://github.com/Kitware/CMake/releases/download/v$&#123;CMAKE_VERSION&#125;/$&#123;CMAKE_FILE&#125;sudo chmod +x $&#123;CMAKE_FILE&#125;sudo ./$&#123;CMAKE_FILE&#125; --skip-license --prefix=/usr/local --exclude-subdirsudo rm $&#123;CMAKE_FILE&#125;export PATH=$PATH:/usr/local/bincmake --version 6.ä¸‹è½½å¹¶æå–Redisæºä»£ç  123cd /usr/srcsudo wget -O redis-8.4.0.tar.gz https://github.com/redis/redis/archive/refs/tags/8.4.0.tar.gzsudo tar -xzf redis-8.4.0.tar.gz 7.ç¼–è¯‘Redis å›½å†…ç¯å¢ƒå®‰è£…æ—¶å› ä¸ºéœ€è¦ä»GitHubä¸‹è½½æ¨¡å—ï¼Œé€Ÿåº¦å¾ˆæ…¢ï¼Œè€Œä¸”ç»å¸¸å¤±è´¥ï¼Œå»ºè®®å®‰è£…æ—¶å…ˆä¸è¦å®‰è£…æ¨¡å—ï¼Œå®‰è£…å¥½redisåå†æŒ‰éœ€å®‰è£…æ¨¡å—ã€‚ 123456789101112131415161718# å¯ç”¨GCCå·¥å…·é›†source /etc/profile.d/gcc-toolset-13.shcd /usr/src/redis-8.4.0# æ„å»ºTLSexport BUILD_TLS=yes# æ„å»ºRedisæ¨¡å—ï¼Œå¦‚æœä¸å®‰è£…æ¨¡å—ï¼Œåˆ™ä¸éœ€è¦æ­¤å‚æ•°export BUILD_WITH_MODULES=yes# å®‰è£…Rustå·¥å…·é“¾export INSTALL_RUST_TOOLCHAIN=yes# å…³é—­è­¦å‘Šexport DISABLE_WERRORS=yes# å¼€å§‹ç¼–è¯‘sudo make -j &quot;$(nproc)&quot; all# éªŒè¯./src/redis-server --version./src/redis-cli --version 8.å¯åŠ¨Redis 1sudo ./src/redis-server redis-full.conf 9.ç™»å½•Redis 123456789101112131415161718192021222324252627282930313233343536373839404142$ ./src/redis-cli127.0.0.1:6379&gt; MODULE LIST1) 1) &quot;name&quot; 2) &quot;search&quot; 3) &quot;ver&quot; 4) (integer) 80402 5) &quot;path&quot; 6) &quot;./modules/redisearch/redisearch.so&quot; 7) &quot;args&quot; 8) (empty array)2) 1) &quot;name&quot; 2) &quot;vectorset&quot; 3) &quot;ver&quot; 4) (integer) 1 5) &quot;path&quot; 6) &quot;&quot; 7) &quot;args&quot; 8) (empty array)3) 1) &quot;name&quot; 2) &quot;ReJSON&quot; 3) &quot;ver&quot; 4) (integer) 80400 5) &quot;path&quot; 6) &quot;./modules/redisjson/rejson.so&quot; 7) &quot;args&quot; 8) (empty array)4) 1) &quot;name&quot; 2) &quot;bf&quot; 3) &quot;ver&quot; 4) (integer) 80400 5) &quot;path&quot; 6) &quot;./modules/redisbloom/redisbloom.so&quot; 7) &quot;args&quot; 8) (empty array)5) 1) &quot;name&quot; 2) &quot;timeseries&quot; 3) &quot;ver&quot; 4) (integer) 80400 5) &quot;path&quot; 6) &quot;./modules/redistimeseries/redistimeseries.so&quot; 7) &quot;args&quot; 8) (empty array) 10.å®‰è£…æ¨¡å—ï¼Œå¦‚æœå®‰è£…æ—¶æ²¡æœ‰å®‰è£…æ¨¡å—ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–‡ç« ä¸­çš„ä»‹ç» Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³• Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Linux å®‰è£… Redis8 çš„æ–¹æ³• Linux ç‰ˆæœ¬ï¼šRocky Linux release 9.4 (Blue Onyx)ã€‚ Rediså®˜ç½‘ï¼šhttps://redis.io/ Rediså®˜ç½‘å®‰è£…æ‰‹å†Œ","date_published":"2025-12-25T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/24/redis7-datatype-16-JSON/","url":"https://blog.hanqunfeng.com/2025/12/24/redis7-datatype-16-JSON/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- JSON","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisJSON ä¸­çš„ JSON æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\">RedisJSON çš„å®‰è£…å‚è§ <a href=\"/2025/12/24/redis7-module-RedisJSON/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•</a></li>\n<li class=\"lvl-2\">ç¤ºä¾‹ä»£ç ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/redisson-demo\">GitHub</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"JSON-vs-String\">JSON vs String</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redis JSONå­˜å‚¨æ•°æ®çš„æ€§èƒ½æ›´é«˜ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">Redis JSON åº•å±‚å…¶å®æ˜¯ä»¥ä¸€ç§é«˜æ•ˆçš„äºŒè¿›åˆ¶çš„æ ¼å¼å­˜å‚¨ã€‚</li>\n<li class=\"lvl-6\">ç›¸æ¯”ç®€å•çš„æ–‡æœ¬æ ¼å¼ï¼ŒäºŒè¿›åˆ¶æ ¼å¼è¿›è¡Œ JOSN æ ¼å¼è¯»å†™çš„æ€§èƒ½æ›´é«˜ï¼Œä¹Ÿæ›´èŠ‚çœå†…å­˜ã€‚</li>\n<li class=\"lvl-6\">æ ¹æ®å®˜ç½‘çš„æ€§èƒ½æµ‹è¯•æŠ¥å‘Šï¼Œä½¿ç”¨ Redis JSON è¯»å†™ JSONæ•°æ®ï¼Œæ€§èƒ½å·²ç»èƒ½å¤Ÿåª²ç¾ MongoDB ä»¥åŠ ElasticSearch ç­‰ä¼ ç»Ÿ NoSQL æ•°æ®åº“ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Redis JSON ä½¿ç”¨æ ‘çŠ¶ç»“æ„æ¥å­˜å‚¨JSONã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">è¿™ç§å­˜å‚¨æ–¹å¼å¯ä»¥å¿«é€Ÿè®¿é—®å­å…ƒç´ ã€‚</li>\n<li class=\"lvl-6\">ä¸ä¼ ç»Ÿçš„æ–‡æœ¬å­˜å‚¨æ–¹æ¡ˆç›¸æ¯”ï¼Œæ ‘çŠ¶å­˜å‚¨ç»“æ„èƒ½å¤Ÿæ›´é«˜æ•ˆçš„æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸Redisç”Ÿæ€é›†æˆåº¦é«˜ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä½œä¸ºRedisçš„æ‰©å±•æ¨¡å—ï¼ŒRedis JSON å’ŒRedisçš„å…¶ä»–åŠŸèƒ½å’Œå·¥å…·æ— ç¼é›†æˆã€‚</li>\n<li class=\"lvl-6\">è¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥ç»§ç»­ä½¿ç”¨TTLã€Redisäº‹åŠ¡ã€å‘å¸ƒ/è®¢é˜…ã€Luaè„šæœ¬ç­‰åŠŸèƒ½ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"JSONPath\">JSONPath</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>JSONPath æ˜¯ä¸€ç§ç”¨äºæŸ¥è¯¢å’Œä¿®æ”¹ JSON æ•°æ®çš„è¯­æ³•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>JSONPath è¯­æ³•</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>è¯­æ³•å…ƒç´ </th>\n<th>ä¸­æ–‡è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>$</code></td>\n<td>æ ¹èŠ‚ç‚¹ï¼ˆæœ€å¤–å±‚ JSON å…ƒç´ ï¼‰ï¼ŒJSONPath çš„èµ·ç‚¹</td>\n<td><code>$</code>ã€<code>$.user.name</code></td>\n</tr>\n<tr>\n<td><code>.</code></td>\n<td>è®¿é—®å­å­—æ®µï¼ˆå¯¹è±¡å±æ€§è®¿é—®ï¼‰</td>\n<td><code>$.user.age</code></td>\n</tr>\n<tr>\n<td><code>[]</code></td>\n<td>å­å…ƒç´ é€‰æ‹©å™¨ï¼ˆå­—æ®µåæˆ–æ•°ç»„ç´¢å¼•ï¼‰</td>\n<td><code>$['user']['name']</code></td>\n</tr>\n<tr>\n<td><code>..</code></td>\n<td>é€’å½’ä¸‹é™ï¼Œéå†æ‰€æœ‰å±‚çº§çš„èŠ‚ç‚¹</td>\n<td><code>$..id</code></td>\n</tr>\n<tr>\n<td><code>*</code></td>\n<td>é€šé…ç¬¦ï¼ŒåŒ¹é…å½“å‰å±‚çº§çš„æ‰€æœ‰å…ƒç´ </td>\n<td><code>$.users[*]</code></td>\n</tr>\n<tr>\n<td><code>[index]</code></td>\n<td>æ•°ç»„ä¸‹æ ‡è®¿é—®ï¼ˆæ”¯æŒè´Ÿç´¢å¼•ï¼‰</td>\n<td><code>$.scores[0]</code></td>\n</tr>\n<tr>\n<td><code>[a,b,c]</code></td>\n<td>è”åˆé€‰æ‹©ï¼Œè¿”å›å¤šä¸ªæŒ‡å®šå…ƒç´ </td>\n<td><code>$.scores[0,2,4]</code></td>\n</tr>\n<tr>\n<td><code>[start:end:step]</code></td>\n<td>æ•°ç»„åˆ‡ç‰‡ï¼ˆèµ·å§‹ç´¢å¼• : ç»“æŸç´¢å¼• : æ­¥é•¿ï¼‰</td>\n<td><code>$.scores[1:5:2]</code></td>\n</tr>\n<tr>\n<td><code>[*]</code></td>\n<td>é€‰æ‹©æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ </td>\n<td><code>$.items[*]</code></td>\n</tr>\n<tr>\n<td><code>[:]</code></td>\n<td>é€‰æ‹©æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆåˆ‡ç‰‡å†™æ³•ï¼‰</td>\n<td><code>$.items[:]</code></td>\n</tr>\n<tr>\n<td><code>?()</code></td>\n<td>è¿‡æ»¤è¡¨è¾¾å¼ï¼Œç”¨äºæ•°ç»„æˆ–å¯¹è±¡çš„æ¡ä»¶ç­›é€‰</td>\n<td><code>$.users[?(@.age&gt;=18)]</code></td>\n</tr>\n<tr>\n<td><code>()</code></td>\n<td>è„šæœ¬è¡¨è¾¾å¼ï¼Œç”¨äºè®¡ç®—æˆ–å¤æ‚é€»è¾‘åˆ¤æ–­</td>\n<td><code>$.items[?((@.a+@.b)&gt;10)]</code></td>\n</tr>\n<tr>\n<td><code>@</code></td>\n<td>å½“å‰å…ƒç´ å¼•ç”¨ï¼Œå¸¸ç”¨äºè¿‡æ»¤æˆ–è„šæœ¬è¡¨è¾¾å¼ä¸­</td>\n<td><code>@.price&lt;100</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•°ç»„åˆ‡ç‰‡ <code>[start:end:step]</code> è¯¦è§£</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å†™æ³•</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>[3:]</code></td>\n<td>ä»ç´¢å¼• 3 åˆ°æœ«å°¾</td>\n</tr>\n<tr>\n<td><code>[:8]</code></td>\n<td>ä»å¤´åˆ°ç´¢å¼• 7</td>\n</tr>\n<tr>\n<td><code>[:8:2]</code></td>\n<td>ä»å¤´åˆ° 7ï¼Œæ¯éš” 2 ä¸ªå–ä¸€ä¸ª</td>\n</tr>\n<tr>\n<td><code>[::]</code></td>\n<td>ç­‰ä»·äº <code>[:]</code>ï¼Œå–å…¨éƒ¨</td>\n</tr>\n<tr>\n<td><code>[*]</code></td>\n<td>æ¨èå†™æ³•ï¼Œå–å…¨éƒ¨</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>é»˜è®¤å€¼è§„åˆ™ï¼š<br>\nstart é»˜è®¤ 0<br>\nend é»˜è®¤æ•°ç»„æœ«å°¾<br>\nstep é»˜è®¤ 1</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿‡æ»¤è¡¨è¾¾å¼ <code>?()</code> æ”¯æŒçš„è¿ç®—ç¬¦</p>\n</li>\n</ul>\n<blockquote>\n<p>æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå®æµ‹ä¸­ä»…æ”¯æŒæ•°å­—æ¯”è¾ƒï¼Œä¸”æ³¨æ„ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>è¿ç®—ç¬¦</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>==</code></td>\n<td>ç­‰äº</td>\n</tr>\n<tr>\n<td><code>!=</code></td>\n<td>ä¸ç­‰äº</td>\n</tr>\n<tr>\n<td><code>&lt;</code></td>\n<td>å°äº</td>\n</tr>\n<tr>\n<td><code>&lt;=</code></td>\n<td>å°äºç­‰äº</td>\n</tr>\n<tr>\n<td><code>&gt;</code></td>\n<td>å¤§äº</td>\n</tr>\n<tr>\n<td><code>&gt;=</code></td>\n<td>å¤§äºç­‰äº</td>\n</tr>\n<tr>\n<td><code>=~</code></td>\n<td>æ­£åˆ™åŒ¹é…</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>é€»è¾‘è¿ç®—ç¬¦</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>è¿ç®—ç¬¦</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&amp;&amp;</code></td>\n<td>ä¸</td>\n</tr>\n<tr>\n<td><code>||</code></td>\n<td>æˆ–</td>\n</tr>\n<tr>\n<td><code>()</code></td>\n<td>åˆ†ç»„ä¼˜å…ˆçº§</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redis çš„ RedisJSON æ¨¡å—ï¼ˆæä¾› JSON æ“ä½œåŠŸèƒ½ï¼‰æ”¯æŒçš„ JSONPath è¯­æ³•æ˜¯å—é™çš„å­é›†ï¼Œå°¤å…¶æ˜¯ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">âŒ ä¸æ”¯æŒå¤æ‚è¡¨è¾¾å¼</li>\n<li class=\"lvl-6\">âŒ ä¸æ”¯æŒåµŒå¥—æ•°ç»„æ¡ä»¶ï¼ˆ@.items[*].xxxï¼‰</li>\n<li class=\"lvl-6\">âš ï¸ å¯¹ ?() çš„æ”¯æŒéå¸¸æœ‰é™</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœéœ€è¦å¤æ‚çš„æŸ¥è¯¢æ¨èä½¿ç”¨ <code>RediSearch</code> æ¨¡å—ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢çš„ç« èŠ‚ä¼šä»‹ç»ã€‚</p>\n</li>\n</ul>\n<h2 id=\"JSON-å‘½ä»¤\">JSON å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>JSON å‘½ä»¤ æ±‡æ€»</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åˆ†ç±»</th>\n<th>å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åŸºç¡€è¯»å†™</td>\n<td>SET / MSET / GET / MGET</td>\n</tr>\n<tr>\n<td>æ•°ç»„æ“ä½œ</td>\n<td>ARRAPPEND / ARRINSERT / ARRPOP / ARRLEN / ARRINDEX / ARRTRIM</td>\n</tr>\n<tr>\n<td>å¯¹è±¡æ“ä½œ</td>\n<td>OBJKEYS / OBJLEN / TYPE</td>\n</tr>\n<tr>\n<td>æ•°å€¼è¿ç®—</td>\n<td>NUMINCRBY / NUMMULTBY / TOGGLE</td>\n</tr>\n<tr>\n<td>å­—ç¬¦ä¸²</td>\n<td>STRAPPEND / STRLEN</td>\n</tr>\n<tr>\n<td>åˆ é™¤æ¸…ç©º</td>\n<td>DEL / FORGET / CLEAR</td>\n</tr>\n<tr>\n<td>åˆå¹¶è¾“å‡º</td>\n<td>MERGE / RESP</td>\n</tr>\n<tr>\n<td>è°ƒè¯•è¯Šæ–­</td>\n<td>DEBUG / DEBUG MEMORY</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ä¸€ã€åŸºç¡€è¯»å†™ç±»ï¼ˆCRUDï¼‰\">ä¸€ã€åŸºç¡€è¯»å†™ç±»ï¼ˆCRUDï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>å…³é”®å‚æ•°è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JSON.SET</td>\n<td>è®¾ç½®æˆ–æ›´æ–°æŸä¸ª path çš„å€¼</td>\n<td><code>key</code>ï¼šé”®å<br><code>path</code>ï¼šJSONPathï¼ˆå¦‚ <code>$</code>ã€<code>$.a.b</code>ï¼‰<br><code>value</code>ï¼šJSON å€¼</td>\n<td><code>JSON.SET user:1 $ '&#123;&quot;name&quot;:&quot;Tom&quot;,&quot;age&quot;:18&#125;'</code></td>\n</tr>\n<tr>\n<td>JSON.MSET</td>\n<td>æ‰¹é‡è®¾ç½®å¤šä¸ª key</td>\n<td><code>(key path value)...</code></td>\n<td><code>JSON.MSET k1 $ '&#123;&quot;a&quot;:1&#125;' k2 $.b 2</code></td>\n</tr>\n<tr>\n<td>JSON.GET</td>\n<td>è·å–ä¸€ä¸ª key çš„ JSON å€¼</td>\n<td><code>key</code><br><code>path...</code>ï¼šå¯å¤šä¸ª</td>\n<td><code>JSON.GET user:1 $.name $.age</code></td>\n</tr>\n<tr>\n<td>JSON.MGET</td>\n<td>ä»å¤šä¸ª key è·å–åŒä¸€è·¯å¾„</td>\n<td><code>key... path</code></td>\n<td><code>JSON.MGET k1 k2 $.a</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">JSON.GET è¿”å› å­—ç¬¦ä¸²åŒ– JSON</li>\n<li class=\"lvl-6\">JSON.MGET è¿”å›æ•°ç»„ï¼Œå¯¹åº”å¤šä¸ª key</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"äºŒã€æ•°ç»„æ“ä½œç±»ï¼ˆArrayï¼‰\">äºŒã€æ•°ç»„æ“ä½œç±»ï¼ˆArrayï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>å‚æ•°å«ä¹‰</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JSON.ARRAPPEND</td>\n<td>å‘æ•°ç»„æœ«å°¾è¿½åŠ å…ƒç´ </td>\n<td><code>key path value...</code></td>\n<td><code>JSON.ARRAPPEND k $.tags &quot;redis&quot; &quot;json&quot;</code></td>\n</tr>\n<tr>\n<td>JSON.ARRINSERT</td>\n<td>åœ¨æŒ‡å®šç´¢å¼•æ’å…¥å…ƒç´ </td>\n<td><code>key path index value...</code></td>\n<td><code>JSON.ARRINSERT k $.tags 1 &quot;nosql&quot;</code></td>\n</tr>\n<tr>\n<td>JSON.ARRPOP</td>\n<td>åˆ é™¤å¹¶è¿”å›æŒ‡å®šç´¢å¼•å…ƒç´ </td>\n<td><code>key path [index]</code></td>\n<td><code>JSON.ARRPOP k $.tags -1</code></td>\n</tr>\n<tr>\n<td>JSON.ARRLEN</td>\n<td>è·å–æ•°ç»„é•¿åº¦</td>\n<td><code>key path</code></td>\n<td><code>JSON.ARRLEN k $.tags</code></td>\n</tr>\n<tr>\n<td>JSON.ARRINDEX</td>\n<td>æŸ¥æ‰¾å…ƒç´ ç´¢å¼•</td>\n<td><code>key path value</code></td>\n<td><code>JSON.ARRINDEX k $.tags &quot;redis&quot;</code></td>\n</tr>\n<tr>\n<td>JSON.ARRTRIM</td>\n<td>æˆªå–æ•°ç»„åŒºé—´</td>\n<td><code>key path start stop</code></td>\n<td><code>JSON.ARRTRIM k $.scores 0 9</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ç´¢å¼•æ”¯æŒè´Ÿæ•°ï¼ˆ-1 è¡¨ç¤ºæœ€åä¸€ä¸ªï¼‰</li>\n<li class=\"lvl-6\">ARRTRIM ç±»ä¼¼ LTRIM</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ä¸‰ã€å¯¹è±¡æ“ä½œç±»ï¼ˆObjectï¼‰\">ä¸‰ã€å¯¹è±¡æ“ä½œç±»ï¼ˆObjectï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>å‚æ•°è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JSON.OBJKEYS</td>\n<td>è·å–å¯¹è±¡çš„æ‰€æœ‰ key</td>\n<td><code>key path</code></td>\n<td><code>JSON.OBJKEYS k $.user</code></td>\n</tr>\n<tr>\n<td>JSON.OBJLEN</td>\n<td>è·å–å¯¹è±¡å­—æ®µæ•°é‡</td>\n<td><code>key path</code></td>\n<td><code>JSON.OBJLEN k $.user</code></td>\n</tr>\n<tr>\n<td>JSON.TYPE</td>\n<td>è¿”å› path å¯¹åº”å€¼ç±»å‹</td>\n<td><code>key path</code></td>\n<td><code>JSON.TYPE k $.user.name</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>JSON.TYPE è¿”å›ç±»å‹åŒ…æ‹¬ï¼šobject / array / string / number / boolean / null</p>\n</li>\n</ul>\n<h3 id=\"å››ã€æ•°å€¼è¿ç®—ç±»ï¼ˆNumericï¼‰\">å››ã€æ•°å€¼è¿ç®—ç±»ï¼ˆNumericï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>å‚æ•°è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JSON.NUMINCRBY</td>\n<td>æ•°å€¼è‡ªå¢</td>\n<td><code>key path number</code></td>\n<td><code>JSON.NUMINCRBY k $.count 1</code></td>\n</tr>\n<tr>\n<td>JSON.NUMMULTBY</td>\n<td>æ•°å€¼ä¹˜æ³•</td>\n<td><code>key path number</code></td>\n<td><code>JSON.NUMMULTBY k $.price 0.8</code></td>\n</tr>\n<tr>\n<td>JSON.TOGGLE</td>\n<td>å¸ƒå°”å€¼å–å</td>\n<td><code>key path</code></td>\n<td><code>JSON.TOGGLE k $.enabled</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä¿è¯ åŸå­æ€§</li>\n<li class=\"lvl-6\">å¸¸ç”¨äºè®¡æ•°ã€å¼€å…³çŠ¶æ€</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"äº”ã€å­—ç¬¦ä¸²æ“ä½œç±»ï¼ˆStringï¼‰\">äº”ã€å­—ç¬¦ä¸²æ“ä½œç±»ï¼ˆStringï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>å‚æ•°è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JSON.STRAPPEND</td>\n<td>è¿½åŠ å­—ç¬¦ä¸²</td>\n<td><code>key path value</code></td>\n<td><code>JSON.STRAPPEND k $.msg &quot; world&quot;</code></td>\n</tr>\n<tr>\n<td>JSON.STRLEN</td>\n<td>å­—ç¬¦ä¸²é•¿åº¦</td>\n<td><code>key path</code></td>\n<td><code>JSON.STRLEN k $.msg</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å…­ã€åˆ é™¤-æ¸…ç©ºç±»\">å…­ã€åˆ é™¤ / æ¸…ç©ºç±»</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>å‚æ•°è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JSON.DEL</td>\n<td>åˆ é™¤æŒ‡å®š path</td>\n<td><code>key path</code></td>\n<td><code>JSON.DEL k $.user.age</code></td>\n</tr>\n<tr>\n<td>JSON.FORGET</td>\n<td>ç­‰ä»· JSON.DEL</td>\n<td>åŒä¸Š</td>\n<td><code>JSON.FORGET k $.tmp</code></td>\n</tr>\n<tr>\n<td>JSON.CLEAR</td>\n<td>æ¸…ç©ºå€¼</td>\n<td><code>key path</code></td>\n<td><code>JSON.CLEAR k $.list</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>JSON.CLEAR è¡Œä¸ºè¯´æ˜ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æ•°ç»„ â†’ []</li>\n<li class=\"lvl-6\">å¯¹è±¡ â†’ {}</li>\n<li class=\"lvl-6\">æ•°å€¼ â†’ 0</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ä¸ƒã€åˆå¹¶ä¸é«˜çº§æ“ä½œ\">ä¸ƒã€åˆå¹¶ä¸é«˜çº§æ“ä½œ</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>å‚æ•°è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JSON.MERGE</td>\n<td>åˆå¹¶ JSONï¼ˆRFC7396ï¼‰</td>\n<td><code>key path value</code></td>\n<td><code>JSON.MERGE k $ '&#123;&quot;a&quot;:2,&quot;b&quot;:3&#125;'</code></td>\n</tr>\n<tr>\n<td>JSON.RESP</td>\n<td>RESP æ ¼å¼è¿”å›</td>\n<td><code>key path</code></td>\n<td><code>JSON.RESP k $.user</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯´æ˜ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">MERGE æ”¯æŒå­—æ®µè¦†ç›–ã€åˆ é™¤ã€æ‰©å±•</li>\n<li class=\"lvl-6\">RESP é€‚åˆå®¢æˆ·ç«¯ç›´æ¥è§£æ</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å…«ã€è°ƒè¯•ä¸è¯Šæ–­ç±»ï¼ˆDebugï¼‰\">å…«ã€è°ƒè¯•ä¸è¯Šæ–­ç±»ï¼ˆDebugï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨</th>\n<th>å‚æ•°è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JSON.DEBUG</td>\n<td>è°ƒè¯•å‘½ä»¤å®¹å™¨</td>\n<td>å­å‘½ä»¤</td>\n<td><code>JSON.DEBUG MEMORY k</code></td>\n</tr>\n<tr>\n<td>JSON.DEBUG MEMORY</td>\n<td>æŸ¥çœ‹ JSON å ç”¨å†…å­˜</td>\n<td><code>key</code></td>\n<td><code>JSON.DEBUG MEMORY user:1</code></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"åº”ç”¨ç¤ºä¾‹\">åº”ç”¨ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœºæ™¯é€‰ç”¨ï¼šç”µå•†ç”¨æˆ·ç”»åƒ + è®¢å•ç³»ç»Ÿï¼ˆç»“æ„å¤æ‚ã€å­—æ®µå¤šã€éå¸¸é€‚åˆ JSONPathï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">æˆ‘ä»¬è¦å­˜å‚¨ä¸€ä¸ªç”¨æˆ·çš„å®Œæ•´ç”»åƒï¼š</span><br><span class=\"line\">    åŸºæœ¬ä¿¡æ¯</span><br><span class=\"line\">    åœ°å€åˆ—è¡¨</span><br><span class=\"line\">    è®¢å•åˆ—è¡¨ï¼ˆåŒ…å«å•†å“ã€ä»·æ ¼ã€æ•°é‡ï¼‰</span><br><span class=\"line\">    æ ‡ç­¾(åå¥½)</span><br><span class=\"line\">    è´¦æˆ·çŠ¶æ€</span><br><span class=\"line\">    ç»Ÿè®¡ä¿¡æ¯</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SpringBootæš‚æ—¶æ²¡æœ‰æ”¯æŒRedisJSONï¼Œä½ å¯ä»¥ç¼–å†™Luaè„šæœ¬æ¥å®ç°ç›¸åº”çš„åŠŸèƒ½ï¼Œå¦å¤– <a href=\"https://redisson.pro/docs/data-and-services/objects/#json-object-holder\">Redisson</a>å·²ç»æä¾›äº†å¯¹JSONçš„æ”¯æŒï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å‘ç°è¿˜æœ‰ä¸€äº›Bugï¼Œä¸‹é¢ç»“åˆå‘½ä»¤ç»™å‡ºä»£ç ç¤ºä¾‹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- å¼•å…¥ Redisson ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œç°åœ¨æœ€æ–°ç‰ˆæ˜¯ 4.0.0ï¼Œéœ€è¦ springboot 4.x --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.redisson<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.52.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºå®Œæ•´ JSON æ–‡æ¡£ï¼ˆJSON.SETï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º JSON æ–‡æ¡£ï¼Œå®é™…æ‰§è¡Œä¸­ä¸æ”¯æŒå¤šè¡Œï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†çœ‹ç€æ¸…æ¥šäº›ï¼Œå®é™…è¿è¡Œæ—¶è¦å°†å…¶æ”¹æˆä¸€è¡Œ</span></span><br><span class=\"line\">JSON.SET user:10001 $ <span class=\"string\">&#x27;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &quot;profile&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;name&quot;: &quot;Alice&quot;,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;age&quot;: 28,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;vip&quot;: true</span></span><br><span class=\"line\"><span class=\"string\">  &#125;,</span></span><br><span class=\"line\"><span class=\"string\">  &quot;tags&quot;: [&quot;vip&quot;, &quot;electronics&quot;, &quot;promotion&quot;],</span></span><br><span class=\"line\"><span class=\"string\">  &quot;addresses&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">    &#123; &quot;city&quot;: &quot;Beijing&quot;, &quot;zip&quot;: &quot;100000&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &#123; &quot;city&quot;: &quot;Shanghai&quot;, &quot;zip&quot;: &quot;200000&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">  ],</span></span><br><span class=\"line\"><span class=\"string\">  &quot;orders&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">    &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;orderId&quot;: &quot;O1001&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;amount&quot;: 199.99,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;status&quot;: &quot;PAID&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;items&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &#123; &quot;sku&quot;: &quot;SKU-1&quot;, &quot;price&quot;: 99.99, &quot;qty&quot;: 1 &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &#123; &quot;sku&quot;: &quot;SKU-2&quot;, &quot;price&quot;: 100.00, &quot;qty&quot;: 1 &#125;</span></span><br><span class=\"line\"><span class=\"string\">      ]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;,</span></span><br><span class=\"line\"><span class=\"string\">    &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;orderId&quot;: &quot;O1002&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;amount&quot;: 59.90,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;status&quot;: &quot;CREATED&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;items&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &#123; &quot;sku&quot;: &quot;SKU-3&quot;, &quot;price&quot;: 59.90, &quot;qty&quot;: 1 &#125;</span></span><br><span class=\"line\"><span class=\"string\">      ]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">  ],</span></span><br><span class=\"line\"><span class=\"string\">  &quot;stats&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">    &quot;loginCount&quot;: 10,</span></span><br><span class=\"line\"><span class=\"string\">    &quot;balance&quot;: 300.5</span></span><br><span class=\"line\"><span class=\"string\">  &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥ä½¿ç”¨å•è¡Œæ¨¡å¼ä¸€ç‚¹ç‚¹ç»„è£…</span></span><br><span class=\"line\">JSON.SET user:10001 $ <span class=\"string\">&#x27;&#123;&#125;&#x27;</span></span><br><span class=\"line\">JSON.SET user:10001 $.profile <span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;Alice&quot;,&quot;age&quot;:28,&quot;vip&quot;:true&#125;&#x27;</span></span><br><span class=\"line\">JSON.SET user:10001 $.tags <span class=\"string\">&#x27;[&quot;vip&quot;,&quot;electronics&quot;,&quot;promotion&quot;]&#x27;</span></span><br><span class=\"line\">JSON.SET user:10001 $.addresses <span class=\"string\">&#x27;[&#123;&quot;city&quot;:&quot;Beijing&quot;,&quot;zip&quot;:&quot;100000&quot;&#125;,&#123;&quot;city&quot;:&quot;Shanghai&quot;,&quot;zip&quot;:&quot;200000&quot;&#125;]&#x27;</span></span><br><span class=\"line\">JSON.SET user:10001 $.orders <span class=\"string\">&#x27;[&#123;&quot;orderId&quot;:&quot;O1001&quot;,&quot;amount&quot;:199.99,&quot;status&quot;:&quot;PAID&quot;,&quot;items&quot;:[&#123;&quot;sku&quot;:&quot;SKU-1&quot;,&quot;price&quot;:99.99,&quot;qty&quot;:1&#125;,&#123;&quot;sku&quot;:&quot;SKU-2&quot;,&quot;price&quot;:100,&quot;qty&quot;:1&#125;]&#125;,&#123;&quot;orderId&quot;:&quot;O1002&quot;,&quot;amount&quot;:59.90,&quot;status&quot;:&quot;CREATED&quot;,&quot;items&quot;:[&#123;&quot;sku&quot;:&quot;SKU-3&quot;,&quot;price&quot;:59.90,&quot;qty&quot;:1&#125;]&#125;]&#x27;</span></span><br><span class=\"line\">JSON.SET user:10001 $.stats <span class=\"string\">&#x27;&#123;&quot;loginCount&quot;:10,&quot;balance&quot;:300.5&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç±»å‹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">type</span> user:10001</span><br><span class=\"line\">ReJSON-RL</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šç”¨ä»£ç </p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> RedissonClient redissonClient;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">userStr</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">            &#123;</span></span><br><span class=\"line\"><span class=\"string\">              &quot;profile&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">                &quot;name&quot;: &quot;Alice&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                &quot;age&quot;: 28,</span></span><br><span class=\"line\"><span class=\"string\">                &quot;vip&quot;: true</span></span><br><span class=\"line\"><span class=\"string\">              &#125;,</span></span><br><span class=\"line\"><span class=\"string\">              &quot;tags&quot;: [&quot;vip&quot;, &quot;electronics&quot;, &quot;promotion&quot;],</span></span><br><span class=\"line\"><span class=\"string\">              &quot;addresses&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                &#123; &quot;city&quot;: &quot;Beijing&quot;, &quot;zip&quot;: &quot;100000&quot; &#125;,</span></span><br><span class=\"line\"><span class=\"string\">                &#123; &quot;city&quot;: &quot;Shanghai&quot;, &quot;zip&quot;: &quot;200000&quot; &#125;</span></span><br><span class=\"line\"><span class=\"string\">              ],</span></span><br><span class=\"line\"><span class=\"string\">              &quot;orders&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;orderId&quot;: &quot;O1001&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;amount&quot;: 199.99,</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;status&quot;: &quot;PAID&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;items&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                    &#123; &quot;sku&quot;: &quot;SKU-1&quot;, &quot;price&quot;: 99.99, &quot;qty&quot;: 1 &#125;,</span></span><br><span class=\"line\"><span class=\"string\">                    &#123; &quot;sku&quot;: &quot;SKU-2&quot;, &quot;price&quot;: 100.00, &quot;qty&quot;: 1 &#125;</span></span><br><span class=\"line\"><span class=\"string\">                  ]</span></span><br><span class=\"line\"><span class=\"string\">                &#125;,</span></span><br><span class=\"line\"><span class=\"string\">                &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;orderId&quot;: &quot;O1002&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;amount&quot;: 59.90,</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;status&quot;: &quot;CREATED&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;items&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                    &#123; &quot;sku&quot;: &quot;SKU-3&quot;, &quot;price&quot;: 59.90, &quot;qty&quot;: 1 &#125;</span></span><br><span class=\"line\"><span class=\"string\">                  ]</span></span><br><span class=\"line\"><span class=\"string\">                &#125;</span></span><br><span class=\"line\"><span class=\"string\">              ],</span></span><br><span class=\"line\"><span class=\"string\">              &quot;stats&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">                &quot;loginCount&quot;: 10,</span></span><br><span class=\"line\"><span class=\"string\">                &quot;balance&quot;: 300.5</span></span><br><span class=\"line\"><span class=\"string\">              &#125;</span></span><br><span class=\"line\"><span class=\"string\">            &#125;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;&quot;&quot;</span>;</span><br><span class=\"line\"><span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">RJsonBucket&lt;User&gt; bucket = redissonClient.getJsonBucket(<span class=\"string\">&quot;user:10001&quot;</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(User.class));</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> objectMapper.readValue(userStr, User.class);</span><br><span class=\"line\">bucket.set(user);</span><br></pre></td></tr></table></figure>\n<h3 id=\"JSONPath-æŸ¥è¯¢ç¤ºä¾‹\">JSONPath æŸ¥è¯¢ç¤ºä¾‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1ï¸âƒ£ åŸºç¡€è·¯å¾„è®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–å…¨éƒ¨æ•°æ®</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $.profile</span><br><span class=\"line\"><span class=\"string\">&quot;[&#123;\\&quot;name\\&quot;:\\&quot;Alice\\&quot;,\\&quot;age\\&quot;:28,\\&quot;vip\\&quot;:true&#125;]&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–ç”¨æˆ·å</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $.profile.name</span><br><span class=\"line\"><span class=\"string\">&quot;[\\&quot;Alice\\&quot;]&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;User&gt;() &#123;&#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">User.<span class=\"type\">ProfileBean</span> <span class=\"variable\">profile</span> <span class=\"operator\">=</span> bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;User.ProfileBean&gt;() &#123;&#125;),<span class=\"string\">&quot;profile&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;String&gt;() &#123;&#125;),<span class=\"string\">&quot;profile.name&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// åŠ ä¸Š $. å‰ç¼€ï¼Œè¿”å›å€¼å¿…é¡»æ˜¯ List&lt;T&gt;</span></span><br><span class=\"line\">List&lt;String&gt; names = bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;String&gt;&gt;() &#123;&#125;),<span class=\"string\">&quot;$.profile.name&quot;</span>);</span><br><span class=\"line\">System.out.println(names.get(<span class=\"number\">0</span>));</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2ï¸âƒ£ æ•°ç»„è®¿é—® &amp; é€šé…ç¬¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–æ‰€æœ‰è®¢å•ID</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[*].orderId</span><br><span class=\"line\"><span class=\"string\">&quot;[\\&quot;O1001\\&quot;,\\&quot;O1002\\&quot;]&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–æ‰€æœ‰åœ°å€çš„åŸå¸‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $.addresses[*].city</span><br><span class=\"line\"><span class=\"string\">&quot;[\\&quot;Beijing\\&quot;,\\&quot;Shanghai\\&quot;]&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;String&gt; orderIds = bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;String&gt;&gt;() &#123;&#125;),<span class=\"string\">&quot;$.orders[*].orderId&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">List&lt;String&gt; citys = bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;String&gt;&gt;() &#123;&#125;),<span class=\"string\">&quot;$.addresses[*].city&quot;</span>);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>3ï¸âƒ£ æ•°ç»„ä¸‹æ ‡ä¸åˆ‡ç‰‡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–ç¬¬ä¸€ä¸ªè®¢å•</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[0]</span><br><span class=\"line\"><span class=\"string\">&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªè®¢å•ï¼Œåˆ‡ç‰‡é€»è¾‘æ˜¯ [start:end]ï¼Œ start &lt;= x &lt; end ï¼Œendä¸å†™é»˜è®¤ä¸ºæ•°ç»„æœ«å°¾</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[0:2]</span><br><span class=\"line\"><span class=\"string\">&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;,&#123;\\&quot;orderId\\&quot;:\\&quot;O1002\\&quot;,\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-3\\&quot;,\\&quot;price\\&quot;:59.9,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–æ‰€æœ‰è®¢å•ï¼Œè¿™é‡Œç­‰åŒäº $.orders[*]</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[:]</span><br><span class=\"line\"><span class=\"string\">&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;,&#123;\\&quot;orderId\\&quot;:\\&quot;O1002\\&quot;,\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-3\\&quot;,\\&quot;price\\&quot;:59.9,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;OrdersBean&gt; orders = bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class=\"string\">&quot;$.orders[0]&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">orders = bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class=\"string\">&quot;$.orders[0:2]&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">orders = bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class=\"string\">&quot;$.orders[:]&quot;</span>);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>4ï¸âƒ£ é€’å½’æŸ¥è¯¢ï¼ˆâ€¦ï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰å•†å“ä»·æ ¼ï¼ˆä¸ç®¡åœ¨å“ªä¸€å±‚ï¼‰</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $..price</span><br><span class=\"line\"><span class=\"string\">&quot;[99.99,100,59.9]&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;Double&gt; prices = bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;Double&gt;&gt;() &#123;&#125;),<span class=\"string\">&quot;$..price&quot;</span>);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>5ï¸âƒ£ æ¡ä»¶è¿‡æ»¤ï¼ˆJSONPath æ ¸å¿ƒèƒ½åŠ›ï¼‰</p>\n</li>\n</ul>\n<blockquote>\n<p>âœ… æ”¯æŒçš„æŸ¥è¯¢</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•é‡‘é¢å¤§äº100çš„è®¢å•ï¼Œâœ… æ•°å­—æ¯”è¾ƒ</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.amount&gt;100)]</span><br><span class=\"line\"><span class=\"string\">&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•ä¸­ç¬¬ä¸€ä¸ªå•†å“ä»·æ ¼å¤§äº50çš„è®¢å•ï¼Œâœ… æ•°ç»„æ¡ä»¶</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.items[0].price&gt;50)]</span><br><span class=\"line\"><span class=\"string\">&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;,&#123;\\&quot;orderId\\&quot;:\\&quot;O1002\\&quot;,\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-3\\&quot;,\\&quot;price\\&quot;:59.9,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•é‡‘é¢å¤§äº100å¹¶ä¸”è®¢å•ä¸­ç¬¬ä¸€ä¸ªå•†å“ä»·æ ¼å¤§äº50çš„è®¢å•ï¼Œâœ… é€»è¾‘è¿ç®—ç¬¦</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.amount&gt;100)&amp;&amp;(@.items[0].price&gt;50)]</span><br><span class=\"line\"><span class=\"string\">&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;OrdersBean&gt; orders = bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class=\"string\">&quot;$.orders[?(@.amount&gt;100)]&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">orders = bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class=\"string\">&quot;$.orders[?(@.items[0].price&gt;50)]&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">orders = bucket.get(<span class=\"keyword\">new</span> <span class=\"title class_\">JacksonCodec</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">TypeReference</span>&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),<span class=\"string\">&quot;$.orders[?(@.amount&gt;100)&amp;&amp;(@.items[0].price&gt;50)]&quot;</span>);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>âŒ ä¸æ”¯æŒçš„æŸ¥è¯¢</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰å·²æ”¯ä»˜è®¢å•ï¼ŒâŒ ä¸æ”¯æŒå­—ç¬¦ä¸²çš„æ¯”è¾ƒ</span><br><span class=\"line\">JSON.GET user:10001 $.orders[?(@.status==&quot;PAID&quot;)]</span><br><span class=\"line\"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰å·²æ”¯ä»˜è®¢å•ï¼ŒâŒ ä¸æ”¯æŒæ­£åˆ™åŒ¹é…</span><br><span class=\"line\">JSON.GET user:10001 $.orders[?(@.status=~&quot;PAID&quot;)]</span><br><span class=\"line\"></span><br><span class=\"line\"># ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•ä¸­å•†å“ä»·æ ¼å¤§äº50çš„è®¢å•ï¼Œè¿™ä¸ªå°±ä¸å‡†ï¼ŒâŒ ä¸æ”¯æŒåµŒå¥—æ•°ç»„æ¡ä»¶ï¼ˆ@.items[*].xxxï¼‰</span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.items[*].price&gt;50)]</span><br><span class=\"line\">&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1002\\&quot;,\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-3\\&quot;,\\&quot;price\\&quot;:59.9,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>6ï¸âƒ£ ä¿®æ”¹æ•°æ®ï¼ˆJSON.SET / JSON.NUMINCRBYï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ ä¿®æ”¹ç”¨æˆ·å</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.SET user:10001 $.profile.name <span class=\"string\">&#x27;&quot;Alice Zhang&quot;&#x27;</span></span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ ç”¨æˆ·ç™»å½•æ¬¡æ•° +1</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.NUMINCRBY user:10001 $.stats.loginCount 1</span><br><span class=\"line\"><span class=\"string\">&quot;[11]&quot;</span> <span class=\"comment\"># è¿”å›ä¿®æ”¹åçš„å€¼</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bucket.set(<span class=\"string\">&quot;$.profile.name&quot;</span>, <span class=\"string\">&quot;Alice Zhang&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// æ³¨æ„å¦‚ä¸‹æ–¹æ³•ä¼šå¢åŠ æˆåŠŸï¼Œä½†æ˜¯ä¼šæŠ›å¼‚å¸¸ï¼Œåº”è¯¥æ˜¯Redissonçš„bug</span></span><br><span class=\"line\"><span class=\"comment\">// Caused by: java.lang.NumberFormatException: For input string: &quot;[11]&quot;</span></span><br><span class=\"line\">bucket.incrementAndGet(<span class=\"string\">&quot;$.stats.loginCount&quot;</span>, <span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>7ï¸âƒ£ æ•°ç»„æ“ä½œï¼ˆARRAPPEND / ARRINSERTï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ æ·»åŠ ä¸€ä¸ªè®¢å•</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.ARRAPPEND user:10001 $.orders <span class=\"string\">&#x27;&#123;&quot;orderId&quot;: &quot;O1003&quot;,&quot;amount&quot;: 399,&quot;status&quot;: &quot;PAID&quot;,&quot;items&quot;: [&#123; &quot;sku&quot;: &quot;SKU-9&quot;, &quot;price&quot;: 399, &quot;qty&quot;: 1 &#125;]&#125;&#x27;</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 3 <span class=\"comment\"># è¿”å›æ·»åŠ åçš„é•¿åº¦</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ åœ¨ tags çš„æœ€åæ·»åŠ ä¸€ä¸ªæ ‡ç­¾</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.ARRAPPEND user:10001 $.tags <span class=\"string\">&#x27;&quot;newTag&quot;&#x27;</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 4 <span class=\"comment\"># æ·»åŠ åçš„é•¿åº¦</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ åœ¨ tags ä¸­çš„æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ªæ ‡ç­¾</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.ARRINSERT user:10001 $.tags 1 <span class=\"string\">&#x27;&quot;newTag2&quot;&#x27;</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 5 <span class=\"comment\"># æ’å…¥åçš„é•¿åº¦</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">OrdersBean</span> <span class=\"variable\">ordersBean</span> <span class=\"operator\">=</span> OrdersBean.builder()</span><br><span class=\"line\">                .orderId(<span class=\"string\">&quot;O1003&quot;</span>)</span><br><span class=\"line\">                .amount(<span class=\"number\">399</span>)</span><br><span class=\"line\">                .status(<span class=\"string\">&quot;CREATED&quot;</span>)</span><br><span class=\"line\">                .items(List.of(</span><br><span class=\"line\">                        OrdersBean.ItemsBean.builder()</span><br><span class=\"line\">                                .sku(<span class=\"string\">&quot;SKU-9&quot;</span>)</span><br><span class=\"line\">                                .qty(<span class=\"number\">1</span>)</span><br><span class=\"line\">                                .price(<span class=\"number\">399</span>).build()</span><br><span class=\"line\">                )).build();</span><br><span class=\"line\"><span class=\"comment\">// æ·»åŠ ä¸€ä¸ªè®¢å•ï¼Œè¿”å›æ·»åŠ åçš„é•¿åº¦</span></span><br><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">num</span> <span class=\"operator\">=</span> bucket.arrayAppend(<span class=\"string\">&quot;$.orders&quot;</span>, ordersBean);</span><br><span class=\"line\"></span><br><span class=\"line\">num = bucket.arrayAppend(<span class=\"string\">&quot;$.tags&quot;</span>, <span class=\"string\">&quot;newTag&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ’å…¥æˆåŠŸï¼Œä½†æ˜¯ä¼šæŠ›å¼‚å¸¸ï¼Œåº”è¯¥æ˜¯Redissonçš„bug</span></span><br><span class=\"line\">num = bucket.arrayInsert(<span class=\"string\">&quot;$.tags&quot;</span>, <span class=\"number\">1</span>, <span class=\"string\">&quot;newTag2&quot;</span>);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>8ï¸âƒ£ åˆ é™¤ &amp; æ¸…ç†æ“ä½œï¼ˆJSON.DEL &amp; JSON.CLEARï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ åˆ é™¤ç”¨æˆ·å¹´é¾„ï¼Œ$.profile.age ä¸å­˜åœ¨äº†</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.DEL user:10001 $.profile.age</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1 <span class=\"comment\"># åˆ é™¤æˆåŠŸï¼Œè¿”å›0ï¼Œè¡¨ç¤ºè·¯å¾„ä¸å­˜åœ¨</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ æ¸…ç©ºç”¨æˆ·æ‰€æœ‰æ ‡ç­¾ï¼Œ$.tags ä¿ç•™ï¼Œåªæ˜¯å˜æˆäº† [] ç©ºæ•°ç»„</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.CLEAR user:10001 $.tags</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1 <span class=\"comment\"># æ¸…ç©ºæˆåŠŸï¼Œè¿”å›0ï¼Œè¡¨ç¤ºè·¯å¾„ä¸å­˜åœ¨æˆ–å·²ç»æ¸…ç©º</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">delete</span> <span class=\"operator\">=</span> bucket.delete(<span class=\"string\">&quot;$.profile.age&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">clear</span> <span class=\"operator\">=</span> bucket.clear(<span class=\"string\">&quot;$.tags&quot;</span>);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>9ï¸âƒ£ ç»Ÿè®¡æ•°ç»„é•¿åº¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ğŸ‘‰ ç»Ÿè®¡ç”¨æˆ·è®¢å•çš„é•¿åº¦</span></span><br><span class=\"line\">127.0.0.1:6379&gt; JSON.ARRLEN user:10001 $.orders</span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 3</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ä¼šæŠ›å¼‚å¸¸ï¼Œåº”è¯¥æ˜¯Redissonçš„bug</span></span><br><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">length</span> <span class=\"operator\">=</span> bucket.arraySize(<span class=\"string\">&quot;$.orders&quot;</span>);</span><br></pre></td></tr></table></figure>\n<p>ğŸ”Ÿ æŸ¥çœ‹ JSON å ç”¨å†…å­˜</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; JSON.DEBUG MEMORY user:10001</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1896 <span class=\"comment\"># å ç”¨å†…å­˜å¤§å°ï¼Œå•ä½å­—èŠ‚</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">sizeInMemory</span> <span class=\"operator\">=</span> bucket.sizeInMemory();</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisJSON ä¸­çš„ JSON æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisJSON çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub JSON vs String Redis JSONå­˜å‚¨æ•°æ®çš„æ€§èƒ½æ›´é«˜ã€‚ Redis JSON åº•å±‚å…¶å®æ˜¯ä»¥ä¸€ç§é«˜æ•ˆçš„äºŒè¿›åˆ¶çš„æ ¼å¼å­˜å‚¨ã€‚ ç›¸æ¯”ç®€å•çš„æ–‡æœ¬æ ¼å¼ï¼ŒäºŒè¿›åˆ¶æ ¼å¼è¿›è¡Œ JOSN æ ¼å¼è¯»å†™çš„æ€§èƒ½æ›´é«˜ï¼Œä¹Ÿæ›´èŠ‚çœå†…å­˜ã€‚ æ ¹æ®å®˜ç½‘çš„æ€§èƒ½æµ‹è¯•æŠ¥å‘Šï¼Œä½¿ç”¨ Redis JSON è¯»å†™ JSONæ•°æ®ï¼Œæ€§èƒ½å·²ç»èƒ½å¤Ÿåª²ç¾ MongoDB ä»¥åŠ ElasticSearch ç­‰ä¼ ç»Ÿ NoSQL æ•°æ®åº“ã€‚ Redis JSON ä½¿ç”¨æ ‘çŠ¶ç»“æ„æ¥å­˜å‚¨JSONã€‚ è¿™ç§å­˜å‚¨æ–¹å¼å¯ä»¥å¿«é€Ÿè®¿é—®å­å…ƒç´ ã€‚ ä¸ä¼ ç»Ÿçš„æ–‡æœ¬å­˜å‚¨æ–¹æ¡ˆç›¸æ¯”ï¼Œæ ‘çŠ¶å­˜å‚¨ç»“æ„èƒ½å¤Ÿæ›´é«˜æ•ˆçš„æ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚ ä¸Redisç”Ÿæ€é›†æˆåº¦é«˜ã€‚ ä½œä¸ºRedisçš„æ‰©å±•æ¨¡å—ï¼ŒRedis JSON å’ŒRedisçš„å…¶ä»–åŠŸèƒ½å’Œå·¥å…·æ— ç¼é›†æˆã€‚ è¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥ç»§ç»­ä½¿ç”¨TTLã€Redisäº‹åŠ¡ã€å‘å¸ƒ/è®¢é˜…ã€Luaè„šæœ¬ç­‰åŠŸèƒ½ã€‚ JSONPath JSONPath æ˜¯ä¸€ç§ç”¨äºæŸ¥è¯¢å’Œä¿®æ”¹ JSON æ•°æ®çš„è¯­æ³•ã€‚ JSONPath è¯­æ³• è¯­æ³•å…ƒç´  ä¸­æ–‡è¯´æ˜ ç¤ºä¾‹ $ æ ¹èŠ‚ç‚¹ï¼ˆæœ€å¤–å±‚ JSON å…ƒç´ ï¼‰ï¼ŒJSONPath çš„èµ·ç‚¹ $ã€$.user.name . è®¿é—®å­å­—æ®µï¼ˆå¯¹è±¡å±æ€§è®¿é—®ï¼‰ $.user.age [] å­å…ƒç´ é€‰æ‹©å™¨ï¼ˆå­—æ®µåæˆ–æ•°ç»„ç´¢å¼•ï¼‰ $['user']['name'] .. é€’å½’ä¸‹é™ï¼Œéå†æ‰€æœ‰å±‚çº§çš„èŠ‚ç‚¹ $..id * é€šé…ç¬¦ï¼ŒåŒ¹é…å½“å‰å±‚çº§çš„æ‰€æœ‰å…ƒç´  $.users[*] [index] æ•°ç»„ä¸‹æ ‡è®¿é—®ï¼ˆæ”¯æŒè´Ÿç´¢å¼•ï¼‰ $.scores[0] [a,b,c] è”åˆé€‰æ‹©ï¼Œè¿”å›å¤šä¸ªæŒ‡å®šå…ƒç´  $.scores[0,2,4] [start:end:step] æ•°ç»„åˆ‡ç‰‡ï¼ˆèµ·å§‹ç´¢å¼• : ç»“æŸç´¢å¼• : æ­¥é•¿ï¼‰ $.scores[1:5:2] [*] é€‰æ‹©æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´  $.items[*] [:] é€‰æ‹©æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆåˆ‡ç‰‡å†™æ³•ï¼‰ $.items[:] ?() è¿‡æ»¤è¡¨è¾¾å¼ï¼Œç”¨äºæ•°ç»„æˆ–å¯¹è±¡çš„æ¡ä»¶ç­›é€‰ $.users[?(@.age&gt;=18)] () è„šæœ¬è¡¨è¾¾å¼ï¼Œç”¨äºè®¡ç®—æˆ–å¤æ‚é€»è¾‘åˆ¤æ–­ $.items[?((@.a+@.b)&gt;10)] @ å½“å‰å…ƒç´ å¼•ç”¨ï¼Œå¸¸ç”¨äºè¿‡æ»¤æˆ–è„šæœ¬è¡¨è¾¾å¼ä¸­ @.price&lt;100 æ•°ç»„åˆ‡ç‰‡ [start:end:step] è¯¦è§£ å†™æ³• å«ä¹‰ [3:] ä»ç´¢å¼• 3 åˆ°æœ«å°¾ [:8] ä»å¤´åˆ°ç´¢å¼• 7 [:8:2] ä»å¤´åˆ° 7ï¼Œæ¯éš” 2 ä¸ªå–ä¸€ä¸ª [::] ç­‰ä»·äº [:]ï¼Œå–å…¨éƒ¨ [*] æ¨èå†™æ³•ï¼Œå–å…¨éƒ¨ é»˜è®¤å€¼è§„åˆ™ï¼š start é»˜è®¤ 0 end é»˜è®¤æ•°ç»„æœ«å°¾ step é»˜è®¤ 1 è¿‡æ»¤è¡¨è¾¾å¼ ?() æ”¯æŒçš„è¿ç®—ç¬¦ æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå®æµ‹ä¸­ä»…æ”¯æŒæ•°å­—æ¯”è¾ƒï¼Œä¸”æ³¨æ„ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼ è¿ç®—ç¬¦ å«ä¹‰ == ç­‰äº != ä¸ç­‰äº &lt; å°äº &lt;= å°äºç­‰äº &gt; å¤§äº &gt;= å¤§äºç­‰äº =~ æ­£åˆ™åŒ¹é… é€»è¾‘è¿ç®—ç¬¦ è¿ç®—ç¬¦ å«ä¹‰ &amp;&amp; ä¸ || æˆ– () åˆ†ç»„ä¼˜å…ˆçº§ Redis çš„ RedisJSON æ¨¡å—ï¼ˆæä¾› JSON æ“ä½œåŠŸèƒ½ï¼‰æ”¯æŒçš„ JSONPath è¯­æ³•æ˜¯å—é™çš„å­é›†ï¼Œå°¤å…¶æ˜¯ï¼š âŒ ä¸æ”¯æŒå¤æ‚è¡¨è¾¾å¼ âŒ ä¸æ”¯æŒåµŒå¥—æ•°ç»„æ¡ä»¶ï¼ˆ@.items[*].xxxï¼‰ âš ï¸ å¯¹ ?() çš„æ”¯æŒéå¸¸æœ‰é™ å¦‚æœéœ€è¦å¤æ‚çš„æŸ¥è¯¢æ¨èä½¿ç”¨ RediSearch æ¨¡å—ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢çš„ç« èŠ‚ä¼šä»‹ç»ã€‚ JSON å‘½ä»¤ JSON å‘½ä»¤ æ±‡æ€» åˆ†ç±» å‘½ä»¤ åŸºç¡€è¯»å†™ SET / MSET / GET / MGET æ•°ç»„æ“ä½œ ARRAPPEND / ARRINSERT / ARRPOP / ARRLEN / ARRINDEX / ARRTRIM å¯¹è±¡æ“ä½œ OBJKEYS / OBJLEN / TYPE æ•°å€¼è¿ç®— NUMINCRBY / NUMMULTBY / TOGGLE å­—ç¬¦ä¸² STRAPPEND / STRLEN åˆ é™¤æ¸…ç©º DEL / FORGET / CLEAR åˆå¹¶è¾“å‡º MERGE / RESP è°ƒè¯•è¯Šæ–­ DEBUG / DEBUG MEMORY ä¸€ã€åŸºç¡€è¯»å†™ç±»ï¼ˆCRUDï¼‰ å‘½ä»¤ ä½œç”¨ å…³é”®å‚æ•°è¯´æ˜ ç¤ºä¾‹ JSON.SET è®¾ç½®æˆ–æ›´æ–°æŸä¸ª path çš„å€¼ keyï¼šé”®åpathï¼šJSONPathï¼ˆå¦‚ $ã€$.a.bï¼‰valueï¼šJSON å€¼ JSON.SET user:1 $ '&#123;&quot;name&quot;:&quot;Tom&quot;,&quot;age&quot;:18&#125;' JSON.MSET æ‰¹é‡è®¾ç½®å¤šä¸ª key (key path value)... JSON.MSET k1 $ '&#123;&quot;a&quot;:1&#125;' k2 $.b 2 JSON.GET è·å–ä¸€ä¸ª key çš„ JSON å€¼ keypath...ï¼šå¯å¤šä¸ª JSON.GET user:1 $.name $.age JSON.MGET ä»å¤šä¸ª key è·å–åŒä¸€è·¯å¾„ key... path JSON.MGET k1 k2 $.a è¯´æ˜ï¼š JSON.GET è¿”å› å­—ç¬¦ä¸²åŒ– JSON JSON.MGET è¿”å›æ•°ç»„ï¼Œå¯¹åº”å¤šä¸ª key äºŒã€æ•°ç»„æ“ä½œç±»ï¼ˆArrayï¼‰ å‘½ä»¤ ä½œç”¨ å‚æ•°å«ä¹‰ ç¤ºä¾‹ JSON.ARRAPPEND å‘æ•°ç»„æœ«å°¾è¿½åŠ å…ƒç´  key path value... JSON.ARRAPPEND k $.tags &quot;redis&quot; &quot;json&quot; JSON.ARRINSERT åœ¨æŒ‡å®šç´¢å¼•æ’å…¥å…ƒç´  key path index value... JSON.ARRINSERT k $.tags 1 &quot;nosql&quot; JSON.ARRPOP åˆ é™¤å¹¶è¿”å›æŒ‡å®šç´¢å¼•å…ƒç´  key path [index] JSON.ARRPOP k $.tags -1 JSON.ARRLEN è·å–æ•°ç»„é•¿åº¦ key path JSON.ARRLEN k $.tags JSON.ARRINDEX æŸ¥æ‰¾å…ƒç´ ç´¢å¼• key path value JSON.ARRINDEX k $.tags &quot;redis&quot; JSON.ARRTRIM æˆªå–æ•°ç»„åŒºé—´ key path start stop JSON.ARRTRIM k $.scores 0 9 è¯´æ˜ï¼š ç´¢å¼•æ”¯æŒè´Ÿæ•°ï¼ˆ-1 è¡¨ç¤ºæœ€åä¸€ä¸ªï¼‰ ARRTRIM ç±»ä¼¼ LTRIM ä¸‰ã€å¯¹è±¡æ“ä½œç±»ï¼ˆObjectï¼‰ å‘½ä»¤ ä½œç”¨ å‚æ•°è¯´æ˜ ç¤ºä¾‹ JSON.OBJKEYS è·å–å¯¹è±¡çš„æ‰€æœ‰ key key path JSON.OBJKEYS k $.user JSON.OBJLEN è·å–å¯¹è±¡å­—æ®µæ•°é‡ key path JSON.OBJLEN k $.user JSON.TYPE è¿”å› path å¯¹åº”å€¼ç±»å‹ key path JSON.TYPE k $.user.name JSON.TYPE è¿”å›ç±»å‹åŒ…æ‹¬ï¼šobject / array / string / number / boolean / null å››ã€æ•°å€¼è¿ç®—ç±»ï¼ˆNumericï¼‰ å‘½ä»¤ ä½œç”¨ å‚æ•°è¯´æ˜ ç¤ºä¾‹ JSON.NUMINCRBY æ•°å€¼è‡ªå¢ key path number JSON.NUMINCRBY k $.count 1 JSON.NUMMULTBY æ•°å€¼ä¹˜æ³• key path number JSON.NUMMULTBY k $.price 0.8 JSON.TOGGLE å¸ƒå°”å€¼å–å key path JSON.TOGGLE k $.enabled è¯´æ˜ï¼š ä¿è¯ åŸå­æ€§ å¸¸ç”¨äºè®¡æ•°ã€å¼€å…³çŠ¶æ€ äº”ã€å­—ç¬¦ä¸²æ“ä½œç±»ï¼ˆStringï¼‰ å‘½ä»¤ ä½œç”¨ å‚æ•°è¯´æ˜ ç¤ºä¾‹ JSON.STRAPPEND è¿½åŠ å­—ç¬¦ä¸² key path value JSON.STRAPPEND k $.msg &quot; world&quot; JSON.STRLEN å­—ç¬¦ä¸²é•¿åº¦ key path JSON.STRLEN k $.msg å…­ã€åˆ é™¤ / æ¸…ç©ºç±» å‘½ä»¤ ä½œç”¨ å‚æ•°è¯´æ˜ ç¤ºä¾‹ JSON.DEL åˆ é™¤æŒ‡å®š path key path JSON.DEL k $.user.age JSON.FORGET ç­‰ä»· JSON.DEL åŒä¸Š JSON.FORGET k $.tmp JSON.CLEAR æ¸…ç©ºå€¼ key path JSON.CLEAR k $.list JSON.CLEAR è¡Œä¸ºè¯´æ˜ï¼š æ•°ç»„ â†’ [] å¯¹è±¡ â†’ {} æ•°å€¼ â†’ 0 ä¸ƒã€åˆå¹¶ä¸é«˜çº§æ“ä½œ å‘½ä»¤ ä½œç”¨ å‚æ•°è¯´æ˜ ç¤ºä¾‹ JSON.MERGE åˆå¹¶ JSONï¼ˆRFC7396ï¼‰ key path value JSON.MERGE k $ '&#123;&quot;a&quot;:2,&quot;b&quot;:3&#125;' JSON.RESP RESP æ ¼å¼è¿”å› key path JSON.RESP k $.user è¯´æ˜ï¼š MERGE æ”¯æŒå­—æ®µè¦†ç›–ã€åˆ é™¤ã€æ‰©å±• RESP é€‚åˆå®¢æˆ·ç«¯ç›´æ¥è§£æ å…«ã€è°ƒè¯•ä¸è¯Šæ–­ç±»ï¼ˆDebugï¼‰ å‘½ä»¤ ä½œç”¨ å‚æ•°è¯´æ˜ ç¤ºä¾‹ JSON.DEBUG è°ƒè¯•å‘½ä»¤å®¹å™¨ å­å‘½ä»¤ JSON.DEBUG MEMORY k JSON.DEBUG MEMORY æŸ¥çœ‹ JSON å ç”¨å†…å­˜ key JSON.DEBUG MEMORY user:1 åº”ç”¨ç¤ºä¾‹ åœºæ™¯é€‰ç”¨ï¼šç”µå•†ç”¨æˆ·ç”»åƒ + è®¢å•ç³»ç»Ÿï¼ˆç»“æ„å¤æ‚ã€å­—æ®µå¤šã€éå¸¸é€‚åˆ JSONPathï¼‰ 1234567æˆ‘ä»¬è¦å­˜å‚¨ä¸€ä¸ªç”¨æˆ·çš„å®Œæ•´ç”»åƒï¼š åŸºæœ¬ä¿¡æ¯ åœ°å€åˆ—è¡¨ è®¢å•åˆ—è¡¨ï¼ˆåŒ…å«å•†å“ã€ä»·æ ¼ã€æ•°é‡ï¼‰ æ ‡ç­¾(åå¥½) è´¦æˆ·çŠ¶æ€ ç»Ÿè®¡ä¿¡æ¯ SpringBootæš‚æ—¶æ²¡æœ‰æ”¯æŒRedisJSONï¼Œä½ å¯ä»¥ç¼–å†™Luaè„šæœ¬æ¥å®ç°ç›¸åº”çš„åŠŸèƒ½ï¼Œå¦å¤– Redissonå·²ç»æä¾›äº†å¯¹JSONçš„æ”¯æŒï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å‘ç°è¿˜æœ‰ä¸€äº›Bugï¼Œä¸‹é¢ç»“åˆå‘½ä»¤ç»™å‡ºä»£ç ç¤ºä¾‹ã€‚ 123456&lt;!-- å¼•å…¥ Redisson ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œç°åœ¨æœ€æ–°ç‰ˆæ˜¯ 4.0.0ï¼Œéœ€è¦ springboot 4.x --&gt;&lt;dependency&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.52.0&lt;/version&gt;&lt;/dependency&gt; åˆ›å»ºå®Œæ•´ JSON æ–‡æ¡£ï¼ˆJSON.SETï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# åˆ›å»º JSON æ–‡æ¡£ï¼Œå®é™…æ‰§è¡Œä¸­ä¸æ”¯æŒå¤šè¡Œï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†çœ‹ç€æ¸…æ¥šäº›ï¼Œå®é™…è¿è¡Œæ—¶è¦å°†å…¶æ”¹æˆä¸€è¡ŒJSON.SET user:10001 $ &#x27;&#123; &quot;profile&quot;: &#123; &quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 28, &quot;vip&quot;: true &#125;, &quot;tags&quot;: [&quot;vip&quot;, &quot;electronics&quot;, &quot;promotion&quot;], &quot;addresses&quot;: [ &#123; &quot;city&quot;: &quot;Beijing&quot;, &quot;zip&quot;: &quot;100000&quot; &#125;, &#123; &quot;city&quot;: &quot;Shanghai&quot;, &quot;zip&quot;: &quot;200000&quot; &#125; ], &quot;orders&quot;: [ &#123; &quot;orderId&quot;: &quot;O1001&quot;, &quot;amount&quot;: 199.99, &quot;status&quot;: &quot;PAID&quot;, &quot;items&quot;: [ &#123; &quot;sku&quot;: &quot;SKU-1&quot;, &quot;price&quot;: 99.99, &quot;qty&quot;: 1 &#125;, &#123; &quot;sku&quot;: &quot;SKU-2&quot;, &quot;price&quot;: 100.00, &quot;qty&quot;: 1 &#125; ] &#125;, &#123; &quot;orderId&quot;: &quot;O1002&quot;, &quot;amount&quot;: 59.90, &quot;status&quot;: &quot;CREATED&quot;, &quot;items&quot;: [ &#123; &quot;sku&quot;: &quot;SKU-3&quot;, &quot;price&quot;: 59.90, &quot;qty&quot;: 1 &#125; ] &#125; ], &quot;stats&quot;: &#123; &quot;loginCount&quot;: 10, &quot;balance&quot;: 300.5 &#125;&#125;&#x27;# ä¹Ÿå¯ä»¥ä½¿ç”¨å•è¡Œæ¨¡å¼ä¸€ç‚¹ç‚¹ç»„è£…JSON.SET user:10001 $ &#x27;&#123;&#125;&#x27;JSON.SET user:10001 $.profile &#x27;&#123;&quot;name&quot;:&quot;Alice&quot;,&quot;age&quot;:28,&quot;vip&quot;:true&#125;&#x27;JSON.SET user:10001 $.tags &#x27;[&quot;vip&quot;,&quot;electronics&quot;,&quot;promotion&quot;]&#x27;JSON.SET user:10001 $.addresses &#x27;[&#123;&quot;city&quot;:&quot;Beijing&quot;,&quot;zip&quot;:&quot;100000&quot;&#125;,&#123;&quot;city&quot;:&quot;Shanghai&quot;,&quot;zip&quot;:&quot;200000&quot;&#125;]&#x27;JSON.SET user:10001 $.orders &#x27;[&#123;&quot;orderId&quot;:&quot;O1001&quot;,&quot;amount&quot;:199.99,&quot;status&quot;:&quot;PAID&quot;,&quot;items&quot;:[&#123;&quot;sku&quot;:&quot;SKU-1&quot;,&quot;price&quot;:99.99,&quot;qty&quot;:1&#125;,&#123;&quot;sku&quot;:&quot;SKU-2&quot;,&quot;price&quot;:100,&quot;qty&quot;:1&#125;]&#125;,&#123;&quot;orderId&quot;:&quot;O1002&quot;,&quot;amount&quot;:59.90,&quot;status&quot;:&quot;CREATED&quot;,&quot;items&quot;:[&#123;&quot;sku&quot;:&quot;SKU-3&quot;,&quot;price&quot;:59.90,&quot;qty&quot;:1&#125;]&#125;]&#x27;JSON.SET user:10001 $.stats &#x27;&#123;&quot;loginCount&quot;:10,&quot;balance&quot;:300.5&#125;&#x27;# æŸ¥çœ‹ç±»å‹127.0.0.1:6379&gt; type user:10001ReJSON-RL é€šç”¨ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142@Autowiredprivate RedissonClient redissonClient;String userStr = &quot;&quot;&quot; &#123; &quot;profile&quot;: &#123; &quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 28, &quot;vip&quot;: true &#125;, &quot;tags&quot;: [&quot;vip&quot;, &quot;electronics&quot;, &quot;promotion&quot;], &quot;addresses&quot;: [ &#123; &quot;city&quot;: &quot;Beijing&quot;, &quot;zip&quot;: &quot;100000&quot; &#125;, &#123; &quot;city&quot;: &quot;Shanghai&quot;, &quot;zip&quot;: &quot;200000&quot; &#125; ], &quot;orders&quot;: [ &#123; &quot;orderId&quot;: &quot;O1001&quot;, &quot;amount&quot;: 199.99, &quot;status&quot;: &quot;PAID&quot;, &quot;items&quot;: [ &#123; &quot;sku&quot;: &quot;SKU-1&quot;, &quot;price&quot;: 99.99, &quot;qty&quot;: 1 &#125;, &#123; &quot;sku&quot;: &quot;SKU-2&quot;, &quot;price&quot;: 100.00, &quot;qty&quot;: 1 &#125; ] &#125;, &#123; &quot;orderId&quot;: &quot;O1002&quot;, &quot;amount&quot;: 59.90, &quot;status&quot;: &quot;CREATED&quot;, &quot;items&quot;: [ &#123; &quot;sku&quot;: &quot;SKU-3&quot;, &quot;price&quot;: 59.90, &quot;qty&quot;: 1 &#125; ] &#125; ], &quot;stats&quot;: &#123; &quot;loginCount&quot;: 10, &quot;balance&quot;: 300.5 &#125; &#125; &quot;&quot;&quot;;ObjectMapper objectMapper = new ObjectMapper();RJsonBucket&lt;User&gt; bucket = redissonClient.getJsonBucket(&quot;user:10001&quot;, new JacksonCodec&lt;&gt;(User.class)); 12User user = objectMapper.readValue(userStr, User.class);bucket.set(user); JSONPath æŸ¥è¯¢ç¤ºä¾‹ 1ï¸âƒ£ åŸºç¡€è·¯å¾„è®¿é—® 12345678910# è·å–å…¨éƒ¨æ•°æ®127.0.0.1:6379&gt; JSON.GET user:10001# è·å–ç”¨æˆ·ä¿¡æ¯127.0.0.1:6379&gt; JSON.GET user:10001 $.profile&quot;[&#123;\\&quot;name\\&quot;:\\&quot;Alice\\&quot;,\\&quot;age\\&quot;:28,\\&quot;vip\\&quot;:true&#125;]&quot;# è·å–ç”¨æˆ·å127.0.0.1:6379&gt; JSON.GET user:10001 $.profile.name&quot;[\\&quot;Alice\\&quot;]&quot; 123456789User user = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;User&gt;() &#123;&#125;));User.ProfileBean profile = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;User.ProfileBean&gt;() &#123;&#125;),&quot;profile&quot;);String name = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;String&gt;() &#123;&#125;),&quot;profile.name&quot;);// åŠ ä¸Š $. å‰ç¼€ï¼Œè¿”å›å€¼å¿…é¡»æ˜¯ List&lt;T&gt;List&lt;String&gt; names = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;List&lt;String&gt;&gt;() &#123;&#125;),&quot;$.profile.name&quot;);System.out.println(names.get(0)); 2ï¸âƒ£ æ•°ç»„è®¿é—® &amp; é€šé…ç¬¦ 1234567# è·å–æ‰€æœ‰è®¢å•ID127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[*].orderId&quot;[\\&quot;O1001\\&quot;,\\&quot;O1002\\&quot;]&quot;# è·å–æ‰€æœ‰åœ°å€çš„åŸå¸‚127.0.0.1:6379&gt; JSON.GET user:10001 $.addresses[*].city&quot;[\\&quot;Beijing\\&quot;,\\&quot;Shanghai\\&quot;]&quot; 123List&lt;String&gt; orderIds = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;List&lt;String&gt;&gt;() &#123;&#125;),&quot;$.orders[*].orderId&quot;);List&lt;String&gt; citys = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;List&lt;String&gt;&gt;() &#123;&#125;),&quot;$.addresses[*].city&quot;); 3ï¸âƒ£ æ•°ç»„ä¸‹æ ‡ä¸åˆ‡ç‰‡ 1234567891011# è·å–ç¬¬ä¸€ä¸ªè®¢å•127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[0]&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot;# è·å–ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªè®¢å•ï¼Œåˆ‡ç‰‡é€»è¾‘æ˜¯ [start:end]ï¼Œ start &lt;= x &lt; end ï¼Œendä¸å†™é»˜è®¤ä¸ºæ•°ç»„æœ«å°¾127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[0:2]&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;,&#123;\\&quot;orderId\\&quot;:\\&quot;O1002\\&quot;,\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-3\\&quot;,\\&quot;price\\&quot;:59.9,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot;# è·å–æ‰€æœ‰è®¢å•ï¼Œè¿™é‡Œç­‰åŒäº $.orders[*]127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[:]&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;,&#123;\\&quot;orderId\\&quot;:\\&quot;O1002\\&quot;,\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-3\\&quot;,\\&quot;price\\&quot;:59.9,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot; 12345List&lt;OrdersBean&gt; orders = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),&quot;$.orders[0]&quot;);orders = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),&quot;$.orders[0:2]&quot;);orders = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),&quot;$.orders[:]&quot;); 4ï¸âƒ£ é€’å½’æŸ¥è¯¢ï¼ˆâ€¦ï¼‰ 123# ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰å•†å“ä»·æ ¼ï¼ˆä¸ç®¡åœ¨å“ªä¸€å±‚ï¼‰127.0.0.1:6379&gt; JSON.GET user:10001 $..price&quot;[99.99,100,59.9]&quot; 1List&lt;Double&gt; prices = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;List&lt;Double&gt;&gt;() &#123;&#125;),&quot;$..price&quot;); 5ï¸âƒ£ æ¡ä»¶è¿‡æ»¤ï¼ˆJSONPath æ ¸å¿ƒèƒ½åŠ›ï¼‰ âœ… æ”¯æŒçš„æŸ¥è¯¢ 1234567891011# ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•é‡‘é¢å¤§äº100çš„è®¢å•ï¼Œâœ… æ•°å­—æ¯”è¾ƒ127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.amount&gt;100)]&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot;# ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•ä¸­ç¬¬ä¸€ä¸ªå•†å“ä»·æ ¼å¤§äº50çš„è®¢å•ï¼Œâœ… æ•°ç»„æ¡ä»¶127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.items[0].price&gt;50)]&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;,&#123;\\&quot;orderId\\&quot;:\\&quot;O1002\\&quot;,\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-3\\&quot;,\\&quot;price\\&quot;:59.9,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot;# ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•é‡‘é¢å¤§äº100å¹¶ä¸”è®¢å•ä¸­ç¬¬ä¸€ä¸ªå•†å“ä»·æ ¼å¤§äº50çš„è®¢å•ï¼Œâœ… é€»è¾‘è¿ç®—ç¬¦127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.amount&gt;100)&amp;&amp;(@.items[0].price&gt;50)]&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1001\\&quot;,\\&quot;amount\\&quot;:199.99,\\&quot;status\\&quot;:\\&quot;PAID\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-1\\&quot;,\\&quot;price\\&quot;:99.99,\\&quot;qty\\&quot;:1&#125;,&#123;\\&quot;sku\\&quot;:\\&quot;SKU-2\\&quot;,\\&quot;price\\&quot;:100,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot; 12345List&lt;OrdersBean&gt; orders = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),&quot;$.orders[?(@.amount&gt;100)]&quot;);orders = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),&quot;$.orders[?(@.items[0].price&gt;50)]&quot;);orders = bucket.get(new JacksonCodec&lt;&gt;(new TypeReference&lt;List&lt;OrdersBean&gt;&gt;() &#123;&#125;),&quot;$.orders[?(@.amount&gt;100)&amp;&amp;(@.items[0].price&gt;50)]&quot;); âŒ ä¸æ”¯æŒçš„æŸ¥è¯¢ 12345678# ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰å·²æ”¯ä»˜è®¢å•ï¼ŒâŒ ä¸æ”¯æŒå­—ç¬¦ä¸²çš„æ¯”è¾ƒJSON.GET user:10001 $.orders[?(@.status==&quot;PAID&quot;)]# ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰å·²æ”¯ä»˜è®¢å•ï¼ŒâŒ ä¸æ”¯æŒæ­£åˆ™åŒ¹é…JSON.GET user:10001 $.orders[?(@.status=~&quot;PAID&quot;)]# ğŸ‘‰ æ‰¾å‡ºæ‰€æœ‰è®¢å•ä¸­å•†å“ä»·æ ¼å¤§äº50çš„è®¢å•ï¼Œè¿™ä¸ªå°±ä¸å‡†ï¼ŒâŒ ä¸æ”¯æŒåµŒå¥—æ•°ç»„æ¡ä»¶ï¼ˆ@.items[*].xxxï¼‰127.0.0.1:6379&gt; JSON.GET user:10001 $.orders[?(@.items[*].price&gt;50)]&quot;[&#123;\\&quot;orderId\\&quot;:\\&quot;O1002\\&quot;,\\&quot;amount\\&quot;:59.9,\\&quot;status\\&quot;:\\&quot;CREATED\\&quot;,\\&quot;items\\&quot;:[&#123;\\&quot;sku\\&quot;:\\&quot;SKU-3\\&quot;,\\&quot;price\\&quot;:59.9,\\&quot;qty\\&quot;:1&#125;]&#125;]&quot; 6ï¸âƒ£ ä¿®æ”¹æ•°æ®ï¼ˆJSON.SET / JSON.NUMINCRBYï¼‰ 123456# ğŸ‘‰ ä¿®æ”¹ç”¨æˆ·å127.0.0.1:6379&gt; JSON.SET user:10001 $.profile.name &#x27;&quot;Alice Zhang&quot;&#x27;OK# ğŸ‘‰ ç”¨æˆ·ç™»å½•æ¬¡æ•° +1127.0.0.1:6379&gt; JSON.NUMINCRBY user:10001 $.stats.loginCount 1&quot;[11]&quot; # è¿”å›ä¿®æ”¹åçš„å€¼ 1234bucket.set(&quot;$.profile.name&quot;, &quot;Alice Zhang&quot;);// æ³¨æ„å¦‚ä¸‹æ–¹æ³•ä¼šå¢åŠ æˆåŠŸï¼Œä½†æ˜¯ä¼šæŠ›å¼‚å¸¸ï¼Œåº”è¯¥æ˜¯Redissonçš„bug// Caused by: java.lang.NumberFormatException: For input string: &quot;[11]&quot;bucket.incrementAndGet(&quot;$.stats.loginCount&quot;, 1); 7ï¸âƒ£ æ•°ç»„æ“ä½œï¼ˆARRAPPEND / ARRINSERTï¼‰ 1234567891011# ğŸ‘‰ æ·»åŠ ä¸€ä¸ªè®¢å•127.0.0.1:6379&gt; JSON.ARRAPPEND user:10001 $.orders &#x27;&#123;&quot;orderId&quot;: &quot;O1003&quot;,&quot;amount&quot;: 399,&quot;status&quot;: &quot;PAID&quot;,&quot;items&quot;: [&#123; &quot;sku&quot;: &quot;SKU-9&quot;, &quot;price&quot;: 399, &quot;qty&quot;: 1 &#125;]&#125;&#x27;1) (integer) 3 # è¿”å›æ·»åŠ åçš„é•¿åº¦# ğŸ‘‰ åœ¨ tags çš„æœ€åæ·»åŠ ä¸€ä¸ªæ ‡ç­¾127.0.0.1:6379&gt; JSON.ARRAPPEND user:10001 $.tags &#x27;&quot;newTag&quot;&#x27;1) (integer) 4 # æ·»åŠ åçš„é•¿åº¦# ğŸ‘‰ åœ¨ tags ä¸­çš„æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ªæ ‡ç­¾127.0.0.1:6379&gt; JSON.ARRINSERT user:10001 $.tags 1 &#x27;&quot;newTag2&quot;&#x27;1) (integer) 5 # æ’å…¥åçš„é•¿åº¦ 1234567891011121314151617OrdersBean ordersBean = OrdersBean.builder() .orderId(&quot;O1003&quot;) .amount(399) .status(&quot;CREATED&quot;) .items(List.of( OrdersBean.ItemsBean.builder() .sku(&quot;SKU-9&quot;) .qty(1) .price(399).build() )).build();// æ·»åŠ ä¸€ä¸ªè®¢å•ï¼Œè¿”å›æ·»åŠ åçš„é•¿åº¦long num = bucket.arrayAppend(&quot;$.orders&quot;, ordersBean);num = bucket.arrayAppend(&quot;$.tags&quot;, &quot;newTag&quot;);// æ’å…¥æˆåŠŸï¼Œä½†æ˜¯ä¼šæŠ›å¼‚å¸¸ï¼Œåº”è¯¥æ˜¯Redissonçš„bugnum = bucket.arrayInsert(&quot;$.tags&quot;, 1, &quot;newTag2&quot;); 8ï¸âƒ£ åˆ é™¤ &amp; æ¸…ç†æ“ä½œï¼ˆJSON.DEL &amp; JSON.CLEARï¼‰ 1234567# ğŸ‘‰ åˆ é™¤ç”¨æˆ·å¹´é¾„ï¼Œ$.profile.age ä¸å­˜åœ¨äº†127.0.0.1:6379&gt; JSON.DEL user:10001 $.profile.age(integer) 1 # åˆ é™¤æˆåŠŸï¼Œè¿”å›0ï¼Œè¡¨ç¤ºè·¯å¾„ä¸å­˜åœ¨# ğŸ‘‰ æ¸…ç©ºç”¨æˆ·æ‰€æœ‰æ ‡ç­¾ï¼Œ$.tags ä¿ç•™ï¼Œåªæ˜¯å˜æˆäº† [] ç©ºæ•°ç»„127.0.0.1:6379&gt; JSON.CLEAR user:10001 $.tags(integer) 1 # æ¸…ç©ºæˆåŠŸï¼Œè¿”å›0ï¼Œè¡¨ç¤ºè·¯å¾„ä¸å­˜åœ¨æˆ–å·²ç»æ¸…ç©º 123long delete = bucket.delete(&quot;$.profile.age&quot;);long clear = bucket.clear(&quot;$.tags&quot;); 9ï¸âƒ£ ç»Ÿè®¡æ•°ç»„é•¿åº¦ 123# ğŸ‘‰ ç»Ÿè®¡ç”¨æˆ·è®¢å•çš„é•¿åº¦127.0.0.1:6379&gt; JSON.ARRLEN user:10001 $.orders1) (integer) 3 12// ä¼šæŠ›å¼‚å¸¸ï¼Œåº”è¯¥æ˜¯Redissonçš„buglong length = bucket.arraySize(&quot;$.orders&quot;); ğŸ”Ÿ æŸ¥çœ‹ JSON å ç”¨å†…å­˜ 12127.0.0.1:6379&gt; JSON.DEBUG MEMORY user:10001(integer) 1896 # å ç”¨å†…å­˜å¤§å°ï¼Œå•ä½å­—èŠ‚ 1long sizeInMemory = bucket.sizeInMemory();","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisJSON ä¸­çš„ JSON æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisJSON çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub","date_published":"2025-12-24T13:40:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/24/redis7-module-RedisJSON/","url":"https://blog.hanqunfeng.com/2025/12/24/redis7-module-RedisJSON/","title":"Redis æ‰©å±•æ¨¡å— -- RedisJSON çš„å®‰è£…æ–¹æ³•","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisJSON çš„å®‰è£…æ–¹æ³•</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RedisJSON-ç®€ä»‹\">RedisJSON ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/RedisJSON/RedisJSON\">RedisJSON</a> æ˜¯ Redis å®˜æ–¹ç»´æŠ¤çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œéš¶å±äº <code>Redis Stack</code>ï¼Œä¸“é—¨ç”¨äºå¯¹JSONæ•°æ®è¿›è¡Œæ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯¥æ¨¡å—ä»¥ <code>Redis Module</code> æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Redis8+ï¼ŒRedisJSON å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å®‰è£…-RedisJSON\">å®‰è£… RedisJSON</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è™½ç„¶<a href=\"https://cloud.redis.io\">Redis Cloud</a>çš„<code>Download Center</code>ä¸­æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„<code>.so</code>æ–‡ä»¶ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚<br>\nå¯ä»¥åœ¨æµ·å¤–çš„<code>ç›¸åŒé…ç½®</code>çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„<code>rejson.so</code>ä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install -y \\</span><br><span class=\"line\">  gcc \\</span><br><span class=\"line\">  gcc-c++ \\</span><br><span class=\"line\">  make \\</span><br><span class=\"line\">  cmake \\</span><br><span class=\"line\">  autoconf \\</span><br><span class=\"line\">  automake \\</span><br><span class=\"line\">  libtool \\</span><br><span class=\"line\">  pkgconfig \\</span><br><span class=\"line\">  openssl-devel</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¯‘RedisJSON</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /usr/local/soft/modules/</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/soft/modules</span><br><span class=\"line\"><span class=\"comment\"># clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> --recursive https://github.com/RedisJSON/RedisJSON.git</span><br><span class=\"line\"><span class=\"built_in\">cd</span> RedisJSON</span><br><span class=\"line\"><span class=\"comment\"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class=\"line\">git checkout v2.8.16</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥</span></span><br><span class=\"line\">git submodule update --init --recursive</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥å¹¶å®‰è£…éœ€è¦çš„ä¾èµ–</span></span><br><span class=\"line\">./sbin/setup</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\"># readies version: 7fc8e62</span></span><br><span class=\"line\">dnf install -q -y ca-certificates</span><br><span class=\"line\">dnf install -q -y wget unzip</span><br><span class=\"line\">/usr/local/soft/modules/RedisJSON/deps/readies/bin/enable-utf8</span><br><span class=\"line\">dnf install -q -y git unzip rsync</span><br><span class=\"line\">/usr/local/soft/modules/RedisJSON/deps/readies/bin/getclang --modern</span><br><span class=\"line\">/usr/local/soft/modules/RedisJSON/deps/readies/bin/getrust</span><br><span class=\"line\">/usr/local/soft/modules/RedisJSON/deps/readies/bin/getcmake --usr</span><br><span class=\"line\">dnf install -q -y <span class=\"built_in\">which</span></span><br><span class=\"line\">/usr/local/soft/modules/RedisJSON/deps/readies/bin/getgcc --modern</span><br><span class=\"line\"><span class=\"built_in\">dir</span>=$(<span class=\"built_in\">mktemp</span> -d /tmp/tar.XXXXXX); (<span class=\"built_in\">cd</span> <span class=\"variable\">$dir</span>; wget --no-verbose -O tar.tgz http://redismodules.s3.amazonaws.com/readies/gnu/gnu-tar-1.32-x64-centos7.tgz; tar -xzf tar.tgz -C /; ); <span class=\"built_in\">rm</span> -rf <span class=\"variable\">$dir</span></span><br><span class=\"line\">dnf install -q -y lcov</span><br><span class=\"line\">/usr/bin/python3 /usr/local/soft/modules/RedisJSON/deps/readies/bin/getrmpytools --reinstall --modern</span><br><span class=\"line\">/usr/bin/python3 -m pip install --disable-pip-version-check --user  -r /usr/local/soft/modules/RedisJSON/tests/pytest/requirements.txt</span><br><span class=\"line\">/usr/local/soft/modules/RedisJSON/deps/readies/bin/getaws</span><br><span class=\"line\">NO_PY2=1 /usr/local/soft/modules/RedisJSON/deps/readies/bin/getpudb</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># RedisJSON çš„ç¼–è¯‘ä¾èµ– Rust å·¥å…·é“¾ï¼Œæ‰€ä»¥ç¼–è¯‘å‰éœ€è¦å®‰è£…rustï¼Œè‹¥å·²ç»å®‰è£…åˆ™å¿½ç•¥</span></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… rustup</span></span><br><span class=\"line\">curl --proto <span class=\"string\">&#x27;=https&#x27;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‰æç¤ºé€‰æ‹©é»˜è®¤å®‰è£…ï¼ˆé€šå¸¸é€‰æ‹© 1ï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®© Rust ç”Ÿæ•ˆ</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> <span class=\"variable\">$HOME</span>/.cargo/env</span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥ rust ç‰ˆæœ¬</span></span><br><span class=\"line\">rustc --version <span class=\"comment\"># rustc 1.92.0 (ded5c06cf 2025-12-08)</span></span><br><span class=\"line\">cargo --version <span class=\"comment\"># cargo 1.92.0 (344c4567c 2025-10-21)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘ RedisJSON</span></span><br><span class=\"line\">make</span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘è¿‡ç¨‹æœªæŠ¥é”™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œç¼–è¯‘åçš„æ–‡ä»¶ä½äº `bin/linux-x64-release/rejson.so`</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong><code>./sbin/setup</code> æŠ¥é”™</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æœ¬äººä½¿ç”¨çš„æ˜¯ Amazon Linux 2023(å†…æ ¸ 6.1)ï¼Œå³ <code>EL9</code>ï¼Œç±»ä¼¼äºCentOS 9ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œä¼šæŠ¥é”™ï¼Œå¤§è‡´æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./sbin/setup</span><br><span class=\"line\"><span class=\"comment\">## é”™è¯¯ä¿¡æ¯</span></span><br><span class=\"line\">â€¦â€¦</span><br><span class=\"line\">[FAILED] raven-release.el9.noarch.rpm: Status code: 403 <span class=\"keyword\">for</span> https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)</span><br><span class=\"line\">Status code: 403 <span class=\"keyword\">for</span> https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)</span><br><span class=\"line\"></span><br><span class=\"line\">In /usr/local/soft/modules/RedisJSON/deps/readies/bin/getepel:</span><br><span class=\"line\">346      \t\t<span class=\"comment\"># xinstall --allowerasing https://dl.fedoraproject.org/pub/epel/epel-release-latest-$&#123;EPEL&#125;.noarch.rpm</span></span><br><span class=\"line\">347      \t<span class=\"keyword\">fi</span></span><br><span class=\"line\">348</span><br><span class=\"line\">349  &gt;&gt;&gt; \tinstall_raven</span><br><span class=\"line\">350      \tinstall_remi</span><br><span class=\"line\">351      \t<span class=\"comment\"># install_centos_stream_repos</span></span><br><span class=\"line\">352</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">command</span> failed: /usr/local/soft/modules/RedisJSON/deps/readies/bin/getepel</span><br><span class=\"line\"><span class=\"built_in\">command</span> failed: /usr/local/soft/modules/RedisJSON/deps/readies/bin/getclang --modern</span><br><span class=\"line\"></span><br><span class=\"line\">In /usr/local/soft/modules/RedisJSON/sbin/setup:</span><br><span class=\"line\">18       \tpython3 -m pip list</span><br><span class=\"line\">19       <span class=\"keyword\">fi</span></span><br><span class=\"line\">20</span><br><span class=\"line\">21   &gt;&gt;&gt; <span class=\"variable\">$ROOT</span>/sbin/system-setup.py</span><br><span class=\"line\">22       <span class=\"keyword\">if</span> [[ <span class=\"variable\">$VERBOSE</span> == 1 ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">23       \tpython3 -m pip list</span><br><span class=\"line\">24       <span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>é”™è¯¯åˆ†æä¸è§£å†³æ–¹æ³•ï¼š</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">\n<p>è¿™é‡Œå®é™…ä¸Šæ˜¯ä¸¤ä¸ªé”™è¯¯ï¼Œç¬¬ä¸€ä¸ªé”™è¯¯ä¸å®‰è£… RedisBloom æ—¶ä¸€æ ·ï¼Œç¦ç”¨æ‰ <code>install_raven</code> å³å¯ï¼Œå…·ä½“å‚è§ <a href=\"/2025/12/21/redis7-module-RedisBloom/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a> è¿›è¡Œä¿®æ”¹ã€‚</p>\n</li>\n<li class=\"lvl-6\">\n<p>ç¬¬äºŒä¸ªé”™è¯¯è¿˜æ˜¯æ“ä½œç³»ç»Ÿçš„äº‹ï¼Œåœ¨ <code>deps/readies/bin/getclang</code>ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå…¶å®ä¸€çœ‹å°±æ˜ç™½äº†</p>\n</li>\n</ul>\n  <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">redhat_compat</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> <span class=\"variable language_\">self</span>.modern:</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    <span class=\"variable language_\">self</span>.run(<span class=\"string\">&quot;%s/bin/getepel&quot;</span> % READIES, sudo=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"variable language_\">self</span>.dist <span class=\"keyword\">in</span> [<span class=\"string\">&#x27;centos&#x27;</span>, <span class=\"string\">&#x27;ol&#x27;</span>] <span class=\"keyword\">and</span> <span class=\"variable language_\">self</span>.os_version[<span class=\"number\">0</span>] &gt;= <span class=\"number\">8</span>:</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.install(<span class=\"string\">&quot;clang&quot;</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.install(<span class=\"string\">&quot;llvm-toolset&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.install(<span class=\"string\">&quot;llvm-toolset-7.0&quot;</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.cp_to_profile_d(<span class=\"string\">&quot;/opt/rh/llvm-toolset-7.0/enable&quot;</span>, <span class=\"string\">&quot;llvm-toolset-7.0.sh&quot;</span>)</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä½¿ç”¨çš„æœºå™¨ä¸æ˜¯ centosï¼Œæ‰€ä»¥å°±èµ°<code>else</code>çš„é€»è¾‘äº†ï¼Œå¦å¤–è¿™é‡Œå³ä¾¿èµ°äº† centos é€»è¾‘ï¼Œä¹Ÿæœ‰é—®é¢˜ï¼Œå°±æ˜¯el9ä¸­å·²ç»æ²¡æœ‰ <code>llvm-toolset</code> äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ <code>llvm</code>ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹è¯¥æ–¹æ³•</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">ä¿®æ”¹æ–¹æ³•å¦‚ä¸‹ï¼š</li>\n</ul>\n  <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">redhat_compat</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> <span class=\"variable language_\">self</span>.modern:</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    <span class=\"variable language_\">self</span>.run(<span class=\"string\">&quot;%s/bin/getepel&quot;</span> % READIES, sudo=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"comment\"># å»æ‰åˆ¤æ–­ï¼Œç›´æ¥å®‰è£…ï¼Œå‰ææ˜¯ el9ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ä»€ä¹ˆéƒ½ä¸å†™ï¼Œè€Œæ˜¯é€šè¿‡å‘½ä»¤è¡Œå®‰è£…ï¼šdnf install -y clang llvm llvm-devel</span></span><br><span class=\"line\">    <span class=\"variable language_\">self</span>.install(<span class=\"string\">&quot;clang&quot;</span>)</span><br><span class=\"line\">    <span class=\"variable language_\">self</span>.install(<span class=\"string\">&quot;llvm&quot;</span>)</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</div>\n<h2 id=\"Redis-å¯ç”¨æ¨¡å—\">Redis å¯ç”¨æ¨¡å—</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†ç”Ÿæˆçš„ <code>rejson.so</code> æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> bin/linux-x64-release/rejson.so /usr/local/soft/redis-7.4.7/modules/rejson.so</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡é‡‡ç”¨ <code>loadmodule</code> åŠ è½½æ¨¡å—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°† rejson.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class=\"line\">loadmodule /usr/local/soft/redis-7.4.7/modules/rejson.so</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨redis</span></span><br><span class=\"line\">redis-server redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•æµ‹è¯•</span></span><br><span class=\"line\">redis-cli --user admin --pass 123456</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ¨¡å—</span></span><br><span class=\"line\">127.0.0.1:6379&gt; info Modules</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\"># Modules</span></span><br><span class=\"line\">module:name=ReJSON,ver=20816,api=1,filters=0,usedby=[],using=[],options=[handle-io-errors]</span><br><span class=\"line\">module:name=bf,ver=20817,api=1,filters=0,usedby=[],using=[],options=[handle-io-errors]</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; MODULE LIST</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;ReJSON&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 20816</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;bf&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 20817</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisJSON çš„å®‰è£…æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisJSON ç®€ä»‹ RedisJSON æ˜¯ Redis å®˜æ–¹ç»´æŠ¤çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œéš¶å±äº Redis Stackï¼Œä¸“é—¨ç”¨äºå¯¹JSONæ•°æ®è¿›è¡Œæ“ä½œã€‚ è¯¥æ¨¡å—ä»¥ Redis Module æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚ Redis8+ï¼ŒRedisJSON å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚ å®‰è£… RedisJSON è™½ç„¶Redis Cloudçš„Download Centerä¸­æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„.soæ–‡ä»¶ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚ å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚ å¯ä»¥åœ¨æµ·å¤–çš„ç›¸åŒé…ç½®çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„rejson.soä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚ å®‰è£…ä¾èµ– 12345678910sudo dnf install -y \\ gcc \\ gcc-c++ \\ make \\ cmake \\ autoconf \\ automake \\ libtool \\ pkgconfig \\ openssl-devel ç¼–è¯‘RedisJSON 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647mkdir -p /usr/local/soft/modules/cd /usr/local/soft/modules# clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—git clone --recursive https://github.com/RedisJSON/RedisJSON.gitcd RedisJSON# æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬git checkout v2.8.16# æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥git submodule update --init --recursive# æ£€æŸ¥å¹¶å®‰è£…éœ€è¦çš„ä¾èµ–./sbin/setup## è¾“å‡º# readies version: 7fc8e62dnf install -q -y ca-certificatesdnf install -q -y wget unzip/usr/local/soft/modules/RedisJSON/deps/readies/bin/enable-utf8dnf install -q -y git unzip rsync/usr/local/soft/modules/RedisJSON/deps/readies/bin/getclang --modern/usr/local/soft/modules/RedisJSON/deps/readies/bin/getrust/usr/local/soft/modules/RedisJSON/deps/readies/bin/getcmake --usrdnf install -q -y which/usr/local/soft/modules/RedisJSON/deps/readies/bin/getgcc --moderndir=$(mktemp -d /tmp/tar.XXXXXX); (cd $dir; wget --no-verbose -O tar.tgz http://redismodules.s3.amazonaws.com/readies/gnu/gnu-tar-1.32-x64-centos7.tgz; tar -xzf tar.tgz -C /; ); rm -rf $dirdnf install -q -y lcov/usr/bin/python3 /usr/local/soft/modules/RedisJSON/deps/readies/bin/getrmpytools --reinstall --modern/usr/bin/python3 -m pip install --disable-pip-version-check --user -r /usr/local/soft/modules/RedisJSON/tests/pytest/requirements.txt/usr/local/soft/modules/RedisJSON/deps/readies/bin/getawsNO_PY2=1 /usr/local/soft/modules/RedisJSON/deps/readies/bin/getpudb# RedisJSON çš„ç¼–è¯‘ä¾èµ– Rust å·¥å…·é“¾ï¼Œæ‰€ä»¥ç¼–è¯‘å‰éœ€è¦å®‰è£…rustï¼Œè‹¥å·²ç»å®‰è£…åˆ™å¿½ç•¥# å®‰è£… rustupcurl --proto &#x27;=https&#x27; --tlsv1.2 -sSf https://sh.rustup.rs | sh# æŒ‰æç¤ºé€‰æ‹©é»˜è®¤å®‰è£…ï¼ˆé€šå¸¸é€‰æ‹© 1ï¼‰# è®© Rust ç”Ÿæ•ˆsource $HOME/.cargo/env# æ£€æŸ¥ rust ç‰ˆæœ¬rustc --version # rustc 1.92.0 (ded5c06cf 2025-12-08)cargo --version # cargo 1.92.0 (344c4567c 2025-10-21)# ç¼–è¯‘ RedisJSONmake# ç¼–è¯‘è¿‡ç¨‹æœªæŠ¥é”™è¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œç¼–è¯‘åçš„æ–‡ä»¶ä½äº `bin/linux-x64-release/rejson.so` ./sbin/setup æŠ¥é”™ æœ¬äººä½¿ç”¨çš„æ˜¯ Amazon Linux 2023(å†…æ ¸ 6.1)ï¼Œå³ EL9ï¼Œç±»ä¼¼äºCentOS 9ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œä¼šæŠ¥é”™ï¼Œå¤§è‡´æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526./sbin/setup## é”™è¯¯ä¿¡æ¯â€¦â€¦[FAILED] raven-release.el9.noarch.rpm: Status code: 403 for https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)Status code: 403 for https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)In /usr/local/soft/modules/RedisJSON/deps/readies/bin/getepel:346 # xinstall --allowerasing https://dl.fedoraproject.org/pub/epel/epel-release-latest-$&#123;EPEL&#125;.noarch.rpm347 fi348349 &gt;&gt;&gt; install_raven350 install_remi351 # install_centos_stream_repos352command failed: /usr/local/soft/modules/RedisJSON/deps/readies/bin/getepelcommand failed: /usr/local/soft/modules/RedisJSON/deps/readies/bin/getclang --modernIn /usr/local/soft/modules/RedisJSON/sbin/setup:18 python3 -m pip list19 fi2021 &gt;&gt;&gt; $ROOT/sbin/system-setup.py22 if [[ $VERBOSE == 1 ]]; then23 python3 -m pip list24 fi é”™è¯¯åˆ†æä¸è§£å†³æ–¹æ³•ï¼š è¿™é‡Œå®é™…ä¸Šæ˜¯ä¸¤ä¸ªé”™è¯¯ï¼Œç¬¬ä¸€ä¸ªé”™è¯¯ä¸å®‰è£… RedisBloom æ—¶ä¸€æ ·ï¼Œç¦ç”¨æ‰ install_raven å³å¯ï¼Œå…·ä½“å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³• è¿›è¡Œä¿®æ”¹ã€‚ ç¬¬äºŒä¸ªé”™è¯¯è¿˜æ˜¯æ“ä½œç³»ç»Ÿçš„äº‹ï¼Œåœ¨ deps/readies/bin/getclangä¸­æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå…¶å®ä¸€çœ‹å°±æ˜ç™½äº† 12345678910def redhat_compat(self): if not self.modern: return self.run(&quot;%s/bin/getepel&quot; % READIES, sudo=True) if self.dist in [&#x27;centos&#x27;, &#x27;ol&#x27;] and self.os_version[0] &gt;= 8: self.install(&quot;clang&quot;) self.install(&quot;llvm-toolset&quot;) else: self.install(&quot;llvm-toolset-7.0&quot;) self.cp_to_profile_d(&quot;/opt/rh/llvm-toolset-7.0/enable&quot;, &quot;llvm-toolset-7.0.sh&quot;) æˆ‘ä½¿ç”¨çš„æœºå™¨ä¸æ˜¯ centosï¼Œæ‰€ä»¥å°±èµ°elseçš„é€»è¾‘äº†ï¼Œå¦å¤–è¿™é‡Œå³ä¾¿èµ°äº† centos é€»è¾‘ï¼Œä¹Ÿæœ‰é—®é¢˜ï¼Œå°±æ˜¯el9ä¸­å·²ç»æ²¡æœ‰ llvm-toolset äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ llvmï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹è¯¥æ–¹æ³• ä¿®æ”¹æ–¹æ³•å¦‚ä¸‹ï¼š 1234567def redhat_compat(self): if not self.modern: return self.run(&quot;%s/bin/getepel&quot; % READIES, sudo=True) # å»æ‰åˆ¤æ–­ï¼Œç›´æ¥å®‰è£…ï¼Œå‰ææ˜¯ el9ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ä»€ä¹ˆéƒ½ä¸å†™ï¼Œè€Œæ˜¯é€šè¿‡å‘½ä»¤è¡Œå®‰è£…ï¼šdnf install -y clang llvm llvm-devel self.install(&quot;clang&quot;) self.install(&quot;llvm&quot;) Redis å¯ç”¨æ¨¡å— å°†ç”Ÿæˆçš„ rejson.so æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º 12# æ³¨æ„ .so æ–‡ä»¶éœ€è¦åŒ…å«å¯æ‰§è¡Œæƒé™cp bin/linux-x64-release/rejson.so /usr/local/soft/redis-7.4.7/modules/rejson.so æœ¬æ–‡é‡‡ç”¨ loadmodule åŠ è½½æ¨¡å— 12345678910111213141516171819202122232425262728293031323334# å°† rejson.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redisloadmodule /usr/local/soft/redis-7.4.7/modules/rejson.so# å¯åŠ¨redisredis-server redis.conf# ç™»å½•æµ‹è¯•redis-cli --user admin --pass 123456# æŸ¥çœ‹æ¨¡å—127.0.0.1:6379&gt; info Modules## è¾“å‡º# Modulesmodule:name=ReJSON,ver=20816,api=1,filters=0,usedby=[],using=[],options=[handle-io-errors]module:name=bf,ver=20817,api=1,filters=0,usedby=[],using=[],options=[handle-io-errors]127.0.0.1:6379&gt; MODULE LIST# è¾“å‡º1) 1) &quot;name&quot; 2) &quot;ReJSON&quot; 3) &quot;ver&quot; 4) (integer) 20816 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/rejson.so&quot; 7) &quot;args&quot; 8) (empty array)2) 1) &quot;name&quot; 2) &quot;bf&quot; 3) &quot;ver&quot; 4) (integer) 20817 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot; 7) &quot;args&quot; 8) (empty array)","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisJSON çš„å®‰è£…æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/","date_published":"2025-12-24T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-15-TDigest/","url":"https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-15-TDigest/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TDigest","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ TDigest æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\">RedisBloom çš„å®‰è£…å‚è§ <a href=\"/2025/12/21/redis7-module-RedisBloom/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"T-Digest-åˆ†ä½æ•°ä¼°è®¡ç®—æ³•\">T-Digest(åˆ†ä½æ•°ä¼°è®¡ç®—æ³•)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>T-Digestï¼ˆTDigestï¼‰è§£å†³çš„é—®é¢˜ä¸ CMSã€TopK å®Œå…¨ä¸åŒï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ åˆ†ä½æ•°ï¼ˆquantileï¼‰ç»Ÿè®¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>T-Digest ç”± Ted Dunning æå‡ºï¼Œä¸“é—¨ä¸º <code>é«˜ç²¾åº¦å°¾éƒ¨åˆ†ä½æ•°</code> è®¾è®¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>TDigest å¯ä»¥åœ¨æä½å†…å­˜å ç”¨ä¸‹ï¼Œè¿‘ä¼¼è®¡ç®—åˆ†ä½æ•°ï¼ˆP50 / P90 / P99 / Median ç­‰ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ†ä½æ•°ï¼ˆPercentileï¼‰æŒ‡æ ‡å¯¹ç…§è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æŒ‡æ ‡</th>\n<th>è‹±æ–‡å…¨ç§°</th>\n<th>æ•°å­¦å«ä¹‰</th>\n<th>é€šä¿—è§£é‡Š</th>\n<th>å…¸å‹ä¸šåŠ¡è§£è¯»</th>\n<th>å¸¸è§ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Median</td>\n<td>Median</td>\n<td>æ’åºåä½äºä¸­é—´ä½ç½®çš„å€¼</td>\n<td>ä¸€åŠæ•°æ®åœ¨å®ƒå·¦å³</td>\n<td>â€œä¸€èˆ¬ç”¨æˆ·çš„ä½“éªŒâ€</td>\n<td>åŸºç¡€ä½“éªŒè¯„ä¼°</td>\n</tr>\n<tr>\n<td>P50</td>\n<td>50th Percentile</td>\n<td>50% çš„æ•°æ® â‰¤ è¯¥å€¼</td>\n<td>å’Œ Median å®Œå…¨ç›¸åŒ</td>\n<td>â€œå…¸å‹è¯·æ±‚è€—æ—¶â€</td>\n<td>å¸¸è§„æ€§èƒ½ç›‘æ§</td>\n</tr>\n<tr>\n<td>P90</td>\n<td>90th Percentile</td>\n<td>90% çš„æ•°æ® â‰¤ è¯¥å€¼</td>\n<td>10% çš„è¯·æ±‚æ›´æ…¢</td>\n<td>â€œå¤§å¤šæ•°ç”¨æˆ·çš„ä½“éªŒâ€</td>\n<td>ä¸šåŠ¡ä½“éªŒç›‘æ§</td>\n</tr>\n<tr>\n<td>P95</td>\n<td>95th Percentile</td>\n<td>95% çš„æ•°æ® â‰¤ è¯¥å€¼</td>\n<td>5% çš„è¯·æ±‚æ›´æ…¢</td>\n<td>â€œå°¾éƒ¨å¼€å§‹æ¶åŒ–â€</td>\n<td>SLA è¾¹ç•Œç›‘æ§</td>\n</tr>\n<tr>\n<td>P99</td>\n<td>99th Percentile</td>\n<td>99% çš„æ•°æ® â‰¤ è¯¥å€¼</td>\n<td>1% çš„è¯·æ±‚æœ€æ…¢</td>\n<td>â€œæç«¯ä½†çœŸå®çš„ç”¨æˆ·ä½“éªŒâ€</td>\n<td>æ ¸å¿ƒ SLA / SLO</td>\n</tr>\n<tr>\n<td>P99.9</td>\n<td>99.9th Percentile</td>\n<td>99.9% çš„æ•°æ® â‰¤ è¯¥å€¼</td>\n<td>åƒåˆ†ä¹‹ä¸€æœ€æ…¢è¯·æ±‚</td>\n<td>â€œæç«¯å°¾å»¶è¿Ÿâ€</td>\n<td>é‡‘è / æ ¸å¿ƒé“¾è·¯</td>\n</tr>\n<tr>\n<td>Max</td>\n<td>Maximum</td>\n<td>æ•°æ®ä¸­çš„æœ€å¤§å€¼</td>\n<td>æœ€æ…¢çš„é‚£ä¸€æ¬¡</td>\n<td>å™ªéŸ³æå¤§</td>\n<td>å‡ ä¹ä¸ç”¨</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ä¸€ä¸ªå¿«é€Ÿç†è§£ç¤ºä¾‹</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å‡è®¾ 100 æ¬¡è¯·æ±‚ï¼š</span><br><span class=\"line\">    99 æ¬¡è€—æ—¶ï¼š10 ms</span><br><span class=\"line\">    1 æ¬¡è€—æ—¶ï¼š3000 ms</span><br><span class=\"line\"></span><br><span class=\"line\">æ‰€ä»¥ï¼š</span><br><span class=\"line\">    P99 = 3000 ms</span><br><span class=\"line\">    P90 = 10 ms</span><br><span class=\"line\">    P50/Median = 10 ms</span><br><span class=\"line\">    å¹³å‡å€¼ = ï¼ˆ99*10 + 1*3000ï¼‰/ 100 = 39.9 ms</span><br><span class=\"line\"></span><br><span class=\"line\">ğŸ‘‰ åªæœ‰ P99 çœŸå®æš´éœ²äº†é—®é¢˜ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å·¥ç¨‹å®è·µä¸­çš„â€œæ ‡å‡†æ­é…â€</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åº”ç”¨åœºæ™¯</th>\n<th>å¸¸çœ‹æŒ‡æ ‡</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Web / API æœåŠ¡</td>\n<td>P90 / P99</td>\n</tr>\n<tr>\n<td>å¾®æœåŠ¡é“¾è·¯</td>\n<td>P99 / P99.9</td>\n</tr>\n<tr>\n<td>æ•°æ®åº“ / å­˜å‚¨</td>\n<td>P95 / P99</td>\n</tr>\n<tr>\n<td>å‰ç«¯ä½“éªŒ</td>\n<td>P50 / P90</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€å¥è¯ï¼šTDigest ç”¨äºç»Ÿè®¡æ•°å­—çš„åˆ†å¸ƒï¼ŒP50 çœ‹ä¸­é—´ï¼ŒP90 çœ‹å¤§å¤šæ•°ï¼ŒP99 çœ‹æœ€å·®é‚£ 1%</p>\n</li>\n</ul>\n<h2 id=\"RedisBloom-ä¸­-TDigest-çš„æ ¸å¿ƒå‘½ä»¤\">RedisBloom ä¸­ TDigest çš„æ ¸å¿ƒå‘½ä»¤</h2>\n<h3 id=\"åˆ›å»º-TDigest\">åˆ›å»º TDigest</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TDIGEST.CREATE key [COMPRESSION compression]</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># keyï¼š TDigest çš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># compressionï¼š å‹ç¼©çº§åˆ«ï¼Œé»˜è®¤ä¸º 100ï¼Œè¶Šå¤§ â†’ ç²¾åº¦è¶Šé«˜ â†’ å†…å­˜è¶Šå¤§</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.CREATE latency:td COMPRESSION 200</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å– TDigest çš„ç±»å‹</span></span><br><span class=\"line\"><span class=\"built_in\">type</span> latency:td</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">TDIS-TYPE</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ·»åŠ æ ·æœ¬\">æ·»åŠ æ ·æœ¬</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TDIGEST.ADD key value [value ...]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.ADD latency:td 12.3 15.7 100.4</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹æœ€å¤§-æœ€å°å€¼\">æŸ¥çœ‹æœ€å¤§/æœ€å°å€¼</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–æœ€å¤§å€¼</span></span><br><span class=\"line\"><span class=\"comment\"># TDIGEST.MAX key</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.MAX latency:td</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\"><span class=\"string\">&quot;100.4&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å–æœ€å°å€¼</span></span><br><span class=\"line\"><span class=\"comment\"># TDIGEST.MIN key</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.MIN latency:td</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\"><span class=\"string\">&quot;12.3&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥è¯¢åˆ†ä½æ•°\">æŸ¥è¯¢åˆ†ä½æ•°</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TDIGEST.QUANTILE key quantile [quantile ...]</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># keyï¼š TDigest çš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># quantileï¼š æŸ¥è¯¢çš„åˆ†ä½æ•°ï¼Œ0.5=&gt;P50 / 0.9=&gt;P90 / 0.99=&gt;P99</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.QUANTILE latency:td 0.5 0.9 0.99</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">1) <span class=\"string\">&quot;15.7&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;100.4&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;100.4&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"åå‘æŸ¥è¯¢ï¼ˆå€¼-â†’-ç™¾åˆ†ä½ï¼‰\">åå‘æŸ¥è¯¢ï¼ˆå€¼ â†’ ç™¾åˆ†ä½ï¼‰</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TDIGEST.CDF key value [value ...]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.CDF latency:td 12.3 15.7 100.4 20</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">1) <span class=\"string\">&quot;0.16666666666666666&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;0.5&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;0.8333333333333334&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;0.6666666666666666&quot;</span>  <span class=\"comment\"># è¿™é‡Œæ³¨æ„ value ä¸å¿…é¡»åœ¨ TDIGEST ä¸­ï¼Œè¿™é‡Œçš„å«ä¹‰æ˜¯ P66=20ï¼Œå³ 66% çš„å€¼éƒ½ â‰¤ 20</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆå¹¶-TDigest\">åˆå¹¶ TDigest</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TDIGEST.MERGE destination-key numkeys source-key [source-key ...] [COMPRESSION compression] [OVERRIDE]</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># destination-keyï¼š ç›®æ ‡ TDigest çš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># numkeysï¼š æº TDigest çš„æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># source-keyï¼š æº TDigest çš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># compressionï¼š å‹ç¼©çº§åˆ«ï¼Œé»˜è®¤ä¸º 100ï¼Œè¶Šå¤§ â†’ ç²¾åº¦è¶Šé«˜ â†’ å†…å­˜è¶Šå¤§</span></span><br><span class=\"line\"><span class=\"comment\"># OVERRIDEï¼š æ˜¯å¦è¦†ç›–ç›®æ ‡ TDigestï¼Œé»˜è®¤ä¸º false</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.MERGE latency:td 2 latency:td:1 latency:td:2 COMPRESSION 200 OVERRIDE</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure>\n<h3 id=\"è·å–è¿‘ä¼¼æ’å\">è·å–è¿‘ä¼¼æ’å</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­£å‘æ’å</span></span><br><span class=\"line\"><span class=\"comment\"># TDIGEST.RANK key value [value ...]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># TDIGEST.ADD latency:td 12.3 15.7 100.4 # å‡è®¾è¿™äº›æ•°æ®å·²ç»å†™å…¥äº† TDigest</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœæŠŠ value æ”¾å…¥å½“å‰åˆ†å¸ƒä¸­ï¼Œå®ƒçš„ rankï¼ˆå°äºè¯¥å€¼çš„æ ·æœ¬æ•°é‡ï¼‰æ˜¯å¤šå°‘</span></span><br><span class=\"line\">TDIGEST.RANK latency:td 0 12.3 15.7 20 100.4 200</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) -1   <span class=\"comment\"># 0: å°äºæœ€å°å€¼ 12.3 â†’ è¿”å› -1</span></span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 0    <span class=\"comment\"># 12.3: ç¬¬ 0 ä½ â†’ è¿”å› 0ï¼ŒçœŸå®å­˜åœ¨çš„ä½æ•°</span></span><br><span class=\"line\">3) (<span class=\"built_in\">integer</span>) 1    <span class=\"comment\"># 15.7: æ’åœ¨ 12.3 å â†’ è¿”å› 1ï¼ŒçœŸå®å­˜åœ¨çš„ä½æ•°</span></span><br><span class=\"line\">4) (<span class=\"built_in\">integer</span>) 2    <span class=\"comment\"># 20: ä»‹äº 15.7 ä¸ 100.4 ä¹‹é—´ â†’ è¿”å› 2</span></span><br><span class=\"line\">5) (<span class=\"built_in\">integer</span>) 2    <span class=\"comment\"># 100.4: ç¬¬ 2 ä½ â†’ 20ï¼ŒçœŸå®å­˜åœ¨çš„ä½æ•°</span></span><br><span class=\"line\">6) (<span class=\"built_in\">integer</span>) 3    <span class=\"comment\"># 200: å¤§äº 100.4 â†’ è¿”å› 3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åå‘æ’å</span></span><br><span class=\"line\"><span class=\"comment\"># TDIGEST.REVRANK key value [value ...]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.REVRANK latency:td 0 12.3 15.7 20 100.4 200</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ ¹æ®æ’åè·å–å…ƒç´ \">æ ¹æ®æ’åè·å–å…ƒç´ </h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­£å‘æ’å</span></span><br><span class=\"line\"><span class=\"comment\"># TDIGEST.BYRANK key rank [rank ...]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.BYRANK latency:td 0 1 2 3</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">1) <span class=\"string\">&quot;12.3&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;15.7&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;100.4&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;inf&quot;</span>  <span class=\"comment\"># ä¸å­˜åœ¨</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åå‘æ’å</span></span><br><span class=\"line\"><span class=\"comment\"># TDIGEST.BYREVRANK key rank [rank ...]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.BYREVRANK latency:td 0 1 2 3</span><br></pre></td></tr></table></figure>\n<h3 id=\"è®¡ç®—-TDigest-å†…éƒ¨æ ·æœ¬-å»æ‰å°¾éƒ¨æå€¼åçš„å¹³å‡è¿‘ä¼¼å€¼ï¼ˆTrimmed-Meanï¼Œæˆªæ–­å‡å€¼ï¼‰\">è®¡ç®— TDigest å†…éƒ¨æ ·æœ¬ å»æ‰å°¾éƒ¨æå€¼åçš„å¹³å‡è¿‘ä¼¼å€¼ï¼ˆTrimmed Meanï¼Œæˆªæ–­å‡å€¼ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å»æ‰æ•°æ®åˆ†å¸ƒçš„æç«¯å°¾éƒ¨ï¼Œåªç®—ä¸»è¦é›†ä¸­åŒºåŸŸçš„å¹³å‡å€¼ï¼Œè¿™æ ·æ›´èƒ½ä»£è¡¨â€œç»å¤§å¤šæ•°ç”¨æˆ·çš„ä½“éªŒâ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TDIGEST.TRIMMED_MEAN key low_cut_quantile high_cut_quantile</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># keyï¼š TDigest çš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># low_cut_quantileï¼š å»æ‰çš„å·¦ä¾§ç™¾åˆ†æ¯”</span></span><br><span class=\"line\"><span class=\"comment\"># high_cut_quantileï¼š å»æ‰çš„å³ä¾§ç™¾åˆ†æ¯”</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.TRIMMED_MEAN latency:td 0.05 0.95</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœ</span></span><br><span class=\"line\"><span class=\"string\">&quot;42.800000000000004&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è·å–-TDigest-çš„ä¿¡æ¯\">è·å– TDigest çš„ä¿¡æ¯</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TDIGEST.INFO key</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.INFO latency:td</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœ</span></span><br><span class=\"line\"> 1) Compression     <span class=\"comment\"># å‹ç¼©çº§åˆ«ï¼Œæ§åˆ¶è´¨å¿ƒçš„æ•°é‡ä¸ç²¾åº¦ã€‚å€¼è¶Šå¤§ â†’ ç²¾åº¦è¶Šé«˜ï¼Œå†…å­˜ç¨å¤§ã€‚</span></span><br><span class=\"line\"> 2) (<span class=\"built_in\">integer</span>) 200</span><br><span class=\"line\"> 3) Capacity       <span class=\"comment\"># è´¨å¿ƒæœ€å¤§å®¹é‡ã€‚è¡¨ç¤ºå†…éƒ¨èƒ½å®¹çº³çš„æœ€å¤§èŠ‚ç‚¹æ•°ï¼Œå®é™…ä½¿ç”¨ä¸­ TDigest ä¼šåŠ¨æ€åˆå¹¶è´¨å¿ƒä»¥æ§åˆ¶å†…å­˜ã€‚</span></span><br><span class=\"line\"> 4) (<span class=\"built_in\">integer</span>) 1210</span><br><span class=\"line\"> 5) Merged nodes   <span class=\"comment\"># å·²åˆå¹¶çš„è´¨å¿ƒæ•°é‡ã€‚è¿™äº›æ˜¯ TDigest å½“å‰å‹ç¼©åçš„èŠ‚ç‚¹ï¼Œç”¨äºè®¡ç®— rank / quantileã€‚</span></span><br><span class=\"line\"> 6) (<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\"> 7) Unmerged nodes <span class=\"comment\"># æœªåˆå¹¶çš„èŠ‚ç‚¹æ•°é‡ã€‚è¡¨ç¤ºæ–°åŠ å…¥ä½†å°šæœªå‹ç¼©åˆ°è´¨å¿ƒçš„æ ·æœ¬ã€‚</span></span><br><span class=\"line\"> 8) (<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\"> 9) Merged weight  <span class=\"comment\"># å·²åˆå¹¶è´¨å¿ƒçš„æ€»æƒé‡ã€‚æ¯ä¸ªæ ·æœ¬æƒé‡é»˜è®¤ä¸º 1ï¼Œ3 è¡¨ç¤ºç›®å‰æ€»å…±æœ‰ 3 ä¸ªæ ·æœ¬è¢«åˆå¹¶è¿›è´¨å¿ƒã€‚</span></span><br><span class=\"line\">10) (<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">11) Unmerged weight <span class=\"comment\"># æœªåˆå¹¶èŠ‚ç‚¹çš„æƒé‡æ€»å’Œã€‚0 è¡¨ç¤ºæ²¡æœ‰æœªå‹ç¼©çš„æ ·æœ¬</span></span><br><span class=\"line\">12) (<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">13) Observations    <span class=\"comment\"># è§‚æµ‹åˆ°çš„æ ·æœ¬æ€»æ•°ã€‚ä½  TDIGEST.ADD çš„ 3 ä¸ªæ ·æœ¬æ­£å¥½å¯¹åº”è¿™ä¸ªå€¼ã€‚</span></span><br><span class=\"line\">14) (<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">15) Total compressions <span class=\"comment\"># å·²ç»æ‰§è¡Œçš„å‹ç¼©æ¬¡æ•°ã€‚æ¯æ¬¡ TDigest å†…éƒ¨è´¨å¿ƒåˆå¹¶ç§°ä¸ºä¸€æ¬¡å‹ç¼©ã€‚</span></span><br><span class=\"line\">16) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">17) Memory usage     <span class=\"comment\"># Redis ä¸ºè¿™ä¸ª TDigest åˆ†é…çš„å†…å­˜ï¼ˆå­—èŠ‚ï¼‰ã€‚åŒ…å«è´¨å¿ƒã€ç´¢å¼•ã€ç»“æ„å¼€é”€ã€‚TDigest å†…å­˜ä½¿ç”¨æ˜¯å›ºå®šçš„ã€ä¸æ ·æœ¬æ•°é‡æ— å…³ï¼ˆä¸»è¦ç”± Compression å†³å®šï¼‰</span></span><br><span class=\"line\">18) (<span class=\"built_in\">integer</span>) 19368</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ¸…ç©ºå…ƒç´ \">æ¸…ç©ºå…ƒç´ </h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TDIGEST.RESET key</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\">TDIGEST.RESET latency:td</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure>\n<h2 id=\"TDigest-çš„å†…å­˜ä¸ç²¾åº¦\">TDigest çš„å†…å­˜ä¸ç²¾åº¦</h2>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>ç‰¹æ€§</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å†…å­˜å ç”¨</td>\n<td>ä¸ COMPRESSION æˆæ­£æ¯”ï¼ˆé€šå¸¸ KB çº§ï¼‰</td>\n</tr>\n<tr>\n<td>ç²¾åº¦</td>\n<td>å°¾éƒ¨åˆ†ä½æ•°ï¼ˆP95/P99ï¼‰æé«˜</td>\n</tr>\n<tr>\n<td>å†™å…¥å¤æ‚åº¦</td>\n<td>è¿‘ä¼¼ O(log n)</td>\n</tr>\n<tr>\n<td>æŸ¥è¯¢å¤æ‚åº¦</td>\n<td>O(log n)</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ä¸æ ·æœ¬æ•°é‡æ— å…³ã€‚</p>\n</blockquote>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ TDigest æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisBloom çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³• T-Digest(åˆ†ä½æ•°ä¼°è®¡ç®—æ³•) T-Digestï¼ˆTDigestï¼‰è§£å†³çš„é—®é¢˜ä¸ CMSã€TopK å®Œå…¨ä¸åŒï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ åˆ†ä½æ•°ï¼ˆquantileï¼‰ç»Ÿè®¡ã€‚ T-Digest ç”± Ted Dunning æå‡ºï¼Œä¸“é—¨ä¸º é«˜ç²¾åº¦å°¾éƒ¨åˆ†ä½æ•° è®¾è®¡ã€‚ TDigest å¯ä»¥åœ¨æä½å†…å­˜å ç”¨ä¸‹ï¼Œè¿‘ä¼¼è®¡ç®—åˆ†ä½æ•°ï¼ˆP50 / P90 / P99 / Median ç­‰ï¼‰ã€‚ åˆ†ä½æ•°ï¼ˆPercentileï¼‰æŒ‡æ ‡å¯¹ç…§è¡¨ æŒ‡æ ‡ è‹±æ–‡å…¨ç§° æ•°å­¦å«ä¹‰ é€šä¿—è§£é‡Š å…¸å‹ä¸šåŠ¡è§£è¯» å¸¸è§ä½¿ç”¨åœºæ™¯ Median Median æ’åºåä½äºä¸­é—´ä½ç½®çš„å€¼ ä¸€åŠæ•°æ®åœ¨å®ƒå·¦å³ â€œä¸€èˆ¬ç”¨æˆ·çš„ä½“éªŒâ€ åŸºç¡€ä½“éªŒè¯„ä¼° P50 50th Percentile 50% çš„æ•°æ® â‰¤ è¯¥å€¼ å’Œ Median å®Œå…¨ç›¸åŒ â€œå…¸å‹è¯·æ±‚è€—æ—¶â€ å¸¸è§„æ€§èƒ½ç›‘æ§ P90 90th Percentile 90% çš„æ•°æ® â‰¤ è¯¥å€¼ 10% çš„è¯·æ±‚æ›´æ…¢ â€œå¤§å¤šæ•°ç”¨æˆ·çš„ä½“éªŒâ€ ä¸šåŠ¡ä½“éªŒç›‘æ§ P95 95th Percentile 95% çš„æ•°æ® â‰¤ è¯¥å€¼ 5% çš„è¯·æ±‚æ›´æ…¢ â€œå°¾éƒ¨å¼€å§‹æ¶åŒ–â€ SLA è¾¹ç•Œç›‘æ§ P99 99th Percentile 99% çš„æ•°æ® â‰¤ è¯¥å€¼ 1% çš„è¯·æ±‚æœ€æ…¢ â€œæç«¯ä½†çœŸå®çš„ç”¨æˆ·ä½“éªŒâ€ æ ¸å¿ƒ SLA / SLO P99.9 99.9th Percentile 99.9% çš„æ•°æ® â‰¤ è¯¥å€¼ åƒåˆ†ä¹‹ä¸€æœ€æ…¢è¯·æ±‚ â€œæç«¯å°¾å»¶è¿Ÿâ€ é‡‘è / æ ¸å¿ƒé“¾è·¯ Max Maximum æ•°æ®ä¸­çš„æœ€å¤§å€¼ æœ€æ…¢çš„é‚£ä¸€æ¬¡ å™ªéŸ³æå¤§ å‡ ä¹ä¸ç”¨ ä¸€ä¸ªå¿«é€Ÿç†è§£ç¤ºä¾‹ 1234567891011å‡è®¾ 100 æ¬¡è¯·æ±‚ï¼š 99 æ¬¡è€—æ—¶ï¼š10 ms 1 æ¬¡è€—æ—¶ï¼š3000 msæ‰€ä»¥ï¼š P99 = 3000 ms P90 = 10 ms P50/Median = 10 ms å¹³å‡å€¼ = ï¼ˆ99*10 + 1*3000ï¼‰/ 100 = 39.9 msğŸ‘‰ åªæœ‰ P99 çœŸå®æš´éœ²äº†é—®é¢˜ã€‚ å·¥ç¨‹å®è·µä¸­çš„â€œæ ‡å‡†æ­é…â€ åº”ç”¨åœºæ™¯ å¸¸çœ‹æŒ‡æ ‡ Web / API æœåŠ¡ P90 / P99 å¾®æœåŠ¡é“¾è·¯ P99 / P99.9 æ•°æ®åº“ / å­˜å‚¨ P95 / P99 å‰ç«¯ä½“éªŒ P50 / P90 ä¸€å¥è¯ï¼šTDigest ç”¨äºç»Ÿè®¡æ•°å­—çš„åˆ†å¸ƒï¼ŒP50 çœ‹ä¸­é—´ï¼ŒP90 çœ‹å¤§å¤šæ•°ï¼ŒP99 çœ‹æœ€å·®é‚£ 1% RedisBloom ä¸­ TDigest çš„æ ¸å¿ƒå‘½ä»¤ åˆ›å»º TDigest 12345678910111213# TDIGEST.CREATE key [COMPRESSION compression]# å‚æ•°è¯´æ˜# keyï¼š TDigest çš„åç§°# compressionï¼š å‹ç¼©çº§åˆ«ï¼Œé»˜è®¤ä¸º 100ï¼Œè¶Šå¤§ â†’ ç²¾åº¦è¶Šé«˜ â†’ å†…å­˜è¶Šå¤§# ç¤ºä¾‹TDIGEST.CREATE latency:td COMPRESSION 200# è¿”å›å€¼OK# è·å– TDigest çš„ç±»å‹type latency:td# è¿”å›å€¼TDIS-TYPE æ·»åŠ æ ·æœ¬ 12345# TDIGEST.ADD key value [value ...]# ç¤ºä¾‹TDIGEST.ADD latency:td 12.3 15.7 100.4# è¿”å›å€¼OK æŸ¥çœ‹æœ€å¤§/æœ€å°å€¼ 12345678910111213# è·å–æœ€å¤§å€¼# TDIGEST.MAX key# ç¤ºä¾‹TDIGEST.MAX latency:td# è¿”å›å€¼&quot;100.4&quot;# å–æœ€å°å€¼# TDIGEST.MIN key# ç¤ºä¾‹TDIGEST.MIN latency:td# è¿”å›å€¼&quot;12.3&quot; æŸ¥è¯¢åˆ†ä½æ•° 12345678910# TDIGEST.QUANTILE key quantile [quantile ...]# å‚æ•°è¯´æ˜# keyï¼š TDigest çš„åç§°# quantileï¼š æŸ¥è¯¢çš„åˆ†ä½æ•°ï¼Œ0.5=&gt;P50 / 0.9=&gt;P90 / 0.99=&gt;P99# ç¤ºä¾‹TDIGEST.QUANTILE latency:td 0.5 0.9 0.99# è¿”å›å€¼1) &quot;15.7&quot;2) &quot;100.4&quot;3) &quot;100.4&quot; åå‘æŸ¥è¯¢ï¼ˆå€¼ â†’ ç™¾åˆ†ä½ï¼‰ 12345678# TDIGEST.CDF key value [value ...]# ç¤ºä¾‹TDIGEST.CDF latency:td 12.3 15.7 100.4 20# è¿”å›å€¼1) &quot;0.16666666666666666&quot;2) &quot;0.5&quot;3) &quot;0.8333333333333334&quot;4) &quot;0.6666666666666666&quot; # è¿™é‡Œæ³¨æ„ value ä¸å¿…é¡»åœ¨ TDIGEST ä¸­ï¼Œè¿™é‡Œçš„å«ä¹‰æ˜¯ P66=20ï¼Œå³ 66% çš„å€¼éƒ½ â‰¤ 20 åˆå¹¶ TDigest 1234567891011# TDIGEST.MERGE destination-key numkeys source-key [source-key ...] [COMPRESSION compression] [OVERRIDE]# å‚æ•°è¯´æ˜# destination-keyï¼š ç›®æ ‡ TDigest çš„åç§°# numkeysï¼š æº TDigest çš„æ•°é‡# source-keyï¼š æº TDigest çš„åç§°# compressionï¼š å‹ç¼©çº§åˆ«ï¼Œé»˜è®¤ä¸º 100ï¼Œè¶Šå¤§ â†’ ç²¾åº¦è¶Šé«˜ â†’ å†…å­˜è¶Šå¤§# OVERRIDEï¼š æ˜¯å¦è¦†ç›–ç›®æ ‡ TDigestï¼Œé»˜è®¤ä¸º false# ç¤ºä¾‹TDIGEST.MERGE latency:td 2 latency:td:1 latency:td:2 COMPRESSION 200 OVERRIDE# è¿”å›å€¼OK è·å–è¿‘ä¼¼æ’å 123456789101112131415161718# æ­£å‘æ’å# TDIGEST.RANK key value [value ...]# ç¤ºä¾‹# TDIGEST.ADD latency:td 12.3 15.7 100.4 # å‡è®¾è¿™äº›æ•°æ®å·²ç»å†™å…¥äº† TDigest# å¦‚æœæŠŠ value æ”¾å…¥å½“å‰åˆ†å¸ƒä¸­ï¼Œå®ƒçš„ rankï¼ˆå°äºè¯¥å€¼çš„æ ·æœ¬æ•°é‡ï¼‰æ˜¯å¤šå°‘TDIGEST.RANK latency:td 0 12.3 15.7 20 100.4 200# è¿”å›å€¼1) (integer) -1 # 0: å°äºæœ€å°å€¼ 12.3 â†’ è¿”å› -12) (integer) 0 # 12.3: ç¬¬ 0 ä½ â†’ è¿”å› 0ï¼ŒçœŸå®å­˜åœ¨çš„ä½æ•°3) (integer) 1 # 15.7: æ’åœ¨ 12.3 å â†’ è¿”å› 1ï¼ŒçœŸå®å­˜åœ¨çš„ä½æ•°4) (integer) 2 # 20: ä»‹äº 15.7 ä¸ 100.4 ä¹‹é—´ â†’ è¿”å› 25) (integer) 2 # 100.4: ç¬¬ 2 ä½ â†’ 20ï¼ŒçœŸå®å­˜åœ¨çš„ä½æ•°6) (integer) 3 # 200: å¤§äº 100.4 â†’ è¿”å› 3# åå‘æ’å# TDIGEST.REVRANK key value [value ...]# ç¤ºä¾‹TDIGEST.REVRANK latency:td 0 12.3 15.7 20 100.4 200 æ ¹æ®æ’åè·å–å…ƒç´  1234567891011121314# æ­£å‘æ’å# TDIGEST.BYRANK key rank [rank ...]# ç¤ºä¾‹TDIGEST.BYRANK latency:td 0 1 2 3# è¾“å‡ºç»“æœ1) &quot;12.3&quot;2) &quot;15.7&quot;3) &quot;100.4&quot;4) &quot;inf&quot; # ä¸å­˜åœ¨# åå‘æ’å# TDIGEST.BYREVRANK key rank [rank ...]# ç¤ºä¾‹TDIGEST.BYREVRANK latency:td 0 1 2 3 è®¡ç®— TDigest å†…éƒ¨æ ·æœ¬ å»æ‰å°¾éƒ¨æå€¼åçš„å¹³å‡è¿‘ä¼¼å€¼ï¼ˆTrimmed Meanï¼Œæˆªæ–­å‡å€¼ï¼‰ å»æ‰æ•°æ®åˆ†å¸ƒçš„æç«¯å°¾éƒ¨ï¼Œåªç®—ä¸»è¦é›†ä¸­åŒºåŸŸçš„å¹³å‡å€¼ï¼Œè¿™æ ·æ›´èƒ½ä»£è¡¨â€œç»å¤§å¤šæ•°ç”¨æˆ·çš„ä½“éªŒâ€ 123456789# TDIGEST.TRIMMED_MEAN key low_cut_quantile high_cut_quantile# å‚æ•°è¯´æ˜# keyï¼š TDigest çš„åç§°# low_cut_quantileï¼š å»æ‰çš„å·¦ä¾§ç™¾åˆ†æ¯”# high_cut_quantileï¼š å»æ‰çš„å³ä¾§ç™¾åˆ†æ¯”# ç¤ºä¾‹TDIGEST.TRIMMED_MEAN latency:td 0.05 0.95# è¾“å‡ºç»“æœ&quot;42.800000000000004&quot; è·å– TDigest çš„ä¿¡æ¯ 12345678910111213141516171819202122# TDIGEST.INFO key# ç¤ºä¾‹TDIGEST.INFO latency:td# è¾“å‡ºç»“æœ 1) Compression # å‹ç¼©çº§åˆ«ï¼Œæ§åˆ¶è´¨å¿ƒçš„æ•°é‡ä¸ç²¾åº¦ã€‚å€¼è¶Šå¤§ â†’ ç²¾åº¦è¶Šé«˜ï¼Œå†…å­˜ç¨å¤§ã€‚ 2) (integer) 200 3) Capacity # è´¨å¿ƒæœ€å¤§å®¹é‡ã€‚è¡¨ç¤ºå†…éƒ¨èƒ½å®¹çº³çš„æœ€å¤§èŠ‚ç‚¹æ•°ï¼Œå®é™…ä½¿ç”¨ä¸­ TDigest ä¼šåŠ¨æ€åˆå¹¶è´¨å¿ƒä»¥æ§åˆ¶å†…å­˜ã€‚ 4) (integer) 1210 5) Merged nodes # å·²åˆå¹¶çš„è´¨å¿ƒæ•°é‡ã€‚è¿™äº›æ˜¯ TDigest å½“å‰å‹ç¼©åçš„èŠ‚ç‚¹ï¼Œç”¨äºè®¡ç®— rank / quantileã€‚ 6) (integer) 3 7) Unmerged nodes # æœªåˆå¹¶çš„èŠ‚ç‚¹æ•°é‡ã€‚è¡¨ç¤ºæ–°åŠ å…¥ä½†å°šæœªå‹ç¼©åˆ°è´¨å¿ƒçš„æ ·æœ¬ã€‚ 8) (integer) 0 9) Merged weight # å·²åˆå¹¶è´¨å¿ƒçš„æ€»æƒé‡ã€‚æ¯ä¸ªæ ·æœ¬æƒé‡é»˜è®¤ä¸º 1ï¼Œ3 è¡¨ç¤ºç›®å‰æ€»å…±æœ‰ 3 ä¸ªæ ·æœ¬è¢«åˆå¹¶è¿›è´¨å¿ƒã€‚10) (integer) 311) Unmerged weight # æœªåˆå¹¶èŠ‚ç‚¹çš„æƒé‡æ€»å’Œã€‚0 è¡¨ç¤ºæ²¡æœ‰æœªå‹ç¼©çš„æ ·æœ¬12) (integer) 013) Observations # è§‚æµ‹åˆ°çš„æ ·æœ¬æ€»æ•°ã€‚ä½  TDIGEST.ADD çš„ 3 ä¸ªæ ·æœ¬æ­£å¥½å¯¹åº”è¿™ä¸ªå€¼ã€‚14) (integer) 315) Total compressions # å·²ç»æ‰§è¡Œçš„å‹ç¼©æ¬¡æ•°ã€‚æ¯æ¬¡ TDigest å†…éƒ¨è´¨å¿ƒåˆå¹¶ç§°ä¸ºä¸€æ¬¡å‹ç¼©ã€‚16) (integer) 117) Memory usage # Redis ä¸ºè¿™ä¸ª TDigest åˆ†é…çš„å†…å­˜ï¼ˆå­—èŠ‚ï¼‰ã€‚åŒ…å«è´¨å¿ƒã€ç´¢å¼•ã€ç»“æ„å¼€é”€ã€‚TDigest å†…å­˜ä½¿ç”¨æ˜¯å›ºå®šçš„ã€ä¸æ ·æœ¬æ•°é‡æ— å…³ï¼ˆä¸»è¦ç”± Compression å†³å®šï¼‰18) (integer) 19368 æ¸…ç©ºå…ƒç´  12345# TDIGEST.RESET key# ç¤ºä¾‹TDIGEST.RESET latency:td# è¾“å‡ºç»“æœOK TDigest çš„å†…å­˜ä¸ç²¾åº¦ ç»´åº¦ ç‰¹æ€§ å†…å­˜å ç”¨ ä¸ COMPRESSION æˆæ­£æ¯”ï¼ˆé€šå¸¸ KB çº§ï¼‰ ç²¾åº¦ å°¾éƒ¨åˆ†ä½æ•°ï¼ˆP95/P99ï¼‰æé«˜ å†™å…¥å¤æ‚åº¦ è¿‘ä¼¼ O(log n) æŸ¥è¯¢å¤æ‚åº¦ O(log n) ä¸æ ·æœ¬æ•°é‡æ— å…³ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ TDigest æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisBloom çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•","date_published":"2025-12-23T07:40:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-14-TopK/","url":"https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-14-TopK/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TopK","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ TopK æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\">RedisBloom çš„å®‰è£…å‚è§ <a href=\"/2025/12/21/redis7-module-RedisBloom/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"TopK\">TopK</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>TopKï¼Œä¸“é—¨ç”¨äºè§£å†³ â€œåœ¨æµ·é‡æ•°æ®æµä¸­ï¼Œå®æ—¶æ‰¾å‡ºæœ€çƒ­é—¨çš„ N ä¸ªå…ƒç´ â€ è¿™ä¸€ç±»é—®é¢˜</p>\n</li>\n<li class=\"lvl-2\">\n<p>Top-K å±äºæµå¼é‡é¢‘ï¼ˆHeavy Hittersï¼‰ç®—æ³•å®¶æ—ï¼Œå…¶ç›®æ ‡ä¸æ˜¯è®°å½•æ‰€æœ‰å…ƒç´ ï¼Œè€Œæ˜¯ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åœ¨å—é™å†…å­˜ä¸‹ï¼ŒæŒç»­ç»´æŠ¤å‡ºç°é¢‘ç‡æœ€é«˜çš„ K ä¸ªå…ƒç´ </li>\n</ul>\n</li>\n<li class=\"lvl-3\">\n<p>TopK çš„æ ¸å¿ƒç‰¹æ€§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å›ºå®šå®¹é‡ï¼šåªç»´æŠ¤ K ä¸ªå…ƒç´ </span><br><span class=\"line\">è¿‘ä¼¼ç»Ÿè®¡ï¼šè®¡æ•°å¯èƒ½ç•¥æœ‰è¯¯å·®</span><br><span class=\"line\">è‡ªåŠ¨æ·˜æ±°ï¼šä½é¢‘å…ƒç´ ä¼šè¢«è¸¢å‡º</span><br><span class=\"line\">å†™å…¥æå¿«ï¼šé€‚åˆé«˜ QPS</span><br><span class=\"line\">å†…å­˜ç¨³å®šï¼šä¸æ•°æ®è§„æ¨¡æ— å…³</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RedisBloom çš„ TopK å†…éƒ¨ä½¿ç”¨ CMS ä½œä¸ºé¢‘æ¬¡ä¼°ç®—åŸºç¡€ï¼Œå¹¶ç»“åˆ<code>å †+æ·˜æ±°ç­–ç•¥</code>æ¥ç»´æŠ¤çƒ­ç‚¹é›†åˆã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">CMS: å‚è€ƒ <a href=\"/2025/12/23/redis7-datatype-13-CMS/\" title=\"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch)\">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch)</a></li>\n<li class=\"lvl-6\">å †+æ·˜æ±°ç­–ç•¥: TopK åœ¨å†…éƒ¨å¦‚ä½•å†³å®šè°èƒ½è¿›å…¥ TopKã€è°å¿…é¡»è¢«è¸¢å‡º TopK çš„ä¸€æ•´å¥—æœºåˆ¶ã€‚\n<ul class=\"lvl-4\">\n<li class=\"lvl-10\">å †ï¼šTopK ä½¿ç”¨ä¸€ä¸ªæœ€å°å †æ¥ç»´æŠ¤ TopK å…ƒç´ ï¼ŒTopK ç»´æŠ¤ K ä¸ªå€™é€‰å…ƒç´ ï¼Œå †é¡¶æ°¸è¿œæ˜¯ å½“å‰ TopK ä¸­é¢‘æ¬¡æœ€ä½çš„é‚£ä¸ª</li>\n<li class=\"lvl-10\">æ·˜æ±°ç­–ç•¥ï¼šTopK ä½¿ç”¨ä¸€ä¸ª LRU ç¼“å­˜æ¥è®°å½•æœ€è¿‘è®¿é—®çš„å…ƒç´ ï¼Œå½“ TopK å…ƒç´ æ•°é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå°† LRU ç¼“å­˜ä¸­çš„å…ƒç´ é€ä¸ªåŠ å…¥ TopKï¼Œå¹¶æ›´æ–° TopK å…ƒç´ çš„é¢‘ç‡ã€‚</li>\n<li class=\"lvl-10\">ä¸€å¥è¯ï¼šå½“æ–°å…ƒç´ çš„ä¼°ç®—é¢‘æ¬¡è¶…è¿‡å½“å‰æœ€å¼±çš„é‚£ä¸ªæ—¶ï¼Œå°±æŠŠå¼±è€…æ·˜æ±°æ‰ï¼Œè®©æ–°å…ƒç´ è¿›æ¦œã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å½“ä¸€ä¸ªæ–°å…ƒç´ åˆ°æ¥æ—¶ï¼Œæˆ‘è¯¥ä¸è¯¥è®©å®ƒè¿›å…¥-TopKï¼Ÿ\">å½“ä¸€ä¸ªæ–°å…ƒç´ åˆ°æ¥æ—¶ï¼Œæˆ‘è¯¥ä¸è¯¥è®©å®ƒè¿›å…¥ TopKï¼Ÿ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹é¢æ˜¯ TopK åœ¨ TOPK.ADD æ—¶çš„çœŸå®é€»è¾‘æŠ½è±¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Step 1ï¼šæ›´æ–° CMSï¼ˆä¸å­˜ itemï¼Œåªæ›´æ–°è®¡æ•°å™¨ï¼‰</span></span><br><span class=\"line\">CMS.increment(item)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 2ï¼šitem æ˜¯å¦åœ¨ TopK æ˜¾å¼é›†åˆä¸­ï¼Ÿ</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> item <span class=\"keyword\">in</span> TopK:</span><br><span class=\"line\">    <span class=\"comment\"># é‡æ–°å¹³è¡¡å †ä½ç½®</span></span><br><span class=\"line\">    update_heap(item)</span><br><span class=\"line\">    <span class=\"built_in\">return</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 3ï¼šTopK æ˜¯å¦æœªæ»¡ï¼Ÿ</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> TopK.size &lt; K:</span><br><span class=\"line\">    TopK.insert(item)</span><br><span class=\"line\">    <span class=\"built_in\">return</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Step 4ï¼šæ¯”è¾ƒ CMS ä¼°ç®—å€¼</span></span><br><span class=\"line\">freq_new = CMS.query(item)</span><br><span class=\"line\">freq_min = CMS.query(TopK.min_item)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> freq_new &gt; freq_min:</span><br><span class=\"line\">    TopK.evict_min()</span><br><span class=\"line\">    TopK.insert(item)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    <span class=\"comment\"># ä»€ä¹ˆéƒ½ä¸åš</span></span><br><span class=\"line\">    pass</span><br></pre></td></tr></table></figure>\n<h2 id=\"TopK-çš„åº”ç”¨åœºæ™¯\">TopK çš„åº”ç”¨åœºæ™¯</h2>\n<table>\n<thead>\n<tr>\n<th>é—®é¢˜</th>\n<th>TopK æ˜¯å¦é€‚åˆ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å½“å‰è®¿é—®é‡æœ€é«˜çš„ URL</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>æœç´¢çƒ­è¯ Top 10</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>å•†å“ç‚¹å‡»æ¦œ</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>æ‰€æœ‰å•†å“çš„ç‚¹å‡»æ¬¡æ•°</td>\n<td>âŒ</td>\n</tr>\n<tr>\n<td>ç²¾ç¡®è®¡æ•°</td>\n<td>âŒ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RedisBloom-TopK-çš„æ ¸å¿ƒå‘½ä»¤\">RedisBloom TopK çš„æ ¸å¿ƒå‘½ä»¤</h2>\n<h3 id=\"åˆ›å»º-TopK\">åˆ›å»º TopK</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ TopK å‰å¿…é¡»å…ˆåˆ›å»º TopK</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TOPK.RESERVE key topk [width depth decay]</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># key: é”®å</span></span><br><span class=\"line\"><span class=\"comment\"># topk: å­˜å‚¨çš„å…ƒç´ æ•°é‡ï¼Œå³ç»Ÿè®¡çš„å‰ K ä¸ªå…ƒç´ </span></span><br><span class=\"line\"><span class=\"comment\"># width: å†…éƒ¨CMS çš„å®½åº¦ï¼Œé»˜è®¤ 8</span></span><br><span class=\"line\"><span class=\"comment\"># depth: å†…éƒ¨CMS çš„æ·±åº¦ï¼Œé»˜è®¤ 7</span></span><br><span class=\"line\"><span class=\"comment\"># decay: è¡°å‡å› å­ï¼ˆ0 ~ 1ï¼‰ï¼Œé»˜è®¤ 0.9</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># å«ä¹‰ï¼šç»´æŠ¤è®¿é—®é‡æœ€é«˜çš„ 100 ä¸ª URLï¼Œå…è®¸å†å²çƒ­åº¦é€æ¸è¡°å‡ã€‚</span></span><br><span class=\"line\">TOPK.RESERVE topk:urls 100 2000 7 0.9</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯ç±»å‹</span></span><br><span class=\"line\"><span class=\"built_in\">type</span> topk:urls</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">TopK-TYPE</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ·»åŠ å…ƒç´ \">æ·»åŠ å…ƒç´ </h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TOPK.ADD key items [items ...]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># å«ä¹‰ï¼šæ·»åŠ å…ƒç´  &quot;a&quot; å’Œ &quot;b&quot; åˆ° TopK ä¸­</span></span><br><span class=\"line\">TOPK.ADD topk:urls a b</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼ï¼Œè¢«æŒ¤å‡º TopK çš„å…ƒç´ ï¼ˆå¦‚æœæœ‰ï¼‰</span></span><br><span class=\"line\">1) (nil)</span><br><span class=\"line\">2) (nil)</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¢åŠ å…ƒç´ çš„é¢‘ç‡\">å¢åŠ å…ƒç´ çš„é¢‘ç‡</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TOPK.INCRBY key item increment [item increment ...]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># å«ä¹‰ï¼šå°†å…ƒç´  &quot;a&quot; çš„é¢‘ç‡å¢åŠ  1</span></span><br><span class=\"line\">TOPK.INCRBY topk:urls a 1</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">1) (nil)</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥è¯¢å…ƒç´ æ˜¯å¦åœ¨-TopK-ä¸­\">æŸ¥è¯¢å…ƒç´ æ˜¯å¦åœ¨ TopK ä¸­</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TOPK.QUERY key item [item ...]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># å«ä¹‰ï¼šæŸ¥è¯¢å…ƒç´  &quot;a&quot; æ˜¯å¦åœ¨ TopK ä¸­</span></span><br><span class=\"line\">TOPK.QUERY topk:urls a</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1 <span class=\"comment\"># 1 è¡¨ç¤ºå…ƒç´  &quot;a&quot; åœ¨ TopK ä¸­ï¼Œ0 è¡¨ç¤ºå…ƒç´  &quot;a&quot; ä¸åœ¨ TopK ä¸­</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è·å–-TopK-ä¸­çš„å…ƒç´ \">è·å– TopK ä¸­çš„å…ƒç´ </h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TOPK.LIST key [WITHCOUNT]</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># WITHCOUNT: æ˜¯å¦è¿”å›æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸è¿”å›</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># å«ä¹‰ï¼šè·å– TopK ä¸­çš„å…ƒç´ ï¼Œå¹¶è¿”å›æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°</span></span><br><span class=\"line\">TOPK.LIST topk:urls WITHCOUNT</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">1) <span class=\"string\">&quot;a&quot;</span></span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">3) <span class=\"string\">&quot;b&quot;</span></span><br><span class=\"line\">4) (<span class=\"built_in\">integer</span>) 1</span><br></pre></td></tr></table></figure>\n<h3 id=\"è·å–è¿‘ä¼¼è®¡æ•°\">è·å–è¿‘ä¼¼è®¡æ•°</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TOPK.COUNT key item [item ...]</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># å«ä¹‰ï¼šè·å–å…ƒç´  &quot;a&quot; çš„è¿‘ä¼¼è®¡æ•°</span></span><br><span class=\"line\">TOPK.COUNT topk:urls a</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 2</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹TopK-çš„çŠ¶æ€\">æŸ¥çœ‹TopK çš„çŠ¶æ€</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># TOPK.INFO key</span></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># å«ä¹‰ï¼šæŸ¥çœ‹ TopK çš„çŠ¶æ€</span></span><br><span class=\"line\">TOPK.INFO topk:urls</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç»“æœ</span></span><br><span class=\"line\">1) k                    <span class=\"comment\"># topk çš„å¤§å°</span></span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 100</span><br><span class=\"line\">3) width                <span class=\"comment\"># å†…éƒ¨ CMS çš„å®½åº¦</span></span><br><span class=\"line\">4) (<span class=\"built_in\">integer</span>) 2000</span><br><span class=\"line\">5) depth                <span class=\"comment\"># å†…éƒ¨ CMS çš„æ·±åº¦</span></span><br><span class=\"line\">6) (<span class=\"built_in\">integer</span>) 7</span><br><span class=\"line\">7) decay                <span class=\"comment\"># è¡°å‡å› å­</span></span><br><span class=\"line\">8) <span class=\"string\">&quot;0.9&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"TopK-çš„è¡°å‡ï¼ˆdecayï¼‰å‚æ•°æ€ä¹ˆç†è§£\">TopK çš„è¡°å‡ï¼ˆdecayï¼‰å‚æ•°æ€ä¹ˆç†è§£</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>decay ç”¨äºè§£å†³ä¸€ä¸ªé—®é¢˜ï¼šâ€œè€çƒ­ç‚¹æ°¸è¿œéœ¸æ¦œï¼Œæ–°çƒ­ç‚¹ä¸Šä¸æ¥â€</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>decay</th>\n<th>è¡Œä¸º</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.0</td>\n<td>æ°¸ä¸è¡°å‡ï¼ˆå…¨å†å²ç»Ÿè®¡ï¼‰</td>\n</tr>\n<tr>\n<td>0.9</td>\n<td>è¶Šè€çš„æ•°æ®æƒé‡è¶Šä½</td>\n</tr>\n<tr>\n<td>0.5</td>\n<td>çƒ­ç‚¹æ›´æ–°éå¸¸å¿«</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»éªŒå€¼ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å®æ—¶çƒ­ç‚¹ï¼š0.8 ~ 0.9</li>\n<li class=\"lvl-6\">é•¿å‘¨æœŸæ¦œå•ï¼š0.95 ~ 1.0</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"CMS-å’Œ-TopK-ç»„åˆä½¿ç”¨åœºæ™¯\">CMS å’Œ TopK ç»„åˆä½¿ç”¨åœºæ™¯</h2>\n<h3 id=\"ğŸ“Œåœºæ™¯1ï¼š-å®æ—¶çƒ­æœæ¦œï¼ˆæœ€ç»å…¸ç»„åˆï¼‰\">ğŸ“Œåœºæ™¯1ï¼š å®æ—¶çƒ­æœæ¦œï¼ˆæœ€ç»å…¸ç»„åˆï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éœ€æ±‚ï¼šç»Ÿè®¡æ‰€æœ‰æœç´¢è¯é¢‘æ¬¡ï¼ˆCMSï¼‰ï¼ŒåŒæ—¶å®æ—¶å‡ºTOP10çƒ­æœï¼ˆTOPKï¼‰ï¼Œæ—¢çŸ¥çƒ­åº¦åˆèƒ½æ’åº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. åˆå§‹åŒ–CMSï¼ˆç»Ÿè®¡å…¨é‡æœç´¢è¯è®¡æ•°ï¼Œè¯¯å·®0.001ï¼‰</span></span><br><span class=\"line\">cms.initbyprob search_count 0.001 0.01</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. åˆå§‹åŒ–TOPKï¼ˆå–TOP10çƒ­æœï¼‰</span></span><br><span class=\"line\">topk.reserve search_top10 10</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. ç”¨æˆ·æœç´¢æ ¸å¿ƒæ“ä½œï¼ˆ2å‘½ä»¤å¿…ä¸€èµ·æ‰§è¡Œï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># æœç´¢&quot;å‘¨æ°ä¼¦&quot;ï¼ŒCMSè®¡æ•°+1ï¼ŒåŒæ—¶å½•å…¥TOPKï¼ˆè‡ªåŠ¨ç´¯åŠ çƒ­åº¦ï¼‰</span></span><br><span class=\"line\">cms.incrby search_count å‘¨æ°ä¼¦ 1</span><br><span class=\"line\">topk.incrby search_top10 å‘¨æ°ä¼¦ 1</span><br><span class=\"line\"></span><br><span class=\"line\">cms.incrby search_count åŸç¥ 1</span><br><span class=\"line\">topk.incrby search_top10 åŸç¥ 1</span><br><span class=\"line\">cms.incrby search_count å‘¨æ°ä¼¦ 1  <span class=\"comment\"># é‡å¤æœç´¢ï¼ŒåŒç«¯åŒæ­¥+1</span></span><br><span class=\"line\">topk.incrby search_top10 å‘¨æ°ä¼¦ 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. æ ¸å¿ƒæŸ¥è¯¢ï¼šå…ˆå–TOP10ï¼Œå†æŸ¥ç²¾å‡†è®¡æ•°ï¼ˆç»„åˆæ ¸å¿ƒï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸€æ­¥ï¼šå–TOP10çƒ­æœåˆ—è¡¨</span></span><br><span class=\"line\">topk.list search_top10  <span class=\"comment\"># è¿”å›ï¼šå‘¨æ°ä¼¦ã€åŸç¥...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬äºŒæ­¥ï¼šæŸ¥çƒ­æœè¯ç²¾å‡†è¿‘ä¼¼è®¡æ•°ï¼ˆCMSæ¯”TOPK.countæ›´å‡†ï¼‰</span></span><br><span class=\"line\">cms.query search_count å‘¨æ°ä¼¦  <span class=\"comment\"># è¿”å›2ï¼ˆç²¾å‡†ï¼‰</span></span><br><span class=\"line\">topk.count search_top10 å‘¨æ°ä¼¦  <span class=\"comment\"># å‚è€ƒå€¼ï¼Œä¼˜å…ˆç”¨CMSç»“æœ</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. è¾…åŠ©æŸ¥è¯¢ï¼šåˆ¤æ–­è¯æ˜¯å¦åœ¨çƒ­æœæ¦œ</span></span><br><span class=\"line\">topk.query search_top10 å‘¨æ°ä¼¦  <span class=\"comment\"># 1=åœ¨ï¼Œ0=ä¸åœ¨</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"TopK-vs-ZSET\">TopK vs ZSET</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èƒ½åŠ›è¾¹ç•Œå¯¹æ¯”</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>èƒ½åŠ›</th>\n<th>TopK</th>\n<th>ZSet</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ˜¯å¦è¿‘ä¼¼</td>\n<td>âœ”ï¸ æ˜¯</td>\n<td>âŒ å¦</td>\n</tr>\n<tr>\n<td>æ˜¯å¦ä¿å­˜å…¨éƒ¨å…ƒç´ </td>\n<td>âŒ åªä¿å­˜ Top K</td>\n<td>âœ”ï¸ ä¿å­˜å…¨éƒ¨</td>\n</tr>\n<tr>\n<td>é¢‘æ¬¡æ˜¯å¦ç²¾ç¡®</td>\n<td>âŒ ä¼°è®¡</td>\n<td>âœ”ï¸ ç²¾ç¡®</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ”¯æŒæ’åº</td>\n<td>âš ï¸ ä»… Top K</td>\n<td>âœ”ï¸ å…¨é‡æ’åº</td>\n</tr>\n<tr>\n<td>æ˜¯å¦å¯éå†</td>\n<td>âŒ ä»… K ä¸ª</td>\n<td>âœ”ï¸ å…¨é‡</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ”¯æŒåˆ é™¤</td>\n<td>âŒ ä¸æ”¯æŒ</td>\n<td>âœ”ï¸ æ”¯æŒ</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ”¯æŒèŒƒå›´æŸ¥è¯¢</td>\n<td>âŒ</td>\n<td>âœ”ï¸</td>\n</tr>\n<tr>\n<td>Top N æŸ¥è¯¢</td>\n<td>âœ”ï¸ åŸç”Ÿ</td>\n<td>âœ”ï¸</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ€§èƒ½ä¸ååé‡å¯¹æ¯”</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>TopK</th>\n<th>ZSet</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å†™å…¥å¤æ‚åº¦</td>\n<td>O(d)</td>\n<td>O(log N)</td>\n</tr>\n<tr>\n<td>é«˜å¹¶å‘å†™å…¥</td>\n<td>æä¼˜</td>\n<td>ä¸€èˆ¬</td>\n</tr>\n<tr>\n<td>æŸ¥è¯¢ TopK</td>\n<td>O(K)</td>\n<td>O(K)</td>\n</tr>\n<tr>\n<td>æŸ¥è¯¢å•å…ƒç´ é¢‘æ¬¡</td>\n<td>O(d)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>æ‰¹é‡å†™å…¥</td>\n<td>æå¿«</td>\n<td>è¾ƒæ…¢</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ TopK æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisBloom çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³• TopK TopKï¼Œä¸“é—¨ç”¨äºè§£å†³ â€œåœ¨æµ·é‡æ•°æ®æµä¸­ï¼Œå®æ—¶æ‰¾å‡ºæœ€çƒ­é—¨çš„ N ä¸ªå…ƒç´ â€ è¿™ä¸€ç±»é—®é¢˜ Top-K å±äºæµå¼é‡é¢‘ï¼ˆHeavy Hittersï¼‰ç®—æ³•å®¶æ—ï¼Œå…¶ç›®æ ‡ä¸æ˜¯è®°å½•æ‰€æœ‰å…ƒç´ ï¼Œè€Œæ˜¯ï¼š åœ¨å—é™å†…å­˜ä¸‹ï¼ŒæŒç»­ç»´æŠ¤å‡ºç°é¢‘ç‡æœ€é«˜çš„ K ä¸ªå…ƒç´  TopK çš„æ ¸å¿ƒç‰¹æ€§ 12345å›ºå®šå®¹é‡ï¼šåªç»´æŠ¤ K ä¸ªå…ƒç´ è¿‘ä¼¼ç»Ÿè®¡ï¼šè®¡æ•°å¯èƒ½ç•¥æœ‰è¯¯å·®è‡ªåŠ¨æ·˜æ±°ï¼šä½é¢‘å…ƒç´ ä¼šè¢«è¸¢å‡ºå†™å…¥æå¿«ï¼šé€‚åˆé«˜ QPSå†…å­˜ç¨³å®šï¼šä¸æ•°æ®è§„æ¨¡æ— å…³ RedisBloom çš„ TopK å†…éƒ¨ä½¿ç”¨ CMS ä½œä¸ºé¢‘æ¬¡ä¼°ç®—åŸºç¡€ï¼Œå¹¶ç»“åˆå †+æ·˜æ±°ç­–ç•¥æ¥ç»´æŠ¤çƒ­ç‚¹é›†åˆã€‚ CMS: å‚è€ƒ Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch) å †+æ·˜æ±°ç­–ç•¥: TopK åœ¨å†…éƒ¨å¦‚ä½•å†³å®šè°èƒ½è¿›å…¥ TopKã€è°å¿…é¡»è¢«è¸¢å‡º TopK çš„ä¸€æ•´å¥—æœºåˆ¶ã€‚ å †ï¼šTopK ä½¿ç”¨ä¸€ä¸ªæœ€å°å †æ¥ç»´æŠ¤ TopK å…ƒç´ ï¼ŒTopK ç»´æŠ¤ K ä¸ªå€™é€‰å…ƒç´ ï¼Œå †é¡¶æ°¸è¿œæ˜¯ å½“å‰ TopK ä¸­é¢‘æ¬¡æœ€ä½çš„é‚£ä¸ª æ·˜æ±°ç­–ç•¥ï¼šTopK ä½¿ç”¨ä¸€ä¸ª LRU ç¼“å­˜æ¥è®°å½•æœ€è¿‘è®¿é—®çš„å…ƒç´ ï¼Œå½“ TopK å…ƒç´ æ•°é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå°† LRU ç¼“å­˜ä¸­çš„å…ƒç´ é€ä¸ªåŠ å…¥ TopKï¼Œå¹¶æ›´æ–° TopK å…ƒç´ çš„é¢‘ç‡ã€‚ ä¸€å¥è¯ï¼šå½“æ–°å…ƒç´ çš„ä¼°ç®—é¢‘æ¬¡è¶…è¿‡å½“å‰æœ€å¼±çš„é‚£ä¸ªæ—¶ï¼Œå°±æŠŠå¼±è€…æ·˜æ±°æ‰ï¼Œè®©æ–°å…ƒç´ è¿›æ¦œã€‚ å½“ä¸€ä¸ªæ–°å…ƒç´ åˆ°æ¥æ—¶ï¼Œæˆ‘è¯¥ä¸è¯¥è®©å®ƒè¿›å…¥ TopKï¼Ÿ ä¸‹é¢æ˜¯ TopK åœ¨ TOPK.ADD æ—¶çš„çœŸå®é€»è¾‘æŠ½è±¡ 123456789101112131415161718192021222324# Step 1ï¼šæ›´æ–° CMSï¼ˆä¸å­˜ itemï¼Œåªæ›´æ–°è®¡æ•°å™¨ï¼‰CMS.increment(item)# Step 2ï¼šitem æ˜¯å¦åœ¨ TopK æ˜¾å¼é›†åˆä¸­ï¼Ÿif item in TopK: # é‡æ–°å¹³è¡¡å †ä½ç½® update_heap(item) return# Step 3ï¼šTopK æ˜¯å¦æœªæ»¡ï¼Ÿif TopK.size &lt; K: TopK.insert(item) return# Step 4ï¼šæ¯”è¾ƒ CMS ä¼°ç®—å€¼freq_new = CMS.query(item)freq_min = CMS.query(TopK.min_item)if freq_new &gt; freq_min: TopK.evict_min() TopK.insert(item)else: # ä»€ä¹ˆéƒ½ä¸åš pass TopK çš„åº”ç”¨åœºæ™¯ é—®é¢˜ TopK æ˜¯å¦é€‚åˆ å½“å‰è®¿é—®é‡æœ€é«˜çš„ URL âœ… æœç´¢çƒ­è¯ Top 10 âœ… å•†å“ç‚¹å‡»æ¦œ âœ… æ‰€æœ‰å•†å“çš„ç‚¹å‡»æ¬¡æ•° âŒ ç²¾ç¡®è®¡æ•° âŒ RedisBloom TopK çš„æ ¸å¿ƒå‘½ä»¤ åˆ›å»º TopK ä½¿ç”¨ TopK å‰å¿…é¡»å…ˆåˆ›å»º TopK 123456789101112131415161718# TOPK.RESERVE key topk [width depth decay]# å‚æ•°è¯´æ˜# key: é”®å# topk: å­˜å‚¨çš„å…ƒç´ æ•°é‡ï¼Œå³ç»Ÿè®¡çš„å‰ K ä¸ªå…ƒç´ # width: å†…éƒ¨CMS çš„å®½åº¦ï¼Œé»˜è®¤ 8# depth: å†…éƒ¨CMS çš„æ·±åº¦ï¼Œé»˜è®¤ 7# decay: è¡°å‡å› å­ï¼ˆ0 ~ 1ï¼‰ï¼Œé»˜è®¤ 0.9# ç¤ºä¾‹# å«ä¹‰ï¼šç»´æŠ¤è®¿é—®é‡æœ€é«˜çš„ 100 ä¸ª URLï¼Œå…è®¸å†å²çƒ­åº¦é€æ¸è¡°å‡ã€‚TOPK.RESERVE topk:urls 100 2000 7 0.9# è¿”å›å€¼OK# éªŒè¯ç±»å‹type topk:urls# è¿”å›å€¼TopK-TYPE æ·»åŠ å…ƒç´  1234567# TOPK.ADD key items [items ...]# ç¤ºä¾‹# å«ä¹‰ï¼šæ·»åŠ å…ƒç´  &quot;a&quot; å’Œ &quot;b&quot; åˆ° TopK ä¸­TOPK.ADD topk:urls a b# è¿”å›å€¼ï¼Œè¢«æŒ¤å‡º TopK çš„å…ƒç´ ï¼ˆå¦‚æœæœ‰ï¼‰1) (nil)2) (nil) å¢åŠ å…ƒç´ çš„é¢‘ç‡ 123456# TOPK.INCRBY key item increment [item increment ...]# ç¤ºä¾‹# å«ä¹‰ï¼šå°†å…ƒç´  &quot;a&quot; çš„é¢‘ç‡å¢åŠ  1TOPK.INCRBY topk:urls a 1# è¾“å‡ºç»“æœ1) (nil) æŸ¥è¯¢å…ƒç´ æ˜¯å¦åœ¨ TopK ä¸­ 123456# TOPK.QUERY key item [item ...]# ç¤ºä¾‹# å«ä¹‰ï¼šæŸ¥è¯¢å…ƒç´  &quot;a&quot; æ˜¯å¦åœ¨ TopK ä¸­TOPK.QUERY topk:urls a# è¿”å›å€¼1) (integer) 1 # 1 è¡¨ç¤ºå…ƒç´  &quot;a&quot; åœ¨ TopK ä¸­ï¼Œ0 è¡¨ç¤ºå…ƒç´  &quot;a&quot; ä¸åœ¨ TopK ä¸­ è·å– TopK ä¸­çš„å…ƒç´  1234567891011# TOPK.LIST key [WITHCOUNT]# å‚æ•°è¯´æ˜# WITHCOUNT: æ˜¯å¦è¿”å›æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸è¿”å›# ç¤ºä¾‹# å«ä¹‰ï¼šè·å– TopK ä¸­çš„å…ƒç´ ï¼Œå¹¶è¿”å›æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°TOPK.LIST topk:urls WITHCOUNT# è¾“å‡ºç»“æœ1) &quot;a&quot;2) (integer) 23) &quot;b&quot;4) (integer) 1 è·å–è¿‘ä¼¼è®¡æ•° 123456# TOPK.COUNT key item [item ...]# ç¤ºä¾‹# å«ä¹‰ï¼šè·å–å…ƒç´  &quot;a&quot; çš„è¿‘ä¼¼è®¡æ•°TOPK.COUNT topk:urls a# è¾“å‡ºç»“æœ1) (integer) 2 æŸ¥çœ‹TopK çš„çŠ¶æ€ 12345678910111213# TOPK.INFO key# ç¤ºä¾‹# å«ä¹‰ï¼šæŸ¥çœ‹ TopK çš„çŠ¶æ€TOPK.INFO topk:urls# è¾“å‡ºç»“æœ1) k # topk çš„å¤§å°2) (integer) 1003) width # å†…éƒ¨ CMS çš„å®½åº¦4) (integer) 20005) depth # å†…éƒ¨ CMS çš„æ·±åº¦6) (integer) 77) decay # è¡°å‡å› å­8) &quot;0.9&quot; TopK çš„è¡°å‡ï¼ˆdecayï¼‰å‚æ•°æ€ä¹ˆç†è§£ decay ç”¨äºè§£å†³ä¸€ä¸ªé—®é¢˜ï¼šâ€œè€çƒ­ç‚¹æ°¸è¿œéœ¸æ¦œï¼Œæ–°çƒ­ç‚¹ä¸Šä¸æ¥â€ decay è¡Œä¸º 1.0 æ°¸ä¸è¡°å‡ï¼ˆå…¨å†å²ç»Ÿè®¡ï¼‰ 0.9 è¶Šè€çš„æ•°æ®æƒé‡è¶Šä½ 0.5 çƒ­ç‚¹æ›´æ–°éå¸¸å¿« ç»éªŒå€¼ï¼š å®æ—¶çƒ­ç‚¹ï¼š0.8 ~ 0.9 é•¿å‘¨æœŸæ¦œå•ï¼š0.95 ~ 1.0 CMS å’Œ TopK ç»„åˆä½¿ç”¨åœºæ™¯ ğŸ“Œåœºæ™¯1ï¼š å®æ—¶çƒ­æœæ¦œï¼ˆæœ€ç»å…¸ç»„åˆï¼‰ éœ€æ±‚ï¼šç»Ÿè®¡æ‰€æœ‰æœç´¢è¯é¢‘æ¬¡ï¼ˆCMSï¼‰ï¼ŒåŒæ—¶å®æ—¶å‡ºTOP10çƒ­æœï¼ˆTOPKï¼‰ï¼Œæ—¢çŸ¥çƒ­åº¦åˆèƒ½æ’åº 1234567891011121314151617181920212223242526# 1. åˆå§‹åŒ–CMSï¼ˆç»Ÿè®¡å…¨é‡æœç´¢è¯è®¡æ•°ï¼Œè¯¯å·®0.001ï¼‰cms.initbyprob search_count 0.001 0.01# 2. åˆå§‹åŒ–TOPKï¼ˆå–TOP10çƒ­æœï¼‰topk.reserve search_top10 10# 3. ç”¨æˆ·æœç´¢æ ¸å¿ƒæ“ä½œï¼ˆ2å‘½ä»¤å¿…ä¸€èµ·æ‰§è¡Œï¼‰# æœç´¢&quot;å‘¨æ°ä¼¦&quot;ï¼ŒCMSè®¡æ•°+1ï¼ŒåŒæ—¶å½•å…¥TOPKï¼ˆè‡ªåŠ¨ç´¯åŠ çƒ­åº¦ï¼‰cms.incrby search_count å‘¨æ°ä¼¦ 1topk.incrby search_top10 å‘¨æ°ä¼¦ 1cms.incrby search_count åŸç¥ 1topk.incrby search_top10 åŸç¥ 1cms.incrby search_count å‘¨æ°ä¼¦ 1 # é‡å¤æœç´¢ï¼ŒåŒç«¯åŒæ­¥+1topk.incrby search_top10 å‘¨æ°ä¼¦ 1# 4. æ ¸å¿ƒæŸ¥è¯¢ï¼šå…ˆå–TOP10ï¼Œå†æŸ¥ç²¾å‡†è®¡æ•°ï¼ˆç»„åˆæ ¸å¿ƒï¼‰# ç¬¬ä¸€æ­¥ï¼šå–TOP10çƒ­æœåˆ—è¡¨topk.list search_top10 # è¿”å›ï¼šå‘¨æ°ä¼¦ã€åŸç¥...# ç¬¬äºŒæ­¥ï¼šæŸ¥çƒ­æœè¯ç²¾å‡†è¿‘ä¼¼è®¡æ•°ï¼ˆCMSæ¯”TOPK.countæ›´å‡†ï¼‰cms.query search_count å‘¨æ°ä¼¦ # è¿”å›2ï¼ˆç²¾å‡†ï¼‰topk.count search_top10 å‘¨æ°ä¼¦ # å‚è€ƒå€¼ï¼Œä¼˜å…ˆç”¨CMSç»“æœ# 5. è¾…åŠ©æŸ¥è¯¢ï¼šåˆ¤æ–­è¯æ˜¯å¦åœ¨çƒ­æœæ¦œtopk.query search_top10 å‘¨æ°ä¼¦ # 1=åœ¨ï¼Œ0=ä¸åœ¨ TopK vs ZSET èƒ½åŠ›è¾¹ç•Œå¯¹æ¯” èƒ½åŠ› TopK ZSet æ˜¯å¦è¿‘ä¼¼ âœ”ï¸ æ˜¯ âŒ å¦ æ˜¯å¦ä¿å­˜å…¨éƒ¨å…ƒç´  âŒ åªä¿å­˜ Top K âœ”ï¸ ä¿å­˜å…¨éƒ¨ é¢‘æ¬¡æ˜¯å¦ç²¾ç¡® âŒ ä¼°è®¡ âœ”ï¸ ç²¾ç¡® æ˜¯å¦æ”¯æŒæ’åº âš ï¸ ä»… Top K âœ”ï¸ å…¨é‡æ’åº æ˜¯å¦å¯éå† âŒ ä»… K ä¸ª âœ”ï¸ å…¨é‡ æ˜¯å¦æ”¯æŒåˆ é™¤ âŒ ä¸æ”¯æŒ âœ”ï¸ æ”¯æŒ æ˜¯å¦æ”¯æŒèŒƒå›´æŸ¥è¯¢ âŒ âœ”ï¸ Top N æŸ¥è¯¢ âœ”ï¸ åŸç”Ÿ âœ”ï¸ æ€§èƒ½ä¸ååé‡å¯¹æ¯” ç»´åº¦ TopK ZSet å†™å…¥å¤æ‚åº¦ O(d) O(log N) é«˜å¹¶å‘å†™å…¥ æä¼˜ ä¸€èˆ¬ æŸ¥è¯¢ TopK O(K) O(K) æŸ¥è¯¢å•å…ƒç´ é¢‘æ¬¡ O(d) O(1) æ‰¹é‡å†™å…¥ æå¿« è¾ƒæ…¢","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ TopK æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisBloom çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•","date_published":"2025-12-23T06:50:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-13-CMS/","url":"https://blog.hanqunfeng.com/2025/12/23/redis7-datatype-13-CMS/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch)","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Count-Min Sketch æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\">RedisBloom çš„å®‰è£…å‚è§ <a href=\"/2025/12/21/redis7-module-RedisBloom/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Count-Min-Sketch\">Count-Min Sketch</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Count-Min Sketchï¼ˆCMSï¼‰ ç”¨äºåœ¨æä½å†…å­˜å ç”¨ä¸‹ï¼Œå¯¹é«˜é¢‘å†™å…¥çš„è®¡æ•°å‹æ•°æ®è¿›è¡Œè¿‘ä¼¼ç»Ÿè®¡ï¼Œéå¸¸é€‚åˆæµé‡ã€äº‹ä»¶ã€å…³é”®è¯ç­‰â€œåªå…³å¿ƒé¢‘æ¬¡è§„æ¨¡ã€ä¸è¦æ±‚ç²¾ç¡®å€¼â€çš„åœºæ™¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Count-Min Sketch æ˜¯ä¸€ç§åŸºäºå“ˆå¸Œçš„æ¦‚ç‡å‹è®¡æ•°ç»“æ„ï¼Œç”¨äºä¼°ç®—å…ƒç´ å‡ºç°æ¬¡æ•°ï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹å¾ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åªä¼šé«˜ä¼°ï¼Œä¸ä¼šä½ä¼°ï¼ˆover-estimationï¼‰</li>\n<li class=\"lvl-6\">å›ºå®šå†…å­˜ï¼Œä¸å…ƒç´ ç§ç±»æ•°æ— å…³</li>\n<li class=\"lvl-6\">O(1) çš„æ›´æ–°ä¸æŸ¥è¯¢å¤æ‚åº¦</li>\n<li class=\"lvl-6\">ä¸æ”¯æŒåˆ é™¤ï¼ˆæˆ–åªèƒ½è¿‘ä¼¼åˆ é™¤ï¼‰</li>\n<li class=\"lvl-6\">åªèƒ½è¿”å›ç»™å®šå…ƒç´ è¿‘ä¼¼ç»Ÿè®¡å…¶é¢‘æ¬¡ï¼Œè€Œæ— æ³•è¿”å›å…¨éƒ¨å…ƒç´ çš„ç»Ÿè®¡é¢‘æ¬¡</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åŸºæœ¬å·¥ä½œåŸç†ï¼ˆç®€åŒ–ç‰ˆï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.åˆå§‹åŒ–ä¸€ä¸ªäºŒç»´æ•°ç»„ counter[d][w]</span><br><span class=\"line\">2.å¯¹æ¯ä¸ªå…ƒç´  xï¼š</span><br><span class=\"line\">    a. é€šè¿‡ d ä¸ªå“ˆå¸Œå‡½æ•°æ˜ å°„åˆ° d è¡Œä¸­çš„ w ä¸ªä½ç½®</span><br><span class=\"line\">    b. å¯¹å¯¹åº”çš„ d ä¸ªè®¡æ•°å™¨å…¨éƒ¨ +1</span><br><span class=\"line\">3.æŸ¥è¯¢å…ƒç´  x çš„é¢‘æ¬¡ï¼š</span><br><span class=\"line\">    a.å–è¿™ d ä¸ªè®¡æ•°å™¨çš„ æœ€å°å€¼(å–æœ€å°å€¼æ˜¯ä¸ºäº†å°½é‡æŠµæ¶ˆå“ˆå¸Œå†²çªå¸¦æ¥çš„â€œå¤šåŠ â€)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æ³¨æ„ä¸‹å›¾ä¸­çš„æ•°ç»„ä¸æ˜¯äºŒè¿›åˆ¶çš„ï¼Œæ¯æ¬¡æ˜ å°„éƒ½ä¼š+1<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/Ybl5tj.png\" alt=\"\"></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯¯å·®ä¸ç©ºé—´å¤æ‚åº¦</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>è¯¯å·®ä¸Šç•Œ</td>\n<td>â‰¤ Îµ Ã— æ€»æ’å…¥æ¬¡æ•°</td>\n</tr>\n<tr>\n<td>é”™è¯¯æ¦‚ç‡</td>\n<td>â‰¤ Î´</td>\n</tr>\n<tr>\n<td>ç©ºé—´å¤æ‚åº¦</td>\n<td>O(1 / Îµ Ã— log(1 / Î´))</td>\n</tr>\n<tr>\n<td>æŸ¥è¯¢å¤æ‚åº¦</td>\n<td>O(d)</td>\n</tr>\n<tr>\n<td>æ›´æ–°å¤æ‚åº¦</td>\n<td>O(d)</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ç»“è®ºï¼šæ•°æ®é‡å†å¤§ï¼Œå†…å­˜ä¸å¢é•¿ï¼Œä»£ä»·æ˜¯â€œç²¾åº¦æ¢ç©ºé—´â€</p>\n</blockquote>\n<h2 id=\"RedisBloom-ä¸­-CMS-çš„æ ¸å¿ƒå‘½ä»¤\">RedisBloom ä¸­ CMS çš„æ ¸å¿ƒå‘½ä»¤</h2>\n<h3 id=\"åˆ›å»º-CMS\">åˆ›å»º CMS</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‰åº•å±‚ç»´åº¦åˆå§‹åŒ–</span></span><br><span class=\"line\"><span class=\"comment\"># CMS.INITBYDIM key width depth</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># width (w)ï¼šæ¯ä¸€è¡Œçš„æ¡¶æ•°ï¼ˆå½±å“è¯¯å·®ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># depth (d)ï¼šå“ˆå¸Œå‡½æ•°æ•°é‡ï¼ˆå½±å“å†²çªæ¦‚ç‡ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># æ¯”å¦‚ï¼š</span></span><br><span class=\"line\">CMS.INITBYDIM page:view 1000 10</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯ç±»å‹</span></span><br><span class=\"line\"><span class=\"built_in\">type</span> page:view</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼</span></span><br><span class=\"line\">CMSk-TYPE</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‰è¯¯å·®+å®¹é‡åˆå§‹åŒ–</span></span><br><span class=\"line\"><span class=\"comment\"># CMS.INITBYPROB page:view error probability</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># error (Îµ)ï¼šè¯¯å·®ä¸Šç•Œ</span></span><br><span class=\"line\"><span class=\"comment\"># probability (Î´)ï¼šè¶…è¿‡è¯¯å·®ä¸Šç•Œçš„æ¦‚ç‡ï¼Œè¿™ä¸ªæ•°å­—è¶Šæ¥è¿‘é›¶ï¼Œæ¯ä¸ªé¡¹ç›®çš„å†…å­˜æ¶ˆè€—å°±è¶Šå¤§ï¼Œæ¯æ¬¡æ“ä½œçš„CPUä½¿ç”¨å°±è¶Šå¤šã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># RedisBloom ä¼šè‡ªåŠ¨æ¢ç®— w å’Œ d</span></span><br><span class=\"line\"><span class=\"comment\"># æ¯”å¦‚ï¼š</span></span><br><span class=\"line\">CMS.INITBYPROB key 0.001 0.01</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æ•°å€¼</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>error</code></td>\n<td><code>0.001</code></td>\n<td>æœ€å¤§ç›¸å¯¹è¯¯å·® Îµ = 0.1%</td>\n</tr>\n<tr>\n<td><code>probability</code></td>\n<td><code>0.01</code></td>\n<td>åªæœ‰ 1% çš„æ¦‚ç‡è¶…è¿‡è¯¥è¯¯å·®</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å¢åŠ è®¡æ•°\">å¢åŠ è®¡æ•°</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># CMS.INCRBY key item1 count1 item2 count2 ...</span></span><br><span class=\"line\">CMS.INCRBY page:view home 1 about 1 home 1</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">3) (<span class=\"built_in\">integer</span>) 2</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥è¯¢è®¡æ•°\">æŸ¥è¯¢è®¡æ•°</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># CMS.QUERY key item1 item2 ...</span></span><br><span class=\"line\">CMS.QUERY page:view home about</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›çš„æ˜¯ ä¼°ç®—å€¼ï¼ˆå¯èƒ½åå¤§ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 1</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆå¹¶-CMS\">åˆå¹¶ CMS</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># CMS.MERGE dest numkeys src1 src2 ... WEIGHTS w1 w2 ...</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># destï¼šç›®æ ‡ CMSï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\"># numkeysï¼šæº CMS æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># src1 src2 ...ï¼šæº CMSï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\"># WEIGHTS w1 w2 ...ï¼šæº CMS æƒé‡</span></span><br><span class=\"line\">CMS.MERGE page:view 2 page:view:1 page:view:2 WEIGHTS 1 1</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure>\n<h3 id=\"è·å–-CMS-çš„ä¿¡æ¯\">è·å– CMS çš„ä¿¡æ¯</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># CMS.INFO key</span></span><br><span class=\"line\">CMS.INFO page:view</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) width            <span class=\"comment\"># æ¯ä¸€è¡Œæ¡¶æ•° w</span></span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 1000</span><br><span class=\"line\">3) depth            <span class=\"comment\"># å“ˆå¸Œå‡½æ•°æ•°é‡ d</span></span><br><span class=\"line\">4) (<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\">5) count            <span class=\"comment\"># å½“å‰å·²æ’å…¥çš„å…ƒç´ æ•°é‡</span></span><br><span class=\"line\">6) (<span class=\"built_in\">integer</span>) 3</span><br></pre></td></tr></table></figure>\n<h2 id=\"CMS-çš„ä½¿ç”¨åœºæ™¯\">CMS çš„ä½¿ç”¨åœºæ™¯</h2>\n<h3 id=\"åœºæ™¯1ï¼šç½‘ç«™PVç»Ÿè®¡\">åœºæ™¯1ï¼šç½‘ç«™PVç»Ÿè®¡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éœ€æ±‚ï¼šç»Ÿè®¡ç½‘ç«™ PVï¼Œå³é¡µé¢è¢«è®¿é—®çš„æ¬¡æ•°ï¼Œå…è®¸0.1%çš„è¯¯å·®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆå§‹åŒ– CMS</span></span><br><span class=\"line\">CMS.INITBYPROB page:pv 0.001 0.01</span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ è®¡æ•°</span></span><br><span class=\"line\">CMS.INCRBY page:pv /home 1 /about 1</span><br><span class=\"line\">CMS.INCRBY page:pv /home 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢è®¡æ•°</span></span><br><span class=\"line\">CMS.QUERY page:pv /home</span><br></pre></td></tr></table></figure>\n<h3 id=\"åœºæ™¯2ï¼šæ¥å£è°ƒç”¨é¢‘æ¬¡é™æµå‰ç½®ç»Ÿè®¡\">åœºæ™¯2ï¼šæ¥å£è°ƒç”¨é¢‘æ¬¡é™æµå‰ç½®ç»Ÿè®¡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éœ€æ±‚ï¼šç»Ÿè®¡æ¥å£è°ƒç”¨æ¬¡æ•°ï¼Œä¸ºé™æµæä¾›å·²ç»ï¼Œä¸éœ€è¦ç²¾å‡†è®¡æ•°ï¼Œå…è®¸0.1%çš„è¯¯å·®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º CMS</span></span><br><span class=\"line\">CMS.INITBYPROB api:<span class=\"built_in\">limit</span> 0.001 0.01</span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ è®¡æ•°</span></span><br><span class=\"line\">CMS.INCRBY api:<span class=\"built_in\">limit</span> /api/user/list 1</span><br><span class=\"line\"><span class=\"comment\"># è·å–è®¡æ•°</span></span><br><span class=\"line\">CMS.QUERY api:<span class=\"built_in\">limit</span> /api/user/list</span><br></pre></td></tr></table></figure>\n<h2 id=\"CMS-vs-ZSET\">CMS vs ZSET</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èƒ½åŠ›è¾¹ç•Œå¯¹æ¯”</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>èƒ½åŠ›</th>\n<th>CMS</th>\n<th>ZSet</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é¢‘æ¬¡ç»Ÿè®¡</td>\n<td>âœ”ï¸ è¿‘ä¼¼</td>\n<td>âœ”ï¸ ç²¾ç¡®</td>\n</tr>\n<tr>\n<td>æ˜¯å¦å­˜å…ƒç´ </td>\n<td>âŒ ä¸å­˜</td>\n<td>âœ”ï¸ å­˜</td>\n</tr>\n<tr>\n<td>æ˜¯å¦å¯éå†å…ƒç´ </td>\n<td>âŒ ä¸å¯</td>\n<td>âœ”ï¸ å¯</td>\n</tr>\n<tr>\n<td>TopK / æ’è¡Œ</td>\n<td>âŒï¼ˆéœ€é…åˆ TopKï¼‰</td>\n<td>âœ”ï¸ å¤©ç„¶æ”¯æŒ</td>\n</tr>\n<tr>\n<td>åˆ é™¤å…ƒç´ </td>\n<td>âŒ ä¸æ”¯æŒ</td>\n<td>âœ”ï¸ æ”¯æŒ</td>\n</tr>\n<tr>\n<td>è¯¯åˆ¤ / è¯¯å·®</td>\n<td>âœ”ï¸ å­˜åœ¨</td>\n<td>âŒ æ— </td>\n</tr>\n<tr>\n<td>æ˜¯å¦å¯é€†ï¼ˆæŸ¥æˆå‘˜ï¼‰</td>\n<td>âŒ ä¸å¯é€†</td>\n<td>âœ”ï¸ å¯é€†</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ€§èƒ½ç‰¹å¾å¯¹æ¯”</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ“ä½œ</th>\n<th>CMS</th>\n<th>ZSet</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ’å…¥ / è®¡æ•°</td>\n<td>O(d)ï¼ˆå¸¸æ•°çº§ï¼‰</td>\n<td>O(log N)</td>\n</tr>\n<tr>\n<td>æŸ¥è¯¢é¢‘æ¬¡</td>\n<td>O(d)</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>æ’åæŸ¥è¯¢</td>\n<td>âŒ</td>\n<td>O(log N)</td>\n</tr>\n<tr>\n<td>æ‰¹é‡å†™å…¥</td>\n<td>æå¿«</td>\n<td>ä¸­ç­‰</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Count-Min Sketch æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisBloom çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³• Count-Min Sketch Count-Min Sketchï¼ˆCMSï¼‰ ç”¨äºåœ¨æä½å†…å­˜å ç”¨ä¸‹ï¼Œå¯¹é«˜é¢‘å†™å…¥çš„è®¡æ•°å‹æ•°æ®è¿›è¡Œè¿‘ä¼¼ç»Ÿè®¡ï¼Œéå¸¸é€‚åˆæµé‡ã€äº‹ä»¶ã€å…³é”®è¯ç­‰â€œåªå…³å¿ƒé¢‘æ¬¡è§„æ¨¡ã€ä¸è¦æ±‚ç²¾ç¡®å€¼â€çš„åœºæ™¯ã€‚ Count-Min Sketch æ˜¯ä¸€ç§åŸºäºå“ˆå¸Œçš„æ¦‚ç‡å‹è®¡æ•°ç»“æ„ï¼Œç”¨äºä¼°ç®—å…ƒç´ å‡ºç°æ¬¡æ•°ï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹å¾ï¼š åªä¼šé«˜ä¼°ï¼Œä¸ä¼šä½ä¼°ï¼ˆover-estimationï¼‰ å›ºå®šå†…å­˜ï¼Œä¸å…ƒç´ ç§ç±»æ•°æ— å…³ O(1) çš„æ›´æ–°ä¸æŸ¥è¯¢å¤æ‚åº¦ ä¸æ”¯æŒåˆ é™¤ï¼ˆæˆ–åªèƒ½è¿‘ä¼¼åˆ é™¤ï¼‰ åªèƒ½è¿”å›ç»™å®šå…ƒç´ è¿‘ä¼¼ç»Ÿè®¡å…¶é¢‘æ¬¡ï¼Œè€Œæ— æ³•è¿”å›å…¨éƒ¨å…ƒç´ çš„ç»Ÿè®¡é¢‘æ¬¡ åŸºæœ¬å·¥ä½œåŸç†ï¼ˆç®€åŒ–ç‰ˆï¼‰ 1234561.åˆå§‹åŒ–ä¸€ä¸ªäºŒç»´æ•°ç»„ counter[d][w]2.å¯¹æ¯ä¸ªå…ƒç´  xï¼š a. é€šè¿‡ d ä¸ªå“ˆå¸Œå‡½æ•°æ˜ å°„åˆ° d è¡Œä¸­çš„ w ä¸ªä½ç½® b. å¯¹å¯¹åº”çš„ d ä¸ªè®¡æ•°å™¨å…¨éƒ¨ +13.æŸ¥è¯¢å…ƒç´  x çš„é¢‘æ¬¡ï¼š a.å–è¿™ d ä¸ªè®¡æ•°å™¨çš„ æœ€å°å€¼(å–æœ€å°å€¼æ˜¯ä¸ºäº†å°½é‡æŠµæ¶ˆå“ˆå¸Œå†²çªå¸¦æ¥çš„â€œå¤šåŠ â€) æ³¨æ„ä¸‹å›¾ä¸­çš„æ•°ç»„ä¸æ˜¯äºŒè¿›åˆ¶çš„ï¼Œæ¯æ¬¡æ˜ å°„éƒ½ä¼š+1 è¯¯å·®ä¸ç©ºé—´å¤æ‚åº¦ ç»´åº¦ è¯´æ˜ è¯¯å·®ä¸Šç•Œ â‰¤ Îµ Ã— æ€»æ’å…¥æ¬¡æ•° é”™è¯¯æ¦‚ç‡ â‰¤ Î´ ç©ºé—´å¤æ‚åº¦ O(1 / Îµ Ã— log(1 / Î´)) æŸ¥è¯¢å¤æ‚åº¦ O(d) æ›´æ–°å¤æ‚åº¦ O(d) ç»“è®ºï¼šæ•°æ®é‡å†å¤§ï¼Œå†…å­˜ä¸å¢é•¿ï¼Œä»£ä»·æ˜¯â€œç²¾åº¦æ¢ç©ºé—´â€ RedisBloom ä¸­ CMS çš„æ ¸å¿ƒå‘½ä»¤ åˆ›å»º CMS 1234567891011121314151617181920212223# æŒ‰åº•å±‚ç»´åº¦åˆå§‹åŒ–# CMS.INITBYDIM key width depth# å‚æ•°è¯´æ˜# width (w)ï¼šæ¯ä¸€è¡Œçš„æ¡¶æ•°ï¼ˆå½±å“è¯¯å·®ï¼‰# depth (d)ï¼šå“ˆå¸Œå‡½æ•°æ•°é‡ï¼ˆå½±å“å†²çªæ¦‚ç‡ï¼‰# æ¯”å¦‚ï¼šCMS.INITBYDIM page:view 1000 10# è¾“å‡ºOK# éªŒè¯ç±»å‹type page:view# è¿”å›å€¼CMSk-TYPE# æŒ‰è¯¯å·®+å®¹é‡åˆå§‹åŒ–# CMS.INITBYPROB page:view error probability# å‚æ•°è¯´æ˜# error (Îµ)ï¼šè¯¯å·®ä¸Šç•Œ# probability (Î´)ï¼šè¶…è¿‡è¯¯å·®ä¸Šç•Œçš„æ¦‚ç‡ï¼Œè¿™ä¸ªæ•°å­—è¶Šæ¥è¿‘é›¶ï¼Œæ¯ä¸ªé¡¹ç›®çš„å†…å­˜æ¶ˆè€—å°±è¶Šå¤§ï¼Œæ¯æ¬¡æ“ä½œçš„CPUä½¿ç”¨å°±è¶Šå¤šã€‚# RedisBloom ä¼šè‡ªåŠ¨æ¢ç®— w å’Œ d# æ¯”å¦‚ï¼šCMS.INITBYPROB key 0.001 0.01 å‚æ•° æ•°å€¼ è¯´æ˜ error 0.001 æœ€å¤§ç›¸å¯¹è¯¯å·® Îµ = 0.1% probability 0.01 åªæœ‰ 1% çš„æ¦‚ç‡è¶…è¿‡è¯¥è¯¯å·® å¢åŠ è®¡æ•° 123456# CMS.INCRBY key item1 count1 item2 count2 ...CMS.INCRBY page:view home 1 about 1 home 1# è¾“å‡º1) (integer) 12) (integer) 13) (integer) 2 æŸ¥è¯¢è®¡æ•° 123456# CMS.QUERY key item1 item2 ...CMS.QUERY page:view home about# è¿”å›çš„æ˜¯ ä¼°ç®—å€¼ï¼ˆå¯èƒ½åå¤§ï¼‰# è¾“å‡º1) (integer) 22) (integer) 1 åˆå¹¶ CMS 123456789# CMS.MERGE dest numkeys src1 src2 ... WEIGHTS w1 w2 ...# å‚æ•°è¯´æ˜# destï¼šç›®æ ‡ CMSï¼Œå¿…é¡»å­˜åœ¨# numkeysï¼šæº CMS æ•°é‡# src1 src2 ...ï¼šæº CMSï¼Œå¿…é¡»å­˜åœ¨# WEIGHTS w1 w2 ...ï¼šæº CMS æƒé‡CMS.MERGE page:view 2 page:view:1 page:view:2 WEIGHTS 1 1# è¾“å‡ºOK è·å– CMS çš„ä¿¡æ¯ 123456789# CMS.INFO keyCMS.INFO page:view# è¾“å‡º1) width # æ¯ä¸€è¡Œæ¡¶æ•° w2) (integer) 10003) depth # å“ˆå¸Œå‡½æ•°æ•°é‡ d4) (integer) 105) count # å½“å‰å·²æ’å…¥çš„å…ƒç´ æ•°é‡6) (integer) 3 CMS çš„ä½¿ç”¨åœºæ™¯ åœºæ™¯1ï¼šç½‘ç«™PVç»Ÿè®¡ éœ€æ±‚ï¼šç»Ÿè®¡ç½‘ç«™ PVï¼Œå³é¡µé¢è¢«è®¿é—®çš„æ¬¡æ•°ï¼Œå…è®¸0.1%çš„è¯¯å·® 12345678# åˆå§‹åŒ– CMSCMS.INITBYPROB page:pv 0.001 0.01# æ·»åŠ è®¡æ•°CMS.INCRBY page:pv /home 1 /about 1CMS.INCRBY page:pv /home 1# æŸ¥è¯¢è®¡æ•°CMS.QUERY page:pv /home åœºæ™¯2ï¼šæ¥å£è°ƒç”¨é¢‘æ¬¡é™æµå‰ç½®ç»Ÿè®¡ éœ€æ±‚ï¼šç»Ÿè®¡æ¥å£è°ƒç”¨æ¬¡æ•°ï¼Œä¸ºé™æµæä¾›å·²ç»ï¼Œä¸éœ€è¦ç²¾å‡†è®¡æ•°ï¼Œå…è®¸0.1%çš„è¯¯å·® 123456# åˆ›å»º CMSCMS.INITBYPROB api:limit 0.001 0.01# æ·»åŠ è®¡æ•°CMS.INCRBY api:limit /api/user/list 1# è·å–è®¡æ•°CMS.QUERY api:limit /api/user/list CMS vs ZSET èƒ½åŠ›è¾¹ç•Œå¯¹æ¯” èƒ½åŠ› CMS ZSet é¢‘æ¬¡ç»Ÿè®¡ âœ”ï¸ è¿‘ä¼¼ âœ”ï¸ ç²¾ç¡® æ˜¯å¦å­˜å…ƒç´  âŒ ä¸å­˜ âœ”ï¸ å­˜ æ˜¯å¦å¯éå†å…ƒç´  âŒ ä¸å¯ âœ”ï¸ å¯ TopK / æ’è¡Œ âŒï¼ˆéœ€é…åˆ TopKï¼‰ âœ”ï¸ å¤©ç„¶æ”¯æŒ åˆ é™¤å…ƒç´  âŒ ä¸æ”¯æŒ âœ”ï¸ æ”¯æŒ è¯¯åˆ¤ / è¯¯å·® âœ”ï¸ å­˜åœ¨ âŒ æ—  æ˜¯å¦å¯é€†ï¼ˆæŸ¥æˆå‘˜ï¼‰ âŒ ä¸å¯é€† âœ”ï¸ å¯é€† æ€§èƒ½ç‰¹å¾å¯¹æ¯” æ“ä½œ CMS ZSet æ’å…¥ / è®¡æ•° O(d)ï¼ˆå¸¸æ•°çº§ï¼‰ O(log N) æŸ¥è¯¢é¢‘æ¬¡ O(d) O(1) æ’åæŸ¥è¯¢ âŒ O(log N) æ‰¹é‡å†™å…¥ æå¿« ä¸­ç­‰","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Count-Min Sketch æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisBloom çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•","date_published":"2025-12-23T06:40:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/22/redis7-datatype-12-CF/","url":"https://blog.hanqunfeng.com/2025/12/22/redis7-datatype-12-CF/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CF(Cuckoo Filter)","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Cuckoo Filter æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\">RedisBloom çš„å®‰è£…å‚è§ <a href=\"/2025/12/21/redis7-module-RedisBloom/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li>\n<li class=\"lvl-2\">ç¤ºä¾‹ä»£ç ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/data-type-demo\">GitHub</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Cuckoo-Filterï¼ˆå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼‰\">Cuckoo Filterï¼ˆå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Cuckoo Filter æ˜¯ Bloom Filter çš„æ”¹è¿›ç‰ˆï¼Œæ”¯æŒ åŠ¨æ€æ·»åŠ å’Œåˆ é™¤å…ƒç´ ï¼Œä»èƒ½æä¾›æ¯”å¸ƒéš†è¿‡æ»¤å™¨æ›´é«˜çš„æŸ¥è¯¢æ€§èƒ½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://en.wikipedia.org/wiki/Cuckoo_filter\">ç»´åŸºç™¾ç§‘å¯¹ Cuckoo Filter çš„æè¿°</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨é«˜ QPS æŸ¥è¯¢åœºæ™¯ä¸‹ï¼ŒCuckoo Filter é€šå¸¸ä¼˜äº Bloom Filterã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¼˜ç‚¹ï¼šä½è¯¯åˆ¤ç‡ + é«˜è´Ÿè½½ç‡ï¼ŒåŸºäºç›¸åŒçš„é›†åˆå’Œè¯¯æŠ¥ç‡ï¼ŒCuckoo Filteré€šå¸¸å ç”¨ç©ºé—´æ›´å°‘ã€‚ç›¸å¯¹çš„ï¼Œç®—æ³•å®ç°ä¹Ÿå°±æ›´å¤æ‚ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¼ºç‚¹ï¼šä¸Bloom Filterä¸€æ ·ï¼Œæœ‰å¯èƒ½å°†ä¸€ä¸ªä¸åœ¨é›†åˆä¸­çš„å…ƒç´ é”™è¯¯çš„åˆ¤æ–­æˆåœ¨é›†åˆä¸­</p>\n</li>\n<li class=\"lvl-2\">\n<p>Bloom Filter çš„è¯¯æŠ¥ç‡é€šè¿‡è°ƒæ•´<code>ä½æ•°ç»„çš„å¤§å°</code>å’Œ<code>å“ˆå¸Œå‡½æ•°æ•°é‡</code>æ¥æ§åˆ¶ï¼Œè€Œ Cuckoo Filter çš„è¯¯æŠ¥ç‡å—<code>æŒ‡çº¹å¤§å°</code>å’Œ<code>æ¡¶å¤§å°</code>æ§åˆ¶ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å¸ƒè°·å“ˆå¸Œç®—æ³•\">å¸ƒè°·å“ˆå¸Œç®—æ³•</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://baike.baidu.com/item/Cockoo%20hash/3022855\">ç™¾åº¦ç™¾ç§‘å¯¹å¸ƒè°·å“ˆå¸Œç®—æ³•çš„æè¿°</a>]</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç®—æ³•ä½¿ç”¨ä¸¤ä¸ªä¸åŒå“ˆå¸Œå‡½æ•°è®¡ç®—å¯¹åº” key çš„ä½ç½®ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<ol>\n<li class=\"lvl-9\">å½“ä¸¤ä¸ªå“ˆå¸Œä»»æ„ä½ç½®ä¸ºç©ºï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªä½ç½®æ’å…¥</li>\n</ol>\n</li>\n<li class=\"lvl-6\">\n<ol start=\"2\">\n<li class=\"lvl-9\">å½“ä¸¤ä¸ªå“ˆå¸Œæœ‰ä½ç½®ä¸ºç©ºæ—¶ï¼Œåˆ™æ’å…¥åˆ°ç©ºä½ç½®</li>\n</ol>\n</li>\n<li class=\"lvl-6\">\n<ol start=\"3\">\n<li class=\"lvl-9\">å½“ä¸¤ä¸ªå“ˆå¸Œä½ç½®å‡ä¸ä¸ºç©ºæ—¶ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªä½ç½®æ’å…¥å¹¶è¸¢å‡ºåŸkeyï¼ŒåŸkeyä¼šå†æ¬¡ç»è¿‡è®¡ç®—è·å¾—æ–°çš„ä½ç½®ï¼Œè½¬è‡³1æ‰§è¡Œï¼Œåå¤ç›´åˆ°æˆåŠŸæˆ–è€…è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Cuckoo-Filter-çš„å®ç°åŸç†\">Cuckoo Filter çš„å®ç°åŸç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸ƒè°·è¿‡æ»¤å™¨ æ˜¯åœ¨<code>å¸ƒè°·å“ˆå¸Œç®—æ³•</code>çš„ç®—æ³•åŸºç¡€ä¸Šæ‰©å……æ¥çš„ï¼Œä½†æ˜¯å®ƒæ‰€æä¾›çš„æ¦‚å¿µä¸æ˜¯è¡¨ï¼Œè€Œæ˜¯æä¾›äº†å¤šä¸ªæ•°æ®æ¡¶(Bucket)</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯ä¸€ä¸ªæ•°æ®æ¡¶éƒ½æ˜¯ä¸ª<code>ä¸€ç»´æ•°ç»„</code>ï¼Œæ¯ä¸ªæ•°ç»„çš„ä¿å­˜å†…å®¹ä¸º<code>æ¡ç›®(Entry)</code>ï¼Œæ¯ä¸€ä¸ªæ¡ç›®é‡Œé¢å¯ä»¥ä¿å­˜ä¸€ä¸ª<code>æŒ‡çº¹æ•°æ®</code>(æŒ‡çº¹æ•°æ®å°±æ˜¯åŸå§‹æ•°æ®ç»è¿‡å“ˆå¸Œè®¡ç®—å¾—åˆ°çš„ä¸€ä¸ªnä½çš„æ•°æ®æ ‡è®°)ï¼Œé™¤äº†æŒ‡çº¹æ•°æ®ä¹‹å¤–ï¼Œè¿˜ä¼šåŒæ—¶å¾—å‡ºä¸€ä¸ª<code>ä¿å­˜ä½ç½®P1æ ‡è®°</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ä¸¤ä¸ªæ•°æ®è®¡ç®—å¾—åˆ°çš„æŒ‡çº¹æ•°æ®ç›¸åŒæ—¶ï¼Œå°±ä¼šå‘ç”Ÿå†²çªï¼Œå†²çªæ“ä½œçš„è§£å†³æ€è·¯æ˜¯ä½¿ç”¨<code>å¸ƒè°·å“ˆå¸Œç®—æ³•</code>ï¼Œç®€å•è¯´å°±æ˜¯æ–°çš„æ•°æ®ä¼šå°†åŸæœ‰æ•°æ®<code>è¸¢å‡º</code>ï¼Œè€Œè¢«è¸¢å‡ºçš„æ•°æ®ä¼šè¢«é‡æ–°è®¡ç®—å¾—åˆ°æ–°çš„æŒ‡çº¹æ•°æ®å’Œä¿å­˜ä½ç½®æ ‡è®°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¸ƒè°·è¿‡æ»¤å™¨é‡Œé¢éœ€è¦è¿›è¡Œå„ç§æ•°æ®çš„<code>è¸¢å‡º</code>æ“ä½œï¼Œè¿™ä¸ªè¸¢å‡ºçš„æ–¹å¼å°±æ˜¯ä½¿ç”¨<code>P1æ ‡å¿—ä½</code>å’Œ<code>æŒ‡çº¹æ•°æ®</code>è¿›è¡Œ<code>å¼‚æˆ–è®¡ç®—</code>å¾—å‡ºæ¥çš„<code>P2æ ‡å¿—ä½</code>ï¼ŒæŒ‰ç…§åŒæ ·çš„æ€è·¯(å‰æ:ä¸€ç›´éƒ½æœ‰å†²çªæ“ä½œ)ä¸€ç›´è®¡ç®—æ–°çš„P2ä½ï¼Œç›´åˆ°å†²çªè§£å†³æˆ–è€…è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œå°±ä¼šå¤±è´¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æŒ‡çº¹æ•°æ®é‡Œé¢åŒ…å«æœ‰<code>å”¯ä¸€æ€§</code>ï¼Œæ‰€ä»¥å¯ä»¥å®ç°æ•°æ®çš„åˆ é™¤ï¼Œå½“ç„¶ï¼Œä¸åŒçš„æ•°æ®è®¡ç®—æ˜¯æœ‰å¯èƒ½å¾—åˆ°ç›¸åŒæŒ‡çº¹çš„ï¼Œé‚£ä¹ˆä¸€æ—¦åˆ é™¤æ•°æ®ä¹‹åï¼Œæœ‰å¯èƒ½é€ æˆæ•°æ®çš„&quot;å‡åˆ é™¤&quot;ï¼Œæ‰€ä»¥å¸ƒè°·è¿‡æ»¤å™¨æœ¬èº«ä¹Ÿæ˜¯å­˜åœ¨æœ‰è¯¯å·®çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Cuckoo Filter ä¸­çš„ <code>BUSKETSIZE</code></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">BUSKETSIZEï¼Œè¡¨ç¤ºæ¯ä¸ªæ¡¶(Busket)ä¸­å­˜æ”¾çš„å…ƒç´ ä¸ªæ•°ï¼Œå³æ¡¶å¤§å°ã€‚</li>\n<li class=\"lvl-6\">Cuckoo Filterçš„æ•°ç»„é‡Œå­˜çš„ä¸æ˜¯ä½ï¼Œè€Œæ˜¯æ¡¶(busket)ï¼Œæ¯ä¸ªæ¡¶é‡Œå¯ä»¥å­˜æ”¾å¤šä¸ªæ•°æ®ã€‚</li>\n<li class=\"lvl-6\">åŒä¸€ä¸ªæ¡¶ä¸­å­˜æ”¾çš„æ•°æ®è¶Šå¤šï¼Œç©ºé—´åˆ©ç”¨ç‡æ›´é«˜ï¼Œç›¸åº”çš„è¯¯åˆ¤ç‡ä¹Ÿå°±è¶Šé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´æ…¢ã€‚</li>\n<li class=\"lvl-6\">Redisçš„CuckooFilterå®ç°ä¸­ï¼ŒBUSKETSIZEåº”è¯¥æ˜¯ä¸€ä¸ªåœ¨1åˆ°255ä¹‹é—´çš„æ•´æ•°ï¼Œé»˜è®¤çš„ BUSKETSIZE æ˜¯ <code>2</code>ã€‚</li>\n<li class=\"lvl-6\">æ¡¶(Busket)ä¸­å¹¶ä¸å®é™…ä¿å­˜æ•°æ®æœ¬èº«ï¼Œè€Œæ˜¯ä¿å­˜æ•°æ®çš„æŒ‡çº¹(fingerprint)ã€‚æŒ‡çº¹è¶Šå°ï¼ŒHASHå†²çªé€ æˆè¯¯åˆ¤çš„å‡ ç‡å°±è¶Šå°ã€‚è¿™ä¸ªå‚æ•°çš„è°ƒæ•´æ¯”è¾ƒå¤æ‚ï¼ŒRedisçš„CuckooFilterä¸­ä¸æ”¯æŒè°ƒæ•´è¿™ä¸ªå‚æ•°ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"CF-å‘½ä»¤è¯´æ˜\">CF å‘½ä»¤è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹åº”Rediså‘½ä»¤ï¼š <code>CF.xxx</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>æ˜¯å¦åˆ›å»º Filter</th>\n<th>å…³é”®å‚æ•°å«ä¹‰</th>\n<th>è¿”å›å€¼</th>\n<th>ç¤ºä¾‹</th>\n<th>ä½¿ç”¨è¦ç‚¹ / å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>CF.RESERVE</strong></td>\n<td>æ˜¾å¼åˆ›å»º Cuckoo Filter</td>\n<td>æ˜¯</td>\n<td><code>capacity</code>ï¼šå®¹é‡(å¿…å¡«)<br><code>BUCKETSIZE</code>ï¼šæ¯ä¸ªæ¡¶é‡Œæœ€å¤šèƒ½æ”¾å¤šå°‘ä¸ª fingerprintï¼ˆæŒ‡çº¹ï¼‰ï¼Œé»˜è®¤ 2(å¤§å¤šæ•°æƒ…å†µä¸‹çš„æœ€ä¼˜è§£)<br><code>MAXITERATIONS</code>ï¼šé‡æ’æ¬¡æ•°ï¼Œè¶Šå¤§æˆåŠŸç‡è¶Šé«˜<br><code>EXPANSION</code>ï¼šæ‰©å®¹å€æ•°ï¼Œé»˜è®¤ 1ï¼ˆä¸æ‰©å®¹ï¼‰</td>\n<td>OK</td>\n<td><code>CF.RESERVE user:cf 100000</code></td>\n<td>âœ… <strong>ç”Ÿäº§æ¨è</strong><br>æ”¯æŒåˆ é™¤ä¸è®¡æ•°</td>\n</tr>\n<tr>\n<td><strong>CF.ADD</strong></td>\n<td>æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œä¸å»é‡</td>\n<td>æ˜¯ ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</td>\n<td><code>item</code>ï¼šå…ƒç´ </td>\n<td>OK</td>\n<td><code>CF.ADD user:cf user_1</code></td>\n<td>è‹¥æ»¡å¯èƒ½å¤±è´¥</td>\n</tr>\n<tr>\n<td><strong>CF.ADDNX</strong></td>\n<td>å…ƒç´ ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ ï¼Œå»é‡</td>\n<td>æ˜¯ ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</td>\n<td><code>item</code></td>\n<td><code>1</code> æ–°å¢<br><code>0</code> å·²å­˜åœ¨</td>\n<td><code>CF.ADDNX user:cf user_1</code></td>\n<td>å¹‚ç­‰å†™å…¥é¦–é€‰</td>\n</tr>\n<tr>\n<td><strong>CF.INSERT</strong></td>\n<td>æ‰¹é‡æ’å…¥</td>\n<td>æ˜¯ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</td>\n<td><code>ITEMS</code>ï¼šå…ƒç´ åˆ—è¡¨</td>\n<td>OK</td>\n<td><code>CF.INSERT user:cf ITEMS u1 u2</code></td>\n<td>é»˜è®¤é…ç½®</td>\n</tr>\n<tr>\n<td><strong>CF.INSERTNX</strong></td>\n<td>æ‰¹é‡æ’å…¥ï¼ˆä¸å­˜åœ¨æ‰åŠ ï¼‰</td>\n<td>æ˜¯</td>\n<td><code>ITEMS</code></td>\n<td><code>0/1</code> åˆ—è¡¨</td>\n<td><code>CF.INSERTNX user:cf ITEMS u1 u2</code></td>\n<td>å¹‚ç­‰ + æ‰¹é‡</td>\n</tr>\n<tr>\n<td><strong>CF.EXISTS</strong></td>\n<td>åˆ¤æ–­å•ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</td>\n<td>å¦</td>\n<td><code>item</code></td>\n<td><code>1</code> å¯èƒ½å­˜åœ¨<br><code>0</code> ä¸å­˜åœ¨</td>\n<td><code>CF.EXISTS user:cf user_1</code></td>\n<td>ä»æœ‰è¯¯åˆ¤</td>\n</tr>\n<tr>\n<td><strong>CF.MEXISTS</strong></td>\n<td>æ‰¹é‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨</td>\n<td>å¦</td>\n<td><code>item...</code></td>\n<td><code>0/1</code> åˆ—è¡¨</td>\n<td><code>CF.MEXISTS user:cf u1 u9</code></td>\n<td>é«˜å¹¶å‘æ¨è</td>\n</tr>\n<tr>\n<td><strong>CF.COUNT</strong></td>\n<td>è¿”å›å…ƒç´ å‡ºç°æ¬¡æ•°</td>\n<td>å¦</td>\n<td><code>item</code></td>\n<td>æ•´æ•°</td>\n<td><code>CF.COUNT user:cf user_1</code></td>\n<td>â­ Bloom æ²¡æœ‰çš„èƒ½åŠ›</td>\n</tr>\n<tr>\n<td><strong>CF.DEL</strong></td>\n<td>åˆ é™¤ä¸€ä¸ªå…ƒç´ </td>\n<td>å¦</td>\n<td><code>item</code></td>\n<td><code>1</code> åˆ é™¤æˆåŠŸ<br><code>0</code> ä¸å­˜åœ¨</td>\n<td><code>CF.DEL user:cf user_1</code></td>\n<td>â­ Bloom ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td><strong><a href=\"http://CF.INFO\">CF.INFO</a></strong></td>\n<td>æŸ¥çœ‹ Filter å…ƒä¿¡æ¯</td>\n<td>å¦</td>\n<td>æ— </td>\n<td>KV åˆ—è¡¨</td>\n<td><code>CF.INFO user:cf</code></td>\n<td>è¿ç»´åˆ†æ</td>\n</tr>\n<tr>\n<td><strong>CF.SCANDUMP</strong></td>\n<td>åˆ†å—å¯¼å‡º Filter</td>\n<td>å¦</td>\n<td><code>iterator</code></td>\n<td><code>iterator + data</code></td>\n<td><code>CF.SCANDUMP user:cf 0</code></td>\n<td>è¿ç§» / å¤‡ä»½</td>\n</tr>\n<tr>\n<td><strong>CF.LOADCHUNK</strong></td>\n<td>ä» dump æ¢å¤ Filter</td>\n<td>æ˜¯</td>\n<td><code>iterator + data</code></td>\n<td>OK</td>\n<td><code>CF.LOADCHUNK user:cf 1 &quot;xxx&quot;</code></td>\n<td>ä¸ SCANDUMP é…åˆ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Bloom-vs-Cuckoo\">Bloom vs Cuckoo</h2>\n<table>\n<thead>\n<tr>\n<th>ç»´åº¦</th>\n<th>Bloom Filter</th>\n<th>Cuckoo Filter</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æŸ¥è¯¢å¤æ‚åº¦</td>\n<td>O(k)ï¼ˆk ä¸ªå“ˆå¸Œå‡½æ•°ï¼‰</td>\n<td>O(1)ï¼ˆ2â€“4 æ¬¡ bucket è®¿é—®ï¼‰</td>\n</tr>\n<tr>\n<td>æ’å…¥å¤æ‚åº¦</td>\n<td>O(k)</td>\n<td>å¹³å‡ O(1)ï¼Œæœ€åå¯èƒ½è§¦å‘é‡æ’</td>\n</tr>\n<tr>\n<td>åˆ é™¤æ”¯æŒ</td>\n<td>âŒ åŸç”Ÿä¸æ”¯æŒ</td>\n<td>âœ… åŸç”Ÿæ”¯æŒ</td>\n</tr>\n<tr>\n<td>è¯¯åˆ¤ç‡ï¼ˆFalse Positiveï¼‰</td>\n<td>å¯é…ç½®ï¼Œç¨³å®š</td>\n<td>å¯é…ç½®ï¼Œé€šå¸¸æ›´ä½</td>\n</tr>\n<tr>\n<td>æ¼åˆ¤ï¼ˆFalse Negativeï¼‰</td>\n<td>âŒ ç†è®ºä¸Šä¸ä¼š</td>\n<td>âŒ ç†è®ºä¸Šä¸ä¼š</td>\n</tr>\n<tr>\n<td>ç©ºé—´åˆ©ç”¨ç‡</td>\n<td>é«˜ï¼ˆä½†å— k å½±å“ï¼‰</td>\n<td>é€šå¸¸æ›´é«˜ï¼ˆç‰¹åˆ«æ˜¯ä½è¯¯åˆ¤ç‡ï¼‰</td>\n</tr>\n<tr>\n<td>æ‰©å®¹æˆæœ¬</td>\n<td>é«˜ï¼ˆéœ€é‡å»ºï¼‰</td>\n<td>ä¸­ç­‰ï¼ˆæ”¯æŒæ‰©å±•ç­–ç•¥ï¼‰</td>\n</tr>\n<tr>\n<td>å®ç°å¤æ‚åº¦</td>\n<td>ä½</td>\n<td>è¾ƒé«˜</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>RedisBloom Cuckoo Filter ä¸æ”¯æŒè®¾ç½® <code>è¯¯åˆ¤ç‡</code>ï¼Œé€šå¸¸ å®¹é‡ è¶Šå¤§ï¼Œè¯¯åˆ¤ç‡è¶Šä½ã€‚</p>\n</blockquote>\n<h2 id=\"CF-å‘½ä»¤ç¤ºä¾‹\">CF å‘½ä»¤ç¤ºä¾‹</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º Cuckoo Filter</span></span><br><span class=\"line\"><span class=\"comment\">## å®¹é‡1000ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«å‚æ•°ã€‚åé¢å‡ ä¸ªéƒ½æ˜¯å¯é€‰å‚æ•°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">## BUSKETSIZEè¶Šå¤§ï¼Œç©ºé—´åˆ©ç”¨ç‡æ›´é«˜ï¼Œä½†æ˜¯è¯¯åˆ¤ç‡ä¹Ÿæ›´é«˜ï¼Œæ€§èƒ½æ›´å·®ï¼Œé»˜è®¤2</span></span><br><span class=\"line\"><span class=\"comment\">## MAXITARATIONSè¶Šå°ï¼Œæ€§èƒ½è¶Šå¥½ã€‚å¦‚æœè®¾ç½®è¶Šå¤§ï¼Œç©ºé—´åˆ©ç”¨ç‡å°±è¶Šå¥½ã€‚é»˜è®¤20</span></span><br><span class=\"line\"><span class=\"comment\">## EXPANSION æ˜¯æŒ‡ç©ºé—´æ‰©å®¹çš„æ¯”ä¾‹ã€‚é»˜è®¤1ï¼Œä¸æ‰©å®¹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.RESERVE user:cf 1000 BUCKETSIZE 2 MAXITERATIONS 500 EXPANSION 2</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ å…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.ADD user:cf user_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; CF.ADD user:cf user_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># å¯ä»¥é‡å¤æ·»åŠ å…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.ADD user:cf user_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å…ƒç´ å‡ºç°æ¬¡æ•°</span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.COUNT user:cf user_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\"><span class=\"comment\"># åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.EXISTS user:cf user_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># æ‰¹é‡åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.MEXISTS user:cf user_1 user_2 user_100</span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">3) (<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å…ƒç´ ï¼Œä¸€æ¬¡åªåˆ é™¤ä¸€ä¸ª</span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.DEL user:cf user_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># å› ä¸ºuser_1æœ‰ä¸¤ä¸ªï¼Œæ‰€ä»¥æ‰æ˜¯è¿˜æ˜¯èƒ½æŸ¥è¯¢å‡º user_1</span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.COUNT user:cf user_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡åˆ é™¤</span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.DEL user:cf user_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># åŒåå…ƒç´ å·²å…¨éƒ¨åˆ é™¤ï¼ŒæŸ¥è¯¢ä¸åˆ°</span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.COUNT user:cf user_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…ƒç´ ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ ï¼Œå¹‚ç­‰</span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.ADDNX user:cf user_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; CF.ADDNX user:cf user_3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ Filter å…ƒä¿¡æ¯</span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.INFO user:cf</span><br><span class=\"line\"> 1) Size                      <span class=\"comment\"># å½“å‰ Cuckoo Filter å®é™…å ç”¨çš„å†…å­˜å¤§å°ï¼ˆå­—èŠ‚ï¼‰</span></span><br><span class=\"line\"> 2) (<span class=\"built_in\">integer</span>) 1080</span><br><span class=\"line\"> 3) Number of buckets         <span class=\"comment\"># å½“å‰è¿‡æ»¤å™¨ä¸­ bucketï¼ˆæ¡¶ï¼‰çš„æ€»æ•°é‡ï¼ŒSize = Number of buckets * Bucket size(é»˜è®¤ä¸º2)</span></span><br><span class=\"line\"> 4) (<span class=\"built_in\">integer</span>) 512</span><br><span class=\"line\"> 5) Number of filters         <span class=\"comment\"># å†…éƒ¨ å­ Cuckoo Filter çš„æ•°é‡</span></span><br><span class=\"line\"> 6) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"> 7) Number of items inserted  <span class=\"comment\"># æˆåŠŸæ’å…¥çš„å…ƒç´ æ€»æ•°ï¼ˆè¿‘ä¼¼ï¼‰</span></span><br><span class=\"line\"> 8) (<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\"> 9) Number of items deleted   <span class=\"comment\"># å·²åˆ é™¤å…ƒç´ çš„ç´¯è®¡æ¬¡æ•°</span></span><br><span class=\"line\">10) (<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">11) Bucket size               <span class=\"comment\"># æ¯ä¸ª bucket å¯å®¹çº³çš„ fingerprint æ•°ï¼Œé»˜è®¤ä¸º 2</span></span><br><span class=\"line\">12) (<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">13) Expansion rate            <span class=\"comment\"># è¿‡æ»¤å™¨è‡ªåŠ¨æ‰©å®¹å€ç‡ï¼Œé»˜è®¤ä¸º1ï¼Œ0 æˆ– 1 è¡¨ç¤ºä¸æ‰©å®¹ï¼ˆæ»¡åˆ™å¤±è´¥ï¼‰</span></span><br><span class=\"line\">14) (<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">15) Max iterations            <span class=\"comment\"># Cuckoo Kick-out çš„æœ€å¤§é‡æ’æ¬¡æ•°ï¼Œå€¼è¶Šå¤§ï¼Œæ’å…¥æˆåŠŸç‡è¶Šé«˜ï¼Œä½†å†™å…¥å»¶è¿Ÿå¯èƒ½ä¸Šå‡</span></span><br><span class=\"line\">16) (<span class=\"built_in\">integer</span>) 500</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰¹é‡æ·»åŠ ï¼Œkeyä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.INSERT order:cf CAPACITY 100 ITEMS order1 order2</span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># å¹‚ç­‰ï¼Œå…ƒç´ ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; CF.INSERTNX order:cf CAPACITY 100 ITEMS order1 order2 order100</span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">3) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç±»å‹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">type</span> order:cf</span><br><span class=\"line\">MBbloomCF</span><br></pre></td></tr></table></figure>\n<h2 id=\"SpringBoot-é›†æˆ\">SpringBoot é›†æˆ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SpringBoot çš„ RedisTemplate ä¸­æ²¡æœ‰æä¾›å¯¹<code>RedisBloom</code>çš„å°è£…ï¼Œéœ€è¦è‡ªå·±å°è£…ï¼Œæˆ‘è¿™é‡Œå°è£…äº†ä¸€ä¸ªç®€æ˜“çš„<code>RedisCuckooFilterTool</code></p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.example.redisbloom;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * åŸºäº RedisBloom æ’ä»¶çš„ CuckooFilter å®ç°</span></span><br><span class=\"line\"><span class=\"comment\"> * https://github.com/RedisBloom/RedisBloom/releases</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.LinkedHashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisCuckooFilterTool</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> StringRedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">RedisCuckooFilterTool</span><span class=\"params\">(StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆå§‹åŒ– Cuckoo Filter</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¸èƒ½é‡å¤åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key      Filter åç§°</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> capacity é¢„è®¡å®¹é‡</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">reserve</span><span class=\"params\">(String key, <span class=\"type\">long</span> capacity)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;CF.RESERVE&#x27;, KEYS[1], &quot;</span> + capacity + <span class=\"string\">&quot;)&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            redisTemplate.execute(</span><br><span class=\"line\">                    <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, String.class),</span><br><span class=\"line\">                    Collections.singletonList(key)</span><br><span class=\"line\">            );</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;RedisCuckooFilterTool reserve error:&quot;</span>,e);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆå§‹åŒ– Cuckoo Filterï¼ˆé«˜çº§å‚æ•°ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¸èƒ½é‡å¤åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key           Filter åç§°</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> capacity      é¢„è®¡å®¹é‡</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> bucketSize    æ¯ä¸ªæ¡¶é‡Œæœ€å¤šèƒ½æ”¾å¤šå°‘ä¸ª fingerprintï¼ˆæŒ‡çº¹ï¼‰ï¼Œé»˜è®¤ 2(å¤§å¤šæ•°æƒ…å†µä¸‹çš„æœ€ä¼˜è§£)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> maxIterations é‡æ’æ¬¡æ•°ï¼Œè¶Šå¤§æˆåŠŸç‡è¶Šé«˜</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> expansion     æ‰©å®¹å€æ•°ï¼Œé»˜è®¤ 1ï¼ˆä¸æ‰©å®¹ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">reserve</span><span class=\"params\">(String key, <span class=\"type\">long</span> capacity, <span class=\"type\">int</span> bucketSize, <span class=\"type\">int</span> maxIterations, <span class=\"type\">int</span> expansion)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> String.format(</span><br><span class=\"line\">                <span class=\"string\">&quot;return redis.call(&#x27;CF.RESERVE&#x27;, KEYS[1], %d, &quot;</span> +</span><br><span class=\"line\">                        <span class=\"string\">&quot;&#x27;BUCKETSIZE&#x27;, %d, &#x27;MAXITERATIONS&#x27;, %d, &#x27;EXPANSION&#x27;, %d)&quot;</span>,</span><br><span class=\"line\">                capacity, bucketSize, maxIterations, expansion</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            redisTemplate.execute(</span><br><span class=\"line\">                    <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, String.class),</span><br><span class=\"line\">                    Collections.singletonList(key)</span><br><span class=\"line\">            );</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;RedisCuckooFilterTool reserve error:&quot;</span>,e);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ·»åŠ å…ƒç´ ï¼ˆä¸å»é‡ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">add</span><span class=\"params\">(String key, String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;CF.ADD&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Boolean</span> <span class=\"variable\">execute</span> <span class=\"operator\">=</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, Boolean.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                value</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Boolean.TRUE.equals(execute);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ·»åŠ å…ƒç´ ï¼ˆä»…å½“ä¸å­˜åœ¨æ—¶ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> true è¡¨ç¤ºæˆåŠŸæ’å…¥ï¼Œfalse è¡¨ç¤ºå·²å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">addNx</span><span class=\"params\">(String key, String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;CF.ADDNX&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Boolean</span> <span class=\"variable\">execute</span> <span class=\"operator\">=</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, Boolean.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                value</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Boolean.TRUE.equals(execute);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">exists</span><span class=\"params\">(String key, String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;CF.EXISTS&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Boolean</span> <span class=\"variable\">execute</span> <span class=\"operator\">=</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, Boolean.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                value</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Boolean.TRUE.equals(execute);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ‰¹é‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> æ¯ä¸ªå…ƒç´ å¯¹åº”çš„ç»“æœï¼Œ1 è¡¨ç¤ºå­˜åœ¨ï¼Œ0 è¡¨ç¤ºä¸å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Long&gt; <span class=\"title function_\">mexists</span><span class=\"params\">(String key, String... items)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;CF.MEXISTS&#x27;, KEYS[1], unpack(ARGV))&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (items == <span class=\"literal\">null</span> || items.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                items</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * è¿”å›å…ƒç´ å‡ºç°æ¬¡æ•°ï¼ˆè¿‘ä¼¼ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Long <span class=\"title function_\">count</span><span class=\"params\">(String key, String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;CF.COUNT&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, Long.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                value</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆ é™¤å…ƒç´ </span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> true åˆ é™¤æˆåŠŸï¼Œfalse è¡¨ç¤ºä¸å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">delete</span><span class=\"params\">(String key, String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;CF.DEL&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Long</span> <span class=\"variable\">execute</span> <span class=\"operator\">=</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, Long.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                value</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Boolean.TRUE.equals(execute);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ‰¹é‡æ’å…¥ï¼Œä¸å»é‡</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> æ¯ä¸ªå…ƒç´ å¯¹åº”æ’å…¥ç»“æœï¼Œ1 æ’å…¥æˆåŠŸï¼Œ0 æ’å…¥å¤±è´¥</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Long&gt; <span class=\"title function_\">insert</span><span class=\"params\">(String key, String... items)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;CF.INSERT&#x27;, KEYS[1], &#x27;ITEMS&#x27;, unpack(ARGV))&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (items == <span class=\"literal\">null</span> || items.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                items</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ‰¹é‡æ’å…¥ï¼Œå»é‡</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> æ¯ä¸ªå…ƒç´ å¯¹åº”æ’å…¥ç»“æœï¼Œ1 æ’å…¥æˆåŠŸï¼Œ0 æ’å…¥å¤±è´¥</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Boolean&gt; <span class=\"title function_\">insertNx</span><span class=\"params\">(String key, String... items)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;CF.INSERTNX&#x27;, KEYS[1], &#x27;ITEMS&#x27;, unpack(ARGV))&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (items == <span class=\"literal\">null</span> || items.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                items</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * è·å– Cuckoo Filter å…ƒä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Map&lt;String, Long&gt; <span class=\"title function_\">info</span><span class=\"params\">(String key)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;CF.INFO&#x27;, KEYS[1])&quot;</span>;</span><br><span class=\"line\">        List&lt;Object&gt; result = redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class=\"line\">                Collections.singletonList(key)</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (result == <span class=\"literal\">null</span> || result.isEmpty()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyMap();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        Map&lt;String, Long&gt; infoMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; result.size(); i += <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">field</span> <span class=\"operator\">=</span> toString(result.get(i));</span><br><span class=\"line\">            <span class=\"type\">Long</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> (Long) result.get(i + <span class=\"number\">1</span>);</span><br><span class=\"line\">            infoMap.put(field, value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> infoMap;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * å­—èŠ‚æ•°ç»„è½¬å­—ç¬¦ä¸²</span></span><br><span class=\"line\"><span class=\"comment\">     * info è¿”å›çš„ List</span></span><br><span class=\"line\"><span class=\"comment\">     * [</span></span><br><span class=\"line\"><span class=\"comment\">     * byte[](&quot;Size&quot;),                  Long(1080),</span></span><br><span class=\"line\"><span class=\"comment\">     * byte[](&quot;Number of buckets&quot;),     Long(512),</span></span><br><span class=\"line\"><span class=\"comment\">     * byte[](&quot;Number of filters&quot;),     Long(1),</span></span><br><span class=\"line\"><span class=\"comment\">     * ...</span></span><br><span class=\"line\"><span class=\"comment\">     * ]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String <span class=\"title function_\">toString</span><span class=\"params\">(Object obj)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> <span class=\"type\">byte</span>[]) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>((<span class=\"type\">byte</span>[]) obj);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> String.valueOf(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Cuckoo Filter æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisBloom çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub Cuckoo Filterï¼ˆå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼‰ Cuckoo Filter æ˜¯ Bloom Filter çš„æ”¹è¿›ç‰ˆï¼Œæ”¯æŒ åŠ¨æ€æ·»åŠ å’Œåˆ é™¤å…ƒç´ ï¼Œä»èƒ½æä¾›æ¯”å¸ƒéš†è¿‡æ»¤å™¨æ›´é«˜çš„æŸ¥è¯¢æ€§èƒ½ã€‚ ç»´åŸºç™¾ç§‘å¯¹ Cuckoo Filter çš„æè¿° åœ¨é«˜ QPS æŸ¥è¯¢åœºæ™¯ä¸‹ï¼ŒCuckoo Filter é€šå¸¸ä¼˜äº Bloom Filterã€‚ ä¼˜ç‚¹ï¼šä½è¯¯åˆ¤ç‡ + é«˜è´Ÿè½½ç‡ï¼ŒåŸºäºç›¸åŒçš„é›†åˆå’Œè¯¯æŠ¥ç‡ï¼ŒCuckoo Filteré€šå¸¸å ç”¨ç©ºé—´æ›´å°‘ã€‚ç›¸å¯¹çš„ï¼Œç®—æ³•å®ç°ä¹Ÿå°±æ›´å¤æ‚ã€‚ ç¼ºç‚¹ï¼šä¸Bloom Filterä¸€æ ·ï¼Œæœ‰å¯èƒ½å°†ä¸€ä¸ªä¸åœ¨é›†åˆä¸­çš„å…ƒç´ é”™è¯¯çš„åˆ¤æ–­æˆåœ¨é›†åˆä¸­ Bloom Filter çš„è¯¯æŠ¥ç‡é€šè¿‡è°ƒæ•´ä½æ•°ç»„çš„å¤§å°å’Œå“ˆå¸Œå‡½æ•°æ•°é‡æ¥æ§åˆ¶ï¼Œè€Œ Cuckoo Filter çš„è¯¯æŠ¥ç‡å—æŒ‡çº¹å¤§å°å’Œæ¡¶å¤§å°æ§åˆ¶ã€‚ å¸ƒè°·å“ˆå¸Œç®—æ³• ç™¾åº¦ç™¾ç§‘å¯¹å¸ƒè°·å“ˆå¸Œç®—æ³•çš„æè¿°] ç®—æ³•ä½¿ç”¨ä¸¤ä¸ªä¸åŒå“ˆå¸Œå‡½æ•°è®¡ç®—å¯¹åº” key çš„ä½ç½®ã€‚ å½“ä¸¤ä¸ªå“ˆå¸Œä»»æ„ä½ç½®ä¸ºç©ºï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªä½ç½®æ’å…¥ å½“ä¸¤ä¸ªå“ˆå¸Œæœ‰ä½ç½®ä¸ºç©ºæ—¶ï¼Œåˆ™æ’å…¥åˆ°ç©ºä½ç½® å½“ä¸¤ä¸ªå“ˆå¸Œä½ç½®å‡ä¸ä¸ºç©ºæ—¶ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªä½ç½®æ’å…¥å¹¶è¸¢å‡ºåŸkeyï¼ŒåŸkeyä¼šå†æ¬¡ç»è¿‡è®¡ç®—è·å¾—æ–°çš„ä½ç½®ï¼Œè½¬è‡³1æ‰§è¡Œï¼Œåå¤ç›´åˆ°æˆåŠŸæˆ–è€…è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚ Cuckoo Filter çš„å®ç°åŸç† å¸ƒè°·è¿‡æ»¤å™¨ æ˜¯åœ¨å¸ƒè°·å“ˆå¸Œç®—æ³•çš„ç®—æ³•åŸºç¡€ä¸Šæ‰©å……æ¥çš„ï¼Œä½†æ˜¯å®ƒæ‰€æä¾›çš„æ¦‚å¿µä¸æ˜¯è¡¨ï¼Œè€Œæ˜¯æä¾›äº†å¤šä¸ªæ•°æ®æ¡¶(Bucket) æ¯ä¸€ä¸ªæ•°æ®æ¡¶éƒ½æ˜¯ä¸ªä¸€ç»´æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„çš„ä¿å­˜å†…å®¹ä¸ºæ¡ç›®(Entry)ï¼Œæ¯ä¸€ä¸ªæ¡ç›®é‡Œé¢å¯ä»¥ä¿å­˜ä¸€ä¸ªæŒ‡çº¹æ•°æ®(æŒ‡çº¹æ•°æ®å°±æ˜¯åŸå§‹æ•°æ®ç»è¿‡å“ˆå¸Œè®¡ç®—å¾—åˆ°çš„ä¸€ä¸ªnä½çš„æ•°æ®æ ‡è®°)ï¼Œé™¤äº†æŒ‡çº¹æ•°æ®ä¹‹å¤–ï¼Œè¿˜ä¼šåŒæ—¶å¾—å‡ºä¸€ä¸ªä¿å­˜ä½ç½®P1æ ‡è®°ã€‚ å½“ä¸¤ä¸ªæ•°æ®è®¡ç®—å¾—åˆ°çš„æŒ‡çº¹æ•°æ®ç›¸åŒæ—¶ï¼Œå°±ä¼šå‘ç”Ÿå†²çªï¼Œå†²çªæ“ä½œçš„è§£å†³æ€è·¯æ˜¯ä½¿ç”¨å¸ƒè°·å“ˆå¸Œç®—æ³•ï¼Œç®€å•è¯´å°±æ˜¯æ–°çš„æ•°æ®ä¼šå°†åŸæœ‰æ•°æ®è¸¢å‡ºï¼Œè€Œè¢«è¸¢å‡ºçš„æ•°æ®ä¼šè¢«é‡æ–°è®¡ç®—å¾—åˆ°æ–°çš„æŒ‡çº¹æ•°æ®å’Œä¿å­˜ä½ç½®æ ‡è®°ã€‚ å¸ƒè°·è¿‡æ»¤å™¨é‡Œé¢éœ€è¦è¿›è¡Œå„ç§æ•°æ®çš„è¸¢å‡ºæ“ä½œï¼Œè¿™ä¸ªè¸¢å‡ºçš„æ–¹å¼å°±æ˜¯ä½¿ç”¨P1æ ‡å¿—ä½å’ŒæŒ‡çº¹æ•°æ®è¿›è¡Œå¼‚æˆ–è®¡ç®—å¾—å‡ºæ¥çš„P2æ ‡å¿—ä½ï¼ŒæŒ‰ç…§åŒæ ·çš„æ€è·¯(å‰æ:ä¸€ç›´éƒ½æœ‰å†²çªæ“ä½œ)ä¸€ç›´è®¡ç®—æ–°çš„P2ä½ï¼Œç›´åˆ°å†²çªè§£å†³æˆ–è€…è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œå°±ä¼šå¤±è´¥ã€‚ æŒ‡çº¹æ•°æ®é‡Œé¢åŒ…å«æœ‰å”¯ä¸€æ€§ï¼Œæ‰€ä»¥å¯ä»¥å®ç°æ•°æ®çš„åˆ é™¤ï¼Œå½“ç„¶ï¼Œä¸åŒçš„æ•°æ®è®¡ç®—æ˜¯æœ‰å¯èƒ½å¾—åˆ°ç›¸åŒæŒ‡çº¹çš„ï¼Œé‚£ä¹ˆä¸€æ—¦åˆ é™¤æ•°æ®ä¹‹åï¼Œæœ‰å¯èƒ½é€ æˆæ•°æ®çš„&quot;å‡åˆ é™¤&quot;ï¼Œæ‰€ä»¥å¸ƒè°·è¿‡æ»¤å™¨æœ¬èº«ä¹Ÿæ˜¯å­˜åœ¨æœ‰è¯¯å·®çš„ã€‚ Cuckoo Filter ä¸­çš„ BUSKETSIZE BUSKETSIZEï¼Œè¡¨ç¤ºæ¯ä¸ªæ¡¶(Busket)ä¸­å­˜æ”¾çš„å…ƒç´ ä¸ªæ•°ï¼Œå³æ¡¶å¤§å°ã€‚ Cuckoo Filterçš„æ•°ç»„é‡Œå­˜çš„ä¸æ˜¯ä½ï¼Œè€Œæ˜¯æ¡¶(busket)ï¼Œæ¯ä¸ªæ¡¶é‡Œå¯ä»¥å­˜æ”¾å¤šä¸ªæ•°æ®ã€‚ åŒä¸€ä¸ªæ¡¶ä¸­å­˜æ”¾çš„æ•°æ®è¶Šå¤šï¼Œç©ºé—´åˆ©ç”¨ç‡æ›´é«˜ï¼Œç›¸åº”çš„è¯¯åˆ¤ç‡ä¹Ÿå°±è¶Šé«˜ï¼Œæ€§èƒ½ä¹Ÿæ›´æ…¢ã€‚ Redisçš„CuckooFilterå®ç°ä¸­ï¼ŒBUSKETSIZEåº”è¯¥æ˜¯ä¸€ä¸ªåœ¨1åˆ°255ä¹‹é—´çš„æ•´æ•°ï¼Œé»˜è®¤çš„ BUSKETSIZE æ˜¯ 2ã€‚ æ¡¶(Busket)ä¸­å¹¶ä¸å®é™…ä¿å­˜æ•°æ®æœ¬èº«ï¼Œè€Œæ˜¯ä¿å­˜æ•°æ®çš„æŒ‡çº¹(fingerprint)ã€‚æŒ‡çº¹è¶Šå°ï¼ŒHASHå†²çªé€ æˆè¯¯åˆ¤çš„å‡ ç‡å°±è¶Šå°ã€‚è¿™ä¸ªå‚æ•°çš„è°ƒæ•´æ¯”è¾ƒå¤æ‚ï¼ŒRedisçš„CuckooFilterä¸­ä¸æ”¯æŒè°ƒæ•´è¿™ä¸ªå‚æ•°ã€‚ CF å‘½ä»¤è¯´æ˜ å¯¹åº”Rediså‘½ä»¤ï¼š CF.xxx å‘½ä»¤ åŠŸèƒ½è¯´æ˜ æ˜¯å¦åˆ›å»º Filter å…³é”®å‚æ•°å«ä¹‰ è¿”å›å€¼ ç¤ºä¾‹ ä½¿ç”¨è¦ç‚¹ / å¤‡æ³¨ CF.RESERVE æ˜¾å¼åˆ›å»º Cuckoo Filter æ˜¯ capacityï¼šå®¹é‡(å¿…å¡«)BUCKETSIZEï¼šæ¯ä¸ªæ¡¶é‡Œæœ€å¤šèƒ½æ”¾å¤šå°‘ä¸ª fingerprintï¼ˆæŒ‡çº¹ï¼‰ï¼Œé»˜è®¤ 2(å¤§å¤šæ•°æƒ…å†µä¸‹çš„æœ€ä¼˜è§£)MAXITERATIONSï¼šé‡æ’æ¬¡æ•°ï¼Œè¶Šå¤§æˆåŠŸç‡è¶Šé«˜EXPANSIONï¼šæ‰©å®¹å€æ•°ï¼Œé»˜è®¤ 1ï¼ˆä¸æ‰©å®¹ï¼‰ OK CF.RESERVE user:cf 100000 âœ… ç”Ÿäº§æ¨èæ”¯æŒåˆ é™¤ä¸è®¡æ•° CF.ADD æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œä¸å»é‡ æ˜¯ ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰ itemï¼šå…ƒç´  OK CF.ADD user:cf user_1 è‹¥æ»¡å¯èƒ½å¤±è´¥ CF.ADDNX å…ƒç´ ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ ï¼Œå»é‡ æ˜¯ ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰ item 1 æ–°å¢0 å·²å­˜åœ¨ CF.ADDNX user:cf user_1 å¹‚ç­‰å†™å…¥é¦–é€‰ CF.INSERT æ‰¹é‡æ’å…¥ æ˜¯ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰ ITEMSï¼šå…ƒç´ åˆ—è¡¨ OK CF.INSERT user:cf ITEMS u1 u2 é»˜è®¤é…ç½® CF.INSERTNX æ‰¹é‡æ’å…¥ï¼ˆä¸å­˜åœ¨æ‰åŠ ï¼‰ æ˜¯ ITEMS 0/1 åˆ—è¡¨ CF.INSERTNX user:cf ITEMS u1 u2 å¹‚ç­‰ + æ‰¹é‡ CF.EXISTS åˆ¤æ–­å•ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ å¦ item 1 å¯èƒ½å­˜åœ¨0 ä¸å­˜åœ¨ CF.EXISTS user:cf user_1 ä»æœ‰è¯¯åˆ¤ CF.MEXISTS æ‰¹é‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨ å¦ item... 0/1 åˆ—è¡¨ CF.MEXISTS user:cf u1 u9 é«˜å¹¶å‘æ¨è CF.COUNT è¿”å›å…ƒç´ å‡ºç°æ¬¡æ•° å¦ item æ•´æ•° CF.COUNT user:cf user_1 â­ Bloom æ²¡æœ‰çš„èƒ½åŠ› CF.DEL åˆ é™¤ä¸€ä¸ªå…ƒç´  å¦ item 1 åˆ é™¤æˆåŠŸ0 ä¸å­˜åœ¨ CF.DEL user:cf user_1 â­ Bloom ä¸æ”¯æŒ CF.INFO æŸ¥çœ‹ Filter å…ƒä¿¡æ¯ å¦ æ—  KV åˆ—è¡¨ CF.INFO user:cf è¿ç»´åˆ†æ CF.SCANDUMP åˆ†å—å¯¼å‡º Filter å¦ iterator iterator + data CF.SCANDUMP user:cf 0 è¿ç§» / å¤‡ä»½ CF.LOADCHUNK ä» dump æ¢å¤ Filter æ˜¯ iterator + data OK CF.LOADCHUNK user:cf 1 &quot;xxx&quot; ä¸ SCANDUMP é…åˆ Bloom vs Cuckoo ç»´åº¦ Bloom Filter Cuckoo Filter æŸ¥è¯¢å¤æ‚åº¦ O(k)ï¼ˆk ä¸ªå“ˆå¸Œå‡½æ•°ï¼‰ O(1)ï¼ˆ2â€“4 æ¬¡ bucket è®¿é—®ï¼‰ æ’å…¥å¤æ‚åº¦ O(k) å¹³å‡ O(1)ï¼Œæœ€åå¯èƒ½è§¦å‘é‡æ’ åˆ é™¤æ”¯æŒ âŒ åŸç”Ÿä¸æ”¯æŒ âœ… åŸç”Ÿæ”¯æŒ è¯¯åˆ¤ç‡ï¼ˆFalse Positiveï¼‰ å¯é…ç½®ï¼Œç¨³å®š å¯é…ç½®ï¼Œé€šå¸¸æ›´ä½ æ¼åˆ¤ï¼ˆFalse Negativeï¼‰ âŒ ç†è®ºä¸Šä¸ä¼š âŒ ç†è®ºä¸Šä¸ä¼š ç©ºé—´åˆ©ç”¨ç‡ é«˜ï¼ˆä½†å— k å½±å“ï¼‰ é€šå¸¸æ›´é«˜ï¼ˆç‰¹åˆ«æ˜¯ä½è¯¯åˆ¤ç‡ï¼‰ æ‰©å®¹æˆæœ¬ é«˜ï¼ˆéœ€é‡å»ºï¼‰ ä¸­ç­‰ï¼ˆæ”¯æŒæ‰©å±•ç­–ç•¥ï¼‰ å®ç°å¤æ‚åº¦ ä½ è¾ƒé«˜ RedisBloom Cuckoo Filter ä¸æ”¯æŒè®¾ç½® è¯¯åˆ¤ç‡ï¼Œé€šå¸¸ å®¹é‡ è¶Šå¤§ï¼Œè¯¯åˆ¤ç‡è¶Šä½ã€‚ CF å‘½ä»¤ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677# åˆ›å»º Cuckoo Filter## å®¹é‡1000ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«å‚æ•°ã€‚åé¢å‡ ä¸ªéƒ½æ˜¯å¯é€‰å‚æ•°ã€‚## BUSKETSIZEè¶Šå¤§ï¼Œç©ºé—´åˆ©ç”¨ç‡æ›´é«˜ï¼Œä½†æ˜¯è¯¯åˆ¤ç‡ä¹Ÿæ›´é«˜ï¼Œæ€§èƒ½æ›´å·®ï¼Œé»˜è®¤2## MAXITARATIONSè¶Šå°ï¼Œæ€§èƒ½è¶Šå¥½ã€‚å¦‚æœè®¾ç½®è¶Šå¤§ï¼Œç©ºé—´åˆ©ç”¨ç‡å°±è¶Šå¥½ã€‚é»˜è®¤20## EXPANSION æ˜¯æŒ‡ç©ºé—´æ‰©å®¹çš„æ¯”ä¾‹ã€‚é»˜è®¤1ï¼Œä¸æ‰©å®¹127.0.0.1:6379&gt; CF.RESERVE user:cf 1000 BUCKETSIZE 2 MAXITERATIONS 500 EXPANSION 2OK# æ·»åŠ å…ƒç´ 127.0.0.1:6379&gt; CF.ADD user:cf user_1(integer) 1127.0.0.1:6379&gt; CF.ADD user:cf user_2(integer) 1# å¯ä»¥é‡å¤æ·»åŠ å…ƒç´ 127.0.0.1:6379&gt; CF.ADD user:cf user_1(integer) 1# è¿”å›å…ƒç´ å‡ºç°æ¬¡æ•°127.0.0.1:6379&gt; CF.COUNT user:cf user_1(integer) 2# åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨127.0.0.1:6379&gt; CF.EXISTS user:cf user_1(integer) 1# æ‰¹é‡åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨127.0.0.1:6379&gt; CF.MEXISTS user:cf user_1 user_2 user_1001) (integer) 12) (integer) 13) (integer) 0# åˆ é™¤å…ƒç´ ï¼Œä¸€æ¬¡åªåˆ é™¤ä¸€ä¸ª127.0.0.1:6379&gt; CF.DEL user:cf user_1(integer) 1# å› ä¸ºuser_1æœ‰ä¸¤ä¸ªï¼Œæ‰€ä»¥æ‰æ˜¯è¿˜æ˜¯èƒ½æŸ¥è¯¢å‡º user_1127.0.0.1:6379&gt; CF.COUNT user:cf user_1(integer) 1# å†æ¬¡åˆ é™¤127.0.0.1:6379&gt; CF.DEL user:cf user_1(integer) 1# åŒåå…ƒç´ å·²å…¨éƒ¨åˆ é™¤ï¼ŒæŸ¥è¯¢ä¸åˆ°127.0.0.1:6379&gt; CF.COUNT user:cf user_1(integer) 0# å…ƒç´ ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ ï¼Œå¹‚ç­‰127.0.0.1:6379&gt; CF.ADDNX user:cf user_2(integer) 0127.0.0.1:6379&gt; CF.ADDNX user:cf user_3(integer) 1# æŸ¥çœ‹ Filter å…ƒä¿¡æ¯127.0.0.1:6379&gt; CF.INFO user:cf 1) Size # å½“å‰ Cuckoo Filter å®é™…å ç”¨çš„å†…å­˜å¤§å°ï¼ˆå­—èŠ‚ï¼‰ 2) (integer) 1080 3) Number of buckets # å½“å‰è¿‡æ»¤å™¨ä¸­ bucketï¼ˆæ¡¶ï¼‰çš„æ€»æ•°é‡ï¼ŒSize = Number of buckets * Bucket size(é»˜è®¤ä¸º2) 4) (integer) 512 5) Number of filters # å†…éƒ¨ å­ Cuckoo Filter çš„æ•°é‡ 6) (integer) 1 7) Number of items inserted # æˆåŠŸæ’å…¥çš„å…ƒç´ æ€»æ•°ï¼ˆè¿‘ä¼¼ï¼‰ 8) (integer) 2 9) Number of items deleted # å·²åˆ é™¤å…ƒç´ çš„ç´¯è®¡æ¬¡æ•°10) (integer) 211) Bucket size # æ¯ä¸ª bucket å¯å®¹çº³çš„ fingerprint æ•°ï¼Œé»˜è®¤ä¸º 212) (integer) 213) Expansion rate # è¿‡æ»¤å™¨è‡ªåŠ¨æ‰©å®¹å€ç‡ï¼Œé»˜è®¤ä¸º1ï¼Œ0 æˆ– 1 è¡¨ç¤ºä¸æ‰©å®¹ï¼ˆæ»¡åˆ™å¤±è´¥ï¼‰14) (integer) 215) Max iterations # Cuckoo Kick-out çš„æœ€å¤§é‡æ’æ¬¡æ•°ï¼Œå€¼è¶Šå¤§ï¼Œæ’å…¥æˆåŠŸç‡è¶Šé«˜ï¼Œä½†å†™å…¥å»¶è¿Ÿå¯èƒ½ä¸Šå‡16) (integer) 500# æ‰¹é‡æ·»åŠ ï¼Œkeyä¸å­˜åœ¨åˆ™åˆ›å»º127.0.0.1:6379&gt; CF.INSERT order:cf CAPACITY 100 ITEMS order1 order21) (integer) 12) (integer) 1# å¹‚ç­‰ï¼Œå…ƒç´ ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ 127.0.0.1:6379&gt; CF.INSERTNX order:cf CAPACITY 100 ITEMS order1 order2 order1001) (integer) 02) (integer) 03) (integer) 1# æŸ¥çœ‹ç±»å‹127.0.0.1:6379&gt; type order:cfMBbloomCF SpringBoot é›†æˆ SpringBoot çš„ RedisTemplate ä¸­æ²¡æœ‰æä¾›å¯¹RedisBloomçš„å°è£…ï¼Œéœ€è¦è‡ªå·±å°è£…ï¼Œæˆ‘è¿™é‡Œå°è£…äº†ä¸€ä¸ªç®€æ˜“çš„RedisCuckooFilterTool 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240package com.example.redisbloom;/** * åŸºäº RedisBloom æ’ä»¶çš„ CuckooFilter å®ç° * https://github.com/RedisBloom/RedisBloom/releases */import lombok.extern.slf4j.Slf4j;import org.springframework.data.redis.core.StringRedisTemplate;import org.springframework.data.redis.core.script.DefaultRedisScript;import org.springframework.stereotype.Component;import java.util.Collections;import java.util.LinkedHashMap;import java.util.List;import java.util.Map;@Component@Slf4jpublic class RedisCuckooFilterTool &#123; private final StringRedisTemplate redisTemplate; public RedisCuckooFilterTool(StringRedisTemplate redisTemplate) &#123; this.redisTemplate = redisTemplate; &#125; /** * åˆå§‹åŒ– Cuckoo Filter * &lt;p&gt; * ä¸èƒ½é‡å¤åˆ›å»º * * @param key Filter åç§° * @param capacity é¢„è®¡å®¹é‡ */ public boolean reserve(String key, long capacity) &#123; String script = &quot;return redis.call(&#x27;CF.RESERVE&#x27;, KEYS[1], &quot; + capacity + &quot;)&quot;; try&#123; redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, String.class), Collections.singletonList(key) ); return true; &#125; catch (Exception e) &#123; log.error(&quot;RedisCuckooFilterTool reserve error:&quot;,e); return false; &#125; &#125; /** * åˆå§‹åŒ– Cuckoo Filterï¼ˆé«˜çº§å‚æ•°ï¼‰ * * ä¸èƒ½é‡å¤åˆ›å»º * * @param key Filter åç§° * @param capacity é¢„è®¡å®¹é‡ * @param bucketSize æ¯ä¸ªæ¡¶é‡Œæœ€å¤šèƒ½æ”¾å¤šå°‘ä¸ª fingerprintï¼ˆæŒ‡çº¹ï¼‰ï¼Œé»˜è®¤ 2(å¤§å¤šæ•°æƒ…å†µä¸‹çš„æœ€ä¼˜è§£) * @param maxIterations é‡æ’æ¬¡æ•°ï¼Œè¶Šå¤§æˆåŠŸç‡è¶Šé«˜ * @param expansion æ‰©å®¹å€æ•°ï¼Œé»˜è®¤ 1ï¼ˆä¸æ‰©å®¹ï¼‰ */ public boolean reserve(String key, long capacity, int bucketSize, int maxIterations, int expansion) &#123; String script = String.format( &quot;return redis.call(&#x27;CF.RESERVE&#x27;, KEYS[1], %d, &quot; + &quot;&#x27;BUCKETSIZE&#x27;, %d, &#x27;MAXITERATIONS&#x27;, %d, &#x27;EXPANSION&#x27;, %d)&quot;, capacity, bucketSize, maxIterations, expansion ); try&#123; redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, String.class), Collections.singletonList(key) ); return true; &#125; catch (Exception e) &#123; log.error(&quot;RedisCuckooFilterTool reserve error:&quot;,e); return false; &#125; &#125; /** * æ·»åŠ å…ƒç´ ï¼ˆä¸å»é‡ï¼‰ */ public boolean add(String key, String value) &#123; String script = &quot;return redis.call(&#x27;CF.ADD&#x27;, KEYS[1], ARGV[1])&quot;; final Boolean execute = redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, Boolean.class), Collections.singletonList(key), value ); return Boolean.TRUE.equals(execute); &#125; /** * æ·»åŠ å…ƒç´ ï¼ˆä»…å½“ä¸å­˜åœ¨æ—¶ï¼‰ * * @return true è¡¨ç¤ºæˆåŠŸæ’å…¥ï¼Œfalse è¡¨ç¤ºå·²å­˜åœ¨ */ public boolean addNx(String key, String value) &#123; String script = &quot;return redis.call(&#x27;CF.ADDNX&#x27;, KEYS[1], ARGV[1])&quot;; final Boolean execute = redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, Boolean.class), Collections.singletonList(key), value ); return Boolean.TRUE.equals(execute); &#125; /** * åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ */ public boolean exists(String key, String value) &#123; String script = &quot;return redis.call(&#x27;CF.EXISTS&#x27;, KEYS[1], ARGV[1])&quot;; final Boolean execute = redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, Boolean.class), Collections.singletonList(key), value ); return Boolean.TRUE.equals(execute); &#125; /** * æ‰¹é‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨ * @return æ¯ä¸ªå…ƒç´ å¯¹åº”çš„ç»“æœï¼Œ1 è¡¨ç¤ºå­˜åœ¨ï¼Œ0 è¡¨ç¤ºä¸å­˜åœ¨ */ public List&lt;Long&gt; mexists(String key, String... items) &#123; String script = &quot;return redis.call(&#x27;CF.MEXISTS&#x27;, KEYS[1], unpack(ARGV))&quot;; if (items == null || items.length == 0) &#123; return Collections.emptyList(); &#125; return redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, List.class), Collections.singletonList(key), items ); &#125; /** * è¿”å›å…ƒç´ å‡ºç°æ¬¡æ•°ï¼ˆè¿‘ä¼¼ï¼‰ */ public Long count(String key, String value) &#123; String script = &quot;return redis.call(&#x27;CF.COUNT&#x27;, KEYS[1], ARGV[1])&quot;; return redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, Long.class), Collections.singletonList(key), value ); &#125; /** * åˆ é™¤å…ƒç´  * * @return true åˆ é™¤æˆåŠŸï¼Œfalse è¡¨ç¤ºä¸å­˜åœ¨ */ public boolean delete(String key, String value) &#123; String script = &quot;return redis.call(&#x27;CF.DEL&#x27;, KEYS[1], ARGV[1])&quot;; final Long execute = redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, Long.class), Collections.singletonList(key), value ); return Boolean.TRUE.equals(execute); &#125; /** * æ‰¹é‡æ’å…¥ï¼Œä¸å»é‡ * @return æ¯ä¸ªå…ƒç´ å¯¹åº”æ’å…¥ç»“æœï¼Œ1 æ’å…¥æˆåŠŸï¼Œ0 æ’å…¥å¤±è´¥ */ public List&lt;Long&gt; insert(String key, String... items) &#123; String script = &quot;return redis.call(&#x27;CF.INSERT&#x27;, KEYS[1], &#x27;ITEMS&#x27;, unpack(ARGV))&quot;; if (items == null || items.length == 0) &#123; return Collections.emptyList(); &#125; return redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, List.class), Collections.singletonList(key), items ); &#125; /** * æ‰¹é‡æ’å…¥ï¼Œå»é‡ * @return æ¯ä¸ªå…ƒç´ å¯¹åº”æ’å…¥ç»“æœï¼Œ1 æ’å…¥æˆåŠŸï¼Œ0 æ’å…¥å¤±è´¥ */ public List&lt;Boolean&gt; insertNx(String key, String... items) &#123; String script = &quot;return redis.call(&#x27;CF.INSERTNX&#x27;, KEYS[1], &#x27;ITEMS&#x27;, unpack(ARGV))&quot;; if (items == null || items.length == 0) &#123; return Collections.emptyList(); &#125; return redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, List.class), Collections.singletonList(key), items ); &#125; /** * è·å– Cuckoo Filter å…ƒä¿¡æ¯ */ public Map&lt;String, Long&gt; info(String key) &#123; String script = &quot;return redis.call(&#x27;CF.INFO&#x27;, KEYS[1])&quot;; List&lt;Object&gt; result = redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, List.class), Collections.singletonList(key) ); if (result == null || result.isEmpty()) &#123; return Collections.emptyMap(); &#125; Map&lt;String, Long&gt; infoMap = new LinkedHashMap&lt;&gt;(); for (int i = 0; i &lt; result.size(); i += 2) &#123; String field = toString(result.get(i)); Long value = (Long) result.get(i + 1); infoMap.put(field, value); &#125; return infoMap; &#125; /** * å­—èŠ‚æ•°ç»„è½¬å­—ç¬¦ä¸² * info è¿”å›çš„ List * [ * byte[](&quot;Size&quot;), Long(1080), * byte[](&quot;Number of buckets&quot;), Long(512), * byte[](&quot;Number of filters&quot;), Long(1), * ... * ] */ private String toString(Object obj) &#123; if (obj instanceof byte[]) &#123; return new String((byte[]) obj); &#125; return String.valueOf(obj); &#125;&#125;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Cuckoo Filter æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisBloom çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub","date_published":"2025-12-22T06:40:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/22/redis7-datatype-11-BF/","url":"https://blog.hanqunfeng.com/2025/12/22/redis7-datatype-11-BF/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- BF(Bloom Filter)","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Bloom Filter æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n<li class=\"lvl-2\">RedisBloom çš„å®‰è£…å‚è§ <a href=\"/2025/12/21/redis7-module-RedisBloom/\" title=\"Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•\">Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•</a></li>\n<li class=\"lvl-2\">ç¤ºä¾‹ä»£ç ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/redis-demo/data-type-demo\">GitHub</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Bloom-Filter-å¸ƒéš†è¿‡æ»¤å™¨\">Bloom Filter(å¸ƒéš†è¿‡æ»¤å™¨)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§ç”¨äºå¿«é€Ÿåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨çš„ probabilistic data structureï¼ˆæ¦‚ç‡æ•°æ®ç»“æ„ï¼‰ï¼Œéå¸¸é€‚åˆæµ·é‡æ•°æ®ä¸”ä¸è¦æ±‚ç»å¯¹ç²¾ç¡®çš„åœºæ™¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://en.wikipedia.org/wiki/Bloom_filter\">ç»´åŸºç™¾ç§‘å¯¹ Bloom Filter çš„æè¿°</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ <a href=\"https://redisson.pro/docs/data-and-services/objects/#bloom-filter\">Redissonçš„å¸ƒéš†è¿‡æ»¤å™¨</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶ä½æ•°ç»„å’Œä¸€ç³»åˆ—å“ˆå¸Œå‡½æ•°æ¥ä¿å­˜å…ƒç´ ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä¼˜ç‚¹: éå¸¸èŠ‚çœç©ºé—´ã€æŸ¥è¯¢å¿«</li>\n<li class=\"lvl-6\">ç¼ºç‚¹: æœ‰ä¸€å®šçš„è¯¯åˆ¤æ¦‚ç‡ã€æ— æ³•åˆ é™¤å…ƒç´ ã€æ— æ³•ç»™å…ƒç´ è®¡æ•°</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ä¸€ä¸ªå…ƒç´ ä¸åœ¨é›†åˆä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ è‚¯å®šä¸åœ¨é›†åˆä¸­ã€‚ä½†æ˜¯ï¼Œå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ä¸€ä¸ªå…ƒç´ åœ¨é›†åˆä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ æœ‰å¯èƒ½ä¸åœ¨é›†åˆä¸­ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/l7rGDM.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½æ•°ç»„ï¼ˆBit Arrayï¼‰ï¼šå¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨ä¸€ä¸ªé•¿åº¦å›ºå®šçš„ä½æ•°ç»„æ¥å­˜å‚¨æ•°æ®ã€‚æ¯ä¸ªä½ç½®åªå ç”¨ä¸€ä¸ªæ¯”ç‰¹ï¼ˆ0æˆ–1ï¼‰ï¼Œåˆå§‹æ—¶æ‰€æœ‰ä½éƒ½è®¾ç½®ä¸º0ã€‚ä½æ•°ç»„çš„é•¿åº¦å’Œå“ˆå¸Œå‡½æ•°çš„æ•°é‡å†³å®šäº†è¿‡æ»¤å™¨çš„è¯¯æŠ¥ç‡å’Œå®¹é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å“ˆå¸Œå‡½æ•°é›†åˆï¼šå¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°éƒ½ä¼šå°†è¾“å…¥æ•°æ®æ˜ å°„åˆ°ä½æ•°ç»„çš„ä¸€ä¸ªä¸åŒä½ç½®ã€‚å“ˆå¸Œå‡½æ•°çš„é€‰æ‹©å¯¹è¿‡æ»¤å™¨çš„æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼Œç†æƒ³çš„å“ˆå¸Œå‡½æ•°åº”è¯¥å…·æœ‰è‰¯å¥½çš„æ•£åˆ—æ€§ï¼Œä½¿å¾—ä¸åŒçš„è¾“å…¥å°½å¯èƒ½å‡åŒ€åœ°æ˜ å°„åˆ°ä½æ•°ç»„çš„ä¸åŒä½ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚ä½•é™ä½è¯¯åˆ¤ç‡ï¼Ÿ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æ›´å¤§çš„ä½æ•°ç»„</li>\n<li class=\"lvl-6\">æ›´å¤šçš„å“ˆå¸Œå‡½æ•°</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å¾ˆå¤šäººéƒ½æ˜¯ç”¨è¿‡Googleå¼€æºçš„Guavaçš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä½†å…¶æ˜¯JVMå±‚çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œè‹¥éœ€è¦åˆ†å¸ƒå¼å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°±å¯ä»¥ä½¿ç”¨RedisBloomæä¾›çš„BF(Bloom Filter)ã€‚</p>\n</li>\n</ul>\n<h2 id=\"BF-å‘½ä»¤è¯´æ˜\">BF å‘½ä»¤è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹åº”Rediså‘½ä»¤ï¼š <code>BF.xxx</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>æ˜¯å¦åˆ›å»º Filter</th>\n<th>å…³é”®å‚æ•°å«ä¹‰</th>\n<th>è¿”å›å€¼</th>\n<th>ç¤ºä¾‹</th>\n<th>ä½¿ç”¨è¦ç‚¹ / å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>BF.RESERVE</strong></td>\n<td>æ˜¾å¼åˆ›å»º Bloom Filter</td>\n<td>æ˜¯ï¼ˆå·²å­˜åœ¨åˆ™æŠ¥é”™ï¼‰</td>\n<td><code>error_rate</code>ï¼šè¯¯åˆ¤ç‡<br><code>capacity</code>ï¼šé¢„è®¡å…ƒç´ æ•°<br><code>EXPANSION</code>ï¼šæ‰©å®¹å€ç‡</td>\n<td>OK</td>\n<td><code>BF.RESERVE user:bf 0.001 1000000</code></td>\n<td>âœ… <strong>ç”Ÿäº§æ¨è</strong><br>æ˜¾å¼è§„åˆ’å®¹é‡ä¸è¯¯åˆ¤ç‡ï¼Œé¿å…éšå¼åˆ›å»º</td>\n</tr>\n<tr>\n<td><strong>BF.ADD</strong></td>\n<td>æ·»åŠ å•ä¸ªå…ƒç´ </td>\n<td>æ˜¯ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</td>\n<td>æ— </td>\n<td><code>1</code> æ–°å¢<br><code>0</code> å¯èƒ½å·²å­˜åœ¨</td>\n<td><code>BF.ADD user:bf user_1</code></td>\n<td>Key å¿…é¡»å·²å­˜åœ¨ï¼Œå¦åˆ™æŠ¥é”™</td>\n</tr>\n<tr>\n<td><strong>BF.MADD</strong></td>\n<td>æ‰¹é‡æ·»åŠ å…ƒç´ </td>\n<td>æ˜¯ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</td>\n<td><code>item...</code>ï¼šå¤šä¸ªå…ƒç´ </td>\n<td><code>0/1</code> åˆ—è¡¨</td>\n<td><code>BF.MADD user:bf u1 u2 u3</code></td>\n<td>âš  ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œä¸å»ºè®®ç”Ÿäº§</td>\n</tr>\n<tr>\n<td><strong>BF.INSERT</strong></td>\n<td>æ‰¹é‡æ’å…¥ï¼ˆå¯æ§å‚æ•°ï¼‰</td>\n<td>æ˜¯</td>\n<td><code>CAPACITY</code>ï¼šå®¹é‡<br><code>ERROR</code>ï¼šè¯¯åˆ¤ç‡<br><code>NOCREATE</code>:ä¸è‡ªåŠ¨åˆ›å»ºè¿‡æ»¤å™¨<br><code>NONSCALING</code>: ä¸æ‰©å®¹ï¼Œè¾¾åˆ°capacityæ—¶ï¼Œè¿‡æ»¤å™¨è¿”å›é”™è¯¯<br><code>EXPANSION expansion</code>:æ‰©å®¹æ—¶ï¼Œæ–°å»ºå­è¿‡æ»¤å™¨çš„å®¹é‡å¢é•¿å€ç‡ï¼Œé»˜è®¤2 <br><code>ITEMS</code>ï¼šå…ƒç´ åˆ—è¡¨</td>\n<td><code>0/1</code> åˆ—è¡¨</td>\n<td><code>BF.INSERT user:bf CAPACITY 10000 ERROR 0.001 ITEMS u1 u2</code></td>\n<td>âœ… <strong>æœ€æ¨èçš„å†™å…¥æ–¹å¼</strong><br>æ”¯æŒåˆå§‹åŒ– + æ’å…¥</td>\n</tr>\n<tr>\n<td><strong>BF.EXISTS</strong></td>\n<td>åˆ¤æ–­å•ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</td>\n<td>å¦</td>\n<td><code>item</code>ï¼šå¾…åˆ¤æ–­å…ƒç´ </td>\n<td><code>1</code> å¯èƒ½å­˜åœ¨<br><code>0</code> ä¸€å®šä¸å­˜åœ¨</td>\n<td><code>BF.EXISTS user:bf user_1</code></td>\n<td>ä¸å­˜åœ¨ç»“æœ <strong>ç»å¯¹å¯é </strong></td>\n</tr>\n<tr>\n<td><strong>BF.MEXISTS</strong></td>\n<td>æ‰¹é‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨</td>\n<td>å¦</td>\n<td><code>item...</code>ï¼šå¤šä¸ªå…ƒç´ </td>\n<td><code>0/1</code> åˆ—è¡¨</td>\n<td><code>BF.MEXISTS user:bf u1 u9</code></td>\n<td>é«˜å¹¶å‘æ‰¹é‡æŸ¥è¯¢é¦–é€‰</td>\n</tr>\n<tr>\n<td><strong>BF.CARD</strong></td>\n<td>è¿”å›æ’å…¥å…ƒç´ æ•°é‡ï¼ˆè¿‘ä¼¼ï¼‰</td>\n<td>å¦</td>\n<td>æ— </td>\n<td>æ•´æ•°</td>\n<td><code>BF.CARD user:bf</code></td>\n<td>ç”¨äºå®¹é‡ç›‘æ§ï¼Œéç²¾ç¡®</td>\n</tr>\n<tr>\n<td><strong><a href=\"http://BF.INFO\">BF.INFO</a></strong></td>\n<td>è¿”å› Bloom Filter å…ƒä¿¡æ¯</td>\n<td>å¦</td>\n<td>æ— </td>\n<td>KV åˆ—è¡¨</td>\n<td><code>BF.INFO user:bf</code></td>\n<td>è¿ç»´ã€å®¹é‡ä¸å†…å­˜åˆ†æå¿…å¤‡</td>\n</tr>\n<tr>\n<td><strong>BF.SCANDUMP</strong></td>\n<td>åˆ†å—å¯¼å‡º Bloom Filter</td>\n<td>å¦</td>\n<td><code>iterator</code>ï¼šæ¸¸æ ‡</td>\n<td><code>iterator + data</code></td>\n<td><code>BF.SCANDUMP user:bf 0</code></td>\n<td>ç”¨äºè¿ç§»ã€å¤‡ä»½</td>\n</tr>\n<tr>\n<td><strong>BF.LOADCHUNK</strong></td>\n<td>ä» dump æ•°æ®æ¢å¤ Filter</td>\n<td>æ˜¯</td>\n<td><code>iterator</code><br><code>data</code></td>\n<td>OK</td>\n<td><code>BF.LOADCHUNK user:bf 1 &quot;xxx&quot;</code></td>\n<td>å¿…é¡»ä¸ SCANDUMP é…åˆä½¿ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"BF-å‘½ä»¤ç¤ºä¾‹\">BF å‘½ä»¤ç¤ºä¾‹</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆå§‹åŒ–ä¸€ä¸ªBloomFilterï¼Œé”™è¯¯ç‡0.01ï¼Œå…ƒç´ æ•°é‡1000</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BF.RESERVE <span class=\"built_in\">test</span> 0.01 1000</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç±»å‹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">type</span> <span class=\"built_in\">test</span></span><br><span class=\"line\">MBbloom--</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ å…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; BF.ADD <span class=\"built_in\">test</span> user1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; BF.ADD <span class=\"built_in\">test</span> user2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># æ‰¹é‡æ·»åŠ å…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; BF.MADD <span class=\"built_in\">test</span> user3 user4 user5</span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">3) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›Bloomè¿‡æ»¤å™¨çš„åŸºæ•°ï¼Œå³æ·»åŠ çš„å…ƒç´ æ•°é‡(å­˜åœ¨è¯¯å·®)</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BF.CARD <span class=\"built_in\">test</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BF.EXISTS <span class=\"built_in\">test</span> user2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; BF.EXISTS <span class=\"built_in\">test</span> user6</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\"><span class=\"comment\"># æ‰¹é‡æŸ¥è¯¢å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BF.MEXISTS <span class=\"built_in\">test</span> user1 user2 user6</span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">3) (<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–ä¿¡æ¯</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BF.INFO <span class=\"built_in\">test</span></span><br><span class=\"line\"> 1) Capacity       <span class=\"comment\"># åˆå§‹åŒ–æ—¶çš„å®¹é‡ï¼Œè¶…è¿‡è¯¥å€¼åï¼Œä¼šè§¦å‘ æ‰©å®¹ï¼ˆæ–°å»ºä¸€ä¸ªå­ Bloom Filterï¼‰</span></span><br><span class=\"line\"> 2) (<span class=\"built_in\">integer</span>) 1000</span><br><span class=\"line\"> 3) Size           <span class=\"comment\"># å½“å‰ Bloom Filter å®é™…ä½¿ç”¨çš„ bit array å¤§å°ï¼ˆå­—èŠ‚)ï¼Œç”± capacity + error_rate è®¡ç®—å¾—å‡ºï¼Œå€¼ä¸€æ—¦åˆ›å»º ä¸ä¼šéšå…ƒç´ å‡å°‘</span></span><br><span class=\"line\"> 4) (<span class=\"built_in\">integer</span>) 1480</span><br><span class=\"line\"> 5) Number of filters <span class=\"comment\"># å½“å‰ key å†…éƒ¨åŒ…å«çš„ Bloom Filter æ•°é‡</span></span><br><span class=\"line\"> 6) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"> 7) Number of items inserted  <span class=\"comment\"># å·²è°ƒç”¨ BF.ADD / BF.MADD æ’å…¥çš„å…ƒç´ æ€»æ•°</span></span><br><span class=\"line\"> 8) (<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\"> 9) Expansion rate     <span class=\"comment\"># Bloom Filter æ‰©å®¹æ—¶ï¼Œæ–°å»ºå­è¿‡æ»¤å™¨çš„å®¹é‡å¢é•¿å€ç‡</span></span><br><span class=\"line\">10) (<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"SpringBoot-é›†æˆ\">SpringBoot é›†æˆ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SpringBoot çš„ RedisTemplate ä¸­æ²¡æœ‰æä¾›å¯¹<code>RedisBloom</code>çš„å°è£…ï¼Œéœ€è¦è‡ªå·±å°è£…ï¼Œæˆ‘è¿™é‡Œå°è£…äº†ä¸€ä¸ªç®€æ˜“çš„<code>RedisBloomFilterTool</code></p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.example.redisbloom;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * åŸºäº RedisBloom æ’ä»¶çš„ BloomFilter å®ç°</span></span><br><span class=\"line\"><span class=\"comment\"> * https://github.com/RedisBloom/RedisBloom/releases</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * ä¸æƒ³å®‰è£…æ’ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ Redission çš„ BloomFilter</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisBloomFilterTool</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> StringRedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">RedisBloomFilterTool</span><span class=\"params\">(StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.redisTemplate = redisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆå§‹åŒ– BloomFilter</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¸èƒ½é‡å¤åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key       BloomFilter åç§°</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> errorRate é”™è¯¯ç‡ï¼Œæ¯”å¦‚ä¸º0.01ï¼Œå³ 1%</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> capacity  å®¹é‡ï¼Œæ¯”å¦‚ä¸º1000</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">reserve</span><span class=\"params\">(String key, <span class=\"type\">double</span> errorRate, <span class=\"type\">long</span> capacity)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;BF.RESERVE&#x27;, KEYS[1], &quot;</span> + errorRate + <span class=\"string\">&quot;, &quot;</span> + capacity + <span class=\"string\">&quot;)&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            redisTemplate.execute(</span><br><span class=\"line\">                    <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, String.class),</span><br><span class=\"line\">                    Collections.singletonList(key)</span><br><span class=\"line\">            );</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;RedisBloomFilterTool reserve error:&quot;</span>, e);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ·»åŠ å…ƒç´ åˆ° BloomFilterï¼ŒBloomFilter ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">add</span><span class=\"params\">(String key, String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ä½¿ç”¨ RedisModule æä¾›çš„ BF.ADD å‘½ä»¤</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;BF.ADD&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Boolean</span> <span class=\"variable\">execute</span> <span class=\"operator\">=</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, Boolean.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                value</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Boolean.TRUE.equals(execute);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">exists</span><span class=\"params\">(String key, String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;BF.EXISTS&#x27;, KEYS[1], ARGV[1])&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Boolean</span> <span class=\"variable\">execute</span> <span class=\"operator\">=</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, Boolean.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                value</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Boolean.TRUE.equals(execute);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ‰¹é‡æ·»åŠ </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> æ·»åŠ ç»“æœåˆ—è¡¨ï¼ŒæˆåŠŸ 1ï¼Œå¤±è´¥ 0</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Long&gt; <span class=\"title function_\">addBatch</span><span class=\"params\">(String key, String... items)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;BF.MADD&#x27;, KEYS[1], unpack(ARGV))&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (items == <span class=\"literal\">null</span> || items.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// è°ƒç”¨ BF.MADD å‘½ä»¤</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                items</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ‰¹é‡æ·»åŠ ï¼Œå¦‚æœBloomFilterä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ®å‚æ•°åˆ›å»º BloomFilterï¼Œè‹¥å·²å­˜åœ¨ï¼Œåˆ™å¿½ç•¥ capacity å’Œ errorRate</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key       BloomFilter åç§°</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> capacity  å®¹é‡</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> errorRate é”™è¯¯ç‡</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> items     è¦æ·»åŠ çš„å…ƒç´ </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> æ·»åŠ ç»“æœåˆ—è¡¨ï¼ŒæˆåŠŸ 1ï¼Œå¤±è´¥ 0</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Long&gt; <span class=\"title function_\">insert</span><span class=\"params\">(String key, <span class=\"type\">long</span> capacity, <span class=\"type\">double</span> errorRate, String... items)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;BF.INSERT&#x27;, KEYS[1], &#x27;CAPACITY&#x27;, ARGV[1], &#x27;ERROR&#x27;, ARGV[2], &#x27;ITEMS&#x27;, unpack(ARGV, 3))&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (items == <span class=\"literal\">null</span> || items.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;Object&gt; args = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        args.add(String.valueOf(capacity));</span><br><span class=\"line\">        args.add(String.valueOf(errorRate));</span><br><span class=\"line\">        Collections.addAll(args, items);   <span class=\"comment\">// âœ… å…³é”®ç‚¹</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// è°ƒç”¨ BF.INSERT å‘½ä»¤</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                args.toArray()</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ‰¹é‡åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> å­˜åœ¨ 1ï¼Œä¸å­˜åœ¨ 0</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Long&gt; <span class=\"title function_\">mexists</span><span class=\"params\">(String key, String... items)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;BF.MEXISTS&#x27;, KEYS[1], unpack(ARGV))&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (items == <span class=\"literal\">null</span> || items.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// è°ƒç”¨ BF.MADD å‘½ä»¤</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class=\"line\">                Collections.singletonList(key),</span><br><span class=\"line\">                items</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * è·å–å…ƒç´ æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Long <span class=\"title function_\">card</span><span class=\"params\">(String key)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;BF.CARD&#x27;, KEYS[1])&quot;</span>;</span><br><span class=\"line\">        <span class=\"comment\">// ä½¿ç”¨ RedisModule æä¾›çš„ BF.CARD å‘½ä»¤</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, Long.class),</span><br><span class=\"line\">                Collections.singletonList(key)</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * è·å– Bloom Filter å…ƒä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Map&lt;String, Long&gt; <span class=\"title function_\">info</span><span class=\"params\">(String key)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">script</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;return redis.call(&#x27;BF.INFO&#x27;, KEYS[1])&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;Object&gt; result = redisTemplate.execute(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultRedisScript</span>&lt;&gt;(script, List.class),</span><br><span class=\"line\">                Collections.singletonList(key)</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (result == <span class=\"literal\">null</span> || result.isEmpty()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Collections.emptyMap();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        Map&lt;String, Long&gt; infoMap = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; result.size(); i += <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">field</span> <span class=\"operator\">=</span> toString(result.get(i));</span><br><span class=\"line\">            <span class=\"type\">Long</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> (Long) result.get(i + <span class=\"number\">1</span>);</span><br><span class=\"line\">            infoMap.put(field, value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> infoMap;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String <span class=\"title function_\">toString</span><span class=\"params\">(Object obj)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> <span class=\"type\">byte</span>[]) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>((<span class=\"type\">byte</span>[]) obj);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> String.valueOf(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"SpringBoot-ä¸-Redisson-é›†æˆä¹‹-BloomFilter-çš„ä½¿ç”¨æ–¹æ³•\">SpringBoot ä¸ Redisson é›†æˆä¹‹ BloomFilter çš„ä½¿ç”¨æ–¹æ³•</h2>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.redisson<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.52.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> RedissonClient redissonClient;</span><br><span class=\"line\"></span><br><span class=\"line\">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class=\"line\">RBloomFilter&lt;Object&gt; bloomFilter = redissonClient.getBloomFilter(<span class=\"string\">&quot;bloomFilter&quot;</span>);</span><br><span class=\"line\">bloomFilter.tryInit(<span class=\"number\">1000000</span>, <span class=\"number\">0.01</span>); <span class=\"comment\">// åˆå§‹åŒ–</span></span><br><span class=\"line\">bloomFilter.add(<span class=\"string\">&quot;test&quot;</span>); <span class=\"comment\">// æ·»åŠ å…ƒç´ </span></span><br><span class=\"line\">System.out.println(bloomFilter.contains(<span class=\"string\">&quot;test&quot;</span>)); <span class=\"comment\">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\">System.out.println(bloomFilter.count()); <span class=\"comment\">// è·å–å½“å‰å¸ƒéš†è¿‡æ»¤å™¨ä¸­å·²æ·»åŠ çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class=\"line\">System.out.println(bloomFilter.getSize()); <span class=\"comment\">// è·å–å½“å‰å¸ƒéš†è¿‡æ»¤å™¨å ç”¨å†…å­˜çš„å¤§å°ï¼Œå•ä½bit</span></span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Bloom Filter æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisBloom çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub Bloom Filter(å¸ƒéš†è¿‡æ»¤å™¨) å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§ç”¨äºå¿«é€Ÿåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨çš„ probabilistic data structureï¼ˆæ¦‚ç‡æ•°æ®ç»“æ„ï¼‰ï¼Œéå¸¸é€‚åˆæµ·é‡æ•°æ®ä¸”ä¸è¦æ±‚ç»å¯¹ç²¾ç¡®çš„åœºæ™¯ã€‚ ç»´åŸºç™¾ç§‘å¯¹ Bloom Filter çš„æè¿° ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ Redissonçš„å¸ƒéš†è¿‡æ»¤å™¨ å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶ä½æ•°ç»„å’Œä¸€ç³»åˆ—å“ˆå¸Œå‡½æ•°æ¥ä¿å­˜å…ƒç´ ã€‚ ä¼˜ç‚¹: éå¸¸èŠ‚çœç©ºé—´ã€æŸ¥è¯¢å¿« ç¼ºç‚¹: æœ‰ä¸€å®šçš„è¯¯åˆ¤æ¦‚ç‡ã€æ— æ³•åˆ é™¤å…ƒç´ ã€æ— æ³•ç»™å…ƒç´ è®¡æ•° å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ä¸€ä¸ªå…ƒç´ ä¸åœ¨é›†åˆä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ è‚¯å®šä¸åœ¨é›†åˆä¸­ã€‚ä½†æ˜¯ï¼Œå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ä¸€ä¸ªå…ƒç´ åœ¨é›†åˆä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ æœ‰å¯èƒ½ä¸åœ¨é›†åˆä¸­ã€‚ ä½æ•°ç»„ï¼ˆBit Arrayï¼‰ï¼šå¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨ä¸€ä¸ªé•¿åº¦å›ºå®šçš„ä½æ•°ç»„æ¥å­˜å‚¨æ•°æ®ã€‚æ¯ä¸ªä½ç½®åªå ç”¨ä¸€ä¸ªæ¯”ç‰¹ï¼ˆ0æˆ–1ï¼‰ï¼Œåˆå§‹æ—¶æ‰€æœ‰ä½éƒ½è®¾ç½®ä¸º0ã€‚ä½æ•°ç»„çš„é•¿åº¦å’Œå“ˆå¸Œå‡½æ•°çš„æ•°é‡å†³å®šäº†è¿‡æ»¤å™¨çš„è¯¯æŠ¥ç‡å’Œå®¹é‡ã€‚ å“ˆå¸Œå‡½æ•°é›†åˆï¼šå¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°éƒ½ä¼šå°†è¾“å…¥æ•°æ®æ˜ å°„åˆ°ä½æ•°ç»„çš„ä¸€ä¸ªä¸åŒä½ç½®ã€‚å“ˆå¸Œå‡½æ•°çš„é€‰æ‹©å¯¹è¿‡æ»¤å™¨çš„æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼Œç†æƒ³çš„å“ˆå¸Œå‡½æ•°åº”è¯¥å…·æœ‰è‰¯å¥½çš„æ•£åˆ—æ€§ï¼Œä½¿å¾—ä¸åŒçš„è¾“å…¥å°½å¯èƒ½å‡åŒ€åœ°æ˜ å°„åˆ°ä½æ•°ç»„çš„ä¸åŒä½ç½®ã€‚ å¦‚ä½•é™ä½è¯¯åˆ¤ç‡ï¼Ÿ æ›´å¤§çš„ä½æ•°ç»„ æ›´å¤šçš„å“ˆå¸Œå‡½æ•° å¾ˆå¤šäººéƒ½æ˜¯ç”¨è¿‡Googleå¼€æºçš„Guavaçš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä½†å…¶æ˜¯JVMå±‚çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œè‹¥éœ€è¦åˆ†å¸ƒå¼å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°±å¯ä»¥ä½¿ç”¨RedisBloomæä¾›çš„BF(Bloom Filter)ã€‚ BF å‘½ä»¤è¯´æ˜ å¯¹åº”Rediså‘½ä»¤ï¼š BF.xxx å‘½ä»¤ åŠŸèƒ½è¯´æ˜ æ˜¯å¦åˆ›å»º Filter å…³é”®å‚æ•°å«ä¹‰ è¿”å›å€¼ ç¤ºä¾‹ ä½¿ç”¨è¦ç‚¹ / å¤‡æ³¨ BF.RESERVE æ˜¾å¼åˆ›å»º Bloom Filter æ˜¯ï¼ˆå·²å­˜åœ¨åˆ™æŠ¥é”™ï¼‰ error_rateï¼šè¯¯åˆ¤ç‡capacityï¼šé¢„è®¡å…ƒç´ æ•°EXPANSIONï¼šæ‰©å®¹å€ç‡ OK BF.RESERVE user:bf 0.001 1000000 âœ… ç”Ÿäº§æ¨èæ˜¾å¼è§„åˆ’å®¹é‡ä¸è¯¯åˆ¤ç‡ï¼Œé¿å…éšå¼åˆ›å»º BF.ADD æ·»åŠ å•ä¸ªå…ƒç´  æ˜¯ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰ æ—  1 æ–°å¢0 å¯èƒ½å·²å­˜åœ¨ BF.ADD user:bf user_1 Key å¿…é¡»å·²å­˜åœ¨ï¼Œå¦åˆ™æŠ¥é”™ BF.MADD æ‰¹é‡æ·»åŠ å…ƒç´  æ˜¯ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰ item...ï¼šå¤šä¸ªå…ƒç´  0/1 åˆ—è¡¨ BF.MADD user:bf u1 u2 u3 âš  ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œä¸å»ºè®®ç”Ÿäº§ BF.INSERT æ‰¹é‡æ’å…¥ï¼ˆå¯æ§å‚æ•°ï¼‰ æ˜¯ CAPACITYï¼šå®¹é‡ERRORï¼šè¯¯åˆ¤ç‡NOCREATE:ä¸è‡ªåŠ¨åˆ›å»ºè¿‡æ»¤å™¨NONSCALING: ä¸æ‰©å®¹ï¼Œè¾¾åˆ°capacityæ—¶ï¼Œè¿‡æ»¤å™¨è¿”å›é”™è¯¯EXPANSION expansion:æ‰©å®¹æ—¶ï¼Œæ–°å»ºå­è¿‡æ»¤å™¨çš„å®¹é‡å¢é•¿å€ç‡ï¼Œé»˜è®¤2 ITEMSï¼šå…ƒç´ åˆ—è¡¨ 0/1 åˆ—è¡¨ BF.INSERT user:bf CAPACITY 10000 ERROR 0.001 ITEMS u1 u2 âœ… æœ€æ¨èçš„å†™å…¥æ–¹å¼æ”¯æŒåˆå§‹åŒ– + æ’å…¥ BF.EXISTS åˆ¤æ–­å•ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ å¦ itemï¼šå¾…åˆ¤æ–­å…ƒç´  1 å¯èƒ½å­˜åœ¨0 ä¸€å®šä¸å­˜åœ¨ BF.EXISTS user:bf user_1 ä¸å­˜åœ¨ç»“æœ ç»å¯¹å¯é  BF.MEXISTS æ‰¹é‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨ å¦ item...ï¼šå¤šä¸ªå…ƒç´  0/1 åˆ—è¡¨ BF.MEXISTS user:bf u1 u9 é«˜å¹¶å‘æ‰¹é‡æŸ¥è¯¢é¦–é€‰ BF.CARD è¿”å›æ’å…¥å…ƒç´ æ•°é‡ï¼ˆè¿‘ä¼¼ï¼‰ å¦ æ—  æ•´æ•° BF.CARD user:bf ç”¨äºå®¹é‡ç›‘æ§ï¼Œéç²¾ç¡® BF.INFO è¿”å› Bloom Filter å…ƒä¿¡æ¯ å¦ æ—  KV åˆ—è¡¨ BF.INFO user:bf è¿ç»´ã€å®¹é‡ä¸å†…å­˜åˆ†æå¿…å¤‡ BF.SCANDUMP åˆ†å—å¯¼å‡º Bloom Filter å¦ iteratorï¼šæ¸¸æ ‡ iterator + data BF.SCANDUMP user:bf 0 ç”¨äºè¿ç§»ã€å¤‡ä»½ BF.LOADCHUNK ä» dump æ•°æ®æ¢å¤ Filter æ˜¯ iteratordata OK BF.LOADCHUNK user:bf 1 &quot;xxx&quot; å¿…é¡»ä¸ SCANDUMP é…åˆä½¿ç”¨ BF å‘½ä»¤ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344# åˆå§‹åŒ–ä¸€ä¸ªBloomFilterï¼Œé”™è¯¯ç‡0.01ï¼Œå…ƒç´ æ•°é‡1000127.0.0.1:6379&gt; BF.RESERVE test 0.01 1000OK# æŸ¥çœ‹ç±»å‹127.0.0.1:6379&gt; type testMBbloom--# æ·»åŠ å…ƒç´ 127.0.0.1:6379&gt; BF.ADD test user1(integer) 1127.0.0.1:6379&gt; BF.ADD test user2(integer) 1# æ‰¹é‡æ·»åŠ å…ƒç´ 127.0.0.1:6379&gt; BF.MADD test user3 user4 user51) (integer) 12) (integer) 13) (integer) 1# è¿”å›Bloomè¿‡æ»¤å™¨çš„åŸºæ•°ï¼Œå³æ·»åŠ çš„å…ƒç´ æ•°é‡(å­˜åœ¨è¯¯å·®)127.0.0.1:6379&gt; BF.CARD test(integer) 5# æŸ¥è¯¢å…ƒç´ æ˜¯å¦å­˜åœ¨127.0.0.1:6379&gt; BF.EXISTS test user2(integer) 1127.0.0.1:6379&gt; BF.EXISTS test user6(integer) 0# æ‰¹é‡æŸ¥è¯¢å…ƒç´ æ˜¯å¦å­˜åœ¨127.0.0.1:6379&gt; BF.MEXISTS test user1 user2 user61) (integer) 12) (integer) 13) (integer) 0# è·å–ä¿¡æ¯127.0.0.1:6379&gt; BF.INFO test 1) Capacity # åˆå§‹åŒ–æ—¶çš„å®¹é‡ï¼Œè¶…è¿‡è¯¥å€¼åï¼Œä¼šè§¦å‘ æ‰©å®¹ï¼ˆæ–°å»ºä¸€ä¸ªå­ Bloom Filterï¼‰ 2) (integer) 1000 3) Size # å½“å‰ Bloom Filter å®é™…ä½¿ç”¨çš„ bit array å¤§å°ï¼ˆå­—èŠ‚)ï¼Œç”± capacity + error_rate è®¡ç®—å¾—å‡ºï¼Œå€¼ä¸€æ—¦åˆ›å»º ä¸ä¼šéšå…ƒç´ å‡å°‘ 4) (integer) 1480 5) Number of filters # å½“å‰ key å†…éƒ¨åŒ…å«çš„ Bloom Filter æ•°é‡ 6) (integer) 1 7) Number of items inserted # å·²è°ƒç”¨ BF.ADD / BF.MADD æ’å…¥çš„å…ƒç´ æ€»æ•° 8) (integer) 5 9) Expansion rate # Bloom Filter æ‰©å®¹æ—¶ï¼Œæ–°å»ºå­è¿‡æ»¤å™¨çš„å®¹é‡å¢é•¿å€ç‡10) (integer) 2 SpringBoot é›†æˆ SpringBoot çš„ RedisTemplate ä¸­æ²¡æœ‰æä¾›å¯¹RedisBloomçš„å°è£…ï¼Œéœ€è¦è‡ªå·±å°è£…ï¼Œæˆ‘è¿™é‡Œå°è£…äº†ä¸€ä¸ªç®€æ˜“çš„RedisBloomFilterTool 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188package com.example.redisbloom;/** * åŸºäº RedisBloom æ’ä»¶çš„ BloomFilter å®ç° * https://github.com/RedisBloom/RedisBloom/releases * &lt;p&gt; * ä¸æƒ³å®‰è£…æ’ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ Redission çš„ BloomFilter */import lombok.extern.slf4j.Slf4j;import org.springframework.data.redis.core.StringRedisTemplate;import org.springframework.data.redis.core.script.DefaultRedisScript;import org.springframework.stereotype.Component;import java.util.*;@Component@Slf4jpublic class RedisBloomFilterTool &#123; private final StringRedisTemplate redisTemplate; public RedisBloomFilterTool(StringRedisTemplate redisTemplate) &#123; this.redisTemplate = redisTemplate; &#125; /** * åˆå§‹åŒ– BloomFilter * &lt;p&gt; * ä¸èƒ½é‡å¤åˆ›å»º * * @param key BloomFilter åç§° * @param errorRate é”™è¯¯ç‡ï¼Œæ¯”å¦‚ä¸º0.01ï¼Œå³ 1% * @param capacity å®¹é‡ï¼Œæ¯”å¦‚ä¸º1000 */ public boolean reserve(String key, double errorRate, long capacity) &#123; String script = &quot;return redis.call(&#x27;BF.RESERVE&#x27;, KEYS[1], &quot; + errorRate + &quot;, &quot; + capacity + &quot;)&quot;; try &#123; redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, String.class), Collections.singletonList(key) ); return true; &#125; catch (Exception e) &#123; log.error(&quot;RedisBloomFilterTool reserve error:&quot;, e); return false; &#125; &#125; /** * æ·»åŠ å…ƒç´ åˆ° BloomFilterï¼ŒBloomFilter ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º */ public boolean add(String key, String value) &#123; // ä½¿ç”¨ RedisModule æä¾›çš„ BF.ADD å‘½ä»¤ String script = &quot;return redis.call(&#x27;BF.ADD&#x27;, KEYS[1], ARGV[1])&quot;; final Boolean execute = redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, Boolean.class), Collections.singletonList(key), value ); return Boolean.TRUE.equals(execute); &#125; /** * åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ */ public boolean exists(String key, String value) &#123; String script = &quot;return redis.call(&#x27;BF.EXISTS&#x27;, KEYS[1], ARGV[1])&quot;; final Boolean execute = redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, Boolean.class), Collections.singletonList(key), value ); return Boolean.TRUE.equals(execute); &#125; /** * æ‰¹é‡æ·»åŠ  * @return æ·»åŠ ç»“æœåˆ—è¡¨ï¼ŒæˆåŠŸ 1ï¼Œå¤±è´¥ 0 */ public List&lt;Long&gt; addBatch(String key, String... items) &#123; String script = &quot;return redis.call(&#x27;BF.MADD&#x27;, KEYS[1], unpack(ARGV))&quot;; if (items == null || items.length == 0) &#123; return Collections.emptyList(); &#125; // è°ƒç”¨ BF.MADD å‘½ä»¤ return redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, List.class), Collections.singletonList(key), items ); &#125; /** * æ‰¹é‡æ·»åŠ ï¼Œå¦‚æœBloomFilterä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ®å‚æ•°åˆ›å»º BloomFilterï¼Œè‹¥å·²å­˜åœ¨ï¼Œåˆ™å¿½ç•¥ capacity å’Œ errorRate * * @param key BloomFilter åç§° * @param capacity å®¹é‡ * @param errorRate é”™è¯¯ç‡ * @param items è¦æ·»åŠ çš„å…ƒç´  * @return æ·»åŠ ç»“æœåˆ—è¡¨ï¼ŒæˆåŠŸ 1ï¼Œå¤±è´¥ 0 */ public List&lt;Long&gt; insert(String key, long capacity, double errorRate, String... items) &#123; String script = &quot;return redis.call(&#x27;BF.INSERT&#x27;, KEYS[1], &#x27;CAPACITY&#x27;, ARGV[1], &#x27;ERROR&#x27;, ARGV[2], &#x27;ITEMS&#x27;, unpack(ARGV, 3))&quot;; if (items == null || items.length == 0) &#123; return Collections.emptyList(); &#125; List&lt;Object&gt; args = new ArrayList&lt;&gt;(); args.add(String.valueOf(capacity)); args.add(String.valueOf(errorRate)); Collections.addAll(args, items); // âœ… å…³é”®ç‚¹ // è°ƒç”¨ BF.INSERT å‘½ä»¤ return redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, List.class), Collections.singletonList(key), args.toArray() ); &#125; /** * æ‰¹é‡åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ * @return å­˜åœ¨ 1ï¼Œä¸å­˜åœ¨ 0 */ public List&lt;Long&gt; mexists(String key, String... items) &#123; String script = &quot;return redis.call(&#x27;BF.MEXISTS&#x27;, KEYS[1], unpack(ARGV))&quot;; if (items == null || items.length == 0) &#123; return Collections.emptyList(); &#125; // è°ƒç”¨ BF.MADD å‘½ä»¤ return redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, List.class), Collections.singletonList(key), items ); &#125; /** * è·å–å…ƒç´ æ•°é‡ */ public Long card(String key) &#123; String script = &quot;return redis.call(&#x27;BF.CARD&#x27;, KEYS[1])&quot;; // ä½¿ç”¨ RedisModule æä¾›çš„ BF.CARD å‘½ä»¤ return redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, Long.class), Collections.singletonList(key) ); &#125; /** * è·å– Bloom Filter å…ƒä¿¡æ¯ */ public Map&lt;String, Long&gt; info(String key) &#123; String script = &quot;return redis.call(&#x27;BF.INFO&#x27;, KEYS[1])&quot;; List&lt;Object&gt; result = redisTemplate.execute( new DefaultRedisScript&lt;&gt;(script, List.class), Collections.singletonList(key) ); if (result == null || result.isEmpty()) &#123; return Collections.emptyMap(); &#125; Map&lt;String, Long&gt; infoMap = new LinkedHashMap&lt;&gt;(); for (int i = 0; i &lt; result.size(); i += 2) &#123; String field = toString(result.get(i)); Long value = (Long) result.get(i + 1); infoMap.put(field, value); &#125; return infoMap; &#125; private String toString(Object obj) &#123; if (obj instanceof byte[]) &#123; return new String((byte[]) obj); &#125; return String.valueOf(obj); &#125;&#125; SpringBoot ä¸ Redisson é›†æˆä¹‹ BloomFilter çš„ä½¿ç”¨æ–¹æ³• 12345&lt;dependency&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.52.0&lt;/version&gt;&lt;/dependency&gt; 12345678910@Autowiredprivate RedissonClient redissonClient;â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦RBloomFilter&lt;Object&gt; bloomFilter = redissonClient.getBloomFilter(&quot;bloomFilter&quot;);bloomFilter.tryInit(1000000, 0.01); // åˆå§‹åŒ–bloomFilter.add(&quot;test&quot;); // æ·»åŠ å…ƒç´ System.out.println(bloomFilter.contains(&quot;test&quot;)); // åˆ¤æ–­æ˜¯å¦å­˜åœ¨System.out.println(bloomFilter.count()); // è·å–å½“å‰å¸ƒéš†è¿‡æ»¤å™¨ä¸­å·²æ·»åŠ çš„å…ƒç´ ä¸ªæ•°System.out.println(bloomFilter.getSize()); // è·å–å½“å‰å¸ƒéš†è¿‡æ»¤å™¨å ç”¨å†…å­˜çš„å¤§å°ï¼Œå•ä½bit","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å‹ RedisBloom ä¸­çš„ Bloom Filter æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisBloom çš„å®‰è£…å‚è§ Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³• ç¤ºä¾‹ä»£ç ï¼šGitHub","date_published":"2025-12-22T05:40:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/21/redis7-module-RedisBloom/","url":"https://blog.hanqunfeng.com/2025/12/21/redis7-module-RedisBloom/","title":"Redis æ‰©å±•æ¨¡å— -- RedisBloom çš„å®‰è£…æ–¹æ³•","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisBloom çš„å®‰è£…æ–¹æ³•</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">æ“ä½œç³»ç»Ÿï¼š<code>Amazon Linux 2023(å†…æ ¸ 6.1)</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RedisBloom-ç®€ä»‹\">RedisBloom ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/RedisBloom/RedisBloom\">RedisBloom</a> æ˜¯ Redis å®˜æ–¹ç»´æŠ¤çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œéš¶å±äº <code>Redis Stack</code>ï¼Œä¸“é—¨ç”¨äºæä¾›æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼ˆProbabilistic Data Structuresï¼‰çš„é«˜æ€§èƒ½å®ç°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒé€šè¿‡ç‰ºç‰²ä¸€å®šçš„ç²¾ç¡®æ€§ï¼Œæ¢å–æä½çš„å†…å­˜å ç”¨å’Œæé«˜çš„ååèƒ½åŠ›ï¼Œéå¸¸é€‚åˆæµ·é‡æ•°æ®åœºæ™¯ä¸‹çš„â€œå­˜åœ¨æ€§åˆ¤æ–­â€å’Œâ€œè¿‘ä¼¼ç»Ÿè®¡â€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯¥æ¨¡å—ä»¥ <code>Redis Module</code> æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Redis8+ï¼ŒRedisBloom å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚</p>\n</li>\n</ul>\n<h2 id=\"RedisBloom-æä¾›çš„æ ¸å¿ƒæ•°æ®ç»“æ„\">RedisBloom æä¾›çš„æ ¸å¿ƒæ•°æ®ç»“æ„</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…å¥½RedisBloomåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æŸ¥çœ‹RedisBloom æ”¯æŒçš„å‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®é™…ä¸Šæ‰€æœ‰ Stack Module Commandséƒ½æ˜¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼Œå› ä¸ºæˆ‘ä»¬è¿™é‡Œåªå®‰è£…äº† RedisBloomï¼Œæ‰€ä»¥æ­¤æ—¶ä»…å¯ä»¥çœ‹åˆ° RedisBloom æ¨¡å—çš„å‘½ä»¤</span></span><br><span class=\"line\">&gt; <span class=\"built_in\">help</span> @module</span><br></pre></td></tr></table></figure>\n<h3 id=\"é€šè¿‡è¾“å‡ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°-RedisBloom-æ¨¡å—æ”¯æŒçš„å‘½ä»¤å¤§è‡´åˆ†ä¸º-5-ç±»\">é€šè¿‡è¾“å‡ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ° RedisBloom æ¨¡å—æ”¯æŒçš„å‘½ä»¤å¤§è‡´åˆ†ä¸º 5 ç±»</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1ï¸âƒ£ Bloom Filterï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">åˆ¤æ–­æŸä¸ªå…ƒç´ â€œå¯èƒ½å­˜åœ¨ / ä¸€å®šä¸å­˜åœ¨â€ï¼Œä½†ä¸å­˜å‚¨å…ƒç´ æœ¬èº«ï¼Œä¹Ÿä¸æ”¯æŒåˆ é™¤</li>\n<li class=\"lvl-6\"><a href=\"https://en.wikipedia.org/wiki/Bloom_filter\">ç»´åŸºç™¾ç§‘å¯¹ Bloom Filter çš„æè¿°</a></li>\n<li class=\"lvl-6\">ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ <a href=\"https://redisson.pro/docs/data-and-services/objects/#bloom-filter\">Redissonçš„å¸ƒéš†è¿‡æ»¤å™¨</a></li>\n<li class=\"lvl-6\">å¯¹åº”Rediså‘½ä»¤ï¼š <code>BF.xxx</code>ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ <a href=\"/2025/12/22/redis7-datatype-11-BF/\" title=\"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- BF(Bloom Filter)\">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- BF(Bloom Filter)</a></li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>2ï¸âƒ£ Cuckoo Filterï¼ˆå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼‰</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">Bloom Filter çš„å¢å¼ºç‰ˆï¼Œæ”¯æŒ åˆ é™¤å…ƒç´ </li>\n<li class=\"lvl-6\"><a href=\"https://en.wikipedia.org/wiki/Cuckoo_filter\">ç»´åŸºç™¾ç§‘å¯¹ Cuckoo Filter çš„æè¿°</a></li>\n<li class=\"lvl-6\">åœ¨é«˜ QPS æŸ¥è¯¢åœºæ™¯ä¸‹ï¼ŒCuckoo Filter é€šå¸¸ä¼˜äº Bloom Filterã€‚</li>\n<li class=\"lvl-6\">ä½è¯¯åˆ¤ç‡ + é«˜è´Ÿè½½ç‡åœºæ™¯ï¼ŒCuckoo Filter æ›´çœå†…å­˜ã€‚</li>\n<li class=\"lvl-6\">å¯¹åº”Rediså‘½ä»¤ï¼š <code>CF.xxx</code>ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ <a href=\"/2025/12/22/redis7-datatype-12-CF/\" title=\"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CF(Cuckoo Filter)\">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CF(Cuckoo Filter)</a></li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>3ï¸âƒ£ Count-Min Sketchï¼ˆCMSï¼‰</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">è¿‘ä¼¼ç»Ÿè®¡å…ƒç´ å‡ºç°é¢‘ç‡</li>\n<li class=\"lvl-6\">å¯¹åº”Rediså‘½ä»¤ï¼š <code>CMS.xxx</code>ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ <a href=\"/2025/12/23/redis7-datatype-13-CMS/\" title=\"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch)\">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch)</a></li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>4ï¸âƒ£ Top-K</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ç»Ÿè®¡è®¿é—®é¢‘ç‡æœ€é«˜çš„ K ä¸ªå…ƒç´ </li>\n<li class=\"lvl-6\">å¯¹åº”Rediså‘½ä»¤ï¼š <code>TOPK.xxx</code>ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ <a href=\"/2025/12/23/redis7-datatype-14-TopK/\" title=\"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TopK\">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TopK</a></li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>5ï¸âƒ£ TDigest</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ç»Ÿè®¡æ•°å­—çš„åˆ†å¸ƒ</li>\n<li class=\"lvl-6\">å¯¹åº”Rediså‘½ä»¤ï¼š <code>TDIGEST.xxx</code>ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ <a href=\"/2025/12/23/redis7-datatype-15-TDigest/\" title=\"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TDigest\">Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TDigest</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"å®‰è£…-RedisBloom\">å®‰è£… RedisBloom</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä»<a href=\"https://cloud.redis.io\">Redis Cloud</a>çš„<code>Download Center</code>ä¸­è¿›è¡Œä¸‹è½½ï¼Œå…¶æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„<code>.so</code>æ–‡ä»¶ï¼Œå¯ä»¥ä¼˜å…ˆè¿›è¡Œå°è¯•ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/uPic/rguEIA.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æºç ç¼–è¯‘</p>\n</li>\n</ul>\n<blockquote>\n<p>å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚<br>\nå¯ä»¥åœ¨æµ·å¤–çš„<code>ç›¸åŒé…ç½®</code>çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„<code>redisbloom.so</code>ä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install -y \\</span><br><span class=\"line\">  gcc \\</span><br><span class=\"line\">  gcc-c++ \\</span><br><span class=\"line\">  make \\</span><br><span class=\"line\">  cmake \\</span><br><span class=\"line\">  autoconf \\</span><br><span class=\"line\">  automake \\</span><br><span class=\"line\">  libtool \\</span><br><span class=\"line\">  pkgconfig \\</span><br><span class=\"line\">  openssl-devel</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¯‘RedisBloom</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /usr/local/soft/modules/</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/soft/modules</span><br><span class=\"line\"><span class=\"comment\"># clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> --recursive https://github.com/RedisBloom/RedisBloom.git</span><br><span class=\"line\"><span class=\"built_in\">cd</span> RedisBloom</span><br><span class=\"line\"><span class=\"comment\"># æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬</span></span><br><span class=\"line\">git checkout v2.8.17</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥</span></span><br><span class=\"line\">git submodule update --init --recursive</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥å¹¶å®‰è£…éœ€è¦çš„ä¾èµ–</span></span><br><span class=\"line\">./sbin/setup</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\"># readies version: 7fc8e62</span></span><br><span class=\"line\">dnf install -q -y ca-certificates</span><br><span class=\"line\">dnf install -q -y wget unzip</span><br><span class=\"line\">/usr/local/soft/modules/RedisBloom/deps/readies/bin/enable-utf8</span><br><span class=\"line\">dnf install -q -y git jq</span><br><span class=\"line\">dnf install -q -y <span class=\"built_in\">which</span></span><br><span class=\"line\">/usr/local/soft/modules/RedisBloom/deps/readies/bin/getepel</span><br><span class=\"line\">/usr/local/soft/modules/RedisBloom/deps/readies/bin/getgcc --modern</span><br><span class=\"line\">dnf install -q -y valgrind</span><br><span class=\"line\">/usr/local/soft/modules/RedisBloom/sbin/get-fbinfer</span><br><span class=\"line\">dnf install -q -y lcov</span><br><span class=\"line\">/usr/bin/python3 /usr/local/soft/modules/RedisBloom/deps/readies/bin/getrmpytools --reinstall --modern</span><br><span class=\"line\">/usr/bin/python3 /usr/local/soft/modules/RedisBloom/deps/readies/bin/getcmake --usr</span><br><span class=\"line\">/usr/bin/python3 -m pip install --disable-pip-version-check --user  -r tests/flow/requirements.txt</span><br><span class=\"line\">/usr/local/soft/modules/RedisBloom/deps/readies/bin/getaws</span><br><span class=\"line\">/usr/bin/python3 -m pip install --disable-pip-version-check --user  pudb</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘</span></span><br><span class=\"line\">make</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">Building /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-c/src/libtdigest_static.a ...</span><br><span class=\"line\"></span><br><span class=\"line\">Generating /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-c/Makefile ...</span><br><span class=\"line\">-- The C compiler identification is GNU 11.5.0</span><br><span class=\"line\">-- The CXX compiler identification is GNU 11.5.0</span><br><span class=\"line\">-- Detecting C compiler ABI info</span><br><span class=\"line\">-- Detecting C compiler ABI info - <span class=\"keyword\">done</span></span><br><span class=\"line\">-- Check <span class=\"keyword\">for</span> working C compiler: /usr/bin/gcc - skipped</span><br><span class=\"line\">-- Detecting C compile features</span><br><span class=\"line\">-- Detecting C compile features - <span class=\"keyword\">done</span></span><br><span class=\"line\">-- Detecting CXX compiler ABI info</span><br><span class=\"line\">-- Detecting CXX compiler ABI info - <span class=\"keyword\">done</span></span><br><span class=\"line\">-- Check <span class=\"keyword\">for</span> working CXX compiler: /usr/bin/g++ - skipped</span><br><span class=\"line\">-- Detecting CXX compile features</span><br><span class=\"line\">-- Detecting CXX compile features - <span class=\"keyword\">done</span></span><br><span class=\"line\">-- Setting build <span class=\"built_in\">type</span> to <span class=\"string\">&#x27;Release&#x27;</span> as none was specified.</span><br><span class=\"line\">-- Configuring <span class=\"keyword\">done</span></span><br><span class=\"line\">-- Generating <span class=\"keyword\">done</span></span><br><span class=\"line\">-- Build files have been written to: /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-c</span><br><span class=\"line\"></span><br><span class=\"line\">Building /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-c/libtdigest_static.a ...</span><br><span class=\"line\">[ 50%] Building C object src/CMakeFiles/tdigest_static.dir/tdigest.c.o</span><br><span class=\"line\">[100%] Linking C static library libtdigest_static.a</span><br><span class=\"line\">[100%] Built target tdigest_static</span><br><span class=\"line\">Compiling deps/bloom/bloom.c...</span><br><span class=\"line\">Compiling deps/murmur2/MurmurHash2.c...</span><br><span class=\"line\">Compiling deps/rmutil/util.c...</span><br><span class=\"line\">Compiling src/rebloom.c...</span><br><span class=\"line\">Compiling src/sb.c...</span><br><span class=\"line\">Compiling src/cf.c...</span><br><span class=\"line\">Compiling src/rm_topk.c...</span><br><span class=\"line\">Compiling src/rm_tdigest.c...</span><br><span class=\"line\">Compiling src/topk.c...</span><br><span class=\"line\">Compiling src/rm_cms.c...</span><br><span class=\"line\">Compiling src/cms.c...</span><br><span class=\"line\">Linking /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/redisbloom.so...</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong><code>./sbin/setup</code> æŠ¥é”™</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æœ¬äººä½¿ç”¨çš„æ˜¯ Amazon Linux 2023(å†…æ ¸ 6.1)ï¼Œå³ <code>EL9</code>ï¼Œç±»ä¼¼äºCentOS 9ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œä¼šæŠ¥é”™ï¼Œå¤§è‡´æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./sbin/setup</span><br><span class=\"line\"><span class=\"comment\">## é”™è¯¯ä¿¡æ¯</span></span><br><span class=\"line\">â€¦â€¦</span><br><span class=\"line\">[FAILED] raven-release.el9.noarch.rpm: Status code: 403 <span class=\"keyword\">for</span> https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)</span><br><span class=\"line\">Status code: 403 <span class=\"keyword\">for</span> https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)</span><br><span class=\"line\"></span><br><span class=\"line\">In /usr/local/soft/modules/RedisBloom/deps/readies/bin/getepel:</span><br><span class=\"line\">346      \t\t<span class=\"comment\"># xinstall --allowerasing https://dl.fedoraproject.org/pub/epel/epel-release-latest-$&#123;EPEL&#125;.noarch.rpm</span></span><br><span class=\"line\">347      \t<span class=\"keyword\">fi</span></span><br><span class=\"line\">348</span><br><span class=\"line\">349  &gt;&gt;&gt; \tinstall_raven</span><br><span class=\"line\">350      \tinstall_remi</span><br><span class=\"line\">351      \t<span class=\"comment\"># install_centos_stream_repos</span></span><br><span class=\"line\">352</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">command</span> failed: /usr/local/soft/modules/RedisBloom/deps/readies/bin/getepel</span><br><span class=\"line\"></span><br><span class=\"line\">In /usr/local/soft/modules/RedisBloom/sbin/setup:</span><br><span class=\"line\">16       \tpython3 -m pip list</span><br><span class=\"line\">17       <span class=\"keyword\">fi</span></span><br><span class=\"line\">18</span><br><span class=\"line\">19   &gt;&gt;&gt; <span class=\"variable\">$ROOT</span>/sbin/system-setup.py</span><br><span class=\"line\">20       <span class=\"keyword\">if</span> [[ <span class=\"variable\">$VERBOSE</span> == 1 ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">21       \tpython3 -m pip list</span><br><span class=\"line\">22       <span class=\"keyword\">fi</span> ç¼–è¯‘å®‰è£…æ—¶æŠ¥é”™</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## é”™è¯¯åˆ†æä¸è§£å†³æ–¹æ³•</span></span><br><span class=\"line\">é—®é¢˜åŸå› ï¼š</span><br><span class=\"line\">    ä½ è¿™ä¸ªé”™è¯¯ä¸æ˜¯ RedisBloom æœ¬èº«çš„ç¼–è¯‘é—®é¢˜ï¼Œè€Œæ˜¯ ä¾èµ–ç¯å¢ƒåˆå§‹åŒ–ï¼ˆreadies / getepelï¼‰é˜¶æ®µå¤±è´¥ï¼Œå¤±è´¥ç‚¹éå¸¸æ˜ç¡®ã€‚</span><br><span class=\"line\">readies/bin/getepel è„šæœ¬åœ¨ RHEL 9 / Rocky 9 / AlmaLinux 9 ç³»ç»Ÿä¸Šå°è¯•å®‰è£… Raven Repoï¼Œä½†è¯¥ä»“åº“åœ°å€ https://dyn.su/el9/... å·²è¢« 403 Forbidden æ‹’ç»ï¼Œå¯¼è‡´è„šæœ¬ç›´æ¥å¤±è´¥å¹¶ä¸­æ–­ setupã€‚</span><br><span class=\"line\">    è¿™ä¸æ˜¯ä½ æœºå™¨çš„é—®é¢˜ï¼Œè€Œæ˜¯ RedisBloom ä¾èµ–å·¥å…·é“¾å¯¹ EL9 çš„å…¼å®¹æ€§æ»åã€‚</span><br><span class=\"line\">    RedisBloom çš„ ./sbin/setup ä¼šè°ƒç”¨ deps/readies/bin/getepel</span><br><span class=\"line\">    è¿™ä¸ªè„šæœ¬ç”¨äºï¼š</span><br><span class=\"line\">        å®‰è£… EPEL</span><br><span class=\"line\">        å®‰è£… Raven Repoï¼ˆEL9 ç‰¹æœ‰ï¼‰</span><br><span class=\"line\">        å®‰è£… Remi Repo</span><br><span class=\"line\">    ä½† Raven Repo ç›®å‰å·²ä¸ç¨³å®š / ä¸å†å…¬å¼€æä¾› rpm ä¸‹è½½ï¼Œè€Œ readies ä»£ç ä»ç„¶åœ¨å¼ºåˆ¶å®‰è£…ã€‚</span><br><span class=\"line\">    ä½ çš„ç³»ç»Ÿæ˜¯ EL9 ç³»åˆ—ï¼Œæ—¥å¿—ä¸­æ˜ç¡®ï¼šraven-release.el9.noarch.rpm</span><br><span class=\"line\">    è¯´æ˜ä½ ä½¿ç”¨çš„å¯èƒ½æ˜¯å¦‚ä¸‹ç³»ç»Ÿä¸­çš„ä¸€ä¸ªï¼š</span><br><span class=\"line\">        RHEL 9</span><br><span class=\"line\">        Rocky Linux 9</span><br><span class=\"line\">        AlmaLinux 9</span><br><span class=\"line\">        CentOS Stream 9</span><br><span class=\"line\"></span><br><span class=\"line\">æ¨èè§£å†³æ–¹æ¡ˆ:</span><br><span class=\"line\">   Raven Repo å¹¶éæ˜¯ ReidsBloom çš„å¿…è¦ä¾èµ–ï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹ getepel è„šæœ¬ï¼Œç¦ç”¨ install_raven</span><br><span class=\"line\">   vi deps/readies/bin/getepelï¼Œæ‰¾åˆ°æ‰€æœ‰ install_ravenï¼Œå¹¶å°†å…¶æ³¨é‡Šæ‰å³å¯</span><br></pre></td></tr></table></figure>\n</div>\n<h2 id=\"Redis-å¯ç”¨æ¨¡å—\">Redis å¯ç”¨æ¨¡å—</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†ç”Ÿæˆçš„ <code>redisbloom.so</code> æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„ .so æ–‡ä»¶éœ€è¦å…·æœ‰å¯æ‰§è¡Œæƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> bin/linux-x64-release/redisbloom.so /usr/local/soft/redis-7.4.7/modules/redisbloom.so</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redis å¯ç”¨æ¨¡å—æœ‰ä¸‰ç§æ–¹æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.å°† redisbloom.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class=\"line\">loadmodule /usr/local/soft/redis-7.4.7/modules/redisbloom.so</span><br><span class=\"line\"><span class=\"comment\"># 2.ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼åŠ è½½æ¨¡å—</span></span><br><span class=\"line\">redis-server --loadmodule /usr/local/soft/redis-7.4.7/modules/redisbloom.so</span><br><span class=\"line\"><span class=\"comment\"># 3.ä¸éœ€è¦é‡å¯redis</span></span><br><span class=\"line\">redis-cli MODULE LOAD /usr/local/soft/redis-7.4.7/modules/redisbloom.so</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>åŠ è½½æ–¹å¼</th>\n<th>æ˜¯å¦æŒä¹…</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>MODULE LOAD</code>ï¼ˆredis-cliï¼‰</td>\n<td>âŒ ä»…å½“å‰è¿›ç¨‹</td>\n</tr>\n<tr>\n<td>å‘½ä»¤è¡Œ <code>redis-server --loadmodule</code></td>\n<td>âŒ ä»…æœ¬æ¬¡å¯åŠ¨</td>\n</tr>\n<tr>\n<td><code>redis.conf</code> ä¸­ <code>loadmodule</code></td>\n<td>âœ… <strong>æ°¸ä¹…ç”Ÿæ•ˆ</strong> ï¼ˆæ¨è/ç”Ÿäº§ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡é‡‡ç”¨ <code>loadmodule</code> åŠ è½½æ¨¡å—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°† redisbloom.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redis</span></span><br><span class=\"line\">loadmodule /usr/local/soft/redis-7.4.7/modules/redisbloom.so</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨redis</span></span><br><span class=\"line\">redis-server redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•æµ‹è¯•</span></span><br><span class=\"line\">redis-cli --user admin --pass 123456</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ¨¡å—</span></span><br><span class=\"line\">127.0.0.1:6379&gt; info Modules</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\"># Modules</span></span><br><span class=\"line\">module:name=bf,ver=20817,api=1,filters=0,usedby=[],using=[],options=[handle-io-errors]</span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; MODULE LIST</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;bf&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;ver&quot;</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 20817</span><br><span class=\"line\">   5) <span class=\"string\">&quot;path&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot;</span></span><br><span class=\"line\">   7) <span class=\"string\">&quot;args&quot;</span></span><br><span class=\"line\">   8) (empty array)</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisBloom çš„å®‰è£…æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ RedisBloom ç®€ä»‹ RedisBloom æ˜¯ Redis å®˜æ–¹ç»´æŠ¤çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œéš¶å±äº Redis Stackï¼Œä¸“é—¨ç”¨äºæä¾›æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼ˆProbabilistic Data Structuresï¼‰çš„é«˜æ€§èƒ½å®ç°ã€‚ å®ƒé€šè¿‡ç‰ºç‰²ä¸€å®šçš„ç²¾ç¡®æ€§ï¼Œæ¢å–æä½çš„å†…å­˜å ç”¨å’Œæé«˜çš„ååèƒ½åŠ›ï¼Œéå¸¸é€‚åˆæµ·é‡æ•°æ®åœºæ™¯ä¸‹çš„â€œå­˜åœ¨æ€§åˆ¤æ–­â€å’Œâ€œè¿‘ä¼¼ç»Ÿè®¡â€ã€‚ è¯¥æ¨¡å—ä»¥ Redis Module æ–¹å¼åŠ è½½ï¼Œå¯æ— ç¼é›†æˆåˆ°ç°æœ‰ Redis å®ä¾‹ä¸­ã€‚ Redis8+ï¼ŒRedisBloom å·²ç»å†…ç½®åœ¨ Redis ä¸­ï¼Œå¯ä»¥åœ¨å®‰è£…redisåŒæ—¶å®‰è£…å…¨éƒ¨ Stack æ¨¡å—ã€‚ RedisBloom æä¾›çš„æ ¸å¿ƒæ•°æ®ç»“æ„ å®‰è£…å¥½RedisBloomåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æŸ¥çœ‹RedisBloom æ”¯æŒçš„å‘½ä»¤ 12# å®é™…ä¸Šæ‰€æœ‰ Stack Module Commandséƒ½æ˜¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼Œå› ä¸ºæˆ‘ä»¬è¿™é‡Œåªå®‰è£…äº† RedisBloomï¼Œæ‰€ä»¥æ­¤æ—¶ä»…å¯ä»¥çœ‹åˆ° RedisBloom æ¨¡å—çš„å‘½ä»¤&gt; help @module é€šè¿‡è¾“å‡ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ° RedisBloom æ¨¡å—æ”¯æŒçš„å‘½ä»¤å¤§è‡´åˆ†ä¸º 5 ç±» 1ï¸âƒ£ Bloom Filterï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰ åˆ¤æ–­æŸä¸ªå…ƒç´ â€œå¯èƒ½å­˜åœ¨ / ä¸€å®šä¸å­˜åœ¨â€ï¼Œä½†ä¸å­˜å‚¨å…ƒç´ æœ¬èº«ï¼Œä¹Ÿä¸æ”¯æŒåˆ é™¤ ç»´åŸºç™¾ç§‘å¯¹ Bloom Filter çš„æè¿° ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ Redissonçš„å¸ƒéš†è¿‡æ»¤å™¨ å¯¹åº”Rediså‘½ä»¤ï¼š BF.xxxï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- BF(Bloom Filter) 2ï¸âƒ£ Cuckoo Filterï¼ˆå¸ƒè°·é¸Ÿè¿‡æ»¤å™¨ï¼‰ Bloom Filter çš„å¢å¼ºç‰ˆï¼Œæ”¯æŒ åˆ é™¤å…ƒç´  ç»´åŸºç™¾ç§‘å¯¹ Cuckoo Filter çš„æè¿° åœ¨é«˜ QPS æŸ¥è¯¢åœºæ™¯ä¸‹ï¼ŒCuckoo Filter é€šå¸¸ä¼˜äº Bloom Filterã€‚ ä½è¯¯åˆ¤ç‡ + é«˜è´Ÿè½½ç‡åœºæ™¯ï¼ŒCuckoo Filter æ›´çœå†…å­˜ã€‚ å¯¹åº”Rediså‘½ä»¤ï¼š CF.xxxï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CF(Cuckoo Filter) 3ï¸âƒ£ Count-Min Sketchï¼ˆCMSï¼‰ è¿‘ä¼¼ç»Ÿè®¡å…ƒç´ å‡ºç°é¢‘ç‡ å¯¹åº”Rediså‘½ä»¤ï¼š CMS.xxxï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- CMS(Count-Min Sketch) 4ï¸âƒ£ Top-K ç»Ÿè®¡è®¿é—®é¢‘ç‡æœ€é«˜çš„ K ä¸ªå…ƒç´  å¯¹åº”Rediså‘½ä»¤ï¼š TOPK.xxxï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TopK 5ï¸âƒ£ TDigest ç»Ÿè®¡æ•°å­—çš„åˆ†å¸ƒ å¯¹åº”Rediså‘½ä»¤ï¼š TDIGEST.xxxï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å‚è§ Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- TDigest å®‰è£… RedisBloom æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä»Redis Cloudçš„Download Centerä¸­è¿›è¡Œä¸‹è½½ï¼Œå…¶æä¾›äº†æ‰€æœ‰Redisæ¨¡å—ç¼–è¯‘åçš„.soæ–‡ä»¶ï¼Œå¯ä»¥ä¼˜å…ˆè¿›è¡Œå°è¯•ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå…¼å®¹ï¼Œæ‰€ä»¥æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯é€šè¿‡æºç è‡ªå·±ç¼–è¯‘ã€‚ æºç ç¼–è¯‘ å®‰è£…æ—¶éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œä¸»è¦æ˜¯å®‰è£…ä¾èµ–æ—¶éœ€è¦ä»æµ·å¤–ç½‘ä¸‹è½½ï¼Œå¦‚æœè¦éƒ¨ç½²åœ¨å›½å†…æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¿æ¥å¤±è´¥ã€‚ å¯ä»¥åœ¨æµ·å¤–çš„ç›¸åŒé…ç½®çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä¹‹åå°†ç¼–è¯‘å¥½çš„redisbloom.soä¸Šä¼ åˆ°å›½å†…æœåŠ¡å™¨å³å¯ã€‚ å®‰è£…ä¾èµ– 12345678910sudo dnf install -y \\ gcc \\ gcc-c++ \\ make \\ cmake \\ autoconf \\ automake \\ libtool \\ pkgconfig \\ openssl-devel ç¼–è¯‘RedisBloom 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869mkdir -p /usr/local/soft/modules/cd /usr/local/soft/modules# clone ä»£ç ï¼Œè¿™é‡Œ --recursive æ˜¯ä¸ºäº†æ‹‰å–å­æ¨¡å—git clone --recursive https://github.com/RedisBloom/RedisBloom.gitcd RedisBloom# æ¨èåˆ‡æ¢åˆ°ç¨³å®šçš„releaseç‰ˆæœ¬git checkout v2.8.17# æ›´æ–°å­æ¨¡å—ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸Šé¢ clone æ—¶æ²¡æœ‰åŠ ä¸Š --recursive ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸èƒ½çœç•¥git submodule update --init --recursive# æ£€æŸ¥å¹¶å®‰è£…éœ€è¦çš„ä¾èµ–./sbin/setup## è¾“å‡º# readies version: 7fc8e62dnf install -q -y ca-certificatesdnf install -q -y wget unzip/usr/local/soft/modules/RedisBloom/deps/readies/bin/enable-utf8dnf install -q -y git jqdnf install -q -y which/usr/local/soft/modules/RedisBloom/deps/readies/bin/getepel/usr/local/soft/modules/RedisBloom/deps/readies/bin/getgcc --moderndnf install -q -y valgrind/usr/local/soft/modules/RedisBloom/sbin/get-fbinferdnf install -q -y lcov/usr/bin/python3 /usr/local/soft/modules/RedisBloom/deps/readies/bin/getrmpytools --reinstall --modern/usr/bin/python3 /usr/local/soft/modules/RedisBloom/deps/readies/bin/getcmake --usr/usr/bin/python3 -m pip install --disable-pip-version-check --user -r tests/flow/requirements.txt/usr/local/soft/modules/RedisBloom/deps/readies/bin/getaws/usr/bin/python3 -m pip install --disable-pip-version-check --user pudb# ç¼–è¯‘make# è¾“å‡ºBuilding /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-c/src/libtdigest_static.a ...Generating /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-c/Makefile ...-- The C compiler identification is GNU 11.5.0-- The CXX compiler identification is GNU 11.5.0-- Detecting C compiler ABI info-- Detecting C compiler ABI info - done-- Check for working C compiler: /usr/bin/gcc - skipped-- Detecting C compile features-- Detecting C compile features - done-- Detecting CXX compiler ABI info-- Detecting CXX compiler ABI info - done-- Check for working CXX compiler: /usr/bin/g++ - skipped-- Detecting CXX compile features-- Detecting CXX compile features - done-- Setting build type to &#x27;Release&#x27; as none was specified.-- Configuring done-- Generating done-- Build files have been written to: /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-cBuilding /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/t-digest-c/libtdigest_static.a ...[ 50%] Building C object src/CMakeFiles/tdigest_static.dir/tdigest.c.o[100%] Linking C static library libtdigest_static.a[100%] Built target tdigest_staticCompiling deps/bloom/bloom.c...Compiling deps/murmur2/MurmurHash2.c...Compiling deps/rmutil/util.c...Compiling src/rebloom.c...Compiling src/sb.c...Compiling src/cf.c...Compiling src/rm_topk.c...Compiling src/rm_tdigest.c...Compiling src/topk.c...Compiling src/rm_cms.c...Compiling src/cms.c...Linking /usr/local/soft/modules/RedisBloom/bin/linux-x64-release/redisbloom.so... ./sbin/setup æŠ¥é”™ æœ¬äººä½¿ç”¨çš„æ˜¯ Amazon Linux 2023(å†…æ ¸ 6.1)ï¼Œå³ EL9ï¼Œç±»ä¼¼äºCentOS 9ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œä¼šæŠ¥é”™ï¼Œå¤§è‡´æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647./sbin/setup## é”™è¯¯ä¿¡æ¯â€¦â€¦[FAILED] raven-release.el9.noarch.rpm: Status code: 403 for https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)Status code: 403 for https://dyn.su/el9/base/x86_64/raven-release.el9.noarch.rpm (IP: 104.21.57.14)In /usr/local/soft/modules/RedisBloom/deps/readies/bin/getepel:346 # xinstall --allowerasing https://dl.fedoraproject.org/pub/epel/epel-release-latest-$&#123;EPEL&#125;.noarch.rpm347 fi348349 &gt;&gt;&gt; install_raven350 install_remi351 # install_centos_stream_repos352command failed: /usr/local/soft/modules/RedisBloom/deps/readies/bin/getepelIn /usr/local/soft/modules/RedisBloom/sbin/setup:16 python3 -m pip list17 fi1819 &gt;&gt;&gt; $ROOT/sbin/system-setup.py20 if [[ $VERBOSE == 1 ]]; then21 python3 -m pip list22 fi ç¼–è¯‘å®‰è£…æ—¶æŠ¥é”™## é”™è¯¯åˆ†æä¸è§£å†³æ–¹æ³•é—®é¢˜åŸå› ï¼š ä½ è¿™ä¸ªé”™è¯¯ä¸æ˜¯ RedisBloom æœ¬èº«çš„ç¼–è¯‘é—®é¢˜ï¼Œè€Œæ˜¯ ä¾èµ–ç¯å¢ƒåˆå§‹åŒ–ï¼ˆreadies / getepelï¼‰é˜¶æ®µå¤±è´¥ï¼Œå¤±è´¥ç‚¹éå¸¸æ˜ç¡®ã€‚readies/bin/getepel è„šæœ¬åœ¨ RHEL 9 / Rocky 9 / AlmaLinux 9 ç³»ç»Ÿä¸Šå°è¯•å®‰è£… Raven Repoï¼Œä½†è¯¥ä»“åº“åœ°å€ https://dyn.su/el9/... å·²è¢« 403 Forbidden æ‹’ç»ï¼Œå¯¼è‡´è„šæœ¬ç›´æ¥å¤±è´¥å¹¶ä¸­æ–­ setupã€‚ è¿™ä¸æ˜¯ä½ æœºå™¨çš„é—®é¢˜ï¼Œè€Œæ˜¯ RedisBloom ä¾èµ–å·¥å…·é“¾å¯¹ EL9 çš„å…¼å®¹æ€§æ»åã€‚ RedisBloom çš„ ./sbin/setup ä¼šè°ƒç”¨ deps/readies/bin/getepel è¿™ä¸ªè„šæœ¬ç”¨äºï¼š å®‰è£… EPEL å®‰è£… Raven Repoï¼ˆEL9 ç‰¹æœ‰ï¼‰ å®‰è£… Remi Repo ä½† Raven Repo ç›®å‰å·²ä¸ç¨³å®š / ä¸å†å…¬å¼€æä¾› rpm ä¸‹è½½ï¼Œè€Œ readies ä»£ç ä»ç„¶åœ¨å¼ºåˆ¶å®‰è£…ã€‚ ä½ çš„ç³»ç»Ÿæ˜¯ EL9 ç³»åˆ—ï¼Œæ—¥å¿—ä¸­æ˜ç¡®ï¼šraven-release.el9.noarch.rpm è¯´æ˜ä½ ä½¿ç”¨çš„å¯èƒ½æ˜¯å¦‚ä¸‹ç³»ç»Ÿä¸­çš„ä¸€ä¸ªï¼š RHEL 9 Rocky Linux 9 AlmaLinux 9 CentOS Stream 9æ¨èè§£å†³æ–¹æ¡ˆ: Raven Repo å¹¶éæ˜¯ ReidsBloom çš„å¿…è¦ä¾èµ–ï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹ getepel è„šæœ¬ï¼Œç¦ç”¨ install_raven vi deps/readies/bin/getepelï¼Œæ‰¾åˆ°æ‰€æœ‰ install_ravenï¼Œå¹¶å°†å…¶æ³¨é‡Šæ‰å³å¯ Redis å¯ç”¨æ¨¡å— å°†ç”Ÿæˆçš„ redisbloom.so æ‹·è´åˆ° redis çš„ modules ç›®å½•ä¸‹ï¼ˆéå¿…é¡»ï¼‰ï¼Œç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º 12# æ³¨æ„ .so æ–‡ä»¶éœ€è¦å…·æœ‰å¯æ‰§è¡Œæƒé™cp bin/linux-x64-release/redisbloom.so /usr/local/soft/redis-7.4.7/modules/redisbloom.so Redis å¯ç”¨æ¨¡å—æœ‰ä¸‰ç§æ–¹æ³• 123456# 1.å°† redisbloom.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redisloadmodule /usr/local/soft/redis-7.4.7/modules/redisbloom.so# 2.ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼åŠ è½½æ¨¡å—redis-server --loadmodule /usr/local/soft/redis-7.4.7/modules/redisbloom.so# 3.ä¸éœ€è¦é‡å¯redisredis-cli MODULE LOAD /usr/local/soft/redis-7.4.7/modules/redisbloom.so åŠ è½½æ–¹å¼ æ˜¯å¦æŒä¹… MODULE LOADï¼ˆredis-cliï¼‰ âŒ ä»…å½“å‰è¿›ç¨‹ å‘½ä»¤è¡Œ redis-server --loadmodule âŒ ä»…æœ¬æ¬¡å¯åŠ¨ redis.conf ä¸­ loadmodule âœ… æ°¸ä¹…ç”Ÿæ•ˆ ï¼ˆæ¨è/ç”Ÿäº§ï¼‰ æœ¬æ–‡é‡‡ç”¨ loadmodule åŠ è½½æ¨¡å— 123456789101112131415161718192021222324# å°† redisbloom.so æ·»åŠ åˆ° redis.conf ä¸­ï¼Œéœ€è¦é‡å¯ redisloadmodule /usr/local/soft/redis-7.4.7/modules/redisbloom.so# å¯åŠ¨redisredis-server redis.conf# ç™»å½•æµ‹è¯•redis-cli --user admin --pass 123456# æŸ¥çœ‹æ¨¡å—127.0.0.1:6379&gt; info Modules## è¾“å‡º# Modulesmodule:name=bf,ver=20817,api=1,filters=0,usedby=[],using=[],options=[handle-io-errors]127.0.0.1:6379&gt; MODULE LIST# è¾“å‡º1) 1) &quot;name&quot; 2) &quot;bf&quot; 3) &quot;ver&quot; 4) (integer) 20817 5) &quot;path&quot; 6) &quot;/usr/local/soft/redis-7.4.7/modules/redisbloom.so&quot; 7) &quot;args&quot; 8) (empty array)","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis æ‰©å±•æ¨¡å— â€“ RedisBloom çš„å®‰è£…æ–¹æ³• æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 æ“ä½œç³»ç»Ÿï¼šAmazon Linux 2023(å†…æ ¸ 6.1) Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/","date_published":"2025-12-21T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/20/redis7-datatype-10-stream/","url":"https://blog.hanqunfeng.com/2025/12/20/redis7-datatype-10-stream/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- Stream","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis Stream æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Stream-æ ¸å¿ƒè¯¦è§£\">Stream æ ¸å¿ƒè¯¦è§£</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redis Stream æ˜¯ Redis 5.0 æ–°å¢çš„æœ‰åºã€å¯æŒä¹…åŒ–ã€æ”¯æŒå¤šæ’­çš„<code>æ¶ˆæ¯é˜Ÿåˆ—</code>ï¼Œåº•å±‚ç”¨<code>åŸºæ•°æ ‘+é“¾è¡¨</code>å®ç°ï¼Œå…¼é¡¾äº†é«˜æ•ˆæŸ¥è¯¢ä¸æœ‰åºå†™å…¥ï¼Œå®Œç¾è§£å†³äº† List é˜Ÿåˆ—ï¼ˆæ— æ³•å¤šæ’­ã€æ— æŒä¹…åŒ–ä¿éšœï¼‰ã€Pub/Subï¼ˆæ— æŒä¹…åŒ–ã€ä¸¢æ¶ˆæ¯ï¼‰çš„ç—›ç‚¹ï¼Œæ˜¯ç”Ÿäº§ç¯å¢ƒé¦–é€‰çš„ Redis æ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å»ºè®®ç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„ MQ æ–¹æ¡ˆï¼Œå¦‚æœä»…æ˜¯å†…éƒ¨ç³»ç»Ÿä½¿ç”¨çš„è½»é‡MQï¼Œå·²ç»æœ‰äº†redisï¼Œä½†æ˜¯ä¸æƒ³å¼•å…¥å…¶å®ƒä¸­é—´ä»¶ï¼Œä¹Ÿå¯ä»¥å°è¯•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Stream ä¸ä¼ ç»Ÿçš„MQ çš„å¯¹æ¯”</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å¯¹æ¯”ç»´åº¦</th>\n<th>Redis Stream</th>\n<th>RabbitMQ</th>\n<th>Kafka</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ•°æ®æ¨¡å‹</strong></td>\n<td>ç±»ä¼¼æ—¥å¿—çš„æœ‰åº KV æ¶ˆæ¯æµï¼ˆID â†’ field/valueï¼‰</td>\n<td>é˜Ÿåˆ—ï¼ˆFIFOï¼‰</td>\n<td>æ—¥å¿—åˆ†åŒºï¼ˆPartitioned Append-Only Logï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ¶ˆæ¯æŒä¹…åŒ–</strong></td>\n<td>å¯é€‰æŒä¹…åŒ–ï¼ˆAOF / RDBï¼‰ï¼Œé»˜è®¤å†…å­˜ä¼˜å…ˆ</td>\n<td>å¯æŒä¹…åŒ–åˆ°ç£ç›˜</td>\n<td>æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œé¡ºåºå†™å…¥ï¼Œæ•ˆç‡é«˜</td>\n</tr>\n<tr>\n<td><strong>æ¶ˆæ¯ç¡®è®¤</strong></td>\n<td>XACK å¯¹å•æ¡æ¶ˆæ¯ç¡®è®¤ï¼Œæ”¯æŒ Pending æ¶ˆæ¯ç®¡ç†</td>\n<td>ACK / NACK</td>\n<td>Offset æ§åˆ¶ï¼ŒConsumer è‡ªè¡Œæäº¤</td>\n</tr>\n<tr>\n<td><strong>æ¶ˆè´¹æ¨¡å¼</strong></td>\n<td>æ”¯æŒ Consumer Groupï¼Œå¤šæ¶ˆè´¹è€…å…±äº« Pending æ¶ˆæ¯</td>\n<td>Queue ç»‘å®š Consumerï¼Œå¤šæ¶ˆè´¹è€…æŠ¢å </td>\n<td>Consumer Groupï¼Œå¤šæ¶ˆè´¹è€…å¹³è¡Œæ¶ˆè´¹</td>\n</tr>\n<tr>\n<td><strong>é‡å¤æ¶ˆè´¹</strong></td>\n<td>é»˜è®¤å¯èƒ½é‡å¤ï¼Œéœ€è¦åº”ç”¨ç«¯å¹‚ç­‰</td>\n<td>å¯é€šè¿‡ ACK/NACK æ§åˆ¶</td>\n<td>é»˜è®¤å¯èƒ½é‡å¤ï¼ŒConsumer éœ€å¹‚ç­‰å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>æ¶ˆæ¯é¡ºåº</strong></td>\n<td>æŒ‰ Stream ID é¡ºåºï¼Œå¯ä¿è¯åˆ†ç»„å†…é¡ºåº</td>\n<td>é˜Ÿåˆ—é¡ºåºä¿è¯</td>\n<td>Partition å†…é¡ºåºä¿è¯</td>\n</tr>\n<tr>\n<td><strong>æ¶ˆæ¯ä¿ç•™ç­–ç•¥</strong></td>\n<td>å¯é…ç½® maxlen / minidï¼ŒæŒ‰æ—¶é—´æˆ–é•¿åº¦è£å‰ª</td>\n<td>é˜Ÿåˆ—é•¿åº¦ / TTL æ§åˆ¶</td>\n<td>åŸºäºæ—¶é—´æˆ–å¤§å°ä¿ç•™ï¼ˆRetention Policyï¼‰</td>\n</tr>\n<tr>\n<td><strong>å»¶æ—¶/å®šæ—¶æ¶ˆè´¹</strong></td>\n<td>åŸç”Ÿä¸æ”¯æŒå»¶æ—¶é˜Ÿåˆ—ï¼Œéœ€è¦åº”ç”¨ç«¯å¤„ç†</td>\n<td>æ”¯æŒæ’ä»¶æˆ– TTL</td>\n<td>åŸç”Ÿä¸æ”¯æŒï¼Œéœ€è¦åº”ç”¨ç«¯å¤„ç†æˆ– Kafka Streams</td>\n</tr>\n<tr>\n<td><strong>äº‹åŠ¡ä¸åŸå­æ“ä½œ</strong></td>\n<td>äº‹åŠ¡å¯ç”¨ MULTI/EXECï¼ŒXADD æ”¯æŒ NOMKSTREAM ç­‰é€‰é¡¹</td>\n<td>åŸç”Ÿäº‹åŠ¡æ”¯æŒï¼ˆäº‹åŠ¡ / confirm æ¨¡å¼ï¼‰</td>\n<td>ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¾èµ–å¹‚ç­‰ç”Ÿäº§è€…</td>\n</tr>\n<tr>\n<td><strong>æ€§èƒ½</strong></td>\n<td>å†…å­˜çº§é«˜ååï¼ŒæŒä¹…åŒ–ä¼šæœ‰å¼€é”€</td>\n<td>ä¸­ç­‰ï¼Œå—ç£ç›˜å’Œç½‘ç»œé™åˆ¶</td>\n<td>é«˜ååï¼Œé¡ºåºå†™å…¥ç£ç›˜æ•ˆç‡æé«˜</td>\n</tr>\n<tr>\n<td><strong>å…¸å‹ä½¿ç”¨åœºæ™¯</strong></td>\n<td>äº‹ä»¶æ—¥å¿—ã€è½»é‡ MQã€å†…éƒ¨å¼‚æ­¥æµæ°´çº¿</td>\n<td>ä¼ä¸šçº§æ¶ˆæ¯ã€ä»»åŠ¡è°ƒåº¦ã€RPC</td>\n<td>å¤§æ•°æ®ç®¡é“ã€æ—¥å¿—æ”¶é›†ã€æµå¤„ç†</td>\n</tr>\n<tr>\n<td><strong>å¤šè¯­è¨€æ”¯æŒ</strong></td>\n<td>å®¢æˆ·ç«¯æ”¯æŒå¤šç§è¯­è¨€ï¼ˆJavaã€Pythonã€Go ç­‰ï¼‰</td>\n<td>å®¢æˆ·ç«¯ä¸°å¯Œ</td>\n<td>å®¢æˆ·ç«¯ä¸°å¯Œ</td>\n</tr>\n<tr>\n<td><strong>æ˜“è¿ç»´æ€§</strong></td>\n<td>å•èŠ‚ç‚¹å³å¯ä½¿ç”¨ï¼Œä½†æŒä¹…åŒ–éœ€å…³æ³¨å†…å­˜</td>\n<td>é›†ç¾¤è¾ƒå¤æ‚ï¼Œéœ€è¦ RabbitMQ é›†ç¾¤</td>\n<td>é›†ç¾¤å¤æ‚åº¦é«˜ï¼Œéœ€è¦ ZooKeeper æˆ– KRaft</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"åº•å±‚æ ¸å¿ƒå®ç°\">åº•å±‚æ ¸å¿ƒå®ç°</h3>\n<ol>\n<li class=\"lvl-3\">\n<p>å­˜å‚¨ç»“æ„ï¼šæ ¸å¿ƒæ˜¯åŸºæ•°æ ‘ï¼ˆRadix Treeï¼‰+ åŒå‘é“¾è¡¨ï¼ŒåŸºæ•°æ ‘å­˜ã€Œæ¶ˆæ¯IDâ†’æ¶ˆæ¯å†…å®¹ã€çš„æ˜ å°„ï¼ŒåŒå‘é“¾è¡¨æŒ‰æ¶ˆæ¯IDæœ‰åºä¸²è”æ‰€æœ‰æ¶ˆæ¯ï¼Œä¿è¯å†™å…¥å’ŒæŒ‰IDæŸ¥è¯¢çš„é«˜æ•ˆæ€§ï¼ˆO(logN)ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>æ¶ˆæ¯IDï¼šé»˜è®¤è‡ªåŠ¨ç”Ÿæˆï¼Œæ ¼å¼ä¸ºæ—¶é—´æˆ³-åºåˆ—å·ï¼ˆå¦‚1734567890000-0ï¼‰ï¼Œæ—¶é—´æˆ³æ˜¯æ¯«ç§’çº§ï¼Œåºåˆ—å·è§£å†³åŒä¸€æ¯«ç§’å¤šæ¶ˆæ¯çš„æœ‰åºé—®é¢˜ï¼›ä¹Ÿæ”¯æŒæ‰‹åŠ¨æŒ‡å®šï¼Œéœ€æ»¡è¶³ä¸¥æ ¼é€’å¢ï¼Œå¦åˆ™å†™å…¥å¤±è´¥ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>æŒä¹…åŒ–ï¼šå’Œ Redis å…¶ä»–æ•°æ®ç»“æ„ä¸€è‡´ï¼Œä¾èµ– RDB/AOF æŒä¹…åŒ–ï¼Œæ¶ˆæ¯å†™å…¥åä¼šè½ç›˜ï¼Œé‡å¯åä¸ä¸¢å¤±ï¼Œè¿™æ˜¯ Pub/Sub ä¸å…·å¤‡çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>æ ¸å¿ƒå…ƒæ•°æ®ï¼šæ¯ä¸ª Stream ä¼šç»´æŠ¤last-idï¼ˆæœ€æ–°æ¶ˆæ¯IDï¼‰ã€groupsï¼ˆæ¶ˆè´¹ç»„åˆ—è¡¨ï¼‰ã€entriesï¼ˆæ¶ˆæ¯å®ä½“ï¼‰ä¸‰ç±»å…ƒæ•°æ®ï¼Œæ¶ˆè´¹ç»„çš„å…ƒæ•°æ®ç‹¬ç«‹å­˜å‚¨ï¼Œäº’ä¸å¹²æ‰°ã€‚</p>\n</li>\n</ol>\n<h2 id=\"Stream-æ ¸å¿ƒåŸºç¡€æ“ä½œï¼ˆå¿…ç”¨ï¼‰\">Stream æ ¸å¿ƒåŸºç¡€æ“ä½œï¼ˆå¿…ç”¨ï¼‰</h2>\n<h3 id=\"1-ç”Ÿäº§æ¶ˆæ¯ï¼ˆXADDï¼‰ï¼šå†™å…¥é˜Ÿåˆ—\">1. ç”Ÿäº§æ¶ˆæ¯ï¼ˆXADDï¼‰ï¼šå†™å…¥é˜Ÿåˆ—</h3>\n<p>â€¢ æ ¸å¿ƒå‘½ä»¤ï¼š<code>XADD key ID å­—æ®µ1 å€¼1 å­—æ®µ2 å€¼2 ...</code>ï¼ŒID å†™*è¡¨ç¤ºè‡ªåŠ¨ç”Ÿæˆï¼ˆç”Ÿäº§é¦–é€‰ï¼‰</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XADD key</span><br><span class=\"line\">     [NOMKSTREAM]</span><br><span class=\"line\">     [MAXLEN | MINID [= | ~] threshold [LIMIT count]]</span><br><span class=\"line\">     * | <span class=\"built_in\">id</span></span><br><span class=\"line\">     field value [field value ...]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è§£é‡Š</span></span><br><span class=\"line\"><span class=\"comment\"># key: Stream åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># NOMKSTREAM: ä¸è‡ªåŠ¨åˆ›å»º Streamï¼Œè‹¥ key ä¸å­˜åœ¨ â†’ å‘½ä»¤ç›´æ¥å¤±è´¥</span></span><br><span class=\"line\"><span class=\"comment\"># MAXLEN threshold â€”â€” æŒ‰é•¿åº¦è£å‰ª</span></span><br><span class=\"line\"><span class=\"comment\">#   MAXLEN 1000: Stream æœ€å¤šä¿ç•™ 1000 æ¡æ¶ˆæ¯ï¼Œè¶…å‡ºéƒ¨åˆ†ä¼šè¢«åˆ é™¤ï¼ˆä»æœ€æ—§å¼€å§‹ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">#   MAXLEN = 1000: ç²¾ç¡®è£å‰ªï¼Œä¸¥æ ¼ä¿è¯é•¿åº¦ â‰¤ 1000ï¼Œæ¯æ¬¡å†™å…¥éƒ½ä¼šæ£€æŸ¥å¹¶è£å‰ªï¼Œæ€§èƒ½å¼€é”€è¾ƒå¤§</span></span><br><span class=\"line\"><span class=\"comment\">#   MAXLEN ~ 1000ï¼ˆæ¨èï¼‰: è¿‘ä¼¼è£å‰ªï¼Œå…è®¸ Stream é•¿åº¦ ç•¥å¾®è¶…è¿‡é˜ˆå€¼ï¼ŒRedis åœ¨å†…éƒ¨æ‰¹é‡è£å‰ªï¼Œå†™å…¥æ€§èƒ½æ›´é«˜</span></span><br><span class=\"line\"><span class=\"comment\"># LIMIT count â€”â€” æ¯æ¬¡æœ€å¤šè£å‰ªå¤šå°‘æ¡</span></span><br><span class=\"line\"><span class=\"comment\">#   MAXLEN ~ 1000 LIMIT 100: å•æ¬¡å†™å…¥ æœ€å¤šåˆ é™¤ 100 æ¡æ—§æ¶ˆæ¯ï¼Œé˜²æ­¢ä¸€æ¬¡è£å‰ªé˜»å¡ Redis ä¸»çº¿ç¨‹</span></span><br><span class=\"line\"><span class=\"comment\"># MINID threshold â€”â€” æŒ‰ ID è£å‰ªï¼ˆRedis â‰¥ 6.2ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">#   MINID ~ 1670000000000-0: åˆ é™¤ ID å°äº threshold çš„æ¶ˆæ¯ï¼Œæ›´é€‚åˆ æ—¶é—´çª—å£å‹ä¿ç•™ç­–ç•¥</span></span><br><span class=\"line\"><span class=\"comment\"># * | id â€”â€” æ¶ˆæ¯ ID</span></span><br><span class=\"line\"><span class=\"comment\">#   *: è‡ªåŠ¨ç”Ÿæˆ IDï¼ˆ99% åœºæ™¯ï¼‰ï¼Œæ ¼å¼ï¼š&lt;æ¯«ç§’æ—¶é—´æˆ³&gt;-&lt;åºå·&gt;ï¼Œå•è°ƒé€’å¢ï¼Œå…¨å±€æœ‰åºï¼Œæ¶ˆè´¹è€…ç»„ä¾èµ–å®ƒè¿›è¡Œ offset ç®¡ç†</span></span><br><span class=\"line\"><span class=\"comment\">#   id: æŒ‡å®šIDï¼ˆä¸å¸¸ç”¨ï¼‰ï¼ŒID å¿…é¡»ä¸¥æ ¼å¤§äº Stream ä¸­æœ€å¤§ IDï¼Œå¦åˆ™å†™å…¥å¤±è´¥</span></span><br><span class=\"line\"><span class=\"comment\"># field value â€”â€” æ¶ˆæ¯ä½“ï¼ˆPayloadï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">#   è‡³å°‘ä¸€å¯¹ field-valueï¼Œfield / value éƒ½æ˜¯ Binary Safeï¼Œæœ¬è´¨ç±»ä¼¼ Hashï¼Œä½†ä¸å¯ä¿®æ”¹</span></span><br></pre></td></tr></table></figure>\n<p>â€¢ ç¤ºä¾‹</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘è®¢å•é˜Ÿåˆ—å†™å…¥1æ¡æ¶ˆæ¯ï¼Œè‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯ID</span></span><br><span class=\"line\">XADD order_stream * uid 1001 order_no ORD20251220 price 299</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"string\">&quot;1766215406540-0&quot;</span> <span class=\"comment\"># æ¶ˆæ¯ID</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿ç•™æŸä¸ªæ—¶é—´ç‚¹ä¹‹åçš„æ—¥å¿—</span></span><br><span class=\"line\">XADD <span class=\"built_in\">log</span> MINID ~ 1689900000000-0 * level INFO msg <span class=\"string\">&quot;startup&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"2-æ¶ˆè´¹æ¶ˆæ¯ï¼ˆ2ç§æ ¸å¿ƒæ¨¡å¼ï¼‰\">2. æ¶ˆè´¹æ¶ˆæ¯ï¼ˆ2ç§æ ¸å¿ƒæ¨¡å¼ï¼‰</h3>\n<h4 id=\"ï¼ˆ1ï¼‰-ç‹¬ç«‹æ¶ˆè´¹ï¼ˆæ— æ¶ˆè´¹ç»„ï¼‰ï¼šä¸€å¯¹ä¸€æ¶ˆè´¹ï¼Œé€‚åˆç®€å•åœºæ™¯\">ï¼ˆ1ï¼‰ ç‹¬ç«‹æ¶ˆè´¹ï¼ˆæ— æ¶ˆè´¹ç»„ï¼‰ï¼šä¸€å¯¹ä¸€æ¶ˆè´¹ï¼Œé€‚åˆç®€å•åœºæ™¯</h4>\n<p>â€¢ XREADï¼šä¸»åŠ¨æ‹‰å–æ¶ˆæ¯ï¼Œæ”¯æŒé˜»å¡/éé˜»å¡</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XREAD</span><br><span class=\"line\">  [COUNT count]</span><br><span class=\"line\">  [BLOCK milliseconds]</span><br><span class=\"line\">  STREAMS key [key ...]</span><br><span class=\"line\">          <span class=\"built_in\">id</span>  [<span class=\"built_in\">id</span>  ...]</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è§£é‡Š</span></span><br><span class=\"line\"><span class=\"comment\"># COUNT count â€”â€” å•æ¬¡æœ€å¤šè¯»å–å¤šå°‘æ¡ï¼Œæ˜¯â€œä¸Šé™â€ï¼Œä¸æ˜¯ä¿è¯å€¼</span></span><br><span class=\"line\"><span class=\"comment\"># BLOCK milliseconds â€”â€” é˜»å¡ç­‰å¾…æ–°æ¶ˆæ¯ï¼Œé˜»å¡æœŸé—´ ä¸ä¼šå ç”¨ CPUï¼Œè¶…æ—¶è¿”å› nil</span></span><br><span class=\"line\"><span class=\"comment\">#   BLOCK 0: æ— é™é˜»å¡ï¼Œç›´åˆ°æœ‰æ–°æ¶ˆæ¯</span></span><br><span class=\"line\"><span class=\"comment\"># STREAMS key [key ...] â€”â€” æŒ‡å®šè¯»å–çš„ Streamï¼Œkey ä¸ id ä¸€ä¸€å¯¹åº”</span></span><br><span class=\"line\"><span class=\"comment\"># id [id ...] â€”â€” ä»å“ªä¸ªä½ç½®å¼€å§‹è¯»ï¼Œè¯»å– ID å¤§äºè¯¥å€¼çš„æ¶ˆæ¯ï¼Œä¸åŒ…å« è¯¥ ID æœ¬èº«</span></span><br><span class=\"line\"><span class=\"comment\">#   æ™®é€š IDï¼ˆæ¸¸æ ‡è¯­ä¹‰ï¼‰: XREAD STREAMS mystream 1689999999999-0</span></span><br><span class=\"line\"><span class=\"comment\">#   $: åªå…³å¿ƒâ€œå°†æ¥â€çš„æ¶ˆæ¯ï¼Œä» å½“å‰ Stream çš„æœ«å°¾ä¹‹å å¼€å§‹è¯»ï¼Œå†å²æ¶ˆæ¯å…¨éƒ¨å¿½ç•¥: XREAD BLOCK 0 STREAMS mystream $</span></span><br></pre></td></tr></table></figure>\n<p>â€¢ ç¤ºä¾‹1ï¼ˆéé˜»å¡ï¼‰</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»å¼€å¤´æ‹‰5æ¡æ¶ˆæ¯</span></span><br><span class=\"line\">XREAD COUNT 5 STREAMS order_stream 0-0</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;order_stream&quot;</span>          <span class=\"comment\"># Streamåç§°</span></span><br><span class=\"line\">   2) 1) 1) <span class=\"string\">&quot;1766215406540-0&quot;</span> <span class=\"comment\"># æ¶ˆæ¯ID</span></span><br><span class=\"line\">         2) 1) <span class=\"string\">&quot;uid&quot;</span>          <span class=\"comment\"># æ¶ˆæ¯ä½“ é”®å€¼å¯¹</span></span><br><span class=\"line\">            2) <span class=\"string\">&quot;1001&quot;</span></span><br><span class=\"line\">            3) <span class=\"string\">&quot;order_no&quot;</span></span><br><span class=\"line\">            4) <span class=\"string\">&quot;ORD20251220&quot;</span></span><br><span class=\"line\">            5) <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">            6) <span class=\"string\">&quot;299&quot;</span></span><br></pre></td></tr></table></figure>\n<p>â€¢ ç¤ºä¾‹2ï¼ˆé˜»å¡ï¼‰</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># $è¡¨ç¤ºä»æœ€æ–°æ¶ˆæ¯å¼€å§‹æ‹‰ï¼Œé˜»å¡3ç§’ï¼Œæœ‰æ–°æ¶ˆæ¯ç«‹å³è¿”å›ï¼Œæ— åˆ™3ç§’åè¶…æ—¶ï¼Œæ˜¯ç”Ÿäº§å¸¸ç”¨å†™æ³•ã€‚</span></span><br><span class=\"line\">XREAD COUNT 5 BLOCK 3000 STREAMS order_stream $</span><br></pre></td></tr></table></figure>\n<h4 id=\"ï¼ˆ2ï¼‰-æ¶ˆè´¹ç»„æ¶ˆè´¹ï¼ˆXGROUPï¼‰ï¼šä¸€å¯¹å¤šæ¶ˆè´¹ï¼Œæ ¸å¿ƒç”Ÿäº§æ¨¡å¼\">ï¼ˆ2ï¼‰ æ¶ˆè´¹ç»„æ¶ˆè´¹ï¼ˆXGROUPï¼‰ï¼šä¸€å¯¹å¤šæ¶ˆè´¹ï¼Œæ ¸å¿ƒç”Ÿäº§æ¨¡å¼</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Stream æœ€æ ¸å¿ƒçš„ä»·å€¼å°±æ˜¯æ¶ˆè´¹ç»„ï¼Œæ”¯æŒå¤šæ¶ˆè´¹è€…ååŒæ¶ˆè´¹ã€æ¶ˆæ¯ç¡®è®¤ã€æœªæ¶ˆè´¹æ¶ˆæ¯è¿½æº¯ï¼Œè§£å†³äº†åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„æ¶ˆæ¯åˆ†ç‰‡ä¸è´Ÿè½½å‡è¡¡é—®é¢˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<ol>\n<li class=\"lvl-5\">å…ˆåˆ›å»ºæ¶ˆè´¹ç»„<code>XGROUP CREATE</code></li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XGROUP CREATE key group <span class=\"built_in\">id</span>|$</span><br><span class=\"line\">       [MKSTREAM]</span><br><span class=\"line\">       [ENTRIESREAD entries-read]</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è§£é‡Š</span></span><br><span class=\"line\"><span class=\"comment\"># keyï¼šStream åç§°ï¼Œä¸ºæŒ‡å®šçš„Streamåˆ›å»ºæ¶ˆè´¹ç»„</span></span><br><span class=\"line\"><span class=\"comment\"># group: æ¶ˆè´¹ç»„åç§°ï¼Œæ¶ˆè´¹è€…ç»„çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸€ä¸ª Stream å¯ä»¥æœ‰ å¤šä¸ª consumer group</span></span><br><span class=\"line\"><span class=\"comment\"># id | $ â€”â€” å…³é”®å‚æ•°ï¼šæ¶ˆè´¹èµ·å§‹ä½ç‚¹ï¼ˆoffsetï¼‰ï¼Œ$è¡¨ç¤ºä»å½“å‰æœ€æ–°æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ï¼Œç”¨0-0è¡¨ç¤ºä»é˜Ÿåˆ—å¼€å¤´æ¶ˆè´¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># [MKSTREAM] â€”â€” è‡ªåŠ¨åˆ›å»º Streamï¼Œå¦‚æœæŒ‡å®šçš„keyä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºï¼Œæ¨èåœ¨è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸­ä½¿ç”¨</span></span><br><span class=\"line\"><span class=\"comment\"># [ENTRIESREAD entries-read] â€”â€” è®¾ç½®â€œå·²è¯»å–æ¡æ•°â€ï¼ˆé«˜çº§å‚æ•°ï¼‰ï¼Œä¸€èˆ¬ä¸šåŠ¡ä¸éœ€è¦ä½¿ç”¨ï¼Œä¸»è¦ç”¨äºæ‰‹åŠ¨æ¢å¤groupã€æ•°æ®è¿ç§»ç­‰åœºæ™¯</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹ï¼šåˆ›å»ºgroup1æ¶ˆè´¹ç»„ï¼Œä»æœ€æ–°è®¢å•æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹</span></span><br><span class=\"line\">XGROUP CREATE order_stream group1 $ MKSTREAM</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li class=\"lvl-3\">\n<p>æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯<code>XREADGROUP</code></p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XREADGROUP GROUP group consumer</span><br><span class=\"line\">           [COUNT count]</span><br><span class=\"line\">           [BLOCK milliseconds]</span><br><span class=\"line\">           [NOACK]</span><br><span class=\"line\">           STREAMS key [key ...]</span><br><span class=\"line\">                   <span class=\"built_in\">id</span>  [<span class=\"built_in\">id</span>  ...]</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è§£é‡Š</span></span><br><span class=\"line\"><span class=\"comment\"># GROUP group consumer: æŒ‡å®šæ¶ˆè´¹è€…ç»„åï¼šgroupï¼Œæ¶ˆè´¹è€…åï¼šconsumer</span></span><br><span class=\"line\"><span class=\"comment\">#    åŒä¸€ä¸ª group ä¸‹ï¼Œä¸åŒ consumer ä¸ä¼šæ”¶åˆ°é‡å¤æ¶ˆæ¯</span></span><br><span class=\"line\"><span class=\"comment\"># [COUNT count] â€”â€” å•æ¬¡æœ€å¤šè¿”å›æ¡æ•°ï¼Œæ˜¯è½¯é™åˆ¶ï¼Œä¸æ˜¯ä¸¥æ ¼ä¿è¯</span></span><br><span class=\"line\"><span class=\"comment\"># [BLOCK milliseconds] â€”â€” é˜»å¡ç­‰å¾…æ–°æ¶ˆæ¯ï¼Œæœ€å¤šé˜»å¡ milliseconds æ¯«ç§’</span></span><br><span class=\"line\"><span class=\"comment\">#    BLOCK 0 â†’ æ°¸ä¹…é˜»å¡</span></span><br><span class=\"line\"><span class=\"comment\"># [NOACK] â€”â€” ä¸è¿›å…¥ Pendingï¼ˆâš ï¸ è°¨æ…ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">#    æ¶ˆæ¯ ä¸ä¼šè¿›å…¥ Pendingï¼Œä¸éœ€è¦ XACKï¼Œæ¶ˆè´¹åå³è®¤ä¸ºå®Œæˆ</span></span><br><span class=\"line\"><span class=\"comment\">#    é£é™©ï¼šæ¶ˆè´¹è€…å´©æºƒ â†’ æ¶ˆæ¯ç›´æ¥ä¸¢å¤±ï¼Œä¸å¯é‡æŠ•é€’</span></span><br><span class=\"line\"><span class=\"comment\"># STREAMS key [key ...]: æŒ‡å®šè¦è¯»å–çš„ Streamï¼ˆæ”¯æŒå¤šä¸ªï¼‰ï¼Œkey é¡ºåºéœ€ä¸åç»­ id é¡ºåºä¸€è‡´</span></span><br><span class=\"line\"><span class=\"comment\"># id [id ...] â€”â€” å†³å®šâ€œè¯»ä»€ä¹ˆâ€çš„å…³é”®</span></span><br><span class=\"line\"><span class=\"comment\">#    ä½¿ç”¨ &gt; â€”â€” è¯»å–â€œæ–°æ¶ˆæ¯â€ï¼ˆâœ… ç”Ÿäº§ç¯å¢ƒ 99% ä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰ï¼Œä»æœªæŠ•é€’ç»™ä»»ä½• consumer çš„æ–°æ¶ˆæ¯</span></span><br><span class=\"line\"><span class=\"comment\">#    ä½¿ç”¨ 0/å…·ä½“ID â€”â€” é‡è¯» Pendingï¼ˆè¡¥å¿ï¼‰ï¼Œè¯»å– å·²æŠ•é€’ä½†æœª ACK çš„æ¶ˆæ¯</span></span><br><span class=\"line\"><span class=\"comment\">#    å¤š Stream åœºæ™¯: STREAMS stream1 stream2 &gt; &gt;ï¼Œæ¯ä¸ª stream å¿…é¡»æœ‰ä¸€ä¸ªå¯¹åº” id</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹ï¼šconsumerA ä»group1æ‹‰3æ¡æœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œé˜»å¡5ç§’ã€‚</span></span><br><span class=\"line\">XREADGROUP GROUP group1 consumerA COUNT 3 BLOCK 5000 STREAMS order_stream &gt;</span><br><span class=\"line\"><span class=\"comment\">## æ­¤æ—¶åœ¨5ç§’å†…åˆ›å»ºæ–°çš„æ¶ˆæ¯ï¼Œå°±ä¼šæœ‰ç±»ä¼¼å¦‚ä¸‹è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;order_stream&quot;</span></span><br><span class=\"line\">   2) 1) 1) <span class=\"string\">&quot;1766215642763-0&quot;</span></span><br><span class=\"line\">         2) 1) <span class=\"string\">&quot;uid&quot;</span></span><br><span class=\"line\">            2) <span class=\"string\">&quot;1001&quot;</span></span><br><span class=\"line\">            3) <span class=\"string\">&quot;order_no&quot;</span></span><br><span class=\"line\">            4) <span class=\"string\">&quot;ORD20251220&quot;</span></span><br><span class=\"line\">            5) <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">            6) <span class=\"string\">&quot;299&quot;</span></span><br><span class=\"line\">(1.50s)</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰\">3. æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¶ˆè´¹å®Œæˆåå¿…é¡»ç¡®è®¤ï¼Œå¦åˆ™ä¼šè¢«æ ‡è®°ä¸ºã€Œæœªç¡®è®¤æ¶ˆæ¯ã€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># XACK key æ¶ˆè´¹ç»„å æ¶ˆæ¯ID1 æ¶ˆæ¯ID2 ...ã€‚</span></span><br><span class=\"line\">XACK key group <span class=\"built_in\">id</span> [<span class=\"built_in\">id</span> ...]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹: ç¡®è®¤2æ¡æ¶ˆæ¯æ¶ˆè´¹å®Œæˆï¼ŒStream ä¼šåˆ é™¤è¯¥æ¶ˆæ¯çš„æœªç¡®è®¤æ ‡è®°</span></span><br><span class=\"line\">XACK order_stream group1 1734567890000-0 1734567890001-0</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-æ¶ˆæ¯é‡è¯•\">4. æ¶ˆæ¯é‡è¯•</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œä¼šè¢«å­˜å…¥æ¶ˆè´¹ç»„çš„<code>ã€ŒPELï¼ˆPending Entries Listï¼‰ã€</code>ï¼Œå¯é€šè¿‡<code>XPENDING key æ¶ˆè´¹ç»„å</code>æŸ¥çœ‹ï¼Œæ”¯æŒ<code>XCLAIM</code>å°†<code>PEL</code>ä¸­çš„æ¶ˆæ¯è½¬ç§»ç»™å…¶ä»–æ¶ˆè´¹è€…å¤„ç†ï¼Œé¿å…å•ç‚¹æ•…éšœå¯¼è‡´æ¶ˆæ¯å †ç§¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>XPENDINGï¼šæŸ¥çœ‹æœªè¢«ç¡®è®¤çš„æ¶ˆæ¯æƒ…å†µ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XPENDING key group</span><br><span class=\"line\">        [[IDLE min-idle-time]</span><br><span class=\"line\">         start end count</span><br><span class=\"line\">         [consumer]]</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è§£é‡Š</span></span><br><span class=\"line\"><span class=\"comment\"># key: Stream åç§°ï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\"># group: æ¶ˆè´¹è€…ç»„åç§°ï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\"># [IDLE min-idle-time]ï¼ˆRedis â‰¥ 6.2ï¼‰: ä»…è¿”å› ç©ºé—²æ—¶é—´ â‰¥ min-idle-timeï¼ˆæ¯«ç§’ï¼‰ çš„ Pending æ¶ˆæ¯</span></span><br><span class=\"line\"><span class=\"comment\">#    min-idle-time(ç©ºé—²æ—¶é—´) = ä»ä¸Šæ¬¡æŠ•é€’ / claimåˆ°ç°åœ¨</span></span><br><span class=\"line\"><span class=\"comment\"># start end â€”â€” ID èŒƒå›´</span></span><br><span class=\"line\"><span class=\"comment\">#    -: æœ€å°ID</span></span><br><span class=\"line\"><span class=\"comment\">#    +: æœ€å¤§ID</span></span><br><span class=\"line\"><span class=\"comment\"># count â€”â€” è¿”å›æ¡æ•°ä¸Šé™</span></span><br><span class=\"line\"><span class=\"comment\"># [consumer]ï¼ˆå¯é€‰ï¼‰: åªæŸ¥çœ‹æŸä¸€ä¸ª consumer çš„ Pendingï¼Œä¸æŒ‡å®šåˆ™æŸ¥çœ‹ group å†…å…¨éƒ¨</span></span><br><span class=\"line\"><span class=\"comment\"># åªè¿”å› å…ƒæ•°æ®ï¼Œä¸è¿”å›æ¶ˆæ¯å†…å®¹</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹1: æŸ¥çœ‹æ˜¯å¦æœ‰æ¶ˆæ¯ç§¯å‹</span></span><br><span class=\"line\">XPENDING order_stream group1</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1      <span class=\"comment\"># ç§¯å‹æ¶ˆæ¯æ•°ï¼Œæœªç¡®è®¤æ¶ˆæ¯æ•°é‡</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;1766215642763-0&quot;</span> <span class=\"comment\"># Pending ä¸­æœ€å° ID</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;1766215642763-0&quot;</span> <span class=\"comment\"># Pending ä¸­æœ€å¤§ ID</span></span><br><span class=\"line\">4) 1) 1) <span class=\"string\">&quot;consumerA&quot;</span> <span class=\"comment\"># æŒ‰ consumer ç»Ÿè®¡çš„ Pending æ•°é‡</span></span><br><span class=\"line\">      2) <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹2: æŸ¥æ‰¾ idle è¶…è¿‡ 1 åˆ†é’Ÿçš„æ¶ˆæ¯ï¼Œæœ€å¤šè¿”å›10æ¡</span></span><br><span class=\"line\">XPENDING order_stream group1 IDLE 60000 - + 10</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;1766215642763-0&quot;</span> <span class=\"comment\"># æ¶ˆæ¯ ID</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;consumerA&quot;</span>       <span class=\"comment\"># å½“å‰æŒæœ‰è¯¥æ¶ˆæ¯çš„ consumer</span></span><br><span class=\"line\">   3) (<span class=\"built_in\">integer</span>) 255581  <span class=\"comment\"># idle æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 2       <span class=\"comment\"># delivery countï¼ˆæŠ•é€’æ¬¡æ•°ï¼‰,è¯¥æ¶ˆæ¯è‡³å°‘è¢«æŠ•é€’è¿‡ 2 æ¬¡</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹3: åªæŸ¥çœ‹ consumerA çš„ Pendingï¼Œæœ€å¤šè¿”å›20æ¡</span></span><br><span class=\"line\">XPENDING order_stream group1 - + 20 consumerA</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>XCLAIM: è½¬ç§»æŠ•é€’</p>\n</li>\n</ul>\n<blockquote>\n<p>å°†å·²ç»æŠ•é€’ä½†æœª ACKã€ä¸” idle è¶…è¿‡é˜ˆå€¼çš„ Pending æ¶ˆæ¯ï¼Œä»åŸ consumer æ‰‹ä¸­â€œæŠ¢å â€ç»™æ–°çš„ consumerï¼Œå¹¶é‡æ–°æŠ•é€’ã€‚<br>\nä¸€æ—¦æŠ¢å æˆåŠŸï¼ŒåŸ consumer å°±ä¸åœ¨æ‹¥æœ‰è¯¥æ¶ˆæ¯çš„ Pending è®°å½•</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XCLAIM key group consumer min-idle-time <span class=\"built_in\">id</span> [<span class=\"built_in\">id</span> ...]</span><br><span class=\"line\">       [IDLE ms]</span><br><span class=\"line\">       [TIME unix-time-milliseconds]</span><br><span class=\"line\">       [RETRYCOUNT count]</span><br><span class=\"line\">       [FORCE]</span><br><span class=\"line\">       [JUSTID]</span><br><span class=\"line\">       [LASTID lastid]</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è§£é‡Š</span></span><br><span class=\"line\"><span class=\"comment\"># key: Stream Keyï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\"># group: æ¶ˆè´¹è€…ç»„åç§°ï¼Œå¿…é¡»å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\"># consumer: æ–°çš„æ¶ˆè´¹è€…ï¼ŒæŠ¢å åçš„ Pending æ¶ˆæ¯å°†å½’å±è¯¥ consumer</span></span><br><span class=\"line\"><span class=\"comment\"># min-idle-time: ç©ºé—²æ—¶é—´ï¼Œåªæœ‰ idle â‰¥ min-idle-time çš„ Pending æ¶ˆæ¯æ‰å…è®¸è¢« claim</span></span><br><span class=\"line\"><span class=\"comment\"># id [id ...]: æŒ‡å®šè¦ claim çš„æ¶ˆæ¯ IDï¼ŒIDå¿…é¡»å­˜åœ¨</span></span><br><span class=\"line\"><span class=\"comment\"># [IDLE ms]: äººä¸ºè®¾ç½® idle æ—¶é—´ï¼Œè¦†ç›– Redis å†…éƒ¨è®¡ç®—çš„ idleï¼Œæ¯”å¦‚å¼ºåˆ¶åˆ¶é€ â€œå·²è¶…æ—¶â€çŠ¶æ€</span></span><br><span class=\"line\"><span class=\"comment\"># [TIME unix-time-milliseconds]: æ‰‹åŠ¨æŒ‡å®šâ€œæœ€åæŠ•é€’æ—¶é—´â€ï¼Œä¸ IDLE äºŒé€‰ä¸€ä½¿ç”¨ï¼Œæå°‘è§äºä¸šåŠ¡ä»£ç </span></span><br><span class=\"line\"><span class=\"comment\"># [RETRYCOUNT count]: æ‰‹åŠ¨è®¾ç½® delivery countï¼Œå®ç°â€œæœ€å¤šé‡è¯• N æ¬¡ï¼Œè¶…è¿‡è¿›æ­»ä¿¡é˜Ÿåˆ—â€</span></span><br><span class=\"line\"><span class=\"comment\"># [FORCE]: å¼ºåˆ¶ claim ä¸å­˜åœ¨äº Pending çš„æ¶ˆæ¯ï¼Œâš ï¸ é«˜é£é™©</span></span><br><span class=\"line\"><span class=\"comment\"># [JUSTID]: åªè¿”å› æ¶ˆæ¯ IDï¼Œä¸è¿”å›æ¶ˆæ¯ä½“ï¼ˆfield/valueï¼‰ï¼Œå‡å°‘ç½‘ç»œå¼€é”€</span></span><br><span class=\"line\"><span class=\"comment\"># [LASTID lastid]ï¼ˆRedis â‰¥ 7.0ï¼‰: æ›´æ–° consumer group çš„ last-delivered-idï¼Œå½±å“åç»­ XREADGROUP &gt; çš„è¡Œä¸º</span></span><br><span class=\"line\"><span class=\"comment\">#    âš ï¸ é«˜çº§ç‰¹æ€§ï¼Œä¸€èˆ¬ä¸å»ºè®®ä¸šåŠ¡ä»£ç ä½¿ç”¨</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># 1ï¸âƒ£ æŠ¢å  idle è¶…è¿‡ 60s çš„æ¶ˆæ¯</span></span><br><span class=\"line\">XCLAIM order_stream group1 consumerB 60000 1766215642763-0</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;1766215642763-0&quot;</span></span><br><span class=\"line\">   2) 1) <span class=\"string\">&quot;uid&quot;</span></span><br><span class=\"line\">      2) <span class=\"string\">&quot;1001&quot;</span></span><br><span class=\"line\">      3) <span class=\"string\">&quot;order_no&quot;</span></span><br><span class=\"line\">      4) <span class=\"string\">&quot;ORD20251220&quot;</span></span><br><span class=\"line\">      5) <span class=\"string\">&quot;price&quot;</span></span><br><span class=\"line\">      6) <span class=\"string\">&quot;299&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2ï¸âƒ£ æŠ¢å å¹¶æ ‡è®°ä¸ºç¬¬ 3 æ¬¡é‡è¯•</span></span><br><span class=\"line\">XCLAIM orders order-group consumerB 60000 1766215642763-0 RETRYCOUNT 3</span><br><span class=\"line\"><span class=\"comment\"># 3ï¸âƒ£ åªè¿”å› IDï¼ˆé…åˆæ‰¹å¤„ç†ï¼‰</span></span><br><span class=\"line\">XCLAIM orders order-group consumerB 60000 1766215642763-0 JUSTID</span><br></pre></td></tr></table></figure>\n<h2 id=\"é«˜çº§ç‰¹æ€§ï¼ˆç”Ÿäº§å¿…å¤‡ï¼‰\">é«˜çº§ç‰¹æ€§ï¼ˆç”Ÿäº§å¿…å¤‡ï¼‰</h2>\n<ol>\n<li class=\"lvl-3\">\n<p>æ¶ˆæ¯å›æº¯ä¸éå†</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># XRANGE key èµ·å§‹ID ç»“æŸID [COUNT æ¡æ•°]ï¼ˆæ­£å‘éå†ï¼‰</span></span><br><span class=\"line\">XRANGE key start end [COUNT count]</span><br><span class=\"line\"><span class=\"comment\"># XREVRANGE key ç»“æŸID èµ·å§‹ID [COUNT æ¡æ•°]ï¼ˆåå‘éå†ï¼‰</span></span><br><span class=\"line\">XREVRANGE key end start [COUNT count]</span><br><span class=\"line\"><span class=\"comment\"># ç¤ºä¾‹: 0-0:æœ€å°çš„æ¶ˆæ¯IDï¼Œç­‰åŒäº -ï¼Œ+:è¡¨ç¤ºæœ€æ–°æ¶ˆæ¯ï¼Œé€‚åˆæ•°æ®å¯¹è´¦ã€å†å²æ¶ˆæ¯æŸ¥è¯¢ã€‚</span></span><br><span class=\"line\">XRANGE order_stream 0-0 + COUNT 10</span><br><span class=\"line\">XRANGE order_stream - + COUNT 10</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li class=\"lvl-3\">\n<p>é˜Ÿåˆ—ä¿¡æ¯æŸ¥è¯¢</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥æ¶ˆæ¯æ€»æ•°</span></span><br><span class=\"line\">XLEN key</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥Streamå®Œæ•´å…ƒæ•°æ®ï¼ˆæœ€æ–°IDã€æ¶ˆè´¹ç»„æ•°é‡ã€æ¶ˆæ¯æ€»æ•°ç­‰ï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">XINFO STREAM key [FULL [COUNT count]]</span><br><span class=\"line\"><span class=\"comment\">## FULL: å®Œæ•´æ¨¡å¼</span></span><br><span class=\"line\">    <span class=\"comment\"># ğŸ‘‰ è¿”å›ï¼š</span></span><br><span class=\"line\">    <span class=\"comment\">#     Stream å…ƒä¿¡æ¯</span></span><br><span class=\"line\">    <span class=\"comment\">#     æ‰€æœ‰ Consumer Group</span></span><br><span class=\"line\">    <span class=\"comment\">#     æ¯ä¸ª Group çš„ Consumer</span></span><br><span class=\"line\">    <span class=\"comment\">#     Pending Entries Listï¼ˆPELï¼‰</span></span><br><span class=\"line\">    <span class=\"comment\">#     éƒ¨åˆ†å†å² entries</span></span><br><span class=\"line\">    <span class=\"comment\"># âš ï¸ å¼€é”€å¾ˆå¤§ï¼Œæ…ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚</span></span><br><span class=\"line\"><span class=\"comment\">## COUNT countï¼ˆFULL æ¨¡å¼çš„é™åˆ¶å‚æ•°ï¼‰</span></span><br><span class=\"line\">    <span class=\"comment\">#   XINFO STREAM key FULL COUNT 10: é™åˆ¶è¿”å›çš„entries æ•°é‡ä»¥åŠæ¯ä¸ª group / consumer çš„ PEL è®°å½•æ•°é‡</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥æ‰€æœ‰æ¶ˆè´¹ç»„ä¿¡æ¯</span></span><br><span class=\"line\">XINFO GROUPS key</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¥ç»„ä¸‹æ‰€æœ‰æ¶ˆè´¹è€…</span></span><br><span class=\"line\">XINFO CONSUMERS key æ¶ˆè´¹ç»„å</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li class=\"lvl-3\">\n<p>æ¶ˆè´¹ç»„ç®¡ç†</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ¶ˆè´¹ç»„</span></span><br><span class=\"line\">XGROUP DESTROY key æ¶ˆè´¹ç»„å</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ¶ˆè´¹è€…</span></span><br><span class=\"line\">XGROUP DELCONSUMER key æ¶ˆè´¹ç»„å æ¶ˆè´¹è€…å</span><br><span class=\"line\"><span class=\"comment\"># é‡ç½®æ¶ˆè´¹ç»„èµ·å§‹ID</span></span><br><span class=\"line\">XGROUP SETID key æ¶ˆè´¹ç»„å æ–°ID</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li class=\"lvl-3\">\n<p>æƒ°æ€§åˆ é™¤ï¼šStream ä¸ä¼šä¸»åŠ¨åˆ é™¤å·²ç¡®è®¤çš„æ¶ˆæ¯ï¼Œä»…é MAXLENæ·˜æ±°ï¼Œè‹¥éœ€ä¸»åŠ¨æ¸…ç†å†å²æ¶ˆæ¯ï¼Œç›´æ¥ç”¨XADDçš„MAXLENå‚æ•°å³å¯ï¼Œæ— éœ€é¢å¤–å‘½ä»¤ã€‚</p>\n</li>\n</ol>\n<h2 id=\"ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒç—›ç‚¹ä¸è§£å†³æ–¹æ¡ˆ\">ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒç—›ç‚¹ä¸è§£å†³æ–¹æ¡ˆ</h2>\n<ol>\n<li class=\"lvl-3\">\n<p>æ¶ˆæ¯ä¸¢å¤±ï¼š3é‡ä¿éšœ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">å¼€å¯ Redis AOF æŒä¹…åŒ–ï¼ˆè®¾ä¸ºeverysecï¼Œå…¼é¡¾æ€§èƒ½ä¸å¯é æ€§ï¼‰</li>\n<li class=\"lvl-6\">ç”Ÿäº§è€…å†™å…¥åç¡®è®¤è¿”å›å€¼ï¼ˆç¡®ä¿å†™å…¥æˆåŠŸï¼‰</li>\n<li class=\"lvl-6\">æ¶ˆè´¹è€…æ¶ˆè´¹åå¿…é¡»<code>XACK</code>ç¡®è®¤ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-3\">\n<p>æ¶ˆæ¯å †ç§¯ï¼š2ç§å¤„ç†</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">â‘  å†™å…¥æ—¶ç”¨<code>MAXLEN</code>è®¾ç½®ä¸Šé™ï¼Œæ·˜æ±°æ—§æ¶ˆæ¯ï¼›</li>\n<li class=\"lvl-6\">â‘¡ æ¶ˆè´¹ç«¯æ‰©å®¹æ¶ˆè´¹è€…å®ä¾‹ï¼Œæ¶ˆè´¹ç»„ä¼šè‡ªåŠ¨å°†æœªæ¶ˆè´¹æ¶ˆæ¯åˆ†ç‰‡ç»™å¤šä¸ªæ¶ˆè´¹è€…ï¼Œå®ç°å¹¶è¡Œæ¶ˆè´¹ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-3\">\n<p>é‡å¤æ¶ˆè´¹</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æ ¹æº: ç½‘ç»œæŠ–åŠ¨ï¼ˆæ¶ˆè´¹è€…ç¡®è®¤æ¶ˆæ¯å‰æ–­å¼€è¿æ¥ï¼Œæ¶ˆæ¯é‡å›PELï¼‰</li>\n<li class=\"lvl-6\">è§£å†³æ–¹æ¡ˆ: æ¶ˆæ¯å¹‚ç­‰æ€§ï¼ˆç”Ÿäº§è€…ç»™æ¶ˆæ¯åŠ å”¯ä¸€æ ‡è¯†ï¼Œæ¶ˆè´¹è€…æ ¹æ®å”¯ä¸€æ ‡è¯†å»é‡ï¼‰ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-3\">\n<p>é˜»å¡è¶…æ—¶ï¼šæ¶ˆè´¹ç«¯ç”¨BLOCKé˜»å¡æ‹‰å–ï¼Œè¶…æ—¶æ—¶é—´å»ºè®®è®¾ä¸º3-5ç§’ï¼Œé¿å…é¢‘ç¹ç©ºè½®è¯¢å ç”¨CPUï¼ŒåŒæ—¶ä¿è¯æ–°æ¶ˆæ¯çš„å“åº”é€Ÿåº¦ã€‚</p>\n</li>\n</ol>\n<h2 id=\"å…¸å‹åº”ç”¨åœºæ™¯\">å…¸å‹åº”ç”¨åœºæ™¯</h2>\n<h3 id=\"åˆ†å¸ƒå¼ä¸šåŠ¡è§£è€¦ï¼ˆè®¢å•-åº“å­˜-æ”¯ä»˜-ç‰©æµè§£è€¦ï¼‰\">åˆ†å¸ƒå¼ä¸šåŠ¡è§£è€¦ï¼ˆè®¢å•-åº“å­˜-æ”¯ä»˜-ç‰©æµè§£è€¦ï¼‰</h3>\n<blockquote>\n<p>æ ¸å¿ƒæ€è·¯ï¼šå• Stream å¯¹åº”æ ¸å¿ƒä¸šåŠ¡ï¼ˆè®¢å•ï¼‰ï¼Œåº“å­˜ã€æ”¯ä»˜ã€ç‰©æµå„åˆ›å»ºç‹¬ç«‹æ¶ˆè´¹ç»„ï¼Œå„è‡ªæ¶ˆè´¹äº’ä¸å¹²æ‰°ï¼Œå®ç°ä¸šåŠ¡è§£è€¦ã€‚</p>\n</blockquote>\n<ol>\n<li class=\"lvl-3\">\n<p>ç”Ÿäº§è€…ï¼ˆè®¢å•æœåŠ¡ï¼‰ï¼šå†™å…¥è®¢å•å®Œæˆæ¶ˆæ¯</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯IDï¼Œå†™å…¥è®¢å•æ ¸å¿ƒä¿¡æ¯ï¼Œè®¾ç½®é˜Ÿåˆ—æœ€å¤§1ä¸‡æ¡æ¶ˆæ¯ï¼ˆè¿‘ä¼¼æ·˜æ±°ï¼‰</span></span><br><span class=\"line\">XADD order_core_stream * MAXLEN ~ 10000 order_no ORD20251220001 uid 1001 amount 299 status created create_time 1734567890</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li class=\"lvl-3\">\n<p>åˆ›å»º3ä¸ªç‹¬ç«‹æ¶ˆè´¹ç»„ï¼ˆåº“å­˜/æ”¯ä»˜/ç‰©æµï¼‰</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åº“å­˜æ¶ˆè´¹ç»„ï¼šä»æœ€æ–°æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ï¼Œé˜Ÿåˆ—ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º</span></span><br><span class=\"line\">XGROUP CREATE order_core_stream group_stock $ MKSTREAM</span><br><span class=\"line\"><span class=\"comment\"># æ”¯ä»˜æ¶ˆè´¹ç»„</span></span><br><span class=\"line\">XGROUP CREATE order_core_stream group_pay $ MKSTREAM</span><br><span class=\"line\"><span class=\"comment\"># ç‰©æµæ¶ˆè´¹ç»„</span></span><br><span class=\"line\">XGROUP CREATE order_core_stream group_logistics $ MKSTREAM</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li class=\"lvl-3\">\n<p>å„æ¶ˆè´¹ç»„æ¶ˆè´¹è€…æ‹‰å–+ç¡®è®¤æ¶ˆæ¯</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åº“å­˜æœåŠ¡æ¶ˆè´¹è€…ï¼ˆconsumer_stock1ï¼‰æ‹‰å–3æ¡æœªæ¶ˆè´¹æ¶ˆæ¯ï¼Œé˜»å¡5ç§’</span></span><br><span class=\"line\">XREADGROUP GROUP group_stock consumer_stock1 COUNT 3 BLOCK 5000 STREAMS order_core_stream &gt;</span><br><span class=\"line\"><span class=\"comment\"># åº“å­˜å¤„ç†å®Œæˆåç¡®è®¤æ¶ˆæ¯ï¼ˆæ›¿æ¢ä¸ºå®é™…æ‹‰å–åˆ°çš„æ¶ˆæ¯IDï¼‰</span></span><br><span class=\"line\">XACK order_core_stream group_stock 1734567890000-0 1734567890001-0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ”¯ä»˜æœåŠ¡æ¶ˆè´¹è€…ï¼ˆconsumer_pay1ï¼‰åŒç†</span></span><br><span class=\"line\">XREADGROUP GROUP group_pay consumer_pay1 COUNT 3 BLOCK 5000 STREAMS order_core_stream &gt;</span><br><span class=\"line\">XACK order_core_stream group_pay 1734567890000-0 1734567890001-0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç‰©æµæœåŠ¡æ¶ˆè´¹è€…ï¼ˆconsumer_log1ï¼‰åŒç†</span></span><br><span class=\"line\">XREADGROUP GROUP group_logistics consumer_log1 COUNT 3 BLOCK 5000 STREAMS order_core_stream &gt;</span><br><span class=\"line\">XACK order_core_stream group_logistics 1734567890000-0 1734567890001-0</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆç”¨æˆ·æ³¨å†Œ-é‚®ä»¶-çŸ­ä¿¡-ç§¯åˆ†å¼‚æ­¥æ‰§è¡Œï¼‰\">å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆç”¨æˆ·æ³¨å†Œ-é‚®ä»¶/çŸ­ä¿¡/ç§¯åˆ†å¼‚æ­¥æ‰§è¡Œï¼‰</h3>\n<blockquote>\n<p>æ ¸å¿ƒæ€è·¯ï¼šæ³¨å†Œæ¥å£åªè´Ÿè´£å†™å…¥ Stream æ¶ˆæ¯ï¼Œæ— éœ€ç­‰å¾…åç»­ä»»åŠ¡å®Œæˆï¼Œå•æ¶ˆè´¹ç»„å¤šæ¶ˆè´¹è€…æå‡å¼‚æ­¥ä»»åŠ¡å¤„ç†æ•ˆç‡ï¼Œæ ¸å¿ƒæ˜¯å¿«é€Ÿå“åº”å‰ç«¯ã€‚</p>\n</blockquote>\n<ol>\n<li class=\"lvl-3\">\n<p>ç”Ÿäº§è€…ï¼ˆæ³¨å†ŒæœåŠ¡ï¼‰ï¼šç”¨æˆ·æ³¨å†ŒæˆåŠŸåå†™å…¥æ¶ˆæ¯</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å†™å…¥ç”¨æˆ·æ³¨å†Œä¿¡æ¯ï¼ŒMAXLENé™åˆ¶5000æ¡ï¼Œé¿å…ç§¯å‹è¿‡å¤šæ— æ•ˆæ³¨å†Œæ¶ˆæ¯</span></span><br><span class=\"line\">XADD user_register_stream * MAXLEN ~ 5000 uid 1001 username zhangsan phone 13800138000 email zs@xxx.com reg_time 1734567900</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li class=\"lvl-3\">\n<p>åˆ›å»ºå•ä¸ªæ¶ˆè´¹ç»„ï¼ˆç»Ÿä¸€å¤„ç†æ³¨å†Œåç»­ä»»åŠ¡ï¼‰</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XGROUP CREATE user_register_stream group_reg_task $ MKSTREAM</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li class=\"lvl-3\">\n<p>å¤šæ¶ˆè´¹è€…å¹¶è¡Œæ‹‰å–ï¼ˆé‚®ä»¶/çŸ­ä¿¡/ç§¯åˆ†å„1ä¸ªæ¶ˆè´¹è€…ï¼Œæˆ–å¤šå®ä¾‹æ‰©å®¹ï¼‰</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># çŸ­ä¿¡å‘é€æ¶ˆè´¹è€…ï¼ˆconsumer_smsï¼‰</span></span><br><span class=\"line\">XREADGROUP GROUP group_reg_task consumer_sms COUNT 5 BLOCK 3000 STREAMS user_register_stream &gt;</span><br><span class=\"line\">XACK user_register_stream group_reg_task æ¶ˆæ¯ID1 æ¶ˆæ¯ID2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‚®ä»¶å‘é€æ¶ˆè´¹è€…ï¼ˆconsumer_emailï¼‰</span></span><br><span class=\"line\">XREADGROUP GROUP group_reg_task consumer_email COUNT 5 BLOCK 3000 STREAMS user_register_stream &gt;</span><br><span class=\"line\">XACK user_register_stream group_reg_task æ¶ˆæ¯ID1 æ¶ˆæ¯ID2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç§¯åˆ†å‘æ”¾æ¶ˆè´¹è€…ï¼ˆconsumer_scoreï¼‰</span></span><br><span class=\"line\">XREADGROUP GROUP group_reg_task consumer_score COUNT 5 BLOCK 3000 STREAMS user_register_stream &gt;</span><br><span class=\"line\">XACK user_register_stream group_reg_task æ¶ˆæ¯ID1 æ¶ˆæ¯ID2</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ—¥å¿—æ”¶é›†ï¼ˆç³»ç»Ÿå®æ—¶æ—¥å¿—-åˆ†æ-å‘Šè­¦ï¼‰\">æ—¥å¿—æ”¶é›†ï¼ˆç³»ç»Ÿå®æ—¶æ—¥å¿—-åˆ†æ/å‘Šè­¦ï¼‰</h3>\n<blockquote>\n<p>æ ¸å¿ƒæ€è·¯ï¼šå„ä¸šåŠ¡ç³»ç»Ÿå®æ—¶å†™å…¥æ—¥å¿—åˆ° Streamï¼Œå¤šæ¶ˆè´¹ç»„åˆ†åˆ«åšæ—¥å¿—åˆ†æã€å®æ—¶å‘Šè­¦ï¼Œå…¼é¡¾å®æ—¶æ€§ä¸æ•°æ®ç•™å­˜ï¼Œæ”¯æŒå†å²æ—¥å¿—å›æº¯ã€‚</p>\n</blockquote>\n<ol>\n<li class=\"lvl-3\">\n<p>ç”Ÿäº§è€…ï¼ˆå„ä¸šåŠ¡ç³»ç»Ÿï¼‰ï¼šå®æ—¶å†™å…¥ç³»ç»Ÿæ—¥å¿—ï¼ˆæŒ‰çº§åˆ«/ä¸šåŠ¡åˆ†ç±»ï¼Œè¿™é‡Œç»Ÿä¸€å†™å…¥æ€»æ—¥å¿—æµï¼‰</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å†™å…¥æ—¥å¿—ï¼šåŒ…å«ä¸šåŠ¡æ¨¡å—ã€æ—¥å¿—çº§åˆ«ã€å†…å®¹ã€æ—¶é—´ï¼Œæ— æ¶ˆæ¯æ•°é‡ä¸Šé™ï¼ˆæŒ‰å®é™…æœåŠ¡å™¨å†…å­˜è°ƒæ•´MAXLENï¼‰</span></span><br><span class=\"line\">XADD sys_log_stream * module order_service level ERROR content <span class=\"string\">&quot;åº“å­˜æ‰£å‡å¤±è´¥ï¼Œè®¢å•å·ORD20251220001&quot;</span> log_time 1734567910</span><br><span class=\"line\">XADD sys_log_stream * module pay_service level INFO content <span class=\"string\">&quot;æ”¯ä»˜æˆåŠŸï¼Œuid1001ï¼Œé‡‘é¢299&quot;</span> log_time 1734567912</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li class=\"lvl-3\">\n<p>åˆ›å»º2ä¸ªæ¶ˆè´¹ç»„ï¼ˆæ—¥å¿—åˆ†æ+å®æ—¶å‘Šè­¦ï¼‰</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ—¥å¿—åˆ†ææ¶ˆè´¹ç»„ï¼ˆç”¨äºç¦»çº¿ç»Ÿè®¡ã€æ•°æ®å½’æ¡£ï¼‰ï¼Œä»é˜Ÿåˆ—å¼€å¤´æ¶ˆè´¹ï¼ˆ0-0ï¼‰ï¼Œå…œåº•æ‰€æœ‰å†å²æ—¥å¿—</span></span><br><span class=\"line\">XGROUP CREATE sys_log_stream group_log_analysis 0-0 MKSTREAM</span><br><span class=\"line\"><span class=\"comment\"># å®æ—¶å‘Šè­¦æ¶ˆè´¹ç»„ï¼ˆç”¨äºå®æ—¶æ•è·ERRORæ—¥å¿—å‘Šè­¦ï¼‰ï¼Œä»æœ€æ–°æ¶ˆæ¯æ¶ˆè´¹</span></span><br><span class=\"line\">XGROUP CREATE sys_log_stream group_log_alert $ MKSTREAM</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li class=\"lvl-3\">\n<p>å¯¹åº”æ¶ˆè´¹è€…æ‹‰å–å¤„ç†</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ—¥å¿—åˆ†ææ¶ˆè´¹è€…ï¼ˆæ‰¹é‡æ‹‰å–ï¼Œéé˜»å¡ï¼Œé€‚åˆç¦»çº¿å¤„ç†ï¼‰</span></span><br><span class=\"line\">XREADGROUP GROUP group_log_analysis consumer_analysis COUNT 100 STREAMS sys_log_stream &gt;</span><br><span class=\"line\">XACK sys_log_stream group_log_analysis æ‰¹é‡æ¶ˆæ¯ID...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‘Šè­¦æ¶ˆè´¹è€…ï¼ˆé˜»å¡æ‹‰å–ï¼Œå¿«é€Ÿå“åº”ï¼Œåªå¤„ç†ERRORçº§åˆ«æ—¥å¿—ï¼‰</span></span><br><span class=\"line\">XREADGROUP GROUP group_log_alert consumer_alert BLOCK 0 STREAMS sys_log_stream &gt;  <span class=\"comment\"># BLOCK 0 æ°¸ä¹…é˜»å¡ï¼Œæœ‰æ¶ˆæ¯ç«‹å³è¿”å›</span></span><br><span class=\"line\">XACK sys_log_stream group_log_alert å‘Šè­¦æ¶ˆæ¯ID</span><br></pre></td></tr></table></figure>\n<h3 id=\"é™æµå‰Šå³°ï¼ˆç§’æ€åœºæ™¯-è¯·æ±‚å‰Šå³°å¡«è°·ï¼‰\">é™æµå‰Šå³°ï¼ˆç§’æ€åœºæ™¯-è¯·æ±‚å‰Šå³°å¡«è°·ï¼‰</h3>\n<blockquote>\n<p>æ ¸å¿ƒæ€è·¯ï¼šç§’æ€è¯·æ±‚é«˜å³°æ—¶ï¼Œå…ˆå†™å…¥ Stream åšç¼“å†²ï¼Œæ¶ˆè´¹ç«¯åŒ€é€Ÿæ‹‰å–ï¼ˆæ§åˆ¶æ¯ç§’å¤„ç†é‡ï¼‰ï¼Œé¿å…ä¸‹æ¸¸æ•°æ®åº“/ä¸šåŠ¡æœåŠ¡è¢«å‹å®ï¼Œæ ¸å¿ƒæ˜¯â€œæ…¢æ¶ˆè´¹ã€ç¨³å¤„ç†â€ã€‚</p>\n</blockquote>\n<ol>\n<li class=\"lvl-3\">\n<p>ç”Ÿäº§è€…ï¼ˆç§’æ€å…¥å£æœåŠ¡ï¼‰ï¼šæ¥æ”¶ç§’æ€è¯·æ±‚ï¼Œç›´æ¥å†™å…¥ Streamï¼Œå¿«é€Ÿè¿”å›â€œæ’é˜Ÿä¸­â€</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å†™å…¥ç§’æ€è¯·æ±‚ï¼Œè®¾ç½®MAXLEN 10000ï¼ˆé™åˆ¶æœ€å¤§æ’é˜Ÿæ•°ï¼Œè¶…è¿‡åˆ™æ‹’ç»ï¼Œé¿å…OOMï¼‰</span></span><br><span class=\"line\">XADD seckill_stream * MAXLEN ~ 10000 seckill_id 101 uid 1001 request_time 1734568000</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li class=\"lvl-3\">\n<p>åˆ›å»ºæ¶ˆè´¹ç»„ï¼ˆå•æ¶ˆè´¹ç»„+å¤šæ¶ˆè´¹è€…ï¼Œæ§åˆ¶æ€»å¤„ç†é€Ÿç‡ï¼‰</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XGROUP CREATE seckill_stream group_seckill $ MKSTREAM</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li class=\"lvl-3\">\n<p>æ¶ˆè´¹ç«¯ï¼ˆåŒ€é€Ÿæ‹‰å–ï¼Œæ ¸å¿ƒæ˜¯æ§åˆ¶COUNTå’Œæ¶ˆè´¹é¢‘ç‡ï¼Œæ¯”å¦‚æ¯ç§’å¤„ç†100æ¡ï¼‰</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ¶ˆè´¹è€…ï¼ˆå¤šå®ä¾‹éƒ¨ç½²ï¼Œæ€»å¤„ç†é‡=å•å®ä¾‹COUNTÃ—å®ä¾‹æ•°ï¼Œè¿™é‡Œå•å®ä¾‹æ¯æ¬¡æ‹‰10æ¡ï¼Œæ¯ç§’æ‹‰10æ¬¡ï¼Œå•å®ä¾‹æ¯ç§’å¤„ç†100æ¡ï¼‰</span></span><br><span class=\"line\">XREADGROUP GROUP group_seckill consumer_seckill1 COUNT 10 BLOCK 100 STREAMS seckill_stream &gt;</span><br><span class=\"line\"><span class=\"comment\"># ä¸šåŠ¡å¤„ç†ï¼šæ‰£åº“å­˜ã€ç”Ÿæˆè®¢å•ï¼ˆæ ¸å¿ƒæ˜¯å¤„ç†é€»è¾‘åŒæ­¥æ‰§è¡Œï¼Œæ§åˆ¶é€Ÿç‡ï¼‰</span></span><br><span class=\"line\">XACK seckill_stream group_seckill ç§’æ€è¯·æ±‚æ¶ˆæ¯ID...</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å…³é”®ä¼˜åŒ–ï¼šæ¶ˆè´¹ç«¯é€šè¿‡å®šæ—¶ä»»åŠ¡+å›ºå®šCOUNTæ‹‰å–ï¼Œè€Œéæ— é™æ‹‰å–ï¼Œç²¾å‡†æ§åˆ¶å¤„ç†é€Ÿç‡ï¼Œå®ç°å‰Šå³°å¡«è°·ã€‚</p>\n</blockquote>\n<h2 id=\"ä¸å…¶ä»–-Redis-é˜Ÿåˆ—æ–¹æ¡ˆå¯¹æ¯”ï¼ˆæ ¸å¿ƒä¼˜åŠ¿ï¼‰\">ä¸å…¶ä»– Redis é˜Ÿåˆ—æ–¹æ¡ˆå¯¹æ¯”ï¼ˆæ ¸å¿ƒä¼˜åŠ¿ï¼‰</h2>\n<p>â€¢ å¯¹æ¯” List<br>\n- List æ˜¯ç®€å•çš„å…ˆè¿›å…ˆå‡ºï¼Œä¸æ”¯æŒå¤šæ’­ï¼ˆå¤šä¸ªæ¶ˆè´¹è€…ä¼šæŠ¢æ¶ˆæ¯ï¼‰ã€æ— æ¶ˆè´¹ç»„ã€æ— æ¶ˆæ¯ç¡®è®¤ï¼Œä»…é€‚åˆç®€å•ä¸€å¯¹ä¸€é˜Ÿåˆ—ï¼›<br>\n- Stream æ”¯æŒå¤šæ’­+æ¶ˆè´¹ç»„+ç¡®è®¤æœºåˆ¶ï¼Œé€‚åˆå¤æ‚åˆ†å¸ƒå¼åœºæ™¯ã€‚</p>\n<table>\n<thead>\n<tr>\n<th>å¯¹æ¯”é¡¹</th>\n<th>Stream</th>\n<th>List</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ¶ˆè´¹è€…ç»„</td>\n<td>âœ…</td>\n<td>âŒ</td>\n</tr>\n<tr>\n<td>ACK</td>\n<td>âœ…</td>\n<td>âŒ</td>\n</tr>\n<tr>\n<td>é‡è¯•</td>\n<td>âœ…</td>\n<td>âŒ</td>\n</tr>\n<tr>\n<td>é˜»å¡</td>\n<td>âœ…</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td>é¡ºåºæ€§</td>\n<td>å¼º</td>\n<td>å¼º</td>\n</tr>\n</tbody>\n</table>\n<p>â€¢ å¯¹æ¯” Pub/Sub<br>\n- Pub/Sub æ— æŒä¹…åŒ–ï¼ŒRedis é‡å¯æˆ–æ¶ˆè´¹è€…ç¦»çº¿ä¼šä¸¢æ¶ˆæ¯ï¼›<br>\n- Pub/Sub æ— æ¶ˆè´¹ç»„ï¼Œæ¶ˆæ¯å‘å®Œå³ä¸¢ï¼Œä»…é€‚åˆå®æ—¶å¹¿æ’­ï¼ˆå¦‚èŠå¤©å®¤ï¼‰ï¼Œä¸é€‚åˆé‡è¦ä¸šåŠ¡ã€‚</p>\n<h2 id=\"Stream-å‘½ä»¤\">Stream å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SpringBoot çš„ <code>StringRedisTemplate.opsForStream()</code> ä¸­ Stream æ•°æ®ç±»å‹ çš„æ“ä½œæ–¹æ³•ä¸ Redis åŸç”Ÿå‘½ä»¤çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<blockquote>\n<p>æ³¨æ„è¿™é‡Œä¸ä¸€å®šè¦ç”¨ <code>StringRedisTemplate</code> æ¥æ“ä½œ Streamï¼Œä½†æ˜¯ç”¨ <code>StringRedisTemplate</code> å¯ä»¥ä¿è¯å¯è¯»æ€§ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ¸å¿ƒèƒ½åŠ›åˆ’åˆ†ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">æ¶ˆæ¯å†™å…¥ï¼ˆXADDï¼‰</span><br><span class=\"line\">æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰</span><br><span class=\"line\">æ¶ˆæ¯è¯»å–ï¼ˆXRANGE / XREAD / XREADGROUPï¼‰</span><br><span class=\"line\">Pending æ¶ˆæ¯ç®¡ç†ï¼ˆXPENDING / XCLAIMï¼‰</span><br><span class=\"line\">æ¶ˆè´¹è€…ç»„ç®¡ç†ï¼ˆXGROUPï¼‰</span><br><span class=\"line\">Stream å…ƒä¿¡æ¯ï¼ˆXINFOï¼‰</span><br><span class=\"line\">Stream è£å‰ªä¸åˆ é™¤ï¼ˆXTRIM / XDELï¼‰</span><br><span class=\"line\">å¯¹è±¡æ˜ å°„ï¼ˆMapRecord / ObjectRecordï¼‰</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ¶ˆæ¯å†™å…¥ï¼ˆXADDï¼‰\">æ¶ˆæ¯å†™å…¥ï¼ˆXADDï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1ï¸âƒ£ åŸºç¡€å†™å…¥</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³• <code>opsForStream().xxx()</code></th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å†™å…¥ Map</td>\n<td><code>add(K key, Map&lt;HK,HV&gt;)</code></td>\n<td><code>XADD key * field value</code></td>\n<td>è‡ªåŠ¨ç”Ÿæˆ ID</td>\n</tr>\n<tr>\n<td>å†™å…¥ Record</td>\n<td><code>add(Record&lt;K, ?&gt; record)</code></td>\n<td><code>XADD</code></td>\n<td>æ”¯æŒ ObjectRecord</td>\n</tr>\n<tr>\n<td>å†™å…¥ MapRecord</td>\n<td><code>add(MapRecord&lt;K,HK,HV&gt;)</code></td>\n<td><code>XADD</code></td>\n<td>Map å½¢å¼</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2ï¸âƒ£ å¸¦å‚æ•°å†™å…¥ï¼ˆæ¨èï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å†™å…¥ + é€‰é¡¹</td>\n<td><code>add(record, XAddOptions)</code></td>\n<td><code>XADD ...</code></td>\n<td>æ”¯æŒ MAXLEN / NOMKSTREAM</td>\n</tr>\n<tr>\n<td>Map + é€‰é¡¹</td>\n<td><code>add(key, map, XAddOptions)</code></td>\n<td><code>XADD</code></td>\n<td>Redis â‰¥ 6</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰\">æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ç¡®è®¤æ¶ˆæ¯</td>\n<td><code>acknowledge(key, group, recordIdsâ€¦)</code></td>\n<td><code>XACK</code></td>\n<td>æ ‡è®°å·²æ¶ˆè´¹</td>\n</tr>\n<tr>\n<td>Record ç¡®è®¤</td>\n<td><code>acknowledge(group, record)</code></td>\n<td><code>XACK</code></td>\n<td>å¸¸ç”¨</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>âš ï¸ åªå¯¹ Consumer Group ç”Ÿæ•ˆ</p>\n</blockquote>\n<h3 id=\"æ¶ˆæ¯è¯»å–ï¼ˆæ— æ¶ˆè´¹è€…ç»„ï¼‰\">æ¶ˆæ¯è¯»å–ï¼ˆæ— æ¶ˆè´¹è€…ç»„ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1ï¸âƒ£ æŒ‰ Range è¯»å–ï¼ˆå†å²æ•°æ®ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ­£åºè¯»å–</td>\n<td><code>range(key, range)</code></td>\n<td><code>XRANGE</code></td>\n</tr>\n<tr>\n<td>é™åˆ¶æ¡æ•°</td>\n<td><code>range(key, range, limit)</code></td>\n<td><code>XRANGE</code></td>\n</tr>\n<tr>\n<td>ååºè¯»å–</td>\n<td><code>reverseRange(key, range)</code></td>\n<td><code>XREVRANGE</code></td>\n</tr>\n<tr>\n<td>ååº + limit</td>\n<td><code>reverseRange(key, range, limit)</code></td>\n<td><code>XREVRANGE</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2ï¸âƒ£ å®æ—¶è¯»å–ï¼ˆXREADï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>è¯»å–</td>\n<td><code>read(StreamOffsetâ€¦)</code></td>\n<td><code>XREAD</code></td>\n<td>ä¸æ”¯æŒ ACK</td>\n</tr>\n<tr>\n<td>å¸¦å‚æ•°</td>\n<td><code>read(options, offsetsâ€¦)</code></td>\n<td><code>XREAD</code></td>\n<td>BLOCK / COUNT</td>\n</tr>\n<tr>\n<td>æ˜ å°„å¯¹è±¡</td>\n<td><code>read(Class&lt;T&gt;, â€¦)</code></td>\n<td><code>XREAD</code></td>\n<td>è‡ªåŠ¨ååºåˆ—åŒ–</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æ¶ˆè´¹è€…ç»„è¯»å–ï¼ˆXREADGROUPï¼‰\">æ¶ˆè´¹è€…ç»„è¯»å–ï¼ˆXREADGROUPï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ç»„å†…è¯»å–</td>\n<td><code>read(Consumer, offsetsâ€¦)</code></td>\n<td><code>XREADGROUP</code></td>\n<td>MQ æ ¸å¿ƒ</td>\n</tr>\n<tr>\n<td>å¸¦å‚æ•°</td>\n<td><code>read(Consumer, options, offsetsâ€¦)</code></td>\n<td><code>XREADGROUP</code></td>\n<td>BLOCK</td>\n</tr>\n<tr>\n<td>æ˜ å°„å¯¹è±¡</td>\n<td><code>read(Class&lt;T&gt;, Consumer, â€¦)</code></td>\n<td><code>XREADGROUP</code></td>\n<td>â€”</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"Pending-æ¶ˆæ¯ç®¡ç†ï¼ˆXPENDING-XCLAIMï¼‰\">Pending æ¶ˆæ¯ç®¡ç†ï¼ˆXPENDING / XCLAIMï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1ï¸âƒ£ Pending æŸ¥è¯¢</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Pending æ±‡æ€»</td>\n<td><code>pending(key, group)</code></td>\n<td><code>XPENDING</code></td>\n</tr>\n<tr>\n<td>æŒ‡å®šæ¶ˆè´¹è€…</td>\n<td><code>pending(key, consumer)</code></td>\n<td><code>XPENDING</code></td>\n</tr>\n<tr>\n<td>èŒƒå›´æŸ¥è¯¢</td>\n<td><code>pending(key, group, range, count)</code></td>\n<td><code>XPENDING</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2ï¸âƒ£ æ¶ˆæ¯é‡æ–°åˆ†é…ï¼ˆXCLAIMï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é‡æ–°åˆ†é…</td>\n<td><code>claim(key, group, newOwner, minIdle, idsâ€¦)</code></td>\n<td><code>XCLAIM</code></td>\n<td>è¶…æ—¶æ¥ç®¡</td>\n</tr>\n<tr>\n<td>é«˜çº§é…ç½®</td>\n<td><code>claim(key, group, newOwner, XClaimOptions)</code></td>\n<td><code>XCLAIM</code></td>\n<td>force / retry</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æ¶ˆè´¹è€…ç»„ç®¡ç†ï¼ˆXGROUPï¼‰\">æ¶ˆè´¹è€…ç»„ç®¡ç†ï¼ˆXGROUPï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åˆ›å»ºç»„</td>\n<td><code>createGroup(key, group)</code></td>\n<td><code>XGROUP CREATE</code></td>\n<td>ä» <code>$</code> å¼€å§‹</td>\n</tr>\n<tr>\n<td>æŒ‡å®š offset</td>\n<td><code>createGroup(key, offset, group)</code></td>\n<td><code>XGROUP CREATE</code></td>\n<td>å¸¸ç”¨ <code>0-0</code></td>\n</tr>\n<tr>\n<td>åˆ é™¤æ¶ˆè´¹è€…</td>\n<td><code>deleteConsumer(key, consumer)</code></td>\n<td><code>XGROUP DELCONSUMER</code></td>\n<td></td>\n</tr>\n<tr>\n<td>é”€æ¯ç»„</td>\n<td><code>destroyGroup(key, group)</code></td>\n<td><code>XGROUP DESTROY</code></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"Stream-å…ƒä¿¡æ¯ï¼ˆXINFOï¼‰\">Stream å…ƒä¿¡æ¯ï¼ˆXINFOï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Stream ä¿¡æ¯</td>\n<td><code>info(key)</code></td>\n<td><code>XINFO STREAM</code></td>\n</tr>\n<tr>\n<td>ç»„ä¿¡æ¯</td>\n<td><code>groups(key)</code></td>\n<td><code>XINFO GROUPS</code></td>\n</tr>\n<tr>\n<td>æ¶ˆè´¹è€…ä¿¡æ¯</td>\n<td><code>consumers(key, group)</code></td>\n<td><code>XINFO CONSUMERS</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"Stream-åˆ é™¤-è£å‰ª\">Stream åˆ é™¤ / è£å‰ª</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1ï¸âƒ£ åˆ é™¤æ¶ˆæ¯</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åˆ é™¤æ¶ˆæ¯</td>\n<td><code>delete(key, recordIdsâ€¦)</code></td>\n<td><code>XDEL</code></td>\n</tr>\n<tr>\n<td>åˆ é™¤ Record</td>\n<td><code>delete(record)</code></td>\n<td><code>XDEL</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2ï¸âƒ£ è£å‰ª Streamï¼ˆXTRIMï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ç²¾ç¡®è£å‰ª</td>\n<td><code>trim(key, count)</code></td>\n<td><code>XTRIM</code></td>\n<td></td>\n</tr>\n<tr>\n<td>è¿‘ä¼¼è£å‰ª</td>\n<td><code>trim(key, count, true)</code></td>\n<td><code>XTRIM ~</code></td>\n<td>æ€§èƒ½æ›´å¥½</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å¯¹è±¡æ˜ å°„èƒ½åŠ›ï¼ˆéå¸¸é‡è¦ï¼‰\">å¯¹è±¡æ˜ å°„èƒ½åŠ›ï¼ˆéå¸¸é‡è¦ï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>èƒ½åŠ›</th>\n<th>æ–¹æ³•</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Map â†’ Object</td>\n<td><code>map(MapRecord, Class&lt;T&gt;)</code></td>\n<td>è‡ªåŠ¨ååºåˆ—åŒ–</td>\n</tr>\n<tr>\n<td>List æ˜ å°„</td>\n<td><code>map(List&lt;MapRecord&gt;, Class&lt;T&gt;)</code></td>\n<td></td>\n</tr>\n<tr>\n<td>HashMapper</td>\n<td><code>getHashMapper(Class&lt;T&gt;)</code></td>\n<td>è‡ªå®šä¹‰æ˜ å°„</td>\n</tr>\n<tr>\n<td>ååºåˆ—åŒ–</td>\n<td><code>deserializeRecord(ByteRecord)</code></td>\n<td>åº•å±‚èƒ½åŠ›</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis Stream æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ Stream æ ¸å¿ƒè¯¦è§£ Redis Stream æ˜¯ Redis 5.0 æ–°å¢çš„æœ‰åºã€å¯æŒä¹…åŒ–ã€æ”¯æŒå¤šæ’­çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåº•å±‚ç”¨åŸºæ•°æ ‘+é“¾è¡¨å®ç°ï¼Œå…¼é¡¾äº†é«˜æ•ˆæŸ¥è¯¢ä¸æœ‰åºå†™å…¥ï¼Œå®Œç¾è§£å†³äº† List é˜Ÿåˆ—ï¼ˆæ— æ³•å¤šæ’­ã€æ— æŒä¹…åŒ–ä¿éšœï¼‰ã€Pub/Subï¼ˆæ— æŒä¹…åŒ–ã€ä¸¢æ¶ˆæ¯ï¼‰çš„ç—›ç‚¹ï¼Œæ˜¯ç”Ÿäº§ç¯å¢ƒé¦–é€‰çš„ Redis æ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆã€‚ å»ºè®®ç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„ MQ æ–¹æ¡ˆï¼Œå¦‚æœä»…æ˜¯å†…éƒ¨ç³»ç»Ÿä½¿ç”¨çš„è½»é‡MQï¼Œå·²ç»æœ‰äº†redisï¼Œä½†æ˜¯ä¸æƒ³å¼•å…¥å…¶å®ƒä¸­é—´ä»¶ï¼Œä¹Ÿå¯ä»¥å°è¯•ã€‚ Stream ä¸ä¼ ç»Ÿçš„MQ çš„å¯¹æ¯” å¯¹æ¯”ç»´åº¦ Redis Stream RabbitMQ Kafka æ•°æ®æ¨¡å‹ ç±»ä¼¼æ—¥å¿—çš„æœ‰åº KV æ¶ˆæ¯æµï¼ˆID â†’ field/valueï¼‰ é˜Ÿåˆ—ï¼ˆFIFOï¼‰ æ—¥å¿—åˆ†åŒºï¼ˆPartitioned Append-Only Logï¼‰ æ¶ˆæ¯æŒä¹…åŒ– å¯é€‰æŒä¹…åŒ–ï¼ˆAOF / RDBï¼‰ï¼Œé»˜è®¤å†…å­˜ä¼˜å…ˆ å¯æŒä¹…åŒ–åˆ°ç£ç›˜ æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œé¡ºåºå†™å…¥ï¼Œæ•ˆç‡é«˜ æ¶ˆæ¯ç¡®è®¤ XACK å¯¹å•æ¡æ¶ˆæ¯ç¡®è®¤ï¼Œæ”¯æŒ Pending æ¶ˆæ¯ç®¡ç† ACK / NACK Offset æ§åˆ¶ï¼ŒConsumer è‡ªè¡Œæäº¤ æ¶ˆè´¹æ¨¡å¼ æ”¯æŒ Consumer Groupï¼Œå¤šæ¶ˆè´¹è€…å…±äº« Pending æ¶ˆæ¯ Queue ç»‘å®š Consumerï¼Œå¤šæ¶ˆè´¹è€…æŠ¢å  Consumer Groupï¼Œå¤šæ¶ˆè´¹è€…å¹³è¡Œæ¶ˆè´¹ é‡å¤æ¶ˆè´¹ é»˜è®¤å¯èƒ½é‡å¤ï¼Œéœ€è¦åº”ç”¨ç«¯å¹‚ç­‰ å¯é€šè¿‡ ACK/NACK æ§åˆ¶ é»˜è®¤å¯èƒ½é‡å¤ï¼ŒConsumer éœ€å¹‚ç­‰å¤„ç† æ¶ˆæ¯é¡ºåº æŒ‰ Stream ID é¡ºåºï¼Œå¯ä¿è¯åˆ†ç»„å†…é¡ºåº é˜Ÿåˆ—é¡ºåºä¿è¯ Partition å†…é¡ºåºä¿è¯ æ¶ˆæ¯ä¿ç•™ç­–ç•¥ å¯é…ç½® maxlen / minidï¼ŒæŒ‰æ—¶é—´æˆ–é•¿åº¦è£å‰ª é˜Ÿåˆ—é•¿åº¦ / TTL æ§åˆ¶ åŸºäºæ—¶é—´æˆ–å¤§å°ä¿ç•™ï¼ˆRetention Policyï¼‰ å»¶æ—¶/å®šæ—¶æ¶ˆè´¹ åŸç”Ÿä¸æ”¯æŒå»¶æ—¶é˜Ÿåˆ—ï¼Œéœ€è¦åº”ç”¨ç«¯å¤„ç† æ”¯æŒæ’ä»¶æˆ– TTL åŸç”Ÿä¸æ”¯æŒï¼Œéœ€è¦åº”ç”¨ç«¯å¤„ç†æˆ– Kafka Streams äº‹åŠ¡ä¸åŸå­æ“ä½œ äº‹åŠ¡å¯ç”¨ MULTI/EXECï¼ŒXADD æ”¯æŒ NOMKSTREAM ç­‰é€‰é¡¹ åŸç”Ÿäº‹åŠ¡æ”¯æŒï¼ˆäº‹åŠ¡ / confirm æ¨¡å¼ï¼‰ ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¾èµ–å¹‚ç­‰ç”Ÿäº§è€… æ€§èƒ½ å†…å­˜çº§é«˜ååï¼ŒæŒä¹…åŒ–ä¼šæœ‰å¼€é”€ ä¸­ç­‰ï¼Œå—ç£ç›˜å’Œç½‘ç»œé™åˆ¶ é«˜ååï¼Œé¡ºåºå†™å…¥ç£ç›˜æ•ˆç‡æé«˜ å…¸å‹ä½¿ç”¨åœºæ™¯ äº‹ä»¶æ—¥å¿—ã€è½»é‡ MQã€å†…éƒ¨å¼‚æ­¥æµæ°´çº¿ ä¼ä¸šçº§æ¶ˆæ¯ã€ä»»åŠ¡è°ƒåº¦ã€RPC å¤§æ•°æ®ç®¡é“ã€æ—¥å¿—æ”¶é›†ã€æµå¤„ç† å¤šè¯­è¨€æ”¯æŒ å®¢æˆ·ç«¯æ”¯æŒå¤šç§è¯­è¨€ï¼ˆJavaã€Pythonã€Go ç­‰ï¼‰ å®¢æˆ·ç«¯ä¸°å¯Œ å®¢æˆ·ç«¯ä¸°å¯Œ æ˜“è¿ç»´æ€§ å•èŠ‚ç‚¹å³å¯ä½¿ç”¨ï¼Œä½†æŒä¹…åŒ–éœ€å…³æ³¨å†…å­˜ é›†ç¾¤è¾ƒå¤æ‚ï¼Œéœ€è¦ RabbitMQ é›†ç¾¤ é›†ç¾¤å¤æ‚åº¦é«˜ï¼Œéœ€è¦ ZooKeeper æˆ– KRaft åº•å±‚æ ¸å¿ƒå®ç° å­˜å‚¨ç»“æ„ï¼šæ ¸å¿ƒæ˜¯åŸºæ•°æ ‘ï¼ˆRadix Treeï¼‰+ åŒå‘é“¾è¡¨ï¼ŒåŸºæ•°æ ‘å­˜ã€Œæ¶ˆæ¯IDâ†’æ¶ˆæ¯å†…å®¹ã€çš„æ˜ å°„ï¼ŒåŒå‘é“¾è¡¨æŒ‰æ¶ˆæ¯IDæœ‰åºä¸²è”æ‰€æœ‰æ¶ˆæ¯ï¼Œä¿è¯å†™å…¥å’ŒæŒ‰IDæŸ¥è¯¢çš„é«˜æ•ˆæ€§ï¼ˆO(logN)ï¼‰ã€‚ æ¶ˆæ¯IDï¼šé»˜è®¤è‡ªåŠ¨ç”Ÿæˆï¼Œæ ¼å¼ä¸ºæ—¶é—´æˆ³-åºåˆ—å·ï¼ˆå¦‚1734567890000-0ï¼‰ï¼Œæ—¶é—´æˆ³æ˜¯æ¯«ç§’çº§ï¼Œåºåˆ—å·è§£å†³åŒä¸€æ¯«ç§’å¤šæ¶ˆæ¯çš„æœ‰åºé—®é¢˜ï¼›ä¹Ÿæ”¯æŒæ‰‹åŠ¨æŒ‡å®šï¼Œéœ€æ»¡è¶³ä¸¥æ ¼é€’å¢ï¼Œå¦åˆ™å†™å…¥å¤±è´¥ã€‚ æŒä¹…åŒ–ï¼šå’Œ Redis å…¶ä»–æ•°æ®ç»“æ„ä¸€è‡´ï¼Œä¾èµ– RDB/AOF æŒä¹…åŒ–ï¼Œæ¶ˆæ¯å†™å…¥åä¼šè½ç›˜ï¼Œé‡å¯åä¸ä¸¢å¤±ï¼Œè¿™æ˜¯ Pub/Sub ä¸å…·å¤‡çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚ æ ¸å¿ƒå…ƒæ•°æ®ï¼šæ¯ä¸ª Stream ä¼šç»´æŠ¤last-idï¼ˆæœ€æ–°æ¶ˆæ¯IDï¼‰ã€groupsï¼ˆæ¶ˆè´¹ç»„åˆ—è¡¨ï¼‰ã€entriesï¼ˆæ¶ˆæ¯å®ä½“ï¼‰ä¸‰ç±»å…ƒæ•°æ®ï¼Œæ¶ˆè´¹ç»„çš„å…ƒæ•°æ®ç‹¬ç«‹å­˜å‚¨ï¼Œäº’ä¸å¹²æ‰°ã€‚ Stream æ ¸å¿ƒåŸºç¡€æ“ä½œï¼ˆå¿…ç”¨ï¼‰ 1. ç”Ÿäº§æ¶ˆæ¯ï¼ˆXADDï¼‰ï¼šå†™å…¥é˜Ÿåˆ— â€¢ æ ¸å¿ƒå‘½ä»¤ï¼šXADD key ID å­—æ®µ1 å€¼1 å­—æ®µ2 å€¼2 ...ï¼ŒID å†™*è¡¨ç¤ºè‡ªåŠ¨ç”Ÿæˆï¼ˆç”Ÿäº§é¦–é€‰ï¼‰ 12345678910111213141516171819202122XADD key [NOMKSTREAM] [MAXLEN | MINID [= | ~] threshold [LIMIT count]] * | id field value [field value ...]# å‚æ•°è§£é‡Š# key: Stream åç§°# NOMKSTREAM: ä¸è‡ªåŠ¨åˆ›å»º Streamï¼Œè‹¥ key ä¸å­˜åœ¨ â†’ å‘½ä»¤ç›´æ¥å¤±è´¥# MAXLEN threshold â€”â€” æŒ‰é•¿åº¦è£å‰ª# MAXLEN 1000: Stream æœ€å¤šä¿ç•™ 1000 æ¡æ¶ˆæ¯ï¼Œè¶…å‡ºéƒ¨åˆ†ä¼šè¢«åˆ é™¤ï¼ˆä»æœ€æ—§å¼€å§‹ï¼‰# MAXLEN = 1000: ç²¾ç¡®è£å‰ªï¼Œä¸¥æ ¼ä¿è¯é•¿åº¦ â‰¤ 1000ï¼Œæ¯æ¬¡å†™å…¥éƒ½ä¼šæ£€æŸ¥å¹¶è£å‰ªï¼Œæ€§èƒ½å¼€é”€è¾ƒå¤§# MAXLEN ~ 1000ï¼ˆæ¨èï¼‰: è¿‘ä¼¼è£å‰ªï¼Œå…è®¸ Stream é•¿åº¦ ç•¥å¾®è¶…è¿‡é˜ˆå€¼ï¼ŒRedis åœ¨å†…éƒ¨æ‰¹é‡è£å‰ªï¼Œå†™å…¥æ€§èƒ½æ›´é«˜# LIMIT count â€”â€” æ¯æ¬¡æœ€å¤šè£å‰ªå¤šå°‘æ¡# MAXLEN ~ 1000 LIMIT 100: å•æ¬¡å†™å…¥ æœ€å¤šåˆ é™¤ 100 æ¡æ—§æ¶ˆæ¯ï¼Œé˜²æ­¢ä¸€æ¬¡è£å‰ªé˜»å¡ Redis ä¸»çº¿ç¨‹# MINID threshold â€”â€” æŒ‰ ID è£å‰ªï¼ˆRedis â‰¥ 6.2ï¼‰# MINID ~ 1670000000000-0: åˆ é™¤ ID å°äº threshold çš„æ¶ˆæ¯ï¼Œæ›´é€‚åˆ æ—¶é—´çª—å£å‹ä¿ç•™ç­–ç•¥# * | id â€”â€” æ¶ˆæ¯ ID# *: è‡ªåŠ¨ç”Ÿæˆ IDï¼ˆ99% åœºæ™¯ï¼‰ï¼Œæ ¼å¼ï¼š&lt;æ¯«ç§’æ—¶é—´æˆ³&gt;-&lt;åºå·&gt;ï¼Œå•è°ƒé€’å¢ï¼Œå…¨å±€æœ‰åºï¼Œæ¶ˆè´¹è€…ç»„ä¾èµ–å®ƒè¿›è¡Œ offset ç®¡ç†# id: æŒ‡å®šIDï¼ˆä¸å¸¸ç”¨ï¼‰ï¼ŒID å¿…é¡»ä¸¥æ ¼å¤§äº Stream ä¸­æœ€å¤§ IDï¼Œå¦åˆ™å†™å…¥å¤±è´¥# field value â€”â€” æ¶ˆæ¯ä½“ï¼ˆPayloadï¼‰# è‡³å°‘ä¸€å¯¹ field-valueï¼Œfield / value éƒ½æ˜¯ Binary Safeï¼Œæœ¬è´¨ç±»ä¼¼ Hashï¼Œä½†ä¸å¯ä¿®æ”¹ â€¢ ç¤ºä¾‹ 1234567# å‘è®¢å•é˜Ÿåˆ—å†™å…¥1æ¡æ¶ˆæ¯ï¼Œè‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯IDXADD order_stream * uid 1001 order_no ORD20251220 price 299## è¾“å‡º&quot;1766215406540-0&quot; # æ¶ˆæ¯ID# ä¿ç•™æŸä¸ªæ—¶é—´ç‚¹ä¹‹åçš„æ—¥å¿—XADD log MINID ~ 1689900000000-0 * level INFO msg &quot;startup&quot; 2. æ¶ˆè´¹æ¶ˆæ¯ï¼ˆ2ç§æ ¸å¿ƒæ¨¡å¼ï¼‰ ï¼ˆ1ï¼‰ ç‹¬ç«‹æ¶ˆè´¹ï¼ˆæ— æ¶ˆè´¹ç»„ï¼‰ï¼šä¸€å¯¹ä¸€æ¶ˆè´¹ï¼Œé€‚åˆç®€å•åœºæ™¯ â€¢ XREADï¼šä¸»åŠ¨æ‹‰å–æ¶ˆæ¯ï¼Œæ”¯æŒé˜»å¡/éé˜»å¡ 12345678910111213XREAD [COUNT count] [BLOCK milliseconds] STREAMS key [key ...] id [id ...]# å‚æ•°è§£é‡Š# COUNT count â€”â€” å•æ¬¡æœ€å¤šè¯»å–å¤šå°‘æ¡ï¼Œæ˜¯â€œä¸Šé™â€ï¼Œä¸æ˜¯ä¿è¯å€¼# BLOCK milliseconds â€”â€” é˜»å¡ç­‰å¾…æ–°æ¶ˆæ¯ï¼Œé˜»å¡æœŸé—´ ä¸ä¼šå ç”¨ CPUï¼Œè¶…æ—¶è¿”å› nil# BLOCK 0: æ— é™é˜»å¡ï¼Œç›´åˆ°æœ‰æ–°æ¶ˆæ¯# STREAMS key [key ...] â€”â€” æŒ‡å®šè¯»å–çš„ Streamï¼Œkey ä¸ id ä¸€ä¸€å¯¹åº”# id [id ...] â€”â€” ä»å“ªä¸ªä½ç½®å¼€å§‹è¯»ï¼Œè¯»å– ID å¤§äºè¯¥å€¼çš„æ¶ˆæ¯ï¼Œä¸åŒ…å« è¯¥ ID æœ¬èº«# æ™®é€š IDï¼ˆæ¸¸æ ‡è¯­ä¹‰ï¼‰: XREAD STREAMS mystream 1689999999999-0# $: åªå…³å¿ƒâ€œå°†æ¥â€çš„æ¶ˆæ¯ï¼Œä» å½“å‰ Stream çš„æœ«å°¾ä¹‹å å¼€å§‹è¯»ï¼Œå†å²æ¶ˆæ¯å…¨éƒ¨å¿½ç•¥: XREAD BLOCK 0 STREAMS mystream $ â€¢ ç¤ºä¾‹1ï¼ˆéé˜»å¡ï¼‰ 1234567891011# ä»å¼€å¤´æ‹‰5æ¡æ¶ˆæ¯XREAD COUNT 5 STREAMS order_stream 0-0# è¾“å‡º1) 1) &quot;order_stream&quot; # Streamåç§° 2) 1) 1) &quot;1766215406540-0&quot; # æ¶ˆæ¯ID 2) 1) &quot;uid&quot; # æ¶ˆæ¯ä½“ é”®å€¼å¯¹ 2) &quot;1001&quot; 3) &quot;order_no&quot; 4) &quot;ORD20251220&quot; 5) &quot;price&quot; 6) &quot;299&quot; â€¢ ç¤ºä¾‹2ï¼ˆé˜»å¡ï¼‰ 12# $è¡¨ç¤ºä»æœ€æ–°æ¶ˆæ¯å¼€å§‹æ‹‰ï¼Œé˜»å¡3ç§’ï¼Œæœ‰æ–°æ¶ˆæ¯ç«‹å³è¿”å›ï¼Œæ— åˆ™3ç§’åè¶…æ—¶ï¼Œæ˜¯ç”Ÿäº§å¸¸ç”¨å†™æ³•ã€‚XREAD COUNT 5 BLOCK 3000 STREAMS order_stream $ ï¼ˆ2ï¼‰ æ¶ˆè´¹ç»„æ¶ˆè´¹ï¼ˆXGROUPï¼‰ï¼šä¸€å¯¹å¤šæ¶ˆè´¹ï¼Œæ ¸å¿ƒç”Ÿäº§æ¨¡å¼ Stream æœ€æ ¸å¿ƒçš„ä»·å€¼å°±æ˜¯æ¶ˆè´¹ç»„ï¼Œæ”¯æŒå¤šæ¶ˆè´¹è€…ååŒæ¶ˆè´¹ã€æ¶ˆæ¯ç¡®è®¤ã€æœªæ¶ˆè´¹æ¶ˆæ¯è¿½æº¯ï¼Œè§£å†³äº†åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„æ¶ˆæ¯åˆ†ç‰‡ä¸è´Ÿè½½å‡è¡¡é—®é¢˜ã€‚ å…ˆåˆ›å»ºæ¶ˆè´¹ç»„XGROUP CREATE 1234567891011121314XGROUP CREATE key group id|$ [MKSTREAM] [ENTRIESREAD entries-read]# å‚æ•°è§£é‡Š# keyï¼šStream åç§°ï¼Œä¸ºæŒ‡å®šçš„Streamåˆ›å»ºæ¶ˆè´¹ç»„# group: æ¶ˆè´¹ç»„åç§°ï¼Œæ¶ˆè´¹è€…ç»„çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸€ä¸ª Stream å¯ä»¥æœ‰ å¤šä¸ª consumer group# id | $ â€”â€” å…³é”®å‚æ•°ï¼šæ¶ˆè´¹èµ·å§‹ä½ç‚¹ï¼ˆoffsetï¼‰ï¼Œ$è¡¨ç¤ºä»å½“å‰æœ€æ–°æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ï¼Œç”¨0-0è¡¨ç¤ºä»é˜Ÿåˆ—å¼€å¤´æ¶ˆè´¹ã€‚# [MKSTREAM] â€”â€” è‡ªåŠ¨åˆ›å»º Streamï¼Œå¦‚æœæŒ‡å®šçš„keyä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºï¼Œæ¨èåœ¨è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸­ä½¿ç”¨# [ENTRIESREAD entries-read] â€”â€” è®¾ç½®â€œå·²è¯»å–æ¡æ•°â€ï¼ˆé«˜çº§å‚æ•°ï¼‰ï¼Œä¸€èˆ¬ä¸šåŠ¡ä¸éœ€è¦ä½¿ç”¨ï¼Œä¸»è¦ç”¨äºæ‰‹åŠ¨æ¢å¤groupã€æ•°æ®è¿ç§»ç­‰åœºæ™¯# ç¤ºä¾‹ï¼šåˆ›å»ºgroup1æ¶ˆè´¹ç»„ï¼Œä»æœ€æ–°è®¢å•æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹XGROUP CREATE order_stream group1 $ MKSTREAM# è¾“å‡ºOK æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯XREADGROUP 123456789101112131415161718192021222324252627282930313233XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] id [id ...]# å‚æ•°è§£é‡Š# GROUP group consumer: æŒ‡å®šæ¶ˆè´¹è€…ç»„åï¼šgroupï¼Œæ¶ˆè´¹è€…åï¼šconsumer# åŒä¸€ä¸ª group ä¸‹ï¼Œä¸åŒ consumer ä¸ä¼šæ”¶åˆ°é‡å¤æ¶ˆæ¯# [COUNT count] â€”â€” å•æ¬¡æœ€å¤šè¿”å›æ¡æ•°ï¼Œæ˜¯è½¯é™åˆ¶ï¼Œä¸æ˜¯ä¸¥æ ¼ä¿è¯# [BLOCK milliseconds] â€”â€” é˜»å¡ç­‰å¾…æ–°æ¶ˆæ¯ï¼Œæœ€å¤šé˜»å¡ milliseconds æ¯«ç§’# BLOCK 0 â†’ æ°¸ä¹…é˜»å¡# [NOACK] â€”â€” ä¸è¿›å…¥ Pendingï¼ˆâš ï¸ è°¨æ…ï¼‰# æ¶ˆæ¯ ä¸ä¼šè¿›å…¥ Pendingï¼Œä¸éœ€è¦ XACKï¼Œæ¶ˆè´¹åå³è®¤ä¸ºå®Œæˆ# é£é™©ï¼šæ¶ˆè´¹è€…å´©æºƒ â†’ æ¶ˆæ¯ç›´æ¥ä¸¢å¤±ï¼Œä¸å¯é‡æŠ•é€’# STREAMS key [key ...]: æŒ‡å®šè¦è¯»å–çš„ Streamï¼ˆæ”¯æŒå¤šä¸ªï¼‰ï¼Œkey é¡ºåºéœ€ä¸åç»­ id é¡ºåºä¸€è‡´# id [id ...] â€”â€” å†³å®šâ€œè¯»ä»€ä¹ˆâ€çš„å…³é”®# ä½¿ç”¨ &gt; â€”â€” è¯»å–â€œæ–°æ¶ˆæ¯â€ï¼ˆâœ… ç”Ÿäº§ç¯å¢ƒ 99% ä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰ï¼Œä»æœªæŠ•é€’ç»™ä»»ä½• consumer çš„æ–°æ¶ˆæ¯# ä½¿ç”¨ 0/å…·ä½“ID â€”â€” é‡è¯» Pendingï¼ˆè¡¥å¿ï¼‰ï¼Œè¯»å– å·²æŠ•é€’ä½†æœª ACK çš„æ¶ˆæ¯# å¤š Stream åœºæ™¯: STREAMS stream1 stream2 &gt; &gt;ï¼Œæ¯ä¸ª stream å¿…é¡»æœ‰ä¸€ä¸ªå¯¹åº” id# ç¤ºä¾‹ï¼šconsumerA ä»group1æ‹‰3æ¡æœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œé˜»å¡5ç§’ã€‚XREADGROUP GROUP group1 consumerA COUNT 3 BLOCK 5000 STREAMS order_stream &gt;## æ­¤æ—¶åœ¨5ç§’å†…åˆ›å»ºæ–°çš„æ¶ˆæ¯ï¼Œå°±ä¼šæœ‰ç±»ä¼¼å¦‚ä¸‹è¾“å‡º1) 1) &quot;order_stream&quot; 2) 1) 1) &quot;1766215642763-0&quot; 2) 1) &quot;uid&quot; 2) &quot;1001&quot; 3) &quot;order_no&quot; 4) &quot;ORD20251220&quot; 5) &quot;price&quot; 6) &quot;299&quot;(1.50s) 3. æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰ æ¶ˆè´¹å®Œæˆåå¿…é¡»ç¡®è®¤ï¼Œå¦åˆ™ä¼šè¢«æ ‡è®°ä¸ºã€Œæœªç¡®è®¤æ¶ˆæ¯ã€ 12345# XACK key æ¶ˆè´¹ç»„å æ¶ˆæ¯ID1 æ¶ˆæ¯ID2 ...ã€‚XACK key group id [id ...]# ç¤ºä¾‹: ç¡®è®¤2æ¡æ¶ˆæ¯æ¶ˆè´¹å®Œæˆï¼ŒStream ä¼šåˆ é™¤è¯¥æ¶ˆæ¯çš„æœªç¡®è®¤æ ‡è®°XACK order_stream group1 1734567890000-0 1734567890001-0 4. æ¶ˆæ¯é‡è¯• æœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œä¼šè¢«å­˜å…¥æ¶ˆè´¹ç»„çš„ã€ŒPELï¼ˆPending Entries Listï¼‰ã€ï¼Œå¯é€šè¿‡XPENDING key æ¶ˆè´¹ç»„åæŸ¥çœ‹ï¼Œæ”¯æŒXCLAIMå°†PELä¸­çš„æ¶ˆæ¯è½¬ç§»ç»™å…¶ä»–æ¶ˆè´¹è€…å¤„ç†ï¼Œé¿å…å•ç‚¹æ•…éšœå¯¼è‡´æ¶ˆæ¯å †ç§¯ã€‚ XPENDINGï¼šæŸ¥çœ‹æœªè¢«ç¡®è®¤çš„æ¶ˆæ¯æƒ…å†µ 123456789101112131415161718192021222324252627282930313233343536XPENDING key group [[IDLE min-idle-time] start end count [consumer]]# å‚æ•°è§£é‡Š# key: Stream åç§°ï¼Œå¿…é¡»å­˜åœ¨# group: æ¶ˆè´¹è€…ç»„åç§°ï¼Œå¿…é¡»å­˜åœ¨# [IDLE min-idle-time]ï¼ˆRedis â‰¥ 6.2ï¼‰: ä»…è¿”å› ç©ºé—²æ—¶é—´ â‰¥ min-idle-timeï¼ˆæ¯«ç§’ï¼‰ çš„ Pending æ¶ˆæ¯# min-idle-time(ç©ºé—²æ—¶é—´) = ä»ä¸Šæ¬¡æŠ•é€’ / claimåˆ°ç°åœ¨# start end â€”â€” ID èŒƒå›´# -: æœ€å°ID# +: æœ€å¤§ID# count â€”â€” è¿”å›æ¡æ•°ä¸Šé™# [consumer]ï¼ˆå¯é€‰ï¼‰: åªæŸ¥çœ‹æŸä¸€ä¸ª consumer çš„ Pendingï¼Œä¸æŒ‡å®šåˆ™æŸ¥çœ‹ group å†…å…¨éƒ¨# åªè¿”å› å…ƒæ•°æ®ï¼Œä¸è¿”å›æ¶ˆæ¯å†…å®¹# ç¤ºä¾‹1: æŸ¥çœ‹æ˜¯å¦æœ‰æ¶ˆæ¯ç§¯å‹XPENDING order_stream group1## è¾“å‡º1) (integer) 1 # ç§¯å‹æ¶ˆæ¯æ•°ï¼Œæœªç¡®è®¤æ¶ˆæ¯æ•°é‡2) &quot;1766215642763-0&quot; # Pending ä¸­æœ€å° ID3) &quot;1766215642763-0&quot; # Pending ä¸­æœ€å¤§ ID4) 1) 1) &quot;consumerA&quot; # æŒ‰ consumer ç»Ÿè®¡çš„ Pending æ•°é‡ 2) &quot;1&quot;# ç¤ºä¾‹2: æŸ¥æ‰¾ idle è¶…è¿‡ 1 åˆ†é’Ÿçš„æ¶ˆæ¯ï¼Œæœ€å¤šè¿”å›10æ¡XPENDING order_stream group1 IDLE 60000 - + 10## è¾“å‡º1) 1) &quot;1766215642763-0&quot; # æ¶ˆæ¯ ID 2) &quot;consumerA&quot; # å½“å‰æŒæœ‰è¯¥æ¶ˆæ¯çš„ consumer 3) (integer) 255581 # idle æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ 4) (integer) 2 # delivery countï¼ˆæŠ•é€’æ¬¡æ•°ï¼‰,è¯¥æ¶ˆæ¯è‡³å°‘è¢«æŠ•é€’è¿‡ 2 æ¬¡# ç¤ºä¾‹3: åªæŸ¥çœ‹ consumerA çš„ Pendingï¼Œæœ€å¤šè¿”å›20æ¡XPENDING order_stream group1 - + 20 consumerA XCLAIM: è½¬ç§»æŠ•é€’ å°†å·²ç»æŠ•é€’ä½†æœª ACKã€ä¸” idle è¶…è¿‡é˜ˆå€¼çš„ Pending æ¶ˆæ¯ï¼Œä»åŸ consumer æ‰‹ä¸­â€œæŠ¢å â€ç»™æ–°çš„ consumerï¼Œå¹¶é‡æ–°æŠ•é€’ã€‚ ä¸€æ—¦æŠ¢å æˆåŠŸï¼ŒåŸ consumer å°±ä¸åœ¨æ‹¥æœ‰è¯¥æ¶ˆæ¯çš„ Pending è®°å½• 12345678910111213141516171819202122232425262728293031323334353637XCLAIM key group consumer min-idle-time id [id ...] [IDLE ms] [TIME unix-time-milliseconds] [RETRYCOUNT count] [FORCE] [JUSTID] [LASTID lastid]# å‚æ•°è§£é‡Š# key: Stream Keyï¼Œå¿…é¡»å­˜åœ¨# group: æ¶ˆè´¹è€…ç»„åç§°ï¼Œå¿…é¡»å­˜åœ¨# consumer: æ–°çš„æ¶ˆè´¹è€…ï¼ŒæŠ¢å åçš„ Pending æ¶ˆæ¯å°†å½’å±è¯¥ consumer# min-idle-time: ç©ºé—²æ—¶é—´ï¼Œåªæœ‰ idle â‰¥ min-idle-time çš„ Pending æ¶ˆæ¯æ‰å…è®¸è¢« claim# id [id ...]: æŒ‡å®šè¦ claim çš„æ¶ˆæ¯ IDï¼ŒIDå¿…é¡»å­˜åœ¨# [IDLE ms]: äººä¸ºè®¾ç½® idle æ—¶é—´ï¼Œè¦†ç›– Redis å†…éƒ¨è®¡ç®—çš„ idleï¼Œæ¯”å¦‚å¼ºåˆ¶åˆ¶é€ â€œå·²è¶…æ—¶â€çŠ¶æ€# [TIME unix-time-milliseconds]: æ‰‹åŠ¨æŒ‡å®šâ€œæœ€åæŠ•é€’æ—¶é—´â€ï¼Œä¸ IDLE äºŒé€‰ä¸€ä½¿ç”¨ï¼Œæå°‘è§äºä¸šåŠ¡ä»£ç # [RETRYCOUNT count]: æ‰‹åŠ¨è®¾ç½® delivery countï¼Œå®ç°â€œæœ€å¤šé‡è¯• N æ¬¡ï¼Œè¶…è¿‡è¿›æ­»ä¿¡é˜Ÿåˆ—â€# [FORCE]: å¼ºåˆ¶ claim ä¸å­˜åœ¨äº Pending çš„æ¶ˆæ¯ï¼Œâš ï¸ é«˜é£é™©# [JUSTID]: åªè¿”å› æ¶ˆæ¯ IDï¼Œä¸è¿”å›æ¶ˆæ¯ä½“ï¼ˆfield/valueï¼‰ï¼Œå‡å°‘ç½‘ç»œå¼€é”€# [LASTID lastid]ï¼ˆRedis â‰¥ 7.0ï¼‰: æ›´æ–° consumer group çš„ last-delivered-idï¼Œå½±å“åç»­ XREADGROUP &gt; çš„è¡Œä¸º# âš ï¸ é«˜çº§ç‰¹æ€§ï¼Œä¸€èˆ¬ä¸å»ºè®®ä¸šåŠ¡ä»£ç ä½¿ç”¨# ç¤ºä¾‹ï¼š# 1ï¸âƒ£ æŠ¢å  idle è¶…è¿‡ 60s çš„æ¶ˆæ¯XCLAIM order_stream group1 consumerB 60000 1766215642763-0# è¾“å‡º1) 1) &quot;1766215642763-0&quot; 2) 1) &quot;uid&quot; 2) &quot;1001&quot; 3) &quot;order_no&quot; 4) &quot;ORD20251220&quot; 5) &quot;price&quot; 6) &quot;299&quot;# 2ï¸âƒ£ æŠ¢å å¹¶æ ‡è®°ä¸ºç¬¬ 3 æ¬¡é‡è¯•XCLAIM orders order-group consumerB 60000 1766215642763-0 RETRYCOUNT 3# 3ï¸âƒ£ åªè¿”å› IDï¼ˆé…åˆæ‰¹å¤„ç†ï¼‰XCLAIM orders order-group consumerB 60000 1766215642763-0 JUSTID é«˜çº§ç‰¹æ€§ï¼ˆç”Ÿäº§å¿…å¤‡ï¼‰ æ¶ˆæ¯å›æº¯ä¸éå† 1234567# XRANGE key èµ·å§‹ID ç»“æŸID [COUNT æ¡æ•°]ï¼ˆæ­£å‘éå†ï¼‰XRANGE key start end [COUNT count]# XREVRANGE key ç»“æŸID èµ·å§‹ID [COUNT æ¡æ•°]ï¼ˆåå‘éå†ï¼‰XREVRANGE key end start [COUNT count]# ç¤ºä¾‹: 0-0:æœ€å°çš„æ¶ˆæ¯IDï¼Œç­‰åŒäº -ï¼Œ+:è¡¨ç¤ºæœ€æ–°æ¶ˆæ¯ï¼Œé€‚åˆæ•°æ®å¯¹è´¦ã€å†å²æ¶ˆæ¯æŸ¥è¯¢ã€‚XRANGE order_stream 0-0 + COUNT 10XRANGE order_stream - + COUNT 10 é˜Ÿåˆ—ä¿¡æ¯æŸ¥è¯¢ 1234567891011121314151617181920# æŸ¥æ¶ˆæ¯æ€»æ•°XLEN key# æŸ¥Streamå®Œæ•´å…ƒæ•°æ®ï¼ˆæœ€æ–°IDã€æ¶ˆè´¹ç»„æ•°é‡ã€æ¶ˆæ¯æ€»æ•°ç­‰ï¼‰XINFO STREAM key [FULL [COUNT count]]## FULL: å®Œæ•´æ¨¡å¼ # ğŸ‘‰ è¿”å›ï¼š # Stream å…ƒä¿¡æ¯ # æ‰€æœ‰ Consumer Group # æ¯ä¸ª Group çš„ Consumer # Pending Entries Listï¼ˆPELï¼‰ # éƒ¨åˆ†å†å² entries # âš ï¸ å¼€é”€å¾ˆå¤§ï¼Œæ…ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚## COUNT countï¼ˆFULL æ¨¡å¼çš„é™åˆ¶å‚æ•°ï¼‰ # XINFO STREAM key FULL COUNT 10: é™åˆ¶è¿”å›çš„entries æ•°é‡ä»¥åŠæ¯ä¸ª group / consumer çš„ PEL è®°å½•æ•°é‡# æŸ¥æ‰€æœ‰æ¶ˆè´¹ç»„ä¿¡æ¯XINFO GROUPS key# æŸ¥è¯¥ç»„ä¸‹æ‰€æœ‰æ¶ˆè´¹è€…XINFO CONSUMERS key æ¶ˆè´¹ç»„å æ¶ˆè´¹ç»„ç®¡ç† 123456# åˆ é™¤æ¶ˆè´¹ç»„XGROUP DESTROY key æ¶ˆè´¹ç»„å# åˆ é™¤æ¶ˆè´¹è€…XGROUP DELCONSUMER key æ¶ˆè´¹ç»„å æ¶ˆè´¹è€…å# é‡ç½®æ¶ˆè´¹ç»„èµ·å§‹IDXGROUP SETID key æ¶ˆè´¹ç»„å æ–°ID æƒ°æ€§åˆ é™¤ï¼šStream ä¸ä¼šä¸»åŠ¨åˆ é™¤å·²ç¡®è®¤çš„æ¶ˆæ¯ï¼Œä»…é MAXLENæ·˜æ±°ï¼Œè‹¥éœ€ä¸»åŠ¨æ¸…ç†å†å²æ¶ˆæ¯ï¼Œç›´æ¥ç”¨XADDçš„MAXLENå‚æ•°å³å¯ï¼Œæ— éœ€é¢å¤–å‘½ä»¤ã€‚ ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒç—›ç‚¹ä¸è§£å†³æ–¹æ¡ˆ æ¶ˆæ¯ä¸¢å¤±ï¼š3é‡ä¿éšœ å¼€å¯ Redis AOF æŒä¹…åŒ–ï¼ˆè®¾ä¸ºeverysecï¼Œå…¼é¡¾æ€§èƒ½ä¸å¯é æ€§ï¼‰ ç”Ÿäº§è€…å†™å…¥åç¡®è®¤è¿”å›å€¼ï¼ˆç¡®ä¿å†™å…¥æˆåŠŸï¼‰ æ¶ˆè´¹è€…æ¶ˆè´¹åå¿…é¡»XACKç¡®è®¤ã€‚ æ¶ˆæ¯å †ç§¯ï¼š2ç§å¤„ç† â‘  å†™å…¥æ—¶ç”¨MAXLENè®¾ç½®ä¸Šé™ï¼Œæ·˜æ±°æ—§æ¶ˆæ¯ï¼› â‘¡ æ¶ˆè´¹ç«¯æ‰©å®¹æ¶ˆè´¹è€…å®ä¾‹ï¼Œæ¶ˆè´¹ç»„ä¼šè‡ªåŠ¨å°†æœªæ¶ˆè´¹æ¶ˆæ¯åˆ†ç‰‡ç»™å¤šä¸ªæ¶ˆè´¹è€…ï¼Œå®ç°å¹¶è¡Œæ¶ˆè´¹ã€‚ é‡å¤æ¶ˆè´¹ æ ¹æº: ç½‘ç»œæŠ–åŠ¨ï¼ˆæ¶ˆè´¹è€…ç¡®è®¤æ¶ˆæ¯å‰æ–­å¼€è¿æ¥ï¼Œæ¶ˆæ¯é‡å›PELï¼‰ è§£å†³æ–¹æ¡ˆ: æ¶ˆæ¯å¹‚ç­‰æ€§ï¼ˆç”Ÿäº§è€…ç»™æ¶ˆæ¯åŠ å”¯ä¸€æ ‡è¯†ï¼Œæ¶ˆè´¹è€…æ ¹æ®å”¯ä¸€æ ‡è¯†å»é‡ï¼‰ã€‚ é˜»å¡è¶…æ—¶ï¼šæ¶ˆè´¹ç«¯ç”¨BLOCKé˜»å¡æ‹‰å–ï¼Œè¶…æ—¶æ—¶é—´å»ºè®®è®¾ä¸º3-5ç§’ï¼Œé¿å…é¢‘ç¹ç©ºè½®è¯¢å ç”¨CPUï¼ŒåŒæ—¶ä¿è¯æ–°æ¶ˆæ¯çš„å“åº”é€Ÿåº¦ã€‚ å…¸å‹åº”ç”¨åœºæ™¯ åˆ†å¸ƒå¼ä¸šåŠ¡è§£è€¦ï¼ˆè®¢å•-åº“å­˜-æ”¯ä»˜-ç‰©æµè§£è€¦ï¼‰ æ ¸å¿ƒæ€è·¯ï¼šå• Stream å¯¹åº”æ ¸å¿ƒä¸šåŠ¡ï¼ˆè®¢å•ï¼‰ï¼Œåº“å­˜ã€æ”¯ä»˜ã€ç‰©æµå„åˆ›å»ºç‹¬ç«‹æ¶ˆè´¹ç»„ï¼Œå„è‡ªæ¶ˆè´¹äº’ä¸å¹²æ‰°ï¼Œå®ç°ä¸šåŠ¡è§£è€¦ã€‚ ç”Ÿäº§è€…ï¼ˆè®¢å•æœåŠ¡ï¼‰ï¼šå†™å…¥è®¢å•å®Œæˆæ¶ˆæ¯ 12# è‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯IDï¼Œå†™å…¥è®¢å•æ ¸å¿ƒä¿¡æ¯ï¼Œè®¾ç½®é˜Ÿåˆ—æœ€å¤§1ä¸‡æ¡æ¶ˆæ¯ï¼ˆè¿‘ä¼¼æ·˜æ±°ï¼‰XADD order_core_stream * MAXLEN ~ 10000 order_no ORD20251220001 uid 1001 amount 299 status created create_time 1734567890 åˆ›å»º3ä¸ªç‹¬ç«‹æ¶ˆè´¹ç»„ï¼ˆåº“å­˜/æ”¯ä»˜/ç‰©æµï¼‰ 123456# åº“å­˜æ¶ˆè´¹ç»„ï¼šä»æœ€æ–°æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ï¼Œé˜Ÿåˆ—ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºXGROUP CREATE order_core_stream group_stock $ MKSTREAM# æ”¯ä»˜æ¶ˆè´¹ç»„XGROUP CREATE order_core_stream group_pay $ MKSTREAM# ç‰©æµæ¶ˆè´¹ç»„XGROUP CREATE order_core_stream group_logistics $ MKSTREAM å„æ¶ˆè´¹ç»„æ¶ˆè´¹è€…æ‹‰å–+ç¡®è®¤æ¶ˆæ¯ 123456789101112# åº“å­˜æœåŠ¡æ¶ˆè´¹è€…ï¼ˆconsumer_stock1ï¼‰æ‹‰å–3æ¡æœªæ¶ˆè´¹æ¶ˆæ¯ï¼Œé˜»å¡5ç§’XREADGROUP GROUP group_stock consumer_stock1 COUNT 3 BLOCK 5000 STREAMS order_core_stream &gt;# åº“å­˜å¤„ç†å®Œæˆåç¡®è®¤æ¶ˆæ¯ï¼ˆæ›¿æ¢ä¸ºå®é™…æ‹‰å–åˆ°çš„æ¶ˆæ¯IDï¼‰XACK order_core_stream group_stock 1734567890000-0 1734567890001-0# æ”¯ä»˜æœåŠ¡æ¶ˆè´¹è€…ï¼ˆconsumer_pay1ï¼‰åŒç†XREADGROUP GROUP group_pay consumer_pay1 COUNT 3 BLOCK 5000 STREAMS order_core_stream &gt;XACK order_core_stream group_pay 1734567890000-0 1734567890001-0# ç‰©æµæœåŠ¡æ¶ˆè´¹è€…ï¼ˆconsumer_log1ï¼‰åŒç†XREADGROUP GROUP group_logistics consumer_log1 COUNT 3 BLOCK 5000 STREAMS order_core_stream &gt;XACK order_core_stream group_logistics 1734567890000-0 1734567890001-0 å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼ˆç”¨æˆ·æ³¨å†Œ-é‚®ä»¶/çŸ­ä¿¡/ç§¯åˆ†å¼‚æ­¥æ‰§è¡Œï¼‰ æ ¸å¿ƒæ€è·¯ï¼šæ³¨å†Œæ¥å£åªè´Ÿè´£å†™å…¥ Stream æ¶ˆæ¯ï¼Œæ— éœ€ç­‰å¾…åç»­ä»»åŠ¡å®Œæˆï¼Œå•æ¶ˆè´¹ç»„å¤šæ¶ˆè´¹è€…æå‡å¼‚æ­¥ä»»åŠ¡å¤„ç†æ•ˆç‡ï¼Œæ ¸å¿ƒæ˜¯å¿«é€Ÿå“åº”å‰ç«¯ã€‚ ç”Ÿäº§è€…ï¼ˆæ³¨å†ŒæœåŠ¡ï¼‰ï¼šç”¨æˆ·æ³¨å†ŒæˆåŠŸåå†™å…¥æ¶ˆæ¯ 12# å†™å…¥ç”¨æˆ·æ³¨å†Œä¿¡æ¯ï¼ŒMAXLENé™åˆ¶5000æ¡ï¼Œé¿å…ç§¯å‹è¿‡å¤šæ— æ•ˆæ³¨å†Œæ¶ˆæ¯XADD user_register_stream * MAXLEN ~ 5000 uid 1001 username zhangsan phone 13800138000 email zs@xxx.com reg_time 1734567900 åˆ›å»ºå•ä¸ªæ¶ˆè´¹ç»„ï¼ˆç»Ÿä¸€å¤„ç†æ³¨å†Œåç»­ä»»åŠ¡ï¼‰ 1XGROUP CREATE user_register_stream group_reg_task $ MKSTREAM å¤šæ¶ˆè´¹è€…å¹¶è¡Œæ‹‰å–ï¼ˆé‚®ä»¶/çŸ­ä¿¡/ç§¯åˆ†å„1ä¸ªæ¶ˆè´¹è€…ï¼Œæˆ–å¤šå®ä¾‹æ‰©å®¹ï¼‰ 1234567891011# çŸ­ä¿¡å‘é€æ¶ˆè´¹è€…ï¼ˆconsumer_smsï¼‰XREADGROUP GROUP group_reg_task consumer_sms COUNT 5 BLOCK 3000 STREAMS user_register_stream &gt;XACK user_register_stream group_reg_task æ¶ˆæ¯ID1 æ¶ˆæ¯ID2# é‚®ä»¶å‘é€æ¶ˆè´¹è€…ï¼ˆconsumer_emailï¼‰XREADGROUP GROUP group_reg_task consumer_email COUNT 5 BLOCK 3000 STREAMS user_register_stream &gt;XACK user_register_stream group_reg_task æ¶ˆæ¯ID1 æ¶ˆæ¯ID2# ç§¯åˆ†å‘æ”¾æ¶ˆè´¹è€…ï¼ˆconsumer_scoreï¼‰XREADGROUP GROUP group_reg_task consumer_score COUNT 5 BLOCK 3000 STREAMS user_register_stream &gt;XACK user_register_stream group_reg_task æ¶ˆæ¯ID1 æ¶ˆæ¯ID2 æ—¥å¿—æ”¶é›†ï¼ˆç³»ç»Ÿå®æ—¶æ—¥å¿—-åˆ†æ/å‘Šè­¦ï¼‰ æ ¸å¿ƒæ€è·¯ï¼šå„ä¸šåŠ¡ç³»ç»Ÿå®æ—¶å†™å…¥æ—¥å¿—åˆ° Streamï¼Œå¤šæ¶ˆè´¹ç»„åˆ†åˆ«åšæ—¥å¿—åˆ†æã€å®æ—¶å‘Šè­¦ï¼Œå…¼é¡¾å®æ—¶æ€§ä¸æ•°æ®ç•™å­˜ï¼Œæ”¯æŒå†å²æ—¥å¿—å›æº¯ã€‚ ç”Ÿäº§è€…ï¼ˆå„ä¸šåŠ¡ç³»ç»Ÿï¼‰ï¼šå®æ—¶å†™å…¥ç³»ç»Ÿæ—¥å¿—ï¼ˆæŒ‰çº§åˆ«/ä¸šåŠ¡åˆ†ç±»ï¼Œè¿™é‡Œç»Ÿä¸€å†™å…¥æ€»æ—¥å¿—æµï¼‰ 123# å†™å…¥æ—¥å¿—ï¼šåŒ…å«ä¸šåŠ¡æ¨¡å—ã€æ—¥å¿—çº§åˆ«ã€å†…å®¹ã€æ—¶é—´ï¼Œæ— æ¶ˆæ¯æ•°é‡ä¸Šé™ï¼ˆæŒ‰å®é™…æœåŠ¡å™¨å†…å­˜è°ƒæ•´MAXLENï¼‰XADD sys_log_stream * module order_service level ERROR content &quot;åº“å­˜æ‰£å‡å¤±è´¥ï¼Œè®¢å•å·ORD20251220001&quot; log_time 1734567910XADD sys_log_stream * module pay_service level INFO content &quot;æ”¯ä»˜æˆåŠŸï¼Œuid1001ï¼Œé‡‘é¢299&quot; log_time 1734567912 åˆ›å»º2ä¸ªæ¶ˆè´¹ç»„ï¼ˆæ—¥å¿—åˆ†æ+å®æ—¶å‘Šè­¦ï¼‰ 1234# æ—¥å¿—åˆ†ææ¶ˆè´¹ç»„ï¼ˆç”¨äºç¦»çº¿ç»Ÿè®¡ã€æ•°æ®å½’æ¡£ï¼‰ï¼Œä»é˜Ÿåˆ—å¼€å¤´æ¶ˆè´¹ï¼ˆ0-0ï¼‰ï¼Œå…œåº•æ‰€æœ‰å†å²æ—¥å¿—XGROUP CREATE sys_log_stream group_log_analysis 0-0 MKSTREAM# å®æ—¶å‘Šè­¦æ¶ˆè´¹ç»„ï¼ˆç”¨äºå®æ—¶æ•è·ERRORæ—¥å¿—å‘Šè­¦ï¼‰ï¼Œä»æœ€æ–°æ¶ˆæ¯æ¶ˆè´¹XGROUP CREATE sys_log_stream group_log_alert $ MKSTREAM å¯¹åº”æ¶ˆè´¹è€…æ‹‰å–å¤„ç† 1234567# æ—¥å¿—åˆ†ææ¶ˆè´¹è€…ï¼ˆæ‰¹é‡æ‹‰å–ï¼Œéé˜»å¡ï¼Œé€‚åˆç¦»çº¿å¤„ç†ï¼‰XREADGROUP GROUP group_log_analysis consumer_analysis COUNT 100 STREAMS sys_log_stream &gt;XACK sys_log_stream group_log_analysis æ‰¹é‡æ¶ˆæ¯ID...# å‘Šè­¦æ¶ˆè´¹è€…ï¼ˆé˜»å¡æ‹‰å–ï¼Œå¿«é€Ÿå“åº”ï¼Œåªå¤„ç†ERRORçº§åˆ«æ—¥å¿—ï¼‰XREADGROUP GROUP group_log_alert consumer_alert BLOCK 0 STREAMS sys_log_stream &gt; # BLOCK 0 æ°¸ä¹…é˜»å¡ï¼Œæœ‰æ¶ˆæ¯ç«‹å³è¿”å›XACK sys_log_stream group_log_alert å‘Šè­¦æ¶ˆæ¯ID é™æµå‰Šå³°ï¼ˆç§’æ€åœºæ™¯-è¯·æ±‚å‰Šå³°å¡«è°·ï¼‰ æ ¸å¿ƒæ€è·¯ï¼šç§’æ€è¯·æ±‚é«˜å³°æ—¶ï¼Œå…ˆå†™å…¥ Stream åšç¼“å†²ï¼Œæ¶ˆè´¹ç«¯åŒ€é€Ÿæ‹‰å–ï¼ˆæ§åˆ¶æ¯ç§’å¤„ç†é‡ï¼‰ï¼Œé¿å…ä¸‹æ¸¸æ•°æ®åº“/ä¸šåŠ¡æœåŠ¡è¢«å‹å®ï¼Œæ ¸å¿ƒæ˜¯â€œæ…¢æ¶ˆè´¹ã€ç¨³å¤„ç†â€ã€‚ ç”Ÿäº§è€…ï¼ˆç§’æ€å…¥å£æœåŠ¡ï¼‰ï¼šæ¥æ”¶ç§’æ€è¯·æ±‚ï¼Œç›´æ¥å†™å…¥ Streamï¼Œå¿«é€Ÿè¿”å›â€œæ’é˜Ÿä¸­â€ 12# å†™å…¥ç§’æ€è¯·æ±‚ï¼Œè®¾ç½®MAXLEN 10000ï¼ˆé™åˆ¶æœ€å¤§æ’é˜Ÿæ•°ï¼Œè¶…è¿‡åˆ™æ‹’ç»ï¼Œé¿å…OOMï¼‰XADD seckill_stream * MAXLEN ~ 10000 seckill_id 101 uid 1001 request_time 1734568000 åˆ›å»ºæ¶ˆè´¹ç»„ï¼ˆå•æ¶ˆè´¹ç»„+å¤šæ¶ˆè´¹è€…ï¼Œæ§åˆ¶æ€»å¤„ç†é€Ÿç‡ï¼‰ 1XGROUP CREATE seckill_stream group_seckill $ MKSTREAM æ¶ˆè´¹ç«¯ï¼ˆåŒ€é€Ÿæ‹‰å–ï¼Œæ ¸å¿ƒæ˜¯æ§åˆ¶COUNTå’Œæ¶ˆè´¹é¢‘ç‡ï¼Œæ¯”å¦‚æ¯ç§’å¤„ç†100æ¡ï¼‰ 1234# æ¶ˆè´¹è€…ï¼ˆå¤šå®ä¾‹éƒ¨ç½²ï¼Œæ€»å¤„ç†é‡=å•å®ä¾‹COUNTÃ—å®ä¾‹æ•°ï¼Œè¿™é‡Œå•å®ä¾‹æ¯æ¬¡æ‹‰10æ¡ï¼Œæ¯ç§’æ‹‰10æ¬¡ï¼Œå•å®ä¾‹æ¯ç§’å¤„ç†100æ¡ï¼‰XREADGROUP GROUP group_seckill consumer_seckill1 COUNT 10 BLOCK 100 STREAMS seckill_stream &gt;# ä¸šåŠ¡å¤„ç†ï¼šæ‰£åº“å­˜ã€ç”Ÿæˆè®¢å•ï¼ˆæ ¸å¿ƒæ˜¯å¤„ç†é€»è¾‘åŒæ­¥æ‰§è¡Œï¼Œæ§åˆ¶é€Ÿç‡ï¼‰XACK seckill_stream group_seckill ç§’æ€è¯·æ±‚æ¶ˆæ¯ID... å…³é”®ä¼˜åŒ–ï¼šæ¶ˆè´¹ç«¯é€šè¿‡å®šæ—¶ä»»åŠ¡+å›ºå®šCOUNTæ‹‰å–ï¼Œè€Œéæ— é™æ‹‰å–ï¼Œç²¾å‡†æ§åˆ¶å¤„ç†é€Ÿç‡ï¼Œå®ç°å‰Šå³°å¡«è°·ã€‚ ä¸å…¶ä»– Redis é˜Ÿåˆ—æ–¹æ¡ˆå¯¹æ¯”ï¼ˆæ ¸å¿ƒä¼˜åŠ¿ï¼‰ â€¢ å¯¹æ¯” List - List æ˜¯ç®€å•çš„å…ˆè¿›å…ˆå‡ºï¼Œä¸æ”¯æŒå¤šæ’­ï¼ˆå¤šä¸ªæ¶ˆè´¹è€…ä¼šæŠ¢æ¶ˆæ¯ï¼‰ã€æ— æ¶ˆè´¹ç»„ã€æ— æ¶ˆæ¯ç¡®è®¤ï¼Œä»…é€‚åˆç®€å•ä¸€å¯¹ä¸€é˜Ÿåˆ—ï¼› - Stream æ”¯æŒå¤šæ’­+æ¶ˆè´¹ç»„+ç¡®è®¤æœºåˆ¶ï¼Œé€‚åˆå¤æ‚åˆ†å¸ƒå¼åœºæ™¯ã€‚ å¯¹æ¯”é¡¹ Stream List æ¶ˆè´¹è€…ç»„ âœ… âŒ ACK âœ… âŒ é‡è¯• âœ… âŒ é˜»å¡ âœ… âœ… é¡ºåºæ€§ å¼º å¼º â€¢ å¯¹æ¯” Pub/Sub - Pub/Sub æ— æŒä¹…åŒ–ï¼ŒRedis é‡å¯æˆ–æ¶ˆè´¹è€…ç¦»çº¿ä¼šä¸¢æ¶ˆæ¯ï¼› - Pub/Sub æ— æ¶ˆè´¹ç»„ï¼Œæ¶ˆæ¯å‘å®Œå³ä¸¢ï¼Œä»…é€‚åˆå®æ—¶å¹¿æ’­ï¼ˆå¦‚èŠå¤©å®¤ï¼‰ï¼Œä¸é€‚åˆé‡è¦ä¸šåŠ¡ã€‚ Stream å‘½ä»¤ SpringBoot çš„ StringRedisTemplate.opsForStream() ä¸­ Stream æ•°æ®ç±»å‹ çš„æ“ä½œæ–¹æ³•ä¸ Redis åŸç”Ÿå‘½ä»¤çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š æ³¨æ„è¿™é‡Œä¸ä¸€å®šè¦ç”¨ StringRedisTemplate æ¥æ“ä½œ Streamï¼Œä½†æ˜¯ç”¨ StringRedisTemplate å¯ä»¥ä¿è¯å¯è¯»æ€§ã€‚ æ ¸å¿ƒèƒ½åŠ›åˆ’åˆ†ï¼š 12345678æ¶ˆæ¯å†™å…¥ï¼ˆXADDï¼‰æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰æ¶ˆæ¯è¯»å–ï¼ˆXRANGE / XREAD / XREADGROUPï¼‰Pending æ¶ˆæ¯ç®¡ç†ï¼ˆXPENDING / XCLAIMï¼‰æ¶ˆè´¹è€…ç»„ç®¡ç†ï¼ˆXGROUPï¼‰Stream å…ƒä¿¡æ¯ï¼ˆXINFOï¼‰Stream è£å‰ªä¸åˆ é™¤ï¼ˆXTRIM / XDELï¼‰å¯¹è±¡æ˜ å°„ï¼ˆMapRecord / ObjectRecordï¼‰ æ¶ˆæ¯å†™å…¥ï¼ˆXADDï¼‰ 1ï¸âƒ£ åŸºç¡€å†™å…¥ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• opsForStream().xxx() Redis åŸå§‹å‘½ä»¤ è¯´æ˜ å†™å…¥ Map add(K key, Map&lt;HK,HV&gt;) XADD key * field value è‡ªåŠ¨ç”Ÿæˆ ID å†™å…¥ Record add(Record&lt;K, ?&gt; record) XADD æ”¯æŒ ObjectRecord å†™å…¥ MapRecord add(MapRecord&lt;K,HK,HV&gt;) XADD Map å½¢å¼ 2ï¸âƒ£ å¸¦å‚æ•°å†™å…¥ï¼ˆæ¨èï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ å¤‡æ³¨ å†™å…¥ + é€‰é¡¹ add(record, XAddOptions) XADD ... æ”¯æŒ MAXLEN / NOMKSTREAM Map + é€‰é¡¹ add(key, map, XAddOptions) XADD Redis â‰¥ 6 æ¶ˆæ¯ç¡®è®¤ï¼ˆXACKï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ è¯´æ˜ ç¡®è®¤æ¶ˆæ¯ acknowledge(key, group, recordIdsâ€¦) XACK æ ‡è®°å·²æ¶ˆè´¹ Record ç¡®è®¤ acknowledge(group, record) XACK å¸¸ç”¨ âš ï¸ åªå¯¹ Consumer Group ç”Ÿæ•ˆ æ¶ˆæ¯è¯»å–ï¼ˆæ— æ¶ˆè´¹è€…ç»„ï¼‰ 1ï¸âƒ£ æŒ‰ Range è¯»å–ï¼ˆå†å²æ•°æ®ï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ æ­£åºè¯»å– range(key, range) XRANGE é™åˆ¶æ¡æ•° range(key, range, limit) XRANGE ååºè¯»å– reverseRange(key, range) XREVRANGE ååº + limit reverseRange(key, range, limit) XREVRANGE 2ï¸âƒ£ å®æ—¶è¯»å–ï¼ˆXREADï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ è¯´æ˜ è¯»å– read(StreamOffsetâ€¦) XREAD ä¸æ”¯æŒ ACK å¸¦å‚æ•° read(options, offsetsâ€¦) XREAD BLOCK / COUNT æ˜ å°„å¯¹è±¡ read(Class&lt;T&gt;, â€¦) XREAD è‡ªåŠ¨ååºåˆ—åŒ– æ¶ˆè´¹è€…ç»„è¯»å–ï¼ˆXREADGROUPï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ è¯´æ˜ ç»„å†…è¯»å– read(Consumer, offsetsâ€¦) XREADGROUP MQ æ ¸å¿ƒ å¸¦å‚æ•° read(Consumer, options, offsetsâ€¦) XREADGROUP BLOCK æ˜ å°„å¯¹è±¡ read(Class&lt;T&gt;, Consumer, â€¦) XREADGROUP â€” Pending æ¶ˆæ¯ç®¡ç†ï¼ˆXPENDING / XCLAIMï¼‰ 1ï¸âƒ£ Pending æŸ¥è¯¢ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ Pending æ±‡æ€» pending(key, group) XPENDING æŒ‡å®šæ¶ˆè´¹è€… pending(key, consumer) XPENDING èŒƒå›´æŸ¥è¯¢ pending(key, group, range, count) XPENDING 2ï¸âƒ£ æ¶ˆæ¯é‡æ–°åˆ†é…ï¼ˆXCLAIMï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ è¯´æ˜ é‡æ–°åˆ†é… claim(key, group, newOwner, minIdle, idsâ€¦) XCLAIM è¶…æ—¶æ¥ç®¡ é«˜çº§é…ç½® claim(key, group, newOwner, XClaimOptions) XCLAIM force / retry æ¶ˆè´¹è€…ç»„ç®¡ç†ï¼ˆXGROUPï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ è¯´æ˜ åˆ›å»ºç»„ createGroup(key, group) XGROUP CREATE ä» $ å¼€å§‹ æŒ‡å®š offset createGroup(key, offset, group) XGROUP CREATE å¸¸ç”¨ 0-0 åˆ é™¤æ¶ˆè´¹è€… deleteConsumer(key, consumer) XGROUP DELCONSUMER é”€æ¯ç»„ destroyGroup(key, group) XGROUP DESTROY Stream å…ƒä¿¡æ¯ï¼ˆXINFOï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ Stream ä¿¡æ¯ info(key) XINFO STREAM ç»„ä¿¡æ¯ groups(key) XINFO GROUPS æ¶ˆè´¹è€…ä¿¡æ¯ consumers(key, group) XINFO CONSUMERS Stream åˆ é™¤ / è£å‰ª 1ï¸âƒ£ åˆ é™¤æ¶ˆæ¯ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ åˆ é™¤æ¶ˆæ¯ delete(key, recordIdsâ€¦) XDEL åˆ é™¤ Record delete(record) XDEL 2ï¸âƒ£ è£å‰ª Streamï¼ˆXTRIMï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ è¯´æ˜ ç²¾ç¡®è£å‰ª trim(key, count) XTRIM è¿‘ä¼¼è£å‰ª trim(key, count, true) XTRIM ~ æ€§èƒ½æ›´å¥½ å¯¹è±¡æ˜ å°„èƒ½åŠ›ï¼ˆéå¸¸é‡è¦ï¼‰ èƒ½åŠ› æ–¹æ³• è¯´æ˜ Map â†’ Object map(MapRecord, Class&lt;T&gt;) è‡ªåŠ¨ååºåˆ—åŒ– List æ˜ å°„ map(List&lt;MapRecord&gt;, Class&lt;T&gt;) HashMapper getHashMapper(Class&lt;T&gt;) è‡ªå®šä¹‰æ˜ å°„ ååºåˆ—åŒ– deserializeRecord(ByteRecord) åº•å±‚èƒ½åŠ›","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis Stream æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/","date_published":"2025-12-20T05:40:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/19/redis7-datatype-09-geo/","url":"https://blog.hanqunfeng.com/2025/12/19/redis7-datatype-09-geo/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- Geo","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis Geo æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Geo-æ ¸å¿ƒè¯¦è§£\">Geo æ ¸å¿ƒè¯¦è§£</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redis Geo æ˜¯åŸºäºæœ‰åºé›†åˆï¼ˆ<code>zset</code>ï¼‰ å®ç°çš„åœ°ç†ç©ºé—´æ“ä½œåŠŸèƒ½ï¼Œåº•å±‚ç”¨<code>geohashç¼–ç </code>å­˜å‚¨<code>ç»çº¬åº¦</code>ï¼Œæ ¸å¿ƒæ”¯æŒ 6 ä¸ªåŸºç¡€æ“ä½œ + 2 ä¸ªæ‰©å±•æ“ä½œï¼Œå…¼é¡¾<code>ç²¾å‡†å­˜å‚¨</code>ã€<code>è·ç¦»è®¡ç®—</code>ã€<code>èŒƒå›´ç­›é€‰</code>ç­‰æ ¸å¿ƒéœ€æ±‚ï¼Œç›´æ¥å¯¹æ¥å®é™…åœºæ™¯ï¼ˆå¦‚é™„è¿‘é—¨åº—ã€åŒåŸå¥½å‹ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ‰æ•ˆç»åº¦(longitude)ä¸º <code>-180 ~ 180</code>ï¼Œæœ‰æ•ˆçº¬åº¦(latitude)ä¸º <code>-85.05112878 ~ 85.05112878</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Redis å†…éƒ¨å®ç°ä¸­ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GEO æ•°æ® â‰ˆ ZSET</span><br><span class=\"line\">score = GeoHashï¼ˆ52 ä½bit â‰ˆ 11 ä¸ªå­—ç¬¦ï¼‰</span><br><span class=\"line\">member = å®é™…æˆå‘˜å</span><br></pre></td></tr></table></figure>\n<h2 id=\"Geohash-æ˜¯ä»€ä¹ˆ\">Geohash æ˜¯ä»€ä¹ˆ?</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Geohash æ˜¯ä¸€ç§å°†äºŒç»´åœ°ç†åæ ‡ï¼ˆç»åº¦ã€çº¬åº¦ï¼‰ç¼–ç ä¸ºä¸€ç»´å­—ç¬¦ä¸²æˆ–æ•´æ•°çš„ç©ºé—´ç´¢å¼•ç®—æ³•ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å°†ã€Œä½ç½®ã€æ˜ å°„ä¸ºã€Œå¯æ’åºçš„å€¼ã€</span><br><span class=\"line\">ç›¸è¿‘çš„åœ°ç†ä½ç½® â†’ å‰ç¼€ç›¸åŒæˆ–æ¥è¿‘</span><br><span class=\"line\">ä¾¿äº èŒƒå›´æŸ¥è¯¢ã€é‚»è¿‘æŸ¥è¯¢ã€ç´¢å¼•å­˜å‚¨</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ¸å¿ƒæ€æƒ³</p>\n</li>\n</ul>\n<blockquote>\n<p>ä¸æ–­å¯¹ç»çº¬åº¦åŒºé—´è¿›è¡ŒäºŒåˆ†ï¼Œå¹¶äº¤å‰ç¼–ç <br>\nç¼–ç é¡ºåºï¼šç»åº¦ â†’ çº¬åº¦ â†’ ç»åº¦ â†’ çº¬åº¦ â†’ â€¦</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">æ¯ä¸€æ­¥ï¼š</span><br><span class=\"line\">    1.å–å½“å‰åŒºé—´çš„ä¸­ç‚¹</span><br><span class=\"line\">    2.å¤§äºä¸­ç‚¹è®°ä¸º 1</span><br><span class=\"line\">    3.å°äºä¸­ç‚¹è®°ä¸º 0</span><br><span class=\"line\">    4.ç¼©å°åŒºé—´ï¼Œç»§ç»­ä¸‹ä¸€ä½</span><br><span class=\"line\">æœ€ç»ˆå¾—åˆ°ä¸€ä¸ª bit åºåˆ—ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redis å†…éƒ¨çš„ Geohash å­—ç¬¦ = <code>52bit</code>ï¼Œå³ ç»åº¦ <code>26 bit</code>ï¼Œçº¬åº¦ <code>26 bit</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">æ¯ä¸ªå­—ç¬¦ = 5 bit</span><br><span class=\"line\">å†…éƒ¨ 52 bit â†’ æŒ‰ 5 bit åˆ†ç»„ â†’ 52 Ã· 5 = 10 ä½™ 2 bit</span><br><span class=\"line\"></span><br><span class=\"line\">Redis é»˜è®¤åœ¨è¾“å‡ºå­—ç¬¦ä¸²æ—¶ï¼š</span><br><span class=\"line\">    ä¼šæŠŠ å‰©ä½™çš„ 2 bit å¡«å……æˆå®Œæ•´å­—ç¬¦ï¼Œå³æœ«å°¾è¡¥ä¸‰ä¸ª 0</span><br><span class=\"line\">    å› æ­¤æœ€ç»ˆå¾—åˆ° 11 ä¸ª Base32 å­—ç¬¦</span><br></pre></td></tr></table></figure>\n<h3 id=\"Geohash-è®¡ç®—è¿‡ç¨‹ç¤ºä¾‹\">Geohash è®¡ç®—è¿‡ç¨‹ç¤ºä¾‹</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">longitude = 116.397128</span><br><span class=\"line\">latitude  = 39.916527</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºäº†ç®€åŒ–è®¡ç®—è¿‡ç¨‹ï¼Œæˆ‘ä»¬è¿™é‡Œå›ºå®šä¸€ä¸ªå¸¸ç”¨ç²¾åº¦ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ç²¾åº¦é€‰æ‹©ï¼š5 ä¸ª Geohash å­—ç¬¦ = 25 ä¸ª bit â‡’ ç»åº¦ 13 bitï¼Œçº¬åº¦ 12 bitï¼ˆå¥‡æ•°ä½ç»åº¦ï¼‰</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>é€ä½è®¡ç®—ï¼ˆå…³é”®è¿‡ç¨‹ï¼‰<br>\n1ï¸âƒ£ ç»åº¦ bitï¼ˆ13 ä½ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ä½æ¬¡</th>\n<th>åŒºé—´</th>\n<th>mid</th>\n<th>åˆ¤æ–­</th>\n<th>bit</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>[-180,180]</td>\n<td>0</td>\n<td>116 â‰¥ 0</td>\n<td>1</td>\n</tr>\n<tr>\n<td>2</td>\n<td>[0,180]</td>\n<td>90</td>\n<td>116 â‰¥ 90</td>\n<td>1</td>\n</tr>\n<tr>\n<td>3</td>\n<td>[90,180]</td>\n<td>135</td>\n<td>116 &lt; 135</td>\n<td>0</td>\n</tr>\n<tr>\n<td>4</td>\n<td>[90,135]</td>\n<td>112.5</td>\n<td>116 â‰¥ 112.5</td>\n<td>1</td>\n</tr>\n<tr>\n<td>5</td>\n<td>[112.5,135]</td>\n<td>123.75</td>\n<td>116 &lt; 123.75</td>\n<td>0</td>\n</tr>\n<tr>\n<td>6</td>\n<td>[112.5,123.75]</td>\n<td>118.125</td>\n<td>116 &lt; 118.125</td>\n<td>0</td>\n</tr>\n<tr>\n<td>7</td>\n<td>[112.5,118.125]</td>\n<td>115.3125</td>\n<td>116 â‰¥ 115.3125</td>\n<td>1</td>\n</tr>\n<tr>\n<td>8</td>\n<td>[115.3125,118.125]</td>\n<td>116.71875</td>\n<td>116 &lt; 116.71875</td>\n<td>0</td>\n</tr>\n<tr>\n<td>9</td>\n<td>[115.3125,116.71875]</td>\n<td>116.015625</td>\n<td>116 â‰¥ 116.015625</td>\n<td>1</td>\n</tr>\n<tr>\n<td>10</td>\n<td>[116.015625,116.71875]</td>\n<td>116.3671875</td>\n<td>116 â‰¥ 116.3671875</td>\n<td>1</td>\n</tr>\n<tr>\n<td>11</td>\n<td>[116.3671875,116.71875]</td>\n<td>116.54296875</td>\n<td>116 &lt; 116.54296875</td>\n<td>0</td>\n</tr>\n<tr>\n<td>12</td>\n<td>[116.3671875,116.54296875]</td>\n<td>116.455078125</td>\n<td>116 &lt; 116.455078125</td>\n<td>0</td>\n</tr>\n<tr>\n<td>13</td>\n<td>[116.3671875,116.455078125]</td>\n<td>116.4111328125</td>\n<td>116 &lt; 116.4111328125</td>\n<td>0</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ç»åº¦ bitï¼ˆ13 ä½ï¼‰ï¼š<code>1101001011000</code></p>\n</blockquote>\n<p>2ï¸âƒ£ çº¬åº¦ bitï¼ˆ12 ä½ï¼‰</p>\n<table>\n<thead>\n<tr>\n<th>ä½æ¬¡</th>\n<th>åŒºé—´</th>\n<th>mid</th>\n<th>åˆ¤æ–­</th>\n<th>bit</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>[-90,90]</td>\n<td>0</td>\n<td>39 â‰¥ 0</td>\n<td>1</td>\n</tr>\n<tr>\n<td>2</td>\n<td>[0,90]</td>\n<td>45</td>\n<td>39 &lt; 45</td>\n<td>0</td>\n</tr>\n<tr>\n<td>3</td>\n<td>[0,45]</td>\n<td>22.5</td>\n<td>39 â‰¥ 22.5</td>\n<td>1</td>\n</tr>\n<tr>\n<td>4</td>\n<td>[22.5,45]</td>\n<td>33.75</td>\n<td>39 â‰¥ 33.75</td>\n<td>1</td>\n</tr>\n<tr>\n<td>5</td>\n<td>[33.75,45]</td>\n<td>39.375</td>\n<td>39 &lt; 39.375</td>\n<td>0</td>\n</tr>\n<tr>\n<td>6</td>\n<td>[33.75,39.375]</td>\n<td>36.5625</td>\n<td>39 â‰¥ 36.5625</td>\n<td>1</td>\n</tr>\n<tr>\n<td>7</td>\n<td>[36.5625,39.375]</td>\n<td>37.96875</td>\n<td>39 â‰¥ 37.96875</td>\n<td>1</td>\n</tr>\n<tr>\n<td>8</td>\n<td>[37.96875,39.375]</td>\n<td>38.671875</td>\n<td>39 â‰¥ 38.671875</td>\n<td>1</td>\n</tr>\n<tr>\n<td>9</td>\n<td>[38.671875,39.375]</td>\n<td>39.0234375</td>\n<td>39 &lt; 39.0234375</td>\n<td>0</td>\n</tr>\n<tr>\n<td>10</td>\n<td>[38.671875,39.0234375]</td>\n<td>38.84765625</td>\n<td>39 â‰¥ 38.84765625</td>\n<td>1</td>\n</tr>\n<tr>\n<td>11</td>\n<td>[38.84765625,39.0234375]</td>\n<td>38.935546875</td>\n<td>39 â‰¥ 38.935546875</td>\n<td>1</td>\n</tr>\n<tr>\n<td>12</td>\n<td>[38.935546875,39.0234375]</td>\n<td>38.9794921875</td>\n<td>39 â‰¥ 38.9794921875</td>\n<td>1</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>çº¬åº¦ bitï¼ˆ12 ä½ï¼‰ï¼š<code>101101110111</code></p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>äº¤å‰åˆå¹¶ï¼ˆæœ€ç»ˆ bit åºåˆ—ï¼‰</p>\n</li>\n</ul>\n<blockquote>\n<p>æŒ‰è§„åˆ™ï¼šç»åº¦ â†’ çº¬åº¦ â†’ ç»åº¦ â†’ çº¬åº¦ â€¦</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ç»åº¦: 1 1 0 1 0 0 1 0 1 1 0 0 0</span><br><span class=\"line\">çº¬åº¦: 1 0 1 1 0 1 1 1 0 1 1 1</span><br><span class=\"line\"></span><br><span class=\"line\">äº¤å‰åå¾—åˆ° 25 bitï¼š11 10 01 11 00 01 11 01 10 11 01 01 01</span><br><span class=\"line\">åˆå¹¶ä¸ºä¸€è¡Œï¼š1110011100011101101010101</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ 5 bit â†’ 1 ä¸ª Base32 å­—ç¬¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»å·¦åˆ°å³ï¼Œæ¯ 5 ä½ä¸€ç»„ï¼š</span></span><br><span class=\"line\">11100 | 11100 | 01110 | 11010 | 10101</span><br><span class=\"line\"><span class=\"comment\"># è½¬10è¿›åˆ¶</span></span><br><span class=\"line\">28    | 28    | 14    | 26    | 21</span><br><span class=\"line\"><span class=\"comment\"># è½¬ Base32</span></span><br><span class=\"line\">w     | w    | f    | u    | p</span><br><span class=\"line\"><span class=\"comment\"># æœ€ç»ˆç»“æœï¼š</span></span><br><span class=\"line\">wwfup</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>Geohash ä½¿ç”¨çš„ Base32 å­—ç¬¦é›†ï¼ˆå›ºå®šï¼Œä¸æ˜¯ RFC Base32ï¼‰ï¼š</strong></em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Index:  0 1 2 3 4 5 6 7 8 9</span><br><span class=\"line\">Char :  0 1 2 3 4 5 6 7 8 9</span><br><span class=\"line\"></span><br><span class=\"line\">Index: 10 11 12 13 14 15 16 17 18 19</span><br><span class=\"line\">Char :  b  c  d  e  f  g  h  j  k  m</span><br><span class=\"line\"></span><br><span class=\"line\">Index: 20 21 22 23 24 25 26 27 28 29</span><br><span class=\"line\">Char :  n  p  q  r  s  t  u  v  w  x</span><br><span class=\"line\"></span><br><span class=\"line\">Index: 30 31</span><br><span class=\"line\">Char :  y  z</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">Geohash Base32 å­—ç¬¦é›† ä¸ºä»€ä¹ˆç¼ºå°‘ <code>a, i, l, o</code>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">ä¸ºäº†é¿å…åœ¨è§†è§‰ä¸Šå¼•èµ·æ•°å­—æ··æ·†</li>\n</ul>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a å®¹æ˜“å’Œ 4 æ··æ·†</span><br><span class=\"line\">i å®¹æ˜“å’Œ 1 æ··æ·†</span><br><span class=\"line\">l å®¹æ˜“å’Œ 1 æ··æ·†</span><br><span class=\"line\">o å®¹æ˜“å’Œ 0 æ··æ·†</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">å»æ‰ <code>a, i, l, o</code> ååˆšå¥½æ˜¯ 32 ä¸ªå­—ç¬¦ï¼Œå› ä¸º Geohash éœ€è¦ 2âµ = 32 ä¸ªå­—ç¬¦ å¯¹åº” 5 bit ç²¾åº¦</li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"Geo-æ ¸å¿ƒåŸºç¡€æ“ä½œï¼ˆå¿…ç”¨ï¼‰\">Geo æ ¸å¿ƒåŸºç¡€æ“ä½œï¼ˆå¿…ç”¨ï¼‰</h2>\n<h3 id=\"1-GEOADDï¼šæ·»åŠ åœ°ç†ä½ç½®åæ ‡ï¼ˆæ ¸å¿ƒå†™å…¥æ“ä½œï¼‰\">1. GEOADDï¼šæ·»åŠ åœ°ç†ä½ç½®åæ ‡ï¼ˆæ ¸å¿ƒå†™å…¥æ“ä½œï¼‰</h3>\n<p>â—¦ è¯­æ³•ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GEOADD key [NX | XX] [CH] longitude latitude member [longitude latitude member ...]</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># key: keyåç§°</span></span><br><span class=\"line\"><span class=\"comment\"># NXï¼šå¦‚æœå·²å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œå†™å…¥æ“ä½œ</span></span><br><span class=\"line\"><span class=\"comment\"># XX: å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œå†™å…¥æ“ä½œï¼Œä¸ NX äº’æ–¥</span></span><br><span class=\"line\"><span class=\"comment\"># CH: ï¼ˆCHæ˜¯æ›´æ”¹çš„ç¼©å†™ï¼‰è¿”å›æ–°å¢å’Œä¿®æ”¹çš„æˆå‘˜æ•°é‡ï¼Œä¿®æ”¹ç»çº¬åº¦ä¹Ÿç®—ä¿®æ”¹ï¼Œå¦‚æœä¸åŠ CHï¼Œåˆ™åªè®¡ç®—æ–°å¢æˆå‘˜æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># longitude: ç»åº¦ (-180 ~ 180)</span></span><br><span class=\"line\"><span class=\"comment\"># latitude: çº¬åº¦ (-85.05112878 ~ 85.05112878)</span></span><br><span class=\"line\"><span class=\"comment\"># member: æˆå‘˜åç§°ï¼Œä½ç½®å”¯ä¸€æ ‡è¯†ï¼ˆå­—ç¬¦ä¸²ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼ï¼š(ä¸å¸¦CH)æˆåŠŸæ–°å¢çš„ member æ•°é‡ï¼ˆå·²å­˜åœ¨ä¸ä¼šé‡å¤è®¡ç®—ï¼‰ï¼Œ(å¸¦CH)è¿”å›æ–°å¢å’Œä¿®æ”¹çš„æˆå‘˜æ•°é‡</span></span><br></pre></td></tr></table></figure>\n<p>â—¦ ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç»™shopé›†åˆåŠ ç‹åºœäº•ã€è¥¿å•2ä¸ªé—¨åº—çš„ç»çº¬åº¦</span></span><br><span class=\"line\">GEOADD shop 116.403963 39.915112 wangfujing 116.391248 39.906217 xidan</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br></pre></td></tr></table></figure>\n<p>â—¦ å…³é”®ï¼šç»çº¬åº¦é¡ºåºä¸èƒ½åï¼Œå­˜å‚¨åä¼šè‡ªåŠ¨ç»™æ¯ä¸ªæˆå‘˜ç”Ÿæˆgeohashç¼–ç ã€‚</p>\n<h3 id=\"2-GEOPOSï¼šè·å–æŒ‡å®šæˆå‘˜çš„ç»çº¬åº¦ï¼ˆç²¾å‡†æŸ¥è¯¢åæ ‡ï¼‰\">2. GEOPOSï¼šè·å–æŒ‡å®šæˆå‘˜çš„ç»çº¬åº¦ï¼ˆç²¾å‡†æŸ¥è¯¢åæ ‡ï¼‰</h3>\n<p>â—¦ è¯­æ³•ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GEOPOS key [member [member ...]]</span><br></pre></td></tr></table></figure>\n<p>â—¦ ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿”å›ç‹åºœäº•çš„ç»çº¬åº¦æ•°ç»„ [ç»åº¦, çº¬åº¦]</span></span><br><span class=\"line\">GEOPOS shop wangfujing</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;116.40396326780319214&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;39.91511209922290249&quot;</span></span><br></pre></td></tr></table></figure>\n<p>â—¦ å…³é”®ï¼šè¿”å›ç»“æœä¸æŸ¥è¯¢æˆå‘˜é¡ºåºä¸€è‡´ï¼Œä¸å­˜åœ¨çš„æˆå‘˜è¿”å›nilï¼Œå¯æ‰¹é‡æŸ¥è¯¢æå‡æ•ˆç‡ã€‚</p>\n<h3 id=\"3-GEODISTï¼šè®¡ç®—ä¸¤ä¸ªæˆå‘˜ä¹‹é—´çš„è·ç¦»ï¼ˆæ ¸å¿ƒè®¡ç®—æ“ä½œï¼‰\">3. GEODISTï¼šè®¡ç®—ä¸¤ä¸ªæˆå‘˜ä¹‹é—´çš„è·ç¦»ï¼ˆæ ¸å¿ƒè®¡ç®—æ“ä½œï¼‰</h3>\n<p>â—¦ è¯­æ³•ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GEODIST key member1 member2 [M|KM|FT|MI]</span><br><span class=\"line\"><span class=\"comment\"># [M|KM|FT|MI] : è·ç¦»å•ä½</span></span><br><span class=\"line\"><span class=\"comment\"># M : ç±³ï¼Œé»˜è®¤</span></span><br><span class=\"line\"><span class=\"comment\"># KM : åƒç±³</span></span><br><span class=\"line\"><span class=\"comment\"># FT : è‹±å°º</span></span><br><span class=\"line\"><span class=\"comment\"># MI : è‹±é‡Œ</span></span><br></pre></td></tr></table></figure>\n<p>â—¦ ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿”å›ç‹åºœäº•å’Œè¥¿å•ä¹‹é—´çš„è·ç¦»ï¼Œå•ä½ä¸ºç±³</span></span><br><span class=\"line\">GEODIST shop wangfujing xidan</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\"><span class=\"string\">&quot;1468.0611&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¡ç®—ç‹åºœäº•åˆ°è¥¿å•çš„è·ç¦»ï¼Œå•ä½åƒç±³</span></span><br><span class=\"line\">GEODIST shop wangfujing xidan km</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\"><span class=\"string\">&quot;1.4681&quot;</span></span><br></pre></td></tr></table></figure>\n<p>â—¦ å…³é”®ï¼šè¿”å›æµ®ç‚¹å‹ç»“æœï¼Œæˆå‘˜ä¸å­˜åœ¨è¿”å›nilï¼Œæ”¯æŒè·¨åŒºåŸŸè·ç¦»è®¡ç®—ï¼ˆå¦‚ä¸åŒåŸå¸‚é—¨åº—ï¼‰ã€‚</p>\n<h3 id=\"4-GEOHASHï¼šè·å–æŒ‡å®šæˆå‘˜çš„geohashç¼–ç ï¼ˆåº•å±‚ç¼–ç æŸ¥è¯¢ï¼‰\">4. GEOHASHï¼šè·å–æŒ‡å®šæˆå‘˜çš„geohashç¼–ç ï¼ˆåº•å±‚ç¼–ç æŸ¥è¯¢ï¼‰</h3>\n<p>â—¦ è¯­æ³•ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GEOHASH key [member [member ...]]</span><br></pre></td></tr></table></figure>\n<p>â—¦ ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿”å›ç‹åºœäº•çš„geohashå­—ç¬¦ä¸²ï¼Œå…±11ä½</span></span><br><span class=\"line\">GEOHASH shop wangfujing</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) <span class=\"string\">&quot;wx4g0f6f2u0&quot;</span></span><br></pre></td></tr></table></figure>\n<p>â—¦ å…³é”®ï¼šgeohashç¼–ç è¶Šé•¿ç²¾åº¦è¶Šé«˜ï¼ŒRedisé»˜è®¤ç²¾åº¦è¶³å¤Ÿæ—¥å¸¸ä½¿ç”¨ï¼›ç¼–ç ç›¸åŒçš„æˆå‘˜ï¼Œåœ°ç†ä½ç½®æè¿‘ï¼Œå¯ç”¨äºå¿«é€Ÿåˆ¤è¿‘ã€‚</p>\n<h3 id=\"5-GEORADIUSï¼šæŒ‰æŒ‡å®šç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œç­›é€‰æŒ‡å®šèŒƒå›´çš„æˆå‘˜ï¼ˆèŒƒå›´æŸ¥è¯¢1ï¼ŒæŒ‰ä¸­å¿ƒç‚¹åæ ‡ï¼‰\">5. GEORADIUSï¼šæŒ‰æŒ‡å®šç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œç­›é€‰æŒ‡å®šèŒƒå›´çš„æˆå‘˜ï¼ˆèŒƒå›´æŸ¥è¯¢1ï¼ŒæŒ‰ä¸­å¿ƒç‚¹åæ ‡ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å³å°†å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ <code>GEOSEARCH</code> / <code>GEOSEARCHSTORE</code> æ›¿ä»£<br>\nâ—¦ è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GEORADIUS key longitude latitude radius M|KM|FT|MI [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count [ANY]] [ASC|DESC] [STORE key|STOREDIST key]</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># key: keyåç§°</span></span><br><span class=\"line\"><span class=\"comment\"># longitude: ç»åº¦</span></span><br><span class=\"line\"><span class=\"comment\"># latitude: çº¬åº¦</span></span><br><span class=\"line\"><span class=\"comment\"># radius: åŠå¾„</span></span><br><span class=\"line\"><span class=\"comment\"># M|KM|FT|MI: å•ä½</span></span><br><span class=\"line\"><span class=\"comment\">## å¯é€‰å‚æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># WITHCOORD: è¿”å›ç»çº¬åº¦</span></span><br><span class=\"line\"><span class=\"comment\"># WITHDIST: å¸¦è·ç¦»</span></span><br><span class=\"line\"><span class=\"comment\"># WITHHASH: å¸¦geohash</span></span><br><span class=\"line\"><span class=\"comment\"># COUNT count: é™åˆ¶è¿”å›æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># ANY: éšæœºè¿”å›æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># ASC/DESC: æŒ‰è·ç¦»æ­£/å€’åº</span></span><br><span class=\"line\"><span class=\"comment\"># STORE key: å­˜å‚¨ç»“æœåˆ°æŒ‡å®škey</span></span><br><span class=\"line\"><span class=\"comment\"># STOREDIST key: å­˜å‚¨ç»“æœåˆ°æŒ‡å®škeyï¼Œç»“æœä¸ºè·ç¦»</span></span><br></pre></td></tr></table></figure>\n<p>â—¦ æ ¸å¿ƒå¯é€‰å‚æ•°ï¼šWITHDISTï¼ˆè¿”å›è·ç¦»ï¼‰ã€WITHCOORDï¼ˆè¿”å›ç»çº¬åº¦ï¼‰ã€WITHHASHï¼ˆè¿”å›geohashï¼‰ã€COUNT nï¼ˆé™åˆ¶è¿”å›æ•°é‡ï¼‰ã€ASC/DESCï¼ˆæŒ‰è·ç¦»æ­£/å€’åºï¼‰</p>\n<p>â—¦ ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»¥å¤©å®‰é—¨é™„è¿‘ä¸ºä¸­å¿ƒï¼ŒæŸ¥5kmå†…10ä¸ªé—¨åº—ï¼ŒæŒ‰è·ç¦»ä»è¿‘åˆ°è¿œè¿”å›å¹¶å¸¦è·ç¦»</span></span><br><span class=\"line\">GEORADIUS shop 116.397 39.91 5 km WITHDIST COUNT 10 ASC</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;xidan&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;0.6463&quot;</span></span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;wangfujing&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;0.8223&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"6-GEORADIUSBYMEMBERï¼šæŒ‰å·²æœ‰æˆå‘˜ä¸ºä¸­å¿ƒï¼Œç­›é€‰æŒ‡å®šèŒƒå›´çš„æˆå‘˜ï¼ˆèŒƒå›´æŸ¥è¯¢2ï¼ŒæŒ‰å·²æœ‰èŠ‚ç‚¹ï¼Œæ›´å¸¸ç”¨ï¼‰\">6. GEORADIUSBYMEMBERï¼šæŒ‰å·²æœ‰æˆå‘˜ä¸ºä¸­å¿ƒï¼Œç­›é€‰æŒ‡å®šèŒƒå›´çš„æˆå‘˜ï¼ˆèŒƒå›´æŸ¥è¯¢2ï¼ŒæŒ‰å·²æœ‰èŠ‚ç‚¹ï¼Œæ›´å¸¸ç”¨ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å³å°†å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ <code>GEOSEARCH</code> / <code>GEOSEARCHSTORE</code> æ›¿ä»£<br>\nâ—¦ è¯­æ³•ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GEORADIUSBYMEMBER key member radius M|KM|FT|MI [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count [ANY]] [ASC|DESC] [STORE key|STOREDIST key]</span><br><span class=\"line\"><span class=\"comment\"># è¯­æ³•è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># key: keyåç§°</span></span><br><span class=\"line\"><span class=\"comment\"># member: å·²æœ‰æˆå‘˜åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># radius: åŠå¾„</span></span><br><span class=\"line\"><span class=\"comment\"># M|KM|FT|MI: å•ä½</span></span><br><span class=\"line\"><span class=\"comment\">## å¯é€‰å‚æ•°è¯´æ˜åŒ GEORADIUS</span></span><br></pre></td></tr></table></figure>\n<p>â—¦ å¯é€‰å‚æ•°ä¸GEORADIUSä¸€è‡´ï¼Œåœºæ™¯æ›´è´´åˆå®é™…ï¼ˆå¦‚æŸ¥â€œæˆ‘é™„è¿‘â€çš„é—¨åº—ï¼Œå…ˆå­˜è‡ªå·±çš„åæ ‡ä¸ºæˆå‘˜ï¼Œå†ç”¨æ­¤å‘½ä»¤ï¼‰<br>\nâ—¦ ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥ç‹åºœäº•3kmå†…çš„é—¨åº—ï¼ŒæŒ‰è·ç¦»æ’åº</span></span><br><span class=\"line\">GEORADIUSBYMEMBER shop wangfujing 3 km WITHDIST ASC</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;wangfujing&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;0.0000&quot;</span></span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;xidan&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;1.4681&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Geo-æ‰©å±•æ“ä½œï¼ˆå®æˆ˜å¸¸ç”¨ï¼‰\">Geo æ‰©å±•æ“ä½œï¼ˆå®æˆ˜å¸¸ç”¨ï¼‰</h2>\n<h3 id=\"1-GEOSEARCHï¼ˆRedis-6-2-æ–°å¢ï¼Œæ›¿ä»£-GEORADIUS-GEORADIUSBYMEMBERï¼‰\">1. GEOSEARCHï¼ˆRedis 6.2+ æ–°å¢ï¼Œæ›¿ä»£ GEORADIUS/GEORADIUSBYMEMBERï¼‰</h3>\n<p>â—¦ ä¼˜åŠ¿ï¼šåŠŸèƒ½æ›´å…¨ã€è¯­æ³•æ›´ç»Ÿä¸€ï¼Œæ”¯æŒä¸¤ç§æŸ¥è¯¢æ¨¡å¼ï¼Œæ˜¯æœªæ¥ä¸»æµç”¨æ³•</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GEOSEARCH key &lt;FROMMEMBER member | FROMLONLAT longitude latitude&gt;</span><br><span class=\"line\">  &lt;BYRADIUS radius &lt;M | KM | FT | MI&gt; | BYBOX width height &lt;M | KM | FT | MI&gt;&gt;</span><br><span class=\"line\">  [ASC | DESC] [COUNT count [ANY]] [WITHCOORD] [WITHDIST] [WITHHASH]</span><br></pre></td></tr></table></figure>\n<p>â—¦ è¯­æ³•1ï¼ˆæŒ‰åæ ‡ä¸­å¿ƒï¼‰ï¼š<code>GEOSEARCH key FROMLONLAT ç»åº¦ çº¬åº¦ BYRADIUS è·ç¦» å•ä½ [å¯é€‰å‚æ•°]</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥å¤©å®‰é—¨3kmå†…çš„é—¨åº—ï¼ŒæŒ‰è·ç¦»æ’åº</span></span><br><span class=\"line\">GEOSEARCH shop FROMLONLAT 116.397 39.91 BYRADIUS 3 km WITHDIST WITHCOORD WITHHASH ASC COUNT 10</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;xidan&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;0.6463&quot;</span></span><br><span class=\"line\">   3) (<span class=\"built_in\">integer</span>) 4069885362016563</span><br><span class=\"line\">   4) 1) <span class=\"string\">&quot;116.39124959707260132&quot;</span></span><br><span class=\"line\">      2) <span class=\"string\">&quot;39.90621776267477827&quot;</span></span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;wangfujing&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;0.8223&quot;</span></span><br><span class=\"line\">   3) (<span class=\"built_in\">integer</span>) 4069885555089518</span><br><span class=\"line\">   4) 1) <span class=\"string\">&quot;116.40396326780319214&quot;</span></span><br><span class=\"line\">      2) <span class=\"string\">&quot;39.91511209922290249&quot;</span></span><br></pre></td></tr></table></figure>\n<p>â—¦ è¯­æ³•2ï¼ˆæŒ‰æˆå‘˜ä¸­å¿ƒï¼‰ï¼š<code>GEOSEARCH key FROMMEMBER ä¸­å¿ƒæˆå‘˜ BYRADIUS è·ç¦» å•ä½ [å¯é€‰å‚æ•°]</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥ç‹åºœäº•3kmå†…çš„é—¨åº—ï¼ŒæŒ‰è·ç¦»æ’åº</span></span><br><span class=\"line\">GEOSEARCH shop FROMMEMBER wangfujing BYRADIUS 3 km WITHDIST WITHCOORD WITHHASH ASC COUNT 10</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;wangfujing&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;0.0000&quot;</span></span><br><span class=\"line\">   3) (<span class=\"built_in\">integer</span>) 4069885555089518</span><br><span class=\"line\">   4) 1) <span class=\"string\">&quot;116.40396326780319214&quot;</span></span><br><span class=\"line\">      2) <span class=\"string\">&quot;39.91511209922290249&quot;</span></span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;xidan&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;1.4681&quot;</span></span><br><span class=\"line\">   3) (<span class=\"built_in\">integer</span>) 4069885362016563</span><br><span class=\"line\">   4) 1) <span class=\"string\">&quot;116.39124959707260132&quot;</span></span><br><span class=\"line\">      2) <span class=\"string\">&quot;39.90621776267477827&quot;</span></span><br></pre></td></tr></table></figure>\n<p>â—¦ æ–°å¢ç‰¹æ€§ï¼šæ”¯æŒ <code>BYBOXï¼ˆæŒ‰çŸ©å½¢èŒƒå›´æŸ¥è¯¢ï¼‰</code>ï¼Œé€‚é…æ›´å¤šåœºæ™¯ï¼ˆå¦‚æŸ¥è¯¢æŸç‰‡åŒºå†…çš„é—¨åº—ï¼‰ã€‚</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥ç‹åºœäº•2.0*2.0kmå†…çš„é—¨åº—ï¼ŒæŒ‰è·ç¦»æ’åºï¼Œè¿™é‡Œä»¥ ç‹åºœäº• ä¸ºçŸ©å½¢çš„ä¸­å¿ƒï¼ŒæŸ¥è¯¢2.0*2.0kmå†…çš„é—¨åº—</span></span><br><span class=\"line\"><span class=\"comment\"># è¥¿å•è·ç¦»ç‹åºœäº• 1.4681 kmï¼Œæ‰€ä»¥ä¸åœ¨ç»“æœä¸­</span></span><br><span class=\"line\">GEOSEARCH shop FROMMEMBER wangfujing BYBOX 2.0 2.0 km WITHDIST WITHCOORD WITHHASH ASC COUNT 10</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) 1) <span class=\"string\">&quot;wangfujing&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;0.0000&quot;</span></span><br><span class=\"line\">   3) (<span class=\"built_in\">integer</span>) 4069885555089518</span><br><span class=\"line\">   4) 1) <span class=\"string\">&quot;116.40396326780319214&quot;</span></span><br><span class=\"line\">      2) <span class=\"string\">&quot;39.91511209922290249&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"2-GEOSEARCHSTOREï¼ˆRedis-6-2-æ–°å¢ï¼‰\">2. GEOSEARCHSTOREï¼ˆRedis 6.2+ æ–°å¢ï¼‰</h3>\n<p>â—¦ ä½œç”¨ï¼šå°† GEOSEARCH çš„æŸ¥è¯¢ç»“æœï¼Œç›´æ¥å­˜å‚¨åˆ°æŒ‡å®šzsetä¸­ï¼Œæ–¹ä¾¿åç»­äºŒæ¬¡å¤„ç†ï¼ˆå¦‚åˆ†é¡µã€æ’åºï¼‰<br>\nâ—¦ è¯­æ³•ï¼šGEOSEARCHSTORE ç›®æ ‡key æºkey æŸ¥è¯¢æ¡ä»¶ï¼ˆåŒGEOSEARCHï¼‰</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GEOSEARCHSTORE destination <span class=\"built_in\">source</span></span><br><span class=\"line\">  &lt;FROMMEMBER member | FROMLONLAT longitude latitude&gt;</span><br><span class=\"line\">  &lt;BYRADIUS radius &lt;M | KM | FT | MI&gt; | BYBOX width height &lt;M | KM | FT | MI&gt;&gt;</span><br><span class=\"line\">  [ASC | DESC] [COUNT count [ANY]] [STOREDIST]</span><br></pre></td></tr></table></figure>\n<p>â—¦ ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŠŠç‹åºœäº•3kmå†…çš„é—¨åº—ï¼Œå­˜åˆ°near_shopé›†åˆ</span></span><br><span class=\"line\">GEOSEARCHSTORE near_shop shop FROMMEMBER wangfujing BYRADIUS 3 km</span><br></pre></td></tr></table></figure>\n<h2 id=\"åº•å±‚æ ¸å¿ƒä¸å®æˆ˜æ³¨æ„äº‹é¡¹\">åº•å±‚æ ¸å¿ƒä¸å®æˆ˜æ³¨æ„äº‹é¡¹</h2>\n<ol>\n<li class=\"lvl-3\">\n<p>åº•å±‚æœ¬è´¨ï¼šæ‰€æœ‰Geoæ“ä½œçš„keyï¼Œæœ¬è´¨éƒ½æ˜¯zsetï¼Œå› æ­¤zsetçš„å‘½ä»¤ï¼ˆå¦‚ZREMã€ZSCOREï¼‰å¯ç›´æ¥ç”¨äºGeo keyï¼Œä¾‹å¦‚ ZREM shop xidan å¯åˆ é™¤è¥¿å•çš„åœ°ç†ä½ç½®ï¼ˆGeoæ— å•ç‹¬åˆ é™¤å‘½ä»¤ï¼Œä¾èµ–ZREMï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>ç²¾åº¦é™åˆ¶ï¼šç»çº¬åº¦æ”¯æŒå°æ•°ç‚¹åå¤šä½ï¼Œä½†Rediså†…éƒ¨ä¼šåšç²¾åº¦å–èˆï¼Œæ—¥å¸¸åœºæ™¯ï¼ˆå¦‚æ‰“è½¦ã€é—¨åº—ï¼‰å®Œå…¨å¤Ÿç”¨ï¼Œæ— éœ€é¢å¤–å¤„ç†ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>æ€§èƒ½ä¼˜åŒ–ï¼šå¤§èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚100kmä»¥ä¸Šï¼‰å»ºè®®åŠ COUNTé™åˆ¶è¿”å›æ•°é‡ï¼›é«˜é¢‘æŸ¥è¯¢å¯å°†ç»“æœç¼“å­˜åˆ°æ™®é€škeyï¼Œå‡å°‘Geoè®¡ç®—å¼€é”€ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>é€‚ç”¨åœºæ™¯ï¼šé™„è¿‘é—¨åº—ã€åŒåŸç¤¾äº¤ã€ç‰©æµå®šä½ï¼Œä¸é€‚ç”¨é«˜ç²¾åº¦åœºæ™¯ï¼ˆå¦‚å†›äº‹ã€æµ‹ç»˜ï¼‰ï¼Œæ­¤ç±»åœºæ™¯éœ€ç”¨ä¸“ä¸šGISç³»ç»Ÿã€‚</p>\n</li>\n</ol>\n<h2 id=\"å…¸å‹å®æˆ˜åœºæ™¯ç¤ºä¾‹\">å…¸å‹å®æˆ˜åœºæ™¯ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éœ€æ±‚ï¼šæ­å»ºâ€œé™„è¿‘é¤é¥®â€æŸ¥è¯¢åŠŸèƒ½ï¼Œæ”¯æŒæ·»åŠ é¤é¥®åæ ‡ã€æŸ¥è¯¢å½“å‰ä½ç½®3kmå†…é¤é¥®å¹¶æŒ‰è·ç¦»æ’åºã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. æ‰¹é‡æ·»åŠ é¤é¥®åæ ‡</span></span><br><span class=\"line\">GEOADD restaurant 116.405 39.916 aaa 116.402 39.913 bbb 116.408 39.918 ccc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. æŸ¥å½“å‰ä½ç½®ï¼ˆ116.404,39.915ï¼‰3kmå†…é¤é¥®ï¼ˆå¸¦è·ç¦»ã€æ­£åºï¼‰</span></span><br><span class=\"line\">GEOSEARCH restaurant FROMLONLAT 116.404 39.915 BYRADIUS 3 km WITHDIST ASC</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. åˆ é™¤æŸé¤é¥®</span></span><br><span class=\"line\">ZREM restaurant aaa</span><br></pre></td></tr></table></figure>\n<h2 id=\"Geo-å‘½ä»¤\">Geo å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SpringBoot çš„ <code>StringRedisTemplate.opsForGeo()</code> ä¸­ Geo æ•°æ®ç±»å‹ çš„æ“ä½œæ–¹æ³•ä¸ Redis åŸç”Ÿå‘½ä»¤çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<blockquote>\n<p>æ³¨æ„è¿™é‡Œä¸€å®šè¦ç”¨ <code>StringRedisTemplate</code> æ¥æ“ä½œ Geo</p>\n</blockquote>\n<h3 id=\"å†™å…¥-åˆ é™¤ç±»æ“ä½œ\">å†™å…¥ / åˆ é™¤ç±»æ“ä½œ</h3>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ·»åŠ å•ä¸ªåæ ‡</td>\n<td><code>add(K key, Point point, M member)</code></td>\n<td><code>GEOADD key longitude latitude member</code></td>\n<td>è¿”å› <strong>æ–°å¢æˆå‘˜æ•°é‡</strong>ï¼ˆå·²å­˜åœ¨åˆ™è¿”å› 0ï¼‰</td>\n</tr>\n<tr>\n<td>æ·»åŠ å•ä¸ªä½ç½®</td>\n<td><code>add(K key, GeoLocation&lt;M&gt; location)</code></td>\n<td><code>GEOADD key longitude latitude member</code></td>\n<td><code>GeoLocation</code> å†…éƒ¨å°è£…äº† <code>Point + member</code></td>\n</tr>\n<tr>\n<td>æ‰¹é‡æ·»åŠ </td>\n<td><code>add(K key, Map&lt;M, Point&gt; map)</code></td>\n<td><code>GEOADD key lon1 lat1 member1 [lon2 lat2 member2 ...]</code></td>\n<td><strong>æ¨è</strong>ï¼Œä¸€æ¬¡ç½‘ç»œ IO</td>\n</tr>\n<tr>\n<td>æ‰¹é‡æ·»åŠ </td>\n<td><code>add(K key, Iterable&lt;GeoLocation&lt;M&gt;&gt; locations)</code></td>\n<td><code>GEOADD key lon1 lat1 member1 [lon2 lat2 member2 ...]</code></td>\n<td>ä¸ Map æ–¹å¼ç­‰ä»·</td>\n</tr>\n<tr>\n<td>åˆ é™¤æˆå‘˜</td>\n<td><code>remove(K key, M... members)</code></td>\n<td><code>ZREM key member [member ...]</code></td>\n<td>GEO æœ¬è´¨æ˜¯ <strong>Sorted Set</strong></td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Point</span> <span class=\"variable\">point</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Point</span>(longitude, latitude);</span><br><span class=\"line\">redisTemplate.opsForGeo().add(key, point, member);</span><br><span class=\"line\"></span><br><span class=\"line\">RedisGeoCommands.GeoLocation&lt;String&gt; geoLocation= <span class=\"keyword\">new</span> <span class=\"title class_\">RedisGeoCommands</span>.GeoLocation&lt;&gt;(member, point);</span><br><span class=\"line\">redisTemplate.opsForGeo().add(key, geoLocation);</span><br></pre></td></tr></table></figure>\n<h3 id=\"è·ç¦»-åæ ‡-å“ˆå¸ŒæŸ¥è¯¢\">è·ç¦» / åæ ‡ / å“ˆå¸ŒæŸ¥è¯¢</h3>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ä¸¤ç‚¹è·ç¦»</td>\n<td><code>distance(K key, m1, m2)</code></td>\n<td><code>GEODIST key m1 m2</code></td>\n<td>é»˜è®¤å•ä½ç±³</td>\n</tr>\n<tr>\n<td>æŒ‡å®šå•ä½è·ç¦»</td>\n<td><code>distance(K key, m1, m2, metric)</code></td>\n<td><code>GEODIST key m1 m2 unit</code></td>\n<td>m / km / mi / ft</td>\n</tr>\n<tr>\n<td>è·å– GeoHash</td>\n<td><code>hash(K key, M... members)</code></td>\n<td><code>GEOHASH key member</code></td>\n<td>ç”¨äºè°ƒè¯•</td>\n</tr>\n<tr>\n<td>è·å–åæ ‡</td>\n<td><code>position(K key, M... members)</code></td>\n<td><code>GEOPOS key member</code></td>\n<td>lon / lat</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"åŠå¾„æŸ¥è¯¢ï¼ˆæ—§æ¥å£ï¼Œå·²ä¸æ¨èï¼‰\">åŠå¾„æŸ¥è¯¢ï¼ˆæ—§æ¥å£ï¼Œå·²ä¸æ¨èï¼‰</h3>\n<blockquote>\n<p>Redis 6.2 èµ·ï¼Œå®˜æ–¹ä¸æ¨èç»§ç»­ä½¿ç”¨ GEORADIUS / GEORADIUSBYMEMBERï¼Œä½† Spring ä»ä¿ç•™æ¥å£ä»¥å…¼å®¹ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1ï¸âƒ£ åŸºäºåæ ‡ç‚¹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åŠå¾„æŸ¥è¯¢</td>\n<td><code>radius(K key, Circle within)</code></td>\n<td><code>GEORADIUS key lon lat radius</code></td>\n</tr>\n<tr>\n<td>åŠå¾„ + å‚æ•°</td>\n<td><code>radius(K key, Circle within, args)</code></td>\n<td><code>GEORADIUS</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2ï¸âƒ£ åŸºäºæˆå‘˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åŠå¾„æŸ¥è¯¢</td>\n<td><code>radius(K key, member, radius)</code></td>\n<td><code>GEORADIUSBYMEMBER</code></td>\n</tr>\n<tr>\n<td>æŒ‡å®šå•ä½</td>\n<td><code>radius(K key, member, Distance)</code></td>\n<td><code>GEORADIUSBYMEMBER</code></td>\n</tr>\n<tr>\n<td>å¸¦å‚æ•°</td>\n<td><code>radius(K key, member, Distance, args)</code></td>\n<td><code>GEORADIUSBYMEMBER</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æœç´¢æŸ¥è¯¢ï¼ˆæ¨èä½¿ç”¨-GEOSEARCHï¼‰\">æœç´¢æŸ¥è¯¢ï¼ˆæ¨èä½¿ç”¨ GEOSEARCHï¼‰</h3>\n<blockquote>\n<p>æ›¿ä»£ GEORADIUS / GEORADIUSBYMEMBER</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1ï¸âƒ£ æŒ‰åœ†å½¢èŒƒå›´æœç´¢</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åœ†å½¢æœç´¢</td>\n<td><code>search(K key, Circle within)</code></td>\n<td><code>GEOSEARCH</code></td>\n<td>æ–°æ¨èæ¥å£</td>\n</tr>\n<tr>\n<td>æŒ‡å®šå‚è€ƒç‚¹</td>\n<td><code>search(K key, GeoReference, Distance)</code></td>\n<td><code>GEOSEARCH</code></td>\n<td>FROMMEMBER / FROMLONLAT</td>\n</tr>\n<tr>\n<td>å¸¦å‚æ•°</td>\n<td><code>search(K key, reference, radius, args)</code></td>\n<td><code>GEOSEARCH</code></td>\n<td>æ”¯æŒæ’åºã€limit</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2ï¸âƒ£ æŒ‰çŸ©å½¢èŒƒå›´æœç´¢</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>çŸ©å½¢æœç´¢</td>\n<td><code>search(K key, reference, BoundingBox)</code></td>\n<td><code>GEOSEARCH</code></td>\n</tr>\n<tr>\n<td>å¸¦å‚æ•°</td>\n<td><code>search(K key, reference, BoundingBox, args)</code></td>\n<td><code>GEOSEARCH</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šç”¨æœç´¢ï¼ˆåº•å±‚èƒ½åŠ›ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ä»»æ„ GeoShape</td>\n<td><code>search(K key, reference, GeoShape, args)</code></td>\n<td><code>GEOSEARCH</code></td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åŸºäºç»™å®šçš„åæ ‡æœç´¢</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">search</span><span class=\"params\">(String key, <span class=\"type\">double</span> longitude, <span class=\"type\">double</span> latitude, <span class=\"type\">double</span> radius)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ä¸­å¿ƒç‚¹</span></span><br><span class=\"line\">    <span class=\"type\">Point</span> <span class=\"variable\">point</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Point</span>(longitude, latitude);</span><br><span class=\"line\">    <span class=\"comment\">// åŠå¾„</span></span><br><span class=\"line\">    <span class=\"type\">Distance</span> <span class=\"variable\">distance</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Distance</span>(radius, RedisGeoCommands.DistanceUnit.METERS);</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºåœ†å½¢</span></span><br><span class=\"line\">    <span class=\"type\">Circle</span> <span class=\"variable\">circle</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Circle</span>(point, distance);</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºåœ°ç†å‚è€ƒ</span></span><br><span class=\"line\">    GeoReference&lt;String&gt; objectGeoReference = GeoReference.fromCircle(circle);</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºåœ°ç†å½¢çŠ¶</span></span><br><span class=\"line\">    <span class=\"type\">GeoShape</span> <span class=\"variable\">geoShape</span> <span class=\"operator\">=</span> GeoShape.byRadius(distance);</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºå‚æ•°</span></span><br><span class=\"line\">    RedisGeoCommands.<span class=\"type\">GeoRadiusCommandArgs</span> <span class=\"variable\">args</span> <span class=\"operator\">=</span> RedisGeoCommands.GeoRadiusCommandArgs.newGeoRadiusArgs()</span><br><span class=\"line\">            .includeCoordinates() <span class=\"comment\">// è¿”å›åæ ‡</span></span><br><span class=\"line\">            .includeDistance() <span class=\"comment\">// è¿”å›è·ç¦»</span></span><br><span class=\"line\">            .sortAscending() <span class=\"comment\">// æ’åº</span></span><br><span class=\"line\">            .limit(<span class=\"number\">10</span>); <span class=\"comment\">// é™åˆ¶è¿”å›æ•°é‡</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æŸ¥è¯¢</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; results = redisTemplate.opsForGeo().search(key, objectGeoReference, geoShape, args);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (results != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        results.forEach(result -&gt; &#123;</span><br><span class=\"line\">            <span class=\"comment\">// è·å–æˆå‘˜åç§°</span></span><br><span class=\"line\">            System.out.println(result.getContent().getName());</span><br><span class=\"line\">            <span class=\"comment\">// è·å–åæ ‡</span></span><br><span class=\"line\">            System.out.println(result.getContent().getPoint());</span><br><span class=\"line\">            <span class=\"comment\">// è·å–è·ç¦»</span></span><br><span class=\"line\">            System.out.println(result.getDistance());</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// åŸºäºæˆå‘˜çš„åæ ‡æœç´¢</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">search</span><span class=\"params\">(String key, String member, <span class=\"type\">double</span> radius)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// åŠå¾„</span></span><br><span class=\"line\">    <span class=\"type\">Distance</span> <span class=\"variable\">distance</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Distance</span>(radius, RedisGeoCommands.DistanceUnit.METERS);</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºåœ°ç†å‚è€ƒ</span></span><br><span class=\"line\">    GeoReference&lt;String&gt; objectGeoReference = GeoReference.fromMember(member);</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºåœ°ç†å½¢çŠ¶</span></span><br><span class=\"line\">    <span class=\"type\">GeoShape</span> <span class=\"variable\">geoShape</span> <span class=\"operator\">=</span> GeoShape.byRadius(distance);</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºå‚æ•°</span></span><br><span class=\"line\">    RedisGeoCommands.<span class=\"type\">GeoRadiusCommandArgs</span> <span class=\"variable\">args</span> <span class=\"operator\">=</span> RedisGeoCommands.GeoRadiusCommandArgs.newGeoRadiusArgs()</span><br><span class=\"line\">            .includeCoordinates() <span class=\"comment\">// è¿”å›åæ ‡</span></span><br><span class=\"line\">            .includeDistance() <span class=\"comment\">// è¿”å›è·ç¦»</span></span><br><span class=\"line\">            .sortAscending() <span class=\"comment\">// æ’åº</span></span><br><span class=\"line\">            .limit(<span class=\"number\">10</span>); <span class=\"comment\">// é™åˆ¶è¿”å›æ•°é‡</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æŸ¥è¯¢</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; results = redisTemplate.opsForGeo().search(key, objectGeoReference, geoShape, args);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (results != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        results.forEach(result -&gt; &#123;</span><br><span class=\"line\">            <span class=\"comment\">// è·å–æˆå‘˜åç§°</span></span><br><span class=\"line\">            System.out.println(result.getContent().getName());</span><br><span class=\"line\">            <span class=\"comment\">// è·å–åæ ‡</span></span><br><span class=\"line\">            System.out.println(result.getContent().getPoint());</span><br><span class=\"line\">            <span class=\"comment\">// è·å–è·ç¦»</span></span><br><span class=\"line\">            System.out.println(result.getDistance());</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"æœç´¢å¹¶å­˜å‚¨ï¼ˆGEOSEARCHSTOREï¼‰\">æœç´¢å¹¶å­˜å‚¨ï¼ˆGEOSEARCHSTOREï¼‰</h3>\n<blockquote>\n<p>è¿™æ˜¯ æœç´¢ + å†™å…¥ çš„ç»„åˆæ“ä½œï¼Œç»“æœä¼šå†™å…¥æ–°çš„ ZSet</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1ï¸âƒ£ åœ†å½¢èŒƒå›´å­˜å‚¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æœç´¢å¹¶å­˜å‚¨</td>\n<td><code>searchAndStore(K key, destKey, Circle)</code></td>\n<td><code>GEOSEARCHSTORE</code></td>\n</tr>\n<tr>\n<td>æŒ‡å®šå‚è€ƒç‚¹</td>\n<td><code>searchAndStore(K key, destKey, reference, radius)</code></td>\n<td><code>GEOSEARCHSTORE</code></td>\n</tr>\n<tr>\n<td>å¸¦å‚æ•°</td>\n<td><code>searchAndStore(K key, destKey, reference, radius, args)</code></td>\n<td><code>GEOSEARCHSTORE</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>2ï¸âƒ£ çŸ©å½¢èŒƒå›´å­˜å‚¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>çŸ©å½¢å­˜å‚¨</td>\n<td><code>searchAndStore(K key, destKey, reference, BoundingBox)</code></td>\n<td><code>GEOSEARCHSTORE</code></td>\n</tr>\n<tr>\n<td>å¸¦å‚æ•°</td>\n<td><code>searchAndStore(K key, destKey, reference, BoundingBox, args)</code></td>\n<td><code>GEOSEARCHSTORE</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>3ï¸âƒ£ é€šç”¨ GeoShape å­˜å‚¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é€šç”¨å­˜å‚¨</td>\n<td><code>searchAndStore(K key, destKey, reference, GeoShape, args)</code></td>\n<td><code>GEOSEARCHSTORE</code></td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis Geo æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ Geo æ ¸å¿ƒè¯¦è§£ Redis Geo æ˜¯åŸºäºæœ‰åºé›†åˆï¼ˆzsetï¼‰ å®ç°çš„åœ°ç†ç©ºé—´æ“ä½œåŠŸèƒ½ï¼Œåº•å±‚ç”¨geohashç¼–ç å­˜å‚¨ç»çº¬åº¦ï¼Œæ ¸å¿ƒæ”¯æŒ 6 ä¸ªåŸºç¡€æ“ä½œ + 2 ä¸ªæ‰©å±•æ“ä½œï¼Œå…¼é¡¾ç²¾å‡†å­˜å‚¨ã€è·ç¦»è®¡ç®—ã€èŒƒå›´ç­›é€‰ç­‰æ ¸å¿ƒéœ€æ±‚ï¼Œç›´æ¥å¯¹æ¥å®é™…åœºæ™¯ï¼ˆå¦‚é™„è¿‘é—¨åº—ã€åŒåŸå¥½å‹ï¼‰ã€‚ æœ‰æ•ˆç»åº¦(longitude)ä¸º -180 ~ 180ï¼Œæœ‰æ•ˆçº¬åº¦(latitude)ä¸º -85.05112878 ~ 85.05112878ã€‚ Redis å†…éƒ¨å®ç°ä¸­ï¼š 123GEO æ•°æ® â‰ˆ ZSETscore = GeoHashï¼ˆ52 ä½bit â‰ˆ 11 ä¸ªå­—ç¬¦ï¼‰member = å®é™…æˆå‘˜å Geohash æ˜¯ä»€ä¹ˆ? Geohash æ˜¯ä¸€ç§å°†äºŒç»´åœ°ç†åæ ‡ï¼ˆç»åº¦ã€çº¬åº¦ï¼‰ç¼–ç ä¸ºä¸€ç»´å­—ç¬¦ä¸²æˆ–æ•´æ•°çš„ç©ºé—´ç´¢å¼•ç®—æ³•ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ï¼š 123å°†ã€Œä½ç½®ã€æ˜ å°„ä¸ºã€Œå¯æ’åºçš„å€¼ã€ç›¸è¿‘çš„åœ°ç†ä½ç½® â†’ å‰ç¼€ç›¸åŒæˆ–æ¥è¿‘ä¾¿äº èŒƒå›´æŸ¥è¯¢ã€é‚»è¿‘æŸ¥è¯¢ã€ç´¢å¼•å­˜å‚¨ æ ¸å¿ƒæ€æƒ³ ä¸æ–­å¯¹ç»çº¬åº¦åŒºé—´è¿›è¡ŒäºŒåˆ†ï¼Œå¹¶äº¤å‰ç¼–ç  ç¼–ç é¡ºåºï¼šç»åº¦ â†’ çº¬åº¦ â†’ ç»åº¦ â†’ çº¬åº¦ â†’ â€¦ 123456æ¯ä¸€æ­¥ï¼š 1.å–å½“å‰åŒºé—´çš„ä¸­ç‚¹ 2.å¤§äºä¸­ç‚¹è®°ä¸º 1 3.å°äºä¸­ç‚¹è®°ä¸º 0 4.ç¼©å°åŒºé—´ï¼Œç»§ç»­ä¸‹ä¸€ä½æœ€ç»ˆå¾—åˆ°ä¸€ä¸ª bit åºåˆ—ã€‚ Redis å†…éƒ¨çš„ Geohash å­—ç¬¦ = 52bitï¼Œå³ ç»åº¦ 26 bitï¼Œçº¬åº¦ 26 bit 123456æ¯ä¸ªå­—ç¬¦ = 5 bitå†…éƒ¨ 52 bit â†’ æŒ‰ 5 bit åˆ†ç»„ â†’ 52 Ã· 5 = 10 ä½™ 2 bitRedis é»˜è®¤åœ¨è¾“å‡ºå­—ç¬¦ä¸²æ—¶ï¼š ä¼šæŠŠ å‰©ä½™çš„ 2 bit å¡«å……æˆå®Œæ•´å­—ç¬¦ï¼Œå³æœ«å°¾è¡¥ä¸‰ä¸ª 0 å› æ­¤æœ€ç»ˆå¾—åˆ° 11 ä¸ª Base32 å­—ç¬¦ Geohash è®¡ç®—è¿‡ç¨‹ç¤ºä¾‹ 12longitude = 116.397128latitude = 39.916527 ä¸ºäº†ç®€åŒ–è®¡ç®—è¿‡ç¨‹ï¼Œæˆ‘ä»¬è¿™é‡Œå›ºå®šä¸€ä¸ªå¸¸ç”¨ç²¾åº¦ï¼š ç²¾åº¦é€‰æ‹©ï¼š5 ä¸ª Geohash å­—ç¬¦ = 25 ä¸ª bit â‡’ ç»åº¦ 13 bitï¼Œçº¬åº¦ 12 bitï¼ˆå¥‡æ•°ä½ç»åº¦ï¼‰ é€ä½è®¡ç®—ï¼ˆå…³é”®è¿‡ç¨‹ï¼‰ 1ï¸âƒ£ ç»åº¦ bitï¼ˆ13 ä½ï¼‰ ä½æ¬¡ åŒºé—´ mid åˆ¤æ–­ bit 1 [-180,180] 0 116 â‰¥ 0 1 2 [0,180] 90 116 â‰¥ 90 1 3 [90,180] 135 116 &lt; 135 0 4 [90,135] 112.5 116 â‰¥ 112.5 1 5 [112.5,135] 123.75 116 &lt; 123.75 0 6 [112.5,123.75] 118.125 116 &lt; 118.125 0 7 [112.5,118.125] 115.3125 116 â‰¥ 115.3125 1 8 [115.3125,118.125] 116.71875 116 &lt; 116.71875 0 9 [115.3125,116.71875] 116.015625 116 â‰¥ 116.015625 1 10 [116.015625,116.71875] 116.3671875 116 â‰¥ 116.3671875 1 11 [116.3671875,116.71875] 116.54296875 116 &lt; 116.54296875 0 12 [116.3671875,116.54296875] 116.455078125 116 &lt; 116.455078125 0 13 [116.3671875,116.455078125] 116.4111328125 116 &lt; 116.4111328125 0 ç»åº¦ bitï¼ˆ13 ä½ï¼‰ï¼š1101001011000 2ï¸âƒ£ çº¬åº¦ bitï¼ˆ12 ä½ï¼‰ ä½æ¬¡ åŒºé—´ mid åˆ¤æ–­ bit 1 [-90,90] 0 39 â‰¥ 0 1 2 [0,90] 45 39 &lt; 45 0 3 [0,45] 22.5 39 â‰¥ 22.5 1 4 [22.5,45] 33.75 39 â‰¥ 33.75 1 5 [33.75,45] 39.375 39 &lt; 39.375 0 6 [33.75,39.375] 36.5625 39 â‰¥ 36.5625 1 7 [36.5625,39.375] 37.96875 39 â‰¥ 37.96875 1 8 [37.96875,39.375] 38.671875 39 â‰¥ 38.671875 1 9 [38.671875,39.375] 39.0234375 39 &lt; 39.0234375 0 10 [38.671875,39.0234375] 38.84765625 39 â‰¥ 38.84765625 1 11 [38.84765625,39.0234375] 38.935546875 39 â‰¥ 38.935546875 1 12 [38.935546875,39.0234375] 38.9794921875 39 â‰¥ 38.9794921875 1 çº¬åº¦ bitï¼ˆ12 ä½ï¼‰ï¼š101101110111 äº¤å‰åˆå¹¶ï¼ˆæœ€ç»ˆ bit åºåˆ—ï¼‰ æŒ‰è§„åˆ™ï¼šç»åº¦ â†’ çº¬åº¦ â†’ ç»åº¦ â†’ çº¬åº¦ â€¦ 12345ç»åº¦: 1 1 0 1 0 0 1 0 1 1 0 0 0çº¬åº¦: 1 0 1 1 0 1 1 1 0 1 1 1äº¤å‰åå¾—åˆ° 25 bitï¼š11 10 01 11 00 01 11 01 10 11 01 01 01åˆå¹¶ä¸ºä¸€è¡Œï¼š1110011100011101101010101 æ¯ 5 bit â†’ 1 ä¸ª Base32 å­—ç¬¦ 12345678# ä»å·¦åˆ°å³ï¼Œæ¯ 5 ä½ä¸€ç»„ï¼š11100 | 11100 | 01110 | 11010 | 10101# è½¬10è¿›åˆ¶28 | 28 | 14 | 26 | 21# è½¬ Base32w | w | f | u | p# æœ€ç»ˆç»“æœï¼šwwfup Geohash ä½¿ç”¨çš„ Base32 å­—ç¬¦é›†ï¼ˆå›ºå®šï¼Œä¸æ˜¯ RFC Base32ï¼‰ï¼š 1234567891011Index: 0 1 2 3 4 5 6 7 8 9Char : 0 1 2 3 4 5 6 7 8 9Index: 10 11 12 13 14 15 16 17 18 19Char : b c d e f g h j k mIndex: 20 21 22 23 24 25 26 27 28 29Char : n p q r s t u v w xIndex: 30 31Char : y z Geohash Base32 å­—ç¬¦é›† ä¸ºä»€ä¹ˆç¼ºå°‘ a, i, l, o ä¸ºäº†é¿å…åœ¨è§†è§‰ä¸Šå¼•èµ·æ•°å­—æ··æ·† 1234a å®¹æ˜“å’Œ 4 æ··æ·†i å®¹æ˜“å’Œ 1 æ··æ·†l å®¹æ˜“å’Œ 1 æ··æ·†o å®¹æ˜“å’Œ 0 æ··æ·† å»æ‰ a, i, l, o ååˆšå¥½æ˜¯ 32 ä¸ªå­—ç¬¦ï¼Œå› ä¸º Geohash éœ€è¦ 2âµ = 32 ä¸ªå­—ç¬¦ å¯¹åº” 5 bit ç²¾åº¦ Geo æ ¸å¿ƒåŸºç¡€æ“ä½œï¼ˆå¿…ç”¨ï¼‰ 1. GEOADDï¼šæ·»åŠ åœ°ç†ä½ç½®åæ ‡ï¼ˆæ ¸å¿ƒå†™å…¥æ“ä½œï¼‰ â—¦ è¯­æ³•ï¼š 12345678910GEOADD key [NX | XX] [CH] longitude latitude member [longitude latitude member ...]# å‚æ•°è¯´æ˜ï¼š# key: keyåç§°# NXï¼šå¦‚æœå·²å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œå†™å…¥æ“ä½œ# XX: å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œå†™å…¥æ“ä½œï¼Œä¸ NX äº’æ–¥# CH: ï¼ˆCHæ˜¯æ›´æ”¹çš„ç¼©å†™ï¼‰è¿”å›æ–°å¢å’Œä¿®æ”¹çš„æˆå‘˜æ•°é‡ï¼Œä¿®æ”¹ç»çº¬åº¦ä¹Ÿç®—ä¿®æ”¹ï¼Œå¦‚æœä¸åŠ CHï¼Œåˆ™åªè®¡ç®—æ–°å¢æˆå‘˜æ•°é‡# longitude: ç»åº¦ (-180 ~ 180)# latitude: çº¬åº¦ (-85.05112878 ~ 85.05112878)# member: æˆå‘˜åç§°ï¼Œä½ç½®å”¯ä¸€æ ‡è¯†ï¼ˆå­—ç¬¦ä¸²ï¼‰# è¿”å›å€¼ï¼š(ä¸å¸¦CH)æˆåŠŸæ–°å¢çš„ member æ•°é‡ï¼ˆå·²å­˜åœ¨ä¸ä¼šé‡å¤è®¡ç®—ï¼‰ï¼Œ(å¸¦CH)è¿”å›æ–°å¢å’Œä¿®æ”¹çš„æˆå‘˜æ•°é‡ â—¦ ç¤ºä¾‹ï¼š 1234# ç»™shopé›†åˆåŠ ç‹åºœäº•ã€è¥¿å•2ä¸ªé—¨åº—çš„ç»çº¬åº¦GEOADD shop 116.403963 39.915112 wangfujing 116.391248 39.906217 xidan# è¾“å‡º(integer) 2 â—¦ å…³é”®ï¼šç»çº¬åº¦é¡ºåºä¸èƒ½åï¼Œå­˜å‚¨åä¼šè‡ªåŠ¨ç»™æ¯ä¸ªæˆå‘˜ç”Ÿæˆgeohashç¼–ç ã€‚ 2. GEOPOSï¼šè·å–æŒ‡å®šæˆå‘˜çš„ç»çº¬åº¦ï¼ˆç²¾å‡†æŸ¥è¯¢åæ ‡ï¼‰ â—¦ è¯­æ³•ï¼š 1GEOPOS key [member [member ...]] â—¦ ç¤ºä¾‹ï¼š 12345# è¿”å›ç‹åºœäº•çš„ç»çº¬åº¦æ•°ç»„ [ç»åº¦, çº¬åº¦]GEOPOS shop wangfujing# è¾“å‡º1) 1) &quot;116.40396326780319214&quot; 2) &quot;39.91511209922290249&quot; â—¦ å…³é”®ï¼šè¿”å›ç»“æœä¸æŸ¥è¯¢æˆå‘˜é¡ºåºä¸€è‡´ï¼Œä¸å­˜åœ¨çš„æˆå‘˜è¿”å›nilï¼Œå¯æ‰¹é‡æŸ¥è¯¢æå‡æ•ˆç‡ã€‚ 3. GEODISTï¼šè®¡ç®—ä¸¤ä¸ªæˆå‘˜ä¹‹é—´çš„è·ç¦»ï¼ˆæ ¸å¿ƒè®¡ç®—æ“ä½œï¼‰ â—¦ è¯­æ³•ï¼š 123456GEODIST key member1 member2 [M|KM|FT|MI]# [M|KM|FT|MI] : è·ç¦»å•ä½# M : ç±³ï¼Œé»˜è®¤# KM : åƒç±³# FT : è‹±å°º# MI : è‹±é‡Œ â—¦ ç¤ºä¾‹ï¼š 123456789# è¿”å›ç‹åºœäº•å’Œè¥¿å•ä¹‹é—´çš„è·ç¦»ï¼Œå•ä½ä¸ºç±³GEODIST shop wangfujing xidan# è¾“å‡º&quot;1468.0611&quot;# è®¡ç®—ç‹åºœäº•åˆ°è¥¿å•çš„è·ç¦»ï¼Œå•ä½åƒç±³GEODIST shop wangfujing xidan km# è¾“å‡º&quot;1.4681&quot; â—¦ å…³é”®ï¼šè¿”å›æµ®ç‚¹å‹ç»“æœï¼Œæˆå‘˜ä¸å­˜åœ¨è¿”å›nilï¼Œæ”¯æŒè·¨åŒºåŸŸè·ç¦»è®¡ç®—ï¼ˆå¦‚ä¸åŒåŸå¸‚é—¨åº—ï¼‰ã€‚ 4. GEOHASHï¼šè·å–æŒ‡å®šæˆå‘˜çš„geohashç¼–ç ï¼ˆåº•å±‚ç¼–ç æŸ¥è¯¢ï¼‰ â—¦ è¯­æ³•ï¼š 1GEOHASH key [member [member ...]] â—¦ ç¤ºä¾‹ï¼š 1234# è¿”å›ç‹åºœäº•çš„geohashå­—ç¬¦ä¸²ï¼Œå…±11ä½GEOHASH shop wangfujing# è¾“å‡º1) &quot;wx4g0f6f2u0&quot; â—¦ å…³é”®ï¼šgeohashç¼–ç è¶Šé•¿ç²¾åº¦è¶Šé«˜ï¼ŒRedisé»˜è®¤ç²¾åº¦è¶³å¤Ÿæ—¥å¸¸ä½¿ç”¨ï¼›ç¼–ç ç›¸åŒçš„æˆå‘˜ï¼Œåœ°ç†ä½ç½®æè¿‘ï¼Œå¯ç”¨äºå¿«é€Ÿåˆ¤è¿‘ã€‚ 5. GEORADIUSï¼šæŒ‰æŒ‡å®šç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œç­›é€‰æŒ‡å®šèŒƒå›´çš„æˆå‘˜ï¼ˆèŒƒå›´æŸ¥è¯¢1ï¼ŒæŒ‰ä¸­å¿ƒç‚¹åæ ‡ï¼‰ å³å°†å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ GEOSEARCH / GEOSEARCHSTORE æ›¿ä»£ â—¦ è¯­æ³•ï¼š 12345678910111213141516GEORADIUS key longitude latitude radius M|KM|FT|MI [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count [ANY]] [ASC|DESC] [STORE key|STOREDIST key]# å‚æ•°è¯´æ˜# key: keyåç§°# longitude: ç»åº¦# latitude: çº¬åº¦# radius: åŠå¾„# M|KM|FT|MI: å•ä½## å¯é€‰å‚æ•°# WITHCOORD: è¿”å›ç»çº¬åº¦# WITHDIST: å¸¦è·ç¦»# WITHHASH: å¸¦geohash# COUNT count: é™åˆ¶è¿”å›æ•°é‡# ANY: éšæœºè¿”å›æ•°é‡# ASC/DESC: æŒ‰è·ç¦»æ­£/å€’åº# STORE key: å­˜å‚¨ç»“æœåˆ°æŒ‡å®škey# STOREDIST key: å­˜å‚¨ç»“æœåˆ°æŒ‡å®škeyï¼Œç»“æœä¸ºè·ç¦» â—¦ æ ¸å¿ƒå¯é€‰å‚æ•°ï¼šWITHDISTï¼ˆè¿”å›è·ç¦»ï¼‰ã€WITHCOORDï¼ˆè¿”å›ç»çº¬åº¦ï¼‰ã€WITHHASHï¼ˆè¿”å›geohashï¼‰ã€COUNT nï¼ˆé™åˆ¶è¿”å›æ•°é‡ï¼‰ã€ASC/DESCï¼ˆæŒ‰è·ç¦»æ­£/å€’åºï¼‰ â—¦ ç¤ºä¾‹ï¼š 1234567# ä»¥å¤©å®‰é—¨é™„è¿‘ä¸ºä¸­å¿ƒï¼ŒæŸ¥5kmå†…10ä¸ªé—¨åº—ï¼ŒæŒ‰è·ç¦»ä»è¿‘åˆ°è¿œè¿”å›å¹¶å¸¦è·ç¦»GEORADIUS shop 116.397 39.91 5 km WITHDIST COUNT 10 ASC# è¾“å‡º1) 1) &quot;xidan&quot; 2) &quot;0.6463&quot;2) 1) &quot;wangfujing&quot; 2) &quot;0.8223&quot; 6. GEORADIUSBYMEMBERï¼šæŒ‰å·²æœ‰æˆå‘˜ä¸ºä¸­å¿ƒï¼Œç­›é€‰æŒ‡å®šèŒƒå›´çš„æˆå‘˜ï¼ˆèŒƒå›´æŸ¥è¯¢2ï¼ŒæŒ‰å·²æœ‰èŠ‚ç‚¹ï¼Œæ›´å¸¸ç”¨ï¼‰ å³å°†å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ GEOSEARCH / GEOSEARCHSTORE æ›¿ä»£ â—¦ è¯­æ³•ï¼š 1234567GEORADIUSBYMEMBER key member radius M|KM|FT|MI [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count [ANY]] [ASC|DESC] [STORE key|STOREDIST key]# è¯­æ³•è¯´æ˜ï¼š# key: keyåç§°# member: å·²æœ‰æˆå‘˜åç§°# radius: åŠå¾„# M|KM|FT|MI: å•ä½## å¯é€‰å‚æ•°è¯´æ˜åŒ GEORADIUS â—¦ å¯é€‰å‚æ•°ä¸GEORADIUSä¸€è‡´ï¼Œåœºæ™¯æ›´è´´åˆå®é™…ï¼ˆå¦‚æŸ¥â€œæˆ‘é™„è¿‘â€çš„é—¨åº—ï¼Œå…ˆå­˜è‡ªå·±çš„åæ ‡ä¸ºæˆå‘˜ï¼Œå†ç”¨æ­¤å‘½ä»¤ï¼‰ â—¦ ç¤ºä¾‹ï¼š 1234567# æŸ¥ç‹åºœäº•3kmå†…çš„é—¨åº—ï¼ŒæŒ‰è·ç¦»æ’åºGEORADIUSBYMEMBER shop wangfujing 3 km WITHDIST ASC# è¾“å‡º1) 1) &quot;wangfujing&quot; 2) &quot;0.0000&quot;2) 1) &quot;xidan&quot; 2) &quot;1.4681&quot; Geo æ‰©å±•æ“ä½œï¼ˆå®æˆ˜å¸¸ç”¨ï¼‰ 1. GEOSEARCHï¼ˆRedis 6.2+ æ–°å¢ï¼Œæ›¿ä»£ GEORADIUS/GEORADIUSBYMEMBERï¼‰ â—¦ ä¼˜åŠ¿ï¼šåŠŸèƒ½æ›´å…¨ã€è¯­æ³•æ›´ç»Ÿä¸€ï¼Œæ”¯æŒä¸¤ç§æŸ¥è¯¢æ¨¡å¼ï¼Œæ˜¯æœªæ¥ä¸»æµç”¨æ³• 123GEOSEARCH key &lt;FROMMEMBER member | FROMLONLAT longitude latitude&gt; &lt;BYRADIUS radius &lt;M | KM | FT | MI&gt; | BYBOX width height &lt;M | KM | FT | MI&gt;&gt; [ASC | DESC] [COUNT count [ANY]] [WITHCOORD] [WITHDIST] [WITHHASH] â—¦ è¯­æ³•1ï¼ˆæŒ‰åæ ‡ä¸­å¿ƒï¼‰ï¼šGEOSEARCH key FROMLONLAT ç»åº¦ çº¬åº¦ BYRADIUS è·ç¦» å•ä½ [å¯é€‰å‚æ•°] 12345678910111213# æŸ¥å¤©å®‰é—¨3kmå†…çš„é—¨åº—ï¼ŒæŒ‰è·ç¦»æ’åºGEOSEARCH shop FROMLONLAT 116.397 39.91 BYRADIUS 3 km WITHDIST WITHCOORD WITHHASH ASC COUNT 10# è¾“å‡º1) 1) &quot;xidan&quot; 2) &quot;0.6463&quot; 3) (integer) 4069885362016563 4) 1) &quot;116.39124959707260132&quot; 2) &quot;39.90621776267477827&quot;2) 1) &quot;wangfujing&quot; 2) &quot;0.8223&quot; 3) (integer) 4069885555089518 4) 1) &quot;116.40396326780319214&quot; 2) &quot;39.91511209922290249&quot; â—¦ è¯­æ³•2ï¼ˆæŒ‰æˆå‘˜ä¸­å¿ƒï¼‰ï¼šGEOSEARCH key FROMMEMBER ä¸­å¿ƒæˆå‘˜ BYRADIUS è·ç¦» å•ä½ [å¯é€‰å‚æ•°] 12345678910111213# æŸ¥ç‹åºœäº•3kmå†…çš„é—¨åº—ï¼ŒæŒ‰è·ç¦»æ’åºGEOSEARCH shop FROMMEMBER wangfujing BYRADIUS 3 km WITHDIST WITHCOORD WITHHASH ASC COUNT 10# è¾“å‡º1) 1) &quot;wangfujing&quot; 2) &quot;0.0000&quot; 3) (integer) 4069885555089518 4) 1) &quot;116.40396326780319214&quot; 2) &quot;39.91511209922290249&quot;2) 1) &quot;xidan&quot; 2) &quot;1.4681&quot; 3) (integer) 4069885362016563 4) 1) &quot;116.39124959707260132&quot; 2) &quot;39.90621776267477827&quot; â—¦ æ–°å¢ç‰¹æ€§ï¼šæ”¯æŒ BYBOXï¼ˆæŒ‰çŸ©å½¢èŒƒå›´æŸ¥è¯¢ï¼‰ï¼Œé€‚é…æ›´å¤šåœºæ™¯ï¼ˆå¦‚æŸ¥è¯¢æŸç‰‡åŒºå†…çš„é—¨åº—ï¼‰ã€‚ 123456789# æŸ¥ç‹åºœäº•2.0*2.0kmå†…çš„é—¨åº—ï¼ŒæŒ‰è·ç¦»æ’åºï¼Œè¿™é‡Œä»¥ ç‹åºœäº• ä¸ºçŸ©å½¢çš„ä¸­å¿ƒï¼ŒæŸ¥è¯¢2.0*2.0kmå†…çš„é—¨åº—# è¥¿å•è·ç¦»ç‹åºœäº• 1.4681 kmï¼Œæ‰€ä»¥ä¸åœ¨ç»“æœä¸­GEOSEARCH shop FROMMEMBER wangfujing BYBOX 2.0 2.0 km WITHDIST WITHCOORD WITHHASH ASC COUNT 10# è¾“å‡º1) 1) &quot;wangfujing&quot; 2) &quot;0.0000&quot; 3) (integer) 4069885555089518 4) 1) &quot;116.40396326780319214&quot; 2) &quot;39.91511209922290249&quot; 2. GEOSEARCHSTOREï¼ˆRedis 6.2+ æ–°å¢ï¼‰ â—¦ ä½œç”¨ï¼šå°† GEOSEARCH çš„æŸ¥è¯¢ç»“æœï¼Œç›´æ¥å­˜å‚¨åˆ°æŒ‡å®šzsetä¸­ï¼Œæ–¹ä¾¿åç»­äºŒæ¬¡å¤„ç†ï¼ˆå¦‚åˆ†é¡µã€æ’åºï¼‰ â—¦ è¯­æ³•ï¼šGEOSEARCHSTORE ç›®æ ‡key æºkey æŸ¥è¯¢æ¡ä»¶ï¼ˆåŒGEOSEARCHï¼‰ 1234GEOSEARCHSTORE destination source &lt;FROMMEMBER member | FROMLONLAT longitude latitude&gt; &lt;BYRADIUS radius &lt;M | KM | FT | MI&gt; | BYBOX width height &lt;M | KM | FT | MI&gt;&gt; [ASC | DESC] [COUNT count [ANY]] [STOREDIST] â—¦ ç¤ºä¾‹ï¼š 12# æŠŠç‹åºœäº•3kmå†…çš„é—¨åº—ï¼Œå­˜åˆ°near_shopé›†åˆGEOSEARCHSTORE near_shop shop FROMMEMBER wangfujing BYRADIUS 3 km åº•å±‚æ ¸å¿ƒä¸å®æˆ˜æ³¨æ„äº‹é¡¹ åº•å±‚æœ¬è´¨ï¼šæ‰€æœ‰Geoæ“ä½œçš„keyï¼Œæœ¬è´¨éƒ½æ˜¯zsetï¼Œå› æ­¤zsetçš„å‘½ä»¤ï¼ˆå¦‚ZREMã€ZSCOREï¼‰å¯ç›´æ¥ç”¨äºGeo keyï¼Œä¾‹å¦‚ ZREM shop xidan å¯åˆ é™¤è¥¿å•çš„åœ°ç†ä½ç½®ï¼ˆGeoæ— å•ç‹¬åˆ é™¤å‘½ä»¤ï¼Œä¾èµ–ZREMï¼‰ã€‚ ç²¾åº¦é™åˆ¶ï¼šç»çº¬åº¦æ”¯æŒå°æ•°ç‚¹åå¤šä½ï¼Œä½†Rediså†…éƒ¨ä¼šåšç²¾åº¦å–èˆï¼Œæ—¥å¸¸åœºæ™¯ï¼ˆå¦‚æ‰“è½¦ã€é—¨åº—ï¼‰å®Œå…¨å¤Ÿç”¨ï¼Œæ— éœ€é¢å¤–å¤„ç†ã€‚ æ€§èƒ½ä¼˜åŒ–ï¼šå¤§èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚100kmä»¥ä¸Šï¼‰å»ºè®®åŠ COUNTé™åˆ¶è¿”å›æ•°é‡ï¼›é«˜é¢‘æŸ¥è¯¢å¯å°†ç»“æœç¼“å­˜åˆ°æ™®é€škeyï¼Œå‡å°‘Geoè®¡ç®—å¼€é”€ã€‚ é€‚ç”¨åœºæ™¯ï¼šé™„è¿‘é—¨åº—ã€åŒåŸç¤¾äº¤ã€ç‰©æµå®šä½ï¼Œä¸é€‚ç”¨é«˜ç²¾åº¦åœºæ™¯ï¼ˆå¦‚å†›äº‹ã€æµ‹ç»˜ï¼‰ï¼Œæ­¤ç±»åœºæ™¯éœ€ç”¨ä¸“ä¸šGISç³»ç»Ÿã€‚ å…¸å‹å®æˆ˜åœºæ™¯ç¤ºä¾‹ éœ€æ±‚ï¼šæ­å»ºâ€œé™„è¿‘é¤é¥®â€æŸ¥è¯¢åŠŸèƒ½ï¼Œæ”¯æŒæ·»åŠ é¤é¥®åæ ‡ã€æŸ¥è¯¢å½“å‰ä½ç½®3kmå†…é¤é¥®å¹¶æŒ‰è·ç¦»æ’åºã€‚ 12345678# 1. æ‰¹é‡æ·»åŠ é¤é¥®åæ ‡GEOADD restaurant 116.405 39.916 aaa 116.402 39.913 bbb 116.408 39.918 ccc# 2. æŸ¥å½“å‰ä½ç½®ï¼ˆ116.404,39.915ï¼‰3kmå†…é¤é¥®ï¼ˆå¸¦è·ç¦»ã€æ­£åºï¼‰GEOSEARCH restaurant FROMLONLAT 116.404 39.915 BYRADIUS 3 km WITHDIST ASC# 3. åˆ é™¤æŸé¤é¥®ZREM restaurant aaa Geo å‘½ä»¤ SpringBoot çš„ StringRedisTemplate.opsForGeo() ä¸­ Geo æ•°æ®ç±»å‹ çš„æ“ä½œæ–¹æ³•ä¸ Redis åŸç”Ÿå‘½ä»¤çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š æ³¨æ„è¿™é‡Œä¸€å®šè¦ç”¨ StringRedisTemplate æ¥æ“ä½œ Geo å†™å…¥ / åˆ é™¤ç±»æ“ä½œ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ å¤‡æ³¨ æ·»åŠ å•ä¸ªåæ ‡ add(K key, Point point, M member) GEOADD key longitude latitude member è¿”å› æ–°å¢æˆå‘˜æ•°é‡ï¼ˆå·²å­˜åœ¨åˆ™è¿”å› 0ï¼‰ æ·»åŠ å•ä¸ªä½ç½® add(K key, GeoLocation&lt;M&gt; location) GEOADD key longitude latitude member GeoLocation å†…éƒ¨å°è£…äº† Point + member æ‰¹é‡æ·»åŠ  add(K key, Map&lt;M, Point&gt; map) GEOADD key lon1 lat1 member1 [lon2 lat2 member2 ...] æ¨èï¼Œä¸€æ¬¡ç½‘ç»œ IO æ‰¹é‡æ·»åŠ  add(K key, Iterable&lt;GeoLocation&lt;M&gt;&gt; locations) GEOADD key lon1 lat1 member1 [lon2 lat2 member2 ...] ä¸ Map æ–¹å¼ç­‰ä»· åˆ é™¤æˆå‘˜ remove(K key, M... members) ZREM key member [member ...] GEO æœ¬è´¨æ˜¯ Sorted Set 12345Point point = new Point(longitude, latitude);redisTemplate.opsForGeo().add(key, point, member);RedisGeoCommands.GeoLocation&lt;String&gt; geoLocation= new RedisGeoCommands.GeoLocation&lt;&gt;(member, point);redisTemplate.opsForGeo().add(key, geoLocation); è·ç¦» / åæ ‡ / å“ˆå¸ŒæŸ¥è¯¢ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ è¯´æ˜ ä¸¤ç‚¹è·ç¦» distance(K key, m1, m2) GEODIST key m1 m2 é»˜è®¤å•ä½ç±³ æŒ‡å®šå•ä½è·ç¦» distance(K key, m1, m2, metric) GEODIST key m1 m2 unit m / km / mi / ft è·å– GeoHash hash(K key, M... members) GEOHASH key member ç”¨äºè°ƒè¯• è·å–åæ ‡ position(K key, M... members) GEOPOS key member lon / lat åŠå¾„æŸ¥è¯¢ï¼ˆæ—§æ¥å£ï¼Œå·²ä¸æ¨èï¼‰ Redis 6.2 èµ·ï¼Œå®˜æ–¹ä¸æ¨èç»§ç»­ä½¿ç”¨ GEORADIUS / GEORADIUSBYMEMBERï¼Œä½† Spring ä»ä¿ç•™æ¥å£ä»¥å…¼å®¹ã€‚ 1ï¸âƒ£ åŸºäºåæ ‡ç‚¹ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ åŠå¾„æŸ¥è¯¢ radius(K key, Circle within) GEORADIUS key lon lat radius åŠå¾„ + å‚æ•° radius(K key, Circle within, args) GEORADIUS 2ï¸âƒ£ åŸºäºæˆå‘˜ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ åŠå¾„æŸ¥è¯¢ radius(K key, member, radius) GEORADIUSBYMEMBER æŒ‡å®šå•ä½ radius(K key, member, Distance) GEORADIUSBYMEMBER å¸¦å‚æ•° radius(K key, member, Distance, args) GEORADIUSBYMEMBER æœç´¢æŸ¥è¯¢ï¼ˆæ¨èä½¿ç”¨ GEOSEARCHï¼‰ æ›¿ä»£ GEORADIUS / GEORADIUSBYMEMBER 1ï¸âƒ£ æŒ‰åœ†å½¢èŒƒå›´æœç´¢ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ è¯´æ˜ åœ†å½¢æœç´¢ search(K key, Circle within) GEOSEARCH æ–°æ¨èæ¥å£ æŒ‡å®šå‚è€ƒç‚¹ search(K key, GeoReference, Distance) GEOSEARCH FROMMEMBER / FROMLONLAT å¸¦å‚æ•° search(K key, reference, radius, args) GEOSEARCH æ”¯æŒæ’åºã€limit 2ï¸âƒ£ æŒ‰çŸ©å½¢èŒƒå›´æœç´¢ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ çŸ©å½¢æœç´¢ search(K key, reference, BoundingBox) GEOSEARCH å¸¦å‚æ•° search(K key, reference, BoundingBox, args) GEOSEARCH é€šç”¨æœç´¢ï¼ˆåº•å±‚èƒ½åŠ›ï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ ä»»æ„ GeoShape search(K key, reference, GeoShape, args) GEOSEARCH 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162// åŸºäºç»™å®šçš„åæ ‡æœç´¢public void search(String key, double longitude, double latitude, double radius) &#123; // ä¸­å¿ƒç‚¹ Point point = new Point(longitude, latitude); // åŠå¾„ Distance distance = new Distance(radius, RedisGeoCommands.DistanceUnit.METERS); // åˆ›å»ºåœ†å½¢ Circle circle = new Circle(point, distance); // åˆ›å»ºåœ°ç†å‚è€ƒ GeoReference&lt;String&gt; objectGeoReference = GeoReference.fromCircle(circle); // åˆ›å»ºåœ°ç†å½¢çŠ¶ GeoShape geoShape = GeoShape.byRadius(distance); // åˆ›å»ºå‚æ•° RedisGeoCommands.GeoRadiusCommandArgs args = RedisGeoCommands.GeoRadiusCommandArgs.newGeoRadiusArgs() .includeCoordinates() // è¿”å›åæ ‡ .includeDistance() // è¿”å›è·ç¦» .sortAscending() // æ’åº .limit(10); // é™åˆ¶è¿”å›æ•°é‡ // æŸ¥è¯¢ final GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; results = redisTemplate.opsForGeo().search(key, objectGeoReference, geoShape, args); if (results != null) &#123; results.forEach(result -&gt; &#123; // è·å–æˆå‘˜åç§° System.out.println(result.getContent().getName()); // è·å–åæ ‡ System.out.println(result.getContent().getPoint()); // è·å–è·ç¦» System.out.println(result.getDistance()); &#125;); &#125;&#125;// åŸºäºæˆå‘˜çš„åæ ‡æœç´¢public void search(String key, String member, double radius) &#123; // åŠå¾„ Distance distance = new Distance(radius, RedisGeoCommands.DistanceUnit.METERS); // åˆ›å»ºåœ°ç†å‚è€ƒ GeoReference&lt;String&gt; objectGeoReference = GeoReference.fromMember(member); // åˆ›å»ºåœ°ç†å½¢çŠ¶ GeoShape geoShape = GeoShape.byRadius(distance); // åˆ›å»ºå‚æ•° RedisGeoCommands.GeoRadiusCommandArgs args = RedisGeoCommands.GeoRadiusCommandArgs.newGeoRadiusArgs() .includeCoordinates() // è¿”å›åæ ‡ .includeDistance() // è¿”å›è·ç¦» .sortAscending() // æ’åº .limit(10); // é™åˆ¶è¿”å›æ•°é‡ // æŸ¥è¯¢ final GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; results = redisTemplate.opsForGeo().search(key, objectGeoReference, geoShape, args); if (results != null) &#123; results.forEach(result -&gt; &#123; // è·å–æˆå‘˜åç§° System.out.println(result.getContent().getName()); // è·å–åæ ‡ System.out.println(result.getContent().getPoint()); // è·å–è·ç¦» System.out.println(result.getDistance()); &#125;); &#125;&#125; æœç´¢å¹¶å­˜å‚¨ï¼ˆGEOSEARCHSTOREï¼‰ è¿™æ˜¯ æœç´¢ + å†™å…¥ çš„ç»„åˆæ“ä½œï¼Œç»“æœä¼šå†™å…¥æ–°çš„ ZSet 1ï¸âƒ£ åœ†å½¢èŒƒå›´å­˜å‚¨ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ æœç´¢å¹¶å­˜å‚¨ searchAndStore(K key, destKey, Circle) GEOSEARCHSTORE æŒ‡å®šå‚è€ƒç‚¹ searchAndStore(K key, destKey, reference, radius) GEOSEARCHSTORE å¸¦å‚æ•° searchAndStore(K key, destKey, reference, radius, args) GEOSEARCHSTORE 2ï¸âƒ£ çŸ©å½¢èŒƒå›´å­˜å‚¨ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ çŸ©å½¢å­˜å‚¨ searchAndStore(K key, destKey, reference, BoundingBox) GEOSEARCHSTORE å¸¦å‚æ•° searchAndStore(K key, destKey, reference, BoundingBox, args) GEOSEARCHSTORE 3ï¸âƒ£ é€šç”¨ GeoShape å­˜å‚¨ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ é€šç”¨å­˜å‚¨ searchAndStore(K key, destKey, reference, GeoShape, args) GEOSEARCHSTORE","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis Geo æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/","date_published":"2025-12-19T13:40:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/19/redis7-datatype-08-hyperloglog/","url":"https://blog.hanqunfeng.com/2025/12/19/redis7-datatype-08-hyperloglog/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- Hyperloglog","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis Hyperloglog æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Hyperloglog-æ ¸å¿ƒè¯¦è§£\">Hyperloglog æ ¸å¿ƒè¯¦è§£</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redis HyperLogLog æ˜¯ä¸“é—¨ç”¨äºåšåŸºæ•°ç»Ÿè®¡çš„é«˜çº§æ•°æ®ç±»å‹ï¼Œæ ¸å¿ƒä¼˜åŠ¿æ˜¯ç”¨æå°çš„å†…å­˜ï¼ˆå›ºå®šçº¦ <code>12KB</code>ï¼‰å°±èƒ½ç»Ÿè®¡æµ·é‡æ•°æ®çš„åŸºæ•°ï¼Œè¯¯å·®ç‡ä»… <code>0.81%</code>ï¼Œæ— éœ€å­˜å‚¨å…¨éƒ¨æ•°æ®æœ¬èº«ã€‚</p>\n</li>\n</ul>\n<blockquote>\n<p>åŸºæ•°ï¼šæŒ‡é›†åˆä¸­ä¸é‡å¤å…ƒç´ çš„æ•°é‡ï¼ˆæ¯”å¦‚ç»Ÿè®¡ UVï¼Œå°±æ˜¯ä¸é‡å¤è®¿å®¢çš„æ•°é‡ï¼‰ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redis Hyperloglog å¹¶éç‹¬ç«‹æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯åŸºäº String ç±»å‹çš„ä½æ“ä½œæ‰©å±•</p>\n</li>\n</ul>\n<h2 id=\"æ ¸å¿ƒä½¿ç”¨æ–¹å¼ï¼ˆ3ä¸ªæ ¸å¿ƒå‘½ä»¤ï¼‰\">æ ¸å¿ƒä½¿ç”¨æ–¹å¼ï¼ˆ3ä¸ªæ ¸å¿ƒå‘½ä»¤ï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>HyperLogLog å‘½ä»¤æç®€ï¼Œåªæœ‰ 3 ä¸ªæ ¸å¿ƒæ“ä½œ</p>\n</li>\n</ul>\n<h3 id=\"PFADD\">PFADD</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘ HyperLogLog ä¸­æ·»åŠ 1ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼ŒæˆåŠŸæ·»åŠ ï¼ˆå…ƒç´ æœªå­˜åœ¨ï¼‰è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PFADD key [element [element ...]]</span><br></pre></td></tr></table></figure>\n<h3 id=\"PFCOUNT\">PFCOUNT</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»Ÿè®¡å•ä¸ª/å¤šä¸ª HyperLogLog çš„åŸºæ•°ï¼ˆå»é‡æ€»æ•°ï¼‰ï¼Œå¤š key ä¼ å…¥æ—¶ä¼šè®¡ç®—æ‰€æœ‰ key çš„å¹¶é›†åŸºæ•°ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PFCOUNT key [key ...]</span><br></pre></td></tr></table></figure>\n<h3 id=\"PFMERGE\">PFMERGE</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°†å¤šä¸ªæº HyperLogLog åˆå¹¶ä¸º1ä¸ªç›®æ ‡ HyperLogLogï¼Œé€‚ç”¨äºè·¨ç»´åº¦æ±‡æ€»ç»Ÿè®¡ï¼ˆæ¯”å¦‚åˆå¹¶ä»Šæ—¥ã€æ˜¨æ—¥çš„ UV å¾—åˆ°ä¸¤æ—¥æ€» UVï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PFMERGE destkey [sourcekey [sourcekey ...]]</span><br></pre></td></tr></table></figure>\n<h2 id=\"å®æ“ç¤ºä¾‹\">å®æ“ç¤ºä¾‹</h2>\n<h3 id=\"ç¤ºä¾‹1ï¼šå•-key-åŸºç¡€ç»Ÿè®¡ï¼ˆç»Ÿè®¡ç½‘ç«™-UVï¼‰\">ç¤ºä¾‹1ï¼šå• key åŸºç¡€ç»Ÿè®¡ï¼ˆç»Ÿè®¡ç½‘ç«™ UVï¼‰</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. æ¨¡æ‹Ÿ3ä¸ªè®¿å®¢è®¿é—®ï¼Œå…¶ä¸­ç”¨æˆ·Aé‡å¤è®¿é—®</span></span><br><span class=\"line\">127.0.0.1:6379&gt; PFADD uv:20251218 userA userB userC</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; PFADD uv:20251218 userA</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. ç»Ÿè®¡å½“æ—¥UVï¼ˆå»é‡åæ˜¯3ï¼Œå¿½ç•¥é‡å¤çš„userAï¼‰</span></span><br><span class=\"line\">127.0.0.1:6379&gt; PFCOUNT uv:20251218</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹2ï¼š-å¤š-key-åˆå¹¶ä¸æ±‡æ€»ç»Ÿè®¡\">ç¤ºä¾‹2ï¼š å¤š key åˆå¹¶ä¸æ±‡æ€»ç»Ÿè®¡</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. åˆ†åˆ«ç»Ÿè®¡12.17å’Œ12.18çš„UV</span></span><br><span class=\"line\">127.0.0.1:6379&gt; PFADD uv:20251217 userA userD</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; PFADD uv:20251218 userA userB userC</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. åˆå¹¶ä¸¤æ—¥UVåˆ° uv:20251217_18</span></span><br><span class=\"line\">127.0.0.1:6379&gt; PFMERGE uv:20251217_18 uv:20251217 uv:20251218</span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. ç»Ÿè®¡ä¸¤æ—¥æ€»UVï¼ˆå¹¶é›†å»é‡ï¼Œç»“æœä¸º4ï¼šuserAã€Bã€Cã€Dï¼‰</span></span><br><span class=\"line\">127.0.0.1:6379&gt; PFCOUNT uv:20251217_18</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ ¸å¿ƒåº”ç”¨åœºæ™¯ï¼ˆç²¾å‡†è½åœ°åœºæ™¯ï¼‰\">æ ¸å¿ƒåº”ç”¨åœºæ™¯ï¼ˆç²¾å‡†è½åœ°åœºæ™¯ï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>HyperLogLog åªå…³æ³¨ <strong>â€œå»é‡æ•°é‡â€</strong>ï¼Œä¸å…³æ³¨â€œå…·ä½“å…ƒç´ æ˜¯è°â€ï¼Œé€‚åˆä»¥ä¸‹é«˜é¢‘åœºæ™¯ï¼Œä¹Ÿæ˜¯ä¼ä¸šçº§å¸¸ç”¨æ–¹æ¡ˆï¼š</p>\n</li>\n</ul>\n<ol>\n<li class=\"lvl-3\">\n<p>ç½‘ç«™/APP UV ç»Ÿè®¡ï¼šæ›¿ä»£ä¼ ç»Ÿçš„ Set å­˜å‚¨ï¼ˆSet å­˜æµ·é‡ UV å†…å­˜å ç”¨æé«˜ï¼‰ï¼Œå• key ä»… 12KBï¼Œè½»æ¾ç»Ÿè®¡ç™¾ä¸‡/åƒä¸‡çº§ UVã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>ä¸šåŠ¡åœºæ™¯å»é‡è®¡æ•°ï¼šæ¯”å¦‚ç»Ÿè®¡å•æ—¥/å•æœˆçš„ç‹¬ç«‹æ”¯ä»˜ç”¨æˆ·æ•°ã€ç‹¬ç«‹ä¸‹å•ç”¨æˆ·æ•°ã€ç‹¬ç«‹ç‚¹å‡»å•†å“çš„ç”¨æˆ·æ•°ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>æµ·é‡æ•°æ®å»é‡ç»Ÿè®¡ï¼šæ¯”å¦‚ç»Ÿè®¡æŸæ¥å£çš„ç‹¬ç«‹è°ƒç”¨ IP æ•°ã€æŸç›´æ’­é—´çš„ç‹¬ç«‹è§‚çœ‹äººæ•°ã€æŸå¹¿å‘Šçš„ç‹¬ç«‹æ›å…‰æ•°ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>è·¨ç»´åº¦æ±‡æ€»ç»Ÿè®¡ï¼šæ¯”å¦‚åˆå¹¶ä¸åŒæ¸ é“ï¼ˆAPPã€å°ç¨‹åºã€H5ï¼‰çš„ç‹¬ç«‹è®¿å®¢æ•°ï¼Œå¾—åˆ°å…¨æ¸ é“æ€»è®¿å®¢æ•°ã€‚</p>\n</li>\n</ol>\n<h2 id=\"å…³é”®æ³¨æ„äº‹é¡¹ï¼ˆé¿å‘é‡ç‚¹ï¼‰\">å…³é”®æ³¨æ„äº‹é¡¹ï¼ˆé¿å‘é‡ç‚¹ï¼‰</h2>\n<ol>\n<li class=\"lvl-3\">\n<p>ä¸å­˜å‚¨å…·ä½“å…ƒç´ ï¼Œä»…å­˜ç»Ÿè®¡ç»“æœï¼šæ— æ³•åƒ Set é‚£æ ·è·å–é›†åˆä¸­çš„å…·ä½“å…ƒç´ ï¼ˆæ¯”å¦‚æ— æ³•é€šè¿‡ HyperLogLog æŸ¥åˆ°å…·ä½“æ˜¯å“ªäº›ç”¨æˆ·è®¿é—®äº†ç½‘ç«™ï¼‰ï¼Œåªå…³å¿ƒâ€œæœ‰å¤šå°‘ä¸ªâ€ï¼Œä¸å…³å¿ƒâ€œæ˜¯è°â€ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>è¯¯å·®ä¸å¯é¿å…ï¼Œå¯æ§ä¸å½±å“å¤§éƒ¨åˆ†åœºæ™¯ï¼šå›ºå®šè¯¯å·®ç‡ <code>0.81%</code>ï¼Œæ•°æ®é‡è¶Šå¤§è¯¯å·®è¶Šç¨³å®šï¼ŒUVã€ç‹¬ç«‹ç”¨æˆ·æ•°ç­‰åœºæ™¯å¯¹ç²¾åº¦è¦æ±‚ä¸é«˜ï¼Œå®Œå…¨å¤Ÿç”¨ï¼›è‹¥éœ€ 100% ç²¾å‡†ï¼ˆæ¯”å¦‚ç»Ÿè®¡æ ¸å¿ƒäº¤æ˜“ç”¨æˆ·æ•°ï¼‰ï¼Œéœ€ç”¨ Set æˆ– Hash å®ç°ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>å†…å­˜å ç”¨å›ºå®šï¼Œä¸æ•°æ®é‡æ— å…³ï¼šæ— è®ºç»Ÿè®¡ 10 ä¸ªè¿˜æ˜¯ 1 äº¿ä¸ªå…ƒç´ ï¼Œå•ä¸ª HyperLogLog å ç”¨å†…å­˜çº¦ <code>12KB</code>ï¼Œè¿™æ˜¯å…¶æ ¸å¿ƒä¼˜åŠ¿ï¼Œä¹Ÿæ˜¯åŒºåˆ«äº Set çš„å…³é”®ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>å…ƒç´ æ”¯æŒå­—ç¬¦ä¸²ç±»å‹ï¼šPFADD ä¼ å…¥çš„å…ƒç´ å¿…é¡»æ˜¯å­—ç¬¦ä¸²/å­—èŠ‚ç±»å‹ï¼Œä¸æ”¯æŒå…¶ä»–æ•°æ®ç±»å‹ï¼ˆå¦‚æ•°å­—ã€åˆ—è¡¨ç­‰ï¼Œéœ€æ‰‹åŠ¨è½¬ä¸ºå­—ç¬¦ä¸²ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>è¿‡æœŸæ—¶é—´æ”¯æŒï¼šHyperLogLog æœ¬èº«ä¸è‡ªå¸¦è¿‡æœŸæœºåˆ¶ï¼Œä½†å¯é€šè¿‡ <code>EXPIRE key seconds</code> ç»™å…¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ¯”å¦‚ UV ç»Ÿè®¡æŒ‰æ—¥è¿‡æœŸï¼Œé¿å…å†…å­˜å †ç§¯ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>PFADD å¹‚ç­‰æ€§ï¼šé‡å¤æ·»åŠ åŒä¸€å…ƒç´ ï¼Œä¸ä¼šæ”¹å˜åŸºæ•°ç»“æœï¼Œä¹Ÿä¸ä¼šé¢å¤–å ç”¨å†…å­˜ï¼Œå¯æ”¾å¿ƒé‡å¤è°ƒç”¨ã€‚</p>\n</li>\n</ol>\n<h2 id=\"ä¸-Set-ç»Ÿè®¡åŸºæ•°çš„å¯¹æ¯”ï¼ˆé€‰å‹å‚è€ƒï¼‰\">ä¸ Set ç»Ÿè®¡åŸºæ•°çš„å¯¹æ¯”ï¼ˆé€‰å‹å‚è€ƒï¼‰</h2>\n<table>\n<thead>\n<tr>\n<th>å¯¹æ¯”ç»´åº¦</th>\n<th>HyperLogLog</th>\n<th>Set</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ•°æ®ç»“æ„ç±»å‹</td>\n<td>åŸºæ•°ç»Ÿè®¡ç»“æ„</td>\n<td>æ— åºé›†åˆ</td>\n</tr>\n<tr>\n<td>å†…å­˜å ç”¨</td>\n<td>å›ºå®šçº¦ <strong>12KB</strong>ï¼Œä¸æ•°æ®é‡æ— å…³</td>\n<td>éšå…ƒç´ æ•°é‡çº¿æ€§å¢é•¿ï¼Œæµ·é‡æ•°æ®å†…å­˜å ç”¨æé«˜</td>\n</tr>\n<tr>\n<td>ç»Ÿè®¡ç»“æœç²¾åº¦</td>\n<td><strong>éç²¾å‡†</strong>ï¼Œæ ‡å‡†è¯¯å·®çº¦ <strong>0.81%</strong></td>\n<td><strong>100% ç²¾å‡†</strong></td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ”¯æŒè·å–å…·ä½“å…ƒç´ </td>\n<td>ä¸æ”¯æŒ</td>\n<td>æ”¯æŒï¼ˆå¦‚ <code>SMEMBERS</code>ï¼‰</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ”¯æŒå»é‡</td>\n<td>æ”¯æŒï¼ˆåŸºæ•°å»é‡ï¼‰</td>\n<td>æ”¯æŒï¼ˆå…ƒç´ çº§å»é‡ï¼‰</td>\n</tr>\n<tr>\n<td>ç»Ÿè®¡æ€§èƒ½</td>\n<td>æå¿«ï¼ˆå›ºå®šè®¡ç®—é€»è¾‘ï¼ŒO(1)ï¼‰</td>\n<td>æ•°æ®é‡è¶Šå¤§ï¼Œç»Ÿè®¡ä¸éå†æˆæœ¬è¶Šé«˜</td>\n</tr>\n<tr>\n<td>é€‚åˆæ•°æ®è§„æ¨¡</td>\n<td>è¶…å¤§è§„æ¨¡ï¼ˆç™¾ä¸‡ / åƒä¸‡ / äº¿çº§ï¼‰</td>\n<td>ä¸­å°è§„æ¨¡é›†åˆ</td>\n</tr>\n<tr>\n<td>å¸¸è§ä½¿ç”¨åœºæ™¯</td>\n<td>UV / DAU ç»Ÿè®¡ã€ç‹¬ç«‹ IP æ•°ã€è®¿é—®ç”¨æˆ·æ•°</td>\n<td>å¥½å‹åˆ—è¡¨ã€æ ‡ç­¾é›†åˆã€å…³æ³¨åˆ—è¡¨</td>\n</tr>\n<tr>\n<td>æ˜¯å¦å¯åšé›†åˆè¿ç®—</td>\n<td>ä¸æ”¯æŒ</td>\n<td>æ”¯æŒï¼ˆ<code>SUNION</code> / <code>SINTER</code> / <code>SDIFF</code>ï¼‰</td>\n</tr>\n<tr>\n<td>æ˜¯å¦å¯åºåˆ—åŒ–/æŒä¹…åŒ–</td>\n<td>å¯ï¼ˆRedis å†…éƒ¨ç»“æ„ï¼‰</td>\n<td>å¯</td>\n</tr>\n<tr>\n<td>é€‰å‹ç»“è®º</td>\n<td><strong>ä½æˆæœ¬ + æµ·é‡æ•°æ® + å¯æ¥å—è¯¯å·®çš„åŸºæ•°ç»Ÿè®¡</strong></td>\n<td><strong>ç²¾å‡†ç»Ÿè®¡ + éœ€è¦å…ƒç´ æ˜ç»†çš„åœºæ™¯</strong></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"HyperLogLog-å‘½ä»¤\">HyperLogLog å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SpringBoot çš„ <code>StringRedisTemplate.opsForHyperLogLog()</code> ä¸­ HyperLogLog æ•°æ®ç±»å‹ çš„æ“ä½œæ–¹æ³•ä¸ Redis åŸç”Ÿå‘½ä»¤çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<blockquote>\n<p>æ³¨æ„è¿™é‡Œä¸€å®šè¦ç”¨ <code>StringRedisTemplate</code> æ¥æ“ä½œ HyperLogLog</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>å¤‡æ³¨ / ä½¿ç”¨å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ·»åŠ å…ƒç´ </td>\n<td><code>Long add(K key, V... values)</code></td>\n<td><code>PFADD key element [element ...]</code></td>\n<td>è¿”å› 1 è¡¨ç¤º HLL ç»“æ„å‘ç”Ÿå˜åŒ–</td>\n</tr>\n<tr>\n<td>è·å–åŸºæ•°ï¼ˆå»é‡æ•°ï¼‰</td>\n<td><code>Long size(K... keys)</code></td>\n<td><code>PFCOUNT key [key ...]</code></td>\n<td>æ”¯æŒå¤š key åˆå¹¶ç»Ÿè®¡</td>\n</tr>\n<tr>\n<td>åˆå¹¶ HLL</td>\n<td><code>Long union(K destination, K... sourceKeys)</code></td>\n<td><code>PFMERGE destkey sourcekey [sourcekey ...]</code></td>\n<td>åˆå¹¶åå†™å…¥ destkey</td>\n</tr>\n<tr>\n<td>åˆ é™¤ HLL</td>\n<td><code>void delete(K key)</code></td>\n<td><code>DEL key</code></td>\n<td>ç›´æ¥åˆ é™¤æ•´ä¸ª HLL</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis Hyperloglog æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ Hyperloglog æ ¸å¿ƒè¯¦è§£ Redis HyperLogLog æ˜¯ä¸“é—¨ç”¨äºåšåŸºæ•°ç»Ÿè®¡çš„é«˜çº§æ•°æ®ç±»å‹ï¼Œæ ¸å¿ƒä¼˜åŠ¿æ˜¯ç”¨æå°çš„å†…å­˜ï¼ˆå›ºå®šçº¦ 12KBï¼‰å°±èƒ½ç»Ÿè®¡æµ·é‡æ•°æ®çš„åŸºæ•°ï¼Œè¯¯å·®ç‡ä»… 0.81%ï¼Œæ— éœ€å­˜å‚¨å…¨éƒ¨æ•°æ®æœ¬èº«ã€‚ åŸºæ•°ï¼šæŒ‡é›†åˆä¸­ä¸é‡å¤å…ƒç´ çš„æ•°é‡ï¼ˆæ¯”å¦‚ç»Ÿè®¡ UVï¼Œå°±æ˜¯ä¸é‡å¤è®¿å®¢çš„æ•°é‡ï¼‰ã€‚ Redis Hyperloglog å¹¶éç‹¬ç«‹æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯åŸºäº String ç±»å‹çš„ä½æ“ä½œæ‰©å±• æ ¸å¿ƒä½¿ç”¨æ–¹å¼ï¼ˆ3ä¸ªæ ¸å¿ƒå‘½ä»¤ï¼‰ HyperLogLog å‘½ä»¤æç®€ï¼Œåªæœ‰ 3 ä¸ªæ ¸å¿ƒæ“ä½œ PFADD å‘ HyperLogLog ä¸­æ·»åŠ 1ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼ŒæˆåŠŸæ·»åŠ ï¼ˆå…ƒç´ æœªå­˜åœ¨ï¼‰è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚ 1PFADD key [element [element ...]] PFCOUNT ç»Ÿè®¡å•ä¸ª/å¤šä¸ª HyperLogLog çš„åŸºæ•°ï¼ˆå»é‡æ€»æ•°ï¼‰ï¼Œå¤š key ä¼ å…¥æ—¶ä¼šè®¡ç®—æ‰€æœ‰ key çš„å¹¶é›†åŸºæ•°ã€‚ 1PFCOUNT key [key ...] PFMERGE å°†å¤šä¸ªæº HyperLogLog åˆå¹¶ä¸º1ä¸ªç›®æ ‡ HyperLogLogï¼Œé€‚ç”¨äºè·¨ç»´åº¦æ±‡æ€»ç»Ÿè®¡ï¼ˆæ¯”å¦‚åˆå¹¶ä»Šæ—¥ã€æ˜¨æ—¥çš„ UV å¾—åˆ°ä¸¤æ—¥æ€» UVï¼‰ã€‚ 1PFMERGE destkey [sourcekey [sourcekey ...]] å®æ“ç¤ºä¾‹ ç¤ºä¾‹1ï¼šå• key åŸºç¡€ç»Ÿè®¡ï¼ˆç»Ÿè®¡ç½‘ç«™ UVï¼‰ 123456789# 1. æ¨¡æ‹Ÿ3ä¸ªè®¿å®¢è®¿é—®ï¼Œå…¶ä¸­ç”¨æˆ·Aé‡å¤è®¿é—®127.0.0.1:6379&gt; PFADD uv:20251218 userA userB userC(integer) 1127.0.0.1:6379&gt; PFADD uv:20251218 userA(integer) 0# 2. ç»Ÿè®¡å½“æ—¥UVï¼ˆå»é‡åæ˜¯3ï¼Œå¿½ç•¥é‡å¤çš„userAï¼‰127.0.0.1:6379&gt; PFCOUNT uv:20251218(integer) 3 ç¤ºä¾‹2ï¼š å¤š key åˆå¹¶ä¸æ±‡æ€»ç»Ÿè®¡ 12345678910111213# 1. åˆ†åˆ«ç»Ÿè®¡12.17å’Œ12.18çš„UV127.0.0.1:6379&gt; PFADD uv:20251217 userA userD(integer) 1127.0.0.1:6379&gt; PFADD uv:20251218 userA userB userC(integer) 1# 2. åˆå¹¶ä¸¤æ—¥UVåˆ° uv:20251217_18127.0.0.1:6379&gt; PFMERGE uv:20251217_18 uv:20251217 uv:20251218OK# 3. ç»Ÿè®¡ä¸¤æ—¥æ€»UVï¼ˆå¹¶é›†å»é‡ï¼Œç»“æœä¸º4ï¼šuserAã€Bã€Cã€Dï¼‰127.0.0.1:6379&gt; PFCOUNT uv:20251217_18(integer) 4 æ ¸å¿ƒåº”ç”¨åœºæ™¯ï¼ˆç²¾å‡†è½åœ°åœºæ™¯ï¼‰ HyperLogLog åªå…³æ³¨ â€œå»é‡æ•°é‡â€ï¼Œä¸å…³æ³¨â€œå…·ä½“å…ƒç´ æ˜¯è°â€ï¼Œé€‚åˆä»¥ä¸‹é«˜é¢‘åœºæ™¯ï¼Œä¹Ÿæ˜¯ä¼ä¸šçº§å¸¸ç”¨æ–¹æ¡ˆï¼š ç½‘ç«™/APP UV ç»Ÿè®¡ï¼šæ›¿ä»£ä¼ ç»Ÿçš„ Set å­˜å‚¨ï¼ˆSet å­˜æµ·é‡ UV å†…å­˜å ç”¨æé«˜ï¼‰ï¼Œå• key ä»… 12KBï¼Œè½»æ¾ç»Ÿè®¡ç™¾ä¸‡/åƒä¸‡çº§ UVã€‚ ä¸šåŠ¡åœºæ™¯å»é‡è®¡æ•°ï¼šæ¯”å¦‚ç»Ÿè®¡å•æ—¥/å•æœˆçš„ç‹¬ç«‹æ”¯ä»˜ç”¨æˆ·æ•°ã€ç‹¬ç«‹ä¸‹å•ç”¨æˆ·æ•°ã€ç‹¬ç«‹ç‚¹å‡»å•†å“çš„ç”¨æˆ·æ•°ã€‚ æµ·é‡æ•°æ®å»é‡ç»Ÿè®¡ï¼šæ¯”å¦‚ç»Ÿè®¡æŸæ¥å£çš„ç‹¬ç«‹è°ƒç”¨ IP æ•°ã€æŸç›´æ’­é—´çš„ç‹¬ç«‹è§‚çœ‹äººæ•°ã€æŸå¹¿å‘Šçš„ç‹¬ç«‹æ›å…‰æ•°ã€‚ è·¨ç»´åº¦æ±‡æ€»ç»Ÿè®¡ï¼šæ¯”å¦‚åˆå¹¶ä¸åŒæ¸ é“ï¼ˆAPPã€å°ç¨‹åºã€H5ï¼‰çš„ç‹¬ç«‹è®¿å®¢æ•°ï¼Œå¾—åˆ°å…¨æ¸ é“æ€»è®¿å®¢æ•°ã€‚ å…³é”®æ³¨æ„äº‹é¡¹ï¼ˆé¿å‘é‡ç‚¹ï¼‰ ä¸å­˜å‚¨å…·ä½“å…ƒç´ ï¼Œä»…å­˜ç»Ÿè®¡ç»“æœï¼šæ— æ³•åƒ Set é‚£æ ·è·å–é›†åˆä¸­çš„å…·ä½“å…ƒç´ ï¼ˆæ¯”å¦‚æ— æ³•é€šè¿‡ HyperLogLog æŸ¥åˆ°å…·ä½“æ˜¯å“ªäº›ç”¨æˆ·è®¿é—®äº†ç½‘ç«™ï¼‰ï¼Œåªå…³å¿ƒâ€œæœ‰å¤šå°‘ä¸ªâ€ï¼Œä¸å…³å¿ƒâ€œæ˜¯è°â€ã€‚ è¯¯å·®ä¸å¯é¿å…ï¼Œå¯æ§ä¸å½±å“å¤§éƒ¨åˆ†åœºæ™¯ï¼šå›ºå®šè¯¯å·®ç‡ 0.81%ï¼Œæ•°æ®é‡è¶Šå¤§è¯¯å·®è¶Šç¨³å®šï¼ŒUVã€ç‹¬ç«‹ç”¨æˆ·æ•°ç­‰åœºæ™¯å¯¹ç²¾åº¦è¦æ±‚ä¸é«˜ï¼Œå®Œå…¨å¤Ÿç”¨ï¼›è‹¥éœ€ 100% ç²¾å‡†ï¼ˆæ¯”å¦‚ç»Ÿè®¡æ ¸å¿ƒäº¤æ˜“ç”¨æˆ·æ•°ï¼‰ï¼Œéœ€ç”¨ Set æˆ– Hash å®ç°ã€‚ å†…å­˜å ç”¨å›ºå®šï¼Œä¸æ•°æ®é‡æ— å…³ï¼šæ— è®ºç»Ÿè®¡ 10 ä¸ªè¿˜æ˜¯ 1 äº¿ä¸ªå…ƒç´ ï¼Œå•ä¸ª HyperLogLog å ç”¨å†…å­˜çº¦ 12KBï¼Œè¿™æ˜¯å…¶æ ¸å¿ƒä¼˜åŠ¿ï¼Œä¹Ÿæ˜¯åŒºåˆ«äº Set çš„å…³é”®ã€‚ å…ƒç´ æ”¯æŒå­—ç¬¦ä¸²ç±»å‹ï¼šPFADD ä¼ å…¥çš„å…ƒç´ å¿…é¡»æ˜¯å­—ç¬¦ä¸²/å­—èŠ‚ç±»å‹ï¼Œä¸æ”¯æŒå…¶ä»–æ•°æ®ç±»å‹ï¼ˆå¦‚æ•°å­—ã€åˆ—è¡¨ç­‰ï¼Œéœ€æ‰‹åŠ¨è½¬ä¸ºå­—ç¬¦ä¸²ï¼‰ã€‚ è¿‡æœŸæ—¶é—´æ”¯æŒï¼šHyperLogLog æœ¬èº«ä¸è‡ªå¸¦è¿‡æœŸæœºåˆ¶ï¼Œä½†å¯é€šè¿‡ EXPIRE key seconds ç»™å…¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ¯”å¦‚ UV ç»Ÿè®¡æŒ‰æ—¥è¿‡æœŸï¼Œé¿å…å†…å­˜å †ç§¯ï¼‰ã€‚ PFADD å¹‚ç­‰æ€§ï¼šé‡å¤æ·»åŠ åŒä¸€å…ƒç´ ï¼Œä¸ä¼šæ”¹å˜åŸºæ•°ç»“æœï¼Œä¹Ÿä¸ä¼šé¢å¤–å ç”¨å†…å­˜ï¼Œå¯æ”¾å¿ƒé‡å¤è°ƒç”¨ã€‚ ä¸ Set ç»Ÿè®¡åŸºæ•°çš„å¯¹æ¯”ï¼ˆé€‰å‹å‚è€ƒï¼‰ å¯¹æ¯”ç»´åº¦ HyperLogLog Set æ•°æ®ç»“æ„ç±»å‹ åŸºæ•°ç»Ÿè®¡ç»“æ„ æ— åºé›†åˆ å†…å­˜å ç”¨ å›ºå®šçº¦ 12KBï¼Œä¸æ•°æ®é‡æ— å…³ éšå…ƒç´ æ•°é‡çº¿æ€§å¢é•¿ï¼Œæµ·é‡æ•°æ®å†…å­˜å ç”¨æé«˜ ç»Ÿè®¡ç»“æœç²¾åº¦ éç²¾å‡†ï¼Œæ ‡å‡†è¯¯å·®çº¦ 0.81% 100% ç²¾å‡† æ˜¯å¦æ”¯æŒè·å–å…·ä½“å…ƒç´  ä¸æ”¯æŒ æ”¯æŒï¼ˆå¦‚ SMEMBERSï¼‰ æ˜¯å¦æ”¯æŒå»é‡ æ”¯æŒï¼ˆåŸºæ•°å»é‡ï¼‰ æ”¯æŒï¼ˆå…ƒç´ çº§å»é‡ï¼‰ ç»Ÿè®¡æ€§èƒ½ æå¿«ï¼ˆå›ºå®šè®¡ç®—é€»è¾‘ï¼ŒO(1)ï¼‰ æ•°æ®é‡è¶Šå¤§ï¼Œç»Ÿè®¡ä¸éå†æˆæœ¬è¶Šé«˜ é€‚åˆæ•°æ®è§„æ¨¡ è¶…å¤§è§„æ¨¡ï¼ˆç™¾ä¸‡ / åƒä¸‡ / äº¿çº§ï¼‰ ä¸­å°è§„æ¨¡é›†åˆ å¸¸è§ä½¿ç”¨åœºæ™¯ UV / DAU ç»Ÿè®¡ã€ç‹¬ç«‹ IP æ•°ã€è®¿é—®ç”¨æˆ·æ•° å¥½å‹åˆ—è¡¨ã€æ ‡ç­¾é›†åˆã€å…³æ³¨åˆ—è¡¨ æ˜¯å¦å¯åšé›†åˆè¿ç®— ä¸æ”¯æŒ æ”¯æŒï¼ˆSUNION / SINTER / SDIFFï¼‰ æ˜¯å¦å¯åºåˆ—åŒ–/æŒä¹…åŒ– å¯ï¼ˆRedis å†…éƒ¨ç»“æ„ï¼‰ å¯ é€‰å‹ç»“è®º ä½æˆæœ¬ + æµ·é‡æ•°æ® + å¯æ¥å—è¯¯å·®çš„åŸºæ•°ç»Ÿè®¡ ç²¾å‡†ç»Ÿè®¡ + éœ€è¦å…ƒç´ æ˜ç»†çš„åœºæ™¯ HyperLogLog å‘½ä»¤ SpringBoot çš„ StringRedisTemplate.opsForHyperLogLog() ä¸­ HyperLogLog æ•°æ®ç±»å‹ çš„æ“ä½œæ–¹æ³•ä¸ Redis åŸç”Ÿå‘½ä»¤çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š æ³¨æ„è¿™é‡Œä¸€å®šè¦ç”¨ StringRedisTemplate æ¥æ“ä½œ HyperLogLog æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ å¤‡æ³¨ / ä½¿ç”¨å»ºè®® æ·»åŠ å…ƒç´  Long add(K key, V... values) PFADD key element [element ...] è¿”å› 1 è¡¨ç¤º HLL ç»“æ„å‘ç”Ÿå˜åŒ– è·å–åŸºæ•°ï¼ˆå»é‡æ•°ï¼‰ Long size(K... keys) PFCOUNT key [key ...] æ”¯æŒå¤š key åˆå¹¶ç»Ÿè®¡ åˆå¹¶ HLL Long union(K destination, K... sourceKeys) PFMERGE destkey sourcekey [sourcekey ...] åˆå¹¶åå†™å…¥ destkey åˆ é™¤ HLL void delete(K key) DEL key ç›´æ¥åˆ é™¤æ•´ä¸ª HLL","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis Hyperloglog æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/","date_published":"2025-12-19T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/18/redis7-datatype-07-bitfield/","url":"https://blog.hanqunfeng.com/2025/12/18/redis7-datatype-07-bitfield/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- Bitfield","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis Bitfield æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Bitfield-æ ¸å¿ƒè¯¦è§£\">Bitfield æ ¸å¿ƒè¯¦è§£</h2>\n<p>â€¢ BITFIELD æ˜¯ Redis ç”¨äºæŠŠä¸€ä¸ª å­—ç¬¦ä¸²å€¼è§†ä¸ºä¸€ä¸ªç”±äºŒè¿›åˆ¶â€œä½æ•°ç»„â€ç»„æˆçš„å­˜å‚¨åŒºï¼Œå¹¶å¯¹å…¶ä¸­ä»»æ„æŒ‡å®šä½ç½®çš„æ•´æ•°åŸŸè¿›è¡Œè¯»å–ã€å†™å…¥ã€è‡ªå¢ç­‰æ“ä½œçš„å‘½ä»¤ã€‚<br>\nâ€¢ è¿™äº›æ•´æ•°åŸŸå¯ä»¥æ˜¯ä»»æ„ä½å®½ï¼ˆä¾‹å¦‚ 1 ä½ã€4 ä½ã€8 ä½ã€31 ä½ã€63 ä½ç­‰ï¼‰ï¼Œå¯æŒ‡å®šä¸ºæœ‰ç¬¦å·ï¼ˆsignedï¼‰æˆ–æ— ç¬¦å·ï¼ˆunsignedï¼‰ã€‚</p>\n<h2 id=\"Bitfield-å‘½ä»¤\">Bitfield å‘½ä»¤</h2>\n<h3 id=\"1-BITFIELD-æ‰¹é‡æ“ä½œ\">1. <code>BITFIELD</code> æ‰¹é‡æ“ä½œ</h3>\n<p>â€¢ BITFIELD å‘½ä»¤æ”¯æŒåœ¨ä¸€æ¬¡è°ƒç”¨ä¸­æ‰§è¡Œå¤šä¸ªæ“ä½œï¼Œå¹¶å°†ç»“æœæŒ‰æ“ä½œé¡ºåºè¿”å›ã€‚</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BITFIELD key [GET encoding offset | [OVERFLOW &lt;WRAP | SAT | FAIL&gt;]</span><br><span class=\"line\">  &lt;SET encoding offset value | INCRBY encoding offset increment&gt;</span><br><span class=\"line\">  [GET encoding offset | [OVERFLOW &lt;WRAP | SAT | FAIL&gt;]</span><br><span class=\"line\">  &lt;SET encoding offset value | INCRBY encoding offset increment&gt;</span><br><span class=\"line\">  ...]]</span><br></pre></td></tr></table></figure>\n<p>â€¢ å‚æ•°è¯´æ˜ï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰</p>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>key</strong></td>\n<td>æ“ä½œçš„ Redis å­—ç¬¦ä¸²é”®</td>\n</tr>\n<tr>\n<td><strong>GET encoding offset</strong></td>\n<td>ä»æŒ‡å®šä½åç§»é‡è¯»å–ä¸€ä¸ªæ•´æ•°</td>\n</tr>\n<tr>\n<td><strong>SET encoding offset value</strong></td>\n<td>åœ¨æŒ‡å®šä½ç½®å†™å…¥æ•´æ•°</td>\n</tr>\n<tr>\n<td><strong>INCRBY encoding offset increment</strong></td>\n<td>åœ¨æŒ‡å®šä½ç½®å¯¹æ•´æ•°åšå¢é‡æ“ä½œ</td>\n</tr>\n<tr>\n<td><strong>OVERFLOW WRAP/SAT/FAIL</strong></td>\n<td>é…ç½®éšåçš„ç®—æ•°æ“ä½œæº¢å‡ºè¡Œä¸º</td>\n</tr>\n</tbody>\n</table>\n<p>â€¢ æ•°æ®ç±»å‹ï¼ˆencodingï¼‰:ç”¨äºæŒ‡å®šæ•´æ•°çš„ä½å®½å’Œç¬¦å·ç±»å‹</p>\n<table>\n<thead>\n<tr>\n<th>å‰ç¼€</th>\n<th>å«ä¹‰</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>u&lt;number&gt;</code></td>\n<td>æ— ç¬¦å·æ•´æ•°ï¼ˆunsignedï¼‰ï¼Œå ä½ bits = number</td>\n<td>u5 â€” 5 ä½æ— ç¬¦å·æ•´æ•°</td>\n</tr>\n<tr>\n<td><code>i&lt;number&gt;</code></td>\n<td>æœ‰ç¬¦å·æ•´æ•°ï¼ˆsignedï¼‰ï¼Œå ä½ bits = number</td>\n<td>i10 â€” 10 ä½æœ‰ç¬¦å·æ•´æ•°</td>\n</tr>\n</tbody>\n</table>\n<p>â€¢ æº¢å‡ºï¼ˆOVERFLOWï¼‰:é»˜è®¤ç®—æ•°æ“ä½œä¸­å¯èƒ½å‘ç”Ÿæº¢å‡ºï¼ŒOVERFLOW å…è®¸ä½ æ§åˆ¶å¤„ç†ç­–ç•¥ã€‚æ³¨æ„ï¼Œè¿™éƒ¨åˆ†å¿…é¡»åœ¨åç»­çš„ SET/INCRBY æ“ä½œä¹‹å‰æŒ‡å®šã€‚</p>\n<table>\n<thead>\n<tr>\n<th>ç­–ç•¥</th>\n<th>è¡Œä¸º</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>WRAP</strong></td>\n<td>ç¯ç»•ï¼ˆé»˜è®¤ï¼‰æº¢å‡ºæŒ‰ç¯å½¢è®¡æ•°å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>SAT</strong></td>\n<td>é¥±å’Œï¼Œåœ¨è¾¹ç•Œå€¼ä¿æŒæœ€å¤§/æœ€å°</td>\n</tr>\n<tr>\n<td><strong>FAIL</strong></td>\n<td>æº¢å‡ºæ—¶æ“ä½œå¤±è´¥å¹¶è¿”å›é”™è¯¯</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 4 ä½æ— ç¬¦å·æ•´æ•°åŠ  1 æ—¶ï¼Œå¦‚æœè¶…è¿‡ 15ï¼Œåˆ™ä¿æŒ 15ï¼ˆé¥±å’Œï¼‰ã€‚</span></span><br><span class=\"line\">BITFIELD key OVERFLOW SAT INCRBY u4 0 1</span><br></pre></td></tr></table></figure>\n<p>â€¢ è¿”å›å€¼: BITFIELD ä¼šä¸ºæ¯ä¸ªå­å‘½ä»¤è¿”å›ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œæ•°ç»„å„å…ƒç´ æŒ‰æ“ä½œé¡ºåºå¯¹åº”æ‰§è¡Œç»“æœ</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BITFIELD mykey INCRBY i5 100 1 GET u4 0</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 0</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-BITFIELD-RO-æ‰¹é‡åªè¯»\">2. <code>BITFIELD_RO</code> æ‰¹é‡åªè¯»</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redis 6.0 æ–°å¢çš„åªè¯»ç‰ˆæœ¬ï¼Œç”¨äºæ‰¹é‡åªè¯»</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BITFIELD_RO key [GET encoding offset [GET encoding offset ...]]</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç»¼åˆç¤ºä¾‹\">ç»¼åˆç¤ºä¾‹</h2>\n<h3 id=\"ç¤ºä¾‹-1-è®¾ç½®å¹¶è¯»å–ç®€å•æ•´æ•°\">ç¤ºä¾‹ 1. è®¾ç½®å¹¶è¯»å–ç®€å•æ•´æ•°</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; SET mykey <span class=\"string\">&quot;&quot;</span> <span class=\"comment\"># æ­¤æ—¶mykey çš„å€¼æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œé•¿åº¦ä¸º 0</span></span><br><span class=\"line\"><span class=\"comment\"># SET u4 0 7ï¼šåœ¨ key mykey åç§» 0 ä½ç½®è®¾ç½® 4 ä½æ— ç¬¦å·æ•´æ•°å€¼ä¸º 7ï¼Œå³å‰4ä½å˜æˆ 0111ï¼Œå› ä¸ºè‡³å°‘8bitï¼Œæ‰€ä»¥å®é™…å€¼æ˜¯ 01110000</span></span><br><span class=\"line\"><span class=\"comment\"># GET u4 0ï¼šè¯»å– key mykey åç§» 0 ä½çš„ 4 ä½æ— ç¬¦å·æ•´æ•°ï¼Œæ­¤æ—¶ mykey è™½ç„¶æ˜¯ 01110000ï¼Œä½†è¿™é‡ŒæŒ‡å®šåªè¯»å‰4ä½ï¼Œå³ 0111ï¼Œæ‰€ä»¥è½¬æ¢ä¸ºäºŒè¿›åˆ¶å°±æ˜¯ 7</span></span><br><span class=\"line\">&gt; BITFIELD mykey SET u4 0 7 GET u4 0</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 0 <span class=\"comment\"># setå‘½ä»¤çš„è¿”å›å€¼ï¼Œè¿™é‡Œè¿”å›setå‰çš„å€¼</span></span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 7 <span class=\"comment\"># getå‘½ä»¤çš„è¿”å›å€¼</span></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®æœ‰ç¬¦å·æ•´æ•°</span></span><br><span class=\"line\">&gt; BITFIELD mykey SET i4 0 -2 GET i4 0</span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 7 <span class=\"comment\"># è¿”å›setå‰çš„å€¼ï¼Œä¹‹å‰æ˜¯7ï¼Œå³ 0111ï¼Œsetåå˜ä¸º -2ï¼Œå³ 1110</span></span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) -2 <span class=\"comment\"># getå‘½ä»¤çš„è¿”å›å€¼</span></span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>è´Ÿæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">ä»¥ -2 ä¸ºä¾‹ï¼Œå…ˆå†™å‡º +2 çš„äºŒè¿›åˆ¶ï¼Œä»¥8ä½ä¸ºä¾‹ï¼Œå°±æ˜¯ <code>00000010</code>ï¼Œ4ä½å°±æ˜¯ <code>0010</code></li>\n<li class=\"lvl-2\">æŒ‰ä½å–åï¼ˆå¾—åˆ°åç ï¼‰ï¼Œä¾‹å¦‚ <code>00000010</code>ï¼ŒæŒ‰ä½å–åå°±æ˜¯ <code>11111101</code></li>\n<li class=\"lvl-2\">åŠ  1ï¼ˆå¾—åˆ°è¡¥ç ï¼‰ï¼Œ<code>11111101</code> + 1ï¼Œå¾—åˆ° <code>11111110</code>ï¼Œè¿™å°±æ˜¯ -2 çš„äºŒè¿›åˆ¶è¡¨ç¤º</li>\n<li class=\"lvl-2\">å¦‚æœæ˜¯4ä½ï¼Œåˆ™ -2 å°±æ˜¯ <code>1110</code></li>\n</ul>\n</div>\n<h3 id=\"ç¤ºä¾‹-2-è‡ªå¢è®¡æ•°å™¨\">ç¤ºä¾‹ 2. è‡ªå¢è®¡æ•°å™¨</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœ counter ä¹‹å‰ä¸ºç©ºï¼Œåˆ™è§†ä¸º 0</span></span><br><span class=\"line\"><span class=\"comment\"># INCRBY u8 8 5ï¼šåœ¨ key counter çš„ç¬¬ 8 ä½ï¼ˆä¸‹ä¸€ä¸ªå­—èŠ‚å¼€å¤´å¤„ï¼‰ä¸ŠæŒ‰ 8 ä½ unsigned ç±»å‹è‡ªå¢ 5</span></span><br><span class=\"line\"><span class=\"comment\"># GET u8 8ï¼šè¯»å– key counter çš„ç¬¬ 8 ä½ï¼ˆä¸‹ä¸€ä¸ªå­—èŠ‚å¼€å¤´å¤„ï¼‰çš„ 8 ä½æ— ç¬¦å·æ•´æ•°ï¼Œè¿”å›è¿™ä¸ªæ•´æ•°çš„æ–°å€¼</span></span><br><span class=\"line\">BITFIELD counter INCRBY u8 8 5 GET u8 8</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 5 <span class=\"comment\"># INCRBY çš„è¿”å›å€¼ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯å¢åŠ çš„å€¼ï¼Œè€Œä¸æ˜¯è®¡ç®—åçš„å€¼</span></span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 5</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-3-å¸¦æº¢å‡ºæ§åˆ¶çš„æ“ä½œ\">ç¤ºä¾‹ 3. å¸¦æº¢å‡ºæ§åˆ¶çš„æ“ä½œ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># OVERFLOW SAT: è®¾ç½®æº¢å‡ºç­–ç•¥ä¸º SATï¼ˆé¥±å’Œï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># INCRBY u4 0 20: å¯¹ 4 ä½æ— ç¬¦å·æ•´æ•°ï¼ˆæœ€å¤§ 15ï¼‰åŠ  20ï¼Œæ­¤æ—¶è‚¯å®šä¼šæº¢å‡ºï¼Œç”±äºè¿‡ 15 ä¸Šé™ï¼Œç»“æœè¿”å› 15ï¼ˆé¥±å’Œï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># GET u4 0ï¼šè¯»å– 4 ä½æ— ç¬¦å·æ•´æ•°ï¼Œå³15</span></span><br><span class=\"line\">BITFIELD limits OVERFLOW SAT INCRBY u4 0 20 GET u4 0</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 15</span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 15</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-4-æ‰¹é‡å¤šä¸ªæ“ä½œ\">ç¤ºä¾‹ 4. æ‰¹é‡å¤šä¸ªæ“ä½œ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET u4 0 GET u4 4: ä¾æ¬¡è¯»å–å¤šä¸ªä¸åŒ bit åç§»é‡ä¸Šçš„å°æ•´æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># SET u4 8 3 INCRBY i5 16 1: å†™å…¥ã€å¢é‡æ“ä½œå¯ä»¥æ··åˆå¤„ç†</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›ç»“æœæ•°ç»„å¯¹åº”æ¯ä¸ªå­å‘½ä»¤é¡ºåºè¿”å›ç»“æœ</span></span><br><span class=\"line\">BITFIELD events GET u4 0 GET u4 4 SET u4 8 3 INCRBY i5 16 1</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 0 <span class=\"comment\"># eventsåŸå…ˆä¸ºç©ºï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›0</span></span><br><span class=\"line\">2) (<span class=\"built_in\">integer</span>) 0 <span class=\"comment\"># eventsåŸå…ˆä¸ºç©ºï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›0</span></span><br><span class=\"line\">3) (<span class=\"built_in\">integer</span>) 0 <span class=\"comment\"># eventsåŸå…ˆä¸ºç©ºï¼Œè¿™é‡Œè¿”å›åŸå…ˆçš„å€¼ï¼Œæ‰€ä»¥è¿˜æ˜¯0ï¼Œä½†æ­¤æ—¶å®é™…çš„å€¼æ˜¯ 0000000000110000</span></span><br><span class=\"line\">4) (<span class=\"built_in\">integer</span>) 1 <span class=\"comment\"># è¿”å›å¢åŠ çš„å€¼ï¼Œå³ 1ï¼Œä½†æ­¤æ—¶å®é™…çš„å€¼æ˜¯ 000000000011000000001000ï¼Œå³å ç”¨äº†3ä¸ªå­—èŠ‚</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"SpringBoot-æ“ä½œ-BitField\">SpringBoot æ“ä½œ BitField</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SpringBoot çš„ <code>StringRedisTemplate.opsForValue()</code> ä¸­ BitField æ•°æ®ç±»å‹ çš„æ“ä½œæ–¹æ³•ä¸ Redis åŸç”Ÿå‘½ä»¤çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<blockquote>\n<p>æ³¨æ„è¿™é‡Œä¸€å®šè¦ç”¨ <code>StringRedisTemplate</code> æ¥æ“ä½œ BitField</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½å­—æ®µè¯»/å†™/è‡ªå¢</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ä½å­—æ®µæ“ä½œï¼ˆè¯»/å†™/è‡ªå¢ï¼‰</td>\n<td><code>bitField(K key, BitFieldSubCommands subCommands)</code></td>\n<td><code>BITFIELD key ...</code></td>\n<td>åŸå­æ‰§è¡Œå¤šä¸ªå­å‘½ä»¤</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BITFIELD limits</span><br><span class=\"line\">    OVERFLOW SAT</span><br><span class=\"line\">    SET u4 0 3</span><br><span class=\"line\">    INCRBY u4 0 20</span><br><span class=\"line\">    GET u4 0</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// SET u4 0 3</span></span><br><span class=\"line\">BitFieldSubCommands.<span class=\"type\">BitFieldSet</span> <span class=\"variable\">bitFieldSet</span> <span class=\"operator\">=</span> BitFieldSubCommands.BitFieldSet.create(BitFieldSubCommands.BitFieldType.unsigned(<span class=\"number\">4</span>), BitFieldSubCommands.Offset.offset(<span class=\"number\">0</span>), <span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">// OVERFLOW SAT INCRBY u4 0 20</span></span><br><span class=\"line\">BitFieldSubCommands.<span class=\"type\">BitFieldIncrBy</span> <span class=\"variable\">bitFieldIncrBy</span> <span class=\"operator\">=</span> BitFieldSubCommands.BitFieldIncrBy.create(BitFieldSubCommands.BitFieldType.unsigned(<span class=\"number\">4</span>), BitFieldSubCommands.Offset.offset(<span class=\"number\">0</span>), <span class=\"number\">20</span>, BitFieldSubCommands.BitFieldIncrBy.Overflow.SAT);</span><br><span class=\"line\"><span class=\"comment\">// GET u4 0</span></span><br><span class=\"line\">BitFieldSubCommands.<span class=\"type\">BitFieldGet</span> <span class=\"variable\">bitFieldGet</span> <span class=\"operator\">=</span> BitFieldSubCommands.BitFieldGet.create(BitFieldSubCommands.BitFieldType.unsigned(<span class=\"number\">4</span>), BitFieldSubCommands.Offset.offset(<span class=\"number\">0</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è·å–ç»“æœï¼Œæ¯ä¸ªå­æ“ä½œè¿”å›ä¸€ä¸ªç»“æœ</span></span><br><span class=\"line\">List&lt;Long&gt; limits = redisTemplate.opsForValue().bitField(<span class=\"string\">&quot;limits&quot;</span>, BitFieldSubCommands.create(bitFieldSet, bitFieldIncrBy, bitFieldGet));</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis Bitfield æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ Bitfield æ ¸å¿ƒè¯¦è§£ â€¢ BITFIELD æ˜¯ Redis ç”¨äºæŠŠä¸€ä¸ª å­—ç¬¦ä¸²å€¼è§†ä¸ºä¸€ä¸ªç”±äºŒè¿›åˆ¶â€œä½æ•°ç»„â€ç»„æˆçš„å­˜å‚¨åŒºï¼Œå¹¶å¯¹å…¶ä¸­ä»»æ„æŒ‡å®šä½ç½®çš„æ•´æ•°åŸŸè¿›è¡Œè¯»å–ã€å†™å…¥ã€è‡ªå¢ç­‰æ“ä½œçš„å‘½ä»¤ã€‚ â€¢ è¿™äº›æ•´æ•°åŸŸå¯ä»¥æ˜¯ä»»æ„ä½å®½ï¼ˆä¾‹å¦‚ 1 ä½ã€4 ä½ã€8 ä½ã€31 ä½ã€63 ä½ç­‰ï¼‰ï¼Œå¯æŒ‡å®šä¸ºæœ‰ç¬¦å·ï¼ˆsignedï¼‰æˆ–æ— ç¬¦å·ï¼ˆunsignedï¼‰ã€‚ Bitfield å‘½ä»¤ 1. BITFIELD æ‰¹é‡æ“ä½œ â€¢ BITFIELD å‘½ä»¤æ”¯æŒåœ¨ä¸€æ¬¡è°ƒç”¨ä¸­æ‰§è¡Œå¤šä¸ªæ“ä½œï¼Œå¹¶å°†ç»“æœæŒ‰æ“ä½œé¡ºåºè¿”å›ã€‚ 12345BITFIELD key [GET encoding offset | [OVERFLOW &lt;WRAP | SAT | FAIL&gt;] &lt;SET encoding offset value | INCRBY encoding offset increment&gt; [GET encoding offset | [OVERFLOW &lt;WRAP | SAT | FAIL&gt;] &lt;SET encoding offset value | INCRBY encoding offset increment&gt; ...]] â€¢ å‚æ•°è¯´æ˜ï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰ å‚æ•° å«ä¹‰ key æ“ä½œçš„ Redis å­—ç¬¦ä¸²é”® GET encoding offset ä»æŒ‡å®šä½åç§»é‡è¯»å–ä¸€ä¸ªæ•´æ•° SET encoding offset value åœ¨æŒ‡å®šä½ç½®å†™å…¥æ•´æ•° INCRBY encoding offset increment åœ¨æŒ‡å®šä½ç½®å¯¹æ•´æ•°åšå¢é‡æ“ä½œ OVERFLOW WRAP/SAT/FAIL é…ç½®éšåçš„ç®—æ•°æ“ä½œæº¢å‡ºè¡Œä¸º â€¢ æ•°æ®ç±»å‹ï¼ˆencodingï¼‰:ç”¨äºæŒ‡å®šæ•´æ•°çš„ä½å®½å’Œç¬¦å·ç±»å‹ å‰ç¼€ å«ä¹‰ ç¤ºä¾‹ u&lt;number&gt; æ— ç¬¦å·æ•´æ•°ï¼ˆunsignedï¼‰ï¼Œå ä½ bits = number u5 â€” 5 ä½æ— ç¬¦å·æ•´æ•° i&lt;number&gt; æœ‰ç¬¦å·æ•´æ•°ï¼ˆsignedï¼‰ï¼Œå ä½ bits = number i10 â€” 10 ä½æœ‰ç¬¦å·æ•´æ•° â€¢ æº¢å‡ºï¼ˆOVERFLOWï¼‰:é»˜è®¤ç®—æ•°æ“ä½œä¸­å¯èƒ½å‘ç”Ÿæº¢å‡ºï¼ŒOVERFLOW å…è®¸ä½ æ§åˆ¶å¤„ç†ç­–ç•¥ã€‚æ³¨æ„ï¼Œè¿™éƒ¨åˆ†å¿…é¡»åœ¨åç»­çš„ SET/INCRBY æ“ä½œä¹‹å‰æŒ‡å®šã€‚ ç­–ç•¥ è¡Œä¸º WRAP ç¯ç»•ï¼ˆé»˜è®¤ï¼‰æº¢å‡ºæŒ‰ç¯å½¢è®¡æ•°å¤„ç† SAT é¥±å’Œï¼Œåœ¨è¾¹ç•Œå€¼ä¿æŒæœ€å¤§/æœ€å° FAIL æº¢å‡ºæ—¶æ“ä½œå¤±è´¥å¹¶è¿”å›é”™è¯¯ 12# 4 ä½æ— ç¬¦å·æ•´æ•°åŠ  1 æ—¶ï¼Œå¦‚æœè¶…è¿‡ 15ï¼Œåˆ™ä¿æŒ 15ï¼ˆé¥±å’Œï¼‰ã€‚BITFIELD key OVERFLOW SAT INCRBY u4 0 1 â€¢ è¿”å›å€¼: BITFIELD ä¼šä¸ºæ¯ä¸ªå­å‘½ä»¤è¿”å›ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œæ•°ç»„å„å…ƒç´ æŒ‰æ“ä½œé¡ºåºå¯¹åº”æ‰§è¡Œç»“æœ 1234BITFIELD mykey INCRBY i5 100 1 GET u4 0# è¾“å‡º1) (integer) 12) (integer) 0 2. BITFIELD_RO æ‰¹é‡åªè¯» Redis 6.0 æ–°å¢çš„åªè¯»ç‰ˆæœ¬ï¼Œç”¨äºæ‰¹é‡åªè¯» 1BITFIELD_RO key [GET encoding offset [GET encoding offset ...]] ç»¼åˆç¤ºä¾‹ ç¤ºä¾‹ 1. è®¾ç½®å¹¶è¯»å–ç®€å•æ•´æ•° 1234567891011&gt; SET mykey &quot;&quot; # æ­¤æ—¶mykey çš„å€¼æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œé•¿åº¦ä¸º 0# SET u4 0 7ï¼šåœ¨ key mykey åç§» 0 ä½ç½®è®¾ç½® 4 ä½æ— ç¬¦å·æ•´æ•°å€¼ä¸º 7ï¼Œå³å‰4ä½å˜æˆ 0111ï¼Œå› ä¸ºè‡³å°‘8bitï¼Œæ‰€ä»¥å®é™…å€¼æ˜¯ 01110000# GET u4 0ï¼šè¯»å– key mykey åç§» 0 ä½çš„ 4 ä½æ— ç¬¦å·æ•´æ•°ï¼Œæ­¤æ—¶ mykey è™½ç„¶æ˜¯ 01110000ï¼Œä½†è¿™é‡ŒæŒ‡å®šåªè¯»å‰4ä½ï¼Œå³ 0111ï¼Œæ‰€ä»¥è½¬æ¢ä¸ºäºŒè¿›åˆ¶å°±æ˜¯ 7&gt; BITFIELD mykey SET u4 0 7 GET u4 0# è¾“å‡º1) (integer) 0 # setå‘½ä»¤çš„è¿”å›å€¼ï¼Œè¿™é‡Œè¿”å›setå‰çš„å€¼2) (integer) 7 # getå‘½ä»¤çš„è¿”å›å€¼# è®¾ç½®æœ‰ç¬¦å·æ•´æ•°&gt; BITFIELD mykey SET i4 0 -2 GET i4 01) (integer) 7 # è¿”å›setå‰çš„å€¼ï¼Œä¹‹å‰æ˜¯7ï¼Œå³ 0111ï¼Œsetåå˜ä¸º -2ï¼Œå³ 11102) (integer) -2 # getå‘½ä»¤çš„è¿”å›å€¼ è´Ÿæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º ä»¥ -2 ä¸ºä¾‹ï¼Œå…ˆå†™å‡º +2 çš„äºŒè¿›åˆ¶ï¼Œä»¥8ä½ä¸ºä¾‹ï¼Œå°±æ˜¯ 00000010ï¼Œ4ä½å°±æ˜¯ 0010 æŒ‰ä½å–åï¼ˆå¾—åˆ°åç ï¼‰ï¼Œä¾‹å¦‚ 00000010ï¼ŒæŒ‰ä½å–åå°±æ˜¯ 11111101 åŠ  1ï¼ˆå¾—åˆ°è¡¥ç ï¼‰ï¼Œ11111101 + 1ï¼Œå¾—åˆ° 11111110ï¼Œè¿™å°±æ˜¯ -2 çš„äºŒè¿›åˆ¶è¡¨ç¤º å¦‚æœæ˜¯4ä½ï¼Œåˆ™ -2 å°±æ˜¯ 1110 ç¤ºä¾‹ 2. è‡ªå¢è®¡æ•°å™¨ 1234567# å¦‚æœ counter ä¹‹å‰ä¸ºç©ºï¼Œåˆ™è§†ä¸º 0# INCRBY u8 8 5ï¼šåœ¨ key counter çš„ç¬¬ 8 ä½ï¼ˆä¸‹ä¸€ä¸ªå­—èŠ‚å¼€å¤´å¤„ï¼‰ä¸ŠæŒ‰ 8 ä½ unsigned ç±»å‹è‡ªå¢ 5# GET u8 8ï¼šè¯»å– key counter çš„ç¬¬ 8 ä½ï¼ˆä¸‹ä¸€ä¸ªå­—èŠ‚å¼€å¤´å¤„ï¼‰çš„ 8 ä½æ— ç¬¦å·æ•´æ•°ï¼Œè¿”å›è¿™ä¸ªæ•´æ•°çš„æ–°å€¼BITFIELD counter INCRBY u8 8 5 GET u8 8# è¾“å‡º1) (integer) 5 # INCRBY çš„è¿”å›å€¼ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯å¢åŠ çš„å€¼ï¼Œè€Œä¸æ˜¯è®¡ç®—åçš„å€¼2) (integer) 5 ç¤ºä¾‹ 3. å¸¦æº¢å‡ºæ§åˆ¶çš„æ“ä½œ 1234567# OVERFLOW SAT: è®¾ç½®æº¢å‡ºç­–ç•¥ä¸º SATï¼ˆé¥±å’Œï¼‰# INCRBY u4 0 20: å¯¹ 4 ä½æ— ç¬¦å·æ•´æ•°ï¼ˆæœ€å¤§ 15ï¼‰åŠ  20ï¼Œæ­¤æ—¶è‚¯å®šä¼šæº¢å‡ºï¼Œç”±äºè¿‡ 15 ä¸Šé™ï¼Œç»“æœè¿”å› 15ï¼ˆé¥±å’Œï¼‰# GET u4 0ï¼šè¯»å– 4 ä½æ— ç¬¦å·æ•´æ•°ï¼Œå³15BITFIELD limits OVERFLOW SAT INCRBY u4 0 20 GET u4 0# è¾“å‡º1) (integer) 152) (integer) 15 ç¤ºä¾‹ 4. æ‰¹é‡å¤šä¸ªæ“ä½œ 123456789# GET u4 0 GET u4 4: ä¾æ¬¡è¯»å–å¤šä¸ªä¸åŒ bit åç§»é‡ä¸Šçš„å°æ•´æ•°# SET u4 8 3 INCRBY i5 16 1: å†™å…¥ã€å¢é‡æ“ä½œå¯ä»¥æ··åˆå¤„ç†# è¿”å›ç»“æœæ•°ç»„å¯¹åº”æ¯ä¸ªå­å‘½ä»¤é¡ºåºè¿”å›ç»“æœBITFIELD events GET u4 0 GET u4 4 SET u4 8 3 INCRBY i5 16 1# è¾“å‡º1) (integer) 0 # eventsåŸå…ˆä¸ºç©ºï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›02) (integer) 0 # eventsåŸå…ˆä¸ºç©ºï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›03) (integer) 0 # eventsåŸå…ˆä¸ºç©ºï¼Œè¿™é‡Œè¿”å›åŸå…ˆçš„å€¼ï¼Œæ‰€ä»¥è¿˜æ˜¯0ï¼Œä½†æ­¤æ—¶å®é™…çš„å€¼æ˜¯ 00000000001100004) (integer) 1 # è¿”å›å¢åŠ çš„å€¼ï¼Œå³ 1ï¼Œä½†æ­¤æ—¶å®é™…çš„å€¼æ˜¯ 000000000011000000001000ï¼Œå³å ç”¨äº†3ä¸ªå­—èŠ‚ SpringBoot æ“ä½œ BitField SpringBoot çš„ StringRedisTemplate.opsForValue() ä¸­ BitField æ•°æ®ç±»å‹ çš„æ“ä½œæ–¹æ³•ä¸ Redis åŸç”Ÿå‘½ä»¤çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š æ³¨æ„è¿™é‡Œä¸€å®šè¦ç”¨ StringRedisTemplate æ¥æ“ä½œ BitField ä½å­—æ®µè¯»/å†™/è‡ªå¢ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ å¤‡æ³¨ ä½å­—æ®µæ“ä½œï¼ˆè¯»/å†™/è‡ªå¢ï¼‰ bitField(K key, BitFieldSubCommands subCommands) BITFIELD key ... åŸå­æ‰§è¡Œå¤šä¸ªå­å‘½ä»¤ ç¤ºä¾‹ 12345BITFIELD limits OVERFLOW SAT SET u4 0 3 INCRBY u4 0 20 GET u4 0 123456789// SET u4 0 3BitFieldSubCommands.BitFieldSet bitFieldSet = BitFieldSubCommands.BitFieldSet.create(BitFieldSubCommands.BitFieldType.unsigned(4), BitFieldSubCommands.Offset.offset(0), 3);// OVERFLOW SAT INCRBY u4 0 20BitFieldSubCommands.BitFieldIncrBy bitFieldIncrBy = BitFieldSubCommands.BitFieldIncrBy.create(BitFieldSubCommands.BitFieldType.unsigned(4), BitFieldSubCommands.Offset.offset(0), 20, BitFieldSubCommands.BitFieldIncrBy.Overflow.SAT);// GET u4 0BitFieldSubCommands.BitFieldGet bitFieldGet = BitFieldSubCommands.BitFieldGet.create(BitFieldSubCommands.BitFieldType.unsigned(4), BitFieldSubCommands.Offset.offset(0));// è·å–ç»“æœï¼Œæ¯ä¸ªå­æ“ä½œè¿”å›ä¸€ä¸ªç»“æœList&lt;Long&gt; limits = redisTemplate.opsForValue().bitField(&quot;limits&quot;, BitFieldSubCommands.create(bitFieldSet, bitFieldIncrBy, bitFieldGet));","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis Bitfield æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/","date_published":"2025-12-18T13:30:06.000Z","tags":["æŠ€æœ¯","redis","redis"]},{"id":"https://blog.hanqunfeng.com/2025/12/18/redis7-datatype-07-bitmap/","url":"https://blog.hanqunfeng.com/2025/12/18/redis7-datatype-07-bitmap/","title":"Redis å‘½ä»¤åŠæ•°æ®ç±»å‹ -- Bitmap","content_html":"<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">æœ¬æ–‡ä»‹ç» Redis Bitmap æ•°æ®ç±»å‹</li>\n<li class=\"lvl-2\">æœ¬æ–‡åŸºäº<code>redis-7.4.7</code>ï¼Œ<code>springboot-3.5.8</code></li>\n<li class=\"lvl-2\">Rediså®˜ç½‘ï¼š<a href=\"https://redis.io/\">https://redis.io/</a></li>\n<li class=\"lvl-2\">Redis å‘½ä»¤æ–‡æ¡£ï¼š<a href=\"https://redis.io/docs/latest/commands/\">https://redis.io/docs/latest/commands/</a></li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Bitmap-æ ¸å¿ƒè¯¦è§£\">Bitmap æ ¸å¿ƒè¯¦è§£</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Redis Bitmap å¹¶éç‹¬ç«‹æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯åŸºäº String ç±»å‹çš„ä½æ“ä½œæ‰©å±•</p>\n</li>\n<li class=\"lvl-2\">\n<p>String åº•å±‚æ˜¯å­—èŠ‚æ•°ç»„ï¼ŒBitmap å°±æ˜¯å¯¹æ•°ç»„ä¸­å•ä¸ª bit åšè¯»å†™ï¼ˆbit åªæœ‰ 0/1 ä¸¤ä¸ªå€¼ï¼‰</p>\n</li>\n</ul>\n<h2 id=\"Bitmap-å‘½ä»¤ä½¿ç”¨æ–¹å¼\">Bitmap å‘½ä»¤ä½¿ç”¨æ–¹å¼</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ ¸å¿ƒå›´ç»•ã€Œä½è®¾ç½®ã€ä½æŸ¥è¯¢ã€ä½ç»Ÿè®¡ã€ä½è¿ç®—ã€å››ç±»å‘½ä»¤ï¼Œæ˜¯æ—¥å¸¸ä½¿ç”¨çš„åŸºç¡€</p>\n</li>\n</ul>\n<h3 id=\"1-ä½è®¾ç½®ï¼šSETBIT-key-offset-value\">1. ä½è®¾ç½®ï¼š<code>SETBIT key offset value</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»™æŒ‡å®š key çš„ç¬¬ offset ä½è®¾ 0/1ï¼ˆoffset ä» 0 å¼€å§‹ï¼Œæ”¯æŒè¶…å¤§åç§»é‡ï¼ŒRedis ä¼šè‡ªåŠ¨æ‰©å®¹ï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>offset ä»å·¦å¾€å³é€’å¢ï¼Œä»å·¦åˆ°å³ä¸º 0ã€1ã€2â€¦ï¼Œè‡³å°‘ç”³è¯· 8bit ç©ºé—´ï¼Œä¸è¶³ 8bit æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰©å±•åˆ° 8bit å³ 1byte</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SETBIT bitkey 1 1 <span class=\"comment\"># å®é™…çš„bitä¸º 01000000</span></span><br><span class=\"line\">SETBIT bitkey 10 1 <span class=\"comment\"># å®é™…çš„bitä¸º 0100000000100000</span></span><br><span class=\"line\"><span class=\"comment\"># æ“ä½œ String</span></span><br><span class=\"line\">SET k1 v1 <span class=\"comment\"># å®é™…çš„bitä¸º 0111011000110001</span></span><br><span class=\"line\">SETBIT k1 1 0 <span class=\"comment\"># å®é™…bitä¸º 0011011000110001</span></span><br><span class=\"line\">GET k1 <span class=\"comment\"># è¾“å‡º 61</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># bitmap å®é™…ä¸Šæ˜¯ string</span></span><br><span class=\"line\">TYPE bitkey <span class=\"comment\"># è¾“å‡º string</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"2-ä½æŸ¥è¯¢ï¼šGETBIT-key-offset\">2. ä½æŸ¥è¯¢ï¼š<code>GETBIT key offset</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢æŒ‡å®šåç§»é‡çš„ä½å€¼ï¼Œä¸å­˜åœ¨çš„ offset é»˜è®¤è¿”å› 0</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GETBIT bitkey 1</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-ä½ç»Ÿè®¡ï¼šBITCOUNT-key-start-end\">3. ä½ç»Ÿè®¡ï¼š<code>BITCOUNT key [start end]</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»Ÿè®¡ key ä¸­å€¼ä¸º 1 çš„ bit æ€»æ•°ï¼Œå¯é€‰æŒ‰å­—èŠ‚èŒƒå›´ï¼ˆstart/end æ˜¯å­—èŠ‚ç´¢å¼•ï¼‰ç­›é€‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BITCOUNT bitkey</span><br><span class=\"line\"><span class=\"comment\"># ç­‰ä»·äº</span></span><br><span class=\"line\">BITCOUNT bitkey 0 -1</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-ä½è¿ç®—ï¼šBITOP-op-destkey-key1-key2\">4. ä½è¿ç®—ï¼š<code>BITOP op destkey key1 key2...</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹å¤šä¸ª Bitmap åš ä¸ï¼ˆANDï¼‰ã€æˆ–ï¼ˆORï¼‰ã€å¼‚æˆ–ï¼ˆXORï¼‰ã€éï¼ˆNOTï¼‰è¿ç®—ï¼Œç»“æœå­˜å…¥ destkey</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°†key1 ä¸ key2 åšæŒ‰ä½ä¸è¿ç®—ï¼Œç»“æœå­˜å…¥ destkey</span></span><br><span class=\"line\">BITOP AND destkey key1 key2</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-ä½æŸ¥æ‰¾ï¼šBITPOS-key-value-start-end\">5. ä½æŸ¥æ‰¾ï¼š<code>BITPOS key value [start end]</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ä¸º 0/1 çš„ bit åç§»é‡ï¼Œå¿«é€Ÿå®šä½ç›®æ ‡ä½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BITPOS bitkey 1</span><br><span class=\"line\"><span class=\"comment\"># ç­‰ä»·äº</span></span><br><span class=\"line\">BITPOS bitkey 1 0 -1</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ ¸å¿ƒä½¿ç”¨åœºæ™¯-å®æ“ä¸¾ä¾‹ï¼ˆè´´åˆå¼€å‘å®æˆ˜ï¼‰\">æ ¸å¿ƒä½¿ç”¨åœºæ™¯ + å®æ“ä¸¾ä¾‹ï¼ˆè´´åˆå¼€å‘å®æˆ˜ï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Bitmap çš„æ ¸å¿ƒä¼˜åŠ¿æ˜¯æè‡´çœå†…å­˜+é«˜æ•ˆç»Ÿè®¡ï¼ˆ1 ä¸ªå­—èŠ‚=8 ä¸ª bitï¼Œå­˜å‚¨ 1000 ä¸‡æ¡çŠ¶æ€ä»…éœ€çº¦ 1.2MBï¼‰ï¼Œä»¥ä¸‹æ˜¯é«˜é¢‘åœºæ™¯</p>\n</li>\n</ul>\n<h3 id=\"åœºæ™¯1ï¼š-ç”¨æˆ·ç­¾åˆ°-æ‰“å¡ï¼ˆæœ€ç»å…¸åœºæ™¯ï¼‰\">åœºæ™¯1ï¼š ç”¨æˆ·ç­¾åˆ°/æ‰“å¡ï¼ˆæœ€ç»å…¸åœºæ™¯ï¼‰</h3>\n<p>â€¢ éœ€æ±‚ï¼šè®°å½•ç”¨æˆ·æ¯æ—¥ç­¾åˆ°çŠ¶æ€ï¼ŒæŸ¥è¯¢æŸç”¨æˆ·æŸå¤©æ˜¯å¦ç­¾åˆ°ã€ç»Ÿè®¡æŸç”¨æˆ·æœˆåº¦ç­¾åˆ°æ¬¡æ•°<br>\nâ€¢ è®¾è®¡ï¼škey æ ¼å¼ <code>user:sign:uid:202512</code>ï¼ˆç”¨æˆ·2025å¹´12æœˆç­¾åˆ°ï¼‰ï¼Œoffset ä¸ºæ—¥æœŸï¼ˆ1å·=0ã€2å·=1â€¦31å·=30ï¼‰ï¼Œç­¾åˆ°è®¾ 1ã€æœªç­¾åˆ°é»˜è®¤ 0<br>\nâ€¢ å®æ“å‘½ä»¤ï¼š</p>\n<ol>\n<li class=\"lvl-3\">\n<p>12æœˆ1å·ç­¾åˆ°ï¼š<code>SETBIT user:sign:uid:202512 0 1</code></p>\n</li>\n<li class=\"lvl-3\">\n<p>æŸ¥è¯¢12æœˆ1å·æ˜¯å¦ç­¾åˆ°ï¼š<code>GETBIT user:sign:uid:202512 0</code>ï¼ˆè¿”å›1=ç­¾åˆ°ï¼‰</p>\n</li>\n<li class=\"lvl-3\">\n<p>ç»Ÿè®¡12æœˆæ€»ç­¾åˆ°æ¬¡æ•°ï¼š<code>BITCOUNT user:sign:uid:202512</code></p>\n</li>\n</ol>\n<p>â€¢ ä¼˜åŠ¿ï¼š1ä¸ªç”¨æˆ·1ä¸ªæœˆç­¾åˆ°ä»…å  4 å­—èŠ‚ï¼ˆ31 bitï¼‰ï¼Œç™¾ä¸‡ç”¨æˆ·æœˆåº¦ç­¾åˆ°ä»…å çº¦ 3.9MBï¼Œè¿œè¶…æ•°æ®åº“å­˜å‚¨çš„æ€§ä»·æ¯”ã€‚</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŠ£åŠ¿ï¼šè‹¥æƒ³æŸ¥è¯¢è¯¥ç”¨æˆ·æœ¬æœˆå†…éƒ½å“ªå¤©ç­¾åˆ°äº†ï¼Œå³è¦æŸ¥çœ‹bitmapå“ªäº›ä½ä¸º1ï¼Œåˆ™bitmapä¸æ”¯æŒè¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥åœ¨ä¸šåŠ¡ç«¯å®ç°ã€‚å¦‚éœ€è¦ç²¾ç¡®æŸ¥è¯¢å’Œèšåˆç»Ÿè®¡åˆ™éœ€è¦åŒæ­¥æ•°æ®åˆ°å…³ç³»å‹æ•°æ®åº“ã€‚</p>\n</li>\n</ul>\n<h3 id=\"åœºæ™¯2ï¼š-æ—¥æ´»-å‘¨æ´»-æœˆæ´»ï¼ˆDAU-WAU-MAUï¼‰ç»Ÿè®¡ï¼ˆé«˜å¹¶å‘åœºæ™¯é¦–é€‰ï¼‰\">åœºæ™¯2ï¼š æ—¥æ´»/å‘¨æ´»/æœˆæ´»ï¼ˆDAU/WAU/MAUï¼‰ç»Ÿè®¡ï¼ˆé«˜å¹¶å‘åœºæ™¯é¦–é€‰ï¼‰</h3>\n<p>â€¢ éœ€æ±‚ï¼šç»Ÿè®¡æ¯æ—¥è®¿é—®å¹³å°çš„ç”¨æˆ·æ•°ï¼Œå¿«é€Ÿè®¡ç®—å‘¨æ´»ï¼ˆ7å¤©å†…è‡³å°‘è®¿é—®1æ¬¡ï¼‰ã€æœˆæ´»ï¼Œå»é‡ç»Ÿè®¡<br>\nâ€¢ è®¾è®¡ï¼šæŒ‰æ—¥æœŸå»º Bitmapï¼Œkey æ ¼å¼ <code>active:user:20251217</code>ï¼ˆå½“æ—¥æ´»è·ƒï¼‰ï¼Œoffset è®¾ä¸ºç”¨æˆ·å”¯ä¸€IDï¼ˆéœ€ç¡®ä¿IDæ˜¯è¿ç»­æˆ–å¯æ˜ å°„ä¸ºæ•°å­—ï¼Œé¿å…è¶…å¤§åç§»é‡ï¼‰ï¼Œç”¨æˆ·è®¿é—®åˆ™è®¾ 1<br>\nâ€¢ å®æ“å‘½ä»¤ï¼š</p>\n<ol>\n<li class=\"lvl-3\">\n<p>ç”¨æˆ·ID 10086 12æœˆ17æ—¥è®¿é—®ï¼š<code>SETBIT active:user:20251217 10086 1</code></p>\n</li>\n<li class=\"lvl-3\">\n<p>ç»Ÿè®¡12æœˆ17æ—¥æ—¥æ´»ï¼š<code>BITCOUNT active:user:20251217</code></p>\n</li>\n<li class=\"lvl-3\">\n<p>ç»Ÿè®¡12æœˆ15-17æ—¥3å¤©å†…æ´»è·ƒçš„ç”¨æˆ·æ•°ï¼š<code>BITOP OR active:user:20251215_17 active:user:20251215 active:user:20251216 active:user:20251217</code> â†’ å†æ‰§è¡Œ <code>BITCOUNT active:user:20251215_17</code></p>\n</li>\n<li class=\"lvl-3\">\n<p>ç»Ÿè®¡12æœˆ15-17æ—¥æ¯å¤©éƒ½ç™»å½•çš„ç”¨æˆ·æ•°ï¼š<code>BITOP AND active:user:20251215_17 active:user:20251215 active:user:20251216 active:user:20251217</code> â†’ å†æ‰§è¡Œ <code>BITCOUNT active:user:20251215_17</code></p>\n</li>\n</ol>\n<p>â€¢ ä¼˜åŠ¿ï¼šç™¾ä¸‡çº§ç”¨æˆ·æ—¥æ´»ç»Ÿè®¡ï¼Œå• Bitmap ä»…å çº¦ 125KBï¼Œä½è¿ç®—åˆå¹¶ç»Ÿè®¡é€Ÿåº¦æ¯«ç§’çº§ï¼Œè¿œå¿«äºæ•°æ®åº“ group by å»é‡ã€‚</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŠ£åŠ¿ï¼šè‹¥æƒ³æŸ¥çœ‹æœ¬æœˆå†…å“ªäº›ç”¨æˆ·ç™»å½•è¿‡ï¼Œåˆ™éœ€è¦éå† Bitmap çš„æ‰€æœ‰ offset ä½ï¼Œæ•ˆç‡è¾ƒä½ã€‚å¦‚éœ€è¦ç²¾ç¡®æŸ¥è¯¢å’Œèšåˆç»Ÿè®¡åˆ™éœ€è¦åŒæ­¥æ•°æ®åˆ°å…³ç³»å‹æ•°æ®åº“ã€‚</p>\n</li>\n</ul>\n<h3 id=\"åœºæ™¯3ï¼š-åŠŸèƒ½å¼€å…³-çŠ¶æ€æ ‡è®°ï¼ˆå¤šç»´åº¦è½»é‡æ ‡è®°ï¼‰\">åœºæ™¯3ï¼š åŠŸèƒ½å¼€å…³/çŠ¶æ€æ ‡è®°ï¼ˆå¤šç»´åº¦è½»é‡æ ‡è®°ï¼‰</h3>\n<p>â€¢ éœ€æ±‚ï¼šç»™ç”¨æˆ·æ ‡è®°å¤šç±»è½»é‡çŠ¶æ€ï¼ˆå¦‚æ˜¯å¦å¼€é€šä¼šå‘˜ã€æ˜¯å¦ç»‘å®šæ‰‹æœºã€æ˜¯å¦å‚ä¸æ´»åŠ¨ï¼‰ï¼Œæ— éœ€å•ç‹¬å­˜å¤šä¸ªkey<br>\nâ€¢ è®¾è®¡ï¼š1ä¸ªkeyå¯¹åº”1ä¸ªç”¨æˆ·ï¼Œkey æ ¼å¼ <code>user:status:10086</code>ï¼Œä¸åŒ offset å¯¹åº”ä¸åŒçŠ¶æ€ï¼ˆoffset0=æ˜¯å¦ç»‘å®šæ‰‹æœºã€offset1=æ˜¯å¦ä¼šå‘˜ã€offset2=æ˜¯å¦å‚ä¸æ´»åŠ¨ï¼‰ï¼Œ1=æ˜¯ã€0=å¦<br>\nâ€¢ å®æ“å‘½ä»¤ï¼š</p>\n<ol>\n<li class=\"lvl-3\">\n<p>ç»™ç”¨æˆ·10086ç»‘å®šæ‰‹æœºï¼š<code>SETBIT user:status:10086 0 1</code></p>\n</li>\n<li class=\"lvl-3\">\n<p>å¼€é€šä¼šå‘˜ï¼š<code>SETBIT user:status:10086 1 1</code></p>\n</li>\n<li class=\"lvl-3\">\n<p>æŸ¥è¯¢æ˜¯å¦æ˜¯ä¼šå‘˜ï¼š<code>GETBIT user:status:10086 1</code></p>\n</li>\n</ol>\n<p>â€¢ ä¼˜åŠ¿ï¼š1ä¸ªkeyæ‰¿è½½ç”¨æˆ·Nä¸ªçŠ¶æ€ï¼Œæ— éœ€ç»´æŠ¤å¤šä¸ª String/Hashï¼ŒæŸ¥è¯¢å’Œä¿®æ”¹å‡ä¸ºO(1)ï¼Œæç®€é«˜æ•ˆã€‚</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŠ£åŠ¿ï¼šè‹¥æƒ³æŸ¥çœ‹ç”¨æˆ·æ‰€æœ‰çŠ¶æ€ï¼Œåˆ™éœ€è¦éå†æ‰€æœ‰ offset çš„ä½ï¼Œæ•ˆç‡è¾ƒä½ï¼Œå¦å¤–ç»Ÿè®¡å“ªäº›ç”¨æˆ·å¼€å¯äº†æŸä¸ªçŠ¶æ€ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚å¦‚éœ€è¦ç²¾ç¡®æŸ¥è¯¢å’Œèšåˆç»Ÿè®¡åˆ™éœ€è¦åŒæ­¥æ•°æ®åˆ°å…³ç³»å‹æ•°æ®åº“ã€‚</p>\n</li>\n</ul>\n<h3 id=\"åœºæ™¯4ï¼š-å¸ƒéš†è¿‡æ»¤å™¨åº•å±‚å®ç°ï¼ˆæ ¸å¿ƒä¾èµ–Bitmapï¼‰\">åœºæ™¯4ï¼š å¸ƒéš†è¿‡æ»¤å™¨åº•å±‚å®ç°ï¼ˆæ ¸å¿ƒä¾èµ–Bitmapï¼‰</h3>\n<p>â€¢ éœ€æ±‚ï¼šå®ç°æµ·é‡æ•°æ®çš„å¿«é€Ÿå»é‡åˆ¤æ–­ï¼ˆå¦‚ç¼“å­˜ç©¿é€é˜²æŠ¤ã€æµ·é‡URLå»é‡ï¼‰ï¼Œå…è®¸æå°è¯¯åˆ¤ç‡ï¼Œä¸å…è®¸æ¼åˆ¤<br>\nâ€¢ è®¾è®¡ï¼šç”¨1ä¸ªå¤§ Bitmap ä½œä¸ºåº•å±‚å­˜å‚¨ï¼Œé…åˆå¤šä¸ªå“ˆå¸Œå‡½æ•° â€”â€” æ•°æ®å­˜å…¥æ—¶ï¼Œé€šè¿‡å¤šä¸ªå“ˆå¸Œå‡½æ•°ç®—å‡ºå¤šä¸ª offsetï¼Œå°†å¯¹åº” bit è®¾ä¸º1ï¼›æŸ¥è¯¢æ—¶ï¼Œè‹¥æ‰€æœ‰å“ˆå¸Œå¯¹åº”çš„ offset éƒ½æ˜¯1ï¼Œåˆ™å¤§æ¦‚ç‡å­˜åœ¨ï¼Œå¦åˆ™ä¸€å®šä¸å­˜åœ¨<br>\nâ€¢ å®æ“ï¼šRedis 7 å¯ç›´æ¥ç”¨ Bitmap æ‰‹åŠ¨å®ç°ï¼Œä¹Ÿå¯ç»“åˆ RedisBloom æ‰©å±•ï¼ˆæ›´æ˜“ç”¨ï¼‰ï¼Œæ ¸å¿ƒåŸç†æ˜¯ Bitmap çš„ä½è®¾ç½®ä¸æŸ¥è¯¢ã€‚<br>\nâ€¢ ä¼˜åŠ¿ï¼šå­˜å‚¨1äº¿æ¡æ•°æ®ï¼Œè¯¯åˆ¤ç‡5%çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä»…éœ€çº¦ 12MB å†…å­˜ï¼ŒæŸ¥è¯¢é€Ÿåº¦æè‡´å¿«ã€‚</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŠ£åŠ¿ï¼šå¸ƒéš†è¿‡æ»¤å™¨è™½ç„¶æœ‰æå°è¯¯åˆ¤ç‡ï¼Œä½†ä¸å…è®¸åˆ é™¤ã€‚</p>\n</li>\n</ul>\n<h2 id=\"æ³¨æ„äº‹é¡¹ï¼ˆé¿å‘å…³é”®ï¼‰\">æ³¨æ„äº‹é¡¹ï¼ˆé¿å‘å…³é”®ï¼‰</h2>\n<ol>\n<li class=\"lvl-3\">\n<p>offset ä¸è¦æ— é™åˆ¶è¿‡å¤§ï¼šè™½ Redis æ”¯æŒè¶…å¤§ offsetï¼Œä½†è¿‡å¤§ï¼ˆå¦‚è¶…è¿‡10äº¿ï¼‰ä¼šå¯¼è‡´ Bitmap å ç”¨å†…å­˜éª¤å¢ï¼Œéœ€åˆç†è§„åˆ’ offset èŒƒå›´ï¼ˆå¦‚ç”¨æˆ·IDåšå“ˆå¸Œæ˜ å°„å‹ç¼©ï¼‰</p>\n</li>\n<li class=\"lvl-3\">\n<p>é¿å…å• key è¿‡å¤§ï¼šå•ä¸ª Bitmap å»ºè®®æ§åˆ¶åœ¨1GBå†…ï¼ˆå¯¹åº”çº¦85äº¿ bitï¼‰ï¼Œè¿‡å¤§æ˜“å¯¼è‡´RedisæŒä¹…åŒ–/è¿ç§»è€—æ—¶è¿‡é•¿</p>\n</li>\n<li class=\"lvl-3\">\n<p>æ³¨æ„ç¼–ç å…¼å®¹ï¼šBitmap åŸºäº Stringï¼ŒRedis ä¼šè‡ªåŠ¨ç”¨ RAW ç¼–ç å­˜å‚¨ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®</p>\n</li>\n</ol>\n<h2 id=\"Bitmap-å‘½ä»¤\">Bitmap å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>SpringBoot çš„ <code>StringRedisTemplate.opsForValue()</code> ä¸­ Bitmap æ•°æ®ç±»å‹ çš„æ“ä½œæ–¹æ³•ä¸ Redis åŸç”Ÿå‘½ä»¤çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<blockquote>\n<p>æ³¨æ„è¿™é‡Œä¸€å®šè¦ç”¨ <code>StringRedisTemplate</code> æ¥æ“ä½œ Bitmap</p>\n</blockquote>\n<h3 id=\"å†™æ“ä½œï¼ˆä½ä¿®æ”¹ï¼‰\">å†™æ“ä½œï¼ˆä½ä¿®æ”¹ï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>è®¾ç½®æŒ‡å®šåç§»é‡çš„ä½</td>\n<td><code>setBit(K key, long offset, boolean value)</code></td>\n<td><code>SETBIT key offset value</code></td>\n<td>è¿”å›æ—§å€¼ï¼ˆ0 / 1ï¼‰ï¼Œoffset ä» 0 å¼€å§‹</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>offset è¡¨ç¤º ç¬¬å‡ ä½ï¼ˆbitï¼‰ï¼Œä¸æ˜¯å­—èŠ‚</p>\n</blockquote>\n<h3 id=\"è¯»æ“ä½œï¼ˆä½æŸ¥è¯¢ï¼‰\">è¯»æ“ä½œï¼ˆä½æŸ¥è¯¢ï¼‰</h3>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•åŠŸèƒ½</th>\n<th>æ–¹æ³•</th>\n<th>Redis åŸå§‹å‘½ä»¤</th>\n<th>å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>è·å–æŒ‡å®šåç§»é‡çš„ä½</td>\n<td><code>getBit(K key, long offset)</code></td>\n<td><code>GETBIT key offset</code></td>\n<td>è¿”å› 0 / 1ï¼Œä¸ä¼šä¿®æ”¹æ•°æ®</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"Bitmap-å¸¸ç”¨ä½†-Spring-æœªç›´æ¥å°è£…çš„å‘½ä»¤\">Bitmap å¸¸ç”¨ä½† Spring æœªç›´æ¥å°è£…çš„å‘½ä»¤</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Spring Data Redis ä¸­é€šå¸¸é€šè¿‡ RedisCallback æˆ– execute è°ƒç”¨è¿™äº›å‘½ä»¤ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Redis å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>BITCOUNT key [start end]</code></td>\n<td>ç»Ÿè®¡ bit=1 çš„æ•°é‡</td>\n<td>å¸¸ç”¨äºæ´»è·ƒç”¨æˆ·ç»Ÿè®¡</td>\n</tr>\n<tr>\n<td><code>BITPOS key bit [start end]</code></td>\n<td>æŸ¥æ‰¾ç¬¬ä¸€ä¸ª 0/1 çš„ä½ç½®</td>\n<td>å¸¸ç”¨äºåˆ†é…ä½</td>\n</tr>\n<tr>\n<td><code>BITOP AND/OR/XOR/NOT</code></td>\n<td>ä½è¿ç®—</td>\n<td>å¤š bitmap è®¡ç®—</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.example.demo.bitmap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.example.demo.CommonUtil;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.domain.Range;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisStringCommands;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisCallback;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.StandardCharsets;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">BitmapUtil</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> StringRedisTemplate redisTemplate;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * BITCOUNT key [start end]</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * ç»Ÿè®¡ bit=1 çš„æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Long <span class=\"title function_\">bitCount</span><span class=\"params\">(String key)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt;</span><br><span class=\"line\">                connection.stringCommands().bitCount(key.getBytes(StandardCharsets.UTF_8))</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Long <span class=\"title function_\">bitCount</span><span class=\"params\">(String key, <span class=\"type\">long</span> start, <span class=\"type\">long</span> end)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt;</span><br><span class=\"line\">                connection.stringCommands().bitCount(key.getBytes(), start, end)</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * BITPOS key bit [start] [end]</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * bit = false â†’ æŸ¥æ‰¾ç¬¬ä¸€ä¸ª 0</span></span><br><span class=\"line\"><span class=\"comment\">     * bit = true â†’ æŸ¥æ‰¾ç¬¬ä¸€ä¸ª 1</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * è¿”å›å€¼æ˜¯ bit ç´¢å¼•ï¼ˆä¸æ˜¯ byteï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Long <span class=\"title function_\">bitPos</span><span class=\"params\">(String key, <span class=\"type\">boolean</span> bit)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt;</span><br><span class=\"line\">                connection.stringCommands().bitPos(key.getBytes(), bit)</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Long <span class=\"title function_\">bitPos</span><span class=\"params\">(String key, <span class=\"type\">boolean</span> bit, <span class=\"type\">long</span> start, <span class=\"type\">long</span> end)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt;</span><br><span class=\"line\">                connection.stringCommands().bitPos(key.getBytes(), bit, Range.open(start, end))</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * BITOP operation destKey key [key ...]</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * operation: AND\\OR\\XOR\\NOT</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * è¿ç®—ç»“æœä¿å­˜åœ¨ destKey ä¸­</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Long <span class=\"title function_\">bitOp</span><span class=\"params\">(String destKey, RedisStringCommands.BitOperation operation, String... sourceKeys)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            <span class=\"type\">byte</span>[][] keys = Arrays.stream(sourceKeys)</span><br><span class=\"line\">                    .map(String::getBytes)</span><br><span class=\"line\">                    .toArray(<span class=\"type\">byte</span>[][]::<span class=\"keyword\">new</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.stringCommands().bitOp(</span><br><span class=\"line\">                    operation,</span><br><span class=\"line\">                    destKey.getBytes(),</span><br><span class=\"line\">                    keys</span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis Bitmap æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/ Bitmap æ ¸å¿ƒè¯¦è§£ Redis Bitmap å¹¶éç‹¬ç«‹æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯åŸºäº String ç±»å‹çš„ä½æ“ä½œæ‰©å±• String åº•å±‚æ˜¯å­—èŠ‚æ•°ç»„ï¼ŒBitmap å°±æ˜¯å¯¹æ•°ç»„ä¸­å•ä¸ª bit åšè¯»å†™ï¼ˆbit åªæœ‰ 0/1 ä¸¤ä¸ªå€¼ï¼‰ Bitmap å‘½ä»¤ä½¿ç”¨æ–¹å¼ æ ¸å¿ƒå›´ç»•ã€Œä½è®¾ç½®ã€ä½æŸ¥è¯¢ã€ä½ç»Ÿè®¡ã€ä½è¿ç®—ã€å››ç±»å‘½ä»¤ï¼Œæ˜¯æ—¥å¸¸ä½¿ç”¨çš„åŸºç¡€ 1. ä½è®¾ç½®ï¼šSETBIT key offset value ç»™æŒ‡å®š key çš„ç¬¬ offset ä½è®¾ 0/1ï¼ˆoffset ä» 0 å¼€å§‹ï¼Œæ”¯æŒè¶…å¤§åç§»é‡ï¼ŒRedis ä¼šè‡ªåŠ¨æ‰©å®¹ï¼‰ offset ä»å·¦å¾€å³é€’å¢ï¼Œä»å·¦åˆ°å³ä¸º 0ã€1ã€2â€¦ï¼Œè‡³å°‘ç”³è¯· 8bit ç©ºé—´ï¼Œä¸è¶³ 8bit æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰©å±•åˆ° 8bit å³ 1byte 123456789SETBIT bitkey 1 1 # å®é™…çš„bitä¸º 01000000SETBIT bitkey 10 1 # å®é™…çš„bitä¸º 0100000000100000# æ“ä½œ StringSET k1 v1 # å®é™…çš„bitä¸º 0111011000110001SETBIT k1 1 0 # å®é™…bitä¸º 0011011000110001GET k1 # è¾“å‡º 61# bitmap å®é™…ä¸Šæ˜¯ stringTYPE bitkey # è¾“å‡º string 2. ä½æŸ¥è¯¢ï¼šGETBIT key offset æŸ¥è¯¢æŒ‡å®šåç§»é‡çš„ä½å€¼ï¼Œä¸å­˜åœ¨çš„ offset é»˜è®¤è¿”å› 0 123GETBIT bitkey 1# è¾“å‡º(integer) 1 3. ä½ç»Ÿè®¡ï¼šBITCOUNT key [start end] ç»Ÿè®¡ key ä¸­å€¼ä¸º 1 çš„ bit æ€»æ•°ï¼Œå¯é€‰æŒ‰å­—èŠ‚èŒƒå›´ï¼ˆstart/end æ˜¯å­—èŠ‚ç´¢å¼•ï¼‰ç­›é€‰ 123BITCOUNT bitkey# ç­‰ä»·äºBITCOUNT bitkey 0 -1 4. ä½è¿ç®—ï¼šBITOP op destkey key1 key2... å¯¹å¤šä¸ª Bitmap åš ä¸ï¼ˆANDï¼‰ã€æˆ–ï¼ˆORï¼‰ã€å¼‚æˆ–ï¼ˆXORï¼‰ã€éï¼ˆNOTï¼‰è¿ç®—ï¼Œç»“æœå­˜å…¥ destkey 12# å°†key1 ä¸ key2 åšæŒ‰ä½ä¸è¿ç®—ï¼Œç»“æœå­˜å…¥ destkeyBITOP AND destkey key1 key2 5. ä½æŸ¥æ‰¾ï¼šBITPOS key value [start end] æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ä¸º 0/1 çš„ bit åç§»é‡ï¼Œå¿«é€Ÿå®šä½ç›®æ ‡ä½ 123BITPOS bitkey 1# ç­‰ä»·äºBITPOS bitkey 1 0 -1 æ ¸å¿ƒä½¿ç”¨åœºæ™¯ + å®æ“ä¸¾ä¾‹ï¼ˆè´´åˆå¼€å‘å®æˆ˜ï¼‰ Bitmap çš„æ ¸å¿ƒä¼˜åŠ¿æ˜¯æè‡´çœå†…å­˜+é«˜æ•ˆç»Ÿè®¡ï¼ˆ1 ä¸ªå­—èŠ‚=8 ä¸ª bitï¼Œå­˜å‚¨ 1000 ä¸‡æ¡çŠ¶æ€ä»…éœ€çº¦ 1.2MBï¼‰ï¼Œä»¥ä¸‹æ˜¯é«˜é¢‘åœºæ™¯ åœºæ™¯1ï¼š ç”¨æˆ·ç­¾åˆ°/æ‰“å¡ï¼ˆæœ€ç»å…¸åœºæ™¯ï¼‰ â€¢ éœ€æ±‚ï¼šè®°å½•ç”¨æˆ·æ¯æ—¥ç­¾åˆ°çŠ¶æ€ï¼ŒæŸ¥è¯¢æŸç”¨æˆ·æŸå¤©æ˜¯å¦ç­¾åˆ°ã€ç»Ÿè®¡æŸç”¨æˆ·æœˆåº¦ç­¾åˆ°æ¬¡æ•° â€¢ è®¾è®¡ï¼škey æ ¼å¼ user:sign:uid:202512ï¼ˆç”¨æˆ·2025å¹´12æœˆç­¾åˆ°ï¼‰ï¼Œoffset ä¸ºæ—¥æœŸï¼ˆ1å·=0ã€2å·=1â€¦31å·=30ï¼‰ï¼Œç­¾åˆ°è®¾ 1ã€æœªç­¾åˆ°é»˜è®¤ 0 â€¢ å®æ“å‘½ä»¤ï¼š 12æœˆ1å·ç­¾åˆ°ï¼šSETBIT user:sign:uid:202512 0 1 æŸ¥è¯¢12æœˆ1å·æ˜¯å¦ç­¾åˆ°ï¼šGETBIT user:sign:uid:202512 0ï¼ˆè¿”å›1=ç­¾åˆ°ï¼‰ ç»Ÿè®¡12æœˆæ€»ç­¾åˆ°æ¬¡æ•°ï¼šBITCOUNT user:sign:uid:202512 â€¢ ä¼˜åŠ¿ï¼š1ä¸ªç”¨æˆ·1ä¸ªæœˆç­¾åˆ°ä»…å  4 å­—èŠ‚ï¼ˆ31 bitï¼‰ï¼Œç™¾ä¸‡ç”¨æˆ·æœˆåº¦ç­¾åˆ°ä»…å çº¦ 3.9MBï¼Œè¿œè¶…æ•°æ®åº“å­˜å‚¨çš„æ€§ä»·æ¯”ã€‚ åŠ£åŠ¿ï¼šè‹¥æƒ³æŸ¥è¯¢è¯¥ç”¨æˆ·æœ¬æœˆå†…éƒ½å“ªå¤©ç­¾åˆ°äº†ï¼Œå³è¦æŸ¥çœ‹bitmapå“ªäº›ä½ä¸º1ï¼Œåˆ™bitmapä¸æ”¯æŒè¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥åœ¨ä¸šåŠ¡ç«¯å®ç°ã€‚å¦‚éœ€è¦ç²¾ç¡®æŸ¥è¯¢å’Œèšåˆç»Ÿè®¡åˆ™éœ€è¦åŒæ­¥æ•°æ®åˆ°å…³ç³»å‹æ•°æ®åº“ã€‚ åœºæ™¯2ï¼š æ—¥æ´»/å‘¨æ´»/æœˆæ´»ï¼ˆDAU/WAU/MAUï¼‰ç»Ÿè®¡ï¼ˆé«˜å¹¶å‘åœºæ™¯é¦–é€‰ï¼‰ â€¢ éœ€æ±‚ï¼šç»Ÿè®¡æ¯æ—¥è®¿é—®å¹³å°çš„ç”¨æˆ·æ•°ï¼Œå¿«é€Ÿè®¡ç®—å‘¨æ´»ï¼ˆ7å¤©å†…è‡³å°‘è®¿é—®1æ¬¡ï¼‰ã€æœˆæ´»ï¼Œå»é‡ç»Ÿè®¡ â€¢ è®¾è®¡ï¼šæŒ‰æ—¥æœŸå»º Bitmapï¼Œkey æ ¼å¼ active:user:20251217ï¼ˆå½“æ—¥æ´»è·ƒï¼‰ï¼Œoffset è®¾ä¸ºç”¨æˆ·å”¯ä¸€IDï¼ˆéœ€ç¡®ä¿IDæ˜¯è¿ç»­æˆ–å¯æ˜ å°„ä¸ºæ•°å­—ï¼Œé¿å…è¶…å¤§åç§»é‡ï¼‰ï¼Œç”¨æˆ·è®¿é—®åˆ™è®¾ 1 â€¢ å®æ“å‘½ä»¤ï¼š ç”¨æˆ·ID 10086 12æœˆ17æ—¥è®¿é—®ï¼šSETBIT active:user:20251217 10086 1 ç»Ÿè®¡12æœˆ17æ—¥æ—¥æ´»ï¼šBITCOUNT active:user:20251217 ç»Ÿè®¡12æœˆ15-17æ—¥3å¤©å†…æ´»è·ƒçš„ç”¨æˆ·æ•°ï¼šBITOP OR active:user:20251215_17 active:user:20251215 active:user:20251216 active:user:20251217 â†’ å†æ‰§è¡Œ BITCOUNT active:user:20251215_17 ç»Ÿè®¡12æœˆ15-17æ—¥æ¯å¤©éƒ½ç™»å½•çš„ç”¨æˆ·æ•°ï¼šBITOP AND active:user:20251215_17 active:user:20251215 active:user:20251216 active:user:20251217 â†’ å†æ‰§è¡Œ BITCOUNT active:user:20251215_17 â€¢ ä¼˜åŠ¿ï¼šç™¾ä¸‡çº§ç”¨æˆ·æ—¥æ´»ç»Ÿè®¡ï¼Œå• Bitmap ä»…å çº¦ 125KBï¼Œä½è¿ç®—åˆå¹¶ç»Ÿè®¡é€Ÿåº¦æ¯«ç§’çº§ï¼Œè¿œå¿«äºæ•°æ®åº“ group by å»é‡ã€‚ åŠ£åŠ¿ï¼šè‹¥æƒ³æŸ¥çœ‹æœ¬æœˆå†…å“ªäº›ç”¨æˆ·ç™»å½•è¿‡ï¼Œåˆ™éœ€è¦éå† Bitmap çš„æ‰€æœ‰ offset ä½ï¼Œæ•ˆç‡è¾ƒä½ã€‚å¦‚éœ€è¦ç²¾ç¡®æŸ¥è¯¢å’Œèšåˆç»Ÿè®¡åˆ™éœ€è¦åŒæ­¥æ•°æ®åˆ°å…³ç³»å‹æ•°æ®åº“ã€‚ åœºæ™¯3ï¼š åŠŸèƒ½å¼€å…³/çŠ¶æ€æ ‡è®°ï¼ˆå¤šç»´åº¦è½»é‡æ ‡è®°ï¼‰ â€¢ éœ€æ±‚ï¼šç»™ç”¨æˆ·æ ‡è®°å¤šç±»è½»é‡çŠ¶æ€ï¼ˆå¦‚æ˜¯å¦å¼€é€šä¼šå‘˜ã€æ˜¯å¦ç»‘å®šæ‰‹æœºã€æ˜¯å¦å‚ä¸æ´»åŠ¨ï¼‰ï¼Œæ— éœ€å•ç‹¬å­˜å¤šä¸ªkey â€¢ è®¾è®¡ï¼š1ä¸ªkeyå¯¹åº”1ä¸ªç”¨æˆ·ï¼Œkey æ ¼å¼ user:status:10086ï¼Œä¸åŒ offset å¯¹åº”ä¸åŒçŠ¶æ€ï¼ˆoffset0=æ˜¯å¦ç»‘å®šæ‰‹æœºã€offset1=æ˜¯å¦ä¼šå‘˜ã€offset2=æ˜¯å¦å‚ä¸æ´»åŠ¨ï¼‰ï¼Œ1=æ˜¯ã€0=å¦ â€¢ å®æ“å‘½ä»¤ï¼š ç»™ç”¨æˆ·10086ç»‘å®šæ‰‹æœºï¼šSETBIT user:status:10086 0 1 å¼€é€šä¼šå‘˜ï¼šSETBIT user:status:10086 1 1 æŸ¥è¯¢æ˜¯å¦æ˜¯ä¼šå‘˜ï¼šGETBIT user:status:10086 1 â€¢ ä¼˜åŠ¿ï¼š1ä¸ªkeyæ‰¿è½½ç”¨æˆ·Nä¸ªçŠ¶æ€ï¼Œæ— éœ€ç»´æŠ¤å¤šä¸ª String/Hashï¼ŒæŸ¥è¯¢å’Œä¿®æ”¹å‡ä¸ºO(1)ï¼Œæç®€é«˜æ•ˆã€‚ åŠ£åŠ¿ï¼šè‹¥æƒ³æŸ¥çœ‹ç”¨æˆ·æ‰€æœ‰çŠ¶æ€ï¼Œåˆ™éœ€è¦éå†æ‰€æœ‰ offset çš„ä½ï¼Œæ•ˆç‡è¾ƒä½ï¼Œå¦å¤–ç»Ÿè®¡å“ªäº›ç”¨æˆ·å¼€å¯äº†æŸä¸ªçŠ¶æ€ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚å¦‚éœ€è¦ç²¾ç¡®æŸ¥è¯¢å’Œèšåˆç»Ÿè®¡åˆ™éœ€è¦åŒæ­¥æ•°æ®åˆ°å…³ç³»å‹æ•°æ®åº“ã€‚ åœºæ™¯4ï¼š å¸ƒéš†è¿‡æ»¤å™¨åº•å±‚å®ç°ï¼ˆæ ¸å¿ƒä¾èµ–Bitmapï¼‰ â€¢ éœ€æ±‚ï¼šå®ç°æµ·é‡æ•°æ®çš„å¿«é€Ÿå»é‡åˆ¤æ–­ï¼ˆå¦‚ç¼“å­˜ç©¿é€é˜²æŠ¤ã€æµ·é‡URLå»é‡ï¼‰ï¼Œå…è®¸æå°è¯¯åˆ¤ç‡ï¼Œä¸å…è®¸æ¼åˆ¤ â€¢ è®¾è®¡ï¼šç”¨1ä¸ªå¤§ Bitmap ä½œä¸ºåº•å±‚å­˜å‚¨ï¼Œé…åˆå¤šä¸ªå“ˆå¸Œå‡½æ•° â€”â€” æ•°æ®å­˜å…¥æ—¶ï¼Œé€šè¿‡å¤šä¸ªå“ˆå¸Œå‡½æ•°ç®—å‡ºå¤šä¸ª offsetï¼Œå°†å¯¹åº” bit è®¾ä¸º1ï¼›æŸ¥è¯¢æ—¶ï¼Œè‹¥æ‰€æœ‰å“ˆå¸Œå¯¹åº”çš„ offset éƒ½æ˜¯1ï¼Œåˆ™å¤§æ¦‚ç‡å­˜åœ¨ï¼Œå¦åˆ™ä¸€å®šä¸å­˜åœ¨ â€¢ å®æ“ï¼šRedis 7 å¯ç›´æ¥ç”¨ Bitmap æ‰‹åŠ¨å®ç°ï¼Œä¹Ÿå¯ç»“åˆ RedisBloom æ‰©å±•ï¼ˆæ›´æ˜“ç”¨ï¼‰ï¼Œæ ¸å¿ƒåŸç†æ˜¯ Bitmap çš„ä½è®¾ç½®ä¸æŸ¥è¯¢ã€‚ â€¢ ä¼˜åŠ¿ï¼šå­˜å‚¨1äº¿æ¡æ•°æ®ï¼Œè¯¯åˆ¤ç‡5%çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä»…éœ€çº¦ 12MB å†…å­˜ï¼ŒæŸ¥è¯¢é€Ÿåº¦æè‡´å¿«ã€‚ åŠ£åŠ¿ï¼šå¸ƒéš†è¿‡æ»¤å™¨è™½ç„¶æœ‰æå°è¯¯åˆ¤ç‡ï¼Œä½†ä¸å…è®¸åˆ é™¤ã€‚ æ³¨æ„äº‹é¡¹ï¼ˆé¿å‘å…³é”®ï¼‰ offset ä¸è¦æ— é™åˆ¶è¿‡å¤§ï¼šè™½ Redis æ”¯æŒè¶…å¤§ offsetï¼Œä½†è¿‡å¤§ï¼ˆå¦‚è¶…è¿‡10äº¿ï¼‰ä¼šå¯¼è‡´ Bitmap å ç”¨å†…å­˜éª¤å¢ï¼Œéœ€åˆç†è§„åˆ’ offset èŒƒå›´ï¼ˆå¦‚ç”¨æˆ·IDåšå“ˆå¸Œæ˜ å°„å‹ç¼©ï¼‰ é¿å…å• key è¿‡å¤§ï¼šå•ä¸ª Bitmap å»ºè®®æ§åˆ¶åœ¨1GBå†…ï¼ˆå¯¹åº”çº¦85äº¿ bitï¼‰ï¼Œè¿‡å¤§æ˜“å¯¼è‡´RedisæŒä¹…åŒ–/è¿ç§»è€—æ—¶è¿‡é•¿ æ³¨æ„ç¼–ç å…¼å®¹ï¼šBitmap åŸºäº Stringï¼ŒRedis ä¼šè‡ªåŠ¨ç”¨ RAW ç¼–ç å­˜å‚¨ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½® Bitmap å‘½ä»¤ SpringBoot çš„ StringRedisTemplate.opsForValue() ä¸­ Bitmap æ•°æ®ç±»å‹ çš„æ“ä½œæ–¹æ³•ä¸ Redis åŸç”Ÿå‘½ä»¤çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š æ³¨æ„è¿™é‡Œä¸€å®šè¦ç”¨ StringRedisTemplate æ¥æ“ä½œ Bitmap å†™æ“ä½œï¼ˆä½ä¿®æ”¹ï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ å¤‡æ³¨ è®¾ç½®æŒ‡å®šåç§»é‡çš„ä½ setBit(K key, long offset, boolean value) SETBIT key offset value è¿”å›æ—§å€¼ï¼ˆ0 / 1ï¼‰ï¼Œoffset ä» 0 å¼€å§‹ offset è¡¨ç¤º ç¬¬å‡ ä½ï¼ˆbitï¼‰ï¼Œä¸æ˜¯å­—èŠ‚ è¯»æ“ä½œï¼ˆä½æŸ¥è¯¢ï¼‰ æ–¹æ³•åŠŸèƒ½ æ–¹æ³• Redis åŸå§‹å‘½ä»¤ å¤‡æ³¨ è·å–æŒ‡å®šåç§»é‡çš„ä½ getBit(K key, long offset) GETBIT key offset è¿”å› 0 / 1ï¼Œä¸ä¼šä¿®æ”¹æ•°æ® Bitmap å¸¸ç”¨ä½† Spring æœªç›´æ¥å°è£…çš„å‘½ä»¤ Spring Data Redis ä¸­é€šå¸¸é€šè¿‡ RedisCallback æˆ– execute è°ƒç”¨è¿™äº›å‘½ä»¤ã€‚ Redis å‘½ä»¤ åŠŸèƒ½ è¯´æ˜ BITCOUNT key [start end] ç»Ÿè®¡ bit=1 çš„æ•°é‡ å¸¸ç”¨äºæ´»è·ƒç”¨æˆ·ç»Ÿè®¡ BITPOS key bit [start end] æŸ¥æ‰¾ç¬¬ä¸€ä¸ª 0/1 çš„ä½ç½® å¸¸ç”¨äºåˆ†é…ä½ BITOP AND/OR/XOR/NOT ä½è¿ç®— å¤š bitmap è®¡ç®— 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374package com.example.demo.bitmap;import com.example.demo.CommonUtil;import org.springframework.data.domain.Range;import org.springframework.data.redis.connection.RedisStringCommands;import org.springframework.data.redis.core.RedisCallback;import org.springframework.stereotype.Component;import java.nio.charset.StandardCharsets;import java.util.Arrays;@Componentpublic class BitmapUtil &#123; @Autowired protected StringRedisTemplate redisTemplate; /** * BITCOUNT key [start end] * &lt;p&gt; * ç»Ÿè®¡ bit=1 çš„æ•°é‡ */ public Long bitCount(String key) &#123; return redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; connection.stringCommands().bitCount(key.getBytes(StandardCharsets.UTF_8)) ); &#125; public Long bitCount(String key, long start, long end) &#123; return redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; connection.stringCommands().bitCount(key.getBytes(), start, end) ); &#125; /** * BITPOS key bit [start] [end] * &lt;p&gt; * bit = false â†’ æŸ¥æ‰¾ç¬¬ä¸€ä¸ª 0 * bit = true â†’ æŸ¥æ‰¾ç¬¬ä¸€ä¸ª 1 * &lt;p&gt; * è¿”å›å€¼æ˜¯ bit ç´¢å¼•ï¼ˆä¸æ˜¯ byteï¼‰ */ public Long bitPos(String key, boolean bit) &#123; return redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; connection.stringCommands().bitPos(key.getBytes(), bit) ); &#125; public Long bitPos(String key, boolean bit, long start, long end) &#123; return redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; connection.stringCommands().bitPos(key.getBytes(), bit, Range.open(start, end)) ); &#125; /** * BITOP operation destKey key [key ...] * &lt;p&gt; * operation: AND\\OR\\XOR\\NOT * &lt;p&gt; * è¿ç®—ç»“æœä¿å­˜åœ¨ destKey ä¸­ */ public Long bitOp(String destKey, RedisStringCommands.BitOperation operation, String... sourceKeys) &#123; return redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; &#123; byte[][] keys = Arrays.stream(sourceKeys) .map(String::getBytes) .toArray(byte[][]::new); return connection.stringCommands().bitOp( operation, destKey.getBytes(), keys ); &#125;); &#125;&#125;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Redis Bitmap æ•°æ®ç±»å‹ æœ¬æ–‡åŸºäºredis-7.4.7ï¼Œspringboot-3.5.8 Rediså®˜ç½‘ï¼šhttps://redis.io/ Redis å‘½ä»¤æ–‡æ¡£ï¼šhttps://redis.io/docs/latest/commands/","date_published":"2025-12-18T13:30:05.000Z","tags":["æŠ€æœ¯","redis","redis"]}]}