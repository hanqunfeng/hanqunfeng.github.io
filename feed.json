{"version":"https://jsonfeed.org/version/1","name":"é£˜é€¸å³°çš„åšå®¢","home_page_url":"https://blog.hanqunfeng.com","feed_url":"https://blog.hanqunfeng.com/feed.json","author":{"name":"é£˜é€¸å³°"},"items":[{"id":"https://blog.hanqunfeng.com/2025/09/15/zookeeper-study/","url":"https://blog.hanqunfeng.com/2025/09/15/zookeeper-study/","title":"Zookeeper çš„å®‰è£…åŠä½¿ç”¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS8 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://zookeeper.apache.org\">Zookeeperå®˜ç½‘</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Zookeeper-ç®€ä»‹\">Zookeeper ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper æ˜¯ä¸€ä¸ªé›†ä¸­å¼æœåŠ¡ï¼Œç”¨äºï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>ZooKeeper å®˜æ–¹åŠŸèƒ½</th>\n<th>ä¸»è¦èŠ‚ç‚¹ç±»å‹</th>\n<th>å…·ä½“åœºæ™¯ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é…ç½®ä¸­å¿ƒ (Config Center)</td>\n<td>ç»´æŠ¤é…ç½®ä¿¡æ¯ (Configuration Management)</td>\n<td>æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰</td>\n<td>æŠŠæ•°æ®åº“è¿æ¥ä¿¡æ¯ã€ç³»ç»Ÿå‚æ•°ç­‰æ”¾åœ¨ ZooKeeper é‡Œï¼ŒåŠ¨æ€æ›´æ–°ï¼Œåƒ Apolloã€Spring Cloud Config ä¸€æ ·ã€‚</td>\n</tr>\n<tr>\n<td>æ³¨å†Œä¸­å¿ƒ (Service Registry)</td>\n<td>æä¾›å‘½åæœåŠ¡ (Naming Service)</td>\n<td>ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEphemeralï¼‰</td>\n<td>æœåŠ¡å®ä¾‹å¯åŠ¨æ—¶åœ¨ ZooKeeper é‡Œæ³¨å†Œè‡ªå·±çš„åœ°å€ï¼Œå®¢æˆ·ç«¯ä» ZooKeeper è·å–æœåŠ¡åˆ—è¡¨ï¼Œç±»ä¼¼äº Nacosã€Eurekaã€‚</td>\n</tr>\n<tr>\n<td>åˆ†å¸ƒå¼é” (Distributed Lock)</td>\n<td>åˆ†å¸ƒå¼åŒæ­¥ (Distributed Synchronization)</td>\n<td>ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEphemeral Sequentialï¼‰</td>\n<td>ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨æ‰§è¡Œå…³é”®ä»»åŠ¡ï¼Œå…¸å‹åº”ç”¨æ˜¯åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚</td>\n</tr>\n<tr>\n<td>æ¶ˆæ¯é˜Ÿåˆ— (Message Queue)</td>\n<td>é›†ç¾¤ç®¡ç†æœåŠ¡ (Cluster Management)</td>\n<td>æŒä¹…/ä¸´æ—¶èŠ‚ç‚¹ + Watch æœºåˆ¶</td>\n<td>é€šè¿‡ Watch æœºåˆ¶ç›‘å¬ ZNode å˜åŒ–ï¼ŒèŠ‚ç‚¹é—´ç”¨æ•°æ®å˜æ›´å½“â€œä¿¡å·â€ä¼ é€’æ¶ˆæ¯ï¼Œæ—©æœŸ Kafka ç”¨è¿‡è¿™ç§æ–¹å¼ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ª ZNodeã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸åŒäºæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä¿å­˜æ•°æ®ï¼Œæ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ 1MB çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬(version)ï¼Œç‰ˆæœ¬ä»0å¼€å§‹è®¡æ•°ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/QgdBSR.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"Zookeeper-å®‰è£…\">Zookeeper å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œ Zookeeper éœ€è¦å®‰è£… JDK1.8+ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ <a href=\"https://mirrors.tuna.tsinghua.edu.cn/Adoptium/\">OpenJDK11</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /usr/local/jdk</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/jdk</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> wget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">ln</span> -s jdk-11.0.28+6 jdk11</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">vim /etc/profile <span class=\"comment\"># æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class=\"line\">  <span class=\"built_in\">export</span> JAVA_HOME=/usr/local/jdk/jdk11</span><br><span class=\"line\">  <span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"comment\"># ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹javaç‰ˆæœ¬</span></span><br><span class=\"line\">java -version</span><br><span class=\"line\">openjdk version <span class=\"string\">&quot;11.0.28&quot;</span> 2025-07-15</span><br><span class=\"line\">OpenJDK Runtime Environment Temurin-11.0.28+6 (build 11.0.28+6)</span><br><span class=\"line\">OpenJDK 64-Bit Server VM Temurin-11.0.28+6 (build 11.0.28+6, mixed mode)</span><br></pre></td></tr></table></figure>\n<h3 id=\"å•æœºå®‰è£…\">å•æœºå®‰è£…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://zookeeper.apache.org/releases.html\">ä¸‹è½½ Zookeeper</a>ï¼Œç›®å‰æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ä¸º <code>3.8.4</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½</span></span><br><span class=\"line\">wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz</span><br><span class=\"line\"><span class=\"comment\"># è§£å‹</span></span><br><span class=\"line\">tar -zxvf apache-zookeeper-3.8.4-bin.tar.gz</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ä¸ªè½¯è¿æ¥ï¼Œæ–¹ä¾¿ä»¥åå‡çº§</span></span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s apache-zookeeper-3.8.4-bin zookeeper</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> zookeeper/conf</span><br><span class=\"line\"><span class=\"built_in\">cp</span> zoo_sample.cfg zoo.cfg</span><br><span class=\"line\"><span class=\"comment\"># å»ºè®®ä¿®æ”¹ zoo.cfg é…ç½®æ–‡ä»¶ï¼Œå°† dataDir=/tmp/zookeeper ä¿®æ”¹ä¸ºæŒ‡å®šçš„dataç›®å½•</span></span><br><span class=\"line\">vim zoo.cfg</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>zoo.cfg å‚æ•°è¯´æ˜</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼</th>\n<th>å•ä½ / å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>tickTime</strong></td>\n<td>ZooKeeper æ—¶é—´é…ç½®ä¸­çš„åŸºæœ¬å•ä½</td>\n<td>2000</td>\n<td>æ¯«ç§’</td>\n</tr>\n<tr>\n<td><strong>initLimit</strong></td>\n<td>follower åˆå§‹åŒ–è¿æ¥åˆ° leader çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•°</td>\n<td>10</td>\n<td>10 Ã— tickTime = 20000 ms</td>\n</tr>\n<tr>\n<td><strong>syncLimit</strong></td>\n<td>follower ä¸ leader æ•°æ®åŒæ­¥çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•°</td>\n<td>5</td>\n<td>5 Ã— tickTime = 10000 ms</td>\n</tr>\n<tr>\n<td><strong>dataDir</strong></td>\n<td>æ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•ï¼ˆæœªæŒ‡å®š dataLogDir æ—¶ï¼Œæ—¥å¿—ä¹Ÿä¼šä¿å­˜åœ¨æ­¤ç›®å½•ï¼‰</td>\n<td>/tmp/zookeeper</td>\n<td>ç›®å½•è·¯å¾„</td>\n</tr>\n<tr>\n<td><strong>clientPort</strong></td>\n<td>å®¢æˆ·ç«¯è¿æ¥ ZooKeeper çš„ç«¯å£å·</td>\n<td>2181</td>\n<td>é»˜è®¤ 2181</td>\n</tr>\n<tr>\n<td><strong>maxClientCnxns</strong></td>\n<td>å•ä¸ªå®¢æˆ·ç«¯æœ€å¤§å¹¶å‘è¿æ¥æ•°</td>\n<td>60</td>\n<td>è¶…è¿‡é™åˆ¶åæ–°è¿æ¥ä¼šè¢«æ‹’ç»</td>\n</tr>\n<tr>\n<td><strong>autopurge.snapRetainCount</strong></td>\n<td>å¿«ç…§æ–‡ä»¶ä¿ç•™ä¸ªæ•°ï¼Œè¶…è¿‡æ•°é‡çš„å°†ä¼šè¢«æ¸…ç†</td>\n<td>3</td>\n<td>é»˜è®¤ 3</td>\n</tr>\n<tr>\n<td><strong>autopurge.purgeInterval</strong></td>\n<td>æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš”æ—¶é—´ï¼Œå•ä½å°æ—¶ï¼Œ0 è¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†</td>\n<td>1</td>\n<td>1 å°æ—¶</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ zookeeper</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> zookeeper</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨</span></span><br><span class=\"line\">bin/zkServer.sh start</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">bin/zkServer.sh start conf/zoo.cfg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢</span></span><br><span class=\"line\">bin/zkServer.sh stop</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class=\"line\">bin/zkServer.sh status</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class=\"line\">./bin/zkServer.sh version</span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤å®‰è£…\">é›†ç¾¤å®‰è£…</h3>\n<h4 id=\"ZooKeeper-é›†ç¾¤è§’è‰²\">ZooKeeper é›†ç¾¤è§’è‰²</h4>\n<h5 id=\"1-Leaderï¼ˆé¢†å¯¼è€…ï¼‰\">1. Leaderï¼ˆé¢†å¯¼è€…ï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>èŒè´£ï¼š</strong></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">äº‹åŠ¡è¯·æ±‚ï¼ˆå†™æ“ä½œï¼‰çš„å”¯ä¸€è°ƒåº¦è€…å’Œå¤„ç†è€…ï¼Œä¿è¯é›†ç¾¤äº‹åŠ¡å¤„ç†çš„é¡ºåºæ€§ï¼›</li>\n<li class=\"lvl-4\">é›†ç¾¤å†…éƒ¨å„ä¸ªæœåŠ¡å™¨çš„è°ƒåº¦è€…ï¼›</li>\n<li class=\"lvl-4\">å¯¹äº <code>create</code>ã€<code>setData</code>ã€<code>delete</code> ç­‰å†™æ“ä½œè¯·æ±‚ï¼Œç»Ÿä¸€è½¬å‘ç»™ Leader å¤„ç†ï¼›</li>\n<li class=\"lvl-4\">Leader è´Ÿè´£å†³å®šç¼–å·ã€æ‰§è¡Œæ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º <strong>äº‹åŠ¡</strong>ã€‚</li>\n</ul>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‰å°è™šæ‹Ÿæœº zoo.cfg æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é€‰ä¸¾å‡º Leader è§’è‰²ï¼Œåˆ™å…¶ä½™å°±æ˜¯ Follower è§’è‰²ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.1=10.250.0.229:2888:3888</span><br><span class=\"line\">server.2=10.250.0.152:2888:3888</span><br><span class=\"line\">server.3=10.250.0.36:2888:3888</span><br></pre></td></tr></table></figure>\n<h5 id=\"2-Followerï¼ˆè·Ÿéšè€…ï¼‰\">2. Followerï¼ˆè·Ÿéšè€…ï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>èŒè´£ï¼š</strong></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡ï¼ˆè¯»æ“ä½œï¼‰è¯·æ±‚ï¼ˆå¯ä»¥ç›´æ¥å“åº”ï¼‰ï¼›</li>\n<li class=\"lvl-4\">è½¬å‘äº‹åŠ¡è¯·æ±‚ç»™ Leaderï¼›</li>\n<li class=\"lvl-4\">å‚ä¸é›†ç¾¤ Leader é€‰ä¸¾æŠ•ç¥¨ã€‚</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>leaderèŠ‚ç‚¹å¯ä»¥å¤„ç†è¯»å†™è¯·æ±‚ï¼Œfolloweråªå¯ä»¥å¤„ç†è¯»è¯·æ±‚ã€‚followeråœ¨æ¥åˆ°å†™è¯·æ±‚æ—¶ä¼šæŠŠå†™è¯·æ±‚è½¬å‘ç»™leaderæ¥å¤„ç†ã€‚</p>\n</blockquote>\n<h5 id=\"3-Observerï¼ˆè§‚å¯Ÿè€…ï¼‰\">3. Observerï¼ˆè§‚å¯Ÿè€…ï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>èŒè´£ï¼š</strong></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¯¹äºéäº‹åŠ¡è¯·æ±‚ï¼ˆè¯»æ“ä½œï¼‰å¯ä»¥ç‹¬ç«‹å¤„ç†ï¼›</li>\n<li class=\"lvl-4\">å¯¹äºäº‹åŠ¡è¯·æ±‚ä¼šè½¬å‘ç»™ Leader å¤„ç†ï¼›</li>\n<li class=\"lvl-4\">æ¥æ”¶æ¥è‡ª Leader çš„ <code>inform</code> ä¿¡æ¯ï¼Œæ›´æ–°æœ¬åœ°å­˜å‚¨ï¼›</li>\n<li class=\"lvl-4\">ä¸å‚ä¸æäº¤å’Œé€‰ä¸¾æŠ•ç¥¨ï¼›</li>\n<li class=\"lvl-4\">é€šå¸¸ç”¨äº <strong>æå‡é›†ç¾¤éäº‹åŠ¡å¤„ç†èƒ½åŠ›</strong>ï¼Œä¸å½±å“é›†ç¾¤äº‹åŠ¡å¤„ç†æ€§èƒ½ã€‚</li>\n</ul>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®ä¸€ä¸ª ID ä¸º 4 çš„è§‚å¯Ÿè€…èŠ‚ç‚¹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.4=10.250.0.56:2888:3888:observer</span><br></pre></td></tr></table></figure>\n<h4 id=\"é›†ç¾¤æ­å»º\">é›†ç¾¤æ­å»º</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¯å¢ƒå‡†å¤‡ï¼š4å°æœåŠ¡å™¨ï¼ŒæŒ‰ç…§ <code>å•æœºå®‰è£…</code> çš„æ–¹å¼å‡†å¤‡å¥½ Zookeeper ç¯å¢ƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.250.0.229</span><br><span class=\"line\">10.250.0.152</span><br><span class=\"line\">10.250.0.36</span><br><span class=\"line\">10.250.0.56</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>zoo.cfg</code> æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.1=10.250.0.229:2888:3888</span><br><span class=\"line\">server.2=10.250.0.152:2888:3888</span><br><span class=\"line\">server.3=10.250.0.36:2888:3888</span><br><span class=\"line\">server.4=10.250.0.56:2888:3888:observer</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«åœ¨ <code>dataDir</code> ç›®å½•ä¸‹åˆ›å»º <code>myid</code> æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸ server å¯¹åº”çš„ç¼–å·ï¼ˆæ³¨æ„ï¼šä¸Šä¸‹ä¸è¦æœ‰ç©ºè¡Œï¼Œå·¦å³ä¸è¦æœ‰ç©ºæ ¼ï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«å¯åŠ¨ Zookeeper æœåŠ¡å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ†åˆ«å¯åŠ¨4ä¸ªèŠ‚ç‚¹çš„zookeeper server</span></span><br><span class=\"line\">bin/zkServer.sh start</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°èŠ‚ç‚¹è§’è‰²ç±»å‹</span></span><br><span class=\"line\">bin/zkServer.sh status</span><br></pre></td></tr></table></figure>\n<h2 id=\"ZooKeeper-é»˜è®¤ç«¯å£è¯´æ˜\">ZooKeeper é»˜è®¤ç«¯å£è¯´æ˜</h2>\n<table>\n<thead>\n<tr>\n<th>ç«¯å£</th>\n<th>ç”¨é€”</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2181</td>\n<td>å®¢æˆ·ç«¯è¿æ¥ç«¯å£</td>\n<td>å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªç«¯å£è®¿é—® ZooKeeper</td>\n</tr>\n<tr>\n<td>2888</td>\n<td>é›†ç¾¤å†…éƒ¨é€šä¿¡</td>\n<td>follower ä¸ leader ä¹‹é—´åŒæ­¥æ•°æ®</td>\n</tr>\n<tr>\n<td>3888</td>\n<td>leader é€‰ä¸¾ç«¯å£</td>\n<td>é›†ç¾¤é€‰ä¸¾ leader ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>8080 (å¯é€‰)</td>\n<td>admin/metrics webç«¯å£</td>\n<td>å¦‚æœå¼€å¯äº† adminServer</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ°¸ä¹…å¼€å¯ç«¯å£</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=2181/tcp</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=2888/tcp</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=3888/tcp</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½¿ç”¨ adminServer</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=8080/tcp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --reload</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ˜¯å¦å¼€æ”¾æˆåŠŸ</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --list-all</span><br></pre></td></tr></table></figure>\n<h2 id=\"å®¢æˆ·ç«¯è¿æ¥\">å®¢æˆ·ç«¯è¿æ¥</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é»˜è®¤è¿æ¥ 127.0.0.1:2181</span></span><br><span class=\"line\">bin/zkCli.sh</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š -server ip:portï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œåˆ™è¿æ¥ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒZooKeeper ä¼šè‡ªåŠ¨å¤„ç†ä¸ Leader/Follower çš„äº¤äº’</span></span><br><span class=\"line\">bin/zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å®¢æˆ·ç«¯å‘½ä»¤ç®€ä»‹ï¼š<a href=\"https://zookeeper.apache.org/doc/r3.8.4/zookeeperCLI.html\">å‚è€ƒå®˜ç½‘</a></p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>è¯­æ³•ç¤ºä¾‹</th>\n<th>åŠŸèƒ½æè¿°</th>\n<th>å¸¸ç”¨å‚æ•°åŠè¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>help</strong></td>\n<td><code>help</code></td>\n<td>æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤</td>\n<td>æ— </td>\n<td><code>help</code></td>\n</tr>\n<tr>\n<td><strong>quit</strong></td>\n<td><code>quit</code></td>\n<td>é€€å‡ºå®¢æˆ·ç«¯</td>\n<td>æ— </td>\n<td><code>quit</code></td>\n</tr>\n<tr>\n<td><strong>ls</strong></td>\n<td><code>ls [-s] [-w] [-R] path</code></td>\n<td>æŸ¥çœ‹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</td>\n<td>- <code>-w</code>: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–<br>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-R</code>: é€’å½’æŸ¥çœ‹</td>\n<td><code>ls -s -w /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>create</strong></td>\n<td><code>create [-s] [-e] [-c] [-t ttl] path [data] [acl]</code></td>\n<td>åˆ›å»ºèŠ‚ç‚¹</td>\n<td>- <code>-s</code>: é¡ºåºèŠ‚ç‚¹<br>- <code>-e</code>: ä¸´æ—¶èŠ‚ç‚¹<br>- <code>-c</code>: å®¹å™¨èŠ‚ç‚¹<br>- <code>-t ttl</code>: TTLèŠ‚ç‚¹ï¼Œå•ä½æ¯«ç§’</td>\n<td><code>create -e /zk_test_ephemeral &quot;temp_data&quot;</code></td>\n</tr>\n<tr>\n<td><strong>get</strong></td>\n<td><code>get [-s] [-w] path</code></td>\n<td>è·å–èŠ‚ç‚¹æ•°æ®ä¿¡æ¯</td>\n<td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-w</code>: ç›‘å¬èŠ‚ç‚¹å˜åŒ–</td>\n<td><code>get -s -w /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>set</strong></td>\n<td><code>set [-s] [-v version] path data</code></td>\n<td>è®¾ç½®èŠ‚ç‚¹æ•°æ®</td>\n<td>- <code>-s</code>: é¡ºåºèŠ‚ç‚¹<br>- <code>-v</code>: æŒ‡å®šç‰ˆæœ¬å·</td>\n<td><code>set /zk_test &quot;new_data&quot;</code></td>\n</tr>\n<tr>\n<td><strong>getAcl</strong></td>\n<td><code>getAcl [-s] path</code></td>\n<td>è·å–èŠ‚ç‚¹è®¿é—®æ§åˆ¶ä¿¡æ¯</td>\n<td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</td>\n<td><code>getAcl /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>setAcl</strong></td>\n<td><code>setAcl [-s] [-v version] [-R] path acl</code></td>\n<td>è®¾ç½®èŠ‚ç‚¹è®¿é—®æ§åˆ¶åˆ—è¡¨</td>\n<td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-v</code>: æŒ‡å®šç‰ˆæœ¬å·<br>- <code>-R</code>: é€’å½’è®¾ç½®</td>\n<td><code>setAcl /zk_test world:anyone:r</code></td>\n</tr>\n<tr>\n<td><strong>stat</strong></td>\n<td><code>stat [-w] path</code></td>\n<td>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</td>\n<td>- <code>-w</code>: ç›‘å¬èŠ‚ç‚¹å˜åŒ–</td>\n<td><code>stat -w /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>delete</strong></td>\n<td><code>delete [-v version] path</code></td>\n<td>åˆ é™¤æŸä¸€èŠ‚ç‚¹ï¼ˆæ— å­èŠ‚ç‚¹ï¼‰</td>\n<td>- <code>-v</code>: èŠ‚ç‚¹ç‰ˆæœ¬å·</td>\n<td><code>delete /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>deleteall</strong></td>\n<td><code>deleteall path</code></td>\n<td>é€’å½’åˆ é™¤æŸä¸€èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹</td>\n<td>æ— </td>\n<td><code>deleteall /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>setquota</strong></td>\n<td><code>setquota [-n] [-b] val path</code></td>\n<td>å¯¹èŠ‚ç‚¹å¢åŠ é™åˆ¶</td>\n<td>- <code>-n</code>: å­èŠ‚ç‚¹æœ€å¤§ä¸ªæ•°<br>- <code>-b</code>: æ•°æ®å€¼æœ€å¤§é•¿åº¦ï¼Œ-1 è¡¨ç¤ºæ— é™åˆ¶</td>\n<td><code>setquota -n 5 /zk_test</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>GUI å·¥å…·</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>ç±»å‹ / è¿è¡Œæ–¹å¼</th>\n<th>ä¼˜ç‚¹</th>\n<th>æ³¨æ„äº‹é¡¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>PrettyZoo</strong></td>\n<td>æ¡Œé¢åº”ç”¨ï¼ˆJavaFXï¼‰(<a href=\"https://github.com/vran-dev/PrettyZoo\" title=\"vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...\">GitHub</a>)</td>\n<td>æ”¯æŒ Mac/Windows/Linuxï¼Œç•Œé¢å‹å¥½ï¼›æ”¯æŒèŠ‚ç‚¹åˆ›å»º/åˆ é™¤/æ›´æ–°/æŸ¥è¯¢ï¼ŒACL ç®¡ç†ï¼Œå¤š ZK å®ä¾‹ç®¡ç†ï¼ŒSSH éš§é“ç­‰åŠŸèƒ½ã€‚(<a href=\"https://github.com/vran-dev/PrettyZoo\" title=\"vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...\">GitHub</a>)</td>\n<td>é¡¹ç›®å·²ç» archivedï¼Œç»´æŠ¤å¯èƒ½ä¸æ´»è·ƒã€‚æœ€æ–°ç‰ˆå¯èƒ½åœ¨å…¼å®¹æ€§æˆ– Bug ä¿®å¤æ–¹é¢ä¸å¦‚æ´»è·ƒé¡¹ç›®ã€‚ä¹Ÿå¯èƒ½éœ€è¦è‡ªå·±æ„å»ºæˆ–è°ƒè¯•ã€‚(<a href=\"https://github.com/vran-dev/PrettyZoo\" title=\"vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...\">GitHub</a>)</td>\n</tr>\n<tr>\n<td><strong>ZooNavigator</strong></td>\n<td>Web ç•Œé¢ + å¯ Docker éƒ¨ç½²æˆ–æœ¬åœ°å¯åŠ¨(<a href=\"https://github.com/elkozmon/zoonavigator\" title=\"elkozmon/zoonavigator: Web-based ZooKeeper UI\">GitHub</a>)</td>\n<td>åŠŸèƒ½ä¸°å¯Œï¼›æ”¯æŒå¤šä¸ª Zookeeper ç‰ˆæœ¬ï¼ˆå¦‚ 3.5.x ï½ 3.9.xï¼‰ï¼›æµè§ˆ / ç¼–è¾‘ /æœç´¢èŠ‚ç‚¹ï¼›å¯¼å…¥å¯¼å‡ºé…ç½®ï¼›æ”¯æŒæµè§ˆå™¨è®¿é—®ï¼Œæ— éœ€æœ¬åœ° heavy GUIã€‚(<a href=\"https://github.com/elkozmon/zoonavigator\" title=\"elkozmon/zoonavigator: Web-based ZooKeeper UI\">GitHub</a>)</td>\n<td>å› ä¸º Web åº”ç”¨ï¼Œå¯èƒ½å¯¹æµè§ˆå™¨å®‰å…¨ç­–ç•¥ä¸ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿï¼›éœ€è¦éƒ¨ç½²è‡ªå·±ç‰ˆæœ¬æˆ– Dockerï¼›å¦‚æœè¦æ±‚æœ¬åœ°è„±æœºæ“ä½œæ—¶ï¼Œæœ‰äº›åŠŸèƒ½å¯èƒ½ç¨ä¸å¦‚æ¡Œé¢åº”ç”¨ã€‚</td>\n</tr>\n<tr>\n<td><strong>ZooKeeper Assistant</strong></td>\n<td>æ¡Œé¢ï¼ç®¡ç†å‘˜é¢æ¿ç±»å‹ï¼ˆæ”¯æŒç›‘æ§ç•Œé¢ç­‰ï¼‰(<a href=\"https://dev.to/redisant/an-exciting-apache-zookeeper-desktop-gui-1fdo\" title=\"An exciting Apache ZooKeeper Desktop GUI\">DEV Community</a>)</td>\n<td>é™¤äº†æµè§ˆèŠ‚ç‚¹æ ‘ä»¥å¤–ï¼Œè¿˜æä¾›å¥åº·çŠ¶æ€ç›‘æ§ï¼ˆå»¶è¿Ÿã€è¯·æ±‚æ•°ç­‰ï¼‰ã€ä¸åŒæ•°æ®æ ¼å¼æ”¯æŒï¼ˆJSON/XML ç­‰ï¼‰ã€å¯¼å…¥/å¯¼å‡ºèŠ‚ç‚¹æ•°æ®ã€å‘½ä»¤è¡Œæ“ä½œé›†æˆã€‚(<a href=\"https://dev.to/redisant/an-exciting-apache-zookeeper-desktop-gui-1fdo\" title=\"An exciting Apache ZooKeeper Desktop GUI\">DEV Community</a>)</td>\n<td>æœ‰äº›åŠŸèƒ½å¯èƒ½åœ¨ Mac ä¸Šå…¼å®¹æ€§æˆ–è§†è§‰ä½“éªŒéœ€è¦è°ƒè¯•ï¼›å…·ä½“ç‰ˆæœ¬æ”¯æŒæƒ…å†µè¦çœ‹æœ€è¿‘æ›´æ–°ã€‚æŸäº›ç›‘æ§ç•Œé¢å¯èƒ½ä¾èµ–äº ZK çš„æŒ‡æ ‡æˆ–æ’ä»¶ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Zookeeper-èŠ‚ç‚¹ç±»å‹\">Zookeeper èŠ‚ç‚¹ç±»å‹</h2>\n<table>\n<thead>\n<tr>\n<th>èŠ‚ç‚¹ç±»å‹</th>\n<th>ç”Ÿå‘½å‘¨æœŸè¯´æ˜</th>\n<th>åˆ›å»ºå‘½ä»¤ç¤ºä¾‹</th>\n<th>ç‰¹ç‚¹è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æŒä¹…èŠ‚ç‚¹</strong> (Persistent)</td>\n<td>èŠ‚ç‚¹ä¸€ç›´å­˜åœ¨ï¼Œé™¤éæ‰‹åŠ¨åˆ é™¤ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ŒèŠ‚ç‚¹ä¹Ÿä¸ä¼šæ¶ˆå¤±</td>\n<td><code>create /locks</code></td>\n<td>é€‚åˆå­˜å‚¨é…ç½®ä¿¡æ¯ã€å…ƒæ•°æ®ç­‰æŒä¹…æ•°æ®</td>\n</tr>\n<tr>\n<td><strong>ä¸´æ—¶èŠ‚ç‚¹</strong> (Ephemeral)</td>\n<td>å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ˆå¼‚å¸¸æˆ–è¶…æ—¶ï¼‰æ—¶ï¼ŒèŠ‚ç‚¹è‡ªåŠ¨è¢«åˆ é™¤</td>\n<td><code>create -e /locks/DBLock</code></td>\n<td>å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€ä¸´æ—¶ä¼šè¯æ•°æ®</td>\n</tr>\n<tr>\n<td><strong>æœ‰åºèŠ‚ç‚¹</strong> (Sequential)</td>\n<td>åœ¨æŒä¹…æˆ–ä¸´æ—¶èŠ‚ç‚¹åŸºç¡€ä¸Šï¼Œå¢åŠ æœ‰åºç¼–å·ï¼ŒZooKeeper è‡ªåŠ¨åœ¨èŠ‚ç‚¹åååŠ é€’å¢åºå·</td>\n<td><code>create -e -s /jobs/job</code></td>\n<td>å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€é˜Ÿåˆ—ç­‰éœ€è¦é¡ºåºçš„åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>å®¹å™¨èŠ‚ç‚¹</strong> (Container)</td>\n<td>V3.5.3+ï¼Œå½“å®¹å™¨èŠ‚ç‚¹ä¸‹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œå®¹å™¨èŠ‚ç‚¹ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤</td>\n<td><code>create -c /work</code></td>\n<td>é€‚åˆåˆ†å¸ƒå¼ä»»åŠ¡ä¸´æ—¶ç›®å½•ã€åŠ¨æ€æ•°æ®ç›®å½•</td>\n</tr>\n<tr>\n<td><strong>TTL èŠ‚ç‚¹</strong> (TTL)</td>\n<td>åœ¨æŒ‡å®š TTL æ—¶é—´å†…æœªä¿®æ”¹ä¸”æ— å­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆéœ€å¼€å¯ <code>extendedTypesEnabled=true</code> é…ç½®ï¼‰</td>\n<td><code>create -t 3000 /ttl_node</code></td>\n<td>é€‚åˆä¸´æ—¶ç¼“å­˜ã€ä¸´æ—¶çŠ¶æ€æ•°æ®ï¼Œè¿‡æœŸè‡ªåŠ¨æ¸…ç†</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åŒä¸€çº§èŠ‚ç‚¹ key åç§°æ˜¯å”¯ä¸€çš„</li>\n<li class=\"lvl-4\">åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå¿…é¡»è¦å¸¦ä¸Šå…¨è·¯å¾„</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"4å­—æ¯å‘½ä»¤\">4å­—æ¯å‘½ä»¤</h2>\n<h3 id=\"ä»€ä¹ˆæ˜¯-4-å­—æ¯å‘½ä»¤\">ä»€ä¹ˆæ˜¯ <code>4 å­—æ¯å‘½ä»¤</code>?</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper æä¾›äº†ä¸€ç»„ç®€çŸ­çš„ <code>4ä¸ªå­—æ¯çš„ç®¡ç†å‘½ä»¤</code>(Four Letter Words Commands)ï¼Œå¯ä»¥é€šè¿‡ TCP è¿æ¥ ZooKeeper ç«¯å£ï¼ˆé»˜è®¤ 2181ï¼‰å‘é€è¿™äº›å‘½ä»¤ï¼Œå¿«é€ŸæŸ¥çœ‹æˆ–ç®¡ç† ZooKeeper çŠ¶æ€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨çš„ <code>4å­—æ¯å‘½ä»¤</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>å¼•å…¥ç‰ˆæœ¬</th>\n<th>åŠŸèƒ½æè¿°</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>conf</code></td>\n<td>3.3.0</td>\n<td>æ‰“å°æœåŠ¡ç›¸å…³é…ç½®çš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo conf | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>cons</code></td>\n<td>3.3.0</td>\n<td>åˆ—å‡ºæ‰€æœ‰è¿æ¥åˆ°è¯¥æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥/ä¼šè¯è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥æ”¶/å‘é€çš„åŒ…æ•°é‡ã€ä¼šè¯IDã€æ“ä½œå»¶è¿Ÿã€æœ€åæ“ä½œæ‰§è¡Œæ—¶é—´ç­‰</td>\n<td><code>echo cons | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>crst</code></td>\n<td>3.3.0</td>\n<td>é‡ç½®æ‰€æœ‰è¿æ¥çš„è¿æ¥å’Œä¼šè¯ç»Ÿè®¡ä¿¡æ¯</td>\n<td><code>echo crst | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>dump</code></td>\n<td>-</td>\n<td>åˆ—å‡ºé‡è¦çš„ä¼šè¯å’Œä¸´æ—¶èŠ‚ç‚¹ä¿¡æ¯ï¼Œä»…åœ¨ Leader èŠ‚ç‚¹ä¸Šæœ‰æ•ˆ</td>\n<td><code>echo dump | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>envi</code></td>\n<td>-</td>\n<td>æ‰“å°æœåŠ¡ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo envi | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>reqs</code></td>\n<td>-</td>\n<td>åˆ—å‡ºæœªç»å¤„ç†çš„è¯·æ±‚</td>\n<td><code>echo reqs | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>ruok</code></td>\n<td>-</td>\n<td>æµ‹è¯•æœåŠ¡æ˜¯å¦å¤„äºæ­£å¸¸çŠ¶æ€ï¼›æ­£å¸¸è¿”å› <code>imok</code></td>\n<td><code>echo ruok | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>stat</code></td>\n<td>-</td>\n<td>è¾“å‡ºå…³äºæ€§èƒ½å’Œå®¢æˆ·ç«¯è¿æ¥çš„åˆ—è¡¨ä¿¡æ¯</td>\n<td><code>echo stat | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>srst</code></td>\n<td>-</td>\n<td>é‡ç½®æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯</td>\n<td><code>echo srst | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>srvr</code></td>\n<td>3.3.0</td>\n<td>åˆ—å‡ºè¿æ¥æœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo srvr | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>wchs</code></td>\n<td>3.3.0</td>\n<td>åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo wchs | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>wchc</code></td>\n<td>3.3.0</td>\n<td>é€šè¿‡ä¼šè¯åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ Watch ç›¸å…³çš„ä¼šè¯åˆ—è¡¨</td>\n<td><code>echo wchc | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>wchp</code></td>\n<td>3.3.0</td>\n<td>é€šè¿‡è·¯å¾„åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ä¼šè¯ç›¸å…³çš„è·¯å¾„</td>\n<td><code>echo wchp | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>mntr</code></td>\n<td>3.4.0</td>\n<td>è¾“å‡ºå¯ç”¨äºæ£€æµ‹é›†ç¾¤å¥åº·çŠ¶æ€çš„å…³é”®æŒ‡æ ‡å˜é‡åˆ—è¡¨</td>\n<td><code>echo mntr | nc 127.0.0.1 2181</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å¼€å¯-4å­—æ¯å‘½ä»¤\">å¼€å¯ <code>4å­—æ¯å‘½ä»¤</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ ZooKeeper 3.5.0 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œ4lw å‘½ä»¤é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå¿…é¡»åœ¨é…ç½®æ–‡ä»¶(zoo.cfg)ä¸­æ˜¾å¼å¼€å¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¡¨ç¤ºå…è®¸æ‰€æœ‰ 4lw å‘½ä»¤éƒ½èƒ½ç”¨ï¼ˆé£é™©æœ€å¤§ï¼‰</span></span><br><span class=\"line\">4lw.commands.whitelist=*</span><br><span class=\"line\"><span class=\"comment\"># è¿™æ ·åªå…è®¸æ‰§è¡Œ statã€confã€ruok è¿™å‡ ä¸ªå‘½ä»¤ã€‚</span></span><br><span class=\"line\">4lw.commands.whitelist=<span class=\"built_in\">stat</span>,conf,ruok</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨æ–¹æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœæ²¡æœ‰å®‰è£… ncï¼Œå¯ä»¥ä½¿ç”¨ yum å®‰è£…</span></span><br><span class=\"line\">yum install nc -y</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"built_in\">stat</span> | nc 127.0.0.1 2181</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS8 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ Zookeeperå®˜ç½‘ Zookeeper ç®€ä»‹ ZooKeeper æ˜¯ä¸€ä¸ªé›†ä¸­å¼æœåŠ¡ï¼Œç”¨äºï¼š åœºæ™¯ ZooKeeper å®˜æ–¹åŠŸèƒ½ ä¸»è¦èŠ‚ç‚¹ç±»å‹ å…·ä½“åœºæ™¯ç¤ºä¾‹ é…ç½®ä¸­å¿ƒ (Config Center) ç»´æŠ¤é…ç½®ä¿¡æ¯ (Configuration Management) æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰ æŠŠæ•°æ®åº“è¿æ¥ä¿¡æ¯ã€ç³»ç»Ÿå‚æ•°ç­‰æ”¾åœ¨ ZooKeeper é‡Œï¼ŒåŠ¨æ€æ›´æ–°ï¼Œåƒ Apolloã€Spring Cloud Config ä¸€æ ·ã€‚ æ³¨å†Œä¸­å¿ƒ (Service Registry) æä¾›å‘½åæœåŠ¡ (Naming Service) ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEphemeralï¼‰ æœåŠ¡å®ä¾‹å¯åŠ¨æ—¶åœ¨ ZooKeeper é‡Œæ³¨å†Œè‡ªå·±çš„åœ°å€ï¼Œå®¢æˆ·ç«¯ä» ZooKeeper è·å–æœåŠ¡åˆ—è¡¨ï¼Œç±»ä¼¼äº Nacosã€Eurekaã€‚ åˆ†å¸ƒå¼é” (Distributed Lock) åˆ†å¸ƒå¼åŒæ­¥ (Distributed Synchronization) ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEphemeral Sequentialï¼‰ ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨æ‰§è¡Œå…³é”®ä»»åŠ¡ï¼Œå…¸å‹åº”ç”¨æ˜¯åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚ æ¶ˆæ¯é˜Ÿåˆ— (Message Queue) é›†ç¾¤ç®¡ç†æœåŠ¡ (Cluster Management) æŒä¹…/ä¸´æ—¶èŠ‚ç‚¹ + Watch æœºåˆ¶ é€šè¿‡ Watch æœºåˆ¶ç›‘å¬ ZNode å˜åŒ–ï¼ŒèŠ‚ç‚¹é—´ç”¨æ•°æ®å˜æ›´å½“â€œä¿¡å·â€ä¼ é€’æ¶ˆæ¯ï¼Œæ—©æœŸ Kafka ç”¨è¿‡è¿™ç§æ–¹å¼ã€‚ ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ª ZNodeã€‚ ä¸åŒäºæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä¿å­˜æ•°æ®ï¼Œæ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ 1MB çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬(version)ï¼Œç‰ˆæœ¬ä»0å¼€å§‹è®¡æ•°ã€‚ Zookeeper å®‰è£… è¿è¡Œ Zookeeper éœ€è¦å®‰è£… JDK1.8+ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ OpenJDK11 12345678910111213141516sudo mkdir -p /usr/local/jdkcd /usr/local/jdksudo wget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gzsudo tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gzsudo ln -s jdk-11.0.28+6 jdk11# é…ç½®ç¯å¢ƒå˜é‡vim /etc/profile # æ·»åŠ å¦‚ä¸‹å†…å®¹ export JAVA_HOME=/usr/local/jdk/jdk11 export PATH=$JAVA_HOME/bin:$PATH# ç«‹å³ç”Ÿæ•ˆsource /etc/profile# æŸ¥çœ‹javaç‰ˆæœ¬java -versionopenjdk version &quot;11.0.28&quot; 2025-07-15OpenJDK Runtime Environment Temurin-11.0.28+6 (build 11.0.28+6)OpenJDK 64-Bit Server VM Temurin-11.0.28+6 (build 11.0.28+6, mixed mode) å•æœºå®‰è£… ä¸‹è½½ Zookeeperï¼Œç›®å‰æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ä¸º 3.8.4 123456# ä¸‹è½½wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz# è§£å‹tar -zxvf apache-zookeeper-3.8.4-bin.tar.gz# é…ç½®ä¸ªè½¯è¿æ¥ï¼Œæ–¹ä¾¿ä»¥åå‡çº§ln -s apache-zookeeper-3.8.4-bin zookeeper ä¿®æ”¹é…ç½®æ–‡ä»¶ 1234cd zookeeper/confcp zoo_sample.cfg zoo.cfg# å»ºè®®ä¿®æ”¹ zoo.cfg é…ç½®æ–‡ä»¶ï¼Œå°† dataDir=/tmp/zookeeper ä¿®æ”¹ä¸ºæŒ‡å®šçš„dataç›®å½•vim zoo.cfg zoo.cfg å‚æ•°è¯´æ˜ é…ç½®é¡¹ è¯´æ˜ é»˜è®¤å€¼ å•ä½ / å¤‡æ³¨ tickTime ZooKeeper æ—¶é—´é…ç½®ä¸­çš„åŸºæœ¬å•ä½ 2000 æ¯«ç§’ initLimit follower åˆå§‹åŒ–è¿æ¥åˆ° leader çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•° 10 10 Ã— tickTime = 20000 ms syncLimit follower ä¸ leader æ•°æ®åŒæ­¥çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•° 5 5 Ã— tickTime = 10000 ms dataDir æ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•ï¼ˆæœªæŒ‡å®š dataLogDir æ—¶ï¼Œæ—¥å¿—ä¹Ÿä¼šä¿å­˜åœ¨æ­¤ç›®å½•ï¼‰ /tmp/zookeeper ç›®å½•è·¯å¾„ clientPort å®¢æˆ·ç«¯è¿æ¥ ZooKeeper çš„ç«¯å£å· 2181 é»˜è®¤ 2181 maxClientCnxns å•ä¸ªå®¢æˆ·ç«¯æœ€å¤§å¹¶å‘è¿æ¥æ•° 60 è¶…è¿‡é™åˆ¶åæ–°è¿æ¥ä¼šè¢«æ‹’ç» autopurge.snapRetainCount å¿«ç…§æ–‡ä»¶ä¿ç•™ä¸ªæ•°ï¼Œè¶…è¿‡æ•°é‡çš„å°†ä¼šè¢«æ¸…ç† 3 é»˜è®¤ 3 autopurge.purgeInterval æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš”æ—¶é—´ï¼Œå•ä½å°æ—¶ï¼Œ0 è¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç† 1 1 å°æ—¶ å¯åŠ¨ zookeeper 123456789101112cd zookeeper# å¯åŠ¨bin/zkServer.sh start# æŒ‡å®šé…ç½®æ–‡ä»¶bin/zkServer.sh start conf/zoo.cfg# åœæ­¢bin/zkServer.sh stop# æŸ¥çœ‹çŠ¶æ€bin/zkServer.sh status# æŸ¥çœ‹ç‰ˆæœ¬./bin/zkServer.sh version é›†ç¾¤å®‰è£… ZooKeeper é›†ç¾¤è§’è‰² 1. Leaderï¼ˆé¢†å¯¼è€…ï¼‰ èŒè´£ï¼š äº‹åŠ¡è¯·æ±‚ï¼ˆå†™æ“ä½œï¼‰çš„å”¯ä¸€è°ƒåº¦è€…å’Œå¤„ç†è€…ï¼Œä¿è¯é›†ç¾¤äº‹åŠ¡å¤„ç†çš„é¡ºåºæ€§ï¼› é›†ç¾¤å†…éƒ¨å„ä¸ªæœåŠ¡å™¨çš„è°ƒåº¦è€…ï¼› å¯¹äº createã€setDataã€delete ç­‰å†™æ“ä½œè¯·æ±‚ï¼Œç»Ÿä¸€è½¬å‘ç»™ Leader å¤„ç†ï¼› Leader è´Ÿè´£å†³å®šç¼–å·ã€æ‰§è¡Œæ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º äº‹åŠ¡ã€‚ ä¸‰å°è™šæ‹Ÿæœº zoo.cfg æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é€‰ä¸¾å‡º Leader è§’è‰²ï¼Œåˆ™å…¶ä½™å°±æ˜¯ Follower è§’è‰²ã€‚ 123server.1=10.250.0.229:2888:3888server.2=10.250.0.152:2888:3888server.3=10.250.0.36:2888:3888 2. Followerï¼ˆè·Ÿéšè€…ï¼‰ èŒè´£ï¼š å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡ï¼ˆè¯»æ“ä½œï¼‰è¯·æ±‚ï¼ˆå¯ä»¥ç›´æ¥å“åº”ï¼‰ï¼› è½¬å‘äº‹åŠ¡è¯·æ±‚ç»™ Leaderï¼› å‚ä¸é›†ç¾¤ Leader é€‰ä¸¾æŠ•ç¥¨ã€‚ leaderèŠ‚ç‚¹å¯ä»¥å¤„ç†è¯»å†™è¯·æ±‚ï¼Œfolloweråªå¯ä»¥å¤„ç†è¯»è¯·æ±‚ã€‚followeråœ¨æ¥åˆ°å†™è¯·æ±‚æ—¶ä¼šæŠŠå†™è¯·æ±‚è½¬å‘ç»™leaderæ¥å¤„ç†ã€‚ 3. Observerï¼ˆè§‚å¯Ÿè€…ï¼‰ èŒè´£ï¼š å¯¹äºéäº‹åŠ¡è¯·æ±‚ï¼ˆè¯»æ“ä½œï¼‰å¯ä»¥ç‹¬ç«‹å¤„ç†ï¼› å¯¹äºäº‹åŠ¡è¯·æ±‚ä¼šè½¬å‘ç»™ Leader å¤„ç†ï¼› æ¥æ”¶æ¥è‡ª Leader çš„ inform ä¿¡æ¯ï¼Œæ›´æ–°æœ¬åœ°å­˜å‚¨ï¼› ä¸å‚ä¸æäº¤å’Œé€‰ä¸¾æŠ•ç¥¨ï¼› é€šå¸¸ç”¨äº æå‡é›†ç¾¤éäº‹åŠ¡å¤„ç†èƒ½åŠ›ï¼Œä¸å½±å“é›†ç¾¤äº‹åŠ¡å¤„ç†æ€§èƒ½ã€‚ é…ç½®ä¸€ä¸ª ID ä¸º 4 çš„è§‚å¯Ÿè€…èŠ‚ç‚¹ï¼š 1server.4=10.250.0.56:2888:3888:observer é›†ç¾¤æ­å»º ç¯å¢ƒå‡†å¤‡ï¼š4å°æœåŠ¡å™¨ï¼ŒæŒ‰ç…§ å•æœºå®‰è£… çš„æ–¹å¼å‡†å¤‡å¥½ Zookeeper ç¯å¢ƒ 123410.250.0.22910.250.0.15210.250.0.3610.250.0.56 zoo.cfg æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½® 1234server.1=10.250.0.229:2888:3888server.2=10.250.0.152:2888:3888server.3=10.250.0.36:2888:3888server.4=10.250.0.56:2888:3888:observer åˆ†åˆ«åœ¨ dataDir ç›®å½•ä¸‹åˆ›å»º myid æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸ server å¯¹åº”çš„ç¼–å·ï¼ˆæ³¨æ„ï¼šä¸Šä¸‹ä¸è¦æœ‰ç©ºè¡Œï¼Œå·¦å³ä¸è¦æœ‰ç©ºæ ¼ï¼‰ åˆ†åˆ«å¯åŠ¨ Zookeeper æœåŠ¡å™¨ 12345# åˆ†åˆ«å¯åŠ¨4ä¸ªèŠ‚ç‚¹çš„zookeeper serverbin/zkServer.sh start# æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°èŠ‚ç‚¹è§’è‰²ç±»å‹bin/zkServer.sh status ZooKeeper é»˜è®¤ç«¯å£è¯´æ˜ ç«¯å£ ç”¨é€” è¯´æ˜ 2181 å®¢æˆ·ç«¯è¿æ¥ç«¯å£ å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªç«¯å£è®¿é—® ZooKeeper 2888 é›†ç¾¤å†…éƒ¨é€šä¿¡ follower ä¸ leader ä¹‹é—´åŒæ­¥æ•°æ® 3888 leader é€‰ä¸¾ç«¯å£ é›†ç¾¤é€‰ä¸¾ leader ä½¿ç”¨ 8080 (å¯é€‰) admin/metrics webç«¯å£ å¦‚æœå¼€å¯äº† adminServer 123456789101112# æ°¸ä¹…å¼€å¯ç«¯å£sudo firewall-cmd --permanent --add-port=2181/tcpsudo firewall-cmd --permanent --add-port=2888/tcpsudo firewall-cmd --permanent --add-port=3888/tcp# å¦‚æœä½¿ç”¨ adminServersudo firewall-cmd --permanent --add-port=8080/tcp# é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½®sudo firewall-cmd --reload# æŸ¥çœ‹æ˜¯å¦å¼€æ”¾æˆåŠŸsudo firewall-cmd --list-all å®¢æˆ·ç«¯è¿æ¥ å‘½ä»¤è¡Œ 1234# é»˜è®¤è¿æ¥ 127.0.0.1:2181bin/zkCli.sh# æŒ‡å®š -server ip:portï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œåˆ™è¿æ¥ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒZooKeeper ä¼šè‡ªåŠ¨å¤„ç†ä¸ Leader/Follower çš„äº¤äº’bin/zkCli.sh -server 127.0.0.1:2181 å®¢æˆ·ç«¯å‘½ä»¤ç®€ä»‹ï¼šå‚è€ƒå®˜ç½‘ å‘½ä»¤ è¯­æ³•ç¤ºä¾‹ åŠŸèƒ½æè¿° å¸¸ç”¨å‚æ•°åŠè¯´æ˜ ç¤ºä¾‹ help help æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤ æ—  help quit quit é€€å‡ºå®¢æˆ·ç«¯ æ—  quit ls ls [-s] [-w] [-R] path æŸ¥çœ‹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ - -w: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–- -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯- -R: é€’å½’æŸ¥çœ‹ ls -s -w /zk_test create create [-s] [-e] [-c] [-t ttl] path [data] [acl] åˆ›å»ºèŠ‚ç‚¹ - -s: é¡ºåºèŠ‚ç‚¹- -e: ä¸´æ—¶èŠ‚ç‚¹- -c: å®¹å™¨èŠ‚ç‚¹- -t ttl: TTLèŠ‚ç‚¹ï¼Œå•ä½æ¯«ç§’ create -e /zk_test_ephemeral &quot;temp_data&quot; get get [-s] [-w] path è·å–èŠ‚ç‚¹æ•°æ®ä¿¡æ¯ - -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯- -w: ç›‘å¬èŠ‚ç‚¹å˜åŒ– get -s -w /zk_test set set [-s] [-v version] path data è®¾ç½®èŠ‚ç‚¹æ•°æ® - -s: é¡ºåºèŠ‚ç‚¹- -v: æŒ‡å®šç‰ˆæœ¬å· set /zk_test &quot;new_data&quot; getAcl getAcl [-s] path è·å–èŠ‚ç‚¹è®¿é—®æ§åˆ¶ä¿¡æ¯ - -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ getAcl /zk_test setAcl setAcl [-s] [-v version] [-R] path acl è®¾ç½®èŠ‚ç‚¹è®¿é—®æ§åˆ¶åˆ—è¡¨ - -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯- -v: æŒ‡å®šç‰ˆæœ¬å·- -R: é€’å½’è®¾ç½® setAcl /zk_test world:anyone:r stat stat [-w] path æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ - -w: ç›‘å¬èŠ‚ç‚¹å˜åŒ– stat -w /zk_test delete delete [-v version] path åˆ é™¤æŸä¸€èŠ‚ç‚¹ï¼ˆæ— å­èŠ‚ç‚¹ï¼‰ - -v: èŠ‚ç‚¹ç‰ˆæœ¬å· delete /zk_test deleteall deleteall path é€’å½’åˆ é™¤æŸä¸€èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ æ—  deleteall /zk_test setquota setquota [-n] [-b] val path å¯¹èŠ‚ç‚¹å¢åŠ é™åˆ¶ - -n: å­èŠ‚ç‚¹æœ€å¤§ä¸ªæ•°- -b: æ•°æ®å€¼æœ€å¤§é•¿åº¦ï¼Œ-1 è¡¨ç¤ºæ— é™åˆ¶ setquota -n 5 /zk_test GUI å·¥å…· åç§° ç±»å‹ / è¿è¡Œæ–¹å¼ ä¼˜ç‚¹ æ³¨æ„äº‹é¡¹ PrettyZoo æ¡Œé¢åº”ç”¨ï¼ˆJavaFXï¼‰(GitHub) æ”¯æŒ Mac/Windows/Linuxï¼Œç•Œé¢å‹å¥½ï¼›æ”¯æŒèŠ‚ç‚¹åˆ›å»º/åˆ é™¤/æ›´æ–°/æŸ¥è¯¢ï¼ŒACL ç®¡ç†ï¼Œå¤š ZK å®ä¾‹ç®¡ç†ï¼ŒSSH éš§é“ç­‰åŠŸèƒ½ã€‚(GitHub) é¡¹ç›®å·²ç» archivedï¼Œç»´æŠ¤å¯èƒ½ä¸æ´»è·ƒã€‚æœ€æ–°ç‰ˆå¯èƒ½åœ¨å…¼å®¹æ€§æˆ– Bug ä¿®å¤æ–¹é¢ä¸å¦‚æ´»è·ƒé¡¹ç›®ã€‚ä¹Ÿå¯èƒ½éœ€è¦è‡ªå·±æ„å»ºæˆ–è°ƒè¯•ã€‚(GitHub) ZooNavigator Web ç•Œé¢ + å¯ Docker éƒ¨ç½²æˆ–æœ¬åœ°å¯åŠ¨(GitHub) åŠŸèƒ½ä¸°å¯Œï¼›æ”¯æŒå¤šä¸ª Zookeeper ç‰ˆæœ¬ï¼ˆå¦‚ 3.5.x ï½ 3.9.xï¼‰ï¼›æµè§ˆ / ç¼–è¾‘ /æœç´¢èŠ‚ç‚¹ï¼›å¯¼å…¥å¯¼å‡ºé…ç½®ï¼›æ”¯æŒæµè§ˆå™¨è®¿é—®ï¼Œæ— éœ€æœ¬åœ° heavy GUIã€‚(GitHub) å› ä¸º Web åº”ç”¨ï¼Œå¯èƒ½å¯¹æµè§ˆå™¨å®‰å…¨ç­–ç•¥ä¸ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿï¼›éœ€è¦éƒ¨ç½²è‡ªå·±ç‰ˆæœ¬æˆ– Dockerï¼›å¦‚æœè¦æ±‚æœ¬åœ°è„±æœºæ“ä½œæ—¶ï¼Œæœ‰äº›åŠŸèƒ½å¯èƒ½ç¨ä¸å¦‚æ¡Œé¢åº”ç”¨ã€‚ ZooKeeper Assistant æ¡Œé¢ï¼ç®¡ç†å‘˜é¢æ¿ç±»å‹ï¼ˆæ”¯æŒç›‘æ§ç•Œé¢ç­‰ï¼‰(DEV Community) é™¤äº†æµè§ˆèŠ‚ç‚¹æ ‘ä»¥å¤–ï¼Œè¿˜æä¾›å¥åº·çŠ¶æ€ç›‘æ§ï¼ˆå»¶è¿Ÿã€è¯·æ±‚æ•°ç­‰ï¼‰ã€ä¸åŒæ•°æ®æ ¼å¼æ”¯æŒï¼ˆJSON/XML ç­‰ï¼‰ã€å¯¼å…¥/å¯¼å‡ºèŠ‚ç‚¹æ•°æ®ã€å‘½ä»¤è¡Œæ“ä½œé›†æˆã€‚(DEV Community) æœ‰äº›åŠŸèƒ½å¯èƒ½åœ¨ Mac ä¸Šå…¼å®¹æ€§æˆ–è§†è§‰ä½“éªŒéœ€è¦è°ƒè¯•ï¼›å…·ä½“ç‰ˆæœ¬æ”¯æŒæƒ…å†µè¦çœ‹æœ€è¿‘æ›´æ–°ã€‚æŸäº›ç›‘æ§ç•Œé¢å¯èƒ½ä¾èµ–äº ZK çš„æŒ‡æ ‡æˆ–æ’ä»¶ã€‚ Zookeeper èŠ‚ç‚¹ç±»å‹ èŠ‚ç‚¹ç±»å‹ ç”Ÿå‘½å‘¨æœŸè¯´æ˜ åˆ›å»ºå‘½ä»¤ç¤ºä¾‹ ç‰¹ç‚¹è¯´æ˜ æŒä¹…èŠ‚ç‚¹ (Persistent) èŠ‚ç‚¹ä¸€ç›´å­˜åœ¨ï¼Œé™¤éæ‰‹åŠ¨åˆ é™¤ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ŒèŠ‚ç‚¹ä¹Ÿä¸ä¼šæ¶ˆå¤± create /locks é€‚åˆå­˜å‚¨é…ç½®ä¿¡æ¯ã€å…ƒæ•°æ®ç­‰æŒä¹…æ•°æ® ä¸´æ—¶èŠ‚ç‚¹ (Ephemeral) å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ˆå¼‚å¸¸æˆ–è¶…æ—¶ï¼‰æ—¶ï¼ŒèŠ‚ç‚¹è‡ªåŠ¨è¢«åˆ é™¤ create -e /locks/DBLock å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€ä¸´æ—¶ä¼šè¯æ•°æ® æœ‰åºèŠ‚ç‚¹ (Sequential) åœ¨æŒä¹…æˆ–ä¸´æ—¶èŠ‚ç‚¹åŸºç¡€ä¸Šï¼Œå¢åŠ æœ‰åºç¼–å·ï¼ŒZooKeeper è‡ªåŠ¨åœ¨èŠ‚ç‚¹åååŠ é€’å¢åºå· create -e -s /jobs/job å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€é˜Ÿåˆ—ç­‰éœ€è¦é¡ºåºçš„åœºæ™¯ å®¹å™¨èŠ‚ç‚¹ (Container) V3.5.3+ï¼Œå½“å®¹å™¨èŠ‚ç‚¹ä¸‹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œå®¹å™¨èŠ‚ç‚¹ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤ create -c /work é€‚åˆåˆ†å¸ƒå¼ä»»åŠ¡ä¸´æ—¶ç›®å½•ã€åŠ¨æ€æ•°æ®ç›®å½• TTL èŠ‚ç‚¹ (TTL) åœ¨æŒ‡å®š TTL æ—¶é—´å†…æœªä¿®æ”¹ä¸”æ— å­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆéœ€å¼€å¯ extendedTypesEnabled=true é…ç½®ï¼‰ create -t 3000 /ttl_node é€‚åˆä¸´æ—¶ç¼“å­˜ã€ä¸´æ—¶çŠ¶æ€æ•°æ®ï¼Œè¿‡æœŸè‡ªåŠ¨æ¸…ç† æ³¨æ„ åŒä¸€çº§èŠ‚ç‚¹ key åç§°æ˜¯å”¯ä¸€çš„ åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå¿…é¡»è¦å¸¦ä¸Šå…¨è·¯å¾„ 4å­—æ¯å‘½ä»¤ ä»€ä¹ˆæ˜¯ 4 å­—æ¯å‘½ä»¤? ZooKeeper æä¾›äº†ä¸€ç»„ç®€çŸ­çš„ 4ä¸ªå­—æ¯çš„ç®¡ç†å‘½ä»¤(Four Letter Words Commands)ï¼Œå¯ä»¥é€šè¿‡ TCP è¿æ¥ ZooKeeper ç«¯å£ï¼ˆé»˜è®¤ 2181ï¼‰å‘é€è¿™äº›å‘½ä»¤ï¼Œå¿«é€ŸæŸ¥çœ‹æˆ–ç®¡ç† ZooKeeper çŠ¶æ€ã€‚ å¸¸ç”¨çš„ 4å­—æ¯å‘½ä»¤ å‘½ä»¤ å¼•å…¥ç‰ˆæœ¬ åŠŸèƒ½æè¿° ç¤ºä¾‹ conf 3.3.0 æ‰“å°æœåŠ¡ç›¸å…³é…ç½®çš„è¯¦ç»†ä¿¡æ¯ echo conf | nc 127.0.0.1 2181 cons 3.3.0 åˆ—å‡ºæ‰€æœ‰è¿æ¥åˆ°è¯¥æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥/ä¼šè¯è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥æ”¶/å‘é€çš„åŒ…æ•°é‡ã€ä¼šè¯IDã€æ“ä½œå»¶è¿Ÿã€æœ€åæ“ä½œæ‰§è¡Œæ—¶é—´ç­‰ echo cons | nc 127.0.0.1 2181 crst 3.3.0 é‡ç½®æ‰€æœ‰è¿æ¥çš„è¿æ¥å’Œä¼šè¯ç»Ÿè®¡ä¿¡æ¯ echo crst | nc 127.0.0.1 2181 dump - åˆ—å‡ºé‡è¦çš„ä¼šè¯å’Œä¸´æ—¶èŠ‚ç‚¹ä¿¡æ¯ï¼Œä»…åœ¨ Leader èŠ‚ç‚¹ä¸Šæœ‰æ•ˆ echo dump | nc 127.0.0.1 2181 envi - æ‰“å°æœåŠ¡ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯ echo envi | nc 127.0.0.1 2181 reqs - åˆ—å‡ºæœªç»å¤„ç†çš„è¯·æ±‚ echo reqs | nc 127.0.0.1 2181 ruok - æµ‹è¯•æœåŠ¡æ˜¯å¦å¤„äºæ­£å¸¸çŠ¶æ€ï¼›æ­£å¸¸è¿”å› imok echo ruok | nc 127.0.0.1 2181 stat - è¾“å‡ºå…³äºæ€§èƒ½å’Œå®¢æˆ·ç«¯è¿æ¥çš„åˆ—è¡¨ä¿¡æ¯ echo stat | nc 127.0.0.1 2181 srst - é‡ç½®æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯ echo srst | nc 127.0.0.1 2181 srvr 3.3.0 åˆ—å‡ºè¿æ¥æœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯ echo srvr | nc 127.0.0.1 2181 wchs 3.3.0 åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ echo wchs | nc 127.0.0.1 2181 wchc 3.3.0 é€šè¿‡ä¼šè¯åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ Watch ç›¸å…³çš„ä¼šè¯åˆ—è¡¨ echo wchc | nc 127.0.0.1 2181 wchp 3.3.0 é€šè¿‡è·¯å¾„åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ä¼šè¯ç›¸å…³çš„è·¯å¾„ echo wchp | nc 127.0.0.1 2181 mntr 3.4.0 è¾“å‡ºå¯ç”¨äºæ£€æµ‹é›†ç¾¤å¥åº·çŠ¶æ€çš„å…³é”®æŒ‡æ ‡å˜é‡åˆ—è¡¨ echo mntr | nc 127.0.0.1 2181 å¼€å¯ 4å­—æ¯å‘½ä»¤ åœ¨ ZooKeeper 3.5.0 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œ4lw å‘½ä»¤é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå¿…é¡»åœ¨é…ç½®æ–‡ä»¶(zoo.cfg)ä¸­æ˜¾å¼å¼€å¯ã€‚ 1234# è¡¨ç¤ºå…è®¸æ‰€æœ‰ 4lw å‘½ä»¤éƒ½èƒ½ç”¨ï¼ˆé£é™©æœ€å¤§ï¼‰4lw.commands.whitelist=*# è¿™æ ·åªå…è®¸æ‰§è¡Œ statã€confã€ruok è¿™å‡ ä¸ªå‘½ä»¤ã€‚4lw.commands.whitelist=stat,conf,ruok ä½¿ç”¨æ–¹æ³• 1234# å¦‚æœæ²¡æœ‰å®‰è£… ncï¼Œå¯ä»¥ä½¿ç”¨ yum å®‰è£…yum install nc -y# æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€echo stat | nc 127.0.0.1 2181","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS8 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ Zookeeperå®˜ç½‘","date_published":"2025-09-15T13:30:05.000Z","tags":["æŠ€æœ¯","zookeeper","åˆ†å¸ƒå¼","zookeeper"]},{"id":"https://blog.hanqunfeng.com/2025/09/11/springboot3-shardingsphere-proxy-distsql/","url":"https://blog.hanqunfeng.com/2025/09/11/springboot3-shardingsphere-proxy-distsql/","title":"ShardingSphere-Proxy5.5.2 DistSQL","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» ShardingSphere-Proxy5.5.2 DistSQL çš„ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/index_zh.html\">ShardingSphereå®˜ç½‘</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"DistSQL\">DistSQL</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/\">DistSQL</a>ï¼ˆDistributed SQLï¼‰æ˜¯ Apache ShardingSphere ç‰¹æœ‰çš„æ“ä½œè¯­è¨€ã€‚ å®ƒä¸æ ‡å‡† SQL çš„ä½¿ç”¨æ–¹å¼å®Œå…¨ä¸€è‡´ï¼Œç”¨äºæä¾›å¢é‡åŠŸèƒ½çš„ SQL çº§åˆ«æ“ä½œèƒ½åŠ›ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>çµæ´»çš„è§„åˆ™é…ç½®å’Œèµ„æºç®¡æ§èƒ½åŠ›æ˜¯ Apache ShardingSphere çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ä½¿ç”¨ 4.x åŠå…¶ä¹‹å‰ç‰ˆæœ¬æ—¶ï¼Œå¼€å‘è€…è™½ç„¶å¯ä»¥åƒä½¿ç”¨åŸç”Ÿæ•°æ®åº“ä¸€æ ·æ“ä½œæ•°æ®ï¼Œä½†å´éœ€è¦é€šè¿‡æœ¬åœ°æ–‡ä»¶æˆ–æ³¨å†Œä¸­å¿ƒé…ç½®èµ„æºå’Œè§„åˆ™ã€‚ç„¶è€Œï¼Œæ“ä½œä¹ æƒ¯å˜æ›´ï¼Œå¯¹äºè¿ç»´å·¥ç¨‹å¸ˆå¹¶ä¸å‹å¥½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä» 5.x ç‰ˆæœ¬å¼€å§‹ï¼ŒDistSQLï¼ˆDistributed SQLï¼‰è®©ç”¨æˆ·å¯ä»¥åƒæ“ä½œæ•°æ®åº“ä¸€æ ·æ“ä½œ Apache ShardingSphereï¼Œä½¿å…¶ä»é¢å‘å¼€å‘äººå‘˜çš„æ¡†æ¶å’Œä¸­é—´ä»¶è½¬å˜ä¸ºé¢å‘è¿ç»´äººå‘˜çš„æ•°æ®åº“äº§å“ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>DistSQL ç»†åˆ†ä¸º RDLã€RQLã€RAL å’Œ RUL å››ç§ç±»å‹ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">RDL: Resource &amp; Rule Definition Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤ã€‚</li>\n<li class=\"lvl-4\">RQL: Resource &amp; Rule Query Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„æŸ¥è¯¢å’Œå±•ç°ã€‚</li>\n<li class=\"lvl-4\">RAL: Resource &amp; Rule Administration Languageï¼Œè´Ÿè´£å¼ºåˆ¶è·¯ç”±ã€ç†”æ–­ã€é…ç½®å¯¼å…¥å¯¼å‡ºã€æ•°æ®è¿ç§»æ§åˆ¶ç­‰ç®¡ç†åŠŸèƒ½ã€‚</li>\n<li class=\"lvl-4\">RUL: Resource &amp; Rule Utility Languageï¼Œè´Ÿè´£ SQL è§£æã€SQL æ ¼å¼åŒ–ã€æ‰§è¡Œè®¡åˆ’é¢„è§ˆç­‰åŠŸèƒ½ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>DistSQL ä»…å¯ä»¥åœ¨ ShardingSphere-Proxy ä¸­ä½¿ç”¨ï¼Œä¸èƒ½åœ¨ ShardingSphere-JDBC ä¸­ä½¿ç”¨ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ç¤ºä¾‹å‡†å¤‡\">ç¤ºä¾‹å‡†å¤‡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…·ä½“çš„è¯­æ³•ï¼Œå®˜ç½‘ä»‹ç»çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡ŒåŸºäº <a href=\"/2025/09/04/springboot3-shardingsphere-proxy/\" title=\"SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨\">SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨</a> ä¸­çš„é…ç½®è¿›è¡Œç¤ºä¾‹è¯´æ˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºäº†å°½å¯èƒ½å¤šçš„ä½¿ç”¨ DistSQL è¯­æ³•ï¼Œè¿™é‡Œä»…åœ¨ <code>global.yaml</code> ä¸­é…ç½®å¦‚ä¸‹å†…å®¹:</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é…ç½®ä¸ºåŸºäº zookeeper é›†ç¾¤æ¨¡å¼ï¼Œä¸ºäº†æ¼”ç¤º DistSQL è¯­æ³•ï¼Œè¿™é‡Œéœ€è¦å°†é…ç½®æŒä¹…åŒ–ï¼Œä½¿ç”¨ JDBC çš„å•æœºæ¨¡å¼ä¹Ÿå¯ä»¥</span></span><br><span class=\"line\"><span class=\"attr\">mode:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">Cluster</span>                 <span class=\"comment\"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class=\"line\">  <span class=\"attr\">repository:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">ZooKeeper</span>             <span class=\"comment\"># æ³¨å†Œä¸­å¿ƒç±»å‹</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">governance_ds</span>  <span class=\"comment\"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class=\"line\">      <span class=\"attr\">server-lists:</span> <span class=\"string\">localhost:2181</span> <span class=\"comment\"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class=\"line\">      <span class=\"attr\">retryIntervalMilliseconds:</span> <span class=\"number\">500</span> <span class=\"comment\"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">timeToLiveSeconds:</span> <span class=\"number\">60</span>     <span class=\"comment\"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"attr\">maxRetries:</span> <span class=\"number\">3</span>             <span class=\"comment\"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">operationTimeoutMilliseconds:</span> <span class=\"number\">500</span>  <span class=\"comment\"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç”¨æˆ·å’Œæƒé™ï¼Œå› ä¸º DistSQL æš‚ä¸æ”¯æŒ ç”¨æˆ·å’Œæƒé™ç®¡ç†ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å…ˆé…ç½®ç”¨æˆ·å’Œæƒé™</span></span><br><span class=\"line\"><span class=\"attr\">authority:</span></span><br><span class=\"line\">  <span class=\"attr\">users:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">user:</span> <span class=\"string\">root@127.0.0.1</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">root</span></span><br><span class=\"line\">      <span class=\"attr\">admin:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">user:</span> <span class=\"string\">sharding@%</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">sharding</span></span><br><span class=\"line\">  <span class=\"attr\">privilege:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">DATABASE_PERMITTED</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">user-database-mappings:</span> <span class=\"string\">root@127.0.0.1=*,sharding@%=sharding_db</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ ShardingSphere-Proxy æœåŠ¡ï¼Œå¹¶ç™»å½•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ ShardingSphere-Proxy</span></span><br><span class=\"line\">./shardingsphere-proxy-bin/bin/start.sh</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ç®¡ç†å‘˜ç™»å½•</span></span><br><span class=\"line\">mysql -h127.0.0.1 -uroot -proot -P3307</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™</span></span><br><span class=\"line\">mysql&gt; SHOW AUTHORITY RULE;</span><br><span class=\"line\">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class=\"line\">| <span class=\"built_in\">users</span>                      | provider           | props                                                                |</span><br><span class=\"line\">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class=\"line\">| root@127.0.0.1; sharding@% | DATABASE_PERMITTED | &#123;<span class=\"string\">&quot;user-database-mappings&quot;</span>:<span class=\"string\">&quot;root@127.0.0.1=*,sharding@%=sharding_db&quot;</span>&#125; |</span><br><span class=\"line\">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class=\"line\">1 row <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.49 sec)</span><br></pre></td></tr></table></figure>\n<h2 id=\"å…¨å±€é…ç½®ï¼Œå³global-yamlä¸­çš„é…ç½®\">å…¨å±€é…ç½®ï¼Œå³<code>global.yaml</code>ä¸­çš„é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…¨å±€é…ç½®å¯¹æ‰€æœ‰é€»è¾‘æ•°æ®åº“æœ‰æ•ˆ</p>\n</li>\n</ul>\n<h3 id=\"å±æ€§é…ç½®\">å±æ€§é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">props:</span></span><br><span class=\"line\">  <span class=\"attr\">sql-show:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"DistSQL-è¯­æ³•\">DistSQL è¯­æ³•</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®å±æ€§ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/set-dist-vairable/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè¦æ³¨æ„ï¼Œå±æ€§åéœ€è¦ä½¿ç”¨ä¸‹åˆ’çº¿æ ¼å¼</span></span><br><span class=\"line\">SET DIST VARIABLE sql_show = <span class=\"literal\">true</span>;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å±æ€§ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/show-dist-variable/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; SHOW DIST VARIABLES;</span><br><span class=\"line\">+-----------------------------------------+-----------------+</span><br><span class=\"line\">| variable_name                           | variable_value  |</span><br><span class=\"line\">+-----------------------------------------+-----------------+</span><br><span class=\"line\">| agent_plugins_enabled                   | <span class=\"literal\">true</span>            |</span><br><span class=\"line\">| cached_connections                      | 0               |</span><br><span class=\"line\">| cdc_server_port                         | 33071           |</span><br><span class=\"line\">| check_table_metadata_enabled            | <span class=\"literal\">false</span>           |</span><br><span class=\"line\">| kernel_executor_size                    | 0               |</span><br><span class=\"line\">| load_table_metadata_batch_size          | 1000            |</span><br><span class=\"line\">| max_connections_size_per_query          | 1               |</span><br><span class=\"line\">| proxy_backend_query_fetch_size          | -1              |</span><br><span class=\"line\">| proxy_default_port                      | 3307            |</span><br><span class=\"line\">| proxy_frontend_database_protocol_type   |                 |</span><br><span class=\"line\">| proxy_frontend_executor_size            | 0               |</span><br><span class=\"line\">| proxy_frontend_flush_threshold          | 128             |</span><br><span class=\"line\">| proxy_frontend_max_connections          | 0               |</span><br><span class=\"line\">| proxy_frontend_ssl_cipher               |                 |</span><br><span class=\"line\">| proxy_frontend_ssl_enabled              | <span class=\"literal\">false</span>           |</span><br><span class=\"line\">| proxy_frontend_ssl_version              | TLSv1.2,TLSv1.3 |</span><br><span class=\"line\">| proxy_meta_data_collector_enabled       | <span class=\"literal\">false</span>           |</span><br><span class=\"line\">| proxy_netty_backlog                     | 1024            |</span><br><span class=\"line\">| sql_show                                | <span class=\"literal\">true</span>            |</span><br><span class=\"line\">| sql_simple                              | <span class=\"literal\">false</span>           |</span><br><span class=\"line\">| system_log_level                        | INFO            |</span><br><span class=\"line\">| system_schema_metadata_assembly_enabled | <span class=\"literal\">true</span>            |</span><br><span class=\"line\">+-----------------------------------------+-----------------+</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ†å¸ƒå¼äº‹åŠ¡é…ç½®\">åˆ†å¸ƒå¼äº‹åŠ¡é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">transaction:</span></span><br><span class=\"line\">  <span class=\"attr\">defaultType:</span> <span class=\"string\">XA</span></span><br><span class=\"line\">  <span class=\"attr\">providerType:</span> <span class=\"string\">Atomikos</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"DistSQL-è¯­æ³•-2\">DistSQL è¯­æ³•</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹äº‹åŠ¡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/global-rule/show-transaction-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW TRANSACTION RULE;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹äº‹åŠ¡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/global-rule/alter-transaction-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TRANSACTION RULE(</span><br><span class=\"line\">  DEFAULT=<span class=\"string\">&quot;XA&quot;</span>, TYPE(NAME=<span class=\"string\">&quot;Atomikos&quot;</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h2 id=\"è§„åˆ™é…ç½®ï¼Œå³database-xxx-yamlä¸­çš„é…ç½®\">è§„åˆ™é…ç½®ï¼Œå³<code>database-xxx.yaml</code>ä¸­çš„é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹ DistSQL ä»…å¯ä»¥åœ¨é€»è¾‘åº“ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªé€»è¾‘æ•°æ®åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; CREATE DATABASE sharding_db;</span><br><span class=\"line\">Query OK, 0 rows affected (0.03 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; use sharding_db;</span><br><span class=\"line\">Database changed</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ•°æ®æºé…ç½®\">æ•°æ®æºé…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ DistSQLä¸­ï¼Œå®˜æ–¹å°†æ•°æ®æºå«åš<code>å­˜å‚¨å•å…ƒ(STORAGE UNIT)</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_0:</span> <span class=\"comment\"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>  <span class=\"comment\"># æ³¨æ„è¿™é‡Œå±æ€§ä¸º url</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">ds_1:</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"DistSQL-è¯­æ³•-3\">DistSQL è¯­æ³•</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨å†Œå­˜å‚¨å•å…ƒï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/register-storage-unit/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">REGISTER STORAGE UNIT ds_0 (</span><br><span class=\"line\">    URL=<span class=\"string\">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class=\"line\">    USER=<span class=\"string\">&quot;root&quot;</span>,</span><br><span class=\"line\">    PASSWORD=<span class=\"string\">&quot;newpwd&quot;</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">REGISTER STORAGE UNIT ds_1 (</span><br><span class=\"line\">    URL=<span class=\"string\">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class=\"line\">    USER=<span class=\"string\">&quot;root&quot;</span>,</span><br><span class=\"line\">    PASSWORD=<span class=\"string\">&quot;newpwd&quot;</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢å­˜å‚¨å•å…ƒï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/storage-unit-query/show-storage-units/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW STORAGE UNITS FROM sharding_db \\G;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹å­˜å‚¨å•å…ƒï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/alter-storage-unit/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER STORAGE UNIT ds_1 (</span><br><span class=\"line\">    URL=<span class=\"string\">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class=\"line\">    USER=<span class=\"string\">&quot;root&quot;</span>,</span><br><span class=\"line\">    PASSWORD=<span class=\"string\">&quot;newpwd&quot;</span>,</span><br><span class=\"line\">    PROPERTIES(<span class=\"string\">&quot;maximumPoolSize&quot;</span>=10,<span class=\"string\">&quot;idleTimeout&quot;</span>=30000)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å–æ¶ˆæ³¨å†Œå­˜å‚¨å•å…ƒï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/unregister-storage-unit/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ— æ³•ç§»é™¤å·²ç»è¢«è§„åˆ™ä½¿ç”¨çš„å­˜å‚¨å•å…ƒ</span></span><br><span class=\"line\">UNREGISTER STORAGE UNIT ds_0;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å•è¡¨é…ç½®\">å•è¡¨é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SINGLE</span> <span class=\"comment\"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"comment\"># MySQL é£æ ¼</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ds_0.t_address</span> <span class=\"comment\"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"DistSQL-è¯­æ³•-4\">DistSQL è¯­æ³•</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŠ è½½å•è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/single-table/load-single-table/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LOAD SINGLE TABLE ds_0.t_address;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢å•è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/single-table/show-single-table/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW SINGLE TABLES;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸è½½å•è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/single-table/unload-single-table/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UNLOAD SINGLE TABLE ds_0.t_address;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¹¿æ’­è¡¨é…ç½®\">å¹¿æ’­è¡¨é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!BROADCAST</span>  <span class=\"comment\"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">dict</span>    <span class=\"comment\"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"DistSQL-è¯­æ³•-5\">DistSQL è¯­æ³•</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºå¹¿æ’­è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/broadcast-table/create-broadcast-table-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE BROADCAST TABLE RULE dict;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤å¹¿æ’­è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/broadcast-table/drop-broadcast-table-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP BROADCAST TABLE RULE dict;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢å¹¿æ’­è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/broadcast-table/show-broadcast-table-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨</span></span><br><span class=\"line\">SHOW BROADCAST TABLE RULES;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æŒ‡å®šæ•°æ®åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨</span></span><br><span class=\"line\">SHOW BROADCAST TABLE RULES FROM sharding_db;</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ†åº“åˆ†è¡¨é…ç½®\">åˆ†åº“åˆ†è¡¨é…ç½®</h3>\n<h4 id=\"å•åˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹\">å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">course:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">cid</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_inline</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">cid</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">course_inline:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># å±æ€§</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">course_$&#123;cid</span> <span class=\"string\">%</span> <span class=\"number\">2</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class=\"line\">          <span class=\"attr\">allow-range-query-with-inline-sharding:</span> <span class=\"literal\">true</span> <span class=\"comment\"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class=\"line\">      <span class=\"attr\">course_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-6\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/create-sharding-table-rule/#1%E6%A0%87%E5%87%86%E5%88%86%E7%89%87%E8%A7%84%E5%88%99\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE SHARDING TABLE RULE course (</span><br><span class=\"line\">  DATANODES(<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;0..1&#125;</span>.course_<span class=\"variable\">$&#123;1..2&#125;</span>&quot;</span>),</span><br><span class=\"line\">  DATABASE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  TABLE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=cid,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;course_<span class=\"variable\">$&#123;cid % 2 + 1&#125;</span>&quot;</span>,<span class=\"string\">&quot;allow-range-query-with-inline-sharding&quot;</span>=<span class=\"literal\">true</span> )))),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=cid,TYPE(NAME=<span class=\"string\">&quot;snowflake&quot;</span>))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h4 id=\"å•åˆ†ç‰‡é”®ï¼ŒString-ç±»å‹\">å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class=\"line\"><span class=\"comment\">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">custom_snowflake_string</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span> <span class=\"comment\"># åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®—</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span> <span class=\"comment\"># åˆ†è¡¨ï¼Œt_user_0, t_user_1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">uuid:</span>    <span class=\"comment\"># å®šä¹‰åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">UUID</span> <span class=\"comment\"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class=\"line\">      <span class=\"attr\">custom_snowflake_string:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CUSTOM_SNOWFLAKE_STRING</span> <span class=\"comment\"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">workerId:</span> <span class=\"number\">2</span></span><br><span class=\"line\">          <span class=\"attr\">datacenterId:</span> <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-7\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE SHARDING TABLE RULE t_user (</span><br><span class=\"line\">  DATANODES(<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;0..1&#125;</span>.t_user_<span class=\"variable\">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class=\"line\">  DATABASE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=<span class=\"built_in\">id</span>,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;Math.abs(id.hashCode()%2)&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  TABLE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=<span class=\"built_in\">id</span>,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;t_user_<span class=\"variable\">$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=<span class=\"built_in\">id</span>,TYPE(NAME=<span class=\"string\">&quot;CUSTOM_SNOWFLAKE_STRING&quot;</span>))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¤šåˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹\">å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order-complex-algorithm</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class=\"line\"><span class=\"comment\">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_item-class-based-algorithm_spi</span> <span class=\"comment\"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order-complex-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">COMPLEX_INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_order_complex_$&#123;(user_id</span> <span class=\"string\">+</span> <span class=\"string\">order_id</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">)</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm_spi:</span> <span class=\"comment\"># SPI</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">T_ORDER_ITEM_COMPLEX</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-8\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE SHARDING TABLE RULE t_order_complex (</span><br><span class=\"line\">  DATANODES(<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;0..1&#125;</span>.t_order_complex_<span class=\"variable\">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class=\"line\">  DATABASE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  TABLE_STRATEGY(TYPE=<span class=\"string\">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;complex_inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;t_order_complex_<span class=\"variable\">$&#123;(user_id + order_id + 1) % 2&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=<span class=\"string\">&quot;snowflake&quot;</span>))</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE SHARDING TABLE RULE t_order_item_complex (</span><br><span class=\"line\">  DATANODES(<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;0..1&#125;</span>.t_order_item_complex_<span class=\"variable\">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class=\"line\">  DATABASE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  TABLE_STRATEGY(TYPE=<span class=\"string\">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;T_ORDER_ITEM_COMPLEX&quot;</span>))),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class=\"string\">&quot;SNOWFLAKE&quot;</span>))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h4 id=\"è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™\">è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">   <span class=\"comment\"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">bindingTables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">t_order,t_order_item</span></span><br><span class=\"line\">    <span class=\"attr\">autoTables:</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">mod_2:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MOD</span> <span class=\"comment\"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">sharding-count:</span> <span class=\"number\">2</span> <span class=\"comment\"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-9\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE SHARDING TABLE RULE t_order (</span><br><span class=\"line\">  STORAGE_UNITS(ds_0,ds_1),</span><br><span class=\"line\">  SHARDING_COLUMN=user_id,TYPE(NAME=<span class=\"string\">&quot;mod&quot;</span>,PROPERTIES(<span class=\"string\">&quot;sharding-count&quot;</span>=<span class=\"string\">&quot;2&quot;</span>)),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=<span class=\"string\">&quot;snowflake&quot;</span>))</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE SHARDING TABLE RULE t_order_item (</span><br><span class=\"line\">  STORAGE_UNITS(ds_0,ds_1),</span><br><span class=\"line\">  SHARDING_COLUMN=user_id,TYPE(NAME=<span class=\"string\">&quot;mod&quot;</span>,PROPERTIES(<span class=\"string\">&quot;sharding-count&quot;</span>=<span class=\"string\">&quot;2&quot;</span>)),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class=\"string\">&quot;snowflake&quot;</span>))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h4 id=\"å…¶å®ƒåˆ†ç‰‡æ“ä½œè¯­å¥\">å…¶å®ƒåˆ†ç‰‡æ“ä½œè¯­å¥</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢åˆ†ç‰‡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/sharding/show-sharding-table-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰é€»è¾‘åº“ä¸‹çš„æ‰€æœ‰åˆ†ç‰‡è§„åˆ™</span></span><br><span class=\"line\">SHOW SHARDING TABLE RULES \\G;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šé€»è¾‘åº“ä¸‹çš„åˆ†ç‰‡è§„åˆ™</span></span><br><span class=\"line\">SHOW SHARDING TABLE RULES FROM sharding_db; \\G;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šåˆ†ç‰‡è§„åˆ™</span></span><br><span class=\"line\">SHOW SHARDING TABLE RULE t_user \\G;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹åˆ†ç‰‡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/alter-sharding-table-rule/\">å®˜ç½‘æ–‡æ¡£</a>ï¼Œä¸åˆ›å»ºåˆ†ç‰‡è§„åˆ™ç±»ä¼¼ï¼Œå°†<code>CREATE</code>æ”¹ä¸º<code>ALTER</code>å³å¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER SHARDING TABLE RULE t_order_item_complex (</span><br><span class=\"line\">  DATANODES(<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;0..1&#125;</span>.t_order_item_complex_<span class=\"variable\">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class=\"line\">  DATABASE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  TABLE_STRATEGY(TYPE=<span class=\"string\">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;T_ORDER_ITEM_COMPLEX&quot;</span>))),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class=\"string\">&quot;SNOWFLAKE&quot;</span>))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤åˆ†ç‰‡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/drop-sharding-table-rule/\">å®˜ç½‘æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP SHARDING TABLE RULE t_order;</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å¤šä¸ªè¡¨</span></span><br><span class=\"line\">DROP SHARDING TABLE RULE t_order,t_order_item;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ•°æ®åŠ å¯†è§„åˆ™\">æ•°æ®åŠ å¯†è§„åˆ™</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!ENCRYPT</span>    <span class=\"comment\"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># åŠ å¯†è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># åŠ å¯†åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">cipher:</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">password</span> <span class=\"comment\"># å¯†æ–‡åˆ—åç§°</span></span><br><span class=\"line\">              <span class=\"attr\">encryptorName:</span> <span class=\"string\">aes_encryptor</span> <span class=\"comment\"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class=\"line\">    <span class=\"attr\">encryptors:</span></span><br><span class=\"line\">      <span class=\"attr\">aes_encryptor:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">AES</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">aes-key-value:</span> <span class=\"string\">123456abc</span>     <span class=\"comment\"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class=\"line\">          <span class=\"attr\">digest-algorithm-name:</span> <span class=\"string\">SHA-1</span> <span class=\"comment\"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-10\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåŠ å¯†è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/encrypt/create-encrypt-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE ENCRYPT RULE t_user (</span><br><span class=\"line\">COLUMNS(</span><br><span class=\"line\">  (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=<span class=\"string\">&#x27;AES&#x27;</span>,PROPERTIES(<span class=\"string\">&#x27;aes-key-value&#x27;</span>=<span class=\"string\">&#x27;123456abc&#x27;</span>, <span class=\"string\">&#x27;digest-algorithm-name&#x27;</span>=<span class=\"string\">&#x27;SHA-1&#x27;</span>))))</span><br><span class=\"line\">));</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹åŠ å¯†è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER ENCRYPT RULE t_user (</span><br><span class=\"line\">COLUMNS(</span><br><span class=\"line\">  (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=<span class=\"string\">&#x27;AES&#x27;</span>,PROPERTIES(<span class=\"string\">&#x27;aes-key-value&#x27;</span>=<span class=\"string\">&#x27;123456abc&#x27;</span>, <span class=\"string\">&#x27;digest-algorithm-name&#x27;</span>=<span class=\"string\">&#x27;SHA-1&#x27;</span>))))</span><br><span class=\"line\">));</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤åŠ å¯†è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP ENCRYPT RULE t_user;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢åŠ å¯†è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/encrypt/show-encrypt-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰åŠ å¯†è§„åˆ™</span></span><br><span class=\"line\">SHOW ENCRYPT RULES \\G;</span><br><span class=\"line\"><span class=\"comment\"># è·å–æŒ‡å®šé€»è¾‘åº“ä¸­çš„åŠ å¯†è§„åˆ™</span></span><br><span class=\"line\">SHOW ENCRYPT RULES FROM sharding_db \\G;</span><br><span class=\"line\"><span class=\"comment\"># è·å–æŒ‡å®šé€»è¾‘è¡¨ä¸­çš„åŠ å¯†è§„åˆ™</span></span><br><span class=\"line\">SHOW ENCRYPT RULE t_user \\G;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ•°æ®è„±æ•è§„åˆ™\">æ•°æ®è„±æ•è§„åˆ™</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!MASK</span>  <span class=\"comment\"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># è„±æ•è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span>  <span class=\"comment\"># è„±æ•åˆ—é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># è„±æ•åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">md5_mask</span> <span class=\"comment\"># è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">email:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">mask_before_special_chars_mask</span></span><br><span class=\"line\">          <span class=\"attr\">telephone:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">keep_first_n_last_m_mask</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">my_mask</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">maskAlgorithms:</span> <span class=\"comment\"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">md5_mask:</span> <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span>  <span class=\"comment\"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class=\"line\">      <span class=\"attr\">mask_before_special_chars_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MASK_BEFORE_SPECIAL_CHARS</span> <span class=\"comment\"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">special-chars:</span> <span class=\"string\">&#x27;@&#x27;</span>  <span class=\"comment\"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span>   <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">keep_first_n_last_m_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">KEEP_FIRST_N_LAST_M</span> <span class=\"comment\"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">first-n:</span> <span class=\"number\">3</span>     <span class=\"comment\"># ä¿ç•™å‰ 3 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">last-m:</span> <span class=\"number\">4</span>      <span class=\"comment\"># ä¿ç•™å 4 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">my_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MY_CUSTOM_MASK</span>  <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&quot;#&quot;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-11\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºè„±æ•è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/mask/create-mask-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE MASK RULE t_user (</span><br><span class=\"line\">  COLUMNS(</span><br><span class=\"line\">    (NAME=password, TYPE(NAME=<span class=\"string\">&#x27;MD5&#x27;</span>)),</span><br><span class=\"line\">    (NAME=email, TYPE(NAME=<span class=\"string\">&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;special-chars&quot;</span>=<span class=\"string\">&quot;@&quot;</span>,  <span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;*&quot;</span>))),</span><br><span class=\"line\">    (NAME=telephone, TYPE(NAME=<span class=\"string\">&#x27;KEEP_FIRST_N_LAST_M&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;first-n&quot;</span>=3, <span class=\"string\">&quot;last-m&quot;</span>=4, <span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;*&quot;</span>))),</span><br><span class=\"line\">    (NAME=`name`, TYPE(NAME=<span class=\"string\">&#x27;MY_CUSTOM_MASK&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;#&quot;</span>)))</span><br><span class=\"line\">  )</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œæ³¨æ„ name æ˜¯å…³é”®å­—ï¼Œæ‰€ä»¥éœ€è¦ç”¨ `` åŒ…èµ·æ¥</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹è„±æ•è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER MASK RULE t_user (</span><br><span class=\"line\">  COLUMNS(</span><br><span class=\"line\">    (NAME=password, TYPE(NAME=<span class=\"string\">&#x27;MD5&#x27;</span>)),</span><br><span class=\"line\">    (NAME=email, TYPE(NAME=<span class=\"string\">&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;special-chars&quot;</span>=<span class=\"string\">&quot;@&quot;</span>,  <span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;*&quot;</span>))),</span><br><span class=\"line\">    (NAME=telephone, TYPE(NAME=<span class=\"string\">&#x27;KEEP_FIRST_N_LAST_M&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;first-n&quot;</span>=3, <span class=\"string\">&quot;last-m&quot;</span>=4, <span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;*&quot;</span>))),</span><br><span class=\"line\">    (NAME=`name`, TYPE(NAME=<span class=\"string\">&#x27;MY_CUSTOM_MASK&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;#&quot;</span>)))</span><br><span class=\"line\">  )</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤è„±æ•è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP MASK RULE t_user;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢è„±æ•è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/mask/show-mask-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰è„±æ•è§„åˆ™</span></span><br><span class=\"line\">SHOW MASK RULES;</span><br><span class=\"line\"><span class=\"comment\"># ä»…æŸ¥è¯¢æŒ‡å®šé€»è¾‘åº“ä¸­çš„è„±æ•è§„åˆ™</span></span><br><span class=\"line\">SHOW MASK RULES FROM sharding_db;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æŒ‡å®šè§„åˆ™</span></span><br><span class=\"line\">mysql&gt; SHOW MASK RULE t_user;</span><br><span class=\"line\">+--------+-----------+---------------------------+-------------------------------------------------+</span><br><span class=\"line\">| table  | column    | algorithm_type            | algorithm_props                                 |</span><br><span class=\"line\">+--------+-----------+---------------------------+-------------------------------------------------+</span><br><span class=\"line\">| t_user | password  | MD5                       |                                                 |</span><br><span class=\"line\">| t_user | email     | MASK_BEFORE_SPECIAL_CHARS | &#123;<span class=\"string\">&quot;replace-char&quot;</span>:<span class=\"string\">&quot;*&quot;</span>,<span class=\"string\">&quot;special-chars&quot;</span>:<span class=\"string\">&quot;@&quot;</span>&#125;        |</span><br><span class=\"line\">| t_user | telephone | KEEP_FIRST_N_LAST_M       | &#123;<span class=\"string\">&quot;first-n&quot;</span>:<span class=\"string\">&quot;3&quot;</span>,<span class=\"string\">&quot;last-m&quot;</span>:<span class=\"string\">&quot;4&quot;</span>,<span class=\"string\">&quot;replace-char&quot;</span>:<span class=\"string\">&quot;*&quot;</span>&#125; |</span><br><span class=\"line\">| t_user | name      | MY_CUSTOM_MASK            | &#123;<span class=\"string\">&quot;replace-char&quot;</span>:<span class=\"string\">&quot;#&quot;</span>&#125;                            |</span><br><span class=\"line\">+--------+-----------+---------------------------+-------------------------------------------------+</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» ShardingSphere-Proxy5.5.2 DistSQL çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ DistSQL DistSQLï¼ˆDistributed SQLï¼‰æ˜¯ Apache ShardingSphere ç‰¹æœ‰çš„æ“ä½œè¯­è¨€ã€‚ å®ƒä¸æ ‡å‡† SQL çš„ä½¿ç”¨æ–¹å¼å®Œå…¨ä¸€è‡´ï¼Œç”¨äºæä¾›å¢é‡åŠŸèƒ½çš„ SQL çº§åˆ«æ“ä½œèƒ½åŠ›ã€‚ çµæ´»çš„è§„åˆ™é…ç½®å’Œèµ„æºç®¡æ§èƒ½åŠ›æ˜¯ Apache ShardingSphere çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚ åœ¨ä½¿ç”¨ 4.x åŠå…¶ä¹‹å‰ç‰ˆæœ¬æ—¶ï¼Œå¼€å‘è€…è™½ç„¶å¯ä»¥åƒä½¿ç”¨åŸç”Ÿæ•°æ®åº“ä¸€æ ·æ“ä½œæ•°æ®ï¼Œä½†å´éœ€è¦é€šè¿‡æœ¬åœ°æ–‡ä»¶æˆ–æ³¨å†Œä¸­å¿ƒé…ç½®èµ„æºå’Œè§„åˆ™ã€‚ç„¶è€Œï¼Œæ“ä½œä¹ æƒ¯å˜æ›´ï¼Œå¯¹äºè¿ç»´å·¥ç¨‹å¸ˆå¹¶ä¸å‹å¥½ã€‚ ä» 5.x ç‰ˆæœ¬å¼€å§‹ï¼ŒDistSQLï¼ˆDistributed SQLï¼‰è®©ç”¨æˆ·å¯ä»¥åƒæ“ä½œæ•°æ®åº“ä¸€æ ·æ“ä½œ Apache ShardingSphereï¼Œä½¿å…¶ä»é¢å‘å¼€å‘äººå‘˜çš„æ¡†æ¶å’Œä¸­é—´ä»¶è½¬å˜ä¸ºé¢å‘è¿ç»´äººå‘˜çš„æ•°æ®åº“äº§å“ã€‚ DistSQL ç»†åˆ†ä¸º RDLã€RQLã€RAL å’Œ RUL å››ç§ç±»å‹ã€‚ RDL: Resource &amp; Rule Definition Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤ã€‚ RQL: Resource &amp; Rule Query Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„æŸ¥è¯¢å’Œå±•ç°ã€‚ RAL: Resource &amp; Rule Administration Languageï¼Œè´Ÿè´£å¼ºåˆ¶è·¯ç”±ã€ç†”æ–­ã€é…ç½®å¯¼å…¥å¯¼å‡ºã€æ•°æ®è¿ç§»æ§åˆ¶ç­‰ç®¡ç†åŠŸèƒ½ã€‚ RUL: Resource &amp; Rule Utility Languageï¼Œè´Ÿè´£ SQL è§£æã€SQL æ ¼å¼åŒ–ã€æ‰§è¡Œè®¡åˆ’é¢„è§ˆç­‰åŠŸèƒ½ã€‚ DistSQL ä»…å¯ä»¥åœ¨ ShardingSphere-Proxy ä¸­ä½¿ç”¨ï¼Œä¸èƒ½åœ¨ ShardingSphere-JDBC ä¸­ä½¿ç”¨ã€‚ ç¤ºä¾‹å‡†å¤‡ å…·ä½“çš„è¯­æ³•ï¼Œå®˜ç½‘ä»‹ç»çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡ŒåŸºäº SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨ ä¸­çš„é…ç½®è¿›è¡Œç¤ºä¾‹è¯´æ˜ã€‚ ä¸ºäº†å°½å¯èƒ½å¤šçš„ä½¿ç”¨ DistSQL è¯­æ³•ï¼Œè¿™é‡Œä»…åœ¨ global.yaml ä¸­é…ç½®å¦‚ä¸‹å†…å®¹: 12345678910111213141516171819202122232425# é…ç½®ä¸ºåŸºäº zookeeper é›†ç¾¤æ¨¡å¼ï¼Œä¸ºäº†æ¼”ç¤º DistSQL è¯­æ³•ï¼Œè¿™é‡Œéœ€è¦å°†é…ç½®æŒä¹…åŒ–ï¼Œä½¿ç”¨ JDBC çš„å•æœºæ¨¡å¼ä¹Ÿå¯ä»¥mode: type: Cluster # è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone repository: type: ZooKeeper # æ³¨å†Œä¸­å¿ƒç±»å‹ props: namespace: governance_ds # ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹ server-lists: localhost:2181 # ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨ retryIntervalMilliseconds: 500 # ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚ timeToLiveSeconds: 60 # è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥ maxRetries: 3 # æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚ operationTimeoutMilliseconds: 500 # å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚# é…ç½®ç”¨æˆ·å’Œæƒé™ï¼Œå› ä¸º DistSQL æš‚ä¸æ”¯æŒ ç”¨æˆ·å’Œæƒé™ç®¡ç†ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å…ˆé…ç½®ç”¨æˆ·å’Œæƒé™authority: users: - user: root@127.0.0.1 password: root admin: true - user: sharding@% password: sharding privilege: type: DATABASE_PERMITTED props: user-database-mappings: root@127.0.0.1=*,sharding@%=sharding_db å¯åŠ¨ ShardingSphere-Proxy æœåŠ¡ï¼Œå¹¶ç™»å½• 12345678910111213# å¯åŠ¨ ShardingSphere-Proxy./shardingsphere-proxy-bin/bin/start.sh# ä½¿ç”¨ç®¡ç†å‘˜ç™»å½•mysql -h127.0.0.1 -uroot -proot -P3307# æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™mysql&gt; SHOW AUTHORITY RULE;+----------------------------+--------------------+----------------------------------------------------------------------+| users | provider | props |+----------------------------+--------------------+----------------------------------------------------------------------+| root@127.0.0.1; sharding@% | DATABASE_PERMITTED | &#123;&quot;user-database-mappings&quot;:&quot;root@127.0.0.1=*,sharding@%=sharding_db&quot;&#125; |+----------------------------+--------------------+----------------------------------------------------------------------+1 row in set (0.49 sec) å…¨å±€é…ç½®ï¼Œå³global.yamlä¸­çš„é…ç½® å…¨å±€é…ç½®å¯¹æ‰€æœ‰é€»è¾‘æ•°æ®åº“æœ‰æ•ˆ å±æ€§é…ç½® é…ç½®æ–‡ä»¶ä¸­çš„é…ç½® 12props: sql-show: true # æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false DistSQL è¯­æ³• è®¾ç½®å±æ€§ï¼Œå®˜æ–¹æ–‡æ¡£ 12# è¿™é‡Œè¦æ³¨æ„ï¼Œå±æ€§åéœ€è¦ä½¿ç”¨ä¸‹åˆ’çº¿æ ¼å¼SET DIST VARIABLE sql_show = true; æŸ¥çœ‹å±æ€§ï¼Œå®˜æ–¹æ–‡æ¡£ 123456789101112131415161718192021222324252627mysql&gt; SHOW DIST VARIABLES;+-----------------------------------------+-----------------+| variable_name | variable_value |+-----------------------------------------+-----------------+| agent_plugins_enabled | true || cached_connections | 0 || cdc_server_port | 33071 || check_table_metadata_enabled | false || kernel_executor_size | 0 || load_table_metadata_batch_size | 1000 || max_connections_size_per_query | 1 || proxy_backend_query_fetch_size | -1 || proxy_default_port | 3307 || proxy_frontend_database_protocol_type | || proxy_frontend_executor_size | 0 || proxy_frontend_flush_threshold | 128 || proxy_frontend_max_connections | 0 || proxy_frontend_ssl_cipher | || proxy_frontend_ssl_enabled | false || proxy_frontend_ssl_version | TLSv1.2,TLSv1.3 || proxy_meta_data_collector_enabled | false || proxy_netty_backlog | 1024 || sql_show | true || sql_simple | false || system_log_level | INFO || system_schema_metadata_assembly_enabled | true |+-----------------------------------------+-----------------+ åˆ†å¸ƒå¼äº‹åŠ¡é…ç½® é…ç½®æ–‡ä»¶ä¸­çš„é…ç½® 123transaction: defaultType: XA providerType: Atomikos DistSQL è¯­æ³• æŸ¥çœ‹äº‹åŠ¡è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 1SHOW TRANSACTION RULE; ä¿®æ”¹äº‹åŠ¡è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 123ALTER TRANSACTION RULE( DEFAULT=&quot;XA&quot;, TYPE(NAME=&quot;Atomikos&quot;)); è§„åˆ™é…ç½®ï¼Œå³database-xxx.yamlä¸­çš„é…ç½® ä»¥ä¸‹ DistSQL ä»…å¯ä»¥åœ¨é€»è¾‘åº“ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªé€»è¾‘æ•°æ®åº“ 12345mysql&gt; CREATE DATABASE sharding_db;Query OK, 0 rows affected (0.03 sec)mysql&gt; use sharding_db;Database changed æ•°æ®æºé…ç½® åœ¨ DistSQLä¸­ï¼Œå®˜æ–¹å°†æ•°æ®æºå«åšå­˜å‚¨å•å…ƒ(STORAGE UNIT) é…ç½®æ–‡ä»¶ä¸­çš„é…ç½® 12345678910dataSources: ds_0: # é€»è¾‘æ•°æ®æºåç§° url: jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 # æ³¨æ„è¿™é‡Œå±æ€§ä¸º url username: root password: newpwd ds_1: url: jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd DistSQL è¯­æ³• æ³¨å†Œå­˜å‚¨å•å…ƒï¼Œå®˜æ–¹æ–‡æ¡£ 1234567891011REGISTER STORAGE UNIT ds_0 ( URL=&quot;jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;, USER=&quot;root&quot;, PASSWORD=&quot;newpwd&quot;);REGISTER STORAGE UNIT ds_1 ( URL=&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;, USER=&quot;root&quot;, PASSWORD=&quot;newpwd&quot;); æŸ¥è¯¢å­˜å‚¨å•å…ƒï¼Œå®˜æ–¹æ–‡æ¡£ 1SHOW STORAGE UNITS FROM sharding_db \\G; ä¿®æ”¹å­˜å‚¨å•å…ƒï¼Œå®˜æ–¹æ–‡æ¡£ 123456ALTER STORAGE UNIT ds_1 ( URL=&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;, USER=&quot;root&quot;, PASSWORD=&quot;newpwd&quot;, PROPERTIES(&quot;maximumPoolSize&quot;=10,&quot;idleTimeout&quot;=30000)); å–æ¶ˆæ³¨å†Œå­˜å‚¨å•å…ƒï¼Œå®˜æ–¹æ–‡æ¡£ 12# æ— æ³•ç§»é™¤å·²ç»è¢«è§„åˆ™ä½¿ç”¨çš„å­˜å‚¨å•å…ƒUNREGISTER STORAGE UNIT ds_0; å•è¡¨é…ç½® é…ç½®æ–‡ä»¶ä¸­çš„é…ç½® 12345rules: - !SINGLE # å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™ tables: # MySQL é£æ ¼ - ds_0.t_address # åŠ è½½æŒ‡å®šå•è¡¨ DistSQL è¯­æ³• åŠ è½½å•è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1LOAD SINGLE TABLE ds_0.t_address; æŸ¥è¯¢å•è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1SHOW SINGLE TABLES; å¸è½½å•è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1UNLOAD SINGLE TABLE ds_0.t_address; å¹¿æ’­è¡¨é…ç½® å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨ 1234rules: - !BROADCAST # å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª tables: - dict # å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚ DistSQL è¯­æ³• åˆ›å»ºå¹¿æ’­è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1CREATE BROADCAST TABLE RULE dict; åˆ é™¤å¹¿æ’­è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1DROP BROADCAST TABLE RULE dict; æŸ¥è¯¢å¹¿æ’­è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1234# æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨SHOW BROADCAST TABLE RULES;# æŸ¥è¯¢æŒ‡å®šæ•°æ®åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨SHOW BROADCAST TABLE RULES FROM sharding_db; åˆ†åº“åˆ†è¡¨é…ç½® å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹ 12345678910111213141516171819202122232425262728293031rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® course: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.course_$&#123;1..2&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1 databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: course_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: cid shardingAlgorithmName: course_inline keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: cid # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• course_inline: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™ props: # å±æ€§ algorithm-expression: course_$&#123;cid % 2 + 1&#125; # è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2 allow-range-query-with-inline-sharding: true # å…è®¸èŒƒå›´æŸ¥è¯¢ course_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; # è¡¨ç¤º ds_0, ds_1 keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong DistSQL è¯­æ³• åˆ›å»ºåˆ†ç‰‡è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 123456CREATE SHARDING TABLE RULE course ( DATANODES(&quot;ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;&quot;), DATABASE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;ds_$&#123;user_id % 2&#125;&quot;)))), TABLE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=cid,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;course_$&#123;cid % 2 + 1&#125;&quot;,&quot;allow-range-query-with-inline-sharding&quot;=true )))), KEY_GENERATE_STRATEGY(COLUMN=cid,TYPE(NAME=&quot;snowflake&quot;))); å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹ 123456789101112131415161718192021222324252627282930313233343536rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® t_user: actualDataNodes: ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_inline # åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: id # è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹# keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° keyGeneratorName: custom_snowflake_string # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• t_user_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;Math.abs(id.hashCode()%2)&#125; # åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®— t_user_inline: type: INLINE props: algorithm-expression: t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125; # åˆ†è¡¨ï¼Œt_user_0, t_user_1 keyGenerators: # åˆ†å¸ƒå¼åºåˆ—ç®—æ³• uuid: # å®šä¹‰åç§° type: UUID # å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString custom_snowflake_string: type: CUSTOM_SNOWFLAKE_STRING # è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi props: workerId: 2 datacenterId: 2 DistSQL è¯­æ³• åˆ›å»ºåˆ†ç‰‡è§„åˆ™ 123456CREATE SHARDING TABLE RULE t_user ( DATANODES(&quot;ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;&quot;), DATABASE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;ds_$&#123;Math.abs(id.hashCode()%2)&#125;&quot;)))), TABLE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;&quot;)))), KEY_GENERATE_STRATEGY(COLUMN=id,TYPE(NAME=&quot;CUSTOM_SNOWFLAKE_STRING&quot;))); å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® t_order_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id shardingAlgorithmName: t_order-complex-algorithm keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id # åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”# shardingAlgorithmName: t_order_item-class-based-algorithm # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• shardingAlgorithmName: t_order_item-class-based-algorithm_spi # åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• t_order_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; t_order-complex-algorithm: type: COMPLEX_INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³• props: algorithm-expression: t_order_complex_$&#123;(user_id + order_id + 1) % 2&#125; t_order_item-class-based-algorithm_spi: # SPI type: T_ORDER_ITEM_COMPLEX # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong DistSQL è¯­æ³• åˆ›å»ºåˆ†ç‰‡è§„åˆ™ 12345678910111213CREATE SHARDING TABLE RULE t_order_complex ( DATANODES(&quot;ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;&quot;), DATABASE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;ds_$&#123;user_id % 2&#125;&quot;)))), TABLE_STRATEGY(TYPE=&quot;complex&quot;,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;complex_inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;t_order_complex_$&#123;(user_id + order_id + 1) % 2&#125;&quot;)))), KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=&quot;snowflake&quot;)));CREATE SHARDING TABLE RULE t_order_item_complex ( DATANODES(&quot;ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;&quot;), DATABASE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;ds_$&#123;user_id % 2&#125;&quot;)))), TABLE_STRATEGY(TYPE=&quot;complex&quot;,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;T_ORDER_ITEM_COMPLEX&quot;))), KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=&quot;SNOWFLAKE&quot;))); è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™ ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™ 12345678910111213141516171819202122232425262728293031323334rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® # ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´ bindingTables: - t_order,t_order_item autoTables: # è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½® t_order: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• mod_2: type: MOD # åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³• props: sharding-count: 2 # åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™ keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong DistSQL è¯­æ³• åˆ›å»ºåˆ†ç‰‡è§„åˆ™ 1234567891011CREATE SHARDING TABLE RULE t_order ( STORAGE_UNITS(ds_0,ds_1), SHARDING_COLUMN=user_id,TYPE(NAME=&quot;mod&quot;,PROPERTIES(&quot;sharding-count&quot;=&quot;2&quot;)), KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=&quot;snowflake&quot;)));CREATE SHARDING TABLE RULE t_order_item ( STORAGE_UNITS(ds_0,ds_1), SHARDING_COLUMN=user_id,TYPE(NAME=&quot;mod&quot;,PROPERTIES(&quot;sharding-count&quot;=&quot;2&quot;)), KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=&quot;snowflake&quot;))); å…¶å®ƒåˆ†ç‰‡æ“ä½œè¯­å¥ æŸ¥è¯¢åˆ†ç‰‡è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 123456# æŸ¥çœ‹å½“å‰é€»è¾‘åº“ä¸‹çš„æ‰€æœ‰åˆ†ç‰‡è§„åˆ™SHOW SHARDING TABLE RULES \\G;# æŸ¥çœ‹æŒ‡å®šé€»è¾‘åº“ä¸‹çš„åˆ†ç‰‡è§„åˆ™SHOW SHARDING TABLE RULES FROM sharding_db; \\G;# æŸ¥çœ‹æŒ‡å®šåˆ†ç‰‡è§„åˆ™SHOW SHARDING TABLE RULE t_user \\G; ä¿®æ”¹åˆ†ç‰‡è§„åˆ™ï¼Œå®˜ç½‘æ–‡æ¡£ï¼Œä¸åˆ›å»ºåˆ†ç‰‡è§„åˆ™ç±»ä¼¼ï¼Œå°†CREATEæ”¹ä¸ºALTERå³å¯ 123456ALTER SHARDING TABLE RULE t_order_item_complex ( DATANODES(&quot;ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;&quot;), DATABASE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;ds_$&#123;user_id % 2&#125;&quot;)))), TABLE_STRATEGY(TYPE=&quot;complex&quot;,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;T_ORDER_ITEM_COMPLEX&quot;))), KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=&quot;SNOWFLAKE&quot;))); åˆ é™¤åˆ†ç‰‡è§„åˆ™ï¼Œå®˜ç½‘æ–‡æ¡£ 123DROP SHARDING TABLE RULE t_order;# åˆ é™¤å¤šä¸ªè¡¨DROP SHARDING TABLE RULE t_order,t_order_item; æ•°æ®åŠ å¯†è§„åˆ™ 12345678910111213141516rules: - !ENCRYPT # æ•°æ®åŠ å¯†é…ç½® tables: t_user: # åŠ å¯†è¡¨åç§° columns: password: # åŠ å¯†åˆ—åç§° cipher: name: password # å¯†æ–‡åˆ—åç§° encryptorName: aes_encryptor # å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§° # åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/ encryptors: aes_encryptor: # åŠ è§£å¯†ç®—æ³•åç§° type: AES # åŠ è§£å¯†ç®—æ³•ç±»å‹ props: # åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½® aes-key-value: 123456abc # AES ä½¿ç”¨çš„ KEY digest-algorithm-name: SHA-1 # AES KEY çš„æ‘˜è¦ç®—æ³• DistSQL è¯­æ³• åˆ›å»ºåŠ å¯†è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 1234CREATE ENCRYPT RULE t_user (COLUMNS( (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=&#x27;AES&#x27;,PROPERTIES(&#x27;aes-key-value&#x27;=&#x27;123456abc&#x27;, &#x27;digest-algorithm-name&#x27;=&#x27;SHA-1&#x27;)))))); ä¿®æ”¹åŠ å¯†è§„åˆ™ 1234ALTER ENCRYPT RULE t_user (COLUMNS( (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=&#x27;AES&#x27;,PROPERTIES(&#x27;aes-key-value&#x27;=&#x27;123456abc&#x27;, &#x27;digest-algorithm-name&#x27;=&#x27;SHA-1&#x27;)))))); åˆ é™¤åŠ å¯†è§„åˆ™ 1DROP ENCRYPT RULE t_user; æŸ¥è¯¢åŠ å¯†è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 123456# æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰åŠ å¯†è§„åˆ™SHOW ENCRYPT RULES \\G;# è·å–æŒ‡å®šé€»è¾‘åº“ä¸­çš„åŠ å¯†è§„åˆ™SHOW ENCRYPT RULES FROM sharding_db \\G;# è·å–æŒ‡å®šé€»è¾‘è¡¨ä¸­çš„åŠ å¯†è§„åˆ™SHOW ENCRYPT RULE t_user \\G; æ•°æ®è„±æ•è§„åˆ™ 1234567891011121314151617181920212223242526272829303132rules: - !MASK # æ•°æ®è„±æ•é…ç½® tables: t_user: # è„±æ•è¡¨åç§° columns: # è„±æ•åˆ—é…ç½® password: # è„±æ•åˆ—åç§° maskAlgorithm: md5_mask # è„±æ•ç®—æ³•åç§° email: maskAlgorithm: mask_before_special_chars_mask telephone: maskAlgorithm: keep_first_n_last_m_mask name: maskAlgorithm: my_mask maskAlgorithms: # è„±æ•ç®—æ³•é…ç½® md5_mask: # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° type: MD5 # è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º mask_before_special_chars_mask: type: MASK_BEFORE_SPECIAL_CHARS # åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com props: special-chars: &#x27;@&#x27; # é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ• replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ keep_first_n_last_m_mask: type: KEEP_FIRST_N_LAST_M # ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678 props: first-n: 3 # ä¿ç•™å‰ 3 ä½ last-m: 4 # ä¿ç•™å 4 ä½ replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ my_mask: type: MY_CUSTOM_MASK # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° props: replace-char: &quot;#&quot; DistSQL è¯­æ³• åˆ›å»ºè„±æ•è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 123456789CREATE MASK RULE t_user ( COLUMNS( (NAME=password, TYPE(NAME=&#x27;MD5&#x27;)), (NAME=email, TYPE(NAME=&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;, PROPERTIES(&quot;special-chars&quot;=&quot;@&quot;, &quot;replace-char&quot;=&quot;*&quot;))), (NAME=telephone, TYPE(NAME=&#x27;KEEP_FIRST_N_LAST_M&#x27;, PROPERTIES(&quot;first-n&quot;=3, &quot;last-m&quot;=4, &quot;replace-char&quot;=&quot;*&quot;))), (NAME=`name`, TYPE(NAME=&#x27;MY_CUSTOM_MASK&#x27;, PROPERTIES(&quot;replace-char&quot;=&quot;#&quot;))) ));# è¿™é‡Œæ³¨æ„ name æ˜¯å…³é”®å­—ï¼Œæ‰€ä»¥éœ€è¦ç”¨ `` åŒ…èµ·æ¥ ä¿®æ”¹è„±æ•è§„åˆ™ 12345678ALTER MASK RULE t_user ( COLUMNS( (NAME=password, TYPE(NAME=&#x27;MD5&#x27;)), (NAME=email, TYPE(NAME=&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;, PROPERTIES(&quot;special-chars&quot;=&quot;@&quot;, &quot;replace-char&quot;=&quot;*&quot;))), (NAME=telephone, TYPE(NAME=&#x27;KEEP_FIRST_N_LAST_M&#x27;, PROPERTIES(&quot;first-n&quot;=3, &quot;last-m&quot;=4, &quot;replace-char&quot;=&quot;*&quot;))), (NAME=`name`, TYPE(NAME=&#x27;MY_CUSTOM_MASK&#x27;, PROPERTIES(&quot;replace-char&quot;=&quot;#&quot;))) )); åˆ é™¤è„±æ•è§„åˆ™ 1DROP MASK RULE t_user; æŸ¥è¯¢è„±æ•è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 1234567891011121314# æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰è„±æ•è§„åˆ™SHOW MASK RULES;# ä»…æŸ¥è¯¢æŒ‡å®šé€»è¾‘åº“ä¸­çš„è„±æ•è§„åˆ™SHOW MASK RULES FROM sharding_db;# æŸ¥è¯¢æŒ‡å®šè§„åˆ™mysql&gt; SHOW MASK RULE t_user;+--------+-----------+---------------------------+-------------------------------------------------+| table | column | algorithm_type | algorithm_props |+--------+-----------+---------------------------+-------------------------------------------------+| t_user | password | MD5 | || t_user | email | MASK_BEFORE_SPECIAL_CHARS | &#123;&quot;replace-char&quot;:&quot;*&quot;,&quot;special-chars&quot;:&quot;@&quot;&#125; || t_user | telephone | KEEP_FIRST_N_LAST_M | &#123;&quot;first-n&quot;:&quot;3&quot;,&quot;last-m&quot;:&quot;4&quot;,&quot;replace-char&quot;:&quot;*&quot;&#125; || t_user | name | MY_CUSTOM_MASK | &#123;&quot;replace-char&quot;:&quot;#&quot;&#125; |+--------+-----------+---------------------------+-------------------------------------------------+","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» ShardingSphere-Proxy5.5.2 DistSQL çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘","date_published":"2025-09-11T13:30:05.000Z","tags":["æŠ€æœ¯","springboot","sharding-sphere","springboot","sharding-sphere"]},{"id":"https://blog.hanqunfeng.com/2025/09/10/springboot3-shardingsphere-proxy-mode/","url":"https://blog.hanqunfeng.com/2025/09/10/springboot3-shardingsphere-proxy-mode/","title":"SpringBoot3 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/index_zh.html\">ShardingSphereå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åœ¨ <a href=\"/2025/09/04/springboot3-shardingsphere-proxy/\" title=\"SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨\">SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨</a> çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è¿è¡Œæ¨¡å¼è¯´æ˜\">è¿è¡Œæ¨¡å¼è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/dev-manual/mode/\">è¿è¡Œæ¨¡å¼</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy è¿è¡Œæ¨¡å¼åˆ†ä¸ºä¸¤ç§ï¼šå•æœºæ¨¡å¼(Standalone) å’Œ é›†ç¾¤æ¨¡å¼(Cluster)ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿è¡Œæ¨¡å¼å°±æ˜¯æŒ‡å®šå°†<code>å…ƒæ•°æ®</code>(è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ç­‰)æŒä¹…åŒ–çš„å­˜å‚¨æ–¹å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤è¿è¡Œæ¨¡å¼ä¸ºå•æœºæ¨¡å¼ï¼Œä½¿ç”¨<code>H2</code>çš„å†…å­˜æ–¹å¼ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å•æœºæ¨¡å¼-Standalone\">å•æœºæ¨¡å¼(Standalone)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å•æœºæ¨¡å¼èƒ½å¤Ÿå°†æ•°æ®æºå’Œè§„åˆ™ç­‰å…ƒæ•°æ®ä¿¡æ¯æŒä¹…åŒ–ï¼Œä½†æ— æ³•å°†å…ƒæ•°æ®åŒæ­¥è‡³å¤šä¸ª Apache ShardingSphere å®ä¾‹ï¼Œæ— æ³•åœ¨é›†ç¾¤ç¯å¢ƒä¸­ç›¸äº’æ„ŸçŸ¥ã€‚ é€šè¿‡æŸä¸€å®ä¾‹æ›´æ–°å…ƒæ•°æ®ä¹‹åï¼Œä¼šå¯¼è‡´å…¶ä»–å®ä¾‹ç”±äºè·å–ä¸åˆ°æœ€æ–°çš„å…ƒæ•°æ®è€Œäº§ç”Ÿä¸ä¸€è‡´çš„é”™è¯¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨äºå·¥ç¨‹å¸ˆåœ¨æœ¬åœ°æ­å»º Apache ShardingSphere ç¯å¢ƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å•æœºæ¨¡å¼ç›®å‰ä»…æ”¯æŒä¸€ç§ï¼šJDBCï¼Œå³æ•°æ®åº“æŒä¹…åŒ–ã€‚ä»¥ä¸‹ä¸ºé»˜è®¤å€¼(<code>JDBCRepositoryPropertyKey</code>)ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>æ•°æ®ç±»å‹</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>provider</td>\n<td>String</td>\n<td>å…ƒæ•°æ®å­˜å‚¨ç±»å‹ï¼Œå¯é€‰å€¼ä¸º <code>H2</code>ã€<code>MySQL</code> ã€<code>EmbeddedDerby</code>ã€<code>DerbyNetworkServer</code>ã€<code>HSQLDB</code></td>\n<td>H2</td>\n</tr>\n<tr>\n<td>jdbc_url</td>\n<td>String</td>\n<td>JDBC URL</td>\n<td><code>jdbc:h2:mem:config;DB_CLOSE_DELAY=0;DATABASE_TO_UPPER=false;MODE=MYSQL</code></td>\n</tr>\n<tr>\n<td>username</td>\n<td>String</td>\n<td>è´¦å·</td>\n<td>sa</td>\n</tr>\n<tr>\n<td>password</td>\n<td>String</td>\n<td>å¯†ç </td>\n<td>ç©ºï¼ˆæ— é»˜è®¤å€¼ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä»¥ Mysql å­˜å‚¨å…ƒæ•°æ®ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/common-config/builtin-algorithm/metadata-repository/#jdbc-%E6%8C%81%E4%B9%85%E5%8C%96\">å®˜ç½‘è¯´æ˜</a></p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">mode:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">Standalone</span></span><br><span class=\"line\">  <span class=\"attr\">repository:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">JDBC</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">provider:</span> <span class=\"string\">MySQL</span></span><br><span class=\"line\">      <span class=\"attr\">jdbc_url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶éœ€è¦å°† mysql çš„é©±åŠ¨ jar åŒ… æ·»åŠ åˆ° <code>ext-lib</code> ç›®å½•ä¸‹</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ ShardingSphere Proxy æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ä¸Šé¢çš„æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¼ è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„ä¸­çš„å…ƒæ•°æ®å­˜å‚¨è¿›å»</p>\n</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `repository` (</span><br><span class=\"line\">  `id` <span class=\"type\">varchar</span>(<span class=\"number\">36</span>) <span class=\"keyword\">COLLATE</span> utf8mb4_bin <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `key` text <span class=\"keyword\">COLLATE</span> utf8mb4_bin,</span><br><span class=\"line\">  `<span class=\"keyword\">value</span>` text <span class=\"keyword\">COLLATE</span> utf8mb4_bin,</span><br><span class=\"line\">  `parent` text <span class=\"keyword\">COLLATE</span> utf8mb4_bin,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB <span class=\"keyword\">DEFAULT</span> CHARSET<span class=\"operator\">=</span>utf8mb4 <span class=\"keyword\">COLLATE</span><span class=\"operator\">=</span>utf8mb4_bin;</span><br></pre></td></tr></table></figure>\n<h3 id=\"é‡ç‚¹è¯´æ˜\">é‡ç‚¹è¯´æ˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æ•°æ®åº“ä¸­ä¸å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¯¥è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„å…ƒæ•°æ®æ’å…¥è¯¥è¡¨ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“æ•°æ®åº“ä¸­å·²å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè¯»å–è¯¥è¡¨ä¸­çš„æ•°æ®å¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ï¼Œè€Œä¸ä¼šè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚å³æ­¤æ—¶é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ä¸ä¼šç”Ÿæ•ˆã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è‹¥æ­¤æ—¶æƒ³ä¿®æ”¹é…ç½®è§„åˆ™ï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.åˆ é™¤è¯¥è¡¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åé‡æ–°å¯åŠ¨Proxyï¼Œæ­¤æ—¶ä¼šé‡æ–°åˆ›å»ºè¯¥è¡¨å¹¶åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚</li>\n<li class=\"lvl-4\">2.æ‰‹å·¥ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„å…ƒæ•°æ®ï¼Œä½†ä¿®æ”¹åéœ€è¦é‡æ–°å¯åŠ¨Proxyæ‰ä¼šåŠ è½½æ–°çš„å…ƒæ•°æ®ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚</li>\n<li class=\"lvl-4\">3.<code>[æ¨è]</code>ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ <a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/\">DistSQL</a> åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œä¿®æ”¹åçš„é…ç½®ä¼šè¢«ä¿å­˜åœ¨è¯¥è¡¨ä¸­ï¼Œå¹¶ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯Proxyã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒå¯ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤çš„ H2 å†…å­˜æ•°æ®åº“ï¼Œç”Ÿäº§ç¯å¢ƒå¯ä»¥ä½¿ç”¨ MySQLç­‰æ•°æ®åº“å¯¹å…ƒæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„é›†ç¾¤æ¨¡å¼ã€‚</p>\n</li>\n</ul>\n<h2 id=\"é›†ç¾¤æ¨¡å¼-Cluster\">é›†ç¾¤æ¨¡å¼(Cluster)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤æ¨¡å¼æä¾›äº†å¤šä¸ª Apache ShardingSphere å®ä¾‹ä¹‹é—´çš„å…ƒæ•°æ®å…±äº«å’Œåˆ†å¸ƒå¼åœºæ™¯ä¸‹çŠ¶æ€åè°ƒçš„èƒ½åŠ›ã€‚ å®ƒèƒ½å¤Ÿæä¾›è®¡ç®—èƒ½åŠ›æ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨ç­‰åˆ†å¸ƒå¼ç³»ç»Ÿå¿…å¤‡çš„èƒ½åŠ›ï¼Œé›†ç¾¤ç¯å¢ƒéœ€è¦é€šè¿‡ç‹¬ç«‹éƒ¨ç½²çš„æ³¨å†Œä¸­å¿ƒæ¥å­˜å‚¨å…ƒæ•°æ®å’Œåè°ƒèŠ‚ç‚¹çŠ¶æ€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨é›†ç¾¤æ¨¡å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä»¥ zookeeper é›†ç¾¤æ¨¡å¼ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/common-config/builtin-algorithm/metadata-repository/#zookeeper-%E6%8C%81%E4%B9%85%E5%8C%96\">å®˜ç½‘è¯´æ˜</a></p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">mode:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">Cluster</span>                 <span class=\"comment\"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class=\"line\">  <span class=\"attr\">repository:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">ZooKeeper</span>             <span class=\"comment\"># æ³¨å†Œä¸­å¿ƒç±»å‹ï¼Œå½“å‰ç‰ˆæœ¬ä»…æ”¯æŒ ZooKeeper å’Œ etcd</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">governance_ds</span>  <span class=\"comment\"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class=\"line\">      <span class=\"attr\">server-lists:</span> <span class=\"string\">localhost:2181</span> <span class=\"comment\"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class=\"line\">      <span class=\"attr\">retryIntervalMilliseconds:</span> <span class=\"number\">500</span> <span class=\"comment\"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">timeToLiveSeconds:</span> <span class=\"number\">60</span>     <span class=\"comment\"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"attr\">maxRetries:</span> <span class=\"number\">3</span>             <span class=\"comment\"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">operationTimeoutMilliseconds:</span> <span class=\"number\">500</span>  <span class=\"comment\"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"é‡ç‚¹è¯´æ˜-2\">é‡ç‚¹è¯´æ˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸è¦æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­çš„ namespace ä¸‹çš„é…ç½®ä¿¡æ¯!</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ—¢ç„¶æ˜¯é›†ç¾¤ï¼Œå°±éœ€è¦å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ã€‚ å½“ç¬¬ä¸€ä¸ª ShardingSphere-Proxy å®ä¾‹ å¯åŠ¨åï¼Œå…¶å®ƒç›¸åŒé…ç½®çš„ ShardingSphere-Proxy å®ä¾‹ä»…éœ€è¦ä¸€ä¸ª <code>global.yaml</code> å…¨å±€é…ç½®æ–‡ä»¶å³å¯ï¼Œå¹¶ä»…éœ€åœ¨å…¶ä¸­é…ç½®ä¸Šé¢çš„<code>è¿è¡Œæ¨¡å¼</code>ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å†é…ç½®å…¶å®ƒé…ç½®ï¼Œæ¯”å¦‚è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šé€šè¿‡ Zookeeper é›†ç¾¤ä¸­çš„ namespace è·å–å¹¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª ShardingSphere-Proxy å®ä¾‹å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨å°†è‡ªå·±æ³¨å†Œåˆ° Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹ï¼Œå¹¶è‡ªåŠ¨è·å–è¯¥ namespace ä¸‹çš„é…ç½®ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ Zookeeper é›†ç¾¤ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶ç¬¬ä¸€æ¬¡å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨åœ¨ Zookeeper ä¸­åˆ›å»º namespaceï¼Œå¹¶å†™å…¥é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯åˆ° Zookeeper ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶å†å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨ä» Zookeeper ä¸­è¯»å– namespace ä¸‹çš„é…ç½®ä¿¡æ¯ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä¸ä¼šå†è¯»å–æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ ¹æ®ä¸Šé¢çš„è§„åˆ™ï¼Œæ­¤æ—¶ä¿®æ”¹æœ¬åœ°çš„é…ç½®æ–‡ä»¶ä¸­çš„åˆ†ç‰‡è§„åˆ™åé‡å¯ShardingSphere-Proxy å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ­¤æ—¶æœ‰ä¸‰ç§æ–¹æ³•ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">\n<ol>\n<li class=\"lvl-9\">åˆ é™¤ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespaceï¼Œç„¶åé‡å¯ ShardingSphere-Proxyã€‚è¿™ç§æ–¹æ³•æœ‰ä¸ªå¼Šç«¯ï¼Œå³ä¼šå¯¼è‡´è¿æ¥åˆ°ç›¸åŒ ZooKeeper é›†ç¾¤çš„ namespace çš„å…¶å®ƒ ShardingSphere-Proxy å®ä¾‹æ•°æ®ä¸¢å¤±(å®Œå…¨ä¸å¯ç”¨)ï¼Œä¹Ÿéœ€è¦é‡å¯æ‰èƒ½é‡æ–°è·å–åˆ°æ•°æ®ã€‚</li>\n</ol>\n</li>\n<li class=\"lvl-6\">\n<ol start=\"2\">\n<li class=\"lvl-9\">æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹çš„åˆ†ç‰‡è§„åˆ™ï¼Œä¿®æ”¹åä¼šç«‹å³åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚</li>\n</ol>\n</li>\n<li class=\"lvl-6\">\n<ol start=\"3\">\n<li class=\"lvl-9\"><code>[æ¨è]</code>ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ <a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/\">DistSQL</a> åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚æ‰€ä»¥ï¼Œçµæ´»æŒæ¡ <code>DistSQL</code> æ˜¯ç»´æŠ¤ ShardingSphere-Proxy é›†ç¾¤çš„å…³é”®ã€‚</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ å¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡å™¨ï¼Œæ¯”å¦‚ Nginxï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„ ShardingSphere-Proxy å®ä¾‹ã€‚æ¯”å¦‚ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stream&#123;</span><br><span class=\"line\">    upstream shardingsphere_proxy&#123;</span><br><span class=\"line\">        server  10.10.21.35:3307;</span><br><span class=\"line\">        server  10.10.21.36:3307;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    server&#123;</span><br><span class=\"line\">        listen 3310;</span><br><span class=\"line\">        proxy_connect_timeout 20s;</span><br><span class=\"line\">        proxy_timeout 5m;</span><br><span class=\"line\">        proxy_pass shardingsphere_proxy;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"ä¸-Spring-Boot3-æ•´åˆ\">ä¸ Spring Boot3 æ•´åˆ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ— è®ºæ˜¯ <code>å•æœºæ¨¡å¼</code> è¿˜æ˜¯ <code>é›†ç¾¤æ¨¡å¼</code>ï¼Œå…¶ç›®çš„éƒ½æ˜¯å°† <code>é…ç½®</code> ä¿å­˜åˆ°ç‹¬ç«‹çš„ <code>é…ç½®ä¸­å¿ƒ(æ•°æ®åº“ æˆ– Zookeeper)</code>ä¸­ï¼Œå¹¶è®©å…¶å®ƒ <code>ShardingSphere-Proxy</code> å®ä¾‹ä»è¯¥é…ç½®ä¸­å¿ƒä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‰æ–‡æˆ‘ä»¬ä»‹ç»è¿‡ <code>Spring Boot3</code> + <code>ShardingSphere-Proxy</code> å°±ç›¸å½“äºæ˜¯é›†æˆæ™®é€šçš„MySqlæ•°æ®åº“ï¼Œè€Œ <code>Spring Boot3</code> + <code>ShardingSphere-JDBC</code> å°±éœ€è¦å•ç‹¬åœ¨æœ¬åœ°é…ç½®å„ç§è§„åˆ™ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š <code>ShardingSphere-JDBC</code> ä¹Ÿå¯ä»¥ä» <code>é…ç½®ä¸­å¿ƒ</code> ä¸­è¯»å–é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦åœ¨æœ¬åœ°é…ç½®ä»»ä½•è§„åˆ™äº†ï¼Œæˆ‘ä»¬ä»…éœ€è¦åœ¨ <code>sharding.yaml</code> ä¸­é…ç½®å¥½<code>è¿è¡Œæ¨¡å¼</code>ï¼Œå¹¶é…ç½®å¥½ <code>databaseName</code> çš„åç§°å³å¯ã€‚æ³¨æ„ï¼Œæ­¤æ—¶é…ç½®ä¸­å¿ƒçš„çš„äº‹åŠ¡ä¸èƒ½æ˜¯ <code>XA</code>ï¼Œå› ä¸º<code>Spring Boot3</code> + <code>ShardingSphere-JDBC</code>ç›®å‰ä¸æ”¯æŒ <code>XA</code> äº‹åŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶ï¼Œspringbooté¡¹ç›®å¯åŠ¨åä¼šæ‹‰å–<code>é…ç½®ä¸­å¿ƒ</code>ä¸­çš„é…ç½®ä¿¡æ¯å¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„å…¶å®ƒé…ç½®ä¿¡æ¯ä¼šè¢«å¿½ç•¥ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/G3kESF.png\" alt=\"\"></p>\n</li>\n</ul>\n<h3 id=\"å•æœºæ¨¡å¼\">å•æœºæ¨¡å¼</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-03\">ä»£ç ç¤ºä¾‹</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œå¿…é¡»é‡å¯åº”ç”¨æ‰èƒ½ç”Ÿæ•ˆ</p>\n</li>\n<li class=\"lvl-2\">\n<p>sharding.yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">mode:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">Standalone</span></span><br><span class=\"line\">  <span class=\"attr\">repository:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">JDBC</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">provider:</span> <span class=\"string\">MySQL</span></span><br><span class=\"line\">      <span class=\"attr\">jdbc_url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class=\"line\"><span class=\"attr\">databaseName:</span> <span class=\"string\">sharding_db</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Maven ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- MySQL Connector/J --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.baomidou<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.5.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.shardingsphere<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>shardingsphere-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.5.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.hanqf<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>algorithm-swapper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤æ¨¡å¼\">é›†ç¾¤æ¨¡å¼</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-04\">ä»£ç ç¤ºä¾‹</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œç«‹å³æ¨é€åˆ°æ‰€æœ‰å®ä¾‹ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>sharding.yamlï¼Œæ³¨æ„è¿™é‡Œä¸€å®šè¦é…ç½® <code>databaseName</code></p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># # å¼€å¯é›†ç¾¤æ¨¡å¼</span></span><br><span class=\"line\"><span class=\"attr\">mode:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">Cluster</span>                 <span class=\"comment\"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class=\"line\">  <span class=\"attr\">repository:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">ZooKeeper</span>             <span class=\"comment\"># æ³¨å†Œä¸­å¿ƒç±»å‹</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">governance_ds</span>  <span class=\"comment\"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class=\"line\">      <span class=\"attr\">server-lists:</span> <span class=\"string\">localhost:2181</span> <span class=\"comment\"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class=\"line\">      <span class=\"attr\">retryIntervalMilliseconds:</span> <span class=\"number\">500</span> <span class=\"comment\"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">timeToLiveSeconds:</span> <span class=\"number\">60</span>     <span class=\"comment\"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"attr\">maxRetries:</span> <span class=\"number\">3</span>             <span class=\"comment\"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">operationTimeoutMilliseconds:</span> <span class=\"number\">500</span>  <span class=\"comment\"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class=\"line\"><span class=\"attr\">databaseName:</span> <span class=\"string\">sharding_db</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Maven ä¾èµ–ï¼Œæ³¨æ„è¦åŠ ä¸Š <code>shardingsphere-cluster-mode-repository-zookeeper</code> çš„ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- MySQL Connector/J --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.baomidou<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.5.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.shardingsphere<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>shardingsphere-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.5.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.hanqf<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>algorithm-swapper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- shardingsphere-cluster-mode-repository-zookeeper --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.shardingsphere<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>shardingsphere-cluster-mode-repository-zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.5.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å¦‚ä½•é€‰æ‹©\">å¦‚ä½•é€‰æ‹©</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æˆ‘ä½¿ç”¨<code>springboot3+shardingSphere-JDBC5.5.2</code>æ—¶ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨æœ¬åœ°<code>é…ç½®æ–‡ä»¶</code>çš„æ–¹å¼è¿˜æ˜¯ä½¿ç”¨<code>é…ç½®ä¸­å¿ƒ</code>ï¼ˆæ¯”å¦‚ï¼šzookeeperï¼‰çš„æ–¹å¼å‘¢ï¼Ÿ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹å¼</th>\n<th>éƒ¨ç½²å¤æ‚åº¦</th>\n<th>é…ç½®åŠ¨æ€æ›´æ–°</th>\n<th>å¤šå®ä¾‹å…±äº«é…ç½®</th>\n<th>çƒ­æ›´æ–°æ”¯æŒ</th>\n<th>é€‚ç”¨ç¯å¢ƒ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æœ¬åœ°é…ç½®æ–‡ä»¶</td>\n<td>ç®€å•</td>\n<td>ä¸æ”¯æŒ</td>\n<td>ä¸æ”¯æŒ</td>\n<td>å¦</td>\n<td>å¼€å‘/æµ‹è¯•/å°å‹é¡¹ç›®</td>\n</tr>\n<tr>\n<td>é…ç½®ä¸­å¿ƒï¼ˆZooKeeper/etcdï¼‰</td>\n<td>ç•¥é«˜</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n<td>æ˜¯</td>\n<td>ç”Ÿäº§/åˆ†å¸ƒå¼ç¯å¢ƒ</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">DistSQL ç›®å‰ç¡®å®åªæ”¯æŒåœ¨ ShardingSphere-Proxy ä¸Šæ‰§è¡Œï¼Œå¹¶ä¸” Proxy åªæ”¯æŒ MySQL å’Œ PostgreSQL åè®®ã€‚</li>\n<li class=\"lvl-4\">å¦‚æœä½ åœ¨ Spring Boot + ShardingSphere-JDBC é‡Œç”¨ å…¶å®ƒæ•°æ®åº“ï¼ˆæ¯”å¦‚ SQL Serverã€Oracleã€DB2 ç­‰ï¼‰ï¼Œå°±æ— æ³•ç›´æ¥é€šè¿‡ DistSQL å»åŠ¨æ€æ”¹é…ç½®ã€‚</li>\n<li class=\"lvl-4\">æ­¤æ—¶ä½ å¯ä»¥é€‰æ‹©é€šè¿‡ Zookeeper çš„å®¢æˆ·ç«¯ç›´æ¥ä¿®æ”¹æˆ–é…ç½®è§„åˆ™ï¼Œä¹Ÿå¯ä»¥ä¸é€‰æ‹© <code>é…ç½®ä¸­å¿ƒ</code> çš„æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨ <code>æœ¬åœ°é…ç½®æ–‡ä»¶</code>ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†åº“åˆ†è¡¨\">ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†åº“åˆ†è¡¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åº“åˆ†è¡¨çš„ä¸»è¦ç›®çš„æ˜¯ <strong>è§£å†³æ•°æ®é‡å¤§å¸¦æ¥çš„æ€§èƒ½ã€å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§é—®é¢˜</strong>ã€‚é€šå¸¸éœ€è¦è€ƒè™‘çš„å‡ ä¸ªå…³é”®æŒ‡æ ‡ï¼š</p>\n</li>\n</ul>\n<h3 id=\"1-æ•°æ®é‡æŒ‡æ ‡\">1. æ•°æ®é‡æŒ‡æ ‡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>å•è¡¨æ•°æ®é‡è¿‡å¤§</strong>ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå•è¡¨æ•°æ®é‡åœ¨ <strong>åƒä¸‡çº§</strong> ä»¥ä¸Šæ—¶ï¼ŒæŸ¥è¯¢ã€å†™å…¥å’Œç´¢å¼•çš„æ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¾‹å¦‚ï¼šä¸€ä¸ªè®¢å•è¡¨ä¸€å¤©æœ‰ä¸Šç™¾ä¸‡æ¡æ•°æ®ï¼Œä¸€å¹´ä¸‹æ¥å¯èƒ½æœ‰ä¸Šäº¿æ¡ï¼Œå•è¡¨æ€§èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚</p>\n</li>\n</ul>\n<h3 id=\"2-è®¿é—®é‡æŒ‡æ ‡\">2. è®¿é—®é‡æŒ‡æ ‡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>é«˜å¹¶å‘å†™å…¥æˆ–æŸ¥è¯¢</strong>ï¼šæ•°æ®åº“è¿æ¥ã€äº‹åŠ¡é”ã€IO ç­‰èµ„æºä¼šæˆä¸ºç“¶é¢ˆã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ çš„ç³»ç»Ÿæ¯å¤©æœ‰ä¸Šåƒä¸‡çš„è¯·æ±‚ï¼Œæ•°æ®åº“å¯èƒ½æ— æ³•æ‰¿å—ã€‚</p>\n</li>\n</ul>\n<h3 id=\"3-ä¸šåŠ¡éš”ç¦»éœ€æ±‚\">3. ä¸šåŠ¡éš”ç¦»éœ€æ±‚</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸åŒä¸šåŠ¡çš„æ•°æ®åˆ†ç¦»ï¼Œé¿å…å•ä¸ªä¸šåŠ¡å½±å“æ•´ä¸ªæ•°æ®åº“çš„ç¨³å®šæ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¾‹å¦‚ï¼šç”µå•†ç³»ç»Ÿä¸­çš„è®¢å•å’Œæ—¥å¿—æ•°æ®ï¼Œæ—¥å¿—é‡éå¸¸å¤§ï¼Œå’Œè®¢å•åˆ†å¼€å­˜å‚¨æ›´åˆç†ã€‚</p>\n</li>\n</ul>\n<h3 id=\"4-è¿è¥ä¸æˆæœ¬å› ç´ \">4. è¿è¥ä¸æˆæœ¬å› ç´ </h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åº“åˆ†è¡¨åï¼Œå¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸Šï¼Œæ”¯æŒ <strong>æ°´å¹³æ‰©å±•</strong>ï¼Œè€Œä¸å¿…ä¾èµ–æ˜‚è´µçš„å•æœºæ•°æ®åº“ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ä½¿ç”¨-ShardingSphere-å¯èƒ½å¸¦æ¥çš„é—®é¢˜\">ä½¿ç”¨ ShardingSphere å¯èƒ½å¸¦æ¥çš„é—®é¢˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ <strong>ShardingSphere</strong> å¯ä»¥æ–¹ä¾¿åœ°è§£å†³åˆ†åº“åˆ†è¡¨é—®é¢˜ï¼Œä½†åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œå®ƒä¼šå¸¦æ¥ä¸€äº›æ–°çš„å¤æ‚æ€§å’Œæ½œåœ¨é—®é¢˜ï¼Œä¸»è¦ä½“ç°åœ¨æ€§èƒ½ã€è¿ç»´ã€åŠŸèƒ½é™åˆ¶ç­‰æ–¹é¢ã€‚</p>\n</li>\n</ul>\n<h3 id=\"1-æ€§èƒ½ä¸å»¶è¿Ÿ\">1. æ€§èƒ½ä¸å»¶è¿Ÿ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>è·¨åº“ JOIN æ€§èƒ½å·®</strong><br>\nåˆ†åº“åˆ†è¡¨åï¼Œè·¨åº“çš„ <code>JOIN</code> æŸ¥è¯¢ä¼šåœ¨å„ä¸ªåˆ†ç‰‡ä¸Šåˆ†åˆ«æ‰§è¡Œï¼Œç„¶ååœ¨ ShardingSphere å±‚åˆå¹¶ç»“æœï¼Œæ€§èƒ½æ˜æ˜¾ä¸‹é™ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ä¾‹å¦‚ï¼šè®¢å•è¡¨åœ¨å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢è®¢å• + ç”¨æˆ·ä¿¡æ¯æ—¶å¿…é¡»è·¨åº“ JOINï¼Œæ‰§è¡Œæ•ˆç‡æ¯”å•åº“ä½å¾ˆå¤šã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p><strong>åˆ†é¡µæŸ¥è¯¢æ…¢</strong><br>\nåˆ†åº“åˆ†è¡¨åï¼Œå¦‚æœè¦å…¨å±€æ’åº + åˆ†é¡µï¼Œéœ€è¦æ‰€æœ‰åˆ†ç‰‡æŸ¥å‡ºæ•°æ®å†åˆå¹¶ï¼Œä»£ä»·éå¸¸å¤§ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è§£å†³æ–¹å¼ï¼šä½¿ç”¨åˆ†ç‰‡é”®èŒƒå›´åˆ†é¡µï¼Œæˆ–å¼•å…¥ ElasticSearch/ClickHouse åšæœç´¢å’Œç»Ÿè®¡ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p><strong>å¹¿æ’­è¡¨å‹åŠ›</strong><br>\né…ç½®äº†å¹¿æ’­è¡¨ï¼ˆæ¯ä¸ªåº“ä¸€ä»½å®Œæ•´æ•°æ®ï¼‰åï¼Œæ›´æ–°éœ€è¦åŒæ­¥æ‰€æœ‰åº“ï¼Œå†™å…¥æ€§èƒ½ä¸‹é™ã€‚</p>\n</li>\n</ul>\n<h3 id=\"2-SQL-å…¼å®¹æ€§é™åˆ¶\">2. SQL å…¼å®¹æ€§é™åˆ¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>å¤æ‚ SQL æ”¯æŒä¸å®Œæ•´</strong><br>\nShardingSphere å¯¹æŸäº›å¤æ‚ SQLï¼ˆå¦‚å­æŸ¥è¯¢ã€çª—å£å‡½æ•°ï¼‰æ”¯æŒæœ‰é™ï¼Œå¯èƒ½æŠ¥é”™æˆ–æ€§èƒ½æå·®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><strong>å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨å—é™</strong><br>\nåˆ†åº“åˆ†è¡¨åï¼Œå­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨åœ¨åˆ†ç‰‡æ•°æ®åº“æ‰§è¡Œå¯èƒ½ä¸ä¸€è‡´ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚</p>\n</li>\n</ul>\n<h3 id=\"3-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜\">3. åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere æ”¯æŒ <strong>XA åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼Œä½†æ€§èƒ½ä¸å¦‚å•æœºäº‹åŠ¡ï¼Œå‡ºç°ç½‘ç»œæŠ–åŠ¨æ—¶å¯èƒ½ä¼šå¡ä½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœä¸šåŠ¡éœ€è¦å¼ºä¸€è‡´æ€§ï¼Œå¿…é¡»ç»“åˆå¯é æ¶ˆæ¯æˆ– TCCã€SAGA ç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼ï¼Œæ¶æ„ä¼šæ›´å¤æ‚ã€‚</p>\n</li>\n</ul>\n<h3 id=\"4-è¿ç»´ä¸ç®¡ç†å¤æ‚åº¦\">4. è¿ç»´ä¸ç®¡ç†å¤æ‚åº¦</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>åˆ†ç‰‡è§„åˆ™å˜æ›´å›°éš¾</strong><br>\nä¾‹å¦‚ï¼Œæœ€åˆæŒ‰ <code>user_id % 2</code> åˆ†æˆä¸¤ä¸ªåº“ï¼Œåç»­æƒ³å¢åŠ åˆ° 4 ä¸ªåº“ï¼Œéœ€è¦è¿ç§»æ•°æ®ï¼Œéå¸¸éº»çƒ¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><strong>ç›‘æ§ä¸è°ƒä¼˜</strong><br>\nShardingSphere å¢åŠ äº†ä¸­é—´å±‚ï¼ŒSQL è·¯ç”±ã€æ‰§è¡Œè®¡åˆ’ã€æ•°æ®èŠ‚ç‚¹çŠ¶æ€éƒ½éœ€è¦é¢å¤–çš„ç›‘æ§å·¥å…·æ”¯æŒã€‚</p>\n</li>\n</ul>\n<h3 id=\"5-æˆæœ¬ä¸å­¦ä¹ æ›²çº¿\">5. æˆæœ¬ä¸å­¦ä¹ æ›²çº¿</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®ç›¸å¯¹å¤æ‚ï¼šåˆ†ç‰‡è§„åˆ™ã€è¯»å†™åˆ†ç¦»ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€å¼¹æ€§æ‰©å®¹éƒ½éœ€è¦ä»”ç»†è®¾è®¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼šå¼€å‘å’Œè¿ç»´äººå‘˜å¿…é¡»äº†è§£ ShardingSphere çš„å·¥ä½œæœºåˆ¶ï¼Œå¦åˆ™å®šä½é—®é¢˜å¾ˆå›°éš¾ã€‚</p>\n</li>\n</ul>\n<h3 id=\"6-é«˜å¯ç”¨ä¸æ‰©å±•é—®é¢˜\">6. é«˜å¯ç”¨ä¸æ‰©å±•é—®é¢˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere-JDBC æ˜¯åº”ç”¨å†…åº“ï¼Œæ— æ³•ç‹¬ç«‹æ‰©å±•ï¼Œéœ€è¦ä¾èµ–åº”ç”¨æ‰©å®¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy æ”¯æŒé›†ç¾¤ï¼Œä½†éœ€è¦è‡ªå·±æ­å»ºé«˜å¯ç”¨æ¶æ„ï¼Œæ¶‰åŠè´Ÿè½½å‡è¡¡ã€æ•…éšœåˆ‡æ¢ç­‰é—®é¢˜ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å…¶å®ƒæŠ€æœ¯æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼æ•°æ®åº“\">å…¶å®ƒæŠ€æœ¯æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼æ•°æ®åº“</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¼€æºäº§å“: æ ¸å¿ƒåŠŸèƒ½å®Œå…¨å¼€æºï¼Œä¼ä¸šç‰ˆæä¾›é¢å¤–å•†ä¸šç‰¹æ€§</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ•°æ®åº“</th>\n<th>æ¶æ„ç±»å‹</th>\n<th>SQL å…¼å®¹æ€§</th>\n<th>åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ</th>\n<th>æ•°æ®å­˜å‚¨æ¨¡å‹</th>\n<th>ä¸»è¦ç‰¹ç‚¹</th>\n<th>å…¸å‹åº”ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><a href=\"https://www.pingcap.com/\">TiDB</a></strong></td>\n<td>åˆ†å¸ƒå¼ HTAP</td>\n<td>MySQL åè®®å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆPercolator æ¨¡å‹ï¼‰</td>\n<td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td>\n<td>å¼€æºã€äº‘åŸç”Ÿã€å¼ºä¸€è‡´æ€§ã€å¼¹æ€§æ‰©å±•</td>\n<td>åœ¨çº¿äº‹åŠ¡å¤„ç† + å®æ—¶åˆ†æ</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://en.oceanbase.com/\">OceanBase</a></strong></td>\n<td>åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td>\n<td>MySQL/Oracle å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>é«˜æ€§èƒ½ã€é‡‘èçº§äº‹åŠ¡ã€é˜¿é‡Œèš‚èšé‡‘æœæ ¸å¿ƒç³»ç»Ÿä½¿ç”¨</td>\n<td>é‡‘èã€ç”µå•†ã€æ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿ</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://www.cockroachlabs.com/\">CockroachDB</a></strong></td>\n<td>åˆ†å¸ƒå¼ NewSQL</td>\n<td>PostgreSQL å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>ç±» Spanner æ¶æ„ï¼Œå…¨çƒåˆ†å¸ƒï¼Œå¼ºä¸€è‡´æ€§</td>\n<td>å…¨çƒåŒ–åˆ†å¸ƒå¼åº”ç”¨</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://www.citusdata.com/\">Citus</a> (PostgreSQL)</strong></td>\n<td>PostgreSQL æ‰©å±•</td>\n<td>PostgreSQL å…¼å®¹</td>\n<td>éƒ¨åˆ†æ”¯æŒï¼ˆåŸºäºé€»è¾‘åˆ†ç‰‡ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>åŸºäº PostgreSQL çš„åˆ†å¸ƒå¼æ‰©å±•ï¼Œæ”¯æŒå¤§è§„æ¨¡ OLAP</td>\n<td>å¤§æ•°æ®å®æ—¶åˆ†æã€BI åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://vitess.io/\">Vitess</a></strong></td>\n<td>åˆ†å¸ƒå¼ä¸­é—´ä»¶ + å­˜å‚¨</td>\n<td>MySQL åè®®å…¼å®¹</td>\n<td>å¼±äº‹åŠ¡ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>YouTube å¼€æºï¼ŒK8s å‹å¥½ï¼Œåˆ†åº“åˆ†è¡¨è‡ªåŠ¨åŒ–</td>\n<td>å¤§è§„æ¨¡ Web åº”ç”¨ï¼Œåœ¨çº¿æœåŠ¡</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://www.yugabyte.com/\">YugabyteDB</a></strong></td>\n<td>åˆ†å¸ƒå¼ SQL + NoSQL</td>\n<td>PostgreSQL å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</td>\n<td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td>\n<td>èåˆ NewSQL å’Œ NoSQLï¼Œå¼ºä¸€è‡´æ€§ï¼Œè·¨åŒºåŸŸéƒ¨ç½²</td>\n<td>é‡‘èçº§äº‹åŠ¡ + åˆ†ææ··åˆåœºæ™¯</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å•†ä¸šäº§å“</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ•°æ®åº“</th>\n<th>æ¶æ„ç±»å‹</th>\n<th>SQL å…¼å®¹æ€§</th>\n<th>åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ</th>\n<th>æ•°æ®å­˜å‚¨æ¨¡å‹</th>\n<th>ä¸»è¦ç‰¹ç‚¹</th>\n<th>å…¸å‹åº”ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><a href=\"https://www.alibabacloud.com/product/polardb\">PolarDB</a></strong></td>\n<td>äº‘åŸç”Ÿåˆ†å¸ƒå¼æ•°æ®åº“</td>\n<td>MySQL/PostgreSQL å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆäº‘ç«¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>é˜¿é‡Œäº‘äº§å“ï¼Œå¼¹æ€§æ‰©å®¹ï¼Œå­˜å‚¨è®¡ç®—åˆ†ç¦»</td>\n<td>äº‘ä¸Šä¼ä¸šæ•°æ®åº“è§£å†³æ–¹æ¡ˆ</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://www.huaweicloud.com/product/gaussdb.html\">GaussDB</a></strong></td>\n<td>åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td>\n<td>MySQL/Oracle å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td>\n<td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td>\n<td>åä¸ºæ¨å‡ºï¼Œåˆ†å¸ƒå¼ HTAPï¼Œäº‘åŸç”Ÿæ¶æ„</td>\n<td>ä¼ä¸šçº§ OLTP + OLAP æ··åˆè´Ÿè½½</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://cloud.google.com/spanner\">Spanner</a></strong></td>\n<td>å…¨çƒåˆ†å¸ƒå¼æ•°æ®åº“</td>\n<td>ç±» SQL</td>\n<td>æ”¯æŒï¼ˆTrueTime åè®®ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>Google äº‘äº§å“ï¼Œå…¨çƒåˆ†å¸ƒå¼å¼ºä¸€è‡´äº‹åŠ¡</td>\n<td>å…¨çƒåŒ–åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé‡‘èåœºæ™¯</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://aws.amazon.com/rds/aurora/\">Amazon Aurora</a></strong></td>\n<td>äº‘åŸç”Ÿåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td>\n<td>MySQL/PostgreSQL å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆå•å®ä¾‹äº‹åŠ¡ï¼Œå¤š AZ é«˜å¯ç”¨ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>AWS æ‰˜ç®¡ï¼Œè‡ªåŠ¨æ‰©å±•å­˜å‚¨ï¼Œå¤šå¯ç”¨åŒºé«˜å¯ç”¨</td>\n<td>OLTPã€ä¼ä¸šçº§ä¸šåŠ¡</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡åœ¨ SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨ çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚ è¿è¡Œæ¨¡å¼è¯´æ˜ è¿è¡Œæ¨¡å¼ ShardingSphere-Proxy è¿è¡Œæ¨¡å¼åˆ†ä¸ºä¸¤ç§ï¼šå•æœºæ¨¡å¼(Standalone) å’Œ é›†ç¾¤æ¨¡å¼(Cluster)ã€‚ è¿è¡Œæ¨¡å¼å°±æ˜¯æŒ‡å®šå°†å…ƒæ•°æ®(è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ç­‰)æŒä¹…åŒ–çš„å­˜å‚¨æ–¹å¼ã€‚ é»˜è®¤è¿è¡Œæ¨¡å¼ä¸ºå•æœºæ¨¡å¼ï¼Œä½¿ç”¨H2çš„å†…å­˜æ–¹å¼ã€‚ å•æœºæ¨¡å¼(Standalone) å•æœºæ¨¡å¼èƒ½å¤Ÿå°†æ•°æ®æºå’Œè§„åˆ™ç­‰å…ƒæ•°æ®ä¿¡æ¯æŒä¹…åŒ–ï¼Œä½†æ— æ³•å°†å…ƒæ•°æ®åŒæ­¥è‡³å¤šä¸ª Apache ShardingSphere å®ä¾‹ï¼Œæ— æ³•åœ¨é›†ç¾¤ç¯å¢ƒä¸­ç›¸äº’æ„ŸçŸ¥ã€‚ é€šè¿‡æŸä¸€å®ä¾‹æ›´æ–°å…ƒæ•°æ®ä¹‹åï¼Œä¼šå¯¼è‡´å…¶ä»–å®ä¾‹ç”±äºè·å–ä¸åˆ°æœ€æ–°çš„å…ƒæ•°æ®è€Œäº§ç”Ÿä¸ä¸€è‡´çš„é”™è¯¯ã€‚ é€‚ç”¨äºå·¥ç¨‹å¸ˆåœ¨æœ¬åœ°æ­å»º Apache ShardingSphere ç¯å¢ƒã€‚ å•æœºæ¨¡å¼ç›®å‰ä»…æ”¯æŒä¸€ç§ï¼šJDBCï¼Œå³æ•°æ®åº“æŒä¹…åŒ–ã€‚ä»¥ä¸‹ä¸ºé»˜è®¤å€¼(JDBCRepositoryPropertyKey)ã€‚ åç§° æ•°æ®ç±»å‹ è¯´æ˜ é»˜è®¤å€¼ provider String å…ƒæ•°æ®å­˜å‚¨ç±»å‹ï¼Œå¯é€‰å€¼ä¸º H2ã€MySQL ã€EmbeddedDerbyã€DerbyNetworkServerã€HSQLDB H2 jdbc_url String JDBC URL jdbc:h2:mem:config;DB_CLOSE_DELAY=0;DATABASE_TO_UPPER=false;MODE=MYSQL username String è´¦å· sa password String å¯†ç  ç©ºï¼ˆæ— é»˜è®¤å€¼ï¼‰ è¿™é‡Œä»¥ Mysql å­˜å‚¨å…ƒæ•°æ®ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒå®˜ç½‘è¯´æ˜ 123456789mode: type: Standalone repository: type: JDBC props: provider: MySQL jdbc_url: jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd æ­¤æ—¶éœ€è¦å°† mysql çš„é©±åŠ¨ jar åŒ… æ·»åŠ åˆ° ext-lib ç›®å½•ä¸‹ å¯åŠ¨ ShardingSphere Proxy æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ä¸Šé¢çš„æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¼ è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„ä¸­çš„å…ƒæ•°æ®å­˜å‚¨è¿›å» 1234567CREATE TABLE `repository` ( `id` varchar(36) COLLATE utf8mb4_bin NOT NULL, `key` text COLLATE utf8mb4_bin, `value` text COLLATE utf8mb4_bin, `parent` text COLLATE utf8mb4_bin, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin; é‡ç‚¹è¯´æ˜ å½“æ•°æ®åº“ä¸­ä¸å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¯¥è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„å…ƒæ•°æ®æ’å…¥è¯¥è¡¨ä¸­ã€‚ å½“æ•°æ®åº“ä¸­å·²å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè¯»å–è¯¥è¡¨ä¸­çš„æ•°æ®å¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ï¼Œè€Œä¸ä¼šè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚å³æ­¤æ—¶é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ä¸ä¼šç”Ÿæ•ˆã€‚ è‹¥æ­¤æ—¶æƒ³ä¿®æ”¹é…ç½®è§„åˆ™ï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š 1.åˆ é™¤è¯¥è¡¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åé‡æ–°å¯åŠ¨Proxyï¼Œæ­¤æ—¶ä¼šé‡æ–°åˆ›å»ºè¯¥è¡¨å¹¶åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚ 2.æ‰‹å·¥ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„å…ƒæ•°æ®ï¼Œä½†ä¿®æ”¹åéœ€è¦é‡æ–°å¯åŠ¨Proxyæ‰ä¼šåŠ è½½æ–°çš„å…ƒæ•°æ®ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚ 3.[æ¨è]ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ DistSQL åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œä¿®æ”¹åçš„é…ç½®ä¼šè¢«ä¿å­˜åœ¨è¯¥è¡¨ä¸­ï¼Œå¹¶ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯Proxyã€‚ å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒå¯ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤çš„ H2 å†…å­˜æ•°æ®åº“ï¼Œç”Ÿäº§ç¯å¢ƒå¯ä»¥ä½¿ç”¨ MySQLç­‰æ•°æ®åº“å¯¹å…ƒæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„é›†ç¾¤æ¨¡å¼ã€‚ é›†ç¾¤æ¨¡å¼(Cluster) é›†ç¾¤æ¨¡å¼æä¾›äº†å¤šä¸ª Apache ShardingSphere å®ä¾‹ä¹‹é—´çš„å…ƒæ•°æ®å…±äº«å’Œåˆ†å¸ƒå¼åœºæ™¯ä¸‹çŠ¶æ€åè°ƒçš„èƒ½åŠ›ã€‚ å®ƒèƒ½å¤Ÿæä¾›è®¡ç®—èƒ½åŠ›æ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨ç­‰åˆ†å¸ƒå¼ç³»ç»Ÿå¿…å¤‡çš„èƒ½åŠ›ï¼Œé›†ç¾¤ç¯å¢ƒéœ€è¦é€šè¿‡ç‹¬ç«‹éƒ¨ç½²çš„æ³¨å†Œä¸­å¿ƒæ¥å­˜å‚¨å…ƒæ•°æ®å’Œåè°ƒèŠ‚ç‚¹çŠ¶æ€ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨é›†ç¾¤æ¨¡å¼ã€‚ è¿™é‡Œä»¥ zookeeper é›†ç¾¤æ¨¡å¼ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒå®˜ç½‘è¯´æ˜ 1234567891011mode: type: Cluster # è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone repository: type: ZooKeeper # æ³¨å†Œä¸­å¿ƒç±»å‹ï¼Œå½“å‰ç‰ˆæœ¬ä»…æ”¯æŒ ZooKeeper å’Œ etcd props: namespace: governance_ds # ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹ server-lists: localhost:2181 # ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨ retryIntervalMilliseconds: 500 # ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚ timeToLiveSeconds: 60 # è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥ maxRetries: 3 # æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚ operationTimeoutMilliseconds: 500 # å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚ é‡ç‚¹è¯´æ˜ ä¸è¦æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­çš„ namespace ä¸‹çš„é…ç½®ä¿¡æ¯! æ—¢ç„¶æ˜¯é›†ç¾¤ï¼Œå°±éœ€è¦å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ã€‚ å½“ç¬¬ä¸€ä¸ª ShardingSphere-Proxy å®ä¾‹ å¯åŠ¨åï¼Œå…¶å®ƒç›¸åŒé…ç½®çš„ ShardingSphere-Proxy å®ä¾‹ä»…éœ€è¦ä¸€ä¸ª global.yaml å…¨å±€é…ç½®æ–‡ä»¶å³å¯ï¼Œå¹¶ä»…éœ€åœ¨å…¶ä¸­é…ç½®ä¸Šé¢çš„è¿è¡Œæ¨¡å¼ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å†é…ç½®å…¶å®ƒé…ç½®ï¼Œæ¯”å¦‚è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šé€šè¿‡ Zookeeper é›†ç¾¤ä¸­çš„ namespace è·å–å¹¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ä¸­ã€‚ æ¯ä¸ª ShardingSphere-Proxy å®ä¾‹å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨å°†è‡ªå·±æ³¨å†Œåˆ° Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹ï¼Œå¹¶è‡ªåŠ¨è·å–è¯¥ namespace ä¸‹çš„é…ç½®ä¿¡æ¯ã€‚ å½“ Zookeeper é›†ç¾¤ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶ç¬¬ä¸€æ¬¡å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨åœ¨ Zookeeper ä¸­åˆ›å»º namespaceï¼Œå¹¶å†™å…¥é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯åˆ° Zookeeper ä¸­ã€‚ å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶å†å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨ä» Zookeeper ä¸­è¯»å– namespace ä¸‹çš„é…ç½®ä¿¡æ¯ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä¸ä¼šå†è¯»å–æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚ å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ ¹æ®ä¸Šé¢çš„è§„åˆ™ï¼Œæ­¤æ—¶ä¿®æ”¹æœ¬åœ°çš„é…ç½®æ–‡ä»¶ä¸­çš„åˆ†ç‰‡è§„åˆ™åé‡å¯ShardingSphere-Proxy å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚ æ­¤æ—¶æœ‰ä¸‰ç§æ–¹æ³•ï¼š åˆ é™¤ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespaceï¼Œç„¶åé‡å¯ ShardingSphere-Proxyã€‚è¿™ç§æ–¹æ³•æœ‰ä¸ªå¼Šç«¯ï¼Œå³ä¼šå¯¼è‡´è¿æ¥åˆ°ç›¸åŒ ZooKeeper é›†ç¾¤çš„ namespace çš„å…¶å®ƒ ShardingSphere-Proxy å®ä¾‹æ•°æ®ä¸¢å¤±(å®Œå…¨ä¸å¯ç”¨)ï¼Œä¹Ÿéœ€è¦é‡å¯æ‰èƒ½é‡æ–°è·å–åˆ°æ•°æ®ã€‚ æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹çš„åˆ†ç‰‡è§„åˆ™ï¼Œä¿®æ”¹åä¼šç«‹å³åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚ [æ¨è]ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ DistSQL åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚æ‰€ä»¥ï¼Œçµæ´»æŒæ¡ DistSQL æ˜¯ç»´æŠ¤ ShardingSphere-Proxy é›†ç¾¤çš„å…³é”®ã€‚ å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ å¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡å™¨ï¼Œæ¯”å¦‚ Nginxï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„ ShardingSphere-Proxy å®ä¾‹ã€‚æ¯”å¦‚ï¼š 123456789101112stream&#123; upstream shardingsphere_proxy&#123; server 10.10.21.35:3307; server 10.10.21.36:3307; &#125; server&#123; listen 3310; proxy_connect_timeout 20s; proxy_timeout 5m; proxy_pass shardingsphere_proxy; &#125;&#125; ä¸ Spring Boot3 æ•´åˆ æ— è®ºæ˜¯ å•æœºæ¨¡å¼ è¿˜æ˜¯ é›†ç¾¤æ¨¡å¼ï¼Œå…¶ç›®çš„éƒ½æ˜¯å°† é…ç½® ä¿å­˜åˆ°ç‹¬ç«‹çš„ é…ç½®ä¸­å¿ƒ(æ•°æ®åº“ æˆ– Zookeeper)ä¸­ï¼Œå¹¶è®©å…¶å®ƒ ShardingSphere-Proxy å®ä¾‹ä»è¯¥é…ç½®ä¸­å¿ƒä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚ å‰æ–‡æˆ‘ä»¬ä»‹ç»è¿‡ Spring Boot3 + ShardingSphere-Proxy å°±ç›¸å½“äºæ˜¯é›†æˆæ™®é€šçš„MySqlæ•°æ®åº“ï¼Œè€Œ Spring Boot3 + ShardingSphere-JDBC å°±éœ€è¦å•ç‹¬åœ¨æœ¬åœ°é…ç½®å„ç§è§„åˆ™ã€‚ å®é™…ä¸Š ShardingSphere-JDBC ä¹Ÿå¯ä»¥ä» é…ç½®ä¸­å¿ƒ ä¸­è¯»å–é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦åœ¨æœ¬åœ°é…ç½®ä»»ä½•è§„åˆ™äº†ï¼Œæˆ‘ä»¬ä»…éœ€è¦åœ¨ sharding.yaml ä¸­é…ç½®å¥½è¿è¡Œæ¨¡å¼ï¼Œå¹¶é…ç½®å¥½ databaseName çš„åç§°å³å¯ã€‚æ³¨æ„ï¼Œæ­¤æ—¶é…ç½®ä¸­å¿ƒçš„çš„äº‹åŠ¡ä¸èƒ½æ˜¯ XAï¼Œå› ä¸ºSpring Boot3 + ShardingSphere-JDBCç›®å‰ä¸æ”¯æŒ XA äº‹åŠ¡ã€‚ æ­¤æ—¶ï¼Œspringbooté¡¹ç›®å¯åŠ¨åä¼šæ‹‰å–é…ç½®ä¸­å¿ƒä¸­çš„é…ç½®ä¿¡æ¯å¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„å…¶å®ƒé…ç½®ä¿¡æ¯ä¼šè¢«å¿½ç•¥ã€‚ å•æœºæ¨¡å¼ ä»£ç ç¤ºä¾‹ é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œå¿…é¡»é‡å¯åº”ç”¨æ‰èƒ½ç”Ÿæ•ˆ sharding.yaml 1234567891011mode: type: Standalone repository: type: JDBC props: provider: MySQL jdbc_url: jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd# æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_dbdatabaseName: sharding_db Maven ä¾èµ– 123456789101112131415161718192021222324&lt;!-- MySQL Connector/J --&gt;&lt;dependency&gt; &lt;groupId&gt;com.mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-spring-boot3-starter&lt;/artifactId&gt; &lt;version&gt;3.5.12&lt;/version&gt;&lt;/dependency&gt;&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;shardingsphere-jdbc&lt;/artifactId&gt; &lt;version&gt;5.5.2&lt;/version&gt;&lt;/dependency&gt;&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;&lt;dependency&gt; &lt;groupId&gt;com.hanqf&lt;/groupId&gt; &lt;artifactId&gt;algorithm-swapper&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;/dependency&gt; é›†ç¾¤æ¨¡å¼ ä»£ç ç¤ºä¾‹ é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œç«‹å³æ¨é€åˆ°æ‰€æœ‰å®ä¾‹ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚ sharding.yamlï¼Œæ³¨æ„è¿™é‡Œä¸€å®šè¦é…ç½® databaseName 1234567891011121314# # å¼€å¯é›†ç¾¤æ¨¡å¼mode: type: Cluster # è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone repository: type: ZooKeeper # æ³¨å†Œä¸­å¿ƒç±»å‹ props: namespace: governance_ds # ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹ server-lists: localhost:2181 # ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨ retryIntervalMilliseconds: 500 # ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚ timeToLiveSeconds: 60 # è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥ maxRetries: 3 # æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚ operationTimeoutMilliseconds: 500 # å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚# æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_dbdatabaseName: sharding_db Maven ä¾èµ–ï¼Œæ³¨æ„è¦åŠ ä¸Š shardingsphere-cluster-mode-repository-zookeeper çš„ä¾èµ– 123456789101112131415161718192021222324252627282930&lt;!-- MySQL Connector/J --&gt;&lt;dependency&gt; &lt;groupId&gt;com.mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-spring-boot3-starter&lt;/artifactId&gt; &lt;version&gt;3.5.12&lt;/version&gt;&lt;/dependency&gt;&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;shardingsphere-jdbc&lt;/artifactId&gt; &lt;version&gt;5.5.2&lt;/version&gt;&lt;/dependency&gt;&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;&lt;dependency&gt; &lt;groupId&gt;com.hanqf&lt;/groupId&gt; &lt;artifactId&gt;algorithm-swapper&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- shardingsphere-cluster-mode-repository-zookeeper --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;shardingsphere-cluster-mode-repository-zookeeper&lt;/artifactId&gt; &lt;version&gt;5.5.2&lt;/version&gt;&lt;/dependency&gt; å¦‚ä½•é€‰æ‹© å½“æˆ‘ä½¿ç”¨springboot3+shardingSphere-JDBC5.5.2æ—¶ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨æœ¬åœ°é…ç½®æ–‡ä»¶çš„æ–¹å¼è¿˜æ˜¯ä½¿ç”¨é…ç½®ä¸­å¿ƒï¼ˆæ¯”å¦‚ï¼šzookeeperï¼‰çš„æ–¹å¼å‘¢ï¼Ÿ æ–¹å¼ éƒ¨ç½²å¤æ‚åº¦ é…ç½®åŠ¨æ€æ›´æ–° å¤šå®ä¾‹å…±äº«é…ç½® çƒ­æ›´æ–°æ”¯æŒ é€‚ç”¨ç¯å¢ƒ æœ¬åœ°é…ç½®æ–‡ä»¶ ç®€å• ä¸æ”¯æŒ ä¸æ”¯æŒ å¦ å¼€å‘/æµ‹è¯•/å°å‹é¡¹ç›® é…ç½®ä¸­å¿ƒï¼ˆZooKeeper/etcdï¼‰ ç•¥é«˜ æ”¯æŒ æ”¯æŒ æ˜¯ ç”Ÿäº§/åˆ†å¸ƒå¼ç¯å¢ƒ æ³¨æ„ DistSQL ç›®å‰ç¡®å®åªæ”¯æŒåœ¨ ShardingSphere-Proxy ä¸Šæ‰§è¡Œï¼Œå¹¶ä¸” Proxy åªæ”¯æŒ MySQL å’Œ PostgreSQL åè®®ã€‚ å¦‚æœä½ åœ¨ Spring Boot + ShardingSphere-JDBC é‡Œç”¨ å…¶å®ƒæ•°æ®åº“ï¼ˆæ¯”å¦‚ SQL Serverã€Oracleã€DB2 ç­‰ï¼‰ï¼Œå°±æ— æ³•ç›´æ¥é€šè¿‡ DistSQL å»åŠ¨æ€æ”¹é…ç½®ã€‚ æ­¤æ—¶ä½ å¯ä»¥é€‰æ‹©é€šè¿‡ Zookeeper çš„å®¢æˆ·ç«¯ç›´æ¥ä¿®æ”¹æˆ–é…ç½®è§„åˆ™ï¼Œä¹Ÿå¯ä»¥ä¸é€‰æ‹© é…ç½®ä¸­å¿ƒ çš„æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨ æœ¬åœ°é…ç½®æ–‡ä»¶ã€‚ ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†åº“åˆ†è¡¨ åˆ†åº“åˆ†è¡¨çš„ä¸»è¦ç›®çš„æ˜¯ è§£å†³æ•°æ®é‡å¤§å¸¦æ¥çš„æ€§èƒ½ã€å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§é—®é¢˜ã€‚é€šå¸¸éœ€è¦è€ƒè™‘çš„å‡ ä¸ªå…³é”®æŒ‡æ ‡ï¼š 1. æ•°æ®é‡æŒ‡æ ‡ å•è¡¨æ•°æ®é‡è¿‡å¤§ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå•è¡¨æ•°æ®é‡åœ¨ åƒä¸‡çº§ ä»¥ä¸Šæ—¶ï¼ŒæŸ¥è¯¢ã€å†™å…¥å’Œç´¢å¼•çš„æ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ã€‚ ä¾‹å¦‚ï¼šä¸€ä¸ªè®¢å•è¡¨ä¸€å¤©æœ‰ä¸Šç™¾ä¸‡æ¡æ•°æ®ï¼Œä¸€å¹´ä¸‹æ¥å¯èƒ½æœ‰ä¸Šäº¿æ¡ï¼Œå•è¡¨æ€§èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚ 2. è®¿é—®é‡æŒ‡æ ‡ é«˜å¹¶å‘å†™å…¥æˆ–æŸ¥è¯¢ï¼šæ•°æ®åº“è¿æ¥ã€äº‹åŠ¡é”ã€IO ç­‰èµ„æºä¼šæˆä¸ºç“¶é¢ˆã€‚ å¦‚æœä½ çš„ç³»ç»Ÿæ¯å¤©æœ‰ä¸Šåƒä¸‡çš„è¯·æ±‚ï¼Œæ•°æ®åº“å¯èƒ½æ— æ³•æ‰¿å—ã€‚ 3. ä¸šåŠ¡éš”ç¦»éœ€æ±‚ ä¸åŒä¸šåŠ¡çš„æ•°æ®åˆ†ç¦»ï¼Œé¿å…å•ä¸ªä¸šåŠ¡å½±å“æ•´ä¸ªæ•°æ®åº“çš„ç¨³å®šæ€§ã€‚ ä¾‹å¦‚ï¼šç”µå•†ç³»ç»Ÿä¸­çš„è®¢å•å’Œæ—¥å¿—æ•°æ®ï¼Œæ—¥å¿—é‡éå¸¸å¤§ï¼Œå’Œè®¢å•åˆ†å¼€å­˜å‚¨æ›´åˆç†ã€‚ 4. è¿è¥ä¸æˆæœ¬å› ç´  åˆ†åº“åˆ†è¡¨åï¼Œå¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸Šï¼Œæ”¯æŒ æ°´å¹³æ‰©å±•ï¼Œè€Œä¸å¿…ä¾èµ–æ˜‚è´µçš„å•æœºæ•°æ®åº“ã€‚ ä½¿ç”¨ ShardingSphere å¯èƒ½å¸¦æ¥çš„é—®é¢˜ ä½¿ç”¨ ShardingSphere å¯ä»¥æ–¹ä¾¿åœ°è§£å†³åˆ†åº“åˆ†è¡¨é—®é¢˜ï¼Œä½†åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œå®ƒä¼šå¸¦æ¥ä¸€äº›æ–°çš„å¤æ‚æ€§å’Œæ½œåœ¨é—®é¢˜ï¼Œä¸»è¦ä½“ç°åœ¨æ€§èƒ½ã€è¿ç»´ã€åŠŸèƒ½é™åˆ¶ç­‰æ–¹é¢ã€‚ 1. æ€§èƒ½ä¸å»¶è¿Ÿ è·¨åº“ JOIN æ€§èƒ½å·® åˆ†åº“åˆ†è¡¨åï¼Œè·¨åº“çš„ JOIN æŸ¥è¯¢ä¼šåœ¨å„ä¸ªåˆ†ç‰‡ä¸Šåˆ†åˆ«æ‰§è¡Œï¼Œç„¶ååœ¨ ShardingSphere å±‚åˆå¹¶ç»“æœï¼Œæ€§èƒ½æ˜æ˜¾ä¸‹é™ã€‚ ä¾‹å¦‚ï¼šè®¢å•è¡¨åœ¨å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢è®¢å• + ç”¨æˆ·ä¿¡æ¯æ—¶å¿…é¡»è·¨åº“ JOINï¼Œæ‰§è¡Œæ•ˆç‡æ¯”å•åº“ä½å¾ˆå¤šã€‚ åˆ†é¡µæŸ¥è¯¢æ…¢ åˆ†åº“åˆ†è¡¨åï¼Œå¦‚æœè¦å…¨å±€æ’åº + åˆ†é¡µï¼Œéœ€è¦æ‰€æœ‰åˆ†ç‰‡æŸ¥å‡ºæ•°æ®å†åˆå¹¶ï¼Œä»£ä»·éå¸¸å¤§ã€‚ è§£å†³æ–¹å¼ï¼šä½¿ç”¨åˆ†ç‰‡é”®èŒƒå›´åˆ†é¡µï¼Œæˆ–å¼•å…¥ ElasticSearch/ClickHouse åšæœç´¢å’Œç»Ÿè®¡ã€‚ å¹¿æ’­è¡¨å‹åŠ› é…ç½®äº†å¹¿æ’­è¡¨ï¼ˆæ¯ä¸ªåº“ä¸€ä»½å®Œæ•´æ•°æ®ï¼‰åï¼Œæ›´æ–°éœ€è¦åŒæ­¥æ‰€æœ‰åº“ï¼Œå†™å…¥æ€§èƒ½ä¸‹é™ã€‚ 2. SQL å…¼å®¹æ€§é™åˆ¶ å¤æ‚ SQL æ”¯æŒä¸å®Œæ•´ ShardingSphere å¯¹æŸäº›å¤æ‚ SQLï¼ˆå¦‚å­æŸ¥è¯¢ã€çª—å£å‡½æ•°ï¼‰æ”¯æŒæœ‰é™ï¼Œå¯èƒ½æŠ¥é”™æˆ–æ€§èƒ½æå·®ã€‚ å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨å—é™ åˆ†åº“åˆ†è¡¨åï¼Œå­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨åœ¨åˆ†ç‰‡æ•°æ®åº“æ‰§è¡Œå¯èƒ½ä¸ä¸€è‡´ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚ 3. åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ ShardingSphere æ”¯æŒ XA åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†æ€§èƒ½ä¸å¦‚å•æœºäº‹åŠ¡ï¼Œå‡ºç°ç½‘ç»œæŠ–åŠ¨æ—¶å¯èƒ½ä¼šå¡ä½ã€‚ å¦‚æœä¸šåŠ¡éœ€è¦å¼ºä¸€è‡´æ€§ï¼Œå¿…é¡»ç»“åˆå¯é æ¶ˆæ¯æˆ– TCCã€SAGA ç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼ï¼Œæ¶æ„ä¼šæ›´å¤æ‚ã€‚ 4. è¿ç»´ä¸ç®¡ç†å¤æ‚åº¦ åˆ†ç‰‡è§„åˆ™å˜æ›´å›°éš¾ ä¾‹å¦‚ï¼Œæœ€åˆæŒ‰ user_id % 2 åˆ†æˆä¸¤ä¸ªåº“ï¼Œåç»­æƒ³å¢åŠ åˆ° 4 ä¸ªåº“ï¼Œéœ€è¦è¿ç§»æ•°æ®ï¼Œéå¸¸éº»çƒ¦ã€‚ ç›‘æ§ä¸è°ƒä¼˜ ShardingSphere å¢åŠ äº†ä¸­é—´å±‚ï¼ŒSQL è·¯ç”±ã€æ‰§è¡Œè®¡åˆ’ã€æ•°æ®èŠ‚ç‚¹çŠ¶æ€éƒ½éœ€è¦é¢å¤–çš„ç›‘æ§å·¥å…·æ”¯æŒã€‚ 5. æˆæœ¬ä¸å­¦ä¹ æ›²çº¿ é…ç½®ç›¸å¯¹å¤æ‚ï¼šåˆ†ç‰‡è§„åˆ™ã€è¯»å†™åˆ†ç¦»ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€å¼¹æ€§æ‰©å®¹éƒ½éœ€è¦ä»”ç»†è®¾è®¡ã€‚ å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼šå¼€å‘å’Œè¿ç»´äººå‘˜å¿…é¡»äº†è§£ ShardingSphere çš„å·¥ä½œæœºåˆ¶ï¼Œå¦åˆ™å®šä½é—®é¢˜å¾ˆå›°éš¾ã€‚ 6. é«˜å¯ç”¨ä¸æ‰©å±•é—®é¢˜ ShardingSphere-JDBC æ˜¯åº”ç”¨å†…åº“ï¼Œæ— æ³•ç‹¬ç«‹æ‰©å±•ï¼Œéœ€è¦ä¾èµ–åº”ç”¨æ‰©å®¹ã€‚ ShardingSphere-Proxy æ”¯æŒé›†ç¾¤ï¼Œä½†éœ€è¦è‡ªå·±æ­å»ºé«˜å¯ç”¨æ¶æ„ï¼Œæ¶‰åŠè´Ÿè½½å‡è¡¡ã€æ•…éšœåˆ‡æ¢ç­‰é—®é¢˜ã€‚ å…¶å®ƒæŠ€æœ¯æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼æ•°æ®åº“ å¼€æºäº§å“: æ ¸å¿ƒåŠŸèƒ½å®Œå…¨å¼€æºï¼Œä¼ä¸šç‰ˆæä¾›é¢å¤–å•†ä¸šç‰¹æ€§ æ•°æ®åº“ æ¶æ„ç±»å‹ SQL å…¼å®¹æ€§ åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ æ•°æ®å­˜å‚¨æ¨¡å‹ ä¸»è¦ç‰¹ç‚¹ å…¸å‹åº”ç”¨åœºæ™¯ TiDB åˆ†å¸ƒå¼ HTAP MySQL åè®®å…¼å®¹ æ”¯æŒï¼ˆPercolator æ¨¡å‹ï¼‰ è¡Œå­˜ + åˆ—å­˜æ··åˆ å¼€æºã€äº‘åŸç”Ÿã€å¼ºä¸€è‡´æ€§ã€å¼¹æ€§æ‰©å±• åœ¨çº¿äº‹åŠ¡å¤„ç† + å®æ—¶åˆ†æ OceanBase åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ MySQL/Oracle å…¼å®¹ æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰ è¡Œå­˜ é«˜æ€§èƒ½ã€é‡‘èçº§äº‹åŠ¡ã€é˜¿é‡Œèš‚èšé‡‘æœæ ¸å¿ƒç³»ç»Ÿä½¿ç”¨ é‡‘èã€ç”µå•†ã€æ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿ CockroachDB åˆ†å¸ƒå¼ NewSQL PostgreSQL å…¼å®¹ æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ è¡Œå­˜ ç±» Spanner æ¶æ„ï¼Œå…¨çƒåˆ†å¸ƒï¼Œå¼ºä¸€è‡´æ€§ å…¨çƒåŒ–åˆ†å¸ƒå¼åº”ç”¨ Citus (PostgreSQL) PostgreSQL æ‰©å±• PostgreSQL å…¼å®¹ éƒ¨åˆ†æ”¯æŒï¼ˆåŸºäºé€»è¾‘åˆ†ç‰‡ï¼‰ è¡Œå­˜ åŸºäº PostgreSQL çš„åˆ†å¸ƒå¼æ‰©å±•ï¼Œæ”¯æŒå¤§è§„æ¨¡ OLAP å¤§æ•°æ®å®æ—¶åˆ†æã€BI åœºæ™¯ Vitess åˆ†å¸ƒå¼ä¸­é—´ä»¶ + å­˜å‚¨ MySQL åè®®å…¼å®¹ å¼±äº‹åŠ¡ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ è¡Œå­˜ YouTube å¼€æºï¼ŒK8s å‹å¥½ï¼Œåˆ†åº“åˆ†è¡¨è‡ªåŠ¨åŒ– å¤§è§„æ¨¡ Web åº”ç”¨ï¼Œåœ¨çº¿æœåŠ¡ YugabyteDB åˆ†å¸ƒå¼ SQL + NoSQL PostgreSQL å…¼å®¹ æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰ è¡Œå­˜ + åˆ—å­˜æ··åˆ èåˆ NewSQL å’Œ NoSQLï¼Œå¼ºä¸€è‡´æ€§ï¼Œè·¨åŒºåŸŸéƒ¨ç½² é‡‘èçº§äº‹åŠ¡ + åˆ†ææ··åˆåœºæ™¯ å•†ä¸šäº§å“ æ•°æ®åº“ æ¶æ„ç±»å‹ SQL å…¼å®¹æ€§ åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ æ•°æ®å­˜å‚¨æ¨¡å‹ ä¸»è¦ç‰¹ç‚¹ å…¸å‹åº”ç”¨åœºæ™¯ PolarDB äº‘åŸç”Ÿåˆ†å¸ƒå¼æ•°æ®åº“ MySQL/PostgreSQL å…¼å®¹ æ”¯æŒï¼ˆäº‘ç«¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ è¡Œå­˜ é˜¿é‡Œäº‘äº§å“ï¼Œå¼¹æ€§æ‰©å®¹ï¼Œå­˜å‚¨è®¡ç®—åˆ†ç¦» äº‘ä¸Šä¼ä¸šæ•°æ®åº“è§£å†³æ–¹æ¡ˆ GaussDB åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ MySQL/Oracle å…¼å®¹ æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ è¡Œå­˜ + åˆ—å­˜æ··åˆ åä¸ºæ¨å‡ºï¼Œåˆ†å¸ƒå¼ HTAPï¼Œäº‘åŸç”Ÿæ¶æ„ ä¼ä¸šçº§ OLTP + OLAP æ··åˆè´Ÿè½½ Spanner å…¨çƒåˆ†å¸ƒå¼æ•°æ®åº“ ç±» SQL æ”¯æŒï¼ˆTrueTime åè®®ï¼‰ è¡Œå­˜ Google äº‘äº§å“ï¼Œå…¨çƒåˆ†å¸ƒå¼å¼ºä¸€è‡´äº‹åŠ¡ å…¨çƒåŒ–åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé‡‘èåœºæ™¯ Amazon Aurora äº‘åŸç”Ÿåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ MySQL/PostgreSQL å…¼å®¹ æ”¯æŒï¼ˆå•å®ä¾‹äº‹åŠ¡ï¼Œå¤š AZ é«˜å¯ç”¨ï¼‰ è¡Œå­˜ AWS æ‰˜ç®¡ï¼Œè‡ªåŠ¨æ‰©å±•å­˜å‚¨ï¼Œå¤šå¯ç”¨åŒºé«˜å¯ç”¨ OLTPã€ä¼ä¸šçº§ä¸šåŠ¡","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡åœ¨ SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨ çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚","date_published":"2025-09-10T13:30:05.000Z","tags":["æŠ€æœ¯","springboot","sharding-sphere","springboot","sharding-sphere"]},{"id":"https://blog.hanqunfeng.com/2025/09/08/maven-nexus-upgrade/","url":"https://blog.hanqunfeng.com/2025/09/08/maven-nexus-upgrade/","title":"Maven ç§æœ Nexus å‡çº§å®å½•","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Mavne ç§æœ Nexus å‡çº§çš„å…¨è¿‡ç¨‹ï¼Œä» <code>3.29.2-02</code> å‡çº§åˆ° <code>3.83.2-01</code></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://help.sonatype.com/en/sonatype-nexus-repository.html\">Nexuså®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mirrors.tuna.tsinghua.edu.cn/Adoptium/\">OpenJdkä¸‹è½½åœ°å€</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://help.sonatype.com/en/sonatype-nexus-repository-system-requirements.html\">Nexusç³»ç»Ÿé…ç½®è¦æ±‚</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å‡çº§è¿‡ç¨‹è¯´æ˜\">å‡çº§è¿‡ç¨‹è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Nexus ä» <code>3.71.x</code> å¼€å§‹ï¼Œä¸å†æ”¯æŒ <code>OrientDB</code>ï¼Œåç»­ç‰ˆæœ¬ä»…æ”¯æŒ <code>H2</code> å’Œ <code>PostgreSQL</code> ï¼Œæ ¹æ®<a href=\"https://help.sonatype.com/en/upgrading-to-nexus-repository-3-71-0-and-beyond.html\">å®˜ç½‘è¯´æ˜</a>ï¼Œ<code>3.70.x</code> ä»¥ä¸‹çš„ç‰ˆæœ¬éœ€è¦å°† Nexus å…ˆå‡çº§åˆ° <code>3.70.x</code> çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç„¶åä½¿ç”¨å®˜æ–¹æä¾›çš„æ•°æ®åº“è¿ç§»å·¥å…·ï¼Œå°†æ•°æ®åº“è¿ç§»åˆ° <code>H2</code> åï¼Œå†å‡çº§åˆ° <code>3.71.x</code> ä»¥åçš„ç‰ˆæœ¬</p>\n</li>\n</ul>\n<h2 id=\"ä»-3-29-2-02-å‡çº§åˆ°-nexus-3-70-4-02\">ä» <code>3.29.2-02</code> å‡çº§åˆ° <code>nexus-3.70.4-02</code></h2>\n<h3 id=\"å®‰è£…-OpenJDK\">å®‰è£… <code>OpenJDK</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éœ€è¦å…ˆå®‰è£…å¥½ <code>OpenJDK</code>ï¼ŒåŸå› æ˜¯<code>Nexusçš„æ•°æ®åº“è¿ç§»å·¥å…·</code>ä»…æ”¯æŒ <code>OpenJDK</code>ï¼Œä¸æ”¯æŒ <code>Oracle JDK</code>ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©å®‰è£… <code>OpenJDK11</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local</span><br><span class=\"line\">curl -O https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\">tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /usr/local/jdk-11.0.28+6/bin/java /usr/bin/java</span><br><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/usr/local/jdk-11.0.28+6</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å®‰è£…-nexus-3-70-x\">å®‰è£… <code>nexus-3.70.x</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›®å‰å®˜ç½‘å‘å¸ƒçš„<code>nexus-3.70.x</code>çš„æœ€æ–°ç‰ˆæœ¬ä¸º <code>nexus-3.70.4-02</code>ï¼Œ<a href=\"https://help.sonatype.com/en/orientdb-downloads.html\">ä¸‹è½½é¡µé¢</a>ï¼Œå…¶å¯¹åº”çš„æ•°æ®åº“è¿ç§»å·¥å…·ä¹Ÿå¯ä»¥ä»è¯¥é¡µé¢ä¸‹è½½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹© <a href=\"https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gz\">Java 11 çš„ç‰ˆæœ¬</a>ï¼Œå‡çº§å®‰è£…ä¸ç¬¬ä¸€æ¬¡å®‰è£…æ–¹å¼ä¸€æ ·ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢åˆ° nexus ç”¨æˆ·ï¼ŒåŸ nexus-3.29.2-02 å°±å®‰è£…åœ¨ è¯¥ç”¨æˆ·çš„ `home` ç›®å½•ä¸‹</span></span><br><span class=\"line\">su - nexus</span><br><span class=\"line\"><span class=\"comment\"># å…³é—­ åŸ nexus æœåŠ¡ï¼Œå…³äºå¦‚ä½•å°† Nexus é…ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://help.sonatype.com/en/run-as-a-service.html</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl stop nexus</span><br><span class=\"line\"><span class=\"comment\">#~/nexus3/bin/nexus stop</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éœ€è¦ç§‘å­¦ä¸Šç½‘</span></span><br><span class=\"line\">curl -O https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gz</span><br><span class=\"line\">tar -zxvf nexus-3.70.4-02-java11-unix.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -f ~/nexus3</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /usr/local/nexus-3.70.4-02 ~/nexus3</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ nexus</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start nexus</span><br><span class=\"line\"><span class=\"comment\"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿ç§»æ•°æ®åˆ°-H2\">è¿ç§»æ•°æ®åˆ° H2</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½æ•°æ®åº“è¿ç§»å·¥å…·</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> ~/backup</span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~/backup</span><br><span class=\"line\"><span class=\"comment\"># ä¸ nexus ç‰ˆæœ¬ä¸€è‡´</span></span><br><span class=\"line\">curl -O https://download.sonatype.com/nexus/nxrm3-migrator/nexus-db-migrator-3.70.4-02.jar</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½• Nexus å¯¼å‡ºæ•°æ®: è®¾ç½® -&gt; System -&gt; Tasks -&gt; Create task -&gt; Admin - Export databases for backup<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/MS26e5.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»»åŠ¡åˆ›å»ºåç‚¹å‡»<code>Run</code>ï¼Œå³å¯åœ¨ <code>/home/nexus/backup</code> ç›®å½•ä¸‹çœ‹åˆ°å¤‡ä»½æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ll /home/nexus/backup</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus   121066 Sep  8 07:25 analytics-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus 19349428 Sep  8 07:25 component-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus   266208 Sep  8 07:25 config-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class=\"line\">-rw-r--r-- 1 nexus nexus 56809625 Sep  8 06:41 nexus-db-migrator-3.70.4-02.jar</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus   132802 Sep  8 07:25 security-2025-09-08-07-25-57-3.70.4-02.bak</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨è¿ç§»å·¥å…·ç”ŸæˆH2æ•°æ®åº“æ–‡ä»¶ï¼Œå®˜ç½‘å‚è€ƒèµ„æ–™: <a href=\"https://help.sonatype.com/en/migrating-to-a-new-database.html#migrating-from-orientdb-to-h2\">Migrating From OrientDB to H2</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¼€å§‹è¿ç§»å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl stop nexus</span><br><span class=\"line\"><span class=\"comment\"># ~/nexus3/bin/nexus stop</span></span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥å¤‡ä»½ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /home/nexus/backup</span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè¦ä½¿ç”¨ OpenJDK 11 è¿è¡Œï¼Œæ ¹æ®éœ€è¦é€‚å½“è°ƒæ•´å†…å­˜å‚æ•°</span></span><br><span class=\"line\">java -Xmx2G -Xms2G -XX:+UseG1GC -jar nexus-db-migrator-3.70.4-02.jar --migration_type=h2</span><br><span class=\"line\"><span class=\"comment\"># è¿è¡Œåä¼šæç¤ºä½ è¿ç§»æ•°æ®åº“å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡ï¼Œæˆ‘ä»¬è¾“å…¥ y ç»§ç»­</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡ŒæˆåŠŸåä¼šç”Ÿæˆ <code>nexus.mv.db</code>ï¼Œå°†å…¶ç§»åŠ¨åˆ° <code>/home/nexus/sonatype-work/nexus3/db/</code> ç›®å½•ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mv</span> nexus.mv.db /home/nexus/sonatype-work/nexus3/db/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¾‘<code>/home/nexus/sonatype-work/nexus3/etc/nexus.properties</code> æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># enable db h2</span></span><br><span class=\"line\">nexus.datastore.enabled=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ nexusï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å®Œæˆäº† ä» <code>3.29.2-02</code> åˆ° <code>nexus-3.70.4-02</code> çš„å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start nexus</span><br><span class=\"line\"><span class=\"comment\"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"ä»-nexus-3-70-4-02-å‡çº§åˆ°-nexus-3-83-2-01\">ä» <code>nexus-3.70.4-02</code> å‡çº§åˆ° <code>nexus-3.83.2-01</code></h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸ªå‡çº§å°±æ¯”è¾ƒç®€å•äº†ï¼Œå’Œæˆ‘ä»¬æ­¤å‰çš„å‡çº§æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œä¸‹è½½è§£å‹åæ›¿æ¢å®‰è£…ç›®å½•å³å¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œä»<code>nexus-3.71.0+</code>å¼€å§‹ä»…æ”¯æŒ<code>jdk17</code>ï¼Œæ‰€ä»¥éœ€è¦æå‰å®‰è£…å¥½<code>jdk17</code>ï¼Œå¦å¤–ä»<code>nexus-3.78.0</code>å¼€å§‹ï¼ŒNexus å†…ç½®äº†<code>openjdk17</code>ï¼Œæ‰€ä»¥ä¸éœ€è¦å†é¢å¤–å®‰è£…jdkã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>nexus-3.83.2-01</code> æ˜¯ç›®å‰çš„æœ€æ–°ç‰ˆï¼Œ<a href=\"https://help.sonatype.com/en/download.html\">æœ€æ–°ç‰ˆä¸‹è½½é¡µé¢</a>ï¼Œ<a href=\"https://help.sonatype.com/en/download-archives---repository-manager-3.html\">å†å²ç‰ˆæœ¬ä¸‹è½½é¡µé¢åœ°å€</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­ Nexus æœåŠ¡</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl stop nexus</span><br><span class=\"line\"><span class=\"comment\"># ~/nexus3/bin/nexus stop</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~</span><br><span class=\"line\">curl -O https://download.sonatype.com/nexus/3/nexus-3.83.2-01-linux-x86_64.tar.gz</span><br><span class=\"line\">tar -zxvf nexus-3.83.2-01-linux-x86_64.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -f nexus3</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s nexus-3.83.2-01 nexus3</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ Nexusï¼Œnexus-3.83.2-01 è‡ªå¸¦ openjdk17ï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬å®‰è£… openjdk</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start nexus</span><br><span class=\"line\"><span class=\"comment\"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/rgLwWf.png\" alt=\"\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/mdWh22.png\" alt=\"\" width=\"1400\" height=\"1000\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/56aOWz.png\" alt=\"\"></p>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Mavne ç§æœ Nexus å‡çº§çš„å…¨è¿‡ç¨‹ï¼Œä» 3.29.2-02 å‡çº§åˆ° 3.83.2-01 Nexuså®˜ç½‘ OpenJdkä¸‹è½½åœ°å€ Nexusç³»ç»Ÿé…ç½®è¦æ±‚ å‡çº§è¿‡ç¨‹è¯´æ˜ Nexus ä» 3.71.x å¼€å§‹ï¼Œä¸å†æ”¯æŒ OrientDBï¼Œåç»­ç‰ˆæœ¬ä»…æ”¯æŒ H2 å’Œ PostgreSQL ï¼Œæ ¹æ®å®˜ç½‘è¯´æ˜ï¼Œ3.70.x ä»¥ä¸‹çš„ç‰ˆæœ¬éœ€è¦å°† Nexus å…ˆå‡çº§åˆ° 3.70.x çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç„¶åä½¿ç”¨å®˜æ–¹æä¾›çš„æ•°æ®åº“è¿ç§»å·¥å…·ï¼Œå°†æ•°æ®åº“è¿ç§»åˆ° H2 åï¼Œå†å‡çº§åˆ° 3.71.x ä»¥åçš„ç‰ˆæœ¬ ä» 3.29.2-02 å‡çº§åˆ° nexus-3.70.4-02 å®‰è£… OpenJDK éœ€è¦å…ˆå®‰è£…å¥½ OpenJDKï¼ŒåŸå› æ˜¯Nexusçš„æ•°æ®åº“è¿ç§»å·¥å…·ä»…æ”¯æŒ OpenJDKï¼Œä¸æ”¯æŒ Oracle JDKï¼Œæˆ‘è¿™é‡Œé€‰æ‹©å®‰è£… OpenJDK11 123456cd /usr/localcurl -O https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gztar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gzln -s /usr/local/jdk-11.0.28+6/bin/java /usr/bin/javaexport JAVA_HOME=/usr/local/jdk-11.0.28+6export PATH=$JAVA_HOME/bin:$PATH å®‰è£… nexus-3.70.x ç›®å‰å®˜ç½‘å‘å¸ƒçš„nexus-3.70.xçš„æœ€æ–°ç‰ˆæœ¬ä¸º nexus-3.70.4-02ï¼Œä¸‹è½½é¡µé¢ï¼Œå…¶å¯¹åº”çš„æ•°æ®åº“è¿ç§»å·¥å…·ä¹Ÿå¯ä»¥ä»è¯¥é¡µé¢ä¸‹è½½ã€‚ è¿™é‡Œæˆ‘ä»¬é€‰æ‹© Java 11 çš„ç‰ˆæœ¬ï¼Œå‡çº§å®‰è£…ä¸ç¬¬ä¸€æ¬¡å®‰è£…æ–¹å¼ä¸€æ ·ã€‚ 1234567891011121314# åˆ‡æ¢åˆ° nexus ç”¨æˆ·ï¼ŒåŸ nexus-3.29.2-02 å°±å®‰è£…åœ¨ è¯¥ç”¨æˆ·çš„ `home` ç›®å½•ä¸‹su - nexus# å…³é—­ åŸ nexus æœåŠ¡ï¼Œå…³äºå¦‚ä½•å°† Nexus é…ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://help.sonatype.com/en/run-as-a-service.htmlsudo systemctl stop nexus#~/nexus3/bin/nexus stop# éœ€è¦ç§‘å­¦ä¸Šç½‘curl -O https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gztar -zxvf nexus-3.70.4-02-java11-unix.tar.gzrm -f ~/nexus3ln -s /usr/local/nexus-3.70.4-02 ~/nexus3# å¯åŠ¨ nexussudo systemctl start nexus# ~/nexus3/bin/nexus start è¿ç§»æ•°æ®åˆ° H2 ä¸‹è½½æ•°æ®åº“è¿ç§»å·¥å…· 1234mkdir ~/backupcd ~/backup# ä¸ nexus ç‰ˆæœ¬ä¸€è‡´curl -O https://download.sonatype.com/nexus/nxrm3-migrator/nexus-db-migrator-3.70.4-02.jar ç™»å½• Nexus å¯¼å‡ºæ•°æ®: è®¾ç½® -&gt; System -&gt; Tasks -&gt; Create task -&gt; Admin - Export databases for backup ä»»åŠ¡åˆ›å»ºåç‚¹å‡»Runï¼Œå³å¯åœ¨ /home/nexus/backup ç›®å½•ä¸‹çœ‹åˆ°å¤‡ä»½æ–‡ä»¶ 123456ll /home/nexus/backup-rw-rw-r-- 1 nexus nexus 121066 Sep 8 07:25 analytics-2025-09-08-07-25-57-3.70.4-02.bak-rw-rw-r-- 1 nexus nexus 19349428 Sep 8 07:25 component-2025-09-08-07-25-57-3.70.4-02.bak-rw-rw-r-- 1 nexus nexus 266208 Sep 8 07:25 config-2025-09-08-07-25-57-3.70.4-02.bak-rw-r--r-- 1 nexus nexus 56809625 Sep 8 06:41 nexus-db-migrator-3.70.4-02.jar-rw-rw-r-- 1 nexus nexus 132802 Sep 8 07:25 security-2025-09-08-07-25-57-3.70.4-02.bak ä½¿ç”¨è¿ç§»å·¥å…·ç”ŸæˆH2æ•°æ®åº“æ–‡ä»¶ï¼Œå®˜ç½‘å‚è€ƒèµ„æ–™: Migrating From OrientDB to H2 12345678# å¼€å§‹è¿ç§»å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡sudo systemctl stop nexus# ~/nexus3/bin/nexus stop# è¿›å…¥å¤‡ä»½ç›®å½•cd /home/nexus/backup# è¿™é‡Œè¦ä½¿ç”¨ OpenJDK 11 è¿è¡Œï¼Œæ ¹æ®éœ€è¦é€‚å½“è°ƒæ•´å†…å­˜å‚æ•°java -Xmx2G -Xms2G -XX:+UseG1GC -jar nexus-db-migrator-3.70.4-02.jar --migration_type=h2# è¿è¡Œåä¼šæç¤ºä½ è¿ç§»æ•°æ®åº“å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡ï¼Œæˆ‘ä»¬è¾“å…¥ y ç»§ç»­ è¿è¡ŒæˆåŠŸåä¼šç”Ÿæˆ nexus.mv.dbï¼Œå°†å…¶ç§»åŠ¨åˆ° /home/nexus/sonatype-work/nexus3/db/ ç›®å½•ä¸‹ 1mv nexus.mv.db /home/nexus/sonatype-work/nexus3/db/ ç¼–è¾‘/home/nexus/sonatype-work/nexus3/etc/nexus.properties æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ 12# enable db h2nexus.datastore.enabled=true å¯åŠ¨ nexusï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å®Œæˆäº† ä» 3.29.2-02 åˆ° nexus-3.70.4-02 çš„å‡çº§ 12sudo systemctl start nexus# ~/nexus3/bin/nexus start ä» nexus-3.70.4-02 å‡çº§åˆ° nexus-3.83.2-01 è¿™ä¸ªå‡çº§å°±æ¯”è¾ƒç®€å•äº†ï¼Œå’Œæˆ‘ä»¬æ­¤å‰çš„å‡çº§æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œä¸‹è½½è§£å‹åæ›¿æ¢å®‰è£…ç›®å½•å³å¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œä»nexus-3.71.0+å¼€å§‹ä»…æ”¯æŒjdk17ï¼Œæ‰€ä»¥éœ€è¦æå‰å®‰è£…å¥½jdk17ï¼Œå¦å¤–ä»nexus-3.78.0å¼€å§‹ï¼ŒNexus å†…ç½®äº†openjdk17ï¼Œæ‰€ä»¥ä¸éœ€è¦å†é¢å¤–å®‰è£…jdkã€‚ nexus-3.83.2-01 æ˜¯ç›®å‰çš„æœ€æ–°ç‰ˆï¼Œæœ€æ–°ç‰ˆä¸‹è½½é¡µé¢ï¼Œå†å²ç‰ˆæœ¬ä¸‹è½½é¡µé¢åœ°å€ 1234567891011# å…³é—­ Nexus æœåŠ¡sudo systemctl stop nexus# ~/nexus3/bin/nexus stopcd ~curl -O https://download.sonatype.com/nexus/3/nexus-3.83.2-01-linux-x86_64.tar.gztar -zxvf nexus-3.83.2-01-linux-x86_64.tar.gzrm -f nexus3ln -s nexus-3.83.2-01 nexus3# å¯åŠ¨ Nexusï¼Œnexus-3.83.2-01 è‡ªå¸¦ openjdk17ï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬å®‰è£… openjdksudo systemctl start nexus# ~/nexus3/bin/nexus start","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Mavne ç§æœ Nexus å‡çº§çš„å…¨è¿‡ç¨‹ï¼Œä» 3.29.2-02 å‡çº§åˆ° 3.83.2-01 Nexuså®˜ç½‘ OpenJdkä¸‹è½½åœ°å€ Nexusç³»ç»Ÿé…ç½®è¦æ±‚","date_published":"2025-09-08T13:30:05.000Z","tags":["æŠ€æœ¯","maven","nexus","mavne","nexus"]},{"id":"https://blog.hanqunfeng.com/2025/09/04/springboot3-shardingsphere-proxy/","url":"https://blog.hanqunfeng.com/2025/09/04/springboot3-shardingsphere-proxy/","title":"SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/index_zh.html\">ShardingSphereå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy\">æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡å°† <a href=\"/2025/09/01/springboot3-shardingsphere/\" title=\"SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨\">SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨</a> ä¿®æ”¹ä¸º <code>ShardingSphere-Proxy</code> çš„æ¨¡å¼</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ShardingSphere-Proxy-ç®€ä»‹\">ShardingSphere-Proxy ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy å®šä½ä¸ºé€æ˜åŒ–çš„æ•°æ®åº“ä»£ç†ç«¯ï¼Œé€šè¿‡å®ç°æ•°æ®åº“äºŒè¿›åˆ¶åè®®ï¼Œå¯¹å¼‚æ„è¯­è¨€æä¾›æ”¯æŒã€‚ ç›®å‰æä¾› MySQL å’Œ PostgreSQL åè®®ï¼Œé€æ˜åŒ–æ•°æ®åº“æ“ä½œï¼Œå¯¹ DBA æ›´åŠ å‹å¥½ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å‘åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ï¼Œå¯ç›´æ¥å½“åš MySQL/PostgreSQL ä½¿ç”¨ï¼›</li>\n<li class=\"lvl-4\">å…¼å®¹ MariaDB ç­‰åŸºäº MySQL åè®®çš„æ•°æ®åº“ï¼Œä»¥åŠ openGauss ç­‰åŸºäº PostgreSQL åè®®çš„æ•°æ®åº“ï¼›</li>\n<li class=\"lvl-4\">é€‚ç”¨äºä»»ä½•å…¼å®¹ MySQL/PostgreSQL åè®®çš„çš„å®¢æˆ·ç«¯ï¼Œå¦‚ï¼šMySQL Command Client, MySQL Workbench, Navicat ç­‰ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/AMn2pu.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy ä¸ ShardingSphere-JDBC çš„ç‰¹æ€§æ¯”è¾ƒ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>ShardingSphere-JDBC</th>\n<th>ShardingSphere-Proxy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ•°æ®åº“æ”¯æŒ</strong></td>\n<td>ä»»æ„æ•°æ®åº“</td>\n<td>MySQL / PostgreSQL</td>\n</tr>\n<tr>\n<td><strong>è¿æ¥æ¶ˆè€—æ•°</strong></td>\n<td>é«˜</td>\n<td>ä½</td>\n</tr>\n<tr>\n<td><strong>å¼‚æ„è¯­è¨€æ”¯æŒ</strong></td>\n<td>ä»…æ”¯æŒ Java</td>\n<td>æ”¯æŒä»»æ„è¯­è¨€</td>\n</tr>\n<tr>\n<td><strong>æ€§èƒ½</strong></td>\n<td>æŸè€—ä½</td>\n<td>æŸè€—ç•¥é«˜</td>\n</tr>\n<tr>\n<td><strong>æ— ä¸­å¿ƒåŒ–</strong></td>\n<td>æ˜¯</td>\n<td>å¦</td>\n</tr>\n<tr>\n<td><strong>é™æ€å…¥å£</strong></td>\n<td>æ— </td>\n<td>æœ‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"éƒ¨ç½²-ShardingSphere-Proxy\">éƒ¨ç½² ShardingSphere-Proxy</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œ ShardingSphere-Proxy è¦æ±‚ JDK 1.8+</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹è½½ <a href=\"https://shardingsphere.apache.org/document/current/cn/downloads/\">ShardingSphere-Proxy5.5.2</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://www.apache.org/dyn/closer.lua/shardingsphere/5.5.2/apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxvf apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®-ShardingSphere-Proxy\">é…ç½® ShardingSphere-Proxy</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>conf/global.yaml</code>: å…¨å±€é…ç½®ï¼Œæ‰€è°“å…¨å±€ï¼Œå°±æ˜¯å¯¹æ‰€æœ‰é€»è¾‘åº“éƒ½ç”Ÿæ•ˆçš„é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/authority/</span></span><br><span class=\"line\"><span class=\"attr\">authority:</span></span><br><span class=\"line\"> <span class=\"attr\">users:</span></span><br><span class=\"line\">   <span class=\"bullet\">-</span> <span class=\"attr\">user:</span> <span class=\"string\">root@127.0.0.1</span> <span class=\"comment\"># æ ¼å¼ï¼šç”¨æˆ·å@IP</span></span><br><span class=\"line\">     <span class=\"attr\">password:</span> <span class=\"string\">root</span></span><br><span class=\"line\">     <span class=\"attr\">admin:</span> <span class=\"literal\">true</span>          <span class=\"comment\"># æ˜¯å¦æ˜¯ç®¡ç†å‘˜</span></span><br><span class=\"line\">   <span class=\"bullet\">-</span> <span class=\"attr\">user:</span> <span class=\"string\">sharding@%</span>     <span class=\"comment\"># æ‰€æœ‰IPéƒ½å¯ä»¥è®¿é—®</span></span><br><span class=\"line\">     <span class=\"attr\">password:</span> <span class=\"string\">sharding</span></span><br><span class=\"line\"> <span class=\"attr\">privilege:</span></span><br><span class=\"line\">   <span class=\"attr\">type:</span> <span class=\"string\">DATABASE_PERMITTED</span> <span class=\"comment\"># æƒé™ç±»å‹</span></span><br><span class=\"line\">   <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">user-database-mappings:</span> <span class=\"string\">root@127.0.0.1=*,sharding@%=sharding_db</span> <span class=\"comment\"># ç”¨æˆ·æƒé™æ˜ å°„ï¼Œ*è¡¨ç¤ºæ‰€æœ‰æ•°æ®åº“</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¼€å¯XAäº‹åŠ¡ï¼Œå¦‚æœæ˜¯ springbooté¡¹ç›®ï¼Œåªéœ€è¦åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Š @Transactional æ³¨è§£å³å¯å¼€å¯äº‹åŠ¡(ä» MySQL 5.7 å¼€å§‹å°±å…¨é¢æ”¯æŒ XA åˆ†å¸ƒå¼äº‹åŠ¡)</span></span><br><span class=\"line\"><span class=\"comment\"># https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/</span></span><br><span class=\"line\"><span class=\"attr\">transaction:</span>  <span class=\"comment\"># é…ç½®äº‹åŠ¡</span></span><br><span class=\"line\">  <span class=\"attr\">defaultType:</span> <span class=\"string\">XA</span>        <span class=\"comment\"># äº‹åŠ¡ç±»å‹ï¼Œé»˜è®¤ LOCAL</span></span><br><span class=\"line\">  <span class=\"attr\">providerType:</span> <span class=\"string\">Atomikos</span> <span class=\"comment\"># äº‹åŠ¡ç®¡ç†å™¨å…·ä½“å®ç°ï¼Œé»˜è®¤å°±æ˜¯ Atomikos</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/props/</span></span><br><span class=\"line\"><span class=\"attr\">props:</span></span><br><span class=\"line\">  <span class=\"attr\">sql-show:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class=\"line\">  <span class=\"attr\">check-table-metadata-enabled:</span> <span class=\"literal\">false</span> <span class=\"comment\"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>conf/database-my.yaml</code>: è‡ªå®šä¹‰åˆ†é…è§„åˆ™é…ç½®</p>\n</li>\n</ul>\n<blockquote>\n<p>æ³¨æ„:<br>\n1.åç§°å¿…é¡»ä»¥ <code>database-</code>å¼€å¤´ï¼Œå®é™…ä¸Š<code>conf</code>ç›®å½•ä¸‹æœ‰å¾ˆå¤šç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®<br>\n2.<code>global.yaml</code>ä¸­çš„é…ç½®é¡¹ä¸èƒ½é…ç½®åˆ° <code>database-my.yaml</code>ä¸­</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class=\"line\"><span class=\"attr\">databaseName:</span> <span class=\"string\">sharding_db</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/</span></span><br><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_0:</span> <span class=\"comment\"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># dataSourceClassName: com.zaxxer.hikari.HikariDataSource # ä¸è¦æŒ‡å®š</span></span><br><span class=\"line\">    <span class=\"comment\"># driverClassName: com.mysql.cj.jdbc.Driver               # ä¸è¦æŒ‡å®š</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>  <span class=\"comment\"># æ³¨æ„è¿™é‡Œå±æ€§ä¸º url</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">ds_1:</span></span><br><span class=\"line\">    <span class=\"comment\"># dataSourceClassName: com.zaxxer.hikari.HikariDataSource</span></span><br><span class=\"line\">    <span class=\"comment\"># driverClassName: com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»¥ä¸‹è§„åˆ™ä¸å‰æ–‡ä¸­çš„ shardingsphere-jdbc ä¸­çš„ rules ç›¸åŒ</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"comment\"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">bindingTables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">t_order,t_order_item</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">course:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">cid</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_inline</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">cid</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order-complex-algorithm</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_item-class-based-algorithm_spi</span> <span class=\"comment\"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class=\"line\">          <span class=\"comment\">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">custom_snowflake_string</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#       t_address:      # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜</span></span><br><span class=\"line\">    <span class=\"comment\">#         actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">autoTables:</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/</span></span><br><span class=\"line\">      <span class=\"attr\">course_inline:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># å±æ€§</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">course_$&#123;cid</span> <span class=\"string\">%</span> <span class=\"number\">2</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class=\"line\">          <span class=\"attr\">allow-range-query-with-inline-sharding:</span> <span class=\"literal\">true</span> <span class=\"comment\"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class=\"line\">      <span class=\"attr\">course_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class=\"line\">      <span class=\"attr\">mod_2:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MOD</span> <span class=\"comment\"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">sharding-count:</span> <span class=\"number\">2</span> <span class=\"comment\"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order-complex-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">COMPLEX_INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_order_complex_$&#123;(user_id</span> <span class=\"string\">+</span> <span class=\"string\">order_id</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">)</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm_spi:</span> <span class=\"comment\"># SPI</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">T_ORDER_ITEM_COMPLEX</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br><span class=\"line\">      <span class=\"attr\">uuid:</span> <span class=\"comment\"># å®šä¹‰åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">UUID</span> <span class=\"comment\"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class=\"line\">      <span class=\"attr\">custom_snowflake_string:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CUSTOM_SNOWFLAKE_STRING</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">workerId:</span> <span class=\"number\">2</span></span><br><span class=\"line\">          <span class=\"attr\">datacenterId:</span> <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!BROADCAST</span>  <span class=\"comment\"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">dict</span>    <span class=\"comment\"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!ENCRYPT</span>    <span class=\"comment\"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span> <span class=\"comment\"># åŠ å¯†è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># åŠ å¯†åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">cipher:</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">password</span> <span class=\"comment\"># å¯†æ–‡åˆ—åç§°</span></span><br><span class=\"line\">              <span class=\"attr\">encryptorName:</span> <span class=\"string\">aes_encryptor</span> <span class=\"comment\"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class=\"line\">    <span class=\"attr\">encryptors:</span></span><br><span class=\"line\">      <span class=\"attr\">aes_encryptor:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">AES</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">aes-key-value:</span> <span class=\"string\">123456abc</span>     <span class=\"comment\"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class=\"line\">          <span class=\"attr\">digest-algorithm-name:</span> <span class=\"string\">SHA-1</span> <span class=\"comment\"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">md5_encryptor:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">salt:</span> <span class=\"number\">123456</span>  <span class=\"comment\"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!MASK</span>  <span class=\"comment\"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span> <span class=\"comment\"># è„±æ•è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span> <span class=\"comment\"># è„±æ•åˆ—é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># è„±æ•åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">md5_mask</span> <span class=\"comment\"># è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">email:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">mask_before_special_chars_mask</span></span><br><span class=\"line\">          <span class=\"attr\">telephone:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">keep_first_n_last_m_mask</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">my_mask</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">maskAlgorithms:</span> <span class=\"comment\"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">md5_mask:</span> <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span>  <span class=\"comment\"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class=\"line\">      <span class=\"attr\">mask_before_special_chars_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MASK_BEFORE_SPECIAL_CHARS</span> <span class=\"comment\"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">special-chars:</span> <span class=\"string\">&#x27;@&#x27;</span>  <span class=\"comment\"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span>   <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">keep_first_n_last_m_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">KEEP_FIRST_N_LAST_M</span> <span class=\"comment\"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">first-n:</span> <span class=\"number\">3</span>     <span class=\"comment\"># ä¿ç•™å‰ 3 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">last-m:</span> <span class=\"number\">4</span>      <span class=\"comment\"># ä¿ç•™å 4 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">my_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MY_CUSTOM_MASK</span>  <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&quot;#&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SINGLE</span> <span class=\"comment\"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"comment\"># MySQL é£æ ¼</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ds_0.t_address</span> <span class=\"comment\"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br><span class=\"line\"><span class=\"comment\">#       - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨</span></span><br><span class=\"line\"><span class=\"comment\">#       - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çš„<code>rules</code>ä¸­ä½¿ç”¨çš„æ˜¯<code>mysql</code>æ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥<code>mysql</code>æ•°æ®åº“çš„ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> ext-lib</span><br><span class=\"line\"><span class=\"built_in\">cd</span> ext-lib</span><br><span class=\"line\">wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒæ—¶<code>rules</code>ä¸­åŒ…å«ä¸€äº›è‡ªå®šä¹‰çš„ç®—æ³•ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†è¿™äº›ç®—æ³•ä½œä¸ºä¾èµ–è¿›è¡Œå¼•å…¥ï¼Œå°†è¿™äº›ç®—æ³•ç±»æ‰“æˆ<code>jar</code>ï¼Œç„¶åä¹Ÿæ‹·è´åˆ°<code>ext-lib</code>ç›®å½•ä¸‹ï¼Œæˆ‘å·²ç»å°†å…¶å‘å¸ƒåˆ°äº†githubä¸Šï¼Œå®é™…ä¸Šå’Œå‰æ–‡ä¸­çš„ <code>shardingsphere-jdbc</code> é¡¹ç›®ä¸­å°†ç®—æ³•é…ç½®ä¸º <code>spi</code> çš„æ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. åªå…‹éš†ä»“åº“çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¸ä¸‹è½½æ‰€æœ‰æ–‡ä»¶</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> --filter=blob:none --sparse https://github.com/hanqunfeng/springbootchapter.git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. è¿›å…¥ä»“åº“ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> springbootchapter</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. è®¾ç½®åªæ£€å‡ºä½ éœ€è¦çš„ç›®å½•</span></span><br><span class=\"line\">git sparse-checkout <span class=\"built_in\">set</span> springboot3-demo/shardingsphere-demo/algorithm-swapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. ç¼–è¯‘æ‰“åŒ…</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> springboot3-demo/shardingsphere-demo/algorithm-swapper</span><br><span class=\"line\">mvn clean package -DskipTests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. å°†æ‰“å¥½çš„åŒ…å¤åˆ¶åˆ° shardingsphere-proxy çš„ ext-lib ç›®å½•ä¸‹</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> target/algorithm-swapper-1.0.0.jar <span class=\"variable\">$shardingsphere</span>-proxy$/ext-lib</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¯åŠ¨ä¸å…³é—­-ShardingSphere-Proxy\">å¯åŠ¨ä¸å…³é—­ ShardingSphere Proxy</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere Proxy è¦æ±‚ JDK 1.8 æˆ–ä»¥ä¸Šç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$shardingsphere</span>-proxy$/bin</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨</span></span><br><span class=\"line\">./start.sh</span><br><span class=\"line\"><span class=\"comment\"># å…³é—­</span></span><br><span class=\"line\">./stop.sh</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-a</code></td>\n<td>ç»‘å®šåœ°å€ï¼Œå¯ä»¥æ˜¯ IPv4ã€IPv6 æˆ–ä¸»æœºåï¼Œå¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”ã€‚</td>\n<td><code>0.0.0.0</code></td>\n</tr>\n<tr>\n<td><code>-p</code></td>\n<td>ç»‘å®šç«¯å£å·ï¼Œå¯ä»¥åœ¨ <code>global.yaml</code> ä¸­ä¿®æ”¹ã€‚<code>-p</code> ä¼˜å…ˆçº§æ›´é«˜</td>\n<td><code>3307</code></td>\n</tr>\n<tr>\n<td><code>-c</code></td>\n<td>ShardingSphere-Proxy é…ç½®ç›®å½•è·¯å¾„ã€‚</td>\n<td><code>conf</code></td>\n</tr>\n<tr>\n<td><code>-f</code></td>\n<td>å¼ºåˆ¶å¯åŠ¨ ShardingSphere-Proxyã€‚</td>\n<td>æ— </td>\n</tr>\n<tr>\n<td><code>-g</code></td>\n<td>å¦‚æœåœ¨ <code>agent</code> ç›®å½•ä¸‹éƒ¨ç½²äº† <code>shardingsphere-agent</code>ï¼Œå¯ç”¨ agent åŠŸèƒ½ã€‚</td>\n<td>æ— </td>\n</tr>\n<tr>\n<td><code>-s</code></td>\n<td>æŒ‡å®šç”¨äºè¿æ¥çš„ socket æ–‡ä»¶è·¯å¾„ã€‚</td>\n<td>æ— </td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy å¯åŠ¨å‘½ä»¤é€ŸæŸ¥è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>å‘½ä»¤ç¤ºä¾‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>é»˜è®¤å¯åŠ¨</strong></td>\n<td><code>./start.sh</code></td>\n<td>é»˜è®¤ç«¯å£ <code>3307</code>ï¼Œé…ç½®ç›®å½• <code>conf</code></td>\n</tr>\n<tr>\n<td><strong>æŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½•</strong></td>\n<td><code>./start.sh 3308 /opt/shardingsphere-proxy/conf</code></td>\n<td>ç®€å†™æ¨¡å¼ï¼ŒæŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½•</td>\n</tr>\n<tr>\n<td><strong>å‚æ•°å½¢å¼å¯åŠ¨</strong></td>\n<td><code>./start.sh -p 3308 -c /opt/shardingsphere-proxy/conf</code></td>\n<td>ä¸ä¸Šé¢ç­‰æ•ˆï¼Œä½†æ›´æ˜ç¡®</td>\n</tr>\n<tr>\n<td><strong>æŒ‡å®šç›‘å¬åœ°å€</strong></td>\n<td><code>./start.sh -a 192.168.1.100 -p 3307 -c conf</code></td>\n<td>æŒ‡å®šå•ä¸ª IP åœ°å€</td>\n</tr>\n<tr>\n<td><strong>æŒ‡å®šå¤šä¸ªç›‘å¬åœ°å€</strong></td>\n<td><code>./start.sh -a 192.168.1.100,127.0.0.1 -p 3307 -c conf</code></td>\n<td>å¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”</td>\n</tr>\n<tr>\n<td><strong>å¼ºåˆ¶å¯åŠ¨</strong></td>\n<td><code>./start.sh -p 3307 -c conf -f</code></td>\n<td>é‡åˆ°æ®‹ç•™ PID æ–‡ä»¶æ—¶ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><strong>å¯ç”¨ agent</strong></td>\n<td><code>./start.sh -p 3307 -c conf -g</code></td>\n<td>å¯åŠ¨ ShardingSphere-Agent</td>\n</tr>\n<tr>\n<td><strong>ä½¿ç”¨ Unix Socket</strong></td>\n<td><code>./start.sh -p 3307 -c conf -s /tmp/sharding-proxy.sock</code></td>\n<td>é€šè¿‡ Socket æ–‡ä»¶è¿›è¡Œè¿æ¥</td>\n</tr>\n<tr>\n<td><strong>å¤šé€‰é¡¹ç»„åˆ</strong></td>\n<td><code>./start.sh -a 127.0.0.1 -p 3310 -c /opt/proxy/conf -f -g -s /tmp/proxy.sock</code></td>\n<td>ä¸€æ¬¡æ€§æŒ‡å®šå¤šä¸ªé€‰é¡¹</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"é¡¹ç›®è¿æ¥-ShardingSphere-Proxy-æ—¶ï¼Œå°±åƒè¿æ¥æ™®é€šçš„-mysql-æœåŠ¡ä¸€æ ·\">é¡¹ç›®è¿æ¥ ShardingSphere-Proxy æ—¶ï¼Œå°±åƒè¿æ¥æ™®é€šçš„ mysql æœåŠ¡ä¸€æ ·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹é¡¹ç›®ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy\">https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy</a></p>\n</li>\n</ul>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ <code>ShardingSphere-JDBC</code> å’Œ <code>ShardingSphere-Proxy</code> ä¸­ï¼Œå­˜åœ¨éƒ¨åˆ† MySQL(å…¶å®ƒæ•°æ®åº“ä¹Ÿç±»ä¼¼) çš„ SQL è¯­æ³•æˆ–åŠŸèƒ½ç›®å‰è¿˜ä¸å®Œå…¨æ”¯æŒçš„æƒ…å†µã€‚<code>ShardingSphere</code> åœ¨åš SQL è·¯ç”±ã€æ”¹å†™ã€æ‰§è¡Œæ—¶ï¼Œå¿…é¡»èƒ½è§£æ SQL å¹¶ç†è§£å…¶è¯­ä¹‰ï¼Œä½†å¹¶ä¸æ˜¯ MySQL çš„ 100% å®Œå…¨ä»£ç†ã€‚å› æ­¤ï¼Œæœ‰äº›å¤æ‚æˆ–ç‰¹å®šåœºæ™¯ä¸‹çš„ SQL å¯èƒ½æ— æ³•è¢«æ­£ç¡®è§£ææˆ–æ‰§è¡Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ”¯æŒè‰¯å¥½çš„ SQL è¯­æ³•</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åŸºç¡€ DML<br>\nSELECTã€INSERTã€UPDATEã€DELETE<br>\nåŸºæœ¬çš„æ¡ä»¶æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µã€åˆ†ç»„ã€èšåˆå‡½æ•°ï¼ˆå¦‚ COUNTã€SUMã€AVGï¼‰</li>\n<li class=\"lvl-4\">DCL<br>\nåŸºæœ¬çš„äº‹åŠ¡è¯­å¥ï¼šBEGINã€COMMITã€ROLLBACK</li>\n<li class=\"lvl-4\">DDL<br>\néƒ¨åˆ†è¡¨ç»“æ„ç®¡ç†è¯­å¥ï¼šCREATE TABLEã€ALTER TABLEã€DROP TABLE</li>\n<li class=\"lvl-4\">å‡½æ•°æ”¯æŒ<br>\nå¤§éƒ¨åˆ†å¸¸ç”¨çš„ MySQL å†…ç½®å‡½æ•°ï¼Œå¦‚å­—ç¬¦ä¸²ã€æ•°å­¦ã€æ—¥æœŸå‡½æ•°</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"åœ¨-ShardingSphere-MySQL-ä¸‹å»ºè®®é¿å…æˆ–è°¨æ…ä½¿ç”¨çš„-SQL-æ¸…å•\">åœ¨ ShardingSphere + MySQL ä¸‹å»ºè®®é¿å…æˆ–è°¨æ…ä½¿ç”¨çš„ SQL æ¸…å•</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol>\n<li class=\"lvl-5\">è·¨åˆ†ç‰‡å¤æ‚æŸ¥è¯¢</li>\n</ol>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>SQL åœºæ™¯</th>\n<th>åŸå› </th>\n<th>å»ºè®®å¤„ç†æ–¹å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å¤šè¡¨å¤æ‚ JOINï¼ˆç‰¹åˆ«æ˜¯è·¨åˆ†ç‰‡ï¼‰</td>\n<td>éœ€è¦è·¨åº“æ•°æ®èšåˆï¼Œæ€§èƒ½å·®ï¼Œå¯èƒ½æŠ¥é”™</td>\n<td>ä½¿ç”¨å¹¿æ’­è¡¨/ç»‘å®šè¡¨ï¼Œæˆ–åœ¨åº”ç”¨å±‚å®Œæˆ</td>\n</tr>\n<tr>\n<td>è·¨åˆ†ç‰‡å­æŸ¥è¯¢</td>\n<td>SQL è·¯ç”±å›°éš¾ï¼Œå¯èƒ½ä¸æ”¯æŒ</td>\n<td>å°½é‡æ”¹æˆå•è¡¨æŸ¥è¯¢æˆ–åˆ†æ­¥æŸ¥è¯¢</td>\n</tr>\n<tr>\n<td>è·¨åˆ†ç‰‡çš„ GROUP BY / ORDER BY</td>\n<td>åœ¨ Proxy å±‚èšåˆï¼Œæ€§èƒ½å¾ˆå·®</td>\n<td>å°½é‡é¿å…ï¼Œæˆ–æ§åˆ¶æ•°æ®é‡</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"2\">\n<li class=\"lvl-5\">DDL ç›¸å…³</li>\n</ol>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>SQL åœºæ™¯</th>\n<th>åŸå› </th>\n<th>å»ºè®®å¤„ç†æ–¹å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>ALTER TABLE</code> å¤æ‚å˜æ›´</td>\n<td>éœ€åœ¨æ‰€æœ‰åˆ†ç‰‡æ‰§è¡Œï¼Œå¯èƒ½æ‰§è¡Œå¤±è´¥</td>\n<td>æ‰‹åŠ¨åœ¨æ¯ä¸ªåˆ†ç‰‡åº“æ‰§è¡Œ</td>\n</tr>\n<tr>\n<td><code>CREATE TRIGGER</code>ã€<code>PROCEDURE</code></td>\n<td>Proxy ä¸è§£æè¿™äº›è¯­æ³•ï¼Œç›´æ¥é€ä¼ ä¸å®‰å…¨</td>\n<td>å°½é‡åœ¨å•åº“æ‰‹åŠ¨åˆ›å»º</td>\n</tr>\n<tr>\n<td><code>CREATE FUNCTION</code></td>\n<td>åŒä¸Š</td>\n<td>å•åº“æ‰§è¡Œæˆ–åº”ç”¨å±‚æ›¿ä»£</td>\n</tr>\n<tr>\n<td><code>FULLTEXT INDEX</code>ã€<code>SPATIAL INDEX</code></td>\n<td>åˆ†ç‰‡ç¯å¢ƒä¸‹æ— æ³•è‡ªåŠ¨ç»´æŠ¤ç´¢å¼•</td>\n<td>å•åº“æ‰‹åŠ¨ç»´æŠ¤æˆ–é¿å…ä½¿ç”¨</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"3\">\n<li class=\"lvl-5\">æ–‡ä»¶å¯¼å…¥å¯¼å‡º</li>\n</ol>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>SQL åœºæ™¯</th>\n<th>åŸå› </th>\n<th>å»ºè®®å¤„ç†æ–¹å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>LOAD DATA INFILE</code></td>\n<td>Proxy ä¸æ”¯æŒæ–‡ä»¶ç³»ç»Ÿç›´æ¥è®¿é—®</td>\n<td>åœ¨åˆ†ç‰‡åº“æ‰‹åŠ¨æ‰§è¡Œæˆ–é€šè¿‡åº”ç”¨å¯¼å…¥</td>\n</tr>\n<tr>\n<td><code>SELECT ... INTO OUTFILE</code></td>\n<td>åŒä¸Š</td>\n<td>åº”ç”¨å±‚å¤„ç†å¯¼å‡º</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"4\">\n<li class=\"lvl-5\">MySQL ç‰¹æœ‰åŠŸèƒ½</li>\n</ol>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŠŸèƒ½</th>\n<th>æ”¯æŒæƒ…å†µ</th>\n<th>å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>MySQL 8.0 å…¬å…±è¡¨è¡¨è¾¾å¼ï¼ˆCTEï¼‰</td>\n<td>éƒ¨åˆ†æ”¯æŒ</td>\n<td>é¿å…è·¨åˆ†ç‰‡ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>çª—å£å‡½æ•°ï¼ˆ<code>OVER() PARTITION BY</code>ï¼‰</td>\n<td>éƒ¨åˆ†æ”¯æŒ</td>\n<td>é¿å…è·¨åˆ†ç‰‡å¤§æ•°æ®é‡ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>JSON å‡½æ•°</td>\n<td>åŸºæœ¬æ”¯æŒ</td>\n<td>å•è¡¨åœºæ™¯å¯ç”¨ï¼Œè·¨åˆ†ç‰‡éœ€è°¨æ…</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†å¸ƒå¼äº‹åŠ¡</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>é—®é¢˜åŸå› </th>\n<th>å»ºè®®å¤„ç†æ–¹å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>è·¨åˆ†ç‰‡åŸç”Ÿäº‹åŠ¡</td>\n<td>MySQL åŸç”Ÿäº‹åŠ¡ä¸æ”¯æŒè·¨åº“</td>\n<td>ä½¿ç”¨ ShardingSphere XA / BASE</td>\n</tr>\n<tr>\n<td>å¤§äº‹åŠ¡ + åˆ†å¸ƒå¼äº‹åŠ¡</td>\n<td>æ€§èƒ½å¼€é”€å¤§</td>\n<td>å°½é‡æ§åˆ¶äº‹åŠ¡èŒƒå›´</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€ æœ¬æ–‡å°† SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨ ä¿®æ”¹ä¸º ShardingSphere-Proxy çš„æ¨¡å¼ ShardingSphere-Proxy ç®€ä»‹ ShardingSphere-Proxy å®šä½ä¸ºé€æ˜åŒ–çš„æ•°æ®åº“ä»£ç†ç«¯ï¼Œé€šè¿‡å®ç°æ•°æ®åº“äºŒè¿›åˆ¶åè®®ï¼Œå¯¹å¼‚æ„è¯­è¨€æä¾›æ”¯æŒã€‚ ç›®å‰æä¾› MySQL å’Œ PostgreSQL åè®®ï¼Œé€æ˜åŒ–æ•°æ®åº“æ“ä½œï¼Œå¯¹ DBA æ›´åŠ å‹å¥½ã€‚ å‘åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ï¼Œå¯ç›´æ¥å½“åš MySQL/PostgreSQL ä½¿ç”¨ï¼› å…¼å®¹ MariaDB ç­‰åŸºäº MySQL åè®®çš„æ•°æ®åº“ï¼Œä»¥åŠ openGauss ç­‰åŸºäº PostgreSQL åè®®çš„æ•°æ®åº“ï¼› é€‚ç”¨äºä»»ä½•å…¼å®¹ MySQL/PostgreSQL åè®®çš„çš„å®¢æˆ·ç«¯ï¼Œå¦‚ï¼šMySQL Command Client, MySQL Workbench, Navicat ç­‰ã€‚ ShardingSphere-Proxy ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾ ShardingSphere-Proxy ä¸ ShardingSphere-JDBC çš„ç‰¹æ€§æ¯”è¾ƒ ç‰¹æ€§ ShardingSphere-JDBC ShardingSphere-Proxy æ•°æ®åº“æ”¯æŒ ä»»æ„æ•°æ®åº“ MySQL / PostgreSQL è¿æ¥æ¶ˆè€—æ•° é«˜ ä½ å¼‚æ„è¯­è¨€æ”¯æŒ ä»…æ”¯æŒ Java æ”¯æŒä»»æ„è¯­è¨€ æ€§èƒ½ æŸè€—ä½ æŸè€—ç•¥é«˜ æ— ä¸­å¿ƒåŒ– æ˜¯ å¦ é™æ€å…¥å£ æ—  æœ‰ éƒ¨ç½² ShardingSphere-Proxy è¿è¡Œ ShardingSphere-Proxy è¦æ±‚ JDK 1.8+ ä¸‹è½½ ShardingSphere-Proxy5.5.2 1234wget https://www.apache.org/dyn/closer.lua/shardingsphere/5.5.2/apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gztar -zxvf apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gzcd apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/ é…ç½® ShardingSphere-Proxy conf/global.yaml: å…¨å±€é…ç½®ï¼Œæ‰€è°“å…¨å±€ï¼Œå°±æ˜¯å¯¹æ‰€æœ‰é€»è¾‘åº“éƒ½ç”Ÿæ•ˆçš„é…ç½® 1234567891011121314151617181920212223# https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/authority/authority: users: - user: root@127.0.0.1 # æ ¼å¼ï¼šç”¨æˆ·å@IP password: root admin: true # æ˜¯å¦æ˜¯ç®¡ç†å‘˜ - user: sharding@% # æ‰€æœ‰IPéƒ½å¯ä»¥è®¿é—® password: sharding privilege: type: DATABASE_PERMITTED # æƒé™ç±»å‹ props: user-database-mappings: root@127.0.0.1=*,sharding@%=sharding_db # ç”¨æˆ·æƒé™æ˜ å°„ï¼Œ*è¡¨ç¤ºæ‰€æœ‰æ•°æ®åº“# å¼€å¯XAäº‹åŠ¡ï¼Œå¦‚æœæ˜¯ springbooté¡¹ç›®ï¼Œåªéœ€è¦åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Š @Transactional æ³¨è§£å³å¯å¼€å¯äº‹åŠ¡(ä» MySQL 5.7 å¼€å§‹å°±å…¨é¢æ”¯æŒ XA åˆ†å¸ƒå¼äº‹åŠ¡)# https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/transaction: # é…ç½®äº‹åŠ¡ defaultType: XA # äº‹åŠ¡ç±»å‹ï¼Œé»˜è®¤ LOCAL providerType: Atomikos # äº‹åŠ¡ç®¡ç†å™¨å…·ä½“å®ç°ï¼Œé»˜è®¤å°±æ˜¯ Atomikos# å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/props/props: sql-show: true # æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false check-table-metadata-enabled: false # åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false conf/database-my.yaml: è‡ªå®šä¹‰åˆ†é…è§„åˆ™é…ç½® æ³¨æ„: 1.åç§°å¿…é¡»ä»¥ database-å¼€å¤´ï¼Œå®é™…ä¸Šconfç›®å½•ä¸‹æœ‰å¾ˆå¤šç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé…ç½® 2.global.yamlä¸­çš„é…ç½®é¡¹ä¸èƒ½é…ç½®åˆ° database-my.yamlä¸­ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214# æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_dbdatabaseName: sharding_db# æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/dataSources: ds_0: # é€»è¾‘æ•°æ®æºåç§° # dataSourceClassName: com.zaxxer.hikari.HikariDataSource # ä¸è¦æŒ‡å®š # driverClassName: com.mysql.cj.jdbc.Driver # ä¸è¦æŒ‡å®š url: jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 # æ³¨æ„è¿™é‡Œå±æ€§ä¸º url username: root password: newpwd ds_1: # dataSourceClassName: com.zaxxer.hikari.HikariDataSource # driverClassName: com.mysql.cj.jdbc.Driver url: jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd# ä»¥ä¸‹è§„åˆ™ä¸å‰æ–‡ä¸­çš„ shardingsphere-jdbc ä¸­çš„ rules ç›¸åŒ# åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® # ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´ bindingTables: - t_order,t_order_item tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® course: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.course_$&#123;1..2&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: course_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: cid shardingAlgorithmName: course_inline keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: cid # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id shardingAlgorithmName: t_order-complex-algorithm keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id # åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš” shardingAlgorithmName: t_order_item-class-based-algorithm_spi # åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_user: actualDataNodes: ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_inline # åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: id # è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹ # keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° keyGeneratorName: custom_snowflake_string # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° # t_address: # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜ # actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹ autoTables: # è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½® t_order: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/ course_inline: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™ props: # å±æ€§ algorithm-expression: course_$&#123;cid % 2 + 1&#125; # è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2 allow-range-query-with-inline-sharding: true # å…è®¸èŒƒå›´æŸ¥è¯¢ course_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; # è¡¨ç¤º ds_0, ds_1 mod_2: type: MOD # åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³• props: sharding-count: 2 # åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™ t_order_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; t_order-complex-algorithm: type: COMPLEX_INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³• props: algorithm-expression: t_order_complex_$&#123;(user_id + order_id + 1) % 2&#125; t_order_item-class-based-algorithm_spi: # SPI type: T_ORDER_ITEM_COMPLEX # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• t_user_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;Math.abs(id.hashCode()%2)&#125; t_user_inline: type: INLINE props: algorithm-expression: t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125; keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong uuid: # å®šä¹‰åç§° type: UUID # å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString custom_snowflake_string: type: CUSTOM_SNOWFLAKE_STRING props: workerId: 2 datacenterId: 2 - !BROADCAST # å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª tables: - dict # å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚ - !ENCRYPT # æ•°æ®åŠ å¯†é…ç½® tables: t_user: # åŠ å¯†è¡¨åç§° columns: password: # åŠ å¯†åˆ—åç§° cipher: name: password # å¯†æ–‡åˆ—åç§° encryptorName: aes_encryptor # å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§° # åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/ encryptors: aes_encryptor: # åŠ è§£å¯†ç®—æ³•åç§° type: AES # åŠ è§£å¯†ç®—æ³•ç±»å‹ props: # åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½® aes-key-value: 123456abc # AES ä½¿ç”¨çš„ KEY digest-algorithm-name: SHA-1 # AES KEY çš„æ‘˜è¦ç®—æ³• md5_encryptor: type: MD5 props: salt: 123456 # ç›å€¼ï¼ˆå¯é€‰ï¼‰ - !MASK # æ•°æ®è„±æ•é…ç½® tables: t_user: # è„±æ•è¡¨åç§° columns: # è„±æ•åˆ—é…ç½® password: # è„±æ•åˆ—åç§° maskAlgorithm: md5_mask # è„±æ•ç®—æ³•åç§° email: maskAlgorithm: mask_before_special_chars_mask telephone: maskAlgorithm: keep_first_n_last_m_mask name: maskAlgorithm: my_mask maskAlgorithms: # è„±æ•ç®—æ³•é…ç½® md5_mask: # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° type: MD5 # è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º mask_before_special_chars_mask: type: MASK_BEFORE_SPECIAL_CHARS # åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com props: special-chars: &#x27;@&#x27; # é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ• replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ keep_first_n_last_m_mask: type: KEEP_FIRST_N_LAST_M # ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678 props: first-n: 3 # ä¿ç•™å‰ 3 ä½ last-m: 4 # ä¿ç•™å 4 ä½ replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ my_mask: type: MY_CUSTOM_MASK # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° props: replace-char: &quot;#&quot; - !SINGLE # å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™ tables: # MySQL é£æ ¼ - ds_0.t_address # åŠ è½½æŒ‡å®šå•è¡¨# - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨# - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨ ä¸Šé¢çš„rulesä¸­ä½¿ç”¨çš„æ˜¯mysqlæ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥mysqlæ•°æ®åº“çš„ä¾èµ– 1234cd apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/mkdir ext-libcd ext-libwget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar åŒæ—¶rulesä¸­åŒ…å«ä¸€äº›è‡ªå®šä¹‰çš„ç®—æ³•ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†è¿™äº›ç®—æ³•ä½œä¸ºä¾èµ–è¿›è¡Œå¼•å…¥ï¼Œå°†è¿™äº›ç®—æ³•ç±»æ‰“æˆjarï¼Œç„¶åä¹Ÿæ‹·è´åˆ°ext-libç›®å½•ä¸‹ï¼Œæˆ‘å·²ç»å°†å…¶å‘å¸ƒåˆ°äº†githubä¸Šï¼Œå®é™…ä¸Šå’Œå‰æ–‡ä¸­çš„ shardingsphere-jdbc é¡¹ç›®ä¸­å°†ç®—æ³•é…ç½®ä¸º spi çš„æ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚ 123456789101112131415# 1. åªå…‹éš†ä»“åº“çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¸ä¸‹è½½æ‰€æœ‰æ–‡ä»¶git clone --filter=blob:none --sparse https://github.com/hanqunfeng/springbootchapter.git# 2. è¿›å…¥ä»“åº“ç›®å½•cd springbootchapter# 3. è®¾ç½®åªæ£€å‡ºä½ éœ€è¦çš„ç›®å½•git sparse-checkout set springboot3-demo/shardingsphere-demo/algorithm-swapper# 4. ç¼–è¯‘æ‰“åŒ…cd springboot3-demo/shardingsphere-demo/algorithm-swappermvn clean package -DskipTests# 5. å°†æ‰“å¥½çš„åŒ…å¤åˆ¶åˆ° shardingsphere-proxy çš„ ext-lib ç›®å½•ä¸‹cp target/algorithm-swapper-1.0.0.jar $shardingsphere-proxy$/ext-lib å¯åŠ¨ä¸å…³é—­ ShardingSphere Proxy ShardingSphere Proxy è¦æ±‚ JDK 1.8 æˆ–ä»¥ä¸Šç‰ˆæœ¬ 12345cd $shardingsphere-proxy$/bin# å¯åŠ¨./start.sh# å…³é—­./stop.sh å‚æ•°è¯´æ˜ å‚æ•° è¯´æ˜ é»˜è®¤å€¼ -a ç»‘å®šåœ°å€ï¼Œå¯ä»¥æ˜¯ IPv4ã€IPv6 æˆ–ä¸»æœºåï¼Œå¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”ã€‚ 0.0.0.0 -p ç»‘å®šç«¯å£å·ï¼Œå¯ä»¥åœ¨ global.yaml ä¸­ä¿®æ”¹ã€‚-p ä¼˜å…ˆçº§æ›´é«˜ 3307 -c ShardingSphere-Proxy é…ç½®ç›®å½•è·¯å¾„ã€‚ conf -f å¼ºåˆ¶å¯åŠ¨ ShardingSphere-Proxyã€‚ æ—  -g å¦‚æœåœ¨ agent ç›®å½•ä¸‹éƒ¨ç½²äº† shardingsphere-agentï¼Œå¯ç”¨ agent åŠŸèƒ½ã€‚ æ—  -s æŒ‡å®šç”¨äºè¿æ¥çš„ socket æ–‡ä»¶è·¯å¾„ã€‚ æ—  ShardingSphere-Proxy å¯åŠ¨å‘½ä»¤é€ŸæŸ¥è¡¨ åœºæ™¯ å‘½ä»¤ç¤ºä¾‹ è¯´æ˜ é»˜è®¤å¯åŠ¨ ./start.sh é»˜è®¤ç«¯å£ 3307ï¼Œé…ç½®ç›®å½• conf æŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½• ./start.sh 3308 /opt/shardingsphere-proxy/conf ç®€å†™æ¨¡å¼ï¼ŒæŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½• å‚æ•°å½¢å¼å¯åŠ¨ ./start.sh -p 3308 -c /opt/shardingsphere-proxy/conf ä¸ä¸Šé¢ç­‰æ•ˆï¼Œä½†æ›´æ˜ç¡® æŒ‡å®šç›‘å¬åœ°å€ ./start.sh -a 192.168.1.100 -p 3307 -c conf æŒ‡å®šå•ä¸ª IP åœ°å€ æŒ‡å®šå¤šä¸ªç›‘å¬åœ°å€ ./start.sh -a 192.168.1.100,127.0.0.1 -p 3307 -c conf å¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš” å¼ºåˆ¶å¯åŠ¨ ./start.sh -p 3307 -c conf -f é‡åˆ°æ®‹ç•™ PID æ–‡ä»¶æ—¶ä½¿ç”¨ å¯ç”¨ agent ./start.sh -p 3307 -c conf -g å¯åŠ¨ ShardingSphere-Agent ä½¿ç”¨ Unix Socket ./start.sh -p 3307 -c conf -s /tmp/sharding-proxy.sock é€šè¿‡ Socket æ–‡ä»¶è¿›è¡Œè¿æ¥ å¤šé€‰é¡¹ç»„åˆ ./start.sh -a 127.0.0.1 -p 3310 -c /opt/proxy/conf -f -g -s /tmp/proxy.sock ä¸€æ¬¡æ€§æŒ‡å®šå¤šä¸ªé€‰é¡¹ é¡¹ç›®è¿æ¥ ShardingSphere-Proxy æ—¶ï¼Œå°±åƒè¿æ¥æ™®é€šçš„ mysql æœåŠ¡ä¸€æ · ç¤ºä¾‹é¡¹ç›®ï¼šhttps://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy åè®° åœ¨ ShardingSphere-JDBC å’Œ ShardingSphere-Proxy ä¸­ï¼Œå­˜åœ¨éƒ¨åˆ† MySQL(å…¶å®ƒæ•°æ®åº“ä¹Ÿç±»ä¼¼) çš„ SQL è¯­æ³•æˆ–åŠŸèƒ½ç›®å‰è¿˜ä¸å®Œå…¨æ”¯æŒçš„æƒ…å†µã€‚ShardingSphere åœ¨åš SQL è·¯ç”±ã€æ”¹å†™ã€æ‰§è¡Œæ—¶ï¼Œå¿…é¡»èƒ½è§£æ SQL å¹¶ç†è§£å…¶è¯­ä¹‰ï¼Œä½†å¹¶ä¸æ˜¯ MySQL çš„ 100% å®Œå…¨ä»£ç†ã€‚å› æ­¤ï¼Œæœ‰äº›å¤æ‚æˆ–ç‰¹å®šåœºæ™¯ä¸‹çš„ SQL å¯èƒ½æ— æ³•è¢«æ­£ç¡®è§£ææˆ–æ‰§è¡Œã€‚ æ”¯æŒè‰¯å¥½çš„ SQL è¯­æ³• åŸºç¡€ DML SELECTã€INSERTã€UPDATEã€DELETE åŸºæœ¬çš„æ¡ä»¶æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µã€åˆ†ç»„ã€èšåˆå‡½æ•°ï¼ˆå¦‚ COUNTã€SUMã€AVGï¼‰ DCL åŸºæœ¬çš„äº‹åŠ¡è¯­å¥ï¼šBEGINã€COMMITã€ROLLBACK DDL éƒ¨åˆ†è¡¨ç»“æ„ç®¡ç†è¯­å¥ï¼šCREATE TABLEã€ALTER TABLEã€DROP TABLE å‡½æ•°æ”¯æŒ å¤§éƒ¨åˆ†å¸¸ç”¨çš„ MySQL å†…ç½®å‡½æ•°ï¼Œå¦‚å­—ç¬¦ä¸²ã€æ•°å­¦ã€æ—¥æœŸå‡½æ•° åœ¨ ShardingSphere + MySQL ä¸‹å»ºè®®é¿å…æˆ–è°¨æ…ä½¿ç”¨çš„ SQL æ¸…å• è·¨åˆ†ç‰‡å¤æ‚æŸ¥è¯¢ SQL åœºæ™¯ åŸå›  å»ºè®®å¤„ç†æ–¹å¼ å¤šè¡¨å¤æ‚ JOINï¼ˆç‰¹åˆ«æ˜¯è·¨åˆ†ç‰‡ï¼‰ éœ€è¦è·¨åº“æ•°æ®èšåˆï¼Œæ€§èƒ½å·®ï¼Œå¯èƒ½æŠ¥é”™ ä½¿ç”¨å¹¿æ’­è¡¨/ç»‘å®šè¡¨ï¼Œæˆ–åœ¨åº”ç”¨å±‚å®Œæˆ è·¨åˆ†ç‰‡å­æŸ¥è¯¢ SQL è·¯ç”±å›°éš¾ï¼Œå¯èƒ½ä¸æ”¯æŒ å°½é‡æ”¹æˆå•è¡¨æŸ¥è¯¢æˆ–åˆ†æ­¥æŸ¥è¯¢ è·¨åˆ†ç‰‡çš„ GROUP BY / ORDER BY åœ¨ Proxy å±‚èšåˆï¼Œæ€§èƒ½å¾ˆå·® å°½é‡é¿å…ï¼Œæˆ–æ§åˆ¶æ•°æ®é‡ DDL ç›¸å…³ SQL åœºæ™¯ åŸå›  å»ºè®®å¤„ç†æ–¹å¼ ALTER TABLE å¤æ‚å˜æ›´ éœ€åœ¨æ‰€æœ‰åˆ†ç‰‡æ‰§è¡Œï¼Œå¯èƒ½æ‰§è¡Œå¤±è´¥ æ‰‹åŠ¨åœ¨æ¯ä¸ªåˆ†ç‰‡åº“æ‰§è¡Œ CREATE TRIGGERã€PROCEDURE Proxy ä¸è§£æè¿™äº›è¯­æ³•ï¼Œç›´æ¥é€ä¼ ä¸å®‰å…¨ å°½é‡åœ¨å•åº“æ‰‹åŠ¨åˆ›å»º CREATE FUNCTION åŒä¸Š å•åº“æ‰§è¡Œæˆ–åº”ç”¨å±‚æ›¿ä»£ FULLTEXT INDEXã€SPATIAL INDEX åˆ†ç‰‡ç¯å¢ƒä¸‹æ— æ³•è‡ªåŠ¨ç»´æŠ¤ç´¢å¼• å•åº“æ‰‹åŠ¨ç»´æŠ¤æˆ–é¿å…ä½¿ç”¨ æ–‡ä»¶å¯¼å…¥å¯¼å‡º SQL åœºæ™¯ åŸå›  å»ºè®®å¤„ç†æ–¹å¼ LOAD DATA INFILE Proxy ä¸æ”¯æŒæ–‡ä»¶ç³»ç»Ÿç›´æ¥è®¿é—® åœ¨åˆ†ç‰‡åº“æ‰‹åŠ¨æ‰§è¡Œæˆ–é€šè¿‡åº”ç”¨å¯¼å…¥ SELECT ... INTO OUTFILE åŒä¸Š åº”ç”¨å±‚å¤„ç†å¯¼å‡º MySQL ç‰¹æœ‰åŠŸèƒ½ åŠŸèƒ½ æ”¯æŒæƒ…å†µ å»ºè®® MySQL 8.0 å…¬å…±è¡¨è¡¨è¾¾å¼ï¼ˆCTEï¼‰ éƒ¨åˆ†æ”¯æŒ é¿å…è·¨åˆ†ç‰‡ä½¿ç”¨ çª—å£å‡½æ•°ï¼ˆOVER() PARTITION BYï¼‰ éƒ¨åˆ†æ”¯æŒ é¿å…è·¨åˆ†ç‰‡å¤§æ•°æ®é‡ä½¿ç”¨ JSON å‡½æ•° åŸºæœ¬æ”¯æŒ å•è¡¨åœºæ™¯å¯ç”¨ï¼Œè·¨åˆ†ç‰‡éœ€è°¨æ… åˆ†å¸ƒå¼äº‹åŠ¡ åœºæ™¯ é—®é¢˜åŸå›  å»ºè®®å¤„ç†æ–¹å¼ è·¨åˆ†ç‰‡åŸç”Ÿäº‹åŠ¡ MySQL åŸç”Ÿäº‹åŠ¡ä¸æ”¯æŒè·¨åº“ ä½¿ç”¨ ShardingSphere XA / BASE å¤§äº‹åŠ¡ + åˆ†å¸ƒå¼äº‹åŠ¡ æ€§èƒ½å¼€é”€å¤§ å°½é‡æ§åˆ¶äº‹åŠ¡èŒƒå›´","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€ æœ¬æ–‡å°† SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨ ä¿®æ”¹ä¸º ShardingSphere-Proxy çš„æ¨¡å¼","date_published":"2025-09-04T13:30:05.000Z","tags":["æŠ€æœ¯","springboot","sharding-sphere","springboot","sharding-sphere"]},{"id":"https://blog.hanqunfeng.com/2025/09/01/springboot3-shardingsphere/","url":"https://blog.hanqunfeng.com/2025/09/01/springboot3-shardingsphere/","title":"SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/index_zh.html\">ShardingSphereå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-01\">æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ShardingSphere-JDBC-ç®€ä»‹\">ShardingSphere-JDBC ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere-JDBC å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">é€‚ç”¨äºä»»ä½•åŸºäº JDBC çš„ ORM æ¡†æ¶ï¼Œå¦‚ï¼šJPA, Hibernate, Mybatis, Spring JDBC Template æˆ–ç›´æ¥ä½¿ç”¨ JDBCï¼›</li>\n<li class=\"lvl-4\">æ”¯æŒä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, HikariCP ç­‰ï¼›</li>\n<li class=\"lvl-4\">æ”¯æŒä»»æ„å®ç° JDBC è§„èŒƒçš„æ•°æ®åº“ï¼Œç›®å‰æ”¯æŒ MySQLï¼ŒPostgreSQLï¼ŒOracleï¼ŒSQLServer ä»¥åŠä»»ä½•å¯ä½¿ç”¨ JDBC è®¿é—®çš„æ•°æ®åº“ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ShardingSphere-JDBC ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/RgXClY.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"mavenä¾èµ–\">mavenä¾èµ–</h2>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- æœ¬é¡¹ç›® åŸºäº mysql --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.baomidou<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.5.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.shardingsphere<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>shardingsphere-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.5.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"application-yml\">application.yml</h2>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">org.apache.shardingsphere.driver.ShardingSphereDriver</span></span><br><span class=\"line\">    <span class=\"comment\"># æŒ‡å‘ç±»è·¯å¾„ä¸‹çš„ sharding.yamlï¼ˆä¹Ÿå¯ absolute path / file: / http: ç­‰ï¼Œè§å®˜æ–¹è¯´æ˜ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:shardingsphere:classpath:sharding.yaml</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥ä¸åœ¨ <code>application.yml</code> ä¸­é…ç½®ï¼Œè€Œæ˜¯é€šè¿‡ <code>@Configuration</code> åˆ›å»º <code>@Bean</code>ï¼Œè¿™æ ·å°±å¯ä»¥é…ç½®å¤šæ•°æ®æºäº†ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DataSourceConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean(name = &quot;shardingDataSource&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DataSource <span class=\"title function_\">shardingDataSource</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> SQLException, IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ShardingSphere æä¾›çš„å·¥å‚æ–¹æ³•ï¼Œæ ¹æ®é…ç½®æ„å»º DataSource</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">InputStream</span> <span class=\"variable\">inputStream</span> <span class=\"operator\">=</span> getClass().getClassLoader().getResourceAsStream(<span class=\"string\">&quot;sharding.yaml&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (inputStream == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;Cannot find sharding.yaml in classpath&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"type\">byte</span>[] yamlBytes = inputStream.readAllBytes();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> YamlShardingSphereDataSourceFactory.createDataSource(yamlBytes);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"sharding-yaml\">sharding.yaml</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®Œæ•´é…ç½®ï¼Œä¸‹æ–‡ä¼šä»‹ç»éƒ¨åˆ†é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/</span></span><br><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_0:</span> <span class=\"comment\"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.zaxxer.hikari.HikariDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">jdbcUrl:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">ds_1:</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.zaxxer.hikari.HikariDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">jdbcUrl:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"comment\"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">bindingTables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">t_order,t_order_item</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">course:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">cid</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_inline</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">cid</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order-complex-algorithm</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class=\"line\"><span class=\"comment\">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_item-class-based-algorithm_spi</span> <span class=\"comment\"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class=\"line\"><span class=\"comment\">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">custom_snowflake_string</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#       t_address:      # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜</span></span><br><span class=\"line\"><span class=\"comment\">#         actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">autoTables:</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/</span></span><br><span class=\"line\">      <span class=\"attr\">course_inline:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># å±æ€§</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">course_$&#123;cid</span> <span class=\"string\">%</span> <span class=\"number\">2</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class=\"line\">          <span class=\"attr\">allow-range-query-with-inline-sharding:</span> <span class=\"literal\">true</span> <span class=\"comment\"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class=\"line\">      <span class=\"attr\">course_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class=\"line\">      <span class=\"attr\">mod_2:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MOD</span> <span class=\"comment\"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">sharding-count:</span> <span class=\"number\">2</span> <span class=\"comment\"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order-complex-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">COMPLEX_INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_order_complex_$&#123;(user_id</span> <span class=\"string\">+</span> <span class=\"string\">order_id</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">)</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CLASS_BASED</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">strategy:</span> <span class=\"string\">COMPLEX</span> <span class=\"comment\"># æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">algorithmClassName:</span> <span class=\"string\">com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm</span> <span class=\"comment\"># æŒ‡å®šç®—æ³•ç±»</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm_spi:</span> <span class=\"comment\"># SPI</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">T_ORDER_ITEM_COMPLEX</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br><span class=\"line\">      <span class=\"attr\">uuid:</span>    <span class=\"comment\"># å®šä¹‰åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">UUID</span> <span class=\"comment\"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class=\"line\">      <span class=\"attr\">custom_snowflake_string:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CUSTOM_SNOWFLAKE_STRING</span>  <span class=\"comment\"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒString</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">workerId:</span> <span class=\"number\">2</span></span><br><span class=\"line\">          <span class=\"attr\">datacenterId:</span> <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!BROADCAST</span>  <span class=\"comment\"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">dict</span>    <span class=\"comment\"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!ENCRYPT</span>    <span class=\"comment\"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># åŠ å¯†è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># åŠ å¯†åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">cipher:</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">password</span> <span class=\"comment\"># å¯†æ–‡åˆ—åç§°</span></span><br><span class=\"line\">              <span class=\"attr\">encryptorName:</span> <span class=\"string\">aes_encryptor</span> <span class=\"comment\"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class=\"line\">    <span class=\"attr\">encryptors:</span></span><br><span class=\"line\">      <span class=\"attr\">aes_encryptor:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">AES</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">aes-key-value:</span> <span class=\"string\">123456abc</span>     <span class=\"comment\"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class=\"line\">          <span class=\"attr\">digest-algorithm-name:</span> <span class=\"string\">SHA-1</span> <span class=\"comment\"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">md5_encryptor:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">salt:</span> <span class=\"number\">123456</span>  <span class=\"comment\"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!MASK</span>  <span class=\"comment\"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># è„±æ•è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span>  <span class=\"comment\"># è„±æ•åˆ—é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># è„±æ•åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">md5_mask</span> <span class=\"comment\"># è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">email:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">mask_before_special_chars_mask</span></span><br><span class=\"line\">          <span class=\"attr\">telephone:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">keep_first_n_last_m_mask</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">my_mask</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">maskAlgorithms:</span> <span class=\"comment\"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">md5_mask:</span> <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span>  <span class=\"comment\"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class=\"line\">      <span class=\"attr\">mask_before_special_chars_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MASK_BEFORE_SPECIAL_CHARS</span> <span class=\"comment\"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">special-chars:</span> <span class=\"string\">&#x27;@&#x27;</span>  <span class=\"comment\"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span>   <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">keep_first_n_last_m_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">KEEP_FIRST_N_LAST_M</span> <span class=\"comment\"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">first-n:</span> <span class=\"number\">3</span>     <span class=\"comment\"># ä¿ç•™å‰ 3 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">last-m:</span> <span class=\"number\">4</span>      <span class=\"comment\"># ä¿ç•™å 4 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">my_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MY_CUSTOM_MASK</span>  <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&quot;#&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SINGLE</span> <span class=\"comment\"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"comment\"># MySQL é£æ ¼</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ds_0.t_address</span> <span class=\"comment\"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br><span class=\"line\"><span class=\"comment\">#       - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨</span></span><br><span class=\"line\"><span class=\"comment\">#       - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/</span></span><br><span class=\"line\"><span class=\"attr\">props:</span></span><br><span class=\"line\">  <span class=\"attr\">sql-show:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class=\"line\">  <span class=\"attr\">check-table-metadata-enabled:</span> <span class=\"literal\">false</span> <span class=\"comment\"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"æ•°æ®æºé…ç½®\">æ•°æ®æºé…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>hikari + mysql</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_0:</span> <span class=\"comment\"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.zaxxer.hikari.HikariDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">jdbcUrl:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">ds_1:</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.zaxxer.hikari.HikariDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">jdbcUrl:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>druid + mysql</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_1:</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\">    <span class=\"comment\"># Druid ç‰¹æœ‰é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">initialSize:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">minIdle:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">maxActive:</span> <span class=\"number\">20</span></span><br><span class=\"line\">    <span class=\"attr\">maxWait:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">    <span class=\"attr\">testWhileIdle:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">validationQuery:</span> <span class=\"string\">SELECT</span> <span class=\"number\">1</span> <span class=\"string\">FROM</span> <span class=\"string\">DUAL</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>druid + mysql + p6spy</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_0:</span> <span class=\"comment\"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.p6spy.engine.spy.P6SpyDriver</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:p6spy:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\">    <span class=\"comment\"># Druid ç‰¹æœ‰é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">initialSize:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">minIdle:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">maxActive:</span> <span class=\"number\">20</span></span><br><span class=\"line\">    <span class=\"attr\">maxWait:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">    <span class=\"attr\">testWhileIdle:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">validationQuery:</span> <span class=\"string\">SELECT</span> <span class=\"number\">1</span> <span class=\"string\">FROM</span> <span class=\"string\">DUAL</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ†åº“åˆ†è¡¨é…ç½®\">åˆ†åº“åˆ†è¡¨é…ç½®</h3>\n<h4 id=\"å•åˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹\">å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">course:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">cid</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_inline</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">cid</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">course_inline:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># å±æ€§</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">course_$&#123;cid</span> <span class=\"string\">%</span> <span class=\"number\">2</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class=\"line\">          <span class=\"attr\">allow-range-query-with-inline-sharding:</span> <span class=\"literal\">true</span> <span class=\"comment\"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class=\"line\">      <span class=\"attr\">course_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ä¸åŒçš„å­—æ®µï¼Œåˆ†åº“ä½¿ç”¨ user_idï¼Œåˆ†è¡¨ä½¿ç”¨ cid</p>\n</li>\n<li class=\"lvl-2\">\n<p>allow-range-query-with-inline-sharding: true ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå…è®¸èŒƒå›´æŸ¥è¯¢ï¼Œé»˜è®¤å€¼æ˜¯ falseï¼Œä¸å…è®¸ between æŸ¥è¯¢</p>\n</li>\n</ul>\n<h4 id=\"å•åˆ†ç‰‡é”®ï¼ŒString-ç±»å‹\">å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class=\"line\"><span class=\"comment\">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">custom_snowflake_string</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span> <span class=\"comment\"># åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®—</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span> <span class=\"comment\"># åˆ†è¡¨ï¼Œt_user_0, t_user_1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">uuid:</span>    <span class=\"comment\"># å®šä¹‰åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">UUID</span> <span class=\"comment\"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class=\"line\">      <span class=\"attr\">custom_snowflake_string:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CUSTOM_SNOWFLAKE_STRING</span> <span class=\"comment\"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">workerId:</span> <span class=\"number\">2</span></span><br><span class=\"line\">          <span class=\"attr\">datacenterId:</span> <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ç›¸åŒçš„å­—æ®µï¼Œå³ä¸»é”®idï¼Œå› å…¶ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ hashCode() è·å–æ•°å­—ï¼Œå†è¿›è¡Œè¿ç®—</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸»é”®è·å–è§„åˆ™ä½¿ç”¨çš„è‡ªå®šä¹‰çš„é›ªèŠ±ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.infra.algorithm.keygen.core.KeyGenerateAlgorithm</code>ï¼Œè¿™é‡Œæ³¨æ„ï¼Œä» <code>5.5.3</code> å¼€å§‹ä¼šæ›´æ¢ä¸º <code>org.apache.shardingsphere.infra.algorithm.keygen.spi.KeyGenerateAlgorithm</code></p>\n</li>\n</ul>\n<h4 id=\"å¤šåˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹\">å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order-complex-algorithm</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class=\"line\"><span class=\"comment\">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_item-class-based-algorithm_spi</span> <span class=\"comment\"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order-complex-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">COMPLEX_INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_order_complex_$&#123;(user_id</span> <span class=\"string\">+</span> <span class=\"string\">order_id</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">)</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CLASS_BASED</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">strategy:</span> <span class=\"string\">COMPLEX</span> <span class=\"comment\"># æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">algorithmClassName:</span> <span class=\"string\">com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm</span> <span class=\"comment\"># æŒ‡å®šç®—æ³•ç±»</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm_spi:</span> <span class=\"comment\"># SPI</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">T_ORDER_ITEM_COMPLEX</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤šä¸ªåˆ†ç‰‡é”®ï¼Œ<code>t_order_complex</code>è¡¨ä½¿ç”¨äº†å†…ç½®çš„<code>COMPLEX_INLINE</code>ç®—æ³•ï¼Œè€Œ<code>t_order_item_complex</code>è¡¨ä½¿ç”¨äº†è‡ªå®šä¹‰çš„çš„åˆ†ç‰‡ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.sharding.spi.ShardingAlgorithm</code></p>\n</li>\n</ul>\n<h4 id=\"è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™\">è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">   <span class=\"comment\"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">bindingTables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">t_order,t_order_item</span></span><br><span class=\"line\">    <span class=\"attr\">autoTables:</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">mod_2:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MOD</span> <span class=\"comment\"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">sharding-count:</span> <span class=\"number\">2</span> <span class=\"comment\"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™éœ€è¦å£°æ˜æ•°æ®åº“ï¼Œä½†ä¸éœ€è¦å£°æ˜è¡¨åˆ†é…è§„åˆ™ï¼Œå…¶æ ¹æ®åˆ†ç‰‡ç®—æ³•è‡ªåŠ¨ç¡®å®šå…·ä½“çš„æ•°æ®è¡¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŒæ—¶è¿™é‡Œè¿˜é…ç½®äº†<code>bindingTables</code>ï¼Œç”¨æ¥æŒ‡å®šå…¶åˆ†ç‰‡è·¯ç”±ä¸€è‡´ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å¹¿æ’­è¡¨é…ç½®\">å¹¿æ’­è¡¨é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!BROADCAST</span>  <span class=\"comment\"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">dict</span>    <span class=\"comment\"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"æ•°æ®åŠ å¯†è§„åˆ™\">æ•°æ®åŠ å¯†è§„åˆ™</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!ENCRYPT</span>    <span class=\"comment\"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># åŠ å¯†è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># åŠ å¯†åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">cipher:</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">password</span> <span class=\"comment\"># å¯†æ–‡åˆ—åç§°</span></span><br><span class=\"line\">              <span class=\"attr\">encryptorName:</span> <span class=\"string\">aes_encryptor</span> <span class=\"comment\"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class=\"line\">    <span class=\"attr\">encryptors:</span></span><br><span class=\"line\">      <span class=\"attr\">aes_encryptor:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">AES</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">aes-key-value:</span> <span class=\"string\">123456abc</span>     <span class=\"comment\"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class=\"line\">          <span class=\"attr\">digest-algorithm-name:</span> <span class=\"string\">SHA-1</span> <span class=\"comment\"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">md5_encryptor:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">salt:</span> <span class=\"number\">123456</span>  <span class=\"comment\"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®åŠ å¯†å­—æ®µè§„åˆ™åï¼Œæ–°å¢æ•°æ®æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¹åŠ å¯†å­—æ®µåŠ å¯†åå­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶ä¹Ÿä¼šåŠ å¯†åè¿›è¡Œæ¯”è¾ƒæŸ¥è¯¢ã€‚</p>\n</li>\n</ul>\n<h3 id=\"æ•°æ®è„±æ•è§„åˆ™\">æ•°æ®è„±æ•è§„åˆ™</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!MASK</span>  <span class=\"comment\"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># è„±æ•è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span>  <span class=\"comment\"># è„±æ•åˆ—é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># è„±æ•åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">md5_mask</span> <span class=\"comment\"># è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">email:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">mask_before_special_chars_mask</span></span><br><span class=\"line\">          <span class=\"attr\">telephone:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">keep_first_n_last_m_mask</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">my_mask</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">maskAlgorithms:</span> <span class=\"comment\"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">md5_mask:</span> <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span>  <span class=\"comment\"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class=\"line\">      <span class=\"attr\">mask_before_special_chars_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MASK_BEFORE_SPECIAL_CHARS</span> <span class=\"comment\"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">special-chars:</span> <span class=\"string\">&#x27;@&#x27;</span>  <span class=\"comment\"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span>   <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">keep_first_n_last_m_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">KEEP_FIRST_N_LAST_M</span> <span class=\"comment\"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">first-n:</span> <span class=\"number\">3</span>     <span class=\"comment\"># ä¿ç•™å‰ 3 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">last-m:</span> <span class=\"number\">4</span>      <span class=\"comment\"># ä¿ç•™å 4 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">my_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MY_CUSTOM_MASK</span>  <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&quot;#&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¢«è„±æ•çš„å­—æ®µåœ¨æŸ¥è¯¢æ—¶ä¼šè¿›è¡Œè„±æ•å±•ç¤ºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¿˜è‡ªå®šä¹‰äº†è„±æ•ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.mask.spi.MaskAlgorithm</code></p>\n</li>\n</ul>\n<h3 id=\"å•è¡¨è§„åˆ™\">å•è¡¨è§„åˆ™</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å³ä¸éœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨çš„è¡¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SINGLE</span> <span class=\"comment\"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"comment\"># MySQL é£æ ¼</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ds_0.t_address</span> <span class=\"comment\"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å±æ€§é…ç½®\">å±æ€§é…ç½®</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/</span></span><br><span class=\"line\"><span class=\"attr\">props:</span></span><br><span class=\"line\">  <span class=\"attr\">sql-show:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class=\"line\">  <span class=\"attr\">check-table-metadata-enabled:</span> <span class=\"literal\">false</span> <span class=\"comment\"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"äº‹åŠ¡é…ç½®\">äº‹åŠ¡é…ç½®</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/</span></span><br><span class=\"line\"><span class=\"attr\">transaction:</span></span><br><span class=\"line\">  <span class=\"attr\">defaultType:</span> <span class=\"string\">LOCAL</span> <span class=\"comment\"># é»˜è®¤äº‹åŠ¡ç±»å‹å°±æ˜¯ LOCAL</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ä¸ springboot2 ä¸åŒï¼Œä¸å†æä¾› <code>springboot-starter-shardingsphere</code>ï¼Œç›¸å…³é…ç½®ä¹Ÿé‡‡ç”¨äº†ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»£ç ä¸­åŒ…å«ä¸¤ä¸ªåº“ä¸­ä½¿ç”¨åˆ°çš„æ•°æ®åº“è„šæœ¬ï¼Œ<code>shardingsphere-demo/shardingsphere-demo-01/sql</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>å…·ä½“ä½¿ç”¨æ•ˆæœå¯ä»¥é€šè¿‡é¡¹ç›®ä¸­æä¾›çš„å•å…ƒæµ‹è¯•ç±»è¿›è¡ŒéªŒè¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ç›®å‰<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/jdbc-driver/spring-boot/\">å°šä¸æ”¯æŒ <code>XA</code> åˆ†å¸ƒå¼äº‹åŠ¡</a>ï¼Œè¿™æ˜¯å› ä¸ºä» <code>Spring Boot 3.x</code> å¼€å§‹ï¼Œå°±å…¨é¢è¿ç§»åˆ°äº† <code>Jakarta EE 9+</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ <code>javax.*</code> çš„ç±»éƒ½è¿ç§»åˆ° <code>jakarta.*</code> å‘½åç©ºé—´(äº‹åŠ¡ã€JPAã€Servlet ç­‰ API éƒ½å—å½±å“)ï¼Œè€Œ <code>ShardingSphere 5.5</code> ä¸­çš„ XA äº‹åŠ¡ä¸»è¦ä¾èµ– <code>Atomikos</code> æˆ– <code>Narayana</code> ç­‰ç¬¬ä¸‰æ–¹åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†å™¨ï¼Œè¿™äº›åº“ç›®å‰å¤§éƒ¨åˆ†è¿˜æ˜¯åŸºäº <code>javax.transaction.*</code> çš„ APIã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€ ShardingSphere-JDBC ç®€ä»‹ ShardingSphere-JDBC å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚ é€‚ç”¨äºä»»ä½•åŸºäº JDBC çš„ ORM æ¡†æ¶ï¼Œå¦‚ï¼šJPA, Hibernate, Mybatis, Spring JDBC Template æˆ–ç›´æ¥ä½¿ç”¨ JDBCï¼› æ”¯æŒä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, HikariCP ç­‰ï¼› æ”¯æŒä»»æ„å®ç° JDBC è§„èŒƒçš„æ•°æ®åº“ï¼Œç›®å‰æ”¯æŒ MySQLï¼ŒPostgreSQLï¼ŒOracleï¼ŒSQLServer ä»¥åŠä»»ä½•å¯ä½¿ç”¨ JDBC è®¿é—®çš„æ•°æ®åº“ã€‚ ShardingSphere-JDBC ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾ mavenä¾èµ– 123456789101112131415161718&lt;!-- æœ¬é¡¹ç›® åŸºäº mysql --&gt;&lt;dependency&gt; &lt;groupId&gt;com.mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-spring-boot3-starter&lt;/artifactId&gt; &lt;version&gt;3.5.12&lt;/version&gt;&lt;/dependency&gt;&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;shardingsphere-jdbc&lt;/artifactId&gt; &lt;version&gt;5.5.2&lt;/version&gt;&lt;/dependency&gt; application.yml 12345spring: datasource: driver-class-name: org.apache.shardingsphere.driver.ShardingSphereDriver # æŒ‡å‘ç±»è·¯å¾„ä¸‹çš„ sharding.yamlï¼ˆä¹Ÿå¯ absolute path / file: / http: ç­‰ï¼Œè§å®˜æ–¹è¯´æ˜ï¼‰ url: jdbc:shardingsphere:classpath:sharding.yaml ä¹Ÿå¯ä»¥ä¸åœ¨ application.yml ä¸­é…ç½®ï¼Œè€Œæ˜¯é€šè¿‡ @Configuration åˆ›å»º @Beanï¼Œè¿™æ ·å°±å¯ä»¥é…ç½®å¤šæ•°æ®æºäº†ã€‚ 123456789101112131415@Configurationpublic class DataSourceConfig &#123; @Bean(name = &quot;shardingDataSource&quot;) public DataSource shardingDataSource() throws SQLException, IOException &#123; // ShardingSphere æä¾›çš„å·¥å‚æ–¹æ³•ï¼Œæ ¹æ®é…ç½®æ„å»º DataSource try (InputStream inputStream = getClass().getClassLoader().getResourceAsStream(&quot;sharding.yaml&quot;)) &#123; if (inputStream == null) &#123; throw new IllegalStateException(&quot;Cannot find sharding.yaml in classpath&quot;); &#125; byte[] yamlBytes = inputStream.readAllBytes(); return YamlShardingSphereDataSourceFactory.createDataSource(yamlBytes); &#125; &#125;&#125; sharding.yaml å®Œæ•´é…ç½®ï¼Œä¸‹æ–‡ä¼šä»‹ç»éƒ¨åˆ†é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221# æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/dataSources: ds_0: # é€»è¾‘æ•°æ®æºåç§° dataSourceClassName: com.zaxxer.hikari.HikariDataSource driverClassName: com.mysql.cj.jdbc.Driver jdbcUrl: jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd ds_1: dataSourceClassName: com.zaxxer.hikari.HikariDataSource driverClassName: com.mysql.cj.jdbc.Driver jdbcUrl: jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd# åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® # ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´ bindingTables: - t_order,t_order_item tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® course: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.course_$&#123;1..2&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: course_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: cid shardingAlgorithmName: course_inline keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: cid # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id shardingAlgorithmName: t_order-complex-algorithm keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id # åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”# shardingAlgorithmName: t_order_item-class-based-algorithm # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• shardingAlgorithmName: t_order_item-class-based-algorithm_spi # åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_user: actualDataNodes: ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_inline # åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: id # è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹# keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° keyGeneratorName: custom_snowflake_string # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°# t_address: # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜# actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹ autoTables: # è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½® t_order: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/ course_inline: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™ props: # å±æ€§ algorithm-expression: course_$&#123;cid % 2 + 1&#125; # è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2 allow-range-query-with-inline-sharding: true # å…è®¸èŒƒå›´æŸ¥è¯¢ course_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; # è¡¨ç¤º ds_0, ds_1 mod_2: type: MOD # åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³• props: sharding-count: 2 # åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™ t_order_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; t_order-complex-algorithm: type: COMPLEX_INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³• props: algorithm-expression: t_order_complex_$&#123;(user_id + order_id + 1) % 2&#125; t_order_item-class-based-algorithm: type: CLASS_BASED # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• props: strategy: COMPLEX # æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥ algorithmClassName: com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm # æŒ‡å®šç®—æ³•ç±» t_order_item-class-based-algorithm_spi: # SPI type: T_ORDER_ITEM_COMPLEX # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• t_user_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;Math.abs(id.hashCode()%2)&#125; t_user_inline: type: INLINE props: algorithm-expression: t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125; keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong uuid: # å®šä¹‰åç§° type: UUID # å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString custom_snowflake_string: type: CUSTOM_SNOWFLAKE_STRING # è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒString props: workerId: 2 datacenterId: 2 - !BROADCAST # å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª tables: - dict # å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚ - !ENCRYPT # æ•°æ®åŠ å¯†é…ç½® tables: t_user: # åŠ å¯†è¡¨åç§° columns: password: # åŠ å¯†åˆ—åç§° cipher: name: password # å¯†æ–‡åˆ—åç§° encryptorName: aes_encryptor # å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§° # åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/ encryptors: aes_encryptor: # åŠ è§£å¯†ç®—æ³•åç§° type: AES # åŠ è§£å¯†ç®—æ³•ç±»å‹ props: # åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½® aes-key-value: 123456abc # AES ä½¿ç”¨çš„ KEY digest-algorithm-name: SHA-1 # AES KEY çš„æ‘˜è¦ç®—æ³• md5_encryptor: type: MD5 props: salt: 123456 # ç›å€¼ï¼ˆå¯é€‰ï¼‰ - !MASK # æ•°æ®è„±æ•é…ç½® tables: t_user: # è„±æ•è¡¨åç§° columns: # è„±æ•åˆ—é…ç½® password: # è„±æ•åˆ—åç§° maskAlgorithm: md5_mask # è„±æ•ç®—æ³•åç§° email: maskAlgorithm: mask_before_special_chars_mask telephone: maskAlgorithm: keep_first_n_last_m_mask name: maskAlgorithm: my_mask maskAlgorithms: # è„±æ•ç®—æ³•é…ç½® md5_mask: # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° type: MD5 # è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º mask_before_special_chars_mask: type: MASK_BEFORE_SPECIAL_CHARS # åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com props: special-chars: &#x27;@&#x27; # é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ• replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ keep_first_n_last_m_mask: type: KEEP_FIRST_N_LAST_M # ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678 props: first-n: 3 # ä¿ç•™å‰ 3 ä½ last-m: 4 # ä¿ç•™å 4 ä½ replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ my_mask: type: MY_CUSTOM_MASK # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° props: replace-char: &quot;#&quot; - !SINGLE # å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™ tables: # MySQL é£æ ¼ - ds_0.t_address # åŠ è½½æŒ‡å®šå•è¡¨# - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨# - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨# å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/props: sql-show: true # æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false check-table-metadata-enabled: false # åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false æ•°æ®æºé…ç½® hikari + mysql 1234567891011121314dataSources: ds_0: # é€»è¾‘æ•°æ®æºåç§° dataSourceClassName: com.zaxxer.hikari.HikariDataSource driverClassName: com.mysql.cj.jdbc.Driver jdbcUrl: jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd ds_1: dataSourceClassName: com.zaxxer.hikari.HikariDataSource driverClassName: com.mysql.cj.jdbc.Driver jdbcUrl: jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd druid + mysql 1234567891011121314dataSources: ds_1: dataSourceClassName: com.alibaba.druid.pool.DruidDataSource driverClassName: com.mysql.cj.jdbc.Driver url: jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC username: root password: newpwd # Druid ç‰¹æœ‰é…ç½® initialSize: 5 minIdle: 5 maxActive: 20 maxWait: 60000 testWhileIdle: true validationQuery: SELECT 1 FROM DUAL druid + mysql + p6spy 1234567891011121314dataSources: ds_0: # é€»è¾‘æ•°æ®æºåç§° dataSourceClassName: com.alibaba.druid.pool.DruidDataSource driverClassName: com.p6spy.engine.spy.P6SpyDriver url: jdbc:p6spy:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC username: root password: newpwd # Druid ç‰¹æœ‰é…ç½® initialSize: 5 minIdle: 5 maxActive: 20 maxWait: 60000 testWhileIdle: true validationQuery: SELECT 1 FROM DUAL åˆ†åº“åˆ†è¡¨é…ç½® å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹ 12345678910111213141516171819202122232425262728293031rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® course: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.course_$&#123;1..2&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1 databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: course_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: cid shardingAlgorithmName: course_inline keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: cid # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• course_inline: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™ props: # å±æ€§ algorithm-expression: course_$&#123;cid % 2 + 1&#125; # è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2 allow-range-query-with-inline-sharding: true # å…è®¸èŒƒå›´æŸ¥è¯¢ course_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; # è¡¨ç¤º ds_0, ds_1 keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ä¸åŒçš„å­—æ®µï¼Œåˆ†åº“ä½¿ç”¨ user_idï¼Œåˆ†è¡¨ä½¿ç”¨ cid allow-range-query-with-inline-sharding: true ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå…è®¸èŒƒå›´æŸ¥è¯¢ï¼Œé»˜è®¤å€¼æ˜¯ falseï¼Œä¸å…è®¸ between æŸ¥è¯¢ å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹ 123456789101112131415161718192021222324252627282930313233343536rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® t_user: actualDataNodes: ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_inline # åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: id # è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹# keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° keyGeneratorName: custom_snowflake_string # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• t_user_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;Math.abs(id.hashCode()%2)&#125; # åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®— t_user_inline: type: INLINE props: algorithm-expression: t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125; # åˆ†è¡¨ï¼Œt_user_0, t_user_1 keyGenerators: # åˆ†å¸ƒå¼åºåˆ—ç®—æ³• uuid: # å®šä¹‰åç§° type: UUID # å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString custom_snowflake_string: type: CUSTOM_SNOWFLAKE_STRING # è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi props: workerId: 2 datacenterId: 2 è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ç›¸åŒçš„å­—æ®µï¼Œå³ä¸»é”®idï¼Œå› å…¶ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ hashCode() è·å–æ•°å­—ï¼Œå†è¿›è¡Œè¿ç®— ä¸»é”®è·å–è§„åˆ™ä½¿ç”¨çš„è‡ªå®šä¹‰çš„é›ªèŠ±ç®—æ³•ï¼Œspiï¼Œè¯¦è§src/main/resources/META-INF/services/org.apache.shardingsphere.infra.algorithm.keygen.core.KeyGenerateAlgorithmï¼Œè¿™é‡Œæ³¨æ„ï¼Œä» 5.5.3 å¼€å§‹ä¼šæ›´æ¢ä¸º org.apache.shardingsphere.infra.algorithm.keygen.spi.KeyGenerateAlgorithm å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® t_order_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id shardingAlgorithmName: t_order-complex-algorithm keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id # åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”# shardingAlgorithmName: t_order_item-class-based-algorithm # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• shardingAlgorithmName: t_order_item-class-based-algorithm_spi # åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• t_order_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; t_order-complex-algorithm: type: COMPLEX_INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³• props: algorithm-expression: t_order_complex_$&#123;(user_id + order_id + 1) % 2&#125; t_order_item-class-based-algorithm: type: CLASS_BASED # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• props: strategy: COMPLEX # æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥ algorithmClassName: com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm # æŒ‡å®šç®—æ³•ç±» t_order_item-class-based-algorithm_spi: # SPI type: T_ORDER_ITEM_COMPLEX # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong å¤šä¸ªåˆ†ç‰‡é”®ï¼Œt_order_complexè¡¨ä½¿ç”¨äº†å†…ç½®çš„COMPLEX_INLINEç®—æ³•ï¼Œè€Œt_order_item_complexè¡¨ä½¿ç”¨äº†è‡ªå®šä¹‰çš„çš„åˆ†ç‰‡ç®—æ³•ï¼Œspiï¼Œè¯¦è§src/main/resources/META-INF/services/org.apache.shardingsphere.sharding.spi.ShardingAlgorithm è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™ ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™ 12345678910111213141516171819202122232425262728293031323334rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® # ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´ bindingTables: - t_order,t_order_item autoTables: # è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½® t_order: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• mod_2: type: MOD # åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³• props: sharding-count: 2 # åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™ keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™éœ€è¦å£°æ˜æ•°æ®åº“ï¼Œä½†ä¸éœ€è¦å£°æ˜è¡¨åˆ†é…è§„åˆ™ï¼Œå…¶æ ¹æ®åˆ†ç‰‡ç®—æ³•è‡ªåŠ¨ç¡®å®šå…·ä½“çš„æ•°æ®è¡¨ã€‚ åŒæ—¶è¿™é‡Œè¿˜é…ç½®äº†bindingTablesï¼Œç”¨æ¥æŒ‡å®šå…¶åˆ†ç‰‡è·¯ç”±ä¸€è‡´ã€‚ å¹¿æ’­è¡¨é…ç½® å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨ 1234rules: - !BROADCAST # å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª tables: - dict # å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚ æ•°æ®åŠ å¯†è§„åˆ™ 1234567891011121314151617181920rules: - !ENCRYPT # æ•°æ®åŠ å¯†é…ç½® tables: t_user: # åŠ å¯†è¡¨åç§° columns: password: # åŠ å¯†åˆ—åç§° cipher: name: password # å¯†æ–‡åˆ—åç§° encryptorName: aes_encryptor # å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§° # åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/ encryptors: aes_encryptor: # åŠ è§£å¯†ç®—æ³•åç§° type: AES # åŠ è§£å¯†ç®—æ³•ç±»å‹ props: # åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½® aes-key-value: 123456abc # AES ä½¿ç”¨çš„ KEY digest-algorithm-name: SHA-1 # AES KEY çš„æ‘˜è¦ç®—æ³• md5_encryptor: type: MD5 props: salt: 123456 # ç›å€¼ï¼ˆå¯é€‰ï¼‰ é…ç½®åŠ å¯†å­—æ®µè§„åˆ™åï¼Œæ–°å¢æ•°æ®æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¹åŠ å¯†å­—æ®µåŠ å¯†åå­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶ä¹Ÿä¼šåŠ å¯†åè¿›è¡Œæ¯”è¾ƒæŸ¥è¯¢ã€‚ æ•°æ®è„±æ•è§„åˆ™ 1234567891011121314151617181920212223242526272829303132rules: - !MASK # æ•°æ®è„±æ•é…ç½® tables: t_user: # è„±æ•è¡¨åç§° columns: # è„±æ•åˆ—é…ç½® password: # è„±æ•åˆ—åç§° maskAlgorithm: md5_mask # è„±æ•ç®—æ³•åç§° email: maskAlgorithm: mask_before_special_chars_mask telephone: maskAlgorithm: keep_first_n_last_m_mask name: maskAlgorithm: my_mask maskAlgorithms: # è„±æ•ç®—æ³•é…ç½® md5_mask: # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° type: MD5 # è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º mask_before_special_chars_mask: type: MASK_BEFORE_SPECIAL_CHARS # åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com props: special-chars: &#x27;@&#x27; # é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ• replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ keep_first_n_last_m_mask: type: KEEP_FIRST_N_LAST_M # ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678 props: first-n: 3 # ä¿ç•™å‰ 3 ä½ last-m: 4 # ä¿ç•™å 4 ä½ replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ my_mask: type: MY_CUSTOM_MASK # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° props: replace-char: &quot;#&quot; è¢«è„±æ•çš„å­—æ®µåœ¨æŸ¥è¯¢æ—¶ä¼šè¿›è¡Œè„±æ•å±•ç¤ºã€‚ è¿™é‡Œè¿˜è‡ªå®šä¹‰äº†è„±æ•ç®—æ³•ï¼Œspiï¼Œè¯¦è§src/main/resources/META-INF/services/org.apache.shardingsphere.mask.spi.MaskAlgorithm å•è¡¨è§„åˆ™ å³ä¸éœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨çš„è¡¨ 12345rules: - !SINGLE # å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™ tables: # MySQL é£æ ¼ - ds_0.t_address # åŠ è½½æŒ‡å®šå•è¡¨ å±æ€§é…ç½® 1234# å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/props: sql-show: true # æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false check-table-metadata-enabled: false # åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false äº‹åŠ¡é…ç½® 123# https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/transaction: defaultType: LOCAL # é»˜è®¤äº‹åŠ¡ç±»å‹å°±æ˜¯ LOCAL åè®° springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ä¸ springboot2 ä¸åŒï¼Œä¸å†æä¾› springboot-starter-shardingsphereï¼Œç›¸å…³é…ç½®ä¹Ÿé‡‡ç”¨äº†ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ã€‚ ä»£ç ä¸­åŒ…å«ä¸¤ä¸ªåº“ä¸­ä½¿ç”¨åˆ°çš„æ•°æ®åº“è„šæœ¬ï¼Œshardingsphere-demo/shardingsphere-demo-01/sql å…·ä½“ä½¿ç”¨æ•ˆæœå¯ä»¥é€šè¿‡é¡¹ç›®ä¸­æä¾›çš„å•å…ƒæµ‹è¯•ç±»è¿›è¡ŒéªŒè¯ã€‚ springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ç›®å‰å°šä¸æ”¯æŒ XA åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè¿™æ˜¯å› ä¸ºä» Spring Boot 3.x å¼€å§‹ï¼Œå°±å…¨é¢è¿ç§»åˆ°äº† Jakarta EE 9+ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ javax.* çš„ç±»éƒ½è¿ç§»åˆ° jakarta.* å‘½åç©ºé—´(äº‹åŠ¡ã€JPAã€Servlet ç­‰ API éƒ½å—å½±å“)ï¼Œè€Œ ShardingSphere 5.5 ä¸­çš„ XA äº‹åŠ¡ä¸»è¦ä¾èµ– Atomikos æˆ– Narayana ç­‰ç¬¬ä¸‰æ–¹åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†å™¨ï¼Œè¿™äº›åº“ç›®å‰å¤§éƒ¨åˆ†è¿˜æ˜¯åŸºäº javax.transaction.* çš„ APIã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€","date_published":"2025-09-01T13:30:05.000Z","tags":["æŠ€æœ¯","springboot","sharding-sphere","springboot","sharding-sphere"]},{"id":"https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/","url":"https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/","title":"K8S UI ä¹‹ Rancher","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://ranchermanager.docs.rancher.com/zh/\">Rancher å®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/rancher/rancher\">Rancher Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Rancher-ç®€ä»‹\">Rancher ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Rancher æ˜¯ä¸€ä¸ª å¼€æºçš„ Kubernetes ç®¡ç†å¹³å°ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·éƒ¨ç½²ã€ç®¡ç†å’Œè¿ç»´å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œå…·æœ‰æ˜“ç”¨çš„ Web UIã€æƒé™æ§åˆ¶ã€é›†ç¾¤ç›‘æ§ã€åº”ç”¨ç®¡ç†ç­‰åŠŸèƒ½ï¼Œå¹¿æ³›åº”ç”¨äºä¼ä¸šçš„äº‘åŸç”Ÿå¹³å°å»ºè®¾ä¸­ã€‚</p>\n</li>\n</ul>\n<h2 id=\"éƒ¨ç½²-Rancher\">éƒ¨ç½² Rancher</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://ranchermanager.docs.rancher.com/zh/getting-started/quick-start-guides/deploy-rancher-manager/helm-cli#%E4%BD%BF%E7%94%A8-helm-%E6%9D%A5%E5%AE%89%E8%A3%85-rancher\">ä½¿ç”¨ Helm å®‰è£… Rancher</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ  rancher çš„ Helm ä»“åº“</span></span><br><span class=\"line\">helm repo add rancher-latest https://releases.rancher.com/server-charts/latest</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–° rancher çš„ Helm ä»“åº“</span></span><br><span class=\"line\">helm repo update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ rancher çš„ç‰ˆæœ¬</span></span><br><span class=\"line\">$ helm search repo rancher -l | <span class=\"built_in\">head</span></span><br><span class=\"line\">NAME                  \tCHART VERSION\tAPP VERSION\tDESCRIPTION</span><br><span class=\"line\">rancher-latest/rancher\t2.11.3       \tv2.11.3    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.11.2       \tv2.11.2    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.11.1       \tv2.11.1    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.11.0       \tv2.11.0    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.3       \tv2.10.3    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.2       \tv2.10.2    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.1       \tv2.10.1    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.0       \tv2.10.0    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.9.3        \tv2.9.3     \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class=\"line\">kubectl create namespace cattle-system</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè¯ä¹¦ï¼Œè¯ä¹¦æ˜¯æœºæ„é¢å‘çš„</span></span><br><span class=\"line\">kubectl create secret tls tls-rancher-ingress \\</span><br><span class=\"line\">  --key=nginx_ssl/nginx.hanqunfeng.com.key \\</span><br><span class=\"line\">  --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\</span><br><span class=\"line\">  -n cattle-system</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… Rancher  --version v2.11.3 å¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼Œé»˜è®¤æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">helm install rancher rancher-latest/rancher \\</span><br><span class=\"line\">  --namespace cattle-system \\</span><br><span class=\"line\">  --create-namespace \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> hostname=rancher.hanqunfeng.com \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> ingress.tls.source=secret \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> replicas=3 \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> bootstrapPassword=rancher#2025</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># --set hostname=rancher.hanqunfeng.com è®¾ç½® rancher çš„åŸŸå</span></span><br><span class=\"line\"><span class=\"comment\"># --set ingress.tls.source=secret é…ç½® rancher çš„è¯ä¹¦ï¼Œåç§°ä¸º tls-rancher-ingress</span></span><br><span class=\"line\"><span class=\"comment\"># --set replicas=3 è®¾ç½® rancher çš„å‰¯æœ¬æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># --set bootstrapPassword=rancher#2025 è®¾ç½® rancher çš„åˆå§‹å¯†ç </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ä¸è¿‡æ‰§è¡Œä¸Šé¢çš„å®‰è£…å‘½ä»¤ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯å½“å‰çš„ rancher ç‰ˆæœ¬ä¸æ”¯æŒ Kubernetes v1.33.2</span></span><br><span class=\"line\">Error: INSTALLATION FAILED: chart requires kubeVersion: &lt; 1.33.0-0 <span class=\"built_in\">which</span> is incompatible with Kubernetes v1.33.2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è§£å†³åŠæ³•</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸‹è½½å¹¶è§£å‹ rancher å®‰è£…åŒ…</span></span><br><span class=\"line\">helm pull rancher-latest/rancher --untar --untardir ./</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å…¶ä¸­çš„ Chart.yaml æ–‡ä»¶</span></span><br><span class=\"line\">kubeVersion: &lt; 1.33.0-0 ==&gt; kubeVersion: &lt; 1.34.0-0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… rancher</span></span><br><span class=\"line\">helm install rancher rancher \\</span><br><span class=\"line\">  --namespace cattle-system \\</span><br><span class=\"line\">  --create-namespace \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> hostname=rancher.hanqunfeng.com \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> ingress.tls.source=secret \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> replicas=3 \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> bootstrapPassword=rancher#2025</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">NAME: rancher</span><br><span class=\"line\">LAST DEPLOYED: Thu Jul 24 23:55:24 2025</span><br><span class=\"line\">NAMESPACE: cattle-system</span><br><span class=\"line\">STATUS: deployed</span><br><span class=\"line\">REVISION: 1</span><br><span class=\"line\">TEST SUITE: None</span><br><span class=\"line\">NOTES:</span><br><span class=\"line\">Rancher Server has been installed.</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: Rancher may take several minutes to fully initialize. Please standby <span class=\"keyword\">while</span> Certificates are being issued, Containers are started and the Ingress rule comes up.</span><br><span class=\"line\"></span><br><span class=\"line\">Check out our docs at https://rancher.com/docs/</span><br><span class=\"line\"></span><br><span class=\"line\">If you provided your own bootstrap password during installation, browse to https://rancher.hanqunfeng.com to get started.</span><br><span class=\"line\"></span><br><span class=\"line\">If this is the first time you installed Rancher, get started by running this <span class=\"built_in\">command</span> and clicking the URL it generates:</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> https://rancher.hanqunfeng.com/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class=\"string\">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">To get just the bootstrap password on its own, run:</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class=\"string\">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123; &quot;\\n&quot; &#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Happy Containering!</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹åˆ›å»ºçš„èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get all,ing -n cattle-system</span><br><span class=\"line\">NAME                                   READY   STATUS      RESTARTS   AGE</span><br><span class=\"line\">pod/helm-operation-8257k               0/2     Completed   0          11m</span><br><span class=\"line\">pod/helm-operation-g8blp               0/2     Completed   0          12m</span><br><span class=\"line\">pod/helm-operation-hwpbp               0/2     Completed   0          10m</span><br><span class=\"line\">pod/helm-operation-qbs5n               0/2     Completed   0          10m</span><br><span class=\"line\">pod/helm-operation-wlptb               0/2     Completed   0          13m</span><br><span class=\"line\">pod/rancher-56689b7d8c-v7hpd           1/1     Running     0          21m</span><br><span class=\"line\">pod/rancher-56689b7d8c-xnrbf           1/1     Running     0          21m</span><br><span class=\"line\">pod/rancher-56689b7d8c-xvqgs           1/1     Running     0          21m</span><br><span class=\"line\">pod/rancher-webhook-5fd5fc44f9-8xwjk   1/1     Running     0          11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE</span><br><span class=\"line\">service/imperative-api-extension   ClusterIP   10.96.188.28   &lt;none&gt;        6666/TCP         15m</span><br><span class=\"line\">service/rancher                    ClusterIP   10.96.21.41    &lt;none&gt;        80/TCP,443/TCP   21m</span><br><span class=\"line\">service/rancher-webhook            ClusterIP   10.96.85.153   &lt;none&gt;        443/TCP          11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                              READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/rancher           3/3     3            3           21m</span><br><span class=\"line\">deployment.apps/rancher-webhook   1/1     1            1           11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                         DESIRED   CURRENT   READY   AGE</span><br><span class=\"line\">replicaset.apps/rancher-56689b7d8c           3         3         3       21m</span><br><span class=\"line\">replicaset.apps/rancher-webhook-5fd5fc44f9   1         1         1       11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                CLASS   HOSTS                    ADDRESS         PORTS     AGE</span><br><span class=\"line\">ingress.networking.k8s.io/rancher   nginx   rancher.hanqunfeng.com   10.211.55.201   80, 443   21m</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµè§ˆå™¨è®¿é—®ï¼š<a href=\"https://rancher.hanqunfeng.com\">https://rancher.hanqunfeng.com</a>ï¼Œè¾“å…¥ä¸Šé¢è®¾ç½®çš„å¯†ç å³å¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœå¿˜è®°åˆå§‹å¯†ç å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯†ç </span></span><br><span class=\"line\">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class=\"string\">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123;&quot;\\n&quot;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/rHDDMN.png\" alt=\"\"></p>\n<h2 id=\"å¸è½½-Rancher\">å¸è½½ Rancher</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¸è½½ Rancher</span></span><br><span class=\"line\">helm uninstall rancher -n cattle-system</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ cattle-system å‘½åç©ºé—´</span></span><br><span class=\"line\">kubectl delete namespace cattle-system</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Rancher å®˜ç½‘ Rancher Github Rancher ç®€ä»‹ Rancher æ˜¯ä¸€ä¸ª å¼€æºçš„ Kubernetes ç®¡ç†å¹³å°ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·éƒ¨ç½²ã€ç®¡ç†å’Œè¿ç»´å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œå…·æœ‰æ˜“ç”¨çš„ Web UIã€æƒé™æ§åˆ¶ã€é›†ç¾¤ç›‘æ§ã€åº”ç”¨ç®¡ç†ç­‰åŠŸèƒ½ï¼Œå¹¿æ³›åº”ç”¨äºä¼ä¸šçš„äº‘åŸç”Ÿå¹³å°å»ºè®¾ä¸­ã€‚ éƒ¨ç½² Rancher ä½¿ç”¨ Helm å®‰è£… Rancher 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788# æ·»åŠ  rancher çš„ Helm ä»“åº“helm repo add rancher-latest https://releases.rancher.com/server-charts/latest# æ›´æ–° rancher çš„ Helm ä»“åº“helm repo update# æŸ¥çœ‹ rancher çš„ç‰ˆæœ¬$ helm search repo rancher -l | headNAME CHART VERSION APP VERSION DESCRIPTIONrancher-latest/rancher 2.11.3 v2.11.3 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.11.2 v2.11.2 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.11.1 v2.11.1 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.11.0 v2.11.0 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.3 v2.10.3 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.2 v2.10.2 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.1 v2.10.1 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.0 v2.10.0 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.9.3 v2.9.3 Install Rancher Server to manage Kubernetes clu...# åˆ›å»ºå‘½åç©ºé—´kubectl create namespace cattle-system# åˆ›å»ºè¯ä¹¦ï¼Œè¯ä¹¦æ˜¯æœºæ„é¢å‘çš„kubectl create secret tls tls-rancher-ingress \\ --key=nginx_ssl/nginx.hanqunfeng.com.key \\ --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\ -n cattle-system# å®‰è£… Rancher --version v2.11.3 å¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼Œé»˜è®¤æœ€æ–°ç‰ˆhelm install rancher rancher-latest/rancher \\ --namespace cattle-system \\ --create-namespace \\ --set hostname=rancher.hanqunfeng.com \\ --set ingress.tls.source=secret \\ --set replicas=3 \\ --set bootstrapPassword=rancher#2025## å‚æ•°è¯´æ˜# --set hostname=rancher.hanqunfeng.com è®¾ç½® rancher çš„åŸŸå# --set ingress.tls.source=secret é…ç½® rancher çš„è¯ä¹¦ï¼Œåç§°ä¸º tls-rancher-ingress# --set replicas=3 è®¾ç½® rancher çš„å‰¯æœ¬æ•°# --set bootstrapPassword=rancher#2025 è®¾ç½® rancher çš„åˆå§‹å¯†ç ## ä¸è¿‡æ‰§è¡Œä¸Šé¢çš„å®‰è£…å‘½ä»¤ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯å½“å‰çš„ rancher ç‰ˆæœ¬ä¸æ”¯æŒ Kubernetes v1.33.2Error: INSTALLATION FAILED: chart requires kubeVersion: &lt; 1.33.0-0 which is incompatible with Kubernetes v1.33.2## è§£å†³åŠæ³•# ä¸‹è½½å¹¶è§£å‹ rancher å®‰è£…åŒ…helm pull rancher-latest/rancher --untar --untardir ./# ä¿®æ”¹å…¶ä¸­çš„ Chart.yaml æ–‡ä»¶kubeVersion: &lt; 1.33.0-0 ==&gt; kubeVersion: &lt; 1.34.0-0# å®‰è£… rancherhelm install rancher rancher \\ --namespace cattle-system \\ --create-namespace \\ --set hostname=rancher.hanqunfeng.com \\ --set ingress.tls.source=secret \\ --set replicas=3 \\ --set bootstrapPassword=rancher#2025## è¾“å‡ºNAME: rancherLAST DEPLOYED: Thu Jul 24 23:55:24 2025NAMESPACE: cattle-systemSTATUS: deployedREVISION: 1TEST SUITE: NoneNOTES:Rancher Server has been installed.NOTE: Rancher may take several minutes to fully initialize. Please standby while Certificates are being issued, Containers are started and the Ingress rule comes up.Check out our docs at https://rancher.com/docs/If you provided your own bootstrap password during installation, browse to https://rancher.hanqunfeng.com to get started.If this is the first time you installed Rancher, get started by running this command and clicking the URL it generates:echo https://rancher.hanqunfeng.com/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#x27;)To get just the bootstrap password on its own, run:kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123; &quot;\\n&quot; &#125;&#125;&#x27;Happy Containering! æŸ¥çœ‹åˆ›å»ºçš„èµ„æº 123456789101112131415161718192021222324252627$ k get all,ing -n cattle-systemNAME READY STATUS RESTARTS AGEpod/helm-operation-8257k 0/2 Completed 0 11mpod/helm-operation-g8blp 0/2 Completed 0 12mpod/helm-operation-hwpbp 0/2 Completed 0 10mpod/helm-operation-qbs5n 0/2 Completed 0 10mpod/helm-operation-wlptb 0/2 Completed 0 13mpod/rancher-56689b7d8c-v7hpd 1/1 Running 0 21mpod/rancher-56689b7d8c-xnrbf 1/1 Running 0 21mpod/rancher-56689b7d8c-xvqgs 1/1 Running 0 21mpod/rancher-webhook-5fd5fc44f9-8xwjk 1/1 Running 0 11mNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/imperative-api-extension ClusterIP 10.96.188.28 &lt;none&gt; 6666/TCP 15mservice/rancher ClusterIP 10.96.21.41 &lt;none&gt; 80/TCP,443/TCP 21mservice/rancher-webhook ClusterIP 10.96.85.153 &lt;none&gt; 443/TCP 11mNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/rancher 3/3 3 3 21mdeployment.apps/rancher-webhook 1/1 1 1 11mNAME DESIRED CURRENT READY AGEreplicaset.apps/rancher-56689b7d8c 3 3 3 21mreplicaset.apps/rancher-webhook-5fd5fc44f9 1 1 1 11mNAME CLASS HOSTS ADDRESS PORTS AGEingress.networking.k8s.io/rancher nginx rancher.hanqunfeng.com 10.211.55.201 80, 443 21m æµè§ˆå™¨è®¿é—®ï¼šhttps://rancher.hanqunfeng.comï¼Œè¾“å…¥ä¸Šé¢è®¾ç½®çš„å¯†ç å³å¯ã€‚ 12# å¦‚æœå¿˜è®°åˆå§‹å¯†ç å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯†ç kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123;&quot;\\n&quot;&#125;&#125;&#x27; å¸è½½ Rancher 1234# å¸è½½ Rancherhelm uninstall rancher -n cattle-system# åˆ é™¤ cattle-system å‘½åç©ºé—´kubectl delete namespace cattle-system","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Rancher å®˜ç½‘ Rancher Github","date_published":"2025-07-25T14:33:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/","title":"K8S UI ä¹‹ Kubesphere","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubesphere.io/zh/\">Kubesphere å®˜ç½‘</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Kubesphere-ç®€ä»‹\">Kubesphere ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>KubeSphere æ˜¯ä¸€ä¸ªåŸºäº Kubernetes æ„å»ºçš„ ä¼ä¸šçº§å¤šç§Ÿæˆ·å®¹å™¨ç®¡ç†å¹³å°ï¼Œæä¾›äº†ä¸€å¥—å®Œæ•´çš„å®¹å™¨å¹³å°è§£å†³æ–¹æ¡ˆï¼Œè®©ç”¨æˆ·ä»¥å›¾å½¢åŒ–æ–¹å¼è½»æ¾ä½¿ç”¨ Kubernetes å’Œ DevOps èƒ½åŠ›ï¼Œä¸éœ€è¦æ·±å…¥ç†è§£å¤æ‚çš„åº•å±‚æ¶æ„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ K8S çš„ Dashboard ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŠŸèƒ½ / ç‰¹æ€§</th>\n<th>Kubernetes Dashboard</th>\n<th><strong>KubeSphere</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>âœ… åŸºç¡€èµ„æºç®¡ç†</td>\n<td>âœ… æ”¯æŒ</td>\n<td>âœ… æ›´ä¸°å¯Œï¼Œæ”¯æŒæ›´å¤šç»†ç²’åº¦æ§åˆ¶</td>\n</tr>\n<tr>\n<td>ğŸ‘¥ å¤šç§Ÿæˆ·æ”¯æŒ</td>\n<td>âŒ æ— </td>\n<td>âœ… å†…å»ºä¼ä¸šçº§å¤šç§Ÿæˆ·ã€ç©ºé—´ï¼ˆWorkspaceï¼‰éš”ç¦»</td>\n</tr>\n<tr>\n<td>ğŸ” èº«ä»½è®¤è¯ä¸æƒé™æ§åˆ¶</td>\n<td>âš ï¸ éœ€æ‰‹åŠ¨æ•´åˆ RBAC</td>\n<td>âœ… å†…å»ºç”¨æˆ·ç®¡ç†ã€è§’è‰²ã€å›¢é˜Ÿã€ä¼ä¸šç»„ç»‡æ¶æ„</td>\n</tr>\n<tr>\n<td>ğŸŒ å¤šé›†ç¾¤æ”¯æŒ</td>\n<td>âŒ ä¸æ”¯æŒ</td>\n<td>âœ… æ”¯æŒè·¨åŒºåŸŸå¤šé›†ç¾¤ç»Ÿä¸€ç®¡ç†</td>\n</tr>\n<tr>\n<td>ğŸš€ DevOpsï¼ˆCI/CD æµæ°´çº¿ï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å†…ç½®å›¾å½¢åŒ–æµæ°´çº¿ï¼ˆJenkins é©±åŠ¨ï¼‰</td>\n</tr>\n<tr>\n<td>ğŸ“Š ç›‘æ§ä¸æŒ‡æ ‡ï¼ˆPrometheusï¼‰</td>\n<td>âŒ æ‰‹åŠ¨å®‰è£…</td>\n<td>âœ… å†…ç½®ï¼Œå›¾å½¢åŒ–å±•ç¤º Pod/Node/æœåŠ¡ç­‰ç›‘æ§æ•°æ®</td>\n</tr>\n<tr>\n<td>ğŸ“ æ—¥å¿—æŸ¥è¯¢ä¸åˆ†æï¼ˆEFKï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å†…å»º Fluent Bit + Elasticsearch + Kibana</td>\n</tr>\n<tr>\n<td>ğŸ’¡ å¾®æœåŠ¡æ²»ç†ï¼ˆIstioï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å¯é€‰å¯ç”¨ï¼Œæ”¯æŒæœåŠ¡æ‹“æ‰‘ã€ç°åº¦å‘å¸ƒã€æµé‡æ²»ç†ç­‰</td>\n</tr>\n<tr>\n<td>ğŸ§° åº”ç”¨å•†åº—ï¼ˆHelm å¯è§†åŒ–éƒ¨ç½²ï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… æ”¯æŒ Helm åº”ç”¨å¸‚åœºï¼Œç‚¹å‡»å³å¯å®‰è£…å¸¸è§ä¸­é—´ä»¶</td>\n</tr>\n<tr>\n<td>ğŸ”Œ æ’ä»¶æ¶æ„</td>\n<td>âŒ æ— </td>\n<td>âœ… æ”¯æŒæ¨¡å—æŒ‰éœ€å¯ç”¨/å…³é—­</td>\n</tr>\n<tr>\n<td>ğŸ§ª å®¹å™¨é•œåƒä»“åº“ï¼ˆHarborï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å¯é›†æˆæˆ–å†…å»º Harbor å®¹å™¨ä»“åº“</td>\n</tr>\n<tr>\n<td>ğŸ“¦ å®‰è£…å¤æ‚åº¦</td>\n<td>âœ… ç®€å•</td>\n<td>âš ï¸ ç•¥å¤æ‚ï¼Œä½†å¯æŒ‰éœ€å¯ç”¨æ¨¡å—</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"éƒ¨ç½²-Kubesphere\">éƒ¨ç½² Kubesphere</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubesphere å¯¹ç³»ç»Ÿèµ„æºæœ‰æœ€ä½è¦æ±‚ï¼Œå…·ä½“å‚è€ƒ<a href=\"https://kubesphere.io/zh/docs/v4.1/03-installation-and-upgrade/01-preparations/01-supported-k8s/\">å®˜ç½‘:ç¯å¢ƒè¦æ±‚</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>éƒ¨ç½²</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœæ— æ³•è®¿é—® charts.kubesphere.io, å¯å°† charts.kubesphere.io æ›¿æ¢ä¸º charts.kubesphere.com.cn</span></span><br><span class=\"line\">helm upgrade --install -n kubesphere-system --create-namespace ks-core https://charts.kubesphere.io/main/ks-core-1.1.4.tgz --debug --<span class=\"built_in\">wait</span></span><br><span class=\"line\"><span class=\"comment\">## å®‰è£…æˆåŠŸåä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</span></span><br><span class=\"line\">NOTES:</span><br><span class=\"line\">Thank you <span class=\"keyword\">for</span> choosing KubeSphere Helm Chart.</span><br><span class=\"line\"></span><br><span class=\"line\">Please be patient and <span class=\"built_in\">wait</span> <span class=\"keyword\">for</span> several seconds <span class=\"keyword\">for</span> the KubeSphere deployment to complete.</span><br><span class=\"line\"></span><br><span class=\"line\">1. Wait <span class=\"keyword\">for</span> Deployment Completion</span><br><span class=\"line\"></span><br><span class=\"line\">    Confirm that all KubeSphere components are running by executing the following <span class=\"built_in\">command</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    kubectl get pods -n kubesphere-system</span><br><span class=\"line\">2. Access the KubeSphere Console</span><br><span class=\"line\"></span><br><span class=\"line\">    Once the deployment is complete, you can access the KubeSphere console using the following URL:</span><br><span class=\"line\"></span><br><span class=\"line\">    http://10.211.55.11:30880</span><br><span class=\"line\"></span><br><span class=\"line\">3. Login to KubeSphere Console</span><br><span class=\"line\"></span><br><span class=\"line\">    Use the following credentials to <span class=\"built_in\">log</span> <span class=\"keyword\">in</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    Account: admin</span><br><span class=\"line\">    Password: P@88w0rd</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: It is highly recommended to change the default password immediately after the first login.</span><br><span class=\"line\">For additional information and details, please visit https://kubesphere.io.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶</span></span><br><span class=\"line\">$ kubectl get pod,deploy,svc -n kubesphere-system</span><br><span class=\"line\">NAME                                         READY   STATUS    RESTARTS       AGE</span><br><span class=\"line\">pod/extensions-museum-ffd8bd9d8-fvcw4        1/1     Running   1 (28m ago)    5h5m</span><br><span class=\"line\">pod/ks-apiserver-7b4479d5f5-2k4c9            1/1     Running   2 (27m ago)    5h5m</span><br><span class=\"line\">pod/ks-console-6bd9b9f5d9-xqlzs              1/1     Running   0              26m</span><br><span class=\"line\">pod/ks-controller-manager-547f9fc8c9-5b88z   1/1     Running   10 (27m ago)   5h5m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/extensions-museum       1/1     1            1           5h14m</span><br><span class=\"line\">deployment.apps/ks-apiserver            1/1     1            1           5h14m</span><br><span class=\"line\">deployment.apps/ks-console              1/1     1            1           5h14m</span><br><span class=\"line\">deployment.apps/ks-controller-manager   1/1     1            1           5h14m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span><br><span class=\"line\">service/extensions-museum       ClusterIP   10.96.95.71    &lt;none&gt;        443/TCP        5h14m</span><br><span class=\"line\">service/ks-apiserver            ClusterIP   10.96.12.106   &lt;none&gt;        80/TCP         5h14m</span><br><span class=\"line\">service/ks-console              NodePort    10.96.55.165   &lt;none&gt;        80:30880/TCP   5h14m</span><br><span class=\"line\">service/ks-controller-manager   ClusterIP   10.96.13.243   &lt;none&gt;        443/TCP        5h14m</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµè§ˆå™¨è®¿é—®ï¼š<a href=\"http://10.211.55.11:30880\">http://10.211.55.11:30880</a>ï¼Œè¾“å…¥è´¦å·å¯†ç ï¼šadmin/P@88w0rdï¼Œé¦–æ¬¡ç™»å½•éœ€è¦ä¿®æ”¹å¯†ç ã€‚</p>\n</li>\n</ul>\n<h2 id=\"é…ç½®-ingress\">é…ç½® ingress</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºè¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create secret tls nginx-tls \\</span><br><span class=\"line\">    --key=nginx_ssl/nginx.hanqunfeng.com.key \\</span><br><span class=\"line\">    --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\</span><br><span class=\"line\">    -n kubesphere-system</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º ingress</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># kubesphere-ingress.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kubesphere-nginx</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ingressClassName:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">tls:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">kubesphere.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">secretName:</span> <span class=\"string\">nginx-tls</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">kubesphere.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">ks-console</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸è½½-Kubesphere\">å¸è½½ Kubesphere</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm uninstall ks-core -n kubesphere-system</span><br><span class=\"line\">kubectl delete namespace kubesphere-system</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Kubesphere å®˜ç½‘ Kubesphere ç®€ä»‹ KubeSphere æ˜¯ä¸€ä¸ªåŸºäº Kubernetes æ„å»ºçš„ ä¼ä¸šçº§å¤šç§Ÿæˆ·å®¹å™¨ç®¡ç†å¹³å°ï¼Œæä¾›äº†ä¸€å¥—å®Œæ•´çš„å®¹å™¨å¹³å°è§£å†³æ–¹æ¡ˆï¼Œè®©ç”¨æˆ·ä»¥å›¾å½¢åŒ–æ–¹å¼è½»æ¾ä½¿ç”¨ Kubernetes å’Œ DevOps èƒ½åŠ›ï¼Œä¸éœ€è¦æ·±å…¥ç†è§£å¤æ‚çš„åº•å±‚æ¶æ„ã€‚ ä¸ K8S çš„ Dashboard ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š åŠŸèƒ½ / ç‰¹æ€§ Kubernetes Dashboard KubeSphere âœ… åŸºç¡€èµ„æºç®¡ç† âœ… æ”¯æŒ âœ… æ›´ä¸°å¯Œï¼Œæ”¯æŒæ›´å¤šç»†ç²’åº¦æ§åˆ¶ ğŸ‘¥ å¤šç§Ÿæˆ·æ”¯æŒ âŒ æ—  âœ… å†…å»ºä¼ä¸šçº§å¤šç§Ÿæˆ·ã€ç©ºé—´ï¼ˆWorkspaceï¼‰éš”ç¦» ğŸ” èº«ä»½è®¤è¯ä¸æƒé™æ§åˆ¶ âš ï¸ éœ€æ‰‹åŠ¨æ•´åˆ RBAC âœ… å†…å»ºç”¨æˆ·ç®¡ç†ã€è§’è‰²ã€å›¢é˜Ÿã€ä¼ä¸šç»„ç»‡æ¶æ„ ğŸŒ å¤šé›†ç¾¤æ”¯æŒ âŒ ä¸æ”¯æŒ âœ… æ”¯æŒè·¨åŒºåŸŸå¤šé›†ç¾¤ç»Ÿä¸€ç®¡ç† ğŸš€ DevOpsï¼ˆCI/CD æµæ°´çº¿ï¼‰ âŒ æ—  âœ… å†…ç½®å›¾å½¢åŒ–æµæ°´çº¿ï¼ˆJenkins é©±åŠ¨ï¼‰ ğŸ“Š ç›‘æ§ä¸æŒ‡æ ‡ï¼ˆPrometheusï¼‰ âŒ æ‰‹åŠ¨å®‰è£… âœ… å†…ç½®ï¼Œå›¾å½¢åŒ–å±•ç¤º Pod/Node/æœåŠ¡ç­‰ç›‘æ§æ•°æ® ğŸ“ æ—¥å¿—æŸ¥è¯¢ä¸åˆ†æï¼ˆEFKï¼‰ âŒ æ—  âœ… å†…å»º Fluent Bit + Elasticsearch + Kibana ğŸ’¡ å¾®æœåŠ¡æ²»ç†ï¼ˆIstioï¼‰ âŒ æ—  âœ… å¯é€‰å¯ç”¨ï¼Œæ”¯æŒæœåŠ¡æ‹“æ‰‘ã€ç°åº¦å‘å¸ƒã€æµé‡æ²»ç†ç­‰ ğŸ§° åº”ç”¨å•†åº—ï¼ˆHelm å¯è§†åŒ–éƒ¨ç½²ï¼‰ âŒ æ—  âœ… æ”¯æŒ Helm åº”ç”¨å¸‚åœºï¼Œç‚¹å‡»å³å¯å®‰è£…å¸¸è§ä¸­é—´ä»¶ ğŸ”Œ æ’ä»¶æ¶æ„ âŒ æ—  âœ… æ”¯æŒæ¨¡å—æŒ‰éœ€å¯ç”¨/å…³é—­ ğŸ§ª å®¹å™¨é•œåƒä»“åº“ï¼ˆHarborï¼‰ âŒ æ—  âœ… å¯é›†æˆæˆ–å†…å»º Harbor å®¹å™¨ä»“åº“ ğŸ“¦ å®‰è£…å¤æ‚åº¦ âœ… ç®€å• âš ï¸ ç•¥å¤æ‚ï¼Œä½†å¯æŒ‰éœ€å¯ç”¨æ¨¡å— éƒ¨ç½² Kubesphere Kubesphere å¯¹ç³»ç»Ÿèµ„æºæœ‰æœ€ä½è¦æ±‚ï¼Œå…·ä½“å‚è€ƒå®˜ç½‘:ç¯å¢ƒè¦æ±‚ éƒ¨ç½² 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# å¦‚æœæ— æ³•è®¿é—® charts.kubesphere.io, å¯å°† charts.kubesphere.io æ›¿æ¢ä¸º charts.kubesphere.com.cnhelm upgrade --install -n kubesphere-system --create-namespace ks-core https://charts.kubesphere.io/main/ks-core-1.1.4.tgz --debug --wait## å®‰è£…æˆåŠŸåä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼šNOTES:Thank you for choosing KubeSphere Helm Chart.Please be patient and wait for several seconds for the KubeSphere deployment to complete.1. Wait for Deployment Completion Confirm that all KubeSphere components are running by executing the following command: kubectl get pods -n kubesphere-system2. Access the KubeSphere Console Once the deployment is complete, you can access the KubeSphere console using the following URL: http://10.211.55.11:308803. Login to KubeSphere Console Use the following credentials to log in: Account: admin Password: P@88w0rdNOTE: It is highly recommended to change the default password immediately after the first login.For additional information and details, please visit https://kubesphere.io.# æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶$ kubectl get pod,deploy,svc -n kubesphere-systemNAME READY STATUS RESTARTS AGEpod/extensions-museum-ffd8bd9d8-fvcw4 1/1 Running 1 (28m ago) 5h5mpod/ks-apiserver-7b4479d5f5-2k4c9 1/1 Running 2 (27m ago) 5h5mpod/ks-console-6bd9b9f5d9-xqlzs 1/1 Running 0 26mpod/ks-controller-manager-547f9fc8c9-5b88z 1/1 Running 10 (27m ago) 5h5mNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/extensions-museum 1/1 1 1 5h14mdeployment.apps/ks-apiserver 1/1 1 1 5h14mdeployment.apps/ks-console 1/1 1 1 5h14mdeployment.apps/ks-controller-manager 1/1 1 1 5h14mNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/extensions-museum ClusterIP 10.96.95.71 &lt;none&gt; 443/TCP 5h14mservice/ks-apiserver ClusterIP 10.96.12.106 &lt;none&gt; 80/TCP 5h14mservice/ks-console NodePort 10.96.55.165 &lt;none&gt; 80:30880/TCP 5h14mservice/ks-controller-manager ClusterIP 10.96.13.243 &lt;none&gt; 443/TCP 5h14m æµè§ˆå™¨è®¿é—®ï¼šhttp://10.211.55.11:30880ï¼Œè¾“å…¥è´¦å·å¯†ç ï¼šadmin/P@88w0rdï¼Œé¦–æ¬¡ç™»å½•éœ€è¦ä¿®æ”¹å¯†ç ã€‚ é…ç½® ingress åˆ›å»ºè¯ä¹¦ 1234kubectl create secret tls nginx-tls \\ --key=nginx_ssl/nginx.hanqunfeng.com.key \\ --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\ -n kubesphere-system åˆ›å»º ingress 12345678910111213141516171819202122232425# kubesphere-ingress.yamlapiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: kubesphere-nginx namespace: kubesphere-system annotations: nginx.ingress.kubernetes.io/force-ssl-redirect: &quot;true&quot;spec: ingressClassName: nginx tls: - hosts: - kubesphere.hanqunfeng.com secretName: nginx-tls rules: - host: kubesphere.hanqunfeng.com http: paths: - pathType: Prefix path: / backend: service: name: ks-console port: number: 80 å¸è½½ Kubesphere 12helm uninstall ks-core -n kubesphere-systemkubectl delete namespace kubesphere-system","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Kubesphere å®˜ç½‘","date_published":"2025-07-24T14:33:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-dashboard/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-dashboard/","title":"K8S UI ä¹‹ Dashboard","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/\">Dashboard k8sä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Dashboard-ç®€ä»‹\">Dashboard ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Dashboard æ˜¯åŸºäºç½‘é¡µçš„ Kubernetes ç”¨æˆ·ç•Œé¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½ å¯ä»¥ä½¿ç”¨ Dashboard å°†å®¹å™¨åº”ç”¨éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œä¹Ÿå¯ä»¥å¯¹å®¹å™¨åº”ç”¨æ’é”™ï¼Œè¿˜èƒ½ç®¡ç†é›†ç¾¤èµ„æºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½ å¯ä»¥ä½¿ç”¨ Dashboard è·å–è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„åº”ç”¨çš„æ¦‚è§ˆä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæˆ–è€…ä¿®æ”¹ Kubernetes èµ„æº ï¼ˆå¦‚ Deploymentã€Jobã€DaemonSet ç­‰ç­‰ï¼‰ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥å¯¹ Deployment å®ç°å¼¹æ€§ä¼¸ç¼©ã€å‘èµ·æ»šåŠ¨å‡çº§ã€é‡å¯ Pod æˆ–è€…ä½¿ç”¨å‘å¯¼åˆ›å»ºæ–°çš„åº”ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Dashboard åŒæ—¶å±•ç¤ºäº† Kubernetes é›†ç¾¤ä¸­çš„èµ„æºçŠ¶æ€ä¿¡æ¯å’Œæ‰€æœ‰æŠ¥é”™ä¿¡æ¯ã€‚</p>\n</li>\n</ul>\n<h2 id=\"éƒ¨ç½²-Dashboard\">éƒ¨ç½² Dashboard</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubernetes Dashboard ç›®å‰ä»…æ”¯æŒåŸºäº Helm çš„å®‰è£…ï¼Œå› ä¸ºå®ƒé€Ÿåº¦æ›´å¿«ï¼Œ å¹¶ä¸”å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°æ§åˆ¶ Dashboard è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ  kubernetes-dashboard ä»“åº“</span></span><br><span class=\"line\">helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ kubernetes-dashboard Chart éƒ¨ç½²åä¸º `kubernetes-dashboard` çš„ Helm Release</span></span><br><span class=\"line\">$ helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\</span><br><span class=\"line\">    --create-namespace \\</span><br><span class=\"line\">    --namespace kubernetes-dashboard</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">Release <span class=\"string\">&quot;kubernetes-dashboard&quot;</span> does not exist. Installing it now.</span><br><span class=\"line\">NAME: kubernetes-dashboard</span><br><span class=\"line\">LAST DEPLOYED: Sun Jul  6 00:40:02 2025</span><br><span class=\"line\">NAMESPACE: kubernetes-dashboard</span><br><span class=\"line\">STATUS: deployed</span><br><span class=\"line\">REVISION: 1</span><br><span class=\"line\">TEST SUITE: None</span><br><span class=\"line\">NOTES:</span><br><span class=\"line\">*************************************************************************************************</span><br><span class=\"line\">*** PLEASE BE PATIENT: Kubernetes Dashboard may need a few minutes to get up and become ready ***</span><br><span class=\"line\">*************************************************************************************************</span><br><span class=\"line\"></span><br><span class=\"line\">Congratulations! You have just installed Kubernetes Dashboard <span class=\"keyword\">in</span> your cluster.</span><br><span class=\"line\"></span><br><span class=\"line\">To access Dashboard run:</span><br><span class=\"line\">  kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: In <span class=\"keyword\">case</span> port-forward <span class=\"built_in\">command</span> does not work, make sure that kong service name is correct.</span><br><span class=\"line\">      Check the services <span class=\"keyword\">in</span> Kubernetes Dashboard namespace using:</span><br><span class=\"line\">        kubectl -n kubernetes-dashboard get svc</span><br><span class=\"line\"></span><br><span class=\"line\">Dashboard will be available at:</span><br><span class=\"line\">  https://localhost:8443</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ helm å®‰è£…çš„åŒ…ï¼Œæ³¨æ„æŒ‡å®š å‘½åç©ºé—´</span></span><br><span class=\"line\">$ helm list -n kubernetes-dashboard</span><br><span class=\"line\">NAME                \tNAMESPACE           \tREVISION\tUPDATED                                \tSTATUS  \tCHART                      \tAPP VERSION</span><br><span class=\"line\">kubernetes-dashboard\tkubernetes-dashboard\t1       \t2025-07-24 14:01:06.678570212 +0800 CST\tdeployed\tkubernetes-dashboard-7.13.0</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å¯åŠ¨çš„èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl -n kubernetes-dashboard get all</span><br><span class=\"line\">NAME                                                       READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">pod/kubernetes-dashboard-api-568f47ddd7-tx6f8              1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-auth-645b944589-t6v2m             1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-kong-648658d45f-7qsm9             1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-metrics-scraper-547874fcf-87mrv   1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-web-7796b9fbbb-xsdlw              1/1     Running   0          20m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class=\"line\">service/kubernetes-dashboard-api               ClusterIP   10.96.149.59    &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\">service/kubernetes-dashboard-auth              ClusterIP   10.96.145.120   &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\">service/kubernetes-dashboard-kong-proxy        ClusterIP   10.96.171.40    &lt;none&gt;        443/TCP    20m</span><br><span class=\"line\">service/kubernetes-dashboard-metrics-scraper   ClusterIP   10.96.79.48     &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\">service/kubernetes-dashboard-web               ClusterIP   10.96.247.143   &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                                   READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-api               1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-auth              1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-kong              1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-metrics-scraper   1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-web               1/1     1            1           20m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                                             DESIRED   CURRENT   READY   AGE</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-api-568f47ddd7              1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-auth-645b944589             1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-kong-648658d45f             1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-metrics-scraper-547874fcf   1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-web-7796b9fbbb              1         1         1       20m</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">ç¬¬ä¸€æ¬¡åˆ›å»ºkubernetes-dashboardæ—¶ï¼Œæœ‰å‡ ä¸ª pod ä¸€ç›´å¤„äº ContainerCreating çŠ¶æ€ï¼Œé€šè¿‡ describe å‘½ä»¤ï¼ŒæŸ¥çœ‹ pod çš„çŠ¶æ€å‘ç°æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Warning  FailedCreatePodSandBox  4m52s                kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network <span class=\"keyword\">for</span> sandbox <span class=\"string\">&quot;cfa0b6062fabd77353e6d832ab0e62f96787b4d59346d9e57c28dbc0e19a3127&quot;</span>: plugin <span class=\"built_in\">type</span>=<span class=\"string\">&quot;calico&quot;</span> failed (add): error getting ClusterInformation: connection is unauthorized: Unauthorized</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>è¿™æ¡é”™è¯¯è¯´æ˜ï¼š</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">å®¹å™¨ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰ä½¿ç”¨çš„æ˜¯ Calico</li>\n<li class=\"lvl-6\">Calico åœ¨å°è¯•è·å– Kubernetes é›†ç¾¤çš„ ClusterInformation æ—¶ è®¤è¯å¤±è´¥</li>\n<li class=\"lvl-6\">é”™è¯¯å…³é”®è¯ï¼šconnection is unauthorized: Unauthorized</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ç¡®å®šå¯¼è‡´è¿™ä¸€é—®é¢˜çš„åŸå› ï¼Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯é‡æ–°å®‰è£… Calico</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete -f calico.yaml</span><br><span class=\"line\">kubectl apply -f calico.yaml</span><br></pre></td></tr></table></figure>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¼€æ”¾ä»£ç†ç«¯å£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨å“ªä¸ªæœºå™¨ä¸Šè¿è¡Œçš„å‘½ä»¤ï¼Œå¼€æ”¾çš„å°±æ˜¯å“ªä¸ªæœºå™¨çš„ç«¯å£</span></span><br><span class=\"line\">kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®ï¼šåœ¨å¼€æ”¾ä»£ç†ç«¯å£çš„æœºå™¨ä¸Šä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼š<a href=\"https://localhost:8443\">https://localhost:8443</a></p>\n</li>\n</ul>\n<h2 id=\"ç™»å½•å¸å·\">ç™»å½•å¸å·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># dashboard-adminuser.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span>                    <span class=\"comment\"># åˆ›å»º ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span>                      <span class=\"comment\"># SA åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubernetes-dashboard</span>       <span class=\"comment\"># SA æ‰€åœ¨å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span>                <span class=\"comment\"># é›†ç¾¤è§’è‰²ç»‘å®š</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span>   <span class=\"comment\"># é›†ç¾¤è§’è‰²ç»„ï¼Œè¿™ä¸ªæ˜¯ k8s å†…ç½®çš„</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span>                     <span class=\"comment\"># é›†ç¾¤è§’è‰²</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">cluster-admin</span>                   <span class=\"comment\"># é›†ç¾¤ç®¡ç†å‘˜è§’è‰²</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span>                  <span class=\"comment\"># æœåŠ¡è´¦å·</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span>                      <span class=\"comment\"># æœåŠ¡è´¦å·åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubernetes-dashboard</span>       <span class=\"comment\"># æœåŠ¡è´¦å·å‘½åç©ºé—´</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºå¹¶è·å–token</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f dashboard-adminuser.yaml</span><br><span class=\"line\"><span class=\"comment\"># è·å–tokenï¼Œè¯¥ token æœ‰æ•ˆæœŸä¸º 1 å°æ—¶ï¼Œtokenæ ¼å¼ä¸º jwtï¼Œå¯ä»¥é€šè¿‡ jwt.io è§£æ</span></span><br><span class=\"line\">kubectl -n kubernetes-dashboard create token admin-user</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å–é•¿æ•ˆtoken</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># dashboard-secret.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubernetes-dashboard</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">kubernetes.io/service-account.name:</span> <span class=\"string\">&quot;admin-user&quot;</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/service-account-token</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f dashboard-secret.yaml</span><br><span class=\"line\"><span class=\"comment\"># è¯¥å‘½ä»¤è·å–tokenï¼Œæ°¸ä¸è¿‡æœŸï¼Œå°†å…¶ä¿å­˜ä¸‹æ¥</span></span><br><span class=\"line\">kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath=<span class=\"string\">&quot;&#123;.data.token&#125;&quot;</span> | <span class=\"built_in\">base64</span> -d</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸è½½-kubernetes-dashboard\">å¸è½½ kubernetes-dashboard</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸è½½ kubernetes-dashboard</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm uninstall kubernetes-dashboard --namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¸…ç†ç”¨æˆ·ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl -n kubernetes-dashboard delete serviceaccount admin-user</span><br><span class=\"line\">kubectl -n kubernetes-dashboard delete clusterrolebinding admin-user</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ å‘½åç©ºé—´ï¼Œåˆ é™¤å‘½åç©ºé—´ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰èµ„æº</span></span><br><span class=\"line\">kubectl delete namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Dashboard k8sä»‹ç» Dashboard ç®€ä»‹ Dashboard æ˜¯åŸºäºç½‘é¡µçš„ Kubernetes ç”¨æˆ·ç•Œé¢ã€‚ ä½ å¯ä»¥ä½¿ç”¨ Dashboard å°†å®¹å™¨åº”ç”¨éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œä¹Ÿå¯ä»¥å¯¹å®¹å™¨åº”ç”¨æ’é”™ï¼Œè¿˜èƒ½ç®¡ç†é›†ç¾¤èµ„æºã€‚ ä½ å¯ä»¥ä½¿ç”¨ Dashboard è·å–è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„åº”ç”¨çš„æ¦‚è§ˆä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæˆ–è€…ä¿®æ”¹ Kubernetes èµ„æº ï¼ˆå¦‚ Deploymentã€Jobã€DaemonSet ç­‰ç­‰ï¼‰ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥å¯¹ Deployment å®ç°å¼¹æ€§ä¼¸ç¼©ã€å‘èµ·æ»šåŠ¨å‡çº§ã€é‡å¯ Pod æˆ–è€…ä½¿ç”¨å‘å¯¼åˆ›å»ºæ–°çš„åº”ç”¨ã€‚ Dashboard åŒæ—¶å±•ç¤ºäº† Kubernetes é›†ç¾¤ä¸­çš„èµ„æºçŠ¶æ€ä¿¡æ¯å’Œæ‰€æœ‰æŠ¥é”™ä¿¡æ¯ã€‚ éƒ¨ç½² Dashboard Kubernetes Dashboard ç›®å‰ä»…æ”¯æŒåŸºäº Helm çš„å®‰è£…ï¼Œå› ä¸ºå®ƒé€Ÿåº¦æ›´å¿«ï¼Œ å¹¶ä¸”å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°æ§åˆ¶ Dashboard è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚ 1234567891011121314151617181920212223242526272829303132333435# æ·»åŠ  kubernetes-dashboard ä»“åº“helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/# ä½¿ç”¨ kubernetes-dashboard Chart éƒ¨ç½²åä¸º `kubernetes-dashboard` çš„ Helm Release$ helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\ --create-namespace \\ --namespace kubernetes-dashboard## è¾“å‡ºRelease &quot;kubernetes-dashboard&quot; does not exist. Installing it now.NAME: kubernetes-dashboardLAST DEPLOYED: Sun Jul 6 00:40:02 2025NAMESPACE: kubernetes-dashboardSTATUS: deployedREVISION: 1TEST SUITE: NoneNOTES:**************************************************************************************************** PLEASE BE PATIENT: Kubernetes Dashboard may need a few minutes to get up and become ready ****************************************************************************************************Congratulations! You have just installed Kubernetes Dashboard in your cluster.To access Dashboard run: kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443NOTE: In case port-forward command does not work, make sure that kong service name is correct. Check the services in Kubernetes Dashboard namespace using: kubectl -n kubernetes-dashboard get svcDashboard will be available at: https://localhost:8443# æŸ¥çœ‹ helm å®‰è£…çš„åŒ…ï¼Œæ³¨æ„æŒ‡å®š å‘½åç©ºé—´$ helm list -n kubernetes-dashboardNAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSIONkubernetes-dashboard kubernetes-dashboard 1 2025-07-24 14:01:06.678570212 +0800 CST deployed kubernetes-dashboard-7.13.0 æŸ¥çœ‹å¯åŠ¨çš„èµ„æº 12345678910111213141516171819202122232425262728$ kubectl -n kubernetes-dashboard get allNAME READY STATUS RESTARTS AGEpod/kubernetes-dashboard-api-568f47ddd7-tx6f8 1/1 Running 0 20mpod/kubernetes-dashboard-auth-645b944589-t6v2m 1/1 Running 0 20mpod/kubernetes-dashboard-kong-648658d45f-7qsm9 1/1 Running 0 20mpod/kubernetes-dashboard-metrics-scraper-547874fcf-87mrv 1/1 Running 0 20mpod/kubernetes-dashboard-web-7796b9fbbb-xsdlw 1/1 Running 0 20mNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/kubernetes-dashboard-api ClusterIP 10.96.149.59 &lt;none&gt; 8000/TCP 20mservice/kubernetes-dashboard-auth ClusterIP 10.96.145.120 &lt;none&gt; 8000/TCP 20mservice/kubernetes-dashboard-kong-proxy ClusterIP 10.96.171.40 &lt;none&gt; 443/TCP 20mservice/kubernetes-dashboard-metrics-scraper ClusterIP 10.96.79.48 &lt;none&gt; 8000/TCP 20mservice/kubernetes-dashboard-web ClusterIP 10.96.247.143 &lt;none&gt; 8000/TCP 20mNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/kubernetes-dashboard-api 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-auth 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-kong 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-metrics-scraper 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-web 1/1 1 1 20mNAME DESIRED CURRENT READY AGEreplicaset.apps/kubernetes-dashboard-api-568f47ddd7 1 1 1 20mreplicaset.apps/kubernetes-dashboard-auth-645b944589 1 1 1 20mreplicaset.apps/kubernetes-dashboard-kong-648658d45f 1 1 1 20mreplicaset.apps/kubernetes-dashboard-metrics-scraper-547874fcf 1 1 1 20mreplicaset.apps/kubernetes-dashboard-web-7796b9fbbb 1 1 1 20m å°è´´å£« ç¬¬ä¸€æ¬¡åˆ›å»ºkubernetes-dashboardæ—¶ï¼Œæœ‰å‡ ä¸ª pod ä¸€ç›´å¤„äº ContainerCreating çŠ¶æ€ï¼Œé€šè¿‡ describe å‘½ä»¤ï¼ŒæŸ¥çœ‹ pod çš„çŠ¶æ€å‘ç°æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š 1Warning FailedCreatePodSandBox 4m52s kubelet Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network for sandbox &quot;cfa0b6062fabd77353e6d832ab0e62f96787b4d59346d9e57c28dbc0e19a3127&quot;: plugin type=&quot;calico&quot; failed (add): error getting ClusterInformation: connection is unauthorized: Unauthorized è¿™æ¡é”™è¯¯è¯´æ˜ï¼š å®¹å™¨ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰ä½¿ç”¨çš„æ˜¯ Calico Calico åœ¨å°è¯•è·å– Kubernetes é›†ç¾¤çš„ ClusterInformation æ—¶ è®¤è¯å¤±è´¥ é”™è¯¯å…³é”®è¯ï¼šconnection is unauthorized: Unauthorized ä¸ç¡®å®šå¯¼è‡´è¿™ä¸€é—®é¢˜çš„åŸå› ï¼Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯é‡æ–°å®‰è£… Calico 12kubectl delete -f calico.yamlkubectl apply -f calico.yaml å¼€æ”¾ä»£ç†ç«¯å£ 12# åœ¨å“ªä¸ªæœºå™¨ä¸Šè¿è¡Œçš„å‘½ä»¤ï¼Œå¼€æ”¾çš„å°±æ˜¯å“ªä¸ªæœºå™¨çš„ç«¯å£kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443 è®¿é—®ï¼šåœ¨å¼€æ”¾ä»£ç†ç«¯å£çš„æœºå™¨ä¸Šä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼šhttps://localhost:8443 ç™»å½•å¸å· åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ· 12345678910111213141516171819# dashboard-adminuser.yamlapiVersion: v1kind: ServiceAccount # åˆ›å»º ServiceAccountmetadata: name: admin-user # SA åç§° namespace: kubernetes-dashboard # SA æ‰€åœ¨å‘½åç©ºé—´---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBinding # é›†ç¾¤è§’è‰²ç»‘å®šmetadata: name: admin-userroleRef: apiGroup: rbac.authorization.k8s.io # é›†ç¾¤è§’è‰²ç»„ï¼Œè¿™ä¸ªæ˜¯ k8s å†…ç½®çš„ kind: ClusterRole # é›†ç¾¤è§’è‰² name: cluster-admin # é›†ç¾¤ç®¡ç†å‘˜è§’è‰²subjects:- kind: ServiceAccount # æœåŠ¡è´¦å· name: admin-user # æœåŠ¡è´¦å·åç§° namespace: kubernetes-dashboard # æœåŠ¡è´¦å·å‘½åç©ºé—´ åˆ›å»ºå¹¶è·å–token 123kubectl apply -f dashboard-adminuser.yaml# è·å–tokenï¼Œè¯¥ token æœ‰æ•ˆæœŸä¸º 1 å°æ—¶ï¼Œtokenæ ¼å¼ä¸º jwtï¼Œå¯ä»¥é€šè¿‡ jwt.io è§£ækubectl -n kubernetes-dashboard create token admin-user è·å–é•¿æ•ˆtoken 123456789# dashboard-secret.yamlapiVersion: v1kind: Secretmetadata: name: admin-user namespace: kubernetes-dashboard annotations: kubernetes.io/service-account.name: &quot;admin-user&quot;type: kubernetes.io/service-account-token 123kubectl apply -f dashboard-secret.yaml# è¯¥å‘½ä»¤è·å–tokenï¼Œæ°¸ä¸è¿‡æœŸï¼Œå°†å…¶ä¿å­˜ä¸‹æ¥kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath=&quot;&#123;.data.token&#125;&quot; | base64 -d å¸è½½ kubernetes-dashboard å¸è½½ kubernetes-dashboard 1helm uninstall kubernetes-dashboard --namespace kubernetes-dashboard æ¸…ç†ç”¨æˆ·ä¿¡æ¯ 12345kubectl -n kubernetes-dashboard delete serviceaccount admin-userkubectl -n kubernetes-dashboard delete clusterrolebinding admin-user# ä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ å‘½åç©ºé—´ï¼Œåˆ é™¤å‘½åç©ºé—´ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰èµ„æºkubectl delete namespace kubernetes-dashboard","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Dashboard k8sä»‹ç»","date_published":"2025-07-24T13:33:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-tools/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-tools/","title":"K8S ä¹‹ Tools","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-3\">\n<p>K8S çš„ Tools: crictlã€nerdctlã€helm ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"crictl-å‘½ä»¤\">crictl å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>crictl</code> æ˜¯k8så®˜æ–¹å‡ºå“çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ containerd è¿›è¡Œé€šä¿¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>crictl</code> å‘½ä»¤é»˜è®¤éœ€è¦ sudo æƒé™ï¼Œå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ  sudoï¼Œå¯ä»¥å°†ç”¨æˆ·åŠ å…¥ containerd çš„ socket æƒé™ç»„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># containerd çš„é»˜è®¤ socket æ˜¯ /var/run/containerd/containerd.sock</span></span><br><span class=\"line\">$ <span class=\"built_in\">ls</span> -l /var/run/containerd/containerd.sock</span><br><span class=\"line\">srw-rw---- 1 root root 0 7æœˆ   1 10:57 /var/run/containerd/containerd.sock</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœ group æ˜¯ rootï¼šä½ å¯ä»¥æ”¹ä¸ºå…¶å®ƒç»„ï¼Œæ¯”å¦‚ docker</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœ docker ç»„ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> groupadd docker</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹æ–‡ä»¶æ‰€å±ç»„ä¸º docker</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chgrp</span> docker /var/run/containerd/containerd.sock</span><br><span class=\"line\"><span class=\"comment\"># ä¸ºç»„æ·»åŠ è¯»å†™æƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> g+rw /var/run/containerd/containerd.sock</span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ ç”¨æˆ·åˆ° docker ç»„</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> usermod -aG docker <span class=\"variable\">$USER</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ·æ–°æƒé™</span></span><br><span class=\"line\">newgrp docker</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶è™½ç„¶å·²ç»å¯ä»¥ä¸ç”¨ sudo äº†ï¼Œä½†æ˜¯ä¸€æ—¦é‡å¯ containerd å°±ä¼šé‡æ–°å›åˆ° root æƒé™ï¼Œå› æ­¤éœ€è¦æ·»åŠ å¦‚ä¸‹é…ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /etc/systemd/system/containerd.service.d/</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/systemd/system/containerd.service.d/override.conf &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">[Service]</span></span><br><span class=\"line\"><span class=\"string\">ExecStartPost=/bin/bash -c &#x27;chmod 660 /run/containerd/containerd.sock &amp;&amp; chgrp docker /run/containerd/containerd.sock&#x27;</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl daemon-reload</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart containerd</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>crictl</code> å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç±»ä¼¼<code>docker</code>å‘½ä»¤</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ“ä½œ</th>\n<th><code>docker</code> å‘½ä»¤</th>\n<th><code>crictl</code> å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</td>\n<td><code>docker ps</code></td>\n<td><code>crictl ps</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢ï¼‰</td>\n<td><code>docker ps -a</code></td>\n<td><code>crictl ps -a</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹é•œåƒ</td>\n<td><code>docker images</code></td>\n<td><code>crictl images</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</td>\n<td><code>docker logs &lt;container_id&gt;</code></td>\n<td><code>crictl logs &lt;container_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>è¿›å…¥å®¹å™¨äº¤äº’</td>\n<td><code>docker exec -it &lt;id&gt; sh</code></td>\n<td><code>crictl exec -it &lt;id&gt; sh</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</td>\n<td><code>docker inspect &lt;container_id&gt;</code></td>\n<td><code>crictl inspect &lt;container_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯</td>\n<td>âŒï¼ˆä¸æ”¯æŒï¼‰</td>\n<td><code>crictl inspectp &lt;pod_id&gt;</code></td>\n<td>K8s ä¸“å±</td>\n</tr>\n<tr>\n<td>åˆ é™¤å®¹å™¨</td>\n<td><code>docker rm &lt;container_id&gt;</code></td>\n<td><code>crictl rm &lt;container_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>åˆ é™¤é•œåƒ</td>\n<td><code>docker rmi &lt;image_id&gt;</code></td>\n<td><code>crictl rmi &lt;image_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æ‹‰å–é•œåƒ</td>\n<td><code>docker pull nginx</code></td>\n<td><code>crictl pull nginx</code></td>\n<td></td>\n</tr>\n<tr>\n<td>è¿è¡Œå®¹å™¨ï¼ˆé K8s åœºæ™¯ï¼‰</td>\n<td><code>docker run -it nginx</code></td>\n<td>âŒï¼ˆä¸æ”¯æŒï¼‰</td>\n<td><code>crictl</code> ä¸è¿è¡Œå®¹å™¨ï¼Œä»…è°ƒè¯•ç°æœ‰å®¹å™¨</td>\n</tr>\n<tr>\n<td>åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶ä¿¡æ¯</td>\n<td><code>docker info</code></td>\n<td><code>crictl info</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€</td>\n<td><code>docker stats</code></td>\n<td><code>crictl stats</code></td>\n<td>ç®€è¦ç‰ˆ</td>\n</tr>\n<tr>\n<td>è®¾ç½®é…ç½®æ–‡ä»¶</td>\n<td><code>~/.docker/config.json</code></td>\n<td><code>/etc/crictl.yaml</code></td>\n<td>å¦‚è®¾ç½® endpoint</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"nerdctl\">nerdctl</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/containerd/nerdctl\">nerdctl</a> æ˜¯ä¸€ä¸ª å…¼å®¹ Docker CLI çš„å®¹å™¨å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† containerd å®¹å™¨è¿è¡Œæ—¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒæ˜¯ containerd å®˜æ–¹å­é¡¹ç›®ï¼Œç”± CNCF ç»´æŠ¤ï¼Œå…¶å‘½ä»¤è¯­æ³•ä¸ Docker CLI å…¼å®¹ï¼Œç›®æ ‡æ˜¯è®©ä¹ æƒ¯ Docker çš„ç”¨æˆ·ä¹Ÿèƒ½è½»æ¾ä½¿ç”¨ containerdã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£… nerdctl</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</span></span><br><span class=\"line\">VERSION=2.1.3</span><br><span class=\"line\">wget https://github.com/containerd/nerdctl/releases/download/v<span class=\"variable\">$&#123;VERSION&#125;</span>/nerdctl-<span class=\"variable\">$&#123;VERSION&#125;</span>-linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. è§£å‹</span></span><br><span class=\"line\">tar -xvf nerdctl-<span class=\"variable\">$&#123;VERSION&#125;</span>-linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. ç§»åŠ¨åˆ°ç³»ç»Ÿ PATH</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mv</span> nerdctl /usr/local/bin/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># nerdctl éœ€è¦ sudo æƒé™</span></span><br><span class=\"line\"><span class=\"comment\">## ä¸º sudo æ·»åŠ  PATH</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> visudo</span><br><span class=\"line\"><span class=\"comment\">## æ‰¾åˆ°è¿™ä¸€è¡Œ</span></span><br><span class=\"line\">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin</span><br><span class=\"line\"><span class=\"comment\">## ä¿®æ”¹ä¸ºï¼Œå³å°† nerdctl æ‰€åœ¨çš„ç›®å½•åŠ å…¥ PATH</span></span><br><span class=\"line\">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin:/usr/local/bin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.æµ‹è¯•</span></span><br><span class=\"line\"><span class=\"comment\">## æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> nerdctl version</span><br><span class=\"line\"><span class=\"comment\">## åˆ—å‡ºå®¹å™¨ï¼Œ--namespace k8s.io è¡¨ç¤ºæŸ¥çœ‹ k8s ä¸­çš„å®¹å™¨</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> nerdctl ps --namespace k8s.io</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ ä¸Š --namespace k8s.ioï¼Œå¯ä»¥è®¾ç½®åˆ«å</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;alias kps=&#x27;sudo nerdctl --namespace=k8s.io ps&#x27;&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"><span class=\"comment\">## æµ‹è¯•</span></span><br><span class=\"line\">kps</span><br></pre></td></tr></table></figure>\n<h2 id=\"Helm\">Helm</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://helm.sh/zh/docs/\">å®˜ç½‘æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Helm æ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼äº Linux ä¸‹çš„åŒ…ç®¡ç†å·¥å…·å¦‚ yumã€apt ç­‰ã€‚å¯ä»¥æ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„ yaml æ–‡ä»¶éƒ¨ç½²åˆ° Kunernetes ä¸Šã€‚</p>\n</li>\n</ul>\n<h3 id=\"Helmçš„å®‰è£…\">Helmçš„å®‰è£…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®˜ç½‘<a href=\"https://helm.sh/zh/docs/intro/install/\">å®‰è£…æ–¹æ³•</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://get.helm.sh/helm-v3.17.4-linux-amd64.tar.gz</span><br><span class=\"line\">tar -zxvf helm-v3.17.4-linux-amd64.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mv</span> linux-amd64/helm /usr/local/bin/helm</span><br><span class=\"line\">$ helm version</span><br><span class=\"line\">version.BuildInfo&#123;Version:<span class=\"string\">&quot;v3.17.4&quot;</span>, GitCommit:<span class=\"string\">&quot;595a05da6166037d0abebaa27ac8a498fa4d7ed2&quot;</span>, GitTreeState:<span class=\"string\">&quot;clean&quot;</span>, GoVersion:<span class=\"string\">&quot;go1.23.10&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Helm<a href=\"https://helm.sh/zh/docs/helm/helm_completion_bash/\">è‡ªåŠ¨è¡¥å…¨</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£… helm çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</span></span><br><span class=\"line\"><span class=\"comment\"># 1 å½“å‰ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;source &lt;(helm completion bash)&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2 æ‰€æœ‰ç”¨æˆ·</span></span><br><span class=\"line\">helm completion bash | <span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/bash_completion.d/helm &gt; /dev/null</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> a+r /etc/bash_completion.d/helm</span><br></pre></td></tr></table></figure>\n<h3 id=\"Helmçš„ä½¿ç”¨\">Helmçš„ä½¿ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥å‚è€ƒ <a href=\"/2023/07/10/aws-eks14-helm/\" title=\"AWS-EKS-14--Helm\">AWS-EKS-14--Helm</a></p>\n</li>\n</ul>\n<h4 id=\"ä»“åº“ç®¡ç†\">ä»“åº“ç®¡ç†</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>addï¼šæ·»åŠ å›¾è¡¨å­˜å‚¨åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>listï¼šåˆ—å‡ºå›¾è¡¨å­˜å‚¨åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm repo list</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>removeï¼šåˆ é™¤å›¾è¡¨å­˜å‚¨åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm repo remove bitnami</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>updateï¼šä»å›¾è¡¨å­˜å‚¨åº“æ›´æ–°æœ¬åœ°å¯ç”¨å›¾è¡¨çš„ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ›´æ–°æ‰€æœ‰ä»“åº“</span></span><br><span class=\"line\">helm repo update</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°æŒ‡å®šçš„ä»“åº“</span></span><br><span class=\"line\">helm repo update bitnami</span><br></pre></td></tr></table></figure>\n<h4 id=\"åœ¨ä»“åº“ä¸­æœç´¢\">åœ¨ä»“åº“ä¸­æœç´¢</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨æ‰€æœ‰ä»“åº“ä¸­æœç´¢ï¼Œé»˜è®¤åªå±•ç¤ºæœ€æ–°çš„ç‰ˆæœ¬</span></span><br><span class=\"line\">helm search repo nginx</span><br><span class=\"line\"><span class=\"comment\"># åœ¨æŒ‡å®šçš„ä»“åº“ä¸­æœç´¢</span></span><br><span class=\"line\">helm search repo bitnami/wordpress</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºæ‰€æœ‰ç‰ˆæœ¬</span></span><br><span class=\"line\">helm search repo nginx -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨å…¨éƒ¨ç‰ˆæœ¬ä¸­æœç´¢å¤§äºç­‰äºæŒ‡å®šç‰ˆæœ¬</span></span><br><span class=\"line\">$ helm search repo nginx --version ^21.0.0 -l</span><br><span class=\"line\">NAME         \tCHART VERSION\tAPP VERSION\tDESCRIPTION</span><br><span class=\"line\">bitnami/nginx\t21.0.8       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.7       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.6       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.4       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.3       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.2       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.1       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.0       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br></pre></td></tr></table></figure>\n<h4 id=\"å®‰è£…åŒ…\">å®‰è£…åŒ…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">helm install nginx bitnami/nginx</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br><span class=\"line\">helm install nginx bitnami/nginx --version 21.0.3</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…åŒ…åˆ°æŒ‡å®šå‘½åç©ºé—´</span></span><br><span class=\"line\">helm install nginx bitnami/nginx -n &lt;namespace&gt;</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…åŒ…å¹¶åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class=\"line\">helm install nginx bitnami/nginx -n &lt;namespace&gt; --create-namespace</span><br><span class=\"line\"><span class=\"comment\"># ociï¼š ä» docker ä»“åº“ä¸­å®‰è£…</span></span><br><span class=\"line\">helm pull oci://registry-1.docker.io/bitnamicharts/nginx --version 21.0.8</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æœ¬åœ° chart ç›®å½•</span></span><br><span class=\"line\">helm install my-release ./nginx</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… .tgz æ ¼å¼çš„æ‰“åŒ… chart</span></span><br><span class=\"line\">helm install my-release ./nginx-1.2.3.tgz</span><br><span class=\"line\"><span class=\"comment\"># ä»è¿œç¨‹tgzå®‰è£…</span></span><br><span class=\"line\">helm install my-release https://example.com/charts/nginx-1.2.3.tgz</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… Git ä»“åº“ä¸­çš„ chartï¼ˆç»“åˆ pluginï¼‰</span></span><br><span class=\"line\">helm plugin install https://github.com/aslafy-z/helm-git</span><br><span class=\"line\">helm repo add mychart <span class=\"string\">&#x27;git+https://github.com/myorg/mychart.git&#x27;</span></span><br><span class=\"line\">helm install my-release mychart/nginx</span><br><span class=\"line\"><span class=\"comment\"># å¸è½½helm-gitæ’ä»¶</span></span><br><span class=\"line\">helm plugin remove helm-git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ --set ä¼ é€’å•ä¸ªæˆ–å¤šä¸ªå€¼</span></span><br><span class=\"line\">helm install my-release bitnami/nginx --<span class=\"built_in\">set</span> service.type=NodePort</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ --values æˆ– -f åŠ è½½ YAML é…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">helm install my-release bitnami/nginx -f custom-values.yaml</span><br><span class=\"line\"><span class=\"comment\"># åŒæ—¶ä½¿ç”¨å¤šç§ values æ–‡ä»¶ + --set</span></span><br><span class=\"line\">helm install my-release bitnami/nginx -f base.yaml -f prod.yaml --<span class=\"built_in\">set</span> replicaCount=3</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…\">æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´å·²å®‰è£…çš„åŒ…</span></span><br><span class=\"line\">helm list -n &lt;namespace&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„åŒ…</span></span><br><span class=\"line\">helm list -A</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…çŠ¶æ€</span></span><br><span class=\"line\">helm status ngxin -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¸è½½åŒ…\">å¸è½½åŒ…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm uninstall nginx -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ K8S çš„ Tools: crictlã€nerdctlã€helm ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github crictl å‘½ä»¤ crictl æ˜¯k8så®˜æ–¹å‡ºå“çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ containerd è¿›è¡Œé€šä¿¡ã€‚ crictl å‘½ä»¤é»˜è®¤éœ€è¦ sudo æƒé™ï¼Œå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ  sudoï¼Œå¯ä»¥å°†ç”¨æˆ·åŠ å…¥ containerd çš„ socket æƒé™ç»„ 123456789101112131415161718192021222324# containerd çš„é»˜è®¤ socket æ˜¯ /var/run/containerd/containerd.sock$ ls -l /var/run/containerd/containerd.socksrw-rw---- 1 root root 0 7æœˆ 1 10:57 /var/run/containerd/containerd.sock# å¦‚æœ group æ˜¯ rootï¼šä½ å¯ä»¥æ”¹ä¸ºå…¶å®ƒç»„ï¼Œæ¯”å¦‚ docker# å¦‚æœ docker ç»„ä¸å­˜åœ¨åˆ™åˆ›å»ºsudo groupadd docker# ä¿®æ”¹æ–‡ä»¶æ‰€å±ç»„ä¸º dockersudo chgrp docker /var/run/containerd/containerd.sock# ä¸ºç»„æ·»åŠ è¯»å†™æƒé™sudo chmod g+rw /var/run/containerd/containerd.sock# æ·»åŠ ç”¨æˆ·åˆ° docker ç»„sudo usermod -aG docker $USER# åˆ·æ–°æƒé™newgrp docker# æ­¤æ—¶è™½ç„¶å·²ç»å¯ä»¥ä¸ç”¨ sudo äº†ï¼Œä½†æ˜¯ä¸€æ—¦é‡å¯ containerd å°±ä¼šé‡æ–°å›åˆ° root æƒé™ï¼Œå› æ­¤éœ€è¦æ·»åŠ å¦‚ä¸‹é…ç½®sudo mkdir -p /etc/systemd/system/containerd.service.d/sudo tee /etc/systemd/system/containerd.service.d/override.conf &lt;&lt;EOF[Service]ExecStartPost=/bin/bash -c &#x27;chmod 660 /run/containerd/containerd.sock &amp;&amp; chgrp docker /run/containerd/containerd.sock&#x27;EOFsudo systemctl daemon-reloadsudo systemctl restart containerd crictl å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç±»ä¼¼dockerå‘½ä»¤ æ“ä½œ docker å‘½ä»¤ crictl å‘½ä»¤ è¯´æ˜ æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker ps crictl ps æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢ï¼‰ docker ps -a crictl ps -a æŸ¥çœ‹é•œåƒ docker images crictl images æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs &lt;container_id&gt; crictl logs &lt;container_id&gt; è¿›å…¥å®¹å™¨äº¤äº’ docker exec -it &lt;id&gt; sh crictl exec -it &lt;id&gt; sh æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ docker inspect &lt;container_id&gt; crictl inspect &lt;container_id&gt; æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯ âŒï¼ˆä¸æ”¯æŒï¼‰ crictl inspectp &lt;pod_id&gt; K8s ä¸“å± åˆ é™¤å®¹å™¨ docker rm &lt;container_id&gt; crictl rm &lt;container_id&gt; åˆ é™¤é•œåƒ docker rmi &lt;image_id&gt; crictl rmi &lt;image_id&gt; æ‹‰å–é•œåƒ docker pull nginx crictl pull nginx è¿è¡Œå®¹å™¨ï¼ˆé K8s åœºæ™¯ï¼‰ docker run -it nginx âŒï¼ˆä¸æ”¯æŒï¼‰ crictl ä¸è¿è¡Œå®¹å™¨ï¼Œä»…è°ƒè¯•ç°æœ‰å®¹å™¨ åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶ä¿¡æ¯ docker info crictl info æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€ docker stats crictl stats ç®€è¦ç‰ˆ è®¾ç½®é…ç½®æ–‡ä»¶ ~/.docker/config.json /etc/crictl.yaml å¦‚è®¾ç½® endpoint nerdctl nerdctl æ˜¯ä¸€ä¸ª å…¼å®¹ Docker CLI çš„å®¹å™¨å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† containerd å®¹å™¨è¿è¡Œæ—¶ã€‚ å®ƒæ˜¯ containerd å®˜æ–¹å­é¡¹ç›®ï¼Œç”± CNCF ç»´æŠ¤ï¼Œå…¶å‘½ä»¤è¯­æ³•ä¸ Docker CLI å…¼å®¹ï¼Œç›®æ ‡æ˜¯è®©ä¹ æƒ¯ Docker çš„ç”¨æˆ·ä¹Ÿèƒ½è½»æ¾ä½¿ç”¨ containerdã€‚ å®‰è£… nerdctl 1234567891011121314151617181920212223242526272829# 1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬VERSION=2.1.3wget https://github.com/containerd/nerdctl/releases/download/v$&#123;VERSION&#125;/nerdctl-$&#123;VERSION&#125;-linux-amd64.tar.gz# 2. è§£å‹tar -xvf nerdctl-$&#123;VERSION&#125;-linux-amd64.tar.gz# 3. ç§»åŠ¨åˆ°ç³»ç»Ÿ PATHsudo mv nerdctl /usr/local/bin/# nerdctl éœ€è¦ sudo æƒé™## ä¸º sudo æ·»åŠ  PATHsudo visudo## æ‰¾åˆ°è¿™ä¸€è¡ŒDefaults secure_path = /sbin:/bin:/usr/sbin:/usr/bin## ä¿®æ”¹ä¸ºï¼Œå³å°† nerdctl æ‰€åœ¨çš„ç›®å½•åŠ å…¥ PATHDefaults secure_path = /sbin:/bin:/usr/sbin:/usr/bin:/usr/local/bin# 4.æµ‹è¯•## æŸ¥çœ‹ç‰ˆæœ¬sudo nerdctl version## åˆ—å‡ºå®¹å™¨ï¼Œ--namespace k8s.io è¡¨ç¤ºæŸ¥çœ‹ k8s ä¸­çš„å®¹å™¨sudo nerdctl ps --namespace k8s.io## å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ ä¸Š --namespace k8s.ioï¼Œå¯ä»¥è®¾ç½®åˆ«åecho &quot;alias kps=&#x27;sudo nerdctl --namespace=k8s.io ps&#x27;&quot; &gt;&gt; ~/.bashrcsource ~/.bashrc## æµ‹è¯•kps Helm å®˜ç½‘æ–‡æ¡£ Helm æ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼äº Linux ä¸‹çš„åŒ…ç®¡ç†å·¥å…·å¦‚ yumã€apt ç­‰ã€‚å¯ä»¥æ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„ yaml æ–‡ä»¶éƒ¨ç½²åˆ° Kunernetes ä¸Šã€‚ Helmçš„å®‰è£… å®˜ç½‘å®‰è£…æ–¹æ³• 12345wget https://get.helm.sh/helm-v3.17.4-linux-amd64.tar.gztar -zxvf helm-v3.17.4-linux-amd64.tar.gzsudo mv linux-amd64/helm /usr/local/bin/helm$ helm versionversion.BuildInfo&#123;Version:&quot;v3.17.4&quot;, GitCommit:&quot;595a05da6166037d0abebaa27ac8a498fa4d7ed2&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.23.10&quot;&#125; Helmè‡ªåŠ¨è¡¥å…¨ 12345678# å®‰è£… helm çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½# 1 å½“å‰ç”¨æˆ·echo &#x27;source &lt;(helm completion bash)&#x27; &gt;&gt; ~/.bashrcsource ~/.bashrc# 2 æ‰€æœ‰ç”¨æˆ·helm completion bash | sudo tee /etc/bash_completion.d/helm &gt; /dev/nullsudo chmod a+r /etc/bash_completion.d/helm Helmçš„ä½¿ç”¨ å¯ä»¥å‚è€ƒ AWS-EKS-14--Helm ä»“åº“ç®¡ç† addï¼šæ·»åŠ å›¾è¡¨å­˜å‚¨åº“ 1helm repo add bitnami https://charts.bitnami.com/bitnami listï¼šåˆ—å‡ºå›¾è¡¨å­˜å‚¨åº“ 1helm repo list removeï¼šåˆ é™¤å›¾è¡¨å­˜å‚¨åº“ 1helm repo remove bitnami updateï¼šä»å›¾è¡¨å­˜å‚¨åº“æ›´æ–°æœ¬åœ°å¯ç”¨å›¾è¡¨çš„ä¿¡æ¯ 1234# æ›´æ–°æ‰€æœ‰ä»“åº“helm repo update# æ›´æ–°æŒ‡å®šçš„ä»“åº“helm repo update bitnami åœ¨ä»“åº“ä¸­æœç´¢ 123456789101112131415161718# åœ¨æ‰€æœ‰ä»“åº“ä¸­æœç´¢ï¼Œé»˜è®¤åªå±•ç¤ºæœ€æ–°çš„ç‰ˆæœ¬helm search repo nginx# åœ¨æŒ‡å®šçš„ä»“åº“ä¸­æœç´¢helm search repo bitnami/wordpress# æ˜¾ç¤ºæ‰€æœ‰ç‰ˆæœ¬helm search repo nginx -l# åœ¨å…¨éƒ¨ç‰ˆæœ¬ä¸­æœç´¢å¤§äºç­‰äºæŒ‡å®šç‰ˆæœ¬$ helm search repo nginx --version ^21.0.0 -lNAME CHART VERSION APP VERSION DESCRIPTIONbitnami/nginx 21.0.8 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.7 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.6 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.4 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.3 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.2 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.1 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.0 1.29.0 NGINX Open Source is a web server that can be a... å®‰è£…åŒ… 123456789101112131415161718192021222324252627282930313233# å®‰è£…æœ€æ–°ç‰ˆhelm install nginx bitnami/nginx# å®‰è£…æŒ‡å®šç‰ˆæœ¬helm install nginx bitnami/nginx --version 21.0.3# å®‰è£…åŒ…åˆ°æŒ‡å®šå‘½åç©ºé—´helm install nginx bitnami/nginx -n &lt;namespace&gt;# å®‰è£…åŒ…å¹¶åˆ›å»ºå‘½åç©ºé—´helm install nginx bitnami/nginx -n &lt;namespace&gt; --create-namespace# ociï¼š ä» docker ä»“åº“ä¸­å®‰è£…helm pull oci://registry-1.docker.io/bitnamicharts/nginx --version 21.0.8# å®‰è£…æœ¬åœ° chart ç›®å½•helm install my-release ./nginx# å®‰è£… .tgz æ ¼å¼çš„æ‰“åŒ… charthelm install my-release ./nginx-1.2.3.tgz# ä»è¿œç¨‹tgzå®‰è£…helm install my-release https://example.com/charts/nginx-1.2.3.tgz# å®‰è£… Git ä»“åº“ä¸­çš„ chartï¼ˆç»“åˆ pluginï¼‰helm plugin install https://github.com/aslafy-z/helm-githelm repo add mychart &#x27;git+https://github.com/myorg/mychart.git&#x27;helm install my-release mychart/nginx# å¸è½½helm-gitæ’ä»¶helm plugin remove helm-git# ä½¿ç”¨ --set ä¼ é€’å•ä¸ªæˆ–å¤šä¸ªå€¼helm install my-release bitnami/nginx --set service.type=NodePort# ä½¿ç”¨ --values æˆ– -f åŠ è½½ YAML é…ç½®æ–‡ä»¶helm install my-release bitnami/nginx -f custom-values.yaml# åŒæ—¶ä½¿ç”¨å¤šç§ values æ–‡ä»¶ + --sethelm install my-release bitnami/nginx -f base.yaml -f prod.yaml --set replicaCount=3 æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ… 123456# æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´å·²å®‰è£…çš„åŒ…helm list -n &lt;namespace&gt;# æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„åŒ…helm list -A# æŸ¥çœ‹å·²å®‰è£…çš„åŒ…çŠ¶æ€helm status ngxin -n &lt;namespace&gt; å¸è½½åŒ… 1helm uninstall nginx -n &lt;namespace&gt;","summary":"æ‘˜è¦ K8S çš„ Tools: crictlã€nerdctlã€helm ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-24T13:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-connection/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-connection/","title":"K8S ä¹‹ è¿œç¨‹è¿æ¥","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»  K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è¿œç¨‹è¿æ¥-k8s-é›†ç¾¤\">è¿œç¨‹è¿æ¥ k8s é›†ç¾¤</h2>\n<h3 id=\"æœ¬åœ°ä¸å­˜åœ¨-kubeconfig-æ–‡ä»¶\">æœ¬åœ°ä¸å­˜åœ¨ kubeconfig æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å– kubeconfig æ–‡ä»¶ï¼Œä½äº Master èŠ‚ç‚¹ï¼š/etc/kubernetes/admin.confï¼Œå°†å…¶æ‹·è´åˆ°æœ¬åœ°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/config</span><br></pre></td></tr></table></figure>\n<h3 id=\"æœ¬åœ°å·²å­˜åœ¨-kubeconfig-æ–‡ä»¶\">æœ¬åœ°å·²å­˜åœ¨ kubeconfig æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å·²ç»é…ç½®äº†ä¸€ä¸ªé›†ç¾¤çš„è¿æ¥ï¼Œè¿˜æƒ³å†æ·»åŠ ä¸€ä¸ªé›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡é€šè¿‡åˆå¹¶çš„æ–¹å¼æ·»åŠ </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°†æ–°é›†ç¾¤çš„ kubeconfig æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°</span></span><br><span class=\"line\">scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/new-cluster.conf</span><br><span class=\"line\"><span class=\"comment\"># åˆå¹¶</span></span><br><span class=\"line\">KUBECONFIG=~/.kube/config:new-cluster.conf kubectl config view --flatten &gt; merged-config.yaml</span><br><span class=\"line\"><span class=\"comment\"># æ›¿æ¢</span></span><br><span class=\"line\"><span class=\"built_in\">mv</span> merged-config.yaml ~/.kube/config</span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤\">é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å–é›†ç¾¤é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–æ‰€æœ‰é›†ç¾¤é…ç½®</span></span><br><span class=\"line\">kubectl config get-contexts</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰é»˜è®¤çš„ context</span></span><br><span class=\"line\">kubectl config current-context</span><br><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢ context</span></span><br><span class=\"line\">kubectl config use-context &lt;context_name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–é›†ç¾¤åç§°</span></span><br><span class=\"line\">kubectl config get-clusters</span><br><span class=\"line\"><span class=\"comment\"># è·å–ç”¨æˆ·åç§°</span></span><br><span class=\"line\">kubectl config get-users</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get node</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤é›†ç¾¤é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤ context</span></span><br><span class=\"line\">kubectl config delete-context &lt;context_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ cluster</span></span><br><span class=\"line\">kubectl config delete-cluster &lt;cluster_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ user</span></span><br><span class=\"line\">kubectl config delete-user &lt;user_name&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘ kubeconfigï¼ˆ~/.kube/configï¼‰ æ–‡ä»¶ï¼Œæ·»åŠ æˆ–åˆ é™¤ä¸éœ€è¦çš„é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github è¿œç¨‹è¿æ¥ k8s é›†ç¾¤ æœ¬åœ°ä¸å­˜åœ¨ kubeconfig æ–‡ä»¶ è·å– kubeconfig æ–‡ä»¶ï¼Œä½äº Master èŠ‚ç‚¹ï¼š/etc/kubernetes/admin.confï¼Œå°†å…¶æ‹·è´åˆ°æœ¬åœ° 1scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/config æœ¬åœ°å·²å­˜åœ¨ kubeconfig æ–‡ä»¶ å·²ç»é…ç½®äº†ä¸€ä¸ªé›†ç¾¤çš„è¿æ¥ï¼Œè¿˜æƒ³å†æ·»åŠ ä¸€ä¸ªé›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡é€šè¿‡åˆå¹¶çš„æ–¹å¼æ·»åŠ  123456# å°†æ–°é›†ç¾¤çš„ kubeconfig æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/new-cluster.conf# åˆå¹¶KUBECONFIG=~/.kube/config:new-cluster.conf kubectl config view --flatten &gt; merged-config.yaml# æ›¿æ¢mv merged-config.yaml ~/.kube/config é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤ è·å–é›†ç¾¤é…ç½® 1234567891011# è·å–æ‰€æœ‰é›†ç¾¤é…ç½®kubectl config get-contexts# æŸ¥çœ‹å½“å‰é»˜è®¤çš„ contextkubectl config current-context# åˆ‡æ¢ contextkubectl config use-context &lt;context_name&gt;# è·å–é›†ç¾¤åç§°kubectl config get-clusters# è·å–ç”¨æˆ·åç§°kubectl config get-users æµ‹è¯• 1kubectl get node åˆ é™¤é›†ç¾¤é…ç½® 123456# åˆ é™¤ contextkubectl config delete-context &lt;context_name&gt;# åˆ é™¤ clusterkubectl config delete-cluster &lt;cluster_name&gt;# åˆ é™¤ userkubectl config delete-user &lt;user_name&gt; åè®° ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘ kubeconfigï¼ˆ~/.kube/configï¼‰ æ–‡ä»¶ï¼Œæ·»åŠ æˆ–åˆ é™¤ä¸éœ€è¦çš„é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-24T12:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/23/k8s-secret/","url":"https://blog.hanqunfeng.com/2025/07/23/k8s-secret/","title":"K8S ä¹‹ Secret","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/\">k8s Secret å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Secret-ä»‹ç»\">Secret ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Secret æ˜¯ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€ä»¤ç‰Œæˆ–å¯†é’¥çš„å¯¹è±¡ã€‚ è¿™æ ·çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«æ”¾åœ¨ Pod è§„çº¦ä¸­æˆ–è€…é•œåƒä¸­ã€‚ ä½¿ç”¨ Secret æ„å‘³ç€ä½ ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­åŒ…å«æœºå¯†æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”±äºåˆ›å»º Secret å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„ Podï¼Œ å› æ­¤åœ¨åˆ›å»ºã€æŸ¥çœ‹å’Œç¼–è¾‘ Pod çš„å·¥ä½œæµç¨‹ä¸­æš´éœ² Secretï¼ˆåŠå…¶æ•°æ®ï¼‰çš„é£é™©è¾ƒå°ã€‚ Kubernetes å’Œåœ¨é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å¯¹ Secret é‡‡å–é¢å¤–çš„é¢„é˜²æªæ–½ï¼Œ ä¾‹å¦‚é¿å…å°†æ•æ„Ÿæ•°æ®å†™å…¥éæ˜“å¤±æ€§å­˜å‚¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Secret ç±»ä¼¼äº ConfigMap ä½†ä¸“é—¨ç”¨äºä¿å­˜æœºå¯†æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª Secret çš„å°ºå¯¸æœ€å¤šä¸º 1MiB</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ K8S ä¸­ï¼ŒSecret æœ‰å¤šç§ç±»å‹ï¼šæœ¬æ–‡åªè®²è§£ <code>Opaque</code> ç±»å‹ï¼Œå…¶ä½™ç±»å‹å‚è€ƒ[å®˜ç½‘]((<a href=\"https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/\">https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/</a>)ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å†…ç½®ç±»å‹</th>\n<th>ç”¨æ³•æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Opaque</code></td>\n<td>ç”¨æˆ·è‡ªå®šä¹‰çš„ä»»æ„æ•°æ®ï¼ˆé»˜è®¤ç±»å‹ï¼‰</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/service-account-token</code></td>\n<td>è‡ªåŠ¨æŒ‚è½½çš„æœåŠ¡è´¦å·ä»¤ç‰Œï¼Œä¾› Pod è®¿é—® API ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/dockercfg</code></td>\n<td>åºåˆ—åŒ–çš„ <code>~/.dockercfg</code> æ–‡ä»¶ï¼Œç”¨äºç§æœ‰ä»“åº“è®¤è¯ï¼ˆæ—§æ ¼å¼ï¼‰</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/dockerconfigjson</code></td>\n<td>åºåˆ—åŒ–çš„ <code>~/.docker/config.json</code> æ–‡ä»¶ï¼ˆæ¨èï¼‰</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/basic-auth</code></td>\n<td>å­˜å‚¨ç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨äº HTTP åŸºæœ¬è®¤è¯</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/ssh-auth</code></td>\n<td>å­˜å‚¨ SSH ç§é’¥ï¼Œç”¨äº SSH èº«ä»½è®¤è¯</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/tls</code></td>\n<td>å­˜å‚¨ TLS å¯†é’¥å’Œè¯ä¹¦ï¼Œç”¨äº HTTPS æˆ–æœåŠ¡åŠ å¯†é€šä¿¡</td>\n</tr>\n<tr>\n<td><code>bootstrap.kubernetes.io/token</code></td>\n<td>ç”¨äº kubelet åŠ å…¥é›†ç¾¤çš„å¼•å¯¼ä»¤ç‰Œ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Secret-åˆ›å»ºåŠä½¿ç”¨\">Secret åˆ›å»ºåŠä½¿ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Secret ä¸ ConfigMap åˆ›å»ºåŠä½¿ç”¨ç±»ä¼¼ï¼Œéƒ½æ˜¯å­˜å‚¨é”®å€¼å¯¹ï¼Œä½†å­˜å‚¨å†…å®¹ä¸åŒï¼ŒSecret å­˜å‚¨çš„æ˜¯ Base64 ç¼–ç åçš„å†…å®¹ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ç¯å¢ƒå˜é‡å¼•ç”¨\">ç¯å¢ƒå˜é‡å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># mysevret.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">Opaque</span>                  <span class=\"comment\"># é»˜è®¤ç±»å‹ ï¼Œå¯ä»¥çœç•¥</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">YWRtaW4=</span>          <span class=\"comment\"># &quot;admin&quot; çš„ base64 ç¼–ç </span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">MWYyZDFlMmU2N2Rm</span>  <span class=\"comment\"># &quot;1f2d1e2e67df&quot; çš„ base64 ç¼–ç </span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># keyï¼švalue æ–¹å¼åˆ›å»ºï¼Œè¿™é‡Œ value å€¼æ˜¯ æ˜æ–‡ï¼Œk8s ä¼šè¿›è¡Œ base64 ç¼–ç </span></span><br><span class=\"line\">kubectl create secret generic my-secret \\</span><br><span class=\"line\">  --from-literal=username=admin \\</span><br><span class=\"line\">  --from-literal=password=1f2d1e2e67df</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶æ–¹å¼åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\"># --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ Secret ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚</span></span><br><span class=\"line\">kubectl create secret generic my-secret \\</span><br><span class=\"line\">  --from-env-file=username.env \\</span><br><span class=\"line\">  --from-env-file=password.env</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># username.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># username=admin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># password.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># password=1f2d1e2e67df</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ Secret çš„å†…å®¹</span></span><br><span class=\"line\">$ k get secrets my-secret -o yaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  password: MWYyZDFlMmU2N2Rm</span><br><span class=\"line\">  username: YWRtaW4=</span><br><span class=\"line\">kind: Secret</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T13:21:22Z&quot;</span></span><br><span class=\"line\">  name: my-secret</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;747355&quot;</span></span><br><span class=\"line\">  uid: 4f77269d-d4c3-4ae8-aafc-7cfa56b84a5d</span><br><span class=\"line\"><span class=\"built_in\">type</span>: Opaque</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-secret</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">      <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;printenv&quot;</span>] <span class=\"comment\"># æ‰“å°ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">      <span class=\"attr\">envFrom:</span>                  <span class=\"comment\"># ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€ Secret ï¼Œç­‰ç­‰</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">secretRef:</span>            <span class=\"comment\"># è¿™é‡Œå¼•ç”¨ Secret ï¼Œæ­¤å¤„å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span>     <span class=\"comment\"># Secret åç§°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† Secret ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod2.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-secret2</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">args:</span>                       <span class=\"comment\"># å®¹å™¨å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;username: $&#123;SECRET_USERNAME&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;password: $&#123;SECRET_PASSWORD&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span>    <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">    <span class=\"attr\">env:</span>                        <span class=\"comment\"># ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">SECRET_USERNAME</span>     <span class=\"comment\"># è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span>                <span class=\"comment\"># value æ¥æº</span></span><br><span class=\"line\">        <span class=\"attr\">secretKeyRef:</span>           <span class=\"comment\"># å¼•ç”¨ Secret ä¸­çš„ key</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span>       <span class=\"comment\"># Secret åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">username</span>         <span class=\"comment\"># Secret ä¸­ key çš„åç§°</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">SECRET_PASSWORD</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">        <span class=\"attr\">secretKeyRef:</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">password</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹podæ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k logs pods/env-secret</span><br><span class=\"line\">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT=443</span><br><span class=\"line\">HOSTNAME=env-secret</span><br><span class=\"line\">SHLVL=1</span><br><span class=\"line\">username=admin</span><br><span class=\"line\">HOME=/root</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br><span class=\"line\">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class=\"line\">password=1f2d1e2e67df</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class=\"line\">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br><span class=\"line\">PWD=/</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ k logs pods/env-secret2</span><br><span class=\"line\">username: admin</span><br><span class=\"line\">password: 1f2d1e2e67df</span><br></pre></td></tr></table></figure>\n<h3 id=\"å­˜å‚¨å·å¼•ç”¨\">å­˜å‚¨å·å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># secret-configfile.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">Opaque</span></span><br><span class=\"line\"><span class=\"attr\">stringData:</span>                          <span class=\"comment\"># ä½¿ç”¨ stringDataï¼ŒK8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç </span></span><br><span class=\"line\">  <span class=\"attr\">app.properties:</span> <span class=\"string\">|</span>                  <span class=\"comment\"># æ–‡ä»¶å</span></span><br><span class=\"line\">    <span class=\"string\">server.port=8080</span></span><br><span class=\"line\">    <span class=\"string\">log.level=INFO</span></span><br><span class=\"line\">  <span class=\"attr\">db.properties:</span> <span class=\"string\">|</span>                   <span class=\"comment\"># æ–‡ä»¶å</span></span><br><span class=\"line\">    <span class=\"string\">db.host=localhost</span></span><br><span class=\"line\">    <span class=\"string\">db.port=5432</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶å†…å®¹æ˜¯æ˜æ–‡ï¼Œk8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç </span></span><br><span class=\"line\">kubectl create secret generic my-secret \\</span><br><span class=\"line\">  --from-file=app.properties \\</span><br><span class=\"line\">  --from-file=db.properties</span><br><span class=\"line\"><span class=\"comment\"># app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># server.port=8080</span></span><br><span class=\"line\"><span class=\"comment\"># log.level=INFO</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># db.host=localhost</span></span><br><span class=\"line\"><span class=\"comment\"># db.port=5432</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ k get secrets my-secret -oyaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  app.properties: c2VydmVyLnBvcnQ9ODA4MApsb2cubGV2ZWw9SU5GTwo=</span><br><span class=\"line\">  db.properties: ZGIuaG9zdD1sb2NhbGhvc3QKZGIucG9ydD0xMjU0MzIK</span><br><span class=\"line\">kind: Secret</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T13:45:14Z&quot;</span></span><br><span class=\"line\">  name: my-secret</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;750742&quot;</span></span><br><span class=\"line\">  uid: 35ffcdd6-d70a-4f3a-9246-5c56da630bc1</span><br><span class=\"line\"><span class=\"built_in\">type</span>: Opaque</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod æŒ‚è½½ Secret ä¸ºæ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># secret-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">secret-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span>              <span class=\"comment\"># æŒ‚è½½è·¯å¾„</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span>                   <span class=\"comment\"># å­˜å‚¨å· åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">secret:</span>                               <span class=\"comment\"># å­˜å‚¨å·ç±»å‹ä¸º Secret</span></span><br><span class=\"line\">      <span class=\"attr\">secretName:</span> <span class=\"string\">my-secret</span>               <span class=\"comment\"># æŒ‚è½½çš„ Secret åç§°ï¼Œæœ¬åˆ©ä¸­å°† Secret ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å™¨å†…çš„ <code>/etc/config/</code> ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/config/app.properties</span><br><span class=\"line\">/etc/config/db.properties</span><br><span class=\"line\"></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it secret-demo -- <span class=\"built_in\">ls</span> /etc/config/</span><br><span class=\"line\">app.properties  db.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæƒ³æŒ‚è½½ Secret ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>items</code> å­—æ®µæŒ‡å®šï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># secret-pod2.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">secret-demo2</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">    <span class=\"attr\">secret:</span></span><br><span class=\"line\">      <span class=\"attr\">secretName:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\">      <span class=\"attr\">items:</span>                   <span class=\"comment\"># æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">app.properties</span>    <span class=\"comment\"># secret ä¸­çš„key</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">app.properties</span>   <span class=\"comment\"># æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Secret çš„ç‰¹ç‚¹ä¸ä½¿ç”¨æ–¹æ³•ä¸ ConfigMap éå¸¸ç±»ä¼¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ğŸ” ConfigMap vs Secret å¯¹æ¯”è¡¨ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>ConfigMap</th>\n<th>Secret</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç”¨é€”</strong></td>\n<td>å­˜å‚¨éæ•æ„Ÿé…ç½®ä¿¡æ¯ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ï¼‰</td>\n<td>å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€è¯ä¹¦ã€tokenï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ•°æ®æ˜¯å¦åŠ å¯†</strong></td>\n<td>å¦ï¼Œæ˜æ–‡å­˜å‚¨ï¼ˆBase64 ç¼–ç å¯è¯»ï¼‰</td>\n<td>å¦ï¼ˆé»˜è®¤ Base64 ç¼–ç ï¼‰ï¼Œå¯é…ç½®åŠ å¯†å­˜å‚¨ï¼ˆå¦‚ä½¿ç”¨ KMSï¼‰</td>\n</tr>\n<tr>\n<td><strong>å­—æ®µå</strong></td>\n<td><code>data</code> / <code>binaryData</code></td>\n<td><code>data</code>ï¼ˆéœ€ base64ï¼‰ / <code>stringData</code>ï¼ˆæ˜æ–‡ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å¯å­˜å‚¨çš„æœ€å¤§å¤§å°</strong></td>\n<td>æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB</td>\n<td>æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB</td>\n</tr>\n<tr>\n<td><strong>æ”¯æŒçš„æŒ‚è½½æ–¹å¼</strong></td>\n<td>- ç¯å¢ƒå˜é‡<br>- å·ï¼ˆæ–‡ä»¶ï¼‰</td>\n<td>- ç¯å¢ƒå˜é‡<br>- å·ï¼ˆæ–‡ä»¶ï¼‰</td>\n</tr>\n<tr>\n<td><strong>é»˜è®¤ç±»å‹ï¼ˆtypeï¼‰</strong></td>\n<td>æ— ç±»å‹å­—æ®µ</td>\n<td>é»˜è®¤ä¸º <code>Opaque</code></td>\n</tr>\n<tr>\n<td><strong>å¯å®šä¹‰ä¸ºå¤šä¸ªæ–‡ä»¶æŒ‚è½½</strong></td>\n<td>âœ…</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td><strong>é»˜è®¤ RBAC è®¿é—®æ§åˆ¶å¼ºåº¦</strong></td>\n<td>å¼±ï¼ˆå¤šæ•°ç”¨æˆ·/Pod å¯è¯»å–ï¼‰</td>\n<td>å¼ºï¼ˆé»˜è®¤å—é™è®¿é—®ï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ”¯æŒçš„å†…ç½®ç±»å‹</strong></td>\n<td>æ— </td>\n<td>âœ… å¦‚ï¼š<code>kubernetes.io/tls</code>ã€<code>kubernetes.io/basic-auth</code> ç­‰</td>\n</tr>\n<tr>\n<td><strong>æ˜¯å¦é€‚åˆå­˜å‚¨å¯†é’¥/å¯†ç </strong></td>\n<td>âŒ ä¸æ¨è</td>\n<td>âœ… æ¨è</td>\n</tr>\n<tr>\n<td><strong>å¯è§†åŒ–æ˜æ–‡è¯»å–</strong></td>\n<td>âœ… ç›´æ¥è¯»å–</td>\n<td>âœ… ä½† Base64 ç¼–ç åéœ€è¦è§£ç </td>\n</tr>\n<tr>\n<td><strong>å¸¸è§ç”¨é€”ç¤ºä¾‹</strong></td>\n<td>App é…ç½®ã€æ—¥å¿—çº§åˆ«ã€è¿æ¥å‚æ•°ç­‰</td>\n<td>æ•°æ®åº“å¯†ç ã€TLS è¯ä¹¦ã€API Token ç­‰</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Secret å®˜æ–¹æ–‡æ¡£ Secret ä»‹ç» Secret æ˜¯ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€ä»¤ç‰Œæˆ–å¯†é’¥çš„å¯¹è±¡ã€‚ è¿™æ ·çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«æ”¾åœ¨ Pod è§„çº¦ä¸­æˆ–è€…é•œåƒä¸­ã€‚ ä½¿ç”¨ Secret æ„å‘³ç€ä½ ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­åŒ…å«æœºå¯†æ•°æ®ã€‚ ç”±äºåˆ›å»º Secret å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„ Podï¼Œ å› æ­¤åœ¨åˆ›å»ºã€æŸ¥çœ‹å’Œç¼–è¾‘ Pod çš„å·¥ä½œæµç¨‹ä¸­æš´éœ² Secretï¼ˆåŠå…¶æ•°æ®ï¼‰çš„é£é™©è¾ƒå°ã€‚ Kubernetes å’Œåœ¨é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å¯¹ Secret é‡‡å–é¢å¤–çš„é¢„é˜²æªæ–½ï¼Œ ä¾‹å¦‚é¿å…å°†æ•æ„Ÿæ•°æ®å†™å…¥éæ˜“å¤±æ€§å­˜å‚¨ã€‚ Secret ç±»ä¼¼äº ConfigMap ä½†ä¸“é—¨ç”¨äºä¿å­˜æœºå¯†æ•°æ®ã€‚ æ¯ä¸ª Secret çš„å°ºå¯¸æœ€å¤šä¸º 1MiB åœ¨ K8S ä¸­ï¼ŒSecret æœ‰å¤šç§ç±»å‹ï¼šæœ¬æ–‡åªè®²è§£ Opaque ç±»å‹ï¼Œå…¶ä½™ç±»å‹å‚è€ƒ[å®˜ç½‘]((https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/)ã€‚ å†…ç½®ç±»å‹ ç”¨æ³•æè¿° Opaque ç”¨æˆ·è‡ªå®šä¹‰çš„ä»»æ„æ•°æ®ï¼ˆé»˜è®¤ç±»å‹ï¼‰ kubernetes.io/service-account-token è‡ªåŠ¨æŒ‚è½½çš„æœåŠ¡è´¦å·ä»¤ç‰Œï¼Œä¾› Pod è®¿é—® API ä½¿ç”¨ kubernetes.io/dockercfg åºåˆ—åŒ–çš„ ~/.dockercfg æ–‡ä»¶ï¼Œç”¨äºç§æœ‰ä»“åº“è®¤è¯ï¼ˆæ—§æ ¼å¼ï¼‰ kubernetes.io/dockerconfigjson åºåˆ—åŒ–çš„ ~/.docker/config.json æ–‡ä»¶ï¼ˆæ¨èï¼‰ kubernetes.io/basic-auth å­˜å‚¨ç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨äº HTTP åŸºæœ¬è®¤è¯ kubernetes.io/ssh-auth å­˜å‚¨ SSH ç§é’¥ï¼Œç”¨äº SSH èº«ä»½è®¤è¯ kubernetes.io/tls å­˜å‚¨ TLS å¯†é’¥å’Œè¯ä¹¦ï¼Œç”¨äº HTTPS æˆ–æœåŠ¡åŠ å¯†é€šä¿¡ bootstrap.kubernetes.io/token ç”¨äº kubelet åŠ å…¥é›†ç¾¤çš„å¼•å¯¼ä»¤ç‰Œ Secret åˆ›å»ºåŠä½¿ç”¨ Secret ä¸ ConfigMap åˆ›å»ºåŠä½¿ç”¨ç±»ä¼¼ï¼Œéƒ½æ˜¯å­˜å‚¨é”®å€¼å¯¹ï¼Œä½†å­˜å‚¨å†…å®¹ä¸åŒï¼ŒSecret å­˜å‚¨çš„æ˜¯ Base64 ç¼–ç åçš„å†…å®¹ã€‚ ç¯å¢ƒå˜é‡å¼•ç”¨ yamlåˆ›å»º 12345678910# mysevret.yamlapiVersion: v1kind: Secretmetadata: name: my-secrettype: Opaque # é»˜è®¤ç±»å‹ ï¼Œå¯ä»¥çœç•¥data: username: YWRtaW4= # &quot;admin&quot; çš„ base64 ç¼–ç  password: MWYyZDFlMmU2N2Rm # &quot;1f2d1e2e67df&quot; çš„ base64 ç¼–ç  å‘½ä»¤è¡Œåˆ›å»º 12345678910111213141516171819202122232425262728293031# keyï¼švalue æ–¹å¼åˆ›å»ºï¼Œè¿™é‡Œ value å€¼æ˜¯ æ˜æ–‡ï¼Œk8s ä¼šè¿›è¡Œ base64 ç¼–ç kubectl create secret generic my-secret \\ --from-literal=username=admin \\ --from-literal=password=1f2d1e2e67df# æ–‡ä»¶æ–¹å¼åˆ›å»º# --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ Secret ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚kubectl create secret generic my-secret \\ --from-env-file=username.env \\ --from-env-file=password.env# username.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# username=admin# password.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# password=1f2d1e2e67df# åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ Secret çš„å†…å®¹$ k get secrets my-secret -o yamlapiVersion: v1data: password: MWYyZDFlMmU2N2Rm username: YWRtaW4=kind: Secretmetadata: creationTimestamp: &quot;2025-07-05T13:21:22Z&quot; name: my-secret namespace: default resourceVersion: &quot;747355&quot; uid: 4f77269d-d4c3-4ae8-aafc-7cfa56b84a5dtype: Opaque å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213# pod.yamlapiVersion: v1kind: Podmetadata: name: env-secretspec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;printenv&quot;] # æ‰“å°ç¯å¢ƒå˜é‡ image: busybox:latest envFrom: # ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€ Secret ï¼Œç­‰ç­‰ - secretRef: # è¿™é‡Œå¼•ç”¨ Secret ï¼Œæ­¤å¤„å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ name: my-secret # Secret åç§° å°† Secret ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213141516171819202122232425# pod2.yamlapiVersion: v1kind: Podmetadata: name: env-secret2spec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;] args: # å®¹å™¨å¯åŠ¨å‘½ä»¤ - | echo &quot;username: $&#123;SECRET_USERNAME&#125;&quot; echo &quot;password: $&#123;SECRET_PASSWORD&#125;&quot; image: busybox:latest env: # ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼ - name: SECRET_USERNAME # è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key valueFrom: # value æ¥æº secretKeyRef: # å¼•ç”¨ Secret ä¸­çš„ key name: my-secret # Secret åç§° key: username # Secret ä¸­ key çš„åç§° - name: SECRET_PASSWORD valueFrom: secretKeyRef: name: my-secret key: password æŸ¥çœ‹podæ—¥å¿— 123456789101112131415161718192021$ k logs pods/env-secretKUBERNETES_PORT=tcp://10.96.0.1:443KUBERNETES_SERVICE_PORT=443HOSTNAME=env-secretSHLVL=1username=adminHOME=/rootKUBERNETES_PORT_443_TCP_ADDR=10.96.0.1PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binKUBERNETES_PORT_443_TCP_PORT=443password=1f2d1e2e67dfKUBERNETES_PORT_443_TCP_PROTO=tcpKUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443KUBERNETES_SERVICE_PORT_HTTPS=443KUBERNETES_SERVICE_HOST=10.96.0.1PWD=/$ k logs pods/env-secret2username: adminpassword: 1f2d1e2e67df å­˜å‚¨å·å¼•ç”¨ yamlåˆ›å»º 1234567891011121314# secret-configfile.yamlapiVersion: v1kind: Secretmetadata: name: my-secrettype: OpaquestringData: # ä½¿ç”¨ stringDataï¼ŒK8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç  app.properties: | # æ–‡ä»¶å server.port=8080 log.level=INFO db.properties: | # æ–‡ä»¶å db.host=localhost db.port=5432 å‘½ä»¤è¡Œåˆ›å»º 1234567891011121314151617181920212223242526# æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡# æ–‡ä»¶å†…å®¹æ˜¯æ˜æ–‡ï¼Œk8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç kubectl create secret generic my-secret \\ --from-file=app.properties \\ --from-file=db.properties# app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# server.port=8080# log.level=INFO# db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# db.host=localhost# db.port=5432$ k get secrets my-secret -oyamlapiVersion: v1data: app.properties: c2VydmVyLnBvcnQ9ODA4MApsb2cubGV2ZWw9SU5GTwo= db.properties: ZGIuaG9zdD1sb2NhbGhvc3QKZGIucG9ydD0xMjU0MzIKkind: Secretmetadata: creationTimestamp: &quot;2025-07-05T13:45:14Z&quot; name: my-secret namespace: default resourceVersion: &quot;750742&quot; uid: 35ffcdd6-d70a-4f3a-9246-5c56da630bc1type: Opaque Pod æŒ‚è½½ Secret ä¸ºæ–‡ä»¶ 123456789101112131415161718# secret-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼šapiVersion: v1kind: Podmetadata: name: secret-demospec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config # æŒ‚è½½è·¯å¾„ readOnly: true volumes: - name: config-volume # å­˜å‚¨å· åç§° secret: # å­˜å‚¨å·ç±»å‹ä¸º Secret secretName: my-secret # æŒ‚è½½çš„ Secret åç§°ï¼Œæœ¬åˆ©ä¸­å°† Secret ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹ å®¹å™¨å†…çš„ /etc/config/ ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š 12345/etc/config/app.properties/etc/config/db.properties$ k exec -it secret-demo -- ls /etc/config/app.properties db.properties å¦‚æœåªæƒ³æŒ‚è½½ Secret ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ items å­—æ®µæŒ‡å®šï¼š 123456789101112131415161718192021# secret-pod2.yamlapiVersion: v1kind: Podmetadata: name: secret-demo2spec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config readOnly: true volumes: - name: config-volume secret: secretName: my-secret items: # æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key - key: app.properties # secret ä¸­çš„key path: app.properties # æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties åè®° Secret çš„ç‰¹ç‚¹ä¸ä½¿ç”¨æ–¹æ³•ä¸ ConfigMap éå¸¸ç±»ä¼¼ã€‚ ğŸ” ConfigMap vs Secret å¯¹æ¯”è¡¨ï¼š ç‰¹æ€§ ConfigMap Secret ç”¨é€” å­˜å‚¨éæ•æ„Ÿé…ç½®ä¿¡æ¯ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ï¼‰ å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€è¯ä¹¦ã€tokenï¼‰ æ•°æ®æ˜¯å¦åŠ å¯† å¦ï¼Œæ˜æ–‡å­˜å‚¨ï¼ˆBase64 ç¼–ç å¯è¯»ï¼‰ å¦ï¼ˆé»˜è®¤ Base64 ç¼–ç ï¼‰ï¼Œå¯é…ç½®åŠ å¯†å­˜å‚¨ï¼ˆå¦‚ä½¿ç”¨ KMSï¼‰ å­—æ®µå data / binaryData dataï¼ˆéœ€ base64ï¼‰ / stringDataï¼ˆæ˜æ–‡ï¼‰ å¯å­˜å‚¨çš„æœ€å¤§å¤§å° æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB æ”¯æŒçš„æŒ‚è½½æ–¹å¼ - ç¯å¢ƒå˜é‡- å·ï¼ˆæ–‡ä»¶ï¼‰ - ç¯å¢ƒå˜é‡- å·ï¼ˆæ–‡ä»¶ï¼‰ é»˜è®¤ç±»å‹ï¼ˆtypeï¼‰ æ— ç±»å‹å­—æ®µ é»˜è®¤ä¸º Opaque å¯å®šä¹‰ä¸ºå¤šä¸ªæ–‡ä»¶æŒ‚è½½ âœ… âœ… é»˜è®¤ RBAC è®¿é—®æ§åˆ¶å¼ºåº¦ å¼±ï¼ˆå¤šæ•°ç”¨æˆ·/Pod å¯è¯»å–ï¼‰ å¼ºï¼ˆé»˜è®¤å—é™è®¿é—®ï¼‰ æ”¯æŒçš„å†…ç½®ç±»å‹ æ—  âœ… å¦‚ï¼škubernetes.io/tlsã€kubernetes.io/basic-auth ç­‰ æ˜¯å¦é€‚åˆå­˜å‚¨å¯†é’¥/å¯†ç  âŒ ä¸æ¨è âœ… æ¨è å¯è§†åŒ–æ˜æ–‡è¯»å– âœ… ç›´æ¥è¯»å– âœ… ä½† Base64 ç¼–ç åéœ€è¦è§£ç  å¸¸è§ç”¨é€”ç¤ºä¾‹ App é…ç½®ã€æ—¥å¿—çº§åˆ«ã€è¿æ¥å‚æ•°ç­‰ æ•°æ®åº“å¯†ç ã€TLS è¯ä¹¦ã€API Token ç­‰","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Secret å®˜æ–¹æ–‡æ¡£","date_published":"2025-07-23T13:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/23/k8s-configmap/","url":"https://blog.hanqunfeng.com/2025/07/23/k8s-configmap/","title":"K8S ä¹‹ ConfigMap","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/\">k8s ConfigMap å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ConfigMap-åˆ«åcm-ä»‹ç»\">ConfigMap(åˆ«åcm) ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ConfigMap æ˜¯ä¸€ç§ API å¯¹è±¡ï¼Œç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨æ—¶ï¼Œ Pod å¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ConfigMap å°†ä½ çš„ç¯å¢ƒé…ç½®ä¿¡æ¯å’Œå®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¤šä¸ª Pod å¯ä»¥å…³è”åŒä¸€ä¸ª ConfigMap</p>\n</li>\n</ul>\n<h2 id=\"ConfigMap-åˆ›å»ºåŠä½¿ç”¨\">ConfigMap åˆ›å»ºåŠä½¿ç”¨</h2>\n<h3 id=\"ç¯å¢ƒå˜é‡å¼•ç”¨\">ç¯å¢ƒå˜é‡å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># configmap.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span>       <span class=\"comment\"># ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span>   <span class=\"comment\"># configmap åç§°</span></span><br><span class=\"line\"><span class=\"attr\">data:</span>                 <span class=\"comment\"># data å­—æ®µè®¾è®¡ç”¨æ¥ä¿å­˜ UTF-8 å­—ç¬¦ä¸²ï¼Œæœ€å¤§å€¼ä¸º 1M</span></span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">k8s-admin</span> <span class=\"comment\"># key: value</span></span><br><span class=\"line\">  <span class=\"attr\">access_level:</span> <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">&quot;123456&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># keyï¼švalue æ–¹å¼åˆ›å»º</span></span><br><span class=\"line\">kubectl create configmap myconfigmap --from-literal=username=k8s-admin --from-literal=access_level=1 --from-literal=password=123456</span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶æ–¹å¼åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\"># --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ ConfigMap ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚</span></span><br><span class=\"line\">kubectl create configmap myconfigmap --from-env-file=app.env --from-env-file=other.env</span><br><span class=\"line\"><span class=\"comment\"># app.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># username=k8s-admin</span></span><br><span class=\"line\"><span class=\"comment\"># access_level=1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># other.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># password=123456</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ ConfigMap çš„å†…å®¹</span></span><br><span class=\"line\">$ k get cm myconfigmap -oyaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  access_level: <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">  password: <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\">  username: k8s-admin</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T10:29:15Z&quot;</span></span><br><span class=\"line\">  name: myconfigmap</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;723770&quot;</span></span><br><span class=\"line\">  uid: ee850cf9-9014-4be2-97d8-5d1840e78d54</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-configmap</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">      <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;printenv&quot;</span>] <span class=\"comment\"># æ‰“å°ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">      <span class=\"attr\">envFrom:</span>                  <span class=\"comment\"># ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€configMapï¼Œç­‰ç­‰</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">configMapRef:</span>         <span class=\"comment\"># è¿™é‡Œå¼•ç”¨ ConfigMapï¼Œæ­¤å¤„å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span>   <span class=\"comment\"># configMap åç§°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† ConfigMap ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod2.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-configmap2</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">args:</span>                       <span class=\"comment\"># å®¹å™¨å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;username: $&#123;CONFIGMAP_USERNAME&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;password: $&#123;CONFIGMAP_PASSWORD&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span>    <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">    <span class=\"attr\">env:</span>                        <span class=\"comment\"># ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">CONFIGMAP_USERNAME</span>  <span class=\"comment\"># è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span>                <span class=\"comment\"># value æ¥æº</span></span><br><span class=\"line\">        <span class=\"attr\">configMapKeyRef:</span>        <span class=\"comment\"># å¼•ç”¨ ConfigMap ä¸­çš„ key</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span>     <span class=\"comment\"># configMap åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">username</span>         <span class=\"comment\"># configMap ä¸­ key çš„åç§°</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">CONFIGMAP_PASSWORD</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">        <span class=\"attr\">configMapKeyRef:</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">password</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹podæ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl logs pods/env-configmap</span><br><span class=\"line\">access_level=1</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT=443</span><br><span class=\"line\">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br><span class=\"line\">HOSTNAME=env-configmap</span><br><span class=\"line\">SHLVL=1</span><br><span class=\"line\">username=k8s-admin</span><br><span class=\"line\">HOME=/root</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br><span class=\"line\">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class=\"line\">password=123456</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class=\"line\">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br><span class=\"line\">PWD=/</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl logs pods/env-configmap2</span><br><span class=\"line\">username: k8s-admin</span><br><span class=\"line\">password: 123456</span><br></pre></td></tr></table></figure>\n<h3 id=\"å­˜å‚¨å·å¼•ç”¨\">å­˜å‚¨å·å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># configmap-configfile.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">app-config</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">app.properties:</span> <span class=\"string\">|</span>  <span class=\"comment\"># æ–‡ä»¶åç§° ï¼Œä½¿ç”¨ | åˆ›å»ºå¤šè¡Œ</span></span><br><span class=\"line\">    <span class=\"string\">server.port=8080</span></span><br><span class=\"line\">    <span class=\"string\">log.level=INFO</span></span><br><span class=\"line\">  <span class=\"attr\">db.properties:</span> <span class=\"string\">|</span>   <span class=\"comment\"># æ–‡ä»¶åç§°</span></span><br><span class=\"line\">    <span class=\"string\">db.host=localhost</span></span><br><span class=\"line\">    <span class=\"string\">db.port=5432</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\"># æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">kubectl create configmap app-config \\</span><br><span class=\"line\">  --from-file=app.properties \\</span><br><span class=\"line\">  --from-file=db.properties</span><br><span class=\"line\"><span class=\"comment\"># app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># server.port=8080</span></span><br><span class=\"line\"><span class=\"comment\"># log.level=INFO</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># db.host=localhost</span></span><br><span class=\"line\"><span class=\"comment\"># db.port=5432</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ k get cm app-config -oyaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  app.properties: |</span><br><span class=\"line\">    server.port=8080</span><br><span class=\"line\">    log.level=INFO</span><br><span class=\"line\">  db.properties: |</span><br><span class=\"line\">    db.host=localhost</span><br><span class=\"line\">    db.port=5432</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T10:49:00Z&quot;</span></span><br><span class=\"line\">  name: app-config</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;726507&quot;</span></span><br><span class=\"line\">  uid: 05c9a228-ec69-4e88-b8d8-63f97eff2651</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod æŒ‚è½½ ConfigMap ä¸ºæ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># configmap-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">configmap-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span>              <span class=\"comment\"># æŒ‚è½½è·¯å¾„</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span>                   <span class=\"comment\"># å­˜å‚¨å· åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">configMap:</span>                            <span class=\"comment\"># å­˜å‚¨å·ç±»å‹ä¸º ConfigMap</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">app-config</span>                    <span class=\"comment\"># æŒ‚è½½çš„ ConfigMap åç§°ï¼Œæœ¬åˆ©ä¸­å°† configMap ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å™¨å†…çš„ <code>/etc/config/</code> ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/config/app.properties</span><br><span class=\"line\">/etc/config/db.properties</span><br><span class=\"line\"></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it configmap-demo -- <span class=\"built_in\">ls</span> /etc/config/</span><br><span class=\"line\">app.properties  db.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæƒ³æŒ‚è½½ ConfigMap ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>items</code> å­—æ®µæŒ‡å®šï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">configmap-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">    <span class=\"attr\">configMap:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">app-config</span></span><br><span class=\"line\">      <span class=\"attr\">items:</span>                   <span class=\"comment\"># æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">app.properties</span>    <span class=\"comment\"># configMapä¸­çš„key</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">app.properties</span>   <span class=\"comment\"># æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>--from-env-file=app.env</code> ä¸ <code>--from-file=app.env</code> çš„åŒºåˆ«</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é¡¹ç›®</th>\n<th><code>--from-env-file=app.env</code></th>\n<th><code>--from-file=app.env</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ç”¨é€”</td>\n<td>è§£æä¸ºç¯å¢ƒå˜é‡å½¢å¼é”®å€¼å¯¹</td>\n<td>æŒ‰æ–‡ä»¶æ•´ä½“è¯»å…¥ä¸ºå†…å®¹</td>\n</tr>\n<tr>\n<td>é€‚åˆåœºæ™¯</td>\n<td>æƒ³æŠŠæ¯ä¸ªå˜é‡éƒ½å•ç‹¬ç”¨æ‰</td>\n<td>æŒ‚è½½ä¸ºé…ç½®æ–‡ä»¶ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>data ç»“æ„</td>\n<td>æ¯ä¸€è¡Œå˜ä¸€ä¸ªé”®å€¼å¯¹</td>\n<td>æ–‡ä»¶åä¸º keyï¼Œå†…å®¹ä¸ºå€¼</td>\n</tr>\n<tr>\n<td>è¯»å–æ–¹å¼</td>\n<td>ç”¨ <code>envFrom</code> æ³¨å…¥ç¯å¢ƒå˜é‡</td>\n<td>ç”¨ <code>volumeMount</code> æŒ‚è½½æ•´ä¸ªæ–‡ä»¶</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ConfigMap ä¹Ÿæ”¯æŒ <code>äºŒè¿›åˆ¶</code> æ•°æ®ï¼Œä½†éœ€è¦ç”¨ <code>base64</code> ç¼–ç </p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-config</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">config.txt:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    Hello, world!</span></span><br><span class=\"line\"><span class=\"string\"></span><span class=\"attr\">binaryData:</span></span><br><span class=\"line\">  <span class=\"attr\">config.bin:</span> <span class=\"string\">aGVsbG8gd29ybGQK</span>   <span class=\"comment\"># è¿™æ˜¯ &quot;hello world&quot; çš„ base64 ç¼–ç </span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>binaryData å’Œ data çš„åŒºåˆ«</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>å†…å®¹ç±»å‹</th>\n<th>ç¼–ç æ–¹å¼</th>\n<th>é€‚åˆå­˜å‚¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>data</code></td>\n<td>æ–‡æœ¬ï¼ˆUTF-8ï¼‰</td>\n<td>æ˜æ–‡</td>\n<td>é…ç½®æ–‡ä»¶ã€å‚æ•°ã€è„šæœ¬ç­‰</td>\n</tr>\n<tr>\n<td><code>binaryData</code></td>\n<td>ä»»æ„äºŒè¿›åˆ¶æ•°æ®</td>\n<td>base64 ç¼–ç </td>\n<td>å›¾ç‰‡ã€è¯ä¹¦ã€éUTF-8æ–‡ä»¶ç­‰</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>â—æ³¨æ„äº‹é¡¹</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>é¡¹ç›®</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>base64 ç¼–ç æ ¼å¼</td>\n<td><code>binaryData</code> ä¸­çš„å€¼å¿…é¡»æ˜¯æ ‡å‡† base64ï¼Œä¸æ”¯æŒæ¢è¡Œ</td>\n</tr>\n<tr>\n<td>è§£ç åå¤§å°é™åˆ¶</td>\n<td>ConfigMap å•ä¸ªå¯¹è±¡æœ€å¤§ 1MBï¼ˆæ— è®º data è¿˜æ˜¯ binaryDataï¼‰</td>\n</tr>\n<tr>\n<td>äºŒè€…å¯å…±å­˜</td>\n<td><code>data</code> ä¸ <code>binaryData</code> å¯ä»¥åŒæ—¶å‡ºç°åœ¨åŒä¸€ä¸ª ConfigMap ä¸­ï¼ˆå­—æ®µåä¸èƒ½é‡å¤ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹ ConfigMap å ï¼š<code>k edit configmap &lt;configmap-name&gt;</code></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¦‚æœ Pod æ˜¯ä½œä¸º ç¯å¢ƒå˜é‡ å…³è”çš„ï¼ŒPod ä¸ä¼šæ›´æ–°ï¼Œåªèƒ½é‡æ–°åˆ›å»º</li>\n<li class=\"lvl-4\">å¦‚æœ Pod æ˜¯ä½œä¸º volume æŒ‚è½½çš„ï¼ŒPod ä¼šè‡ªåŠ¨æ›´æ–°(å¤§çº¦å‡ ç§’å)</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ é™¤ ConfigMap åï¼š<code>k delete configmap &lt;configmap-name&gt;</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Pod çŠ¶æ€</th>\n<th>ConfigMap åˆ é™¤åå½±å“</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ­£åœ¨è¿è¡Œ</td>\n<td>ä¸å—å½±å“</td>\n</tr>\n<tr>\n<td>é‡å¯ / æ‰©å®¹</td>\n<td><strong>å¤±è´¥</strong>ï¼šæ‰¾ä¸åˆ° ConfigMapï¼Œæ— æ³•åˆ›å»ºå®¹å™¨</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s ConfigMap å®˜æ–¹æ–‡æ¡£ ConfigMap(åˆ«åcm) ä»‹ç» ConfigMap æ˜¯ä¸€ç§ API å¯¹è±¡ï¼Œç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚ ä½¿ç”¨æ—¶ï¼Œ Pod å¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚ ConfigMap å°†ä½ çš„ç¯å¢ƒé…ç½®ä¿¡æ¯å’Œå®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹ã€‚ å¤šä¸ª Pod å¯ä»¥å…³è”åŒä¸€ä¸ª ConfigMap ConfigMap åˆ›å»ºåŠä½¿ç”¨ ç¯å¢ƒå˜é‡å¼•ç”¨ yamlåˆ›å»º 123456789# configmap.yamlapiVersion: v1kind: ConfigMap # ConfigMapmetadata: name: myconfigmap # configmap åç§°data: # data å­—æ®µè®¾è®¡ç”¨æ¥ä¿å­˜ UTF-8 å­—ç¬¦ä¸²ï¼Œæœ€å¤§å€¼ä¸º 1M username: k8s-admin # key: value access_level: &quot;1&quot; password: &quot;123456&quot; å‘½ä»¤è¡Œåˆ›å»º 1234567891011121314151617181920212223242526# keyï¼švalue æ–¹å¼åˆ›å»ºkubectl create configmap myconfigmap --from-literal=username=k8s-admin --from-literal=access_level=1 --from-literal=password=123456# æ–‡ä»¶æ–¹å¼åˆ›å»º# --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ ConfigMap ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚kubectl create configmap myconfigmap --from-env-file=app.env --from-env-file=other.env# app.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# username=k8s-admin# access_level=1# other.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# password=123456# åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ ConfigMap çš„å†…å®¹$ k get cm myconfigmap -oyamlapiVersion: v1data: access_level: &quot;1&quot; password: &quot;123456&quot; username: k8s-adminkind: ConfigMapmetadata: creationTimestamp: &quot;2025-07-05T10:29:15Z&quot; name: myconfigmap namespace: default resourceVersion: &quot;723770&quot; uid: ee850cf9-9014-4be2-97d8-5d1840e78d54 å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213# pod.yamlapiVersion: v1kind: Podmetadata: name: env-configmapspec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;printenv&quot;] # æ‰“å°ç¯å¢ƒå˜é‡ image: busybox:latest envFrom: # ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€configMapï¼Œç­‰ç­‰ - configMapRef: # è¿™é‡Œå¼•ç”¨ ConfigMapï¼Œæ­¤å¤„å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ name: myconfigmap # configMap åç§° å°† ConfigMap ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213141516171819202122232425# pod2.yamlapiVersion: v1kind: Podmetadata: name: env-configmap2spec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;] args: # å®¹å™¨å¯åŠ¨å‘½ä»¤ - | echo &quot;username: $&#123;CONFIGMAP_USERNAME&#125;&quot; echo &quot;password: $&#123;CONFIGMAP_PASSWORD&#125;&quot; image: busybox:latest env: # ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼ - name: CONFIGMAP_USERNAME # è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key valueFrom: # value æ¥æº configMapKeyRef: # å¼•ç”¨ ConfigMap ä¸­çš„ key name: myconfigmap # configMap åç§° key: username # configMap ä¸­ key çš„åç§° - name: CONFIGMAP_PASSWORD valueFrom: configMapKeyRef: name: myconfigmap key: password æŸ¥çœ‹podæ—¥å¿— 12345678910111213141516171819202122$ kubectl logs pods/env-configmapaccess_level=1KUBERNETES_SERVICE_PORT=443KUBERNETES_PORT=tcp://10.96.0.1:443HOSTNAME=env-configmapSHLVL=1username=k8s-adminHOME=/rootKUBERNETES_PORT_443_TCP_ADDR=10.96.0.1PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binKUBERNETES_PORT_443_TCP_PORT=443password=123456KUBERNETES_PORT_443_TCP_PROTO=tcpKUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443KUBERNETES_SERVICE_PORT_HTTPS=443KUBERNETES_SERVICE_HOST=10.96.0.1PWD=/$ kubectl logs pods/env-configmap2username: k8s-adminpassword: 123456 å­˜å‚¨å·å¼•ç”¨ yamlåˆ›å»º 123456789101112# configmap-configfile.yamlapiVersion: v1kind: ConfigMapmetadata: name: app-configdata: app.properties: | # æ–‡ä»¶åç§° ï¼Œä½¿ç”¨ | åˆ›å»ºå¤šè¡Œ server.port=8080 log.level=INFO db.properties: | # æ–‡ä»¶åç§° db.host=localhost db.port=5432 å‘½ä»¤è¡Œåˆ›å»º 12345678910111213141516171819202122232425262728 # æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡kubectl create configmap app-config \\ --from-file=app.properties \\ --from-file=db.properties# app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# server.port=8080# log.level=INFO# db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# db.host=localhost# db.port=5432$ k get cm app-config -oyamlapiVersion: v1data: app.properties: | server.port=8080 log.level=INFO db.properties: | db.host=localhost db.port=5432kind: ConfigMapmetadata: creationTimestamp: &quot;2025-07-05T10:49:00Z&quot; name: app-config namespace: default resourceVersion: &quot;726507&quot; uid: 05c9a228-ec69-4e88-b8d8-63f97eff2651 Pod æŒ‚è½½ ConfigMap ä¸ºæ–‡ä»¶ 123456789101112131415161718# configmap-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼šapiVersion: v1kind: Podmetadata: name: configmap-demospec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config # æŒ‚è½½è·¯å¾„ readOnly: true volumes: - name: config-volume # å­˜å‚¨å· åç§° configMap: # å­˜å‚¨å·ç±»å‹ä¸º ConfigMap name: app-config # æŒ‚è½½çš„ ConfigMap åç§°ï¼Œæœ¬åˆ©ä¸­å°† configMap ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹ å®¹å™¨å†…çš„ /etc/config/ ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š 12345/etc/config/app.properties/etc/config/db.properties$ k exec -it configmap-demo -- ls /etc/config/app.properties db.properties å¦‚æœåªæƒ³æŒ‚è½½ ConfigMap ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ items å­—æ®µæŒ‡å®šï¼š 1234567891011121314151617181920apiVersion: v1kind: Podmetadata: name: configmap-demospec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config readOnly: true volumes: - name: config-volume configMap: name: app-config items: # æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key - key: app.properties # configMapä¸­çš„key path: app.properties # æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties åè®° --from-env-file=app.env ä¸ --from-file=app.env çš„åŒºåˆ« é¡¹ç›® --from-env-file=app.env --from-file=app.env ç”¨é€” è§£æä¸ºç¯å¢ƒå˜é‡å½¢å¼é”®å€¼å¯¹ æŒ‰æ–‡ä»¶æ•´ä½“è¯»å…¥ä¸ºå†…å®¹ é€‚åˆåœºæ™¯ æƒ³æŠŠæ¯ä¸ªå˜é‡éƒ½å•ç‹¬ç”¨æ‰ æŒ‚è½½ä¸ºé…ç½®æ–‡ä»¶ä½¿ç”¨ data ç»“æ„ æ¯ä¸€è¡Œå˜ä¸€ä¸ªé”®å€¼å¯¹ æ–‡ä»¶åä¸º keyï¼Œå†…å®¹ä¸ºå€¼ è¯»å–æ–¹å¼ ç”¨ envFrom æ³¨å…¥ç¯å¢ƒå˜é‡ ç”¨ volumeMount æŒ‚è½½æ•´ä¸ªæ–‡ä»¶ ConfigMap ä¹Ÿæ”¯æŒ äºŒè¿›åˆ¶ æ•°æ®ï¼Œä½†éœ€è¦ç”¨ base64 ç¼–ç  123456789apiVersion: v1kind: ConfigMapmetadata: name: my-configdata: config.txt: | Hello, world!binaryData: config.bin: aGVsbG8gd29ybGQK # è¿™æ˜¯ &quot;hello world&quot; çš„ base64 ç¼–ç  binaryData å’Œ data çš„åŒºåˆ« å­—æ®µ å†…å®¹ç±»å‹ ç¼–ç æ–¹å¼ é€‚åˆå­˜å‚¨ data æ–‡æœ¬ï¼ˆUTF-8ï¼‰ æ˜æ–‡ é…ç½®æ–‡ä»¶ã€å‚æ•°ã€è„šæœ¬ç­‰ binaryData ä»»æ„äºŒè¿›åˆ¶æ•°æ® base64 ç¼–ç  å›¾ç‰‡ã€è¯ä¹¦ã€éUTF-8æ–‡ä»¶ç­‰ â—æ³¨æ„äº‹é¡¹ é¡¹ç›® è¯´æ˜ base64 ç¼–ç æ ¼å¼ binaryData ä¸­çš„å€¼å¿…é¡»æ˜¯æ ‡å‡† base64ï¼Œä¸æ”¯æŒæ¢è¡Œ è§£ç åå¤§å°é™åˆ¶ ConfigMap å•ä¸ªå¯¹è±¡æœ€å¤§ 1MBï¼ˆæ— è®º data è¿˜æ˜¯ binaryDataï¼‰ äºŒè€…å¯å…±å­˜ data ä¸ binaryData å¯ä»¥åŒæ—¶å‡ºç°åœ¨åŒä¸€ä¸ª ConfigMap ä¸­ï¼ˆå­—æ®µåä¸èƒ½é‡å¤ï¼‰ ä¿®æ”¹ ConfigMap å ï¼šk edit configmap &lt;configmap-name&gt; å¦‚æœ Pod æ˜¯ä½œä¸º ç¯å¢ƒå˜é‡ å…³è”çš„ï¼ŒPod ä¸ä¼šæ›´æ–°ï¼Œåªèƒ½é‡æ–°åˆ›å»º å¦‚æœ Pod æ˜¯ä½œä¸º volume æŒ‚è½½çš„ï¼ŒPod ä¼šè‡ªåŠ¨æ›´æ–°(å¤§çº¦å‡ ç§’å) åˆ é™¤ ConfigMap åï¼šk delete configmap &lt;configmap-name&gt; Pod çŠ¶æ€ ConfigMap åˆ é™¤åå½±å“ æ­£åœ¨è¿è¡Œ ä¸å—å½±å“ é‡å¯ / æ‰©å®¹ å¤±è´¥ï¼šæ‰¾ä¸åˆ° ConfigMapï¼Œæ— æ³•åˆ›å»ºå®¹å™¨","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s ConfigMap å®˜æ–¹æ–‡æ¡£","date_published":"2025-07-23T12:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/22/k8s-storageclass/","url":"https://blog.hanqunfeng.com/2025/07/22/k8s-storageclass/","title":"K8S ä¹‹ StorageClass","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/\">k8s StorageClass å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"StorageClass-åˆ«åsc-ä»‹ç»\">StorageClass(åˆ«åsc) ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>K8s çš„å­˜å‚¨èµ„æºåˆ†ä¸ºä¸¤ç§ä¾›åº”æ¨¡å¼ï¼šé™æ€ä¾›åº”æ¨¡å¼ å’Œ åŠ¨æ€ä¾›åº”æ¨¡å¼ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">é™æ€æ¨¡å¼ä¸‹ï¼Œç®¡ç†å‘˜éœ€è¦é¢„å…ˆåˆ›å»ºè®¸å¤šPVï¼Œç­‰å¾… PVC  æ¥ç»‘å®šã€‚</li>\n<li class=\"lvl-4\">åŠ¨æ€æ¨¡å¼ä¸‹ï¼ŒKubernetes ä¼šé€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»º PVï¼Œå¹¶å®Œæˆä¸ PVC çš„ç»‘å®šã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>StorageClass æ˜¯ Kubernetes ä¸­ç”¨æ¥å®šä¹‰ <code>å­˜å‚¨åç«¯ç±»å‹å’Œé…ç½®å‚æ•°</code> çš„èµ„æº</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½œç”¨ï¼š è‡ªåŠ¨åˆ›å»º PVï¼ˆPersistentVolumeï¼‰çš„â€œæ¨¡æ¿â€æˆ–â€œè§„åˆ™â€</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨åœºæ™¯ï¼š é…åˆ PVC ä½¿ç”¨æ—¶ï¼ŒKubernetes å¯ä»¥æ ¹æ® StorageClass è‡ªåŠ¨ åŠ¨æ€åˆ›å»º å¯¹åº”çš„æŒä¹…å·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>âœ… æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ— éœ€æ‰‹åŠ¨åˆ›å»º PV</li>\n<li class=\"lvl-4\">æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆNFSã€äº‘ç›˜ã€Cephã€GlusterFSã€iSCSIâ€¦ï¼‰</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/OGGWYb.png\" alt=\"\"></p>\n<h2 id=\"åˆ›å»º-StorageClass\">åˆ›å»º StorageClass</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ª NFS çš„ StorageClass çš„ yaml ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nfs-storage.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">storage.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StorageClass</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-csi</span>                                           <span class=\"comment\"># å­˜å‚¨ç±»åç§°</span></span><br><span class=\"line\"><span class=\"attr\">provisioner:</span> <span class=\"string\">nfs.csi.k8s.io</span>                               <span class=\"comment\"># æŒ‡å®šå­˜å‚¨æ’ä»¶çš„ CSI é©±åŠ¨åç§°ï¼Œéœ€è¦å®‰è£… nfs-csi-driver</span></span><br><span class=\"line\"><span class=\"attr\">reclaimPolicy:</span> <span class=\"string\">Delete</span>                                     <span class=\"comment\"># Retainï¼šPVC åˆ é™¤åï¼ŒPV ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆæ•°æ®ä¿ç•™ï¼‰ï¼Œé»˜è®¤æ˜¯ Delete,ç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚</span></span><br><span class=\"line\"><span class=\"attr\">allowVolumeExpansion:</span> <span class=\"literal\">true</span>                                <span class=\"comment\"># æ˜¯å¦å…è®¸ PVC è‡ªåŠ¨æ‰©å®¹ï¼Œnfs æ”¯æŒæ‰©å®¹</span></span><br><span class=\"line\"><span class=\"attr\">mountOptions:</span>                                             <span class=\"comment\"># æŒ‚è½½é€‰é¡¹ï¼Œcsiæ’ä»¶ä¸åŒï¼Œé€‰é¡¹ä¸åŒã€‚è¿™é‡Œæ˜¯ nfsçš„</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">hard</span>                                                  <span class=\"comment\"># æœåŠ¡å™¨å¼‚å¸¸æ—¶å®¢æˆ·ç«¯ä¼šä¸€ç›´å‘è¯·æ±‚ç›´åˆ°æŒ‚è½½æˆåŠŸ</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nfsvers=4.1</span>                                           <span class=\"comment\"># nfsç‰ˆæœ¬    nfs4.1</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nolock</span>                                                <span class=\"comment\"># å…è®¸å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®</span></span><br><span class=\"line\"><span class=\"attr\">volumeBindingMode:</span> <span class=\"string\">Immediate</span>                              <span class=\"comment\"># é»˜è®¤å€¼ï¼šImmediate: åˆ›å»ºPVCæ—¶ç«‹å³ç»‘å®š ,WaitForFirstConsumerï¼šç­‰åˆ° Pod è°ƒåº¦åˆ°èŠ‚ç‚¹åå†åˆ†é…å·ï¼Œé€‚åˆå¤šå¯ç”¨åŒºåœºæ™¯</span></span><br><span class=\"line\"><span class=\"attr\">parameters:</span>                                               <span class=\"comment\"># å‚æ•°é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.88</span>                                    <span class=\"comment\"># nfsæœåŠ¡å™¨åœ°å€</span></span><br><span class=\"line\">  <span class=\"attr\">share:</span> <span class=\"string\">/nfs-server/data</span>                                 <span class=\"comment\"># nfs-serverä¸Šçš„å­˜å‚¨ç›®å½•</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>csi-driver-nfs ä» v4.x èµ·ï¼Œå·²ç»æ”¯æŒ Delete reclaimPolicy å’Œ allowVolumeExpansion è‡ªåŠ¨æ‰©å®¹ã€‚<br>\nç”Ÿäº§ç¯å¢ƒæ…ç”¨ Delete reclaimPolicyï¼Œå› ä¸ºæ­¤æ—¶åˆ é™¤ PVC åï¼Œnfs-server ä¸Šçš„å­˜å‚¨ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª StorageClass é…ç½®ä¸­æœ‰ä¸‰ä¸ªå¿…å¡«çš„å‚æ•°ï¼š<code>provisioner</code>ã€<code>parameters</code> å’Œ <code>reclaimPolicy</code> å­—æ®µï¼Œ è¿™äº›å­—æ®µä¼šåœ¨ StorageClass éœ€è¦åŠ¨æ€åˆ¶å¤‡ PersistentVolume (PV) ä»¥æ»¡è¶³ PersistentVolumeClaim (PVC) æ—¶ä½¿ç”¨åˆ°ã€‚</p>\n</li>\n</ul>\n<h3 id=\"provisioner-å­˜å‚¨åˆ¶å¤‡å™¨\">provisioner: å­˜å‚¨åˆ¶å¤‡å™¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª StorageClass éƒ½æœ‰ä¸€ä¸ªåˆ¶å¤‡å™¨ï¼ˆProvisionerï¼‰ï¼Œç”¨æ¥å†³å®šä½¿ç”¨å“ªä¸ªå·æ’ä»¶åˆ¶å¤‡ PVã€‚ è¯¥å­—æ®µå¿…é¡»æŒ‡å®šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯”å¦‚ NFS å­˜å‚¨åˆ¶å¤‡å™¨ï¼š<code>provisioner: nfs.csi.k8s.io</code>ï¼Œæ˜¯ K8S å®˜æ–¹ç»´æŠ¤çš„ NFS CSI æ’ä»¶ã€‚<a href=\"https://github.com/kubernetes-csi/csi-driver-nfs\">Github</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£… NFS CSI æ’ä»¶ï¼š<a href=\"https://github.com/kubernetes-csi/csi-driver-nfs/blob/master/docs/install-csi-driver-master.md\">Install NFS CSI Driver</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨çº¿å®‰è£…</span></span><br><span class=\"line\">curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/install-driver.sh | bash -s master --</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯</span></span><br><span class=\"line\">kubectl -n kube-system get pod -o wide -l app=csi-nfs-controller</span><br><span class=\"line\">kubectl -n kube-system get pod -o wide -l app=csi-nfs-node</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸è½½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/uninstall-driver.sh | bash -s master --</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º StorageClass</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f nfs-storage.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## æŸ¥çœ‹ storageclass</span></span><br><span class=\"line\">$ k get sc</span><br><span class=\"line\">NAME      PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class=\"line\">nfs-csi   nfs.csi.k8s.io   Delete          Immediate           <span class=\"literal\">true</span>                   5s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º PVC æ—¶æŒ‡å®š storageclassï¼ŒStorageClass ä¼šè‡ªåŠ¨åˆ›å»º PV</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nfs-pvc.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-pvc</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">nfs-csi</span>  <span class=\"comment\"># æŒ‡å®š StorageClass çš„åç§°ï¼Œå¦‚æœè®¾ç½®äº†é»˜è®¤çš„scï¼Œæ­¤å¤„å¯ä»¥åˆ é™¤è¯¥é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>          <span class=\"comment\"># æŒ‡å®šè®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">800Mi</span>         <span class=\"comment\"># ç”³è¯·çš„å®¹é‡</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º PVC</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º PVC</span></span><br><span class=\"line\">$ k apply -f nfs-pvc.yaml</span><br><span class=\"line\">persistentvolumeclaim/nfs-pvc created</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ PVå’ŒPVCï¼Œå¯ä»¥çœ‹åˆ° PV è‡ªåŠ¨åˆ›å»ºäº†</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907   800Mi      RWX            Delete           Bound    default/nfs-pvc   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          2m4s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/nfs-pvc   Bound    pvc-c1d33fec-5e16-4156-8405-1af4fc171907   800Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 2m4s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è‡ªåŠ¨æ‰©å®¹ï¼Œä¿®æ”¹ PVC å®¹é‡åˆ° 1Gi</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl edit pvc nfs-pvc</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å¦‚ä¸‹</span></span><br><span class=\"line\"><span class=\"comment\"># &quot;storage&quot;:&quot;1Gi&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° è‡ªåŠ¨æ‰©å®¹æˆåŠŸ</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907   1Gi        RWX            Delete           Bound    default/nfs-pvc   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          4m50s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/nfs-pvc   Bound    pvc-c1d33fec-5e16-4156-8405-1af4fc171907   1Gi        RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 4m50s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤PVCï¼Œè‡ªåŠ¨åˆ é™¤PV</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete pvc nfs-pvc</span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° PV å·²ç»è¢«è‡ªåŠ¨åˆ é™¤ï¼Œ reclaimPolicy: Delete</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">No resources found</span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶ nfs-server çš„ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"è®¾ç½®é»˜è®¤çš„-StorageClass\">è®¾ç½®é»˜è®¤çš„ StorageClass</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢æˆ‘ä»¬åˆ›å»º PVC çš„æ—¶å€™éœ€è¦æŒ‡å®š StorageClassï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œé‚£ä¹ˆåœ¨PVCé‡Œå°±å¯ä»¥çœç•¥æ‰ StorageClass çš„è®¾ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>K8S ä¸­åªèƒ½è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è®¾ç½®é»˜è®¤çš„ StorageClass</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸º sc æ·»åŠ  `é»˜è®¤` æ³¨è§£ï¼Œå»æ‰è¯¥æ³¨è§£ æˆ–è€… è®¾ç½®ä¸º false å°±å–æ¶ˆé»˜è®¤äº†ã€‚</span></span><br><span class=\"line\">$ kubectl patch storageclass nfs-csi -p <span class=\"string\">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\">storageclass.storage.k8s.io/nfs-csi patched</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹scï¼Œæ­¤æ—¶çœ‹åˆ°åç§°åé¢å¤šäº†ä¸€ä¸ª (default) ï¼Œè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ StorageClass</span></span><br><span class=\"line\">$ k get sc</span><br><span class=\"line\">NAME                PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class=\"line\">nfs-csi (default)   nfs.csi.k8s.io   Delete          Immediate           <span class=\"literal\">true</span>                   14m</span><br></pre></td></tr></table></figure>\n<h2 id=\"StatefulSet-è‡ªåŠ¨åˆ›å»º-PVC\">StatefulSet: è‡ªåŠ¨åˆ›å»º PVC</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çš„æ–¹å¼è¿˜æ˜¯è¦æ±‚æˆ‘ä»¬å¿…é¡»åˆ›å»º PVCï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä¸ç”¨åˆ›å»º PVC ï¼Œè€Œæ˜¯åœ¨åˆ›å»ºæ§åˆ¶å™¨çš„æ—¶å€™å°±ä¸€èµ·æŠŠ PVC åˆ›å»ºå¥½å‘¢ï¼Ÿ</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›®å‰åªæœ‰ <code>StatefulSet</code>æ§åˆ¶å™¨ æ‰æ”¯æŒè‡ªåŠ¨åˆ›å»º PVC</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># redis-statefulset.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span>                  <span class=\"comment\"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span>                    <span class=\"comment\"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">redis-sts</span>                    <span class=\"comment\"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">sts-ns</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                                <span class=\"comment\"># é…ç½®é¡¹</span></span><br><span class=\"line\">  <span class=\"attr\">revisionHistoryLimit:</span> <span class=\"number\">10</span>           <span class=\"comment\"># ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                          <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span>                     <span class=\"comment\"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                     <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">updateStrategy:</span>                    <span class=\"comment\"># æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ ·</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">RollingUpdate</span>              <span class=\"comment\"># 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚</span></span><br><span class=\"line\">                                     <span class=\"comment\"># 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span>                   <span class=\"comment\"># æ»šåŠ¨å‡çº§çš„é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">partition:</span> <span class=\"number\">0</span>                   <span class=\"comment\"># ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§</span></span><br><span class=\"line\">  <span class=\"attr\">serviceName:</span> <span class=\"string\">redis-svc</span>             <span class=\"comment\"># æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹ï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºå¥½</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">2</span>                        <span class=\"comment\"># å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span>                          <span class=\"comment\"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                   <span class=\"comment\"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">redis:6.2</span>             <span class=\"comment\"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">redis</span>                  <span class=\"comment\"># å®¹å™¨çš„åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span>                <span class=\"comment\"># æŒ‚è½½æ•°æ®å·</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">redis-data</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/data</span>           <span class=\"comment\"># Redis æŒä¹…åŒ–æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹</span></span><br><span class=\"line\">  <span class=\"attr\">volumeClaimTemplates:</span>              <span class=\"comment\"># é…ç½® PVC æ¨¡æ¿</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">redis-data</span>               <span class=\"comment\"># PVC åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>              <span class=\"comment\"># è®¿é—®æ¨¡å¼ï¼šå¤šèŠ‚ç‚¹è¯»å†™</span></span><br><span class=\"line\">      <span class=\"attr\">resources:</span></span><br><span class=\"line\">        <span class=\"attr\">requests:</span></span><br><span class=\"line\">          <span class=\"attr\">storage:</span> <span class=\"string\">500Mi</span>             <span class=\"comment\"># è¯·æ±‚çš„å­˜å‚¨å®¹é‡ï¼Œæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´</span></span><br><span class=\"line\">      <span class=\"attr\">storageClassName:</span> <span class=\"string\">nfs-csi</span>      <span class=\"comment\"># å­˜å‚¨ç±»åç§°ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤å­˜å‚¨ç±»ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®š</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º StatefulSetï¼Œå¹¶æŸ¥çœ‹ PV,PVC</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º StatefulSet</span></span><br><span class=\"line\">$ kubectl apply -f redis-statefulset.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ PV,PVC</span></span><br><span class=\"line\">$ k get pv,pvc -n sts-ns</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-1   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          19s</span><br><span class=\"line\">persistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-0   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          22s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-0   Bound    pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 22s</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-1   Bound    pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 20s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>StatefulSet çš„ volumeClaimTemplates æ¯ä¸ª Pod å•ç‹¬åˆ›å»º PVCï¼ŒPod å’Œ PVC ä¸€ä¸€å¯¹åº”ï¼Œå³æœ‰å‡ ä¸ªå‰¯æœ¬å°±åˆ›å»ºå‡ ä¸ª PVCã€‚PVC åç§°æ˜¯ï¼š<code>&lt;volumeClaimTemplates.metadata.name&gt;-&lt;statefulset-name&gt;-&lt;pod-ordinal&gt;</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ é™¤ StatefulSet</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete -f redis-statefulset.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ PV,PVCï¼Œå‘ç°åˆ é™¤ StatefulSet åï¼ŒPV å’Œ PVC æ˜¯ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ PVC</span></span><br><span class=\"line\">$ k get pv,pvc -n sts-ns</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-1   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          6m30s</span><br><span class=\"line\">persistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-0   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          6m33s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-0   Bound    pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 6m33s</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-1   Bound    pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 6m31s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰‹åŠ¨åˆ é™¤ PVCï¼Œå› ä¸ºscé…ç½®çš„å›æ”¶ç­–ç•¥ä¸º Deleteï¼Œæ‰€ä»¥ PV ä¹Ÿä¼šè¢«åˆ é™¤</span></span><br><span class=\"line\">k delete pvc -n sts-ns redis-data-redis-sts-0</span><br><span class=\"line\">k delete pvc -n sts-ns redis-data-redis-sts-1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Šï¼Œæ— è®ºæ˜¯åˆ é™¤ statefulset è¿˜æ˜¯ç¼©å®¹ statefulsetï¼ŒPVC éƒ½ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s StorageClass å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS StorageClass(åˆ«åsc) ä»‹ç» K8s çš„å­˜å‚¨èµ„æºåˆ†ä¸ºä¸¤ç§ä¾›åº”æ¨¡å¼ï¼šé™æ€ä¾›åº”æ¨¡å¼ å’Œ åŠ¨æ€ä¾›åº”æ¨¡å¼ã€‚ é™æ€æ¨¡å¼ä¸‹ï¼Œç®¡ç†å‘˜éœ€è¦é¢„å…ˆåˆ›å»ºè®¸å¤šPVï¼Œç­‰å¾… PVC æ¥ç»‘å®šã€‚ åŠ¨æ€æ¨¡å¼ä¸‹ï¼ŒKubernetes ä¼šé€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»º PVï¼Œå¹¶å®Œæˆä¸ PVC çš„ç»‘å®šã€‚ StorageClass æ˜¯ Kubernetes ä¸­ç”¨æ¥å®šä¹‰ å­˜å‚¨åç«¯ç±»å‹å’Œé…ç½®å‚æ•° çš„èµ„æº ä½œç”¨ï¼š è‡ªåŠ¨åˆ›å»º PVï¼ˆPersistentVolumeï¼‰çš„â€œæ¨¡æ¿â€æˆ–â€œè§„åˆ™â€ ä½¿ç”¨åœºæ™¯ï¼š é…åˆ PVC ä½¿ç”¨æ—¶ï¼ŒKubernetes å¯ä»¥æ ¹æ® StorageClass è‡ªåŠ¨ åŠ¨æ€åˆ›å»º å¯¹åº”çš„æŒä¹…å·ã€‚ âœ… æ ¸å¿ƒä¼˜åŠ¿ï¼š æ— éœ€æ‰‹åŠ¨åˆ›å»º PV æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆNFSã€äº‘ç›˜ã€Cephã€GlusterFSã€iSCSIâ€¦ï¼‰ åˆ›å»º StorageClass ä¸€ä¸ª NFS çš„ StorageClass çš„ yaml ç¤ºä¾‹ 12345678910111213141516# nfs-storage.yamlapiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: nfs-csi # å­˜å‚¨ç±»åç§°provisioner: nfs.csi.k8s.io # æŒ‡å®šå­˜å‚¨æ’ä»¶çš„ CSI é©±åŠ¨åç§°ï¼Œéœ€è¦å®‰è£… nfs-csi-driverreclaimPolicy: Delete # Retainï¼šPVC åˆ é™¤åï¼ŒPV ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆæ•°æ®ä¿ç•™ï¼‰ï¼Œé»˜è®¤æ˜¯ Delete,ç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚allowVolumeExpansion: true # æ˜¯å¦å…è®¸ PVC è‡ªåŠ¨æ‰©å®¹ï¼Œnfs æ”¯æŒæ‰©å®¹mountOptions: # æŒ‚è½½é€‰é¡¹ï¼Œcsiæ’ä»¶ä¸åŒï¼Œé€‰é¡¹ä¸åŒã€‚è¿™é‡Œæ˜¯ nfsçš„ - hard # æœåŠ¡å™¨å¼‚å¸¸æ—¶å®¢æˆ·ç«¯ä¼šä¸€ç›´å‘è¯·æ±‚ç›´åˆ°æŒ‚è½½æˆåŠŸ - nfsvers=4.1 # nfsç‰ˆæœ¬ nfs4.1 - nolock # å…è®¸å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®volumeBindingMode: Immediate # é»˜è®¤å€¼ï¼šImmediate: åˆ›å»ºPVCæ—¶ç«‹å³ç»‘å®š ,WaitForFirstConsumerï¼šç­‰åˆ° Pod è°ƒåº¦åˆ°èŠ‚ç‚¹åå†åˆ†é…å·ï¼Œé€‚åˆå¤šå¯ç”¨åŒºåœºæ™¯parameters: # å‚æ•°é…ç½® server: 10.211.55.88 # nfsæœåŠ¡å™¨åœ°å€ share: /nfs-server/data # nfs-serverä¸Šçš„å­˜å‚¨ç›®å½• csi-driver-nfs ä» v4.x èµ·ï¼Œå·²ç»æ”¯æŒ Delete reclaimPolicy å’Œ allowVolumeExpansion è‡ªåŠ¨æ‰©å®¹ã€‚ ç”Ÿäº§ç¯å¢ƒæ…ç”¨ Delete reclaimPolicyï¼Œå› ä¸ºæ­¤æ—¶åˆ é™¤ PVC åï¼Œnfs-server ä¸Šçš„å­˜å‚¨ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚ æ¯ä¸ª StorageClass é…ç½®ä¸­æœ‰ä¸‰ä¸ªå¿…å¡«çš„å‚æ•°ï¼šprovisionerã€parameters å’Œ reclaimPolicy å­—æ®µï¼Œ è¿™äº›å­—æ®µä¼šåœ¨ StorageClass éœ€è¦åŠ¨æ€åˆ¶å¤‡ PersistentVolume (PV) ä»¥æ»¡è¶³ PersistentVolumeClaim (PVC) æ—¶ä½¿ç”¨åˆ°ã€‚ provisioner: å­˜å‚¨åˆ¶å¤‡å™¨ æ¯ä¸ª StorageClass éƒ½æœ‰ä¸€ä¸ªåˆ¶å¤‡å™¨ï¼ˆProvisionerï¼‰ï¼Œç”¨æ¥å†³å®šä½¿ç”¨å“ªä¸ªå·æ’ä»¶åˆ¶å¤‡ PVã€‚ è¯¥å­—æ®µå¿…é¡»æŒ‡å®šã€‚ æ¯”å¦‚ NFS å­˜å‚¨åˆ¶å¤‡å™¨ï¼šprovisioner: nfs.csi.k8s.ioï¼Œæ˜¯ K8S å®˜æ–¹ç»´æŠ¤çš„ NFS CSI æ’ä»¶ã€‚Githubã€‚ å®‰è£… NFS CSI æ’ä»¶ï¼šInstall NFS CSI Driver 123456# åœ¨çº¿å®‰è£…curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/install-driver.sh | bash -s master --# éªŒè¯kubectl -n kube-system get pod -o wide -l app=csi-nfs-controllerkubectl -n kube-system get pod -o wide -l app=csi-nfs-node å¸è½½ 1curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/uninstall-driver.sh | bash -s master -- ç¤ºä¾‹ åˆ›å»º StorageClass 123456kubectl apply -f nfs-storage.yaml## æŸ¥çœ‹ storageclass$ k get scNAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGEnfs-csi nfs.csi.k8s.io Delete Immediate true 5s åˆ›å»º PVC æ—¶æŒ‡å®š storageclassï¼ŒStorageClass ä¼šè‡ªåŠ¨åˆ›å»º PV 12345678910111213# nfs-pvc.yamlapiVersion: v1kind: PersistentVolumeClaimmetadata: name: nfs-pvc namespace: defaultspec: storageClassName: nfs-csi # æŒ‡å®š StorageClass çš„åç§°ï¼Œå¦‚æœè®¾ç½®äº†é»˜è®¤çš„scï¼Œæ­¤å¤„å¯ä»¥åˆ é™¤è¯¥é…ç½® accessModes: - ReadWriteMany # æŒ‡å®šè®¿é—®æ¨¡å¼ resources: requests: storage: 800Mi # ç”³è¯·çš„å®¹é‡ åˆ›å»º PVC 1234567891011# åˆ›å»º PVC$ k apply -f nfs-pvc.yamlpersistentvolumeclaim/nfs-pvc created# æŸ¥çœ‹ PVå’ŒPVCï¼Œå¯ä»¥çœ‹åˆ° PV è‡ªåŠ¨åˆ›å»ºäº†$ k get pv,pvcNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907 800Mi RWX Delete Bound default/nfs-pvc nfs-csi &lt;unset&gt; 2m4sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/nfs-pvc Bound pvc-c1d33fec-5e16-4156-8405-1af4fc171907 800Mi RWX nfs-csi &lt;unset&gt; 2m4s è‡ªåŠ¨æ‰©å®¹ï¼Œä¿®æ”¹ PVC å®¹é‡åˆ° 1Gi 1234567891011kubectl edit pvc nfs-pvc# ä¿®æ”¹å¦‚ä¸‹# &quot;storage&quot;:&quot;1Gi&quot;# å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° è‡ªåŠ¨æ‰©å®¹æˆåŠŸ$ k get pv,pvcNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907 1Gi RWX Delete Bound default/nfs-pvc nfs-csi &lt;unset&gt; 4m50sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/nfs-pvc Bound pvc-c1d33fec-5e16-4156-8405-1af4fc171907 1Gi RWX nfs-csi &lt;unset&gt; 4m50s åˆ é™¤PVCï¼Œè‡ªåŠ¨åˆ é™¤PV 12345kubectl delete pvc nfs-pvc# å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° PV å·²ç»è¢«è‡ªåŠ¨åˆ é™¤ï¼Œ reclaimPolicy: Delete$ k get pv,pvcNo resources found# æ­¤æ—¶ nfs-server çš„ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨ è®¾ç½®é»˜è®¤çš„ StorageClass ä¸Šé¢æˆ‘ä»¬åˆ›å»º PVC çš„æ—¶å€™éœ€è¦æŒ‡å®š StorageClassï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œé‚£ä¹ˆåœ¨PVCé‡Œå°±å¯ä»¥çœç•¥æ‰ StorageClass çš„è®¾ç½®ã€‚ K8S ä¸­åªèƒ½è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚ è®¾ç½®é»˜è®¤çš„ StorageClass 12345678# ä¸º sc æ·»åŠ  `é»˜è®¤` æ³¨è§£ï¼Œå»æ‰è¯¥æ³¨è§£ æˆ–è€… è®¾ç½®ä¸º false å°±å–æ¶ˆé»˜è®¤äº†ã€‚$ kubectl patch storageclass nfs-csi -p &#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;storageclass.storage.k8s.io/nfs-csi patched# æŸ¥çœ‹scï¼Œæ­¤æ—¶çœ‹åˆ°åç§°åé¢å¤šäº†ä¸€ä¸ª (default) ï¼Œè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ StorageClass$ k get scNAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGEnfs-csi (default) nfs.csi.k8s.io Delete Immediate true 14m StatefulSet: è‡ªåŠ¨åˆ›å»º PVC ä¸Šé¢çš„æ–¹å¼è¿˜æ˜¯è¦æ±‚æˆ‘ä»¬å¿…é¡»åˆ›å»º PVCï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä¸ç”¨åˆ›å»º PVC ï¼Œè€Œæ˜¯åœ¨åˆ›å»ºæ§åˆ¶å™¨çš„æ—¶å€™å°±ä¸€èµ·æŠŠ PVC åˆ›å»ºå¥½å‘¢ï¼Ÿ ç›®å‰åªæœ‰ StatefulSetæ§åˆ¶å™¨ æ‰æ”¯æŒè‡ªåŠ¨åˆ›å»º PVC 123456789101112131415161718192021222324252627282930313233343536373839# redis-statefulset.yamlapiVersion: apps/v1 # æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æºkind: StatefulSet # Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰metadata: name: redis-sts # èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰ namespace: sts-nsspec: # é…ç½®é¡¹ revisionHistoryLimit: 10 # ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚ selector: # é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod matchLabels: # æ ‡ç­¾é€‰æ‹©å™¨ app: redis # é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰ updateStrategy: # æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ · type: RollingUpdate # 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚ # 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚ rollingUpdate: # æ»šåŠ¨å‡çº§çš„é…ç½® partition: 0 # ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§ serviceName: redis-svc # æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹ï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºå¥½ replicas: 2 # å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1 template: # æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½® metadata: labels: app: redis # Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´ spec: containers: - image: redis:6.2 # å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ name: redis # å®¹å™¨çš„åç§° volumeMounts: # æŒ‚è½½æ•°æ®å· - name: redis-data mountPath: /data # Redis æŒä¹…åŒ–æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ volumeClaimTemplates: # é…ç½® PVC æ¨¡æ¿ - metadata: name: redis-data # PVC åç§° spec: accessModes: - ReadWriteMany # è®¿é—®æ¨¡å¼ï¼šå¤šèŠ‚ç‚¹è¯»å†™ resources: requests: storage: 500Mi # è¯·æ±‚çš„å­˜å‚¨å®¹é‡ï¼Œæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ storageClassName: nfs-csi # å­˜å‚¨ç±»åç§°ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤å­˜å‚¨ç±»ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®š åˆ›å»º StatefulSetï¼Œå¹¶æŸ¥çœ‹ PV,PVC 123456789101112# åˆ›å»º StatefulSet$ kubectl apply -f redis-statefulset.yaml# æŸ¥çœ‹ PV,PVC$ k get pv,pvc -n sts-nsNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-1 nfs-csi &lt;unset&gt; 19spersistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-0 nfs-csi &lt;unset&gt; 22sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/redis-data-redis-sts-0 Bound pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX nfs-csi &lt;unset&gt; 22spersistentvolumeclaim/redis-data-redis-sts-1 Bound pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX nfs-csi &lt;unset&gt; 20s StatefulSet çš„ volumeClaimTemplates æ¯ä¸ª Pod å•ç‹¬åˆ›å»º PVCï¼ŒPod å’Œ PVC ä¸€ä¸€å¯¹åº”ï¼Œå³æœ‰å‡ ä¸ªå‰¯æœ¬å°±åˆ›å»ºå‡ ä¸ª PVCã€‚PVC åç§°æ˜¯ï¼š&lt;volumeClaimTemplates.metadata.name&gt;-&lt;statefulset-name&gt;-&lt;pod-ordinal&gt; åˆ é™¤ StatefulSet 123456789101112131415kubectl delete -f redis-statefulset.yaml# æŸ¥çœ‹ PV,PVCï¼Œå‘ç°åˆ é™¤ StatefulSet åï¼ŒPV å’Œ PVC æ˜¯ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ PVC$ k get pv,pvc -n sts-nsNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-1 nfs-csi &lt;unset&gt; 6m30spersistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-0 nfs-csi &lt;unset&gt; 6m33sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/redis-data-redis-sts-0 Bound pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX nfs-csi &lt;unset&gt; 6m33spersistentvolumeclaim/redis-data-redis-sts-1 Bound pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX nfs-csi &lt;unset&gt; 6m31s# æ‰‹åŠ¨åˆ é™¤ PVCï¼Œå› ä¸ºscé…ç½®çš„å›æ”¶ç­–ç•¥ä¸º Deleteï¼Œæ‰€ä»¥ PV ä¹Ÿä¼šè¢«åˆ é™¤k delete pvc -n sts-ns redis-data-redis-sts-0k delete pvc -n sts-ns redis-data-redis-sts-1 å®é™…ä¸Šï¼Œæ— è®ºæ˜¯åˆ é™¤ statefulset è¿˜æ˜¯ç¼©å®¹ statefulsetï¼ŒPVC éƒ½ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s StorageClass å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS","date_published":"2025-07-22T12:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-pv-pvc/","url":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-pv-pvc/","title":"K8S ä¹‹ æŒä¹…å· PV å’Œ PVC","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/\">k8s PV/PVC å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"PV-å’Œ-PVC-ä»‹ç»\">PV å’Œ PVC ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>PV(PersistentVolume) æ˜¯ Kubernetes ä¸­çš„ä¸€ç§å­˜å‚¨èµ„æºï¼Œç”¨äºå°†åº•å±‚çš„ç‰©ç†å­˜å‚¨ï¼ˆå¦‚ NFSã€iSCSIã€Cephã€äº‘å­˜å‚¨ç­‰ï¼‰æŠ½è±¡æˆ Kubernetes èµ„æºï¼Œä¾› Pod ä½¿ç”¨ã€‚å®ƒæ˜¯å¯¹å­˜å‚¨çš„ä¸€ç§â€œå£°æ˜å¼â€ç®¡ç†ï¼Œç±»ä¼¼äº Pod å£°æ˜è®¡ç®—èµ„æºã€‚PV æ˜¯é›†ç¾¤çº§åˆ«çš„å­˜å‚¨èµ„æºï¼Œä¸æ”¯æŒ Namespaceã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>PVC(PersistentVolumeClaim)ï¼ŒæŒä¹…å·å£°æ˜ï¼Œ æ˜¯ Kubernetes ä¸­ç”¨äºç”³è¯·å­˜å‚¨èµ„æºçš„å¯¹è±¡ã€‚PVC æ˜¯ Namespace çº§åˆ«çš„èµ„æºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç®€è€Œè¨€ä¹‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">PV æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œç”±ç®¡ç†å‘˜æå‰é…ç½®æˆ–åŠ¨æ€åˆ›å»ºã€‚</li>\n<li class=\"lvl-4\">PVCï¼ˆPersistentVolumeClaimï¼‰ æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„ç”³è¯·ã€‚</li>\n<li class=\"lvl-4\">Pod é€šè¿‡ PVC ç»‘å®šåˆ° PVï¼Œä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ã€‚</li>\n<li class=\"lvl-4\">å¼€å‘è€…ç”¨ PVC æ¥ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œä¸å…³å¿ƒå­˜å‚¨çš„å…·ä½“å®ç°æ–¹å¼ã€‚</li>\n<li class=\"lvl-4\">PVC é€šè¿‡ Kubernetes è‡ªåŠ¨åŒ¹é…ä¸€ä¸ªåˆé€‚çš„ PersistentVolumeï¼ˆPVï¼‰è¿›è¡Œç»‘å®šã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>PV ä¸ PVC çš„åŸºæœ¬æµç¨‹</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ç®¡ç†å‘˜åˆ›å»º PVï¼ˆæˆ–è€…é›†ç¾¤é€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚</li>\n<li class=\"lvl-4\">ç”¨æˆ·æäº¤ PVCï¼Œå£°æ˜è‡ªå·±éœ€è¦å¤šå°‘å®¹é‡ã€ä»€ä¹ˆè®¿é—®æ¨¡å¼ã€‚</li>\n<li class=\"lvl-4\">Kubernetes æŸ¥æ‰¾å¯ç”¨çš„ PVï¼Œæ¡ä»¶ç¬¦åˆï¼ˆå®¹é‡ã€è®¿é—®æ¨¡å¼ã€StorageClassï¼‰å°±è‡ªåŠ¨ç»‘å®šã€‚</li>\n<li class=\"lvl-4\">Pod æŒ‚è½½ PVCï¼Œå®ç°æŒä¹…åŒ–å­˜å‚¨ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"PV-ç¤ºä¾‹\">PV ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ PV ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pv-nfs.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">pv-nfs-1g</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">volumeMode:</span> <span class=\"string\">Filesystem</span>                 <span class=\"comment\"># å­˜å‚¨å·æ¨¡å¼ï¼Œé»˜è®¤ä¸º Filesystem</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span>                              <span class=\"comment\"># å­˜å‚¨èƒ½åŠ›</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">1Gi</span>                         <span class=\"comment\"># å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span>                           <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span>                      <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">persistentVolumeReclaimPolicy:</span> <span class=\"string\">Retain</span>  <span class=\"comment\"># å›æ”¶ç­–ç•¥</span></span><br><span class=\"line\">  <span class=\"attr\">nfs:</span>                                   <span class=\"comment\"># æŒä¹…å·ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/nfs-server/data/pv-nfs-1g</span>     <span class=\"comment\"># å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨</span></span><br><span class=\"line\">    <span class=\"attr\">server:</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.88</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">pv-nfs-2g</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span>                              <span class=\"comment\"># å­˜å‚¨èƒ½åŠ›</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">2Gi</span>                         <span class=\"comment\"># å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span>                           <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>                      <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">persistentVolumeReclaimPolicy:</span> <span class=\"string\">Retain</span>  <span class=\"comment\"># å›æ”¶ç­–ç•¥</span></span><br><span class=\"line\">  <span class=\"attr\">nfs:</span>                                   <span class=\"comment\"># å­˜å‚¨ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/nfs-server/data/pv-nfs-2g</span>     <span class=\"comment\"># å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨</span></span><br><span class=\"line\">    <span class=\"attr\">server:</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.88</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å­˜å‚¨å·æ¨¡å¼\">å­˜å‚¨å·æ¨¡å¼</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#volume-mode\">å®˜ç½‘æ–‡æ¡£:å­˜å‚¨å·æ¨¡å¼</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Kubernetes æ”¯æŒä¸¤ç§å·æ¨¡å¼ï¼ˆvolumeModesï¼‰ï¼šFilesystemï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ å’Œ Blockï¼ˆå—ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœè¯¥å‚æ•°è¢«çœç•¥ï¼Œé»˜è®¤çš„å·æ¨¡å¼æ˜¯ Filesystemã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>volumeMode å±æ€§è®¾ç½®ä¸º Filesystem çš„å·ä¼šè¢« Pod æŒ‚è½½ï¼ˆMountï¼‰ åˆ°æŸä¸ªç›®å½•ã€‚</p>\n</li>\n</ul>\n<h3 id=\"æŒä¹…å·ç±»å‹\">æŒä¹…å·ç±»å‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes\">å®˜ç½‘æ–‡æ¡£:æŒä¹…å·ç±»å‹</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>âœ… å½“å‰æ”¯æŒçš„æ’ä»¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ’ä»¶ç±»å‹</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>csi</strong></td>\n<td><strong>å®¹å™¨å­˜å‚¨æ¥å£ï¼ˆCSIï¼‰</strong>ï¼Œæ¨èçš„ç°ä»£å­˜å‚¨æ¥å£</td>\n</tr>\n<tr>\n<td><strong>fc</strong></td>\n<td>Fibre Channel å­˜å‚¨</td>\n</tr>\n<tr>\n<td><strong>hostPath</strong></td>\n<td>HostPath å·ï¼ˆä»…ä¾›å•èŠ‚ç‚¹æµ‹è¯•ä½¿ç”¨ï¼›å¤šèŠ‚ç‚¹ä¸æ¨èï¼Œæ¨èä½¿ç”¨ local å·æ›¿ä»£ï¼‰</td>\n</tr>\n<tr>\n<td><strong>iscsi</strong></td>\n<td>iSCSIï¼ˆåŸºäº IP çš„ SCSI å­˜å‚¨ï¼‰</td>\n</tr>\n<tr>\n<td><strong>local</strong></td>\n<td>èŠ‚ç‚¹æœ¬åœ°å­˜å‚¨è®¾å¤‡</td>\n</tr>\n<tr>\n<td><strong>nfs</strong></td>\n<td>ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰å­˜å‚¨</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âš ï¸ å·²å¼ƒç”¨ä½†ä»å¯ç”¨ï¼ˆéœ€ CSI è¿ç§»ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ’ä»¶ç±»å‹</th>\n<th>æè¿°</th>\n<th>CSI è¿ç§»çŠ¶æ€</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>awsElasticBlockStore</strong></td>\n<td>AWS EBS å—å­˜å‚¨</td>\n<td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>azureDisk</strong></td>\n<td>Azure ç£ç›˜å­˜å‚¨</td>\n<td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>azureFile</strong></td>\n<td>Azure æ–‡ä»¶å­˜å‚¨</td>\n<td>ä» v1.24 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>cinder</strong></td>\n<td>OpenStack å—å­˜å‚¨</td>\n<td>ä» v1.21 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>flexVolume</strong></td>\n<td>FlexVolumeï¼ˆæ— è¿ç§»è®¡åˆ’ï¼Œä½†æœªè®¡åˆ’ç§»é™¤ï¼‰</td>\n<td>ä» v1.23 å¼€å§‹å¼ƒç”¨</td>\n</tr>\n<tr>\n<td><strong>gcePersistentDisk</strong></td>\n<td>GCP æŒä¹…ç£ç›˜</td>\n<td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>portworxVolume</strong></td>\n<td>Portworx å­˜å‚¨å·</td>\n<td>ä» v1.31 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>vsphereVolume</strong></td>\n<td>vSphere VMDK å·</td>\n<td>ä» v1.25 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âŒ å·²åºŸå¼ƒ/å³å°†ç§»é™¤çš„ In-Tree æ’ä»¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ’ä»¶ç±»å‹</th>\n<th>æè¿°</th>\n<th>å¼ƒç”¨/ç§»é™¤ç‰ˆæœ¬</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>cephfs</strong></td>\n<td>Ceph æ–‡ä»¶ç³»ç»Ÿå·</td>\n<td>v1.31 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>flocker</strong></td>\n<td>Flocker å­˜å‚¨</td>\n<td>v1.25 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>glusterfs</strong></td>\n<td>GlusterFS å­˜å‚¨</td>\n<td>v1.26 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>photonPersistentDisk</strong></td>\n<td>Photon æŒä¹…ç£ç›˜</td>\n<td>v1.15 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>quobyte</strong></td>\n<td>Quobyte å·</td>\n<td>v1.25 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>rbd</strong></td>\n<td>Rados å—è®¾å¤‡ï¼ˆCeph RBDï¼‰</td>\n<td>v1.31 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>scaleIO</strong></td>\n<td>ScaleIO å·</td>\n<td>v1.21 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>storageos</strong></td>\n<td>StorageOS å·</td>\n<td>v1.25 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"accessModes-è®¿é—®æ¨¡å¼\">accessModes è®¿é—®æ¨¡å¼</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#access-modes\">å®˜ç½‘æ–‡æ¡£:è®¿é—®æ¨¡å¼</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>è®¿é—®æ¨¡å¼</th>\n<th>è¯´æ˜</th>\n<th>æ˜¯å¦è·¨èŠ‚ç‚¹æŒ‚è½½</th>\n<th>æ˜¯å¦æ”¯æŒå¤š Pod æŒ‚è½½</th>\n<th>æ˜¯å¦æ”¯æŒè¯»å†™</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ReadWriteOnce (RWO)</strong></td>\n<td>å·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼ŒåŒä¸€èŠ‚ç‚¹å†…å¤šä¸ª Pod å¯å…±äº«ä½¿ç”¨ã€‚</td>\n<td>âŒ å¦</td>\n<td>âœ… æ˜¯ï¼ˆåŒä¸€èŠ‚ç‚¹ï¼‰</td>\n<td>âœ… æ˜¯</td>\n</tr>\n<tr>\n<td><strong>ReadOnlyMany (ROX)</strong></td>\n<td>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æŒ‚è½½ã€‚</td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n<td>âŒ å¦ï¼ˆåªè¯»ï¼‰</td>\n</tr>\n<tr>\n<td><strong>ReadWriteMany (RWX)</strong></td>\n<td>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ã€‚</td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n</tr>\n<tr>\n<td><strong>ReadWriteOncePod (RWOP)</strong></td>\n<td>å·åªèƒ½è¢«å•ä¸ª Pod ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼Œç¡®ä¿é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª Pod ä½¿ç”¨è¯¥å·ï¼ˆv1.29+ç¨³å®šï¼‰ã€‚</td>\n<td>âŒ å¦</td>\n<td>âŒ å¦ï¼ˆåªèƒ½ä¸€ä¸ª Podï¼‰</td>\n<td>âœ… æ˜¯</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>NFS æ”¯æŒå‰ä¸‰ç§è®¿é—®æ¨¡å¼ï¼ŒhostPath åªæ”¯æŒ ReadWriteOnceã€‚</p>\n</li>\n</ul>\n<h3 id=\"persistentVolumeReclaimPolicy-å›æ”¶ç­–ç•¥\">persistentVolumeReclaimPolicy å›æ”¶ç­–ç•¥</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy\">å®˜æ–¹æ–‡æ¡£:å›æ”¶ç­–ç•¥</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å›æ”¶ç­–ç•¥</th>\n<th>å«ä¹‰</th>\n<th>å›æ”¶è¡Œä¸º</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Retain</strong></td>\n<td><strong>ä¿ç•™</strong>ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨ä»ç„¶ä¿ç•™</td>\n<td>æ‰‹åŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤å PV çŠ¶æ€ä¸º <code>Released</code>ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†æˆ–é‡æ–°ç»‘å®š</td>\n<td>é‡è¦æ•°æ®ï¼Œé¿å…è¯¯åˆ ï¼›å¦‚æ•°æ®åº“æ•°æ®ç›˜</td>\n</tr>\n<tr>\n<td><strong>Delete</strong></td>\n<td><strong>åˆ é™¤</strong>ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨éƒ½ä¼šè¢«åˆ é™¤</td>\n<td>è‡ªåŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤æ—¶è‡ªåŠ¨åˆ é™¤ PV å’Œåç«¯å­˜å‚¨èµ„æºï¼ˆå¦‚äº‘ç›˜ï¼‰</td>\n<td>ä¸´æ—¶æ•°æ®ã€ä¸é‡è¦çš„å­˜å‚¨</td>\n</tr>\n<tr>\n<td><strong>Recycle</strong></td>\n<td><strong>å›æ”¶</strong>ï¼šç®€å•æ¸…ç©ºæ•°æ®</td>\n<td>è‡ªåŠ¨æ‰§è¡Œ <code>rm -rf /thevolume/*</code>ï¼Œç„¶å PV å˜å› <code>Available</code> çŠ¶æ€</td>\n<td>æ—§ç‰ˆæœ¬é›†ç¾¤çš„å°æ–‡ä»¶ä¸´æ—¶å­˜å‚¨</td>\n</tr>\n</tbody>\n</table>\n<div class=\"warning\">\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p><strong>æ³¨æ„</strong>: åˆ›å»º <strong>Recycle</strong> çš„ PV æ—¶ï¼Œä¼šæç¤ºå¦‚ä¸‹å†…å®¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Warning: spec.persistentVolumeReclaimPolicy: The Recycle reclaim policy is deprecated. Instead, the recommended approach is to use dynamic provisioning.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>æ„æ€å°±æ˜¯ <strong>Recycle</strong> ç­–ç•¥å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨<code>åŠ¨æ€ä¾›åº”æ¨¡å¼</code>ã€‚ä½†<a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy\">å®˜æ–¹æ–‡æ¡£</a>ä¸­å´æç¤º <code>å¯¹äº Kubernetes 1.33 æ¥è¯´ï¼Œåªæœ‰ nfs å’Œ hostPath å·ç±»å‹æ”¯æŒå›æ”¶ï¼ˆRecycleï¼‰ã€‚</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬äººåœ¨ Kubernetes 1.33.2 ä¸­æµ‹è¯•ï¼ŒNFS æ”¯æŒ Recycleï¼Œåˆ é™¤ PVC å PV çŠ¶æ€ä¼šå˜ä¸º <strong>Available</strong></p>\n</li>\n</ul>\n</div>\n<h3 id=\"ç®¡ç†-PV\">ç®¡ç† PV</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º</span></span><br><span class=\"line\">kubectl create -f pv-nfs.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹</span></span><br><span class=\"line\">$ k get pv</span><br><span class=\"line\">NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">pv-nfs-1g   1Gi        RWO            Retain           Available                          &lt;<span class=\"built_in\">unset</span>&gt;                          80s</span><br><span class=\"line\">pv-nfs-2g   2Gi        RWX            Retain           Available                          &lt;<span class=\"built_in\">unset</span>&gt;                          80s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤</span></span><br><span class=\"line\">kubectl delete pv pv-nfs-1g</span><br><span class=\"line\">k delete -f pv-nfs.yaml</span><br></pre></td></tr></table></figure>\n<h2 id=\"PVC-ç¤ºä¾‹\">PVC ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod é€šè¿‡ PVC å‘ PV ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœ PVC ä¸€ç›´æ— æ³•åŒ¹é…åˆ° PVï¼Œåˆ™ PVC å¤„äº Pending çŠ¶æ€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Pod å¿…é¡»ä¸ PVC å¤„äºåŒä¸€å‘½åç©ºé—´ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>PVC ä¸ PV æ˜¯ 1:1 çš„å…³ç³»ã€‚ä¸€æ—¦ PV ç»‘å®šåˆ° PVCï¼Œåˆ™ PVC çŠ¶æ€å˜ä¸º Boundã€‚è¯¥ PV å°†ä¸å†è¢«å…¶ä»– PVC ç»‘å®šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>PVC ä¸ PV åŒ¹é…çš„æ¡ä»¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŒ¹é…æ¡ä»¶</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å®¹é‡</strong></td>\n<td><strong>PVC è¯·æ±‚çš„å®¹é‡ â‰¤ PV æä¾›çš„å®¹é‡</strong>ã€‚PV å¿…é¡»è‡³å°‘æ»¡è¶³ PVC çš„å®¹é‡è¯·æ±‚ã€‚</td>\n</tr>\n<tr>\n<td><strong>è®¿é—®æ¨¡å¼</strong></td>\n<td><strong>PV æ”¯æŒ PVC è¯·æ±‚çš„è®¿é—®æ¨¡å¼</strong>ã€‚PVC è¦æ±‚çš„æ‰€æœ‰è®¿é—®æ¨¡å¼ï¼ŒPV éƒ½å¿…é¡»å…·å¤‡ã€‚ä¾‹å¦‚ï¼šPVC è¦æ±‚ <code>ReadWriteOnce</code>ï¼ŒPV è‡³å°‘è¦æ”¯æŒ <code>ReadWriteOnce</code>ã€‚</td>\n</tr>\n<tr>\n<td><strong>StorageClass</strong></td>\n<td><strong>PVC å’Œ PV çš„ <code>storageClassName</code> å¿…é¡»ä¸€è‡´</strong>ã€‚å¦‚æœ PVC æŒ‡å®šäº† <code>storageClassName</code>ï¼Œåªèƒ½ç»‘å®šåŒåçš„ PVã€‚</td>\n</tr>\n<tr>\n<td><strong>Selectorï¼ˆå¯é€‰ï¼‰</strong></td>\n<td>å¦‚æœ PVC æœ‰è®¾ç½® <code>selector</code>ï¼ˆåŸºäºæ ‡ç­¾ï¼‰ï¼ŒPV çš„æ ‡ç­¾ä¹Ÿå¿…é¡»åŒ¹é…ã€‚</td>\n</tr>\n</tbody>\n</table>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">PV ä¸­å£°æ˜çš„ <code>accessModes</code> ä»…ä½œä¸ºä¸ PVC çš„è®¿é—®æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå®é™…æŒ‚è½½åˆ° Pod åï¼Œä¸ä¼šé™åˆ¶ Pod çš„è¯»å†™è®¿é—®</li>\n</ul>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªç®€å•çš„ yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pvc.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">mypvc</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>   <span class=\"comment\"># ç”³è¯·åŒ¹é…çš„è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">500Mi</span>  <span class=\"comment\"># ç”³è¯·çš„å®¹é‡ï¼Œå®é™…å®¹é‡ä»¥åŒ¹é…çš„ PV ä¸ºå‡†</span></span><br><span class=\"line\">  <span class=\"comment\"># selector:         # åŒ¹é…çš„ PV æ ‡ç­¾</span></span><br><span class=\"line\">  <span class=\"comment\">#   matchLabels:</span></span><br><span class=\"line\">  <span class=\"comment\">#     pv: nfs-pv1   # pv çš„æ ‡ç­¾ï¼Œåˆ›å»º pv æ—¶è¦æŒ‡å®š</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ç®¡ç†-PVC\">ç®¡ç† PVC</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º PVC</span></span><br><span class=\"line\">kubectl apply -f pvc.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹PVCï¼Œæ­¤æ—¶çœ‹åˆ° pv-nfs-1g ç»‘å®šäº† PVC</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">NAME                         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pv-nfs-1g   1Gi        RWO            Retain           Available                                  &lt;<span class=\"built_in\">unset</span>&gt;                          16s</span><br><span class=\"line\">persistentvolume/pv-nfs-2g   2Gi        RWX            Retain           Bound       default/mypvc                  &lt;<span class=\"built_in\">unset</span>&gt;                          16s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                          STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/mypvc   Bound    pv-nfs-2g   2Gi        RWX                           &lt;<span class=\"built_in\">unset</span>&gt;                 9s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ PVC</span></span><br><span class=\"line\">kubectl delete pvc mypvc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶å†æ¬¡æŸ¥çœ‹ PVï¼Œpv-nfs-1g çŠ¶æ€å˜æ›´ä¸º Releasedï¼Œè¡¨ç¤ºå·²ç»é‡Šæ”¾ï¼Œä½†æ˜¯ä¸èƒ½å†è¢«å…¶å®ƒ PVC ç»‘å®šäº†ï¼Œåªèƒ½åˆ é™¤é‡å»ºäº†</span></span><br><span class=\"line\">$ k get pv</span><br><span class=\"line\">NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">pv-nfs-1g   1Gi        RWO            Retain           Available                                              &lt;<span class=\"built_in\">unset</span>&gt;                          18m</span><br><span class=\"line\">pv-nfs-2g   2Gi        RWX            Retain           Released     default/mypvc                             &lt;<span class=\"built_in\">unset</span>&gt;                          18m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ PV</span></span><br><span class=\"line\">k delete pv pv-nfs-1g</span><br></pre></td></tr></table></figure>\n<h2 id=\"Pod-ç»‘å®š-PVC\">Pod ç»‘å®š PVC</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä»¥ nginx deployment ä¸ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nginx-pvc-deployment.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx-pvc-deployment</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span>                              <span class=\"comment\"># 3ä¸ª podä¼šå…±äº«ä¸€ä¸ª PVC</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nginx-pvc</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">nginx-pvc</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx-storage</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/usr/share/nginx/html</span>  <span class=\"comment\"># æŒ‚è½½åˆ° nginx çš„é»˜è®¤ç½‘é¡µç›®å½•</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx-storage</span></span><br><span class=\"line\">        <span class=\"attr\">persistentVolumeClaim:</span>              <span class=\"comment\"># æŒ‡å®šå­˜å‚¨å·ç±»å‹æ˜¯ PVC</span></span><br><span class=\"line\">          <span class=\"attr\">claimName:</span> <span class=\"string\">mypvc</span>                  <span class=\"comment\"># å¯¹åº”ä½ åˆ›å»ºçš„ PVC åç§°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ª PVC å¯¹åº”ä¸€ä¸ª PVï¼Œä½†æ˜¯ä¸€ä¸ª PVC å¯ä»¥å¯¹åº”å¤šä¸ª Deployment ç­‰æ§åˆ¶å™¨ã€‚ä¸‹é¢æˆ‘ä»¬å°±å†åˆ›å»ºä¸€ä¸ª Deploymentï¼Œå°† ç›¸åŒçš„ PVC æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œå¹¶ä¸”æ¯éš”5ç§’ä¿®æ”¹ä¸€æ¬¡ PVC æŒ‚è½½çš„ç½‘é¡µï¼Œå¹¶é€šè¿‡ nginx å®¹å™¨æŸ¥çœ‹ç»“æœ</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># busybox-deployment.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">busybox-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;while true; do echo $(date) &gt; /data/index.html; sleep 5; done&quot;</span>]</span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-volume</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/data</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-volume</span></span><br><span class=\"line\">        <span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">          <span class=\"attr\">claimName:</span> <span class=\"string\">mypvc</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåæŸ¥çœ‹ pod ip</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get pod -o wide</span><br><span class=\"line\">NAME                                    READY   STATUS    RESTARTS   AGE     IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">busybox-deployment-d7589665d-dx2rs      1/1     Running   0          2m59s   10.244.126.6     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">nginx-pvc-deployment-775b8c4f8b-89cw7   1/1     Running   0          44s     10.244.126.8     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">nginx-pvc-deployment-775b8c4f8b-fszlf   1/1     Running   0          44s     10.244.194.123   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">nginx-pvc-deployment-775b8c4f8b-w9qkt   1/1     Running   0          44s     10.244.126.7     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®ä»»æ„ä¸€ä¸ª nginx pod</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶ä¼šçœ‹åˆ°é¡µé¢å†…å®¹åœ¨å˜åŒ–</span></span><br><span class=\"line\">watch -n 5 curl 10.244.194.123</span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸º pod ç»‘å®š pvcæ—¶ï¼Œæ¯æ¬¡éƒ½è¦å…ˆåˆ›å»º pv å’Œ pvcï¼Œéå¸¸éº»çƒ¦ã€‚æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ</p>\n<blockquote>\n<p>ä½¿ç”¨ StorageClass å®ç°è‡ªåŠ¨åˆ›å»º PVï¼Œæˆ‘ä»¬ä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•å®ç°ã€‚</p>\n</blockquote>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœ PVC è¢« Pod ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PVC å—ï¼Ÿ</p>\n<blockquote>\n<p>ä¸å¯ä»¥ï¼ŒPVC è¢« Pod ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… Pod åˆ é™¤åæ‰èƒ½åˆ é™¤ PVCã€‚<br>\nè‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PVC å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PVC çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PVC çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“å­˜Podå¯¹å‚¨å·çš„ä½¿ç”¨ã€‚<br>\næ­¤æ—¶ä¸€æ—¦Pod åˆ é™¤ï¼ŒPVC å°±ä¼šè¢«åˆ é™¤ã€‚</p>\n</blockquote>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœPV è¢« PVC ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PV å—ï¼Ÿ</p>\n<blockquote>\n<p>ä¸å¯ä»¥ï¼ŒPV è¢« PVC ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… PVC åˆ é™¤åæ‰èƒ½åˆ é™¤ PVã€‚<br>\nè‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PV å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PV çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PV çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“Podå¯¹å­˜å‚¨å·çš„ä½¿ç”¨ã€‚<br>\næ­¤æ—¶ä¸€æ—¦ PVC åˆ é™¤ï¼ŒPV å°±ä¼šè¢«åˆ é™¤ã€‚</p>\n</blockquote>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s PV/PVC å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS PV å’Œ PVC ä»‹ç» PV(PersistentVolume) æ˜¯ Kubernetes ä¸­çš„ä¸€ç§å­˜å‚¨èµ„æºï¼Œç”¨äºå°†åº•å±‚çš„ç‰©ç†å­˜å‚¨ï¼ˆå¦‚ NFSã€iSCSIã€Cephã€äº‘å­˜å‚¨ç­‰ï¼‰æŠ½è±¡æˆ Kubernetes èµ„æºï¼Œä¾› Pod ä½¿ç”¨ã€‚å®ƒæ˜¯å¯¹å­˜å‚¨çš„ä¸€ç§â€œå£°æ˜å¼â€ç®¡ç†ï¼Œç±»ä¼¼äº Pod å£°æ˜è®¡ç®—èµ„æºã€‚PV æ˜¯é›†ç¾¤çº§åˆ«çš„å­˜å‚¨èµ„æºï¼Œä¸æ”¯æŒ Namespaceã€‚ PVC(PersistentVolumeClaim)ï¼ŒæŒä¹…å·å£°æ˜ï¼Œ æ˜¯ Kubernetes ä¸­ç”¨äºç”³è¯·å­˜å‚¨èµ„æºçš„å¯¹è±¡ã€‚PVC æ˜¯ Namespace çº§åˆ«çš„èµ„æºã€‚ ç®€è€Œè¨€ä¹‹ï¼š PV æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œç”±ç®¡ç†å‘˜æå‰é…ç½®æˆ–åŠ¨æ€åˆ›å»ºã€‚ PVCï¼ˆPersistentVolumeClaimï¼‰ æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„ç”³è¯·ã€‚ Pod é€šè¿‡ PVC ç»‘å®šåˆ° PVï¼Œä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ã€‚ å¼€å‘è€…ç”¨ PVC æ¥ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œä¸å…³å¿ƒå­˜å‚¨çš„å…·ä½“å®ç°æ–¹å¼ã€‚ PVC é€šè¿‡ Kubernetes è‡ªåŠ¨åŒ¹é…ä¸€ä¸ªåˆé€‚çš„ PersistentVolumeï¼ˆPVï¼‰è¿›è¡Œç»‘å®šã€‚ PV ä¸ PVC çš„åŸºæœ¬æµç¨‹ ç®¡ç†å‘˜åˆ›å»º PVï¼ˆæˆ–è€…é›†ç¾¤é€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚ ç”¨æˆ·æäº¤ PVCï¼Œå£°æ˜è‡ªå·±éœ€è¦å¤šå°‘å®¹é‡ã€ä»€ä¹ˆè®¿é—®æ¨¡å¼ã€‚ Kubernetes æŸ¥æ‰¾å¯ç”¨çš„ PVï¼Œæ¡ä»¶ç¬¦åˆï¼ˆå®¹é‡ã€è®¿é—®æ¨¡å¼ã€StorageClassï¼‰å°±è‡ªåŠ¨ç»‘å®šã€‚ Pod æŒ‚è½½ PVCï¼Œå®ç°æŒä¹…åŒ–å­˜å‚¨ã€‚ PV ç¤ºä¾‹ ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ PV ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829# pv-nfs.yamlapiVersion: v1kind: PersistentVolumemetadata: name: pv-nfs-1gspec: volumeMode: Filesystem # å­˜å‚¨å·æ¨¡å¼ï¼Œé»˜è®¤ä¸º Filesystem capacity: # å­˜å‚¨èƒ½åŠ› storage: 1Gi # å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi accessModes: # è®¿é—®æ¨¡å¼ - ReadWriteOnce # è®¿é—®æ¨¡å¼ persistentVolumeReclaimPolicy: Retain # å›æ”¶ç­–ç•¥ nfs: # æŒä¹…å·ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰ path: /nfs-server/data/pv-nfs-1g # å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨ server: 10.211.55.88---apiVersion: v1kind: PersistentVolumemetadata: name: pv-nfs-2gspec: capacity: # å­˜å‚¨èƒ½åŠ› storage: 2Gi # å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi accessModes: # è®¿é—®æ¨¡å¼ - ReadWriteMany # è®¿é—®æ¨¡å¼ persistentVolumeReclaimPolicy: Retain # å›æ”¶ç­–ç•¥ nfs: # å­˜å‚¨ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰ path: /nfs-server/data/pv-nfs-2g # å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨ server: 10.211.55.88 å­˜å‚¨å·æ¨¡å¼ å®˜ç½‘æ–‡æ¡£:å­˜å‚¨å·æ¨¡å¼ Kubernetes æ”¯æŒä¸¤ç§å·æ¨¡å¼ï¼ˆvolumeModesï¼‰ï¼šFilesystemï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ å’Œ Blockï¼ˆå—ï¼‰ã€‚ å¦‚æœè¯¥å‚æ•°è¢«çœç•¥ï¼Œé»˜è®¤çš„å·æ¨¡å¼æ˜¯ Filesystemã€‚ volumeMode å±æ€§è®¾ç½®ä¸º Filesystem çš„å·ä¼šè¢« Pod æŒ‚è½½ï¼ˆMountï¼‰ åˆ°æŸä¸ªç›®å½•ã€‚ æŒä¹…å·ç±»å‹ å®˜ç½‘æ–‡æ¡£:æŒä¹…å·ç±»å‹ âœ… å½“å‰æ”¯æŒçš„æ’ä»¶ æ’ä»¶ç±»å‹ æè¿° csi å®¹å™¨å­˜å‚¨æ¥å£ï¼ˆCSIï¼‰ï¼Œæ¨èçš„ç°ä»£å­˜å‚¨æ¥å£ fc Fibre Channel å­˜å‚¨ hostPath HostPath å·ï¼ˆä»…ä¾›å•èŠ‚ç‚¹æµ‹è¯•ä½¿ç”¨ï¼›å¤šèŠ‚ç‚¹ä¸æ¨èï¼Œæ¨èä½¿ç”¨ local å·æ›¿ä»£ï¼‰ iscsi iSCSIï¼ˆåŸºäº IP çš„ SCSI å­˜å‚¨ï¼‰ local èŠ‚ç‚¹æœ¬åœ°å­˜å‚¨è®¾å¤‡ nfs ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰å­˜å‚¨ âš ï¸ å·²å¼ƒç”¨ä½†ä»å¯ç”¨ï¼ˆéœ€ CSI è¿ç§»ï¼‰ æ’ä»¶ç±»å‹ æè¿° CSI è¿ç§»çŠ¶æ€ awsElasticBlockStore AWS EBS å—å­˜å‚¨ ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§» azureDisk Azure ç£ç›˜å­˜å‚¨ ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§» azureFile Azure æ–‡ä»¶å­˜å‚¨ ä» v1.24 å¼€å§‹é»˜è®¤è¿ç§» cinder OpenStack å—å­˜å‚¨ ä» v1.21 å¼€å§‹é»˜è®¤è¿ç§» flexVolume FlexVolumeï¼ˆæ— è¿ç§»è®¡åˆ’ï¼Œä½†æœªè®¡åˆ’ç§»é™¤ï¼‰ ä» v1.23 å¼€å§‹å¼ƒç”¨ gcePersistentDisk GCP æŒä¹…ç£ç›˜ ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§» portworxVolume Portworx å­˜å‚¨å· ä» v1.31 å¼€å§‹é»˜è®¤è¿ç§» vsphereVolume vSphere VMDK å· ä» v1.25 å¼€å§‹é»˜è®¤è¿ç§» âŒ å·²åºŸå¼ƒ/å³å°†ç§»é™¤çš„ In-Tree æ’ä»¶ æ’ä»¶ç±»å‹ æè¿° å¼ƒç”¨/ç§»é™¤ç‰ˆæœ¬ cephfs Ceph æ–‡ä»¶ç³»ç»Ÿå· v1.31 ä¹‹åä¸å¯ç”¨ flocker Flocker å­˜å‚¨ v1.25 ä¹‹åä¸å¯ç”¨ glusterfs GlusterFS å­˜å‚¨ v1.26 ä¹‹åä¸å¯ç”¨ photonPersistentDisk Photon æŒä¹…ç£ç›˜ v1.15 ä¹‹åä¸å¯ç”¨ quobyte Quobyte å· v1.25 ä¹‹åä¸å¯ç”¨ rbd Rados å—è®¾å¤‡ï¼ˆCeph RBDï¼‰ v1.31 ä¹‹åä¸å¯ç”¨ scaleIO ScaleIO å· v1.21 ä¹‹åä¸å¯ç”¨ storageos StorageOS å· v1.25 ä¹‹åä¸å¯ç”¨ accessModes è®¿é—®æ¨¡å¼ å®˜ç½‘æ–‡æ¡£:è®¿é—®æ¨¡å¼ è®¿é—®æ¨¡å¼ è¯´æ˜ æ˜¯å¦è·¨èŠ‚ç‚¹æŒ‚è½½ æ˜¯å¦æ”¯æŒå¤š Pod æŒ‚è½½ æ˜¯å¦æ”¯æŒè¯»å†™ ReadWriteOnce (RWO) å·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼ŒåŒä¸€èŠ‚ç‚¹å†…å¤šä¸ª Pod å¯å…±äº«ä½¿ç”¨ã€‚ âŒ å¦ âœ… æ˜¯ï¼ˆåŒä¸€èŠ‚ç‚¹ï¼‰ âœ… æ˜¯ ReadOnlyMany (ROX) å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æŒ‚è½½ã€‚ âœ… æ˜¯ âœ… æ˜¯ âŒ å¦ï¼ˆåªè¯»ï¼‰ ReadWriteMany (RWX) å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ã€‚ âœ… æ˜¯ âœ… æ˜¯ âœ… æ˜¯ ReadWriteOncePod (RWOP) å·åªèƒ½è¢«å•ä¸ª Pod ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼Œç¡®ä¿é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª Pod ä½¿ç”¨è¯¥å·ï¼ˆv1.29+ç¨³å®šï¼‰ã€‚ âŒ å¦ âŒ å¦ï¼ˆåªèƒ½ä¸€ä¸ª Podï¼‰ âœ… æ˜¯ NFS æ”¯æŒå‰ä¸‰ç§è®¿é—®æ¨¡å¼ï¼ŒhostPath åªæ”¯æŒ ReadWriteOnceã€‚ persistentVolumeReclaimPolicy å›æ”¶ç­–ç•¥ å®˜æ–¹æ–‡æ¡£:å›æ”¶ç­–ç•¥ å›æ”¶ç­–ç•¥ å«ä¹‰ å›æ”¶è¡Œä¸º å…¸å‹ä½¿ç”¨åœºæ™¯ Retain ä¿ç•™ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨ä»ç„¶ä¿ç•™ æ‰‹åŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤å PV çŠ¶æ€ä¸º Releasedï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†æˆ–é‡æ–°ç»‘å®š é‡è¦æ•°æ®ï¼Œé¿å…è¯¯åˆ ï¼›å¦‚æ•°æ®åº“æ•°æ®ç›˜ Delete åˆ é™¤ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨éƒ½ä¼šè¢«åˆ é™¤ è‡ªåŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤æ—¶è‡ªåŠ¨åˆ é™¤ PV å’Œåç«¯å­˜å‚¨èµ„æºï¼ˆå¦‚äº‘ç›˜ï¼‰ ä¸´æ—¶æ•°æ®ã€ä¸é‡è¦çš„å­˜å‚¨ Recycle å›æ”¶ï¼šç®€å•æ¸…ç©ºæ•°æ® è‡ªåŠ¨æ‰§è¡Œ rm -rf /thevolume/*ï¼Œç„¶å PV å˜å› Available çŠ¶æ€ æ—§ç‰ˆæœ¬é›†ç¾¤çš„å°æ–‡ä»¶ä¸´æ—¶å­˜å‚¨ æ³¨æ„: åˆ›å»º Recycle çš„ PV æ—¶ï¼Œä¼šæç¤ºå¦‚ä¸‹å†…å®¹ 1Warning: spec.persistentVolumeReclaimPolicy: The Recycle reclaim policy is deprecated. Instead, the recommended approach is to use dynamic provisioning. æ„æ€å°±æ˜¯ Recycle ç­–ç•¥å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨åŠ¨æ€ä¾›åº”æ¨¡å¼ã€‚ä½†å®˜æ–¹æ–‡æ¡£ä¸­å´æç¤º å¯¹äº Kubernetes 1.33 æ¥è¯´ï¼Œåªæœ‰ nfs å’Œ hostPath å·ç±»å‹æ”¯æŒå›æ”¶ï¼ˆRecycleï¼‰ã€‚ æœ¬äººåœ¨ Kubernetes 1.33.2 ä¸­æµ‹è¯•ï¼ŒNFS æ”¯æŒ Recycleï¼Œåˆ é™¤ PVC å PV çŠ¶æ€ä¼šå˜ä¸º Available ç®¡ç† PV 123456789101112# åˆ›å»ºkubectl create -f pv-nfs.yaml# æŸ¥çœ‹$ k get pvNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpv-nfs-1g 1Gi RWO Retain Available &lt;unset&gt; 80spv-nfs-2g 2Gi RWX Retain Available &lt;unset&gt; 80s# åˆ é™¤kubectl delete pv pv-nfs-1gk delete -f pv-nfs.yaml PVC ç¤ºä¾‹ Pod é€šè¿‡ PVC å‘ PV ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœ PVC ä¸€ç›´æ— æ³•åŒ¹é…åˆ° PVï¼Œåˆ™ PVC å¤„äº Pending çŠ¶æ€ã€‚ Pod å¿…é¡»ä¸ PVC å¤„äºåŒä¸€å‘½åç©ºé—´ã€‚ PVC ä¸ PV æ˜¯ 1:1 çš„å…³ç³»ã€‚ä¸€æ—¦ PV ç»‘å®šåˆ° PVCï¼Œåˆ™ PVC çŠ¶æ€å˜ä¸º Boundã€‚è¯¥ PV å°†ä¸å†è¢«å…¶ä»– PVC ç»‘å®šã€‚ PVC ä¸ PV åŒ¹é…çš„æ¡ä»¶ åŒ¹é…æ¡ä»¶ è¯´æ˜ å®¹é‡ PVC è¯·æ±‚çš„å®¹é‡ â‰¤ PV æä¾›çš„å®¹é‡ã€‚PV å¿…é¡»è‡³å°‘æ»¡è¶³ PVC çš„å®¹é‡è¯·æ±‚ã€‚ è®¿é—®æ¨¡å¼ PV æ”¯æŒ PVC è¯·æ±‚çš„è®¿é—®æ¨¡å¼ã€‚PVC è¦æ±‚çš„æ‰€æœ‰è®¿é—®æ¨¡å¼ï¼ŒPV éƒ½å¿…é¡»å…·å¤‡ã€‚ä¾‹å¦‚ï¼šPVC è¦æ±‚ ReadWriteOnceï¼ŒPV è‡³å°‘è¦æ”¯æŒ ReadWriteOnceã€‚ StorageClass PVC å’Œ PV çš„ storageClassName å¿…é¡»ä¸€è‡´ã€‚å¦‚æœ PVC æŒ‡å®šäº† storageClassNameï¼Œåªèƒ½ç»‘å®šåŒåçš„ PVã€‚ Selectorï¼ˆå¯é€‰ï¼‰ å¦‚æœ PVC æœ‰è®¾ç½® selectorï¼ˆåŸºäºæ ‡ç­¾ï¼‰ï¼ŒPV çš„æ ‡ç­¾ä¹Ÿå¿…é¡»åŒ¹é…ã€‚ å°è´´å£« PV ä¸­å£°æ˜çš„ accessModes ä»…ä½œä¸ºä¸ PVC çš„è®¿é—®æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå®é™…æŒ‚è½½åˆ° Pod åï¼Œä¸ä¼šé™åˆ¶ Pod çš„è¯»å†™è®¿é—® ä¸€ä¸ªç®€å•çš„ yaml 123456789101112131415# pvc.yamlapiVersion: v1kind: PersistentVolumeClaimmetadata: name: mypvc namespace: defaultspec: accessModes: - ReadWriteMany # ç”³è¯·åŒ¹é…çš„è®¿é—®æ¨¡å¼ resources: requests: storage: 500Mi # ç”³è¯·çš„å®¹é‡ï¼Œå®é™…å®¹é‡ä»¥åŒ¹é…çš„ PV ä¸ºå‡† # selector: # åŒ¹é…çš„ PV æ ‡ç­¾ # matchLabels: # pv: nfs-pv1 # pv çš„æ ‡ç­¾ï¼Œåˆ›å»º pv æ—¶è¦æŒ‡å®š ç®¡ç† PVC 1234567891011121314151617181920212223# åˆ›å»º PVCkubectl apply -f pvc.yaml# æŸ¥çœ‹PVCï¼Œæ­¤æ—¶çœ‹åˆ° pv-nfs-1g ç»‘å®šäº† PVC$ k get pv,pvcNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pv-nfs-1g 1Gi RWO Retain Available &lt;unset&gt; 16spersistentvolume/pv-nfs-2g 2Gi RWX Retain Bound default/mypvc &lt;unset&gt; 16sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/mypvc Bound pv-nfs-2g 2Gi RWX &lt;unset&gt; 9s# åˆ é™¤ PVCkubectl delete pvc mypvc# æ­¤æ—¶å†æ¬¡æŸ¥çœ‹ PVï¼Œpv-nfs-1g çŠ¶æ€å˜æ›´ä¸º Releasedï¼Œè¡¨ç¤ºå·²ç»é‡Šæ”¾ï¼Œä½†æ˜¯ä¸èƒ½å†è¢«å…¶å®ƒ PVC ç»‘å®šäº†ï¼Œåªèƒ½åˆ é™¤é‡å»ºäº†$ k get pvNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpv-nfs-1g 1Gi RWO Retain Available &lt;unset&gt; 18mpv-nfs-2g 2Gi RWX Retain Released default/mypvc &lt;unset&gt; 18m# åˆ é™¤ PVk delete pv pv-nfs-1g Pod ç»‘å®š PVC è¿™é‡Œä»¥ nginx deployment ä¸ºä¾‹ 12345678910111213141516171819202122232425262728# nginx-pvc-deployment.yamlapiVersion: apps/v1kind: Deploymentmetadata: name: nginx-pvc-deployment namespace: defaultspec: replicas: 3 # 3ä¸ª podä¼šå…±äº«ä¸€ä¸ª PVC selector: matchLabels: app: nginx-pvc template: metadata: labels: app: nginx-pvc spec: containers: - name: nginx image: nginx ports: - containerPort: 80 volumeMounts: - name: nginx-storage mountPath: /usr/share/nginx/html # æŒ‚è½½åˆ° nginx çš„é»˜è®¤ç½‘é¡µç›®å½• volumes: - name: nginx-storage persistentVolumeClaim: # æŒ‡å®šå­˜å‚¨å·ç±»å‹æ˜¯ PVC claimName: mypvc # å¯¹åº”ä½ åˆ›å»ºçš„ PVC åç§° ä¸€ä¸ª PVC å¯¹åº”ä¸€ä¸ª PVï¼Œä½†æ˜¯ä¸€ä¸ª PVC å¯ä»¥å¯¹åº”å¤šä¸ª Deployment ç­‰æ§åˆ¶å™¨ã€‚ä¸‹é¢æˆ‘ä»¬å°±å†åˆ›å»ºä¸€ä¸ª Deploymentï¼Œå°† ç›¸åŒçš„ PVC æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œå¹¶ä¸”æ¯éš”5ç§’ä¿®æ”¹ä¸€æ¬¡ PVC æŒ‚è½½çš„ç½‘é¡µï¼Œå¹¶é€šè¿‡ nginx å®¹å™¨æŸ¥çœ‹ç»“æœ 1234567891011121314151617181920212223242526# busybox-deployment.yamlapiVersion: apps/v1kind: Deploymentmetadata: name: busybox-deploymentspec: replicas: 1 selector: matchLabels: app: busybox template: metadata: labels: app: busybox spec: containers: - name: busybox image: busybox command: [&quot;sh&quot;, &quot;-c&quot;, &quot;while true; do echo $(date) &gt; /data/index.html; sleep 5; done&quot;] volumeMounts: - name: shared-volume mountPath: /data volumes: - name: shared-volume persistentVolumeClaim: claimName: mypvc åˆ›å»ºåæŸ¥çœ‹ pod ip 123456$ k get pod -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESbusybox-deployment-d7589665d-dx2rs 1/1 Running 0 2m59s 10.244.126.6 k8s-worker2 &lt;none&gt; &lt;none&gt;nginx-pvc-deployment-775b8c4f8b-89cw7 1/1 Running 0 44s 10.244.126.8 k8s-worker2 &lt;none&gt; &lt;none&gt;nginx-pvc-deployment-775b8c4f8b-fszlf 1/1 Running 0 44s 10.244.194.123 k8s-worker1 &lt;none&gt; &lt;none&gt;nginx-pvc-deployment-775b8c4f8b-w9qkt 1/1 Running 0 44s 10.244.126.7 k8s-worker2 &lt;none&gt; &lt;none&gt; è®¿é—®ä»»æ„ä¸€ä¸ª nginx pod 12# æ­¤æ—¶ä¼šçœ‹åˆ°é¡µé¢å†…å®¹åœ¨å˜åŒ–watch -n 5 curl 10.244.194.123 åè®° ä¸º pod ç»‘å®š pvcæ—¶ï¼Œæ¯æ¬¡éƒ½è¦å…ˆåˆ›å»º pv å’Œ pvcï¼Œéå¸¸éº»çƒ¦ã€‚æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ ä½¿ç”¨ StorageClass å®ç°è‡ªåŠ¨åˆ›å»º PVï¼Œæˆ‘ä»¬ä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•å®ç°ã€‚ å¦‚æœ PVC è¢« Pod ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PVC å—ï¼Ÿ ä¸å¯ä»¥ï¼ŒPVC è¢« Pod ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… Pod åˆ é™¤åæ‰èƒ½åˆ é™¤ PVCã€‚ è‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PVC å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PVC çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PVC çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“å­˜Podå¯¹å‚¨å·çš„ä½¿ç”¨ã€‚ æ­¤æ—¶ä¸€æ—¦Pod åˆ é™¤ï¼ŒPVC å°±ä¼šè¢«åˆ é™¤ã€‚ å¦‚æœPV è¢« PVC ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PV å—ï¼Ÿ ä¸å¯ä»¥ï¼ŒPV è¢« PVC ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… PVC åˆ é™¤åæ‰èƒ½åˆ é™¤ PVã€‚ è‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PV å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PV çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PV çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“Podå¯¹å­˜å‚¨å·çš„ä½¿ç”¨ã€‚ æ­¤æ—¶ä¸€æ—¦ PVC åˆ é™¤ï¼ŒPV å°±ä¼šè¢«åˆ é™¤ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s PV/PVC å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS","date_published":"2025-07-21T15:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-nfs/","url":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-nfs/","title":"K8S ä¹‹ å­˜å‚¨å· NFS","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· NFS ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å­˜å‚¨å·-NFS-ä»‹ç»\">å­˜å‚¨å· NFS ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Kubernetes ä¸­ï¼ŒNFS (Network File System) æ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œå°†è¿œç¨‹å­˜å‚¨æŒ‚è½½åˆ° Pod çš„æ–¹å¼ã€‚å®ƒå…è®¸å¤šä¸ª Pod è·¨èŠ‚ç‚¹å…±äº«ç›¸åŒçš„å­˜å‚¨ç›®å½•ï¼Œå¸¸ç”¨äº ReadWriteManyï¼ˆRWXï¼‰ åœºæ™¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªNFS æœåŠ¡å™¨ï¼Œå¹¶é…ç½® NFS å­˜å‚¨å·ã€‚å…·ä½“å¯ä»¥å‚è€ƒ <a href=\"/2025/07/21/linux-nfs/\" title=\"Linux å®‰è£… NFS\">Linux å®‰è£… NFS</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>k8sä¸­æ¯ä¸ªworkerèŠ‚ç‚¹éƒ½éœ€è¦å®‰è£… NFS å®¢æˆ·ç«¯ï¼Œä½†æ˜¯ä¸éœ€è¦æŒ‚è½½ NFS å­˜å‚¨å·ï¼Œè¿™ä¸ªä¼šåœ¨podä¸­è¿›è¡Œã€‚</p>\n</li>\n</ul>\n<h2 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ pod ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nfs-direct-pod.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-direct-pod</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;sleep 3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nfs-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/data</span>          <span class=\"comment\"># å®¹å™¨å†…æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nfs-volume</span></span><br><span class=\"line\">    <span class=\"attr\">nfs:</span></span><br><span class=\"line\">      <span class=\"attr\">server:</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.88</span>      <span class=\"comment\"># NFS æœåŠ¡ç«¯åœ°å€</span></span><br><span class=\"line\">      <span class=\"attr\">path:</span> <span class=\"string\">/nfs-server/data</span>    <span class=\"comment\"># NFS æœåŠ¡ç«¯å…±äº«ç›®å½•</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">false</span>           <span class=\"comment\"># æ˜¯å¦åªè¯»æŒ‚è½½ï¼Œfalse è¡¨ç¤ºå¯è¯»å†™</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º Pod</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f nfs-direct-pod.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ Pod æŒ‚è½½ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹podéƒ¨ç½²åˆ°å“ªä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\">$ kubectl get pod nfs-direct-pod -o wide</span><br><span class=\"line\">NAME             READY   STATUS    RESTARTS   AGE   IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">nfs-direct-pod   1/1     Running   0          12m   10.244.194.115   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½• k8s-worker1 èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹ nfs æŒ‚è½½ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ åˆ›å»º podæ—¶ä¼šè‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸ŠæŒ‚è½½ nfs</span></span><br><span class=\"line\">$ <span class=\"built_in\">df</span> -t nfs4</span><br><span class=\"line\">Filesystem                    1K-blocks    Used Available Use% Mounted on</span><br><span class=\"line\">10.211.55.88:/nfs-server/data  42872832 3630080  39242752   9% /var/lib/kubelet/pods/e44786a9-fbd9-4ee8-bb28-84eb074fb7d9/volumes/kubernetes.io~nfs/nfs-volume</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹podæŒ‚è½½çš„ç›®å½•</span></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it nfs-direct-pod -- <span class=\"built_in\">df</span> -t nfs4</span><br><span class=\"line\">Filesystem           1K-blocks      Used Available Use% Mounted on</span><br><span class=\"line\">10.211.55.88:/nfs-server/data</span><br><span class=\"line\">                      42872832   3630080  39242752   8% /data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å‘nfsæŒ‚è½½ç›®å½•ä¸­å†™å…¥æ•°æ®</span></span><br><span class=\"line\">k <span class=\"built_in\">exec</span> -it nfs-direct-pod -- sh -c <span class=\"string\">&#x27;echo &quot;hello world&quot; &gt; /data/test.txt&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤pod</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">k delete pod nfs-direct-pod</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡ç™»å½• å®¿ä¸»æœºèŠ‚ç‚¹ï¼Œå‘ç° nfs æŒ‚è½½ç‚¹ä¹Ÿè¢«å¸è½½äº†ï¼Œä½†æ˜¯ nfs-server ä¸­çš„æ–‡ä»¶ä»ç„¶å­˜åœ¨</span></span><br><span class=\"line\">$ <span class=\"built_in\">df</span> -t nfs4</span><br><span class=\"line\"><span class=\"built_in\">df</span>: no file systems processed</span><br></pre></td></tr></table></figure>\n<h2 id=\"å­˜å‚¨å·ç±»å‹-emptyDirã€hostPathã€NFS-çš„å¯¹æ¯”è¡¨\">å­˜å‚¨å·ç±»å‹ emptyDirã€hostPathã€NFS çš„å¯¹æ¯”è¡¨</h2>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th><code>emptyDir</code></th>\n<th><code>hostPath</code></th>\n<th><code>nfs</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ•°æ®ç”Ÿå‘½å‘¨æœŸ</strong></td>\n<td>Pod ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆï¼ŒPod åˆ é™¤æ•°æ®ä¸¢å¤±</td>\n<td>ç»‘å®šèŠ‚ç‚¹ä¸Šçš„ç›®å½•ï¼ŒPod åˆ äº†æ•°æ®ä»ä¿ç•™</td>\n<td>å­˜å‚¨åœ¨è¿œç¨‹ NFS Serverï¼ŒPod åˆ é™¤æ•°æ®ä¸ä¸¢å¤±</td>\n</tr>\n<tr>\n<td><strong>å…±äº«èŒƒå›´</strong></td>\n<td><strong>åŒä¸€ä¸ª Pod çš„å¤šä¸ªå®¹å™¨å¯å…±äº«</strong></td>\n<td>åŒä¸€èŠ‚ç‚¹ä¸Šå¤šä¸ª Pod å¯å…±äº«</td>\n<td>é›†ç¾¤å†…å¤šä¸ª Pod è·¨èŠ‚ç‚¹å¯å…±äº«</td>\n</tr>\n<tr>\n<td><strong>æŒä¹…åŒ–èƒ½åŠ›</strong></td>\n<td>âŒ ä¸æŒä¹…åŒ–ï¼Œéš Pod ç”Ÿå‘½å‘¨æœŸç»“æŸæ¶ˆå¤±</td>\n<td>âœ… æŒä¹…åŒ–ï¼Œåªè¦å®¿ä¸»æœºç›®å½•å­˜åœ¨æ•°æ®å°±åœ¨</td>\n<td>âœ… æŒä¹…åŒ–ï¼ŒNFS å­˜å‚¨ç‹¬ç«‹äº Pod å­˜åœ¨</td>\n</tr>\n<tr>\n<td><strong>è·¨èŠ‚ç‚¹å…±äº«</strong></td>\n<td>âŒ ä¸èƒ½</td>\n<td>âŒ ä¸èƒ½</td>\n<td>âœ… æ”¯æŒè·¨èŠ‚ç‚¹å…±äº«</td>\n</tr>\n<tr>\n<td><strong>é€‚ç”¨åœºæ™¯</strong></td>\n<td>ä¸´æ—¶ç¼“å­˜ã€è¿›ç¨‹é—´å…±äº«æ•°æ®</td>\n<td>å®¿ä¸»æœºç‰¹å®šç›®å½•æŒ‚è½½ï¼Œæ—¥å¿—å­˜å‚¨ã€å®¿ä¸»æœºæ’ä»¶å¯¹æ¥</td>\n<td>å¤šå‰¯æœ¬æœåŠ¡å…±äº«å­˜å‚¨ã€æŒä¹…åŒ–æ•°æ®ã€å…±äº«é…ç½®æ–‡ä»¶</td>\n</tr>\n<tr>\n<td><strong>æ•°æ®å®‰å…¨æ€§</strong></td>\n<td>éš Pod åˆ é™¤ï¼Œ<strong>æ•°æ®æ˜“ä¸¢å¤±</strong></td>\n<td>å®¹å™¨æœ‰æƒé™å¯ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ï¼Œå­˜åœ¨é£é™©</td>\n<td>ä¾èµ– NFS Server ç¨³å®šæ€§ï¼Œé…ç½®ä¸å½“å¯èƒ½è¢«æ‰€æœ‰èŠ‚ç‚¹è¯»å†™</td>\n</tr>\n<tr>\n<td><strong>å…¸å‹ç”¨ä¾‹</strong></td>\n<td>Redis ç¼“å­˜ç›®å½•ã€Sidecar å®¹å™¨å…±äº«æ—¥å¿—</td>\n<td>æŒ‚è½½å®¿ä¸»æœº docker.sockã€å®¿ä¸»æœºæ—¥å¿—ç›®å½•</td>\n<td>è·¨ Pod æ–‡ä»¶å…±äº«ã€Web é™æ€èµ„æºã€Tensorflow å¤šå‰¯æœ¬è®­ç»ƒå…±äº«æ•°æ®</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ä¸ºä»€ä¹ˆå·²ç»æœ‰-NFSï¼Œè¿˜æ¨èç”¨-PV-PVCï¼Ÿ\">ä¸ºä»€ä¹ˆå·²ç»æœ‰ NFSï¼Œè¿˜æ¨èç”¨ PV/PVCï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âœ… ç®€çŸ­å›ç­”ï¼šPV/PVC æ˜¯å¯¹åº•å±‚å­˜å‚¨ï¼ˆå¦‚ NFSï¼‰çš„æŠ½è±¡å’Œæ ‡å‡†åŒ–ç®¡ç†ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŸå› </th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>âœ… <strong>Kubernetes æ ‡å‡†èµ„æº</strong></td>\n<td>ç”¨ PVC å£°æ˜å­˜å‚¨éœ€æ±‚ï¼Œç”± K8s ç»Ÿä¸€è°ƒåº¦å’Œç®¡ç†ã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>å­˜å‚¨ä¸ Pod è§£è€¦</strong></td>\n<td>Pod ä¸“æ³¨äºåº”ç”¨é€»è¾‘ï¼ŒPVC ä¸“æ³¨äºå£°æ˜â€œæˆ‘è¦ä¸€ä¸ª 10Gi çš„ RWX å­˜å‚¨â€ï¼ŒèƒŒåæ˜¯ NFSã€Ceph è¿˜æ˜¯åˆ«çš„ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>åŠ¨æ€ä¾›åº”</strong></td>\n<td>æ­é… StorageClass å¯ä»¥å®ç° <strong>è‡ªåŠ¨åˆ›å»º PV</strong>ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ PVã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></td>\n<td>PVC è¢«åˆ é™¤æ—¶å¯è§¦å‘ PV å›æ”¶ã€ä¿ç•™æˆ–åˆ é™¤ç­–ç•¥ï¼ˆ<code>Retain</code>ã€<code>Recycle</code>ã€<code>Delete</code>ï¼‰ã€‚ç›´æ¥æŒ‚è½½ NFS æ²¡æœ‰è¿™äº›æœºåˆ¶ã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>æƒé™éš”ç¦»</strong></td>\n<td>PV/PVC å¯ä»¥é€šè¿‡ <code>accessModes</code> æ§åˆ¶è®¿é—®çº§åˆ«ï¼Œæ¯”å¦‚åªå…è®¸ç‰¹å®š Pod è®¿é—®ã€‚ç›´æ¥æŒ‚è½½ NFS å®¹æ˜“æƒé™æ··ä¹±ã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>æ›´å¥½å…¼å®¹æ€§</strong></td>\n<td>æŸäº›å·¥ä½œè´Ÿè½½ï¼ˆå¦‚ StatefulSetï¼‰<strong>åªèƒ½ç”¨ PVC</strong>ï¼Œä¸æ”¯æŒç›´æ¥ <code>nfs</code> å·ã€‚</td>\n</tr>\n<tr>\n<td>âœ… <strong>æ›´çµæ´»çš„åˆ‡æ¢å­˜å‚¨æ–¹æ¡ˆ</strong></td>\n<td>åæœŸå¦‚æœæ¢æˆ Cephã€EBSã€GlusterFSï¼Œåªéœ€æ”¹ PV/PVCï¼Œä¸éœ€è¦æ”¹ Pod é…ç½®ã€‚</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· NFS ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github å­˜å‚¨å· NFS ä»‹ç» åœ¨ Kubernetes ä¸­ï¼ŒNFS (Network File System) æ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œå°†è¿œç¨‹å­˜å‚¨æŒ‚è½½åˆ° Pod çš„æ–¹å¼ã€‚å®ƒå…è®¸å¤šä¸ª Pod è·¨èŠ‚ç‚¹å…±äº«ç›¸åŒçš„å­˜å‚¨ç›®å½•ï¼Œå¸¸ç”¨äº ReadWriteManyï¼ˆRWXï¼‰ åœºæ™¯ã€‚ æˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªNFS æœåŠ¡å™¨ï¼Œå¹¶é…ç½® NFS å­˜å‚¨å·ã€‚å…·ä½“å¯ä»¥å‚è€ƒ Linux å®‰è£… NFS k8sä¸­æ¯ä¸ªworkerèŠ‚ç‚¹éƒ½éœ€è¦å®‰è£… NFS å®¢æˆ·ç«¯ï¼Œä½†æ˜¯ä¸éœ€è¦æŒ‚è½½ NFS å­˜å‚¨å·ï¼Œè¿™ä¸ªä¼šåœ¨podä¸­è¿›è¡Œã€‚ ç¤ºä¾‹ ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ pod ç¤ºä¾‹ 12345678910111213141516171819# nfs-direct-pod.yamlapiVersion: v1kind: Podmetadata: name: nfs-direct-podspec: containers: - name: busybox image: busybox command: [&quot;sh&quot;, &quot;-c&quot;, &quot;sleep 3600&quot;] volumeMounts: - name: nfs-volume mountPath: /data # å®¹å™¨å†…æŒ‚è½½ç‚¹ volumes: - name: nfs-volume nfs: server: 10.211.55.88 # NFS æœåŠ¡ç«¯åœ°å€ path: /nfs-server/data # NFS æœåŠ¡ç«¯å…±äº«ç›®å½• readOnly: false # æ˜¯å¦åªè¯»æŒ‚è½½ï¼Œfalse è¡¨ç¤ºå¯è¯»å†™ åˆ›å»º Pod 1kubectl apply -f nfs-direct-pod.yaml æŸ¥çœ‹ Pod æŒ‚è½½ç‚¹ 123456789101112131415161718# æŸ¥çœ‹podéƒ¨ç½²åˆ°å“ªä¸ªèŠ‚ç‚¹$ kubectl get pod nfs-direct-pod -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESnfs-direct-pod 1/1 Running 0 12m 10.244.194.115 k8s-worker1 &lt;none&gt; &lt;none&gt;# ç™»å½• k8s-worker1 èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹ nfs æŒ‚è½½ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ åˆ›å»º podæ—¶ä¼šè‡ªåŠ¨åœ¨å®¿ä¸»æœºä¸ŠæŒ‚è½½ nfs$ df -t nfs4Filesystem 1K-blocks Used Available Use% Mounted on10.211.55.88:/nfs-server/data 42872832 3630080 39242752 9% /var/lib/kubelet/pods/e44786a9-fbd9-4ee8-bb28-84eb074fb7d9/volumes/kubernetes.io~nfs/nfs-volume# æŸ¥çœ‹podæŒ‚è½½çš„ç›®å½•$ k exec -it nfs-direct-pod -- df -t nfs4Filesystem 1K-blocks Used Available Use% Mounted on10.211.55.88:/nfs-server/data 42872832 3630080 39242752 8% /data# å‘nfsæŒ‚è½½ç›®å½•ä¸­å†™å…¥æ•°æ®k exec -it nfs-direct-pod -- sh -c &#x27;echo &quot;hello world&quot; &gt; /data/test.txt&#x27; åˆ é™¤pod 12345k delete pod nfs-direct-pod# å†æ¬¡ç™»å½• å®¿ä¸»æœºèŠ‚ç‚¹ï¼Œå‘ç° nfs æŒ‚è½½ç‚¹ä¹Ÿè¢«å¸è½½äº†ï¼Œä½†æ˜¯ nfs-server ä¸­çš„æ–‡ä»¶ä»ç„¶å­˜åœ¨$ df -t nfs4df: no file systems processed å­˜å‚¨å·ç±»å‹ emptyDirã€hostPathã€NFS çš„å¯¹æ¯”è¡¨ ç‰¹æ€§ emptyDir hostPath nfs æ•°æ®ç”Ÿå‘½å‘¨æœŸ Pod ç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆï¼ŒPod åˆ é™¤æ•°æ®ä¸¢å¤± ç»‘å®šèŠ‚ç‚¹ä¸Šçš„ç›®å½•ï¼ŒPod åˆ äº†æ•°æ®ä»ä¿ç•™ å­˜å‚¨åœ¨è¿œç¨‹ NFS Serverï¼ŒPod åˆ é™¤æ•°æ®ä¸ä¸¢å¤± å…±äº«èŒƒå›´ åŒä¸€ä¸ª Pod çš„å¤šä¸ªå®¹å™¨å¯å…±äº« åŒä¸€èŠ‚ç‚¹ä¸Šå¤šä¸ª Pod å¯å…±äº« é›†ç¾¤å†…å¤šä¸ª Pod è·¨èŠ‚ç‚¹å¯å…±äº« æŒä¹…åŒ–èƒ½åŠ› âŒ ä¸æŒä¹…åŒ–ï¼Œéš Pod ç”Ÿå‘½å‘¨æœŸç»“æŸæ¶ˆå¤± âœ… æŒä¹…åŒ–ï¼Œåªè¦å®¿ä¸»æœºç›®å½•å­˜åœ¨æ•°æ®å°±åœ¨ âœ… æŒä¹…åŒ–ï¼ŒNFS å­˜å‚¨ç‹¬ç«‹äº Pod å­˜åœ¨ è·¨èŠ‚ç‚¹å…±äº« âŒ ä¸èƒ½ âŒ ä¸èƒ½ âœ… æ”¯æŒè·¨èŠ‚ç‚¹å…±äº« é€‚ç”¨åœºæ™¯ ä¸´æ—¶ç¼“å­˜ã€è¿›ç¨‹é—´å…±äº«æ•°æ® å®¿ä¸»æœºç‰¹å®šç›®å½•æŒ‚è½½ï¼Œæ—¥å¿—å­˜å‚¨ã€å®¿ä¸»æœºæ’ä»¶å¯¹æ¥ å¤šå‰¯æœ¬æœåŠ¡å…±äº«å­˜å‚¨ã€æŒä¹…åŒ–æ•°æ®ã€å…±äº«é…ç½®æ–‡ä»¶ æ•°æ®å®‰å…¨æ€§ éš Pod åˆ é™¤ï¼Œæ•°æ®æ˜“ä¸¢å¤± å®¹å™¨æœ‰æƒé™å¯ä¿®æ”¹å®¿ä¸»æœºæ–‡ä»¶ï¼Œå­˜åœ¨é£é™© ä¾èµ– NFS Server ç¨³å®šæ€§ï¼Œé…ç½®ä¸å½“å¯èƒ½è¢«æ‰€æœ‰èŠ‚ç‚¹è¯»å†™ å…¸å‹ç”¨ä¾‹ Redis ç¼“å­˜ç›®å½•ã€Sidecar å®¹å™¨å…±äº«æ—¥å¿— æŒ‚è½½å®¿ä¸»æœº docker.sockã€å®¿ä¸»æœºæ—¥å¿—ç›®å½• è·¨ Pod æ–‡ä»¶å…±äº«ã€Web é™æ€èµ„æºã€Tensorflow å¤šå‰¯æœ¬è®­ç»ƒå…±äº«æ•°æ® ä¸ºä»€ä¹ˆå·²ç»æœ‰ NFSï¼Œè¿˜æ¨èç”¨ PV/PVCï¼Ÿ âœ… ç®€çŸ­å›ç­”ï¼šPV/PVC æ˜¯å¯¹åº•å±‚å­˜å‚¨ï¼ˆå¦‚ NFSï¼‰çš„æŠ½è±¡å’Œæ ‡å‡†åŒ–ç®¡ç†ã€‚ åŸå›  è¯´æ˜ âœ… Kubernetes æ ‡å‡†èµ„æº ç”¨ PVC å£°æ˜å­˜å‚¨éœ€æ±‚ï¼Œç”± K8s ç»Ÿä¸€è°ƒåº¦å’Œç®¡ç†ã€‚ âœ… å­˜å‚¨ä¸ Pod è§£è€¦ Pod ä¸“æ³¨äºåº”ç”¨é€»è¾‘ï¼ŒPVC ä¸“æ³¨äºå£°æ˜â€œæˆ‘è¦ä¸€ä¸ª 10Gi çš„ RWX å­˜å‚¨â€ï¼ŒèƒŒåæ˜¯ NFSã€Ceph è¿˜æ˜¯åˆ«çš„ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒã€‚ âœ… åŠ¨æ€ä¾›åº” æ­é… StorageClass å¯ä»¥å®ç° è‡ªåŠ¨åˆ›å»º PVï¼Œä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ PVã€‚ âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç† PVC è¢«åˆ é™¤æ—¶å¯è§¦å‘ PV å›æ”¶ã€ä¿ç•™æˆ–åˆ é™¤ç­–ç•¥ï¼ˆRetainã€Recycleã€Deleteï¼‰ã€‚ç›´æ¥æŒ‚è½½ NFS æ²¡æœ‰è¿™äº›æœºåˆ¶ã€‚ âœ… æƒé™éš”ç¦» PV/PVC å¯ä»¥é€šè¿‡ accessModes æ§åˆ¶è®¿é—®çº§åˆ«ï¼Œæ¯”å¦‚åªå…è®¸ç‰¹å®š Pod è®¿é—®ã€‚ç›´æ¥æŒ‚è½½ NFS å®¹æ˜“æƒé™æ··ä¹±ã€‚ âœ… æ›´å¥½å…¼å®¹æ€§ æŸäº›å·¥ä½œè´Ÿè½½ï¼ˆå¦‚ StatefulSetï¼‰åªèƒ½ç”¨ PVCï¼Œä¸æ”¯æŒç›´æ¥ nfs å·ã€‚ âœ… æ›´çµæ´»çš„åˆ‡æ¢å­˜å‚¨æ–¹æ¡ˆ åæœŸå¦‚æœæ¢æˆ Cephã€EBSã€GlusterFSï¼Œåªéœ€æ”¹ PV/PVCï¼Œä¸éœ€è¦æ”¹ Pod é…ç½®ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· NFS ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-21T15:34:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/21/linux-nfs/","url":"https://blog.hanqunfeng.com/2025/07/21/linux-nfs/","title":"Linux å®‰è£… NFS","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» linux ä¸‹ nfs æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ä¸ä½¿ç”¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº<code>CentOS8(x86_64)</code></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"NFS-ç®€ä»‹\">NFS ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ŒNetwork File Systemï¼‰æ˜¯ä¸€ä¸ªé€šè¿‡ç½‘ç»œå…±äº«æ–‡ä»¶çš„åè®®ï¼Œå…è®¸ä¸åŒæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯åƒæŒ‚è½½æœ¬åœ°ç£ç›˜ä¸€æ ·è®¿é—®è¿œç«¯çš„å…±äº«æ–‡ä»¶ç›®å½•ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å‡†å¤‡ä¸€å°æœåŠ¡å™¨\">å‡†å¤‡ä¸€å°æœåŠ¡å™¨</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½® hostname</span></span><br><span class=\"line\">hostnamectl set-hostname nfs-server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç½‘å¡</span></span><br><span class=\"line\">ip a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®IP åˆ†é…æ–¹å¼ï¼Œmanual: æ‰‹åŠ¨æŒ‡å®šIPï¼Œauto: DHCPè‡ªåŠ¨è·å–ï¼Œdisabled: å…³é—­IP</span></span><br><span class=\"line\">nmcli con mod enp0s5 ipv4.method manual</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½® IP</span></span><br><span class=\"line\">nmcli con mod enp0s5 ipv4.addresses 10.211.55.88/24</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½® gateway</span></span><br><span class=\"line\">nmcli con mod enp0s5 ipv4.gateway 10.211.55.1</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½® dns</span></span><br><span class=\"line\">nmcli con mod enp0s5 ipv4.dns <span class=\"string\">&quot;10.211.55.1,8.8.8.8&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°å¯åŠ¨ç½‘å¡</span></span><br><span class=\"line\">nmcli con up enp0s5</span><br></pre></td></tr></table></figure>\n<h2 id=\"NFS-å®‰è£…ï¼šæœåŠ¡ç«¯\">NFS å®‰è£…ï¼šæœåŠ¡ç«¯</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£… nfs-utils å’Œ rpcbind</span></span><br><span class=\"line\">dnf install rpcbind nfs-utils -y</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º nfs-server å­˜å‚¨ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /nfs-server/data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é…ç½® nfs-serverï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;/nfs-server/data *(insecure,rw,sync,no_root_squash,no_all_squash)&quot;</span> &gt;&gt; /etc/exports</span><br><span class=\"line\"><span class=\"comment\">## é…ç½®é¡¹è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># * ï¼šå…è®¸æ‰€æœ‰å®¢æˆ·ç«¯è®¿é—®ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“çš„å®¢æˆ·ç«¯ IP åœ°å€ï¼Œæ¯”å¦‚ï¼š192.168.0.0/24(rw,sync,no_root_squash,no_all_squash)</span></span><br><span class=\"line\"><span class=\"comment\"># insecure ï¼šå…è®¸ä»»æ„ç«¯å£ï¼ˆå…¼å®¹æ€§å¥½,æ”¯æŒk8sï¼‰ï¼Œé»˜è®¤å€¼æ˜¯ secureï¼šåªå…è®¸ 1024 ä»¥ä¸‹ç«¯å£ï¼Œé€‚åˆä¼ ç»ŸæœåŠ¡å™¨</span></span><br><span class=\"line\"><span class=\"comment\"># rw ï¼šè¯»å†™æƒé™ï¼Œroï¼šåªè¯»æƒé™</span></span><br><span class=\"line\"><span class=\"comment\"># sync ï¼šåŒæ­¥æ¨¡å¼ï¼Œå¼ºä¸€è‡´æ€§ï¼Œasyncï¼šå¼‚æ­¥æ¨¡å¼ï¼Œæ€§èƒ½é«˜ï¼Œä½†å­˜åœ¨ä¸¢æ•°æ®é£é™©</span></span><br><span class=\"line\"><span class=\"comment\"># no_root_squash ï¼šå…è®¸ root ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œroot ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"comment\"># no_all_squash ï¼šå…è®¸æ‰€æœ‰ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå¯ä»¥çœç•¥ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ rpcbindã€nfs æœåŠ¡</span></span><br><span class=\"line\">systemctl start rpcbind &amp;&amp; systemctl start nfs-server</span><br><span class=\"line\"><span class=\"comment\"># å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> rpcbind &amp;&amp; systemctl <span class=\"built_in\">enable</span> nfs-server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/exportsï¼Œéœ€è¦é‡è½½ nfs é…ç½®</span></span><br><span class=\"line\">systemctl reload nfs-server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ nfs æœåŠ¡çŠ¶æ€</span></span><br><span class=\"line\">systemctl status nfs-server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ nfs æœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 2049</span></span><br><span class=\"line\">$ rpcinfo -p | grep nfs</span><br><span class=\"line\">    100003    3   tcp   2049  nfs</span><br><span class=\"line\">    100003    4   tcp   2049  nfs</span><br><span class=\"line\">    100227    3   tcp   2049  nfs_acl</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥å¯¼å‡ºçš„å…±äº«ç›®å½•</span></span><br><span class=\"line\">$ exportfs -v</span><br><span class=\"line\">/nfs-server/data</span><br><span class=\"line\">                &lt;world&gt;(<span class=\"built_in\">sync</span>,wdelay,hide,no_subtree_check,sec=sys,rw,insecure,no_root_squash,no_all_squash)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"å¼€æ”¾ç«¯å£\">å¼€æ”¾ç«¯å£</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ç«¯å£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ rpcinfo -p 10.211.55.88</span><br><span class=\"line\">   program vers proto   port  service</span><br><span class=\"line\">    100000    4   tcp    111  portmapper</span><br><span class=\"line\">    100000    3   tcp    111  portmapper</span><br><span class=\"line\">    100000    2   tcp    111  portmapper</span><br><span class=\"line\">    100000    4   udp    111  portmapper</span><br><span class=\"line\">    100000    3   udp    111  portmapper</span><br><span class=\"line\">    100000    2   udp    111  portmapper</span><br><span class=\"line\">    100024    1   udp  36578  status</span><br><span class=\"line\">    100024    1   tcp  46973  status</span><br><span class=\"line\">    100005    1   udp  20048  mountd</span><br><span class=\"line\">    100005    1   tcp  20048  mountd</span><br><span class=\"line\">    100005    2   udp  20048  mountd</span><br><span class=\"line\">    100005    2   tcp  20048  mountd</span><br><span class=\"line\">    100005    3   udp  20048  mountd</span><br><span class=\"line\">    100005    3   tcp  20048  mountd</span><br><span class=\"line\">    100003    3   tcp   2049  nfs</span><br><span class=\"line\">    100003    4   tcp   2049  nfs</span><br><span class=\"line\">    100227    3   tcp   2049  nfs_acl</span><br><span class=\"line\">    100021    1   udp  36529  nlockmgr</span><br><span class=\"line\">    100021    3   udp  36529  nlockmgr</span><br><span class=\"line\">    100021    4   udp  36529  nlockmgr</span><br><span class=\"line\">    100021    1   tcp  45917  nlockmgr</span><br><span class=\"line\">    100021    3   tcp  45917  nlockmgr</span><br><span class=\"line\">    100021    4   tcp  45917  nlockmgr</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>Program (ç¼–å·)</th>\n<th>æœåŠ¡åç§°</th>\n<th>ç”¨é€”</th>\n<th>ç«¯å£</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>100000</code></td>\n<td>portmapper</td>\n<td>RPC æœåŠ¡æ³¨å†Œè¡¨</td>\n<td>111/tcp, 111/udp</td>\n<td><strong>å¿…é¡»å¼€æ”¾</strong>ï¼Œå®¢æˆ·ç«¯é€šè¿‡å®ƒæŸ¥æ‰¾å…¶å®ƒæœåŠ¡ç«¯å£</td>\n</tr>\n<tr>\n<td><code>100024</code></td>\n<td>status (rpc.statd)</td>\n<td>æ–‡ä»¶é”å®šçŠ¶æ€ç®¡ç†</td>\n<td>36578/udp, 46973/tcp</td>\n<td>å¸¸é…åˆ nlockmgr ä½¿ç”¨ï¼Œéå¿…éœ€</td>\n</tr>\n<tr>\n<td><code>100005</code></td>\n<td>mountd</td>\n<td>æŒ‚è½½æœåŠ¡</td>\n<td>20048/tcp, 20048/udp</td>\n<td><strong>æŒ‚è½½æ—¶å¿…éœ€</strong></td>\n</tr>\n<tr>\n<td><code>100003</code></td>\n<td>nfs</td>\n<td>NFS ä¸»æœåŠ¡</td>\n<td>2049/tcp</td>\n<td><strong>æ ¸å¿ƒæœåŠ¡ï¼Œå¿…éœ€</strong></td>\n</tr>\n<tr>\n<td><code>100227</code></td>\n<td>nfs_acl</td>\n<td>NFS çš„ ACL æƒé™æ§åˆ¶</td>\n<td>2049/tcp</td>\n<td>é€šå¸¸ä¸ nfs ä¸€èµ·</td>\n</tr>\n<tr>\n<td><code>100021</code></td>\n<td>nlockmgr</td>\n<td>æ–‡ä»¶é”ç®¡ç†</td>\n<td>36529/udp, 45917/tcp</td>\n<td>Stateful åº”ç”¨æ¶‰åŠæ–‡ä»¶é”æ—¶éœ€è¦</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ€å°ç«¯å£è¦æ±‚ï¼ˆåŸºæœ¬æŒ‚è½½ç”¨ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>éœ€è¦å¼€æ”¾çš„ç«¯å£</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>âœ… <strong>åŸºæœ¬ NFS æŒ‚è½½è¯»å†™</strong></td>\n<td><code>2049/tcp</code> + <code>111/tcp/udp</code></td>\n</tr>\n<tr>\n<td>âœ… <strong>å®¹å™¨æˆ– K8s æŒ‚è½½</strong></td>\n<td>åŒä¸Šï¼Œä¸€èˆ¬è¿˜æ¨è <code>20048/tcp/udp</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¼€æ”¾å¿…é¡»ç«¯å£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --permanent --add-port=2049/tcp</span><br><span class=\"line\">firewall-cmd --permanent --add-port=111/tcp</span><br><span class=\"line\">firewall-cmd --permanent --add-port=111/udp</span><br><span class=\"line\">firewall-cmd --permanent --add-port=20048/tcp</span><br><span class=\"line\">firewall-cmd --permanent --add-port=20048/udp</span><br><span class=\"line\">firewall-cmd --reload</span><br></pre></td></tr></table></figure>\n<h2 id=\"NFS-å®‰è£…ï¼šå®¢æˆ·ç«¯\">NFS å®‰è£…ï¼šå®¢æˆ·ç«¯</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£… nfs-utils å’Œ rpcbindï¼Œå®‰è£…åä¸éœ€è¦å¯åŠ¨ nfs-server æœåŠ¡ï¼Œåªéœ€è¦å¯åŠ¨ rpcbind æœåŠ¡ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½è¦è¿è¡Œ</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install rpcbind nfs-utils -y</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start rpcbind &amp;&amp; systemctl <span class=\"built_in\">enable</span> rpcbind</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æœåŠ¡å™¨çš„å…±äº«èµ„æºåˆ—è¡¨</span></span><br><span class=\"line\"><span class=\"comment\"># showmount -e &lt;nfs-server-ip&gt;</span></span><br><span class=\"line\">$ showmount -e 10.211.55.88</span><br><span class=\"line\">Export list <span class=\"keyword\">for</span> 10.211.55.88:</span><br><span class=\"line\">/nfs-server/data *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º å®¢æˆ·ç«¯æŒ‚è½½ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /nfs/data</span><br><span class=\"line\"><span class=\"comment\"># æŒ‚è½½</span></span><br><span class=\"line\">mount -t nfs 10.211.55.88:/nfs-server/data /nfs/data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">$ mount | grep nfs/data</span><br><span class=\"line\">10.211.55.88:/nfs-server/data on /nfs/data <span class=\"built_in\">type</span> nfs4 (rw,relatime,vers=4.2,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.211.55.11,local_lock=none,addr=10.211.55.88)</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‚è½½ç‚¹ä¿¡æ¯ï¼Œè¿™ç§æ–¹å¼æ›´å‹å¥½</span></span><br><span class=\"line\">$ <span class=\"built_in\">df</span> -t nfs4</span><br><span class=\"line\">Filesystem                    1K-blocks    Used Available Use% Mounted on</span><br><span class=\"line\">10.211.55.88:/nfs-server/data  42872832 3630080  39242752   9% /nfs/data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®è‡ªåŠ¨æŒ‚è½½</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;10.211.55.88:/nfs-server/data /nfs/data nfs defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br><span class=\"line\"><span class=\"comment\"># æ ¹æ® /etc/fstab æ–‡ä»¶çš„é…ç½®ï¼Œå°è¯•æŒ‚è½½æ‰€æœ‰æœªæŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿã€‚ä¿®æ”¹ /etc/fstab åæ‰§è¡Œ mount -a ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class=\"line\">mount -a</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¢æˆ·ç«¯æŒ‚è½½çš„ç›®å½•ä¸èƒ½åˆ é™¤ï¼Œéœ€è¦å…ˆå¸è½½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -f å¼ºåˆ¶å¸è½½</span></span><br><span class=\"line\">umount -f /nfs/data</span><br><span class=\"line\"></span><br><span class=\"line\">vim /etc/fstab</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æˆ–æ³¨é‡Šæ‰å¯¹åº”çš„ NFS æŒ‚è½½è¡Œ</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf /nfs/data</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» linux ä¸‹ nfs æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ä¸ä½¿ç”¨ æœ¬æ–‡åŸºäºCentOS8(x86_64) NFS ç®€ä»‹ NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ŒNetwork File Systemï¼‰æ˜¯ä¸€ä¸ªé€šè¿‡ç½‘ç»œå…±äº«æ–‡ä»¶çš„åè®®ï¼Œå…è®¸ä¸åŒæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯åƒæŒ‚è½½æœ¬åœ°ç£ç›˜ä¸€æ ·è®¿é—®è¿œç«¯çš„å…±äº«æ–‡ä»¶ç›®å½•ã€‚ å‡†å¤‡ä¸€å°æœåŠ¡å™¨ 12345678910111213141516# è®¾ç½® hostnamehostnamectl set-hostname nfs-server# æŸ¥çœ‹ç½‘å¡ip a# è®¾ç½®IP åˆ†é…æ–¹å¼ï¼Œmanual: æ‰‹åŠ¨æŒ‡å®šIPï¼Œauto: DHCPè‡ªåŠ¨è·å–ï¼Œdisabled: å…³é—­IPnmcli con mod enp0s5 ipv4.method manual# è®¾ç½® IPnmcli con mod enp0s5 ipv4.addresses 10.211.55.88/24# è®¾ç½® gatewaynmcli con mod enp0s5 ipv4.gateway 10.211.55.1# è®¾ç½® dnsnmcli con mod enp0s5 ipv4.dns &quot;10.211.55.1,8.8.8.8&quot;# é‡æ–°å¯åŠ¨ç½‘å¡nmcli con up enp0s5 NFS å®‰è£…ï¼šæœåŠ¡ç«¯ 1234567891011121314151617181920212223242526272829303132333435363738# å®‰è£… nfs-utils å’Œ rpcbinddnf install rpcbind nfs-utils -y# åˆ›å»º nfs-server å­˜å‚¨ç›®å½•mkdir -p /nfs-server/data# é…ç½® nfs-serverï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªç›®å½•echo &quot;/nfs-server/data *(insecure,rw,sync,no_root_squash,no_all_squash)&quot; &gt;&gt; /etc/exports## é…ç½®é¡¹è¯´æ˜# * ï¼šå…è®¸æ‰€æœ‰å®¢æˆ·ç«¯è®¿é—®ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“çš„å®¢æˆ·ç«¯ IP åœ°å€ï¼Œæ¯”å¦‚ï¼š192.168.0.0/24(rw,sync,no_root_squash,no_all_squash)# insecure ï¼šå…è®¸ä»»æ„ç«¯å£ï¼ˆå…¼å®¹æ€§å¥½,æ”¯æŒk8sï¼‰ï¼Œé»˜è®¤å€¼æ˜¯ secureï¼šåªå…è®¸ 1024 ä»¥ä¸‹ç«¯å£ï¼Œé€‚åˆä¼ ç»ŸæœåŠ¡å™¨# rw ï¼šè¯»å†™æƒé™ï¼Œroï¼šåªè¯»æƒé™# sync ï¼šåŒæ­¥æ¨¡å¼ï¼Œå¼ºä¸€è‡´æ€§ï¼Œasyncï¼šå¼‚æ­¥æ¨¡å¼ï¼Œæ€§èƒ½é«˜ï¼Œä½†å­˜åœ¨ä¸¢æ•°æ®é£é™©# no_root_squash ï¼šå…è®¸ root ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œroot ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·# no_all_squash ï¼šå…è®¸æ‰€æœ‰ç”¨æˆ·è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç”¨æˆ·è®¿é—®æ—¶ä¼šè¢«è½¬æ¢æˆ nobody ç”¨æˆ·ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå¯ä»¥çœç•¥ã€‚# å¯åŠ¨ rpcbindã€nfs æœåŠ¡systemctl start rpcbind &amp;&amp; systemctl start nfs-server# å¼€æœºè‡ªå¯åŠ¨systemctl enable rpcbind &amp;&amp; systemctl enable nfs-server# ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/exportsï¼Œéœ€è¦é‡è½½ nfs é…ç½®systemctl reload nfs-server# æŸ¥çœ‹ nfs æœåŠ¡çŠ¶æ€systemctl status nfs-server# æŸ¥çœ‹ nfs æœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 2049$ rpcinfo -p | grep nfs 100003 3 tcp 2049 nfs 100003 4 tcp 2049 nfs 100227 3 tcp 2049 nfs_acl# æ£€æŸ¥å¯¼å‡ºçš„å…±äº«ç›®å½•$ exportfs -v/nfs-server/data &lt;world&gt;(sync,wdelay,hide,no_subtree_check,sec=sys,rw,insecure,no_root_squash,no_all_squash) å¼€æ”¾ç«¯å£ æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ç«¯å£ 12345678910111213141516171819202122232425$ rpcinfo -p 10.211.55.88 program vers proto port service 100000 4 tcp 111 portmapper 100000 3 tcp 111 portmapper 100000 2 tcp 111 portmapper 100000 4 udp 111 portmapper 100000 3 udp 111 portmapper 100000 2 udp 111 portmapper 100024 1 udp 36578 status 100024 1 tcp 46973 status 100005 1 udp 20048 mountd 100005 1 tcp 20048 mountd 100005 2 udp 20048 mountd 100005 2 tcp 20048 mountd 100005 3 udp 20048 mountd 100005 3 tcp 20048 mountd 100003 3 tcp 2049 nfs 100003 4 tcp 2049 nfs 100227 3 tcp 2049 nfs_acl 100021 1 udp 36529 nlockmgr 100021 3 udp 36529 nlockmgr 100021 4 udp 36529 nlockmgr 100021 1 tcp 45917 nlockmgr 100021 3 tcp 45917 nlockmgr 100021 4 tcp 45917 nlockmgr Program (ç¼–å·) æœåŠ¡åç§° ç”¨é€” ç«¯å£ è¯´æ˜ 100000 portmapper RPC æœåŠ¡æ³¨å†Œè¡¨ 111/tcp, 111/udp å¿…é¡»å¼€æ”¾ï¼Œå®¢æˆ·ç«¯é€šè¿‡å®ƒæŸ¥æ‰¾å…¶å®ƒæœåŠ¡ç«¯å£ 100024 status (rpc.statd) æ–‡ä»¶é”å®šçŠ¶æ€ç®¡ç† 36578/udp, 46973/tcp å¸¸é…åˆ nlockmgr ä½¿ç”¨ï¼Œéå¿…éœ€ 100005 mountd æŒ‚è½½æœåŠ¡ 20048/tcp, 20048/udp æŒ‚è½½æ—¶å¿…éœ€ 100003 nfs NFS ä¸»æœåŠ¡ 2049/tcp æ ¸å¿ƒæœåŠ¡ï¼Œå¿…éœ€ 100227 nfs_acl NFS çš„ ACL æƒé™æ§åˆ¶ 2049/tcp é€šå¸¸ä¸ nfs ä¸€èµ· 100021 nlockmgr æ–‡ä»¶é”ç®¡ç† 36529/udp, 45917/tcp Stateful åº”ç”¨æ¶‰åŠæ–‡ä»¶é”æ—¶éœ€è¦ æœ€å°ç«¯å£è¦æ±‚ï¼ˆåŸºæœ¬æŒ‚è½½ç”¨ï¼‰ åœºæ™¯ éœ€è¦å¼€æ”¾çš„ç«¯å£ âœ… åŸºæœ¬ NFS æŒ‚è½½è¯»å†™ 2049/tcp + 111/tcp/udp âœ… å®¹å™¨æˆ– K8s æŒ‚è½½ åŒä¸Šï¼Œä¸€èˆ¬è¿˜æ¨è 20048/tcp/udp å¼€æ”¾å¿…é¡»ç«¯å£ 123456firewall-cmd --permanent --add-port=2049/tcpfirewall-cmd --permanent --add-port=111/tcpfirewall-cmd --permanent --add-port=111/udpfirewall-cmd --permanent --add-port=20048/tcpfirewall-cmd --permanent --add-port=20048/udpfirewall-cmd --reload NFS å®‰è£…ï¼šå®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627# å®‰è£… nfs-utils å’Œ rpcbindï¼Œå®‰è£…åä¸éœ€è¦å¯åŠ¨ nfs-server æœåŠ¡ï¼Œåªéœ€è¦å¯åŠ¨ rpcbind æœåŠ¡ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½è¦è¿è¡Œsudo dnf install rpcbind nfs-utils -ysudo systemctl start rpcbind &amp;&amp; systemctl enable rpcbind# æŸ¥çœ‹æœåŠ¡å™¨çš„å…±äº«èµ„æºåˆ—è¡¨# showmount -e &lt;nfs-server-ip&gt;$ showmount -e 10.211.55.88Export list for 10.211.55.88:/nfs-server/data *# åˆ›å»º å®¢æˆ·ç«¯æŒ‚è½½ç›®å½•mkdir -p /nfs/data# æŒ‚è½½mount -t nfs 10.211.55.88:/nfs-server/data /nfs/data# æŸ¥çœ‹æŒ‚è½½ç‚¹$ mount | grep nfs/data10.211.55.88:/nfs-server/data on /nfs/data type nfs4 (rw,relatime,vers=4.2,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.211.55.11,local_lock=none,addr=10.211.55.88)# æŸ¥çœ‹æŒ‚è½½ç‚¹ä¿¡æ¯ï¼Œè¿™ç§æ–¹å¼æ›´å‹å¥½$ df -t nfs4Filesystem 1K-blocks Used Available Use% Mounted on10.211.55.88:/nfs-server/data 42872832 3630080 39242752 9% /nfs/data# é…ç½®è‡ªåŠ¨æŒ‚è½½echo &quot;10.211.55.88:/nfs-server/data /nfs/data nfs defaults 0 0&quot; &gt;&gt; /etc/fstab# æ ¹æ® /etc/fstab æ–‡ä»¶çš„é…ç½®ï¼Œå°è¯•æŒ‚è½½æ‰€æœ‰æœªæŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿã€‚ä¿®æ”¹ /etc/fstab åæ‰§è¡Œ mount -a ç«‹å³ç”Ÿæ•ˆmount -a å®¢æˆ·ç«¯æŒ‚è½½çš„ç›®å½•ä¸èƒ½åˆ é™¤ï¼Œéœ€è¦å…ˆå¸è½½ 1234567# -f å¼ºåˆ¶å¸è½½umount -f /nfs/datavim /etc/fstab# åˆ é™¤æˆ–æ³¨é‡Šæ‰å¯¹åº”çš„ NFS æŒ‚è½½è¡Œrm -rf /nfs/data","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» linux ä¸‹ nfs æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ä¸ä½¿ç”¨ æœ¬æ–‡åŸºäºCentOS8(x86_64)","date_published":"2025-07-21T15:34:05.000Z","tags":["æŠ€æœ¯","linux","nfs","linux","nfs"]},{"id":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-hostpath/","url":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-hostpath/","title":"K8S ä¹‹ å­˜å‚¨å· hostPath","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· hostPath ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å­˜å‚¨å·-hostPath-ä»‹ç»\">å­˜å‚¨å· hostPath ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>hostPath æ˜¯ä¸€ç§ç›´æ¥æŠŠ Node èŠ‚ç‚¹æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½• æŒ‚è½½åˆ° Pod å®¹å™¨é‡Œçš„å­˜å‚¨å·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®¹æ˜“ç ´åèŠ‚ç‚¹ç¯å¢ƒï¼Œä¸å»ºè®®ç”Ÿäº§ä½¿ç”¨</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŒä¸€ä¸ª Deployment çš„å¤šä¸ª Pod è¢«è°ƒåº¦åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”å®ƒä»¬çš„ hostPath é…ç½®æŒ‡å‘ç›¸åŒçš„å®¿ä¸»æœºè·¯å¾„ï¼Œè¿™äº› Pod ä¹‹é—´æ˜¯å¯ä»¥å…±äº«è¯¥ç›®å½•ä¸­æ–‡ä»¶çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…¸å‹ä½¿ç”¨åœºæ™¯</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ—¥å¿—æ”¶é›†</td>\n<td>æŒ‚è½½ <code>/var/log</code> åˆ° Pod å†…éƒ¨</td>\n</tr>\n<tr>\n<td>æŒ‚è½½å®¿ä¸»æœºé…ç½®æ–‡ä»¶</td>\n<td>å¦‚æŒ‚è½½ <code>/etc/hosts</code>ã€<code>/etc/localtime</code></td>\n</tr>\n<tr>\n<td>ä½¿ç”¨å®¿ä¸»æœº docker.sock</td>\n<td>æŒ‚è½½ <code>/var/run/docker.sock</code> è¿è¡Œ Docker-in-Docker</td>\n</tr>\n<tr>\n<td>å­˜å‚¨è°ƒè¯•ä¸´æ—¶æ–‡ä»¶</td>\n<td>Pod è°ƒè¯•æ—¶è®¿é—®å®¿ä¸»æœºç‰¹å®šç›®å½•</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod å†…éƒ¨ /mnt/hostdata æ˜ å°„åˆ°å®¿ä¸»æœº /data ç›®å½•</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">hostpath-example</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;sleep 3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span>                   <span class=\"comment\"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/mnt/hostdata</span>      <span class=\"comment\"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /mnt/hostdata ç›®å½•</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">myvolume</span>                <span class=\"comment\"># å­˜å‚¨å·åç§° ï¼Œä¸ volumes ä¸­å®šä¹‰çš„ volume é…ç½®åç§°ä¸€è‡´</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span>                          <span class=\"comment\"># å­˜å‚¨å·å£°æ˜</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myvolume</span>                  <span class=\"comment\"># å­˜å‚¨å·åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">hostPath:</span>                       <span class=\"comment\"># å­˜å‚¨å·ç±»å‹ï¼Œè¿™é‡Œæ˜¯ hostPath</span></span><br><span class=\"line\">      <span class=\"attr\">path:</span> <span class=\"string\">/data</span>                   <span class=\"comment\"># ä¸»æœºç›®å½•</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">Directory</span>               <span class=\"comment\"># å¯é€‰å­—æ®µï¼Œä¸»è¦ç”¨äºæŒ‚è½½å‰éªŒè¯</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>hostPath.type</code> å¯ä»¥é…ç½®çš„å€¼å¦‚ä¸‹ï¼Œé»˜è®¤ä¸º ç©ºã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>type</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>DirectoryOrCreate</code></td>\n<td>å¦‚æœ <code>/data</code> ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º ï¼Œæƒé™ä¸º 0755</td>\n</tr>\n<tr>\n<td><code>Directory</code></td>\n<td>å¿…é¡»å­˜åœ¨ä¸”ä¸ºç›®å½•</td>\n</tr>\n<tr>\n<td><code>File</code></td>\n<td>å¿…é¡»å­˜åœ¨ä¸”ä¸ºæ–‡ä»¶</td>\n</tr>\n<tr>\n<td><code>Socket</code></td>\n<td>å¿…é¡»æ˜¯ socket</td>\n</tr>\n<tr>\n<td><code>CharDevice</code></td>\n<td>å­—ç¬¦è®¾å¤‡</td>\n</tr>\n<tr>\n<td><code>BlockDevice</code></td>\n<td>å—è®¾å¤‡</td>\n</tr>\n<tr>\n<td><code>FileOrCreate</code></td>\n<td>ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºç©ºæ–‡ä»¶ï¼Œæƒé™è®¾ç½®ä¸º 0644</td>\n</tr>\n<tr>\n<td><code>ä¸è®¾ç½®</code></td>\n<td>é»˜è®¤å€¼æ˜¯ç©ºï¼Œä¸»æœºä¸Šçš„è·¯å¾„æ— è®ºæ˜¯æ–‡ä»¶ã€ç›®å½•ã€ç”šè‡³ä¸å­˜åœ¨ï¼Œéƒ½ä¼šç›´æ¥æŒ‚è½½ ,å®¹æ˜“å¼•èµ·é¢„æœŸä¹‹å¤–çš„æŒ‚è½½é—®é¢˜</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubernetes åœ¨åˆ é™¤ Pod æ—¶ï¼Œä¸ä¼šåˆ é™¤ hostPath æ‰€æŒ‚è½½çš„å®¿ä¸»æœºç›®å½•æˆ–æ–‡ä»¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å­˜å‚¨å·ç±»å‹</th>\n<th>åˆ é™¤ Pod åç›®å½•ä¼šè¢«åˆ é™¤å—ï¼Ÿ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>emptyDir</code></td>\n<td>âœ… <strong>ä¼šè¢«åˆ é™¤</strong></td>\n<td>ä¸´æ—¶ç›®å½•ï¼ŒPod ç”Ÿå‘½å‘¨æœŸç»“æŸè‡ªåŠ¨æ¸…ç†</td>\n</tr>\n<tr>\n<td><code>hostPath</code></td>\n<td>âŒ <strong>ä¸ä¼šåˆ é™¤</strong></td>\n<td>å®¿ä¸»æœºè·¯å¾„ç‹¬ç«‹äº Pod ç”Ÿå‘½å‘¨æœŸï¼Œ<strong>ä¸ä¼šæ¸…ç†</strong></td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· hostPath ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github å­˜å‚¨å· hostPath ä»‹ç» hostPath æ˜¯ä¸€ç§ç›´æ¥æŠŠ Node èŠ‚ç‚¹æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½• æŒ‚è½½åˆ° Pod å®¹å™¨é‡Œçš„å­˜å‚¨å·ã€‚ å®¹æ˜“ç ´åèŠ‚ç‚¹ç¯å¢ƒï¼Œä¸å»ºè®®ç”Ÿäº§ä½¿ç”¨ åŒä¸€ä¸ª Deployment çš„å¤šä¸ª Pod è¢«è°ƒåº¦åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”å®ƒä»¬çš„ hostPath é…ç½®æŒ‡å‘ç›¸åŒçš„å®¿ä¸»æœºè·¯å¾„ï¼Œè¿™äº› Pod ä¹‹é—´æ˜¯å¯ä»¥å…±äº«è¯¥ç›®å½•ä¸­æ–‡ä»¶çš„ã€‚ å…¸å‹ä½¿ç”¨åœºæ™¯ åœºæ™¯ ç¤ºä¾‹ æ—¥å¿—æ”¶é›† æŒ‚è½½ /var/log åˆ° Pod å†…éƒ¨ æŒ‚è½½å®¿ä¸»æœºé…ç½®æ–‡ä»¶ å¦‚æŒ‚è½½ /etc/hostsã€/etc/localtime ä½¿ç”¨å®¿ä¸»æœº docker.sock æŒ‚è½½ /var/run/docker.sock è¿è¡Œ Docker-in-Docker å­˜å‚¨è°ƒè¯•ä¸´æ—¶æ–‡ä»¶ Pod è°ƒè¯•æ—¶è®¿é—®å®¿ä¸»æœºç‰¹å®šç›®å½• ç¤ºä¾‹ Pod å†…éƒ¨ /mnt/hostdata æ˜ å°„åˆ°å®¿ä¸»æœº /data ç›®å½• 1234567891011121314151617apiVersion: v1kind: Podmetadata: name: hostpath-examplespec: containers: - name: busybox image: busybox command: [&quot;sh&quot;, &quot;-c&quot;, &quot;sleep 3600&quot;] volumeMounts: # å­˜å‚¨å·æŒ‚è½½ç‚¹ - mountPath: /mnt/hostdata # æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /mnt/hostdata ç›®å½• name: myvolume # å­˜å‚¨å·åç§° ï¼Œä¸ volumes ä¸­å®šä¹‰çš„ volume é…ç½®åç§°ä¸€è‡´ volumes: # å­˜å‚¨å·å£°æ˜ - name: myvolume # å­˜å‚¨å·åç§° hostPath: # å­˜å‚¨å·ç±»å‹ï¼Œè¿™é‡Œæ˜¯ hostPath path: /data # ä¸»æœºç›®å½• type: Directory # å¯é€‰å­—æ®µï¼Œä¸»è¦ç”¨äºæŒ‚è½½å‰éªŒè¯ hostPath.type å¯ä»¥é…ç½®çš„å€¼å¦‚ä¸‹ï¼Œé»˜è®¤ä¸º ç©ºã€‚ type å«ä¹‰ DirectoryOrCreate å¦‚æœ /data ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º ï¼Œæƒé™ä¸º 0755 Directory å¿…é¡»å­˜åœ¨ä¸”ä¸ºç›®å½• File å¿…é¡»å­˜åœ¨ä¸”ä¸ºæ–‡ä»¶ Socket å¿…é¡»æ˜¯ socket CharDevice å­—ç¬¦è®¾å¤‡ BlockDevice å—è®¾å¤‡ FileOrCreate ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºç©ºæ–‡ä»¶ï¼Œæƒé™è®¾ç½®ä¸º 0644 ä¸è®¾ç½® é»˜è®¤å€¼æ˜¯ç©ºï¼Œä¸»æœºä¸Šçš„è·¯å¾„æ— è®ºæ˜¯æ–‡ä»¶ã€ç›®å½•ã€ç”šè‡³ä¸å­˜åœ¨ï¼Œéƒ½ä¼šç›´æ¥æŒ‚è½½ ,å®¹æ˜“å¼•èµ·é¢„æœŸä¹‹å¤–çš„æŒ‚è½½é—®é¢˜ Kubernetes åœ¨åˆ é™¤ Pod æ—¶ï¼Œä¸ä¼šåˆ é™¤ hostPath æ‰€æŒ‚è½½çš„å®¿ä¸»æœºç›®å½•æˆ–æ–‡ä»¶ å­˜å‚¨å·ç±»å‹ åˆ é™¤ Pod åç›®å½•ä¼šè¢«åˆ é™¤å—ï¼Ÿ è¯´æ˜ emptyDir âœ… ä¼šè¢«åˆ é™¤ ä¸´æ—¶ç›®å½•ï¼ŒPod ç”Ÿå‘½å‘¨æœŸç»“æŸè‡ªåŠ¨æ¸…ç† hostPath âŒ ä¸ä¼šåˆ é™¤ å®¿ä¸»æœºè·¯å¾„ç‹¬ç«‹äº Pod ç”Ÿå‘½å‘¨æœŸï¼Œä¸ä¼šæ¸…ç†","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· hostPath ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-21T15:33:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-emptydir/","url":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-emptydir/","title":"K8S ä¹‹ å­˜å‚¨å· emptyDir","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· emptyDir ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å­˜å‚¨å·-emptyDir-ä»‹ç»\">å­˜å‚¨å· emptyDir ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>emptyDir æ˜¯ Kubernetes ä¸­æœ€ç®€å•çš„ä¸€ç§ Pod çº§åˆ«çš„ä¸´æ—¶å­˜å‚¨å·ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼šPod ç”Ÿå‘½å‘¨æœŸå†…å…±äº«ä¸´æ—¶å­˜å‚¨ï¼ŒPod åˆ é™¤åæ•°æ®è‡ªåŠ¨ä¸¢å¼ƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŒä¸€ä¸ª Pod å†…çš„å¤šä¸ªå®¹å™¨å¯ä»¥é€šè¿‡ emptyDir å…±äº«æ•°æ®ã€‚è·¨ Pod ä¸å…±äº«ï¼Œé€‚ç”¨äºä¸´æ—¶æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>emptyDir åªèƒ½æŒ‚è½½ç›®å½•ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸¤ä¸ªå®¹å™¨ app å’Œ sidecar é€šè¿‡ /data å…±äº«ä¸€ä¸ª emptyDir å·ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># shared-emptydir-pod.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">shared-emptydir-pod</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app.sto:</span> <span class=\"string\">emptydir</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;echo Hello &gt; /data1/hello; sleep 3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span>               <span class=\"comment\"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-data</span>         <span class=\"comment\"># æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸‹é¢ volumes ä¸­å®šä¹‰çš„ volume åç§°ä¸€è‡´</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/data1</span>          <span class=\"comment\"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data1 ç›®å½•</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">sidecar</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;sleep 3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span>               <span class=\"comment\"># å­˜å‚¨å·æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-data</span>         <span class=\"comment\"># æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸Šé¢å®¹å™¨ä¸­çš„ volume é…ç½®åç§°ä¸€è‡´</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/data2</span>         <span class=\"comment\"># æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data2 ç›®å½•</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span>                      <span class=\"comment\"># å­˜å‚¨å·å£°æ˜</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-data</span>           <span class=\"comment\"># å­˜å‚¨å·åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">emptyDir:</span> &#123;&#125;                <span class=\"comment\"># å£°æ˜ä¸º emptyDir å­˜å‚¨å·</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">k apply -f shared-emptydir-pod.yaml</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹podæ‰€åœ¨èŠ‚ç‚¹</span></span><br><span class=\"line\">$ k get pod -l app.sto=emptydir</span><br><span class=\"line\">NAME                  READY   STATUS    RESTARTS   AGE   IP              NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">shared-emptydir-pod   2/2     Running   0          22m   10.244.126.59   k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ pod-uid</span></span><br><span class=\"line\">$ kubectl get pod shared-emptydir-pod -o jsonpath=<span class=\"string\">&#x27;&#123;.metadata.uid&#125;&#x27;</span></span><br><span class=\"line\">d597b4d7-e6b6-4522-887e-73d3f4c01006</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>emptyDir å­˜å‚¨å· é»˜è®¤ä½¿ç”¨èŠ‚ç‚¹æœ¬åœ°ç£ç›˜ï¼Œè·¯å¾„ä¸º <code>/var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt;</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç™»å½• k8s-worker2 èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> POD_UID=d597b4d7-e6b6-4522-887e-73d3f4c01006</span><br><span class=\"line\"><span class=\"built_in\">export</span> POD_UID=6ea6636c-4a24-4dc5-af2a-2448825913b6</span><br><span class=\"line\"><span class=\"built_in\">export</span> VOLUME_NAME=shared-data</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /var/lib/kubelet/pods/<span class=\"variable\">$POD_UID</span>/volumes/kubernetes.io~empty-dir/<span class=\"variable\">$VOLUME_NAME</span></span><br><span class=\"line\">$ <span class=\"built_in\">ls</span></span><br><span class=\"line\">hello</span><br><span class=\"line\">$ <span class=\"built_in\">cat</span> hello</span><br><span class=\"line\">Hello</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿›å…¥å®¹å™¨æŸ¥çœ‹å­˜å‚¨å·å†…å®¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> -it shared-emptydir-pod -c app -- <span class=\"built_in\">cat</span> /data1/hello</span><br><span class=\"line\">Hello</span><br><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> -it shared-emptydir-pod -c sidecar -- <span class=\"built_in\">cat</span> /data2/hello</span><br><span class=\"line\">Hello</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å†…å®¹ï¼Œå®é™…ä¸Šåœ¨å®¹å™¨å†…éƒ¨å’Œå¤–éƒ¨éƒ½å¯ä»¥ä¿®æ”¹å­˜å‚¨å·å†…å®¹ï¼Œä¿®æ”¹åç«‹åˆ»ç”Ÿæ•ˆ</span></span><br><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> -it shared-emptydir-pod -c sidecar -- sh -c <span class=\"string\">&quot;echo &#x27;Hello World&#x27; &gt; /data2/hello&quot;</span></span><br><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> -it shared-emptydir-pod -c app -- <span class=\"built_in\">cat</span> /data1/hello</span><br><span class=\"line\">Hello World</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤PODåemptydirå­˜å‚¨å·ä¼šç«‹åˆ»åˆ é™¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete pod shared-emptydir-pod</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½• k8s-worker2 èŠ‚ç‚¹æŸ¥çœ‹ emptydir å­˜å‚¨å·</span></span><br><span class=\"line\">$ <span class=\"built_in\">ls</span> /var/lib/kubelet/pods/<span class=\"variable\">$POD_UID</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span>: cannot access <span class=\"string\">&#x27;/var/lib/kubelet/pods/d597b4d7-e6b6-4522-887e-73d3f4c01006&#x27;</span>: No such file or directory</span><br></pre></td></tr></table></figure>\n<h2 id=\"å°†-emptydir-å­˜å‚¨å·æ”¹ç”¨-å†…å­˜-å­˜å‚¨\">å°† emptydir å­˜å‚¨å·æ”¹ç”¨ å†…å­˜ å­˜å‚¨</h2>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">emptyDir:</span></span><br><span class=\"line\">  <span class=\"attr\">medium:</span> <span class=\"string\">Memory</span>        <span class=\"comment\"># ä½¿ç”¨ å†…å­˜ å­˜å‚¨ï¼ˆtmpfsï¼‰ï¼Œé€‚åˆé«˜ IO ä¸´æ—¶ç¼“å­˜</span></span><br><span class=\"line\">  <span class=\"attr\">sizeLimit:</span> <span class=\"string\">512Mi</span>      <span class=\"comment\"># é™åˆ¶å­˜å‚¨å¤§å°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„ï¼Œå³ä½¿è¿™é‡Œä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œä½†æ˜¯ <code>/var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt;</code> ä¾ç„¶å­˜åœ¨ï¼Œä½†å®ƒæŒ‚è½½çš„æ˜¯ tmpfs æ–‡ä»¶ç³»ç»Ÿ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç™»å½•podæ‰€åœ¨èŠ‚ç‚¹æŸ¥çœ‹æŒ‚è½½ç‚¹</span></span><br><span class=\"line\">$ mount | grep <span class=\"variable\">$POD_UID</span></span><br><span class=\"line\">tmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~empty-dir/shared-data <span class=\"built_in\">type</span> tmpfs (rw,relatime,size=524288k)</span><br><span class=\"line\">tmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~projected/kube-api-access-5nk7d <span class=\"built_in\">type</span> tmpfs (rw,relatime,size=3903212k)</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>å·ç±»å‹</th>\n<th>æ¥æº</th>\n<th>æŒ‚è½½è·¯å¾„</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>emptyDir</td>\n<td>ä½ é…ç½®çš„</td>\n<td><code>/data1</code>, <code>/data2</code></td>\n<td>Pod å†…éƒ¨å®¹å™¨å…±äº«ä¸´æ—¶å†…å­˜å­˜å‚¨</td>\n</tr>\n<tr>\n<td>projected</td>\n<td>ç³»ç»Ÿè‡ªåŠ¨</td>\n<td><code>/var/run/secrets/kubernetes.io/serviceaccount/</code></td>\n<td>æŒ‚è½½ serviceaccount tokenï¼ŒCA è¯ä¹¦</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å®¹å™¨å†…æŒ‚è½½ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> shared-emptydir-pod -c app -- mount | grep /data1</span><br><span class=\"line\">tmpfs on /data1 <span class=\"built_in\">type</span> tmpfs (rw,relatime,size=524288k)</span><br><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> shared-emptydir-pod -c app -- mount | grep serviceaccount</span><br><span class=\"line\">tmpfs on /var/run/secrets/kubernetes.io/serviceaccount <span class=\"built_in\">type</span> tmpfs (ro,relatime,size=3903212k)</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· emptyDir ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github å­˜å‚¨å· emptyDir ä»‹ç» emptyDir æ˜¯ Kubernetes ä¸­æœ€ç®€å•çš„ä¸€ç§ Pod çº§åˆ«çš„ä¸´æ—¶å­˜å‚¨å·ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼šPod ç”Ÿå‘½å‘¨æœŸå†…å…±äº«ä¸´æ—¶å­˜å‚¨ï¼ŒPod åˆ é™¤åæ•°æ®è‡ªåŠ¨ä¸¢å¼ƒã€‚ åŒä¸€ä¸ª Pod å†…çš„å¤šä¸ªå®¹å™¨å¯ä»¥é€šè¿‡ emptyDir å…±äº«æ•°æ®ã€‚è·¨ Pod ä¸å…±äº«ï¼Œé€‚ç”¨äºä¸´æ—¶æ•°æ®ã€‚ emptyDir åªèƒ½æŒ‚è½½ç›®å½•ã€‚ ç¤ºä¾‹ ä¸¤ä¸ªå®¹å™¨ app å’Œ sidecar é€šè¿‡ /data å…±äº«ä¸€ä¸ª emptyDir å·ã€‚ 123456789101112131415161718192021222324# shared-emptydir-pod.yamlapiVersion: v1kind: Podmetadata: name: shared-emptydir-pod labels: app.sto: emptydirspec: containers: - name: app image: busybox command: [&quot;sh&quot;, &quot;-c&quot;, &quot;echo Hello &gt; /data1/hello; sleep 3600&quot;] volumeMounts: # å­˜å‚¨å·æŒ‚è½½ç‚¹ - name: shared-data # æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸‹é¢ volumes ä¸­å®šä¹‰çš„ volume åç§°ä¸€è‡´ mountPath: /data1 # æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data1 ç›®å½• - name: sidecar image: busybox command: [&quot;sh&quot;, &quot;-c&quot;, &quot;sleep 3600&quot;] volumeMounts: # å­˜å‚¨å·æŒ‚è½½ç‚¹ - name: shared-data # æŒ‚è½½ç‚¹åç§°ï¼Œä¸ä¸Šé¢å®¹å™¨ä¸­çš„ volume é…ç½®åç§°ä¸€è‡´ mountPath: /data2 # æŒ‚è½½ç‚¹è·¯å¾„ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„ /data2 ç›®å½• volumes: # å­˜å‚¨å·å£°æ˜ - name: shared-data # å­˜å‚¨å·åç§° emptyDir: &#123;&#125; # å£°æ˜ä¸º emptyDir å­˜å‚¨å· åˆ›å»º 12345678k apply -f shared-emptydir-pod.yaml# æŸ¥çœ‹podæ‰€åœ¨èŠ‚ç‚¹$ k get pod -l app.sto=emptydirNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESshared-emptydir-pod 2/2 Running 0 22m 10.244.126.59 k8s-worker2 &lt;none&gt; &lt;none&gt;# æŸ¥çœ‹ pod-uid$ kubectl get pod shared-emptydir-pod -o jsonpath=&#x27;&#123;.metadata.uid&#125;&#x27;d597b4d7-e6b6-4522-887e-73d3f4c01006 emptyDir å­˜å‚¨å· é»˜è®¤ä½¿ç”¨èŠ‚ç‚¹æœ¬åœ°ç£ç›˜ï¼Œè·¯å¾„ä¸º /var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt; 123456789# ç™»å½• k8s-worker2 èŠ‚ç‚¹export POD_UID=d597b4d7-e6b6-4522-887e-73d3f4c01006export POD_UID=6ea6636c-4a24-4dc5-af2a-2448825913b6export VOLUME_NAME=shared-datacd /var/lib/kubelet/pods/$POD_UID/volumes/kubernetes.io~empty-dir/$VOLUME_NAME$ lshello$ cat helloHello è¿›å…¥å®¹å™¨æŸ¥çœ‹å­˜å‚¨å·å†…å®¹ 123456789$ kubectl exec -it shared-emptydir-pod -c app -- cat /data1/helloHello$ kubectl exec -it shared-emptydir-pod -c sidecar -- cat /data2/helloHello# ä¿®æ”¹å†…å®¹ï¼Œå®é™…ä¸Šåœ¨å®¹å™¨å†…éƒ¨å’Œå¤–éƒ¨éƒ½å¯ä»¥ä¿®æ”¹å­˜å‚¨å·å†…å®¹ï¼Œä¿®æ”¹åç«‹åˆ»ç”Ÿæ•ˆ$ kubectl exec -it shared-emptydir-pod -c sidecar -- sh -c &quot;echo &#x27;Hello World&#x27; &gt; /data2/hello&quot;$ kubectl exec -it shared-emptydir-pod -c app -- cat /data1/helloHello World åˆ é™¤PODåemptydirå­˜å‚¨å·ä¼šç«‹åˆ»åˆ é™¤ 12345kubectl delete pod shared-emptydir-pod# ç™»å½• k8s-worker2 èŠ‚ç‚¹æŸ¥çœ‹ emptydir å­˜å‚¨å·$ ls /var/lib/kubelet/pods/$POD_UIDls: cannot access &#x27;/var/lib/kubelet/pods/d597b4d7-e6b6-4522-887e-73d3f4c01006&#x27;: No such file or directory å°† emptydir å­˜å‚¨å·æ”¹ç”¨ å†…å­˜ å­˜å‚¨ 123emptyDir: medium: Memory # ä½¿ç”¨ å†…å­˜ å­˜å‚¨ï¼ˆtmpfsï¼‰ï¼Œé€‚åˆé«˜ IO ä¸´æ—¶ç¼“å­˜ sizeLimit: 512Mi # é™åˆ¶å­˜å‚¨å¤§å° è¿™é‡Œè¦æ³¨æ„ï¼Œå³ä½¿è¿™é‡Œä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œä½†æ˜¯ /var/lib/kubelet/pods/&lt;pod-uid&gt;/volumes/kubernetes.io~empty-dir/&lt;volume-name&gt; ä¾ç„¶å­˜åœ¨ï¼Œä½†å®ƒæŒ‚è½½çš„æ˜¯ tmpfs æ–‡ä»¶ç³»ç»Ÿ 1234# ç™»å½•podæ‰€åœ¨èŠ‚ç‚¹æŸ¥çœ‹æŒ‚è½½ç‚¹$ mount | grep $POD_UIDtmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~empty-dir/shared-data type tmpfs (rw,relatime,size=524288k)tmpfs on /var/lib/kubelet/pods/6ea6636c-4a24-4dc5-af2a-2448825913b6/volumes/kubernetes.io~projected/kube-api-access-5nk7d type tmpfs (rw,relatime,size=3903212k) å·ç±»å‹ æ¥æº æŒ‚è½½è·¯å¾„ ä½œç”¨ emptyDir ä½ é…ç½®çš„ /data1, /data2 Pod å†…éƒ¨å®¹å™¨å…±äº«ä¸´æ—¶å†…å­˜å­˜å‚¨ projected ç³»ç»Ÿè‡ªåŠ¨ /var/run/secrets/kubernetes.io/serviceaccount/ æŒ‚è½½ serviceaccount tokenï¼ŒCA è¯ä¹¦ æŸ¥çœ‹å®¹å™¨å†…æŒ‚è½½ç‚¹ 1234$ kubectl exec shared-emptydir-pod -c app -- mount | grep /data1tmpfs on /data1 type tmpfs (rw,relatime,size=524288k)$ kubectl exec shared-emptydir-pod -c app -- mount | grep serviceaccounttmpfs on /var/run/secrets/kubernetes.io/serviceaccount type tmpfs (ro,relatime,size=3903212k)","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ å­˜å‚¨å· emptyDir ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-21T15:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/20/k8s-statefulset/","url":"https://blog.hanqunfeng.com/2025/07/20/k8s-statefulset/","title":"K8S ä¹‹ Statefulset","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ Statefulset ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/\">k8s Statefulset ä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Statefulset-ä»‹ç»\">Statefulset ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Statefulset(ç¼©å†™ä¸º sts) æ˜¯ K8S å®˜æ–¹æä¾›çš„ä¸€ç§æ§åˆ¶å™¨ï¼Œç”¨äºç®¡ç†æœ‰çŠ¶æ€åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“åº”ç”¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç­‰ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Statefulset(æœ‰çŠ¶æ€) ä¸ Deployment(æ— çŠ¶æ€) çš„åŒºåˆ«æ˜¯ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Statefulset åˆ›å»ºçš„ Pod ä¼šæœ‰ç›¸åŒçš„åç§°ï¼Œå¹¶ä¸”ä¼šåˆ†é…ç›¸åŒçš„æŒä¹…å·ã€‚</li>\n<li class=\"lvl-4\">Statefulset åˆ›å»ºçš„ Pod ä½¿ç”¨ Headless Service(æ— å¤´æœåŠ¡ï¼Œæ²¡æœ‰ClusterIP)è¿›è¡Œé€šä¿¡ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Statefulset-ç®¡ç†\">Statefulset ç®¡ç†</h2>\n<h3 id=\"Statefulset-åˆ›å»º\">Statefulset åˆ›å»º</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Statefulset åªèƒ½ é€šè¿‡ <code>yaml</code> åˆ›å»ºï¼Œä¸æ”¯æŒ <code>create</code> åˆ›å»º</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªç®€å•çš„ <code>redis-statefulset.yaml</code> æ–‡ä»¶è¯´æ˜</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span>                      <span class=\"comment\"># apiç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span>                       <span class=\"comment\"># èµ„æºç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span>                           <span class=\"comment\"># å…ƒæ•°æ®</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">redis-svc</span>                   <span class=\"comment\"># serviceåç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">sts-ns</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                               <span class=\"comment\"># é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span>                            <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">6379</span>                      <span class=\"comment\"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span>                   <span class=\"comment\"># åè®®</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">6379</span>                <span class=\"comment\"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                         <span class=\"comment\"># é€‰æ‹©å™¨</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                      <span class=\"comment\"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis</span></span><br><span class=\"line\">  <span class=\"attr\">clusterIP:</span> <span class=\"string\">None</span>                   <span class=\"comment\"># é›†ç¾¤IPè®¾ç½®ä¸ºNoneï¼Œå³ä¸ºâ€œHeadless Serviceâ€</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">ClusterIP</span>                   <span class=\"comment\"># æœåŠ¡ç±»å‹ï¼Œé»˜è®¤ä¸ºClusterIP</span></span><br><span class=\"line\"><span class=\"string\">---</span>                                 <span class=\"comment\"># åˆ†å‰²çº¿</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span>                  <span class=\"comment\"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span>                    <span class=\"comment\"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">redis-sts</span>                    <span class=\"comment\"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">sts-ns</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                                <span class=\"comment\"># é…ç½®é¡¹</span></span><br><span class=\"line\">  <span class=\"attr\">revisionHistoryLimit:</span> <span class=\"number\">10</span>           <span class=\"comment\"># ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                          <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span>                     <span class=\"comment\"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                     <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">updateStrategy:</span>                    <span class=\"comment\"># æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ ·</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">RollingUpdate</span>              <span class=\"comment\"># 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚</span></span><br><span class=\"line\">                                     <span class=\"comment\"># 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span>                   <span class=\"comment\"># æ»šåŠ¨å‡çº§çš„é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">partition:</span> <span class=\"number\">0</span>                    <span class=\"comment\"># ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§</span></span><br><span class=\"line\">  <span class=\"attr\">serviceName:</span> <span class=\"string\">redis-svc</span>             <span class=\"comment\"># æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">2</span>                        <span class=\"comment\"># å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span>                          <span class=\"comment\"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                   <span class=\"comment\"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">redis:6.2</span>             <span class=\"comment\"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">redis</span>                  <span class=\"comment\"># å®¹å™¨çš„åç§°ï¼Œå®é™…çš„åç§°ä¸º sts-redis-&lt;number&gt;ï¼Œä» 0 å¼€å§‹é€’å¢</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class=\"line\">kubectl create namespace sts-ns</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º StatefulSet</span></span><br><span class=\"line\">kubectl apply -f redis-statefulset.yaml</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-Statefulset\">æŸ¥çœ‹ Statefulset</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get all -n sts-ns</span><br><span class=\"line\">NAME              READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">pod/redis-sts-0   1/1     Running   0          40s</span><br><span class=\"line\">pod/redis-sts-1   1/1     Running   0          24s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span><br><span class=\"line\">service/redis-svc   ClusterIP   None         &lt;none&gt;        6379/TCP   40s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                         READY   AGE</span><br><span class=\"line\">statefulset.apps/redis-sts   2/2     40s</span><br></pre></td></tr></table></figure>\n<h3 id=\"è®¿é—®podä¸­çš„redisæœåŠ¡\">è®¿é—®podä¸­çš„redisæœåŠ¡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ—¢ç„¶æ˜¯Headless Serviceï¼Œå°±åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ç›¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>serviceName</code> ç›´æ¥è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ <code>&lt;pod-name&gt;.&lt;service-name&gt;</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ä¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>&lt;serviceName&gt;.&lt;namespace&gt;</code> æˆ–è€… <code>&lt;serviceName&gt;.&lt;namespace&gt;.svc.cluster.local</code> è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ <code>&lt;pod-name&gt;.&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</code> è®¿é—®ï¼Œå› ä¸º pod-name æ˜¯å›ºå®šä¸”å”¯ä¸€çš„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-svc</span><br><span class=\"line\">10.244.126.55   redis-svc.sts-ns.svc.cluster.local</span><br><span class=\"line\">10.244.194.110  redis-svc.sts-ns.svc.cluster.local</span><br><span class=\"line\"></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-sts-1.redis-svc</span><br><span class=\"line\">10.244.126.55   redis-sts-1.redis-svc.sts-ns.svc.cluster.local</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ Serviceï¼Œç±»å‹ä¸º NodePort æˆ–è€… LoadBalancerï¼Œå°†redisæœåŠ¡æš´éœ²å‡ºå»</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span>                      <span class=\"comment\"># apiç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span>                       <span class=\"comment\"># èµ„æºç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span>                           <span class=\"comment\"># å…ƒæ•°æ®</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">redis-svc-out</span>               <span class=\"comment\"># serviceåç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">sts-ns</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                               <span class=\"comment\"># é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span>                            <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">6379</span>                      <span class=\"comment\"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span>                   <span class=\"comment\"># åè®®</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">6379</span>                <span class=\"comment\"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                         <span class=\"comment\"># é€‰æ‹©å™¨</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                      <span class=\"comment\"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">LoadBalancer</span>                <span class=\"comment\"># è´Ÿè½½å‡è¡¡</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º</span></span><br><span class=\"line\">$ k create -f redis-svc-out.yaml</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹</span></span><br><span class=\"line\">$ k get svc -n sts-ns</span><br><span class=\"line\">NAME            TYPE           CLUSTER-IP    EXTERNAL-IP     PORT(S)          AGE</span><br><span class=\"line\">redis-svc       ClusterIP      None          &lt;none&gt;          6379/TCP         70m</span><br><span class=\"line\">redis-svc-out   LoadBalancer   10.96.21.96   10.211.55.202   6379:31806/TCP   54m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨é›†ç¾¤å¤–çš„æœºå™¨ä¸Šè®¿é—® redisï¼Œæ¯æ¬¡è¿æ¥ä¼šè½®è¯¢è®¿é—®å„ä¸ªpod</span></span><br><span class=\"line\">$ redis-cli -h 10.211.55.202 info server | grep redis_version</span><br><span class=\"line\">redis_version:8.0.3</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-Statefulset-è¯¦æƒ…\">æŸ¥çœ‹ Statefulset è¯¦æƒ…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“ Statefulset è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ Statefulset çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå› </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl describe sts &lt;sts-name&gt;</span><br><span class=\"line\">kubectl describe sts &lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ é™¤-Statefulset\">åˆ é™¤ Statefulset</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete sts &lt;sts-name&gt;</span><br><span class=\"line\">kubectl delete sts &lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡ yaml æ–‡ä»¶åˆ é™¤</span></span><br><span class=\"line\">kubectl delete -f &lt;yaml-file&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹-Statefulset-æ—¥å¿—\">æŸ¥çœ‹ Statefulset æ—¥å¿—</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl logs sts/&lt;sts-name&gt;</span><br><span class=\"line\">kubectl logs sts/&lt;sts-name&gt; -n &lt;namespace-name&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ»šåŠ¨å‡çº§ä¸å›æ»š-Statefulset\">æ»šåŠ¨å‡çº§ä¸å›æ»š Statefulset</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹ <code>RollingUpdate</code> ç±»å‹çš„ <code>Statefulset</code> çš„ <code>.spec.template</code> çš„ä»»ä½•æ›´æ–°éƒ½å°†è§¦å‘æ»šåŠ¨æ›´æ–°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬ä¿®æ”¹è¿‡ <code>Statefulset</code> çš„ <code>.spec.template</code>ï¼Œå¹¶ä¿å­˜åï¼Œé‡æ–°è¿è¡Œ <code>kubectl apply -f &lt;yaml-file&gt;</code>å³å¯è§¦å‘æ»šåŠ¨å‡çº§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæ˜¯æ›´æ–°å®¹å™¨çš„é•œåƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è§¦å‘æ»šåŠ¨å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it pod/redis-sts-0 -n sts-ns -- redis-server -v</span><br><span class=\"line\">Redis server v=6.2.19 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=c51c65e7ae83f735</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># kubectl set image sts/&lt;sts-name&gt; &lt;container-name&gt;=&lt;image&gt;:&lt;tag&gt; --record=true</span></span><br><span class=\"line\">kubectl <span class=\"built_in\">set</span> image sts redis-sts redis=redis:8.0 --record=<span class=\"literal\">true</span> -n sts-ns</span><br><span class=\"line\"></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it pod/redis-sts-0 -n sts-ns -- redis-server -v</span><br><span class=\"line\">Redis server v=8.0.3 sha=00000000:1 malloc=jemalloc-5.3.0 bits=64 build=d4cb0aa008da4ca9</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ»šåŠ¨å‡çº§çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># kubectl rollout status sts/&lt;sts-name&gt;</span></span><br><span class=\"line\">$ kubectl rollout status sts redis-sts -n sts-ns</span><br><span class=\"line\">partitioned roll out complete: 2 new pods have been updated...</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å†å²ç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‰é¢çš„åºå·è¡¨ç¤ºç‰ˆæœ¬å·</span></span><br><span class=\"line\">kubectl rollout <span class=\"built_in\">history</span> sts redis-sts -n sts-ns</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„è¯¦æƒ…</span></span><br><span class=\"line\">kubectl rollout <span class=\"built_in\">history</span> sts redis-sts -n sts-ns --revision=1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å›æ»š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å›é€€åˆ°å‰ä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class=\"line\">kubectl rollout undo sts redis-sts -n sts-ns</span><br><span class=\"line\"><span class=\"comment\"># å›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ --to-revision=1 è¡¨ç¤ºå›åˆ°ç‰ˆæœ¬1</span></span><br><span class=\"line\">kubectl rollout undo sts redis-sts -n sts-nsx --to-revision=1</span><br></pre></td></tr></table></figure>\n<h2 id=\"Deployment-å’Œ-StatefulSet-çš„å¯¹æ¯”æ€»ç»“\">Deployment å’Œ StatefulSet çš„å¯¹æ¯”æ€»ç»“</h2>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th><strong>Deployment</strong></th>\n<th><strong>StatefulSet</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç”¨é€”</strong></td>\n<td>æ— çŠ¶æ€åº”ç”¨ï¼ˆå¦‚ Web æœåŠ¡ã€API æœåŠ¡ï¼‰</td>\n<td>æœ‰çŠ¶æ€åº”ç”¨ï¼ˆå¦‚æ•°æ®åº“ã€ç¼“å­˜ï¼šRedisã€MySQLã€Kafkaï¼‰</td>\n</tr>\n<tr>\n<td><strong>Pod åç§°</strong></td>\n<td>Pod åå­—éšæœºç”Ÿæˆï¼Œå¦‚ <code>nginx-abc123</code></td>\n<td>Pod åå­—æœ‰åºï¼Œæ ¼å¼ä¸º <code>name-0</code>ã€<code>name-1</code>ã€<code>name-2</code></td>\n</tr>\n<tr>\n<td><strong>ç¨³å®šçš„æ ‡è¯†</strong></td>\n<td><strong>ä¸æä¾›</strong>ï¼Œæ¯æ¬¡é‡å»º Pod åå­—å¯èƒ½ä¸åŒ</td>\n<td><strong>æä¾›</strong>ï¼Œæ¯ä¸ª Pod çš„åå­—ã€ç½‘ç»œ IDã€å­˜å‚¨æŒä¹…åŒ–ä¸å˜</td>\n</tr>\n<tr>\n<td><strong>å­˜å‚¨å·</strong></td>\n<td>é€šå¸¸é…åˆ PVCï¼Œä½† Pod é‡å»ºæ—¶æŒ‚è½½å·å¯èƒ½å˜åŒ–</td>\n<td>é…ç½® <code>volumeClaimTemplates</code>ï¼Œæ¯ä¸ª Pod ç‹¬ç«‹æŒä¹…å·</td>\n</tr>\n<tr>\n<td><strong>æ»šåŠ¨æ›´æ–°ç­–ç•¥</strong></td>\n<td>æ”¯æŒ <code>maxSurge</code>ã€<code>maxUnavailable</code>ï¼Œå¯å¹¶è¡Œæ›´æ–° Pod</td>\n<td>é»˜è®¤ <strong>é€ä¸ªé¡ºåºæ›´æ–°</strong> Podï¼ˆå¯ç”¨ <code>partition</code> æ§åˆ¶åˆ†æ‰¹æ›´æ–°ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å¯ç”¨æ€§</strong></td>\n<td>é€šå¸¸è®¾è®¡ä¸º <strong>æ— çŠ¶æ€å¤šå‰¯æœ¬é«˜å¯ç”¨</strong>ï¼Œä¸ä¿è¯ Pod å¯åŠ¨é¡ºåºæˆ–å›ºå®š IP</td>\n<td><strong>æœ‰çŠ¶æ€ä¸”æœ‰åºéƒ¨ç½²ã€åˆ é™¤ã€æ›´æ–°</strong>ï¼Œé€šå¸¸å•å‰¯æœ¬é€ä¸ªç»´æŠ¤å¯ç”¨æ€§</td>\n</tr>\n<tr>\n<td><strong>æœåŠ¡è®¿é—®</strong></td>\n<td>é€šè¿‡ ClusterIPã€NodePortã€LoadBalancer è®¿é—®</td>\n<td>æ¨èç”¨ <strong>Headless Service (clusterIP: None)</strong>ï¼ŒPod æœ‰å›ºå®š DNS</td>\n</tr>\n<tr>\n<td><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></td>\n<td>Web åº”ç”¨ã€REST APIã€æ— çŠ¶æ€å¾®æœåŠ¡</td>\n<td>æ•°æ®åº“ï¼ˆMySQLã€PostgreSQLï¼‰ã€ç¼“å­˜ï¼ˆRedisï¼‰ã€é˜Ÿåˆ—ï¼ˆKafkaã€RabbitMQï¼‰</td>\n</tr>\n<tr>\n<td><strong>Pod ä¼¸ç¼©ç‰¹æ€§</strong></td>\n<td><strong>çµæ´»ä¼¸ç¼©</strong>ï¼Œå¢åŠ /å‡å°‘å‰¯æœ¬æ— ç‰¹å®šé¡ºåº</td>\n<td><strong>æœ‰åºä¼¸ç¼©</strong>ï¼Œ<code>name-0</code> -&gt; <code>name-1</code> -&gt; <code>name-2</code>â€¦</td>\n</tr>\n<tr>\n<td><strong>é‡å»ºç­–ç•¥</strong></td>\n<td>Pod å´©æºƒåé‡å»ºçš„æ˜¯æ–° Podï¼Œæ— æŒä¹…å­˜å‚¨æ•°æ®å¯èƒ½ä¸¢å¤±</td>\n<td>Pod å´©æºƒåé‡å»ºçš„æ˜¯ç›¸åŒ Pod åå­—ï¼ŒæŒ‚è½½ç›¸åŒ PVCï¼Œä¸ä¸¢æ•°æ®</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>StatefulSet ç±»ä¼¼äº Deploymentï¼ŒåŒæ ·æ”¯æŒæ‰©ç¼©å®¹ï¼ˆscale æˆ–è€… hpaï¼‰ï¼Œä½†å› ä¸ºå…¶æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæ‰€ä»¥éœ€è°¨æ…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># scale</span></span><br><span class=\"line\">kubectl scale sts redis-sts --replicas=5 -n sts-ns</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># hpaï¼Œè¦æ±‚podé…ç½®ä¸­æœ‰èµ„æºé™åˆ¶</span></span><br><span class=\"line\">kubectl autoscale sts redis-sts --name=<span class=\"string\">&quot;hpa-redis&quot;</span> --cpu-percent=50 --min=3 --max=10 -n sts-ns</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>æ“ä½œ</th>\n<th><strong>å¯è¡Œæ€§</strong></th>\n<th><strong>æ¨èæƒ…å†µ</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ‰©å®¹ï¼ˆå¢åŠ å‰¯æœ¬æ•°ï¼‰</strong></td>\n<td>âœ… <strong>æ¨è</strong></td>\n<td>å®‰å…¨ï¼Œæ–°å¢ Pod æŒ‰åºä» N-1 å¼€å§‹åˆ›å»ºï¼ˆ<code>sts-name-0</code> -&gt; <code>sts-name-1</code> -&gt; <code>sts-name-2</code>ï¼‰</td>\n</tr>\n<tr>\n<td><strong>ç¼©å®¹ï¼ˆå‡å°‘å‰¯æœ¬æ•°ï¼‰</strong></td>\n<td>âš ï¸ <strong>å°å¿ƒä½¿ç”¨</strong></td>\n<td>å¯èƒ½å¯¼è‡´ Pod åŠå…¶å…³è” PVC è¢«åºŸå¼ƒï¼Œ<strong>æ•°æ®å¯èƒ½ä¸¢å¤±</strong></td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Statefulset ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Statefulset ä»‹ç» Statefulset ä»‹ç» Statefulset(ç¼©å†™ä¸º sts) æ˜¯ K8S å®˜æ–¹æä¾›çš„ä¸€ç§æ§åˆ¶å™¨ï¼Œç”¨äºç®¡ç†æœ‰çŠ¶æ€åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“åº”ç”¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç­‰ç­‰ã€‚ Statefulset(æœ‰çŠ¶æ€) ä¸ Deployment(æ— çŠ¶æ€) çš„åŒºåˆ«æ˜¯ï¼š Statefulset åˆ›å»ºçš„ Pod ä¼šæœ‰ç›¸åŒçš„åç§°ï¼Œå¹¶ä¸”ä¼šåˆ†é…ç›¸åŒçš„æŒä¹…å·ã€‚ Statefulset åˆ›å»ºçš„ Pod ä½¿ç”¨ Headless Service(æ— å¤´æœåŠ¡ï¼Œæ²¡æœ‰ClusterIP)è¿›è¡Œé€šä¿¡ã€‚ Statefulset ç®¡ç† Statefulset åˆ›å»º Statefulset åªèƒ½ é€šè¿‡ yaml åˆ›å»ºï¼Œä¸æ”¯æŒ create åˆ›å»º ä¸€ä¸ªç®€å•çš„ redis-statefulset.yaml æ–‡ä»¶è¯´æ˜ 12345678910111213141516171819202122232425262728293031323334353637383940apiVersion: v1 # apiç‰ˆæœ¬kind: Service # èµ„æºç±»å‹metadata: # å…ƒæ•°æ® name: redis-svc # serviceåç§° namespace: sts-nsspec: # é…ç½® ports: # ç«¯å£ - port: 6379 # é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡» protocol: TCP # åè®® targetPort: 6379 # å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´ selector: # é€‰æ‹©å™¨ app: redis # podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis clusterIP: None # é›†ç¾¤IPè®¾ç½®ä¸ºNoneï¼Œå³ä¸ºâ€œHeadless Serviceâ€ type: ClusterIP # æœåŠ¡ç±»å‹ï¼Œé»˜è®¤ä¸ºClusterIP--- # åˆ†å‰²çº¿apiVersion: apps/v1 # æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æºkind: StatefulSet # Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰metadata: name: redis-sts # èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰ namespace: sts-nsspec: # é…ç½®é¡¹ revisionHistoryLimit: 10 # ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚ selector: # é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod matchLabels: # æ ‡ç­¾é€‰æ‹©å™¨ app: redis # é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰ updateStrategy: # æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ · type: RollingUpdate # 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚ # 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚ rollingUpdate: # æ»šåŠ¨å‡çº§çš„é…ç½® partition: 0 # ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§ serviceName: redis-svc # æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹ replicas: 2 # å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1 template: # æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½® metadata: labels: app: redis # Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´ spec: containers: - image: redis:6.2 # å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ name: redis # å®¹å™¨çš„åç§°ï¼Œå®é™…çš„åç§°ä¸º sts-redis-&lt;number&gt;ï¼Œä» 0 å¼€å§‹é€’å¢ æ‰§è¡Œåˆ›å»º 1234# åˆ›å»ºå‘½åç©ºé—´kubectl create namespace sts-ns# åˆ›å»º StatefulSetkubectl apply -f redis-statefulset.yaml æŸ¥çœ‹ Statefulset 12345678910$ k get all -n sts-nsNAME READY STATUS RESTARTS AGEpod/redis-sts-0 1/1 Running 0 40spod/redis-sts-1 1/1 Running 0 24sNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/redis-svc ClusterIP None &lt;none&gt; 6379/TCP 40sNAME READY AGEstatefulset.apps/redis-sts 2/2 40s è®¿é—®podä¸­çš„redisæœåŠ¡ æ—¢ç„¶æ˜¯Headless Serviceï¼Œå°±åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—® åœ¨ç›¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ serviceName ç›´æ¥è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ &lt;pod-name&gt;.&lt;service-name&gt; åœ¨ä¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ &lt;serviceName&gt;.&lt;namespace&gt; æˆ–è€… &lt;serviceName&gt;.&lt;namespace&gt;.svc.cluster.local è®¿é—®ï¼Œè®¿é—®æŒ‡å®šçš„ podï¼Œå¯ä»¥é€šè¿‡ &lt;pod-name&gt;.&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local è®¿é—®ï¼Œå› ä¸º pod-name æ˜¯å›ºå®šä¸”å”¯ä¸€çš„ 123456$ k exec -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-svc10.244.126.55 redis-svc.sts-ns.svc.cluster.local10.244.194.110 redis-svc.sts-ns.svc.cluster.local$ k exec -it pod/redis-sts-0 -n sts-ns -- getent hosts redis-sts-1.redis-svc10.244.126.55 redis-sts-1.redis-svc.sts-ns.svc.cluster.local åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ Serviceï¼Œç±»å‹ä¸º NodePort æˆ–è€… LoadBalancerï¼Œå°†redisæœåŠ¡æš´éœ²å‡ºå» 12345678910111213apiVersion: v1 # apiç‰ˆæœ¬kind: Service # èµ„æºç±»å‹metadata: # å…ƒæ•°æ® name: redis-svc-out # serviceåç§° namespace: sts-nsspec: # é…ç½® ports: # ç«¯å£ - port: 6379 # é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡» protocol: TCP # åè®® targetPort: 6379 # å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´ selector: # é€‰æ‹©å™¨ app: redis # podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=redis type: LoadBalancer # è´Ÿè½½å‡è¡¡ æ‰§è¡Œ 1234567891011# åˆ›å»º$ k create -f redis-svc-out.yaml# æŸ¥çœ‹$ k get svc -n sts-nsNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEredis-svc ClusterIP None &lt;none&gt; 6379/TCP 70mredis-svc-out LoadBalancer 10.96.21.96 10.211.55.202 6379:31806/TCP 54m# åœ¨é›†ç¾¤å¤–çš„æœºå™¨ä¸Šè®¿é—® redisï¼Œæ¯æ¬¡è¿æ¥ä¼šè½®è¯¢è®¿é—®å„ä¸ªpod$ redis-cli -h 10.211.55.202 info server | grep redis_versionredis_version:8.0.3 æŸ¥çœ‹ Statefulset è¯¦æƒ… å½“ Statefulset è¿è¡Œé”™è¯¯æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹ Statefulset çš„è¯¦æƒ…ï¼Œæ‰¾åˆ°é”™è¯¯åŸå›  12kubectl describe sts &lt;sts-name&gt;kubectl describe sts &lt;sts-name&gt; -n &lt;namespace-name&gt; åˆ é™¤ Statefulset 12345kubectl delete sts &lt;sts-name&gt;kubectl delete sts &lt;sts-name&gt; -n &lt;namespace-name&gt;# é€šè¿‡ yaml æ–‡ä»¶åˆ é™¤kubectl delete -f &lt;yaml-file&gt; æŸ¥çœ‹ Statefulset æ—¥å¿— 12kubectl logs sts/&lt;sts-name&gt;kubectl logs sts/&lt;sts-name&gt; -n &lt;namespace-name&gt; æ»šåŠ¨å‡çº§ä¸å›æ»š Statefulset å¯¹ RollingUpdate ç±»å‹çš„ Statefulset çš„ .spec.template çš„ä»»ä½•æ›´æ–°éƒ½å°†è§¦å‘æ»šåŠ¨æ›´æ–°ã€‚ æˆ‘ä»¬ä¿®æ”¹è¿‡ Statefulset çš„ .spec.templateï¼Œå¹¶ä¿å­˜åï¼Œé‡æ–°è¿è¡Œ kubectl apply -f &lt;yaml-file&gt;å³å¯è§¦å‘æ»šåŠ¨å‡çº§ã€‚ å¦‚æœåªæ˜¯æ›´æ–°å®¹å™¨çš„é•œåƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è§¦å‘æ»šåŠ¨å‡çº§ 12345678$ k exec -it pod/redis-sts-0 -n sts-ns -- redis-server -vRedis server v=6.2.19 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=c51c65e7ae83f735# kubectl set image sts/&lt;sts-name&gt; &lt;container-name&gt;=&lt;image&gt;:&lt;tag&gt; --record=truekubectl set image sts redis-sts redis=redis:8.0 --record=true -n sts-ns$ k exec -it pod/redis-sts-0 -n sts-ns -- redis-server -vRedis server v=8.0.3 sha=00000000:1 malloc=jemalloc-5.3.0 bits=64 build=d4cb0aa008da4ca9 æŸ¥çœ‹æ»šåŠ¨å‡çº§çŠ¶æ€ 123# kubectl rollout status sts/&lt;sts-name&gt;$ kubectl rollout status sts redis-sts -n sts-nspartitioned roll out complete: 2 new pods have been updated... æŸ¥çœ‹å†å²ç‰ˆæœ¬ 1234# å‰é¢çš„åºå·è¡¨ç¤ºç‰ˆæœ¬å·kubectl rollout history sts redis-sts -n sts-ns# æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬çš„è¯¦æƒ…kubectl rollout history sts redis-sts -n sts-ns --revision=1 å›æ»š 1234# å›é€€åˆ°å‰ä¸€ä¸ªç‰ˆæœ¬kubectl rollout undo sts redis-sts -n sts-ns# å›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™é‡Œ --to-revision=1 è¡¨ç¤ºå›åˆ°ç‰ˆæœ¬1kubectl rollout undo sts redis-sts -n sts-nsx --to-revision=1 Deployment å’Œ StatefulSet çš„å¯¹æ¯”æ€»ç»“ ç‰¹æ€§ Deployment StatefulSet ç”¨é€” æ— çŠ¶æ€åº”ç”¨ï¼ˆå¦‚ Web æœåŠ¡ã€API æœåŠ¡ï¼‰ æœ‰çŠ¶æ€åº”ç”¨ï¼ˆå¦‚æ•°æ®åº“ã€ç¼“å­˜ï¼šRedisã€MySQLã€Kafkaï¼‰ Pod åç§° Pod åå­—éšæœºç”Ÿæˆï¼Œå¦‚ nginx-abc123 Pod åå­—æœ‰åºï¼Œæ ¼å¼ä¸º name-0ã€name-1ã€name-2 ç¨³å®šçš„æ ‡è¯† ä¸æä¾›ï¼Œæ¯æ¬¡é‡å»º Pod åå­—å¯èƒ½ä¸åŒ æä¾›ï¼Œæ¯ä¸ª Pod çš„åå­—ã€ç½‘ç»œ IDã€å­˜å‚¨æŒä¹…åŒ–ä¸å˜ å­˜å‚¨å· é€šå¸¸é…åˆ PVCï¼Œä½† Pod é‡å»ºæ—¶æŒ‚è½½å·å¯èƒ½å˜åŒ– é…ç½® volumeClaimTemplatesï¼Œæ¯ä¸ª Pod ç‹¬ç«‹æŒä¹…å· æ»šåŠ¨æ›´æ–°ç­–ç•¥ æ”¯æŒ maxSurgeã€maxUnavailableï¼Œå¯å¹¶è¡Œæ›´æ–° Pod é»˜è®¤ é€ä¸ªé¡ºåºæ›´æ–° Podï¼ˆå¯ç”¨ partition æ§åˆ¶åˆ†æ‰¹æ›´æ–°ï¼‰ å¯ç”¨æ€§ é€šå¸¸è®¾è®¡ä¸º æ— çŠ¶æ€å¤šå‰¯æœ¬é«˜å¯ç”¨ï¼Œä¸ä¿è¯ Pod å¯åŠ¨é¡ºåºæˆ–å›ºå®š IP æœ‰çŠ¶æ€ä¸”æœ‰åºéƒ¨ç½²ã€åˆ é™¤ã€æ›´æ–°ï¼Œé€šå¸¸å•å‰¯æœ¬é€ä¸ªç»´æŠ¤å¯ç”¨æ€§ æœåŠ¡è®¿é—® é€šè¿‡ ClusterIPã€NodePortã€LoadBalancer è®¿é—® æ¨èç”¨ Headless Service (clusterIP: None)ï¼ŒPod æœ‰å›ºå®š DNS å…¸å‹åº”ç”¨åœºæ™¯ Web åº”ç”¨ã€REST APIã€æ— çŠ¶æ€å¾®æœåŠ¡ æ•°æ®åº“ï¼ˆMySQLã€PostgreSQLï¼‰ã€ç¼“å­˜ï¼ˆRedisï¼‰ã€é˜Ÿåˆ—ï¼ˆKafkaã€RabbitMQï¼‰ Pod ä¼¸ç¼©ç‰¹æ€§ çµæ´»ä¼¸ç¼©ï¼Œå¢åŠ /å‡å°‘å‰¯æœ¬æ— ç‰¹å®šé¡ºåº æœ‰åºä¼¸ç¼©ï¼Œname-0 -&gt; name-1 -&gt; name-2â€¦ é‡å»ºç­–ç•¥ Pod å´©æºƒåé‡å»ºçš„æ˜¯æ–° Podï¼Œæ— æŒä¹…å­˜å‚¨æ•°æ®å¯èƒ½ä¸¢å¤± Pod å´©æºƒåé‡å»ºçš„æ˜¯ç›¸åŒ Pod åå­—ï¼ŒæŒ‚è½½ç›¸åŒ PVCï¼Œä¸ä¸¢æ•°æ® åè®° StatefulSet ç±»ä¼¼äº Deploymentï¼ŒåŒæ ·æ”¯æŒæ‰©ç¼©å®¹ï¼ˆscale æˆ–è€… hpaï¼‰ï¼Œä½†å› ä¸ºå…¶æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæ‰€ä»¥éœ€è°¨æ… 12345# scalekubectl scale sts redis-sts --replicas=5 -n sts-ns# hpaï¼Œè¦æ±‚podé…ç½®ä¸­æœ‰èµ„æºé™åˆ¶kubectl autoscale sts redis-sts --name=&quot;hpa-redis&quot; --cpu-percent=50 --min=3 --max=10 -n sts-ns æ“ä½œ å¯è¡Œæ€§ æ¨èæƒ…å†µ æ‰©å®¹ï¼ˆå¢åŠ å‰¯æœ¬æ•°ï¼‰ âœ… æ¨è å®‰å…¨ï¼Œæ–°å¢ Pod æŒ‰åºä» N-1 å¼€å§‹åˆ›å»ºï¼ˆsts-name-0 -&gt; sts-name-1 -&gt; sts-name-2ï¼‰ ç¼©å®¹ï¼ˆå‡å°‘å‰¯æœ¬æ•°ï¼‰ âš ï¸ å°å¿ƒä½¿ç”¨ å¯èƒ½å¯¼è‡´ Pod åŠå…¶å…³è” PVC è¢«åºŸå¼ƒï¼Œæ•°æ®å¯èƒ½ä¸¢å¤±","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Statefulset ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Statefulset ä»‹ç»","date_published":"2025-07-20T15:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/20/k8s-hpa/","url":"https://blog.hanqunfeng.com/2025/07/20/k8s-hpa/","title":"K8S ä¹‹ Horizontal Pod Autoscalerï¼ˆHPAï¼‰","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S ä¸­çš„ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/workloads/autoscaling/\">Autoscaling k8sç®€ä»‹</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale/\">Horizontal Pod Autoscalerï¼ˆHPAï¼‰</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Horizontal-Pod-Autoscalerï¼ˆHPAï¼‰-ç®€ä»‹\">Horizontal Pod Autoscalerï¼ˆHPAï¼‰ ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Horizontal Pod Autoscalerï¼ˆç¼©å†™ä¸º hpaï¼‰åŸºäºèµ„æº CPU åˆ©ç”¨ç‡è‡ªåŠ¨è°ƒæ•´ deploymentã€replication controller æˆ–è€… replica ä¸­ pod çš„æ•°é‡ï¼Œè¿™æœ‰åŠ©äºæ‚¨çš„åº”ç”¨ç¨‹åºè¿›è¡Œæ‰©å±•ä»¥æ»¡è¶³å¢é•¿çš„éœ€æ±‚ï¼Œæˆ–åœ¨ä¸éœ€è¦èµ„æºæ—¶è¿›è¡Œç¼©å‡ï¼Œä»è€Œé‡Šæ”¾å‡ºèŠ‚ç‚¹ç”¨äºå…¶ä»–åº”ç”¨ç¨‹åºã€‚å½“æ‚¨è®¾ç½®ç›®æ ‡ CPU åˆ©ç”¨ç‡ç™¾åˆ†æ¯”æ—¶ï¼ŒHPA æ‰©å±•æˆ–ç¼©å‡åº”ç”¨ç¨‹åºæ¥å°è¯•æ»¡è¶³è¯¥ç›®æ ‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kubernetes æœ¬èº«å·²ç»åŒ…å«äº† HPA çš„ controllerï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–çš„å®‰è£…æˆ–éƒ¨ç½²ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>HPA éœ€è¦è·å– metrics ä¿¡æ¯ï¼Œmetrics ä¿¡æ¯éœ€è¦ä» Metrics Server ä¸­è·å–ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®‰è£… Metrics Serverã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>HPA ä¼šå‘¨æœŸæ€§(é»˜è®¤15ç§’)æŸ¥è¯¢ç›®æ ‡èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œç„¶åå’Œ HPA ä¸­å®šä¹‰çš„å€¼åšæ¯”è¾ƒï¼Œå¹¶æ ¹æ®æ¯”è¾ƒç»“æœç›¸åº”çš„è°ƒæ•´ pod æ•°é‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºpodæ—¶ï¼Œå¿…é¡»ä¸ºå…¶è®¾å®šcpuèµ„æºï¼Œç”¨äºä¸ç›®æ ‡å€¼è¿›è¡Œæ¯”è¾ƒï¼Œç›®å‰æœ€æ–°çš„v2ç‰ˆæœ¬çš„HPAé™¤äº†æ”¯æŒCPUçš„å¯¹æ¯”ï¼Œè¿˜å¯ä»¥è®¾å®šå…¶å®ƒæŒ‡æ ‡ï¼Œå…·ä½“å‚è€ƒ<a href=\"https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/\">HorizontalPodAutoscaler æ¼”ç»ƒ</a>ä¸­çš„â€œåŸºäºå¤šé¡¹åº¦é‡æŒ‡æ ‡å’Œè‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡è‡ªåŠ¨æ‰©ç¼©â€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åšä¸»ä¹‹å‰å†™è¿‡ä¸€ç¯‡åœ¨awsçš„eksä¸­ä½¿ç”¨hpaçš„æ–‡ç«  <a href=\"/2023/07/17/aws-eks17-hpa/\" title=\"AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰\">AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰</a>ï¼Œå’Œåœ¨è‡ªå·±æ­å»º k8sé›†ç¾¤ ä¸­ä½¿ç”¨ hpa åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥æœ¬æ–‡ä¸å†å¯¹é‡å¤å†…å®¹è¿›è¡Œèµ˜è¿°ï¼Œå»ºè®®è¯»è€…å…ˆé˜…è¯» <a href=\"/2023/07/17/aws-eks17-hpa/\" title=\"AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰\">AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰</a>ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å®‰è£…-Metrics-Server\">å®‰è£… Metrics Server</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubernetes çš„ HPA æ˜¯ä¾èµ– Metrics API çš„ï¼Œé»˜è®¤å¹¶ä¸å†…ç½®ã€‚éœ€è¦é€šè¿‡ metrics-server æ¥æ”¶é›†å’Œæä¾›èŠ‚ç‚¹/Pod çš„èµ„æºç”¨é‡æ•°æ®ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£… <a href=\"https://github.com/kubernetes-sigs/metrics-server\">metrics-server</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ curl -L -o metrics-server.yaml https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span><br><span class=\"line\">$ kubectl apply -f metrics-server.yaml</span><br><span class=\"line\">serviceaccount/metrics-server created</span><br><span class=\"line\">clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created</span><br><span class=\"line\">clusterrole.rbac.authorization.k8s.io/system:metrics-server created</span><br><span class=\"line\">rolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created</span><br><span class=\"line\">service/metrics-server created</span><br><span class=\"line\">deployment.apps/metrics-server created</span><br><span class=\"line\">apiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éƒ¨ç½²åå‘ç°podæ²¡æœ‰è¿è¡ŒæˆåŠŸ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  k get all -n kube-system -l k8s-app=metrics-server</span><br><span class=\"line\">NAME                                  READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">pod/metrics-server-867d48dc9c-fgdjq   0/1     Running   0          16s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE</span><br><span class=\"line\">service/metrics-server   ClusterIP   10.96.91.221   &lt;none&gt;        443/TCP   16s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                             READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/metrics-server   0/1     1            0           16s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                        DESIRED   CURRENT   READY   AGE</span><br><span class=\"line\">replicaset.apps/metrics-server-867d48dc9c   1         1         0       16s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ£€æŸ¥æ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k logs deployment.apps/metrics-server -n kube-system</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç±»ä¼¼äº</span></span><br><span class=\"line\">E0703 23:02:38.120831       1 scraper.go:149] <span class=\"string\">&quot;Failed to scrape node&quot;</span> err=<span class=\"string\">&quot;Get \\&quot;https://10.211.55.15:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.15 because it doesn&#x27;t contain any IP SANs&quot;</span> node=<span class=\"string\">&quot;k8s-worker1&quot;</span></span><br><span class=\"line\">E0703 23:02:38.127774       1 scraper.go:149] <span class=\"string\">&quot;Failed to scrape node&quot;</span> err=<span class=\"string\">&quot;Get \\&quot;https://10.211.55.16:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.16 because it doesn&#x27;t contain any IP SANs&quot;</span> node=<span class=\"string\">&quot;k8s-worker2&quot;</span></span><br><span class=\"line\">E0703 23:02:38.140583       1 scraper.go:149] <span class=\"string\">&quot;Failed to scrape node&quot;</span> err=<span class=\"string\">&quot;Get \\&quot;https://10.211.55.11:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.11 because it doesn&#x27;t contain any IP SANs&quot;</span> node=<span class=\"string\">&quot;k8s-master&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ„æ€æ˜¯ metrics-server åœ¨é€šè¿‡ https://<node-ip>:10250 è¯·æ±‚ kubelet çš„æ—¶å€™ï¼Œå‘ç° kubelet çš„è¯ä¹¦ä¸åŒ…å«è¯¥ IP çš„ Subject Alternative Name (SAN)ï¼Œå› æ­¤ TLS æ ¡éªŒå¤±è´¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è§£å†³æ–¹æ¡ˆ: æ·»åŠ  --kubelet-insecure-tls å‚æ•°ï¼Œè·³è¿‡ kubelet çš„ TLS è¯ä¹¦æ ¡éªŒ(metrics-server æœ¬èº«æƒé™æœ‰é™ï¼Œé£é™©å¯æ§ï¼Œkubelet è‡ªç­¾è¯ä¹¦ç»´æŠ¤æˆæœ¬é«˜)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl edit deployment metrics-server -n kube-system</span><br><span class=\"line\"><span class=\"comment\">## åœ¨ args ä¸­æ·»åŠ  --kubelet-insecure-tls</span></span><br><span class=\"line\">  spec:</span><br><span class=\"line\">    containers:</span><br><span class=\"line\">    - args:</span><br><span class=\"line\">      - --cert-dir=/tmp</span><br><span class=\"line\">      - --secure-port=10250</span><br><span class=\"line\">      - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span><br><span class=\"line\">      - --kubelet-use-node-status-port</span><br><span class=\"line\">      - --metric-resolution=15s</span><br><span class=\"line\">      - --kubelet-insecure-tls   <span class=\"comment\"># æ·»åŠ æ­¤è¡Œ</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>wq</code>ä¿å­˜åï¼Œç­‰ä¸€ä¼šå†æ¬¡æŸ¥çœ‹æ‰€æœ‰èµ„æºå‡å·²æ­£å¸¸</p>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ‰€æœ‰ node çš„èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k top nodes</span><br><span class=\"line\">NAME          CPU(cores)   CPU(%)   MEMORY(bytes)   MEMORY(%)</span><br><span class=\"line\">k8s-master    216m         10%      1712Mi          44%</span><br><span class=\"line\">k8s-worker1   79m          3%       1025Mi          26%</span><br><span class=\"line\">k8s-worker2   82m          4%       982Mi           25%</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>NAME</strong></td>\n<td>èŠ‚ç‚¹åç§°ï¼ŒKubernetes é›†ç¾¤çš„èŠ‚ç‚¹åå­—ã€‚</td>\n</tr>\n<tr>\n<td><strong>CPU(cores)</strong></td>\n<td>å½“å‰èŠ‚ç‚¹ CPU çš„ç¬æ—¶ä½¿ç”¨é‡ï¼Œå•ä½æ˜¯æ ¸å¿ƒæ•°ï¼ˆCoreï¼‰ï¼Œæ¯”å¦‚ <code>216m</code> = 0.216 æ ¸å¿ƒã€‚<code>m</code> = <strong>millicores</strong>ï¼Œ1000m = 1æ ¸ã€‚</td>\n</tr>\n<tr>\n<td><strong>CPU(%)</strong></td>\n<td>å½“å‰ CPU ä½¿ç”¨ç‡ï¼Œç›¸å¯¹äºè¯¥èŠ‚ç‚¹ CPU æ€»æ ¸æ•°çš„ç™¾åˆ†æ¯”ã€‚æ¯”å¦‚ <code>10%</code> è¡¨ç¤ºèŠ‚ç‚¹ CPU çš„ 10% è¢«ä½¿ç”¨ã€‚</td>\n</tr>\n<tr>\n<td><strong>MEMORY(bytes)</strong></td>\n<td>èŠ‚ç‚¹å½“å‰ä½¿ç”¨çš„å†…å­˜ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼ˆä¾‹å¦‚ <code>1712Mi</code> = 1712 Mebibytes â‰ˆ 1.7 GBï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>MEMORY(%)</strong></td>\n<td>èŠ‚ç‚¹å†…å­˜ä½¿ç”¨ç‡ï¼Œå æ€»å†…å­˜çš„ç™¾åˆ†æ¯”ã€‚æ¯”å¦‚ <code>44%</code> è¡¨ç¤ºè¯¥èŠ‚ç‚¹å†…å­˜ä½¿ç”¨äº† 44%ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æ‰€æœ‰ pod çš„èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k top pods -A</span><br><span class=\"line\">NAMESPACE     NAME                                       CPU(cores)   MEMORY(bytes)</span><br><span class=\"line\">default       nginx-5869d7778c-5682r                     0m           9Mi</span><br><span class=\"line\">default       nginx-5869d7778c-thw8f                     0m           4Mi</span><br><span class=\"line\">kube-system   calico-kube-controllers-7bfdc5b57c-q5xwp   6m           35Mi</span><br><span class=\"line\">kube-system   calico-node-7pbbq                          42m          281Mi</span><br><span class=\"line\">kube-system   calico-node-v4hzr                          47m          260Mi</span><br><span class=\"line\">kube-system   calico-node-w47qq                          40m          263Mi</span><br><span class=\"line\">kube-system   coredns-674b8bbfcf-2tvld                   2m           23Mi</span><br><span class=\"line\">kube-system   coredns-674b8bbfcf-h6kx7                   2m           22Mi</span><br><span class=\"line\">kube-system   etcd-k8s-master                            27m          85Mi</span><br><span class=\"line\">kube-system   kube-apiserver-k8s-master                  49m          404Mi</span><br><span class=\"line\">kube-system   kube-controller-manager-k8s-master         28m          100Mi</span><br><span class=\"line\">kube-system   kube-proxy-nkbns                           1m           41Mi</span><br><span class=\"line\">kube-system   kube-proxy-plqw8                           1m           25Mi</span><br><span class=\"line\">kube-system   kube-proxy-sbgh6                           1m           34Mi</span><br><span class=\"line\">kube-system   kube-scheduler-k8s-master                  8m           38Mi</span><br><span class=\"line\">kube-system   metrics-server-56fb9549f4-rtt7n            4m           21Mi</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»º-HPA\">åˆ›å»º HPA</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‰é¢çš„æ–‡ç« ä¸­å¤šæ¬¡ä½¿ç”¨ nginx é•œåƒåˆ›å»ºäº† deploymentï¼Œä½†æ˜¯éƒ½æ²¡æœ‰é…ç½®è¿‡èµ„æºï¼Œä¸ºäº†æµ‹è¯• hpaï¼Œéœ€è¦ä¸ºå…¶æŒ‡å®šèµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›´æ¥ä¿®æ”¹ deploymentï¼Œæ”¹å˜ spec.templateï¼ŒPod ä¼šè¢«é‡å»ºã€‚ä¿å­˜åç«‹åˆ»ç”Ÿæ•ˆ</span></span><br><span class=\"line\">kubectl edit deployment nginx</span><br><span class=\"line\"><span class=\"comment\"># å¢åŠ èµ„æºé™åˆ¶</span></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  replicas: 1   <span class=\"comment\"># ä¿®æ”¹å‰¯æœ¬æ•°ä½ 1ï¼Œä»…æ”¹å˜ replicasï¼ŒPod ä¸ä¼šè¢«é‡å»º</span></span><br><span class=\"line\">  template:     <span class=\"comment\"># ä¿®æ”¹ templateï¼ŒPod ä¼šè¢«é‡å»º</span></span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: nginx</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">      - name: nginx</span><br><span class=\"line\">        image: nginx</span><br><span class=\"line\">        resources:</span><br><span class=\"line\">          limits:</span><br><span class=\"line\">            cpu: 500m</span><br><span class=\"line\">            memory: 500Mi</span><br><span class=\"line\">          requests:</span><br><span class=\"line\">            cpu: 200m</span><br><span class=\"line\">            memory: 200Mi</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º HPA</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºäº†ä¸€ä¸ªå«â€œhpa-nginxâ€çš„ HPAï¼Œé»˜è®¤ä¸ deployment çš„åç§°ç›¸åŒï¼Œå¯ä»¥ç”¨ --name=&#x27;hpa-nginx&#x27; æŒ‡å®šhpaçš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># replicas å˜åŠ¨èŒƒå›´æ˜¯æœ€å° 3ï¼Œæœ€å¤§ 10</span></span><br><span class=\"line\"><span class=\"comment\"># ç›®æ ‡cpuåˆ©ç”¨ç‡ä¸º 50%ï¼Œä¸Šé¢æˆ‘ä»¬è®¾å®š CPU request å€¼ä¸º 100mï¼Œæ‰€ä»¥å½“å¹³å‡cpuå€¼ä¸º 100m æ—¶å°±ä¼šè§¦å‘ autoscale</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè¯´å¹³å‡cpuï¼Œæ˜¯æŒ‡æ‰€æœ‰podçš„cpuåˆ©ç”¨ç‡çš„å¹³å‡å€¼</span></span><br><span class=\"line\">$ k autoscale deployment nginx --name=<span class=\"string\">&quot;hpa-nginx&quot;</span> --cpu-percent=50 --min=3 --max=10</span><br><span class=\"line\">horizontalpodautoscaler.autoscaling/hpa-nginx autoscaled</span><br><span class=\"line\"><span class=\"comment\"># è§‚å¯Ÿï¼Œå¤§çº¦ 15ç§’åï¼Œhpa-nginx å‘ç° replicas å€¼ä¸º1ï¼Œ30ç§’çš„æ—¶å€™è‡ªåŠ¨æ‰©å®¹åˆ°3ä¸ªï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®çš„hpaçš„replicasæœ€å°å€¼ä¸º3ï¼Œå¹¶ä¸”é‡‡é›†åˆ°äº†cpuä½¿ç”¨ç‡</span></span><br><span class=\"line\">$ k get hpa -w</span><br><span class=\"line\">NAME        REFERENCE          TARGETS              MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class=\"line\">hpa-nginx   Deployment/nginx   cpu: &lt;unknown&gt;/50%   3         10        0          0s</span><br><span class=\"line\">hpa-nginx   Deployment/nginx   cpu: &lt;unknown&gt;/50%   3         10        1          15s</span><br><span class=\"line\">hpa-nginx   Deployment/nginx   cpu: 0%/50%          3         10        3          30s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ymalæ–‡ä»¶åˆ›å»º HPA</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">autoscaling/v2</span>    <span class=\"comment\"># apiç‰ˆæœ¬ï¼Œè¿™é‡Œè®¾ç½®ä¸º v2</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">HorizontalPodAutoscaler</span> <span class=\"comment\"># èµ„æºç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">hpa-nginx</span>             <span class=\"comment\"># hpaèµ„æºåç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span>          <span class=\"comment\"># å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">maxReplicas:</span> <span class=\"number\">10</span>             <span class=\"comment\"># æœ€å¤§å‰¯æœ¬æ•°</span></span><br><span class=\"line\">  <span class=\"attr\">minReplicas:</span> <span class=\"number\">1</span>              <span class=\"comment\"># æœ€å°å‰¯æœ¬æ•°</span></span><br><span class=\"line\">  <span class=\"attr\">metrics:</span>                    <span class=\"comment\"># æŒ‡æ ‡è®¾å®š</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Resource</span>            <span class=\"comment\"># èµ„æºç±»å‹ï¼Œå¯ä»¥é…ç½®ä¸º Resource/Object/Pods</span></span><br><span class=\"line\">    <span class=\"attr\">resource:</span>                 <span class=\"comment\"># èµ„æºå¯¹è±¡</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">cpu</span>               <span class=\"comment\"># èµ„æºåç§° cpu/memory</span></span><br><span class=\"line\">      <span class=\"attr\">target:</span>                 <span class=\"comment\"># ç›®æ ‡å¯¹è±¡</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">Utilization</span>     <span class=\"comment\"># ç›®æ ‡ç±»å‹ï¼Œå¯ä»¥é…ç½®ä¸º Utilization/AverageValue/Value</span></span><br><span class=\"line\">        <span class=\"attr\">averageUtilization:</span> <span class=\"number\">50</span> <span class=\"comment\"># ç›®æ ‡å€¼ï¼Œè¿™é‡Œæ˜¯å¹³å‡ä½¿ç”¨ç‡çš„ç™¾åˆ†æ¯”</span></span><br><span class=\"line\">  <span class=\"attr\">scaleTargetRef:</span>             <span class=\"comment\"># æŒ‡å®šè¦è‡ªåŠ¨ä¼¸ç¼©çš„èµ„æºå¯¹è±¡</span></span><br><span class=\"line\">    <span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\">    <span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span>          <span class=\"comment\"># èµ„æºç±»å‹ä¸º Deployment</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>               <span class=\"comment\"># èµ„æºåç§°ä¸º nginx</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"HPA-æ”¯æŒçš„ç›‘æ§æŒ‡æ ‡ç±»å‹\">HPA æ”¯æŒçš„ç›‘æ§æŒ‡æ ‡ç±»å‹</h2>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>å­—æ®µå</th>\n<th>è¯´æ˜</th>\n<th>å¸¸è§ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Resource</strong></td>\n<td><code>resource</code></td>\n<td>åŸºäº Pod èµ„æºä½¿ç”¨æƒ…å†µï¼ˆCPUã€å†…å­˜ï¼‰ï¼Œæœ€å¸¸ç”¨</td>\n<td>æŒ‰ CPU åˆ©ç”¨ç‡è‡ªåŠ¨æ‰©ç¼©å®¹</td>\n</tr>\n<tr>\n<td><strong>Pods</strong></td>\n<td><code>pods</code></td>\n<td>åŸºäºæ¯ä¸ª Pod çš„è‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡çš„å¹³å‡å€¼ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹ç›‘æ§ç³»ç»Ÿæä¾›ï¼Œæ¯”å¦‚ Prometheus</td>\n<td>æŒ‰ä¸šåŠ¡æŒ‡æ ‡ï¼ˆå¦‚è¯·æ±‚æ•°ã€é˜Ÿåˆ—é•¿åº¦ï¼‰æ‰©ç¼©å®¹</td>\n</tr>\n<tr>\n<td><strong>Object</strong></td>\n<td><code>object</code></td>\n<td>åŸºäºå•ä¸ª Kubernetes å¯¹è±¡ï¼ˆå¦‚ Serviceã€Ingressï¼‰çš„æŒ‡æ ‡ï¼Œï¼Œæ¯”å¦‚ Prometheus</td>\n<td>æŒ‰æŸä¸ªå¯¹è±¡çš„æŒ‡æ ‡æ‰©ç¼©å®¹ï¼Œä¾‹å¦‚é˜Ÿåˆ—é•¿åº¦</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"Resource-èµ„æºæŒ‡æ ‡ï¼ˆCPU-å†…å­˜ï¼‰\">Resource èµ„æºæŒ‡æ ‡ï¼ˆCPU/å†…å­˜ï¼‰</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Utilization: åˆ©ç”¨ç‡ç™¾åˆ†æ¯”</p>\n</li>\n<li class=\"lvl-2\">\n<p>Utilization ä¸å…³å¿ƒ limitsï¼Œåªçœ‹ requestsã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœ resources.requests æ²¡æœ‰è®¾ç½®ï¼ŒHPA Utilization ä¼šæŠ¥é”™ï¼ˆé™¤é AverageValueï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">metrics:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Resource</span></span><br><span class=\"line\">  <span class=\"attr\">resource:</span>                   <span class=\"comment\"># èµ„æº æŒ‡æ ‡</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">cpu</span>                 <span class=\"comment\"># cpu</span></span><br><span class=\"line\">    <span class=\"attr\">target:</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">Utilization</span>       <span class=\"comment\"># åˆ©ç”¨ç‡ç™¾åˆ†æ¯”</span></span><br><span class=\"line\">      <span class=\"attr\">averageUtilization:</span> <span class=\"number\">50</span>  <span class=\"comment\"># 50%</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å½“å‰æœ‰ 3 ä¸ª Podï¼š</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>Pod</th>\n<th>CPU å®é™…ä½¿ç”¨</th>\n<th>CPU requests</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>pod-1</td>\n<td>150m</td>\n<td>200m</td>\n</tr>\n<tr>\n<td>pod-2</td>\n<td>100m</td>\n<td>200m</td>\n</tr>\n<tr>\n<td>pod-3</td>\n<td>50m</td>\n<td>200m</td>\n</tr>\n<tr>\n<td>åˆè®¡</td>\n<td>400m</td>\n<td>600m</td>\n</tr>\n<tr>\n<td><strong>å¹³å‡</strong></td>\n<td><strong>400m Ã· 600m Ã— 100% â‰ˆ 66.7%</strong></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ç”±äº 66.7% &gt; 50%ï¼Œä¼šæ‰©å®¹ï¼›å¦‚æœå°äº 50%ï¼ŒHPA ä¼šç¼©å®¹ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>AverageValue: æŒ‡å®šèµ„æºä½¿ç”¨å¹³å‡å€¼</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">metrics:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Resource</span></span><br><span class=\"line\">  <span class=\"attr\">resource:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">memory</span>                <span class=\"comment\"># ç›‘æ§èµ„æºç±»å‹ä¸º memoryï¼ˆå†…å­˜ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">target:</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">AverageValue</span>        <span class=\"comment\"># æŒ‡æ ‡ç±»å‹ä¸º AverageValueï¼Œè¡¨ç¤ºæ¯ä¸ª Pod å¹³å‡ä½¿ç”¨å¤šå°‘</span></span><br><span class=\"line\">      <span class=\"attr\">averageValue:</span> <span class=\"string\">400Mi</span>       <span class=\"comment\"># ç›®æ ‡å€¼ï¼šå¹³å‡æ¯ä¸ª Pod ä½¿ç”¨ 400Mi å†…å­˜</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å‡è®¾å½“å‰éƒ¨ç½²äº† 3 ä¸ªå‰¯æœ¬ï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>Pod</th>\n<th>å½“å‰å†…å­˜ä½¿ç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>pod-1</td>\n<td>450Mi</td>\n</tr>\n<tr>\n<td>pod-2</td>\n<td>400Mi</td>\n</tr>\n<tr>\n<td>pod-3</td>\n<td>300Mi</td>\n</tr>\n<tr>\n<td><strong>å¹³å‡</strong></td>\n<td><strong>(450+400+300)/3 = 383.3Mi</strong></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>å› ä¸º 383.3Mi &lt; 400Miï¼Œä¸è§¦å‘æ‰©å®¹ã€‚å¦‚æœå°†æ¥å¹³å‡ä½¿ç”¨è¶…è¿‡ 400Miï¼ŒHPA å°±ä¼šæ‰©å®¹ï¼Œåä¹‹ç¼©å®¹ã€‚</p>\n</blockquote>\n<h2 id=\"HPA-æ‰©ç¼©å®¹é€Ÿåº¦é…ç½®\">HPA æ‰©ç¼©å®¹é€Ÿåº¦é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>HPA çš„æ‰©ç¼©å®¹é€Ÿåº¦æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œé€šè¿‡ behavior å­—æ®µæ¥è‡ªå®šä¹‰æ‰©ç¼©å®¹çš„é€Ÿåº¦å’Œç­–ç•¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹æ˜¯é»˜è®¤ç­–ç•¥</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">behavior:</span></span><br><span class=\"line\">  <span class=\"attr\">scaleUp:</span>                                  <span class=\"comment\"># â¬†ï¸ æ‰©å®¹ç­–ç•¥</span></span><br><span class=\"line\">    <span class=\"attr\">tolerance:</span> <span class=\"number\">0.1</span>                          <span class=\"comment\"># å®¹å¿é˜ˆå€¼ï¼Œé»˜è®¤0.1(10%)ï¼Œè¡¨ç¤ºæ¯æ¬¡æ‰©å®¹æ—¶ï¼Œpodä½¿ç”¨ç‡è¶…è¿‡1.1å€ç›®æ ‡å€¼æ—¶æ‰ä¼šè¿›è¡Œæ‰©å®¹</span></span><br><span class=\"line\">    <span class=\"attr\">stabilizationWindowSeconds:</span> <span class=\"number\">0</span>           <span class=\"comment\"># é»˜è®¤0ï¼Œå³å¢åŠ æˆ–å‡å°‘podæ•°é‡åä¿æŒä¸å˜çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span></span><br><span class=\"line\">    <span class=\"attr\">policies:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Percent</span>                         <span class=\"comment\"># æ‰©å®¹é€Ÿåº¦æŒ‰ç™¾åˆ†æ¯”é™åˆ¶</span></span><br><span class=\"line\">      <span class=\"attr\">value:</span> <span class=\"number\">100</span>                            <span class=\"comment\"># æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 100% çš„å‰¯æœ¬æ•°</span></span><br><span class=\"line\">      <span class=\"attr\">periodSeconds:</span> <span class=\"number\">15</span>                     <span class=\"comment\"># æ¯ 15 ç§’è®¡ç®—ä¸€æ¬¡æ˜¯å¦å¯ä»¥æ‰©å®¹ï¼Œé»˜è®¤ 15 ç§’</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Pods</span>                            <span class=\"comment\"># æŒ‰å›ºå®š Pod æ•°é‡é™åˆ¶æ‰©å®¹é€Ÿåº¦</span></span><br><span class=\"line\">      <span class=\"attr\">value:</span> <span class=\"number\">4</span>                              <span class=\"comment\"># æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 4 ä¸ª Pod</span></span><br><span class=\"line\">      <span class=\"attr\">periodSeconds:</span> <span class=\"number\">15</span>                     <span class=\"comment\"># åŒæ · 15 ç§’è®¡ç®—ä¸€æ¬¡ï¼Œé»˜è®¤ 15 ç§’</span></span><br><span class=\"line\">    <span class=\"attr\">selectPolicy:</span> <span class=\"string\">Max</span>                       <span class=\"comment\"># å¤šä¸ª policy åŒæ—¶å­˜åœ¨æ—¶ï¼Œå– Percent å’Œ Pods çš„æœ€å¤§å€¼ã€‚Min å–æœ€å°å€¼</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">scaleDown:</span>                                <span class=\"comment\"># â¬‡ï¸ ç¼©å®¹ç­–ç•¥</span></span><br><span class=\"line\">    <span class=\"comment\"># selectPolicy: Disabled                  # ç¦ç”¨ç¼©å®¹</span></span><br><span class=\"line\">    <span class=\"attr\">stabilizationWindowSeconds:</span> <span class=\"number\">300</span>         <span class=\"comment\"># é»˜è®¤ 300ï¼Œå³å¢åŠ æˆ–å‡å°‘podæ•°é‡åä¿æŒä¸å˜çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œé˜²æ­¢å¿«é€Ÿç¼©å®¹ï¼ˆå¹³æ»‘ç­–ç•¥ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">policies:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Percent</span>                         <span class=\"comment\"># ç¼©å®¹é€Ÿåº¦æŒ‰ç™¾åˆ†æ¯”é™åˆ¶</span></span><br><span class=\"line\">      <span class=\"attr\">value:</span> <span class=\"number\">100</span>                            <span class=\"comment\"># æ¯ 15 ç§’æœ€å¤šç¼©å®¹ 100% çš„å‰¯æœ¬æ•°</span></span><br><span class=\"line\">      <span class=\"attr\">periodSeconds:</span> <span class=\"number\">15</span>                     <span class=\"comment\"># æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ˜¯å¦å¯ä»¥ç¼©å®¹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®Œæ•´çš„ HPA é…ç½®æ–‡ä»¶ç¤ºä¾‹(ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€ä¿®æ”¹æ‰©ç¼©å®¹é€Ÿåº¦çš„é…ç½®ï¼Œé»˜è®¤ç­–ç•¥æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯)</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">autoscaling/v2</span>                    <span class=\"comment\"># apiç‰ˆæœ¬ï¼Œä½¿ç”¨ v2 ç‰ˆæœ¬æ”¯æŒ behavior æ‰©ç¼©å®¹ç­–ç•¥</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">HorizontalPodAutoscaler</span>                 <span class=\"comment\"># èµ„æºç±»å‹ä¸º HPA</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">hpa-nginx</span>                             <span class=\"comment\"># HPA èµ„æºçš„åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span>                          <span class=\"comment\"># å‘½åç©ºé—´ï¼Œè®¾ç½®ä¸º default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">maxReplicas:</span> <span class=\"number\">10</span>                             <span class=\"comment\"># HPA è‡ªåŠ¨æ‰©å®¹çš„æœ€å¤§å‰¯æœ¬æ•°</span></span><br><span class=\"line\">  <span class=\"attr\">minReplicas:</span> <span class=\"number\">1</span>                              <span class=\"comment\"># HPA è‡ªåŠ¨ç¼©å®¹çš„æœ€å°å‰¯æœ¬æ•°</span></span><br><span class=\"line\">  <span class=\"attr\">metrics:</span>                                    <span class=\"comment\"># è‡ªåŠ¨ä¼¸ç¼©çš„æŒ‡æ ‡é…ç½®</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Resource</span>                            <span class=\"comment\"># æŒ‡æ ‡ç±»å‹ä¸º Resourceï¼ˆèµ„æºå‹ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">resource:</span>                                 <span class=\"comment\"># èµ„æºæŒ‡æ ‡å¯¹è±¡</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">cpu</span>                               <span class=\"comment\"># èµ„æºåç§°ä¸º cpuï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º memory</span></span><br><span class=\"line\">      <span class=\"attr\">target:</span>                                 <span class=\"comment\"># ç›®æ ‡æŒ‡æ ‡å¯¹è±¡</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">Utilization</span>                     <span class=\"comment\"># æŒ‡æ ‡ç±»å‹ä¸º Utilizationï¼ˆåˆ©ç”¨ç‡ç™¾åˆ†æ¯”ï¼‰</span></span><br><span class=\"line\">        <span class=\"attr\">averageUtilization:</span> <span class=\"number\">50</span>                <span class=\"comment\"># CPU å¹³å‡ä½¿ç”¨ç‡è¾¾åˆ° 50% æ—¶è¿›è¡Œæ‰©ç¼©å®¹</span></span><br><span class=\"line\">  <span class=\"attr\">scaleTargetRef:</span>                             <span class=\"comment\"># HPA ç»‘å®šçš„ç›®æ ‡èµ„æºå¯¹è±¡</span></span><br><span class=\"line\">    <span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\">    <span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span>                          <span class=\"comment\"># ç›®æ ‡ç±»å‹ä¸º Deployment</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                               <span class=\"comment\"># ç›®æ ‡ Deployment åç§°ä¸º nginx</span></span><br><span class=\"line\">  <span class=\"attr\">behavior:</span>                                   <span class=\"comment\"># â¬‡ï¸ æ‰©ç¼©å®¹è¡Œä¸ºæ§åˆ¶</span></span><br><span class=\"line\">    <span class=\"attr\">scaleUp:</span>                                  <span class=\"comment\"># æ‰©å®¹ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"attr\">stabilizationWindowSeconds:</span> <span class=\"number\">30</span>          <span class=\"comment\"># æ‰©å®¹å¹³æ»‘çª—å£ä¸º 30 ç§’ï¼Œé˜²æ­¢çŸ­æ—¶é—´æŠ–åŠ¨é¢‘ç¹æ‰©å®¹</span></span><br><span class=\"line\">      <span class=\"attr\">policies:</span>                               <span class=\"comment\"># æ‰©å®¹é€Ÿåº¦é™åˆ¶ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Percent</span>                         <span class=\"comment\"># æŒ‰ç™¾åˆ†æ¯”è®¡ç®—</span></span><br><span class=\"line\">        <span class=\"attr\">value:</span> <span class=\"number\">100</span>                            <span class=\"comment\"># æ¯ 15 ç§’å†…æœ€å¤šæ‰©å®¹ 100%</span></span><br><span class=\"line\">        <span class=\"attr\">periodSeconds:</span> <span class=\"number\">15</span>                     <span class=\"comment\"># æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ‰©å®¹é€Ÿç‡</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Pods</span>                            <span class=\"comment\"># æŒ‰å›ºå®š Pod æ•°é‡è®¡ç®—</span></span><br><span class=\"line\">        <span class=\"attr\">value:</span> <span class=\"number\">4</span>                              <span class=\"comment\"># æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 4 ä¸ª Pod</span></span><br><span class=\"line\">        <span class=\"attr\">periodSeconds:</span> <span class=\"number\">15</span>                     <span class=\"comment\"># æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ‰©å®¹é€Ÿç‡</span></span><br><span class=\"line\">      <span class=\"attr\">selectPolicy:</span> <span class=\"string\">Max</span>                       <span class=\"comment\"># å¦‚æœå¤šä¸ª policy åŒæ—¶æ»¡è¶³ï¼Œå–æœ€å¤§å€¼ï¼ˆæ›´æ¿€è¿›çš„æ‰©å®¹ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">scaleDown:</span>                                <span class=\"comment\"># ç¼©å®¹ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"attr\">stabilizationWindowSeconds:</span> <span class=\"number\">300</span>         <span class=\"comment\"># ç¼©å®¹å¹³æ»‘çª—å£ä¸º 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰ï¼Œé¿å…çŸ­æ—¶æµé‡é™ä½å¿«é€Ÿç¼©å®¹</span></span><br><span class=\"line\">      <span class=\"attr\">policies:</span>                               <span class=\"comment\"># ç¼©å®¹é€Ÿåº¦é™åˆ¶ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">type:</span> <span class=\"string\">Percent</span>                         <span class=\"comment\"># æŒ‰ç™¾åˆ†æ¯”ç¼©å®¹</span></span><br><span class=\"line\">        <span class=\"attr\">value:</span> <span class=\"number\">30</span>                             <span class=\"comment\"># æ¯ 60 ç§’æœ€å¤šç¼©å®¹ 30%</span></span><br><span class=\"line\">        <span class=\"attr\">periodSeconds:</span> <span class=\"number\">60</span>                     <span class=\"comment\"># æ¯ 60 ç§’è¯„ä¼°ä¸€æ¬¡ç¼©å®¹é€Ÿç‡</span></span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S ä¸­çš„ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ Autoscaling k8sç®€ä»‹ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ ç®€ä»‹ Horizontal Pod Autoscalerï¼ˆç¼©å†™ä¸º hpaï¼‰åŸºäºèµ„æº CPU åˆ©ç”¨ç‡è‡ªåŠ¨è°ƒæ•´ deploymentã€replication controller æˆ–è€… replica ä¸­ pod çš„æ•°é‡ï¼Œè¿™æœ‰åŠ©äºæ‚¨çš„åº”ç”¨ç¨‹åºè¿›è¡Œæ‰©å±•ä»¥æ»¡è¶³å¢é•¿çš„éœ€æ±‚ï¼Œæˆ–åœ¨ä¸éœ€è¦èµ„æºæ—¶è¿›è¡Œç¼©å‡ï¼Œä»è€Œé‡Šæ”¾å‡ºèŠ‚ç‚¹ç”¨äºå…¶ä»–åº”ç”¨ç¨‹åºã€‚å½“æ‚¨è®¾ç½®ç›®æ ‡ CPU åˆ©ç”¨ç‡ç™¾åˆ†æ¯”æ—¶ï¼ŒHPA æ‰©å±•æˆ–ç¼©å‡åº”ç”¨ç¨‹åºæ¥å°è¯•æ»¡è¶³è¯¥ç›®æ ‡ã€‚ Kubernetes æœ¬èº«å·²ç»åŒ…å«äº† HPA çš„ controllerï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–çš„å®‰è£…æˆ–éƒ¨ç½²ã€‚ HPA éœ€è¦è·å– metrics ä¿¡æ¯ï¼Œmetrics ä¿¡æ¯éœ€è¦ä» Metrics Server ä¸­è·å–ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®‰è£… Metrics Serverã€‚ HPA ä¼šå‘¨æœŸæ€§(é»˜è®¤15ç§’)æŸ¥è¯¢ç›®æ ‡èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œç„¶åå’Œ HPA ä¸­å®šä¹‰çš„å€¼åšæ¯”è¾ƒï¼Œå¹¶æ ¹æ®æ¯”è¾ƒç»“æœç›¸åº”çš„è°ƒæ•´ pod æ•°é‡ã€‚ åˆ›å»ºpodæ—¶ï¼Œå¿…é¡»ä¸ºå…¶è®¾å®šcpuèµ„æºï¼Œç”¨äºä¸ç›®æ ‡å€¼è¿›è¡Œæ¯”è¾ƒï¼Œç›®å‰æœ€æ–°çš„v2ç‰ˆæœ¬çš„HPAé™¤äº†æ”¯æŒCPUçš„å¯¹æ¯”ï¼Œè¿˜å¯ä»¥è®¾å®šå…¶å®ƒæŒ‡æ ‡ï¼Œå…·ä½“å‚è€ƒHorizontalPodAutoscaler æ¼”ç»ƒä¸­çš„â€œåŸºäºå¤šé¡¹åº¦é‡æŒ‡æ ‡å’Œè‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡è‡ªåŠ¨æ‰©ç¼©â€ã€‚ åšä¸»ä¹‹å‰å†™è¿‡ä¸€ç¯‡åœ¨awsçš„eksä¸­ä½¿ç”¨hpaçš„æ–‡ç«  AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰ï¼Œå’Œåœ¨è‡ªå·±æ­å»º k8sé›†ç¾¤ ä¸­ä½¿ç”¨ hpa åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥æœ¬æ–‡ä¸å†å¯¹é‡å¤å†…å®¹è¿›è¡Œèµ˜è¿°ï¼Œå»ºè®®è¯»è€…å…ˆé˜…è¯» AWS-EKS-17--Horizontal Pod Autoscalerï¼ˆHPAï¼‰ã€‚ å®‰è£… Metrics Server Kubernetes çš„ HPA æ˜¯ä¾èµ– Metrics API çš„ï¼Œé»˜è®¤å¹¶ä¸å†…ç½®ã€‚éœ€è¦é€šè¿‡ metrics-server æ¥æ”¶é›†å’Œæä¾›èŠ‚ç‚¹/Pod çš„èµ„æºç”¨é‡æ•°æ®ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰ã€‚ å®‰è£… metrics-server 1234567891011$ curl -L -o metrics-server.yaml https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml$ kubectl apply -f metrics-server.yamlserviceaccount/metrics-server createdclusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader createdclusterrole.rbac.authorization.k8s.io/system:metrics-server createdrolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader createdclusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator createdclusterrolebinding.rbac.authorization.k8s.io/system:metrics-server createdservice/metrics-server createddeployment.apps/metrics-server createdapiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created éƒ¨ç½²åå‘ç°podæ²¡æœ‰è¿è¡ŒæˆåŠŸ 123456789101112$ k get all -n kube-system -l k8s-app=metrics-serverNAME READY STATUS RESTARTS AGEpod/metrics-server-867d48dc9c-fgdjq 0/1 Running 0 16sNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/metrics-server ClusterIP 10.96.91.221 &lt;none&gt; 443/TCP 16sNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/metrics-server 0/1 1 0 16sNAME DESIRED CURRENT READY AGEreplicaset.apps/metrics-server-867d48dc9c 1 1 0 16s æ£€æŸ¥æ—¥å¿— 12345$ k logs deployment.apps/metrics-server -n kube-system## è¾“å‡ºç±»ä¼¼äºE0703 23:02:38.120831 1 scraper.go:149] &quot;Failed to scrape node&quot; err=&quot;Get \\&quot;https://10.211.55.15:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.15 because it doesn&#x27;t contain any IP SANs&quot; node=&quot;k8s-worker1&quot;E0703 23:02:38.127774 1 scraper.go:149] &quot;Failed to scrape node&quot; err=&quot;Get \\&quot;https://10.211.55.16:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.16 because it doesn&#x27;t contain any IP SANs&quot; node=&quot;k8s-worker2&quot;E0703 23:02:38.140583 1 scraper.go:149] &quot;Failed to scrape node&quot; err=&quot;Get \\&quot;https://10.211.55.11:10250/metrics/resource\\&quot;: tls: failed to verify certificate: x509: cannot validate certificate for 10.211.55.11 because it doesn&#x27;t contain any IP SANs&quot; node=&quot;k8s-master&quot; æ„æ€æ˜¯ metrics-server åœ¨é€šè¿‡ https://:10250 è¯·æ±‚ kubelet çš„æ—¶å€™ï¼Œå‘ç° kubelet çš„è¯ä¹¦ä¸åŒ…å«è¯¥ IP çš„ Subject Alternative Name (SAN)ï¼Œå› æ­¤ TLS æ ¡éªŒå¤±è´¥ã€‚ è§£å†³æ–¹æ¡ˆ: æ·»åŠ  --kubelet-insecure-tls å‚æ•°ï¼Œè·³è¿‡ kubelet çš„ TLS è¯ä¹¦æ ¡éªŒ(metrics-server æœ¬èº«æƒé™æœ‰é™ï¼Œé£é™©å¯æ§ï¼Œkubelet è‡ªç­¾è¯ä¹¦ç»´æŠ¤æˆæœ¬é«˜) 1234567891011kubectl edit deployment metrics-server -n kube-system## åœ¨ args ä¸­æ·»åŠ  --kubelet-insecure-tls spec: containers: - args: - --cert-dir=/tmp - --secure-port=10250 - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname - --kubelet-use-node-status-port - --metric-resolution=15s - --kubelet-insecure-tls # æ·»åŠ æ­¤è¡Œ wqä¿å­˜åï¼Œç­‰ä¸€ä¼šå†æ¬¡æŸ¥çœ‹æ‰€æœ‰èµ„æºå‡å·²æ­£å¸¸ æŸ¥çœ‹æ‰€æœ‰ node çš„èµ„æº 12345$ k top nodesNAME CPU(cores) CPU(%) MEMORY(bytes) MEMORY(%)k8s-master 216m 10% 1712Mi 44%k8s-worker1 79m 3% 1025Mi 26%k8s-worker2 82m 4% 982Mi 25% å­—æ®µ è¯´æ˜ NAME èŠ‚ç‚¹åç§°ï¼ŒKubernetes é›†ç¾¤çš„èŠ‚ç‚¹åå­—ã€‚ CPU(cores) å½“å‰èŠ‚ç‚¹ CPU çš„ç¬æ—¶ä½¿ç”¨é‡ï¼Œå•ä½æ˜¯æ ¸å¿ƒæ•°ï¼ˆCoreï¼‰ï¼Œæ¯”å¦‚ 216m = 0.216 æ ¸å¿ƒã€‚m = millicoresï¼Œ1000m = 1æ ¸ã€‚ CPU(%) å½“å‰ CPU ä½¿ç”¨ç‡ï¼Œç›¸å¯¹äºè¯¥èŠ‚ç‚¹ CPU æ€»æ ¸æ•°çš„ç™¾åˆ†æ¯”ã€‚æ¯”å¦‚ 10% è¡¨ç¤ºèŠ‚ç‚¹ CPU çš„ 10% è¢«ä½¿ç”¨ã€‚ MEMORY(bytes) èŠ‚ç‚¹å½“å‰ä½¿ç”¨çš„å†…å­˜ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼ˆä¾‹å¦‚ 1712Mi = 1712 Mebibytes â‰ˆ 1.7 GBï¼‰ã€‚ MEMORY(%) èŠ‚ç‚¹å†…å­˜ä½¿ç”¨ç‡ï¼Œå æ€»å†…å­˜çš„ç™¾åˆ†æ¯”ã€‚æ¯”å¦‚ 44% è¡¨ç¤ºè¯¥èŠ‚ç‚¹å†…å­˜ä½¿ç”¨äº† 44%ã€‚ æŸ¥çœ‹æ‰€æœ‰ pod çš„èµ„æº 123456789101112131415161718$ k top pods -ANAMESPACE NAME CPU(cores) MEMORY(bytes)default nginx-5869d7778c-5682r 0m 9Midefault nginx-5869d7778c-thw8f 0m 4Mikube-system calico-kube-controllers-7bfdc5b57c-q5xwp 6m 35Mikube-system calico-node-7pbbq 42m 281Mikube-system calico-node-v4hzr 47m 260Mikube-system calico-node-w47qq 40m 263Mikube-system coredns-674b8bbfcf-2tvld 2m 23Mikube-system coredns-674b8bbfcf-h6kx7 2m 22Mikube-system etcd-k8s-master 27m 85Mikube-system kube-apiserver-k8s-master 49m 404Mikube-system kube-controller-manager-k8s-master 28m 100Mikube-system kube-proxy-nkbns 1m 41Mikube-system kube-proxy-plqw8 1m 25Mikube-system kube-proxy-sbgh6 1m 34Mikube-system kube-scheduler-k8s-master 8m 38Mikube-system metrics-server-56fb9549f4-rtt7n 4m 21Mi åˆ›å»º HPA å‰é¢çš„æ–‡ç« ä¸­å¤šæ¬¡ä½¿ç”¨ nginx é•œåƒåˆ›å»ºäº† deploymentï¼Œä½†æ˜¯éƒ½æ²¡æœ‰é…ç½®è¿‡èµ„æºï¼Œä¸ºäº†æµ‹è¯• hpaï¼Œéœ€è¦ä¸ºå…¶æŒ‡å®šèµ„æº 1234567891011121314151617181920# ç›´æ¥ä¿®æ”¹ deploymentï¼Œæ”¹å˜ spec.templateï¼ŒPod ä¼šè¢«é‡å»ºã€‚ä¿å­˜åç«‹åˆ»ç”Ÿæ•ˆkubectl edit deployment nginx# å¢åŠ èµ„æºé™åˆ¶spec: replicas: 1 # ä¿®æ”¹å‰¯æœ¬æ•°ä½ 1ï¼Œä»…æ”¹å˜ replicasï¼ŒPod ä¸ä¼šè¢«é‡å»º template: # ä¿®æ”¹ templateï¼ŒPod ä¼šè¢«é‡å»º metadata: labels: app: nginx spec: containers: - name: nginx image: nginx resources: limits: cpu: 500m memory: 500Mi requests: cpu: 200m memory: 200Mi å‘½ä»¤è¡Œåˆ›å»º HPA 123456789101112# åˆ›å»ºäº†ä¸€ä¸ªå«â€œhpa-nginxâ€çš„ HPAï¼Œé»˜è®¤ä¸ deployment çš„åç§°ç›¸åŒï¼Œå¯ä»¥ç”¨ --name=&#x27;hpa-nginx&#x27; æŒ‡å®šhpaçš„åç§°# replicas å˜åŠ¨èŒƒå›´æ˜¯æœ€å° 3ï¼Œæœ€å¤§ 10# ç›®æ ‡cpuåˆ©ç”¨ç‡ä¸º 50%ï¼Œä¸Šé¢æˆ‘ä»¬è®¾å®š CPU request å€¼ä¸º 100mï¼Œæ‰€ä»¥å½“å¹³å‡cpuå€¼ä¸º 100m æ—¶å°±ä¼šè§¦å‘ autoscale# è¿™é‡Œè¯´å¹³å‡cpuï¼Œæ˜¯æŒ‡æ‰€æœ‰podçš„cpuåˆ©ç”¨ç‡çš„å¹³å‡å€¼$ k autoscale deployment nginx --name=&quot;hpa-nginx&quot; --cpu-percent=50 --min=3 --max=10horizontalpodautoscaler.autoscaling/hpa-nginx autoscaled# è§‚å¯Ÿï¼Œå¤§çº¦ 15ç§’åï¼Œhpa-nginx å‘ç° replicas å€¼ä¸º1ï¼Œ30ç§’çš„æ—¶å€™è‡ªåŠ¨æ‰©å®¹åˆ°3ä¸ªï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®çš„hpaçš„replicasæœ€å°å€¼ä¸º3ï¼Œå¹¶ä¸”é‡‡é›†åˆ°äº†cpuä½¿ç”¨ç‡$ k get hpa -wNAME REFERENCE TARGETS MINPODS MAXPODS REPLICAS AGEhpa-nginx Deployment/nginx cpu: &lt;unknown&gt;/50% 3 10 0 0shpa-nginx Deployment/nginx cpu: &lt;unknown&gt;/50% 3 10 1 15shpa-nginx Deployment/nginx cpu: 0%/50% 3 10 3 30s ymalæ–‡ä»¶åˆ›å»º HPA 12345678910111213141516171819apiVersion: autoscaling/v2 # apiç‰ˆæœ¬ï¼Œè¿™é‡Œè®¾ç½®ä¸º v2kind: HorizontalPodAutoscaler # èµ„æºç±»å‹metadata: name: hpa-nginx # hpaèµ„æºåç§° namespace: default # å‘½åç©ºé—´spec: maxReplicas: 10 # æœ€å¤§å‰¯æœ¬æ•° minReplicas: 1 # æœ€å°å‰¯æœ¬æ•° metrics: # æŒ‡æ ‡è®¾å®š - type: Resource # èµ„æºç±»å‹ï¼Œå¯ä»¥é…ç½®ä¸º Resource/Object/Pods resource: # èµ„æºå¯¹è±¡ name: cpu # èµ„æºåç§° cpu/memory target: # ç›®æ ‡å¯¹è±¡ type: Utilization # ç›®æ ‡ç±»å‹ï¼Œå¯ä»¥é…ç½®ä¸º Utilization/AverageValue/Value averageUtilization: 50 # ç›®æ ‡å€¼ï¼Œè¿™é‡Œæ˜¯å¹³å‡ä½¿ç”¨ç‡çš„ç™¾åˆ†æ¯” scaleTargetRef: # æŒ‡å®šè¦è‡ªåŠ¨ä¼¸ç¼©çš„èµ„æºå¯¹è±¡ apiVersion: apps/v1 kind: Deployment # èµ„æºç±»å‹ä¸º Deployment name: nginx # èµ„æºåç§°ä¸º nginx HPA æ”¯æŒçš„ç›‘æ§æŒ‡æ ‡ç±»å‹ ç±»å‹ å­—æ®µå è¯´æ˜ å¸¸è§ç”¨é€” Resource resource åŸºäº Pod èµ„æºä½¿ç”¨æƒ…å†µï¼ˆCPUã€å†…å­˜ï¼‰ï¼Œæœ€å¸¸ç”¨ æŒ‰ CPU åˆ©ç”¨ç‡è‡ªåŠ¨æ‰©ç¼©å®¹ Pods pods åŸºäºæ¯ä¸ª Pod çš„è‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡çš„å¹³å‡å€¼ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹ç›‘æ§ç³»ç»Ÿæä¾›ï¼Œæ¯”å¦‚ Prometheus æŒ‰ä¸šåŠ¡æŒ‡æ ‡ï¼ˆå¦‚è¯·æ±‚æ•°ã€é˜Ÿåˆ—é•¿åº¦ï¼‰æ‰©ç¼©å®¹ Object object åŸºäºå•ä¸ª Kubernetes å¯¹è±¡ï¼ˆå¦‚ Serviceã€Ingressï¼‰çš„æŒ‡æ ‡ï¼Œï¼Œæ¯”å¦‚ Prometheus æŒ‰æŸä¸ªå¯¹è±¡çš„æŒ‡æ ‡æ‰©ç¼©å®¹ï¼Œä¾‹å¦‚é˜Ÿåˆ—é•¿åº¦ Resource èµ„æºæŒ‡æ ‡ï¼ˆCPU/å†…å­˜ï¼‰ Utilization: åˆ©ç”¨ç‡ç™¾åˆ†æ¯” Utilization ä¸å…³å¿ƒ limitsï¼Œåªçœ‹ requestsã€‚ å¦‚æœ resources.requests æ²¡æœ‰è®¾ç½®ï¼ŒHPA Utilization ä¼šæŠ¥é”™ï¼ˆé™¤é AverageValueï¼‰ã€‚ 1234567metrics:- type: Resource resource: # èµ„æº æŒ‡æ ‡ name: cpu # cpu target: type: Utilization # åˆ©ç”¨ç‡ç™¾åˆ†æ¯” averageUtilization: 50 # 50% å½“å‰æœ‰ 3 ä¸ª Podï¼š Pod CPU å®é™…ä½¿ç”¨ CPU requests pod-1 150m 200m pod-2 100m 200m pod-3 50m 200m åˆè®¡ 400m 600m å¹³å‡ 400m Ã· 600m Ã— 100% â‰ˆ 66.7% ç”±äº 66.7% &gt; 50%ï¼Œä¼šæ‰©å®¹ï¼›å¦‚æœå°äº 50%ï¼ŒHPA ä¼šç¼©å®¹ã€‚ AverageValue: æŒ‡å®šèµ„æºä½¿ç”¨å¹³å‡å€¼ 1234567metrics:- type: Resource resource: name: memory # ç›‘æ§èµ„æºç±»å‹ä¸º memoryï¼ˆå†…å­˜ï¼‰ target: type: AverageValue # æŒ‡æ ‡ç±»å‹ä¸º AverageValueï¼Œè¡¨ç¤ºæ¯ä¸ª Pod å¹³å‡ä½¿ç”¨å¤šå°‘ averageValue: 400Mi # ç›®æ ‡å€¼ï¼šå¹³å‡æ¯ä¸ª Pod ä½¿ç”¨ 400Mi å†…å­˜ å‡è®¾å½“å‰éƒ¨ç½²äº† 3 ä¸ªå‰¯æœ¬ï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š Pod å½“å‰å†…å­˜ä½¿ç”¨ pod-1 450Mi pod-2 400Mi pod-3 300Mi å¹³å‡ (450+400+300)/3 = 383.3Mi å› ä¸º 383.3Mi &lt; 400Miï¼Œä¸è§¦å‘æ‰©å®¹ã€‚å¦‚æœå°†æ¥å¹³å‡ä½¿ç”¨è¶…è¿‡ 400Miï¼ŒHPA å°±ä¼šæ‰©å®¹ï¼Œåä¹‹ç¼©å®¹ã€‚ HPA æ‰©ç¼©å®¹é€Ÿåº¦é…ç½® HPA çš„æ‰©ç¼©å®¹é€Ÿåº¦æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œé€šè¿‡ behavior å­—æ®µæ¥è‡ªå®šä¹‰æ‰©ç¼©å®¹çš„é€Ÿåº¦å’Œç­–ç•¥ã€‚ ä»¥ä¸‹æ˜¯é»˜è®¤ç­–ç•¥ 1234567891011121314151617181920behavior: scaleUp: # â¬†ï¸ æ‰©å®¹ç­–ç•¥ tolerance: 0.1 # å®¹å¿é˜ˆå€¼ï¼Œé»˜è®¤0.1(10%)ï¼Œè¡¨ç¤ºæ¯æ¬¡æ‰©å®¹æ—¶ï¼Œpodä½¿ç”¨ç‡è¶…è¿‡1.1å€ç›®æ ‡å€¼æ—¶æ‰ä¼šè¿›è¡Œæ‰©å®¹ stabilizationWindowSeconds: 0 # é»˜è®¤0ï¼Œå³å¢åŠ æˆ–å‡å°‘podæ•°é‡åä¿æŒä¸å˜çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ policies: - type: Percent # æ‰©å®¹é€Ÿåº¦æŒ‰ç™¾åˆ†æ¯”é™åˆ¶ value: 100 # æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 100% çš„å‰¯æœ¬æ•° periodSeconds: 15 # æ¯ 15 ç§’è®¡ç®—ä¸€æ¬¡æ˜¯å¦å¯ä»¥æ‰©å®¹ï¼Œé»˜è®¤ 15 ç§’ - type: Pods # æŒ‰å›ºå®š Pod æ•°é‡é™åˆ¶æ‰©å®¹é€Ÿåº¦ value: 4 # æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 4 ä¸ª Pod periodSeconds: 15 # åŒæ · 15 ç§’è®¡ç®—ä¸€æ¬¡ï¼Œé»˜è®¤ 15 ç§’ selectPolicy: Max # å¤šä¸ª policy åŒæ—¶å­˜åœ¨æ—¶ï¼Œå– Percent å’Œ Pods çš„æœ€å¤§å€¼ã€‚Min å–æœ€å°å€¼ scaleDown: # â¬‡ï¸ ç¼©å®¹ç­–ç•¥ # selectPolicy: Disabled # ç¦ç”¨ç¼©å®¹ stabilizationWindowSeconds: 300 # é»˜è®¤ 300ï¼Œå³å¢åŠ æˆ–å‡å°‘podæ•°é‡åä¿æŒä¸å˜çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œé˜²æ­¢å¿«é€Ÿç¼©å®¹ï¼ˆå¹³æ»‘ç­–ç•¥ï¼‰ policies: - type: Percent # ç¼©å®¹é€Ÿåº¦æŒ‰ç™¾åˆ†æ¯”é™åˆ¶ value: 100 # æ¯ 15 ç§’æœ€å¤šç¼©å®¹ 100% çš„å‰¯æœ¬æ•° periodSeconds: 15 # æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ˜¯å¦å¯ä»¥ç¼©å®¹ å®Œæ•´çš„ HPA é…ç½®æ–‡ä»¶ç¤ºä¾‹(ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— éœ€ä¿®æ”¹æ‰©ç¼©å®¹é€Ÿåº¦çš„é…ç½®ï¼Œé»˜è®¤ç­–ç•¥æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯) 123456789101112131415161718192021222324252627282930313233343536apiVersion: autoscaling/v2 # apiç‰ˆæœ¬ï¼Œä½¿ç”¨ v2 ç‰ˆæœ¬æ”¯æŒ behavior æ‰©ç¼©å®¹ç­–ç•¥kind: HorizontalPodAutoscaler # èµ„æºç±»å‹ä¸º HPAmetadata: name: hpa-nginx # HPA èµ„æºçš„åç§° namespace: default # å‘½åç©ºé—´ï¼Œè®¾ç½®ä¸º defaultspec: maxReplicas: 10 # HPA è‡ªåŠ¨æ‰©å®¹çš„æœ€å¤§å‰¯æœ¬æ•° minReplicas: 1 # HPA è‡ªåŠ¨ç¼©å®¹çš„æœ€å°å‰¯æœ¬æ•° metrics: # è‡ªåŠ¨ä¼¸ç¼©çš„æŒ‡æ ‡é…ç½® - type: Resource # æŒ‡æ ‡ç±»å‹ä¸º Resourceï¼ˆèµ„æºå‹ï¼‰ resource: # èµ„æºæŒ‡æ ‡å¯¹è±¡ name: cpu # èµ„æºåç§°ä¸º cpuï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º memory target: # ç›®æ ‡æŒ‡æ ‡å¯¹è±¡ type: Utilization # æŒ‡æ ‡ç±»å‹ä¸º Utilizationï¼ˆåˆ©ç”¨ç‡ç™¾åˆ†æ¯”ï¼‰ averageUtilization: 50 # CPU å¹³å‡ä½¿ç”¨ç‡è¾¾åˆ° 50% æ—¶è¿›è¡Œæ‰©ç¼©å®¹ scaleTargetRef: # HPA ç»‘å®šçš„ç›®æ ‡èµ„æºå¯¹è±¡ apiVersion: apps/v1 kind: Deployment # ç›®æ ‡ç±»å‹ä¸º Deployment name: nginx # ç›®æ ‡ Deployment åç§°ä¸º nginx behavior: # â¬‡ï¸ æ‰©ç¼©å®¹è¡Œä¸ºæ§åˆ¶ scaleUp: # æ‰©å®¹ç­–ç•¥ stabilizationWindowSeconds: 30 # æ‰©å®¹å¹³æ»‘çª—å£ä¸º 30 ç§’ï¼Œé˜²æ­¢çŸ­æ—¶é—´æŠ–åŠ¨é¢‘ç¹æ‰©å®¹ policies: # æ‰©å®¹é€Ÿåº¦é™åˆ¶ç­–ç•¥ - type: Percent # æŒ‰ç™¾åˆ†æ¯”è®¡ç®— value: 100 # æ¯ 15 ç§’å†…æœ€å¤šæ‰©å®¹ 100% periodSeconds: 15 # æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ‰©å®¹é€Ÿç‡ - type: Pods # æŒ‰å›ºå®š Pod æ•°é‡è®¡ç®— value: 4 # æ¯ 15 ç§’æœ€å¤šæ‰©å®¹ 4 ä¸ª Pod periodSeconds: 15 # æ¯ 15 ç§’è¯„ä¼°ä¸€æ¬¡æ‰©å®¹é€Ÿç‡ selectPolicy: Max # å¦‚æœå¤šä¸ª policy åŒæ—¶æ»¡è¶³ï¼Œå–æœ€å¤§å€¼ï¼ˆæ›´æ¿€è¿›çš„æ‰©å®¹ï¼‰ scaleDown: # ç¼©å®¹ç­–ç•¥ stabilizationWindowSeconds: 300 # ç¼©å®¹å¹³æ»‘çª—å£ä¸º 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰ï¼Œé¿å…çŸ­æ—¶æµé‡é™ä½å¿«é€Ÿç¼©å®¹ policies: # ç¼©å®¹é€Ÿåº¦é™åˆ¶ç­–ç•¥ - type: Percent # æŒ‰ç™¾åˆ†æ¯”ç¼©å®¹ value: 30 # æ¯ 60 ç§’æœ€å¤šç¼©å®¹ 30% periodSeconds: 60 # æ¯ 60 ç§’è¯„ä¼°ä¸€æ¬¡ç¼©å®¹é€Ÿç‡","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S ä¸­çš„ Horizontal Pod Autoscalerï¼ˆHPAï¼‰ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ Autoscaling k8sç®€ä»‹ Horizontal Pod Autoscalerï¼ˆHPAï¼‰","date_published":"2025-07-20T13:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/19/k8s-ingress-nginx/","url":"https://blog.hanqunfeng.com/2025/07/19/k8s-ingress-nginx/","title":"K8S ä¹‹ Ingress Nginx","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S å®‰è£…åŠä½¿ç”¨ Ingress Nginxï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.github.io/ingress-nginx/\">ingress-nginx å®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/\">ingress-nginx k8sç®€ä»‹</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/\">k8sæ”¯æŒçš„ ingress controller</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Ingress-ç®€ä»‹\">Ingress ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ingress(ç¼©å†™ä¸º ing) æä¾›ä»é›†ç¾¤å¤–éƒ¨åˆ°é›†ç¾¤å†…æœåŠ¡çš„ HTTP å’Œ HTTPS è·¯ç”±(7å±‚)ã€‚ æµé‡è·¯ç”±ç”± Ingress èµ„æºæ‰€å®šä¹‰çš„è§„åˆ™æ¥æ§åˆ¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š Ingress-Nginx å†…ç½®äº† nginxï¼Œç”± nginx å…¶è´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶è½¬å‘ç»™åç«¯æœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹é¢æ˜¯ Ingress çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œå¯å°†æ‰€æœ‰æµé‡éƒ½å‘é€åˆ°åŒä¸€ Service<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/jVrIUP.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"å®‰è£…-Ingress-Nginx\">å®‰è£… Ingress-Nginx</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…æ—¶è¦æ³¨æ„ ingress-nginx çš„ç‰ˆæœ¬å’Œ Kubernetes çš„ç‰ˆæœ¬å…¼å®¹æ€§ï¼Œå‚è€ƒ Github:<a href=\"https://github.com/kubernetes/ingress-nginx\">ingress-nginx</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è·å–å¯¹åº”ç‰ˆæœ¬çš„yamlæ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½æœ€æ–°çš„ v1.13.0 ç‰ˆæœ¬ï¼Œå…¶æ”¯æŒ Kubernetes 1.33 ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> INGRESS_NGINX_VERSION=v1.13.0</span><br><span class=\"line\">curl -L -o ingress-nginx-controller.yaml https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-<span class=\"variable\">$&#123;INGRESS_NGINX_VERSION&#125;</span>/deploy/static/provider/cloud/deploy.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£… ingress-nginx</p>\n</li>\n</ul>\n<blockquote>\n<p>è¿™é‡Œè¦æ³¨æ„ï¼Œingress-nginx çš„ <code>service/ingress-nginx-controller</code> é»˜è®¤ä½¿ç”¨ LoadBalancer ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å…ˆä½¿ k8s é›†ç¾¤æ”¯æŒ LoadBalancer ç±»å‹ï¼Œå¯ä»¥å‚è€ƒ <a href=\"/2025/07/18/k8s-service/\" title=\"K8S ä¹‹ Service\">K8S ä¹‹ Service</a> ä¸­ LoadBalancer éƒ¨åˆ†ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f ingress-nginx-controller.yaml</span><br><span class=\"line\">namespace/ingress-nginx created</span><br><span class=\"line\">serviceaccount/ingress-nginx created</span><br><span class=\"line\">serviceaccount/ingress-nginx-admission created</span><br><span class=\"line\">role.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class=\"line\">role.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class=\"line\">clusterrole.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class=\"line\">clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class=\"line\">rolebinding.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class=\"line\">rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span><br><span class=\"line\">configmap/ingress-nginx-controller created</span><br><span class=\"line\">service/ingress-nginx-controller created</span><br><span class=\"line\">service/ingress-nginx-controller-admission created</span><br><span class=\"line\">deployment.apps/ingress-nginx-controller created</span><br><span class=\"line\">job.batch/ingress-nginx-admission-create created</span><br><span class=\"line\">job.batch/ingress-nginx-admission-patch created</span><br><span class=\"line\">ingressclass.networking.k8s.io/nginx created</span><br><span class=\"line\">validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ingress-nginxèµ„æº</span></span><br><span class=\"line\">$ k get all -n ingress-nginx</span><br><span class=\"line\">NAME                                           READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">pod/ingress-nginx-controller-95f6586c6-nznwq   1/1     Running   0          2m46s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                         TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                      AGE</span><br><span class=\"line\">service/ingress-nginx-controller             LoadBalancer   10.96.112.234   10.211.55.201   80:30168/TCP,443:30600/TCP   2m46s</span><br><span class=\"line\">service/ingress-nginx-controller-admission   ClusterIP      10.96.245.155   &lt;none&gt;          443/TCP                      2m46s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/ingress-nginx-controller   1/1     1            1           2m46s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                                 DESIRED   CURRENT   READY   AGE</span><br><span class=\"line\">replicaset.apps/ingress-nginx-controller-95f6586c6   1         1         1       2m46s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ IngressClass èµ„æº</span></span><br><span class=\"line\">$ k get ingressclasses.networking.k8s.io</span><br><span class=\"line\">NAME    CONTROLLER             PARAMETERS   AGE</span><br><span class=\"line\">nginx   k8s.io/ingress-nginx   &lt;none&gt;       14m</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»º-Ingress-èµ„æº\">åˆ›å»º Ingress èµ„æº</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ingress-demo.yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span>                   <span class=\"comment\"># Ingress èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">web-ingress</span>             <span class=\"comment\"># Ingress åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span>            <span class=\"comment\"># Ingress æ‰€åœ¨çš„å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ingressClassName:</span> <span class=\"string\">nginx</span>       <span class=\"comment\"># Ingress ä½¿ç”¨çš„ IngressClass</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">nginx.hanqunfeng.com</span>  <span class=\"comment\"># è½¬å‘åŸŸåï¼Œæ”¯æŒé€šé…ç¬¦ *.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span>        <span class=\"comment\"># è·¯å¾„åŒ¹é…è§„åˆ™, å‰ç¼€åŒ¹é…</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/</span>                 <span class=\"comment\"># è·¯å¾„</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span>                <span class=\"comment\"># åç«¯æœåŠ¡</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span>              <span class=\"comment\"># å£°æ˜åç«¯æ˜¯ä¸€ä¸ª service</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>         <span class=\"comment\"># serviceåç§°ï¼Œæå‰åˆ›å»ºå¥½ serviceï¼Œç±»å‹å¯ä»¥æ˜¯ClusterIPã€NodePortã€LoadBalancerä»»æ„ï¼Œæ¨èClusterIPï¼Œå› ä¸ºä½¿ç”¨ ingress çš„è¯ï¼Œå°±æ²¡å¿…è¦åˆ›å»ºå…¶å®ƒç±»å‹çš„ service äº†</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span>               <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span>        <span class=\"comment\"># serviceçš„ç«¯å£</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ ingress èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get ing -n ns1</span><br><span class=\"line\">NAME          CLASS   HOSTS                  ADDRESS         PORTS   AGE</span><br><span class=\"line\">web-ingress   nginx   nginx.hanqunfeng.com   10.211.55.201   80      80s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—® web-ingress</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°†åŸŸå nginx.hanqunfeng.com è§£æåˆ° 10.211.55.201ï¼Œå¦‚æœæ˜¯å†…éƒ¨åŸŸåå¯ä»¥é€šè¿‡ hosts æ–‡ä»¶æ·»åŠ è§£æ</span></span><br><span class=\"line\"><span class=\"comment\"># åªèƒ½é€šè¿‡ nginx.hanqunfeng.com è®¿é—®ï¼Œä¸èƒ½é€šè¿‡ 10.211.55.201 è®¿é—®</span></span><br><span class=\"line\">curl http://nginx.hanqunfeng.com</span><br></pre></td></tr></table></figure>\n<h2 id=\"è®©-Ingress-æ”¯æŒ-HTTPS-è®¿é—®\">è®© Ingress æ”¯æŒ HTTPS è®¿é—®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºè¯ä¹¦ï¼Œå¯ä»¥åœ¨é˜¿é‡Œäº‘ä¸Šç”³è¯·ä¸€ä¸ªå…è´¹çš„è¯ä¹¦</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»º secret</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create secret tls nginx-tls \\</span><br><span class=\"line\">    --key=nginx.hanqunfeng.com.key \\</span><br><span class=\"line\">    --cert=nginx.hanqunfeng.com.pem \\</span><br><span class=\"line\">    -n default</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥é€šè¿‡yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx-tls</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">tls.crt:</span> <span class=\"string\">base64</span> <span class=\"string\">ç¼–ç çš„è¯ä¹¦ï¼Œè€Œéæ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">  <span class=\"attr\">tls.key:</span> <span class=\"string\">base64</span> <span class=\"string\">ç¼–ç çš„ç§é’¥ï¼Œè€Œéæ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/tls</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½ çš„ Ingress èµ„æºéœ€è¦å¢åŠ  tls å­—æ®µï¼Œå¼•ç”¨ä¸€ä¸ª Secret å­˜å‚¨çš„ TLS è¯ä¹¦ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span>                   <span class=\"comment\"># Ingress èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">web-ingress</span>             <span class=\"comment\"># Ingress åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span>            <span class=\"comment\"># Ingress æ‰€åœ¨çš„å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ingressClassName:</span> <span class=\"string\">nginx</span>       <span class=\"comment\"># Ingress ä½¿ç”¨çš„ IngressClass</span></span><br><span class=\"line\">  <span class=\"attr\">tls:</span>                          <span class=\"comment\"># é…ç½® TLS</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span>                      <span class=\"comment\"># åŸŸååˆ—è¡¨</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">nginx.hanqunfeng.com</span>      <span class=\"comment\"># åŸŸå</span></span><br><span class=\"line\">    <span class=\"attr\">secretName:</span> <span class=\"string\">nginx-tls</span>       <span class=\"comment\"># å­˜æ”¾è¯ä¹¦çš„ Secret</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">nginx.hanqunfeng.com</span>  <span class=\"comment\">#è½¬å‘åŸŸå</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span>        <span class=\"comment\"># è·¯å¾„åŒ¹é…è§„åˆ™, å‰ç¼€åŒ¹é…</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/</span>                 <span class=\"comment\"># è·¯å¾„</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span>                <span class=\"comment\"># åç«¯æœåŠ¡</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span>              <span class=\"comment\"># service</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>         <span class=\"comment\"># serviceåç§°</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span>               <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span>        <span class=\"comment\"># serviceçš„ç«¯å£</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é‡æ–°è¿è¡Œingress</span></span><br><span class=\"line\">k apply -f nginx-ingress.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ingressï¼Œæ­¤æ—¶å¤šäº†ä¸€ä¸ª 443 ç«¯å£</span></span><br><span class=\"line\">$ k get ing</span><br><span class=\"line\">NAME          CLASS   HOSTS                  ADDRESS         PORTS     AGE</span><br><span class=\"line\">web-ingress   nginx   nginx.hanqunfeng.com   10.211.55.201   80, 443   51s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¿é—®httpsï¼Œä½†æ­¤æ—¶ 80 ç«¯å£è®¿é—®ä¸äº†ï¼Œéœ€è¦é…ç½® 80 ç«¯å£é‡å®šå‘åˆ° 443</span></span><br><span class=\"line\">curl https://nginx.hanqunfeng.com</span><br></pre></td></tr></table></figure>\n<h2 id=\"80ç«¯å£é‡å®šå‘åˆ°443\">80ç«¯å£é‡å®šå‘åˆ°443</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>nginx ingress controller</code>ï¼Œå®ƒå†…ç½®æ”¯æŒé‡å®šå‘ï¼Œä½ å¯ä»¥åœ¨ Ingress ä¸Šæ·»åŠ  annotation</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class=\"string\">&quot;true&quot;</span>  <span class=\"comment\"># 80 é‡å®šå‘åˆ° 443</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®Œæ•´çš„yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">web-ingress</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ingressClassName:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">tls:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">nginx.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">secretName:</span> <span class=\"string\">nginx-tls</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">nginx.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é‡æ–°è¿è¡Œingress</span></span><br><span class=\"line\">k apply -f nginx-ingress.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤æƒ…å†µä¸‹ curl ä¸ä¼šè‡ªåŠ¨è·³è½¬ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ä¼šè‡ªåŠ¨é‡å®šå‘ï¼Œ308 è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘</span></span><br><span class=\"line\">$ curl http://nginx.hanqunfeng.com</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;<span class=\"built_in\">head</span>&gt;&lt;title&gt;308 Permanent Redirect&lt;/title&gt;&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;center&gt;&lt;h1&gt;308 Permanent Redirect&lt;/h1&gt;&lt;/center&gt;</span><br><span class=\"line\">&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ  -L å‚æ•°ï¼Œcurl ä¼šè‡ªåŠ¨è·³è½¬</span></span><br><span class=\"line\">$ curl -L http://nginx.hanqunfeng.com</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;<span class=\"built_in\">head</span>&gt;</span><br><span class=\"line\">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">html &#123; color-scheme: light dark; &#125;</span><br><span class=\"line\">body &#123; width: 35em; margin: 0 auto;</span><br><span class=\"line\">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class=\"line\">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class=\"line\">working. Further configuration is required.&lt;/p&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;p&gt;For online documentation and support please refer to</span><br><span class=\"line\">&lt;a href=<span class=\"string\">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class=\"line\">Commercial support is available at</span><br><span class=\"line\">&lt;a href=<span class=\"string\">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;p&gt;&lt;em&gt;Thank you <span class=\"keyword\">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<h3 id=\"ssl-è¯ä¹¦è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ\">ssl è¯ä¹¦è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># apply ä¼šç›´æ¥æ›´æ–° Secretï¼Œè€Œä¸æ˜¯åˆ é™¤é‡å»º</span></span><br><span class=\"line\">kubectl create secret tls nginx-tls \\</span><br><span class=\"line\">    --key=æ–°çš„.key \\</span><br><span class=\"line\">    --cert=æ–°çš„.pem \\</span><br><span class=\"line\">    -n default --dry-run=client -o yaml | kubectl apply -f -</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ingress Controllerï¼ˆå¦‚ nginx-ingressï¼‰é€šå¸¸ä¼šè‡ªåŠ¨ç›‘å¬ Secret å˜åŒ–ï¼Œå¤§æ¦‚ 30 ç§’ ~ 1 åˆ†é’Ÿå†…è‡ªåŠ¨çƒ­åŠ è½½æ–°è¯ä¹¦ï¼Œæ— éœ€é‡å¯ Podã€‚</p>\n</li>\n</ul>\n<h3 id=\"pathType-å¯ä»¥è®¾ç½®å“ªäº›å€¼ï¼Ÿ\">pathType å¯ä»¥è®¾ç½®å“ªäº›å€¼ï¼Ÿ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Kubernetes Ingress çš„ pathType å­—æ®µä¸­ï¼Œä¸€å…±å¯ä»¥è®¾ç½®ä»¥ä¸‹ä¸‰ç§å€¼</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><strong>pathType å€¼</strong></th>\n<th><strong>å«ä¹‰</strong></th>\n<th><strong>åŒ¹é…è§„åˆ™è¯´æ˜</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Exact</strong></td>\n<td>ç²¾ç¡®åŒ¹é…</td>\n<td>è·¯å¾„å¿…é¡»<strong>å®Œå…¨åŒ¹é…</strong></td>\n</tr>\n<tr>\n<td><strong>Prefix</strong></td>\n<td>å‰ç¼€åŒ¹é…</td>\n<td>ä»¥æŒ‡å®šè·¯å¾„ä¸º<strong>å‰ç¼€</strong>å³å¯åŒ¹é…</td>\n</tr>\n<tr>\n<td><strong>ImplementationSpecific</strong></td>\n<td>ç”± Ingress Controller è‡ªå·±å†³å®š</td>\n<td>nginx å¸¸å¸¸è¡¨ç°ä¸ºå‰ç¼€åŒ¹é…</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Exact ç²¾ç¡®åŒ¹é…ï¼Œä¸”åŒºåˆ†å¤§å°å†™</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åªåŒ¹é… http://example.com/foo</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸ä¼šåŒ¹é… /foo/abc æˆ– /foo/</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Exact</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">/foo</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Prefix å‰ç¼€åŒ¹é…ï¼Œä¸”åŒºåˆ†å¤§å°å†™</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŒ¹é…æ‰€æœ‰ä»¥ /foo å¼€å¤´çš„è·¯å¾„ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#   /foo</span></span><br><span class=\"line\"><span class=\"comment\">#   /foo/   # ä¼šå¿½ç•¥å°¾éƒ¨çš„ /</span></span><br><span class=\"line\"><span class=\"comment\">#   /foo/abc</span></span><br><span class=\"line\"><span class=\"comment\">#   /foo/bar/test</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">/foo</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ImplementationSpecific æ§åˆ¶å™¨è‡ªå®šä¹‰ï¼ˆä¸æ¨èï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŒ¹é…è§„åˆ™ç”± Ingress Controller å†³å®šï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># åœ¨ nginx-ingress ä¸­é€šå¸¸è¡Œä¸ºç±»ä¼¼äº Prefixï¼Œä½†ä¸ä¿è¯å…¼å®¹æ€§ï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># Kubernetes å®˜æ–¹ä¸æ¨èç”Ÿäº§ä½¿ç”¨ï¼Œå»ºè®®æ˜¾å¼ä½¿ç”¨ Prefix æˆ– Exactã€‚</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">ImplementationSpecific</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">/foo</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è®¾ç½®ç¼ºçœçš„-ingressclass\">è®¾ç½®ç¼ºçœçš„ ingressclass</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªç¼ºçœçš„ ingressclass ä¸ºé»˜è®¤å€¼ï¼Œè¿™æ ·ï¼Œå½“åˆ›å»ºingressæ—¶ï¼Œå¦‚æœæœªæŒ‡å®šingressclassï¼Œåˆ™ä½¿ç”¨ç¼ºçœå€¼</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ä»¥é€šè¿‡ kubectl patch ä¸º ingressclass ç›´æ¥æ‰“ä¸Šé»˜è®¤æ ‡è¯†(é€šè¿‡ k edit ingressclass ingressclass-name ä¸ºå…¶æ·»åŠ æ³¨è§£ä¹Ÿå¯ä»¥)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ ingressclasses</span></span><br><span class=\"line\">$ k get ingressclasses</span><br><span class=\"line\">NAME    CONTROLLER             PARAMETERS   AGE</span><br><span class=\"line\">nginx   k8s.io/ingress-nginx   &lt;none&gt;       3h3m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½® nginx ä¸ºé»˜è®¤ ingressclassï¼Œå°±æ˜¯ä¸ºå…¶åŠ ä¸Šå¦‚ä¸‹æ³¨è§£</span></span><br><span class=\"line\">$ kubectl patch ingressclass nginx -p <span class=\"string\">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;ingressclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ingerss-nginx-åº”ç”¨ç¤ºä¾‹\">ingerss-nginx åº”ç”¨ç¤ºä¾‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒä¸€åŸŸåä¸åŒè·¯å¾„<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/s1XbqM.png\" alt=\"\"></p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">simple-fanout-example</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                       <span class=\"comment\"># æœªæŒ‡å®š ingressClassName ,åˆ™ä½¿ç”¨ ä¸Šæ–‡ä¸­è®¾ç½®çš„é»˜è®¤ ingressClassName</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">foo.bar.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">path:</span> <span class=\"string\">/foo</span></span><br><span class=\"line\">        <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">service1</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">4200</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">path:</span> <span class=\"string\">/bar</span></span><br><span class=\"line\">        <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">service2</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">8080</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸åŒåŸŸåçš„æœåŠ¡<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/sBhmbR.png\" alt=\"\"></p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">name-virtual-host-ingress</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">foo.bar.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">&quot;/&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">service1</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">bar.foo.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">&quot;/&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">service2</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯¹ ingress è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹ä¿å­˜(:wq)åä¼šç«‹åˆ»ç”Ÿæ•ˆ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl edit ingress web-ingress</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S å®‰è£…åŠä½¿ç”¨ Ingress Nginxï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ ingress-nginx å®˜ç½‘ ingress-nginx k8sç®€ä»‹ k8sæ”¯æŒçš„ ingress controller Ingress ç®€ä»‹ Ingress(ç¼©å†™ä¸º ing) æä¾›ä»é›†ç¾¤å¤–éƒ¨åˆ°é›†ç¾¤å†…æœåŠ¡çš„ HTTP å’Œ HTTPS è·¯ç”±(7å±‚)ã€‚ æµé‡è·¯ç”±ç”± Ingress èµ„æºæ‰€å®šä¹‰çš„è§„åˆ™æ¥æ§åˆ¶ã€‚ å®é™…ä¸Š Ingress-Nginx å†…ç½®äº† nginxï¼Œç”± nginx å…¶è´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶è½¬å‘ç»™åç«¯æœåŠ¡ã€‚ ä¸‹é¢æ˜¯ Ingress çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œå¯å°†æ‰€æœ‰æµé‡éƒ½å‘é€åˆ°åŒä¸€ Service å®‰è£… Ingress-Nginx å®‰è£…æ—¶è¦æ³¨æ„ ingress-nginx çš„ç‰ˆæœ¬å’Œ Kubernetes çš„ç‰ˆæœ¬å…¼å®¹æ€§ï¼Œå‚è€ƒ Github:ingress-nginxã€‚ è·å–å¯¹åº”ç‰ˆæœ¬çš„yamlæ–‡ä»¶ 123# ä¸‹è½½æœ€æ–°çš„ v1.13.0 ç‰ˆæœ¬ï¼Œå…¶æ”¯æŒ Kubernetes 1.33 ç‰ˆæœ¬export INGRESS_NGINX_VERSION=v1.13.0curl -L -o ingress-nginx-controller.yaml https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-$&#123;INGRESS_NGINX_VERSION&#125;/deploy/static/provider/cloud/deploy.yaml å®‰è£… ingress-nginx è¿™é‡Œè¦æ³¨æ„ï¼Œingress-nginx çš„ service/ingress-nginx-controller é»˜è®¤ä½¿ç”¨ LoadBalancer ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å…ˆä½¿ k8s é›†ç¾¤æ”¯æŒ LoadBalancer ç±»å‹ï¼Œå¯ä»¥å‚è€ƒ K8S ä¹‹ Service ä¸­ LoadBalancer éƒ¨åˆ†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940$ kubectl apply -f ingress-nginx-controller.yamlnamespace/ingress-nginx createdserviceaccount/ingress-nginx createdserviceaccount/ingress-nginx-admission createdrole.rbac.authorization.k8s.io/ingress-nginx createdrole.rbac.authorization.k8s.io/ingress-nginx-admission createdclusterrole.rbac.authorization.k8s.io/ingress-nginx createdclusterrole.rbac.authorization.k8s.io/ingress-nginx-admission createdrolebinding.rbac.authorization.k8s.io/ingress-nginx createdrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission createdclusterrolebinding.rbac.authorization.k8s.io/ingress-nginx createdclusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission createdconfigmap/ingress-nginx-controller createdservice/ingress-nginx-controller createdservice/ingress-nginx-controller-admission createddeployment.apps/ingress-nginx-controller createdjob.batch/ingress-nginx-admission-create createdjob.batch/ingress-nginx-admission-patch createdingressclass.networking.k8s.io/nginx createdvalidatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created# æŸ¥çœ‹ingress-nginxèµ„æº$ k get all -n ingress-nginxNAME READY STATUS RESTARTS AGEpod/ingress-nginx-controller-95f6586c6-nznwq 1/1 Running 0 2m46sNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/ingress-nginx-controller LoadBalancer 10.96.112.234 10.211.55.201 80:30168/TCP,443:30600/TCP 2m46sservice/ingress-nginx-controller-admission ClusterIP 10.96.245.155 &lt;none&gt; 443/TCP 2m46sNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/ingress-nginx-controller 1/1 1 1 2m46sNAME DESIRED CURRENT READY AGEreplicaset.apps/ingress-nginx-controller-95f6586c6 1 1 1 2m46s# æŸ¥çœ‹ IngressClass èµ„æº$ k get ingressclasses.networking.k8s.ioNAME CONTROLLER PARAMETERS AGEnginx k8s.io/ingress-nginx &lt;none&gt; 14m åˆ›å»º Ingress èµ„æº ingress-demo.yaml 123456789101112131415161718apiVersion: networking.k8s.io/v1kind: Ingress # Ingress èµ„æºmetadata: name: web-ingress # Ingress åç§° namespace: default # Ingress æ‰€åœ¨çš„å‘½åç©ºé—´spec: ingressClassName: nginx # Ingress ä½¿ç”¨çš„ IngressClass rules: - host: nginx.hanqunfeng.com # è½¬å‘åŸŸåï¼Œæ”¯æŒé€šé…ç¬¦ *.hanqunfeng.com http: paths: - pathType: Prefix # è·¯å¾„åŒ¹é…è§„åˆ™, å‰ç¼€åŒ¹é… path: / # è·¯å¾„ backend: # åç«¯æœåŠ¡ service: # å£°æ˜åç«¯æ˜¯ä¸€ä¸ª service name: nginx # serviceåç§°ï¼Œæå‰åˆ›å»ºå¥½ serviceï¼Œç±»å‹å¯ä»¥æ˜¯ClusterIPã€NodePortã€LoadBalancerä»»æ„ï¼Œæ¨èClusterIPï¼Œå› ä¸ºä½¿ç”¨ ingress çš„è¯ï¼Œå°±æ²¡å¿…è¦åˆ›å»ºå…¶å®ƒç±»å‹çš„ service äº† port: # ç«¯å£ number: 80 # serviceçš„ç«¯å£ æŸ¥çœ‹ ingress èµ„æº 123$ k get ing -n ns1NAME CLASS HOSTS ADDRESS PORTS AGEweb-ingress nginx nginx.hanqunfeng.com 10.211.55.201 80 80s è®¿é—® web-ingress 123# å°†åŸŸå nginx.hanqunfeng.com è§£æåˆ° 10.211.55.201ï¼Œå¦‚æœæ˜¯å†…éƒ¨åŸŸåå¯ä»¥é€šè¿‡ hosts æ–‡ä»¶æ·»åŠ è§£æ# åªèƒ½é€šè¿‡ nginx.hanqunfeng.com è®¿é—®ï¼Œä¸èƒ½é€šè¿‡ 10.211.55.201 è®¿é—®curl http://nginx.hanqunfeng.com è®© Ingress æ”¯æŒ HTTPS è®¿é—® åˆ›å»ºè¯ä¹¦ï¼Œå¯ä»¥åœ¨é˜¿é‡Œäº‘ä¸Šç”³è¯·ä¸€ä¸ªå…è´¹çš„è¯ä¹¦ åˆ›å»º secret 1234kubectl create secret tls nginx-tls \\ --key=nginx.hanqunfeng.com.key \\ --cert=nginx.hanqunfeng.com.pem \\ -n default ä¹Ÿå¯ä»¥é€šè¿‡yamlåˆ›å»º 123456789apiVersion: v1kind: Secretmetadata: name: nginx-tls namespace: defaultdata: tls.crt: base64 ç¼–ç çš„è¯ä¹¦ï¼Œè€Œéæ–‡ä»¶è·¯å¾„ tls.key: base64 ç¼–ç çš„ç§é’¥ï¼Œè€Œéæ–‡ä»¶è·¯å¾„type: kubernetes.io/tls ä½ çš„ Ingress èµ„æºéœ€è¦å¢åŠ  tls å­—æ®µï¼Œå¼•ç”¨ä¸€ä¸ª Secret å­˜å‚¨çš„ TLS è¯ä¹¦ã€‚ 12345678910111213141516171819202122apiVersion: networking.k8s.io/v1kind: Ingress # Ingress èµ„æºmetadata: name: web-ingress # Ingress åç§° namespace: default # Ingress æ‰€åœ¨çš„å‘½åç©ºé—´spec: ingressClassName: nginx # Ingress ä½¿ç”¨çš„ IngressClass tls: # é…ç½® TLS - hosts: # åŸŸååˆ—è¡¨ - nginx.hanqunfeng.com # åŸŸå secretName: nginx-tls # å­˜æ”¾è¯ä¹¦çš„ Secret rules: - host: nginx.hanqunfeng.com #è½¬å‘åŸŸå http: paths: - pathType: Prefix # è·¯å¾„åŒ¹é…è§„åˆ™, å‰ç¼€åŒ¹é… path: / # è·¯å¾„ backend: # åç«¯æœåŠ¡ service: # service name: nginx # serviceåç§° port: # ç«¯å£ number: 80 # serviceçš„ç«¯å£ 12345678910# é‡æ–°è¿è¡Œingressk apply -f nginx-ingress.yaml# æŸ¥çœ‹ingressï¼Œæ­¤æ—¶å¤šäº†ä¸€ä¸ª 443 ç«¯å£$ k get ingNAME CLASS HOSTS ADDRESS PORTS AGEweb-ingress nginx nginx.hanqunfeng.com 10.211.55.201 80, 443 51s# è®¿é—®httpsï¼Œä½†æ­¤æ—¶ 80 ç«¯å£è®¿é—®ä¸äº†ï¼Œéœ€è¦é…ç½® 80 ç«¯å£é‡å®šå‘åˆ° 443curl https://nginx.hanqunfeng.com 80ç«¯å£é‡å®šå‘åˆ°443 nginx ingress controllerï¼Œå®ƒå†…ç½®æ”¯æŒé‡å®šå‘ï¼Œä½ å¯ä»¥åœ¨ Ingress ä¸Šæ·»åŠ  annotation 123metadata: annotations: nginx.ingress.kubernetes.io/force-ssl-redirect: &quot;true&quot; # 80 é‡å®šå‘åˆ° 443 å®Œæ•´çš„yaml 123456789101112131415161718192021222324apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: web-ingress namespace: default annotations: nginx.ingress.kubernetes.io/force-ssl-redirect: &quot;true&quot;spec: ingressClassName: nginx tls: - hosts: - nginx.hanqunfeng.com secretName: nginx-tls rules: - host: nginx.hanqunfeng.com http: paths: - pathType: Prefix path: / backend: service: name: nginx port: number: 80 è®¿é—®æµ‹è¯• 1234567891011121314151617181920212223242526272829303132333435363738# é‡æ–°è¿è¡Œingressk apply -f nginx-ingress.yaml# é»˜è®¤æƒ…å†µä¸‹ curl ä¸ä¼šè‡ªåŠ¨è·³è½¬ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®ä¼šè‡ªåŠ¨é‡å®šå‘ï¼Œ308 è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘$ curl http://nginx.hanqunfeng.com&lt;html&gt;&lt;head&gt;&lt;title&gt;308 Permanent Redirect&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;center&gt;&lt;h1&gt;308 Permanent Redirect&lt;/h1&gt;&lt;/center&gt;&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;# æ·»åŠ  -L å‚æ•°ï¼Œcurl ä¼šè‡ªåŠ¨è·³è½¬$ curl -L http://nginx.hanqunfeng.com&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Welcome to nginx!&lt;/title&gt;&lt;style&gt;html &#123; color-scheme: light dark; &#125;body &#123; width: 35em; margin: 0 auto;font-family: Tahoma, Verdana, Arial, sans-serif; &#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;&lt;p&gt;If you see this page, the nginx web server is successfully installed andworking. Further configuration is required.&lt;/p&gt;&lt;p&gt;For online documentation and support please refer to&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;Commercial support is available at&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; åè®° ssl è¯ä¹¦è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ 12345# apply ä¼šç›´æ¥æ›´æ–° Secretï¼Œè€Œä¸æ˜¯åˆ é™¤é‡å»ºkubectl create secret tls nginx-tls \\ --key=æ–°çš„.key \\ --cert=æ–°çš„.pem \\ -n default --dry-run=client -o yaml | kubectl apply -f - Ingress Controllerï¼ˆå¦‚ nginx-ingressï¼‰é€šå¸¸ä¼šè‡ªåŠ¨ç›‘å¬ Secret å˜åŒ–ï¼Œå¤§æ¦‚ 30 ç§’ ~ 1 åˆ†é’Ÿå†…è‡ªåŠ¨çƒ­åŠ è½½æ–°è¯ä¹¦ï¼Œæ— éœ€é‡å¯ Podã€‚ pathType å¯ä»¥è®¾ç½®å“ªäº›å€¼ï¼Ÿ åœ¨ Kubernetes Ingress çš„ pathType å­—æ®µä¸­ï¼Œä¸€å…±å¯ä»¥è®¾ç½®ä»¥ä¸‹ä¸‰ç§å€¼ pathType å€¼ å«ä¹‰ åŒ¹é…è§„åˆ™è¯´æ˜ Exact ç²¾ç¡®åŒ¹é… è·¯å¾„å¿…é¡»å®Œå…¨åŒ¹é… Prefix å‰ç¼€åŒ¹é… ä»¥æŒ‡å®šè·¯å¾„ä¸ºå‰ç¼€å³å¯åŒ¹é… ImplementationSpecific ç”± Ingress Controller è‡ªå·±å†³å®š nginx å¸¸å¸¸è¡¨ç°ä¸ºå‰ç¼€åŒ¹é… Exact ç²¾ç¡®åŒ¹é…ï¼Œä¸”åŒºåˆ†å¤§å°å†™ 1234# åªåŒ¹é… http://example.com/foo# ä¸ä¼šåŒ¹é… /foo/abc æˆ– /foo/- pathType: Exact path: /foo Prefix å‰ç¼€åŒ¹é…ï¼Œä¸”åŒºåˆ†å¤§å°å†™ 1234567# åŒ¹é…æ‰€æœ‰ä»¥ /foo å¼€å¤´çš„è·¯å¾„ï¼š# /foo# /foo/ # ä¼šå¿½ç•¥å°¾éƒ¨çš„ /# /foo/abc# /foo/bar/test- pathType: Prefix path: /foo ImplementationSpecific æ§åˆ¶å™¨è‡ªå®šä¹‰ï¼ˆä¸æ¨èï¼‰ 12345# åŒ¹é…è§„åˆ™ç”± Ingress Controller å†³å®šï¼›# åœ¨ nginx-ingress ä¸­é€šå¸¸è¡Œä¸ºç±»ä¼¼äº Prefixï¼Œä½†ä¸ä¿è¯å…¼å®¹æ€§ï¼›# Kubernetes å®˜æ–¹ä¸æ¨èç”Ÿäº§ä½¿ç”¨ï¼Œå»ºè®®æ˜¾å¼ä½¿ç”¨ Prefix æˆ– Exactã€‚- pathType: ImplementationSpecific path: /foo è®¾ç½®ç¼ºçœçš„ ingressclass æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªç¼ºçœçš„ ingressclass ä¸ºé»˜è®¤å€¼ï¼Œè¿™æ ·ï¼Œå½“åˆ›å»ºingressæ—¶ï¼Œå¦‚æœæœªæŒ‡å®šingressclassï¼Œåˆ™ä½¿ç”¨ç¼ºçœå€¼ å¯ä»¥é€šè¿‡ kubectl patch ä¸º ingressclass ç›´æ¥æ‰“ä¸Šé»˜è®¤æ ‡è¯†(é€šè¿‡ k edit ingressclass ingressclass-name ä¸ºå…¶æ·»åŠ æ³¨è§£ä¹Ÿå¯ä»¥) 1234567# æŸ¥çœ‹ ingressclasses$ k get ingressclassesNAME CONTROLLER PARAMETERS AGEnginx k8s.io/ingress-nginx &lt;none&gt; 3h3m# è®¾ç½® nginx ä¸ºé»˜è®¤ ingressclassï¼Œå°±æ˜¯ä¸ºå…¶åŠ ä¸Šå¦‚ä¸‹æ³¨è§£$ kubectl patch ingressclass nginx -p &#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;ingressclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27; ingerss-nginx åº”ç”¨ç¤ºä¾‹ åŒä¸€åŸŸåä¸åŒè·¯å¾„ 1234567891011121314151617181920212223apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: simple-fanout-examplespec: # æœªæŒ‡å®š ingressClassName ,åˆ™ä½¿ç”¨ ä¸Šæ–‡ä¸­è®¾ç½®çš„é»˜è®¤ ingressClassName rules: - host: foo.bar.com http: paths: - path: /foo pathType: Prefix backend: service: name: service1 port: number: 4200 - path: /bar pathType: Prefix backend: service: name: service2 port: number: 8080 ä¸åŒåŸŸåçš„æœåŠ¡ 1234567891011121314151617181920212223242526apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: name-virtual-host-ingressspec: rules: - host: foo.bar.com http: paths: - pathType: Prefix path: &quot;/&quot; backend: service: name: service1 port: number: 80 - host: bar.foo.com http: paths: - pathType: Prefix path: &quot;/&quot; backend: service: name: service2 port: number: 80 é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯¹ ingress è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹ä¿å­˜(:wq)åä¼šç«‹åˆ»ç”Ÿæ•ˆ 1kubectl edit ingress web-ingress","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S å®‰è£…åŠä½¿ç”¨ Ingress Nginxï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ ingress-nginx å®˜ç½‘ ingress-nginx k8sç®€ä»‹ k8sæ”¯æŒçš„ ingress controller","date_published":"2025-07-19T13:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/18/k8s-service/","url":"https://blog.hanqunfeng.com/2025/07/18/k8s-service/","title":"K8S ä¹‹ Service","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ Service ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/\">k8s Service ä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Service-ä»‹ç»\">Service ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Service(ç¼©å†™ä¸º svc)æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„Podçš„é€»è¾‘é›†ï¼Œå¹¶ä¸ºè¿™äº›Podæ”¯æŒå¤–éƒ¨æµé‡æš´éœ²ã€è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å°½ç®¡æ¯ä¸ªPod éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰Serviceï¼Œè¿™äº›IPä¸ä¼šæš´éœ²åœ¨ç¾¤é›†å¤–éƒ¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Serviceå…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºæ¥æ”¶æµé‡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Serviceä¹Ÿå¯ä»¥ç”¨åœ¨ServiceSpecæ ‡è®°typeçš„æ–¹å¼æš´éœ²ï¼Œtypeç±»å‹å¦‚ä¸‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ClusterIPï¼ˆé»˜è®¤ï¼‰ï¼šåœ¨é›†ç¾¤çš„å†…éƒ¨IPä¸Šå…¬å¼€Serviceã€‚è¿™ç§ç±»å‹ä½¿å¾—Serviceåªèƒ½ä»é›†ç¾¤å†…è®¿é—®ã€‚</li>\n<li class=\"lvl-4\">NodePortï¼šä½¿ç”¨NATåœ¨é›†ç¾¤ä¸­æ¯ä¸ªé€‰å®šNodeçš„ç›¸åŒç«¯å£ä¸Šå…¬å¼€Serviceã€‚ä½¿ç”¨ <NodeIP>:<NodePort> ä»é›†ç¾¤å¤–éƒ¨è®¿é—®Serviceã€‚æ˜¯ClusterIPçš„è¶…é›†ã€‚</li>\n<li class=\"lvl-4\">LoadBalancerï¼šåœ¨å½“å‰äº‘ä¸­åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨(å¦‚æœæ”¯æŒçš„è¯)ï¼Œå¹¶ä¸ºServiceåˆ†é…ä¸€ä¸ªå›ºå®šçš„å¤–éƒ¨IPã€‚æ˜¯NodePortçš„è¶…é›†ã€‚</li>\n<li class=\"lvl-4\">ExternalNameï¼šé€šè¿‡è¿”å›å¸¦æœ‰è¯¥åç§°çš„CNAMEè®°å½•ï¼Œä½¿ç”¨ä»»æ„åç§°ï¼ˆç”±specä¸­çš„externalNameæŒ‡å®šï¼‰å…¬å¼€Serviceã€‚ä¸ä½¿ç”¨ä»£ç†ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"åˆ›å»ºService\">åˆ›å»ºService</h2>\n<h3 id=\"ClusterIP\">ClusterIP</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…ˆåˆ›å»ºdeploymentï¼Œæ­¤æ—¶ä¼šä¸ºæ¯ä¸ªpodæ·»åŠ ä¸€ä¸ªlabel app=nginx</span></span><br><span class=\"line\">kubectl create deployment nginx --image=nginx --replicas=2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºserviceï¼Œï¼Œå°†deploymentçš„podæš´éœ²å‡ºæ¥ï¼Œæš´éœ²ç±»å‹ä¸ºClusterIP</span></span><br><span class=\"line\">kubectl expose deployment nginx --<span class=\"built_in\">type</span>=ClusterIP --port=80</span><br><span class=\"line\">$ kubectl get svc nginx</span><br><span class=\"line\">NAME    TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE</span><br><span class=\"line\">nginx   ClusterIP   10.96.14.90   &lt;none&gt;        80/TCP    60s</span><br></pre></td></tr></table></figure>\n<h3 id=\"NodePort\">NodePort</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æš´éœ²å®¿ä¸»æœºçš„ç«¯å£ï¼Œä¾›å¤–éƒ¨è®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºserviceï¼Œå°†deploymentçš„podæš´éœ²å‡ºæ¥ï¼Œæš´éœ²ç±»å‹ä¸ºNodePort</span></span><br><span class=\"line\">kubectl expose deployment nginx --<span class=\"built_in\">type</span>=NodePort --port=80</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹serviceï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°serviceçš„ç«¯å£å’ŒèŠ‚ç‚¹çš„ç«¯å£ï¼Œä¸ ClusterIP çš„åŒºåˆ«å°±æ˜¯æ˜¯å¦æš´éœ²åœ¨èŠ‚ç‚¹ä¸Šçš„ç«¯å£</span></span><br><span class=\"line\">$ kubectl get svc nginx</span><br><span class=\"line\">NAME    TYPE       CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE</span><br><span class=\"line\">nginx   NodePort   10.96.7.8    &lt;none&gt;        80:32691/TCP   31s</span><br></pre></td></tr></table></figure>\n<h3 id=\"yamlæ–‡ä»¶åˆ›å»ºservice\">yamlæ–‡ä»¶åˆ›å»ºservice</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlæ–‡ä»¶æ ¼å¼</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span>      <span class=\"comment\"># apiç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span>       <span class=\"comment\"># èµ„æºç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span>           <span class=\"comment\"># å…ƒæ•°æ®</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>       <span class=\"comment\"># serviceåç§°</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>               <span class=\"comment\"># é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span>            <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">80</span>        <span class=\"comment\"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span>   <span class=\"comment\"># åè®®</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">80</span>  <span class=\"comment\"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">nodePort:</span> <span class=\"number\">30080</span> <span class=\"comment\"># nodeæš´éœ²çš„ç«¯å£ï¼Œserviceç±»å‹ä¸º NodePort æ—¶ä½¿ç”¨ï¼Œé»˜è®¤èŒƒå›´åœ¨ 30000-32767 ä¹‹é—´</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>         <span class=\"comment\"># é€‰æ‹©å™¨</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>      <span class=\"comment\"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=nginx</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span>    <span class=\"comment\"># serviceç±»å‹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼Œservice é»˜è®¤æ˜¯é€šè¿‡<code>æ ‡ç­¾</code>æ¥åŒ¹é…podçš„ï¼Œæ‰€ä»¥åˆ›å»ºserviceçš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿è¯podçš„æ ‡ç­¾æ˜¯å­˜åœ¨çš„ï¼Œå¦åˆ™serviceæ— æ³•åŒ¹é…podï¼Œå¦å¤–è™½ç„¶æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºserviceæ—¶æ˜¯é€šè¿‡<code>kubectl expose deployment nginx --type=NodePort --port=80</code>åˆ›å»ºçš„ï¼Œä½†ä¹Ÿå¹¶ä¸è¡¨ç¤ºserviceåªä¼šåŒ¹é…è¿™ä¸ªdeploymentåˆ›å»ºçš„podï¼Œè€Œæ˜¯ä¼šåŒ¹é…æ‰€æœ‰å…·æœ‰æŒ‡å®šæ ‡ç­¾çš„podï¼ˆapp=nginxï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–serviceçš„ selector</span></span><br><span class=\"line\">$ k get svc -owide</span><br><span class=\"line\">NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE    SELECTOR</span><br><span class=\"line\">kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP        4d5h   &lt;none&gt;</span><br><span class=\"line\">nginx        NodePort    10.96.9.77   &lt;none&gt;        80:30080/TCP   8s     app=nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œæœ‰ä¸ªåç§°ä¸º kubernetes çš„ serviceï¼Œå…¶ä½œç”¨æ˜¯ä¸ºäº†æ–¹ä¾¿é›†ç¾¤å†…éƒ¨çš„ Pod è°ƒç”¨ API Server çš„ç»Ÿä¸€å…¥å£</span></span><br><span class=\"line\"><span class=\"comment\"># æ— è®º API Server å®é™…è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹å“ªä¸ª IPï¼Œé›†ç¾¤å†…éƒ¨åªè¦è®¿é—®å¦‚ä¸‹åœ°å€å°±èƒ½è®¿é—® API Serverã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># https://kubernetes.default.svc</span></span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\"><span class=\"comment\"># https://10.96.0.1</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™ä¸ª Service æ˜¯ ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œä¸å»ºè®®åˆ é™¤æˆ–ä¿®æ”¹ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ExternalName\">ExternalName</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥å°†å…¶å®ƒ namespace çš„ service åˆ«ååˆ° å½“å‰ namespaceï¼Œè¿™æ ·è®¿é—® service æ—¶å°±ä¸éœ€è¦åŠ ä¸Šå‘½åç©ºé—´åç§°äº†</p>\n</li>\n<li class=\"lvl-2\">\n<p>ExternalName Service æ˜¯çº¯ DNS CNAME æ˜ å°„ï¼Œæˆ‘ä»¬ä¸ç»å¯ä»¥æ˜ å°„é›†ç¾¤å†…å®¹æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜ å°„é›†ç¾¤å¤–éƒ¨æœåŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŸå…ˆçš„ service è®¿é—®æ–¹å¼ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨ä¸åŒå‘½åç©ºé—´ä¸‹åˆ›å»ºservice</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸¤ä¸ªå‘½åç©ºé—´ä»¥åŠä¸‹é¢çš„èµ„æº</span></span><br><span class=\"line\"><span class=\"comment\">## ns1</span></span><br><span class=\"line\">kubectl create namespace ns1</span><br><span class=\"line\">kubectl create deployment alpine-demo -n ns1 --image=alpine/curl --replicas=1 -- /bin/sh -c <span class=\"string\">&quot;sleep infinity&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ns2</span></span><br><span class=\"line\">kubectl create namespace ns2</span><br><span class=\"line\">kubectl create deployment nginx-demo -n ns2 --image=nginx --replicas=1</span><br><span class=\"line\">kubectl expose deployment nginx-demo -n ns2 --<span class=\"built_in\">type</span>=ClusterIP --port=80 --name=nginx-service</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥ ns1 ä¸­çš„ pod è®¿é—® ns2 ä¸­çš„ nginx-service</span></span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> -it -n ns1 alpine-demo-66895487c8-sk4t4 -- /bin/sh</span><br><span class=\"line\">curl nginx-service.ns2.svc.cluster.local</span><br><span class=\"line\">curl nginx-service.ns2</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ExternalName è®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨ ns1 ä¸­åˆ›å»º externalName ç±»å‹çš„ serviceï¼Œ--external-name æŒ‡å®š ns2 ä¸­çš„ nginx-service</span></span><br><span class=\"line\">kubectl create service externalname nginx-service -n ns1 --external-name=nginx-service.ns2.svc.cluster.local</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥é€šè¿‡ yaml åˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx-service</span>                               <span class=\"comment\"># service åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">ns1</span>                                    <span class=\"comment\"># æŒ‡å®šå‘½åç©ºé—´ ä¸º ns1</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">externalName:</span> <span class=\"string\">nginx-service.ns2.svc.cluster.local</span> <span class=\"comment\"># æŒ‡å®šå¤–éƒ¨æœåŠ¡åï¼Œæ¯”å¦‚ www.baidu.com</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">ExternalName</span>                                <span class=\"comment\"># æŒ‡å®šä¸º ExternalName ç±»å‹</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                                         <span class=\"comment\"># ä¸éœ€è¦é…ç½® selector</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx-service</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ service</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get svc -n ns1</span><br><span class=\"line\">NAME            TYPE           CLUSTER-IP   EXTERNAL-IP                           PORT(S)   AGE</span><br><span class=\"line\">nginx-service   ExternalName   &lt;none&gt;       nginx-service.ns2.svc.cluster.local   &lt;none&gt;    16s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶å†æ¬¡è¿›å…¥ ns1 ä¸­çš„ pod è®¿é—® ns2 ä¸­çš„ nginx-service æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl <span class=\"built_in\">exec</span> -it -n ns1 alpine-demo-66895487c8-sk4t4 -- /bin/sh</span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶å°±ä¸éœ€è¦åŠ ä¸Š ns2 çš„ namespace äº†</span></span><br><span class=\"line\">curl nginx-service</span><br></pre></td></tr></table></figure>\n<h3 id=\"LoadBalancer\">LoadBalancer</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>LoadBalancer æ˜¯ Kubernetes Service çš„ä¸€ç§ç±»å‹ï¼Œç”¨äºè‡ªåŠ¨ç”³è¯·ä¸€ä¸ªäº‘å‚å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ AWS ELBã€GCP LBã€é˜¿é‡Œäº‘ SLBï¼‰ï¼Œå°†å¤–éƒ¨æµé‡è½¬å‘åˆ° Kubernetes é›†ç¾¤å†…éƒ¨çš„ Pod ä¸Šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ç§æœ‰äº‘ä¸Šï¼Œéœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹è´Ÿè½½å‡è¡¡å™¨æ¥å®ç°ï¼Œæ¯”å¦‚ <a href=\"https://metallb.io\">MetalLB</a>ï¼Œ<a href=\"https://github.com/metallb/metallb\">github</a></p>\n</li>\n</ul>\n<h4 id=\"å®‰è£…-MetallB\">å®‰è£… MetallB</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœæ‚¨åœ¨IPVSæ¨¡å¼ä¸‹ä½¿ç”¨kubeä»£ç†ï¼Œä»Kubernetes v1.14.2å¼€å§‹ï¼Œæ‚¨å¿…é¡»å¯ç”¨ä¸¥æ ¼çš„ARPæ¨¡å¼ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨kube-routerä½œä¸ºæœåŠ¡ä»£ç†ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸ªï¼Œå› ä¸ºå®ƒé»˜è®¤å¯ç”¨äº†ä¸¥æ ¼çš„ARPã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å°†è¦äº§ç”Ÿçš„å˜æ›´ï¼Œå¦‚æœæœ‰å˜æ›´åˆ™è¿”å›éé›¶çŠ¶æ€ç </span></span><br><span class=\"line\">kubectl get configmap kube-proxy -n kube-system -o yaml | \\</span><br><span class=\"line\">sed -e <span class=\"string\">&quot;s/strictARP: false/strictARP: true/&quot;</span> | \\</span><br><span class=\"line\">kubectl diff -f - -n kube-system</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®é™…åº”ç”¨å˜æ›´ï¼Œåªæœ‰å‘ç”Ÿé”™è¯¯æ—¶æ‰è¿”å›éé›¶çŠ¶æ€ç </span></span><br><span class=\"line\">kubectl get configmap kube-proxy -n kube-system -o yaml | \\</span><br><span class=\"line\">sed -e <span class=\"string\">&quot;s/strictARP: false/strictARP: true/&quot;</span> | \\</span><br><span class=\"line\">kubectl apply -f - -n kube-system</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…MetalLB</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> METLB_VERSION=v0.15.2</span><br><span class=\"line\">curl -L -o metallb.yaml https://raw.githubusercontent.com/metallb/metallb/<span class=\"variable\">$&#123;METLB_VERSION&#125;</span>/config/manifests/metallb-native.yaml</span><br><span class=\"line\">kubectl apply -f metallb.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹MetalLBèµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get all -n metallb-system -owide</span><br><span class=\"line\">NAME                              READY   STATUS    RESTARTS      AGE     IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">pod/controller-58fdf44d87-bsp4z   1/1     Running   0             4m13s   10.244.194.104   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">pod/speaker-sjvq5                 1/1     Running   0             4m13s   10.211.55.15     k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">pod/speaker-srpp4                 1/1     Running   0             4m13s   10.211.55.16     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">pod/speaker-tbnls                 1/1     Running   2 (98s ago)   4m13s   10.211.55.11     k8s-master    &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                              TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE     SELECTOR</span><br><span class=\"line\">service/metallb-webhook-service   ClusterIP   10.96.233.8   &lt;none&gt;        443/TCP   4m14s   component=controller</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE     CONTAINERS   IMAGES                            SELECTOR</span><br><span class=\"line\">daemonset.apps/speaker   3         3         3       3            3           kubernetes.io/os=linux   4m13s   speaker      quay.io/metallb/speaker:v0.15.2   app=metallb,component=speaker</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                         READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS   IMAGES                               SELECTOR</span><br><span class=\"line\">deployment.apps/controller   1/1     1            1           4m14s   controller   quay.io/metallb/controller:v0.15.2   app=metallb,component=controller</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                    DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES                               SELECTOR</span><br><span class=\"line\">replicaset.apps/controller-58fdf44d87   1         1         1       4m13s   controller   quay.io/metallb/controller:v0.15.2   app=metallb,component=controller,pod-template-hash=58fdf44d87</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®åœ°å€æ± :metallb-pool.yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">metallb.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">IPAddressPool</span>                 <span class=\"comment\"># åœ°å€æ± ç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metallb-pool</span>                <span class=\"comment\"># åœ°å€æ± åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">metallb-system</span>         <span class=\"comment\"># å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">addresses:</span>                        <span class=\"comment\"># é…ç½®åœ°å€æ± </span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.200</span><span class=\"number\">-10.211</span><span class=\"number\">.55</span><span class=\"number\">.250</span>     <span class=\"comment\"># ä¸ èŠ‚ç‚¹ ç›¸åŒçš„ç½‘æ®µï¼Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥åˆ†é…çš„IPèŒƒå›´</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f metallb-pool.yaml</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®åœ°å€æ± çš„äºŒçº§å…¬å‘Š:metallb-advertisement.yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">metallb.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">L2Advertisement</span>               <span class=\"comment\"># åœ°å€æ± äºŒçº§å…¬å‘Šç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metallb-advertisement</span>       <span class=\"comment\"># å…¬å‘Šåç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">metallb-system</span>         <span class=\"comment\"># å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ipAddressPools:</span>                   <span class=\"comment\"># åœ°å€æ± åç§°åˆ—è¡¨ï¼Œåªæœ‰è¢«å…¬å‘Šçš„åœ°å€æ± æ‰ä¼šè¢«ä½¿ç”¨</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">metallb-pool</span>                    <span class=\"comment\"># åœ°å€æ± åç§°</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f metallb-advertisement.yaml</span><br></pre></td></tr></table></figure>\n<h4 id=\"åˆ›å»º-LoadBalancer-ç±»å‹çš„-service\">åˆ›å»º LoadBalancer ç±»å‹çš„ service</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>metallb-service.yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span>                  <span class=\"comment\"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº Deployment èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span>                     <span class=\"comment\"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆDeploymentï¼‰</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                       <span class=\"comment\"># æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†èµ„æºï¼Œå¯ä¸ selector åŒ¹é…</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                        <span class=\"comment\"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">ns1</span>                     <span class=\"comment\"># å‘½åç©ºé—´ï¼Œé»˜è®¤ä¸º default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                                <span class=\"comment\"># é…ç½®é¡¹</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span>                        <span class=\"comment\"># å‰¯æœ¬æ•°ï¼Œè¡¨ç¤ºå¸Œæœ›è¿è¡Œå¤šå°‘ä¸ª Pod å®ä¾‹</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                          <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span>                     <span class=\"comment\"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                     <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š Deployment ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span>                          <span class=\"comment\"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                   <span class=\"comment\"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">nginx</span>                 <span class=\"comment\"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ nginx é•œåƒ</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                  <span class=\"comment\"># å®¹å™¨çš„åç§°</span></span><br><span class=\"line\"><span class=\"string\">---</span>                                  <span class=\"comment\"># åˆ†å‰²çº¿</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span>                       <span class=\"comment\"># apiç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span>                        <span class=\"comment\"># èµ„æºç±»å‹</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span>                            <span class=\"comment\"># å…ƒæ•°æ®</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span>                        <span class=\"comment\"># serviceåç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">ns1</span>                     <span class=\"comment\"># å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                                <span class=\"comment\"># é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span>                             <span class=\"comment\"># ç«¯å£</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">80</span>                         <span class=\"comment\"># é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡»</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span>                    <span class=\"comment\"># åè®®</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">80</span>                   <span class=\"comment\"># å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                          <span class=\"comment\"># é€‰æ‹©å™¨</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nginx</span>                       <span class=\"comment\"># podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=nginx</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">LoadBalancer</span>                 <span class=\"comment\"># serviceç±»å‹</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k apply -f metallb-service.yaml</span><br><span class=\"line\">deployment.apps/nginx created</span><br><span class=\"line\">service/nginx created</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹service</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯ä»¥çœ‹åˆ° service çš„ç±»å‹ä¸º LoadBalancerï¼Œå¹¶åˆ†é…äº† EXTERNAL-IPï¼Œè¿™é‡Œè¿˜å¼€æ”¾äº†nodePort 30613</span></span><br><span class=\"line\">$ kubectl get svc -n ns1</span><br><span class=\"line\">NAME         TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE</span><br><span class=\"line\">nginx        LoadBalancer   10.96.210.244   10.211.55.200   80:30613/TCP   52s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®service</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é€šè¿‡ service çš„ port è®¿é—®ï¼Œè¿™é‡Œæ˜¯ 80</span></span><br><span class=\"line\">curl 10.211.55.200</span><br><span class=\"line\"><span class=\"comment\"># åŒæ ·å¯ä»¥åŸºäº nodeIP+nodePort è®¿é—®</span></span><br><span class=\"line\">curl 10.211.55.11:30613</span><br></pre></td></tr></table></figure>\n<h2 id=\"è®¿é—®serviceï¼Œè½®è¯¢pod\">è®¿é—®serviceï¼Œè½®è¯¢pod</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## åœ¨é›†ç¾¤å†…</span></span><br><span class=\"line\"><span class=\"comment\"># åœ¨ç›¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ serviceName ç›´æ¥è®¿é—®</span></span><br><span class=\"line\">curl nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥é€šè¿‡ CLUSTER-IP è®¿é—®</span></span><br><span class=\"line\">curl 10.96.9.77</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨ä¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ &lt;serviceName&gt;.&lt;namespace&gt; æˆ–è€… &lt;serviceName&gt;.&lt;namespace&gt;.svc.cluster.local è®¿é—®ï¼Œæ¯”å¦‚æœ¬ç¤ºä¾‹ä¸º</span></span><br><span class=\"line\">curl nginx.default</span><br><span class=\"line\">curl nginx.default.svc.cluster.local</span><br><span class=\"line\"><span class=\"comment\"># è¿™æ˜¯å› ä¸ºåœ¨åˆ›å»º serviceå‰ï¼Œæˆ‘ä»¬æ˜¯ä¸çŸ¥é“ service çš„ IP åœ°å€çš„ï¼Œæ‰€ä»¥åœ¨å…¶å®ƒpodä¸­å°±å¯ä»¥é¢„å…ˆä½¿ç”¨ &lt;serviceName&gt;.&lt;namespace&gt; å ä½ï¼Œk8sä¼šè‡ªåŠ¨å°†å…¶è§£æä¸º service çš„ CLUSTER-IP</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## åœ¨é›†ç¾¤å¤–</span></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡ NODE-IP:NODE-PORT è®¿é—®</span></span><br><span class=\"line\">curl 10.211.55.16:30080</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç®¡ç†service\">ç®¡ç†service</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹service</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹service</span></span><br><span class=\"line\">kubectl get svc</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šnamespaceä¸‹çš„service</span></span><br><span class=\"line\">kubectl get svc -n kube-system</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å…¨éƒ¨service</span></span><br><span class=\"line\">kubectl get svc -A</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹serviceè¯¦æƒ…</span></span><br><span class=\"line\">kubectl get svc nginx -o yaml</span><br><span class=\"line\">kubectl describe svc nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ—¥å¿—</span></span><br><span class=\"line\">k logs svc/nginx</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¾‘serviceï¼Œä¿å­˜ï¼ˆ:wqï¼‰åç”Ÿæ•ˆï¼Œä¸éœ€è¦é¢å¤– apply æˆ– restart</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl edit svc nginx</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤service</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete svc nginx</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Service ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Service ä»‹ç» Service ä»‹ç» Service(ç¼©å†™ä¸º svc)æ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„Podçš„é€»è¾‘é›†ï¼Œå¹¶ä¸ºè¿™äº›Podæ”¯æŒå¤–éƒ¨æµé‡æš´éœ²ã€è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°ã€‚ å°½ç®¡æ¯ä¸ªPod éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰Serviceï¼Œè¿™äº›IPä¸ä¼šæš´éœ²åœ¨ç¾¤é›†å¤–éƒ¨ã€‚ Serviceå…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºæ¥æ”¶æµé‡ã€‚ Serviceä¹Ÿå¯ä»¥ç”¨åœ¨ServiceSpecæ ‡è®°typeçš„æ–¹å¼æš´éœ²ï¼Œtypeç±»å‹å¦‚ä¸‹ï¼š ClusterIPï¼ˆé»˜è®¤ï¼‰ï¼šåœ¨é›†ç¾¤çš„å†…éƒ¨IPä¸Šå…¬å¼€Serviceã€‚è¿™ç§ç±»å‹ä½¿å¾—Serviceåªèƒ½ä»é›†ç¾¤å†…è®¿é—®ã€‚ NodePortï¼šä½¿ç”¨NATåœ¨é›†ç¾¤ä¸­æ¯ä¸ªé€‰å®šNodeçš„ç›¸åŒç«¯å£ä¸Šå…¬å¼€Serviceã€‚ä½¿ç”¨ : ä»é›†ç¾¤å¤–éƒ¨è®¿é—®Serviceã€‚æ˜¯ClusterIPçš„è¶…é›†ã€‚ LoadBalancerï¼šåœ¨å½“å‰äº‘ä¸­åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨(å¦‚æœæ”¯æŒçš„è¯)ï¼Œå¹¶ä¸ºServiceåˆ†é…ä¸€ä¸ªå›ºå®šçš„å¤–éƒ¨IPã€‚æ˜¯NodePortçš„è¶…é›†ã€‚ ExternalNameï¼šé€šè¿‡è¿”å›å¸¦æœ‰è¯¥åç§°çš„CNAMEè®°å½•ï¼Œä½¿ç”¨ä»»æ„åç§°ï¼ˆç”±specä¸­çš„externalNameæŒ‡å®šï¼‰å…¬å¼€Serviceã€‚ä¸ä½¿ç”¨ä»£ç†ã€‚ åˆ›å»ºService ClusterIP åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—® 12345678# å…ˆåˆ›å»ºdeploymentï¼Œæ­¤æ—¶ä¼šä¸ºæ¯ä¸ªpodæ·»åŠ ä¸€ä¸ªlabel app=nginxkubectl create deployment nginx --image=nginx --replicas=2# åˆ›å»ºserviceï¼Œï¼Œå°†deploymentçš„podæš´éœ²å‡ºæ¥ï¼Œæš´éœ²ç±»å‹ä¸ºClusterIPkubectl expose deployment nginx --type=ClusterIP --port=80$ kubectl get svc nginxNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEnginx ClusterIP 10.96.14.90 &lt;none&gt; 80/TCP 60s NodePort æš´éœ²å®¿ä¸»æœºçš„ç«¯å£ï¼Œä¾›å¤–éƒ¨è®¿é—® 123456# åˆ›å»ºserviceï¼Œå°†deploymentçš„podæš´éœ²å‡ºæ¥ï¼Œæš´éœ²ç±»å‹ä¸ºNodePortkubectl expose deployment nginx --type=NodePort --port=80# æŸ¥çœ‹serviceï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°serviceçš„ç«¯å£å’ŒèŠ‚ç‚¹çš„ç«¯å£ï¼Œä¸ ClusterIP çš„åŒºåˆ«å°±æ˜¯æ˜¯å¦æš´éœ²åœ¨èŠ‚ç‚¹ä¸Šçš„ç«¯å£$ kubectl get svc nginxNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEnginx NodePort 10.96.7.8 &lt;none&gt; 80:32691/TCP 31s yamlæ–‡ä»¶åˆ›å»ºservice yamlæ–‡ä»¶æ ¼å¼ 12345678910111213apiVersion: v1 # apiç‰ˆæœ¬kind: Service # èµ„æºç±»å‹metadata: # å…ƒæ•°æ® name: nginx # serviceåç§°spec: # é…ç½® ports: # ç«¯å£ - port: 80 # é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡» protocol: TCP # åè®® targetPort: 80 # å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´ nodePort: 30080 # nodeæš´éœ²çš„ç«¯å£ï¼Œserviceç±»å‹ä¸º NodePort æ—¶ä½¿ç”¨ï¼Œé»˜è®¤èŒƒå›´åœ¨ 30000-32767 ä¹‹é—´ selector: # é€‰æ‹©å™¨ app: nginx # podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=nginx type: NodePort # serviceç±»å‹ è¿™é‡Œæœ‰ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼Œservice é»˜è®¤æ˜¯é€šè¿‡æ ‡ç­¾æ¥åŒ¹é…podçš„ï¼Œæ‰€ä»¥åˆ›å»ºserviceçš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿è¯podçš„æ ‡ç­¾æ˜¯å­˜åœ¨çš„ï¼Œå¦åˆ™serviceæ— æ³•åŒ¹é…podï¼Œå¦å¤–è™½ç„¶æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºserviceæ—¶æ˜¯é€šè¿‡kubectl expose deployment nginx --type=NodePort --port=80åˆ›å»ºçš„ï¼Œä½†ä¹Ÿå¹¶ä¸è¡¨ç¤ºserviceåªä¼šåŒ¹é…è¿™ä¸ªdeploymentåˆ›å»ºçš„podï¼Œè€Œæ˜¯ä¼šåŒ¹é…æ‰€æœ‰å…·æœ‰æŒ‡å®šæ ‡ç­¾çš„podï¼ˆapp=nginxï¼‰ã€‚ 123456789101112# è·å–serviceçš„ selector$ k get svc -owideNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORkubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443/TCP 4d5h &lt;none&gt;nginx NodePort 10.96.9.77 &lt;none&gt; 80:30080/TCP 8s app=nginx# è¿™é‡Œæœ‰ä¸ªåç§°ä¸º kubernetes çš„ serviceï¼Œå…¶ä½œç”¨æ˜¯ä¸ºäº†æ–¹ä¾¿é›†ç¾¤å†…éƒ¨çš„ Pod è°ƒç”¨ API Server çš„ç»Ÿä¸€å…¥å£# æ— è®º API Server å®é™…è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹å“ªä¸ª IPï¼Œé›†ç¾¤å†…éƒ¨åªè¦è®¿é—®å¦‚ä¸‹åœ°å€å°±èƒ½è®¿é—® API Serverã€‚# https://kubernetes.default.svc# æˆ–è€…# https://10.96.0.1# è¿™ä¸ª Service æ˜¯ ç³»ç»Ÿè‡ªå¸¦çš„ï¼Œä¸å»ºè®®åˆ é™¤æˆ–ä¿®æ”¹ã€‚ ExternalName å¯ä»¥å°†å…¶å®ƒ namespace çš„ service åˆ«ååˆ° å½“å‰ namespaceï¼Œè¿™æ ·è®¿é—® service æ—¶å°±ä¸éœ€è¦åŠ ä¸Šå‘½åç©ºé—´åç§°äº† ExternalName Service æ˜¯çº¯ DNS CNAME æ˜ å°„ï¼Œæˆ‘ä»¬ä¸ç»å¯ä»¥æ˜ å°„é›†ç¾¤å†…å®¹æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜ å°„é›†ç¾¤å¤–éƒ¨æœåŠ¡ã€‚ åŸå…ˆçš„ service è®¿é—®æ–¹å¼ï¼š 123456789101112131415# åœ¨ä¸åŒå‘½åç©ºé—´ä¸‹åˆ›å»ºservice# åˆ›å»ºä¸¤ä¸ªå‘½åç©ºé—´ä»¥åŠä¸‹é¢çš„èµ„æº## ns1kubectl create namespace ns1kubectl create deployment alpine-demo -n ns1 --image=alpine/curl --replicas=1 -- /bin/sh -c &quot;sleep infinity&quot;## ns2kubectl create namespace ns2kubectl create deployment nginx-demo -n ns2 --image=nginx --replicas=1kubectl expose deployment nginx-demo -n ns2 --type=ClusterIP --port=80 --name=nginx-service# è¿›å…¥ ns1 ä¸­çš„ pod è®¿é—® ns2 ä¸­çš„ nginx-servicekubectl exec -it -n ns1 alpine-demo-66895487c8-sk4t4 -- /bin/shcurl nginx-service.ns2.svc.cluster.localcurl nginx-service.ns2 ExternalName è®¿é—® 12# åœ¨ ns1 ä¸­åˆ›å»º externalName ç±»å‹çš„ serviceï¼Œ--external-name æŒ‡å®š ns2 ä¸­çš„ nginx-servicekubectl create service externalname nginx-service -n ns1 --external-name=nginx-service.ns2.svc.cluster.local ä¹Ÿå¯ä»¥é€šè¿‡ yaml åˆ›å»º 12345678910apiVersion: v1kind: Servicemetadata: name: nginx-service # service åç§° namespace: ns1 # æŒ‡å®šå‘½åç©ºé—´ ä¸º ns1spec: externalName: nginx-service.ns2.svc.cluster.local # æŒ‡å®šå¤–éƒ¨æœåŠ¡åï¼Œæ¯”å¦‚ www.baidu.com type: ExternalName # æŒ‡å®šä¸º ExternalName ç±»å‹ selector: # ä¸éœ€è¦é…ç½® selector app: nginx-service æŸ¥çœ‹ service 123$ k get svc -n ns1NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEnginx-service ExternalName &lt;none&gt; nginx-service.ns2.svc.cluster.local &lt;none&gt; 16s æ­¤æ—¶å†æ¬¡è¿›å…¥ ns1 ä¸­çš„ pod è®¿é—® ns2 ä¸­çš„ nginx-service æœåŠ¡ 123kubectl exec -it -n ns1 alpine-demo-66895487c8-sk4t4 -- /bin/sh# æ­¤æ—¶å°±ä¸éœ€è¦åŠ ä¸Š ns2 çš„ namespace äº†curl nginx-service LoadBalancer LoadBalancer æ˜¯ Kubernetes Service çš„ä¸€ç§ç±»å‹ï¼Œç”¨äºè‡ªåŠ¨ç”³è¯·ä¸€ä¸ªäº‘å‚å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚ AWS ELBã€GCP LBã€é˜¿é‡Œäº‘ SLBï¼‰ï¼Œå°†å¤–éƒ¨æµé‡è½¬å‘åˆ° Kubernetes é›†ç¾¤å†…éƒ¨çš„ Pod ä¸Šã€‚ åœ¨ç§æœ‰äº‘ä¸Šï¼Œéœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹è´Ÿè½½å‡è¡¡å™¨æ¥å®ç°ï¼Œæ¯”å¦‚ MetalLBï¼Œgithub å®‰è£… MetallB å¦‚æœæ‚¨åœ¨IPVSæ¨¡å¼ä¸‹ä½¿ç”¨kubeä»£ç†ï¼Œä»Kubernetes v1.14.2å¼€å§‹ï¼Œæ‚¨å¿…é¡»å¯ç”¨ä¸¥æ ¼çš„ARPæ¨¡å¼ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨kube-routerä½œä¸ºæœåŠ¡ä»£ç†ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸ªï¼Œå› ä¸ºå®ƒé»˜è®¤å¯ç”¨äº†ä¸¥æ ¼çš„ARPã€‚ 123456789# æŸ¥çœ‹å°†è¦äº§ç”Ÿçš„å˜æ›´ï¼Œå¦‚æœæœ‰å˜æ›´åˆ™è¿”å›éé›¶çŠ¶æ€ç kubectl get configmap kube-proxy -n kube-system -o yaml | \\sed -e &quot;s/strictARP: false/strictARP: true/&quot; | \\kubectl diff -f - -n kube-system# å®é™…åº”ç”¨å˜æ›´ï¼Œåªæœ‰å‘ç”Ÿé”™è¯¯æ—¶æ‰è¿”å›éé›¶çŠ¶æ€ç kubectl get configmap kube-proxy -n kube-system -o yaml | \\sed -e &quot;s/strictARP: false/strictARP: true/&quot; | \\kubectl apply -f - -n kube-system å®‰è£…MetalLB 123export METLB_VERSION=v0.15.2curl -L -o metallb.yaml https://raw.githubusercontent.com/metallb/metallb/$&#123;METLB_VERSION&#125;/config/manifests/metallb-native.yamlkubectl apply -f metallb.yaml æŸ¥çœ‹MetalLBèµ„æº 123456789101112131415161718$ k get all -n metallb-system -owideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESpod/controller-58fdf44d87-bsp4z 1/1 Running 0 4m13s 10.244.194.104 k8s-worker1 &lt;none&gt; &lt;none&gt;pod/speaker-sjvq5 1/1 Running 0 4m13s 10.211.55.15 k8s-worker1 &lt;none&gt; &lt;none&gt;pod/speaker-srpp4 1/1 Running 0 4m13s 10.211.55.16 k8s-worker2 &lt;none&gt; &lt;none&gt;pod/speaker-tbnls 1/1 Running 2 (98s ago) 4m13s 10.211.55.11 k8s-master &lt;none&gt; &lt;none&gt;NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORservice/metallb-webhook-service ClusterIP 10.96.233.8 &lt;none&gt; 443/TCP 4m14s component=controllerNAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE CONTAINERS IMAGES SELECTORdaemonset.apps/speaker 3 3 3 3 3 kubernetes.io/os=linux 4m13s speaker quay.io/metallb/speaker:v0.15.2 app=metallb,component=speakerNAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTORdeployment.apps/controller 1/1 1 1 4m14s controller quay.io/metallb/controller:v0.15.2 app=metallb,component=controllerNAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTORreplicaset.apps/controller-58fdf44d87 1 1 1 4m13s controller quay.io/metallb/controller:v0.15.2 app=metallb,component=controller,pod-template-hash=58fdf44d87 é…ç½®åœ°å€æ± :metallb-pool.yaml 12345678apiVersion: metallb.io/v1beta1kind: IPAddressPool # åœ°å€æ± ç±»å‹metadata: name: metallb-pool # åœ°å€æ± åç§° namespace: metallb-system # å‘½åç©ºé—´spec: addresses: # é…ç½®åœ°å€æ±  - 10.211.55.200-10.211.55.250 # ä¸ èŠ‚ç‚¹ ç›¸åŒçš„ç½‘æ®µï¼Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥åˆ†é…çš„IPèŒƒå›´ 1kubectl apply -f metallb-pool.yaml é…ç½®åœ°å€æ± çš„äºŒçº§å…¬å‘Š:metallb-advertisement.yaml 12345678apiVersion: metallb.io/v1beta1kind: L2Advertisement # åœ°å€æ± äºŒçº§å…¬å‘Šç±»å‹metadata: name: metallb-advertisement # å…¬å‘Šåç§° namespace: metallb-system # å‘½åç©ºé—´spec: ipAddressPools: # åœ°å€æ± åç§°åˆ—è¡¨ï¼Œåªæœ‰è¢«å…¬å‘Šçš„åœ°å€æ± æ‰ä¼šè¢«ä½¿ç”¨ - metallb-pool # åœ°å€æ± åç§° 1kubectl apply -f metallb-advertisement.yaml åˆ›å»º LoadBalancer ç±»å‹çš„ service metallb-service.yaml 12345678910111213141516171819202122232425262728293031323334apiVersion: apps/v1 # æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº Deployment èµ„æºkind: Deployment # Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆDeploymentï¼‰metadata: labels: app: nginx # æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†èµ„æºï¼Œå¯ä¸ selector åŒ¹é… name: nginx # èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰ namespace: ns1 # å‘½åç©ºé—´ï¼Œé»˜è®¤ä¸º defaultspec: # é…ç½®é¡¹ replicas: 3 # å‰¯æœ¬æ•°ï¼Œè¡¨ç¤ºå¸Œæœ›è¿è¡Œå¤šå°‘ä¸ª Pod å®ä¾‹ selector: # é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod matchLabels: # æ ‡ç­¾é€‰æ‹©å™¨ app: nginx # é€‰æ‹©å™¨ï¼ŒæŒ‡å®š Deployment ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰ template: # æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½® metadata: labels: app: nginx # Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´ spec: containers: - image: nginx # å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ nginx é•œåƒ name: nginx # å®¹å™¨çš„åç§°--- # åˆ†å‰²çº¿apiVersion: v1 # apiç‰ˆæœ¬kind: Service # èµ„æºç±»å‹metadata: # å…ƒæ•°æ® name: nginx # serviceåç§° namespace: ns1 # å‘½åç©ºé—´spec: # é…ç½® ports: # ç«¯å£ - port: 80 # é›†ç¾¤å†…è®¿é—®ç«¯å£ï¼Œserviceçš„ç«¯å£ï¼Œä¸€èˆ¬é…ç½®ä¸ºä¸ targetPort ä¸€è‡´ï¼Œä½†æ˜¯éå¿…é¡» protocol: TCP # åè®® targetPort: 80 # å®¹å™¨ç«¯å£, podçš„ç«¯å£ï¼Œè¿™ä¸ªå¿…é¡»ä¸å®é™…å®¹å™¨ç«¯å£ä¸€è‡´ selector: # é€‰æ‹©å™¨ app: nginx # podçš„æ ‡ç­¾ï¼Œå³åŒ¹é…podçš„æ ‡ç­¾ app=nginx type: LoadBalancer # serviceç±»å‹ 123$ k apply -f metallb-service.yamldeployment.apps/nginx createdservice/nginx created æŸ¥çœ‹service 1234# å¯ä»¥çœ‹åˆ° service çš„ç±»å‹ä¸º LoadBalancerï¼Œå¹¶åˆ†é…äº† EXTERNAL-IPï¼Œè¿™é‡Œè¿˜å¼€æ”¾äº†nodePort 30613$ kubectl get svc -n ns1NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEnginx LoadBalancer 10.96.210.244 10.211.55.200 80:30613/TCP 52s è®¿é—®service 1234# é€šè¿‡ service çš„ port è®¿é—®ï¼Œè¿™é‡Œæ˜¯ 80curl 10.211.55.200# åŒæ ·å¯ä»¥åŸºäº nodeIP+nodePort è®¿é—®curl 10.211.55.11:30613 è®¿é—®serviceï¼Œè½®è¯¢pod 12345678910111213141516## åœ¨é›†ç¾¤å†…# åœ¨ç›¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ serviceName ç›´æ¥è®¿é—®curl nginx# ä¹Ÿå¯ä»¥é€šè¿‡ CLUSTER-IP è®¿é—®curl 10.96.9.77# åœ¨ä¸åŒçš„ namespace ä¸­ï¼Œå¯ä»¥é€šè¿‡ &lt;serviceName&gt;.&lt;namespace&gt; æˆ–è€… &lt;serviceName&gt;.&lt;namespace&gt;.svc.cluster.local è®¿é—®ï¼Œæ¯”å¦‚æœ¬ç¤ºä¾‹ä¸ºcurl nginx.defaultcurl nginx.default.svc.cluster.local# è¿™æ˜¯å› ä¸ºåœ¨åˆ›å»º serviceå‰ï¼Œæˆ‘ä»¬æ˜¯ä¸çŸ¥é“ service çš„ IP åœ°å€çš„ï¼Œæ‰€ä»¥åœ¨å…¶å®ƒpodä¸­å°±å¯ä»¥é¢„å…ˆä½¿ç”¨ &lt;serviceName&gt;.&lt;namespace&gt; å ä½ï¼Œk8sä¼šè‡ªåŠ¨å°†å…¶è§£æä¸º service çš„ CLUSTER-IP## åœ¨é›†ç¾¤å¤–# é€šè¿‡ NODE-IP:NODE-PORT è®¿é—®curl 10.211.55.16:30080 ç®¡ç†service æŸ¥çœ‹service 123456789101112# æŸ¥çœ‹servicekubectl get svc# æŸ¥çœ‹æŒ‡å®šnamespaceä¸‹çš„servicekubectl get svc -n kube-system# æŸ¥çœ‹å…¨éƒ¨servicekubectl get svc -A# æŸ¥çœ‹serviceè¯¦æƒ…kubectl get svc nginx -o yamlkubectl describe svc nginx# æŸ¥çœ‹æ—¥å¿—k logs svc/nginx ç¼–è¾‘serviceï¼Œä¿å­˜ï¼ˆ:wqï¼‰åç”Ÿæ•ˆï¼Œä¸éœ€è¦é¢å¤– apply æˆ– restart 1kubectl edit svc nginx åˆ é™¤service 1kubectl delete svc nginx","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Service ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Service ä»‹ç»","date_published":"2025-07-18T14:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/17/acme/","url":"https://blog.hanqunfeng.com/2025/07/17/acme/","title":"acme.sh è‡ªåŠ¨ç”³è¯·å¹¶ç»­ç­¾ SSL è¯ä¹¦çš„å·¥å…·","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»è‡ªåŠ¨ç”³è¯·å¹¶ç»­ç­¾ SSL è¯ä¹¦çš„å·¥å…·: <a href=\"http://acme.sh\">acme.sh</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/acmesh-official/acme.sh\">acme.sh Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"acme-sh-ä»‹ç»\"><a href=\"http://acme.sh\">acme.sh</a> ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"http://acme.sh\">acme.sh</a> å®ç°äº† acme åè®®ï¼Œå¯ä»¥ä» ZeroSSLï¼ŒLetâ€™s Encrypt ç­‰ CA ç”Ÿæˆå…è´¹çš„è¯ä¹¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šshellè„šæœ¬æ–¹å¼ï¼Œå‡ ä¹æ— ä¾èµ–ï¼Œæç®€ï¼Œé€‚åˆä¸æƒ³å®‰è£…Pythonç¯å¢ƒçš„äººã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç‰¹ç‚¹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">çº¯ Shell è„šæœ¬ï¼Œå•æ–‡ä»¶è¿è¡Œ</li>\n<li class=\"lvl-4\">æ”¯æŒ 100+ DNS API è‡ªåŠ¨ç»­ç­¾ï¼ˆå¦‚ Cloudflareã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰</li>\n<li class=\"lvl-4\">æ”¯æŒé€šé…ç¬¦è¯ä¹¦</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"acme-sh-å®‰è£…\"><a href=\"http://acme.sh\">acme.sh</a> å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éœ€è¦å…ˆå®‰è£… crontab</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£… crontab</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install cronie -y</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ crond</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl <span class=\"built_in\">enable</span> --now crond</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ crond çŠ¶æ€</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl status crond</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ crontab æ˜¯å¦æ­£å¸¸</span></span><br><span class=\"line\">crontab -l</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£… <a href=\"http://acme.sh\">acme.sh</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨å®‰è£…åˆ° ~/.acme.sh/ ç›®å½•ä¸‹ï¼Œè¯ä¹¦ä¹Ÿä¼šç”Ÿæˆåœ¨è¯¥ç›®å½•ä¸‹</span></span><br><span class=\"line\">curl https://get.acme.sh | sh -s email=qunfeng_han@aliyun.com</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;alias acme.sh=~/.acme.sh/acme.sh&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ crontab ä¸­æ·»åŠ äº†å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©æ£€æŸ¥ä¸€æ¬¡è¯ä¹¦æ˜¯å¦åˆ°è¾¾ä¸‹æ¬¡æ›´æ–°æ—¥æœŸï¼Œå¦‚æœåˆ°æœŸåˆ™è‡ªåŠ¨æ›´æ–°</span></span><br><span class=\"line\"><span class=\"comment\"># è¯ä¹¦æœ‰æ•ˆæœŸé»˜è®¤ä¸º 90 å¤©ï¼Œè¿˜å‰© 30 å¤©æ—¶ä¼šè§¦å‘è‡ªåŠ¨æ›´æ–°</span></span><br><span class=\"line\">crontab -l</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç±»ä¼¼äº ä»¥ä¸‹å†…å®¹</span></span><br><span class=\"line\">48 1 * * * <span class=\"string\">&quot;/root/.acme.sh&quot;</span>/acme.sh --cron --home <span class=\"string\">&quot;/root/.acme.sh&quot;</span> &gt; /dev/null</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å¸®åŠ©</span></span><br><span class=\"line\">acme.sh -h</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class=\"line\">acme.sh -v</span><br></pre></td></tr></table></figure>\n<h2 id=\"å‡çº§-acme-sh\">å‡çº§ <a href=\"http://acme.sh\">acme.sh</a></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‡çº§ acme.sh åˆ°æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">acme.sh --upgrade</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¼€å¯è‡ªåŠ¨å‡çº§</span></span><br><span class=\"line\">acme.sh --upgrade --auto-upgrade</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯ä»¥éšæ—¶å…³é—­è‡ªåŠ¨æ›´æ–°</span></span><br><span class=\"line\">acme.sh --upgrade --auto-upgrade  0</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸è½½-acme-sh\">å¸è½½ <a href=\"http://acme.sh\">acme.sh</a></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --uninstall</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf ~/.acme.sh</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç”Ÿæˆè¯ä¹¦\">ç”Ÿæˆè¯ä¹¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"http://acme.sh\">acme.sh</a> å®ç°äº† acme åè®®æ”¯æŒçš„æ‰€æœ‰éªŒè¯åè®®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¯ä¹¦åˆ›å»ºåä¼šä¿å­˜åœ¨ ~/.acme.sh/ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æˆ‘çš„åŸŸåæ˜¯ <code>acme.hanqunfeng.com</code>ï¼Œåˆ™è¯ä¹¦ä¿å­˜åœ¨ <code>~/.acme.sh/acme.hanqunfeng.com_ecc/</code>ç›®å½•ä¸‹</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºè¯ä¹¦æ—¶ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼éªŒè¯: HTTP å’Œ DNS éªŒè¯ã€‚</p>\n</li>\n</ul>\n<h3 id=\"HTTP-éªŒè¯\">HTTP éªŒè¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åªæ”¯æŒå•ä¸ªå­åŸŸåçš„è¯ä¹¦ç”Ÿæˆï¼Œä¸æ”¯æŒé€šé…ç¬¦åŸŸå</p>\n</li>\n<li class=\"lvl-2\">\n<p>éœ€è¦æå‰å°†åŸŸåè§£æåˆ°æœ¬æœºçš„IPåœ°å€</p>\n</li>\n</ul>\n<h4 id=\"ç›´æ¥ç­¾å‘\">ç›´æ¥ç­¾å‘</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åªéœ€è¦æŒ‡å®šåŸŸåï¼Œå¹¶æŒ‡å®šåŸŸåæ‰€åœ¨çš„ç½‘ç«™æ ¹ç›®å½•. <a href=\"http://acme.sh\">acme.sh</a> ä¼šå…¨è‡ªåŠ¨çš„ç”ŸæˆéªŒè¯æ–‡ä»¶ï¼Œå¹¶æ”¾åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ï¼ŒéªŒè¯å®Œæˆåä¼šèªæ˜çš„åˆ é™¤éªŒè¯æ–‡ä»¶ï¼Œæ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -d æŒ‡å®šåŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œ--webroot æŒ‡å®šç½‘ç«™æ ¹ç›®å½•</span></span><br><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d www.hanqunfeng.com --webroot /home/wwwroot/mydomain.com/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># --server æŒ‡å®š acme.sh ä½¿ç”¨çš„ CA æœåŠ¡å•†ä¸º Let&#x27;s Encryptï¼Œé»˜è®¤ä½¿ç”¨ ZeroSSL</span></span><br><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d www.hanqunfeng.com --webroot /home/wwwroot/mydomain.com/ --server letsencrypt</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä½¿ç”¨-Nginx-Apache-æ¨¡å¼\">ä½¿ç”¨ Nginx/Apache æ¨¡å¼</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ ç”¨çš„ Nginx/Apache æœåŠ¡å™¨ï¼Œæˆ–è€…åä»£ï¼Œ<a href=\"http://acme.sh\">acme.sh</a> è¿˜å¯ä»¥æ™ºèƒ½çš„ä» Nginx/Apache çš„é…ç½®ä¸­è‡ªåŠ¨å®ŒæˆéªŒè¯ï¼Œä½ ä¸éœ€è¦æŒ‡å®šç½‘ç«™æ ¹ç›®å½•</p>\n</li>\n<li class=\"lvl-2\">\n<p>nginx æˆ– httpd å‘½ä»¤è¦åœ¨ç³»ç»ŸPathä¸­</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -d åŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ª, --nginx å‘Šè¯‰ acme.sh ä½¿ç”¨ Nginx æ¨¡å¼</span></span><br><span class=\"line\">acme.sh --issue --nginx -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br><span class=\"line\"><span class=\"comment\"># -d åŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ª, --apache å‘Šè¯‰ acme.sh ä½¿ç”¨ Apache æ¨¡å¼</span></span><br><span class=\"line\">acme.sh --issue --apache -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä½¿ç”¨ç‹¬ç«‹æœåŠ¡æ¨¡å¼\">ä½¿ç”¨ç‹¬ç«‹æœåŠ¡æ¨¡å¼</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰è¿è¡Œä»»ä½• Web æœåŠ¡ï¼Œ80 ç«¯å£æ˜¯ç©ºé—²çš„ï¼Œé‚£ä¹ˆ <a href=\"http://acme.sh\">acme.sh</a> è¿˜èƒ½å‡è£…è‡ªå·±æ˜¯ä¸€ä¸ª WebServerï¼Œä¸´æ—¶ç›‘å¬ 80 ç«¯å£ï¼Œå®ŒæˆéªŒè¯</p>\n</li>\n<li class=\"lvl-2\">\n<p>éœ€è¦å…ˆå®‰è£… socat å‘½ä»¤ï¼Œsocat å¸¸ç”¨äºä¸´æ—¶å¼€å¯ TCP/UDP ç›‘å¬ç«¯å£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> dnf install socat -y</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”Ÿæˆè¯ä¹¦ï¼Œè¦æ±‚80ç«¯å£ç©ºé—²ï¼Œå¦åˆ™ä¼šå¤±è´¥</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># --standalone ç‹¬ç«‹æœåŠ¡æ¨¡å¼</span></span><br><span class=\"line\">acme.sh --issue --standalone -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br></pre></td></tr></table></figure>\n<h3 id=\"DNS-éªŒè¯\">DNS éªŒè¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ æ²¡æœ‰æœåŠ¡å™¨ï¼Œæ²¡æœ‰å…¬ç½‘ IPï¼Œåªéœ€è¦ DNS çš„è§£æè®°å½•å³å¯å®ŒæˆéªŒè¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ”¯æŒé€šé…ç¬¦åŸŸå</p>\n</li>\n</ul>\n<h4 id=\"æ‰‹åŠ¨éªŒè¯\">æ‰‹åŠ¨éªŒè¯</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™éœ€è¦ä½ æ‰‹åŠ¨åœ¨åŸŸåä¸Šæ·»åŠ ä¸€æ¡ TXT è§£æè®°å½•ï¼ŒéªŒè¯åŸŸåæ‰€æœ‰æƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨æ‰‹åŠ¨éªŒè¯ï¼Œ<a href=\"http://acme.sh\">acme.sh</a> å°†æ— æ³•è‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨æ·»åŠ è§£ææ¥éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚å¦‚æœæœ‰è‡ªåŠ¨æ›´æ–°è¯ä¹¦çš„éœ€æ±‚ï¼Œè¯·ä½¿ç”¨è‡ªåŠ¨éªŒè¯ï¼ˆDNS APIï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># éœ€è¦åŠ ä¸Š --yes-I-know-dns-manual-mode-enough-go-ahead-please é€‰é¡¹</span></span><br><span class=\"line\">acme.sh --issue --dns -d acme.hanqunfeng.com -d www.hanqunfeng.com --yes-I-know-dns-manual-mode-enough-go-ahead-please</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç„¶åï¼Œ<a href=\"http://acme.sh\">acme.sh</a> ä¼šç”Ÿæˆç›¸åº”çš„è§£æè®°å½•æ˜¾ç¤ºå‡ºæ¥ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„åŸŸåç®¡ç†é¢æ¿ä¸­æ·»åŠ è¿™æ¡ TXT è®°å½•å³å¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Add the following txt record:</span><br><span class=\"line\">Domain:_acme-challenge.acme.hanqunfeng.com</span><br><span class=\"line\">Txt value:mUWNg9kuQ9hwOkqYFQ_DFMQ4Eu0CEaxxxxxxxxxxx</span><br><span class=\"line\"></span><br><span class=\"line\">Add the following txt record:</span><br><span class=\"line\">Domain:_acme-challenge.www.hanqunfeng.com</span><br><span class=\"line\">Txt value:vLwDR48eHcmcScOwHrDjaFZo-yw_f9xxxxxxxxxxx</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç­‰å¾…è§£æå®Œæˆä¹‹åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œç°åœ¨ç”¨çš„æ˜¯ --renew å‚æ•°</span></span><br><span class=\"line\">acme.sh --renew -d acme.hanqunfeng.com -d www.hanqunfeng.com</span><br></pre></td></tr></table></figure>\n<h4 id=\"è‡ªåŠ¨éªŒè¯ï¼ˆDNS-APIï¼‰\">è‡ªåŠ¨éªŒè¯ï¼ˆDNS APIï¼‰</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>DNS æ–¹å¼çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„åœ¨äºå¯ä»¥ä½¿ç”¨åŸŸåè§£æå•†æä¾›çš„ API è‡ªåŠ¨æ·»åŠ  TXT è®°å½•ï¼Œä¸”åœ¨å®ŒæˆéªŒè¯ååˆ é™¤å¯¹åº”çš„è®°å½•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"http://acme.sh\">acme.sh</a> ç›®å‰æ”¯æŒ<a href=\"https://github.com/acmesh-official/acme.sh/wiki/dnsapi\">è¶…è¿‡ä¸€ç™¾å®¶çš„ DNS API</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼Œç™»å½•é˜¿é‡Œäº‘å¸å·ï¼Œè·å– AccessKey å’Œ SecretKeyï¼Œå¹¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åªéœ€è¦å‘½ä»¤è¡Œæ‰§è¡Œä¸€æ¬¡ï¼Œè¿è¡Œç”Ÿæˆè¯ä¹¦å‘½ä»¤æ—¶ä¼šä¿å­˜åœ¨ ~/.acme.sh/account.conf ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶è‡ªåŠ¨è·å–ï¼Œæ— éœ€æ‰‹åŠ¨å†è®¾ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> Ali_Key=<span class=\"string\">&quot;&lt;key&gt;&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> Ali_Secret=<span class=\"string\">&quot;&lt;secret&gt;&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”Ÿæˆè¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># --dns dns_ali æŒ‡å®šé˜¿é‡Œäº‘çš„DNS API</span></span><br><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç”Ÿæˆè¯ä¹¦çš„å…¶å®ƒè¯´æ˜\">ç”Ÿæˆè¯ä¹¦çš„å…¶å®ƒè¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"http://acme.sh\">acme.sh</a> è„šæœ¬é»˜è®¤ CA æœåŠ¡å•†æ˜¯ ZeroSSLï¼Œ<a href=\"https://github.com/acmesh-official/acme.sh/wiki/Server\">acme.sh æ”¯æŒçš„CA æœåŠ¡å•†åŠå…¶ä½¿ç”¨æ–¹æ³•</a>ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ --server æŒ‡å®š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œä½¿ç”¨ Let&#x27;s Encrypt çš„ CA æœåŠ¡å•†</span></span><br><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥è®¾ç½®å…¨å±€é»˜è®¤çš„ CA æœåŠ¡å•†ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡éƒ½æŒ‡å®š --server</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --set-default-ca --server letsencrypt</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\"><a href=\"http://acme.sh\">acme.sh</a> å®˜ç½‘è¯´ é»˜è®¤çš„ CA æœåŠ¡å•† ZeroSSL ä¸æ˜¯å¾ˆç¨³å®šï¼Œæœ‰æ—¶å¯èƒ½ä¼šå¯¼è‡´è·å–è¯ä¹¦çš„æ—¶å€™ä¸€ç›´å‡ºç°ï¼š<code>Pendingï¼ŒThe CA is processing your orderï¼Œplease just wait.</code>ï¼Œ æ­¤æ—¶åªéœ€è¦æŠŠ CA æœåŠ¡å™¨æ”¹æˆ Letâ€™s Encrypt å³å¯ï¼Œè™½ç„¶æ›´æ”¹ä»¥åè¿˜æ˜¯æœ‰æ¦‚ç‡å‡ºç° pendingï¼Œä½†åŸºæœ¬ 2-3 æ¬¡å³å¯æˆåŠŸã€‚</li>\n<li class=\"lvl-2\">ä½†æ˜¯ Letâ€™s Encrypt è·å–çš„è¯ä¹¦ï¼Œä¸æ”¯æŒæ¯”è¾ƒæ—§çš„è®¾å¤‡ï¼Œæ¯”å¦‚ Android 5.0 ä»¥ä¸‹çš„è®¾å¤‡ï¼Œå¦‚æœæœ‰è¿™æ–¹é¢çš„éœ€è¦è¿˜æ˜¯æ¨èä½¿ç”¨ ZeroSSLã€‚</li>\n<li class=\"lvl-2\">å¸¸è§æ ¹è¯ä¹¦è¡¨</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ ¹è¯ä¹¦ï¼ˆCNï¼‰</th>\n<th>Android 5.0</th>\n<th>å¸¸è§ç­¾å‘æ–¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ISRG Root X1</strong></td>\n<td>âŒ ä¸å…¼å®¹</td>\n<td>Letâ€™s Encrypt</td>\n</tr>\n<tr>\n<td><strong>DST Root CA X3</strong></td>\n<td>âœ… å…¼å®¹ï¼ˆ2021å¹´è¿‡æœŸï¼‰</td>\n<td>Letâ€™s Encrypt è€ç‰ˆæœ¬</td>\n</tr>\n<tr>\n<td><strong>GlobalSign Root R1</strong></td>\n<td>âœ… å…¼å®¹</td>\n<td>GlobalSign</td>\n</tr>\n<tr>\n<td><strong>USERTrust RSA Certification Authority</strong></td>\n<td>âœ… å…¼å®¹</td>\n<td>ZeroSSL, Sectigo</td>\n</tr>\n<tr>\n<td><strong>Starfield Root CA - G2</strong></td>\n<td>âŒ ä¸å…¼å®¹</td>\n<td>GoDaddy æ–°ç‰ˆ</td>\n</tr>\n<tr>\n<td><strong>Starfield Root CA - G1</strong></td>\n<td>âœ… å…¼å®¹</td>\n<td>GoDaddy è€ç‰ˆ</td>\n</tr>\n<tr>\n<td><strong>GTS Root R1/R3</strong></td>\n<td>âŒ ä¸å…¼å®¹</td>\n<td>Google Trust Services</td>\n</tr>\n<tr>\n<td><strong>Amazon Root CA 1</strong></td>\n<td>âŒ ä¸å…¼å®¹</td>\n<td>Amazon Trust</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥ç”¨åœ¨çº¿å·¥å…·ç›´æ¥æŸ¥çœ‹è¯ä¹¦é“¾ï¼š<a href=\"https://www.ssllabs.com/ssltest/\">https://www.ssllabs.com/ssltest/</a> ï¼Œå®ƒä¼šæ˜¾ç¤ºå®Œæ•´è¯ä¹¦é“¾å’Œå„ç§è®¾å¤‡çš„å…¼å®¹æ€§</p>\n</li>\n</ul>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å·²ç»ç”Ÿæˆçš„è¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ acme.sh --list</span><br><span class=\"line\">Main_Domain          KeyLength  SAN_Domains  CA           Created               Renew</span><br><span class=\"line\">acme.hanqunfeng.com  <span class=\"string\">&quot;ec-256&quot;</span>   no           ZeroSSL.com  2025-07-17T03:31:30Z  2025-09-14T03:31:30Z</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœç”Ÿæˆè¯ä¹¦æ—¶å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  --debug å‚æ•°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --debug</span><br><span class=\"line\"><span class=\"comment\"># --debug 2 è¾“å‡ºæ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯</span></span><br><span class=\"line\">acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --debug 2</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›®å‰è¯ä¹¦æ¯ 60 å¤©è‡ªåŠ¨æ›´æ–°ï¼Œä½ æ— éœ€ä»»ä½•æ“ä½œã€‚ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥å¼ºåˆ¶ç»­ç­¾è¯ä¹¦ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œè¦å°† --issue æ”¹ä¸º --renewï¼Œ--issue åªæœ‰ç¬¬ä¸€æ¬¡ç”Ÿæˆæ­£å¼æ—¶æ‰ä¼šä½¿ç”¨ã€‚åŒæ—¶åŠ ä¸Š --forceï¼Œæœªåˆ°æ›´æ–°æ—¶é—´å¼ºåˆ¶é‡æ–°ç”Ÿæˆè¯ä¹¦ã€‚</span></span><br><span class=\"line\">acme.sh --renew -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --force</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç”Ÿæˆè¯ä¹¦åè‡ªåŠ¨éƒ¨ç½²å’Œæ›´æ–°\">ç”Ÿæˆè¯ä¹¦åè‡ªåŠ¨éƒ¨ç½²å’Œæ›´æ–°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢æ— è®ºæ˜¯ http è¿˜æ˜¯ dns æ¨¡å¼ï¼Œç”Ÿæˆè¯ä¹¦åï¼Œéƒ½ä¼šåœ¨ ~/.acme.sh/acme.hanqunfeng.com_ecc/ ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">â”œâ”€â”€ acme.hanqunfeng.com.cer</span><br><span class=\"line\">â”œâ”€â”€ acme.hanqunfeng.com.conf</span><br><span class=\"line\">â”œâ”€â”€ acme.hanqunfeng.com.csr</span><br><span class=\"line\">â”œâ”€â”€ acme.hanqunfeng.com.csr.conf</span><br><span class=\"line\">â”œâ”€â”€ acme.hanqunfeng.com.key</span><br><span class=\"line\">â”œâ”€â”€ ca.cer</span><br><span class=\"line\">â””â”€â”€ fullchain.cer</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°†è¯ä¹¦æ‹·è´åˆ°çœŸæ­£ä½¿ç”¨è¯ä¹¦çš„ç›®å½•ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨nginxæˆ–è€…apacheï¼Œå¯ä»¥è®© <a href=\"http://acme.sh\">acme.sh</a> å¸®æˆ‘ä»¬è‡ªåŠ¨å°†è¯ä¹¦æ‹·è´åˆ°æ­£ç¡®çš„ç›®å½•ä¸‹ï¼Œå¹¶é‡å¯æœåŠ¡ä½¿è¯ä¹¦ç”Ÿæ•ˆï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè®¾ç½®å³å¯ï¼Œåªéœ€è¦è¿è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œåç»­ä¼šé€šè¿‡ crontab è¿›è¡Œè‡ªåŠ¨æ›´æ–°è¯ä¹¦å¹¶å®Œæˆéƒ¨ç½²ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Nginx</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --install-cert \\</span><br><span class=\"line\">-d acme.hanqunfeng.com \\                               <span class=\"comment\"># ç”Ÿæˆè¯ä¹¦æ—¶æŒ‡å®šçš„åŸŸå</span></span><br><span class=\"line\">--key-file /path/to/keyfile/in/nginx/key.pem \\    <span class=\"comment\"># nginx ä¸­é…ç½®çš„ key æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">--fullchain-file /path/to/fullchain/nginx/cert.pem \\  <span class=\"comment\"># nginx ä¸­é…ç½®çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\">--reloadcmd <span class=\"string\">&quot;systemctl reload nginx&quot;</span>                   <span class=\"comment\"># nginx é‡è½½å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ nginx -s reload</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ–‡ä»¶å¯¹åº”å…³ç³»</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><a href=\"http://acme.sh\">acme.sh</a> æ–‡ä»¶</th>\n<th>å«ä¹‰</th>\n<th>ä½ é…ç½®çš„ç›®æ ‡æ–‡ä»¶</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>acme.hanqunfeng.com.key</code></td>\n<td><strong>ç§é’¥ (Private Key)</strong></td>\n<td><code>/path/to/keyfile/in/nginx/key.pem</code></td>\n</tr>\n<tr>\n<td><code>fullchain.cer</code></td>\n<td><strong>è¯ä¹¦ + ä¸­é—´è¯ä¹¦é“¾ (Fullchain)</strong></td>\n<td><code>/path/to/fullchain/nginx/cert.pem</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Apache</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acme.sh --install-cert \\</span><br><span class=\"line\">-d acme.hanqunfeng.com \\</span><br><span class=\"line\">--cert-file      /path/to/certfile/in/apache/cert.pem  \\ <span class=\"comment\"># apache è¯ä¹¦æ–‡ä»¶</span></span><br><span class=\"line\">--key-file       /path/to/keyfile/in/apache/key.pem  \\   <span class=\"comment\"># apache å¯†é’¥æ–‡ä»¶</span></span><br><span class=\"line\">--fullchain-file /path/to/fullchain/certfile/apache/fullchain.pem \\ <span class=\"comment\"># apache å…¨é“¾æ–‡ä»¶</span></span><br><span class=\"line\">--reloadcmd     <span class=\"string\">&quot;systemctl reload httpd&quot;</span>  <span class=\"comment\"># apache é‡è½½å‘½ä»¤</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ–‡ä»¶å¯¹åº”å…³ç³»</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><a href=\"http://acme.sh\">acme.sh</a> æ–‡ä»¶</th>\n<th>å«ä¹‰</th>\n<th>ä½ é…ç½®çš„ç›®æ ‡æ–‡ä»¶</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>acme.hanqunfeng.com.key</code></td>\n<td><strong>ç§é’¥ (Private Key)</strong></td>\n<td><code>/path/to/keyfile/in/apache/key.pem</code></td>\n</tr>\n<tr>\n<td><code>acme.hanqunfeng.com.cer</code></td>\n<td><strong>ä»…åŸŸåè¯ä¹¦ (Certificate)</strong></td>\n<td><code>/path/to/certfile/in/apache/cert.pem</code></td>\n</tr>\n<tr>\n<td><code>fullchain.cer</code></td>\n<td><strong>è¯ä¹¦ + ä¸­é—´è¯ä¹¦é“¾ (Fullchain)</strong></td>\n<td><code>/path/to/fullchain/certfile/apache/fullchain.pem</code></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"åœæ­¢è‡ªåŠ¨æ›´æ–°å¹¶åˆ é™¤è¯ä¹¦\">åœæ­¢è‡ªåŠ¨æ›´æ–°å¹¶åˆ é™¤è¯ä¹¦</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœæ­¢è‡ªåŠ¨æ›´æ–°</span></span><br><span class=\"line\">acme.sh --remove -d acme.hanqunfeng.com --ecc</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤è¯ä¹¦</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf ~/.acme.sh/acme.hanqunfeng.com_ecc</span><br></pre></td></tr></table></figure>\n<h2 id=\"å…¶å®ƒsslè‡ªåŠ¨ç»­ç­¾å·¥å…·\">å…¶å®ƒsslè‡ªåŠ¨ç»­ç­¾å·¥å…·</h2>\n<table>\n<thead>\n<tr>\n<th>å·¥å…·</th>\n<th>æ¨èåœºæ™¯</th>\n<th>å®˜ç½‘åœ°å€</th>\n<th>ä¾èµ–</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Certbot</td>\n<td>ä¼ ç»ŸæœåŠ¡å™¨ã€Nginx/Apache</td>\n<td><a href=\"https://certbot.eff.org/\">https://certbot.eff.org/</a></td>\n<td>Python</td>\n</tr>\n<tr>\n<td>Lego</td>\n<td>é™æ€äºŒè¿›åˆ¶ã€K8s</td>\n<td><a href=\"https://github.com/go-acme/lego\">https://github.com/go-acme/lego</a></td>\n<td>æ— ä¾èµ–</td>\n</tr>\n<tr>\n<td>cert-manager</td>\n<td>K8s é›†ç¾¤</td>\n<td><a href=\"https://cert-manager.io/\">https://cert-manager.io/</a></td>\n<td>K8s CRD</td>\n</tr>\n<tr>\n<td>Caddy</td>\n<td>ç®€å•ç«™ç‚¹è‡ªåŠ¨HTTPS</td>\n<td><a href=\"https://caddyserver.com/\">https://caddyserver.com/</a></td>\n<td>æ— éœ€å•ç‹¬å·¥å…·</td>\n</tr>\n<tr>\n<td>Traefik</td>\n<td>å¾®æœåŠ¡ç½‘å…³</td>\n<td><a href=\"https://traefik.io/\">https://traefik.io/</a></td>\n<td>Docker/K8s</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»è‡ªåŠ¨ç”³è¯·å¹¶ç»­ç­¾ SSL è¯ä¹¦çš„å·¥å…·: acme.sh acme.sh Github acme.sh ä»‹ç» acme.sh å®ç°äº† acme åè®®ï¼Œå¯ä»¥ä» ZeroSSLï¼ŒLetâ€™s Encrypt ç­‰ CA ç”Ÿæˆå…è´¹çš„è¯ä¹¦ã€‚ é€‚ç”¨åœºæ™¯ï¼šshellè„šæœ¬æ–¹å¼ï¼Œå‡ ä¹æ— ä¾èµ–ï¼Œæç®€ï¼Œé€‚åˆä¸æƒ³å®‰è£…Pythonç¯å¢ƒçš„äººã€‚ ç‰¹ç‚¹ï¼š çº¯ Shell è„šæœ¬ï¼Œå•æ–‡ä»¶è¿è¡Œ æ”¯æŒ 100+ DNS API è‡ªåŠ¨ç»­ç­¾ï¼ˆå¦‚ Cloudflareã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰ æ”¯æŒé€šé…ç¬¦è¯ä¹¦ acme.sh å®‰è£… éœ€è¦å…ˆå®‰è£… crontab 12345678# å®‰è£… crontabsudo dnf install cronie -y# å¯åŠ¨ crondsudo systemctl enable --now crond# æŸ¥çœ‹ crond çŠ¶æ€sudo systemctl status crond# æŸ¥çœ‹ crontab æ˜¯å¦æ­£å¸¸crontab -l å®‰è£… acme.sh 123456789101112131415# å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨å®‰è£…åˆ° ~/.acme.sh/ ç›®å½•ä¸‹ï¼Œè¯ä¹¦ä¹Ÿä¼šç”Ÿæˆåœ¨è¯¥ç›®å½•ä¸‹curl https://get.acme.sh | sh -s email=qunfeng_han@aliyun.comecho &#x27;alias acme.sh=~/.acme.sh/acme.sh&#x27; &gt;&gt; ~/.bashrcsource ~/.bashrc# å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ crontab ä¸­æ·»åŠ äº†å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©æ£€æŸ¥ä¸€æ¬¡è¯ä¹¦æ˜¯å¦åˆ°è¾¾ä¸‹æ¬¡æ›´æ–°æ—¥æœŸï¼Œå¦‚æœåˆ°æœŸåˆ™è‡ªåŠ¨æ›´æ–°# è¯ä¹¦æœ‰æ•ˆæœŸé»˜è®¤ä¸º 90 å¤©ï¼Œè¿˜å‰© 30 å¤©æ—¶ä¼šè§¦å‘è‡ªåŠ¨æ›´æ–°crontab -l# è¾“å‡ºç±»ä¼¼äº ä»¥ä¸‹å†…å®¹48 1 * * * &quot;/root/.acme.sh&quot;/acme.sh --cron --home &quot;/root/.acme.sh&quot; &gt; /dev/null# æŸ¥çœ‹å¸®åŠ©acme.sh -h# æŸ¥çœ‹ç‰ˆæœ¬acme.sh -v å‡çº§ acme.sh 12345678# å‡çº§ acme.sh åˆ°æœ€æ–°ç‰ˆacme.sh --upgrade# å¼€å¯è‡ªåŠ¨å‡çº§acme.sh --upgrade --auto-upgrade# å¯ä»¥éšæ—¶å…³é—­è‡ªåŠ¨æ›´æ–°acme.sh --upgrade --auto-upgrade 0 å¸è½½ acme.sh 12acme.sh --uninstallrm -rf ~/.acme.sh ç”Ÿæˆè¯ä¹¦ acme.sh å®ç°äº† acme åè®®æ”¯æŒçš„æ‰€æœ‰éªŒè¯åè®®ã€‚ è¯ä¹¦åˆ›å»ºåä¼šä¿å­˜åœ¨ ~/.acme.sh/ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æˆ‘çš„åŸŸåæ˜¯ acme.hanqunfeng.comï¼Œåˆ™è¯ä¹¦ä¿å­˜åœ¨ ~/.acme.sh/acme.hanqunfeng.com_ecc/ç›®å½•ä¸‹ åˆ›å»ºè¯ä¹¦æ—¶ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼éªŒè¯: HTTP å’Œ DNS éªŒè¯ã€‚ HTTP éªŒè¯ åªæ”¯æŒå•ä¸ªå­åŸŸåçš„è¯ä¹¦ç”Ÿæˆï¼Œä¸æ”¯æŒé€šé…ç¬¦åŸŸå éœ€è¦æå‰å°†åŸŸåè§£æåˆ°æœ¬æœºçš„IPåœ°å€ ç›´æ¥ç­¾å‘ åªéœ€è¦æŒ‡å®šåŸŸåï¼Œå¹¶æŒ‡å®šåŸŸåæ‰€åœ¨çš„ç½‘ç«™æ ¹ç›®å½•. acme.sh ä¼šå…¨è‡ªåŠ¨çš„ç”ŸæˆéªŒè¯æ–‡ä»¶ï¼Œå¹¶æ”¾åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ï¼ŒéªŒè¯å®Œæˆåä¼šèªæ˜çš„åˆ é™¤éªŒè¯æ–‡ä»¶ï¼Œæ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚ 12345# -d æŒ‡å®šåŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªï¼Œ--webroot æŒ‡å®šç½‘ç«™æ ¹ç›®å½•acme.sh --issue -d acme.hanqunfeng.com -d www.hanqunfeng.com --webroot /home/wwwroot/mydomain.com/# --server æŒ‡å®š acme.sh ä½¿ç”¨çš„ CA æœåŠ¡å•†ä¸º Let&#x27;s Encryptï¼Œé»˜è®¤ä½¿ç”¨ ZeroSSLacme.sh --issue -d acme.hanqunfeng.com -d www.hanqunfeng.com --webroot /home/wwwroot/mydomain.com/ --server letsencrypt ä½¿ç”¨ Nginx/Apache æ¨¡å¼ å¦‚æœä½ ç”¨çš„ Nginx/Apache æœåŠ¡å™¨ï¼Œæˆ–è€…åä»£ï¼Œacme.sh è¿˜å¯ä»¥æ™ºèƒ½çš„ä» Nginx/Apache çš„é…ç½®ä¸­è‡ªåŠ¨å®ŒæˆéªŒè¯ï¼Œä½ ä¸éœ€è¦æŒ‡å®šç½‘ç«™æ ¹ç›®å½• nginx æˆ– httpd å‘½ä»¤è¦åœ¨ç³»ç»ŸPathä¸­ 1234# -d åŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ª, --nginx å‘Šè¯‰ acme.sh ä½¿ç”¨ Nginx æ¨¡å¼acme.sh --issue --nginx -d acme.hanqunfeng.com -d www.hanqunfeng.com# -d åŸŸåï¼Œå¯ä»¥æ·»åŠ å¤šä¸ª, --apache å‘Šè¯‰ acme.sh ä½¿ç”¨ Apache æ¨¡å¼acme.sh --issue --apache -d acme.hanqunfeng.com -d www.hanqunfeng.com ä½¿ç”¨ç‹¬ç«‹æœåŠ¡æ¨¡å¼ å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰è¿è¡Œä»»ä½• Web æœåŠ¡ï¼Œ80 ç«¯å£æ˜¯ç©ºé—²çš„ï¼Œé‚£ä¹ˆ acme.sh è¿˜èƒ½å‡è£…è‡ªå·±æ˜¯ä¸€ä¸ª WebServerï¼Œä¸´æ—¶ç›‘å¬ 80 ç«¯å£ï¼Œå®ŒæˆéªŒè¯ éœ€è¦å…ˆå®‰è£… socat å‘½ä»¤ï¼Œsocat å¸¸ç”¨äºä¸´æ—¶å¼€å¯ TCP/UDP ç›‘å¬ç«¯å£ 1sudo dnf install socat -y ç”Ÿæˆè¯ä¹¦ï¼Œè¦æ±‚80ç«¯å£ç©ºé—²ï¼Œå¦åˆ™ä¼šå¤±è´¥ 12# --standalone ç‹¬ç«‹æœåŠ¡æ¨¡å¼acme.sh --issue --standalone -d acme.hanqunfeng.com -d www.hanqunfeng.com DNS éªŒè¯ å¦‚æœä½ æ²¡æœ‰æœåŠ¡å™¨ï¼Œæ²¡æœ‰å…¬ç½‘ IPï¼Œåªéœ€è¦ DNS çš„è§£æè®°å½•å³å¯å®ŒæˆéªŒè¯ã€‚ æ”¯æŒé€šé…ç¬¦åŸŸå æ‰‹åŠ¨éªŒè¯ è¿™éœ€è¦ä½ æ‰‹åŠ¨åœ¨åŸŸåä¸Šæ·»åŠ ä¸€æ¡ TXT è§£æè®°å½•ï¼ŒéªŒè¯åŸŸåæ‰€æœ‰æƒã€‚ æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨æ‰‹åŠ¨éªŒè¯ï¼Œacme.sh å°†æ— æ³•è‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨æ·»åŠ è§£ææ¥éªŒè¯åŸŸåæ‰€æœ‰æƒã€‚å¦‚æœæœ‰è‡ªåŠ¨æ›´æ–°è¯ä¹¦çš„éœ€æ±‚ï¼Œè¯·ä½¿ç”¨è‡ªåŠ¨éªŒè¯ï¼ˆDNS APIï¼‰ã€‚ 12# éœ€è¦åŠ ä¸Š --yes-I-know-dns-manual-mode-enough-go-ahead-please é€‰é¡¹acme.sh --issue --dns -d acme.hanqunfeng.com -d www.hanqunfeng.com --yes-I-know-dns-manual-mode-enough-go-ahead-please ç„¶åï¼Œacme.sh ä¼šç”Ÿæˆç›¸åº”çš„è§£æè®°å½•æ˜¾ç¤ºå‡ºæ¥ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„åŸŸåç®¡ç†é¢æ¿ä¸­æ·»åŠ è¿™æ¡ TXT è®°å½•å³å¯ã€‚ 1234567Add the following txt record:Domain:_acme-challenge.acme.hanqunfeng.comTxt value:mUWNg9kuQ9hwOkqYFQ_DFMQ4Eu0CEaxxxxxxxxxxxAdd the following txt record:Domain:_acme-challenge.www.hanqunfeng.comTxt value:vLwDR48eHcmcScOwHrDjaFZo-yw_f9xxxxxxxxxxx ç­‰å¾…è§£æå®Œæˆä¹‹åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼š 12# æ³¨æ„è¿™é‡Œç°åœ¨ç”¨çš„æ˜¯ --renew å‚æ•°acme.sh --renew -d acme.hanqunfeng.com -d www.hanqunfeng.com è‡ªåŠ¨éªŒè¯ï¼ˆDNS APIï¼‰ DNS æ–¹å¼çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„åœ¨äºå¯ä»¥ä½¿ç”¨åŸŸåè§£æå•†æä¾›çš„ API è‡ªåŠ¨æ·»åŠ  TXT è®°å½•ï¼Œä¸”åœ¨å®ŒæˆéªŒè¯ååˆ é™¤å¯¹åº”çš„è®°å½•ã€‚ acme.sh ç›®å‰æ”¯æŒè¶…è¿‡ä¸€ç™¾å®¶çš„ DNS APIã€‚ ä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼Œç™»å½•é˜¿é‡Œäº‘å¸å·ï¼Œè·å– AccessKey å’Œ SecretKeyï¼Œå¹¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š 123# åªéœ€è¦å‘½ä»¤è¡Œæ‰§è¡Œä¸€æ¬¡ï¼Œè¿è¡Œç”Ÿæˆè¯ä¹¦å‘½ä»¤æ—¶ä¼šä¿å­˜åœ¨ ~/.acme.sh/account.conf ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶è‡ªåŠ¨è·å–ï¼Œæ— éœ€æ‰‹åŠ¨å†è®¾ç½®export Ali_Key=&quot;&lt;key&gt;&quot;export Ali_Secret=&quot;&lt;secret&gt;&quot; ç”Ÿæˆè¯ä¹¦ 12# --dns dns_ali æŒ‡å®šé˜¿é‡Œäº‘çš„DNS APIacme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali ç”Ÿæˆè¯ä¹¦çš„å…¶å®ƒè¯´æ˜ acme.sh è„šæœ¬é»˜è®¤ CA æœåŠ¡å•†æ˜¯ ZeroSSLï¼Œacme.sh æ”¯æŒçš„CA æœåŠ¡å•†åŠå…¶ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ --server æŒ‡å®š 12# è¿™é‡Œä½¿ç”¨ Let&#x27;s Encrypt çš„ CA æœåŠ¡å•†acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt ä¹Ÿå¯ä»¥è®¾ç½®å…¨å±€é»˜è®¤çš„ CA æœåŠ¡å•†ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡éƒ½æŒ‡å®š --server 1acme.sh --set-default-ca --server letsencrypt å°è´´å£« acme.sh å®˜ç½‘è¯´ é»˜è®¤çš„ CA æœåŠ¡å•† ZeroSSL ä¸æ˜¯å¾ˆç¨³å®šï¼Œæœ‰æ—¶å¯èƒ½ä¼šå¯¼è‡´è·å–è¯ä¹¦çš„æ—¶å€™ä¸€ç›´å‡ºç°ï¼šPendingï¼ŒThe CA is processing your orderï¼Œplease just wait.ï¼Œ æ­¤æ—¶åªéœ€è¦æŠŠ CA æœåŠ¡å™¨æ”¹æˆ Letâ€™s Encrypt å³å¯ï¼Œè™½ç„¶æ›´æ”¹ä»¥åè¿˜æ˜¯æœ‰æ¦‚ç‡å‡ºç° pendingï¼Œä½†åŸºæœ¬ 2-3 æ¬¡å³å¯æˆåŠŸã€‚ ä½†æ˜¯ Letâ€™s Encrypt è·å–çš„è¯ä¹¦ï¼Œä¸æ”¯æŒæ¯”è¾ƒæ—§çš„è®¾å¤‡ï¼Œæ¯”å¦‚ Android 5.0 ä»¥ä¸‹çš„è®¾å¤‡ï¼Œå¦‚æœæœ‰è¿™æ–¹é¢çš„éœ€è¦è¿˜æ˜¯æ¨èä½¿ç”¨ ZeroSSLã€‚ å¸¸è§æ ¹è¯ä¹¦è¡¨ æ ¹è¯ä¹¦ï¼ˆCNï¼‰ Android 5.0 å¸¸è§ç­¾å‘æ–¹ ISRG Root X1 âŒ ä¸å…¼å®¹ Letâ€™s Encrypt DST Root CA X3 âœ… å…¼å®¹ï¼ˆ2021å¹´è¿‡æœŸï¼‰ Letâ€™s Encrypt è€ç‰ˆæœ¬ GlobalSign Root R1 âœ… å…¼å®¹ GlobalSign USERTrust RSA Certification Authority âœ… å…¼å®¹ ZeroSSL, Sectigo Starfield Root CA - G2 âŒ ä¸å…¼å®¹ GoDaddy æ–°ç‰ˆ Starfield Root CA - G1 âœ… å…¼å®¹ GoDaddy è€ç‰ˆ GTS Root R1/R3 âŒ ä¸å…¼å®¹ Google Trust Services Amazon Root CA 1 âŒ ä¸å…¼å®¹ Amazon Trust å¯ä»¥ç”¨åœ¨çº¿å·¥å…·ç›´æ¥æŸ¥çœ‹è¯ä¹¦é“¾ï¼šhttps://www.ssllabs.com/ssltest/ ï¼Œå®ƒä¼šæ˜¾ç¤ºå®Œæ•´è¯ä¹¦é“¾å’Œå„ç§è®¾å¤‡çš„å…¼å®¹æ€§ æŸ¥çœ‹å·²ç»ç”Ÿæˆçš„è¯ä¹¦ 123$ acme.sh --listMain_Domain KeyLength SAN_Domains CA Created Renewacme.hanqunfeng.com &quot;ec-256&quot; no ZeroSSL.com 2025-07-17T03:31:30Z 2025-09-14T03:31:30Z å¦‚æœç”Ÿæˆè¯ä¹¦æ—¶å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  --debug å‚æ•°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ 123acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --debug# --debug 2 è¾“å‡ºæ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯acme.sh --issue -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --debug 2 ç›®å‰è¯ä¹¦æ¯ 60 å¤©è‡ªåŠ¨æ›´æ–°ï¼Œä½ æ— éœ€ä»»ä½•æ“ä½œã€‚ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥å¼ºåˆ¶ç»­ç­¾è¯ä¹¦ï¼š 12# æ³¨æ„è¿™é‡Œè¦å°† --issue æ”¹ä¸º --renewï¼Œ--issue åªæœ‰ç¬¬ä¸€æ¬¡ç”Ÿæˆæ­£å¼æ—¶æ‰ä¼šä½¿ç”¨ã€‚åŒæ—¶åŠ ä¸Š --forceï¼Œæœªåˆ°æ›´æ–°æ—¶é—´å¼ºåˆ¶é‡æ–°ç”Ÿæˆè¯ä¹¦ã€‚acme.sh --renew -d acme.hanqunfeng.com -d *.hanqunfeng.com --dns dns_ali --server letsencrypt --force ç”Ÿæˆè¯ä¹¦åè‡ªåŠ¨éƒ¨ç½²å’Œæ›´æ–° ä¸Šé¢æ— è®ºæ˜¯ http è¿˜æ˜¯ dns æ¨¡å¼ï¼Œç”Ÿæˆè¯ä¹¦åï¼Œéƒ½ä¼šåœ¨ ~/.acme.sh/acme.hanqunfeng.com_ecc/ ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š 1234567â”œâ”€â”€ acme.hanqunfeng.com.cerâ”œâ”€â”€ acme.hanqunfeng.com.confâ”œâ”€â”€ acme.hanqunfeng.com.csrâ”œâ”€â”€ acme.hanqunfeng.com.csr.confâ”œâ”€â”€ acme.hanqunfeng.com.keyâ”œâ”€â”€ ca.cerâ””â”€â”€ fullchain.cer æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°†è¯ä¹¦æ‹·è´åˆ°çœŸæ­£ä½¿ç”¨è¯ä¹¦çš„ç›®å½•ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨nginxæˆ–è€…apacheï¼Œå¯ä»¥è®© acme.sh å¸®æˆ‘ä»¬è‡ªåŠ¨å°†è¯ä¹¦æ‹·è´åˆ°æ­£ç¡®çš„ç›®å½•ä¸‹ï¼Œå¹¶é‡å¯æœåŠ¡ä½¿è¯ä¹¦ç”Ÿæ•ˆï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè®¾ç½®å³å¯ï¼Œåªéœ€è¦è¿è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œåç»­ä¼šé€šè¿‡ crontab è¿›è¡Œè‡ªåŠ¨æ›´æ–°è¯ä¹¦å¹¶å®Œæˆéƒ¨ç½²ã€‚ Nginx 12345acme.sh --install-cert \\-d acme.hanqunfeng.com \\ # ç”Ÿæˆè¯ä¹¦æ—¶æŒ‡å®šçš„åŸŸå--key-file /path/to/keyfile/in/nginx/key.pem \\ # nginx ä¸­é…ç½®çš„ key æ–‡ä»¶è·¯å¾„--fullchain-file /path/to/fullchain/nginx/cert.pem \\ # nginx ä¸­é…ç½®çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„--reloadcmd &quot;systemctl reload nginx&quot; # nginx é‡è½½å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ nginx -s reload æ–‡ä»¶å¯¹åº”å…³ç³» acme.sh æ–‡ä»¶ å«ä¹‰ ä½ é…ç½®çš„ç›®æ ‡æ–‡ä»¶ acme.hanqunfeng.com.key ç§é’¥ (Private Key) /path/to/keyfile/in/nginx/key.pem fullchain.cer è¯ä¹¦ + ä¸­é—´è¯ä¹¦é“¾ (Fullchain) /path/to/fullchain/nginx/cert.pem Apache 123456acme.sh --install-cert \\-d acme.hanqunfeng.com \\--cert-file /path/to/certfile/in/apache/cert.pem \\ # apache è¯ä¹¦æ–‡ä»¶--key-file /path/to/keyfile/in/apache/key.pem \\ # apache å¯†é’¥æ–‡ä»¶--fullchain-file /path/to/fullchain/certfile/apache/fullchain.pem \\ # apache å…¨é“¾æ–‡ä»¶--reloadcmd &quot;systemctl reload httpd&quot; # apache é‡è½½å‘½ä»¤ æ–‡ä»¶å¯¹åº”å…³ç³» acme.sh æ–‡ä»¶ å«ä¹‰ ä½ é…ç½®çš„ç›®æ ‡æ–‡ä»¶ acme.hanqunfeng.com.key ç§é’¥ (Private Key) /path/to/keyfile/in/apache/key.pem acme.hanqunfeng.com.cer ä»…åŸŸåè¯ä¹¦ (Certificate) /path/to/certfile/in/apache/cert.pem fullchain.cer è¯ä¹¦ + ä¸­é—´è¯ä¹¦é“¾ (Fullchain) /path/to/fullchain/certfile/apache/fullchain.pem åœæ­¢è‡ªåŠ¨æ›´æ–°å¹¶åˆ é™¤è¯ä¹¦ 1234# åœæ­¢è‡ªåŠ¨æ›´æ–°acme.sh --remove -d acme.hanqunfeng.com --ecc# åˆ é™¤è¯ä¹¦rm -rf ~/.acme.sh/acme.hanqunfeng.com_ecc å…¶å®ƒsslè‡ªåŠ¨ç»­ç­¾å·¥å…· å·¥å…· æ¨èåœºæ™¯ å®˜ç½‘åœ°å€ ä¾èµ– Certbot ä¼ ç»ŸæœåŠ¡å™¨ã€Nginx/Apache https://certbot.eff.org/ Python Lego é™æ€äºŒè¿›åˆ¶ã€K8s https://github.com/go-acme/lego æ— ä¾èµ– cert-manager K8s é›†ç¾¤ https://cert-manager.io/ K8s CRD Caddy ç®€å•ç«™ç‚¹è‡ªåŠ¨HTTPS https://caddyserver.com/ æ— éœ€å•ç‹¬å·¥å…· Traefik å¾®æœåŠ¡ç½‘å…³ https://traefik.io/ Docker/K8s","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç»è‡ªåŠ¨ç”³è¯·å¹¶ç»­ç­¾ SSL è¯ä¹¦çš„å·¥å…·: acme.sh acme.sh Github","date_published":"2025-07-17T14:30:05.000Z","tags":["æŠ€æœ¯","acme","ssl","certificate","ssl","acme"]},{"id":"https://blog.hanqunfeng.com/2025/07/16/k8s-toomanyrequests/","url":"https://blog.hanqunfeng.com/2025/07/16/k8s-toomanyrequests/","title":"K8S é•œåƒæ‹‰å– ä¹‹ toomanyrequests çš„è§£å†³æ–¹æ³•","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S é•œåƒæ‹‰å– çš„ <code>toomanyrequests</code> çš„è§£å†³æ–¹æ³• ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"toomanyrequests-ä»‹ç»\">toomanyrequests ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æˆ‘ä»¬é€šè¿‡k8såˆ›å»ºpodæ—¶éœ€è¦ä» dockerhub ä¸Šæ‹‰å–é•œåƒï¼Œä½†æ˜¯ dockerhub çš„apiè¯·æ±‚æ˜¯æœ‰é™åˆ¶çš„ï¼Œæœªè®¤è¯ç”¨æˆ·é™åˆ¶ä¸º100/6hï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶å°±ä¼šè¿”å›<code>429 Too Many Requestså“åº”</code>ã€‚<a href=\"https://docs.docker.com/docker-hub/usage/\">Docker Hubçš„ä½¿ç”¨å’Œé™åˆ¶</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å¯ä»¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œè¿™æ ·å¯ä»¥å°†é™åˆ¶æé«˜åˆ°2000/6hã€‚å¦‚æœè¿˜éœ€è¦è¿›ä¸€æ­¥æé«˜è¯·æ±‚é™åˆ¶ï¼Œå¯ä»¥ç”³è¯·dockerhubçš„pro planã€‚</p>\n</li>\n</ul>\n<h2 id=\"dockerhub-è®¤è¯\">dockerhub è®¤è¯</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º Docker Registry Secret</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŒ‡å®š namespaceï¼Œ é»˜è®¤å‘½åç©ºé—´æ˜¯ default</span></span><br><span class=\"line\">kubectl create secret docker-registry \\</span><br><span class=\"line\">  dockerhub-secret \\                            <span class=\"comment\"># åˆ›å»º secret åç§°</span></span><br><span class=\"line\">  --namespace=ä½ çš„å‘½åç©ºé—´ \\                      <span class=\"comment\"># åˆ›å»º secret æ‰€åœ¨çš„å‘½åç©ºé—´</span></span><br><span class=\"line\">  --docker-server=https://index.docker.io/v1/ \\ <span class=\"comment\"># æŒ‡å®š docker registry åœ°å€ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå…¶å®ƒä»“åº“æˆ–ç§æœè¯·æ›´æ”¹ä¸ºå¯¹åº”çš„url</span></span><br><span class=\"line\">  --docker-username=ä½ çš„ç”¨æˆ·å \\                  <span class=\"comment\"># ä»“åº“ çš„ç”¨æˆ·å</span></span><br><span class=\"line\">  --docker-password=ä½ çš„å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ \\           <span class=\"comment\"># ä»“åº“ çš„å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ</span></span><br><span class=\"line\">  --docker-email=ä½ çš„é‚®ç®±                        <span class=\"comment\"># ä»“åº“ çš„é‚®ç®±</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ secret</span></span><br><span class=\"line\">kubectl get secret dockerhub-secret -o yaml -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥åœ¨åˆ›å»º pod æˆ– deployment æ—¶æŒ‡å®šå‡­è¯</p>\n</li>\n</ul>\n<blockquote>\n<p>pod</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">username/repository:tag</span></span><br><span class=\"line\">  <span class=\"attr\">imagePullSecrets:</span>                         <span class=\"comment\"># æ·»åŠ å‡­è¯</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">dockerhub-secret</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>deployment</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">myapp-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">username/repository:tag</span></span><br><span class=\"line\">      <span class=\"attr\">imagePullSecrets:</span>                       <span class=\"comment\"># æ·»åŠ å‡­è¯</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">dockerhub-secret</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† Secret æ·»åŠ åˆ° ServiceAccountï¼Œè¿™æ · Pod åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å°† Secret æŒ‚è½½åˆ° Pod ä¸­</p>\n</li>\n</ul>\n<blockquote>\n<p>æ¯ä¸ª namespace ä¸‹ éƒ½æœ‰ä¸€ä¸ª åç§°ä¸º default çš„ ServiceAccount</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ pod çš„ ServiceAccount</span></span><br><span class=\"line\">$ k describe pod pi-n65gn | grep <span class=\"string\">&quot;Service Account&quot;</span></span><br><span class=\"line\">Service Account:  default</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š namespace ä¸‹çš„ Pod ä½¿ç”¨è¿™ä¸ªå‡­è¯</span></span><br><span class=\"line\">kubectl patch serviceaccount default -p <span class=\"string\">&#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;]&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ å¤šä¸ªå‡­è¯ï¼Œè¿™ä¼šè¦†ç›–ä¹‹å‰çš„è®¾ç½®ï¼Œå¤šä¸ª secret æŒ‰é¡ºåºç”Ÿæ•ˆï¼Œk8s ä¼šé€ä¸ªå°è¯•å»æ‹‰å–é•œåƒ</span></span><br><span class=\"line\">kubectl patch serviceaccount default -p <span class=\"string\">&#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;, &#123;&quot;name&quot;: &quot;harbor-secret&quot;&#125;, &#123;&quot;name&quot;: &quot;aliyun-secret&quot;&#125;]&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿½åŠ ä¸€ä¸ªå‡­è¯ï¼Œä¸ä¼šè¦†ç›–åŸæœ‰çš„è®¾ç½®</span></span><br><span class=\"line\">kubectl patch serviceaccount default --<span class=\"built_in\">type</span>=<span class=\"string\">&#x27;json&#x27;</span> -p=<span class=\"string\">&#x27;[&#123;&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/imagePullSecrets/-&quot;, &quot;value&quot;: &#123;&quot;name&quot;: &quot;new-secret&quot;&#125;&#125;]&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰ imagePullSecrets çš„ç´¢å¼•ï¼Œä»¥ä¸‹å‘½ä»¤ä¼šè¾“å‡ºå‡­è¯çš„åç§°ï¼Œç´¢å¼•ä» 0 å¼€å§‹</span></span><br><span class=\"line\">kubectl get sa default -o jsonpath=<span class=\"string\">&#x27;&#123;.imagePullSecrets[*].name&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ä¸€ä¸ªå‡­è¯: åˆ é™¤ index ä¸º 1 çš„å‡­è¯</span></span><br><span class=\"line\">kubectl patch serviceaccount default --<span class=\"built_in\">type</span>=json -p=<span class=\"string\">&#x27;[&#123;&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/imagePullSecrets/1&quot;&#125;]&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¸…ç©ºæ‰€æœ‰å‡­è¯</span></span><br><span class=\"line\">kubectl patch sa default -p <span class=\"string\">&#x27;&#123;&quot;imagePullSecrets&quot;: []&#125;&#x27;</span> -n &lt;namespace&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸ºæ‰€æœ‰ namespace ä¸‹çš„ Pod æ·»åŠ å‡­è¯</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> ns <span class=\"keyword\">in</span> $(kubectl get ns -o jsonpath=<span class=\"string\">&#x27;&#123;.items[*].metadata.name&#125;&#x27;</span>); <span class=\"keyword\">do</span></span><br><span class=\"line\">  kubectl patch serviceaccount default -n <span class=\"variable\">$ns</span> \\</span><br><span class=\"line\">    --<span class=\"built_in\">type</span>=merge \\</span><br><span class=\"line\">    -p <span class=\"string\">&#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;]&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ ServiceAccount</span></span><br><span class=\"line\">$ kubectl get serviceaccount default -o yaml -n &lt;namespace&gt;</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">imagePullSecrets:</span><br><span class=\"line\">- name: dockerhub-secret</span><br><span class=\"line\">kind: ServiceAccount</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-06-29T14:41:35Z&quot;</span></span><br><span class=\"line\">  name: default</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;361001&quot;</span></span><br><span class=\"line\">  uid: cb3a0f99-5804-4f21-816a-70533cc3d29d</span><br></pre></td></tr></table></figure>\n<h2 id=\"æé«˜ä¸‹è½½é¢‘ç‡çš„å…¶ä»–å»ºè®®\">æé«˜ä¸‹è½½é¢‘ç‡çš„å…¶ä»–å»ºè®®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>1.ä½¿ç”¨é•œåƒç¼“å­˜:</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è®¾ç½®é›†ç¾¤å†…é•œåƒç¼“å­˜ï¼ˆå¦‚ Harbor, Nexus Registryï¼‰</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹é›†ç¾¤çš„é•œåƒä»“åº“é…ç½®ï¼ˆvimï¼‰</span></span><br><span class=\"line\">kubectl edit configmap -n kube-system</span><br><span class=\"line\"><span class=\"comment\"># æ‰¾åˆ° imageRepository: æ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ä½¿ç”¨ Docker Hub é•œåƒåŠ é€Ÿå™¨ï¼ˆå¦‚æœåœ¨ä¸­å›½å¤§é™†ï¼‰\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœ k8s ä½¿ç”¨çš„æ˜¯ dockerï¼Œåˆ™åœ¨<code>/etc/docker/daemon.json</code>æ·»åŠ é•œåƒåŠ é€Ÿå™¨é…ç½®</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /etc/docker</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class=\"string\">&#x27;EOF&#x27;</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;registry-mirrors&quot;</span>: [</span><br><span class=\"line\">    <span class=\"string\">&quot;https://docker.1ms.run&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;https://docker.xuanyuan.me&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;https://docker.m.daocloud.io&quot;</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl daemon-reload</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">å¦‚æœ k8s ä½¿ç”¨çš„æ˜¯ containerdï¼Œåˆ™åœ¨<code>/etc/containerd/config.toml</code>æ·»åŠ é•œåƒåŠ é€Ÿå™¨é…ç½®</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> vi /etc/containerd/config.toml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰¾åˆ° registry.mirrors å­—æ®µï¼Œæ·»åŠ åŠ é€Ÿå™¨ï¼Œæ¯”å¦‚ï¼š</span></span><br><span class=\"line\">[plugins.<span class=\"string\">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors]</span><br><span class=\"line\">  [plugins.<span class=\"string\">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class=\"string\">&quot;docker.io&quot;</span>]</span><br><span class=\"line\">    endpoint = [<span class=\"string\">&quot;https://docker.1ms.run&quot;</span>, <span class=\"string\">&quot;https://docker.xuanyuan.me&quot;</span>, <span class=\"string\">&quot;https://docker.m.daocloud.io&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹åé‡å¯ containerd</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart containerd</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>2.å‡çº§ Docker Hub è®¢é˜…:</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å…è´¹è´¦æˆ·ï¼š200 pulls/6å°æ—¶ï¼ˆåŒ¿åç”¨æˆ·100 pulls/6å°æ—¶ï¼‰</li>\n<li class=\"lvl-4\">Pro/Team è´¦æˆ·ï¼šæ— é™åˆ¶æ‹‰å–</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>3.ä½¿ç”¨å¤šä¸ªè´¦æˆ·:</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ä¸ºä¸åŒèŠ‚ç‚¹é…ç½®ä¸åŒçš„ Docker Hub å‡­è¯</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>4.å‡å°‘ä¸å¿…è¦çš„æ‹‰å–:</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ä½¿ç”¨ imagePullPolicy: IfNotPresent</li>\n<li class=\"lvl-4\">å°½é‡ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ ‡ç­¾è€Œé latest</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S é•œåƒæ‹‰å– çš„ toomanyrequests çš„è§£å†³æ–¹æ³• ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github toomanyrequests ä»‹ç» å½“æˆ‘ä»¬é€šè¿‡k8såˆ›å»ºpodæ—¶éœ€è¦ä» dockerhub ä¸Šæ‹‰å–é•œåƒï¼Œä½†æ˜¯ dockerhub çš„apiè¯·æ±‚æ˜¯æœ‰é™åˆ¶çš„ï¼Œæœªè®¤è¯ç”¨æˆ·é™åˆ¶ä¸º100/6hï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶å°±ä¼šè¿”å›429 Too Many Requestså“åº”ã€‚Docker Hubçš„ä½¿ç”¨å’Œé™åˆ¶ æˆ‘ä»¬å¯ä»¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œè¿™æ ·å¯ä»¥å°†é™åˆ¶æé«˜åˆ°2000/6hã€‚å¦‚æœè¿˜éœ€è¦è¿›ä¸€æ­¥æé«˜è¯·æ±‚é™åˆ¶ï¼Œå¯ä»¥ç”³è¯·dockerhubçš„pro planã€‚ dockerhub è®¤è¯ åˆ›å»º Docker Registry Secret 1234567891011# æŒ‡å®š namespaceï¼Œ é»˜è®¤å‘½åç©ºé—´æ˜¯ defaultkubectl create secret docker-registry \\ dockerhub-secret \\ # åˆ›å»º secret åç§° --namespace=ä½ çš„å‘½åç©ºé—´ \\ # åˆ›å»º secret æ‰€åœ¨çš„å‘½åç©ºé—´ --docker-server=https://index.docker.io/v1/ \\ # æŒ‡å®š docker registry åœ°å€ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå…¶å®ƒä»“åº“æˆ–ç§æœè¯·æ›´æ”¹ä¸ºå¯¹åº”çš„url --docker-username=ä½ çš„ç”¨æˆ·å \\ # ä»“åº“ çš„ç”¨æˆ·å --docker-password=ä½ çš„å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ \\ # ä»“åº“ çš„å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ --docker-email=ä½ çš„é‚®ç®± # ä»“åº“ çš„é‚®ç®±# æŸ¥çœ‹ secretkubectl get secret dockerhub-secret -o yaml -n &lt;namespace&gt; å¯ä»¥åœ¨åˆ›å»º pod æˆ– deployment æ—¶æŒ‡å®šå‡­è¯ pod 12345678910apiVersion: v1kind: Podmetadata: name: myappspec: containers: - name: myapp image: username/repository:tag imagePullSecrets: # æ·»åŠ å‡­è¯ - name: dockerhub-secret deployment 12345678910111213141516171819apiVersion: apps/v1kind: Deploymentmetadata: name: myapp-deploymentspec: replicas: 3 selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: containers: - name: myapp image: username/repository:tag imagePullSecrets: # æ·»åŠ å‡­è¯ - name: dockerhub-secret å°† Secret æ·»åŠ åˆ° ServiceAccountï¼Œè¿™æ · Pod åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å°† Secret æŒ‚è½½åˆ° Pod ä¸­ æ¯ä¸ª namespace ä¸‹ éƒ½æœ‰ä¸€ä¸ª åç§°ä¸º default çš„ ServiceAccount 123456789101112131415161718192021222324252627282930313233343536373839404142# æŸ¥çœ‹ pod çš„ ServiceAccount$ k describe pod pi-n65gn | grep &quot;Service Account&quot;Service Account: default# æŒ‡å®š namespace ä¸‹çš„ Pod ä½¿ç”¨è¿™ä¸ªå‡­è¯kubectl patch serviceaccount default -p &#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;]&#125;&#x27; -n &lt;namespace&gt;# æ·»åŠ å¤šä¸ªå‡­è¯ï¼Œè¿™ä¼šè¦†ç›–ä¹‹å‰çš„è®¾ç½®ï¼Œå¤šä¸ª secret æŒ‰é¡ºåºç”Ÿæ•ˆï¼Œk8s ä¼šé€ä¸ªå°è¯•å»æ‹‰å–é•œåƒkubectl patch serviceaccount default -p &#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;, &#123;&quot;name&quot;: &quot;harbor-secret&quot;&#125;, &#123;&quot;name&quot;: &quot;aliyun-secret&quot;&#125;]&#125;&#x27; -n &lt;namespace&gt;# è¿½åŠ ä¸€ä¸ªå‡­è¯ï¼Œä¸ä¼šè¦†ç›–åŸæœ‰çš„è®¾ç½®kubectl patch serviceaccount default --type=&#x27;json&#x27; -p=&#x27;[&#123;&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/imagePullSecrets/-&quot;, &quot;value&quot;: &#123;&quot;name&quot;: &quot;new-secret&quot;&#125;&#125;]&#x27; -n &lt;namespace&gt;# æŸ¥çœ‹å½“å‰ imagePullSecrets çš„ç´¢å¼•ï¼Œä»¥ä¸‹å‘½ä»¤ä¼šè¾“å‡ºå‡­è¯çš„åç§°ï¼Œç´¢å¼•ä» 0 å¼€å§‹kubectl get sa default -o jsonpath=&#x27;&#123;.imagePullSecrets[*].name&#125;&#x27; -n &lt;namespace&gt;# åˆ é™¤ä¸€ä¸ªå‡­è¯: åˆ é™¤ index ä¸º 1 çš„å‡­è¯kubectl patch serviceaccount default --type=json -p=&#x27;[&#123;&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/imagePullSecrets/1&quot;&#125;]&#x27; -n &lt;namespace&gt;# æ¸…ç©ºæ‰€æœ‰å‡­è¯kubectl patch sa default -p &#x27;&#123;&quot;imagePullSecrets&quot;: []&#125;&#x27; -n &lt;namespace&gt;# ä¸ºæ‰€æœ‰ namespace ä¸‹çš„ Pod æ·»åŠ å‡­è¯for ns in $(kubectl get ns -o jsonpath=&#x27;&#123;.items[*].metadata.name&#125;&#x27;); do kubectl patch serviceaccount default -n $ns \\ --type=merge \\ -p &#x27;&#123;&quot;imagePullSecrets&quot;: [&#123;&quot;name&quot;: &quot;dockerhub-secret&quot;&#125;]&#125;&#x27;done# æŸ¥çœ‹ ServiceAccount$ kubectl get serviceaccount default -o yaml -n &lt;namespace&gt;apiVersion: v1imagePullSecrets:- name: dockerhub-secretkind: ServiceAccountmetadata: creationTimestamp: &quot;2025-06-29T14:41:35Z&quot; name: default namespace: default resourceVersion: &quot;361001&quot; uid: cb3a0f99-5804-4f21-816a-70533cc3d29d æé«˜ä¸‹è½½é¢‘ç‡çš„å…¶ä»–å»ºè®® 1.ä½¿ç”¨é•œåƒç¼“å­˜: è®¾ç½®é›†ç¾¤å†…é•œåƒç¼“å­˜ï¼ˆå¦‚ Harbor, Nexus Registryï¼‰ 123# ä¿®æ”¹é›†ç¾¤çš„é•œåƒä»“åº“é…ç½®ï¼ˆvimï¼‰kubectl edit configmap -n kube-system# æ‰¾åˆ° imageRepository: æ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€ ä½¿ç”¨ Docker Hub é•œåƒåŠ é€Ÿå™¨ï¼ˆå¦‚æœåœ¨ä¸­å›½å¤§é™†ï¼‰ å¦‚æœ k8s ä½¿ç”¨çš„æ˜¯ dockerï¼Œåˆ™åœ¨/etc/docker/daemon.jsonæ·»åŠ é•œåƒåŠ é€Ÿå™¨é…ç½® 123456789101112sudo mkdir -p /etc/dockersudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;&#123; &quot;registry-mirrors&quot;: [ &quot;https://docker.1ms.run&quot;, &quot;https://docker.xuanyuan.me&quot;, &quot;https://docker.m.daocloud.io&quot; ]&#125;EOFsudo systemctl daemon-reloadsudo systemctl restart docker å¦‚æœ k8s ä½¿ç”¨çš„æ˜¯ containerdï¼Œåˆ™åœ¨/etc/containerd/config.tomlæ·»åŠ é•œåƒåŠ é€Ÿå™¨é…ç½® 123456789sudo vi /etc/containerd/config.toml# æ‰¾åˆ° registry.mirrors å­—æ®µï¼Œæ·»åŠ åŠ é€Ÿå™¨ï¼Œæ¯”å¦‚ï¼š[plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors] [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;docker.io&quot;] endpoint = [&quot;https://docker.1ms.run&quot;, &quot;https://docker.xuanyuan.me&quot;, &quot;https://docker.m.daocloud.io&quot;]# ä¿®æ”¹åé‡å¯ containerdsudo systemctl restart containerd 2.å‡çº§ Docker Hub è®¢é˜…: å…è´¹è´¦æˆ·ï¼š200 pulls/6å°æ—¶ï¼ˆåŒ¿åç”¨æˆ·100 pulls/6å°æ—¶ï¼‰ Pro/Team è´¦æˆ·ï¼šæ— é™åˆ¶æ‹‰å– 3.ä½¿ç”¨å¤šä¸ªè´¦æˆ·: ä¸ºä¸åŒèŠ‚ç‚¹é…ç½®ä¸åŒçš„ Docker Hub å‡­è¯ 4.å‡å°‘ä¸å¿…è¦çš„æ‹‰å–: ä½¿ç”¨ imagePullPolicy: IfNotPresent å°½é‡ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ ‡ç­¾è€Œé latest","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S é•œåƒæ‹‰å– çš„ toomanyrequests çš„è§£å†³æ–¹æ³• ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-16T15:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]}]}