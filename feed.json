{"version":"https://jsonfeed.org/version/1","name":"é£˜é€¸å³°çš„åšå®¢","home_page_url":"https://blog.hanqunfeng.com","feed_url":"https://blog.hanqunfeng.com/feed.json","author":{"name":"é£˜é€¸å³°"},"items":[{"id":"https://blog.hanqunfeng.com/2025/12/02/brew-my-formula/","url":"https://blog.hanqunfeng.com/2025/12/02/brew-my-formula/","title":"brew -- åˆ›å»ºè‡ªå·±çš„ Formula","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n-->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://brew.sh\">brew</a>æ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚<code>git</code>ã€<code>node</code>ã€<code>python</code>ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹åˆ›å»ºè‡ªå·±çš„ Formula</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäº MacOS 15.7.2ï¼Œbrew ç‰ˆæœ¬ä¸º Homebrew 5.0.3ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äº brew çš„å®‰è£…åŠä½¿ç”¨å¯ä»¥å‚è€ƒ <a href=\"/2024/11/28/brew/\" title=\"MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew\">MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä»ä¸€ä¸ªç®€å•ç¤ºä¾‹å¼€å§‹\">ä»ä¸€ä¸ªç®€å•ç¤ºä¾‹å¼€å§‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä½¿ç”¨æˆ‘è‡ªå·±ç¼–å†™çš„ä¸€ä¸ªå‘½ä»¤è¡Œè„šæœ¬ä¸ºä¾‹ï¼Œè„šæœ¬åç§°ï¼šcolor_echoï¼Œå…·ä½“å†…å®¹å¯ä»¥æŸ¥çœ‹<a href=\"https://github.com/hanqunfeng/color_echo/blob/main/bin/color_echo\">color_echo</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºç»ˆç«¯æ‰“å°å½©è‰²æ–‡æœ¬çš„å‘½ä»¤ã€‚</p>\n</li>\n</ul>\n<h3 id=\"åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œç”¨äºå­˜å‚¨-color-echo-å‘½ä»¤\">åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œç”¨äºå­˜å‚¨ color_echo å‘½ä»¤</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œç”¨äºå­˜å‚¨ <code>color_echo</code> å‘½ä»¤æ–‡ä»¶ï¼Œä»“åº“åç§°: <code>hanqunfeng/color_echo</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¼–å†™å‘½ä»¤æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> color_echo_dir</span><br><span class=\"line\"><span class=\"built_in\">cd</span> color_echo_dir</span><br><span class=\"line\"><span class=\"comment\"># æ„Ÿå…´è¶£çš„è‡ªå·±å»githubä¸ŠæŸ¥çœ‹æ–‡ä»¶å†…å®¹å§ï¼Œè¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œå°†å‘½ä»¤å­˜å‚¨åœ¨äº† bin ç›®å½•ä¸‹ï¼Œè¿™ä¸ªè·¯å¾„åé¢ç¼–å†™ Formula æ–‡ä»¶æ—¶ä¼šç”¨åˆ°</span></span><br><span class=\"line\">bin/color_echo</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æäº¤ä»£ç å¹¶æ‰“Tag</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨ color_echo_dir ç›®å½•ä¸‹åˆå§‹åŒ–ä»“åº“</span></span><br><span class=\"line\">git init</span><br><span class=\"line\">git add .</span><br><span class=\"line\">git commit -m <span class=\"string\">&quot;Initial commit&quot;</span></span><br><span class=\"line\">git branch -M main</span><br><span class=\"line\">git remote add origin https://github.com/hanqunfeng/color_echo.git</span><br><span class=\"line\">git push -u origin main</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºTag</span></span><br><span class=\"line\">git tag v1.0.0</span><br><span class=\"line\"><span class=\"comment\"># æ¨é€Tag</span></span><br><span class=\"line\">git push --tags</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å–tagçš„sha256å€¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/hanqunfeng/color_echo/archive/refs/tags/v1.0.0.tar.gz</span><br><span class=\"line\">shasum -a 256 v1.0.0.tar.gz</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">9450952a4b477c83ea2d7e28386d6ae38132bf68c46746aa218c03c21aa75f6d  v1.0.0.tar.gz</span><br></pre></td></tr></table></figure>\n<h3 id=\"å‘å¸ƒ-color-echo\">å‘å¸ƒ color_echo</h3>\n<blockquote>\n<p><code>brew create</code> å‘½ä»¤å·²ç»å¤±æ•ˆï¼Œéœ€è¦æ‰‹å·¥åˆ›å»º</p>\n</blockquote>\n<h4 id=\"åˆ›å»º-tap-ä»“åº“\">åˆ›å»º tap ä»“åº“</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew tap-new hanqunfeng/color_echo</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">Warning: tap-new is a developer <span class=\"built_in\">command</span>, so Homebrew<span class=\"string\">&#x27;s</span></span><br><span class=\"line\"><span class=\"string\">developer mode has been automatically turned on.      # æç¤ºå¼€å‘è€…æ¨¡å¼å·²è‡ªåŠ¨æ‰“å¼€</span></span><br><span class=\"line\"><span class=\"string\">To turn developer mode off, run:</span></span><br><span class=\"line\"><span class=\"string\">  brew developer off  # å¦‚åç»­éœ€è¦å…³é—­å¼€å‘è€…æ¨¡å¼å¯ä»¥è¿è¡Œè¯¥å‘½ä»¤</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">## åˆå§‹åŒ–ä»“åº“</span></span><br><span class=\"line\"><span class=\"string\">Initialized empty Git repository in /usr/local/Homebrew/Library/Taps/hanqunfeng/homebrew-color_echo/.git/</span></span><br><span class=\"line\"><span class=\"string\">[main (root-commit) 35d602b] Create hanqunfeng/color_echo tap</span></span><br><span class=\"line\"><span class=\"string\"> 3 files changed, 107 insertions(+)</span></span><br><span class=\"line\"><span class=\"string\"> create mode 100644 .github/workflows/publish.yml</span></span><br><span class=\"line\"><span class=\"string\"> create mode 100644 .github/workflows/tests.yml</span></span><br><span class=\"line\"><span class=\"string\"> create mode 100644 README.md</span></span><br><span class=\"line\"><span class=\"string\">==&gt; Created hanqunfeng/color_echo</span></span><br><span class=\"line\"><span class=\"string\">/usr/local/Homebrew/Library/Taps/hanqunfeng/homebrew-color_echo</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">When a pull request making changes to a formula (or formulae) becomes green</span></span><br><span class=\"line\"><span class=\"string\">(all checks passed), then you can publish the built bottles.</span></span><br><span class=\"line\"><span class=\"string\">To do so, label your PR as `pr-pull` and the workflow will be triggered.</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"æ‰‹å†™ä¸€ä¸ª-Formula-æ–‡ä»¶\">æ‰‹å†™ä¸€ä¸ª Formula æ–‡ä»¶</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/Homebrew/Library/Taps/hanqunfeng/homebrew-color_echo/Formula</span><br><span class=\"line\"><span class=\"built_in\">touch</span> color_echo.rb</span><br></pre></td></tr></table></figure>\n<p>å†™å…¥å†…å®¹ï¼ˆæ¨¡æ¿ï¼‰ï¼šæ¨¡æ¿æ ¼å¼åé¢ä¼šè¯¦ç»†ä»‹ç»</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ColorEcho &lt; Formula</span><br><span class=\"line\">  desc <span class=\"string\">&quot;Print colorful text in terminal&quot;</span></span><br><span class=\"line\">  homepage <span class=\"string\">&quot;https://github.com/hanqunfeng/color_echo&quot;</span></span><br><span class=\"line\">  url <span class=\"string\">&quot;https://github.com/hanqunfeng/color_echo/archive/refs/tags/v1.0.0.tar.gz&quot;</span></span><br><span class=\"line\">  sha256 <span class=\"string\">&quot;9450952a4b477c83ea2d7e28386d6ae38132bf68c46746aa218c03c21aa75f6d&quot;</span></span><br><span class=\"line\">  license <span class=\"string\">&quot;MIT&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  def install</span><br><span class=\"line\">    bin.install <span class=\"string\">&quot;bin/color_echo&quot;</span></span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">test</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    system <span class=\"string\">&quot;#&#123;bin&#125;/color_echo&quot;</span>, <span class=\"string\">&quot;--help&quot;</span></span><br><span class=\"line\">  end</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n<h4 id=\"æäº¤-Formula-æ–‡ä»¶åˆ°Githubä»“åº“\">æäº¤ Formula æ–‡ä»¶åˆ°Githubä»“åº“</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œç”¨äºå­˜å‚¨ Formula æ–‡ä»¶: <code>hanqunfeng/homebrew-color_echo</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>æ·»åŠ  Formula æ–‡ä»¶åˆ°ä»“åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> $(brew --repo hanqunfeng/color_echo)</span><br><span class=\"line\">git add .</span><br><span class=\"line\">git commit -m <span class=\"string\">&quot;Add color_echo 1.0.0&quot;</span></span><br><span class=\"line\">git remote add origin https://github.com/hanqunfeng/homebrew-color_echo.git</span><br><span class=\"line\">git push -u origin main</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">Enumerating objects: 11, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Counting objects: 100% (11/11), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Delta compression using up to 12 threads</span><br><span class=\"line\">Compressing objects: 100% (9/9), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Writing objects: 100% (11/11), 2.11 KiB | 2.11 MiB/s, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Total 11 (delta 0), reused 0 (delta 0), pack-reused 0 (from 0)</span><br><span class=\"line\">To https://github.com/hanqunfeng/homebrew-color_echo.git</span><br><span class=\"line\">! [remote rejected] main -&gt; main (refusing to allow a Personal Access Token to create or update workflow `.github/workflows/publish.yml` without `workflow` scope)</span><br><span class=\"line\">error: failed to push some refs to <span class=\"string\">&#x27;https://github.com/hanqunfeng/homebrew-color_echo.git&#x27;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æç¤ºç¼ºå°‘æƒé™ï¼Œéœ€è¦ç»™ä»“åº“æ·»åŠ æƒé™ã€‚åœ¨ Github ä¸­æ·»åŠ ä¸€ä¸ª Personal Access Tokenï¼Œå¹¶æ·»åŠ æƒé™<code>repo</code> å’Œ <code>workflow</code>ï¼Œé‡æ–°æ¨é€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®è¿œç¨‹ä»“åº“åœ°å€ï¼Œæ³¨æ„æ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€ï¼Œå¹¶ä¸”å¯†é’¥æ›¿æ¢ä¸ºå®é™…çš„å¯†é’¥</span></span><br><span class=\"line\">git remote set-url origin https://ghp_xxxxx@github.com/hanqunfeng/homebrew-color_echo.git</span><br><span class=\"line\">git push -u origin main</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">Enumerating objects: 11, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Counting objects: 100% (11/11), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Delta compression using up to 12 threads</span><br><span class=\"line\">Compressing objects: 100% (9/9), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Writing objects: 100% (11/11), 2.11 KiB | 2.11 MiB/s, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Total 11 (delta 0), reused 0 (delta 0), pack-reused 0 (from 0)</span><br><span class=\"line\">To https://github.com/hanqunfeng/homebrew-color_echo.git</span><br><span class=\"line\">* [new branch]      main -&gt; main</span><br><span class=\"line\">branch <span class=\"string\">&#x27;main&#x27;</span> <span class=\"built_in\">set</span> up to track <span class=\"string\">&#x27;origin/main&#x27;</span>.</span><br></pre></td></tr></table></figure>\n<h4 id=\"å®‰è£…-Formula\">å®‰è£… Formula</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢ tapï¼Œæ³¨æ„: æ‰§è¡Œæœç´¢å’Œå®‰è£…æ—¶éœ€è¦å…ˆåˆ‡æ¢ tapï¼Œå¦åˆ™éœ€è¦ä½¿ç”¨å®Œæ•´åŒ…å hanqunfeng/color_echo/color_echo</span></span><br><span class=\"line\">brew tap hanqunfeng/color_echo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æœç´¢</span></span><br><span class=\"line\">brew search color_echo</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">==&gt; Formulae</span><br><span class=\"line\">hanqunfeng/color_echo/color_echo              color-code</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®Œæ•´åŒ…åæœç´¢</span></span><br><span class=\"line\">brew search hanqunfeng/color_echo/color_echo</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">==&gt; Formulae</span><br><span class=\"line\">color_echo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…</span></span><br><span class=\"line\">brew install color_echo</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">==&gt; Fetching downloads <span class=\"keyword\">for</span>: color_echo</span><br><span class=\"line\">âœ”ï¸ Formula color_echo (1.0.0)                                   [Verifying     2.1KB/  2.1KB]</span><br><span class=\"line\">==&gt; Installing color_echo from hanqunfeng/color_echo</span><br><span class=\"line\">ğŸº  /usr/local/Cellar/color_echo/1.0.0: 4 files, 7.4KB, built <span class=\"keyword\">in</span> 5 seconds</span><br><span class=\"line\">==&gt; Running `brew cleanup color_echo`...</span><br><span class=\"line\">Disable this behaviour by setting `HOMEBREW_NO_INSTALL_CLEANUP=1`.</span><br><span class=\"line\">Hide these hints with `HOMEBREW_NO_ENV_HINTS=1` (see `man brew`).</span><br></pre></td></tr></table></figure>\n<h4 id=\"æµ‹è¯•-Formula\">æµ‹è¯• Formula</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">color_echo --<span class=\"built_in\">help</span></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">ç”¨æ³•: color_echo [å‚æ•°] å†…å®¹</span><br><span class=\"line\"></span><br><span class=\"line\">å‚æ•°è¯´æ˜:</span><br><span class=\"line\">  -c, --color &lt;color&gt;        è®¾ç½®å‰æ™¯è‰²ï¼ˆæ–‡å­—é¢œè‰²ï¼‰</span><br><span class=\"line\">                             å¯é€‰é¢œè‰²: black red green yellow blue magenta cyan white</span><br><span class=\"line\"></span><br><span class=\"line\">  -b, --<span class=\"built_in\">bg</span> &lt;color&gt;           è®¾ç½®èƒŒæ™¯è‰²</span><br><span class=\"line\">                             å¯é€‰é¢œè‰²: black red green yellow blue magenta cyan white</span><br><span class=\"line\"></span><br><span class=\"line\">      --bold                 åŠ ç²—å­—ä½“</span><br><span class=\"line\">      --underline            ä¸‹åˆ’çº¿</span><br><span class=\"line\">      --italic               æ–œä½“å­—ä½“ï¼ˆä»…éƒ¨åˆ†ç»ˆç«¯,Terminal ä¸æ”¯æŒï¼ŒiTerm2 æ”¯æŒï¼‰</span><br><span class=\"line\"></span><br><span class=\"line\">  -n                         ä¸æ¢è¡Œè¾“å‡ºï¼Œå…¼å®¹ <span class=\"built_in\">echo</span> çš„ -n å‚æ•°</span><br><span class=\"line\"></span><br><span class=\"line\">  -h, --<span class=\"built_in\">help</span>                 æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span><br><span class=\"line\"></span><br><span class=\"line\">ç¤ºä¾‹:</span><br><span class=\"line\">  color_echo --color green <span class=\"string\">&quot;Hello World&quot;</span></span><br><span class=\"line\">  color_echo -c red -b yellow --bold <span class=\"string\">&quot;Error Message&quot;</span></span><br><span class=\"line\">  color_echo --underline <span class=\"string\">&quot;This is underlined&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"formula-æ–‡ä»¶æ¨¡æ¿\">formula æ–‡ä»¶æ¨¡æ¿</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Rubyè¯­æ³•ï¼Œå®šä¹‰ä¸€ä¸ªFormulaçš„å­ç±»</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># class å­ç±» &lt; çˆ¶ç±»</span></span><br><span class=\"line\">class ColorEcho &lt; Formula</span><br><span class=\"line\"></span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ å±æ€§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">desc <span class=\"string\">&quot;Print colorful text in terminal&quot;</span>  <span class=\"comment\"># æè¿°</span></span><br><span class=\"line\">homepage <span class=\"string\">&quot;https://github.com/hanqunfeng/color_echo&quot;</span>  <span class=\"comment\"># é¡¹ç›®åœ°å€</span></span><br><span class=\"line\">url <span class=\"string\">&quot;https://github.com/hanqunfeng/color_echo/archive/refs/tags/v1.0.0.tar.gz&quot;</span>  <span class=\"comment\"># ä¸‹è½½åœ°å€ï¼Œå®‰è£…æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶è§£å‹</span></span><br><span class=\"line\">sha256 <span class=\"string\">&quot;9450952a4b477c83ea2d7e28386d6ae38132bf68c46746aa218c03c21aa75f6d&quot;</span>  <span class=\"comment\"># sha256ï¼Œæ ¡éªŒv1.0.0.tar.gz</span></span><br><span class=\"line\">license <span class=\"string\">&quot;MIT&quot;</span>   <span class=\"comment\"># è®¸å¯</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ å®‰è£…æ–¹æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def install  <span class=\"comment\"># Homebrew ä¼šæ‰§è¡Œçš„å®‰è£…æ­¥éª¤ï¼Œå·¥ä½œç›®å½•ä¸ºè§£å‹åçš„æ–‡ä»¶ç›®å½•</span></span><br><span class=\"line\">  <span class=\"comment\"># è¿™é‡Œåªæœ‰ä¸€ä¸ªæ­¥éª¤ï¼Œå¦‚æœè¦ä¸€æ¬¡å®‰è£…å¤šä¸ªå‘½ä»¤ï¼Œå¯ä»¥å¤šæ¬¡æ·»åŠ  bin.install</span></span><br><span class=\"line\">  bin.install <span class=\"string\">&quot;bin/color_echo&quot;</span> <span class=\"comment\"># å°† bin/color_echo å®‰è£…åˆ° /usr/local/bin/color_echo</span></span><br><span class=\"line\">  <span class=\"comment\"># å¦‚æœè¦æŒ‡å®šå®‰è£…åçš„å‘½ä»¤åç§°ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼</span></span><br><span class=\"line\">  <span class=\"comment\"># bin.install &quot;bin/color_echo.sh&quot; =&gt; &quot;color_echo&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># å¦‚æœéœ€è¦æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼</span></span><br><span class=\"line\">  <span class=\"comment\"># system &quot;echo&quot;, &quot;hello world&quot;</span></span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ æµ‹è¯•æ–¹æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">test</span> <span class=\"keyword\">do</span>  <span class=\"comment\"># Homebrew åœ¨å®‰è£…å®Œä½ çš„ formula ä¹‹åï¼Œä¼šåœ¨ä¸€ä¸ªéš”ç¦»ç¯å¢ƒä¸­æ‰§è¡Œè¿™æ®µä»£ç </span></span><br><span class=\"line\">  <span class=\"comment\"># system æŒ‡ä»¤ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œé€—å·åˆ†éš”ç›¸å½“äºç©ºæ ¼</span></span><br><span class=\"line\">  system <span class=\"string\">&quot;#&#123;bin&#125;/color_echo&quot;</span>, <span class=\"string\">&quot;--help&quot;</span>  <span class=\"comment\"># ç›¸å½“äºæ‰§è¡Œ color_echo --help</span></span><br><span class=\"line\">  <span class=\"comment\"># æ–­è¨€æµ‹è¯•</span></span><br><span class=\"line\">  <span class=\"comment\"># assert_equal &quot;2\\n&quot;, pipe_output(&quot;#&#123;bin&#125;/jq .bar&quot;, &#x27;&#123;&quot;foo&quot;:1, &quot;bar&quot;:2&#125;&#x27;)</span></span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>#{bin}: å½“å‰è¿™ä¸ª formula çš„ã€Œå®‰è£…ç›®å½•é‡Œçš„ bin ç›®å½•ã€ï¼Œä¸åŒå¹³å°ä¼šä¸åŒ</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>ç³»ç»Ÿ / æ¶æ„</th>\n<th>å®é™…è·¯å¾„ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Intel Mac</td>\n<td><code>/usr/local/Cellar/color_echo/1.0.0/bin</code></td>\n</tr>\n<tr>\n<td>Apple Silicon</td>\n<td><code>/opt/homebrew/Cellar/color_echo/1.0.0/bin</code></td>\n</tr>\n<tr>\n<td>Linuxbrew</td>\n<td><code>/home/linuxbrew/.linuxbrew/Cellar/.../bin</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœå½“å‰å®‰è£…çš„å‘½ä»¤ä¾èµ–å…¶å®ƒå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ·»åŠ ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ”¾åœ¨ def install æ–¹æ³•ä¹‹å‰</span></span><br><span class=\"line\">depends_on <span class=\"string\">&quot;jq&quot;</span> <span class=\"comment\"># åœ¨å®‰è£…ä½ çš„ formula ä¹‹å‰ï¼ŒHomebrew ä¼šå…ˆè‡ªåŠ¨å®‰è£… jqï¼Œå¹¶ä¿è¯åœ¨ä½ çš„ install / test é˜¶æ®µå¯ä»¥ç”¨</span></span><br><span class=\"line\">depends_on <span class=\"string\">&quot;jq&quot;</span> =&gt; :build   <span class=\"comment\"># åªåœ¨æ„å»ºæ—¶éœ€è¦</span></span><br><span class=\"line\">depends_on <span class=\"string\">&quot;jq&quot;</span> =&gt; :<span class=\"built_in\">test</span>    <span class=\"comment\"># æµ‹è¯•æ—¶éœ€è¦</span></span><br><span class=\"line\">depends_on <span class=\"string\">&quot;jq&quot;</span> =&gt; [:build, :<span class=\"built_in\">test</span>] <span class=\"comment\"># æ„å»ºå’Œæµ‹è¯•éƒ½éœ€è¦</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¯å¢ƒçº¦æŸ</span></span><br><span class=\"line\">depends_on macos: :sonoma          <span class=\"comment\"># ä»… macOS Sonoma</span></span><br><span class=\"line\">depends_on <span class=\"built_in\">arch</span>: :x86_64           <span class=\"comment\"># ä»… x86_64</span></span><br><span class=\"line\">depends_on xcode: [<span class=\"string\">&quot;9.3&quot;</span>, :build]  <span class=\"comment\"># ä»…å½“ Xcodeâ‰¥9.3 ä¸”ç”¨äº build</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¾èµ–ç¬¬ä¸‰æ–¹åº“ä¸­çš„å‘½ä»¤è¦ç”¨å®Œæ•´åŒ…å</span></span><br><span class=\"line\">depends_on <span class=\"string\">&quot;hanqunfeng/color_echo/color_echo&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…³äºæ›´å¤šçš„ Formula æ–‡ä»¶æ¨¡æ¿ï¼Œå¯ä»¥å‚è€ƒï¼š<a href=\"https://docs.brew.sh/Formula-Cookbook\">https://docs.brew.sh/Formula-Cookbook</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>åŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ <code>brew edit xxx</code> å‘½ä»¤æŸ¥çœ‹è¯¥ Formula æ–‡ä»¶çš„å†…å®¹è¿›è¡Œå­¦ä¹ </p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ brewæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚gitã€nodeã€pythonç­‰ã€‚ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹åˆ›å»ºè‡ªå·±çš„ Formula æœ¬æ–‡åŸºäº MacOS 15.7.2ï¼Œbrew ç‰ˆæœ¬ä¸º Homebrew 5.0.3ã€‚ å…³äº brew çš„å®‰è£…åŠä½¿ç”¨å¯ä»¥å‚è€ƒ MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew ä»ä¸€ä¸ªç®€å•ç¤ºä¾‹å¼€å§‹ è¿™é‡Œä½¿ç”¨æˆ‘è‡ªå·±ç¼–å†™çš„ä¸€ä¸ªå‘½ä»¤è¡Œè„šæœ¬ä¸ºä¾‹ï¼Œè„šæœ¬åç§°ï¼šcolor_echoï¼Œå…·ä½“å†…å®¹å¯ä»¥æŸ¥çœ‹color_echoï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºç»ˆç«¯æ‰“å°å½©è‰²æ–‡æœ¬çš„å‘½ä»¤ã€‚ åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œç”¨äºå­˜å‚¨ color_echo å‘½ä»¤ åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œç”¨äºå­˜å‚¨ color_echo å‘½ä»¤æ–‡ä»¶ï¼Œä»“åº“åç§°: hanqunfeng/color_echo ç¼–å†™å‘½ä»¤æ–‡ä»¶ 12345mkdir color_echo_dircd color_echo_dir# æ„Ÿå…´è¶£çš„è‡ªå·±å»githubä¸ŠæŸ¥çœ‹æ–‡ä»¶å†…å®¹å§ï¼Œè¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†# è¿™é‡Œå°†å‘½ä»¤å­˜å‚¨åœ¨äº† bin ç›®å½•ä¸‹ï¼Œè¿™ä¸ªè·¯å¾„åé¢ç¼–å†™ Formula æ–‡ä»¶æ—¶ä¼šç”¨åˆ°bin/color_echo æäº¤ä»£ç å¹¶æ‰“Tag 1234567891011# åœ¨ color_echo_dir ç›®å½•ä¸‹åˆå§‹åŒ–ä»“åº“git initgit add .git commit -m &quot;Initial commit&quot;git branch -M maingit remote add origin https://github.com/hanqunfeng/color_echo.gitgit push -u origin main# åˆ›å»ºTaggit tag v1.0.0# æ¨é€Taggit push --tags è·å–tagçš„sha256å€¼ 1234wget https://github.com/hanqunfeng/color_echo/archive/refs/tags/v1.0.0.tar.gzshasum -a 256 v1.0.0.tar.gz## è¾“å‡º9450952a4b477c83ea2d7e28386d6ae38132bf68c46746aa218c03c21aa75f6d v1.0.0.tar.gz å‘å¸ƒ color_echo brew create å‘½ä»¤å·²ç»å¤±æ•ˆï¼Œéœ€è¦æ‰‹å·¥åˆ›å»º åˆ›å»º tap ä»“åº“ 1234567891011121314151617181920brew tap-new hanqunfeng/color_echo## è¾“å‡ºWarning: tap-new is a developer command, so Homebrew&#x27;sdeveloper mode has been automatically turned on. # æç¤ºå¼€å‘è€…æ¨¡å¼å·²è‡ªåŠ¨æ‰“å¼€To turn developer mode off, run: brew developer off # å¦‚åç»­éœ€è¦å…³é—­å¼€å‘è€…æ¨¡å¼å¯ä»¥è¿è¡Œè¯¥å‘½ä»¤## åˆå§‹åŒ–ä»“åº“Initialized empty Git repository in /usr/local/Homebrew/Library/Taps/hanqunfeng/homebrew-color_echo/.git/[main (root-commit) 35d602b] Create hanqunfeng/color_echo tap 3 files changed, 107 insertions(+) create mode 100644 .github/workflows/publish.yml create mode 100644 .github/workflows/tests.yml create mode 100644 README.md==&gt; Created hanqunfeng/color_echo/usr/local/Homebrew/Library/Taps/hanqunfeng/homebrew-color_echoWhen a pull request making changes to a formula (or formulae) becomes green(all checks passed), then you can publish the built bottles.To do so, label your PR as `pr-pull` and the workflow will be triggered. æ‰‹å†™ä¸€ä¸ª Formula æ–‡ä»¶ 12cd /usr/local/Homebrew/Library/Taps/hanqunfeng/homebrew-color_echo/Formulatouch color_echo.rb å†™å…¥å†…å®¹ï¼ˆæ¨¡æ¿ï¼‰ï¼šæ¨¡æ¿æ ¼å¼åé¢ä¼šè¯¦ç»†ä»‹ç» 123456789101112131415class ColorEcho &lt; Formula desc &quot;Print colorful text in terminal&quot; homepage &quot;https://github.com/hanqunfeng/color_echo&quot; url &quot;https://github.com/hanqunfeng/color_echo/archive/refs/tags/v1.0.0.tar.gz&quot; sha256 &quot;9450952a4b477c83ea2d7e28386d6ae38132bf68c46746aa218c03c21aa75f6d&quot; license &quot;MIT&quot; def install bin.install &quot;bin/color_echo&quot; end test do system &quot;#&#123;bin&#125;/color_echo&quot;, &quot;--help&quot; endend æäº¤ Formula æ–‡ä»¶åˆ°Githubä»“åº“ åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œç”¨äºå­˜å‚¨ Formula æ–‡ä»¶: hanqunfeng/homebrew-color_echo æ·»åŠ  Formula æ–‡ä»¶åˆ°ä»“åº“ 123456789101112131415cd $(brew --repo hanqunfeng/color_echo)git add .git commit -m &quot;Add color_echo 1.0.0&quot;git remote add origin https://github.com/hanqunfeng/homebrew-color_echo.gitgit push -u origin main## è¾“å‡ºEnumerating objects: 11, done.Counting objects: 100% (11/11), done.Delta compression using up to 12 threadsCompressing objects: 100% (9/9), done.Writing objects: 100% (11/11), 2.11 KiB | 2.11 MiB/s, done.Total 11 (delta 0), reused 0 (delta 0), pack-reused 0 (from 0)To https://github.com/hanqunfeng/homebrew-color_echo.git! [remote rejected] main -&gt; main (refusing to allow a Personal Access Token to create or update workflow `.github/workflows/publish.yml` without `workflow` scope)error: failed to push some refs to &#x27;https://github.com/hanqunfeng/homebrew-color_echo.git&#x27; æç¤ºç¼ºå°‘æƒé™ï¼Œéœ€è¦ç»™ä»“åº“æ·»åŠ æƒé™ã€‚åœ¨ Github ä¸­æ·»åŠ ä¸€ä¸ª Personal Access Tokenï¼Œå¹¶æ·»åŠ æƒé™repo å’Œ workflowï¼Œé‡æ–°æ¨é€ 12345678910111213# è®¾ç½®è¿œç¨‹ä»“åº“åœ°å€ï¼Œæ³¨æ„æ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€ï¼Œå¹¶ä¸”å¯†é’¥æ›¿æ¢ä¸ºå®é™…çš„å¯†é’¥git remote set-url origin https://ghp_xxxxx@github.com/hanqunfeng/homebrew-color_echo.gitgit push -u origin main## è¾“å‡ºEnumerating objects: 11, done.Counting objects: 100% (11/11), done.Delta compression using up to 12 threadsCompressing objects: 100% (9/9), done.Writing objects: 100% (11/11), 2.11 KiB | 2.11 MiB/s, done.Total 11 (delta 0), reused 0 (delta 0), pack-reused 0 (from 0)To https://github.com/hanqunfeng/homebrew-color_echo.git* [new branch] main -&gt; mainbranch &#x27;main&#x27; set up to track &#x27;origin/main&#x27;. å®‰è£… Formula 12345678910111213141516171819202122232425# åˆ‡æ¢ tapï¼Œæ³¨æ„: æ‰§è¡Œæœç´¢å’Œå®‰è£…æ—¶éœ€è¦å…ˆåˆ‡æ¢ tapï¼Œå¦åˆ™éœ€è¦ä½¿ç”¨å®Œæ•´åŒ…å hanqunfeng/color_echo/color_echobrew tap hanqunfeng/color_echo# æœç´¢brew search color_echo## è¾“å‡º==&gt; Formulaehanqunfeng/color_echo/color_echo color-code# å®Œæ•´åŒ…åæœç´¢brew search hanqunfeng/color_echo/color_echo## è¾“å‡º==&gt; Formulaecolor_echo# å®‰è£…brew install color_echo## è¾“å‡º==&gt; Fetching downloads for: color_echoâœ”ï¸ Formula color_echo (1.0.0) [Verifying 2.1KB/ 2.1KB]==&gt; Installing color_echo from hanqunfeng/color_echoğŸº /usr/local/Cellar/color_echo/1.0.0: 4 files, 7.4KB, built in 5 seconds==&gt; Running `brew cleanup color_echo`...Disable this behaviour by setting `HOMEBREW_NO_INSTALL_CLEANUP=1`.Hide these hints with `HOMEBREW_NO_ENV_HINTS=1` (see `man brew`). æµ‹è¯• Formula 1234567891011121314151617181920212223color_echo --help## è¾“å‡ºç”¨æ³•: color_echo [å‚æ•°] å†…å®¹å‚æ•°è¯´æ˜: -c, --color &lt;color&gt; è®¾ç½®å‰æ™¯è‰²ï¼ˆæ–‡å­—é¢œè‰²ï¼‰ å¯é€‰é¢œè‰²: black red green yellow blue magenta cyan white -b, --bg &lt;color&gt; è®¾ç½®èƒŒæ™¯è‰² å¯é€‰é¢œè‰²: black red green yellow blue magenta cyan white --bold åŠ ç²—å­—ä½“ --underline ä¸‹åˆ’çº¿ --italic æ–œä½“å­—ä½“ï¼ˆä»…éƒ¨åˆ†ç»ˆç«¯,Terminal ä¸æ”¯æŒï¼ŒiTerm2 æ”¯æŒï¼‰ -n ä¸æ¢è¡Œè¾“å‡ºï¼Œå…¼å®¹ echo çš„ -n å‚æ•° -h, --help æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ç¤ºä¾‹: color_echo --color green &quot;Hello World&quot; color_echo -c red -b yellow --bold &quot;Error Message&quot; color_echo --underline &quot;This is underlined&quot; formula æ–‡ä»¶æ¨¡æ¿ Rubyè¯­æ³•ï¼Œå®šä¹‰ä¸€ä¸ªFormulaçš„å­ç±» 1234# class å­ç±» &lt; çˆ¶ç±»class ColorEcho &lt; Formulaend æ·»åŠ å±æ€§ 12345desc &quot;Print colorful text in terminal&quot; # æè¿°homepage &quot;https://github.com/hanqunfeng/color_echo&quot; # é¡¹ç›®åœ°å€url &quot;https://github.com/hanqunfeng/color_echo/archive/refs/tags/v1.0.0.tar.gz&quot; # ä¸‹è½½åœ°å€ï¼Œå®‰è£…æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶è§£å‹sha256 &quot;9450952a4b477c83ea2d7e28386d6ae38132bf68c46746aa218c03c21aa75f6d&quot; # sha256ï¼Œæ ¡éªŒv1.0.0.tar.gzlicense &quot;MIT&quot; # è®¸å¯ æ·»åŠ å®‰è£…æ–¹æ³• 123456789def install # Homebrew ä¼šæ‰§è¡Œçš„å®‰è£…æ­¥éª¤ï¼Œå·¥ä½œç›®å½•ä¸ºè§£å‹åçš„æ–‡ä»¶ç›®å½• # è¿™é‡Œåªæœ‰ä¸€ä¸ªæ­¥éª¤ï¼Œå¦‚æœè¦ä¸€æ¬¡å®‰è£…å¤šä¸ªå‘½ä»¤ï¼Œå¯ä»¥å¤šæ¬¡æ·»åŠ  bin.install bin.install &quot;bin/color_echo&quot; # å°† bin/color_echo å®‰è£…åˆ° /usr/local/bin/color_echo # å¦‚æœè¦æŒ‡å®šå®‰è£…åçš„å‘½ä»¤åç§°ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ # bin.install &quot;bin/color_echo.sh&quot; =&gt; &quot;color_echo&quot; # å¦‚æœéœ€è¦æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ # system &quot;echo&quot;, &quot;hello world&quot;end æ·»åŠ æµ‹è¯•æ–¹æ³• 123456test do # Homebrew åœ¨å®‰è£…å®Œä½ çš„ formula ä¹‹åï¼Œä¼šåœ¨ä¸€ä¸ªéš”ç¦»ç¯å¢ƒä¸­æ‰§è¡Œè¿™æ®µä»£ç  # system æŒ‡ä»¤ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œé€—å·åˆ†éš”ç›¸å½“äºç©ºæ ¼ system &quot;#&#123;bin&#125;/color_echo&quot;, &quot;--help&quot; # ç›¸å½“äºæ‰§è¡Œ color_echo --help # æ–­è¨€æµ‹è¯• # assert_equal &quot;2\\n&quot;, pipe_output(&quot;#&#123;bin&#125;/jq .bar&quot;, &#x27;&#123;&quot;foo&quot;:1, &quot;bar&quot;:2&#125;&#x27;)end #{bin}: å½“å‰è¿™ä¸ª formula çš„ã€Œå®‰è£…ç›®å½•é‡Œçš„ bin ç›®å½•ã€ï¼Œä¸åŒå¹³å°ä¼šä¸åŒ ç³»ç»Ÿ / æ¶æ„ å®é™…è·¯å¾„ç¤ºä¾‹ Intel Mac /usr/local/Cellar/color_echo/1.0.0/bin Apple Silicon /opt/homebrew/Cellar/color_echo/1.0.0/bin Linuxbrew /home/linuxbrew/.linuxbrew/Cellar/.../bin å¦‚æœå½“å‰å®‰è£…çš„å‘½ä»¤ä¾èµ–å…¶å®ƒå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ·»åŠ ä¾èµ– 123456789101112131415# æ”¾åœ¨ def install æ–¹æ³•ä¹‹å‰depends_on &quot;jq&quot; # åœ¨å®‰è£…ä½ çš„ formula ä¹‹å‰ï¼ŒHomebrew ä¼šå…ˆè‡ªåŠ¨å®‰è£… jqï¼Œå¹¶ä¿è¯åœ¨ä½ çš„ install / test é˜¶æ®µå¯ä»¥ç”¨depends_on &quot;jq&quot; =&gt; :build # åªåœ¨æ„å»ºæ—¶éœ€è¦depends_on &quot;jq&quot; =&gt; :test # æµ‹è¯•æ—¶éœ€è¦depends_on &quot;jq&quot; =&gt; [:build, :test] # æ„å»ºå’Œæµ‹è¯•éƒ½éœ€è¦# ç¯å¢ƒçº¦æŸdepends_on macos: :sonoma # ä»… macOS Sonomadepends_on arch: :x86_64 # ä»… x86_64depends_on xcode: [&quot;9.3&quot;, :build] # ä»…å½“ Xcodeâ‰¥9.3 ä¸”ç”¨äº build# ä¾èµ–ç¬¬ä¸‰æ–¹åº“ä¸­çš„å‘½ä»¤è¦ç”¨å®Œæ•´åŒ…ådepends_on &quot;hanqunfeng/color_echo/color_echo&quot; åè®° å…³äºæ›´å¤šçš„ Formula æ–‡ä»¶æ¨¡æ¿ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://docs.brew.sh/Formula-Cookbook åŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ brew edit xxx å‘½ä»¤æŸ¥çœ‹è¯¥ Formula æ–‡ä»¶çš„å†…å®¹è¿›è¡Œå­¦ä¹ ","summary":"æ‘˜è¦ brewæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶æ”¯æŒMacOSå’ŒLinuxï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œæ¯”å¦‚gitã€nodeã€pythonç­‰ã€‚ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨macosä¸‹åˆ›å»ºè‡ªå·±çš„ Formula æœ¬æ–‡åŸºäº MacOS 15.7.2ï¼Œbrew ç‰ˆæœ¬ä¸º Homebrew 5.0.3ã€‚ å…³äº brew çš„å®‰è£…åŠä½¿ç”¨å¯ä»¥å‚è€ƒ MacOSè½¯ä»¶åŒ…ç®¡ç†å™¨--brew","date_published":"2025-12-02T13:55:05.000Z","tags":["macos","macos","brew"]},{"id":"https://blog.hanqunfeng.com/2025/11/26/linux-command16-lsof/","url":"https://blog.hanqunfeng.com/2025/11/26/linux-command16-lsof/","title":"Linuxå¸¸ç”¨å‘½ä»¤--lsof","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» lsof å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åŸºäºCentOS8ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"lsof-æ˜¯ä»€ä¹ˆï¼Ÿ\">lsof æ˜¯ä»€ä¹ˆï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>lsof = list open files</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒç”¨æ¥æŸ¥çœ‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶</li>\n<li class=\"lvl-4\">åŒ…å«æ™®é€šæ–‡ä»¶ã€ç›®å½•ã€socketã€ç®¡é“ã€ç½‘ç»œè¿æ¥ã€è®¾å¤‡ç­‰</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ Linux ä¸­ï¼šâ€œä¸€åˆ‡çš†æ–‡ä»¶â€</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰€ä»¥ä½ å¯ä»¥ç”¨ lsof æŸ¥çœ‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è°åœ¨å ç”¨ä½ çš„ç«¯å£ï¼Ÿ</li>\n<li class=\"lvl-4\">å“ªä¸ªè¿›ç¨‹æ­£åœ¨è¯»/å†™æŸä¸ªæ–‡ä»¶ï¼Ÿ</li>\n<li class=\"lvl-4\">ä¸ºä»€ä¹ˆæ–‡ä»¶åˆ é™¤äº†å´è¿˜å ç£ç›˜ï¼Ÿ</li>\n<li class=\"lvl-4\">å“ªä¸ªæ–‡ä»¶è¢«é”ä½ï¼Ÿ</li>\n<li class=\"lvl-4\">å“ªäº›ç¨‹åºåœ¨è®¿é—®æŸä¸ªç›®å½•ï¼Ÿ</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>CentOS é»˜è®¤åŒ…å« lsofï¼Œä½†å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥é€šè¿‡ yum å®‰è£…</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install lsof -y</span><br></pre></td></tr></table></figure>\n<h2 id=\"lsof-çš„åŸºæœ¬ç”¨æ³•\">lsof çš„åŸºæœ¬ç”¨æ³•</h2>\n<h3 id=\"æŸ¥çœ‹è¢«åˆ é™¤ä½†ä»è¢«å ç”¨çš„æ–‡ä»¶\">æŸ¥çœ‹è¢«åˆ é™¤ä½†ä»è¢«å ç”¨çš„æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœè¿›ç¨‹æ­£åœ¨è¿è¡Œä¸”ä¿æŒæ–‡ä»¶çš„å¥æŸ„ï¼Œæ­¤æ—¶æ²¡æœ‰åœæ­¢è¿›ç¨‹å°±æ‰§è¡Œäº†<code>rm</code>å‘½ä»¤ï¼Œæ­¤æ—¶æ–‡ä»¶çš„**ç›®å½•é¡¹ï¼ˆåå­—ï¼‰**è¢«åˆ é™¤ï¼Œä½†æ˜¯æ–‡ä»¶æ•°æ®æœ¬èº«æ²¡æœ‰è¢«åˆ é™¤ï¼Œåªè¦æœ‰è¿›ç¨‹è¿˜åœ¨æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼ˆä¿æŒæ–‡ä»¶å¥æŸ„ï¼‰ï¼Œå®ƒå°±ç»§ç»­å ç”¨ç£ç›˜ç©ºé—´ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ–‡ä»¶å·²ç»è¢«åˆ é™¤ï¼ˆunlinkï¼‰ï¼Œä½†è¿›ç¨‹ä»ç„¶æŒæœ‰è¯¥æ–‡ä»¶çš„æ‰“å¼€å¥æŸ„ï¼Œè¿™ç§æ–‡ä»¶åœ¨ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ls</span> ä¸­çœ‹ä¸åˆ°</span><br><span class=\"line\"><span class=\"built_in\">du</span> ä¸ä¼šç»Ÿè®¡ç©ºé—´</span><br><span class=\"line\">åªæœ‰ lsof èƒ½çœ‹åˆ°ï¼Œè¿™æ˜¯å…¸å‹çš„ â€œdeleted but still openâ€ çŠ¶æ€ã€‚</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢å“ªäº›è¢«åˆ é™¤çš„æ–‡ä»¶è¿˜è¢«å ç”¨ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰ link count å°äº 1 çš„ï¼ˆdeletedï¼‰æ–‡ä»¶</span></span><br><span class=\"line\">lsof +L1</span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰è¢«åˆ é™¤çš„æ–‡ä»¶</span></span><br><span class=\"line\">lsof | grep deleted</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœæŸ¥è¯¢åˆ°è¿™ç§æ–‡ä»¶ï¼Œåˆ™éœ€è¦åœæ­¢è¿›ç¨‹ï¼Œæ‰èƒ½çœŸæ­£åˆ é™¤æ–‡ä»¶ã€‚</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>è®°ä¸€æ¬¡çº¿ä¸ŠæœåŠ¡å™¨ç£ç›˜ç©ºé—´å‘Šè­¦é—®é¢˜æ’æŸ¥</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">ç›‘æ§ç³»ç»Ÿå‘Šè­¦ç£ç›˜ç©ºé—´å°äº15%ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ç¡®å®å¦‚æ­¤</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">df</span> -hT</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">Filesystem Type  Size Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/xvda1 ext4  7.9G 3.3G 4.6G  42%  /</span><br><span class=\"line\">tmpfs      tmpfs 2.0G 0    2.0G  0%   /dev/shm</span><br><span class=\"line\">/dev/xvdf1 ext4  99G  80G  15G   85%  /usr/local/boss/logs</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">ä½†é€šè¿‡å¦‚ä¸‹å‘½ä»¤å…·ä½“æŸ¥çœ‹ç›®å½•å ç”¨ç©ºé—´æ—¶ï¼Œå‘ç°å ç”¨çš„ç©ºé—´æ¯”å®é™…å ç”¨çš„ç©ºé—´å°‘å¾ˆå¤š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">du</span> -sh /usr/local/boss/logs</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">2.3G    /usr/local/boss/logs</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ­¤æ—¶æƒ³åˆ°å¯èƒ½æ˜¯åˆ é™¤çš„æ–‡ä»¶å¥æŸ„æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lsof +L1</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç¤ºä¾‹ï¼ŒNLINK:ç¡¬é“¾æ¥æ•°é‡ï¼ˆNumber of Linksï¼‰ï¼Œ=0 è¡¨ç¤ºæ–‡ä»¶è¢«åˆ é™¤ï¼Œä½†æ˜¯è¿›ç¨‹æ²¡æœ‰é‡Šæ”¾æ–‡ä»¶å¥æŸ„</span></span><br><span class=\"line\">COMMAND    PID      USER    FD      TYPE    DEVICE  SIZE/OFF      NLINK   NODE    NAME</span><br><span class=\"line\">java       1836     boss    1w      REG     202,81  82677994584   0       917554  /usr/local/boss/logs/tomcat_log/catalina.out (deleted)</span><br><span class=\"line\">java       1836     boss    2w      REG     202,81  82677994584   0       917554  /usr/local/boss/logs/tomcat_log/catalina.out (deleted)</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">ç»“æœå¦‚é¢„æœŸï¼Œè¿™æ˜¯ä¸€ä¸ªtomcatè¿›ç¨‹ï¼Œåº”è¯¥æ˜¯åˆ é™¤äº†å…¶æ—¥å¿—æ–‡ä»¶ï¼Œä½†æ˜¯åˆ é™¤æ—¶æ²¡æœ‰åœæ­¢tomcatè¿›ç¨‹ï¼Œå¯¼è‡´æ–‡ä»¶è¢«ç»§ç»­å ç”¨ï¼Œæ­¤æ—¶å·²ç»å ç”¨äº†80å¤šä¸ªGçš„ç£ç›˜ç©ºé—´ï¼Œå¦‚æœè¦é‡Šæ”¾ç£ç›˜ç©ºé—´éœ€è¦åœæ­¢tomcatã€‚</li>\n</ul>\n</div>\n<h3 id=\"æŸ¥ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨\">æŸ¥ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæŒ‡å®šç«¯å£å¯¹åº”çš„è¿›ç¨‹</span></span><br><span class=\"line\">lsof -i tcp:8080</span><br><span class=\"line\"><span class=\"comment\"># åè®®å¯ä»¥çœç•¥</span></span><br><span class=\"line\">lsof -i :8080</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç¤ºä¾‹</span></span><br><span class=\"line\">COMMAND   PID USER   FD   TYPE     DEVICE SIZE/OFF NODE NAME</span><br><span class=\"line\">java    18548 boss   39u  IPv6 1251548211      0t0  TCP *:webcache (LISTEN)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°†æœåŠ¡åç§°æ›¿æ¢ä¸ºç«¯å£</span></span><br><span class=\"line\">lsof -i :8080 -P</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç¤ºä¾‹</span></span><br><span class=\"line\">COMMAND   PID USER   FD   TYPE     DEVICE SIZE/OFF NODE NAME</span><br><span class=\"line\">java    18548 boss   39u  IPv6 1251548211      0t0  TCP *:8080 (LISTEN)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶\">æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lsof -p &lt;PID&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç¤ºä¾‹</span></span><br><span class=\"line\">COMMAND   PID USER   FD   TYPE     DEVICE  SIZE/OFF       NODE NAME</span><br><span class=\"line\">java    18548 boss  cwd    DIR      202,1      4096      35377 /home/boss</span><br><span class=\"line\">java    18548 boss  rtd    DIR      202,1      4096          2 /</span><br><span class=\"line\">java    18548 boss  mem    REG      202,1 106065056      60671 /usr/lib/locale/locale-archive</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>èƒ½çœ‹åˆ°è¿™ä¸ªè¿›ç¨‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ‰“å¼€çš„æ—¥å¿—æ–‡ä»¶</li>\n<li class=\"lvl-4\">ä½¿ç”¨çš„ jar æ–‡ä»¶</li>\n<li class=\"lvl-4\">ä½¿ç”¨çš„ socket</li>\n<li class=\"lvl-4\">ä½¿ç”¨çš„ config æ–‡ä»¶</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>è¾“å‡ºç»“æœå­—æ®µè¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>COMMAND</td>\n<td>ç¨‹åºåï¼ˆjavaï¼‰</td>\n</tr>\n<tr>\n<td>PID</td>\n<td>è¿›ç¨‹å·ï¼ˆ18548ï¼‰</td>\n</tr>\n<tr>\n<td>USER</td>\n<td>è¿è¡Œç”¨æˆ·ï¼ˆbossï¼‰</td>\n</tr>\n<tr>\n<td>FD</td>\n<td>æ–‡ä»¶æè¿°ç¬¦</td>\n</tr>\n<tr>\n<td>TYPE</td>\n<td>æ–‡ä»¶ç±»å‹</td>\n</tr>\n<tr>\n<td>DEVICE</td>\n<td>æ‰€åœ¨ç£ç›˜åˆ†åŒº ID</td>\n</tr>\n<tr>\n<td>SIZE/OFF</td>\n<td>æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰</td>\n</tr>\n<tr>\n<td>NODE</td>\n<td>inode ç¼–å·</td>\n</tr>\n<tr>\n<td>NAME</td>\n<td>æ–‡ä»¶åï¼ˆæˆ–ç½‘ç»œè¿æ¥ä¿¡æ¯ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æŸ¥çœ‹æŒ‡å®šç”¨æˆ·å ç”¨çš„æ–‡ä»¶\">æŸ¥çœ‹æŒ‡å®šç”¨æˆ·å ç”¨çš„æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºç”¨æˆ· boss æ‰€æœ‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶</span></span><br><span class=\"line\">lsof -u &lt;USER&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹æŒ‡å®šç¨‹åº-COMMAND-æ‰“å¼€çš„æ–‡ä»¶\">æŸ¥çœ‹æŒ‡å®šç¨‹åº(COMMAND)æ‰“å¼€çš„æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lsof -c &lt;<span class=\"built_in\">command</span>&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥æŸä¸ªç›®å½•æˆ–æ–‡ä»¶æ­£åœ¨è¢«å“ªäº›è¿›ç¨‹å ç”¨\">æŸ¥æŸä¸ªç›®å½•æˆ–æ–‡ä»¶æ­£åœ¨è¢«å“ªäº›è¿›ç¨‹å ç”¨</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›®å½• +D</span></span><br><span class=\"line\"><span class=\"comment\"># èƒ½æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è®¿é—®è¯¥ç›®å½•ä¸­æ–‡ä»¶çš„è¿›ç¨‹</span></span><br><span class=\"line\">lsof +D /home/boss/logs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶</span></span><br><span class=\"line\">lsof /home/boss/logs/access.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªåˆ—å‡º nginx ç”¨æˆ·å ç”¨çš„æ–‡ä»¶ç›®å½•ä¸­çš„å“ªäº›æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># -a: é€»è¾‘ä¸ï¼Œä¸åŠ  -a åˆ™è¡¨ç¤º é€»è¾‘æˆ–</span></span><br><span class=\"line\">lsof -a -u nginx +D /usr/local/nginx/logs</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"æŸ¥çœ‹ç½‘ç»œè¿æ¥\">æŸ¥çœ‹ç½‘ç»œè¿æ¥</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lsof -i</span><br><span class=\"line\"><span class=\"comment\"># è¿‡æ»¤åè®®</span></span><br><span class=\"line\">lsof -i tcp</span><br><span class=\"line\">lsof -i udp</span><br><span class=\"line\"><span class=\"comment\"># è¿‡æ»¤çŠ¶æ€</span></span><br><span class=\"line\">lsof -i -s tcp:listen</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ‰€æœ‰ç›‘å¬ç«¯å£ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\"># -i: æ˜¾ç¤ºç½‘ç»œç›¸å…³çš„æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># -P: æ˜¾ç¤ºç«¯å£(ä¸åŠ -Påˆ™æ˜¾ç¤ºçš„æ˜¯æœåŠ¡å)</span></span><br><span class=\"line\"><span class=\"comment\"># -n: ä¸å°† IP æ˜ å°„æˆä¸»æœºåï¼ˆç¦ç”¨ DNS æŸ¥è¯¢ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># -s: è¿‡æ»¤æ˜¾ç¤ºè¿æ¥çŠ¶æ€</span></span><br><span class=\"line\">lsof -i -P -n -s tcp:listen</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç¤ºä¾‹</span></span><br><span class=\"line\">mongod     1782     root    5u  IPv4       8697      0t0  TCP *:27017 (LISTEN)</span><br><span class=\"line\">java       1808     boss   36u  IPv6       9221      0t0  TCP *:8082 (LISTEN)</span><br><span class=\"line\">java       1808     boss   39u  IPv6       9230      0t0  TCP 127.0.0.1:7093 (LISTEN)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºç”¨æˆ· boss çš„ç½‘ç»œè¿æ¥</span></span><br><span class=\"line\"><span class=\"comment\"># -a: é€»è¾‘ä¸ï¼Œä¸åŠ  -a åˆ™è¡¨ç¤º é€»è¾‘æˆ–</span></span><br><span class=\"line\">lsof -a -u boss -i</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸¸ç”¨å‚æ•°è¯¦è§£\">å¸¸ç”¨å‚æ•°è¯¦è§£</h2>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>ä½œç”¨</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-i</code></td>\n<td>æŸ¥çœ‹ç½‘ç»œç›¸å…³æ–‡ä»¶/ç«¯å£</td>\n<td><code>lsof -i</code></td>\n</tr>\n<tr>\n<td><code>-i :ç«¯å£</code></td>\n<td>æŸ¥çœ‹æŒ‡å®šç«¯å£</td>\n<td><code>lsof -i :8080</code></td>\n</tr>\n<tr>\n<td><code>-p PID</code></td>\n<td>æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ‰€æœ‰æ‰“å¼€æ–‡ä»¶</td>\n<td><code>lsof -p 1836</code></td>\n</tr>\n<tr>\n<td><code>-u ç”¨æˆ·å</code></td>\n<td>æŸ¥çœ‹æŸä¸ªç”¨æˆ·è¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶</td>\n<td><code>lsof -u nginx</code></td>\n</tr>\n<tr>\n<td><code>-c è¿›ç¨‹åå…³é”®å­—</code></td>\n<td>æŸ¥çœ‹æŸä¸ªè¿›ç¨‹åç›¸å…³çš„æ–‡ä»¶</td>\n<td><code>lsof -c java</code></td>\n</tr>\n<tr>\n<td><code>+D ç›®å½•</code></td>\n<td>æŸ¥çœ‹ç›®å½•ä¸­æ‰€æœ‰è¢«è®¿é—®çš„æ–‡ä»¶</td>\n<td><code>lsof +D /usr/local/netqin/boss/netqin/logs</code></td>\n</tr>\n<tr>\n<td><code>+L1</code></td>\n<td>æŸ¥æ‰¾å·²åˆ é™¤ä½†ä»è¢«æ‰“å¼€çš„æ–‡ä»¶</td>\n<td><code>lsof +L1</code>ï¼ˆ=æŸ¥æ‰¾â€œ(deleted)â€å ç›˜é—®é¢˜ï¼‰</td>\n</tr>\n<tr>\n<td><code>-d FD</code></td>\n<td>æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦</td>\n<td><code>lsof -d 1 -p 1836</code>ï¼ˆçœ‹è¿›ç¨‹ stdoutï¼‰</td>\n</tr>\n<tr>\n<td><code>-n</code></td>\n<td>ä¸åš DNS è§£æï¼Œæé«˜é€Ÿåº¦</td>\n<td><code>lsof -i -n</code></td>\n</tr>\n<tr>\n<td><code>-P</code></td>\n<td>æ˜¾ç¤ºç«¯å£å·ï¼ˆä¸è§£æä¸ºæœåŠ¡åï¼‰</td>\n<td><code>lsof -i -P</code></td>\n</tr>\n<tr>\n<td><code>-s</code></td>\n<td>æŒ‰è¿æ¥çŠ¶æ€è¿‡æ»¤ï¼ˆTCP/UDPï¼‰</td>\n<td><code>lsof -i -sTCP:LISTEN</code></td>\n</tr>\n<tr>\n<td><code>-r</code></td>\n<td>æŒç»­è¾“å‡ºï¼ˆå®æ—¶ç›‘æ§ï¼‰</td>\n<td><code>lsof -i -r 1</code>ï¼ˆæ¯ç§’åˆ·æ–°ç½‘ç»œè¿æ¥ï¼‰</td>\n</tr>\n<tr>\n<td><code>-a</code></td>\n<td>é€»è¾‘ ANDï¼Œä¸åŠ  -a éƒ½æ˜¯ é€»è¾‘ OR</td>\n<td><code>lsof -u boss -i</code>ï¼ˆåˆ—å‡ºç”¨æˆ· boss çš„ç½‘ç»œè¿æ¥ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"lsof-æ–‡ä»¶-FD-å­—æ®µè¯¦ç»†è§£é‡Š\">lsof æ–‡ä»¶ FD å­—æ®µè¯¦ç»†è§£é‡Š</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>FDï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰æ ¼å¼æ€»è§„åˆ™ï¼šæ•°å­— + æ ‡å¿—ä½</p>\n</li>\n<li class=\"lvl-2\">\n<p>lsof è¾“å‡ºä¸­çš„ FDï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰åˆ—ï¼Œæ¯ä¸€ä¸ªéƒ½ä»£è¡¨è¿›ç¨‹æ‰“å¼€çš„ä¸€ä¸ªâ€œæ–‡ä»¶â€ï¼ˆåŒ…æ‹¬æ™®é€šæ–‡ä»¶ã€ç›®å½•ã€è®¾å¤‡ã€socketã€pipe ç­‰ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10r   â†’ FD=10ï¼Œ<span class=\"built_in\">read</span> onlyï¼ˆåªè¯»ï¼‰</span><br><span class=\"line\">1w    â†’ FD=1ï¼Œwrite onlyï¼ˆåªå†™ï¼‰</span><br><span class=\"line\">36u   â†’ FD=36ï¼Œ<span class=\"built_in\">read</span>/writeï¼ˆå¯è¯»å¯å†™ï¼‰</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£é‡Š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>éƒ¨åˆ†</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ•°å­—ï¼ˆ0ã€1ã€2ã€3ã€10ã€36â€¦ï¼‰</strong></td>\n<td>æ–‡ä»¶æè¿°ç¬¦ç¼–å·</td>\n</tr>\n<tr>\n<td><strong>å­—æ¯ï¼ˆr / w / uï¼‰</strong></td>\n<td>è®¿é—®æ¨¡å¼ï¼šè¯»/å†™/è¯»å†™</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>FD ç¼–å·</th>\n<th>æ ‡å‡†å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>0</strong></td>\n<td>stdinï¼ˆæ ‡å‡†è¾“å…¥ï¼‰</td>\n</tr>\n<tr>\n<td><strong>1</strong></td>\n<td>stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰</td>\n</tr>\n<tr>\n<td><strong>2</strong></td>\n<td>stderrï¼ˆæ ‡å‡†é”™è¯¯è¾“å‡ºï¼‰</td>\n</tr>\n<tr>\n<td><strong>3</strong> åŠä»¥ä¸Š</td>\n<td>è¿›ç¨‹æ‰“å¼€çš„æ™®é€šæ–‡ä»¶ã€æ—¥å¿—ã€socketã€ç®¡é“ç­‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç‰¹æ®Š FD ç±»å‹ï¼ˆæ²¡æœ‰æ•°å­—ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>cwd</code></td>\n<td>å½“å‰å·¥ä½œç›®å½•ï¼Œè¯´æ˜è¿›ç¨‹åœ¨è¿™ä¸ªç›®å½•ä¸‹è¿è¡Œ</td>\n</tr>\n<tr>\n<td><code>rtd</code></td>\n<td>è¿›ç¨‹çš„æ ¹ç›®å½•ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ /ï¼Œå®¹å™¨é‡Œå¯èƒ½æ˜¯åˆ«çš„ rootfs</td>\n</tr>\n<tr>\n<td><code>txt</code></td>\n<td>å¯æ‰§è¡Œæ–‡ä»¶æœ¬ä½“</td>\n</tr>\n<tr>\n<td><code>mem</code></td>\n<td>å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰æ–‡ä»¶ï¼Œè¿›ç¨‹åŠ è½½åˆ°å†…å­˜ä¸­çš„åº“ / jar / so æ–‡ä»¶</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"lsof-æ–‡ä»¶-TYPE-å­—æ®µè¯¦ç»†è§£é‡Š\">lsof æ–‡ä»¶ TYPE å­—æ®µè¯¦ç»†è§£é‡Š</h2>\n<table>\n<thead>\n<tr>\n<th>æ–‡ä»¶ç±»å‹</th>\n<th>å…¨ç§°</th>\n<th>å«ä¹‰</th>\n<th>å¸¸è§åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>REG</strong></td>\n<td>Regular file</td>\n<td>æ™®é€šæ–‡ä»¶</td>\n<td>æ—¥å¿—ã€é…ç½®ã€å¯æ‰§è¡Œç¨‹åºç­‰</td>\n</tr>\n<tr>\n<td><strong>DIR</strong></td>\n<td>Directory</td>\n<td>ç›®å½•</td>\n<td>è¿›ç¨‹è®¿é—®çš„ç›®å½•ï¼Œä¾‹å¦‚å½“å‰å·¥ä½œç›®å½•</td>\n</tr>\n<tr>\n<td><strong>CHR</strong></td>\n<td>Character special file</td>\n<td>å­—ç¬¦è®¾å¤‡æ–‡ä»¶</td>\n<td><code>/dev/null</code>ã€<code>/dev/tty</code>ã€ä¸²å£ã€é”®ç›˜ç­‰</td>\n</tr>\n<tr>\n<td><strong>BLK</strong></td>\n<td>Block special file</td>\n<td>å—è®¾å¤‡æ–‡ä»¶</td>\n<td><code>/dev/sda</code>ã€ç¡¬ç›˜ã€åˆ†åŒºç­‰</td>\n</tr>\n<tr>\n<td><strong>FIFO</strong></td>\n<td>Named pipe</td>\n<td>å‘½åç®¡é“</td>\n<td>Linux è¿›ç¨‹é—´é€šä¿¡ï¼Œå¦‚ Nginx å’Œ PHP-FPM çš„é€šä¿¡</td>\n</tr>\n<tr>\n<td><strong>sock</strong></td>\n<td>Socket</td>\n<td>å¥—æ¥å­—ï¼ˆUnix åŸŸ socketï¼‰</td>\n<td><code>/var/run/docker.sock</code>ã€MySQL UNix socket</td>\n</tr>\n<tr>\n<td><strong>IPv4</strong></td>\n<td>IPv4 socket</td>\n<td>IPv4 ç½‘ç»œè¿æ¥/ç›‘å¬</td>\n<td><code>TCP *:80</code>ã€<code>UDP 127.0.0.1:53</code></td>\n</tr>\n<tr>\n<td><strong>IPv6</strong></td>\n<td>IPv6 socket</td>\n<td>IPv6 ç½‘ç»œè¿æ¥/ç›‘å¬</td>\n<td><code>TCP [::]:22</code></td>\n</tr>\n<tr>\n<td><strong>unix</strong></td>\n<td>Unix domain socket</td>\n<td>æœ¬åœ°è¿›ç¨‹é€šä¿¡</td>\n<td><code>/run/systemd/journal/stdout</code></td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» lsof å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³• æœ¬æ–‡åŸºäºCentOS8ã€‚ lsof æ˜¯ä»€ä¹ˆï¼Ÿ lsof = list open files å®ƒç”¨æ¥æŸ¥çœ‹ï¼š å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ åŒ…å«æ™®é€šæ–‡ä»¶ã€ç›®å½•ã€socketã€ç®¡é“ã€ç½‘ç»œè¿æ¥ã€è®¾å¤‡ç­‰ åœ¨ Linux ä¸­ï¼šâ€œä¸€åˆ‡çš†æ–‡ä»¶â€ æ‰€ä»¥ä½ å¯ä»¥ç”¨ lsof æŸ¥çœ‹ï¼š è°åœ¨å ç”¨ä½ çš„ç«¯å£ï¼Ÿ å“ªä¸ªè¿›ç¨‹æ­£åœ¨è¯»/å†™æŸä¸ªæ–‡ä»¶ï¼Ÿ ä¸ºä»€ä¹ˆæ–‡ä»¶åˆ é™¤äº†å´è¿˜å ç£ç›˜ï¼Ÿ å“ªä¸ªæ–‡ä»¶è¢«é”ä½ï¼Ÿ å“ªäº›ç¨‹åºåœ¨è®¿é—®æŸä¸ªç›®å½•ï¼Ÿ CentOS é»˜è®¤åŒ…å« lsofï¼Œä½†å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥é€šè¿‡ yum å®‰è£… 1yum install lsof -y lsof çš„åŸºæœ¬ç”¨æ³• æŸ¥çœ‹è¢«åˆ é™¤ä½†ä»è¢«å ç”¨çš„æ–‡ä»¶ å¦‚æœè¿›ç¨‹æ­£åœ¨è¿è¡Œä¸”ä¿æŒæ–‡ä»¶çš„å¥æŸ„ï¼Œæ­¤æ—¶æ²¡æœ‰åœæ­¢è¿›ç¨‹å°±æ‰§è¡Œäº†rmå‘½ä»¤ï¼Œæ­¤æ—¶æ–‡ä»¶çš„**ç›®å½•é¡¹ï¼ˆåå­—ï¼‰**è¢«åˆ é™¤ï¼Œä½†æ˜¯æ–‡ä»¶æ•°æ®æœ¬èº«æ²¡æœ‰è¢«åˆ é™¤ï¼Œåªè¦æœ‰è¿›ç¨‹è¿˜åœ¨æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼ˆä¿æŒæ–‡ä»¶å¥æŸ„ï¼‰ï¼Œå®ƒå°±ç»§ç»­å ç”¨ç£ç›˜ç©ºé—´ã€‚ æ–‡ä»¶å·²ç»è¢«åˆ é™¤ï¼ˆunlinkï¼‰ï¼Œä½†è¿›ç¨‹ä»ç„¶æŒæœ‰è¯¥æ–‡ä»¶çš„æ‰“å¼€å¥æŸ„ï¼Œè¿™ç§æ–‡ä»¶åœ¨ï¼š 123ls ä¸­çœ‹ä¸åˆ°du ä¸ä¼šç»Ÿè®¡ç©ºé—´åªæœ‰ lsof èƒ½çœ‹åˆ°ï¼Œè¿™æ˜¯å…¸å‹çš„ â€œdeleted but still openâ€ çŠ¶æ€ã€‚ æ­¤æ—¶å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢å“ªäº›è¢«åˆ é™¤çš„æ–‡ä»¶è¿˜è¢«å ç”¨ï¼š 1234# åˆ—å‡ºæ‰€æœ‰ link count å°äº 1 çš„ï¼ˆdeletedï¼‰æ–‡ä»¶lsof +L1# åˆ—å‡ºæ‰€æœ‰è¢«åˆ é™¤çš„æ–‡ä»¶lsof | grep deleted å¦‚æœæŸ¥è¯¢åˆ°è¿™ç§æ–‡ä»¶ï¼Œåˆ™éœ€è¦åœæ­¢è¿›ç¨‹ï¼Œæ‰èƒ½çœŸæ­£åˆ é™¤æ–‡ä»¶ã€‚ è®°ä¸€æ¬¡çº¿ä¸ŠæœåŠ¡å™¨ç£ç›˜ç©ºé—´å‘Šè­¦é—®é¢˜æ’æŸ¥ ç›‘æ§ç³»ç»Ÿå‘Šè­¦ç£ç›˜ç©ºé—´å°äº15%ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ç¡®å®å¦‚æ­¤ 123456$ df -hT# è¾“å‡ºFilesystem Type Size Used Avail Use% Mounted on/dev/xvda1 ext4 7.9G 3.3G 4.6G 42% /tmpfs tmpfs 2.0G 0 2.0G 0% /dev/shm/dev/xvdf1 ext4 99G 80G 15G 85% /usr/local/boss/logs ä½†é€šè¿‡å¦‚ä¸‹å‘½ä»¤å…·ä½“æŸ¥çœ‹ç›®å½•å ç”¨ç©ºé—´æ—¶ï¼Œå‘ç°å ç”¨çš„ç©ºé—´æ¯”å®é™…å ç”¨çš„ç©ºé—´å°‘å¾ˆå¤š 123$ du -sh /usr/local/boss/logs# è¾“å‡º2.3G /usr/local/boss/logs æ­¤æ—¶æƒ³åˆ°å¯èƒ½æ˜¯åˆ é™¤çš„æ–‡ä»¶å¥æŸ„æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š 12345lsof +L1## è¾“å‡ºç¤ºä¾‹ï¼ŒNLINK:ç¡¬é“¾æ¥æ•°é‡ï¼ˆNumber of Linksï¼‰ï¼Œ=0 è¡¨ç¤ºæ–‡ä»¶è¢«åˆ é™¤ï¼Œä½†æ˜¯è¿›ç¨‹æ²¡æœ‰é‡Šæ”¾æ–‡ä»¶å¥æŸ„COMMAND PID USER FD TYPE DEVICE SIZE/OFF NLINK NODE NAMEjava 1836 boss 1w REG 202,81 82677994584 0 917554 /usr/local/boss/logs/tomcat_log/catalina.out (deleted)java 1836 boss 2w REG 202,81 82677994584 0 917554 /usr/local/boss/logs/tomcat_log/catalina.out (deleted) ç»“æœå¦‚é¢„æœŸï¼Œè¿™æ˜¯ä¸€ä¸ªtomcatè¿›ç¨‹ï¼Œåº”è¯¥æ˜¯åˆ é™¤äº†å…¶æ—¥å¿—æ–‡ä»¶ï¼Œä½†æ˜¯åˆ é™¤æ—¶æ²¡æœ‰åœæ­¢tomcatè¿›ç¨‹ï¼Œå¯¼è‡´æ–‡ä»¶è¢«ç»§ç»­å ç”¨ï¼Œæ­¤æ—¶å·²ç»å ç”¨äº†80å¤šä¸ªGçš„ç£ç›˜ç©ºé—´ï¼Œå¦‚æœè¦é‡Šæ”¾ç£ç›˜ç©ºé—´éœ€è¦åœæ­¢tomcatã€‚ æŸ¥ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨ é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š 1234567891011121314# åˆ—å‡ºæŒ‡å®šç«¯å£å¯¹åº”çš„è¿›ç¨‹lsof -i tcp:8080# åè®®å¯ä»¥çœç•¥lsof -i :8080## è¾“å‡ºç¤ºä¾‹COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAMEjava 18548 boss 39u IPv6 1251548211 0t0 TCP *:webcache (LISTEN)# å°†æœåŠ¡åç§°æ›¿æ¢ä¸ºç«¯å£lsof -i :8080 -P## è¾“å‡ºç¤ºä¾‹COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAMEjava 18548 boss 39u IPv6 1251548211 0t0 TCP *:8080 (LISTEN) æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶ é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š 12345678lsof -p &lt;PID&gt;## è¾“å‡ºç¤ºä¾‹COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAMEjava 18548 boss cwd DIR 202,1 4096 35377 /home/bossjava 18548 boss rtd DIR 202,1 4096 2 /java 18548 boss mem REG 202,1 106065056 60671 /usr/lib/locale/locale-archive èƒ½çœ‹åˆ°è¿™ä¸ªè¿›ç¨‹ï¼š æ‰“å¼€çš„æ—¥å¿—æ–‡ä»¶ ä½¿ç”¨çš„ jar æ–‡ä»¶ ä½¿ç”¨çš„ socket ä½¿ç”¨çš„ config æ–‡ä»¶ è¾“å‡ºç»“æœå­—æ®µè¯´æ˜ å­—æ®µ å«ä¹‰ COMMAND ç¨‹åºåï¼ˆjavaï¼‰ PID è¿›ç¨‹å·ï¼ˆ18548ï¼‰ USER è¿è¡Œç”¨æˆ·ï¼ˆbossï¼‰ FD æ–‡ä»¶æè¿°ç¬¦ TYPE æ–‡ä»¶ç±»å‹ DEVICE æ‰€åœ¨ç£ç›˜åˆ†åŒº ID SIZE/OFF æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ NODE inode ç¼–å· NAME æ–‡ä»¶åï¼ˆæˆ–ç½‘ç»œè¿æ¥ä¿¡æ¯ï¼‰ æŸ¥çœ‹æŒ‡å®šç”¨æˆ·å ç”¨çš„æ–‡ä»¶ é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š 12# åˆ—å‡ºç”¨æˆ· boss æ‰€æœ‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶lsof -u &lt;USER&gt; æŸ¥çœ‹æŒ‡å®šç¨‹åº(COMMAND)æ‰“å¼€çš„æ–‡ä»¶ é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼š 1lsof -c &lt;command&gt; æŸ¥æŸä¸ªç›®å½•æˆ–æ–‡ä»¶æ­£åœ¨è¢«å“ªäº›è¿›ç¨‹å ç”¨ 1234567891011# ç›®å½• +D# èƒ½æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è®¿é—®è¯¥ç›®å½•ä¸­æ–‡ä»¶çš„è¿›ç¨‹lsof +D /home/boss/logs# æ–‡ä»¶lsof /home/boss/logs/access.log# åªåˆ—å‡º nginx ç”¨æˆ·å ç”¨çš„æ–‡ä»¶ç›®å½•ä¸­çš„å“ªäº›æ–‡ä»¶# -a: é€»è¾‘ä¸ï¼Œä¸åŠ  -a åˆ™è¡¨ç¤º é€»è¾‘æˆ–lsof -a -u nginx +D /usr/local/nginx/logs æŸ¥çœ‹ç½‘ç»œè¿æ¥ 12345678910111213141516171819202122lsof -i# è¿‡æ»¤åè®®lsof -i tcplsof -i udp# è¿‡æ»¤çŠ¶æ€lsof -i -s tcp:listen# åˆ—å‡ºæ‰€æœ‰ç›‘å¬ç«¯å£ï¼Œ# -i: æ˜¾ç¤ºç½‘ç»œç›¸å…³çš„æ–‡ä»¶# -P: æ˜¾ç¤ºç«¯å£(ä¸åŠ -Påˆ™æ˜¾ç¤ºçš„æ˜¯æœåŠ¡å)# -n: ä¸å°† IP æ˜ å°„æˆä¸»æœºåï¼ˆç¦ç”¨ DNS æŸ¥è¯¢ï¼‰# -s: è¿‡æ»¤æ˜¾ç¤ºè¿æ¥çŠ¶æ€lsof -i -P -n -s tcp:listen## è¾“å‡ºç¤ºä¾‹mongod 1782 root 5u IPv4 8697 0t0 TCP *:27017 (LISTEN)java 1808 boss 36u IPv6 9221 0t0 TCP *:8082 (LISTEN)java 1808 boss 39u IPv6 9230 0t0 TCP 127.0.0.1:7093 (LISTEN)# åˆ—å‡ºç”¨æˆ· boss çš„ç½‘ç»œè¿æ¥# -a: é€»è¾‘ä¸ï¼Œä¸åŠ  -a åˆ™è¡¨ç¤º é€»è¾‘æˆ–lsof -a -u boss -i å¸¸ç”¨å‚æ•°è¯¦è§£ å‚æ•° ä½œç”¨ ç¤ºä¾‹ -i æŸ¥çœ‹ç½‘ç»œç›¸å…³æ–‡ä»¶/ç«¯å£ lsof -i -i :ç«¯å£ æŸ¥çœ‹æŒ‡å®šç«¯å£ lsof -i :8080 -p PID æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ‰€æœ‰æ‰“å¼€æ–‡ä»¶ lsof -p 1836 -u ç”¨æˆ·å æŸ¥çœ‹æŸä¸ªç”¨æˆ·è¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶ lsof -u nginx -c è¿›ç¨‹åå…³é”®å­— æŸ¥çœ‹æŸä¸ªè¿›ç¨‹åç›¸å…³çš„æ–‡ä»¶ lsof -c java +D ç›®å½• æŸ¥çœ‹ç›®å½•ä¸­æ‰€æœ‰è¢«è®¿é—®çš„æ–‡ä»¶ lsof +D /usr/local/netqin/boss/netqin/logs +L1 æŸ¥æ‰¾å·²åˆ é™¤ä½†ä»è¢«æ‰“å¼€çš„æ–‡ä»¶ lsof +L1ï¼ˆ=æŸ¥æ‰¾â€œ(deleted)â€å ç›˜é—®é¢˜ï¼‰ -d FD æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦ lsof -d 1 -p 1836ï¼ˆçœ‹è¿›ç¨‹ stdoutï¼‰ -n ä¸åš DNS è§£æï¼Œæé«˜é€Ÿåº¦ lsof -i -n -P æ˜¾ç¤ºç«¯å£å·ï¼ˆä¸è§£æä¸ºæœåŠ¡åï¼‰ lsof -i -P -s æŒ‰è¿æ¥çŠ¶æ€è¿‡æ»¤ï¼ˆTCP/UDPï¼‰ lsof -i -sTCP:LISTEN -r æŒç»­è¾“å‡ºï¼ˆå®æ—¶ç›‘æ§ï¼‰ lsof -i -r 1ï¼ˆæ¯ç§’åˆ·æ–°ç½‘ç»œè¿æ¥ï¼‰ -a é€»è¾‘ ANDï¼Œä¸åŠ  -a éƒ½æ˜¯ é€»è¾‘ OR lsof -u boss -iï¼ˆåˆ—å‡ºç”¨æˆ· boss çš„ç½‘ç»œè¿æ¥ï¼‰ lsof æ–‡ä»¶ FD å­—æ®µè¯¦ç»†è§£é‡Š FDï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰æ ¼å¼æ€»è§„åˆ™ï¼šæ•°å­— + æ ‡å¿—ä½ lsof è¾“å‡ºä¸­çš„ FDï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰åˆ—ï¼Œæ¯ä¸€ä¸ªéƒ½ä»£è¡¨è¿›ç¨‹æ‰“å¼€çš„ä¸€ä¸ªâ€œæ–‡ä»¶â€ï¼ˆåŒ…æ‹¬æ™®é€šæ–‡ä»¶ã€ç›®å½•ã€è®¾å¤‡ã€socketã€pipe ç­‰ï¼‰ã€‚ ç¤ºä¾‹ 12310r â†’ FD=10ï¼Œread onlyï¼ˆåªè¯»ï¼‰1w â†’ FD=1ï¼Œwrite onlyï¼ˆåªå†™ï¼‰36u â†’ FD=36ï¼Œread/writeï¼ˆå¯è¯»å¯å†™ï¼‰ è§£é‡Š éƒ¨åˆ† å«ä¹‰ æ•°å­—ï¼ˆ0ã€1ã€2ã€3ã€10ã€36â€¦ï¼‰ æ–‡ä»¶æè¿°ç¬¦ç¼–å· å­—æ¯ï¼ˆr / w / uï¼‰ è®¿é—®æ¨¡å¼ï¼šè¯»/å†™/è¯»å†™ FD ç¼–å· æ ‡å‡†å«ä¹‰ 0 stdinï¼ˆæ ‡å‡†è¾“å…¥ï¼‰ 1 stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ 2 stderrï¼ˆæ ‡å‡†é”™è¯¯è¾“å‡ºï¼‰ 3 åŠä»¥ä¸Š è¿›ç¨‹æ‰“å¼€çš„æ™®é€šæ–‡ä»¶ã€æ—¥å¿—ã€socketã€ç®¡é“ç­‰ ç‰¹æ®Š FD ç±»å‹ï¼ˆæ²¡æœ‰æ•°å­—ï¼‰ å­—æ®µ å«ä¹‰ cwd å½“å‰å·¥ä½œç›®å½•ï¼Œè¯´æ˜è¿›ç¨‹åœ¨è¿™ä¸ªç›®å½•ä¸‹è¿è¡Œ rtd è¿›ç¨‹çš„æ ¹ç›®å½•ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ /ï¼Œå®¹å™¨é‡Œå¯èƒ½æ˜¯åˆ«çš„ rootfs txt å¯æ‰§è¡Œæ–‡ä»¶æœ¬ä½“ mem å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰æ–‡ä»¶ï¼Œè¿›ç¨‹åŠ è½½åˆ°å†…å­˜ä¸­çš„åº“ / jar / so æ–‡ä»¶ lsof æ–‡ä»¶ TYPE å­—æ®µè¯¦ç»†è§£é‡Š æ–‡ä»¶ç±»å‹ å…¨ç§° å«ä¹‰ å¸¸è§åœºæ™¯ REG Regular file æ™®é€šæ–‡ä»¶ æ—¥å¿—ã€é…ç½®ã€å¯æ‰§è¡Œç¨‹åºç­‰ DIR Directory ç›®å½• è¿›ç¨‹è®¿é—®çš„ç›®å½•ï¼Œä¾‹å¦‚å½“å‰å·¥ä½œç›®å½• CHR Character special file å­—ç¬¦è®¾å¤‡æ–‡ä»¶ /dev/nullã€/dev/ttyã€ä¸²å£ã€é”®ç›˜ç­‰ BLK Block special file å—è®¾å¤‡æ–‡ä»¶ /dev/sdaã€ç¡¬ç›˜ã€åˆ†åŒºç­‰ FIFO Named pipe å‘½åç®¡é“ Linux è¿›ç¨‹é—´é€šä¿¡ï¼Œå¦‚ Nginx å’Œ PHP-FPM çš„é€šä¿¡ sock Socket å¥—æ¥å­—ï¼ˆUnix åŸŸ socketï¼‰ /var/run/docker.sockã€MySQL UNix socket IPv4 IPv4 socket IPv4 ç½‘ç»œè¿æ¥/ç›‘å¬ TCP *:80ã€UDP 127.0.0.1:53 IPv6 IPv6 socket IPv6 ç½‘ç»œè¿æ¥/ç›‘å¬ TCP [::]:22 unix Unix domain socket æœ¬åœ°è¿›ç¨‹é€šä¿¡ /run/systemd/journal/stdout","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» lsof å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³• æœ¬æ–‡åŸºäºCentOS8ã€‚","date_published":"2025-11-26T13:30:05.000Z","tags":["æŠ€æœ¯","linux","linuxå¸¸ç”¨å‘½ä»¤","linuxå¸¸ç”¨å‘½ä»¤"]},{"id":"https://blog.hanqunfeng.com/2025/11/20/utc/","url":"https://blog.hanqunfeng.com/2025/11/20/utc/","title":"ä»€ä¹ˆæ˜¯ UTCï¼Ÿä¸€ç¯‡äººäººéƒ½èƒ½çœ‹æ‡‚çš„ç§‘æ™®æ–‡ç« ","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å¬åˆ°â€œUTC æ—¶é—´â€â€œåŒ—äº¬æ—¶é—´ UTC+8â€â€œæœåŠ¡å™¨æ—¶é—´æ˜¯ UTCâ€ï¼Œä½†è®¸å¤šäººå¹¶ä¸äº†è§£ UTC åˆ°åº•æ˜¯ä»€ä¹ˆã€‚æœ¬æ–‡å°†ç”¨å°½é‡ç®€å•çš„æ–¹å¼ï¼Œå¸¦ä½ ææ¸…æ¥šç°ä»£ä¸–ç•Œæ‰€ä¾èµ–çš„å…¨çƒé€šç”¨æ—¶é—´æ ‡å‡†â€”â€”UTCã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä¸€ã€ä¸ºä»€ä¹ˆä¸–ç•Œéœ€è¦ç»Ÿä¸€æ—¶é—´ï¼Ÿ\">ä¸€ã€ä¸ºä»€ä¹ˆä¸–ç•Œéœ€è¦ç»Ÿä¸€æ—¶é—´ï¼Ÿ</h2>\n<p>æ—©æœŸï¼Œæ¯ä¸ªåŸå¸‚ç”šè‡³æ¯ä¸ªä¹¡é•‡éƒ½æ ¹æ® <strong>å¤ªé˜³ä½ç½®</strong>ç¡®å®šæ—¶é—´ï¼š</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤ªé˜³åœ¨å¤´é¡¶å°±æ˜¯ 12 ç‚¹</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸åŒåœ°æ–¹ç»åº¦ä¸åŒï¼Œæ¯åœ°æ—¶é—´éƒ½ä¸åŒ</p>\n</li>\n</ul>\n<p>è¿™ç§æ–¹æ³•åœ¨æœ¬åœ°æ²¡é—®é¢˜ï¼Œä½†åˆ°äº† <strong>è·¨åŒºåŸŸé“è·¯ã€é€šä¿¡ã€èˆªæµ·ã€èˆªç©ºã€äº’è”ç½‘æ—¶ä»£</strong>ï¼Œé—®é¢˜å·¨å¤§ï¼š</p>\n<blockquote>\n<p>ä¸¤åœ°æ—¶é—´ä¸ç»Ÿä¸€ï¼Œç«è½¦ã€èˆ°é˜Ÿã€è®¢å•ã€é€šä¿¡éƒ½æ²¡æ³•åŒæ­¥è®°å½•ã€‚</p>\n</blockquote>\n<p>å› æ­¤ä¸–ç•Œéœ€è¦ï¼š</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ª <strong>å…¨çƒç»Ÿä¸€ã€ç²¾ç¡®çš„æ ‡å‡†æ—¶é—´</strong></p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‰€æœ‰äººã€æ‰€æœ‰ç³»ç»Ÿéƒ½èƒ½å¯¹é½ä½¿ç”¨</p>\n</li>\n</ul>\n<p>UTC å°±æ˜¯åœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹è¯ç”Ÿçš„ã€‚</p>\n<hr>\n<h2 id=\"äºŒã€UTC-æ˜¯ä»€ä¹ˆï¼Ÿ\">äºŒã€UTC æ˜¯ä»€ä¹ˆï¼Ÿ</h2>\n<p>UTC çš„å…¨ç§°ï¼š</p>\n<blockquote>\n<p><strong>Coordinated Universal Timeï¼ˆåè°ƒä¸–ç•Œæ—¶ï¼‰</strong></p>\n</blockquote>\n<p>å®ƒæ˜¯å½“ä»Šå…¨çƒä½¿ç”¨çš„ <strong>æ ‡å‡†æ—¶é—´ç³»ç»Ÿ</strong>ã€‚</p>\n<p>å®ƒçš„ä¸»è¦ç‰¹ç‚¹ï¼š</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸æ˜¯æŸä¸ªå›½å®¶çš„æ—¶é—´</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ˜¯å›½é™…ç»„ç»‡å…±åŒç»´æŠ¤</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…¨ä¸–ç•Œæ‰€æœ‰æœºæˆ¿ã€é€šä¿¡ã€å«æ˜Ÿã€èˆªç­ã€GPSã€é‡‘èç³»ç»Ÿéƒ½ä»¥å®ƒä¸ºåŸºå‡†</p>\n</li>\n</ul>\n<p>ä¸€å¥è¯ï¼š</p>\n<blockquote>\n<p><strong>UTC æ˜¯ç°ä»£ä¸–ç•Œå…±åŒä½¿ç”¨çš„â€œä¸–ç•Œæ—¶é—´â€ã€‚</strong></p>\n</blockquote>\n<hr>\n<h2 id=\"ä¸‰ã€UTC-å’Œ-GMT-çš„å…³ç³»\">ä¸‰ã€UTC å’Œ GMT çš„å…³ç³»</h2>\n<p>å¾ˆå¤šäººå¬è¿‡ GMTï¼ˆæ ¼æ—å°¼æ²»æ—¶é—´ï¼‰ï¼Œå†å²ä¸Š GMT æ˜¯ä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œåæ¥è¢« UTC å–ä»£ã€‚</p>\n<table>\n<thead>\n<tr>\n<th>é¡¹ç›®</th>\n<th>GMT</th>\n<th>UTC</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å‡ºç°å¹´ä»£</td>\n<td>19 ä¸–çºª</td>\n<td>1972 å¹´</td>\n</tr>\n<tr>\n<td>åŸºå‡†</td>\n<td>åœ°çƒè‡ªè½¬ï¼ˆå¤©æ–‡æ—¶é—´ï¼‰</td>\n<td>åŸå­é’Ÿï¼ˆæ›´ç²¾ç¡®ï¼‰</td>\n</tr>\n<tr>\n<td>æ˜¯å¦ä»æ˜¯æ ‡å‡†</td>\n<td>å·²è¢«æ›¿ä»£</td>\n<td>å½“å‰å”¯ä¸€æ ‡å‡†</td>\n</tr>\n</tbody>\n</table>\n<p>ä½†åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼š</p>\n<blockquote>\n<p><strong>UTC â‰ˆ GMTï¼ˆåŒä¸ºé›¶æ—¶åŒºï¼‰</strong></p>\n</blockquote>\n<p>æ‰€ä»¥ï¼š</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è‹±å›½å†¬å­£ä½¿ç”¨ GMTï¼ˆUTC+0ï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>æŠ€æœ¯ç³»ç»Ÿä½¿ç”¨ UTCï¼ˆUTC+0ï¼‰</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"å››ã€UTC-æ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ\">å››ã€UTC æ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ</h2>\n<p>UTC å¹¶ä¸æ˜¯æŒ‰å¤ªé˜³èµ°ï¼Œè€Œæ˜¯ï¼š</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”±å…¨ä¸–ç•Œ <strong>åŸå­é’Ÿç½‘ç»œç»Ÿä¸€ç”Ÿæˆ</strong></p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯ç§’è¯¯å·®å°äº <strong>åäº¿åˆ†ä¹‹ä¸€ç§’</strong></p>\n</li>\n<li class=\"lvl-2\">\n<p>ç„¶åæ ¹æ®åœ°çƒè‡ªè½¬è¯¯å·®å¶å°”åŠ â€œé—°ç§’â€</p>\n</li>\n</ul>\n<p>ä¾‹å¦‚ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2016-12-31 23:59:60 UTC   â† æ›¾ç»åŠ è¿‡é—°ç§’</span><br></pre></td></tr></table></figure>\n<p>è¿™æ ·ï¼š</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿è¯æ—¶é—´æå…¶å‡†ç¡®</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆä¸ä¼šä¸åœ°çƒçœŸå®æ˜¼å¤œåç¦»å¤ªå¤š</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"äº”ã€UTC-ä¸æ—¶åŒº\">äº”ã€UTC ä¸æ—¶åŒº</h2>\n<p>UTC æ˜¯ 0 æ—¶åŒºã€‚</p>\n<p>æ‰€æœ‰æ—¶åŒºéƒ½æ˜¯ <strong>åœ¨ UTC åŸºç¡€ä¸ŠåŠ å‡åç§»</strong>ï¼š</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒ—äº¬æ—¶é—´ï¼šUTC + 8</p>\n</li>\n<li class=\"lvl-2\">\n<p>çº½çº¦æ—¶é—´ï¼šUTC â€“ 5ï¼ˆå†¬å­£ï¼‰æˆ– â€“4ï¼ˆå¤ä»¤æ—¶ï¼‰</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ—¥æœ¬æ—¶é—´ï¼šUTC + 9</p>\n</li>\n</ul>\n<p>æ‰€ä»¥ä½ å¸¸çœ‹åˆ°ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UTC+8 æˆ– UTC-5</span><br></pre></td></tr></table></figure>\n<p>è¡¨ç¤ºè¯¥åœ°åŒºæ¯” UTC æ—©æˆ–æ™šå¤šå°‘å°æ—¶ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UTC+8  &gt;  UTC+0  &gt;  UTCâˆ’5</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¢æˆç”Ÿæ´»è¯­è¨€ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">UTC+8ï¼ˆä¾‹å¦‚åŒ—äº¬æ—¶é—´ï¼‰æ¯” UTC æ—© 8 å°æ—¶</li>\n<li class=\"lvl-4\">UTCâˆ’5ï¼ˆä¾‹å¦‚ç¾å›½ä¸œéƒ¨å†¬ä»¤æ—¶ï¼‰æ¯” UTC æ™š 5 å°æ—¶</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¾ä¾‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">UTC(å³UTC+0) æ—¶é—´æ˜¯ 12:00</li>\n<li class=\"lvl-4\">UTC+8 = 20:00ï¼ˆå·²ç»æ™šä¸Šï¼‰</li>\n<li class=\"lvl-4\">UTCâˆ’5 = 07:00ï¼ˆè¿˜åœ¨æ—©ä¸Šï¼‰</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"å…­ã€UTC-åœ¨è®¡ç®—æœºä¸–ç•Œçš„é‡è¦æ€§\">å…­ã€UTC åœ¨è®¡ç®—æœºä¸–ç•Œçš„é‡è¦æ€§</h2>\n<p>å‡ ä¹æ‰€æœ‰ IT ç³»ç»Ÿéƒ½æ¨èï¼š</p>\n<blockquote>\n<p><strong>å­˜å‚¨ç”¨ UTCï¼Œå±•ç¤ºç»™ç”¨æˆ·å†è½¬æ¢æˆå½“åœ°æ—¶åŒºã€‚</strong></p>\n</blockquote>\n<p>åŸå› å¾ˆç®€å•ï¼š</p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…¨çƒä¸€è‡´ï¼Œä¸ä¼šæ··ä¹±</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸å—æ—¶åŒºæˆ–å¤ä»¤æ—¶å½±å“</p>\n</li>\n<li class=\"lvl-2\">\n<p>è·¨å›½ç³»ç»Ÿæ—¥å¿—å¯å¯¹é½åˆ†æ</p>\n</li>\n</ul>\n<p>ä½ åœ¨æ—¥å¿—é‡Œç»å¸¸è§åˆ°ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2025-11-20T08:30:00Z</span><br></pre></td></tr></table></figure>\n<p>ç»“å°¾çš„ <code>Z</code> å°±è¡¨ç¤ºï¼š</p>\n<blockquote>\n<p><strong>è¿™æ˜¯ UTC æ—¶é—´</strong></p>\n</blockquote>\n<hr>\n<h2 id=\"ä¸ƒã€UTCã€GMTã€CST-æ€»ç»“å¯¹æ¯”\">ä¸ƒã€UTCã€GMTã€CST æ€»ç»“å¯¹æ¯”</h2>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>å…¨ç§°</th>\n<th>ç°åœ¨åœ°ä½</th>\n<th>æ˜¯å¦æ ‡å‡†</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>UTC</td>\n<td>Coordinated Universal Time</td>\n<td>å…¨çƒæ ‡å‡†</td>\n<td>âœ”</td>\n</tr>\n<tr>\n<td>GMT</td>\n<td>Greenwich Mean Time</td>\n<td>è¢« UTC æ›¿ä»£</td>\n<td>âœ–ï¼ˆå†å²å«ä¹‰ï¼‰</td>\n</tr>\n<tr>\n<td>CST</td>\n<td>China Standard Timeï¼ˆä¸­å›½ï¼‰æˆ– Central Standard Timeï¼ˆç¾å›½ï¼‰</td>\n<td>æœ¬åœ°æ—¶åŒº</td>\n<td>ä¸æ˜¯ä¸–ç•Œç»Ÿä¸€åŸºå‡†</td>\n</tr>\n</tbody>\n</table>\n<p>æ³¨æ„ï¼š</p>\n<blockquote>\n<p>â€œCSTâ€ æ—¢å¯èƒ½æ˜¯ä¸­å›½åŒºï¼Œä¹Ÿå¯èƒ½æ˜¯ç¾å›½åŒºï¼Œéœ€è¦ç»“åˆ UTC åç§»åˆ¤æ–­ã€‚</p>\n</blockquote>\n<hr>\n<h2 id=\"å…«ã€ä¸€å¥è¯æ€»ç»“\">å…«ã€ä¸€å¥è¯æ€»ç»“</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>UTC æ˜¯ç°ä»£å…¨çƒç»Ÿä¸€çš„æ ‡å‡†æ—¶é—´</strong></p>\n</li>\n<li class=\"lvl-2\">\n<p><strong>æ‰€æœ‰æ—¶åŒºéƒ½æ˜¯ç›¸å¯¹äº UTC åç§»</strong></p>\n</li>\n<li class=\"lvl-2\">\n<p><strong>è®¡ç®—æœºé¢†åŸŸæ™®éä½¿ç”¨ UTC å­˜å‚¨æ—¶é—´</strong></p>\n</li>\n<li class=\"lvl-2\">\n<p><strong>GMT æ˜¯ UTC çš„å†å²å‰èº«</strong></p>\n</li>\n<li class=\"lvl-2\">\n<p><strong>åŒ—äº¬æ—¶é—´ = UTC + 8</strong></p>\n</li>\n</ul>\n<p>åªè¦ç†è§£è¿™å‡ ç‚¹ï¼Œä½ å·²ç»æŒæ¡äº†ä¸–ç•Œæ—¶é—´ä½“ç³»çš„æ ¸å¿ƒã€‚</p>\n","content_text":"æ‘˜è¦ åœ¨ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å¬åˆ°â€œUTC æ—¶é—´â€â€œåŒ—äº¬æ—¶é—´ UTC+8â€â€œæœåŠ¡å™¨æ—¶é—´æ˜¯ UTCâ€ï¼Œä½†è®¸å¤šäººå¹¶ä¸äº†è§£ UTC åˆ°åº•æ˜¯ä»€ä¹ˆã€‚æœ¬æ–‡å°†ç”¨å°½é‡ç®€å•çš„æ–¹å¼ï¼Œå¸¦ä½ ææ¸…æ¥šç°ä»£ä¸–ç•Œæ‰€ä¾èµ–çš„å…¨çƒé€šç”¨æ—¶é—´æ ‡å‡†â€”â€”UTCã€‚ ä¸€ã€ä¸ºä»€ä¹ˆä¸–ç•Œéœ€è¦ç»Ÿä¸€æ—¶é—´ï¼Ÿ æ—©æœŸï¼Œæ¯ä¸ªåŸå¸‚ç”šè‡³æ¯ä¸ªä¹¡é•‡éƒ½æ ¹æ® å¤ªé˜³ä½ç½®ç¡®å®šæ—¶é—´ï¼š å¤ªé˜³åœ¨å¤´é¡¶å°±æ˜¯ 12 ç‚¹ ä¸åŒåœ°æ–¹ç»åº¦ä¸åŒï¼Œæ¯åœ°æ—¶é—´éƒ½ä¸åŒ è¿™ç§æ–¹æ³•åœ¨æœ¬åœ°æ²¡é—®é¢˜ï¼Œä½†åˆ°äº† è·¨åŒºåŸŸé“è·¯ã€é€šä¿¡ã€èˆªæµ·ã€èˆªç©ºã€äº’è”ç½‘æ—¶ä»£ï¼Œé—®é¢˜å·¨å¤§ï¼š ä¸¤åœ°æ—¶é—´ä¸ç»Ÿä¸€ï¼Œç«è½¦ã€èˆ°é˜Ÿã€è®¢å•ã€é€šä¿¡éƒ½æ²¡æ³•åŒæ­¥è®°å½•ã€‚ å› æ­¤ä¸–ç•Œéœ€è¦ï¼š ä¸€ä¸ª å…¨çƒç»Ÿä¸€ã€ç²¾ç¡®çš„æ ‡å‡†æ—¶é—´ æ‰€æœ‰äººã€æ‰€æœ‰ç³»ç»Ÿéƒ½èƒ½å¯¹é½ä½¿ç”¨ UTC å°±æ˜¯åœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹è¯ç”Ÿçš„ã€‚ äºŒã€UTC æ˜¯ä»€ä¹ˆï¼Ÿ UTC çš„å…¨ç§°ï¼š Coordinated Universal Timeï¼ˆåè°ƒä¸–ç•Œæ—¶ï¼‰ å®ƒæ˜¯å½“ä»Šå…¨çƒä½¿ç”¨çš„ æ ‡å‡†æ—¶é—´ç³»ç»Ÿã€‚ å®ƒçš„ä¸»è¦ç‰¹ç‚¹ï¼š ä¸æ˜¯æŸä¸ªå›½å®¶çš„æ—¶é—´ æ˜¯å›½é™…ç»„ç»‡å…±åŒç»´æŠ¤ å…¨ä¸–ç•Œæ‰€æœ‰æœºæˆ¿ã€é€šä¿¡ã€å«æ˜Ÿã€èˆªç­ã€GPSã€é‡‘èç³»ç»Ÿéƒ½ä»¥å®ƒä¸ºåŸºå‡† ä¸€å¥è¯ï¼š UTC æ˜¯ç°ä»£ä¸–ç•Œå…±åŒä½¿ç”¨çš„â€œä¸–ç•Œæ—¶é—´â€ã€‚ ä¸‰ã€UTC å’Œ GMT çš„å…³ç³» å¾ˆå¤šäººå¬è¿‡ GMTï¼ˆæ ¼æ—å°¼æ²»æ—¶é—´ï¼‰ï¼Œå†å²ä¸Š GMT æ˜¯ä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œåæ¥è¢« UTC å–ä»£ã€‚ é¡¹ç›® GMT UTC å‡ºç°å¹´ä»£ 19 ä¸–çºª 1972 å¹´ åŸºå‡† åœ°çƒè‡ªè½¬ï¼ˆå¤©æ–‡æ—¶é—´ï¼‰ åŸå­é’Ÿï¼ˆæ›´ç²¾ç¡®ï¼‰ æ˜¯å¦ä»æ˜¯æ ‡å‡† å·²è¢«æ›¿ä»£ å½“å‰å”¯ä¸€æ ‡å‡† ä½†åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼š UTC â‰ˆ GMTï¼ˆåŒä¸ºé›¶æ—¶åŒºï¼‰ æ‰€ä»¥ï¼š è‹±å›½å†¬å­£ä½¿ç”¨ GMTï¼ˆUTC+0ï¼‰ æŠ€æœ¯ç³»ç»Ÿä½¿ç”¨ UTCï¼ˆUTC+0ï¼‰ å››ã€UTC æ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ UTC å¹¶ä¸æ˜¯æŒ‰å¤ªé˜³èµ°ï¼Œè€Œæ˜¯ï¼š ç”±å…¨ä¸–ç•Œ åŸå­é’Ÿç½‘ç»œç»Ÿä¸€ç”Ÿæˆ æ¯ç§’è¯¯å·®å°äº åäº¿åˆ†ä¹‹ä¸€ç§’ ç„¶åæ ¹æ®åœ°çƒè‡ªè½¬è¯¯å·®å¶å°”åŠ â€œé—°ç§’â€ ä¾‹å¦‚ï¼š 12016-12-31 23:59:60 UTC â† æ›¾ç»åŠ è¿‡é—°ç§’ è¿™æ ·ï¼š ä¿è¯æ—¶é—´æå…¶å‡†ç¡® åˆä¸ä¼šä¸åœ°çƒçœŸå®æ˜¼å¤œåç¦»å¤ªå¤š äº”ã€UTC ä¸æ—¶åŒº UTC æ˜¯ 0 æ—¶åŒºã€‚ æ‰€æœ‰æ—¶åŒºéƒ½æ˜¯ åœ¨ UTC åŸºç¡€ä¸ŠåŠ å‡åç§»ï¼š åŒ—äº¬æ—¶é—´ï¼šUTC + 8 çº½çº¦æ—¶é—´ï¼šUTC â€“ 5ï¼ˆå†¬å­£ï¼‰æˆ– â€“4ï¼ˆå¤ä»¤æ—¶ï¼‰ æ—¥æœ¬æ—¶é—´ï¼šUTC + 9 æ‰€ä»¥ä½ å¸¸çœ‹åˆ°ï¼š 1UTC+8 æˆ– UTC-5 è¡¨ç¤ºè¯¥åœ°åŒºæ¯” UTC æ—©æˆ–æ™šå¤šå°‘å°æ—¶ã€‚ 1UTC+8 &gt; UTC+0 &gt; UTCâˆ’5 æ¢æˆç”Ÿæ´»è¯­è¨€ï¼š UTC+8ï¼ˆä¾‹å¦‚åŒ—äº¬æ—¶é—´ï¼‰æ¯” UTC æ—© 8 å°æ—¶ UTCâˆ’5ï¼ˆä¾‹å¦‚ç¾å›½ä¸œéƒ¨å†¬ä»¤æ—¶ï¼‰æ¯” UTC æ™š 5 å°æ—¶ ä¸¾ä¾‹ï¼š UTC(å³UTC+0) æ—¶é—´æ˜¯ 12:00 UTC+8 = 20:00ï¼ˆå·²ç»æ™šä¸Šï¼‰ UTCâˆ’5 = 07:00ï¼ˆè¿˜åœ¨æ—©ä¸Šï¼‰ å…­ã€UTC åœ¨è®¡ç®—æœºä¸–ç•Œçš„é‡è¦æ€§ å‡ ä¹æ‰€æœ‰ IT ç³»ç»Ÿéƒ½æ¨èï¼š å­˜å‚¨ç”¨ UTCï¼Œå±•ç¤ºç»™ç”¨æˆ·å†è½¬æ¢æˆå½“åœ°æ—¶åŒºã€‚ åŸå› å¾ˆç®€å•ï¼š å…¨çƒä¸€è‡´ï¼Œä¸ä¼šæ··ä¹± ä¸å—æ—¶åŒºæˆ–å¤ä»¤æ—¶å½±å“ è·¨å›½ç³»ç»Ÿæ—¥å¿—å¯å¯¹é½åˆ†æ ä½ åœ¨æ—¥å¿—é‡Œç»å¸¸è§åˆ°ï¼š 12025-11-20T08:30:00Z ç»“å°¾çš„ Z å°±è¡¨ç¤ºï¼š è¿™æ˜¯ UTC æ—¶é—´ ä¸ƒã€UTCã€GMTã€CST æ€»ç»“å¯¹æ¯” åç§° å…¨ç§° ç°åœ¨åœ°ä½ æ˜¯å¦æ ‡å‡† UTC Coordinated Universal Time å…¨çƒæ ‡å‡† âœ” GMT Greenwich Mean Time è¢« UTC æ›¿ä»£ âœ–ï¼ˆå†å²å«ä¹‰ï¼‰ CST China Standard Timeï¼ˆä¸­å›½ï¼‰æˆ– Central Standard Timeï¼ˆç¾å›½ï¼‰ æœ¬åœ°æ—¶åŒº ä¸æ˜¯ä¸–ç•Œç»Ÿä¸€åŸºå‡† æ³¨æ„ï¼š â€œCSTâ€ æ—¢å¯èƒ½æ˜¯ä¸­å›½åŒºï¼Œä¹Ÿå¯èƒ½æ˜¯ç¾å›½åŒºï¼Œéœ€è¦ç»“åˆ UTC åç§»åˆ¤æ–­ã€‚ å…«ã€ä¸€å¥è¯æ€»ç»“ UTC æ˜¯ç°ä»£å…¨çƒç»Ÿä¸€çš„æ ‡å‡†æ—¶é—´ æ‰€æœ‰æ—¶åŒºéƒ½æ˜¯ç›¸å¯¹äº UTC åç§» è®¡ç®—æœºé¢†åŸŸæ™®éä½¿ç”¨ UTC å­˜å‚¨æ—¶é—´ GMT æ˜¯ UTC çš„å†å²å‰èº« åŒ—äº¬æ—¶é—´ = UTC + 8 åªè¦ç†è§£è¿™å‡ ç‚¹ï¼Œä½ å·²ç»æŒæ¡äº†ä¸–ç•Œæ—¶é—´ä½“ç³»çš„æ ¸å¿ƒã€‚","summary":"æ‘˜è¦ åœ¨ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸å¬åˆ°â€œUTC æ—¶é—´â€â€œåŒ—äº¬æ—¶é—´ UTC+8â€â€œæœåŠ¡å™¨æ—¶é—´æ˜¯ UTCâ€ï¼Œä½†è®¸å¤šäººå¹¶ä¸äº†è§£ UTC åˆ°åº•æ˜¯ä»€ä¹ˆã€‚æœ¬æ–‡å°†ç”¨å°½é‡ç®€å•çš„æ–¹å¼ï¼Œå¸¦ä½ ææ¸…æ¥šç°ä»£ä¸–ç•Œæ‰€ä¾èµ–çš„å…¨çƒé€šç”¨æ—¶é—´æ ‡å‡†â€”â€”UTCã€‚","date_published":"2025-11-20T14:30:05.000Z","tags":["æŠ€æœ¯","UTC","UTC"]},{"id":"https://blog.hanqunfeng.com/2025/10/31/rocketmq-08-acl2.0/","url":"https://blog.hanqunfeng.com/2025/10/31/rocketmq-08-acl2.0/","title":"RocketMQ ACL 2.0","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RocketMQ ACL 2.0 çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/\">RocketMQå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RocketMQ ä» 5.3.0 èµ·å¼•å…¥å®‰å…¨æ€§æ›´é«˜çš„ ACL 2.0ï¼Œ5.3.2 æ˜¯æœ€åä¸€ä¸ªè¿˜æ”¯æŒ ACL 1.0 çš„ç‰ˆæœ¬ï¼Œ5.3.3 ç§»é™¤äº† ACL 1.0ï¼Œå®˜æ–¹å»ºè®®æ‰€æœ‰ä½¿ç”¨ Apache RocketMQ ACL çš„ç”¨æˆ·è¿ç§»åˆ° ACL 2.0ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ACL-2-0-ç®€ä»‹\">ACL 2.0 ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ <a href=\"https://rocketmq.apache.org/zh/\">RocketMQå®˜ç½‘</a> ä¸­æ²¡æœ‰æ‰¾åˆ°å…³äº ACL 2.0 çš„ä»‹ç»ï¼Œä½†æ˜¯æœ‰ä»‹ç» ACL 1.0 çš„ä½¿ç”¨æ–¹æ³•: <a href=\"https://rocketmq.apache.org/zh/docs/bestPractice/03access\">https://rocketmq.apache.org/zh/docs/bestPractice/03access</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨é˜¿é‡Œäº‘ä¸Šæ‰¾åˆ°ä¸€ç¯‡å‚è€ƒèµ„æ–™ï¼š<a href=\"https://developer.aliyun.com/article/1569146\">Apache RocketMQ ACL 2.0 å…¨æ–°å‡çº§</a></p>\n</li>\n</ul>\n<h2 id=\"é…ç½®æ­¥éª¤\">é…ç½®æ­¥éª¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åœ¨ <a href=\"/2025/10/23/rocketmq-01-install/\" title=\"RocketMQ çš„å®‰è£…åŠä½¿ç”¨\">RocketMQ çš„å®‰è£…åŠä½¿ç”¨</a> ä¸­ é›†ç¾¤ å®‰è£…å®Œæˆä¹‹åï¼Œå¼€å§‹é…ç½® ACL 2.0ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨æ‰€æœ‰ Broker çš„é…ç½®æ–‡ä»¶<code>broker.conf</code>ä¸­å¢åŠ è®¤è¯ä¸æˆæƒé…ç½®:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># broker.conf</span></span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯é…ç½®</span></span><br><span class=\"line\">authenticationEnabled = <span class=\"literal\">true</span></span><br><span class=\"line\">authenticationProvider = org.apache.rocketmq.auth.authentication.provider.DefaultAuthenticationProvider</span><br><span class=\"line\">initAuthenticationUser = &#123;<span class=\"string\">&quot;username&quot;</span>:<span class=\"string\">&quot;mqadmin&quot;</span>,<span class=\"string\">&quot;password&quot;</span>:<span class=\"string\">&quot;1234567&quot;</span>&#125;</span><br><span class=\"line\">innerClientAuthenticationCredentials = &#123;<span class=\"string\">&quot;accessKey&quot;</span>:<span class=\"string\">&quot;mqadmin&quot;</span>,<span class=\"string\">&quot;secretKey&quot;</span>:<span class=\"string\">&quot;1234567&quot;</span>&#125;</span><br><span class=\"line\">authenticationMetadataProvider = org.apache.rocketmq.auth.authentication.provider.LocalAuthenticationMetadataProvider</span><br><span class=\"line\"><span class=\"comment\"># æˆæƒé…ç½®</span></span><br><span class=\"line\">authorizationEnabled = <span class=\"literal\">true</span></span><br><span class=\"line\">authorizationProvider = org.apache.rocketmq.auth.authorization.provider.DefaultAuthorizationProvider</span><br><span class=\"line\">authorizationMetadataProvider = org.apache.rocketmq.auth.authorization.provider.LocalAuthorizationMetadataProvider</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°å®šä¹‰</th>\n<th style=\"text-align:left\">å‚æ•°åç§°</th>\n<th style=\"text-align:left\">å‚æ•°æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>authenticationEnabled</strong></td>\n<td style=\"text-align:left\">æ˜¯å¦æ‰“å¼€è®¤è¯å¼€å…³</td>\n<td style=\"text-align:left\">ç”¨äºåˆ¤æ–­è®¤è¯æ˜¯å¦æ‰“å¼€ã€‚<br>å¯é€‰å€¼ï¼š<br>â€¢ <code>true</code> â€“ æ˜¯<br>â€¢ <code>false</code> â€“ å¦</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>authenticationProvider</strong></td>\n<td style=\"text-align:left\">è®¤è¯æ–¹å¼æä¾›è€…</td>\n<td style=\"text-align:left\">ç”¨äºæä¾›è¯·æ±‚è®¿é—®æ—¶çš„è®¤è¯æ–¹å¼ã€‚<br>å¯é€‰å€¼ï¼š<br>â€¢ <code>org.apache.rocketmq.auth.authentication.provider.DefaultAuthenticationProvider</code> â€“ é»˜è®¤çš„è®¤è¯æ–¹å¼</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>initAuthenticationUser</strong></td>\n<td style=\"text-align:left\">ç³»ç»Ÿåˆå§‹åŒ–ç”¨æˆ·</td>\n<td style=\"text-align:left\">ç”¨äºç³»ç»Ÿåˆå§‹åŒ–æ—¶è‡ªåŠ¨åˆ›å»ºçš„ç”¨æˆ·è´¦å·ã€‚<br>ç¤ºä¾‹ï¼š<br><code>&#123;&quot;username&quot;:&quot;rocketmq&quot;,&quot;password&quot;:&quot;12345678&quot;&#125;</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>innerClientAuthenticationCredentials</strong></td>\n<td style=\"text-align:left\">ç»„ä»¶é—´è®¤è¯ç”¨æˆ·</td>\n<td style=\"text-align:left\">ç”¨äºè®¾ç½®é›†ç¾¤å†…ç»„ä»¶ä¹‹é—´çš„è®¿é—®å‡­è¯ã€‚<br>ç¤ºä¾‹ï¼š<br><code>&#123;&quot;accessKey&quot;:&quot;rocketmq&quot;,&quot;secretKey&quot;:&quot;12345678&quot;&#125;</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>authenticationMetadataProvider</strong></td>\n<td style=\"text-align:left\">è®¤è¯å…ƒæ•°æ®æä¾›è€…</td>\n<td style=\"text-align:left\">ç”¨äºæä¾›è®¤è¯ç›¸å…³çš„å…ƒæ•°æ®ï¼ˆå¦‚ç”¨æˆ·ï¼‰ã€‚<br>å¯é€‰å€¼ï¼š<br>â€¢ <code>org.apache.rocketmq.auth.authentication.provider.LocalAuthenticationMetadataProvider</code> â€“ æœ¬åœ°è®¤è¯å…ƒæ•°æ®æä¾›è€…<br>â€¢ <code>org.apache.rocketmq.proxy.auth.ProxyAuthenticationMetadataProvider</code> â€“ Proxyè®¤è¯å…ƒæ•°æ®æä¾›è€…</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>authenticationStrategy</strong></td>\n<td style=\"text-align:left\">è®¤è¯ç­–ç•¥</td>\n<td style=\"text-align:left\">ç”¨äºæŒ‡å®šè¯·æ±‚è®¿é—®æ—¶çš„è®¤è¯ç­–ç•¥ã€‚<br>å¯é€‰å€¼ï¼š<br>â€¢ <code>org.apache.rocketmq.auth.authentication.strategy.StatelessAuthenticationStrategy</code> â€“ æ¯æ¬¡è¯·æ±‚è®¤è¯ç­–ç•¥<br>â€¢ <code>org.apache.rocketmq.auth.authentication.strategy.StatefulAuthenticationStrategy</code> â€“ é¦–æ¬¡è¯·æ±‚è®¤è¯ç­–ç•¥</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯å¯åŠ¨æ‰€æœ‰ Broker</p>\n</li>\n</ul>\n<h2 id=\"å‘½ä»¤è¡Œç®¡ç†ç”¨æˆ·\">å‘½ä»¤è¡Œç®¡ç†ç”¨æˆ·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœ RocketMQ å¼€å¯äº† ACLï¼Œæ— è®ºæ˜¯ ACL 1.0 è¿˜æ˜¯ ACL 2.0ï¼Œéƒ½éœ€è¦åœ¨ <code>conf/tools.yml</code> é…ç½®æ­£ç¡®çš„è´¦å·å¯†ç ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ <code>mqadmin</code> å‘½ä»¤ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">accessKey:</span> <span class=\"string\">mqadmin</span></span><br><span class=\"line\"><span class=\"attr\">secretKey:</span> <span class=\"number\">1234567</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ç”¨æˆ·ç®¡ç†\">ç”¨æˆ·ç®¡ç†</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">æ¥å£å®šä¹‰</th>\n<th style=\"text-align:left\">æ¥å£åç§°</th>\n<th style=\"text-align:left\">æ¥å£å‚æ•°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>createUser</strong></td>\n<td style=\"text-align:left\">åˆ›å»ºç”¨æˆ·</td>\n<td style=\"text-align:left\">-n namesrv åœ°å€<br>-b broker åœ°å€<br>-c é›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-u ç”¨æˆ·åç§°<br>-p ç”¨æˆ·å¯†ç <br>-t ç”¨æˆ·ç±»å‹ï¼ˆSuperã€Normalï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>updateUser</strong></td>\n<td style=\"text-align:left\">æ›´æ–°ç”¨æˆ·</td>\n<td style=\"text-align:left\">-n namesrv åœ°å€<br>-b broker åœ°å€<br>-c é›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-u ç”¨æˆ·åç§°<br>-p ç”¨æˆ·å¯†ç <br>-t ç”¨æˆ·ç±»å‹ï¼ˆSuperã€Normalï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>deleteUser</strong></td>\n<td style=\"text-align:left\">åˆ é™¤ç”¨æˆ·</td>\n<td style=\"text-align:left\">-b broker åœ°å€<br>-c é›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-u ç”¨æˆ·åç§°</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>getUser</strong></td>\n<td style=\"text-align:left\">æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…</td>\n<td style=\"text-align:left\">-n namesrv åœ°å€<br>-b broker åœ°å€<br>-c é›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-u ç”¨æˆ·åç§°</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>listUser</strong></td>\n<td style=\"text-align:left\">æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨</td>\n<td style=\"text-align:left\">-n namesrv åœ°å€<br>-b broker åœ°å€<br>-c é›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-u ç”¨æˆ·åç§°<br>-f è¿‡æ»¤æ¡ä»¶ï¼ˆæ”¯æŒç”¨æˆ·åç§°æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯é€‰ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç”¨æˆ·</span></span><br><span class=\"line\">sh bin/mqadmin createUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq -p rocketmq</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç”¨æˆ·ï¼ŒæŒ‡å®šç”¨æˆ·ç±»å‹</span></span><br><span class=\"line\">sh bin/mqadmin createUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq -p rocketmq -t Super</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°ç”¨æˆ·</span></span><br><span class=\"line\">sh bin/mqadmin updateUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq -p 12345678</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ç”¨æˆ·</span></span><br><span class=\"line\">sh bin/mqadmin deleteUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…</span></span><br><span class=\"line\">sh bin/mqadmin getUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨</span></span><br><span class=\"line\">sh bin/mqadmin listUser -n 127.0.0.1:9876 -c DefaultCluster</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ï¼Œå¸¦è¿‡æ»¤æ¡ä»¶</span></span><br><span class=\"line\">sh bin/mqadmin listUser -n 127.0.0.1:9876 -c DefaultCluster -f mq</span><br></pre></td></tr></table></figure>\n<h3 id=\"æƒé™ç®¡ç†\">æƒé™ç®¡ç†</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç®¡ç†å‘˜(Super)æ‹¥æœ‰æ‰€ä»¥èµ„æºçš„è®¿é—®æƒé™ï¼Œæ™®é€šç”¨æˆ·(Normal)åˆ™åªæœ‰å¯¹åº”èµ„æºç±»å‹çš„è®¿é—®æƒé™ã€‚ä»¥ä¸‹æ˜¯ä¸ºæ™®é€šç”¨æˆ·è®¾ç½®æƒé™çš„å‘½ä»¤ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‘½ä»¤åç§°</th>\n<th style=\"text-align:left\">æ“ä½œå®šä¹‰</th>\n<th style=\"text-align:left\">å‘½ä»¤å‚æ•°åŠè§£é‡Š</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong><code>createAcl</code></strong></td>\n<td style=\"text-align:left\">åˆ›å»ºæˆæƒ</td>\n<td style=\"text-align:left\">-n <strong>127.0.0.1:9876</strong>ï¼šNameServer åœ°å€ï¼ˆå¤šä¸ªä»¥ <code>;</code> åˆ†éš”ï¼‰<br>-b broker åœ°å€<br>-c <strong>DefaultCluster</strong>ï¼šé›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-s <strong>User:rocketmq</strong>ï¼šæˆæƒçš„ç”¨æˆ·ï¼ˆ<code>User:rocketmq</code> è¡¨ç¤ºç»™ç”¨æˆ· <code>rocketmq</code> æˆæƒï¼‰<br>-r <strong>Topic:*,Group:</strong>ï¼šèµ„æºç±»å‹ä¸åç§°ï¼Œ<code>*</code> è¡¨ç¤ºæ‰€æœ‰ Topic å’Œ Group<br>-a <strong>Pub,Sub</strong>ï¼šæˆæƒæ“ä½œç±»å‹ï¼Œ<code>Pub</code> è¡¨ç¤ºå‘å¸ƒæƒé™ï¼Œ<code>Sub</code> è¡¨ç¤ºè®¢é˜…æƒé™<br>-i <strong>192.168.1.0/24</strong>ï¼šæˆæƒçš„ IP åœ°å€èŒƒå›´<br>-d <strong>Allow</strong>ï¼šæˆæƒç±»å‹ï¼Œ<code>Allow</code> å…è®¸ï¼Œ<code>Deny</code> æ‹’ç»</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><code>updateAcl</code></strong></td>\n<td style=\"text-align:left\">æ›´æ–°æˆæƒ</td>\n<td style=\"text-align:left\">-n <strong>127.0.0.1:9876</strong>ï¼šNameServer åœ°å€<br>-b broker åœ°å€<br>-c <strong>DefaultCluster</strong>ï¼šé›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-s <strong>User:rocketmq</strong>ï¼šæˆæƒçš„ç”¨æˆ·<br>-r <strong>Topic:*,Group:</strong>ï¼šèµ„æºç±»å‹ä¸åç§°<br>-a <strong>Pub,Sub</strong>ï¼šæˆæƒæ“ä½œç±»å‹<br>-i <strong>192.168.1.0/24</strong>ï¼šIP åœ°å€èŒƒå›´<br>-d <strong>Deny</strong>ï¼šæˆæƒç±»å‹ï¼Œæ›´æ–°ä¸º <code>Deny</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><code>deleteAcl</code></strong></td>\n<td style=\"text-align:left\">åˆ é™¤æˆæƒ</td>\n<td style=\"text-align:left\">-n <strong>127.0.0.1:9876</strong>ï¼šNameServer åœ°å€<br>-b broker åœ°å€<br>-c <strong>DefaultCluster</strong>ï¼šé›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-s <strong>User:rocketmq</strong>ï¼šæˆæƒçš„ç”¨æˆ·<br>-r <strong>Topic:</strong>ï¼šæŒ‡å®šåˆ é™¤æŸä¸ªèµ„æºï¼ˆå¦‚ Topicï¼‰æˆæƒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><code>listAcl</code></strong></td>\n<td style=\"text-align:left\">æŸ¥è¯¢æˆæƒåˆ—è¡¨</td>\n<td style=\"text-align:left\">-n <strong>127.0.0.1:9876</strong>ï¼šNameServer åœ°å€<br>-b broker åœ°å€<br>-c <strong>DefaultCluster</strong>ï¼šé›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-s <strong>User:rocketmq</strong>ï¼šæˆæƒçš„ç”¨æˆ·<br>-r <strong>Topic:</strong>ï¼šæŒ‡å®šèµ„æºç±»å‹ï¼ˆå¦‚ Topicï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><code>getAcl</code></strong></td>\n<td style=\"text-align:left\">æŸ¥è¯¢æˆæƒè¯¦æƒ…</td>\n<td style=\"text-align:left\">-n <strong>127.0.0.1:9876</strong>ï¼šNameServer åœ°å€<br>-b broker åœ°å€<br>-c <strong>DefaultCluster</strong>ï¼šé›†ç¾¤åç§°<br><strong>æ³¨ï¼š</strong><code>-b</code> å’Œ <code>-c</code> å‚æ•°äºŒé€‰ä¸€<br>-s <strong>User:rocketmq</strong>ï¼šæˆæƒçš„ç”¨æˆ·</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºæˆæƒ</span></span><br><span class=\"line\">sh bin/mqadmin createAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*,Group:* -a Pub,Sub -i 192.168.1.0/24 -d Allow</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°æˆæƒ</span></span><br><span class=\"line\">sh bin/mqadmin updateAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*,Group:* -a Pub,Sub -i 192.168.1.0/24 -d Deny</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æˆæƒ</span></span><br><span class=\"line\">sh bin/mqadmin deleteAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æˆæƒï¼ŒæŒ‡å®šèµ„æº</span></span><br><span class=\"line\">sh bin/mqadmin deleteAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æˆæƒåˆ—è¡¨</span></span><br><span class=\"line\">sh bin/mqadmin listAcl -n 127.0.0.1:9876 -c DefaultCluster</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æˆæƒåˆ—è¡¨ï¼Œå¸¦è¿‡æ»¤æ¡ä»¶</span></span><br><span class=\"line\">sh bin/mqadmin listAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æˆæƒè¯¦æƒ…</span></span><br><span class=\"line\">sh bin/mqadmin getAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq</span><br></pre></td></tr></table></figure>\n<h2 id=\"Dashboard-é…ç½®\">Dashboard é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶åœ¨ Dashboard ä¸­é…ç½®å¥½è®¤è¯ä¿¡æ¯å¹¶é‡å¯ï¼Œå³å¯æ­£å¸¸è®¿é—®RocketMQé›†ç¾¤ï¼Œå¹¶ä¸”æ”¯æŒåœ¨webç«¯é…ç½®ACLè®¤è¯ä¿¡æ¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim run/application.yaml # æŒ‰éœ€æ›¿æ¢é…ç½®</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">rocketmq:</span></span><br><span class=\"line\">  <span class=\"attr\">config:</span></span><br><span class=\"line\">    <span class=\"attr\">namesrvAddrs:</span>                <span class=\"comment\"># å¡«å†™NameServeråœ°å€åˆ—è¡¨</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">10.250</span><span class=\"number\">.0</span><span class=\"number\">.175</span><span class=\"string\">:9876</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">10.250</span><span class=\"number\">.0</span><span class=\"number\">.188</span><span class=\"string\">:9876</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">10.250</span><span class=\"number\">.0</span><span class=\"number\">.131</span><span class=\"string\">:9876</span></span><br><span class=\"line\">    <span class=\"attr\">dataPath:</span> <span class=\"string\">/usr/local/soft/rocketmq/data/dashboard</span> <span class=\"comment\"># Dashboardæ–‡ä»¶ç›®å½•ï¼Œç™»å½•ç”¨æˆ·é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•</span></span><br><span class=\"line\">    <span class=\"attr\">loginRequired:</span> <span class=\"literal\">true</span>  <span class=\"comment\"># æ˜¯å¦éœ€è¦ç™»å½•ï¼Œæ­¤æ—¶éœ€è¦åœ¨ dataPath ä¸‹åˆ›å»º users.properties æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/users.propertiesæ–‡ä»¶</span></span><br><span class=\"line\">    <span class=\"comment\"># å¦‚æœ broker å¼€å¯äº† ACLï¼Œåˆ™éœ€è¦é…ç½® accessKey å’Œ secretKey</span></span><br><span class=\"line\">    <span class=\"attr\">accessKey:</span> <span class=\"string\">mqadmin</span></span><br><span class=\"line\">    <span class=\"attr\">secretKey:</span> <span class=\"number\">1234567</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Proxy-é…ç½®\">Proxy é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Broker å¼€å¯ ACL 2.0 è®¤è¯åï¼Œå³ä½¿åœ¨ä»£ç ä¸­æ·»åŠ äº†ACLè®¤è¯ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œ<a href=\"https://github.com/apache/rocketmq-clients/tree/master/java/client/src/main/java/org/apache/rocketmq/client/java/example\">æ–°ç‰ˆå®¢æˆ·ç«¯(rocketmq-client-java)</a>é€šè¿‡<code>Proxy</code>å‘é€æˆ–è®¢é˜…æ¶ˆæ¯ä¾æ—§ä¼šå¤±è´¥ï¼Œ<a href=\"https://github.com/apache/rocketmq/tree/develop/example\">åŸå®¢æˆ·ç«¯(rocketmq-client)</a>é€šè¿‡<code>Nameserver</code>å‘é€æˆ–è®¢é˜…æ¶ˆæ¯æ­£å¸¸ï¼Œå°šä¸çŸ¥é“è¯¥å¦‚ä½•å®Œç¾è§£å†³ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æŒ‰ç…§è¿™ç¯‡æ–‡ç« <a href=\"https://developer.aliyun.com/article/1569146\">Apache RocketMQ ACL 2.0 å…¨æ–°å‡çº§</a>çš„ä»‹ç»ï¼Œåœ¨æ‰€æœ‰ Proxy çš„é…ç½®æ–‡ä»¶<code>rmq-proxy.json</code>ä¸­å¢åŠ è®¤è¯ä¸æˆæƒé…ç½®ä¾æ—§æ²¡æœ‰è§£å†³è¯¥é—®é¢˜ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;authenticationEnabled&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;authenticationProvider&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;org.apache.rocketmq.auth.authentication.provider.DefaultAuthenticationProvider&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;authenticationMetadataProvider&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;org.apache.rocketmq.proxy.auth.ProxyAuthenticationMetadataProvider&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;innerClientAuthenticationCredentials&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&#123;\\&quot;accessKey\\&quot;:\\&quot;mqadmin\\&quot;, \\&quot;secretKey\\&quot;:\\&quot;1234567\\&quot;&#125;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;authorizationEnabled&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;authorizationProvider&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;org.apache.rocketmq.auth.authorization.provider.DefaultAuthorizationProvider&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;authorizationMetadataProvider&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;org.apache.rocketmq.proxy.auth.ProxyAuthorizationMetadataProvider&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Caused by: org.apache.rocketmq.client.java.exception.UnauthorizedException: [request-id=1b2af952-38d9-4201-bd10-055e442c6b59, response-code=40100] Authentication failed. Please verify the credentials and try again.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹‹åé€šè¿‡è¿™ç¯‡æ–‡ç«  <a href=\"https://blog.zcw159357.com/article/1/2025-03-15-0048.html\">rocketmqéƒ¨ç½²è¸©å‘(äºŒ) aclé…ç½®</a> çš„ä»‹ç»ï¼Œéœ€è¦åœ¨ <code>rmq-proxy.json</code> ä¸­å¢åŠ å¦‚ä¸‹é…ç½®ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;enableAclRpcHookForClusterMode&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®å®Œæˆåï¼Œé‡å¯ Proxyï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯æœç„¶æ²¡é—®é¢˜äº†ï¼Œæ¶ˆè´¹è€…å¯åŠ¨ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å°±æ˜¯æ¥æ”¶ä¸åˆ°ä»»ä½•æ¶ˆæ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¹‹åé€šè¿‡è¿™ç¯‡æ–‡ç«  <a href=\"https://blog.csdn.net/icebamboo2015/article/details/152118732\">å…³äºRocketMq5.3.3å¼€å¯ACL2.0é€šè¿‡proxy8081ç«¯å£åªèƒ½å‘æ¶ˆæ¯ï¼Œä¸èƒ½æ”¶æ¶ˆæ¯é—®é¢˜ç®€å•å¤„ç†</a> çš„è¯´æ˜ï¼Œå°†æ‰€æœ‰ <code>broker.conf</code> ä¸­ <code>authorizationEnabled</code> é…ç½®æ”¹ä¸º <code>false</code>ï¼Œé‡å¯ Brokerï¼Œé—®é¢˜è§£å†³ã€‚</p>\n</li>\n</ul>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¬”è€…æ„Ÿè§‰å½“å‰ RocketMQ çš„ ACL 2.0 è®¤è¯æœºåˆ¶è¿˜å­˜åœ¨ä¸€äº›bugï¼Œå°±è¿å®˜ç½‘ä¹Ÿæ²¡æœ‰æä¾›çš„æ–‡æ¡£è¯´æ˜ï¼Œæš‚æ—¶å…ˆç©ç©å§ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ ACL 2.0 çš„ä½¿ç”¨æ–¹æ³•ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚ RocketMQ ä» 5.3.0 èµ·å¼•å…¥å®‰å…¨æ€§æ›´é«˜çš„ ACL 2.0ï¼Œ5.3.2 æ˜¯æœ€åä¸€ä¸ªè¿˜æ”¯æŒ ACL 1.0 çš„ç‰ˆæœ¬ï¼Œ5.3.3 ç§»é™¤äº† ACL 1.0ï¼Œå®˜æ–¹å»ºè®®æ‰€æœ‰ä½¿ç”¨ Apache RocketMQ ACL çš„ç”¨æˆ·è¿ç§»åˆ° ACL 2.0ã€‚ ACL 2.0 ç®€ä»‹ åœ¨ RocketMQå®˜ç½‘ ä¸­æ²¡æœ‰æ‰¾åˆ°å…³äº ACL 2.0 çš„ä»‹ç»ï¼Œä½†æ˜¯æœ‰ä»‹ç» ACL 1.0 çš„ä½¿ç”¨æ–¹æ³•: https://rocketmq.apache.org/zh/docs/bestPractice/03accessã€‚ åœ¨é˜¿é‡Œäº‘ä¸Šæ‰¾åˆ°ä¸€ç¯‡å‚è€ƒèµ„æ–™ï¼šApache RocketMQ ACL 2.0 å…¨æ–°å‡çº§ é…ç½®æ­¥éª¤ æœ¬æ–‡åœ¨ RocketMQ çš„å®‰è£…åŠä½¿ç”¨ ä¸­ é›†ç¾¤ å®‰è£…å®Œæˆä¹‹åï¼Œå¼€å§‹é…ç½® ACL 2.0ã€‚ åœ¨æ‰€æœ‰ Broker çš„é…ç½®æ–‡ä»¶broker.confä¸­å¢åŠ è®¤è¯ä¸æˆæƒé…ç½®: 1234567891011# broker.conf# è®¤è¯é…ç½®authenticationEnabled = trueauthenticationProvider = org.apache.rocketmq.auth.authentication.provider.DefaultAuthenticationProviderinitAuthenticationUser = &#123;&quot;username&quot;:&quot;mqadmin&quot;,&quot;password&quot;:&quot;1234567&quot;&#125;innerClientAuthenticationCredentials = &#123;&quot;accessKey&quot;:&quot;mqadmin&quot;,&quot;secretKey&quot;:&quot;1234567&quot;&#125;authenticationMetadataProvider = org.apache.rocketmq.auth.authentication.provider.LocalAuthenticationMetadataProvider# æˆæƒé…ç½®authorizationEnabled = trueauthorizationProvider = org.apache.rocketmq.auth.authorization.provider.DefaultAuthorizationProviderauthorizationMetadataProvider = org.apache.rocketmq.auth.authorization.provider.LocalAuthorizationMetadataProvider å‚æ•°å®šä¹‰ å‚æ•°åç§° å‚æ•°æè¿° authenticationEnabled æ˜¯å¦æ‰“å¼€è®¤è¯å¼€å…³ ç”¨äºåˆ¤æ–­è®¤è¯æ˜¯å¦æ‰“å¼€ã€‚å¯é€‰å€¼ï¼šâ€¢ true â€“ æ˜¯â€¢ false â€“ å¦ authenticationProvider è®¤è¯æ–¹å¼æä¾›è€… ç”¨äºæä¾›è¯·æ±‚è®¿é—®æ—¶çš„è®¤è¯æ–¹å¼ã€‚å¯é€‰å€¼ï¼šâ€¢ org.apache.rocketmq.auth.authentication.provider.DefaultAuthenticationProvider â€“ é»˜è®¤çš„è®¤è¯æ–¹å¼ initAuthenticationUser ç³»ç»Ÿåˆå§‹åŒ–ç”¨æˆ· ç”¨äºç³»ç»Ÿåˆå§‹åŒ–æ—¶è‡ªåŠ¨åˆ›å»ºçš„ç”¨æˆ·è´¦å·ã€‚ç¤ºä¾‹ï¼š&#123;&quot;username&quot;:&quot;rocketmq&quot;,&quot;password&quot;:&quot;12345678&quot;&#125; innerClientAuthenticationCredentials ç»„ä»¶é—´è®¤è¯ç”¨æˆ· ç”¨äºè®¾ç½®é›†ç¾¤å†…ç»„ä»¶ä¹‹é—´çš„è®¿é—®å‡­è¯ã€‚ç¤ºä¾‹ï¼š&#123;&quot;accessKey&quot;:&quot;rocketmq&quot;,&quot;secretKey&quot;:&quot;12345678&quot;&#125; authenticationMetadataProvider è®¤è¯å…ƒæ•°æ®æä¾›è€… ç”¨äºæä¾›è®¤è¯ç›¸å…³çš„å…ƒæ•°æ®ï¼ˆå¦‚ç”¨æˆ·ï¼‰ã€‚å¯é€‰å€¼ï¼šâ€¢ org.apache.rocketmq.auth.authentication.provider.LocalAuthenticationMetadataProvider â€“ æœ¬åœ°è®¤è¯å…ƒæ•°æ®æä¾›è€…â€¢ org.apache.rocketmq.proxy.auth.ProxyAuthenticationMetadataProvider â€“ Proxyè®¤è¯å…ƒæ•°æ®æä¾›è€… authenticationStrategy è®¤è¯ç­–ç•¥ ç”¨äºæŒ‡å®šè¯·æ±‚è®¿é—®æ—¶çš„è®¤è¯ç­–ç•¥ã€‚å¯é€‰å€¼ï¼šâ€¢ org.apache.rocketmq.auth.authentication.strategy.StatelessAuthenticationStrategy â€“ æ¯æ¬¡è¯·æ±‚è®¤è¯ç­–ç•¥â€¢ org.apache.rocketmq.auth.authentication.strategy.StatefulAuthenticationStrategy â€“ é¦–æ¬¡è¯·æ±‚è®¤è¯ç­–ç•¥ é‡å¯å¯åŠ¨æ‰€æœ‰ Broker å‘½ä»¤è¡Œç®¡ç†ç”¨æˆ· å¦‚æœ RocketMQ å¼€å¯äº† ACLï¼Œæ— è®ºæ˜¯ ACL 1.0 è¿˜æ˜¯ ACL 2.0ï¼Œéƒ½éœ€è¦åœ¨ conf/tools.yml é…ç½®æ­£ç¡®çš„è´¦å·å¯†ç ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ mqadmin å‘½ä»¤ã€‚ 12accessKey: mqadminsecretKey: 1234567 ç”¨æˆ·ç®¡ç† æ¥å£å®šä¹‰ æ¥å£åç§° æ¥å£å‚æ•° createUser åˆ›å»ºç”¨æˆ· -n namesrv åœ°å€-b broker åœ°å€-c é›†ç¾¤åç§°æ³¨ï¼š-b å’Œ -c å‚æ•°äºŒé€‰ä¸€-u ç”¨æˆ·åç§°-p ç”¨æˆ·å¯†ç -t ç”¨æˆ·ç±»å‹ï¼ˆSuperã€Normalï¼‰ updateUser æ›´æ–°ç”¨æˆ· -n namesrv åœ°å€-b broker åœ°å€-c é›†ç¾¤åç§°æ³¨ï¼š-b å’Œ -c å‚æ•°äºŒé€‰ä¸€-u ç”¨æˆ·åç§°-p ç”¨æˆ·å¯†ç -t ç”¨æˆ·ç±»å‹ï¼ˆSuperã€Normalï¼‰ deleteUser åˆ é™¤ç”¨æˆ· -b broker åœ°å€-c é›†ç¾¤åç§°æ³¨ï¼š-b å’Œ -c å‚æ•°äºŒé€‰ä¸€-u ç”¨æˆ·åç§° getUser æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ… -n namesrv åœ°å€-b broker åœ°å€-c é›†ç¾¤åç§°æ³¨ï¼š-b å’Œ -c å‚æ•°äºŒé€‰ä¸€-u ç”¨æˆ·åç§° listUser æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ -n namesrv åœ°å€-b broker åœ°å€-c é›†ç¾¤åç§°æ³¨ï¼š-b å’Œ -c å‚æ•°äºŒé€‰ä¸€-u ç”¨æˆ·åç§°-f è¿‡æ»¤æ¡ä»¶ï¼ˆæ”¯æŒç”¨æˆ·åç§°æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯é€‰ï¼‰ ç¤ºä¾‹ 1234567891011121314# åˆ›å»ºç”¨æˆ·sh bin/mqadmin createUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq -p rocketmq# åˆ›å»ºç”¨æˆ·ï¼ŒæŒ‡å®šç”¨æˆ·ç±»å‹sh bin/mqadmin createUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq -p rocketmq -t Super# æ›´æ–°ç”¨æˆ·sh bin/mqadmin updateUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq -p 12345678# åˆ é™¤ç”¨æˆ·sh bin/mqadmin deleteUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq# æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…sh bin/mqadmin getUser -n 127.0.0.1:9876 -c DefaultCluster -u rocketmq# æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨sh bin/mqadmin listUser -n 127.0.0.1:9876 -c DefaultCluster# æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ï¼Œå¸¦è¿‡æ»¤æ¡ä»¶sh bin/mqadmin listUser -n 127.0.0.1:9876 -c DefaultCluster -f mq æƒé™ç®¡ç† ç®¡ç†å‘˜(Super)æ‹¥æœ‰æ‰€ä»¥èµ„æºçš„è®¿é—®æƒé™ï¼Œæ™®é€šç”¨æˆ·(Normal)åˆ™åªæœ‰å¯¹åº”èµ„æºç±»å‹çš„è®¿é—®æƒé™ã€‚ä»¥ä¸‹æ˜¯ä¸ºæ™®é€šç”¨æˆ·è®¾ç½®æƒé™çš„å‘½ä»¤ã€‚ å‘½ä»¤åç§° æ“ä½œå®šä¹‰ å‘½ä»¤å‚æ•°åŠè§£é‡Š createAcl åˆ›å»ºæˆæƒ -n 127.0.0.1:9876ï¼šNameServer åœ°å€ï¼ˆå¤šä¸ªä»¥ ; åˆ†éš”ï¼‰-b broker åœ°å€-c DefaultClusterï¼šé›†ç¾¤åç§°æ³¨ï¼š-b å’Œ -c å‚æ•°äºŒé€‰ä¸€-s User:rocketmqï¼šæˆæƒçš„ç”¨æˆ·ï¼ˆUser:rocketmq è¡¨ç¤ºç»™ç”¨æˆ· rocketmq æˆæƒï¼‰-r Topic:*,Group:ï¼šèµ„æºç±»å‹ä¸åç§°ï¼Œ* è¡¨ç¤ºæ‰€æœ‰ Topic å’Œ Group-a Pub,Subï¼šæˆæƒæ“ä½œç±»å‹ï¼ŒPub è¡¨ç¤ºå‘å¸ƒæƒé™ï¼ŒSub è¡¨ç¤ºè®¢é˜…æƒé™-i 192.168.1.0/24ï¼šæˆæƒçš„ IP åœ°å€èŒƒå›´-d Allowï¼šæˆæƒç±»å‹ï¼ŒAllow å…è®¸ï¼ŒDeny æ‹’ç» updateAcl æ›´æ–°æˆæƒ -n 127.0.0.1:9876ï¼šNameServer åœ°å€-b broker åœ°å€-c DefaultClusterï¼šé›†ç¾¤åç§°æ³¨ï¼š-b å’Œ -c å‚æ•°äºŒé€‰ä¸€-s User:rocketmqï¼šæˆæƒçš„ç”¨æˆ·-r Topic:*,Group:ï¼šèµ„æºç±»å‹ä¸åç§°-a Pub,Subï¼šæˆæƒæ“ä½œç±»å‹-i 192.168.1.0/24ï¼šIP åœ°å€èŒƒå›´-d Denyï¼šæˆæƒç±»å‹ï¼Œæ›´æ–°ä¸º Deny deleteAcl åˆ é™¤æˆæƒ -n 127.0.0.1:9876ï¼šNameServer åœ°å€-b broker åœ°å€-c DefaultClusterï¼šé›†ç¾¤åç§°æ³¨ï¼š-b å’Œ -c å‚æ•°äºŒé€‰ä¸€-s User:rocketmqï¼šæˆæƒçš„ç”¨æˆ·-r Topic:ï¼šæŒ‡å®šåˆ é™¤æŸä¸ªèµ„æºï¼ˆå¦‚ Topicï¼‰æˆæƒ listAcl æŸ¥è¯¢æˆæƒåˆ—è¡¨ -n 127.0.0.1:9876ï¼šNameServer åœ°å€-b broker åœ°å€-c DefaultClusterï¼šé›†ç¾¤åç§°æ³¨ï¼š-b å’Œ -c å‚æ•°äºŒé€‰ä¸€-s User:rocketmqï¼šæˆæƒçš„ç”¨æˆ·-r Topic:ï¼šæŒ‡å®šèµ„æºç±»å‹ï¼ˆå¦‚ Topicï¼‰ getAcl æŸ¥è¯¢æˆæƒè¯¦æƒ… -n 127.0.0.1:9876ï¼šNameServer åœ°å€-b broker åœ°å€-c DefaultClusterï¼šé›†ç¾¤åç§°æ³¨ï¼š-b å’Œ -c å‚æ•°äºŒé€‰ä¸€-s User:rocketmqï¼šæˆæƒçš„ç”¨æˆ· ç¤ºä¾‹ 1234567891011121314# åˆ›å»ºæˆæƒsh bin/mqadmin createAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*,Group:* -a Pub,Sub -i 192.168.1.0/24 -d Allow# æ›´æ–°æˆæƒsh bin/mqadmin updateAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*,Group:* -a Pub,Sub -i 192.168.1.0/24 -d Deny# åˆ é™¤æˆæƒsh bin/mqadmin deleteAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq# åˆ é™¤æˆæƒï¼ŒæŒ‡å®šèµ„æºsh bin/mqadmin deleteAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*# æŸ¥è¯¢æˆæƒåˆ—è¡¨sh bin/mqadmin listAcl -n 127.0.0.1:9876 -c DefaultCluster# æŸ¥è¯¢æˆæƒåˆ—è¡¨ï¼Œå¸¦è¿‡æ»¤æ¡ä»¶sh bin/mqadmin listAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq -r Topic:*# æŸ¥è¯¢æˆæƒè¯¦æƒ…sh bin/mqadmin getAcl -n 127.0.0.1:9876 -c DefaultCluster -s User:rocketmq Dashboard é…ç½® æ­¤æ—¶åœ¨ Dashboard ä¸­é…ç½®å¥½è®¤è¯ä¿¡æ¯å¹¶é‡å¯ï¼Œå³å¯æ­£å¸¸è®¿é—®RocketMQé›†ç¾¤ï¼Œå¹¶ä¸”æ”¯æŒåœ¨webç«¯é…ç½®ACLè®¤è¯ä¿¡æ¯ã€‚ 12345678910111213# vim run/application.yaml # æŒ‰éœ€æ›¿æ¢é…ç½®rocketmq: config: namesrvAddrs: # å¡«å†™NameServeråœ°å€åˆ—è¡¨ - 10.250.0.175:9876 - 10.250.0.188:9876 - 10.250.0.131:9876 dataPath: /usr/local/soft/rocketmq/data/dashboard # Dashboardæ–‡ä»¶ç›®å½•ï¼Œç™»å½•ç”¨æˆ·é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½• loginRequired: true # æ˜¯å¦éœ€è¦ç™»å½•ï¼Œæ­¤æ—¶éœ€è¦åœ¨ dataPath ä¸‹åˆ›å»º users.properties æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/users.propertiesæ–‡ä»¶ # å¦‚æœ broker å¼€å¯äº† ACLï¼Œåˆ™éœ€è¦é…ç½® accessKey å’Œ secretKey accessKey: mqadmin secretKey: 1234567 Proxy é…ç½® Broker å¼€å¯ ACL 2.0 è®¤è¯åï¼Œå³ä½¿åœ¨ä»£ç ä¸­æ·»åŠ äº†ACLè®¤è¯ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œæ–°ç‰ˆå®¢æˆ·ç«¯(rocketmq-client-java)é€šè¿‡Proxyå‘é€æˆ–è®¢é˜…æ¶ˆæ¯ä¾æ—§ä¼šå¤±è´¥ï¼ŒåŸå®¢æˆ·ç«¯(rocketmq-client)é€šè¿‡Nameserverå‘é€æˆ–è®¢é˜…æ¶ˆæ¯æ­£å¸¸ï¼Œå°šä¸çŸ¥é“è¯¥å¦‚ä½•å®Œç¾è§£å†³ã€‚ æŒ‰ç…§è¿™ç¯‡æ–‡ç« Apache RocketMQ ACL 2.0 å…¨æ–°å‡çº§çš„ä»‹ç»ï¼Œåœ¨æ‰€æœ‰ Proxy çš„é…ç½®æ–‡ä»¶rmq-proxy.jsonä¸­å¢åŠ è®¤è¯ä¸æˆæƒé…ç½®ä¾æ—§æ²¡æœ‰è§£å†³è¯¥é—®é¢˜ã€‚ 123456789&#123; &quot;authenticationEnabled&quot;: true, &quot;authenticationProvider&quot;: &quot;org.apache.rocketmq.auth.authentication.provider.DefaultAuthenticationProvider&quot;, &quot;authenticationMetadataProvider&quot;: &quot;org.apache.rocketmq.proxy.auth.ProxyAuthenticationMetadataProvider&quot;, &quot;innerClientAuthenticationCredentials&quot;: &quot;&#123;\\&quot;accessKey\\&quot;:\\&quot;mqadmin\\&quot;, \\&quot;secretKey\\&quot;:\\&quot;1234567\\&quot;&#125;&quot;, &quot;authorizationEnabled&quot;: true, &quot;authorizationProvider&quot;: &quot;org.apache.rocketmq.auth.authorization.provider.DefaultAuthorizationProvider&quot;, &quot;authorizationMetadataProvider&quot;: &quot;org.apache.rocketmq.proxy.auth.ProxyAuthorizationMetadataProvider&quot;&#125; å¼‚å¸¸ä¿¡æ¯å¦‚ä¸‹ï¼š 1Caused by: org.apache.rocketmq.client.java.exception.UnauthorizedException: [request-id=1b2af952-38d9-4201-bd10-055e442c6b59, response-code=40100] Authentication failed. Please verify the credentials and try again. ä¹‹åé€šè¿‡è¿™ç¯‡æ–‡ç«  rocketmqéƒ¨ç½²è¸©å‘(äºŒ) aclé…ç½® çš„ä»‹ç»ï¼Œéœ€è¦åœ¨ rmq-proxy.json ä¸­å¢åŠ å¦‚ä¸‹é…ç½®ï¼š 1&quot;enableAclRpcHookForClusterMode&quot;: true é…ç½®å®Œæˆåï¼Œé‡å¯ Proxyï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯æœç„¶æ²¡é—®é¢˜äº†ï¼Œæ¶ˆè´¹è€…å¯åŠ¨ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å°±æ˜¯æ¥æ”¶ä¸åˆ°ä»»ä½•æ¶ˆæ¯ã€‚ ä¹‹åé€šè¿‡è¿™ç¯‡æ–‡ç«  å…³äºRocketMq5.3.3å¼€å¯ACL2.0é€šè¿‡proxy8081ç«¯å£åªèƒ½å‘æ¶ˆæ¯ï¼Œä¸èƒ½æ”¶æ¶ˆæ¯é—®é¢˜ç®€å•å¤„ç† çš„è¯´æ˜ï¼Œå°†æ‰€æœ‰ broker.conf ä¸­ authorizationEnabled é…ç½®æ”¹ä¸º falseï¼Œé‡å¯ Brokerï¼Œé—®é¢˜è§£å†³ã€‚ åè®° ç¬”è€…æ„Ÿè§‰å½“å‰ RocketMQ çš„ ACL 2.0 è®¤è¯æœºåˆ¶è¿˜å­˜åœ¨ä¸€äº›bugï¼Œå°±è¿å®˜ç½‘ä¹Ÿæ²¡æœ‰æä¾›çš„æ–‡æ¡£è¯´æ˜ï¼Œæš‚æ—¶å…ˆç©ç©å§ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ ACL 2.0 çš„ä½¿ç”¨æ–¹æ³•ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚ RocketMQ ä» 5.3.0 èµ·å¼•å…¥å®‰å…¨æ€§æ›´é«˜çš„ ACL 2.0ï¼Œ5.3.2 æ˜¯æœ€åä¸€ä¸ªè¿˜æ”¯æŒ ACL 1.0 çš„ç‰ˆæœ¬ï¼Œ5.3.3 ç§»é™¤äº† ACL 1.0ï¼Œå®˜æ–¹å»ºè®®æ‰€æœ‰ä½¿ç”¨ Apache RocketMQ ACL çš„ç”¨æˆ·è¿ç§»åˆ° ACL 2.0ã€‚","date_published":"2025-10-31T13:40:05.000Z","tags":["æŠ€æœ¯","rocketmq","åˆ†å¸ƒå¼","rocketmq"]},{"id":"https://blog.hanqunfeng.com/2025/10/29/rocketmq-08-acl1.0/","url":"https://blog.hanqunfeng.com/2025/10/29/rocketmq-08-acl1.0/","title":"RocketMQ ACL 1.0","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RocketMQ ACL 1.0 çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/\">RocketMQå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RocketMQ ä» 5.3.0 èµ·å¼•å…¥å®‰å…¨æ€§æ›´é«˜çš„ ACL 2.0ï¼Œ5.3.2 æ˜¯æœ€åä¸€ä¸ªè¿˜æ”¯æŒ ACL 1.0 çš„ç‰ˆæœ¬ï¼Œ5.3.3 ç§»é™¤äº† ACL 1.0ï¼Œå®˜æ–¹å»ºè®®æ‰€æœ‰ä½¿ç”¨ Apache RocketMQ ACL çš„ç”¨æˆ·è¿ç§»åˆ° ACL 2.0ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ACL-1-0-ç®€ä»‹\">ACL 1.0 ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ACLæ§åˆ¶åœ¨å¢å¼ºé›†ç¾¤è®¿é—®æ§åˆ¶å®‰å…¨æ€§çš„åŒæ—¶ä¹Ÿä¼šå¸¦æ¥éƒ¨ç½²æµç¨‹å’Œè¿ç»´ç®¡ç†çš„å¤æ‚åº¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€èˆ¬ä»…å»ºè®®åœ¨ç½‘ç»œç¯å¢ƒä¸å®‰å…¨ã€ä¸šåŠ¡æ•°æ®æ•æ„Ÿã€å¤šéƒ¨é—¨ç§Ÿæˆ·æ··ç”¨çš„åœºæ™¯ä¸‹ä½¿ç”¨ã€‚å¦‚æœç”Ÿäº§é›†ç¾¤æœ¬èº«æ˜¯ç§æœ‰é›†ç¾¤ä¸ä¼šè¢«å¤–éƒ¨éƒ¨é—¨ç§Ÿæˆ·è®¿é—®ï¼Œå¯ä»¥ä¸å¼€å¯ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ACL-1-0-ä½¿ç”¨æ–¹æ³•\">ACL 1.0 ä½¿ç”¨æ–¹æ³•</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åœ¨ <a href=\"/2025/10/23/rocketmq-01-install/\" title=\"RocketMQ çš„å®‰è£…åŠä½¿ç”¨\">RocketMQ çš„å®‰è£…åŠä½¿ç”¨</a> ä¸­ é›†ç¾¤ å®‰è£…å®Œæˆä¹‹åï¼Œå¼€å§‹é…ç½® ACL 1.0ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é¦–å…ˆéœ€è¦åœ¨ Broker èŠ‚ç‚¹å¼€å¯ ACL æƒé™ï¼Œåœ¨ <code>broker.conf</code> æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œå¹¶é‡å¯ Broker</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">aclEnable=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æƒé™é…ç½®æ–‡ä»¶ä¸º <code>conf/plain_acl.yml</code>ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸éœ€è¦ä¿®æ”¹ï¼Œåé¢ä¼šä»‹ç»å¦‚ä½•é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œé…ç½®ï¼Œé»˜è®¤çš„å†…å®¹å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…¨å±€ç™½åå•ï¼Œæ”¯æŒçš„æ ¼å¼ï¼š*;192.168.*.*;192.168.0.1</span></span><br><span class=\"line\"><span class=\"comment\"># ç™½åå•å†…çš„ IP éƒ½å¯ä»¥è®¿é—®ï¼Œæ— éœ€é…ç½®å¸å·</span></span><br><span class=\"line\"><span class=\"attr\">globalWhiteRemoteAddresses:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"number\">10.10</span><span class=\"number\">.103</span><span class=\"string\">.*</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"number\">192.168</span><span class=\"number\">.0</span><span class=\"string\">.*</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…¨å±€ç™½åå•å¤–çš„IP,éœ€è¦è´¦å·è®¿é—®</span></span><br><span class=\"line\"><span class=\"comment\"># è´¦å·é…ç½®ï¼Œæ•°ç»„å½¢å¼</span></span><br><span class=\"line\"><span class=\"attr\">accounts:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">accessKey:</span> <span class=\"string\">RocketMQ</span> <span class=\"comment\"># ç”¨æˆ·å</span></span><br><span class=\"line\">    <span class=\"attr\">secretKey:</span> <span class=\"number\">12345678</span> <span class=\"comment\"># å¯†ç </span></span><br><span class=\"line\">    <span class=\"attr\">whiteRemoteAddress:</span> <span class=\"comment\"># å½“å‰å¸å·çš„ç™½åå•</span></span><br><span class=\"line\">    <span class=\"attr\">admin:</span> <span class=\"literal\">false</span>        <span class=\"comment\"># æ˜¯å¦æ˜¯ç®¡ç†å‘˜</span></span><br><span class=\"line\">    <span class=\"attr\">defaultTopicPerm:</span> <span class=\"string\">DENY</span> <span class=\"comment\"># å½“å‰ç”¨æˆ·å¯¹æœªåœ¨ topicPerms ä¸­æ˜¾å¼å£°æ˜çš„ Topic çš„é»˜è®¤æƒé™:DENY;PUB;SUB;PUB|SUB</span></span><br><span class=\"line\">    <span class=\"attr\">defaultGroupPerm:</span> <span class=\"string\">SUB</span>  <span class=\"comment\"># å½“å‰ç”¨æˆ·å¯¹æœªåœ¨ groupPerms ä¸­æ˜¾å¼å£°æ˜çš„ Consumer Group çš„é»˜è®¤æƒé™:DENY;PUB;SUB;PUB|SUB</span></span><br><span class=\"line\">    <span class=\"attr\">topicPerms:</span>            <span class=\"comment\"># ç‰¹å®šçš„ topic æƒé™</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">topicA=DENY</span>        <span class=\"comment\"># topicName=perm</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">topicB=PUB|SUB</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">topicC=SUB</span></span><br><span class=\"line\">    <span class=\"attr\">groupPerms:</span>            <span class=\"comment\"># ç‰¹å®šçš„ ConsumerGroup æƒé™</span></span><br><span class=\"line\">      <span class=\"comment\"># the group should convert to retry topic</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">groupA=DENY</span>        <span class=\"comment\"># groupName=perm</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">groupB=PUB|SUB</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">groupC=SUB</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">accessKey:</span> <span class=\"string\">rocketmq2</span></span><br><span class=\"line\">    <span class=\"attr\">secretKey:</span> <span class=\"number\">12345678</span></span><br><span class=\"line\">    <span class=\"attr\">whiteRemoteAddress:</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"string\">.*</span></span><br><span class=\"line\">    <span class=\"comment\"># if it is admin, it could access all resources</span></span><br><span class=\"line\">    <span class=\"attr\">admin:</span> <span class=\"literal\">true</span>         <span class=\"comment\"># æ˜¯å¦æ˜¯ç®¡ç†å‘˜,true è¡¨ç¤ºç®¡ç†å‘˜,ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰èµ„æº</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æƒé™å®šä¹‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">æƒé™å€¼</th>\n<th style=\"text-align:left\">å«ä¹‰</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>DENY</strong></td>\n<td style=\"text-align:left\">æ‹’ç»</td>\n<td style=\"text-align:left\">ç¦æ­¢å¯¹è¯¥ Topic çš„ä»»ä½•æ“ä½œï¼ˆæ— è®ºæ˜¯å‘é€è¿˜æ˜¯è®¢é˜…ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>ANY</strong></td>\n<td style=\"text-align:left\">ä»»æ„æƒé™</td>\n<td style=\"text-align:left\">å…·æœ‰å‘å¸ƒï¼ˆPUBï¼‰å’Œè®¢é˜…ï¼ˆSUBï¼‰åŒé‡æƒé™</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>PUB</strong></td>\n<td style=\"text-align:left\">å‘é€æƒé™</td>\n<td style=\"text-align:left\">å…è®¸ç”Ÿäº§è€…å‘è¯¥ Topic å‘é€æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>SUB</strong></td>\n<td style=\"text-align:left\">è®¢é˜…æƒé™</td>\n<td style=\"text-align:left\">å…è®¸æ¶ˆè´¹è€…è®¢é˜…å¹¶æ¶ˆè´¹è¯¥ Topic çš„æ¶ˆæ¯</td>\n</tr>\n</tbody>\n</table>\n<div class=\"tips\">\n<p><em><strong>defaultGroupPerm: SUB</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">è¡¨ç¤ºï¼šé»˜è®¤å…è®¸è¯¥ç”¨æˆ·ä»¥ä»»æ„æ¶ˆè´¹è€…ç»„èº«ä»½å‚ä¸æ¶ˆè´¹ï¼ˆä¸é™åˆ¶ groupï¼‰ï¼Œä½†å‰ææ˜¯è¯¥æ¶ˆè´¹è€…å¯¹ç›®æ ‡ Topic ä¹Ÿå¿…é¡»æ‹¥æœ‰ SUB æƒé™ã€‚</li>\n</ul>\n</div>\n<h3 id=\"å‘½ä»¤è¡Œé…ç½®-ACL\">å‘½ä»¤è¡Œé…ç½® ACL</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœ RocketMQ å¼€å¯äº† ACLï¼Œæ— è®ºæ˜¯ ACL 1.0 è¿˜æ˜¯ ACL 2.0ï¼Œéƒ½éœ€è¦åœ¨ <code>conf/tools.yml</code> é…ç½®æ­£ç¡®çš„è´¦å·å¯†ç ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ <code>mqadmin</code> å‘½ä»¤ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">accessKey:</span> <span class=\"string\">mqadmin</span></span><br><span class=\"line\"><span class=\"attr\">secretKey:</span> <span class=\"number\">1234567</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œåä¼šè‡ªåŠ¨ä¿®æ”¹ <code>conf/plain_acl.yml</code> æ–‡ä»¶</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ·»åŠ ç™½åå•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/mqadmin updateGlobalWhiteAddr \\</span><br><span class=\"line\">    -n 127.0.0.1:9876 \\</span><br><span class=\"line\">    -c DefaultCluster \\</span><br><span class=\"line\">    -g 10.250.0.*,10.252.*.*,10.20.0.31</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°</th>\n<th style=\"text-align:left\">æ˜¯å¦å¿…å¡«</th>\n<th style=\"text-align:left\">å«ä¹‰</th>\n<th style=\"text-align:left\">ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>-b</code></td>\n<td style=\"text-align:left\">äºŒé€‰ä¸€å¿…å¡«</td>\n<td style=\"text-align:left\">æŒ‡å®šè¦æ›´æ–°ç™½åå•çš„ <strong>Broker åœ°å€</strong></td>\n<td style=\"text-align:left\"><code>127.0.0.1:10911</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-c</code></td>\n<td style=\"text-align:left\">äºŒé€‰ä¸€å¿…å¡«</td>\n<td style=\"text-align:left\">æŒ‡å®šè¦æ›´æ–°ç™½åå•çš„ <strong>Cluster åç§°</strong>ï¼Œé›†ç¾¤å†…æ‰€æœ‰ Broker éƒ½ä¼šè¢«æ›´æ–°</td>\n<td style=\"text-align:left\"><code>DefaultCluster</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-g</code></td>\n<td style=\"text-align:left\">âœ… å¿…å¡«</td>\n<td style=\"text-align:left\">è¦è®¾ç½®çš„å…¨å±€ç™½åå•åœ°å€åˆ—è¡¨ï¼Œæ”¯æŒé€šé…ç¬¦</td>\n<td style=\"text-align:left\"><code>&quot;10.10.103.*,192.168.0.*&quot;</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-n</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\">NameServer åœ°å€</td>\n<td style=\"text-align:left\"><code>127.0.0.1:9876</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-p</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\">æŒ‡å®š ACL é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆBroker ç«¯å¯¹åº”çš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼‰</td>\n<td style=\"text-align:left\"><code>/home/rocketmq/conf/plain_acl.yml</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-h</code></td>\n<td style=\"text-align:left\">å¦</td>\n<td style=\"text-align:left\">æ‰“å°å¸®åŠ©ä¿¡æ¯</td>\n<td style=\"text-align:left\">â€”</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºæˆ–æ›´æ–°ç”¨æˆ·ï¼ŒaccessKey å’Œ secretKey çš„é•¿åº¦å¿…é¡»å¤§äº 6 ä½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç®¡ç†å‘˜</span></span><br><span class=\"line\">sh bin/mqadmin updateAclConfig \\</span><br><span class=\"line\">    -n 127.0.0.1:9876 \\</span><br><span class=\"line\">    -c DefaultCluster \\</span><br><span class=\"line\">    -a mqadmin \\</span><br><span class=\"line\">    -s 1234567 \\</span><br><span class=\"line\">    -m <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºæ™®é€šç”¨æˆ·</span></span><br><span class=\"line\">sh bin/mqadmin updateAclConfig \\</span><br><span class=\"line\">  -c DefaultCluster \\</span><br><span class=\"line\">  -a rocketmq_user \\</span><br><span class=\"line\">  -s 12345678 \\</span><br><span class=\"line\">  -i <span class=\"string\">&quot;PUB|SUB&quot;</span> \\</span><br><span class=\"line\">  -u SUB \\</span><br><span class=\"line\">  -t <span class=\"string\">&quot;topicA=PUB|SUB,topicB=DENY&quot;</span> \\</span><br><span class=\"line\">  -g <span class=\"string\">&quot;groupA=SUB,groupB=DENY&quot;</span> \\</span><br><span class=\"line\">  -w <span class=\"string\">&quot;192.168.0.*&quot;</span> \\</span><br><span class=\"line\">  -n 127.0.0.1:9876</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°</th>\n<th style=\"text-align:left\">æ˜¯å¦å¿…å¡«</th>\n<th style=\"text-align:left\">å«ä¹‰</th>\n<th style=\"text-align:left\">ç¤ºä¾‹</th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>-a</code></td>\n<td style=\"text-align:left\">âœ… å¿…å¡«</td>\n<td style=\"text-align:left\">ç”¨æˆ·åï¼ˆaccessKeyï¼‰</td>\n<td style=\"text-align:left\"><code>rocketmq_user</code></td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-s</code></td>\n<td style=\"text-align:left\">âœ… å¿…å¡«</td>\n<td style=\"text-align:left\">å¯†ç ï¼ˆsecretKeyï¼‰</td>\n<td style=\"text-align:left\"><code>12345678</code></td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-b</code></td>\n<td style=\"text-align:left\">äºŒé€‰ä¸€</td>\n<td style=\"text-align:left\">æŒ‡å®šç›®æ ‡ Broker åœ°å€</td>\n<td style=\"text-align:left\"><code>127.0.0.1:10911</code></td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-c</code></td>\n<td style=\"text-align:left\">äºŒé€‰ä¸€</td>\n<td style=\"text-align:left\">æŒ‡å®šç›®æ ‡é›†ç¾¤åç§°ï¼Œé›†ç¾¤ä¸­æ‰€æœ‰ Broker éƒ½ä¼šè¢«æ›´æ–°</td>\n<td style=\"text-align:left\"><code>DefaultCluster</code></td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-g</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\">æŒ‡å®š Group æƒé™åˆ—è¡¨</td>\n<td style=\"text-align:left\"><code>groupA=SUB,groupB=DENY</code></td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-t</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\">æŒ‡å®š Topic æƒé™åˆ—è¡¨</td>\n<td style=\"text-align:left\">`topicA=PUB</td>\n<td>SUB,topicB=DENY`</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-u</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\">è®¾ç½®é»˜è®¤ Group æƒé™</td>\n<td style=\"text-align:left\"><code>SUB</code></td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-i</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\">è®¾ç½®é»˜è®¤ Topic æƒé™</td>\n<td style=\"text-align:left\"><code>DENY</code></td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-w</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\">è®¾ç½® IP ç™½åå•</td>\n<td style=\"text-align:left\"><code>&quot;10.10.10.*,192.168.1.*&quot;</code></td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-m</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\">æ˜¯å¦è®¾ç½®ä¸ºç®¡ç†å‘˜è´¦å·</td>\n<td style=\"text-align:left\"><code>true</code> æˆ– <code>false</code></td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-n</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\">æŒ‡å®š NameServer åœ°å€</td>\n<td style=\"text-align:left\"><code>127.0.0.1:9876</code></td>\n<td></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-h</code></td>\n<td style=\"text-align:left\">å¦</td>\n<td style=\"text-align:left\">æ‰“å°å¸®åŠ©ä¿¡æ¯</td>\n<td style=\"text-align:left\">â€”</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ç”¨æˆ·</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/mqadmin deleteAccessConfig \\</span><br><span class=\"line\">    -n 127.0.0.1:9876 \\</span><br><span class=\"line\">    -c DefaultCluster \\</span><br><span class=\"line\">    -a mqadmin</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°</th>\n<th style=\"text-align:left\">æ˜¯å¦å¿…å¡«</th>\n<th style=\"text-align:left\">å«ä¹‰</th>\n<th style=\"text-align:left\">ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>-a</code></td>\n<td style=\"text-align:left\">âœ… å¿…å¡«</td>\n<td style=\"text-align:left\">è¦åˆ é™¤çš„ç”¨æˆ·åï¼ˆaccessKeyï¼‰</td>\n<td style=\"text-align:left\"><code>rocketmq_user</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-b</code></td>\n<td style=\"text-align:left\">äºŒé€‰ä¸€</td>\n<td style=\"text-align:left\">æŒ‡å®šç›®æ ‡ Broker åœ°å€</td>\n<td style=\"text-align:left\"><code>127.0.0.1:10911</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-c</code></td>\n<td style=\"text-align:left\">äºŒé€‰ä¸€</td>\n<td style=\"text-align:left\">æŒ‡å®šç›®æ ‡é›†ç¾¤åç§°ï¼ˆåˆ é™¤æ•´ä¸ªé›†ç¾¤ä¸Šçš„è¯¥è´¦å·ï¼‰</td>\n<td style=\"text-align:left\"><code>DefaultCluster</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-n</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\">æŒ‡å®š NameServer åœ°å€</td>\n<td style=\"text-align:left\"><code>127.0.0.1:9876</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-h</code></td>\n<td style=\"text-align:left\">å¦</td>\n<td style=\"text-align:left\">æ‰“å°å¸®åŠ©ä¿¡æ¯</td>\n<td style=\"text-align:left\">â€”</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Dashboard-é…ç½®\">Dashboard é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶åœ¨ Dashboard ä¸­é…ç½®å¥½è®¤è¯ä¿¡æ¯å¹¶é‡å¯ï¼Œå³å¯æ­£å¸¸è®¿é—®RocketMQé›†ç¾¤ï¼Œä½†æ˜¯å¹¶ä¸æ”¯æŒåœ¨webç«¯é…ç½®ACLè®¤è¯ä¿¡æ¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim run/application.yaml # æŒ‰éœ€æ›¿æ¢é…ç½®</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">rocketmq:</span></span><br><span class=\"line\">  <span class=\"attr\">config:</span></span><br><span class=\"line\">    <span class=\"attr\">namesrvAddrs:</span>                <span class=\"comment\"># å¡«å†™NameServeråœ°å€åˆ—è¡¨</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">10.250</span><span class=\"number\">.0</span><span class=\"number\">.175</span><span class=\"string\">:9876</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">10.250</span><span class=\"number\">.0</span><span class=\"number\">.188</span><span class=\"string\">:9876</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">10.250</span><span class=\"number\">.0</span><span class=\"number\">.131</span><span class=\"string\">:9876</span></span><br><span class=\"line\">    <span class=\"attr\">dataPath:</span> <span class=\"string\">/usr/local/soft/rocketmq/data/dashboard</span> <span class=\"comment\"># Dashboardæ–‡ä»¶ç›®å½•ï¼Œç™»å½•ç”¨æˆ·é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•</span></span><br><span class=\"line\">    <span class=\"attr\">loginRequired:</span> <span class=\"literal\">true</span>  <span class=\"comment\"># æ˜¯å¦éœ€è¦ç™»å½•ï¼Œæ­¤æ—¶éœ€è¦åœ¨ dataPath ä¸‹åˆ›å»º users.properties æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/users.propertiesæ–‡ä»¶</span></span><br><span class=\"line\">    <span class=\"comment\"># å¦‚æœ broker å¼€å¯äº† ACLï¼Œåˆ™éœ€è¦é…ç½® accessKey å’Œ secretKey</span></span><br><span class=\"line\">    <span class=\"attr\">accessKey:</span> <span class=\"string\">mqadmin</span></span><br><span class=\"line\">    <span class=\"attr\">secretKey:</span> <span class=\"number\">1234567</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"Proxy-é…ç½®\">Proxy é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Broker å¼€å¯ ACL 1.0 è®¤è¯åï¼Œå³ä½¿åœ¨ä»£ç ä¸­æ·»åŠ äº†ACLè®¤è¯ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œ<a href=\"https://github.com/apache/rocketmq-clients/tree/master/java/client/src/main/java/org/apache/rocketmq/client/java/example\">æ–°ç‰ˆå®¢æˆ·ç«¯(rocketmq-client-java)</a>é€šè¿‡<code>Proxy</code>å‘é€æˆ–è®¢é˜…æ¶ˆæ¯ä¾æ—§ä¼šå¤±è´¥ï¼Œ<a href=\"https://github.com/apache/rocketmq/tree/develop/example\">åŸå®¢æˆ·ç«¯(rocketmq-client)</a>é€šè¿‡<code>Nameserver</code>å‘é€æˆ–è®¢é˜…æ¶ˆæ¯æ­£å¸¸ï¼Œå°šä¸çŸ¥é“è¯¥å¦‚ä½•å®Œç¾è§£å†³ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ç›®å‰æœ‰ä¸¤ç§æ²¡ä»€ä¹ˆæ„ä¹‰çš„è§£å†³æ–¹æ³•ï¼š\">ç›®å‰æœ‰ä¸¤ç§æ²¡ä»€ä¹ˆæ„ä¹‰çš„è§£å†³æ–¹æ³•ï¼š</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol>\n<li class=\"lvl-5\">å°† Proxy IP æ·»åŠ åˆ°ç™½åå•ï¼Œå› ä¸ºå®¢æˆ·ç«¯è¿æ¥Proxyåï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯ç”±Proxyè½¬å‘ï¼Œæ‰€ä»¥å°†Proxy IPæ·»åŠ åˆ°ç™½åå•å³å¯å…äºè®¤è¯ï¼Œè¯¥æ–¹æ³•æ— éœ€é‡å¯å³å¯ç”Ÿæ•ˆ</li>\n</ol>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/mqadmin updateGlobalWhiteAddr \\</span><br><span class=\"line\">    -n 127.0.0.1:9876 \\</span><br><span class=\"line\">    -c DefaultCluster \\</span><br><span class=\"line\">    -g 10.250.0.*</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"2\">\n<li class=\"lvl-5\">ä¸º Proxy å¼€å¯ <code>enableAclRpcHookForClusterMode</code></li>\n</ol>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä¿®æ”¹<code>conf/rmq-proxy.json</code>æ–‡ä»¶ï¼Œæ·»åŠ <code>enableAclRpcHookForClusterMode</code>å‚æ•°</li>\n</ul>\n  <figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;enableAclRpcHookForClusterMode&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä¿®æ”¹<code>conf/tools.yml</code>æ–‡ä»¶ï¼Œé…ç½®å¸å·ä¿¡æ¯ï¼š</li>\n</ul>\n  <figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">accessKey:</span> <span class=\"string\">mqadmin</span></span><br><span class=\"line\"><span class=\"attr\">secretKey:</span> <span class=\"number\">1234567</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">é‡æ–°å¯åŠ¨Proxyå³å¯</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸¤ç§æ–¹æ³•ï¼Œå®¢æˆ·ç«¯ä»£ç éƒ½ä¸éœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œç”šè‡³ä¸éœ€è¦æ·»åŠ ACLè®¤è¯ä¿¡æ¯</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½†è¿™æ ·åšæ²¡å•¥æ„ä¹‰ï¼Œproxyä¹Ÿå¯ä»¥é…ç½®aclï¼Œä½†æ˜¯æ²¡ææ‡‚å¦‚ä½•é…ç½®</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ ACL 1.0 çš„ä½¿ç”¨æ–¹æ³•ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚ RocketMQ ä» 5.3.0 èµ·å¼•å…¥å®‰å…¨æ€§æ›´é«˜çš„ ACL 2.0ï¼Œ5.3.2 æ˜¯æœ€åä¸€ä¸ªè¿˜æ”¯æŒ ACL 1.0 çš„ç‰ˆæœ¬ï¼Œ5.3.3 ç§»é™¤äº† ACL 1.0ï¼Œå®˜æ–¹å»ºè®®æ‰€æœ‰ä½¿ç”¨ Apache RocketMQ ACL çš„ç”¨æˆ·è¿ç§»åˆ° ACL 2.0ã€‚ ACL 1.0 ç®€ä»‹ ACLæ§åˆ¶åœ¨å¢å¼ºé›†ç¾¤è®¿é—®æ§åˆ¶å®‰å…¨æ€§çš„åŒæ—¶ä¹Ÿä¼šå¸¦æ¥éƒ¨ç½²æµç¨‹å’Œè¿ç»´ç®¡ç†çš„å¤æ‚åº¦ã€‚ ä¸€èˆ¬ä»…å»ºè®®åœ¨ç½‘ç»œç¯å¢ƒä¸å®‰å…¨ã€ä¸šåŠ¡æ•°æ®æ•æ„Ÿã€å¤šéƒ¨é—¨ç§Ÿæˆ·æ··ç”¨çš„åœºæ™¯ä¸‹ä½¿ç”¨ã€‚å¦‚æœç”Ÿäº§é›†ç¾¤æœ¬èº«æ˜¯ç§æœ‰é›†ç¾¤ä¸ä¼šè¢«å¤–éƒ¨éƒ¨é—¨ç§Ÿæˆ·è®¿é—®ï¼Œå¯ä»¥ä¸å¼€å¯ã€‚ ACL 1.0 ä½¿ç”¨æ–¹æ³• æœ¬æ–‡åœ¨ RocketMQ çš„å®‰è£…åŠä½¿ç”¨ ä¸­ é›†ç¾¤ å®‰è£…å®Œæˆä¹‹åï¼Œå¼€å§‹é…ç½® ACL 1.0ã€‚ é¦–å…ˆéœ€è¦åœ¨ Broker èŠ‚ç‚¹å¼€å¯ ACL æƒé™ï¼Œåœ¨ broker.conf æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œå¹¶é‡å¯ Broker 1aclEnable=true æƒé™é…ç½®æ–‡ä»¶ä¸º conf/plain_acl.ymlï¼Œè¿™ä¸ªæ–‡ä»¶ä¸éœ€è¦ä¿®æ”¹ï¼Œåé¢ä¼šä»‹ç»å¦‚ä½•é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œé…ç½®ï¼Œé»˜è®¤çš„å†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930# å…¨å±€ç™½åå•ï¼Œæ”¯æŒçš„æ ¼å¼ï¼š*;192.168.*.*;192.168.0.1# ç™½åå•å†…çš„ IP éƒ½å¯ä»¥è®¿é—®ï¼Œæ— éœ€é…ç½®å¸å·globalWhiteRemoteAddresses: - 10.10.103.* - 192.168.0.*# å…¨å±€ç™½åå•å¤–çš„IP,éœ€è¦è´¦å·è®¿é—®# è´¦å·é…ç½®ï¼Œæ•°ç»„å½¢å¼accounts: - accessKey: RocketMQ # ç”¨æˆ·å secretKey: 12345678 # å¯†ç  whiteRemoteAddress: # å½“å‰å¸å·çš„ç™½åå• admin: false # æ˜¯å¦æ˜¯ç®¡ç†å‘˜ defaultTopicPerm: DENY # å½“å‰ç”¨æˆ·å¯¹æœªåœ¨ topicPerms ä¸­æ˜¾å¼å£°æ˜çš„ Topic çš„é»˜è®¤æƒé™:DENY;PUB;SUB;PUB|SUB defaultGroupPerm: SUB # å½“å‰ç”¨æˆ·å¯¹æœªåœ¨ groupPerms ä¸­æ˜¾å¼å£°æ˜çš„ Consumer Group çš„é»˜è®¤æƒé™:DENY;PUB;SUB;PUB|SUB topicPerms: # ç‰¹å®šçš„ topic æƒé™ - topicA=DENY # topicName=perm - topicB=PUB|SUB - topicC=SUB groupPerms: # ç‰¹å®šçš„ ConsumerGroup æƒé™ # the group should convert to retry topic - groupA=DENY # groupName=perm - groupB=PUB|SUB - groupC=SUB - accessKey: rocketmq2 secretKey: 12345678 whiteRemoteAddress: 192.168.1.* # if it is admin, it could access all resources admin: true # æ˜¯å¦æ˜¯ç®¡ç†å‘˜,true è¡¨ç¤ºç®¡ç†å‘˜,ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰èµ„æº æƒé™å®šä¹‰ æƒé™å€¼ å«ä¹‰ è¯´æ˜ DENY æ‹’ç» ç¦æ­¢å¯¹è¯¥ Topic çš„ä»»ä½•æ“ä½œï¼ˆæ— è®ºæ˜¯å‘é€è¿˜æ˜¯è®¢é˜…ï¼‰ ANY ä»»æ„æƒé™ å…·æœ‰å‘å¸ƒï¼ˆPUBï¼‰å’Œè®¢é˜…ï¼ˆSUBï¼‰åŒé‡æƒé™ PUB å‘é€æƒé™ å…è®¸ç”Ÿäº§è€…å‘è¯¥ Topic å‘é€æ¶ˆæ¯ SUB è®¢é˜…æƒé™ å…è®¸æ¶ˆè´¹è€…è®¢é˜…å¹¶æ¶ˆè´¹è¯¥ Topic çš„æ¶ˆæ¯ defaultGroupPerm: SUB è¡¨ç¤ºï¼šé»˜è®¤å…è®¸è¯¥ç”¨æˆ·ä»¥ä»»æ„æ¶ˆè´¹è€…ç»„èº«ä»½å‚ä¸æ¶ˆè´¹ï¼ˆä¸é™åˆ¶ groupï¼‰ï¼Œä½†å‰ææ˜¯è¯¥æ¶ˆè´¹è€…å¯¹ç›®æ ‡ Topic ä¹Ÿå¿…é¡»æ‹¥æœ‰ SUB æƒé™ã€‚ å‘½ä»¤è¡Œé…ç½® ACL å¦‚æœ RocketMQ å¼€å¯äº† ACLï¼Œæ— è®ºæ˜¯ ACL 1.0 è¿˜æ˜¯ ACL 2.0ï¼Œéƒ½éœ€è¦åœ¨ conf/tools.yml é…ç½®æ­£ç¡®çš„è´¦å·å¯†ç ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ mqadmin å‘½ä»¤ã€‚ 12accessKey: mqadminsecretKey: 1234567 ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œåä¼šè‡ªåŠ¨ä¿®æ”¹ conf/plain_acl.yml æ–‡ä»¶ æ·»åŠ ç™½åå• 1234sh bin/mqadmin updateGlobalWhiteAddr \\ -n 127.0.0.1:9876 \\ -c DefaultCluster \\ -g 10.250.0.*,10.252.*.*,10.20.0.31 å‚æ•° æ˜¯å¦å¿…å¡« å«ä¹‰ ç¤ºä¾‹ -b äºŒé€‰ä¸€å¿…å¡« æŒ‡å®šè¦æ›´æ–°ç™½åå•çš„ Broker åœ°å€ 127.0.0.1:10911 -c äºŒé€‰ä¸€å¿…å¡« æŒ‡å®šè¦æ›´æ–°ç™½åå•çš„ Cluster åç§°ï¼Œé›†ç¾¤å†…æ‰€æœ‰ Broker éƒ½ä¼šè¢«æ›´æ–° DefaultCluster -g âœ… å¿…å¡« è¦è®¾ç½®çš„å…¨å±€ç™½åå•åœ°å€åˆ—è¡¨ï¼Œæ”¯æŒé€šé…ç¬¦ &quot;10.10.103.*,192.168.0.*&quot; -n å¯é€‰ NameServer åœ°å€ 127.0.0.1:9876 -p å¯é€‰ æŒ‡å®š ACL é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆBroker ç«¯å¯¹åº”çš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼‰ /home/rocketmq/conf/plain_acl.yml -h å¦ æ‰“å°å¸®åŠ©ä¿¡æ¯ â€” åˆ›å»ºæˆ–æ›´æ–°ç”¨æˆ·ï¼ŒaccessKey å’Œ secretKey çš„é•¿åº¦å¿…é¡»å¤§äº 6 ä½ 1234567891011121314151617181920# åˆ›å»ºç®¡ç†å‘˜sh bin/mqadmin updateAclConfig \\ -n 127.0.0.1:9876 \\ -c DefaultCluster \\ -a mqadmin \\ -s 1234567 \\ -m true# åˆ›å»ºæ™®é€šç”¨æˆ·sh bin/mqadmin updateAclConfig \\ -c DefaultCluster \\ -a rocketmq_user \\ -s 12345678 \\ -i &quot;PUB|SUB&quot; \\ -u SUB \\ -t &quot;topicA=PUB|SUB,topicB=DENY&quot; \\ -g &quot;groupA=SUB,groupB=DENY&quot; \\ -w &quot;192.168.0.*&quot; \\ -n 127.0.0.1:9876 å‚æ•° æ˜¯å¦å¿…å¡« å«ä¹‰ ç¤ºä¾‹ -a âœ… å¿…å¡« ç”¨æˆ·åï¼ˆaccessKeyï¼‰ rocketmq_user -s âœ… å¿…å¡« å¯†ç ï¼ˆsecretKeyï¼‰ 12345678 -b äºŒé€‰ä¸€ æŒ‡å®šç›®æ ‡ Broker åœ°å€ 127.0.0.1:10911 -c äºŒé€‰ä¸€ æŒ‡å®šç›®æ ‡é›†ç¾¤åç§°ï¼Œé›†ç¾¤ä¸­æ‰€æœ‰ Broker éƒ½ä¼šè¢«æ›´æ–° DefaultCluster -g å¯é€‰ æŒ‡å®š Group æƒé™åˆ—è¡¨ groupA=SUB,groupB=DENY -t å¯é€‰ æŒ‡å®š Topic æƒé™åˆ—è¡¨ `topicA=PUB SUB,topicB=DENY` -u å¯é€‰ è®¾ç½®é»˜è®¤ Group æƒé™ SUB -i å¯é€‰ è®¾ç½®é»˜è®¤ Topic æƒé™ DENY -w å¯é€‰ è®¾ç½® IP ç™½åå• &quot;10.10.10.*,192.168.1.*&quot; -m å¯é€‰ æ˜¯å¦è®¾ç½®ä¸ºç®¡ç†å‘˜è´¦å· true æˆ– false -n å¯é€‰ æŒ‡å®š NameServer åœ°å€ 127.0.0.1:9876 -h å¦ æ‰“å°å¸®åŠ©ä¿¡æ¯ â€” åˆ é™¤ç”¨æˆ· 1234sh bin/mqadmin deleteAccessConfig \\ -n 127.0.0.1:9876 \\ -c DefaultCluster \\ -a mqadmin å‚æ•° æ˜¯å¦å¿…å¡« å«ä¹‰ ç¤ºä¾‹ -a âœ… å¿…å¡« è¦åˆ é™¤çš„ç”¨æˆ·åï¼ˆaccessKeyï¼‰ rocketmq_user -b äºŒé€‰ä¸€ æŒ‡å®šç›®æ ‡ Broker åœ°å€ 127.0.0.1:10911 -c äºŒé€‰ä¸€ æŒ‡å®šç›®æ ‡é›†ç¾¤åç§°ï¼ˆåˆ é™¤æ•´ä¸ªé›†ç¾¤ä¸Šçš„è¯¥è´¦å·ï¼‰ DefaultCluster -n å¯é€‰ æŒ‡å®š NameServer åœ°å€ 127.0.0.1:9876 -h å¦ æ‰“å°å¸®åŠ©ä¿¡æ¯ â€” Dashboard é…ç½® æ­¤æ—¶åœ¨ Dashboard ä¸­é…ç½®å¥½è®¤è¯ä¿¡æ¯å¹¶é‡å¯ï¼Œå³å¯æ­£å¸¸è®¿é—®RocketMQé›†ç¾¤ï¼Œä½†æ˜¯å¹¶ä¸æ”¯æŒåœ¨webç«¯é…ç½®ACLè®¤è¯ä¿¡æ¯ã€‚ 1234567891011121314# vim run/application.yaml # æŒ‰éœ€æ›¿æ¢é…ç½®rocketmq: config: namesrvAddrs: # å¡«å†™NameServeråœ°å€åˆ—è¡¨ - 10.250.0.175:9876 - 10.250.0.188:9876 - 10.250.0.131:9876 dataPath: /usr/local/soft/rocketmq/data/dashboard # Dashboardæ–‡ä»¶ç›®å½•ï¼Œç™»å½•ç”¨æˆ·é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½• loginRequired: true # æ˜¯å¦éœ€è¦ç™»å½•ï¼Œæ­¤æ—¶éœ€è¦åœ¨ dataPath ä¸‹åˆ›å»º users.properties æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/users.propertiesæ–‡ä»¶ # å¦‚æœ broker å¼€å¯äº† ACLï¼Œåˆ™éœ€è¦é…ç½® accessKey å’Œ secretKey accessKey: mqadmin secretKey: 1234567 Proxy é…ç½® Broker å¼€å¯ ACL 1.0 è®¤è¯åï¼Œå³ä½¿åœ¨ä»£ç ä¸­æ·»åŠ äº†ACLè®¤è¯ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œæ–°ç‰ˆå®¢æˆ·ç«¯(rocketmq-client-java)é€šè¿‡Proxyå‘é€æˆ–è®¢é˜…æ¶ˆæ¯ä¾æ—§ä¼šå¤±è´¥ï¼ŒåŸå®¢æˆ·ç«¯(rocketmq-client)é€šè¿‡Nameserverå‘é€æˆ–è®¢é˜…æ¶ˆæ¯æ­£å¸¸ï¼Œå°šä¸çŸ¥é“è¯¥å¦‚ä½•å®Œç¾è§£å†³ã€‚ ç›®å‰æœ‰ä¸¤ç§æ²¡ä»€ä¹ˆæ„ä¹‰çš„è§£å†³æ–¹æ³•ï¼š å°† Proxy IP æ·»åŠ åˆ°ç™½åå•ï¼Œå› ä¸ºå®¢æˆ·ç«¯è¿æ¥Proxyåï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯ç”±Proxyè½¬å‘ï¼Œæ‰€ä»¥å°†Proxy IPæ·»åŠ åˆ°ç™½åå•å³å¯å…äºè®¤è¯ï¼Œè¯¥æ–¹æ³•æ— éœ€é‡å¯å³å¯ç”Ÿæ•ˆ 1234sh bin/mqadmin updateGlobalWhiteAddr \\ -n 127.0.0.1:9876 \\ -c DefaultCluster \\ -g 10.250.0.* ä¸º Proxy å¼€å¯ enableAclRpcHookForClusterMode ä¿®æ”¹conf/rmq-proxy.jsonæ–‡ä»¶ï¼Œæ·»åŠ enableAclRpcHookForClusterModeå‚æ•° 1&quot;enableAclRpcHookForClusterMode&quot;: true ä¿®æ”¹conf/tools.ymlæ–‡ä»¶ï¼Œé…ç½®å¸å·ä¿¡æ¯ï¼š 12accessKey: mqadminsecretKey: 1234567 é‡æ–°å¯åŠ¨Proxyå³å¯ ä¸¤ç§æ–¹æ³•ï¼Œå®¢æˆ·ç«¯ä»£ç éƒ½ä¸éœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œç”šè‡³ä¸éœ€è¦æ·»åŠ ACLè®¤è¯ä¿¡æ¯ ä½†è¿™æ ·åšæ²¡å•¥æ„ä¹‰ï¼Œproxyä¹Ÿå¯ä»¥é…ç½®aclï¼Œä½†æ˜¯æ²¡ææ‡‚å¦‚ä½•é…ç½®","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ ACL 1.0 çš„ä½¿ç”¨æ–¹æ³•ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚ RocketMQ ä» 5.3.0 èµ·å¼•å…¥å®‰å…¨æ€§æ›´é«˜çš„ ACL 2.0ï¼Œ5.3.2 æ˜¯æœ€åä¸€ä¸ªè¿˜æ”¯æŒ ACL 1.0 çš„ç‰ˆæœ¬ï¼Œ5.3.3 ç§»é™¤äº† ACL 1.0ï¼Œå®˜æ–¹å»ºè®®æ‰€æœ‰ä½¿ç”¨ Apache RocketMQ ACL çš„ç”¨æˆ·è¿ç§»åˆ° ACL 2.0ã€‚","date_published":"2025-10-29T13:40:05.000Z","tags":["æŠ€æœ¯","rocketmq","åˆ†å¸ƒå¼","rocketmq"]},{"id":"https://blog.hanqunfeng.com/2025/10/28/rocketmq-07-admin-tool/","url":"https://blog.hanqunfeng.com/2025/10/28/rocketmq-07-admin-tool/","title":"RocketMQ Admin Tool","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RocketMQ Admin Tool çš„å¸¸ç”¨å‘½ä»¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/\">RocketMQå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RocketMQ-Admin-Tool-ç®€ä»‹\">RocketMQ Admin Tool ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/docs/deploymentOperations/02admintool\">RocketMQ Admin Tool</a> æ˜¯ RocketMQ çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† RocketMQ çš„é›†ç¾¤ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Topic-ç›¸å…³å‘½ä»¤\">Topic ç›¸å…³å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºæˆ–æ›´æ–° Topic</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°</th>\n<th style=\"text-align:left\">å…¨ç§°</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n<th style=\"text-align:left\">å¯é€‰å€¼ / æ ¼å¼</th>\n<th style=\"text-align:left\">æ˜¯å¦å¿…å¡«</th>\n<th style=\"text-align:left\">ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>-t</code></td>\n<td style=\"text-align:left\"><code>--topic</code></td>\n<td style=\"text-align:left\">ä¸»é¢˜åç§°</td>\n<td style=\"text-align:left\">å­—ç¬¦ä¸²</td>\n<td style=\"text-align:left\">âœ… å¿…å¡«</td>\n<td style=\"text-align:left\"><code>-t MyTopic</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-b</code></td>\n<td style=\"text-align:left\"><code>--brokerAddr</code></td>\n<td style=\"text-align:left\">æŒ‡å®šåˆ›å»º Topic çš„ Broker åœ°å€ï¼ˆä¸ <code>-c</code> äºŒé€‰ä¸€ï¼‰</td>\n<td style=\"text-align:left\"><code>ip:port</code></td>\n<td style=\"text-align:left\">âœ… å¿…å¡«ï¼ˆä¸ <code>-c</code> äºŒé€‰ä¸€ï¼‰</td>\n<td style=\"text-align:left\"><code>-b 192.168.1.10:10911</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-c</code></td>\n<td style=\"text-align:left\"><code>--clusterName</code></td>\n<td style=\"text-align:left\">æŒ‡å®šåˆ›å»º Topic çš„é›†ç¾¤åï¼ˆä¸ <code>-b</code> äºŒé€‰ä¸€ï¼‰</td>\n<td style=\"text-align:left\">å­—ç¬¦ä¸²</td>\n<td style=\"text-align:left\">âœ… å¿…å¡«ï¼ˆä¸ <code>-b</code> äºŒé€‰ä¸€ï¼‰</td>\n<td style=\"text-align:left\"><code>-c DefaultCluster</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-n</code></td>\n<td style=\"text-align:left\"><code>--namesrvAddr</code></td>\n<td style=\"text-align:left\">NameServer åœ°å€åˆ—è¡¨</td>\n<td style=\"text-align:left\">å¤šä¸ªåœ°å€ç”¨ <code>;</code> åˆ†éš”</td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\"><code>-n 192.168.1.1:9876;192.168.1.2:9876</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-r</code></td>\n<td style=\"text-align:left\"><code>--readQueueNums</code></td>\n<td style=\"text-align:left\">è¯»é˜Ÿåˆ—æ•°é‡ï¼Œé»˜è®¤ä¸º8ï¼Œå§‹ç»ˆä¿æŒ r == w</td>\n<td style=\"text-align:left\">æ•´æ•°</td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\"><code>-r 4</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-w</code></td>\n<td style=\"text-align:left\"><code>--writeQueueNums</code></td>\n<td style=\"text-align:left\">å†™é˜Ÿåˆ—æ•°é‡ï¼Œé»˜è®¤ä¸º8ï¼Œå§‹ç»ˆä¿æŒ r == w</td>\n<td style=\"text-align:left\">æ•´æ•°</td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\"><code>-w 4</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-p</code></td>\n<td style=\"text-align:left\"><code>--perm</code></td>\n<td style=\"text-align:left\">Topic æƒé™ï¼Œé»˜è®¤ä¸º6</td>\n<td style=\"text-align:left\">2ï¼šå†™ï¼ˆWï¼‰<br>4ï¼šè¯»ï¼ˆRï¼‰<br>6ï¼šè¯»å†™ï¼ˆRWï¼‰</td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\"><code>-p 6</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-o</code></td>\n<td style=\"text-align:left\"><code>--order</code></td>\n<td style=\"text-align:left\">æ˜¯å¦é¡ºåº Topicï¼Œå…¼å®¹4.xç‰ˆæœ¬ï¼Œ5.xç‰ˆæœ¬ä½¿ç”¨ -a â€œ+message.type=FIFOâ€</td>\n<td style=\"text-align:left\"><code>true</code> / <code>false</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\"><code>-o false</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-u</code></td>\n<td style=\"text-align:left\"><code>--unit</code></td>\n<td style=\"text-align:left\">æ˜¯å¦ä¸ºå•å…ƒï¼ˆUnitï¼‰Topicï¼ˆç”¨äºå¤šç§Ÿæˆ·éš”ç¦»ï¼‰</td>\n<td style=\"text-align:left\"><code>true</code> / <code>false</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\"><code>-u false</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-s</code></td>\n<td style=\"text-align:left\"><code>--hasUnitSub</code></td>\n<td style=\"text-align:left\">æ˜¯å¦æœ‰ Unit è®¢é˜…</td>\n<td style=\"text-align:left\"><code>true</code> / <code>false</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\"><code>-s false</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-a</code></td>\n<td style=\"text-align:left\"><code>--attributes</code></td>\n<td style=\"text-align:left\">é¢å¤–å±æ€§è®¾ç½®ï¼Œç”¨ <code>+</code> è¡¨ç¤ºæ·»åŠ ã€<code>-</code> è¡¨ç¤ºåˆ é™¤</td>\n<td style=\"text-align:left\">ä¾‹ï¼š<code>+a=b,+c=d,-e</code></td>\n<td style=\"text-align:left\">å¯é€‰</td>\n<td style=\"text-align:left\"><code>-a &quot;+message.type=NORMAL&quot;</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-h</code></td>\n<td style=\"text-align:left\"><code>--help</code></td>\n<td style=\"text-align:left\">æ‰“å°å¸®åŠ©ä¿¡æ¯</td>\n<td style=\"text-align:left\">æ— </td>\n<td style=\"text-align:left\">å¦</td>\n<td style=\"text-align:left\"><code>-h</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º Topicï¼Œæ­¤æ—¶ Topic ç±»å‹ä¸º UNSPECIFIEDï¼Œé›†ç¾¤ä¸‹æ‰€æœ‰ Broker éƒ½ä¼šåˆ›å»ºè¯¥ Topic</span></span><br><span class=\"line\">sh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster</span><br><span class=\"line\"><span class=\"comment\"># ä»…åœ¨æŒ‡å®šçš„ Broker ä¸­åˆ›å»º Topicï¼Œæ³¨æ„åªèƒ½åœ¨ Master èŠ‚ç‚¹ä¸Šåˆ›å»º</span></span><br><span class=\"line\">sh bin/mqadmin updateTopic  -n 127.0.0.1:9876 -b 10.250.0.31:10911 -t newTopic</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º Topicï¼Œå¹¶æŒ‡å®š Topic ç±»å‹ä¸º NORMALï¼Œæ”¯æŒçš„æ¶ˆæ¯ç±»å‹ï¼šUNSPECIFIED, TRANSACTION, FIFO, MIXED, DELAY, NORMAL</span></span><br><span class=\"line\">sh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster -a <span class=\"string\">&quot;+message.type=NORMAL&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»º Topicï¼Œå¹¶æŒ‡å®š Topic ç±»å‹ä¸º FIFOï¼ŒåŒæ—¶æŒ‡å®šè¯»å†™é˜Ÿåˆ—æ•°é‡éƒ½ä¸º 4</span></span><br><span class=\"line\">sh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster -r 4 -w 4 -a <span class=\"string\">&quot;+message.type=FIFO&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šæƒé™ï¼Œé»˜è®¤ä¸º 6ï¼šè¯»å†™</span></span><br><span class=\"line\">sh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster -p 6</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹ä¸åˆ é™¤ Topic</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰ Topicï¼Œæ­¤æ—¶åªæ‰“å° topic åˆ—è¡¨</span></span><br><span class=\"line\">sh bin/mqadmin topicList -n 127.0.0.1:9876</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰ Topicï¼Œ-c å‚æ•°è¡¨ç¤ºåŒæ—¶æ‰“å° Cluster Name å’Œ Consumer Group</span></span><br><span class=\"line\">sh bin/mqadmin topicList -n 127.0.0.1:9876 -c</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ Topicï¼Œåˆ é™¤æŒ‡å®šé›†ç¾¤ä¸‹çš„æŒ‡å®šTopic</span></span><br><span class=\"line\">sh bin/mqadmin deleteTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…¶å®ƒ Topic å‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ Topic è·¯ç”±ä¿¡æ¯</span></span><br><span class=\"line\">sh bin/mqadmin topicRoute -n 127.0.0.1:9876 -t newTopic</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"string\">&quot;brokerDatas&quot;</span>:[</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;brokerAddrs&quot;</span>:&#123;0:<span class=\"string\">&quot;10.250.0.188:11011&quot;</span>,1:<span class=\"string\">&quot;10.250.0.31:10911&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;brokerName&quot;</span>:<span class=\"string\">&quot;broker-b&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;cluster&quot;</span>:<span class=\"string\">&quot;DefaultCluster&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;enableActingMaster&quot;</span>:<span class=\"literal\">false</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;brokerAddrs&quot;</span>:&#123;0:<span class=\"string\">&quot;10.250.0.31:11011&quot;</span>,1:<span class=\"string\">&quot;10.250.0.188:10911&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;brokerName&quot;</span>:<span class=\"string\">&quot;broker-a&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;cluster&quot;</span>:<span class=\"string\">&quot;DefaultCluster&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;enableActingMaster&quot;</span>:<span class=\"literal\">false</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t],</span><br><span class=\"line\">\t<span class=\"string\">&quot;filterServerTable&quot;</span>:&#123;&#125;,</span><br><span class=\"line\">\t<span class=\"string\">&quot;queueDatas&quot;</span>:[</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;brokerName&quot;</span>:<span class=\"string\">&quot;broker-b&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;perm&quot;</span>:6,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;readQueueNums&quot;</span>:8,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;topicSysFlag&quot;</span>:0,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;writeQueueNums&quot;</span>:8</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;brokerName&quot;</span>:<span class=\"string\">&quot;broker-a&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;perm&quot;</span>:6,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;readQueueNums&quot;</span>:8,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;topicSysFlag&quot;</span>:0,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;writeQueueNums&quot;</span>:8</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ Topic æ¶ˆæ¯é˜Ÿåˆ—offset</span></span><br><span class=\"line\">sh bin/mqadmin topicStatus -n 127.0.0.1:9876 -t newTopic</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\">#Broker Name                      #QID  #Min Offset           #Max Offset             #Last Updated</span></span><br><span class=\"line\">broker-a                          0     0                     3                       2025-10-27 03:08:43,112</span><br><span class=\"line\">broker-a                          1     0                     4                       2025-10-27 06:13:21,968</span><br><span class=\"line\">broker-a                          2     0                     2                       2025-10-27 06:13:34,685</span><br><span class=\"line\">broker-a                          3     0                     2                       2025-10-26 05:44:17,222</span><br><span class=\"line\">broker-a                          4     0                     1                       2025-10-26 05:44:45,513</span><br><span class=\"line\">broker-a                          5     0                     1                       2025-10-26 06:13:10,541</span><br><span class=\"line\">broker-a                          6     0                     2                       2025-10-26 02:58:34,393</span><br><span class=\"line\">broker-a                          7     0                     1                       2025-10-25 12:42:41,189</span><br><span class=\"line\">broker-b                          0     0                     1                       2025-10-25 14:01:24,836</span><br><span class=\"line\">broker-b                          1     0                     2                       2025-10-26 06:14:24,411</span><br><span class=\"line\">broker-b                          2     0                     0</span><br><span class=\"line\">broker-b                          3     0                     0</span><br><span class=\"line\">broker-b                          4     0                     0</span><br><span class=\"line\">broker-b                          5     0                     1                       2025-10-25 12:30:57,672</span><br><span class=\"line\">broker-b                          6     0                     1                       2025-10-26 06:19:47,051</span><br><span class=\"line\">broker-b                          7     0                     1                       2025-10-26 06:14:49,216</span><br></pre></td></tr></table></figure>\n<h2 id=\"é›†ç¾¤ç›¸å…³å‘½ä»¤\">é›†ç¾¤ç›¸å…³å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼Œé›†ç¾¤ã€BrokerNameã€BrokerIdã€TPSç­‰ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é›†ç¾¤ä¿¡æ¯</span></span><br><span class=\"line\">sh bin/mqadmin clusterList -n 127.0.0.1:9876 -c DefaultCluster</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\">#Cluster Name           #Broker Name            #BID  #Addr                  #Version              #InTPS(LOAD)                   #OutTPS(LOAD)  #Timer(Progress)        #PCWait(ms)  #Hour         #SPACE    #ACTIVATED</span></span><br><span class=\"line\">DefaultCluster          broker-a                0     10.250.0.31:11011      V5_3_2                 0.00(0,0ms)               2.60(0,0ms|0,0ms)  1-0(0.0w, 0.0, 0.0)               0  67.03         0.3300          <span class=\"literal\">true</span></span><br><span class=\"line\">DefaultCluster          broker-a                1     10.250.0.188:10911     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  3-0(0.0w, 0.0, 0.0)               0  67.03         0.3200         <span class=\"literal\">false</span></span><br><span class=\"line\">DefaultCluster          broker-b                0     10.250.0.188:11011     V5_3_2                 0.00(0,0ms)               0.80(0,0ms|0,0ms)  1-0(0.0w, 0.0, 0.0)               0  67.17         0.3200          <span class=\"literal\">true</span></span><br><span class=\"line\">DefaultCluster          broker-b                1     10.250.0.31:10911      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  1-0(0.0w, 0.0, 0.0)               0  67.17         0.3300         <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\">## Broker ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\">#BID: BrokerIdï¼Œ0 è¡¨ç¤º Masterï¼Œ&gt;0 è¡¨ç¤º Slave</span></span><br><span class=\"line\"><span class=\"comment\">#InTPS(LOAD): ç”Ÿäº§è€…å†™å…¥ TPS ä¸è´Ÿè½½ï¼Œ 0.00(0,0ms): æ¯ç§’å…¥ç«™æ¶ˆæ¯æ•°(é˜Ÿåˆ—æ•°ï¼Œå¹³å‡è€—æ—¶)</span></span><br><span class=\"line\"><span class=\"comment\">#OutTPS(LOAD): æ¶ˆè´¹è€…æ‹‰å– TPS ä¸è´Ÿè½½ï¼Œ2.60(0,0ms|0,0ms): æ¯ç§’å‡ºç«™æ¶ˆæ¯æ•°(é˜Ÿåˆ—æ•°ï¼Œå¹³å‡è€—æ—¶|å¹³å‡å»¶æ—¶)</span></span><br><span class=\"line\"><span class=\"comment\">#Timer(Progress): Broker çš„æ¶ˆæ¯å¤„ç†è¿›åº¦ï¼Œæ ¼å¼å¦‚ 1-0(0.0w, 0.0, 0.0)ï¼šå‰é¢æ˜¯å®šæ—¶è½®æ¬¡è¿›åº¦ï¼Œæ‹¬å·å†…æ˜¯å†™å…¥ç­‰å¾…ç­‰ç»Ÿè®¡</span></span><br><span class=\"line\"><span class=\"comment\">#PCWait(ms): è¡¨ç¤º Broker å†™å…¥ PageCache çš„å¹³å‡ç­‰å¾…æ—¶é—´ï¼Œæ•°å€¼è¶Šä½è¶Šå¥½</span></span><br><span class=\"line\"><span class=\"comment\">#Hour: è¡¨ç¤º Broker å·²è¿è¡Œçš„æ—¶é•¿</span></span><br><span class=\"line\"><span class=\"comment\">#SPACE: ç£ç›˜ç©ºé—´ä½¿ç”¨æ¯”ä¾‹ï¼Œå°æ•°å½¢å¼ï¼Œä¾‹å¦‚ 0.3300 è¡¨ç¤ºä½¿ç”¨äº† 33.0%</span></span><br><span class=\"line\"><span class=\"comment\">#ACTIVATED: true è¡¨ç¤ºå½“å‰ Master æ­£åœ¨å·¥ä½œï¼›false è¡¨ç¤ºä»èŠ‚ç‚¹æˆ–å¤‡ç”¨ Master</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹é›†ç¾¤ç»Ÿè®¡ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/mqadmin clusterList -n 127.0.0.1:9876 -c DefaultCluster -m</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\">#Cluster Name     #Broker Name                       #InTotalYest  #OutTotalYest  #InTotalToday #OutTotalToday</span></span><br><span class=\"line\">DefaultCluster    broker-a                                      0              0              0              0</span><br><span class=\"line\">DefaultCluster    broker-a                                      0              0              0              0</span><br><span class=\"line\">DefaultCluster    broker-b                                      0            369              0              0</span><br><span class=\"line\">DefaultCluster    broker-b                                      0              0              0              0</span><br><span class=\"line\"><span class=\"comment\">## Broker ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\">#InTotalYestï¼šæ˜¨æ—¥å…¥ç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨æ˜¨å¤©æ¥æ”¶ï¼ˆç”Ÿäº§è€…å†™å…¥ï¼‰çš„æ¶ˆæ¯æ€»æ•°</span></span><br><span class=\"line\"><span class=\"comment\">#OutTotalYestï¼šæ˜¨æ—¥å‡ºç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨æ˜¨å¤©å‘é€ï¼ˆæ¶ˆè´¹è€…æ¶ˆè´¹ï¼‰çš„æ¶ˆæ¯æ€»æ•°</span></span><br><span class=\"line\"><span class=\"comment\">#InTotalTodayï¼šä»Šæ—¥å…¥ç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨ä»Šå¤©æ¥æ”¶ï¼ˆç”Ÿäº§è€…å†™å…¥ï¼‰çš„æ¶ˆæ¯æ€»æ•°</span></span><br><span class=\"line\"><span class=\"comment\">#OutTotalTodayï¼šä»Šæ—¥å‡ºç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨ä»Šå¤©å‘é€ï¼ˆæ¶ˆè´¹è€…æ¶ˆè´¹ï¼‰çš„æ¶ˆæ¯æ€»æ•°</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¶ˆæ¯ç›¸å…³\">æ¶ˆæ¯ç›¸å…³</h2>\n<h3 id=\"å‘é€æ¶ˆæ¯\">å‘é€æ¶ˆæ¯</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°</th>\n<th style=\"text-align:left\">å…¨å†™</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n<th style=\"text-align:center\">æ˜¯å¦å¿…å¡«</th>\n<th style=\"text-align:left\">ç¤ºä¾‹å€¼</th>\n<th style=\"text-align:left\">å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>-t</code></td>\n<td style=\"text-align:left\"><code>--topic</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯è¦å‘é€çš„ Topic åç§°</td>\n<td style=\"text-align:center\">âœ…</td>\n<td style=\"text-align:left\"><code>TestTopic</code></td>\n<td style=\"text-align:left\">å¿…é¡»æŒ‡å®šç›®æ ‡ Topic</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-p</code></td>\n<td style=\"text-align:left\"><code>--body</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯ä½“å†…å®¹ï¼ˆUTF-8 å­—ç¬¦ä¸²ï¼‰</td>\n<td style=\"text-align:center\">âœ…</td>\n<td style=\"text-align:left\"><code>&quot;Hello RocketMQ&quot;</code></td>\n<td style=\"text-align:left\">å®é™…æ¶ˆæ¯å†…å®¹</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-n</code></td>\n<td style=\"text-align:left\"><code>--namesrvAddr</code></td>\n<td style=\"text-align:left\">NameServer åœ°å€</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>127.0.0.1:9876</code></td>\n<td style=\"text-align:left\">ä¸æŒ‡å®šåˆ™ç”¨é»˜è®¤é…ç½®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-b</code></td>\n<td style=\"text-align:left\"><code>--broker</code></td>\n<td style=\"text-align:left\">æŒ‡å®šå‘é€åˆ°å“ªä¸ª broker</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>broker-a</code></td>\n<td style=\"text-align:left\">ä¸€èˆ¬ç”¨äºæµ‹è¯• Broker çŠ¶æ€</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-i</code></td>\n<td style=\"text-align:left\"><code>--qid</code></td>\n<td style=\"text-align:left\">æŒ‡å®šå‘é€åˆ°çš„é˜Ÿåˆ— ID</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>2</code></td>\n<td style=\"text-align:left\">ä¸€èˆ¬ä¸éœ€è¦è®¾ç½®ï¼ŒRocketMQ ä¼šè‡ªåŠ¨é€‰æ‹©</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-c</code></td>\n<td style=\"text-align:left\"><code>--tags</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯çš„æ ‡ç­¾ï¼ˆtagï¼‰</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>testTag</code></td>\n<td style=\"text-align:left\">ç”¨äºæ¶ˆæ¯è¿‡æ»¤</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-k</code></td>\n<td style=\"text-align:left\"><code>--key</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯çš„ä¸šåŠ¡é”®ï¼ˆkeyï¼‰</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>order123</code></td>\n<td style=\"text-align:left\">å¯ç”¨äºè¿½è¸ªæ¶ˆæ¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-m</code></td>\n<td style=\"text-align:left\"><code>--msgTraceEnable</code></td>\n<td style=\"text-align:left\">æ˜¯å¦å¼€å¯æ¶ˆæ¯è½¨è¿¹</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>true</code></td>\n<td style=\"text-align:left\">é»˜è®¤ <code>false</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-h</code></td>\n<td style=\"text-align:left\"><code>--help</code></td>\n<td style=\"text-align:left\">æ‰“å°å¸®åŠ©ä¿¡æ¯</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\">æ— </td>\n<td style=\"text-align:left\">æ˜¾ç¤ºå‘½ä»¤å‚æ•°è¯´æ˜</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‘é€æ¶ˆæ¯</span></span><br><span class=\"line\">sh bin/mqadmin sendMessage -n 127.0.0.1:9876 -t TestTopic -p <span class=\"string\">&quot;Hello RocketMQ&quot;</span></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\">#Broker Name                      #QID  #Send Result            #MsgId</span></span><br><span class=\"line\">broker-b                          2     SEND_OK                 0AFA00AFCF171EB44E468CC7D5EE0000</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºè§£é‡Š</span></span><br><span class=\"line\"><span class=\"comment\">#Broker Name: Broker åç§°</span></span><br><span class=\"line\"><span class=\"comment\">#QID: é˜Ÿåˆ— ID</span></span><br><span class=\"line\"><span class=\"comment\">#Send Result: å‘é€ç»“æœï¼ŒSEND_OK è¡¨ç¤ºæˆåŠŸ</span></span><br><span class=\"line\"><span class=\"comment\">#MsgId: æ¶ˆæ¯ ID</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š tagsã€key</span></span><br><span class=\"line\">sh bin/mqadmin sendMessage -n 127.0.0.1:9876 -t TestTopic -p <span class=\"string\">&quot;Hello RocketMQ&quot;</span> -c testTag -k order123</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ¶ˆè´¹æ¶ˆæ¯\">æ¶ˆè´¹æ¶ˆæ¯</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°</th>\n<th style=\"text-align:left\">å…¨å†™</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n<th style=\"text-align:center\">æ˜¯å¦å¿…å¡«</th>\n<th style=\"text-align:left\">ç¤ºä¾‹å€¼</th>\n<th style=\"text-align:left\">å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>-t</code></td>\n<td style=\"text-align:left\"><code>--topic</code></td>\n<td style=\"text-align:left\">ç›®æ ‡ Topic åç§°</td>\n<td style=\"text-align:center\">âœ…</td>\n<td style=\"text-align:left\"><code>TestTopic</code></td>\n<td style=\"text-align:left\">å¿…å¡«</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-n</code></td>\n<td style=\"text-align:left\"><code>--namesrvAddr</code></td>\n<td style=\"text-align:left\">NameServer åœ°å€</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>127.0.0.1:9876</code></td>\n<td style=\"text-align:left\">å»ºè®®å¡«å†™ä»¥é¿å…é»˜è®¤é…ç½®ä¸ç”Ÿæ•ˆ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-g</code></td>\n<td style=\"text-align:left\"><code>--consumerGroup</code></td>\n<td style=\"text-align:left\">æ¶ˆè´¹ç»„åç§°</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>TestGroup</code></td>\n<td style=\"text-align:left\">å¯æŒ‡å®šæ¶ˆè´¹ç»„ï¼ˆå½±å“æ¶ˆè´¹ä½ç‚¹ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-b</code></td>\n<td style=\"text-align:left\"><code>--brokerName</code></td>\n<td style=\"text-align:left\">Broker åç§°</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>broker-a</code></td>\n<td style=\"text-align:left\">æŒ‡å®šä»å“ªä¸ª broker æ‹‰å–æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-i</code></td>\n<td style=\"text-align:left\"><code>--queueId</code></td>\n<td style=\"text-align:left\">é˜Ÿåˆ— ID</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>0</code></td>\n<td style=\"text-align:left\">é»˜è®¤ä» 0 å·é˜Ÿåˆ—å¼€å§‹</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-o</code></td>\n<td style=\"text-align:left\"><code>--offset</code></td>\n<td style=\"text-align:left\">é˜Ÿåˆ—èµ·å§‹åç§»é‡ï¼ˆoffsetï¼‰</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>0</code></td>\n<td style=\"text-align:left\">æŒ‡å®šä»å“ªä¸ªä½ç½®å¼€å§‹æ¶ˆè´¹</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-c</code></td>\n<td style=\"text-align:left\"><code>--MessageNumber</code></td>\n<td style=\"text-align:left\">æ¶ˆè´¹æ¶ˆæ¯æ•°é‡</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>10</code></td>\n<td style=\"text-align:left\">é»˜è®¤é€šå¸¸ä¸º 1</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-s</code></td>\n<td style=\"text-align:left\"><code>--beginTimestamp</code></td>\n<td style=\"text-align:left\">èµ·å§‹æ—¶é—´</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>2025-10-28#10:00:00:000</code></td>\n<td style=\"text-align:left\">æ ¼å¼æˆ–æ—¶é—´æˆ³å‡å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-e</code></td>\n<td style=\"text-align:left\"><code>--endTimestamp</code></td>\n<td style=\"text-align:left\">ç»“æŸæ—¶é—´</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>2025-10-28#12:00:00:000</code></td>\n<td style=\"text-align:left\">ä¸ <code>-s</code> ä¸€èµ·ä½¿ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-h</code></td>\n<td style=\"text-align:left\"><code>--help</code></td>\n<td style=\"text-align:left\">æ‰“å°å¸®åŠ©ä¿¡æ¯</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\">æ— </td>\n<td style=\"text-align:left\">æ˜¾ç¤ºå‘½ä»¤å‚æ•°è¯´æ˜</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é»˜è®¤ä»é˜Ÿåˆ— 0 å¼€å§‹æ¶ˆè´¹ï¼Œæ‹‰å–å…¨éƒ¨æ¶ˆæ¯</span></span><br><span class=\"line\">sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic</span><br><span class=\"line\"><span class=\"comment\"># æ‹‰å–æŒ‡å®šæ¡æ•°çš„æ¶ˆæ¯ï¼Œ-c æŒ‡å®šæ‹‰å–æ¡æ•°</span></span><br><span class=\"line\">sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -c 10</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šåç§»é‡ï¼Œæ­¤æ—¶å¿…é¡»åŒæ—¶æŒ‡å®š brokerNameã€queueIdã€offset</span></span><br><span class=\"line\">sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -b broker-b -i 2 -o 3</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šæ¶ˆè´¹è€…ç»„</span></span><br><span class=\"line\">sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -g TestGroup</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šæ—¶é—´èŒƒå›´</span></span><br><span class=\"line\">sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -s 2025-10-28#00:00:00:000 -e 2025-10-28#08:00:00:000</span><br></pre></td></tr></table></figure>\n<h4 id=\"æ¶ˆè´¹ç»“æœ\">æ¶ˆè´¹ç»“æœ</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Consume ok</span><br><span class=\"line\">MSGID: 0AFA00AFCF171EB44E468CC7D5EE0000</span><br><span class=\"line\">MessageExt [brokerName=broker-b, queueId=2, storeSize=228, queueOffset=0, sysFlag=0,</span><br><span class=\"line\">  bornTimestamp=1761638706671, bornHost=/10.250.0.175:41362,</span><br><span class=\"line\">  storeTimestamp=1761638706691, storeHost=/10.250.0.188:11011,</span><br><span class=\"line\">  msgId=0AFA00BC00002B0300000000000CA1E9, commitLogOffset=827881,</span><br><span class=\"line\">  bodyCRC=1774740973, reconsumeTimes=0, preparedTransactionOffset=0,</span><br><span class=\"line\">  toString()=Message&#123;topic=<span class=\"string\">&#x27;TestTopic&#x27;</span>, flag=0,</span><br><span class=\"line\">    properties=&#123;MSG_REGION=DefaultRegion, UNIQ_KEY=0AFA00AFCF171EB44E468CC7D5EE0000,</span><br><span class=\"line\">      CLUSTER=DefaultCluster, MIN_OFFSET=0, WAIT=<span class=\"literal\">true</span>, TRACE_ON=<span class=\"literal\">true</span>, MAX_OFFSET=1&#125;,</span><br><span class=\"line\">    body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81],</span><br><span class=\"line\">    transactionId=<span class=\"string\">&#x27;null&#x27;</span>&#125;]</span><br><span class=\"line\">BODY: Hello RocketMQ</span><br><span class=\"line\"></span><br><span class=\"line\">MessageQueue [topic=TestTopic, brokerName=broker-b, queueId=2] <span class=\"built_in\">print</span> msg finished. status=NO_NEW_MSG, offset=1</span><br><span class=\"line\">The older -1 message of the 2 queue will be provided</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ğŸ“˜ å­—æ®µè§£æè¡¨æ ¼</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å­—æ®µ</th>\n<th style=\"text-align:left\">ç¤ºä¾‹å€¼</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>MSGID</strong></td>\n<td style=\"text-align:left\"><code>0AFA00AFCF171EB44E468CC7D5EE0000</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯å”¯ä¸€æ ‡è¯†ï¼ˆå®¢æˆ·ç«¯ç”Ÿæˆï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>brokerName</strong></td>\n<td style=\"text-align:left\"><code>broker-b</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯å­˜å‚¨åœ¨å“ªä¸ª Broker ä¸Š</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>queueId</strong></td>\n<td style=\"text-align:left\"><code>2</code></td>\n<td style=\"text-align:left\">å­˜å‚¨çš„é˜Ÿåˆ—ç¼–å·ï¼ˆTestTopic æœ‰å¤šä¸ªé˜Ÿåˆ—æ—¶çš„ç¬¬ 3 ä¸ªï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>queueOffset</strong></td>\n<td style=\"text-align:left\"><code>0</code></td>\n<td style=\"text-align:left\">é˜Ÿåˆ—ä¸­çš„åç§»é‡ï¼ˆä» 0 å¼€å§‹ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>storeSize</strong></td>\n<td style=\"text-align:left\"><code>228</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯åœ¨ç£ç›˜ä¸­çš„å­˜å‚¨å­—èŠ‚å¤§å°</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>sysFlag</strong></td>\n<td style=\"text-align:left\"><code>0</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯ç³»ç»Ÿæ ‡å¿—ä½ï¼ˆå†…éƒ¨ç”¨é€”ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>bornTimestamp</strong></td>\n<td style=\"text-align:left\"><code>1761638706671</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯åœ¨ç”Ÿäº§è€…ç«¯åˆ›å»ºçš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>bornHost</strong></td>\n<td style=\"text-align:left\"><code>/10.250.0.175:41362</code></td>\n<td style=\"text-align:left\">ç”Ÿäº§è€…å®¢æˆ·ç«¯çš„ IP å’Œç«¯å£</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>storeTimestamp</strong></td>\n<td style=\"text-align:left\"><code>1761638706691</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯è¢« Broker å­˜å‚¨çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>storeHost</strong></td>\n<td style=\"text-align:left\"><code>/10.250.0.188:11011</code></td>\n<td style=\"text-align:left\">Broker çš„å­˜å‚¨èŠ‚ç‚¹åœ°å€</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>msgId</strong></td>\n<td style=\"text-align:left\"><code>0AFA00BC00002B0300000000000CA1E9</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯åœ¨ Broker å­˜å‚¨ç³»ç»Ÿç”Ÿæˆçš„å”¯ä¸€ ID</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>commitLogOffset</strong></td>\n<td style=\"text-align:left\"><code>827881</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯åœ¨ commitLog æ–‡ä»¶ä¸­çš„åç§»é‡</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>bodyCRC</strong></td>\n<td style=\"text-align:left\"><code>1774740973</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯ä½“çš„ CRC æ ¡éªŒç ï¼ˆç”¨äºæ ¡éªŒæ•°æ®ä¸€è‡´æ€§ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>reconsumeTimes</strong></td>\n<td style=\"text-align:left\"><code>0</code></td>\n<td style=\"text-align:left\">è¢«é‡æ–°æ¶ˆè´¹çš„æ¬¡æ•°ï¼ˆ0 è¡¨ç¤ºç¬¬ä¸€æ¬¡æ¶ˆè´¹ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>preparedTransactionOffset</strong></td>\n<td style=\"text-align:left\"><code>0</code></td>\n<td style=\"text-align:left\">å¦‚æœæ˜¯äº‹åŠ¡æ¶ˆæ¯ï¼Œè¿™é‡Œä¼šè®°å½•é¢„æäº¤åç§»é‡ï¼›æ™®é€šæ¶ˆæ¯ä¸º 0</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>topic</strong></td>\n<td style=\"text-align:left\"><code>TestTopic</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯æ‰€å±ä¸»é¢˜</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>properties</strong></td>\n<td style=\"text-align:left\"><code>&#123;MSG_REGION=DefaultRegion, UNIQ_KEY=..., ...&#125;</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯å±æ€§ï¼ŒåŒ…æ‹¬ç³»ç»Ÿå±æ€§ä¸ç”¨æˆ·å±æ€§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>body</strong></td>\n<td style=\"text-align:left\"><code>[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81]</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯ä½“çš„å­—èŠ‚æ•°ç»„</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>BODYï¼ˆè§£ç åï¼‰</strong></td>\n<td style=\"text-align:left\"><code>Hello RocketMQ</code></td>\n<td style=\"text-align:left\">å®é™…æ¶ˆæ¯å†…å®¹ï¼ˆUTF-8 å­—ç¬¦ä¸²ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âš™ï¸ æ¶ˆæ¯çŠ¶æ€è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">è¾“å‡ºä¿¡æ¯</th>\n<th style=\"text-align:left\">å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>Consume ok</code></td>\n<td style=\"text-align:left\">è¡¨ç¤ºæˆåŠŸä» Broker æ‹‰å–æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>status=NO_NEW_MSG</code></td>\n<td style=\"text-align:left\">å½“å‰é˜Ÿåˆ—ï¼ˆqueueId=2ï¼‰ä¸­å·²ç»æ²¡æœ‰æ¯” offset=1 æ›´æ–°çš„æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>offset=1</code></td>\n<td style=\"text-align:left\">å½“å‰é˜Ÿåˆ—æ¶ˆè´¹åˆ° offset=1ï¼ˆä¸‹æ¬¡æ¶ˆè´¹ä»æ­¤å¼€å§‹ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>The older -1 message of the 2 queue will be provided</code></td>\n<td style=\"text-align:left\">è¿™æ˜¯ä¸€å¥æç¤ºè¯­ï¼Œæ„æ€æ˜¯ï¼šé˜Ÿåˆ—ä¸­æ²¡æœ‰æ›´æ—©çš„æ¶ˆæ¯ï¼ˆoffset=-1 è¡¨ç¤ºæ— å†å²æ¶ˆæ¯ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æŸ¥è¯¢æ¶ˆæ¯\">æŸ¥è¯¢æ¶ˆæ¯</h3>\n<h4 id=\"æ ¹æ®æ¶ˆæ¯-ID-æŸ¥è¯¢æ¶ˆæ¯-queryMsgById\">æ ¹æ®æ¶ˆæ¯ ID æŸ¥è¯¢æ¶ˆæ¯(queryMsgById)</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°</th>\n<th style=\"text-align:left\">å…¨å†™</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n<th style=\"text-align:center\">æ˜¯å¦å¿…å¡«</th>\n<th style=\"text-align:left\">ç¤ºä¾‹å€¼</th>\n<th style=\"text-align:left\">å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>-i</code></td>\n<td style=\"text-align:left\"><code>--msgId</code></td>\n<td style=\"text-align:left\">è¦æŸ¥è¯¢çš„æ¶ˆæ¯ ID</td>\n<td style=\"text-align:center\">âœ…</td>\n<td style=\"text-align:left\"><code>0AFA00AFCF171EB44E468CC7D5EE0000</code></td>\n<td style=\"text-align:left\">å¿…å¡«ï¼Œç”¨äºç²¾ç¡®å®šä½æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-t</code></td>\n<td style=\"text-align:left\"><code>--topic</code></td>\n<td style=\"text-align:left\">ç›®æ ‡ Topic åç§°</td>\n<td style=\"text-align:center\">âœ…</td>\n<td style=\"text-align:left\"><code>TestTopic</code></td>\n<td style=\"text-align:left\">å¿…å¡«</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-n</code></td>\n<td style=\"text-align:left\"><code>--namesrvAddr</code></td>\n<td style=\"text-align:left\">NameServer åœ°å€</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>127.0.0.1:9876</code></td>\n<td style=\"text-align:left\">å»ºè®®æ˜ç¡®æŒ‡å®š</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-c</code></td>\n<td style=\"text-align:left\"><code>--cluster</code></td>\n<td style=\"text-align:left\">é›†ç¾¤åç§°æˆ– LMQ çˆ¶ Topic</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>DefaultCluster</code></td>\n<td style=\"text-align:left\">åœ¨å¤šé›†ç¾¤åœºæ™¯ä¸‹ä½¿ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-g</code></td>\n<td style=\"text-align:left\"><code>--consumerGroup</code></td>\n<td style=\"text-align:left\">æ¶ˆè´¹ç»„åç§°</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>TestGroup</code></td>\n<td style=\"text-align:left\">å½“ç”¨äºæ¶ˆè´¹è€…å…³è”æŸ¥è¯¢æ—¶å¯æŒ‡å®š</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-d</code></td>\n<td style=\"text-align:left\"><code>--clientId</code></td>\n<td style=\"text-align:left\">æ¶ˆè´¹è€…å®¢æˆ·ç«¯ ID</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>192.168.0.1@12345</code></td>\n<td style=\"text-align:left\">è¾…åŠ©å®šä½æ¶ˆè´¹å®ä¾‹</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-f</code></td>\n<td style=\"text-align:left\"><code>--bodyFormat</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯ä½“è¾“å‡ºæ ¼å¼</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>UTF-8</code> / <code>HEX</code> / <code>BASE64</code></td>\n<td style=\"text-align:left\">é»˜è®¤ UTF-8</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-s</code></td>\n<td style=\"text-align:left\"><code>--sendMessage</code></td>\n<td style=\"text-align:left\">æ˜¯å¦é‡æ–°å‘é€æ¶ˆæ¯</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>true</code></td>\n<td style=\"text-align:left\">è°ƒè¯•æ—¶å¯ä½¿ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-u</code></td>\n<td style=\"text-align:left\"><code>--unitName</code></td>\n<td style=\"text-align:left\">å•å…ƒåï¼ˆå¤šå•å…ƒéƒ¨ç½²æ—¶ä½¿ç”¨ï¼‰</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>unit01</code></td>\n<td style=\"text-align:left\">ä¸€èˆ¬åœºæ™¯å¯å¿½ç•¥</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-h</code></td>\n<td style=\"text-align:left\"><code>--help</code></td>\n<td style=\"text-align:left\">æ‰“å°å¸®åŠ©ä¿¡æ¯</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\">æ— </td>\n<td style=\"text-align:left\">æ˜¾ç¤ºå‘½ä»¤è¯´æ˜</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/mqadmin queryMsgById -n 127.0.0.1:9876 -t TestTopic -i 0AFA00AFCF171EB44E468CC7D5EE0000 -f UTF-8</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">OffsetID:            0AFA00BC00002B0300000000000CA1E9</span><br><span class=\"line\">Topic:               TestTopic</span><br><span class=\"line\">Tags:                [null]</span><br><span class=\"line\">Keys:                [null]</span><br><span class=\"line\">Queue ID:            2</span><br><span class=\"line\">Queue Offset:        0</span><br><span class=\"line\">CommitLog Offset:    827881</span><br><span class=\"line\">Reconsume Times:     0</span><br><span class=\"line\">Born Timestamp:      2025-10-28 08:05:06,671</span><br><span class=\"line\">Store Timestamp:     2025-10-28 08:05:06,691</span><br><span class=\"line\">Born Host:           10.250.0.175:41362</span><br><span class=\"line\">Store Host:          10.250.0.188:11011</span><br><span class=\"line\">System Flag:         0</span><br><span class=\"line\">Properties:          &#123;MSG_REGION=DefaultRegion, UNIQ_KEY=0AFA00AFCF171EB44E468CC7D5EE0000, CLUSTER=DefaultCluster, WAIT=<span class=\"literal\">true</span>, TRACE_ON=<span class=\"literal\">true</span>&#125;</span><br><span class=\"line\">Message Body Path:   /tmp/rocketmq/msgbodys/0AFA00AFCF171EB44E468CC7D5EE0000</span><br><span class=\"line\">Message Body:        Hello RocketMQ</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¾“å‡ºå­—æ®µè¯¦è§£</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å­—æ®µå</th>\n<th style=\"text-align:left\">å«ä¹‰</th>\n<th style=\"text-align:left\">ç¤ºä¾‹</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>OffsetID</strong></td>\n<td style=\"text-align:left\">æ¶ˆæ¯åœ¨ CommitLog ä¸­çš„åç§»æ ‡è¯†ï¼ˆå†…éƒ¨å®šä½ä½¿ç”¨ï¼‰</td>\n<td style=\"text-align:left\"><code>0AFA00BC00002B0300000000000CA1E9</code></td>\n<td style=\"text-align:left\">å¯ç”¨äº broker å†…éƒ¨è¿½è¸ªå®šä½æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Topic</strong></td>\n<td style=\"text-align:left\">ä¸»é¢˜åç§°</td>\n<td style=\"text-align:left\"><code>TestTopic</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯æ‰€å±çš„ä¸»é¢˜</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Tags</strong></td>\n<td style=\"text-align:left\">æ¶ˆæ¯æ ‡ç­¾</td>\n<td style=\"text-align:left\"><code>[null]</code></td>\n<td style=\"text-align:left\">è‹¥ç”Ÿäº§æ¶ˆæ¯æ—¶æœªè®¾ç½® tagï¼Œåˆ™ä¸º null</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Keys</strong></td>\n<td style=\"text-align:left\">æ¶ˆæ¯é”®</td>\n<td style=\"text-align:left\"><code>[null]</code></td>\n<td style=\"text-align:left\">é€šå¸¸å¯ç”¨äºä¸šåŠ¡å±‚ç´¢å¼•æŸ¥è¯¢</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Queue ID</strong></td>\n<td style=\"text-align:left\">æ¶ˆæ¯æ‰€åœ¨çš„é˜Ÿåˆ—ç¼–å·</td>\n<td style=\"text-align:left\"><code>2</code></td>\n<td style=\"text-align:left\">å¯¹åº” topic çš„ç¬¬ 3 ä¸ªé˜Ÿåˆ—ï¼ˆä» 0 å¼€å§‹ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Queue Offset</strong></td>\n<td style=\"text-align:left\">é˜Ÿåˆ—åç§»é‡</td>\n<td style=\"text-align:left\"><code>0</code></td>\n<td style=\"text-align:left\">è¡¨ç¤ºæ˜¯è¯¥é˜Ÿåˆ—çš„ç¬¬ä¸€æ¡æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>CommitLog Offset</strong></td>\n<td style=\"text-align:left\">æ¶ˆæ¯åœ¨ commitlog æ–‡ä»¶ä¸­çš„åç§»é‡</td>\n<td style=\"text-align:left\"><code>827881</code></td>\n<td style=\"text-align:left\">broker å­˜å‚¨å±‚ä½ç½®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Reconsume Times</strong></td>\n<td style=\"text-align:left\">è¢«é‡æ–°æ¶ˆè´¹çš„æ¬¡æ•°</td>\n<td style=\"text-align:left\"><code>0</code></td>\n<td style=\"text-align:left\">è¡¨ç¤ºæœªé‡è¯•æ¶ˆè´¹è¿‡</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Born Timestamp</strong></td>\n<td style=\"text-align:left\">æ¶ˆæ¯ç”Ÿæˆæ—¶é—´</td>\n<td style=\"text-align:left\"><code>2025-10-28 08:05:06,671</code></td>\n<td style=\"text-align:left\">ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶é—´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Store Timestamp</strong></td>\n<td style=\"text-align:left\">æ¶ˆæ¯å­˜å‚¨æ—¶é—´</td>\n<td style=\"text-align:left\"><code>2025-10-28 08:05:06,691</code></td>\n<td style=\"text-align:left\">broker å†™å…¥æ¶ˆæ¯çš„æ—¶é—´ï¼ˆé€šå¸¸ç›¸å·®å‡ æ¯«ç§’ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Born Host</strong></td>\n<td style=\"text-align:left\">ç”Ÿäº§è€…å®¢æˆ·ç«¯ IP:ç«¯å£</td>\n<td style=\"text-align:left\"><code>10.250.0.175:41362</code></td>\n<td style=\"text-align:left\">ç”Ÿäº§è€…æ‰€åœ¨æœºå™¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Store Host</strong></td>\n<td style=\"text-align:left\">broker å­˜å‚¨è¯¥æ¶ˆæ¯çš„åœ°å€</td>\n<td style=\"text-align:left\"><code>10.250.0.188:11011</code></td>\n<td style=\"text-align:left\">å¯¹åº”çš„ broker æœåŠ¡ç«¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>System Flag</strong></td>\n<td style=\"text-align:left\">ç³»ç»Ÿæ ‡å¿—ä½</td>\n<td style=\"text-align:left\"><code>0</code></td>\n<td style=\"text-align:left\">å†…éƒ¨ä½¿ç”¨ï¼ˆæ ‡è¯†å‹ç¼©/äº‹åŠ¡ç­‰ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Properties</strong></td>\n<td style=\"text-align:left\">æ¶ˆæ¯å±æ€§</td>\n<td style=\"text-align:left\"><code>&#123;MSG_REGION=DefaultRegion, UNIQ_KEY=..., CLUSTER=DefaultCluster, WAIT=true, TRACE_ON=true&#125;</code></td>\n<td style=\"text-align:left\">åŒ…å« RocketMQ è‡ªåŠ¨é™„åŠ çš„å…ƒæ•°æ®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Message Body Path</strong></td>\n<td style=\"text-align:left\">æ¶ˆæ¯ä½“åœ¨æœ¬åœ°ä¿å­˜çš„æ–‡ä»¶è·¯å¾„</td>\n<td style=\"text-align:left\"><code>/tmp/rocketmq/msgbodys/0AFA00AFCF171EB44E468CC7D5EE0000</code></td>\n<td style=\"text-align:left\">RocketMQ CLI å°†æ¶ˆæ¯ä½“å†…å®¹ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰å†™å…¥æ–‡ä»¶ä»¥ä¾›æŸ¥çœ‹</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Message Body</strong></td>\n<td style=\"text-align:left\">æ¶ˆæ¯å†…å®¹</td>\n<td style=\"text-align:left\"><code>Hello RocketMQ</code></td>\n<td style=\"text-align:left\">æ¶ˆæ¯å†…å®¹</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"æ ¹æ®æ¶ˆæ¯-Key-æŸ¥è¯¢æ¶ˆæ¯-queryMsgByKey\">æ ¹æ®æ¶ˆæ¯ Key æŸ¥è¯¢æ¶ˆæ¯(queryMsgByKey)</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°</th>\n<th style=\"text-align:center\">å¿…å¡«</th>\n<th style=\"text-align:left\">ç¤ºä¾‹</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>-t, --topic</code></td>\n<td style=\"text-align:center\">âœ…</td>\n<td style=\"text-align:left\"><code>TestTopic</code></td>\n<td style=\"text-align:left\">è¦æŸ¥è¯¢çš„ä¸»é¢˜åç§°</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-k, --msgKey</code></td>\n<td style=\"text-align:center\">âœ…</td>\n<td style=\"text-align:left\"><code>order_10001</code></td>\n<td style=\"text-align:left\">å‘é€æ¶ˆæ¯æ—¶è®¾ç½®çš„ä¸šåŠ¡ Key</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-n, --namesrvAddr</code></td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>127.0.0.1:9876</code></td>\n<td style=\"text-align:left\">NameServer åœ°å€</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-c, --cluster</code></td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>DefaultCluster</code></td>\n<td style=\"text-align:left\">æŒ‡å®šé›†ç¾¤åç§°ï¼ˆå¯é€‰ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-b, --beginTimestamp</code></td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>1730083200000</code></td>\n<td style=\"text-align:left\">æŸ¥è¯¢èµ·å§‹æ—¶é—´æˆ³ï¼ˆmsï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-e, --endTimestamp</code></td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>1730173200000</code></td>\n<td style=\"text-align:left\">æŸ¥è¯¢ç»“æŸæ—¶é—´æˆ³ï¼ˆmsï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-m, --maxNum</code></td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>64</code></td>\n<td style=\"text-align:left\">è¿”å›çš„æœ€å¤§æ¶ˆæ¯æ•°ï¼Œé»˜è®¤ 64</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-h, --help</code></td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\">-</td>\n<td style=\"text-align:left\">æ‰“å°å¸®åŠ©ä¿¡æ¯</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/mqadmin queryMsgByKey -n 127.0.0.1:9876 -t TestTopic -k order123</span><br><span class=\"line\"><span class=\"comment\">## æŸ¥è¯¢ç»“æœ</span></span><br><span class=\"line\"><span class=\"comment\">#Message ID                                        #QID                                  #Offset</span></span><br><span class=\"line\">0AFA00AFCF781EB44E468CC902A30000                      7                                        1</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¶ˆè´¹è€…\">æ¶ˆè´¹è€…</h2>\n<h4 id=\"åˆ›å»ºæˆ–æ›´æ–°æ¶ˆè´¹è€…è®¢é˜…ç»„-updateSubGroup\">åˆ›å»ºæˆ–æ›´æ–°æ¶ˆè´¹è€…è®¢é˜…ç»„(updateSubGroup)</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¶ˆè´¹è€…è®¢é˜…ç»„ å°±æ˜¯ æ¶ˆè´¹è€…ç»„ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯è°ƒæ•´æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä¾‹å¦‚ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">æ¶ˆè´¹é¡ºåºï¼ˆé¡ºåº/å¹¶å‘ï¼‰</li>\n<li class=\"lvl-6\">å¹¿æ’­æ¨¡å¼</li>\n<li class=\"lvl-6\">æ¶ˆè´¹ä½¿èƒ½</li>\n<li class=\"lvl-6\">æ¶ˆè´¹é‡è¯•ç­–ç•¥</li>\n<li class=\"lvl-6\">å»¶è¿Ÿæ¶ˆè´¹é˜Ÿåˆ—ç­‰</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°</th>\n<th style=\"text-align:left\">å…¨å†™</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n<th style=\"text-align:center\">æ˜¯å¦å¿…å¡«</th>\n<th style=\"text-align:left\">ç¤ºä¾‹å€¼</th>\n<th style=\"text-align:left\">å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>-g</code></td>\n<td style=\"text-align:left\"><code>--groupName</code></td>\n<td style=\"text-align:left\">æ¶ˆè´¹è€…ç»„åç§°</td>\n<td style=\"text-align:center\">âœ…</td>\n<td style=\"text-align:left\"><code>TestConsumerGroup</code></td>\n<td style=\"text-align:left\">å¿…å¡«</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-n</code></td>\n<td style=\"text-align:left\"><code>--namesrvAddr</code></td>\n<td style=\"text-align:left\">NameServer åœ°å€</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>127.0.0.1:9876</code></td>\n<td style=\"text-align:left\">å»ºè®®æ˜ç¡®æŒ‡å®š</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-b</code></td>\n<td style=\"text-align:left\"><code>--brokerAddr</code></td>\n<td style=\"text-align:left\">æŒ‡å®š Broker åœ°å€</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>10.250.0.188:10911</code></td>\n<td style=\"text-align:left\">ä»…å¯¹å• Broker æ›´æ–°</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-c</code></td>\n<td style=\"text-align:left\"><code>--clusterName</code></td>\n<td style=\"text-align:left\">æŒ‡å®š Cluster åç§°</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>DefaultCluster</code></td>\n<td style=\"text-align:left\">å¯¹æ•´ä¸ªé›†ç¾¤æ›´æ–°</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-d</code></td>\n<td style=\"text-align:left\"><code>--consumeBroadcastEnable</code></td>\n<td style=\"text-align:left\">æ˜¯å¦å¹¿æ’­æ¶ˆè´¹</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>true</code> / <code>false</code></td>\n<td style=\"text-align:left\">true è¡¨ç¤ºå¹¿æ’­ï¼Œfalse è¡¨ç¤ºé›†ç¾¤æ¨¡å¼</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-o</code></td>\n<td style=\"text-align:left\"><code>--consumeMessageOrderly</code></td>\n<td style=\"text-align:left\">æ˜¯å¦é¡ºåºæ¶ˆè´¹</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>true</code> / <code>false</code></td>\n<td style=\"text-align:left\">é¡ºåºæ¶ˆè´¹åªåœ¨åŒé˜Ÿåˆ—ä¸­ç”Ÿæ•ˆ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-i</code></td>\n<td style=\"text-align:left\"><code>--brokerId</code></td>\n<td style=\"text-align:left\">ä»å“ªä¸ª Broker è·å–è®¢é˜…ä¿¡æ¯</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>0</code></td>\n<td style=\"text-align:left\">å†…éƒ¨ç”¨é€”ï¼Œé€šå¸¸ä¸ç”¨è®¾ç½®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-m</code></td>\n<td style=\"text-align:left\"><code>--consumeFromMinEnable</code></td>\n<td style=\"text-align:left\">æ˜¯å¦ä»æœ€å° offset æ¶ˆè´¹</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>true</code> / <code>false</code></td>\n<td style=\"text-align:left\">æ–°ç»„é¦–æ¬¡æ¶ˆè´¹æ—¶ç”Ÿæ•ˆ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-p</code></td>\n<td style=\"text-align:left\"><code>--groupRetryPolicy</code></td>\n<td style=\"text-align:left\">æ¶ˆè´¹ç»„é‡è¯•ç­–ç•¥ JSON</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>&#123;&quot;type&quot;:&quot;EXPONENTIAL&quot;,&quot;exponentialRetryPolicy&quot;:&#123;&quot;initial&quot;:5000,&quot;max&quot;:7200000,&quot;multiplier&quot;:2&#125;&#125;</code></td>\n<td style=\"text-align:left\">å¯ä»¥è‡ªå®šä¹‰é‡è¯•é—´éš”</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-q</code></td>\n<td style=\"text-align:left\"><code>--retryQueueNums</code></td>\n<td style=\"text-align:left\">é‡è¯•é˜Ÿåˆ—æ•°é‡</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>1</code> ~ <code>16</code></td>\n<td style=\"text-align:left\">é»˜è®¤ä¸º 1</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-r</code></td>\n<td style=\"text-align:left\"><code>--retryMaxTimes</code></td>\n<td style=\"text-align:left\">æœ€å¤§é‡è¯•æ¬¡æ•°</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>16</code></td>\n<td style=\"text-align:left\">é»˜è®¤ 16 æ¬¡</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-s</code></td>\n<td style=\"text-align:left\"><code>--consumeEnable</code></td>\n<td style=\"text-align:left\">æ˜¯å¦ä½¿èƒ½æ¶ˆè´¹</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>true</code> / <code>false</code></td>\n<td style=\"text-align:left\">false è¡¨ç¤ºæš‚åœæ¶ˆè´¹</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-w</code></td>\n<td style=\"text-align:left\"><code>--whichBrokerWhenConsumeSlowly</code></td>\n<td style=\"text-align:left\">æ…¢æ¶ˆè´¹é€‰æ‹© Broker ID</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>0</code></td>\n<td style=\"text-align:left\">å†…éƒ¨ä½¿ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-a</code></td>\n<td style=\"text-align:left\"><code>--notifyConsumerIdsChanged</code></td>\n<td style=\"text-align:left\">é€šçŸ¥ ConsumerId æ”¹å˜</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>true</code> / <code>false</code></td>\n<td style=\"text-align:left\">å¯è§¦å‘æ¶ˆè´¹è€…åˆ·æ–°è®¢é˜…ä¿¡æ¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>--attributes</code></td>\n<td style=\"text-align:left\"><code>--attributes</code></td>\n<td style=\"text-align:left\">å…¶ä»–è‡ªå®šä¹‰å±æ€§</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\"><code>attr1=val1,attr2=val2</code></td>\n<td style=\"text-align:left\">å¯è®¾ç½®è‡ªå®šä¹‰é…ç½®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-h</code></td>\n<td style=\"text-align:left\"><code>--help</code></td>\n<td style=\"text-align:left\">æ‰“å°å¸®åŠ©</td>\n<td style=\"text-align:center\">âŒ</td>\n<td style=\"text-align:left\">-</td>\n<td style=\"text-align:left\">æ˜¾ç¤ºå‘½ä»¤å¸®åŠ©</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºæ™®é€šæ¶ˆè´¹è€…ç»„</span></span><br><span class=\"line\">sh bin/mqadmin updateSubGroup -c DefaultCluster -g NormalGroup -n 127.0.0.1:9876</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºé¡ºåºæ¶ˆè´¹ç»„</span></span><br><span class=\"line\">sh bin/mqadmin updateSubGroup -c DefaultCluster -g FIFOGroup -n 127.0.0.1:9876 -o <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå¹¿æ’­æ¶ˆè´¹ç»„</span></span><br><span class=\"line\">sh bin/mqadmin updateSubGroup -c DefaultCluster -g BroadcastGroup -n 127.0.0.1:9876 -d <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè‡ªå®šä¹‰å±æ€§çš„æ¶ˆè´¹è€…ç»„ï¼Œè¿™é‡Œé…ç½®äº†é‡è¯•ç­–ç•¥</span></span><br><span class=\"line\">sh bin/mqadmin updateSubGroup -n 127.0.0.1:9876 -g TestConsumerGroup -c DefaultCluster -d <span class=\"literal\">true</span> -o <span class=\"literal\">true</span> -m <span class=\"literal\">true</span> -p <span class=\"string\">&#x27;&#123;&quot;type&quot;:&quot;EXPONENTIAL&quot;,&quot;exponentialRetryPolicy&quot;:&#123;&quot;initial&quot;:5000,&quot;max&quot;:7200000,&quot;multiplier&quot;:2&#125;&#125;&#x27;</span> -q 1 -r 16 -s <span class=\"literal\">true</span> -w 0 -a <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"åˆ é™¤æ¶ˆè´¹è€…è®¢é˜…ç»„-deleteSubGroup\">åˆ é™¤æ¶ˆè´¹è€…è®¢é˜…ç»„(deleteSubGroup)</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/mqadmin deleteSubGroup -n 127.0.0.1:9876 -g TestConsumerGroup -c DefaultCluster</span><br></pre></td></tr></table></figure>\n<h2 id=\"é‡è¦è¯´æ˜\">é‡è¦è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœ RocketMQ å¼€å¯äº† ACLï¼Œæ— è®ºæ˜¯ ACL 1.0 è¿˜æ˜¯ ACL 2.0ï¼Œéƒ½éœ€è¦åœ¨ <code>conf/tools.yml</code> é…ç½®æ­£ç¡®çš„è´¦å·å¯†ç ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ <code>mqadmin</code> å‘½ä»¤ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">accessKey:</span> <span class=\"string\">mqadmin</span></span><br><span class=\"line\"><span class=\"attr\">secretKey:</span> <span class=\"number\">1234567</span></span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ Admin Tool çš„å¸¸ç”¨å‘½ä»¤ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚ RocketMQ Admin Tool ç®€ä»‹ RocketMQ Admin Tool æ˜¯ RocketMQ çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† RocketMQ çš„é›†ç¾¤ã€‚ Topic ç›¸å…³å‘½ä»¤ åˆ›å»ºæˆ–æ›´æ–° Topic å‚æ•° å…¨ç§° è¯´æ˜ å¯é€‰å€¼ / æ ¼å¼ æ˜¯å¦å¿…å¡« ç¤ºä¾‹ -t --topic ä¸»é¢˜åç§° å­—ç¬¦ä¸² âœ… å¿…å¡« -t MyTopic -b --brokerAddr æŒ‡å®šåˆ›å»º Topic çš„ Broker åœ°å€ï¼ˆä¸ -c äºŒé€‰ä¸€ï¼‰ ip:port âœ… å¿…å¡«ï¼ˆä¸ -c äºŒé€‰ä¸€ï¼‰ -b 192.168.1.10:10911 -c --clusterName æŒ‡å®šåˆ›å»º Topic çš„é›†ç¾¤åï¼ˆä¸ -b äºŒé€‰ä¸€ï¼‰ å­—ç¬¦ä¸² âœ… å¿…å¡«ï¼ˆä¸ -b äºŒé€‰ä¸€ï¼‰ -c DefaultCluster -n --namesrvAddr NameServer åœ°å€åˆ—è¡¨ å¤šä¸ªåœ°å€ç”¨ ; åˆ†éš” å¯é€‰ -n 192.168.1.1:9876;192.168.1.2:9876 -r --readQueueNums è¯»é˜Ÿåˆ—æ•°é‡ï¼Œé»˜è®¤ä¸º8ï¼Œå§‹ç»ˆä¿æŒ r == w æ•´æ•° å¯é€‰ -r 4 -w --writeQueueNums å†™é˜Ÿåˆ—æ•°é‡ï¼Œé»˜è®¤ä¸º8ï¼Œå§‹ç»ˆä¿æŒ r == w æ•´æ•° å¯é€‰ -w 4 -p --perm Topic æƒé™ï¼Œé»˜è®¤ä¸º6 2ï¼šå†™ï¼ˆWï¼‰4ï¼šè¯»ï¼ˆRï¼‰6ï¼šè¯»å†™ï¼ˆRWï¼‰ å¯é€‰ -p 6 -o --order æ˜¯å¦é¡ºåº Topicï¼Œå…¼å®¹4.xç‰ˆæœ¬ï¼Œ5.xç‰ˆæœ¬ä½¿ç”¨ -a â€œ+message.type=FIFOâ€ true / false å¯é€‰ -o false -u --unit æ˜¯å¦ä¸ºå•å…ƒï¼ˆUnitï¼‰Topicï¼ˆç”¨äºå¤šç§Ÿæˆ·éš”ç¦»ï¼‰ true / false å¯é€‰ -u false -s --hasUnitSub æ˜¯å¦æœ‰ Unit è®¢é˜… true / false å¯é€‰ -s false -a --attributes é¢å¤–å±æ€§è®¾ç½®ï¼Œç”¨ + è¡¨ç¤ºæ·»åŠ ã€- è¡¨ç¤ºåˆ é™¤ ä¾‹ï¼š+a=b,+c=d,-e å¯é€‰ -a &quot;+message.type=NORMAL&quot; -h --help æ‰“å°å¸®åŠ©ä¿¡æ¯ æ—  å¦ -h ç¤ºä¾‹ 12345678910# åˆ›å»º Topicï¼Œæ­¤æ—¶ Topic ç±»å‹ä¸º UNSPECIFIEDï¼Œé›†ç¾¤ä¸‹æ‰€æœ‰ Broker éƒ½ä¼šåˆ›å»ºè¯¥ Topicsh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster# ä»…åœ¨æŒ‡å®šçš„ Broker ä¸­åˆ›å»º Topicï¼Œæ³¨æ„åªèƒ½åœ¨ Master èŠ‚ç‚¹ä¸Šåˆ›å»ºsh bin/mqadmin updateTopic -n 127.0.0.1:9876 -b 10.250.0.31:10911 -t newTopic# åˆ›å»º Topicï¼Œå¹¶æŒ‡å®š Topic ç±»å‹ä¸º NORMALï¼Œæ”¯æŒçš„æ¶ˆæ¯ç±»å‹ï¼šUNSPECIFIED, TRANSACTION, FIFO, MIXED, DELAY, NORMALsh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster -a &quot;+message.type=NORMAL&quot;# åˆ›å»º Topicï¼Œå¹¶æŒ‡å®š Topic ç±»å‹ä¸º FIFOï¼ŒåŒæ—¶æŒ‡å®šè¯»å†™é˜Ÿåˆ—æ•°é‡éƒ½ä¸º 4sh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster -r 4 -w 4 -a &quot;+message.type=FIFO&quot;# æŒ‡å®šæƒé™ï¼Œé»˜è®¤ä¸º 6ï¼šè¯»å†™sh bin/mqadmin updateTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster -p 6 æŸ¥çœ‹ä¸åˆ é™¤ Topic 1234567# æŸ¥çœ‹æ‰€æœ‰ Topicï¼Œæ­¤æ—¶åªæ‰“å° topic åˆ—è¡¨sh bin/mqadmin topicList -n 127.0.0.1:9876# æŸ¥çœ‹æ‰€æœ‰ Topicï¼Œ-c å‚æ•°è¡¨ç¤ºåŒæ—¶æ‰“å° Cluster Name å’Œ Consumer Groupsh bin/mqadmin topicList -n 127.0.0.1:9876 -c# åˆ é™¤ Topicï¼Œåˆ é™¤æŒ‡å®šé›†ç¾¤ä¸‹çš„æŒ‡å®šTopicsh bin/mqadmin deleteTopic -n 127.0.0.1:9876 -t newTopic -c DefaultCluster å…¶å®ƒ Topic å‘½ä»¤ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859# æŸ¥çœ‹ Topic è·¯ç”±ä¿¡æ¯sh bin/mqadmin topicRoute -n 127.0.0.1:9876 -t newTopic## è¾“å‡º&#123; &quot;brokerDatas&quot;:[ &#123; &quot;brokerAddrs&quot;:&#123;0:&quot;10.250.0.188:11011&quot;,1:&quot;10.250.0.31:10911&quot; &#125;, &quot;brokerName&quot;:&quot;broker-b&quot;, &quot;cluster&quot;:&quot;DefaultCluster&quot;, &quot;enableActingMaster&quot;:false &#125;, &#123; &quot;brokerAddrs&quot;:&#123;0:&quot;10.250.0.31:11011&quot;,1:&quot;10.250.0.188:10911&quot; &#125;, &quot;brokerName&quot;:&quot;broker-a&quot;, &quot;cluster&quot;:&quot;DefaultCluster&quot;, &quot;enableActingMaster&quot;:false &#125; ], &quot;filterServerTable&quot;:&#123;&#125;, &quot;queueDatas&quot;:[ &#123; &quot;brokerName&quot;:&quot;broker-b&quot;, &quot;perm&quot;:6, &quot;readQueueNums&quot;:8, &quot;topicSysFlag&quot;:0, &quot;writeQueueNums&quot;:8 &#125;, &#123; &quot;brokerName&quot;:&quot;broker-a&quot;, &quot;perm&quot;:6, &quot;readQueueNums&quot;:8, &quot;topicSysFlag&quot;:0, &quot;writeQueueNums&quot;:8 &#125; ]&#125;# æŸ¥çœ‹ Topic æ¶ˆæ¯é˜Ÿåˆ—offsetsh bin/mqadmin topicStatus -n 127.0.0.1:9876 -t newTopic## è¾“å‡º#Broker Name #QID #Min Offset #Max Offset #Last Updatedbroker-a 0 0 3 2025-10-27 03:08:43,112broker-a 1 0 4 2025-10-27 06:13:21,968broker-a 2 0 2 2025-10-27 06:13:34,685broker-a 3 0 2 2025-10-26 05:44:17,222broker-a 4 0 1 2025-10-26 05:44:45,513broker-a 5 0 1 2025-10-26 06:13:10,541broker-a 6 0 2 2025-10-26 02:58:34,393broker-a 7 0 1 2025-10-25 12:42:41,189broker-b 0 0 1 2025-10-25 14:01:24,836broker-b 1 0 2 2025-10-26 06:14:24,411broker-b 2 0 0broker-b 3 0 0broker-b 4 0 0broker-b 5 0 1 2025-10-25 12:30:57,672broker-b 6 0 1 2025-10-26 06:19:47,051broker-b 7 0 1 2025-10-26 06:14:49,216 é›†ç¾¤ç›¸å…³å‘½ä»¤ æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼Œé›†ç¾¤ã€BrokerNameã€BrokerIdã€TPSç­‰ä¿¡æ¯ 123456789101112131415161718# é›†ç¾¤ä¿¡æ¯sh bin/mqadmin clusterList -n 127.0.0.1:9876 -c DefaultCluster## è¾“å‡º#Cluster Name #Broker Name #BID #Addr #Version #InTPS(LOAD) #OutTPS(LOAD) #Timer(Progress) #PCWait(ms) #Hour #SPACE #ACTIVATEDDefaultCluster broker-a 0 10.250.0.31:11011 V5_3_2 0.00(0,0ms) 2.60(0,0ms|0,0ms) 1-0(0.0w, 0.0, 0.0) 0 67.03 0.3300 trueDefaultCluster broker-a 1 10.250.0.188:10911 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 3-0(0.0w, 0.0, 0.0) 0 67.03 0.3200 falseDefaultCluster broker-b 0 10.250.0.188:11011 V5_3_2 0.00(0,0ms) 0.80(0,0ms|0,0ms) 1-0(0.0w, 0.0, 0.0) 0 67.17 0.3200 trueDefaultCluster broker-b 1 10.250.0.31:10911 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 1-0(0.0w, 0.0, 0.0) 0 67.17 0.3300 false## Broker ç»Ÿè®¡ä¿¡æ¯#BID: BrokerIdï¼Œ0 è¡¨ç¤º Masterï¼Œ&gt;0 è¡¨ç¤º Slave#InTPS(LOAD): ç”Ÿäº§è€…å†™å…¥ TPS ä¸è´Ÿè½½ï¼Œ 0.00(0,0ms): æ¯ç§’å…¥ç«™æ¶ˆæ¯æ•°(é˜Ÿåˆ—æ•°ï¼Œå¹³å‡è€—æ—¶)#OutTPS(LOAD): æ¶ˆè´¹è€…æ‹‰å– TPS ä¸è´Ÿè½½ï¼Œ2.60(0,0ms|0,0ms): æ¯ç§’å‡ºç«™æ¶ˆæ¯æ•°(é˜Ÿåˆ—æ•°ï¼Œå¹³å‡è€—æ—¶|å¹³å‡å»¶æ—¶)#Timer(Progress): Broker çš„æ¶ˆæ¯å¤„ç†è¿›åº¦ï¼Œæ ¼å¼å¦‚ 1-0(0.0w, 0.0, 0.0)ï¼šå‰é¢æ˜¯å®šæ—¶è½®æ¬¡è¿›åº¦ï¼Œæ‹¬å·å†…æ˜¯å†™å…¥ç­‰å¾…ç­‰ç»Ÿè®¡#PCWait(ms): è¡¨ç¤º Broker å†™å…¥ PageCache çš„å¹³å‡ç­‰å¾…æ—¶é—´ï¼Œæ•°å€¼è¶Šä½è¶Šå¥½#Hour: è¡¨ç¤º Broker å·²è¿è¡Œçš„æ—¶é•¿#SPACE: ç£ç›˜ç©ºé—´ä½¿ç”¨æ¯”ä¾‹ï¼Œå°æ•°å½¢å¼ï¼Œä¾‹å¦‚ 0.3300 è¡¨ç¤ºä½¿ç”¨äº† 33.0%#ACTIVATED: true è¡¨ç¤ºå½“å‰ Master æ­£åœ¨å·¥ä½œï¼›false è¡¨ç¤ºä»èŠ‚ç‚¹æˆ–å¤‡ç”¨ Master æŸ¥çœ‹é›†ç¾¤ç»Ÿè®¡ä¿¡æ¯ 123456789101112sh bin/mqadmin clusterList -n 127.0.0.1:9876 -c DefaultCluster -m## è¾“å‡º#Cluster Name #Broker Name #InTotalYest #OutTotalYest #InTotalToday #OutTotalTodayDefaultCluster broker-a 0 0 0 0DefaultCluster broker-a 0 0 0 0DefaultCluster broker-b 0 369 0 0DefaultCluster broker-b 0 0 0 0## Broker ç»Ÿè®¡ä¿¡æ¯#InTotalYestï¼šæ˜¨æ—¥å…¥ç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨æ˜¨å¤©æ¥æ”¶ï¼ˆç”Ÿäº§è€…å†™å…¥ï¼‰çš„æ¶ˆæ¯æ€»æ•°#OutTotalYestï¼šæ˜¨æ—¥å‡ºç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨æ˜¨å¤©å‘é€ï¼ˆæ¶ˆè´¹è€…æ¶ˆè´¹ï¼‰çš„æ¶ˆæ¯æ€»æ•°#InTotalTodayï¼šä»Šæ—¥å…¥ç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨ä»Šå¤©æ¥æ”¶ï¼ˆç”Ÿäº§è€…å†™å…¥ï¼‰çš„æ¶ˆæ¯æ€»æ•°#OutTotalTodayï¼šä»Šæ—¥å‡ºç«™æ¶ˆæ¯æ€»é‡ï¼Œè¯¥ Broker åœ¨ä»Šå¤©å‘é€ï¼ˆæ¶ˆè´¹è€…æ¶ˆè´¹ï¼‰çš„æ¶ˆæ¯æ€»æ•° æ¶ˆæ¯ç›¸å…³ å‘é€æ¶ˆæ¯ å‚æ•° å…¨å†™ è¯´æ˜ æ˜¯å¦å¿…å¡« ç¤ºä¾‹å€¼ å¤‡æ³¨ -t --topic æ¶ˆæ¯è¦å‘é€çš„ Topic åç§° âœ… TestTopic å¿…é¡»æŒ‡å®šç›®æ ‡ Topic -p --body æ¶ˆæ¯ä½“å†…å®¹ï¼ˆUTF-8 å­—ç¬¦ä¸²ï¼‰ âœ… &quot;Hello RocketMQ&quot; å®é™…æ¶ˆæ¯å†…å®¹ -n --namesrvAddr NameServer åœ°å€ âŒ 127.0.0.1:9876 ä¸æŒ‡å®šåˆ™ç”¨é»˜è®¤é…ç½® -b --broker æŒ‡å®šå‘é€åˆ°å“ªä¸ª broker âŒ broker-a ä¸€èˆ¬ç”¨äºæµ‹è¯• Broker çŠ¶æ€ -i --qid æŒ‡å®šå‘é€åˆ°çš„é˜Ÿåˆ— ID âŒ 2 ä¸€èˆ¬ä¸éœ€è¦è®¾ç½®ï¼ŒRocketMQ ä¼šè‡ªåŠ¨é€‰æ‹© -c --tags æ¶ˆæ¯çš„æ ‡ç­¾ï¼ˆtagï¼‰ âŒ testTag ç”¨äºæ¶ˆæ¯è¿‡æ»¤ -k --key æ¶ˆæ¯çš„ä¸šåŠ¡é”®ï¼ˆkeyï¼‰ âŒ order123 å¯ç”¨äºè¿½è¸ªæ¶ˆæ¯ -m --msgTraceEnable æ˜¯å¦å¼€å¯æ¶ˆæ¯è½¨è¿¹ âŒ true é»˜è®¤ false -h --help æ‰“å°å¸®åŠ©ä¿¡æ¯ âŒ æ—  æ˜¾ç¤ºå‘½ä»¤å‚æ•°è¯´æ˜ ç¤ºä¾‹ 1234567891011121314# å‘é€æ¶ˆæ¯sh bin/mqadmin sendMessage -n 127.0.0.1:9876 -t TestTopic -p &quot;Hello RocketMQ&quot;## è¾“å‡º#Broker Name #QID #Send Result #MsgIdbroker-b 2 SEND_OK 0AFA00AFCF171EB44E468CC7D5EE0000## è¾“å‡ºè§£é‡Š#Broker Name: Broker åç§°#QID: é˜Ÿåˆ— ID#Send Result: å‘é€ç»“æœï¼ŒSEND_OK è¡¨ç¤ºæˆåŠŸ#MsgId: æ¶ˆæ¯ ID# æŒ‡å®š tagsã€keysh bin/mqadmin sendMessage -n 127.0.0.1:9876 -t TestTopic -p &quot;Hello RocketMQ&quot; -c testTag -k order123 æ¶ˆè´¹æ¶ˆæ¯ å‚æ•° å…¨å†™ è¯´æ˜ æ˜¯å¦å¿…å¡« ç¤ºä¾‹å€¼ å¤‡æ³¨ -t --topic ç›®æ ‡ Topic åç§° âœ… TestTopic å¿…å¡« -n --namesrvAddr NameServer åœ°å€ âŒ 127.0.0.1:9876 å»ºè®®å¡«å†™ä»¥é¿å…é»˜è®¤é…ç½®ä¸ç”Ÿæ•ˆ -g --consumerGroup æ¶ˆè´¹ç»„åç§° âŒ TestGroup å¯æŒ‡å®šæ¶ˆè´¹ç»„ï¼ˆå½±å“æ¶ˆè´¹ä½ç‚¹ï¼‰ -b --brokerName Broker åç§° âŒ broker-a æŒ‡å®šä»å“ªä¸ª broker æ‹‰å–æ¶ˆæ¯ -i --queueId é˜Ÿåˆ— ID âŒ 0 é»˜è®¤ä» 0 å·é˜Ÿåˆ—å¼€å§‹ -o --offset é˜Ÿåˆ—èµ·å§‹åç§»é‡ï¼ˆoffsetï¼‰ âŒ 0 æŒ‡å®šä»å“ªä¸ªä½ç½®å¼€å§‹æ¶ˆè´¹ -c --MessageNumber æ¶ˆè´¹æ¶ˆæ¯æ•°é‡ âŒ 10 é»˜è®¤é€šå¸¸ä¸º 1 -s --beginTimestamp èµ·å§‹æ—¶é—´ âŒ 2025-10-28#10:00:00:000 æ ¼å¼æˆ–æ—¶é—´æˆ³å‡å¯ -e --endTimestamp ç»“æŸæ—¶é—´ âŒ 2025-10-28#12:00:00:000 ä¸ -s ä¸€èµ·ä½¿ç”¨ -h --help æ‰“å°å¸®åŠ©ä¿¡æ¯ âŒ æ—  æ˜¾ç¤ºå‘½ä»¤å‚æ•°è¯´æ˜ ç¤ºä¾‹ 12345678910# é»˜è®¤ä»é˜Ÿåˆ— 0 å¼€å§‹æ¶ˆè´¹ï¼Œæ‹‰å–å…¨éƒ¨æ¶ˆæ¯sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic# æ‹‰å–æŒ‡å®šæ¡æ•°çš„æ¶ˆæ¯ï¼Œ-c æŒ‡å®šæ‹‰å–æ¡æ•°sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -c 10# æŒ‡å®šåç§»é‡ï¼Œæ­¤æ—¶å¿…é¡»åŒæ—¶æŒ‡å®š brokerNameã€queueIdã€offsetsh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -b broker-b -i 2 -o 3# æŒ‡å®šæ¶ˆè´¹è€…ç»„sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -g TestGroup# æŒ‡å®šæ—¶é—´èŒƒå›´sh bin/mqadmin consumeMessage -n 127.0.0.1:9876 -t TestTopic -s 2025-10-28#00:00:00:000 -e 2025-10-28#08:00:00:000 æ¶ˆè´¹ç»“æœ 12345678910111213141516Consume okMSGID: 0AFA00AFCF171EB44E468CC7D5EE0000MessageExt [brokerName=broker-b, queueId=2, storeSize=228, queueOffset=0, sysFlag=0, bornTimestamp=1761638706671, bornHost=/10.250.0.175:41362, storeTimestamp=1761638706691, storeHost=/10.250.0.188:11011, msgId=0AFA00BC00002B0300000000000CA1E9, commitLogOffset=827881, bodyCRC=1774740973, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message&#123;topic=&#x27;TestTopic&#x27;, flag=0, properties=&#123;MSG_REGION=DefaultRegion, UNIQ_KEY=0AFA00AFCF171EB44E468CC7D5EE0000, CLUSTER=DefaultCluster, MIN_OFFSET=0, WAIT=true, TRACE_ON=true, MAX_OFFSET=1&#125;, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81], transactionId=&#x27;null&#x27;&#125;]BODY: Hello RocketMQMessageQueue [topic=TestTopic, brokerName=broker-b, queueId=2] print msg finished. status=NO_NEW_MSG, offset=1The older -1 message of the 2 queue will be provided ğŸ“˜ å­—æ®µè§£æè¡¨æ ¼ å­—æ®µ ç¤ºä¾‹å€¼ è¯´æ˜ MSGID 0AFA00AFCF171EB44E468CC7D5EE0000 æ¶ˆæ¯å”¯ä¸€æ ‡è¯†ï¼ˆå®¢æˆ·ç«¯ç”Ÿæˆï¼‰ brokerName broker-b æ¶ˆæ¯å­˜å‚¨åœ¨å“ªä¸ª Broker ä¸Š queueId 2 å­˜å‚¨çš„é˜Ÿåˆ—ç¼–å·ï¼ˆTestTopic æœ‰å¤šä¸ªé˜Ÿåˆ—æ—¶çš„ç¬¬ 3 ä¸ªï¼‰ queueOffset 0 é˜Ÿåˆ—ä¸­çš„åç§»é‡ï¼ˆä» 0 å¼€å§‹ï¼‰ storeSize 228 æ¶ˆæ¯åœ¨ç£ç›˜ä¸­çš„å­˜å‚¨å­—èŠ‚å¤§å° sysFlag 0 æ¶ˆæ¯ç³»ç»Ÿæ ‡å¿—ä½ï¼ˆå†…éƒ¨ç”¨é€”ï¼‰ bornTimestamp 1761638706671 æ¶ˆæ¯åœ¨ç”Ÿäº§è€…ç«¯åˆ›å»ºçš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ bornHost /10.250.0.175:41362 ç”Ÿäº§è€…å®¢æˆ·ç«¯çš„ IP å’Œç«¯å£ storeTimestamp 1761638706691 æ¶ˆæ¯è¢« Broker å­˜å‚¨çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ storeHost /10.250.0.188:11011 Broker çš„å­˜å‚¨èŠ‚ç‚¹åœ°å€ msgId 0AFA00BC00002B0300000000000CA1E9 æ¶ˆæ¯åœ¨ Broker å­˜å‚¨ç³»ç»Ÿç”Ÿæˆçš„å”¯ä¸€ ID commitLogOffset 827881 æ¶ˆæ¯åœ¨ commitLog æ–‡ä»¶ä¸­çš„åç§»é‡ bodyCRC 1774740973 æ¶ˆæ¯ä½“çš„ CRC æ ¡éªŒç ï¼ˆç”¨äºæ ¡éªŒæ•°æ®ä¸€è‡´æ€§ï¼‰ reconsumeTimes 0 è¢«é‡æ–°æ¶ˆè´¹çš„æ¬¡æ•°ï¼ˆ0 è¡¨ç¤ºç¬¬ä¸€æ¬¡æ¶ˆè´¹ï¼‰ preparedTransactionOffset 0 å¦‚æœæ˜¯äº‹åŠ¡æ¶ˆæ¯ï¼Œè¿™é‡Œä¼šè®°å½•é¢„æäº¤åç§»é‡ï¼›æ™®é€šæ¶ˆæ¯ä¸º 0 topic TestTopic æ¶ˆæ¯æ‰€å±ä¸»é¢˜ properties &#123;MSG_REGION=DefaultRegion, UNIQ_KEY=..., ...&#125; æ¶ˆæ¯å±æ€§ï¼ŒåŒ…æ‹¬ç³»ç»Ÿå±æ€§ä¸ç”¨æˆ·å±æ€§ body [72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81] æ¶ˆæ¯ä½“çš„å­—èŠ‚æ•°ç»„ BODYï¼ˆè§£ç åï¼‰ Hello RocketMQ å®é™…æ¶ˆæ¯å†…å®¹ï¼ˆUTF-8 å­—ç¬¦ä¸²ï¼‰ âš™ï¸ æ¶ˆæ¯çŠ¶æ€è¯´æ˜ è¾“å‡ºä¿¡æ¯ å«ä¹‰ Consume ok è¡¨ç¤ºæˆåŠŸä» Broker æ‹‰å–æ¶ˆæ¯ status=NO_NEW_MSG å½“å‰é˜Ÿåˆ—ï¼ˆqueueId=2ï¼‰ä¸­å·²ç»æ²¡æœ‰æ¯” offset=1 æ›´æ–°çš„æ¶ˆæ¯ offset=1 å½“å‰é˜Ÿåˆ—æ¶ˆè´¹åˆ° offset=1ï¼ˆä¸‹æ¬¡æ¶ˆè´¹ä»æ­¤å¼€å§‹ï¼‰ The older -1 message of the 2 queue will be provided è¿™æ˜¯ä¸€å¥æç¤ºè¯­ï¼Œæ„æ€æ˜¯ï¼šé˜Ÿåˆ—ä¸­æ²¡æœ‰æ›´æ—©çš„æ¶ˆæ¯ï¼ˆoffset=-1 è¡¨ç¤ºæ— å†å²æ¶ˆæ¯ï¼‰ æŸ¥è¯¢æ¶ˆæ¯ æ ¹æ®æ¶ˆæ¯ ID æŸ¥è¯¢æ¶ˆæ¯(queryMsgById) å‚æ•° å…¨å†™ è¯´æ˜ æ˜¯å¦å¿…å¡« ç¤ºä¾‹å€¼ å¤‡æ³¨ -i --msgId è¦æŸ¥è¯¢çš„æ¶ˆæ¯ ID âœ… 0AFA00AFCF171EB44E468CC7D5EE0000 å¿…å¡«ï¼Œç”¨äºç²¾ç¡®å®šä½æ¶ˆæ¯ -t --topic ç›®æ ‡ Topic åç§° âœ… TestTopic å¿…å¡« -n --namesrvAddr NameServer åœ°å€ âŒ 127.0.0.1:9876 å»ºè®®æ˜ç¡®æŒ‡å®š -c --cluster é›†ç¾¤åç§°æˆ– LMQ çˆ¶ Topic âŒ DefaultCluster åœ¨å¤šé›†ç¾¤åœºæ™¯ä¸‹ä½¿ç”¨ -g --consumerGroup æ¶ˆè´¹ç»„åç§° âŒ TestGroup å½“ç”¨äºæ¶ˆè´¹è€…å…³è”æŸ¥è¯¢æ—¶å¯æŒ‡å®š -d --clientId æ¶ˆè´¹è€…å®¢æˆ·ç«¯ ID âŒ 192.168.0.1@12345 è¾…åŠ©å®šä½æ¶ˆè´¹å®ä¾‹ -f --bodyFormat æ¶ˆæ¯ä½“è¾“å‡ºæ ¼å¼ âŒ UTF-8 / HEX / BASE64 é»˜è®¤ UTF-8 -s --sendMessage æ˜¯å¦é‡æ–°å‘é€æ¶ˆæ¯ âŒ true è°ƒè¯•æ—¶å¯ä½¿ç”¨ -u --unitName å•å…ƒåï¼ˆå¤šå•å…ƒéƒ¨ç½²æ—¶ä½¿ç”¨ï¼‰ âŒ unit01 ä¸€èˆ¬åœºæ™¯å¯å¿½ç•¥ -h --help æ‰“å°å¸®åŠ©ä¿¡æ¯ âŒ æ—  æ˜¾ç¤ºå‘½ä»¤è¯´æ˜ ç¤ºä¾‹ 123456789101112131415161718sh bin/mqadmin queryMsgById -n 127.0.0.1:9876 -t TestTopic -i 0AFA00AFCF171EB44E468CC7D5EE0000 -f UTF-8## è¾“å‡ºOffsetID: 0AFA00BC00002B0300000000000CA1E9Topic: TestTopicTags: [null]Keys: [null]Queue ID: 2Queue Offset: 0CommitLog Offset: 827881Reconsume Times: 0Born Timestamp: 2025-10-28 08:05:06,671Store Timestamp: 2025-10-28 08:05:06,691Born Host: 10.250.0.175:41362Store Host: 10.250.0.188:11011System Flag: 0Properties: &#123;MSG_REGION=DefaultRegion, UNIQ_KEY=0AFA00AFCF171EB44E468CC7D5EE0000, CLUSTER=DefaultCluster, WAIT=true, TRACE_ON=true&#125;Message Body Path: /tmp/rocketmq/msgbodys/0AFA00AFCF171EB44E468CC7D5EE0000Message Body: Hello RocketMQ è¾“å‡ºå­—æ®µè¯¦è§£ å­—æ®µå å«ä¹‰ ç¤ºä¾‹ è¯´æ˜ OffsetID æ¶ˆæ¯åœ¨ CommitLog ä¸­çš„åç§»æ ‡è¯†ï¼ˆå†…éƒ¨å®šä½ä½¿ç”¨ï¼‰ 0AFA00BC00002B0300000000000CA1E9 å¯ç”¨äº broker å†…éƒ¨è¿½è¸ªå®šä½æ¶ˆæ¯ Topic ä¸»é¢˜åç§° TestTopic æ¶ˆæ¯æ‰€å±çš„ä¸»é¢˜ Tags æ¶ˆæ¯æ ‡ç­¾ [null] è‹¥ç”Ÿäº§æ¶ˆæ¯æ—¶æœªè®¾ç½® tagï¼Œåˆ™ä¸º null Keys æ¶ˆæ¯é”® [null] é€šå¸¸å¯ç”¨äºä¸šåŠ¡å±‚ç´¢å¼•æŸ¥è¯¢ Queue ID æ¶ˆæ¯æ‰€åœ¨çš„é˜Ÿåˆ—ç¼–å· 2 å¯¹åº” topic çš„ç¬¬ 3 ä¸ªé˜Ÿåˆ—ï¼ˆä» 0 å¼€å§‹ï¼‰ Queue Offset é˜Ÿåˆ—åç§»é‡ 0 è¡¨ç¤ºæ˜¯è¯¥é˜Ÿåˆ—çš„ç¬¬ä¸€æ¡æ¶ˆæ¯ CommitLog Offset æ¶ˆæ¯åœ¨ commitlog æ–‡ä»¶ä¸­çš„åç§»é‡ 827881 broker å­˜å‚¨å±‚ä½ç½® Reconsume Times è¢«é‡æ–°æ¶ˆè´¹çš„æ¬¡æ•° 0 è¡¨ç¤ºæœªé‡è¯•æ¶ˆè´¹è¿‡ Born Timestamp æ¶ˆæ¯ç”Ÿæˆæ—¶é—´ 2025-10-28 08:05:06,671 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶é—´ Store Timestamp æ¶ˆæ¯å­˜å‚¨æ—¶é—´ 2025-10-28 08:05:06,691 broker å†™å…¥æ¶ˆæ¯çš„æ—¶é—´ï¼ˆé€šå¸¸ç›¸å·®å‡ æ¯«ç§’ï¼‰ Born Host ç”Ÿäº§è€…å®¢æˆ·ç«¯ IP:ç«¯å£ 10.250.0.175:41362 ç”Ÿäº§è€…æ‰€åœ¨æœºå™¨ Store Host broker å­˜å‚¨è¯¥æ¶ˆæ¯çš„åœ°å€ 10.250.0.188:11011 å¯¹åº”çš„ broker æœåŠ¡ç«¯ System Flag ç³»ç»Ÿæ ‡å¿—ä½ 0 å†…éƒ¨ä½¿ç”¨ï¼ˆæ ‡è¯†å‹ç¼©/äº‹åŠ¡ç­‰ï¼‰ Properties æ¶ˆæ¯å±æ€§ &#123;MSG_REGION=DefaultRegion, UNIQ_KEY=..., CLUSTER=DefaultCluster, WAIT=true, TRACE_ON=true&#125; åŒ…å« RocketMQ è‡ªåŠ¨é™„åŠ çš„å…ƒæ•°æ® Message Body Path æ¶ˆæ¯ä½“åœ¨æœ¬åœ°ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ /tmp/rocketmq/msgbodys/0AFA00AFCF171EB44E468CC7D5EE0000 RocketMQ CLI å°†æ¶ˆæ¯ä½“å†…å®¹ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰å†™å…¥æ–‡ä»¶ä»¥ä¾›æŸ¥çœ‹ Message Body æ¶ˆæ¯å†…å®¹ Hello RocketMQ æ¶ˆæ¯å†…å®¹ æ ¹æ®æ¶ˆæ¯ Key æŸ¥è¯¢æ¶ˆæ¯(queryMsgByKey) å‚æ•° å¿…å¡« ç¤ºä¾‹ è¯´æ˜ -t, --topic âœ… TestTopic è¦æŸ¥è¯¢çš„ä¸»é¢˜åç§° -k, --msgKey âœ… order_10001 å‘é€æ¶ˆæ¯æ—¶è®¾ç½®çš„ä¸šåŠ¡ Key -n, --namesrvAddr âŒ 127.0.0.1:9876 NameServer åœ°å€ -c, --cluster âŒ DefaultCluster æŒ‡å®šé›†ç¾¤åç§°ï¼ˆå¯é€‰ï¼‰ -b, --beginTimestamp âŒ 1730083200000 æŸ¥è¯¢èµ·å§‹æ—¶é—´æˆ³ï¼ˆmsï¼‰ -e, --endTimestamp âŒ 1730173200000 æŸ¥è¯¢ç»“æŸæ—¶é—´æˆ³ï¼ˆmsï¼‰ -m, --maxNum âŒ 64 è¿”å›çš„æœ€å¤§æ¶ˆæ¯æ•°ï¼Œé»˜è®¤ 64 -h, --help âŒ - æ‰“å°å¸®åŠ©ä¿¡æ¯ ç¤ºä¾‹ 1234sh bin/mqadmin queryMsgByKey -n 127.0.0.1:9876 -t TestTopic -k order123## æŸ¥è¯¢ç»“æœ#Message ID #QID #Offset0AFA00AFCF781EB44E468CC902A30000 7 1 æ¶ˆè´¹è€… åˆ›å»ºæˆ–æ›´æ–°æ¶ˆè´¹è€…è®¢é˜…ç»„(updateSubGroup) æ¶ˆè´¹è€…è®¢é˜…ç»„ å°±æ˜¯ æ¶ˆè´¹è€…ç»„ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯è°ƒæ•´æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä¾‹å¦‚ï¼š æ¶ˆè´¹é¡ºåºï¼ˆé¡ºåº/å¹¶å‘ï¼‰ å¹¿æ’­æ¨¡å¼ æ¶ˆè´¹ä½¿èƒ½ æ¶ˆè´¹é‡è¯•ç­–ç•¥ å»¶è¿Ÿæ¶ˆè´¹é˜Ÿåˆ—ç­‰ å‚æ•° å…¨å†™ è¯´æ˜ æ˜¯å¦å¿…å¡« ç¤ºä¾‹å€¼ å¤‡æ³¨ -g --groupName æ¶ˆè´¹è€…ç»„åç§° âœ… TestConsumerGroup å¿…å¡« -n --namesrvAddr NameServer åœ°å€ âŒ 127.0.0.1:9876 å»ºè®®æ˜ç¡®æŒ‡å®š -b --brokerAddr æŒ‡å®š Broker åœ°å€ âŒ 10.250.0.188:10911 ä»…å¯¹å• Broker æ›´æ–° -c --clusterName æŒ‡å®š Cluster åç§° âŒ DefaultCluster å¯¹æ•´ä¸ªé›†ç¾¤æ›´æ–° -d --consumeBroadcastEnable æ˜¯å¦å¹¿æ’­æ¶ˆè´¹ âŒ true / false true è¡¨ç¤ºå¹¿æ’­ï¼Œfalse è¡¨ç¤ºé›†ç¾¤æ¨¡å¼ -o --consumeMessageOrderly æ˜¯å¦é¡ºåºæ¶ˆè´¹ âŒ true / false é¡ºåºæ¶ˆè´¹åªåœ¨åŒé˜Ÿåˆ—ä¸­ç”Ÿæ•ˆ -i --brokerId ä»å“ªä¸ª Broker è·å–è®¢é˜…ä¿¡æ¯ âŒ 0 å†…éƒ¨ç”¨é€”ï¼Œé€šå¸¸ä¸ç”¨è®¾ç½® -m --consumeFromMinEnable æ˜¯å¦ä»æœ€å° offset æ¶ˆè´¹ âŒ true / false æ–°ç»„é¦–æ¬¡æ¶ˆè´¹æ—¶ç”Ÿæ•ˆ -p --groupRetryPolicy æ¶ˆè´¹ç»„é‡è¯•ç­–ç•¥ JSON âŒ &#123;&quot;type&quot;:&quot;EXPONENTIAL&quot;,&quot;exponentialRetryPolicy&quot;:&#123;&quot;initial&quot;:5000,&quot;max&quot;:7200000,&quot;multiplier&quot;:2&#125;&#125; å¯ä»¥è‡ªå®šä¹‰é‡è¯•é—´éš” -q --retryQueueNums é‡è¯•é˜Ÿåˆ—æ•°é‡ âŒ 1 ~ 16 é»˜è®¤ä¸º 1 -r --retryMaxTimes æœ€å¤§é‡è¯•æ¬¡æ•° âŒ 16 é»˜è®¤ 16 æ¬¡ -s --consumeEnable æ˜¯å¦ä½¿èƒ½æ¶ˆè´¹ âŒ true / false false è¡¨ç¤ºæš‚åœæ¶ˆè´¹ -w --whichBrokerWhenConsumeSlowly æ…¢æ¶ˆè´¹é€‰æ‹© Broker ID âŒ 0 å†…éƒ¨ä½¿ç”¨ -a --notifyConsumerIdsChanged é€šçŸ¥ ConsumerId æ”¹å˜ âŒ true / false å¯è§¦å‘æ¶ˆè´¹è€…åˆ·æ–°è®¢é˜…ä¿¡æ¯ --attributes --attributes å…¶ä»–è‡ªå®šä¹‰å±æ€§ âŒ attr1=val1,attr2=val2 å¯è®¾ç½®è‡ªå®šä¹‰é…ç½® -h --help æ‰“å°å¸®åŠ© âŒ - æ˜¾ç¤ºå‘½ä»¤å¸®åŠ© ç¤ºä¾‹ 12345678910# åˆ›å»ºæ™®é€šæ¶ˆè´¹è€…ç»„sh bin/mqadmin updateSubGroup -c DefaultCluster -g NormalGroup -n 127.0.0.1:9876# åˆ›å»ºé¡ºåºæ¶ˆè´¹ç»„sh bin/mqadmin updateSubGroup -c DefaultCluster -g FIFOGroup -n 127.0.0.1:9876 -o true# åˆ›å»ºå¹¿æ’­æ¶ˆè´¹ç»„sh bin/mqadmin updateSubGroup -c DefaultCluster -g BroadcastGroup -n 127.0.0.1:9876 -d true# åˆ›å»ºè‡ªå®šä¹‰å±æ€§çš„æ¶ˆè´¹è€…ç»„ï¼Œè¿™é‡Œé…ç½®äº†é‡è¯•ç­–ç•¥sh bin/mqadmin updateSubGroup -n 127.0.0.1:9876 -g TestConsumerGroup -c DefaultCluster -d true -o true -m true -p &#x27;&#123;&quot;type&quot;:&quot;EXPONENTIAL&quot;,&quot;exponentialRetryPolicy&quot;:&#123;&quot;initial&quot;:5000,&quot;max&quot;:7200000,&quot;multiplier&quot;:2&#125;&#125;&#x27; -q 1 -r 16 -s true -w 0 -a true åˆ é™¤æ¶ˆè´¹è€…è®¢é˜…ç»„(deleteSubGroup) 1sh bin/mqadmin deleteSubGroup -n 127.0.0.1:9876 -g TestConsumerGroup -c DefaultCluster é‡è¦è¯´æ˜ å¦‚æœ RocketMQ å¼€å¯äº† ACLï¼Œæ— è®ºæ˜¯ ACL 1.0 è¿˜æ˜¯ ACL 2.0ï¼Œéƒ½éœ€è¦åœ¨ conf/tools.yml é…ç½®æ­£ç¡®çš„è´¦å·å¯†ç ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ mqadmin å‘½ä»¤ã€‚ 12accessKey: mqadminsecretKey: 1234567","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ Admin Tool çš„å¸¸ç”¨å‘½ä»¤ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚","date_published":"2025-10-28T13:40:05.000Z","tags":["æŠ€æœ¯","rocketmq","åˆ†å¸ƒå¼","rocketmq"]},{"id":"https://blog.hanqunfeng.com/2025/10/28/rocketmq-06-proxy-config/","url":"https://blog.hanqunfeng.com/2025/10/28/rocketmq-06-proxy-config/","title":"RocketMQ Proxy çš„é…ç½®é¡¹","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RocketMQ Proxy çš„é…ç½®é¡¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/\">RocketMQå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹\">é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“å‰ç‰ˆæœ¬å°šä¸æ”¯æŒé€šè¿‡å‘½ä»¤è¡ŒæŸ¥çœ‹ Proxy çš„é…ç½®é¡¹ï¼Œä½†æ˜¯åœ¨å¯åŠ¨Proxyçš„æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°å½“å‰ç”Ÿæ•ˆçš„é…ç½®é¡¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦å¤–åœ¨æºç  <code>rocketmq-all-5.3.2-source-release/proxy</code> çš„å¯åŠ¨ç±» <code>org.apache.rocketmq.proxy.ProxyStartup</code>ä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±»</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.apache.rocketmq.proxy.config.ProxyConfig</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®é¡¹è¯´æ˜\">é…ç½®é¡¹è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Proxy é…ç½®å‚æ•°è¯´æ˜ä¸ä¼˜åŒ–å»ºè®®ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼ŒProxyçš„é…ç½®æ–‡ä»¶æ˜¯ JSON æ ¼å¼</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">åˆ†ç±»</th>\n<th style=\"text-align:left\">å‚æ•°å</th>\n<th style=\"text-align:left\">é»˜è®¤å€¼</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n<th style=\"text-align:left\">ä¼˜åŒ–å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>åŸºç¡€ä¿¡æ¯</strong></td>\n<td style=\"text-align:left\"><code>rocketMQClusterName</code></td>\n<td style=\"text-align:left\"><code>DefaultCluster</code></td>\n<td style=\"text-align:left\">Broker é›†ç¾¤åç§°ï¼ˆProxy ç”¨äºå…³è” RocketMQ é›†ç¾¤ï¼‰</td>\n<td style=\"text-align:left\">è‹¥æœ‰å¤šä¸ªé›†ç¾¤ï¼Œåº”å”¯ä¸€å‘½å</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>proxyClusterName</code></td>\n<td style=\"text-align:left\"><code>DefaultCluster</code></td>\n<td style=\"text-align:left\">Proxy æ‰€å±é›†ç¾¤åç§°ï¼ˆä¸ brokerClusterName å¯ä¸åŒï¼‰</td>\n<td style=\"text-align:left\">âœ…å»ºè®®ç‹¬ç«‹å‘½åï¼ŒåŒºåˆ† Proxy é›†ç¾¤</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>proxyName</code></td>\n<td style=\"text-align:left\">ä¸»æœºåï¼ˆä¾‹ï¼š<code>ip-10-250-0-175...</code>ï¼‰</td>\n<td style=\"text-align:left\">Proxy å®ä¾‹åç§°ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†</td>\n<td style=\"text-align:left\">âœ…å»ºè®®è®¾ç½®å”¯ä¸€åç§°</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>localServeAddr</code></td>\n<td style=\"text-align:left\">æœ¬åœ° IP</td>\n<td style=\"text-align:left\">Proxy æœ¬åœ°æœåŠ¡åœ°å€ï¼ˆRemoting é€šä¿¡ä½¿ç”¨ï¼‰</td>\n<td style=\"text-align:left\">âœ…å»ºè®®æ˜¾å¼æŒ‡å®š IP</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Namesrv</strong></td>\n<td style=\"text-align:left\"><code>namesrvAddr</code></td>\n<td style=\"text-align:left\">å¤šä¸ªåœ°å€ï¼ˆåˆ†å·åˆ†éš”ï¼‰</td>\n<td style=\"text-align:left\">NameServer åœ°å€ï¼ŒProxy é€šè¿‡å®ƒåŒæ­¥è·¯ç”±</td>\n<td style=\"text-align:left\">âœ…æ¨èé…ç½®ä¸ºå¯è®¿é—®çš„å†…ç½‘åœ°å€</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>namesrvDomain</code></td>\n<td style=\"text-align:left\">ç©º</td>\n<td style=\"text-align:left\">NameServer åŸŸåï¼ˆå¯ç”¨äºåŠ¨æ€è§£æï¼‰</td>\n<td style=\"text-align:left\">å¯é€‰ï¼ŒDNS æ–¹å¼æ—¶ä½¿ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>namesrvDomainSubgroup</code></td>\n<td style=\"text-align:left\">ç©º</td>\n<td style=\"text-align:left\">å­åŸŸåˆ†ç»„ï¼ˆå¤šé›†ç¾¤åŸŸåå‘ç°ç”¨ï¼‰</td>\n<td style=\"text-align:left\">ä¸€èˆ¬å¯å¿½ç•¥</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>TLS é…ç½®</strong></td>\n<td style=\"text-align:left\"><code>tlsTestModeEnable</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æµ‹è¯•æ¨¡å¼ä¸‹è·³è¿‡éªŒè¯ï¼ˆä»…ç”¨äºæœ¬åœ°æµ‹è¯•ï¼‰</td>\n<td style=\"text-align:left\">â—ç”Ÿäº§åº”è®¾ä¸º false</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>tlsKeyPath</code></td>\n<td style=\"text-align:left\"><code>/conf/tls/rocketmq.key</code></td>\n<td style=\"text-align:left\">TLS ç§é’¥è·¯å¾„</td>\n<td style=\"text-align:left\">âœ…æ ¹æ®è¯ä¹¦è·¯å¾„è°ƒæ•´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>tlsCertPath</code></td>\n<td style=\"text-align:left\"><code>/conf/tls/rocketmq.crt</code></td>\n<td style=\"text-align:left\">TLS è¯ä¹¦è·¯å¾„</td>\n<td style=\"text-align:left\">âœ…æ ¹æ®è¯ä¹¦è·¯å¾„è°ƒæ•´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>gRPC åŸºç¡€</strong></td>\n<td style=\"text-align:left\"><code>proxyMode</code></td>\n<td style=\"text-align:left\"><code>CLUSTER</code></td>\n<td style=\"text-align:left\">Proxy æ¨¡å¼ï¼šCLUSTER / LOCAL / REMOTING</td>\n<td style=\"text-align:left\">âœ…ç”Ÿäº§æ¨è CLUSTER</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>grpcServerPort</code></td>\n<td style=\"text-align:left\">8081</td>\n<td style=\"text-align:left\">gRPC æœåŠ¡ç«¯ç›‘å¬ç«¯å£</td>\n<td style=\"text-align:left\">è‹¥å†²çªå¯ä¿®æ”¹</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>grpcShutdownTimeSeconds</code></td>\n<td style=\"text-align:left\">30</td>\n<td style=\"text-align:left\">ä¼˜é›…å…³é—­ç­‰å¾…æ—¶é—´</td>\n<td style=\"text-align:left\">å¯é€‚å½“è°ƒå¤§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>enableGrpcEpoll</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">å¯ç”¨ Linux epoll I/O æ¨¡å‹</td>\n<td style=\"text-align:left\">âœ…Linux å»ºè®®å¼€å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>grpcMaxInboundMessageSize</code></td>\n<td style=\"text-align:left\">136314880 (~130MB)</td>\n<td style=\"text-align:left\">æœ€å¤§å…¥ç«™æ¶ˆæ¯å¤§å°</td>\n<td style=\"text-align:left\">æ ¹æ®æ¶ˆæ¯å¤§å°è°ƒæ•´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>æ¶ˆæ¯é™åˆ¶</strong></td>\n<td style=\"text-align:left\"><code>maxMessageSize</code></td>\n<td style=\"text-align:left\">4194304 (4MB)</td>\n<td style=\"text-align:left\">æœ€å¤§æ¶ˆæ¯ä½“å¤§å°</td>\n<td style=\"text-align:left\">âœ…åº”ä¸ Broker ä¸€è‡´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>enableMessageBodyEmptyCheck</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ ¡éªŒæ¶ˆæ¯ä½“æ˜¯å¦ä¸ºç©º</td>\n<td style=\"text-align:left\">ä¿æŒé»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>maxUserPropertySize</code></td>\n<td style=\"text-align:left\">16384 (16KB)</td>\n<td style=\"text-align:left\">ç”¨æˆ·å±æ€§æœ€å¤§é•¿åº¦</td>\n<td style=\"text-align:left\">æ ¹æ®ä¸šåŠ¡å¤æ‚åº¦è°ƒæ•´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>userPropertyMaxNum</code></td>\n<td style=\"text-align:left\">128</td>\n<td style=\"text-align:left\">å•æ¡æ¶ˆæ¯æœ€å¤§å±æ€§æ•°é‡</td>\n<td style=\"text-align:left\">å¯é€‚å½“è°ƒä½é˜²æ­¢æ€§èƒ½æŸè€—</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>maxMessageGroupSize</code></td>\n<td style=\"text-align:left\">64</td>\n<td style=\"text-align:left\">æœ€å¤§æ¶ˆæ¯ç»„å¤§å°ï¼ˆæ‰¹é‡ pop ä½¿ç”¨ï¼‰</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>æ¶ˆæ¯å¯è§æ€§ä¸å»¶è¿Ÿ</strong></td>\n<td style=\"text-align:left\"><code>defaultInvisibleTimeMills</code></td>\n<td style=\"text-align:left\">60000 (60s)</td>\n<td style=\"text-align:left\">pop æ¶ˆæ¯é»˜è®¤ä¸å¯è§æ—¶é—´</td>\n<td style=\"text-align:left\">âœ…é«˜å¹¶å‘æ—¶å¯è°ƒä½</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>maxInvisibleTimeMills</code></td>\n<td style=\"text-align:left\">43200000 (12h)</td>\n<td style=\"text-align:left\">æœ€å¤§ä¸å¯è§æ—¶é•¿</td>\n<td style=\"text-align:left\">âœ…å¯æ ¹æ®ä¸šåŠ¡é™ä½</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>maxDelayTimeMills</code></td>\n<td style=\"text-align:left\">86400000 (1d)</td>\n<td style=\"text-align:left\">æœ€å¤§å»¶è¿Ÿæ—¶é—´</td>\n<td style=\"text-align:left\">ä¸ Broker ä¿æŒä¸€è‡´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>useDelayLevel</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦ä½¿ç”¨å»¶è¿Ÿç­‰çº§æ¨¡å¼</td>\n<td style=\"text-align:left\">è‹¥ Broker å¯ç”¨ç­‰çº§å»¶è¿Ÿåˆ™å¼€å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>messageDelayLevel</code></td>\n<td style=\"text-align:left\"><code>&quot;1s 5s 10s ... 2h&quot;</code></td>\n<td style=\"text-align:left\">å»¶è¿Ÿç­‰çº§é…ç½®è¡¨</td>\n<td style=\"text-align:left\">âœ…éœ€ä¸ broker.conf å¯¹é½</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>çº¿ç¨‹æ± ï¼ˆgRPC æ¨¡å—ï¼‰</strong></td>\n<td style=\"text-align:left\"><code>grpcBossLoopNum</code></td>\n<td style=\"text-align:left\">1</td>\n<td style=\"text-align:left\">Netty boss çº¿ç¨‹</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>grpcWorkerLoopNum</code></td>\n<td style=\"text-align:left\">4</td>\n<td style=\"text-align:left\">gRPC worker çº¿ç¨‹</td>\n<td style=\"text-align:left\">âœ…CPU&gt;4 æ—¶å¯è°ƒé«˜è‡³æ ¸æ•°</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>grpcThreadPoolNums</code></td>\n<td style=\"text-align:left\">20</td>\n<td style=\"text-align:left\">gRPC ä¸šåŠ¡çº¿ç¨‹æ•°</td>\n<td style=\"text-align:left\">âœ…å»ºè®® â‰ˆ CPU æ ¸æ•°Ã—2</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>grpcThreadPoolQueueCapacity</code></td>\n<td style=\"text-align:left\">100000</td>\n<td style=\"text-align:left\">é˜Ÿåˆ—å®¹é‡</td>\n<td style=\"text-align:left\">âš ï¸å»ºè®® â‰¤20000ï¼Œé˜² OOM</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>çº¿ç¨‹æ± ï¼ˆå†…éƒ¨æ¨¡å—ï¼‰</strong></td>\n<td style=\"text-align:left\"><code>producerProcessorThreadPoolNums</code></td>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\">ç”Ÿäº§è€…å¤„ç†çº¿ç¨‹</td>\n<td style=\"text-align:left\">âœ…å¯æ ¹æ®QPSè°ƒæ•´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>consumerProcessorThreadPoolNums</code></td>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\">æ¶ˆè´¹è€…å¤„ç†çº¿ç¨‹</td>\n<td style=\"text-align:left\">åŒä¸Š</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>topicRouteServiceThreadPoolNums</code></td>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\">è·¯ç”±æœåŠ¡çº¿ç¨‹</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>renewThreadPoolNums</code></td>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\">è‡ªåŠ¨ç»­æœŸçº¿ç¨‹</td>\n<td style=\"text-align:left\">é«˜å¹¶å‘æ—¶å¯è°ƒå¤§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>ç¼“å­˜é…ç½®</strong></td>\n<td style=\"text-align:left\"><code>topicRouteServiceCacheExpiredSeconds</code></td>\n<td style=\"text-align:left\">300</td>\n<td style=\"text-align:left\">è·¯ç”±ç¼“å­˜æœ‰æ•ˆæœŸ</td>\n<td style=\"text-align:left\">âœ…å¯é€‚å½“è°ƒå¤§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>topicConfigCacheExpiredSeconds</code></td>\n<td style=\"text-align:left\">300</td>\n<td style=\"text-align:left\">Topic é…ç½®ç¼“å­˜æœ‰æ•ˆæœŸ</td>\n<td style=\"text-align:left\">åŒä¸Š</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>subscriptionGroupConfigCacheExpiredSeconds</code></td>\n<td style=\"text-align:left\">300</td>\n<td style=\"text-align:left\">è®¢é˜…ç»„ç¼“å­˜æœ‰æ•ˆæœŸ</td>\n<td style=\"text-align:left\">åŒä¸Š</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>aclCacheExpiredSeconds</code></td>\n<td style=\"text-align:left\">300</td>\n<td style=\"text-align:left\">ACL ç¼“å­˜æœ‰æ•ˆæœŸ</td>\n<td style=\"text-align:left\">âœ…åŒä¸Š</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>äº‹åŠ¡ä¸å¿ƒè·³</strong></td>\n<td style=\"text-align:left\"><code>transactionHeartbeatThreadPoolNums</code></td>\n<td style=\"text-align:left\">20</td>\n<td style=\"text-align:left\">äº‹åŠ¡å¿ƒè·³çº¿ç¨‹æ•°</td>\n<td style=\"text-align:left\">âœ…æ ¹æ®äº‹åŠ¡é‡è°ƒæ•´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>transactionHeartbeatPeriodSecond</code></td>\n<td style=\"text-align:left\">20</td>\n<td style=\"text-align:left\">äº‹åŠ¡å¿ƒè·³å‘¨æœŸ</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>transactionDataExpireMillis</code></td>\n<td style=\"text-align:left\">30000</td>\n<td style=\"text-align:left\">äº‹åŠ¡æ•°æ®è¿‡æœŸæ—¶é—´</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>æŒ‡æ ‡ä¸ç›‘æ§</strong></td>\n<td style=\"text-align:left\"><code>metricsExporterType</code></td>\n<td style=\"text-align:left\">DISABLE</td>\n<td style=\"text-align:left\">æŒ‡æ ‡å¯¼å‡ºæ–¹å¼ï¼šDISABLE / PROM / GRPC / LOG</td>\n<td style=\"text-align:left\">âœ…å»ºè®®å¯ç”¨ PROM</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>metricsPromExporterPort</code></td>\n<td style=\"text-align:left\">5557</td>\n<td style=\"text-align:left\">Prometheus å¯¼å‡ºç«¯å£</td>\n<td style=\"text-align:left\">âœ…å»ºè®®æš´éœ²ç›‘æ§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>metricsInDelta</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦æŒ‰å¢é‡å¯¼å‡ºæŒ‡æ ‡</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Remoting æ¨¡å¼</strong></td>\n<td style=\"text-align:left\"><code>enableRemotingLocalProxyGrpc</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">å¯ç”¨æœ¬åœ° Proxy gRPC è½¬å‘</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>remotingListenPort</code></td>\n<td style=\"text-align:left\">8080</td>\n<td style=\"text-align:left\">Remoting é€šä¿¡ç«¯å£</td>\n<td style=\"text-align:left\">è‹¥å†²çªä¿®æ”¹</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>sendLatencyEnable</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">å¯ç”¨å‘é€å»¶è¿Ÿæ¢æµ‹ï¼ˆLoadBalance ä¼˜åŒ–ï¼‰</td>\n<td style=\"text-align:left\">âœ…å»ºè®®å¼€å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>startDetectorEnable</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">å¯ç”¨å¯åŠ¨æ¢æµ‹åŠŸèƒ½</td>\n<td style=\"text-align:left\">å¯é€‰ï¼Œæµ‹è¯•é˜¶æ®µä½¿ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å¯è§‚æµ‹æ€§</strong></td>\n<td style=\"text-align:left\"><code>traceOn</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">å¯ç”¨é“¾è·¯è¿½è¸ª</td>\n<td style=\"text-align:left\">âœ…å»ºè®®å¼€å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>enablePrintJstack</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ‰“å°çº¿ç¨‹å †æ ˆï¼ˆç”¨äºè¯Šæ–­ï¼‰</td>\n<td style=\"text-align:left\">âœ…å¯å»¶é•¿å‘¨æœŸå‡å°‘æ—¥å¿—</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»¼åˆä¼˜åŒ–å»ºè®®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">æ–¹å‘</th>\n<th style=\"text-align:left\">å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>æ€§èƒ½è°ƒä¼˜</strong></td>\n<td style=\"text-align:left\">å¯ç”¨ <code>enableGrpcEpoll=true</code>ï¼›åˆç†é…ç½®çº¿ç¨‹æ± ï¼ˆå¦‚å‡å°‘é˜Ÿåˆ—é•¿åº¦ï¼‰ï¼›è®¾ç½®åˆé€‚çš„ <code>grpcThreadPoolNums</code>ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å¯é æ€§</strong></td>\n<td style=\"text-align:left\">å¼€å¯ <code>traceOn</code> ä¸ <code>sendLatencyEnable</code> ç›‘æ§ï¼›ä½¿ç”¨ Prometheus æŒ‡æ ‡å¯¼å‡ºã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å®‰å…¨æ€§</strong></td>\n<td style=\"text-align:left\">ç¦ç”¨ <code>tlsTestModeEnable</code>ï¼Œä½¿ç”¨çœŸå® TLS è¯ä¹¦ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>èµ„æºç®¡ç†</strong></td>\n<td style=\"text-align:left\">é™åˆ¶ç¼“å­˜æ•°é‡ï¼ˆå¦‚ topic/user/aclï¼‰å’Œçº¿ç¨‹é˜Ÿåˆ—å®¹é‡ï¼Œé˜²æ­¢å†…å­˜è†¨èƒ€ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å¯ç»´æŠ¤æ€§</strong></td>\n<td style=\"text-align:left\">ä½¿ç”¨ç‹¬ç«‹çš„ <code>proxyClusterName</code>ï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶ <code>rmq-proxy.json</code> ä¸­æ˜ç¡®å„é¡¹ç«¯å£å’Œè·¯å¾„ã€‚</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ Proxy çš„é…ç½®é¡¹ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚ é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹ å½“å‰ç‰ˆæœ¬å°šä¸æ”¯æŒé€šè¿‡å‘½ä»¤è¡ŒæŸ¥çœ‹ Proxy çš„é…ç½®é¡¹ï¼Œä½†æ˜¯åœ¨å¯åŠ¨Proxyçš„æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°å½“å‰ç”Ÿæ•ˆçš„é…ç½®é¡¹ã€‚ å¦å¤–åœ¨æºç  rocketmq-all-5.3.2-source-release/proxy çš„å¯åŠ¨ç±» org.apache.rocketmq.proxy.ProxyStartupä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±» 1org.apache.rocketmq.proxy.config.ProxyConfig é…ç½®é¡¹è¯´æ˜ Proxy é…ç½®å‚æ•°è¯´æ˜ä¸ä¼˜åŒ–å»ºè®®ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼ŒProxyçš„é…ç½®æ–‡ä»¶æ˜¯ JSON æ ¼å¼ åˆ†ç±» å‚æ•°å é»˜è®¤å€¼ è¯´æ˜ ä¼˜åŒ–å»ºè®® åŸºç¡€ä¿¡æ¯ rocketMQClusterName DefaultCluster Broker é›†ç¾¤åç§°ï¼ˆProxy ç”¨äºå…³è” RocketMQ é›†ç¾¤ï¼‰ è‹¥æœ‰å¤šä¸ªé›†ç¾¤ï¼Œåº”å”¯ä¸€å‘½å proxyClusterName DefaultCluster Proxy æ‰€å±é›†ç¾¤åç§°ï¼ˆä¸ brokerClusterName å¯ä¸åŒï¼‰ âœ…å»ºè®®ç‹¬ç«‹å‘½åï¼ŒåŒºåˆ† Proxy é›†ç¾¤ proxyName ä¸»æœºåï¼ˆä¾‹ï¼šip-10-250-0-175...ï¼‰ Proxy å®ä¾‹åç§°ï¼Œç”¨äºå”¯ä¸€æ ‡è¯† âœ…å»ºè®®è®¾ç½®å”¯ä¸€åç§° localServeAddr æœ¬åœ° IP Proxy æœ¬åœ°æœåŠ¡åœ°å€ï¼ˆRemoting é€šä¿¡ä½¿ç”¨ï¼‰ âœ…å»ºè®®æ˜¾å¼æŒ‡å®š IP Namesrv namesrvAddr å¤šä¸ªåœ°å€ï¼ˆåˆ†å·åˆ†éš”ï¼‰ NameServer åœ°å€ï¼ŒProxy é€šè¿‡å®ƒåŒæ­¥è·¯ç”± âœ…æ¨èé…ç½®ä¸ºå¯è®¿é—®çš„å†…ç½‘åœ°å€ namesrvDomain ç©º NameServer åŸŸåï¼ˆå¯ç”¨äºåŠ¨æ€è§£æï¼‰ å¯é€‰ï¼ŒDNS æ–¹å¼æ—¶ä½¿ç”¨ namesrvDomainSubgroup ç©º å­åŸŸåˆ†ç»„ï¼ˆå¤šé›†ç¾¤åŸŸåå‘ç°ç”¨ï¼‰ ä¸€èˆ¬å¯å¿½ç•¥ TLS é…ç½® tlsTestModeEnable true æµ‹è¯•æ¨¡å¼ä¸‹è·³è¿‡éªŒè¯ï¼ˆä»…ç”¨äºæœ¬åœ°æµ‹è¯•ï¼‰ â—ç”Ÿäº§åº”è®¾ä¸º false tlsKeyPath /conf/tls/rocketmq.key TLS ç§é’¥è·¯å¾„ âœ…æ ¹æ®è¯ä¹¦è·¯å¾„è°ƒæ•´ tlsCertPath /conf/tls/rocketmq.crt TLS è¯ä¹¦è·¯å¾„ âœ…æ ¹æ®è¯ä¹¦è·¯å¾„è°ƒæ•´ gRPC åŸºç¡€ proxyMode CLUSTER Proxy æ¨¡å¼ï¼šCLUSTER / LOCAL / REMOTING âœ…ç”Ÿäº§æ¨è CLUSTER grpcServerPort 8081 gRPC æœåŠ¡ç«¯ç›‘å¬ç«¯å£ è‹¥å†²çªå¯ä¿®æ”¹ grpcShutdownTimeSeconds 30 ä¼˜é›…å…³é—­ç­‰å¾…æ—¶é—´ å¯é€‚å½“è°ƒå¤§ enableGrpcEpoll false å¯ç”¨ Linux epoll I/O æ¨¡å‹ âœ…Linux å»ºè®®å¼€å¯ grpcMaxInboundMessageSize 136314880 (~130MB) æœ€å¤§å…¥ç«™æ¶ˆæ¯å¤§å° æ ¹æ®æ¶ˆæ¯å¤§å°è°ƒæ•´ æ¶ˆæ¯é™åˆ¶ maxMessageSize 4194304 (4MB) æœ€å¤§æ¶ˆæ¯ä½“å¤§å° âœ…åº”ä¸ Broker ä¸€è‡´ enableMessageBodyEmptyCheck true æ ¡éªŒæ¶ˆæ¯ä½“æ˜¯å¦ä¸ºç©º ä¿æŒé»˜è®¤å³å¯ maxUserPropertySize 16384 (16KB) ç”¨æˆ·å±æ€§æœ€å¤§é•¿åº¦ æ ¹æ®ä¸šåŠ¡å¤æ‚åº¦è°ƒæ•´ userPropertyMaxNum 128 å•æ¡æ¶ˆæ¯æœ€å¤§å±æ€§æ•°é‡ å¯é€‚å½“è°ƒä½é˜²æ­¢æ€§èƒ½æŸè€— maxMessageGroupSize 64 æœ€å¤§æ¶ˆæ¯ç»„å¤§å°ï¼ˆæ‰¹é‡ pop ä½¿ç”¨ï¼‰ é»˜è®¤å³å¯ æ¶ˆæ¯å¯è§æ€§ä¸å»¶è¿Ÿ defaultInvisibleTimeMills 60000 (60s) pop æ¶ˆæ¯é»˜è®¤ä¸å¯è§æ—¶é—´ âœ…é«˜å¹¶å‘æ—¶å¯è°ƒä½ maxInvisibleTimeMills 43200000 (12h) æœ€å¤§ä¸å¯è§æ—¶é•¿ âœ…å¯æ ¹æ®ä¸šåŠ¡é™ä½ maxDelayTimeMills 86400000 (1d) æœ€å¤§å»¶è¿Ÿæ—¶é—´ ä¸ Broker ä¿æŒä¸€è‡´ useDelayLevel false æ˜¯å¦ä½¿ç”¨å»¶è¿Ÿç­‰çº§æ¨¡å¼ è‹¥ Broker å¯ç”¨ç­‰çº§å»¶è¿Ÿåˆ™å¼€å¯ messageDelayLevel &quot;1s 5s 10s ... 2h&quot; å»¶è¿Ÿç­‰çº§é…ç½®è¡¨ âœ…éœ€ä¸ broker.conf å¯¹é½ çº¿ç¨‹æ± ï¼ˆgRPC æ¨¡å—ï¼‰ grpcBossLoopNum 1 Netty boss çº¿ç¨‹ é»˜è®¤å³å¯ grpcWorkerLoopNum 4 gRPC worker çº¿ç¨‹ âœ…CPU&gt;4 æ—¶å¯è°ƒé«˜è‡³æ ¸æ•° grpcThreadPoolNums 20 gRPC ä¸šåŠ¡çº¿ç¨‹æ•° âœ…å»ºè®® â‰ˆ CPU æ ¸æ•°Ã—2 grpcThreadPoolQueueCapacity 100000 é˜Ÿåˆ—å®¹é‡ âš ï¸å»ºè®® â‰¤20000ï¼Œé˜² OOM çº¿ç¨‹æ± ï¼ˆå†…éƒ¨æ¨¡å—ï¼‰ producerProcessorThreadPoolNums 2 ç”Ÿäº§è€…å¤„ç†çº¿ç¨‹ âœ…å¯æ ¹æ®QPSè°ƒæ•´ consumerProcessorThreadPoolNums 2 æ¶ˆè´¹è€…å¤„ç†çº¿ç¨‹ åŒä¸Š topicRouteServiceThreadPoolNums 2 è·¯ç”±æœåŠ¡çº¿ç¨‹ é»˜è®¤å³å¯ renewThreadPoolNums 2 è‡ªåŠ¨ç»­æœŸçº¿ç¨‹ é«˜å¹¶å‘æ—¶å¯è°ƒå¤§ ç¼“å­˜é…ç½® topicRouteServiceCacheExpiredSeconds 300 è·¯ç”±ç¼“å­˜æœ‰æ•ˆæœŸ âœ…å¯é€‚å½“è°ƒå¤§ topicConfigCacheExpiredSeconds 300 Topic é…ç½®ç¼“å­˜æœ‰æ•ˆæœŸ åŒä¸Š subscriptionGroupConfigCacheExpiredSeconds 300 è®¢é˜…ç»„ç¼“å­˜æœ‰æ•ˆæœŸ åŒä¸Š aclCacheExpiredSeconds 300 ACL ç¼“å­˜æœ‰æ•ˆæœŸ âœ…åŒä¸Š äº‹åŠ¡ä¸å¿ƒè·³ transactionHeartbeatThreadPoolNums 20 äº‹åŠ¡å¿ƒè·³çº¿ç¨‹æ•° âœ…æ ¹æ®äº‹åŠ¡é‡è°ƒæ•´ transactionHeartbeatPeriodSecond 20 äº‹åŠ¡å¿ƒè·³å‘¨æœŸ é»˜è®¤å³å¯ transactionDataExpireMillis 30000 äº‹åŠ¡æ•°æ®è¿‡æœŸæ—¶é—´ é»˜è®¤å³å¯ æŒ‡æ ‡ä¸ç›‘æ§ metricsExporterType DISABLE æŒ‡æ ‡å¯¼å‡ºæ–¹å¼ï¼šDISABLE / PROM / GRPC / LOG âœ…å»ºè®®å¯ç”¨ PROM metricsPromExporterPort 5557 Prometheus å¯¼å‡ºç«¯å£ âœ…å»ºè®®æš´éœ²ç›‘æ§ metricsInDelta false æ˜¯å¦æŒ‰å¢é‡å¯¼å‡ºæŒ‡æ ‡ é»˜è®¤å³å¯ Remoting æ¨¡å¼ enableRemotingLocalProxyGrpc true å¯ç”¨æœ¬åœ° Proxy gRPC è½¬å‘ é»˜è®¤å³å¯ remotingListenPort 8080 Remoting é€šä¿¡ç«¯å£ è‹¥å†²çªä¿®æ”¹ sendLatencyEnable false å¯ç”¨å‘é€å»¶è¿Ÿæ¢æµ‹ï¼ˆLoadBalance ä¼˜åŒ–ï¼‰ âœ…å»ºè®®å¼€å¯ startDetectorEnable false å¯ç”¨å¯åŠ¨æ¢æµ‹åŠŸèƒ½ å¯é€‰ï¼Œæµ‹è¯•é˜¶æ®µä½¿ç”¨ å¯è§‚æµ‹æ€§ traceOn false å¯ç”¨é“¾è·¯è¿½è¸ª âœ…å»ºè®®å¼€å¯ enablePrintJstack true æ‰“å°çº¿ç¨‹å †æ ˆï¼ˆç”¨äºè¯Šæ–­ï¼‰ âœ…å¯å»¶é•¿å‘¨æœŸå‡å°‘æ—¥å¿— ç»¼åˆä¼˜åŒ–å»ºè®® æ–¹å‘ å»ºè®® æ€§èƒ½è°ƒä¼˜ å¯ç”¨ enableGrpcEpoll=trueï¼›åˆç†é…ç½®çº¿ç¨‹æ± ï¼ˆå¦‚å‡å°‘é˜Ÿåˆ—é•¿åº¦ï¼‰ï¼›è®¾ç½®åˆé€‚çš„ grpcThreadPoolNumsã€‚ å¯é æ€§ å¼€å¯ traceOn ä¸ sendLatencyEnable ç›‘æ§ï¼›ä½¿ç”¨ Prometheus æŒ‡æ ‡å¯¼å‡ºã€‚ å®‰å…¨æ€§ ç¦ç”¨ tlsTestModeEnableï¼Œä½¿ç”¨çœŸå® TLS è¯ä¹¦ã€‚ èµ„æºç®¡ç† é™åˆ¶ç¼“å­˜æ•°é‡ï¼ˆå¦‚ topic/user/aclï¼‰å’Œçº¿ç¨‹é˜Ÿåˆ—å®¹é‡ï¼Œé˜²æ­¢å†…å­˜è†¨èƒ€ã€‚ å¯ç»´æŠ¤æ€§ ä½¿ç”¨ç‹¬ç«‹çš„ proxyClusterNameï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶ rmq-proxy.json ä¸­æ˜ç¡®å„é¡¹ç«¯å£å’Œè·¯å¾„ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ Proxy çš„é…ç½®é¡¹ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚","date_published":"2025-10-28T13:33:05.000Z","tags":["æŠ€æœ¯","rocketmq","åˆ†å¸ƒå¼","rocketmq"]},{"id":"https://blog.hanqunfeng.com/2025/10/28/rocketmq-05-controller-config/","url":"https://blog.hanqunfeng.com/2025/10/28/rocketmq-05-controller-config/","title":"RocketMQ Controller çš„é…ç½®é¡¹","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RocketMQ Controller çš„é…ç½®é¡¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/\">RocketMQå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"æŸ¥çœ‹-Controller-é…ç½®é¡¹\">æŸ¥çœ‹ Controller é…ç½®é¡¹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹</span></span><br><span class=\"line\">sh bin/mqcontroller -p</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„å…¨éƒ¨é…ç½®é¡¹</span></span><br><span class=\"line\">sh bin/mqcontroller -p -c conf/broker.conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹\">é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨æºç  <code>rocketmq-all-5.3.2-source-release/controller</code> çš„å¯åŠ¨ç±» <code>org.apache.rocketmq.controller.ControllerStartup</code>ä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±»</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">ControllerConfig</span> <span class=\"variable\">controllerConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ControllerConfig</span>();</span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">JraftConfig</span> <span class=\"variable\">jraftConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JraftConfig</span>();</span><br><span class=\"line\">controllerConfig.setJraftConfig(jraftConfig);</span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">NettyServerConfig</span> <span class=\"variable\">nettyServerConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NettyServerConfig</span>();</span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">NettyClientConfig</span> <span class=\"variable\">nettyClientConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NettyClientConfig</span>();</span><br><span class=\"line\">nettyServerConfig.setListenPort(<span class=\"number\">19876</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®é¡¹è¯´æ˜\">é…ç½®é¡¹è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Controller é…ç½®å‚æ•°è¯´æ˜ä¸ä¼˜åŒ–å»ºè®®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">åˆ†ç±»</th>\n<th style=\"text-align:left\">å‚æ•°å</th>\n<th style=\"text-align:left\">é»˜è®¤å€¼</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n<th style=\"text-align:left\">ä¼˜åŒ– / å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>åŸºç¡€ä¿¡æ¯</strong></td>\n<td style=\"text-align:left\"><code>rocketmqHome</code></td>\n<td style=\"text-align:left\">/usr/local/soft/rocketmq/rocketmq5</td>\n<td style=\"text-align:left\">RocketMQ æ ¹è·¯å¾„</td>\n<td style=\"text-align:left\">ä¿æŒé»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>configStorePath</code></td>\n<td style=\"text-align:left\">/root/controller/controller.properties</td>\n<td style=\"text-align:left\">Controller é…ç½®æ–‡ä»¶è·¯å¾„</td>\n<td style=\"text-align:left\">âœ… æ”¹ä¸º <code>/data/rocketmq/controller/controller.properties</code>ï¼Œé¿å…ä½¿ç”¨ <code>/root</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>controllerType</code></td>\n<td style=\"text-align:left\">DLedger</td>\n<td style=\"text-align:left\">Controller ç±»å‹ï¼ˆDLedger / STANDALONEï¼‰</td>\n<td style=\"text-align:left\">âœ… å»ºè®®ä½¿ç”¨ DLedgerï¼ˆé«˜å¯ç”¨ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>controllerStorePath</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">Controller å…ƒæ•°æ®å­˜å‚¨è·¯å¾„</td>\n<td style=\"text-align:left\">âœ… å»ºè®® <code>/data/rocketmq/controller/store</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>DLedger é€‰ä¸¾é…ç½®</strong></td>\n<td style=\"text-align:left\"><code>controllerDLegerGroup</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">Controller é›†ç¾¤ç»„å</td>\n<td style=\"text-align:left\">âœ… å¿…å¡«ï¼Œä¾‹å¦‚ï¼š<code>controllerGroup01</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>controllerDLegerPeers</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ ¼å¼ï¼š<code>n0-10.0.0.1:19876;n1-10.0.0.2:19876;n2-10.0.0.3:19876</code></td>\n<td style=\"text-align:left\">âœ… å¿…å¡«ï¼ˆ3 èŠ‚ç‚¹æ¨èï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>controllerDLegerSelfId</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">å½“å‰èŠ‚ç‚¹ IDï¼Œå¦‚ <code>n0</code></td>\n<td style=\"text-align:left\">âœ… å¿…å¡«</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>mappedFileSize</code></td>\n<td style=\"text-align:left\">1073741824</td>\n<td style=\"text-align:left\">DLedger å­˜å‚¨æ–‡ä»¶å¤§å° (1GB)</td>\n<td style=\"text-align:left\">å¯ä¿æŒé»˜è®¤</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>electMasterMaxRetryCount</code></td>\n<td style=\"text-align:left\">3</td>\n<td style=\"text-align:left\">Master é€‰ä¸¾æœ€å¤§é‡è¯•æ¬¡æ•°</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>enableElectUncleanMaster</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å…è®¸é€‰ä¸¾éåŒæ­¥ Master</td>\n<td style=\"text-align:left\">âœ… å»ºè®®ä¿æŒ falseï¼ˆé¿å…æ•°æ®ä¸¢å¤±ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Broker ç®¡ç†</strong></td>\n<td style=\"text-align:left\"><code>scanNotActiveBrokerInterval</code></td>\n<td style=\"text-align:left\">5000</td>\n<td style=\"text-align:left\">æ‰«æä¸æ´»è·ƒ Broker çš„é—´éš”(ms)</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>scanInactiveMasterInterval</code></td>\n<td style=\"text-align:left\">5000</td>\n<td style=\"text-align:left\">æ£€æµ‹å¤±æ´» Master é—´éš”(ms)</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>notifyBrokerRoleChanged</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦é€šçŸ¥ Broker è§’è‰²å˜æ›´</td>\n<td style=\"text-align:left\">âœ… å»ºè®®å¼€å¯ï¼ˆä¿æŒåŒæ­¥ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>isProcessReadEvent</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¤„ç†è¯»äº‹ä»¶</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>çº¿ç¨‹ä¸æ€§èƒ½</strong></td>\n<td style=\"text-align:left\"><code>controllerThreadPoolNums</code></td>\n<td style=\"text-align:left\">16</td>\n<td style=\"text-align:left\">æ§åˆ¶çº¿ç¨‹æ± å¤§å°</td>\n<td style=\"text-align:left\">å¯è°ƒè‡³ 8â€“32 è§†è§„æ¨¡è€Œå®š</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>controllerRequestThreadPoolQueueCapacity</code></td>\n<td style=\"text-align:left\">50000</td>\n<td style=\"text-align:left\">æ§åˆ¶çº¿ç¨‹æ± é˜Ÿåˆ—å®¹é‡</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Metrics ç›‘æ§</strong></td>\n<td style=\"text-align:left\"><code>metricsExporterType</code></td>\n<td style=\"text-align:left\">DISABLE</td>\n<td style=\"text-align:left\">æŒ‡æ ‡è¾“å‡ºæ–¹å¼ï¼ˆDISABLE / PROM / GRPC / LOGï¼‰</td>\n<td style=\"text-align:left\">âœ… å»ºè®®è®¾ä¸º <code>PROM</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>metricsPromExporterPort</code></td>\n<td style=\"text-align:left\">5557</td>\n<td style=\"text-align:left\">Prometheus ç«¯å£</td>\n<td style=\"text-align:left\">âœ… è‹¥å¯ç”¨ç›‘æ§ï¼Œå¯ç”¨é»˜è®¤ 5557</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>metricsPromExporterHost</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">Prometheus ç»‘å®šä¸»æœº</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>metricLoggingExporterIntervalInMills</code></td>\n<td style=\"text-align:left\">10000</td>\n<td style=\"text-align:left\">æ—¥å¿—è¾“å‡ºæŒ‡æ ‡é—´éš”</td>\n<td style=\"text-align:left\">å¯è°ƒæ•´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>metricsGrpcExporterTarget</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">gRPC ç›‘æ§ç›®æ ‡</td>\n<td style=\"text-align:left\">å¯å¿½ç•¥</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>metricsInDelta</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦ä»¥å¢é‡è¾“å‡ºæŒ‡æ ‡</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>JRaft é…ç½®ï¼ˆåº•å±‚ä¸€è‡´æ€§åè®®ï¼‰</strong></td>\n<td style=\"text-align:left\"><code>jRaftGroupId</code></td>\n<td style=\"text-align:left\">jRaft-Controller</td>\n<td style=\"text-align:left\">Raft ç»„å</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>jRaftServerId</code></td>\n<td style=\"text-align:left\">localhost:9880</td>\n<td style=\"text-align:left\">å½“å‰èŠ‚ç‚¹ ID</td>\n<td style=\"text-align:left\">âœ… ä¿®æ”¹ä¸ºå®é™… IPï¼Œä¾‹å¦‚ <code>10.0.0.1:9880</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>jRaftInitConf</code></td>\n<td style=\"text-align:left\">localhost:9880,localhost:9881,localhost:9882</td>\n<td style=\"text-align:left\">é›†ç¾¤é…ç½®</td>\n<td style=\"text-align:left\">âœ… ä¿®æ”¹ä¸ºå®é™…èŠ‚ç‚¹ IP</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>jRaftControllerRPCAddr</code></td>\n<td style=\"text-align:left\">localhost:9770,localhost:9771,localhost:9772</td>\n<td style=\"text-align:left\">Controller RPC åœ°å€</td>\n<td style=\"text-align:left\">âœ… ä¿®æ”¹ä¸ºå®é™…èŠ‚ç‚¹ IP</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>jRaftElectionTimeoutMs</code></td>\n<td style=\"text-align:left\">1000</td>\n<td style=\"text-align:left\">é€‰ä¸¾è¶…æ—¶ï¼ˆmsï¼‰</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯ï¼ˆè¿‡ä½å¯èƒ½é¢‘ç¹é€‰ä¸¾ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>jRaftScanWaitTimeoutMs</code></td>\n<td style=\"text-align:left\">1000</td>\n<td style=\"text-align:left\">æ‰«æç­‰å¾…è¶…æ—¶</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>jRaftSnapshotIntervalSecs</code></td>\n<td style=\"text-align:left\">3600</td>\n<td style=\"text-align:left\">å¿«ç…§é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰</td>\n<td style=\"text-align:left\">âœ… å¯è®¾ä¸º 600ï¼ˆ10åˆ†é’Ÿï¼‰åŠ å¿«æ—¥å¿—å‹ç¼©</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>ç½‘ç»œé…ç½®</strong></td>\n<td style=\"text-align:left\"><code>bindAddress</code></td>\n<td style=\"text-align:left\">0.0.0.0</td>\n<td style=\"text-align:left\">ç»‘å®šç›‘å¬åœ°å€</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>listenPort</code></td>\n<td style=\"text-align:left\">19876</td>\n<td style=\"text-align:left\">Controller æœåŠ¡ç«¯å£</td>\n<td style=\"text-align:left\">âœ… ç¡®ä¿æœªå†²çª</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>serverWorkerThreads</code></td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">Netty å·¥ä½œçº¿ç¨‹</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>serverSelectorThreads</code></td>\n<td style=\"text-align:left\">3</td>\n<td style=\"text-align:left\">Selector çº¿ç¨‹æ•°</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>serverSocketBacklog</code></td>\n<td style=\"text-align:left\">1024</td>\n<td style=\"text-align:left\">Socket backlog é˜Ÿåˆ—</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>useEpollNativeSelector</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦ä½¿ç”¨ Epoll</td>\n<td style=\"text-align:left\">âœ… Linux ç¯å¢ƒå»ºè®® true</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>enableShutdownGracefully</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">ä¼˜é›…åœæœº</td>\n<td style=\"text-align:left\">âœ… å»ºè®® true</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å®¢æˆ·ç«¯é€šä¿¡</strong></td>\n<td style=\"text-align:left\"><code>clientWorkerThreads</code></td>\n<td style=\"text-align:left\">4</td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯å·¥ä½œçº¿ç¨‹</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>clientAsyncSemaphoreValue</code></td>\n<td style=\"text-align:left\">65535</td>\n<td style=\"text-align:left\">å¼‚æ­¥è¯·æ±‚ä¿¡å·é‡</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>clientCloseSocketIfTimeout</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">è¿æ¥è¶…æ—¶å…³é—­</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>connectTimeoutMillis</code></td>\n<td style=\"text-align:left\">3000</td>\n<td style=\"text-align:left\">è¿æ¥è¶…æ—¶</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>useTLS</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨ TLS</td>\n<td style=\"text-align:left\">âœ… è‹¥ç”Ÿäº§ç¯å¢ƒæœ‰å®‰å…¨è¦æ±‚ï¼Œå»ºè®®å¯ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å…¶ä»–</strong></td>\n<td style=\"text-align:left\"><code>configBlackList</code></td>\n<td style=\"text-align:left\">configBlackList;configStorePath</td>\n<td style=\"text-align:left\">é…ç½®é»‘åå•é¡¹</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>maxReconnectIntervalTimeSeconds</code></td>\n<td style=\"text-align:left\">60</td>\n<td style=\"text-align:left\">æœ€å¤§é‡è¿é—´éš”</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>enableReconnectForGoAway</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦ä¸º GOAWAY è¿æ¥å¯ç”¨é‡è¿</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¨èé‡ç‚¹ä¼˜åŒ–çš„å…³é”®é¡¹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">é¡¹ç›®</th>\n<th style=\"text-align:left\">æ¨èå€¼</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>controllerType</code></td>\n<td style=\"text-align:left\">DLedger</td>\n<td style=\"text-align:left\">é«˜å¯ç”¨æ¨¡å¼</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>controllerDLegerGroup</code></td>\n<td style=\"text-align:left\">controllerGroup01</td>\n<td style=\"text-align:left\">é›†ç¾¤åˆ†ç»„å</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>controllerDLegerPeers</code></td>\n<td style=\"text-align:left\"><code>n0-10.0.0.1:19876;n1-10.0.0.2:19876;n2-10.0.0.3:19876</code></td>\n<td style=\"text-align:left\">ä¸‰èŠ‚ç‚¹æ¨è</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>controllerDLegerSelfId</code></td>\n<td style=\"text-align:left\">n0 / n1 / n2</td>\n<td style=\"text-align:left\">å¯¹åº”èŠ‚ç‚¹ ID</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>enableElectUncleanMaster</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">é˜²æ­¢è„ä¸»é€‰ä¸¾</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>notifyBrokerRoleChanged</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">ä¿æŒé›†ç¾¤ä¸€è‡´æ€§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>metricsExporterType</code></td>\n<td style=\"text-align:left\">PROM</td>\n<td style=\"text-align:left\">ä¾¿äº Prometheus ç›‘æ§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>metricsPromExporterPort</code></td>\n<td style=\"text-align:left\">5557</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>useEpollNativeSelector</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">Linux æ€§èƒ½ä¼˜åŒ–</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>enableShutdownGracefully</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">ä¼˜é›…åœæœº</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>controllerStorePath</code></td>\n<td style=\"text-align:left\">/data/rocketmq/controller/store</td>\n<td style=\"text-align:left\">é¿å…ä½¿ç”¨ <code>/root</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>jRaftSnapshotIntervalSecs</code></td>\n<td style=\"text-align:left\">600</td>\n<td style=\"text-align:left\">æé«˜å¿«ç…§é¢‘ç‡</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ Controller çš„é…ç½®é¡¹ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚ æŸ¥çœ‹ Controller é…ç½®é¡¹ æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹ 1234# æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹sh bin/mqcontroller -p# æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„å…¨éƒ¨é…ç½®é¡¹sh bin/mqcontroller -p -c conf/broker.conf é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹ åœ¨æºç  rocketmq-all-5.3.2-source-release/controller çš„å¯åŠ¨ç±» org.apache.rocketmq.controller.ControllerStartupä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±» 123456final ControllerConfig controllerConfig = new ControllerConfig();final JraftConfig jraftConfig = new JraftConfig();controllerConfig.setJraftConfig(jraftConfig);final NettyServerConfig nettyServerConfig = new NettyServerConfig();final NettyClientConfig nettyClientConfig = new NettyClientConfig();nettyServerConfig.setListenPort(19876); é…ç½®é¡¹è¯´æ˜ Controller é…ç½®å‚æ•°è¯´æ˜ä¸ä¼˜åŒ–å»ºè®® åˆ†ç±» å‚æ•°å é»˜è®¤å€¼ è¯´æ˜ ä¼˜åŒ– / å»ºè®® åŸºç¡€ä¿¡æ¯ rocketmqHome /usr/local/soft/rocketmq/rocketmq5 RocketMQ æ ¹è·¯å¾„ ä¿æŒé»˜è®¤å³å¯ configStorePath /root/controller/controller.properties Controller é…ç½®æ–‡ä»¶è·¯å¾„ âœ… æ”¹ä¸º /data/rocketmq/controller/controller.propertiesï¼Œé¿å…ä½¿ç”¨ /root controllerType DLedger Controller ç±»å‹ï¼ˆDLedger / STANDALONEï¼‰ âœ… å»ºè®®ä½¿ç”¨ DLedgerï¼ˆé«˜å¯ç”¨ï¼‰ controllerStorePath (ç©º) Controller å…ƒæ•°æ®å­˜å‚¨è·¯å¾„ âœ… å»ºè®® /data/rocketmq/controller/store DLedger é€‰ä¸¾é…ç½® controllerDLegerGroup (ç©º) Controller é›†ç¾¤ç»„å âœ… å¿…å¡«ï¼Œä¾‹å¦‚ï¼šcontrollerGroup01 controllerDLegerPeers (ç©º) é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ ¼å¼ï¼šn0-10.0.0.1:19876;n1-10.0.0.2:19876;n2-10.0.0.3:19876 âœ… å¿…å¡«ï¼ˆ3 èŠ‚ç‚¹æ¨èï¼‰ controllerDLegerSelfId (ç©º) å½“å‰èŠ‚ç‚¹ IDï¼Œå¦‚ n0 âœ… å¿…å¡« mappedFileSize 1073741824 DLedger å­˜å‚¨æ–‡ä»¶å¤§å° (1GB) å¯ä¿æŒé»˜è®¤ electMasterMaxRetryCount 3 Master é€‰ä¸¾æœ€å¤§é‡è¯•æ¬¡æ•° é»˜è®¤å³å¯ enableElectUncleanMaster false æ˜¯å¦å…è®¸é€‰ä¸¾éåŒæ­¥ Master âœ… å»ºè®®ä¿æŒ falseï¼ˆé¿å…æ•°æ®ä¸¢å¤±ï¼‰ Broker ç®¡ç† scanNotActiveBrokerInterval 5000 æ‰«æä¸æ´»è·ƒ Broker çš„é—´éš”(ms) é»˜è®¤å³å¯ scanInactiveMasterInterval 5000 æ£€æµ‹å¤±æ´» Master é—´éš”(ms) é»˜è®¤å³å¯ notifyBrokerRoleChanged true æ˜¯å¦é€šçŸ¥ Broker è§’è‰²å˜æ›´ âœ… å»ºè®®å¼€å¯ï¼ˆä¿æŒåŒæ­¥ï¼‰ isProcessReadEvent false æ˜¯å¦å¤„ç†è¯»äº‹ä»¶ é»˜è®¤å³å¯ çº¿ç¨‹ä¸æ€§èƒ½ controllerThreadPoolNums 16 æ§åˆ¶çº¿ç¨‹æ± å¤§å° å¯è°ƒè‡³ 8â€“32 è§†è§„æ¨¡è€Œå®š controllerRequestThreadPoolQueueCapacity 50000 æ§åˆ¶çº¿ç¨‹æ± é˜Ÿåˆ—å®¹é‡ é»˜è®¤å³å¯ Metrics ç›‘æ§ metricsExporterType DISABLE æŒ‡æ ‡è¾“å‡ºæ–¹å¼ï¼ˆDISABLE / PROM / GRPC / LOGï¼‰ âœ… å»ºè®®è®¾ä¸º PROM metricsPromExporterPort 5557 Prometheus ç«¯å£ âœ… è‹¥å¯ç”¨ç›‘æ§ï¼Œå¯ç”¨é»˜è®¤ 5557 metricsPromExporterHost (ç©º) Prometheus ç»‘å®šä¸»æœº é»˜è®¤å³å¯ metricLoggingExporterIntervalInMills 10000 æ—¥å¿—è¾“å‡ºæŒ‡æ ‡é—´éš” å¯è°ƒæ•´ metricsGrpcExporterTarget (ç©º) gRPC ç›‘æ§ç›®æ ‡ å¯å¿½ç•¥ metricsInDelta false æ˜¯å¦ä»¥å¢é‡è¾“å‡ºæŒ‡æ ‡ é»˜è®¤å³å¯ JRaft é…ç½®ï¼ˆåº•å±‚ä¸€è‡´æ€§åè®®ï¼‰ jRaftGroupId jRaft-Controller Raft ç»„å é»˜è®¤å³å¯ jRaftServerId localhost:9880 å½“å‰èŠ‚ç‚¹ ID âœ… ä¿®æ”¹ä¸ºå®é™… IPï¼Œä¾‹å¦‚ 10.0.0.1:9880 jRaftInitConf localhost:9880,localhost:9881,localhost:9882 é›†ç¾¤é…ç½® âœ… ä¿®æ”¹ä¸ºå®é™…èŠ‚ç‚¹ IP jRaftControllerRPCAddr localhost:9770,localhost:9771,localhost:9772 Controller RPC åœ°å€ âœ… ä¿®æ”¹ä¸ºå®é™…èŠ‚ç‚¹ IP jRaftElectionTimeoutMs 1000 é€‰ä¸¾è¶…æ—¶ï¼ˆmsï¼‰ é»˜è®¤å³å¯ï¼ˆè¿‡ä½å¯èƒ½é¢‘ç¹é€‰ä¸¾ï¼‰ jRaftScanWaitTimeoutMs 1000 æ‰«æç­‰å¾…è¶…æ—¶ é»˜è®¤å³å¯ jRaftSnapshotIntervalSecs 3600 å¿«ç…§é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰ âœ… å¯è®¾ä¸º 600ï¼ˆ10åˆ†é’Ÿï¼‰åŠ å¿«æ—¥å¿—å‹ç¼© ç½‘ç»œé…ç½® bindAddress 0.0.0.0 ç»‘å®šç›‘å¬åœ°å€ é»˜è®¤å³å¯ listenPort 19876 Controller æœåŠ¡ç«¯å£ âœ… ç¡®ä¿æœªå†²çª serverWorkerThreads 8 Netty å·¥ä½œçº¿ç¨‹ é»˜è®¤å³å¯ serverSelectorThreads 3 Selector çº¿ç¨‹æ•° é»˜è®¤å³å¯ serverSocketBacklog 1024 Socket backlog é˜Ÿåˆ— é»˜è®¤å³å¯ useEpollNativeSelector false æ˜¯å¦ä½¿ç”¨ Epoll âœ… Linux ç¯å¢ƒå»ºè®® true enableShutdownGracefully false ä¼˜é›…åœæœº âœ… å»ºè®® true å®¢æˆ·ç«¯é€šä¿¡ clientWorkerThreads 4 å®¢æˆ·ç«¯å·¥ä½œçº¿ç¨‹ é»˜è®¤å³å¯ clientAsyncSemaphoreValue 65535 å¼‚æ­¥è¯·æ±‚ä¿¡å·é‡ é»˜è®¤å³å¯ clientCloseSocketIfTimeout true è¿æ¥è¶…æ—¶å…³é—­ é»˜è®¤å³å¯ connectTimeoutMillis 3000 è¿æ¥è¶…æ—¶ é»˜è®¤å³å¯ useTLS false æ˜¯å¦å¯ç”¨ TLS âœ… è‹¥ç”Ÿäº§ç¯å¢ƒæœ‰å®‰å…¨è¦æ±‚ï¼Œå»ºè®®å¯ç”¨ å…¶ä»– configBlackList configBlackList;configStorePath é…ç½®é»‘åå•é¡¹ é»˜è®¤å³å¯ maxReconnectIntervalTimeSeconds 60 æœ€å¤§é‡è¿é—´éš” é»˜è®¤å³å¯ enableReconnectForGoAway true æ˜¯å¦ä¸º GOAWAY è¿æ¥å¯ç”¨é‡è¿ é»˜è®¤å³å¯ æ¨èé‡ç‚¹ä¼˜åŒ–çš„å…³é”®é¡¹ é¡¹ç›® æ¨èå€¼ è¯´æ˜ controllerType DLedger é«˜å¯ç”¨æ¨¡å¼ controllerDLegerGroup controllerGroup01 é›†ç¾¤åˆ†ç»„å controllerDLegerPeers n0-10.0.0.1:19876;n1-10.0.0.2:19876;n2-10.0.0.3:19876 ä¸‰èŠ‚ç‚¹æ¨è controllerDLegerSelfId n0 / n1 / n2 å¯¹åº”èŠ‚ç‚¹ ID enableElectUncleanMaster false é˜²æ­¢è„ä¸»é€‰ä¸¾ notifyBrokerRoleChanged true ä¿æŒé›†ç¾¤ä¸€è‡´æ€§ metricsExporterType PROM ä¾¿äº Prometheus ç›‘æ§ metricsPromExporterPort 5557 é»˜è®¤å³å¯ useEpollNativeSelector true Linux æ€§èƒ½ä¼˜åŒ– enableShutdownGracefully true ä¼˜é›…åœæœº controllerStorePath /data/rocketmq/controller/store é¿å…ä½¿ç”¨ /root jRaftSnapshotIntervalSecs 600 æé«˜å¿«ç…§é¢‘ç‡","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ Controller çš„é…ç½®é¡¹ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚","date_published":"2025-10-28T13:32:05.000Z","tags":["æŠ€æœ¯","rocketmq","åˆ†å¸ƒå¼","rocketmq"]},{"id":"https://blog.hanqunfeng.com/2025/10/28/rocketmq-04-broker-config/","url":"https://blog.hanqunfeng.com/2025/10/28/rocketmq-04-broker-config/","title":"RocketMQ Broker çš„é…ç½®é¡¹","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RocketMQ Broker çš„é…ç½®é¡¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/\">RocketMQå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"æŸ¥çœ‹-Broker-é…ç½®é¡¹\">æŸ¥çœ‹ Broker é…ç½®é¡¹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹</span></span><br><span class=\"line\">sh bin/mqbroker -p</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„å…¨éƒ¨é…ç½®é¡¹</span></span><br><span class=\"line\">sh bin/mqbroker -p -c conf/broker.conf</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹é‡è¦çš„é…ç½®é¡¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é‡è¦çš„é»˜è®¤é…ç½®é¡¹</span></span><br><span class=\"line\">sh bin/mqbroker -m</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„é‡è¦é…ç½®é¡¹</span></span><br><span class=\"line\">sh bin/mqbroker -m -c conf/broker.conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹\">é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨æºç  <code>rocketmq-all-5.3.2-source-release/broker</code> çš„å¯åŠ¨ç±» <code>org.apache.rocketmq.broker.BrokerStartup</code>ä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±»</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">BrokerConfig</span> <span class=\"variable\">brokerConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BrokerConfig</span>();</span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">NettyServerConfig</span> <span class=\"variable\">nettyServerConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NettyServerConfig</span>();</span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">NettyClientConfig</span> <span class=\"variable\">nettyClientConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NettyClientConfig</span>();</span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">MessageStoreConfig</span> <span class=\"variable\">messageStoreConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MessageStoreConfig</span>();</span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">AuthConfig</span> <span class=\"variable\">authConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AuthConfig</span>();</span><br><span class=\"line\">nettyServerConfig.setListenPort(<span class=\"number\">10911</span>);</span><br><span class=\"line\">messageStoreConfig.setHaListenPort(<span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®é¡¹è¯´æ˜\">é…ç½®é¡¹è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Brokerçš„å…¨éƒ¨é…ç½®é¡¹éå¸¸å¤šï¼Œè¿™é‡Œä»…åˆ—å‡ºäº†é‡è¦çš„é…ç½®é¡¹ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">åˆ†ç±»</th>\n<th style=\"text-align:left\">å‚æ•°å</th>\n<th style=\"text-align:left\">é»˜è®¤å€¼</th>\n<th style=\"text-align:left\">å‚æ•°è¯´æ˜</th>\n<th style=\"text-align:left\">ä¼˜åŒ– / å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>åŸºç¡€é…ç½®</strong></td>\n<td style=\"text-align:left\"><code>namesrvAddr</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">NameServer åœ°å€åˆ—è¡¨ï¼ˆå¤šä¸ªç”¨ <code>;</code> åˆ†éš”ï¼‰</td>\n<td style=\"text-align:left\">âœ… <strong>å¿…é¡»è®¾ç½®</strong>ï¼Œå¦åˆ™ broker æ— æ³•æ³¨å†Œåˆ° nameserverã€‚ä¾‹ï¼š<code>namesrvAddr=10.250.0.10:9876;10.250.0.11:9876</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>listenPort</code></td>\n<td style=\"text-align:left\">6888</td>\n<td style=\"text-align:left\">Broker ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£</td>\n<td style=\"text-align:left\">âœ… å»ºè®®ä¿æŒé»˜è®¤æˆ–æ˜¾å¼è®¾ç½®ä¸º 10911ï¼ˆç»å…¸ç«¯å£ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>brokerIP1</code></td>\n<td style=\"text-align:left\">10.250.0.188</td>\n<td style=\"text-align:left\">Broker å¯¹å¤–é€šä¿¡ IP</td>\n<td style=\"text-align:left\">âœ… åœ¨å¤šç½‘å¡ç¯å¢ƒåŠ¡å¿…æŒ‡å®šå…¬ç½‘/å†…ç½‘ IP</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>recoverConcurrently</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¹¶å‘æ¢å¤ CommitLog</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯ï¼ˆé«˜å®‰å…¨æ€§ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Topic &amp; è®¢é˜…</strong></td>\n<td style=\"text-align:left\"><code>autoCreateTopicEnable</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topic</td>\n<td style=\"text-align:left\">âœ… ç”Ÿäº§å»ºè®®è®¾ä¸º <strong>false</strong>ï¼Œé˜²æ­¢è¯¯åˆ›å»º</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>autoCreateSubscriptionGroup</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„</td>\n<td style=\"text-align:left\">âœ… åŒä¸Šï¼Œå»ºè®® <strong>false</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>msgTraceTopicName</code></td>\n<td style=\"text-align:left\">RMQ_SYS_TRACE_TOPIC</td>\n<td style=\"text-align:left\">æ¶ˆæ¯è½¨è¿¹ä¸»é¢˜å</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>traceTopicEnable</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¼€å¯æ¶ˆæ¯è½¨è¿¹åŠŸèƒ½</td>\n<td style=\"text-align:left\">âœ… å»ºè®®è®¾ä¸º <strong>true</strong> ä»¥ä¾¿é—®é¢˜æ’æŸ¥</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>äº‹åŠ¡æ¶ˆæ¯</strong></td>\n<td style=\"text-align:left\"><code>rejectTransactionMessage</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦æ‹’ç»äº‹åŠ¡æ¶ˆæ¯</td>\n<td style=\"text-align:left\">è‹¥ä¸ä½¿ç”¨äº‹åŠ¡å¯è®¾ä¸º true å‡å°‘è´Ÿæ‹…</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>transactionTimeOut</code></td>\n<td style=\"text-align:left\">6000</td>\n<td style=\"text-align:left\">äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>transactionCheckMax</code></td>\n<td style=\"text-align:left\">15</td>\n<td style=\"text-align:left\">äº‹åŠ¡æœ€å¤§å›æŸ¥æ¬¡æ•°</td>\n<td style=\"text-align:left\">å¯è°ƒé«˜ï¼ˆ20ï¼‰æé«˜å¯é æ€§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>transactionCheckInterval</code></td>\n<td style=\"text-align:left\">30000</td>\n<td style=\"text-align:left\">äº‹åŠ¡å›æŸ¥é—´éš”ï¼ˆmsï¼‰</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>è®¿é—®æ§åˆ¶</strong></td>\n<td style=\"text-align:left\"><code>aclEnable</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨ ACL æƒé™éªŒè¯</td>\n<td style=\"text-align:left\">âœ… ç”Ÿäº§ç¯å¢ƒ <strong>å¿…é¡» true</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å­˜å‚¨è·¯å¾„</strong></td>\n<td style=\"text-align:left\"><code>storePathRootDir</code></td>\n<td style=\"text-align:left\">/root/store</td>\n<td style=\"text-align:left\">æ¶ˆæ¯å­˜å‚¨æ ¹ç›®å½•</td>\n<td style=\"text-align:left\">âœ… æ”¹ä¸º <code>/data/rocketmq/store</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>storePathCommitLog</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">CommitLog å­˜å‚¨è·¯å¾„</td>\n<td style=\"text-align:left\">è‹¥ä¸ºç©ºåˆ™ä½¿ç”¨ä¸Šé¢çš„æ ¹ç›®å½•</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>storePathDLedgerCommitLog</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">DLedger æ¨¡å¼å­˜å‚¨è·¯å¾„</td>\n<td style=\"text-align:left\">DLedger æ¨¡å¼æ‰éœ€è¦</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>storePathEpochFile</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">epoch æ–‡ä»¶è·¯å¾„</td>\n<td style=\"text-align:left\">Controller æ¨¡å¼ä½¿ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>storePathBrokerIdentity</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">Broker èº«ä»½æ–‡ä»¶è·¯å¾„</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>disappearTimeAfterStart</code></td>\n<td style=\"text-align:left\">-1</td>\n<td style=\"text-align:left\">Broker å¯åŠ¨åå¤±æ•ˆç­‰å¾…æ—¶é—´</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>storeType</code></td>\n<td style=\"text-align:left\">default</td>\n<td style=\"text-align:left\">å­˜å‚¨ç±»å‹ï¼ˆdefault / dledgerï¼‰</td>\n<td style=\"text-align:left\">âœ… å¤šå‰¯æœ¬éƒ¨ç½²å»ºè®® dledger</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>åˆ·ç›˜ä¸å†™å…¥</strong></td>\n<td style=\"text-align:left\"><code>flushIntervalCommitLog</code></td>\n<td style=\"text-align:left\">500</td>\n<td style=\"text-align:left\">å¼‚æ­¥ flush å‘¨æœŸï¼ˆmsï¼‰</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>commitIntervalCommitLog</code></td>\n<td style=\"text-align:left\">200</td>\n<td style=\"text-align:left\">commit é—´éš”</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>flushCommitLogTimed</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦å®šæ—¶ flush</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>æ–‡ä»¶æ¸…ç†</strong></td>\n<td style=\"text-align:left\"><code>deleteWhen</code></td>\n<td style=\"text-align:left\">04</td>\n<td style=\"text-align:left\">åˆ é™¤è¿‡æœŸæ–‡ä»¶æ—¶é—´ç‚¹</td>\n<td style=\"text-align:left\">æ¯å¤©å‡Œæ™¨ 4 ç‚¹</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>fileReservedTime</code></td>\n<td style=\"text-align:left\">72</td>\n<td style=\"text-align:left\">æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰</td>\n<td style=\"text-align:left\">âœ… å¯æ”¹ä¸º 48 å‡å°‘ç£ç›˜å‹åŠ›</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>deleteFileBatchMax</code></td>\n<td style=\"text-align:left\">10</td>\n<td style=\"text-align:left\">åˆ é™¤æ–‡ä»¶æ‰¹é‡æ•°</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>æ¶ˆæ¯è®¿é—®æ€§èƒ½</strong></td>\n<td style=\"text-align:left\"><code>maxTransferBytesOnMessageInMemory</code></td>\n<td style=\"text-align:left\">262144</td>\n<td style=\"text-align:left\">å†…å­˜æ¶ˆæ¯è¯»å–æœ€å¤§å­—èŠ‚</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>maxTransferCountOnMessageInMemory</code></td>\n<td style=\"text-align:left\">32</td>\n<td style=\"text-align:left\">å†…å­˜æ¶ˆæ¯è¯»å–æœ€å¤§æ¡æ•°</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>maxTransferBytesOnMessageInDisk</code></td>\n<td style=\"text-align:left\">65536</td>\n<td style=\"text-align:left\">ç£ç›˜æ¶ˆæ¯è¯»å–æœ€å¤§å­—èŠ‚</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>maxTransferCountOnMessageInDisk</code></td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">ç£ç›˜æ¶ˆæ¯è¯»å–æœ€å¤§æ¡æ•°</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>accessMessageInMemoryMaxRatio</code></td>\n<td style=\"text-align:left\">40</td>\n<td style=\"text-align:left\">å†…å­˜è®¿é—®æ¯”ä¾‹é˜ˆå€¼</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>ç´¢å¼•ç®¡ç†</strong></td>\n<td style=\"text-align:left\"><code>messageIndexEnable</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨æ¶ˆæ¯ç´¢å¼•</td>\n<td style=\"text-align:left\">âœ… å»ºè®®å¼€å¯ï¼ˆæé«˜æŒ‰ key æŸ¥è¯¢æ€§èƒ½ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>messageIndexSafe</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å®‰å…¨æ¨¡å¼ç´¢å¼•</td>\n<td style=\"text-align:left\">è‹¥ç£ç›˜å¯é æ€§å·®å¯è®¾ä¸º true</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>ä¸»ä»å¤åˆ¶</strong></td>\n<td style=\"text-align:left\"><code>haMasterAddress</code></td>\n<td style=\"text-align:left\"><em>(ç©º)</em></td>\n<td style=\"text-align:left\">Master åœ°å€ï¼ˆSlave æ¨¡å¼ä½¿ç”¨ï¼‰</td>\n<td style=\"text-align:left\">ä»…ä»èŠ‚ç‚¹é…ç½®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>brokerRole</code></td>\n<td style=\"text-align:left\">ASYNC_MASTER</td>\n<td style=\"text-align:left\">Broker è§’è‰²ï¼ˆASYNC_MASTER / SYNC_MASTER / SLAVEï¼‰</td>\n<td style=\"text-align:left\">âœ… ä¸»èŠ‚ç‚¹å»ºè®® SYNC_MASTER æé«˜å¯é æ€§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>flushDiskType</code></td>\n<td style=\"text-align:left\">ASYNC_FLUSH</td>\n<td style=\"text-align:left\">åˆ·ç›˜ç­–ç•¥ï¼ˆSYNC_FLUSH / ASYNC_FLUSHï¼‰</td>\n<td style=\"text-align:left\">âœ… é«˜å¯é å»ºè®® SYNC_FLUSH</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>cleanFileForciblyEnable</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦å¼ºåˆ¶æ¸…ç†æ–‡ä»¶</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>transientStorePoolEnable</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨ transient poolï¼ˆå †å¤–å†…å­˜ï¼‰</td>\n<td style=\"text-align:left\">âœ… å¯è®¾ä¸º true æå‡æ€§èƒ½ï¼ˆéœ€è¶³å¤Ÿå†…å­˜ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>dispatchFromSenderThread</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦ç”±å‘é€çº¿ç¨‹åˆ†å‘</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>wakeCommitWhenPutMessage</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦åœ¨æ¶ˆæ¯å†™å…¥æ—¶å”¤é†’ commit</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>wakeFlushWhenPutMessage</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å†™å…¥åç«‹å³ flush</td>\n<td style=\"text-align:left\">âœ… å¯¹å»¶è¿Ÿæ•æ„Ÿä¸šåŠ¡å¯è®¾ä¸º true</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>æ¶ˆè´¹è¿›åº¦æ¸…ç†</strong></td>\n<td style=\"text-align:left\"><code>enableCleanExpiredOffset</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨ offset æ¸…ç†</td>\n<td style=\"text-align:left\">é»˜è®¤ false</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å‰¯æœ¬å‚æ•°</strong></td>\n<td style=\"text-align:left\"><code>totalReplicas</code></td>\n<td style=\"text-align:left\">1</td>\n<td style=\"text-align:left\">å‰¯æœ¬æ€»æ•°</td>\n<td style=\"text-align:left\">âœ… å¤šèŠ‚ç‚¹å»ºè®®è®¾ä¸º 3</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>inSyncReplicas</code></td>\n<td style=\"text-align:left\">1</td>\n<td style=\"text-align:left\">åŒæ­¥å‰¯æœ¬æ•°</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>minInSyncReplicas</code></td>\n<td style=\"text-align:left\">1</td>\n<td style=\"text-align:left\">æœ€å°åŒæ­¥å‰¯æœ¬</td>\n<td style=\"text-align:left\">âœ… å»ºè®®è®¾ä¸º 2 æé«˜å¯é æ€§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>allAckInSyncStateSet</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦è¦æ±‚æ‰€æœ‰ ISR ç¡®è®¤</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>enableAutoInSyncReplicas</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦è‡ªåŠ¨ç®¡ç† ISR</td>\n<td style=\"text-align:left\">å¯ä¿æŒé»˜è®¤</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>HA ä¸æµæ§</strong></td>\n<td style=\"text-align:left\"><code>haFlowControlEnable</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¼€å¯ä¸»ä»æµæ§</td>\n<td style=\"text-align:left\">âœ… å¤šå‰¯æœ¬å»ºè®® true</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¨èé‡ç‚¹ä¼˜åŒ–çš„å…³é”®é¡¹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">ç±»åˆ«</th>\n<th style=\"text-align:left\">å‚æ•°</th>\n<th style=\"text-align:left\">æ¨èå€¼</th>\n<th style=\"text-align:left\">åŸå› </th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">æ³¨å†Œ</td>\n<td style=\"text-align:left\"><code>namesrvAddr</code></td>\n<td style=\"text-align:left\">å¿…å¡«</td>\n<td style=\"text-align:left\">Broker å¿…é¡»å‘ NameServer æ³¨å†Œ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">å®‰å…¨</td>\n<td style=\"text-align:left\"><code>aclEnable</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">å¯ç”¨è®¿é—®æ§åˆ¶</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">è‡ªåŠ¨åˆ›å»º</td>\n<td style=\"text-align:left\"><code>autoCreateTopicEnable</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">é˜²æ­¢è¯¯åˆ›å»º topic</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">è‡ªåŠ¨è®¢é˜…</td>\n<td style=\"text-align:left\"><code>autoCreateSubscriptionGroup</code></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">é˜²æ­¢è¯¯æ¶ˆè´¹</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">åˆ·ç›˜ç­–ç•¥</td>\n<td style=\"text-align:left\"><code>flushDiskType</code></td>\n<td style=\"text-align:left\">SYNC_FLUSH</td>\n<td style=\"text-align:left\">ä¿è¯å¯é æ€§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ä¸»ä»</td>\n<td style=\"text-align:left\"><code>brokerRole</code></td>\n<td style=\"text-align:left\">SYNC_MASTERï¼ˆä¸»ï¼‰ / SLAVEï¼ˆä»ï¼‰</td>\n<td style=\"text-align:left\">æå‡å¯ç”¨æ€§</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">å­˜å‚¨è·¯å¾„</td>\n<td style=\"text-align:left\"><code>storePathRootDir</code></td>\n<td style=\"text-align:left\"><code>/data/rocketmq/store</code></td>\n<td style=\"text-align:left\">é¿å… <code>/root</code> æƒé™é—®é¢˜</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">å»¶è¿Ÿä¼˜åŒ–</td>\n<td style=\"text-align:left\"><code>transientStorePoolEnable</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">å †å¤–å†…å­˜åŠ é€Ÿå†™å…¥</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ¸…ç†</td>\n<td style=\"text-align:left\"><code>fileReservedTime</code></td>\n<td style=\"text-align:left\">48</td>\n<td style=\"text-align:left\">å‡å°‘ç£ç›˜å ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ¶ˆæ¯è½¨è¿¹</td>\n<td style=\"text-align:left\"><code>traceTopicEnable</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">ä¾¿äºè¿½è¸ªæ¶ˆæ¯é“¾è·¯</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ Broker çš„é…ç½®é¡¹ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚ æŸ¥çœ‹ Broker é…ç½®é¡¹ æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹ 1234# æŸ¥çœ‹å…¨éƒ¨é»˜è®¤é…ç½®é¡¹sh bin/mqbroker -p# æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„å…¨éƒ¨é…ç½®é¡¹sh bin/mqbroker -p -c conf/broker.conf æŸ¥çœ‹é‡è¦çš„é…ç½®é¡¹ 1234# æŸ¥çœ‹é‡è¦çš„é»˜è®¤é…ç½®é¡¹sh bin/mqbroker -m# æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„é‡è¦é…ç½®é¡¹sh bin/mqbroker -m -c conf/broker.conf é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹ åœ¨æºç  rocketmq-all-5.3.2-source-release/broker çš„å¯åŠ¨ç±» org.apache.rocketmq.broker.BrokerStartupä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±» 1234567final BrokerConfig brokerConfig = new BrokerConfig();final NettyServerConfig nettyServerConfig = new NettyServerConfig();final NettyClientConfig nettyClientConfig = new NettyClientConfig();final MessageStoreConfig messageStoreConfig = new MessageStoreConfig();final AuthConfig authConfig = new AuthConfig();nettyServerConfig.setListenPort(10911);messageStoreConfig.setHaListenPort(0); é…ç½®é¡¹è¯´æ˜ Brokerçš„å…¨éƒ¨é…ç½®é¡¹éå¸¸å¤šï¼Œè¿™é‡Œä»…åˆ—å‡ºäº†é‡è¦çš„é…ç½®é¡¹ã€‚ åˆ†ç±» å‚æ•°å é»˜è®¤å€¼ å‚æ•°è¯´æ˜ ä¼˜åŒ– / å»ºè®® åŸºç¡€é…ç½® namesrvAddr (ç©º) NameServer åœ°å€åˆ—è¡¨ï¼ˆå¤šä¸ªç”¨ ; åˆ†éš”ï¼‰ âœ… å¿…é¡»è®¾ç½®ï¼Œå¦åˆ™ broker æ— æ³•æ³¨å†Œåˆ° nameserverã€‚ä¾‹ï¼šnamesrvAddr=10.250.0.10:9876;10.250.0.11:9876 listenPort 6888 Broker ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£ âœ… å»ºè®®ä¿æŒé»˜è®¤æˆ–æ˜¾å¼è®¾ç½®ä¸º 10911ï¼ˆç»å…¸ç«¯å£ï¼‰ brokerIP1 10.250.0.188 Broker å¯¹å¤–é€šä¿¡ IP âœ… åœ¨å¤šç½‘å¡ç¯å¢ƒåŠ¡å¿…æŒ‡å®šå…¬ç½‘/å†…ç½‘ IP recoverConcurrently false æ˜¯å¦å¹¶å‘æ¢å¤ CommitLog é»˜è®¤å³å¯ï¼ˆé«˜å®‰å…¨æ€§ï¼‰ Topic &amp; è®¢é˜… autoCreateTopicEnable true æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topic âœ… ç”Ÿäº§å»ºè®®è®¾ä¸º falseï¼Œé˜²æ­¢è¯¯åˆ›å»º autoCreateSubscriptionGroup true æ˜¯å¦è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ âœ… åŒä¸Šï¼Œå»ºè®® false msgTraceTopicName RMQ_SYS_TRACE_TOPIC æ¶ˆæ¯è½¨è¿¹ä¸»é¢˜å é»˜è®¤å³å¯ traceTopicEnable false æ˜¯å¦å¼€å¯æ¶ˆæ¯è½¨è¿¹åŠŸèƒ½ âœ… å»ºè®®è®¾ä¸º true ä»¥ä¾¿é—®é¢˜æ’æŸ¥ äº‹åŠ¡æ¶ˆæ¯ rejectTransactionMessage false æ˜¯å¦æ‹’ç»äº‹åŠ¡æ¶ˆæ¯ è‹¥ä¸ä½¿ç”¨äº‹åŠ¡å¯è®¾ä¸º true å‡å°‘è´Ÿæ‹… transactionTimeOut 6000 äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰ é»˜è®¤å³å¯ transactionCheckMax 15 äº‹åŠ¡æœ€å¤§å›æŸ¥æ¬¡æ•° å¯è°ƒé«˜ï¼ˆ20ï¼‰æé«˜å¯é æ€§ transactionCheckInterval 30000 äº‹åŠ¡å›æŸ¥é—´éš”ï¼ˆmsï¼‰ é»˜è®¤å³å¯ è®¿é—®æ§åˆ¶ aclEnable false æ˜¯å¦å¯ç”¨ ACL æƒé™éªŒè¯ âœ… ç”Ÿäº§ç¯å¢ƒ å¿…é¡» true å­˜å‚¨è·¯å¾„ storePathRootDir /root/store æ¶ˆæ¯å­˜å‚¨æ ¹ç›®å½• âœ… æ”¹ä¸º /data/rocketmq/store storePathCommitLog (ç©º) CommitLog å­˜å‚¨è·¯å¾„ è‹¥ä¸ºç©ºåˆ™ä½¿ç”¨ä¸Šé¢çš„æ ¹ç›®å½• storePathDLedgerCommitLog (ç©º) DLedger æ¨¡å¼å­˜å‚¨è·¯å¾„ DLedger æ¨¡å¼æ‰éœ€è¦ storePathEpochFile (ç©º) epoch æ–‡ä»¶è·¯å¾„ Controller æ¨¡å¼ä½¿ç”¨ storePathBrokerIdentity (ç©º) Broker èº«ä»½æ–‡ä»¶è·¯å¾„ é»˜è®¤å³å¯ disappearTimeAfterStart -1 Broker å¯åŠ¨åå¤±æ•ˆç­‰å¾…æ—¶é—´ é»˜è®¤å³å¯ storeType default å­˜å‚¨ç±»å‹ï¼ˆdefault / dledgerï¼‰ âœ… å¤šå‰¯æœ¬éƒ¨ç½²å»ºè®® dledger åˆ·ç›˜ä¸å†™å…¥ flushIntervalCommitLog 500 å¼‚æ­¥ flush å‘¨æœŸï¼ˆmsï¼‰ é»˜è®¤å³å¯ commitIntervalCommitLog 200 commit é—´éš” é»˜è®¤å³å¯ flushCommitLogTimed true æ˜¯å¦å®šæ—¶ flush é»˜è®¤å³å¯ æ–‡ä»¶æ¸…ç† deleteWhen 04 åˆ é™¤è¿‡æœŸæ–‡ä»¶æ—¶é—´ç‚¹ æ¯å¤©å‡Œæ™¨ 4 ç‚¹ fileReservedTime 72 æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰ âœ… å¯æ”¹ä¸º 48 å‡å°‘ç£ç›˜å‹åŠ› deleteFileBatchMax 10 åˆ é™¤æ–‡ä»¶æ‰¹é‡æ•° é»˜è®¤å³å¯ æ¶ˆæ¯è®¿é—®æ€§èƒ½ maxTransferBytesOnMessageInMemory 262144 å†…å­˜æ¶ˆæ¯è¯»å–æœ€å¤§å­—èŠ‚ é»˜è®¤å³å¯ maxTransferCountOnMessageInMemory 32 å†…å­˜æ¶ˆæ¯è¯»å–æœ€å¤§æ¡æ•° é»˜è®¤å³å¯ maxTransferBytesOnMessageInDisk 65536 ç£ç›˜æ¶ˆæ¯è¯»å–æœ€å¤§å­—èŠ‚ é»˜è®¤å³å¯ maxTransferCountOnMessageInDisk 8 ç£ç›˜æ¶ˆæ¯è¯»å–æœ€å¤§æ¡æ•° é»˜è®¤å³å¯ accessMessageInMemoryMaxRatio 40 å†…å­˜è®¿é—®æ¯”ä¾‹é˜ˆå€¼ é»˜è®¤å³å¯ ç´¢å¼•ç®¡ç† messageIndexEnable true æ˜¯å¦å¯ç”¨æ¶ˆæ¯ç´¢å¼• âœ… å»ºè®®å¼€å¯ï¼ˆæé«˜æŒ‰ key æŸ¥è¯¢æ€§èƒ½ï¼‰ messageIndexSafe false æ˜¯å¦å®‰å…¨æ¨¡å¼ç´¢å¼• è‹¥ç£ç›˜å¯é æ€§å·®å¯è®¾ä¸º true ä¸»ä»å¤åˆ¶ haMasterAddress (ç©º) Master åœ°å€ï¼ˆSlave æ¨¡å¼ä½¿ç”¨ï¼‰ ä»…ä»èŠ‚ç‚¹é…ç½® brokerRole ASYNC_MASTER Broker è§’è‰²ï¼ˆASYNC_MASTER / SYNC_MASTER / SLAVEï¼‰ âœ… ä¸»èŠ‚ç‚¹å»ºè®® SYNC_MASTER æé«˜å¯é æ€§ flushDiskType ASYNC_FLUSH åˆ·ç›˜ç­–ç•¥ï¼ˆSYNC_FLUSH / ASYNC_FLUSHï¼‰ âœ… é«˜å¯é å»ºè®® SYNC_FLUSH cleanFileForciblyEnable true æ˜¯å¦å¼ºåˆ¶æ¸…ç†æ–‡ä»¶ é»˜è®¤å³å¯ transientStorePoolEnable false æ˜¯å¦å¯ç”¨ transient poolï¼ˆå †å¤–å†…å­˜ï¼‰ âœ… å¯è®¾ä¸º true æå‡æ€§èƒ½ï¼ˆéœ€è¶³å¤Ÿå†…å­˜ï¼‰ dispatchFromSenderThread false æ˜¯å¦ç”±å‘é€çº¿ç¨‹åˆ†å‘ é»˜è®¤å³å¯ wakeCommitWhenPutMessage true æ˜¯å¦åœ¨æ¶ˆæ¯å†™å…¥æ—¶å”¤é†’ commit é»˜è®¤å³å¯ wakeFlushWhenPutMessage false æ˜¯å¦å†™å…¥åç«‹å³ flush âœ… å¯¹å»¶è¿Ÿæ•æ„Ÿä¸šåŠ¡å¯è®¾ä¸º true æ¶ˆè´¹è¿›åº¦æ¸…ç† enableCleanExpiredOffset false æ˜¯å¦å¯ç”¨ offset æ¸…ç† é»˜è®¤ false å‰¯æœ¬å‚æ•° totalReplicas 1 å‰¯æœ¬æ€»æ•° âœ… å¤šèŠ‚ç‚¹å»ºè®®è®¾ä¸º 3 inSyncReplicas 1 åŒæ­¥å‰¯æœ¬æ•° é»˜è®¤å³å¯ minInSyncReplicas 1 æœ€å°åŒæ­¥å‰¯æœ¬ âœ… å»ºè®®è®¾ä¸º 2 æé«˜å¯é æ€§ allAckInSyncStateSet false æ˜¯å¦è¦æ±‚æ‰€æœ‰ ISR ç¡®è®¤ é»˜è®¤å³å¯ enableAutoInSyncReplicas false æ˜¯å¦è‡ªåŠ¨ç®¡ç† ISR å¯ä¿æŒé»˜è®¤ HA ä¸æµæ§ haFlowControlEnable false æ˜¯å¦å¼€å¯ä¸»ä»æµæ§ âœ… å¤šå‰¯æœ¬å»ºè®® true æ¨èé‡ç‚¹ä¼˜åŒ–çš„å…³é”®é¡¹ ç±»åˆ« å‚æ•° æ¨èå€¼ åŸå›  æ³¨å†Œ namesrvAddr å¿…å¡« Broker å¿…é¡»å‘ NameServer æ³¨å†Œ å®‰å…¨ aclEnable true å¯ç”¨è®¿é—®æ§åˆ¶ è‡ªåŠ¨åˆ›å»º autoCreateTopicEnable false é˜²æ­¢è¯¯åˆ›å»º topic è‡ªåŠ¨è®¢é˜… autoCreateSubscriptionGroup false é˜²æ­¢è¯¯æ¶ˆè´¹ åˆ·ç›˜ç­–ç•¥ flushDiskType SYNC_FLUSH ä¿è¯å¯é æ€§ ä¸»ä» brokerRole SYNC_MASTERï¼ˆä¸»ï¼‰ / SLAVEï¼ˆä»ï¼‰ æå‡å¯ç”¨æ€§ å­˜å‚¨è·¯å¾„ storePathRootDir /data/rocketmq/store é¿å… /root æƒé™é—®é¢˜ å»¶è¿Ÿä¼˜åŒ– transientStorePoolEnable true å †å¤–å†…å­˜åŠ é€Ÿå†™å…¥ æ¸…ç† fileReservedTime 48 å‡å°‘ç£ç›˜å ç”¨ æ¶ˆæ¯è½¨è¿¹ traceTopicEnable true ä¾¿äºè¿½è¸ªæ¶ˆæ¯é“¾è·¯","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ Broker çš„é…ç½®é¡¹ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚","date_published":"2025-10-28T13:31:05.000Z","tags":["æŠ€æœ¯","rocketmq","åˆ†å¸ƒå¼","rocketmq"]},{"id":"https://blog.hanqunfeng.com/2025/10/28/rocketmq-03-namesvr-config/","url":"https://blog.hanqunfeng.com/2025/10/28/rocketmq-03-namesvr-config/","title":"RocketMQ NameServer çš„é…ç½®é¡¹","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RocketMQ NameServer çš„é…ç½®é¡¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/\">RocketMQå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"æŸ¥çœ‹-NameServer-é…ç½®é¡¹\">æŸ¥çœ‹ NameServer é…ç½®é¡¹</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹é»˜è®¤é…ç½®é¡¹</span></span><br><span class=\"line\">sh bin/mqnamesrv -p</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„é…ç½®é¡¹ï¼Œå³é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹ä¼šè¦†ç›–é»˜è®¤é…ç½®é¡¹</span></span><br><span class=\"line\">sh bin/mqnamesrv -p -c conf/namesvr.conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹\">é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨æºç  <code>rocketmq-all-5.3.2-source-release/namesrv</code> çš„å¯åŠ¨ç±» <code>org.apache.rocketmq.namesrv.NamesrvStartup</code>ä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±»</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">NamesrvConfig</span> <span class=\"variable\">namesrvConfig</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">NettyServerConfig</span> <span class=\"variable\">nettyServerConfig</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">NettyClientConfig</span> <span class=\"variable\">nettyClientConfig</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">ControllerConfig</span> <span class=\"variable\">controllerConfig</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®é¡¹è¯´æ˜\">é…ç½®é¡¹è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>NameServer é…ç½®é¡¹è¯´æ˜ä¸å»ºè®®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°å</th>\n<th style=\"text-align:left\">é»˜è®¤å€¼</th>\n<th style=\"text-align:left\">å‚æ•°è¯´æ˜</th>\n<th style=\"text-align:left\">ä¼˜åŒ– / å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>rocketmqHome</strong></td>\n<td style=\"text-align:left\">/usr/local/soft/rocketmq/rocketmq5</td>\n<td style=\"text-align:left\">RocketMQ å®‰è£…ç›®å½•</td>\n<td style=\"text-align:left\">ä¸å»ºè®®ä¿®æ”¹</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>kvConfigPath</strong></td>\n<td style=\"text-align:left\">/root/namesrv/kvConfig.json</td>\n<td style=\"text-align:left\">KV é…ç½®å­˜å‚¨è·¯å¾„</td>\n<td style=\"text-align:left\">âœ… æ”¹ä¸º <code>/data/rocketmq/namesrv/kvConfig.json</code> æ›´è§„èŒƒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>configStorePath</strong></td>\n<td style=\"text-align:left\">/root/namesrv/namesrv.properties</td>\n<td style=\"text-align:left\">NameServer å¯åŠ¨é…ç½®æ–‡ä»¶è·¯å¾„</td>\n<td style=\"text-align:left\">âœ… æ”¾åœ¨é root è·¯å¾„ä¸‹ <code>/etc/rocketmq/namesrv.properties</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>productEnvName</strong></td>\n<td style=\"text-align:left\">center</td>\n<td style=\"text-align:left\">äº§å“ç¯å¢ƒåç§°æ ‡è¯†</td>\n<td style=\"text-align:left\">å¯ç”¨äºåŒºåˆ†ç¯å¢ƒï¼ˆdev/test/prodï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clusterTest</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨é›†ç¾¤æµ‹è¯•æ¨¡å¼</td>\n<td style=\"text-align:left\">é»˜è®¤ falseï¼Œç”Ÿäº§å‹¿å¯ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>orderMessageEnable</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¼€å¯é¡ºåºæ¶ˆæ¯åŠŸèƒ½</td>\n<td style=\"text-align:left\">NameServer ä¸€èˆ¬æ— éœ€å¼€å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>returnOrderTopicConfigToBroker</strong></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦è¿”å›é¡ºåºæ¶ˆæ¯ä¸»é¢˜é…ç½®ç»™ broker</td>\n<td style=\"text-align:left\">ä¿æŒé»˜è®¤</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clientRequestThreadPoolNums</strong></td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯è¯·æ±‚çº¿ç¨‹æ•°</td>\n<td style=\"text-align:left\">âœ… è‹¥ NameServer è´Ÿè½½é«˜å¯å¢è‡³ 16~32</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>defaultThreadPoolNums</strong></td>\n<td style=\"text-align:left\">16</td>\n<td style=\"text-align:left\">é»˜è®¤çº¿ç¨‹æ± çº¿ç¨‹æ•°</td>\n<td style=\"text-align:left\">è§† CPU æ ¸å¿ƒæ•°è°ƒæ•´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clientRequestThreadPoolQueueCapacity</strong></td>\n<td style=\"text-align:left\">50000</td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯è¯·æ±‚é˜Ÿåˆ—é•¿åº¦</td>\n<td style=\"text-align:left\">âœ… é«˜å¹¶å‘ç¯å¢ƒå¯è°ƒé«˜è‡³ 100000</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>defaultThreadPoolQueueCapacity</strong></td>\n<td style=\"text-align:left\">10000</td>\n<td style=\"text-align:left\">é»˜è®¤ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦</td>\n<td style=\"text-align:left\">é€‚åº¦æé«˜é˜²æ­¢æ‹’ç»ä»»åŠ¡</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>scanNotActiveBrokerInterval</strong></td>\n<td style=\"text-align:left\">5000</td>\n<td style=\"text-align:left\">æ‰«æå¤±æ•ˆ Broker çš„é—´éš”ï¼ˆmsï¼‰</td>\n<td style=\"text-align:left\">é»˜è®¤ 5sï¼Œå¯ä¿æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>unRegisterBrokerQueueCapacity</strong></td>\n<td style=\"text-align:left\">3000</td>\n<td style=\"text-align:left\">Broker æ³¨é”€é˜Ÿåˆ—å®¹é‡</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>supportActingMaster</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦æ”¯æŒ ActingMaster åŠŸèƒ½</td>\n<td style=\"text-align:left\">âœ… è‹¥å¯ç”¨ controller å»ºè®®è®¾ä¸º true</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>enableAllTopicList</strong></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨æ‰€æœ‰ä¸»é¢˜åˆ—è¡¨æ¥å£</td>\n<td style=\"text-align:left\">å¯ä¿æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>enableTopicList</strong></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦å…è®¸ä¸»é¢˜åˆ—è¡¨æŸ¥è¯¢</td>\n<td style=\"text-align:left\">å¯ä¿æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>notifyMinBrokerIdChanged</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦é€šçŸ¥æœ€å° brokerId å˜åŒ–</td>\n<td style=\"text-align:left\">ä¸€èˆ¬æ— éœ€å¼€å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>enableControllerInNamesrv</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦åœ¨ NameServer ä¸­å¯ç”¨ Controller æ¨¡å—</td>\n<td style=\"text-align:left\">âœ… è‹¥éƒ¨ç½²ç®€åŒ–é›†ç¾¤å¯è€ƒè™‘ trueï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>needWaitForService</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦ç­‰å¾…æœåŠ¡å°±ç»ªå†å¯åŠ¨</td>\n<td style=\"text-align:left\">å¯ä¿æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>waitSecondsForService</strong></td>\n<td style=\"text-align:left\">45</td>\n<td style=\"text-align:left\">å¯åŠ¨ç­‰å¾…æ—¶é—´</td>\n<td style=\"text-align:left\">å¯ä¿æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>deleteTopicWithBrokerRegistration</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ³¨å†Œæ—¶æ˜¯å¦åˆ é™¤ topic</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>configBlackList</strong></td>\n<td style=\"text-align:left\">configBlackList;configStorePath;kvConfigPath</td>\n<td style=\"text-align:left\">é»‘åå•é…ç½®é¡¹</td>\n<td style=\"text-align:left\">ä¿æŒé»˜è®¤</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>bindAddress</strong></td>\n<td style=\"text-align:left\">0.0.0.0</td>\n<td style=\"text-align:left\">ç»‘å®šçš„ç›‘å¬åœ°å€</td>\n<td style=\"text-align:left\">âœ… ç”Ÿäº§ç¯å¢ƒå»ºè®®ç»‘å®šå†…ç½‘ IP</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>listenPort</strong></td>\n<td style=\"text-align:left\">9876</td>\n<td style=\"text-align:left\">NameServer ç›‘å¬ç«¯å£</td>\n<td style=\"text-align:left\">âœ… å¯é€šè¿‡é˜²ç«å¢™é™åˆ¶å¤–éƒ¨è®¿é—®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>serverWorkerThreads</strong></td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">æœåŠ¡ç«¯ä¸šåŠ¡å¤„ç†çº¿ç¨‹æ•°</td>\n<td style=\"text-align:left\">å¯æ ¹æ®è´Ÿè½½è°ƒæ•´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>serverCallbackExecutorThreads</strong></td>\n<td style=\"text-align:left\">0</td>\n<td style=\"text-align:left\">å›è°ƒæ‰§è¡Œçº¿ç¨‹æ•°</td>\n<td style=\"text-align:left\">0 è¡¨ç¤ºè‡ªåŠ¨è®¾ç½®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>serverSelectorThreads</strong></td>\n<td style=\"text-align:left\">3</td>\n<td style=\"text-align:left\">Selector çº¿ç¨‹æ•°</td>\n<td style=\"text-align:left\">ä¸€èˆ¬ 2~4 å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>serverOnewaySemaphoreValue</strong></td>\n<td style=\"text-align:left\">256</td>\n<td style=\"text-align:left\">å•å‘è¯·æ±‚å¹¶å‘é™åˆ¶</td>\n<td style=\"text-align:left\">å¯ä¿æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>serverAsyncSemaphoreValue</strong></td>\n<td style=\"text-align:left\">64</td>\n<td style=\"text-align:left\">å¼‚æ­¥è¯·æ±‚å¹¶å‘é™åˆ¶</td>\n<td style=\"text-align:left\">å¯ä¿æŒæˆ–ç•¥å¢</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>serverChannelMaxIdleTimeSeconds</strong></td>\n<td style=\"text-align:left\">120</td>\n<td style=\"text-align:left\">è¿æ¥ç©ºé—²å…³é—­æ—¶é—´</td>\n<td style=\"text-align:left\">å¯è°ƒå¤§åˆ° 300 æé«˜å®¹é”™</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>serverSocketSndBufSize</strong></td>\n<td style=\"text-align:left\">0</td>\n<td style=\"text-align:left\">TCP å‘é€ç¼“å†²åŒºå¤§å°</td>\n<td style=\"text-align:left\">0 è¡¨ç¤ºä½¿ç”¨ç³»ç»Ÿé»˜è®¤</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>serverSocketRcvBufSize</strong></td>\n<td style=\"text-align:left\">0</td>\n<td style=\"text-align:left\">TCP æ¥æ”¶ç¼“å†²åŒºå¤§å°</td>\n<td style=\"text-align:left\">å»ºè®® 131072ï¼ˆ128KBï¼‰ä»¥ä¸Š</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>writeBufferHighWaterMark</strong></td>\n<td style=\"text-align:left\">0</td>\n<td style=\"text-align:left\">å†™ç¼“å†²é«˜æ°´ä½æ ‡è®°</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>writeBufferLowWaterMark</strong></td>\n<td style=\"text-align:left\">0</td>\n<td style=\"text-align:left\">å†™ç¼“å†²ä½æ°´ä½æ ‡è®°</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>serverSocketBacklog</strong></td>\n<td style=\"text-align:left\">1024</td>\n<td style=\"text-align:left\">TCP è¿æ¥ç­‰å¾…é˜Ÿåˆ—</td>\n<td style=\"text-align:left\">âœ… é«˜å¹¶å‘åœºæ™¯å¯è°ƒå¤§è‡³ 2048</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>serverNettyWorkerGroupEnable</strong></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨ Netty worker çº¿ç¨‹ç»„</td>\n<td style=\"text-align:left\">é»˜è®¤ true</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>serverPooledByteBufAllocatorEnable</strong></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨ Netty æ± åŒ–å†…å­˜</td>\n<td style=\"text-align:left\">å»ºè®®ä¿æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>enableShutdownGracefully</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦ä¼˜é›…å…³é—­</td>\n<td style=\"text-align:left\">âœ… å»ºè®®è®¾ä¸º true</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>shutdownWaitTimeSeconds</strong></td>\n<td style=\"text-align:left\">30</td>\n<td style=\"text-align:left\">ä¼˜é›…å…³é—­ç­‰å¾…æ—¶é—´</td>\n<td style=\"text-align:left\">å»ºè®® 30~60</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>useEpollNativeSelector</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨ Linux Epoll</td>\n<td style=\"text-align:left\">âœ… Linux ç¯å¢ƒå»ºè®®è®¾ä¸º true æé«˜æ€§èƒ½</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clientWorkerThreads</strong></td>\n<td style=\"text-align:left\">4</td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯ worker çº¿ç¨‹æ•°</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clientCallbackExecutorThreads</strong></td>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯å›è°ƒçº¿ç¨‹æ•°</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clientOnewaySemaphoreValue</strong></td>\n<td style=\"text-align:left\">65535</td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯å•å‘è¯·æ±‚å¹¶å‘é™åˆ¶</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clientAsyncSemaphoreValue</strong></td>\n<td style=\"text-align:left\">65535</td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯å¼‚æ­¥è¯·æ±‚å¹¶å‘é™åˆ¶</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>connectTimeoutMillis</strong></td>\n<td style=\"text-align:left\">3000</td>\n<td style=\"text-align:left\">è¿æ¥è¶…æ—¶ï¼ˆmsï¼‰</td>\n<td style=\"text-align:left\">âœ… å¯æé«˜è‡³ 5000 å¢åŠ å®¹é”™</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>channelNotActiveInterval</strong></td>\n<td style=\"text-align:left\">60000</td>\n<td style=\"text-align:left\">æ£€æŸ¥é€šé“éæ´»åŠ¨é—´éš”</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>isScanAvailableNameSrv</strong></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦æ‰«æå¯ç”¨ NameServer</td>\n<td style=\"text-align:left\">ä¿æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clientChannelMaxIdleTimeSeconds</strong></td>\n<td style=\"text-align:left\">120</td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯ç©ºé—²è¿æ¥è¶…æ—¶</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clientSocketSndBufSize</strong></td>\n<td style=\"text-align:left\">0</td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯ TCP å‘é€ç¼“å†²åŒº</td>\n<td style=\"text-align:left\">å»ºè®® 131072</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clientSocketRcvBufSize</strong></td>\n<td style=\"text-align:left\">0</td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯ TCP æ¥æ”¶ç¼“å†²åŒº</td>\n<td style=\"text-align:left\">å»ºè®® 131072</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clientPooledByteBufAllocatorEnable</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯æ˜¯å¦å¯ç”¨æ± åŒ–</td>\n<td style=\"text-align:left\">âœ… å»ºè®®è®¾ä¸º true æé«˜æ€§èƒ½</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>clientCloseSocketIfTimeout</strong></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">è¶…æ—¶æ˜¯å¦å…³é—­ socket</td>\n<td style=\"text-align:left\">ä¿æŒé»˜è®¤</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>useTLS</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨ TLS é€šä¿¡</td>\n<td style=\"text-align:left\">âœ… è‹¥å…¬ç½‘éƒ¨ç½²å¼ºçƒˆå»ºè®®å¼€å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>socksProxyConfig</strong></td>\n<td style=\"text-align:left\">{}</td>\n<td style=\"text-align:left\">SOCKS ä»£ç†é…ç½®</td>\n<td style=\"text-align:left\">å†…ç½‘éƒ¨ç½²æ— éœ€è®¾ç½®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>disableCallbackExecutor</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦ç¦ç”¨å›è°ƒæ‰§è¡Œå™¨</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>disableNettyWorkerGroup</strong></td>\n<td style=\"text-align:left\">false</td>\n<td style=\"text-align:left\">æ˜¯å¦ç¦ç”¨ Netty worker group</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>maxReconnectIntervalTimeSeconds</strong></td>\n<td style=\"text-align:left\">60</td>\n<td style=\"text-align:left\">æœ€å¤§é‡è¿é—´éš”</td>\n<td style=\"text-align:left\">é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>enableReconnectForGoAway</strong></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨ goaway è‡ªåŠ¨é‡è¿</td>\n<td style=\"text-align:left\">ä¿æŒ true å¢å¼ºå¥å£®æ€§</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¨èé‡ç‚¹ä¼˜åŒ–çš„å…³é”®é¡¹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">ç±»åˆ«</th>\n<th style=\"text-align:left\">å‚æ•°</th>\n<th style=\"text-align:left\">æ¨èå€¼</th>\n<th style=\"text-align:left\">åŸå› </th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">æ€§èƒ½</td>\n<td style=\"text-align:left\"><code>useEpollNativeSelector</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">Linux æ€§èƒ½æ˜¾è‘—æå‡</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">å®‰å…¨</td>\n<td style=\"text-align:left\"><code>bindAddress</code></td>\n<td style=\"text-align:left\">å†…ç½‘ IP</td>\n<td style=\"text-align:left\">é˜²æ­¢æš´éœ²å…¬ç½‘</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">å®‰å…¨</td>\n<td style=\"text-align:left\"><code>useTLS</code></td>\n<td style=\"text-align:left\">trueï¼ˆå…¬ç½‘ï¼‰</td>\n<td style=\"text-align:left\">å¯ç”¨åŠ å¯†ä¼ è¾“</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">å¥å£®æ€§</td>\n<td style=\"text-align:left\"><code>enableShutdownGracefully</code></td>\n<td style=\"text-align:left\">true</td>\n<td style=\"text-align:left\">é˜²æ­¢å¼ºåˆ¶å…³é—­å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">è´Ÿè½½</td>\n<td style=\"text-align:left\"><code>clientRequestThreadPoolNums</code></td>\n<td style=\"text-align:left\">16~32</td>\n<td style=\"text-align:left\">æé«˜å¹¶å‘èƒ½åŠ›</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ç½‘ç»œ</td>\n<td style=\"text-align:left\"><code>serverSocketBacklog</code></td>\n<td style=\"text-align:left\">2048</td>\n<td style=\"text-align:left\">å‡å°‘è¿æ¥æ‹’ç»</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ç¼“å†²</td>\n<td style=\"text-align:left\"><code>serverSocketSndBufSize</code> / <code>RcvBufSize</code></td>\n<td style=\"text-align:left\">131072</td>\n<td style=\"text-align:left\">æé«˜ç½‘ç»œåå</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ–‡ä»¶è·¯å¾„</td>\n<td style=\"text-align:left\"><code>kvConfigPath</code> / <code>configStorePath</code></td>\n<td style=\"text-align:left\">é root è·¯å¾„</td>\n<td style=\"text-align:left\">é¿å…æƒé™é—®é¢˜</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ NameServer çš„é…ç½®é¡¹ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚ æŸ¥çœ‹ NameServer é…ç½®é¡¹ 1234# æŸ¥çœ‹é»˜è®¤é…ç½®é¡¹sh bin/mqnamesrv -p# æŸ¥çœ‹åŠ è½½äº†æŒ‡å®šé…ç½®æ–‡ä»¶åçš„é…ç½®é¡¹ï¼Œå³é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹ä¼šè¦†ç›–é»˜è®¤é…ç½®é¡¹sh bin/mqnamesrv -p -c conf/namesvr.conf é…ç½®é¡¹é¡¹ç›®æºç ç®€ä»‹ åœ¨æºç  rocketmq-all-5.3.2-source-release/namesrv çš„å¯åŠ¨ç±» org.apache.rocketmq.namesrv.NamesrvStartupä¸­ å¯ä»¥çœ‹åˆ°å…¶å¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–å¦‚ä¸‹é…ç½®é¡¹çš„ç±» 1234private static NamesrvConfig namesrvConfig = null;private static NettyServerConfig nettyServerConfig = null;private static NettyClientConfig nettyClientConfig = null;private static ControllerConfig controllerConfig = null; é…ç½®é¡¹è¯´æ˜ NameServer é…ç½®é¡¹è¯´æ˜ä¸å»ºè®® å‚æ•°å é»˜è®¤å€¼ å‚æ•°è¯´æ˜ ä¼˜åŒ– / å»ºè®® rocketmqHome /usr/local/soft/rocketmq/rocketmq5 RocketMQ å®‰è£…ç›®å½• ä¸å»ºè®®ä¿®æ”¹ kvConfigPath /root/namesrv/kvConfig.json KV é…ç½®å­˜å‚¨è·¯å¾„ âœ… æ”¹ä¸º /data/rocketmq/namesrv/kvConfig.json æ›´è§„èŒƒ configStorePath /root/namesrv/namesrv.properties NameServer å¯åŠ¨é…ç½®æ–‡ä»¶è·¯å¾„ âœ… æ”¾åœ¨é root è·¯å¾„ä¸‹ /etc/rocketmq/namesrv.properties productEnvName center äº§å“ç¯å¢ƒåç§°æ ‡è¯† å¯ç”¨äºåŒºåˆ†ç¯å¢ƒï¼ˆdev/test/prodï¼‰ clusterTest false æ˜¯å¦å¯ç”¨é›†ç¾¤æµ‹è¯•æ¨¡å¼ é»˜è®¤ falseï¼Œç”Ÿäº§å‹¿å¯ç”¨ orderMessageEnable false æ˜¯å¦å¼€å¯é¡ºåºæ¶ˆæ¯åŠŸèƒ½ NameServer ä¸€èˆ¬æ— éœ€å¼€å¯ returnOrderTopicConfigToBroker true æ˜¯å¦è¿”å›é¡ºåºæ¶ˆæ¯ä¸»é¢˜é…ç½®ç»™ broker ä¿æŒé»˜è®¤ clientRequestThreadPoolNums 8 å®¢æˆ·ç«¯è¯·æ±‚çº¿ç¨‹æ•° âœ… è‹¥ NameServer è´Ÿè½½é«˜å¯å¢è‡³ 16~32 defaultThreadPoolNums 16 é»˜è®¤çº¿ç¨‹æ± çº¿ç¨‹æ•° è§† CPU æ ¸å¿ƒæ•°è°ƒæ•´ clientRequestThreadPoolQueueCapacity 50000 å®¢æˆ·ç«¯è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ âœ… é«˜å¹¶å‘ç¯å¢ƒå¯è°ƒé«˜è‡³ 100000 defaultThreadPoolQueueCapacity 10000 é»˜è®¤ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦ é€‚åº¦æé«˜é˜²æ­¢æ‹’ç»ä»»åŠ¡ scanNotActiveBrokerInterval 5000 æ‰«æå¤±æ•ˆ Broker çš„é—´éš”ï¼ˆmsï¼‰ é»˜è®¤ 5sï¼Œå¯ä¿æŒ unRegisterBrokerQueueCapacity 3000 Broker æ³¨é”€é˜Ÿåˆ—å®¹é‡ é»˜è®¤å³å¯ supportActingMaster false æ˜¯å¦æ”¯æŒ ActingMaster åŠŸèƒ½ âœ… è‹¥å¯ç”¨ controller å»ºè®®è®¾ä¸º true enableAllTopicList true æ˜¯å¦å¯ç”¨æ‰€æœ‰ä¸»é¢˜åˆ—è¡¨æ¥å£ å¯ä¿æŒ enableTopicList true æ˜¯å¦å…è®¸ä¸»é¢˜åˆ—è¡¨æŸ¥è¯¢ å¯ä¿æŒ notifyMinBrokerIdChanged false æ˜¯å¦é€šçŸ¥æœ€å° brokerId å˜åŒ– ä¸€èˆ¬æ— éœ€å¼€å¯ enableControllerInNamesrv false æ˜¯å¦åœ¨ NameServer ä¸­å¯ç”¨ Controller æ¨¡å— âœ… è‹¥éƒ¨ç½²ç®€åŒ–é›†ç¾¤å¯è€ƒè™‘ trueï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰ needWaitForService false æ˜¯å¦ç­‰å¾…æœåŠ¡å°±ç»ªå†å¯åŠ¨ å¯ä¿æŒ waitSecondsForService 45 å¯åŠ¨ç­‰å¾…æ—¶é—´ å¯ä¿æŒ deleteTopicWithBrokerRegistration false æ³¨å†Œæ—¶æ˜¯å¦åˆ é™¤ topic é»˜è®¤å³å¯ configBlackList configBlackList;configStorePath;kvConfigPath é»‘åå•é…ç½®é¡¹ ä¿æŒé»˜è®¤ bindAddress 0.0.0.0 ç»‘å®šçš„ç›‘å¬åœ°å€ âœ… ç”Ÿäº§ç¯å¢ƒå»ºè®®ç»‘å®šå†…ç½‘ IP listenPort 9876 NameServer ç›‘å¬ç«¯å£ âœ… å¯é€šè¿‡é˜²ç«å¢™é™åˆ¶å¤–éƒ¨è®¿é—® serverWorkerThreads 8 æœåŠ¡ç«¯ä¸šåŠ¡å¤„ç†çº¿ç¨‹æ•° å¯æ ¹æ®è´Ÿè½½è°ƒæ•´ serverCallbackExecutorThreads 0 å›è°ƒæ‰§è¡Œçº¿ç¨‹æ•° 0 è¡¨ç¤ºè‡ªåŠ¨è®¾ç½® serverSelectorThreads 3 Selector çº¿ç¨‹æ•° ä¸€èˆ¬ 2~4 å³å¯ serverOnewaySemaphoreValue 256 å•å‘è¯·æ±‚å¹¶å‘é™åˆ¶ å¯ä¿æŒ serverAsyncSemaphoreValue 64 å¼‚æ­¥è¯·æ±‚å¹¶å‘é™åˆ¶ å¯ä¿æŒæˆ–ç•¥å¢ serverChannelMaxIdleTimeSeconds 120 è¿æ¥ç©ºé—²å…³é—­æ—¶é—´ å¯è°ƒå¤§åˆ° 300 æé«˜å®¹é”™ serverSocketSndBufSize 0 TCP å‘é€ç¼“å†²åŒºå¤§å° 0 è¡¨ç¤ºä½¿ç”¨ç³»ç»Ÿé»˜è®¤ serverSocketRcvBufSize 0 TCP æ¥æ”¶ç¼“å†²åŒºå¤§å° å»ºè®® 131072ï¼ˆ128KBï¼‰ä»¥ä¸Š writeBufferHighWaterMark 0 å†™ç¼“å†²é«˜æ°´ä½æ ‡è®° é»˜è®¤å³å¯ writeBufferLowWaterMark 0 å†™ç¼“å†²ä½æ°´ä½æ ‡è®° é»˜è®¤å³å¯ serverSocketBacklog 1024 TCP è¿æ¥ç­‰å¾…é˜Ÿåˆ— âœ… é«˜å¹¶å‘åœºæ™¯å¯è°ƒå¤§è‡³ 2048 serverNettyWorkerGroupEnable true æ˜¯å¦å¯ç”¨ Netty worker çº¿ç¨‹ç»„ é»˜è®¤ true serverPooledByteBufAllocatorEnable true æ˜¯å¦å¯ç”¨ Netty æ± åŒ–å†…å­˜ å»ºè®®ä¿æŒ enableShutdownGracefully false æ˜¯å¦ä¼˜é›…å…³é—­ âœ… å»ºè®®è®¾ä¸º true shutdownWaitTimeSeconds 30 ä¼˜é›…å…³é—­ç­‰å¾…æ—¶é—´ å»ºè®® 30~60 useEpollNativeSelector false æ˜¯å¦å¯ç”¨ Linux Epoll âœ… Linux ç¯å¢ƒå»ºè®®è®¾ä¸º true æé«˜æ€§èƒ½ clientWorkerThreads 4 å®¢æˆ·ç«¯ worker çº¿ç¨‹æ•° é»˜è®¤å³å¯ clientCallbackExecutorThreads 2 å®¢æˆ·ç«¯å›è°ƒçº¿ç¨‹æ•° é»˜è®¤å³å¯ clientOnewaySemaphoreValue 65535 å®¢æˆ·ç«¯å•å‘è¯·æ±‚å¹¶å‘é™åˆ¶ é»˜è®¤å³å¯ clientAsyncSemaphoreValue 65535 å®¢æˆ·ç«¯å¼‚æ­¥è¯·æ±‚å¹¶å‘é™åˆ¶ é»˜è®¤å³å¯ connectTimeoutMillis 3000 è¿æ¥è¶…æ—¶ï¼ˆmsï¼‰ âœ… å¯æé«˜è‡³ 5000 å¢åŠ å®¹é”™ channelNotActiveInterval 60000 æ£€æŸ¥é€šé“éæ´»åŠ¨é—´éš” é»˜è®¤å³å¯ isScanAvailableNameSrv true æ˜¯å¦æ‰«æå¯ç”¨ NameServer ä¿æŒ clientChannelMaxIdleTimeSeconds 120 å®¢æˆ·ç«¯ç©ºé—²è¿æ¥è¶…æ—¶ é»˜è®¤å³å¯ clientSocketSndBufSize 0 å®¢æˆ·ç«¯ TCP å‘é€ç¼“å†²åŒº å»ºè®® 131072 clientSocketRcvBufSize 0 å®¢æˆ·ç«¯ TCP æ¥æ”¶ç¼“å†²åŒº å»ºè®® 131072 clientPooledByteBufAllocatorEnable false å®¢æˆ·ç«¯æ˜¯å¦å¯ç”¨æ± åŒ– âœ… å»ºè®®è®¾ä¸º true æé«˜æ€§èƒ½ clientCloseSocketIfTimeout true è¶…æ—¶æ˜¯å¦å…³é—­ socket ä¿æŒé»˜è®¤ useTLS false æ˜¯å¦å¯ç”¨ TLS é€šä¿¡ âœ… è‹¥å…¬ç½‘éƒ¨ç½²å¼ºçƒˆå»ºè®®å¼€å¯ socksProxyConfig {} SOCKS ä»£ç†é…ç½® å†…ç½‘éƒ¨ç½²æ— éœ€è®¾ç½® disableCallbackExecutor false æ˜¯å¦ç¦ç”¨å›è°ƒæ‰§è¡Œå™¨ é»˜è®¤å³å¯ disableNettyWorkerGroup false æ˜¯å¦ç¦ç”¨ Netty worker group é»˜è®¤å³å¯ maxReconnectIntervalTimeSeconds 60 æœ€å¤§é‡è¿é—´éš” é»˜è®¤å³å¯ enableReconnectForGoAway true æ˜¯å¦å¯ç”¨ goaway è‡ªåŠ¨é‡è¿ ä¿æŒ true å¢å¼ºå¥å£®æ€§ æ¨èé‡ç‚¹ä¼˜åŒ–çš„å…³é”®é¡¹ ç±»åˆ« å‚æ•° æ¨èå€¼ åŸå›  æ€§èƒ½ useEpollNativeSelector true Linux æ€§èƒ½æ˜¾è‘—æå‡ å®‰å…¨ bindAddress å†…ç½‘ IP é˜²æ­¢æš´éœ²å…¬ç½‘ å®‰å…¨ useTLS trueï¼ˆå…¬ç½‘ï¼‰ å¯ç”¨åŠ å¯†ä¼ è¾“ å¥å£®æ€§ enableShutdownGracefully true é˜²æ­¢å¼ºåˆ¶å…³é—­å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ è´Ÿè½½ clientRequestThreadPoolNums 16~32 æé«˜å¹¶å‘èƒ½åŠ› ç½‘ç»œ serverSocketBacklog 2048 å‡å°‘è¿æ¥æ‹’ç» ç¼“å†² serverSocketSndBufSize / RcvBufSize 131072 æé«˜ç½‘ç»œåå æ–‡ä»¶è·¯å¾„ kvConfigPath / configStorePath é root è·¯å¾„ é¿å…æƒé™é—®é¢˜","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RocketMQ NameServer çš„é…ç½®é¡¹ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚","date_published":"2025-10-28T13:30:05.000Z","tags":["æŠ€æœ¯","rocketmq","åˆ†å¸ƒå¼","rocketmq"]},{"id":"https://blog.hanqunfeng.com/2025/10/24/rocketmq-02-dashboard/","url":"https://blog.hanqunfeng.com/2025/10/24/rocketmq-02-dashboard/","title":"RocketMQ Dashboard çš„å®‰è£…åŠä½¿ç”¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RocketMQ Dashboard çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/\">RocketMQå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RocketMQ-Dashboard-ç®€ä»‹\">RocketMQ Dashboard ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/docs/deploymentOperations/04Dashboard\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>RocketMQ Dashboard æ˜¯ RocketMQ çš„ç®¡æ§åˆ©å™¨ï¼Œä¸ºç”¨æˆ·æä¾›å®¢æˆ·ç«¯å’Œåº”ç”¨ç¨‹åºçš„å„ç§äº‹ä»¶ã€æ€§èƒ½çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ”¯æŒä»¥å¯è§†åŒ–å·¥å…·ä»£æ›¿ Topic é…ç½®ã€Broker ç®¡ç†ç­‰å‘½ä»¤è¡Œæ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŠŸèƒ½æ¦‚è§ˆ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é¢æ¿</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>è¿ç»´</strong></td>\n<td>ä¿®æ”¹ <strong>NameServer åœ°å€</strong>ï¼›é€‰æ‹© <strong>VIPChannel</strong> ç­‰è¿ç»´é…ç½®ã€‚</td>\n</tr>\n<tr>\n<td><strong>é©¾é©¶èˆ±</strong></td>\n<td>æŸ¥çœ‹ <strong>Brokerã€Topic æ¶ˆæ¯é‡</strong> ç­‰è¿è¡Œæ€»è§ˆä¿¡æ¯ã€‚</td>\n</tr>\n<tr>\n<td><strong>é›†ç¾¤</strong></td>\n<td>æŸ¥çœ‹ <strong>é›†ç¾¤åˆ†å¸ƒ</strong>ã€Broker é…ç½®ã€è¿è¡ŒçŠ¶æ€åŠè¯¦ç»†ä¿¡æ¯ã€‚</td>\n</tr>\n<tr>\n<td><strong>ä¸»é¢˜ï¼ˆTopicï¼‰</strong></td>\n<td>æœç´¢ã€ç­›é€‰ã€åˆ é™¤ã€æ›´æ–°/æ–°å¢ä¸»é¢˜ï¼›æŸ¥çœ‹ <strong>æ¶ˆæ¯è·¯ç”±</strong>ï¼›æ‰§è¡Œ <strong>å‘é€æ¶ˆæ¯</strong>ã€<strong>é‡ç½®æ¶ˆè´¹ä½ç‚¹</strong> ç­‰æ“ä½œã€‚</td>\n</tr>\n<tr>\n<td><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong></td>\n<td>æœç´¢ã€åˆ é™¤ã€æ–°å¢/æ›´æ–°æ¶ˆè´¹è€…ç»„ï¼›æŸ¥çœ‹ <strong>ç»ˆç«¯ä¿¡æ¯ã€æ¶ˆè´¹è¯¦æƒ…ã€é…ç½®é¡¹</strong>ã€‚</td>\n</tr>\n<tr>\n<td><strong>æ¶ˆæ¯ï¼ˆMessageï¼‰</strong></td>\n<td>æŸ¥çœ‹ <strong>æ¶ˆæ¯è®°å½•ã€æ­»ä¿¡æ¶ˆæ¯ã€æ¶ˆæ¯è½¨è¿¹</strong> ç­‰æ¶ˆæ¯çº§è¯¦æƒ…ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç³»ç»Ÿè¦æ±‚ ä¸ ç½‘ç»œé…ç½®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»åˆ«</th>\n<th>é¡¹ç›®</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç³»ç»Ÿè¦æ±‚</strong></td>\n<td>æ“ä½œç³»ç»Ÿ</td>\n<td>Linux / Unix / macOS</td>\n</tr>\n<tr>\n<td></td>\n<td>JDK</td>\n<td>64 ä½ JDK, 1.x ç‰ˆæœ¬éœ€è¦<strong>1.8+</strong>ï¼Œ2.xç‰ˆæœ¬éœ€è¦ <strong>17+</strong></td>\n</tr>\n<tr>\n<td></td>\n<td>æ„å»ºå·¥å…·</td>\n<td><strong>Maven 3.2.x</strong> æˆ–æ›´é«˜ç‰ˆæœ¬</td>\n</tr>\n<tr>\n<td></td>\n<td>å¯åŠ¨é¡¹</td>\n<td>å¯åŠ¨ <strong>RocketMQ</strong>ï¼ˆåŒ…æ‹¬ NameServer ä¸ Brokerï¼‰</td>\n</tr>\n<tr>\n<td><strong>ç½‘ç»œé…ç½®</strong></td>\n<td>ç½‘ç»œè®¿é—®</td>\n<td>äº‘æœåŠ¡å™¨éœ€å¯è¿œç¨‹è®¿é—®ï¼Œæˆ–æœ¬åœ°è™šæ‹Ÿæœºéœ€å¯ <strong>PING é€šå¤–ç½‘</strong></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RocketMQ-Dashboard-çš„å®‰è£…\">RocketMQ Dashboard çš„å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éƒ¨ç½² RocketMQ Dashboard 2.xï¼Œéœ€è¦å®‰è£… JDK17</p>\n</li>\n<li class=\"lvl-2\">\n<p>æºç å®‰è£…ï¼Œ<a href=\"https://github.com/apache/rocketmq-dashboard\">æºç ä¸‹è½½</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½æºç </span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/soft/rocketmq</span><br><span class=\"line\">wget https://github.com/apache/rocketmq-dashboard/archive/refs/tags/rocketmq-dashboard-2.1.0.tar.gz</span><br><span class=\"line\">tar -zxvf rocketmq-dashboard-2.1.0.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s rocketmq-dashboard-rocketmq-dashboard-2.1.0 rocketmq-dashboard</span><br><span class=\"line\"><span class=\"built_in\">cd</span> rocketmq-dashboard</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>bug ä¿®å¤ï¼Œå½“å‰<code>2.1.0</code>ç‰ˆæœ¬å­˜åœ¨bugï¼Œåªèƒ½é€šè¿‡<code>http://localhost:8082</code>è®¿é—®ï¼Œå¦‚æœéœ€è¦ipæˆ–åŸŸåè®¿é—®ï¼Œåˆ™éœ€è¦ä¿®æ”¹æºç </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> frontend-new/src/api/remoteApi</span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s|apiBaseUrl: &#x27;</span>\\&#x27;<span class=\"string\">&#x27;http://localhost:8082&#x27;</span>\\&#x27;<span class=\"string\">&#x27;|apiBaseUrl: process.env.REACT_APP_API_BASE_URL \\|\\| window.location.origin|&#x27;</span> remoteApi.js.bck</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›¿æ¢å‰ï¼š</span></span><br><span class=\"line\">const appConfig = &#123;</span><br><span class=\"line\">    apiBaseUrl: <span class=\"string\">&#x27;http://localhost:8082&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\"># æ›¿æ¢åï¼š</span></span><br><span class=\"line\">const appConfig = &#123;</span><br><span class=\"line\">    apiBaseUrl: process.env.REACT_APP_API_BASE_URL || window.location.origin</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>ç¯å¢ƒ</th>\n<th>ç¯å¢ƒå˜é‡å€¼</th>\n<th>ç»“æœ (<code>appConfig.apiBaseUrl</code>)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å¼€å‘ç¯å¢ƒ</td>\n<td><code>REACT_APP_API_BASE_URL=http://localhost:8080</code></td>\n<td><code>http://localhost:8080</code></td>\n</tr>\n<tr>\n<td>æµ‹è¯•ç¯å¢ƒ</td>\n<td><code>REACT_APP_API_BASE_URL=https://api.test.example.com</code></td>\n<td><code>https://api.test.example.com</code></td>\n</tr>\n<tr>\n<td>æœªè®¾ç½®å˜é‡</td>\n<td><em>(æ— è¯¥ç¯å¢ƒå˜é‡)</em> åˆ™ä½¿ç”¨é»˜è®¤çš„ <code>window.location.origin</code>ï¼Œå…¶è¡¨ç¤º å½“å‰ç½‘é¡µçš„ åè®® + åŸŸå + ç«¯å£å·</td>\n<td>è‡ªåŠ¨ä½¿ç”¨å½“å‰ç½‘ç«™åœ°å€ï¼Œå¦‚ <code>https://myapp.example.com</code></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ç›®å‰<code>2.1.0</code>ç‰ˆæœ¬çš„bugè¿˜æ¯”è¾ƒå¤šï¼ŒGitHubä»“åº“ä¸­çš„ä»£ç å·²ç»ä¿®å¤äº†åŒ…æ‹¬è¯¥bugåœ¨å†…çš„éƒ¨åˆ†bugï¼Œä¸è¿‡è¿˜æ²¡æœ‰å‘å¸ƒåˆ° releaseã€‚<br>\nç€æ€¥çš„å°ä¼™ä¼´å¯ä»¥é€šè¿‡ <code>git clone</code> é¡¹ç›®ï¼Œç¼–è¯‘å¹¶è¿è¡Œï¼Œæˆ–è€…ç­‰å¾…ä½œè€…å‘å¸ƒæ–°ç‰ˆæœ¬ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/apache/rocketmq-dashboard.git</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¯‘</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/soft/rocketmq/rocketmq-dashboard</span><br><span class=\"line\"><span class=\"comment\"># ç¼–è¯‘</span></span><br><span class=\"line\">JAVA_HOME=/usr/local/jdk/jdk17 mvn clean package -Dmaven.test.skip=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># å°†jaråŒ…å¤åˆ¶åˆ°runç›®å½•ä¸‹ï¼Œä»¥é¿å…é‡æ–°ç¼–è¯‘æ—¶è¢«è¦†ç›–</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> run</span><br><span class=\"line\"><span class=\"built_in\">cp</span> target/rocketmq-dashboard-2.1.0.jar run/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŒ‰éœ€æ›¿æ¢é…ç½®ï¼Œ</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim run/application.yaml # æŒ‰éœ€æ›¿æ¢é…ç½®</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">rocketmq:</span></span><br><span class=\"line\">  <span class=\"attr\">config:</span></span><br><span class=\"line\">    <span class=\"attr\">namesrvAddrs:</span>                <span class=\"comment\"># å¡«å†™NameServeråœ°å€åˆ—è¡¨</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">10.250</span><span class=\"number\">.0</span><span class=\"number\">.175</span><span class=\"string\">:9876</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">10.250</span><span class=\"number\">.0</span><span class=\"number\">.188</span><span class=\"string\">:9876</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">10.250</span><span class=\"number\">.0</span><span class=\"number\">.131</span><span class=\"string\">:9876</span></span><br><span class=\"line\">    <span class=\"attr\">dataPath:</span> <span class=\"string\">/usr/local/soft/rocketmq/data/dashboard</span> <span class=\"comment\"># Dashboardæ–‡ä»¶ç›®å½•ï¼Œç™»å½•ç”¨æˆ·é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•</span></span><br><span class=\"line\">    <span class=\"attr\">loginRequired:</span> <span class=\"literal\">true</span>  <span class=\"comment\"># æ˜¯å¦éœ€è¦ç™»å½•ï¼Œæ­¤æ—¶éœ€è¦åœ¨ dataPath ä¸‹åˆ›å»º users.properties æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/users.propertiesæ–‡ä»¶</span></span><br><span class=\"line\">    <span class=\"comment\"># å¦‚æœ broker å¼€å¯äº† ACLï¼Œåˆ™éœ€è¦é…ç½® accessKey å’Œ secretKey</span></span><br><span class=\"line\"><span class=\"comment\">#    accessKey: mqadmin</span></span><br><span class=\"line\"><span class=\"comment\">#    secretKey: 1234567</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>users.properties</code> æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¯¥æ–‡ä»¶æ”¯æŒçƒ­ä¿®æ”¹ï¼Œå³æ·»åŠ å’Œä¿®æ”¹ç”¨æˆ·æ—¶ï¼Œä¸éœ€è¦é‡æ–°å¯åŠ¨console</span></span><br><span class=\"line\"><span class=\"comment\"># æ ¼å¼ï¼Œ æ¯è¡Œå®šä¹‰ä¸€ä¸ªç”¨æˆ·ï¼Œ username=password[,N]  #Næ˜¯å¯é€‰é¡¹ï¼Œå¯ä»¥ä¸º0 (æ™®é€šç”¨æˆ·)ï¼› 1 ï¼ˆç®¡ç†å‘˜ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># å®šä¹‰ç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜æ‹¥æœ‰å…¨éƒ¨æƒé™</span></span><br><span class=\"line\">super=passwd,1</span><br><span class=\"line\"><span class=\"comment\"># å®šä¹‰æ™®é€šç”¨æˆ·ï¼Œæ™®é€šç”¨æˆ·çš„æƒé™éœ€è¦åœ¨ dataPath ä¸‹çš„ role-permission.yml æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/role-permission.ymlæ–‡ä»¶</span></span><br><span class=\"line\">user1=passwd</span><br><span class=\"line\">user2=passwd</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>role-permission.yml</code> æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¯¥æ–‡ä»¶æ”¯æŒçƒ­ä¿®æ”¹ï¼Œå³æ·»åŠ å’Œä¿®æ”¹ç”¨æˆ·æ—¶ï¼Œä¸éœ€è¦é‡æ–°å¯åŠ¨console</span></span><br><span class=\"line\"><span class=\"comment\"># æ ¼å¼ï¼Œå¦‚æœå¢åŠ å’Œåˆ é™¤æ¥å£æƒé™ï¼Œç›´æ¥åœ¨åˆ—è¡¨ä¸­å¢åŠ å’Œåˆ é™¤æ¥å£åœ°å€å³å¯ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># æ¥å£è·¯å¾„é…ç½®æ”¯æŒé€šé…ç¬¦</span></span><br><span class=\"line\"><span class=\"comment\"># * è¡¨ç¤ºåŒ¹é…0æˆ–å¤šä¸ªä¸æ˜¯/çš„å­—ç¬¦</span></span><br><span class=\"line\"><span class=\"comment\"># ** è¡¨ç¤ºåŒ¹é…0æˆ–å¤šä¸ªä»»æ„å­—ç¬¦</span></span><br><span class=\"line\"><span class=\"comment\"># ? è¡¨ç¤ºåŒ¹é…1ä¸ªä»»æ„å­—ç¬¦</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">rolePerms:</span></span><br><span class=\"line\">  <span class=\"comment\"># æ™®é€šç”¨æˆ·ï¼Œä»¥ä¸‹æƒé™ä¸ºé»˜è®¤æƒé™ï¼ŒåŸºæœ¬ä¸Šå°±åªæ˜¯æŸ¥è¯¢çš„æƒé™</span></span><br><span class=\"line\">  <span class=\"attr\">Normal:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/rocketmq/nsaddr</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/ops/*</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/dashboard/**</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/topic/*.query</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/topic/sendTopicMessage.do</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/producer/*.query</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/message/*</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/messageTrace/*</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/monitor/*</span></span><br><span class=\"line\">    <span class=\"string\">....</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> run</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ï¼Œé»˜è®¤ä¼šåŠ è½½ä¸jaråŒ…åŒçº§ç›®å½•ä¸‹çš„application.yamlæ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> /usr/local/jdk/jdk17/bin/java -jar rocketmq-dashboard-2.1.0.jar 1&gt;dashboard.log 2&gt;&amp;1 &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ—¥å¿—</span></span><br><span class=\"line\"><span class=\"built_in\">tail</span> -f dashboard.log</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/9F26eh.png\" alt=\"\" width=\"1400\" height=\"800\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/apache/rocketmq-dashboard/blob/master/docs/1_0_0/UserGuide_CN.md\">Dashboard ä½¿ç”¨æ‰‹å†Œ</a></p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RocketMQ Dashboard çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚ RocketMQ Dashboard ç®€ä»‹ å®˜æ–¹æ–‡æ¡£ RocketMQ Dashboard æ˜¯ RocketMQ çš„ç®¡æ§åˆ©å™¨ï¼Œä¸ºç”¨æˆ·æä¾›å®¢æˆ·ç«¯å’Œåº”ç”¨ç¨‹åºçš„å„ç§äº‹ä»¶ã€æ€§èƒ½çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ”¯æŒä»¥å¯è§†åŒ–å·¥å…·ä»£æ›¿ Topic é…ç½®ã€Broker ç®¡ç†ç­‰å‘½ä»¤è¡Œæ“ä½œã€‚ åŠŸèƒ½æ¦‚è§ˆ é¢æ¿ åŠŸèƒ½è¯´æ˜ è¿ç»´ ä¿®æ”¹ NameServer åœ°å€ï¼›é€‰æ‹© VIPChannel ç­‰è¿ç»´é…ç½®ã€‚ é©¾é©¶èˆ± æŸ¥çœ‹ Brokerã€Topic æ¶ˆæ¯é‡ ç­‰è¿è¡Œæ€»è§ˆä¿¡æ¯ã€‚ é›†ç¾¤ æŸ¥çœ‹ é›†ç¾¤åˆ†å¸ƒã€Broker é…ç½®ã€è¿è¡ŒçŠ¶æ€åŠè¯¦ç»†ä¿¡æ¯ã€‚ ä¸»é¢˜ï¼ˆTopicï¼‰ æœç´¢ã€ç­›é€‰ã€åˆ é™¤ã€æ›´æ–°/æ–°å¢ä¸»é¢˜ï¼›æŸ¥çœ‹ æ¶ˆæ¯è·¯ç”±ï¼›æ‰§è¡Œ å‘é€æ¶ˆæ¯ã€é‡ç½®æ¶ˆè´¹ä½ç‚¹ ç­‰æ“ä½œã€‚ æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ æœç´¢ã€åˆ é™¤ã€æ–°å¢/æ›´æ–°æ¶ˆè´¹è€…ç»„ï¼›æŸ¥çœ‹ ç»ˆç«¯ä¿¡æ¯ã€æ¶ˆè´¹è¯¦æƒ…ã€é…ç½®é¡¹ã€‚ æ¶ˆæ¯ï¼ˆMessageï¼‰ æŸ¥çœ‹ æ¶ˆæ¯è®°å½•ã€æ­»ä¿¡æ¶ˆæ¯ã€æ¶ˆæ¯è½¨è¿¹ ç­‰æ¶ˆæ¯çº§è¯¦æƒ…ã€‚ ç³»ç»Ÿè¦æ±‚ ä¸ ç½‘ç»œé…ç½® ç±»åˆ« é¡¹ç›® è¯´æ˜ ç³»ç»Ÿè¦æ±‚ æ“ä½œç³»ç»Ÿ Linux / Unix / macOS JDK 64 ä½ JDK, 1.x ç‰ˆæœ¬éœ€è¦1.8+ï¼Œ2.xç‰ˆæœ¬éœ€è¦ 17+ æ„å»ºå·¥å…· Maven 3.2.x æˆ–æ›´é«˜ç‰ˆæœ¬ å¯åŠ¨é¡¹ å¯åŠ¨ RocketMQï¼ˆåŒ…æ‹¬ NameServer ä¸ Brokerï¼‰ ç½‘ç»œé…ç½® ç½‘ç»œè®¿é—® äº‘æœåŠ¡å™¨éœ€å¯è¿œç¨‹è®¿é—®ï¼Œæˆ–æœ¬åœ°è™šæ‹Ÿæœºéœ€å¯ PING é€šå¤–ç½‘ RocketMQ Dashboard çš„å®‰è£… éƒ¨ç½² RocketMQ Dashboard 2.xï¼Œéœ€è¦å®‰è£… JDK17 æºç å®‰è£…ï¼Œæºç ä¸‹è½½ 123456# ä¸‹è½½æºç cd /usr/local/soft/rocketmqwget https://github.com/apache/rocketmq-dashboard/archive/refs/tags/rocketmq-dashboard-2.1.0.tar.gztar -zxvf rocketmq-dashboard-2.1.0.tar.gzln -s rocketmq-dashboard-rocketmq-dashboard-2.1.0 rocketmq-dashboardcd rocketmq-dashboard bug ä¿®å¤ï¼Œå½“å‰2.1.0ç‰ˆæœ¬å­˜åœ¨bugï¼Œåªèƒ½é€šè¿‡http://localhost:8082è®¿é—®ï¼Œå¦‚æœéœ€è¦ipæˆ–åŸŸåè®¿é—®ï¼Œåˆ™éœ€è¦ä¿®æ”¹æºç  1234567891011cd frontend-new/src/api/remoteApised -i &#x27;s|apiBaseUrl: &#x27;\\&#x27;&#x27;http://localhost:8082&#x27;\\&#x27;&#x27;|apiBaseUrl: process.env.REACT_APP_API_BASE_URL \\|\\| window.location.origin|&#x27; remoteApi.js.bck# æ›¿æ¢å‰ï¼šconst appConfig = &#123; apiBaseUrl: &#x27;http://localhost:8082&#x27;&#125;;# æ›¿æ¢åï¼šconst appConfig = &#123; apiBaseUrl: process.env.REACT_APP_API_BASE_URL || window.location.origin&#125;; ç¯å¢ƒ ç¯å¢ƒå˜é‡å€¼ ç»“æœ (appConfig.apiBaseUrl) å¼€å‘ç¯å¢ƒ REACT_APP_API_BASE_URL=http://localhost:8080 http://localhost:8080 æµ‹è¯•ç¯å¢ƒ REACT_APP_API_BASE_URL=https://api.test.example.com https://api.test.example.com æœªè®¾ç½®å˜é‡ (æ— è¯¥ç¯å¢ƒå˜é‡) åˆ™ä½¿ç”¨é»˜è®¤çš„ window.location.originï¼Œå…¶è¡¨ç¤º å½“å‰ç½‘é¡µçš„ åè®® + åŸŸå + ç«¯å£å· è‡ªåŠ¨ä½¿ç”¨å½“å‰ç½‘ç«™åœ°å€ï¼Œå¦‚ https://myapp.example.com ç›®å‰2.1.0ç‰ˆæœ¬çš„bugè¿˜æ¯”è¾ƒå¤šï¼ŒGitHubä»“åº“ä¸­çš„ä»£ç å·²ç»ä¿®å¤äº†åŒ…æ‹¬è¯¥bugåœ¨å†…çš„éƒ¨åˆ†bugï¼Œä¸è¿‡è¿˜æ²¡æœ‰å‘å¸ƒåˆ° releaseã€‚ ç€æ€¥çš„å°ä¼™ä¼´å¯ä»¥é€šè¿‡ git clone é¡¹ç›®ï¼Œç¼–è¯‘å¹¶è¿è¡Œï¼Œæˆ–è€…ç­‰å¾…ä½œè€…å‘å¸ƒæ–°ç‰ˆæœ¬ã€‚ 1git clone https://github.com/apache/rocketmq-dashboard.git ç¼–è¯‘ 123456cd /usr/local/soft/rocketmq/rocketmq-dashboard# ç¼–è¯‘JAVA_HOME=/usr/local/jdk/jdk17 mvn clean package -Dmaven.test.skip=true# å°†jaråŒ…å¤åˆ¶åˆ°runç›®å½•ä¸‹ï¼Œä»¥é¿å…é‡æ–°ç¼–è¯‘æ—¶è¢«è¦†ç›–mkdir runcp target/rocketmq-dashboard-2.1.0.jar run/ æŒ‰éœ€æ›¿æ¢é…ç½®ï¼Œ 12345678910111213# vim run/application.yaml # æŒ‰éœ€æ›¿æ¢é…ç½®rocketmq: config: namesrvAddrs: # å¡«å†™NameServeråœ°å€åˆ—è¡¨ - 10.250.0.175:9876 - 10.250.0.188:9876 - 10.250.0.131:9876 dataPath: /usr/local/soft/rocketmq/data/dashboard # Dashboardæ–‡ä»¶ç›®å½•ï¼Œç™»å½•ç”¨æˆ·é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½• loginRequired: true # æ˜¯å¦éœ€è¦ç™»å½•ï¼Œæ­¤æ—¶éœ€è¦åœ¨ dataPath ä¸‹åˆ›å»º users.properties æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/users.propertiesæ–‡ä»¶ # å¦‚æœ broker å¼€å¯äº† ACLï¼Œåˆ™éœ€è¦é…ç½® accessKey å’Œ secretKey# accessKey: mqadmin# secretKey: 1234567 users.properties æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š 1234567# è¯¥æ–‡ä»¶æ”¯æŒçƒ­ä¿®æ”¹ï¼Œå³æ·»åŠ å’Œä¿®æ”¹ç”¨æˆ·æ—¶ï¼Œä¸éœ€è¦é‡æ–°å¯åŠ¨console# æ ¼å¼ï¼Œ æ¯è¡Œå®šä¹‰ä¸€ä¸ªç”¨æˆ·ï¼Œ username=password[,N] #Næ˜¯å¯é€‰é¡¹ï¼Œå¯ä»¥ä¸º0 (æ™®é€šç”¨æˆ·)ï¼› 1 ï¼ˆç®¡ç†å‘˜ï¼‰# å®šä¹‰ç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜æ‹¥æœ‰å…¨éƒ¨æƒé™super=passwd,1# å®šä¹‰æ™®é€šç”¨æˆ·ï¼Œæ™®é€šç”¨æˆ·çš„æƒé™éœ€è¦åœ¨ dataPath ä¸‹çš„ role-permission.yml æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¦‚æœè¯¥ç›®å½•ä¸‹ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œåˆ™é»˜è®¤ä½¿ç”¨resources/role-permission.ymlæ–‡ä»¶user1=passwduser2=passwd role-permission.yml æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š 1234567891011121314151617181920# è¯¥æ–‡ä»¶æ”¯æŒçƒ­ä¿®æ”¹ï¼Œå³æ·»åŠ å’Œä¿®æ”¹ç”¨æˆ·æ—¶ï¼Œä¸éœ€è¦é‡æ–°å¯åŠ¨console# æ ¼å¼ï¼Œå¦‚æœå¢åŠ å’Œåˆ é™¤æ¥å£æƒé™ï¼Œç›´æ¥åœ¨åˆ—è¡¨ä¸­å¢åŠ å’Œåˆ é™¤æ¥å£åœ°å€å³å¯ã€‚# æ¥å£è·¯å¾„é…ç½®æ”¯æŒé€šé…ç¬¦# * è¡¨ç¤ºåŒ¹é…0æˆ–å¤šä¸ªä¸æ˜¯/çš„å­—ç¬¦# ** è¡¨ç¤ºåŒ¹é…0æˆ–å¤šä¸ªä»»æ„å­—ç¬¦# ? è¡¨ç¤ºåŒ¹é…1ä¸ªä»»æ„å­—ç¬¦rolePerms: # æ™®é€šç”¨æˆ·ï¼Œä»¥ä¸‹æƒé™ä¸ºé»˜è®¤æƒé™ï¼ŒåŸºæœ¬ä¸Šå°±åªæ˜¯æŸ¥è¯¢çš„æƒé™ Normal: - /rocketmq/nsaddr - /ops/* - /dashboard/** - /topic/*.query - /topic/sendTopicMessage.do - /producer/*.query - /message/* - /messageTrace/* - /monitor/* .... å¯åŠ¨ 123456cd run# å¯åŠ¨ï¼Œé»˜è®¤ä¼šåŠ è½½ä¸jaråŒ…åŒçº§ç›®å½•ä¸‹çš„application.yamlæ–‡ä»¶nohup /usr/local/jdk/jdk17/bin/java -jar rocketmq-dashboard-2.1.0.jar 1&gt;dashboard.log 2&gt;&amp;1 &amp;# æŸ¥çœ‹æ—¥å¿—tail -f dashboard.log Dashboard ä½¿ç”¨æ‰‹å†Œ","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RocketMQ Dashboard çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚","date_published":"2025-10-24T13:30:05.000Z","tags":["æŠ€æœ¯","rocketmq","åˆ†å¸ƒå¼","rocketmq"]},{"id":"https://blog.hanqunfeng.com/2025/10/23/rocketmq-01-install/","url":"https://blog.hanqunfeng.com/2025/10/23/rocketmq-01-install/","title":"RocketMQ çš„å®‰è£…åŠä½¿ç”¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RocketMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/\">RocketMQå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Apache-RocketMQ-ç®€ä»‹\">Apache RocketMQ ç®€ä»‹</h2>\n<h3 id=\"ä¸€ã€RocketMQ-æ˜¯ä»€ä¹ˆï¼Ÿ\">ä¸€ã€RocketMQ æ˜¯ä»€ä¹ˆï¼Ÿ</h3>\n<p>RocketMQ æ˜¯ä¸€ä¸ª<strong>åˆ†å¸ƒå¼ã€é˜Ÿåˆ—æ¨¡å‹çš„æ¶ˆæ¯ä¸­é—´ä»¶</strong>ã€‚å®ƒç”±é˜¿é‡Œå·´å·´åœ¨2012å¹´å¼€æºï¼Œå¹¶äº2017å¹´æ­£å¼æˆä¸º Apache åŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ã€‚</p>\n<p>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è´Ÿè´£å¯é ä¼ é€’æ¶ˆæ¯çš„â€œé‚®å±€â€æˆ–â€œå¿«é€’ç³»ç»Ÿâ€ã€‚å½“ç³»ç»ŸAéœ€è¦å‘é€æ•°æ®ç»™ç³»ç»ŸBï¼Œä½†å®ƒä»¬ä¹‹é—´ä¸ç›´æ¥é€šä¿¡æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ RocketMQ æ¥ä¸­è½¬ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ã€ä¸é‡å¤ï¼Œå¹¶ä¸”èƒ½æŒ‰é¡ºåºé€è¾¾ã€‚</p>\n<p><strong>RocketMQ æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯é ã€é«˜å®æ—¶çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶</strong>ã€‚å®ƒå°±åƒåˆ†å¸ƒå¼ç³»ç»Ÿçš„â€œä¸­æ¢ç¥ç»ç³»ç»Ÿâ€ï¼Œè´Ÿè´£åœ¨å„ä¸ªæœåŠ¡ä¹‹é—´å¯é ã€é«˜æ•ˆåœ°ä¼ é€’æ•°æ®ï¼Œæ˜¯ç°ä»£äº’è”ç½‘æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„åŸºç¡€ç»„ä»¶ä¹‹ä¸€ã€‚</p>\n<p><strong>RocketMQ 5.x é€šè¿‡å¼•å…¥ Proxy æ¨¡å¼ï¼Œæå¤§åœ°æå‡äº†æ¶æ„çš„çµæ´»æ€§ã€å¤šè¯­è¨€æ”¯æŒèƒ½åŠ›å’Œäº‘åŸç”Ÿäº²å’ŒåŠ›</strong>ï¼Œæ˜¯å…¶åœ¨æ¶ˆæ¯ä¸­é—´ä»¶é¢†åŸŸæŒç»­æ¼”è¿›çš„é‡è¦é‡Œç¨‹ç¢‘ã€‚</p>\n<p>å®ƒä¸ Kafkaã€RabbitMQ ç­‰éƒ½æ˜¯ä¸šç•Œé¡¶çº§çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½†å„æœ‰ä¾§é‡ã€‚RocketMQ åœ¨äº‹åŠ¡æ¶ˆæ¯ã€é¡ºåºæ¶ˆæ¯å’Œå¯¹åœ¨çº¿ä¸šåŠ¡çš„ç¨³å®šæ€§æ”¯æŒæ–¹é¢è¡¨ç°å°¤ä¸ºå‡ºè‰²ã€‚</p>\n<hr>\n<h3 id=\"äºŒã€æ ¸å¿ƒç‰¹ç‚¹ä¸ä¼˜åŠ¿\">äºŒã€æ ¸å¿ƒç‰¹ç‚¹ä¸ä¼˜åŠ¿</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">åºå·</th>\n<th style=\"text-align:left\">ç‰¹æ€§</th>\n<th style=\"text-align:left\">å…¸å‹åœºæ™¯</th>\n<th style=\"text-align:left\">ä¸»è¦ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><strong>1</strong></td>\n<td style=\"text-align:left\"><strong>å‰Šå³°å¡«è°·</strong></td>\n<td style=\"text-align:left\">ç”µå•†ç§’æ€ã€å¤§ä¿ƒæ´»åŠ¨æ—¶å¤§é‡ä¸‹å•è¯·æ±‚ç¬é—´æ¶Œå…¥</td>\n<td style=\"text-align:left\">å°†çªå‘è¯·æ±‚å…ˆç¼“å­˜ä¸ºæ¶ˆæ¯ï¼Œåç«¯ç³»ç»ŸæŒ‰è‡ªèº«èƒ½åŠ›å¹³ç¨³æ¶ˆè´¹ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½å´©æºƒ</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>2</strong></td>\n<td style=\"text-align:left\"><strong>å¼‚æ­¥è§£è€¦</strong></td>\n<td style=\"text-align:left\">ç”¨æˆ·æ³¨å†Œåè§¦å‘å¤šç³»ç»Ÿä»»åŠ¡ï¼ˆé‚®ä»¶ã€ä¼˜æƒ åˆ¸ã€ç§¯åˆ†ï¼‰</td>\n<td style=\"text-align:left\">ä¸»æµç¨‹åªè´Ÿè´£å‘é€æ¶ˆæ¯ï¼Œå…¶ä»–ç³»ç»Ÿç‹¬ç«‹å¼‚æ­¥å¤„ç†ï¼Œé™ä½ç³»ç»Ÿé—´è€¦åˆã€æé«˜æ‰©å±•æ€§</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>3</strong></td>\n<td style=\"text-align:left\"><strong>é¡ºåºæ¶ˆæ¯</strong></td>\n<td style=\"text-align:left\">è®¢å•çŠ¶æ€å˜æ›´ï¼ˆåˆ›å»º â†’ ä»˜æ¬¾ â†’ å‘è´§ â†’ æ”¶è´§ï¼‰</td>\n<td style=\"text-align:left\">åŒä¸€ä¸šåŠ¡é”®ï¼ˆå¦‚è®¢å•IDï¼‰çš„æ¶ˆæ¯æŒ‰é¡ºåºå‘é€å’Œæ¶ˆè´¹ï¼Œä¿è¯ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>4</strong></td>\n<td style=\"text-align:left\"><strong>æŒä¹…åŒ–ä¸é«˜å¯é æ€§</strong></td>\n<td style=\"text-align:left\">å…³é”®ä¸šåŠ¡æ¶ˆæ¯å¿…é¡»ä¸ä¸¢å¤±ï¼ˆäº¤æ˜“ã€æ”¯ä»˜ã€æ—¥å¿—ï¼‰</td>\n<td style=\"text-align:left\">æ‰€æœ‰æ¶ˆæ¯å†™å…¥ç£ç›˜å¹¶æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œå³ä½¿æœåŠ¡å™¨é‡å¯ä¹Ÿèƒ½æ¢å¤ï¼Œä¿è¯é«˜å¯ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>5</strong></td>\n<td style=\"text-align:left\"><strong>æ¶ˆæ¯å›æº¯</strong></td>\n<td style=\"text-align:left\">æ¶ˆè´¹é€»è¾‘å‡ºé”™ã€æ•°æ®é‡ç®—ã€è¡¥å¿ä»»åŠ¡</td>\n<td style=\"text-align:left\">æ”¯æŒé‡ç½®æ¶ˆè´¹ä½ç‚¹ï¼Œé‡æ–°æ¶ˆè´¹å†å²æ¶ˆæ¯ï¼Œå®ç°ä¸šåŠ¡è¡¥å¿ä¸è¿½æº¯</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>6</strong></td>\n<td style=\"text-align:left\"><strong>æµ·é‡æ¶ˆæ¯å †ç§¯èƒ½åŠ›</strong></td>\n<td style=\"text-align:left\">å¤§è§„æ¨¡å¼‚æ­¥æ—¥å¿—æ”¶é›†ã€IoT æ•°æ®æ±‡èšã€åŸ‹ç‚¹åˆ†æ</td>\n<td style=\"text-align:left\">æ”¯æŒä¸‡äº¿çº§æ¶ˆæ¯å †ç§¯ï¼Œæ€§èƒ½ç¨³å®šä¸è¡°å‡ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®åœºæ™¯</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"ä¸‰ã€æ ¸å¿ƒæ¶æ„ä¸æ¦‚å¿µ\">ä¸‰ã€æ ¸å¿ƒæ¶æ„ä¸æ¦‚å¿µ</h3>\n<p>è¦ç†è§£ RocketMQï¼Œéœ€è¦çŸ¥é“å‡ ä¸ªå…³é”®è§’è‰²ï¼š<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/frTwo1.png\" alt=\"\"></p>\n<h4 id=\"ç»å…¸æ ¸å¿ƒç»„ä»¶\">ç»å…¸æ ¸å¿ƒç»„ä»¶</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">åºå·</th>\n<th style=\"text-align:left\">ç»„ä»¶åç§°</th>\n<th style=\"text-align:left\">ä¸»è¦ä½œç”¨</th>\n<th style=\"text-align:left\">è¯´æ˜ / ç‰¹ç‚¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><strong>1</strong></td>\n<td style=\"text-align:left\"><strong>Producerï¼ˆç”Ÿäº§è€…ï¼‰</strong></td>\n<td style=\"text-align:left\">å‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯</td>\n<td style=\"text-align:left\">è´Ÿè´£å°†ä¸šåŠ¡ç³»ç»Ÿçš„æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„ <strong>Topic</strong>ï¼Œæ”¯æŒåŒæ­¥ã€å¼‚æ­¥ã€å•å‘ä¸‰ç§å‘é€æ–¹å¼</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>2</strong></td>\n<td style=\"text-align:left\"><strong>Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰</strong></td>\n<td style=\"text-align:left\">æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯çš„å®¢æˆ·ç«¯</td>\n<td style=\"text-align:left\">ä» Broker æ‹‰å–æ¶ˆæ¯å¹¶è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¯åˆ†ä¸º <strong>Push</strong> å’Œ <strong>Pull</strong> ä¸¤ç§æ¶ˆè´¹æ¨¡å¼</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>3</strong></td>\n<td style=\"text-align:left\"><strong>Consumer Groupï¼ˆæ¶ˆè´¹è€…ç»„ï¼‰</strong></td>\n<td style=\"text-align:left\">å®ç°è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨æ¶ˆè´¹</td>\n<td style=\"text-align:left\">å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…åŒä¸€ Topic æ—¶ç»„æˆæ¶ˆè´¹è€…ç»„ï¼Œä¸€ä¸ªåˆ†åŒºåªä¼šè¢«ç»„å†…ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>4</strong></td>\n<td style=\"text-align:left\"><strong>Brokerï¼ˆæ¶ˆæ¯æœåŠ¡å™¨ï¼‰</strong></td>\n<td style=\"text-align:left\">å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯</td>\n<td style=\"text-align:left\">RocketMQ çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£æ¶ˆæ¯çš„æŒä¹…åŒ–ã€è½¬å‘ã€ä¸»ä»å¤åˆ¶å’Œé«˜å¯ç”¨</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>5</strong></td>\n<td style=\"text-align:left\"><strong>Topicï¼ˆä¸»é¢˜ï¼‰</strong></td>\n<td style=\"text-align:left\">æ¶ˆæ¯çš„åˆ†ç±»ä¸è·¯ç”±å•å…ƒ</td>\n<td style=\"text-align:left\">Producer å‘é€æ¶ˆæ¯åˆ°æŒ‡å®š Topicï¼ŒConsumer è®¢é˜… Topic æ¶ˆè´¹æ¶ˆæ¯ï¼›ä¸€ä¸ª Topic å¯åŒ…å«å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆåˆ†åŒºï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>6</strong></td>\n<td style=\"text-align:left\"><strong>Name Serverï¼ˆåå­—æœåŠ¡ï¼‰</strong></td>\n<td style=\"text-align:left\">ç®¡ç† Broker åœ°å€ä¿¡æ¯</td>\n<td style=\"text-align:left\">ç±»ä¼¼è½»é‡çº§æ³¨å†Œä¸­å¿ƒï¼Œç»´æŠ¤ Broker å…ƒæ•°æ®ï¼Œå¸®åŠ© Producer å’Œ Consumer å®šä½æ¶ˆæ¯å­˜å‚¨ä½ç½®</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>7</strong></td>\n<td style=\"text-align:left\"><strong>Controllerï¼ˆæ§åˆ¶å™¨ï¼‰</strong></td>\n<td style=\"text-align:left\">ä¸»ä»è‡ªåŠ¨åˆ‡æ¢ä¸é«˜å¯ç”¨æ§åˆ¶</td>\n<td style=\"text-align:left\">RocketMQ 5.x å¼•å…¥ï¼ŒåŸºäº Raftï¼ˆDLedgerï¼‰åè®®å®ç° Broker è‡ªåŠ¨é€‰ä¸»å’Œå…ƒæ•°æ®ç®¡ç†</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>8</strong></td>\n<td style=\"text-align:left\"><strong>Proxyï¼ˆä»£ç†å±‚ï¼‰</strong></td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯è®¿é—®å…¥å£ä¸åè®®è½¬æ¢</td>\n<td style=\"text-align:left\">RocketMQ 5.x æ–°ç»„ä»¶ï¼Œæ— çŠ¶æ€ï¼Œå¯æ¨ªå‘æ‰©å±•ï¼›ç»Ÿä¸€æ¥å…¥å±‚ï¼Œæ”¯æŒå¤šåè®®ï¼ˆå¦‚ HTTPã€gRPCï¼‰ï¼Œéš”ç¦»å®¢æˆ·ç«¯ä¸ Broker</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p><strong>å¼•å…¥ Proxy æ¨¡å¼çš„ä¼˜åŠ¿ï¼š</strong></p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">**æ¶æ„è§£è€¦ä¸è¯­è¨€æ— å…³**ï¼šProxy ä½œä¸ºé€šç”¨ä»£ç†ï¼Œå°†å¤æ‚çš„ Broker åè®®å°è£…æˆæ›´ç®€å•çš„æ¥å£ï¼ˆå¦‚ gRPCï¼‰ï¼Œä½¿å¾—ç”¨ä¸åŒç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Go, Python, C++ ç­‰ï¼‰å¼€å‘çš„å®¢æˆ·ç«¯æ›´å®¹æ˜“æ¥å…¥ï¼Œè€Œæ— éœ€å®ç°å¤æ‚çš„åŸç”Ÿåè®®ã€‚</span><br><span class=\"line\">**ç®€åŒ–å®¢æˆ·ç«¯**ï¼šå®¢æˆ·ç«¯ä¸å†éœ€è¦æ„ŸçŸ¥ Name Server å’Œ Broker çš„åœ°å€å˜åŒ–ï¼Œåªéœ€è¿æ¥å›ºå®šçš„ Proxy åœ°å€å³å¯ï¼Œå¤§å¤§é™ä½äº†å®¢æˆ·ç«¯çš„å¤æ‚åº¦ã€‚</span><br><span class=\"line\">**å¢å¼ºå®‰å…¨æ€§**ï¼šå¯ä»¥åœ¨ Proxy å±‚ç»Ÿä¸€å®ç°å®‰å…¨è®¤è¯ã€é™æµã€å®¡è®¡ç­‰ç­–ç•¥ï¼Œä½œä¸ºBrokeré›†ç¾¤çš„å®‰å…¨å±éšœã€‚</span><br><span class=\"line\">**äº‘åŸç”Ÿå‹å¥½**ï¼šæ— çŠ¶æ€çš„ Proxy éå¸¸é€‚åˆåœ¨ Kubernetes ç­‰å®¹å™¨åŒ–ç¯å¢ƒä¸­è¿›è¡Œéƒ¨ç½²å’Œå¼¹æ€§ä¼¸ç¼©ã€‚</span><br></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"æ¶ˆæ¯ä¸­é—´ä»¶åŠŸèƒ½å¯¹æ¯”è¡¨ï¼ˆActiveMQ-vs-Kafka-vs-RabbitMQ-vs-RocketMQï¼‰\">æ¶ˆæ¯ä¸­é—´ä»¶åŠŸèƒ½å¯¹æ¯”è¡¨ï¼ˆActiveMQ vs Kafka vs RabbitMQ vs RocketMQï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://support.huaweicloud.com/intl/zh-cn/productdesc-hrm/hrm_pd_012.html\">å‚è€ƒèµ„æ–™</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">åŠŸèƒ½é¡¹</th>\n<th style=\"text-align:left\">ActiveMQ</th>\n<th style=\"text-align:left\">Kafka</th>\n<th style=\"text-align:left\">RabbitMQ</th>\n<th style=\"text-align:left\">RocketMQ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯ SDK</td>\n<td style=\"text-align:left\">Javaã€.NETã€C++ ç­‰</td>\n<td style=\"text-align:left\">Javaã€Scala ç­‰</td>\n<td style=\"text-align:left\">Javaã€.NETã€Goã€Pythonã€C ç­‰</td>\n<td style=\"text-align:left\">Javaã€C++ã€Go</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">é€šä¿¡åè®®ä¸è§„èŒƒ</td>\n<td style=\"text-align:left\">æ¨é€æ¨¡å‹ï¼ˆPushï¼‰ï¼Œæ”¯æŒ OpenWireã€STOMPã€AMQPã€MQTTã€JMS</td>\n<td style=\"text-align:left\">æ‹‰å–æ¨¡å‹ï¼ˆPullï¼‰ï¼Œæ”¯æŒ TCP</td>\n<td style=\"text-align:left\">æ¨é€æ¨¡å‹ï¼ˆPushï¼‰ï¼Œæ”¯æŒ AMQPã€MQTTã€STOMPã€HTTPã€WebSocket</td>\n<td style=\"text-align:left\">æ‹‰å–æ¨¡å‹ï¼ˆPullï¼‰ï¼Œæ”¯æŒ TCPã€JMSã€OpenMessaging</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ¶ˆæ¯æœ‰åºæ€§</td>\n<td style=\"text-align:left\">é€šè¿‡ç‹¬å æ¶ˆè´¹è€…ï¼ˆExclusive Consumerï¼‰æˆ–ç‹¬å é˜Ÿåˆ—ï¼ˆExclusive Queuesï¼‰ä¿è¯é¡ºåº</td>\n<td style=\"text-align:left\">ä¿è¯åˆ†åŒºå†…æ¶ˆæ¯é¡ºåº</td>\n<td style=\"text-align:left\">å•é˜Ÿåˆ—å†…æ¶ˆæ¯å¤©ç„¶æœ‰åº</td>\n<td style=\"text-align:left\">ä¸¥æ ¼é¡ºåºæ¶ˆæ¯ï¼Œå¯å¹³æ»‘æ‰©å±•</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">å®šæ—¶/å»¶è¿Ÿæ¶ˆæ¯</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒ</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆä½¿ç”¨å»¶è¿Ÿæ’ä»¶ï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ‰¹é‡æ¶ˆæ¯</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒ</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆå¼‚æ­¥ç”Ÿäº§è€…ï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆPublisher Confirms æ¨¡å¼ä¸‹ï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆåŒæ­¥æ¨¡å¼å¯é¿å…æ¶ˆæ¯ä¸¢å¤±ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">å¹¿æ’­æ¶ˆæ¯</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒ</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆFanout äº¤æ¢æœºï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ¶ˆæ¯è¿‡æ»¤</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆå¯ç”¨ Kafka Streams å®ç°ï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆåŸºäº Exchange çš„è·¯ç”±é”®æˆ– Headerï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆåŸºäº SQL92 å±æ€§è¿‡æ»¤ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æœåŠ¡å™¨ç«¯è§¦å‘é‡æŠ•é€’</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒ</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒ</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆNack æˆ– TTL+DLXï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ¶ˆæ¯å­˜å‚¨</td>\n<td style=\"text-align:left\">æ”¯æŒé«˜æ€§èƒ½æŒä¹…åŒ–ï¼ˆJDBC + LevelDB/KahaDBï¼‰</td>\n<td style=\"text-align:left\">é«˜æ€§èƒ½æ–‡ä»¶å­˜å‚¨</td>\n<td style=\"text-align:left\">å†…å­˜+ç£ç›˜æ··åˆå­˜å‚¨ï¼ˆMnesia/åŸºäº Erlang çš„æ—¥å¿—ï¼‰</td>\n<td style=\"text-align:left\">é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿæ–‡ä»¶å­˜å‚¨</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ¶ˆæ¯å›æº¯ï¼ˆå†å²æ¶ˆæ¯æŸ¥è¯¢ï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆé€šè¿‡ offsetï¼‰</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒï¼ˆæ¶ˆæ¯è¢«æ¶ˆè´¹åæ— æ³•å›æº¯ï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆæ—¶é—´æˆ³ä¸ offsetï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ¶ˆæ¯ä¼˜å…ˆçº§</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒ</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">é«˜å¯ç”¨ä¸æ•…éšœè½¬ç§»</td>\n<td style=\"text-align:left\">ä¾èµ–å­˜å‚¨ï¼Œå¦‚ LevelDB éœ€ ZooKeeper</td>\n<td style=\"text-align:left\">éœ€è¦ ZooKeeper</td>\n<td style=\"text-align:left\">æ”¯æŒé•œåƒé˜Ÿåˆ—ï¼ˆClassic / Quorum æ¨¡å¼ï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒä¸»ä»æ¨¡å¼ï¼ˆæ— éœ€é¢å¤–ç»„ä»¶ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ¶ˆæ¯è½¨è¿¹ï¼ˆMessage Trackï¼‰</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒ</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒ</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒï¼ˆå¯é€šè¿‡æ’ä»¶æ‰©å±•ï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">é…ç½®å¤æ‚åº¦</td>\n<td style=\"text-align:left\">é»˜è®¤é…ç½®è¾ƒä½ï¼Œéœ€æ‰‹åŠ¨ä¼˜åŒ–</td>\n<td style=\"text-align:left\">é…ç½®ä¸ºé”®å€¼å¯¹ï¼Œå¯æ–‡ä»¶æˆ–ä»£ç æä¾›</td>\n<td style=\"text-align:left\">å¼€ç®±å³ç”¨ï¼Œé…ç½®çµæ´»ä½†é€‰é¡¹è¾ƒå¤š</td>\n<td style=\"text-align:left\">å¼€ç®±å³ç”¨ï¼Œä»…éœ€å…³æ³¨å°‘é‡é…ç½®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ç®¡ç†ä¸è¿ç»´å·¥å…·</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆå‘½ä»¤è¡Œç›‘æ§ï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆWeb ç®¡ç†æ§åˆ¶å°ã€CLIï¼‰</td>\n<td style=\"text-align:left\">æ”¯æŒï¼ˆä¸°å¯Œçš„ Web ä¸å‘½ä»¤è¡Œå·¥å…·ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RocketMQ-çš„å®‰è£…\">RocketMQ çš„å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RocketMQ 5.x ä¾èµ– JDK 1.8+ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å•æœºå®‰è£…\">å•æœºå®‰è£…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/docs/quickStart/01quickstart\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹è½½RocketMQ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p /usr/local/soft/rocketmq/</span><br><span class=\"line\">wget https://dist.apache.org/repos/dist/release/rocketmq/5.3.2/rocketmq-all-5.3.2-bin-release.zip</span><br><span class=\"line\">unzip rocketmq-all-5.3.2-bin-release.zip</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s rocketmq-all-5.3.2-bin-release rocketmq5</span><br><span class=\"line\"><span class=\"built_in\">cd</span> rocketmq5</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">é»˜è®¤è„šæœ¬ä¸­ï¼ŒNameServeréœ€è¦4Gå†…å­˜ï¼ŒBroker éœ€è¦8Gå†…å­˜ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿï¼Œå¯ä»¥è¿›å…¥binç›®å½•ï¼Œå¯¹å…¶ä¸­çš„<code>runserver.sh</code>å’Œ<code>runbroker.sh</code>ä¸¤ä¸ªè„šæœ¬è¿›è¡Œä¸€ä¸‹ä¿®æ”¹</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨vi runserver.shæŒ‡ä»¤ï¼Œç¼–è¾‘è¿™ä¸ªè„šæœ¬ï¼Œæ‰¾åˆ°ä¸‹é¢çš„ä¸€è¡Œé…ç½®ï¼Œè°ƒæ•´Javaè¿›ç¨‹çš„å†…å­˜å¤§å°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># NameServer,Controller,Proxy éƒ½ä½¿ç”¨è¿™ä¸ªè„šæœ¬å¯åŠ¨</span></span><br><span class=\"line\">JAVA_OPT=<span class=\"string\">&quot;<span class=\"variable\">$&#123;JAVA_OPT&#125;</span> -server -Xms4g -Xmx4g -Xmn2G -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span></span><br><span class=\"line\">ä¿®æ”¹ä¸ºï¼š</span><br><span class=\"line\">JAVA_OPT=<span class=\"string\">&quot;<span class=\"variable\">$&#123;JAVA_OPT&#125;</span> -server -Xms1g -Xmx1g -Xmn512m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¥ä¸‹æ¥ï¼ŒåŒæ ·è°ƒæ•´runbroker.shä¸­çš„å†…å­˜å¤§å°ã€‚Broker ä½¿ç”¨è¿™ä¸ªè„šæœ¬å¯åŠ¨</span></span><br><span class=\"line\">JAVA_OPT=<span class=\"string\">&quot;<span class=\"variable\">$&#123;JAVA_OPT&#125;</span> -server -Xms8g -Xmx8g&quot;</span></span><br><span class=\"line\">ä¿®æ”¹ä¸ºï¼š</span><br><span class=\"line\">JAVA_OPT=<span class=\"string\">&quot;<span class=\"variable\">$&#123;JAVA_OPT&#125;</span> -server -Xms2g -Xmx2g&quot;</span></span><br></pre></td></tr></table></figure>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ NameServer</p>\n</li>\n</ul>\n<blockquote>\n<p>å®‰è£…å®ŒRocketMQåŒ…åï¼Œæˆ‘ä»¬å¯åŠ¨NameServer</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### å¯åŠ¨namesrv</span></span><br><span class=\"line\">$ <span class=\"built_in\">nohup</span> sh bin/mqnamesrv &amp;</span><br><span class=\"line\"><span class=\"comment\">## æŒ‡å®šé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">$ <span class=\"built_in\">nohup</span> sh bin/mqnamesrv -c namesrv.conf &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### éªŒè¯namesrvæ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class=\"line\">$ <span class=\"built_in\">tail</span> -f ~/logs/rocketmqlogs/namesrv.log</span><br><span class=\"line\"><span class=\"comment\"># æˆ‘ä»¬å¯ä»¥åœ¨namesrv.log ä¸­çœ‹åˆ° &#x27;The Name Server boot success..&#x27;ï¼Œ è¡¨ç¤ºNameServer å·²æˆåŠŸå¯åŠ¨ã€‚</span></span><br><span class=\"line\">The Name Server boot success. serializeType=JSON, address 0.0.0.0:9876</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>namesrv.conf ç¤ºä¾‹</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># The port of nameserver</span></span><br><span class=\"line\">listenPort = 9876</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ Broker+Proxy</p>\n</li>\n</ul>\n<blockquote>\n<p>NameServeræˆåŠŸå¯åŠ¨åï¼Œæˆ‘ä»¬å¯åŠ¨Brokerå’ŒProxyã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Local æ¨¡å¼éƒ¨ç½²ï¼Œå³ Broker å’Œ Proxy åŒè¿›ç¨‹éƒ¨ç½²ã€‚5.x ç‰ˆæœ¬ä¹Ÿæ”¯æŒ Broker å’Œ Proxy åˆ†ç¦»éƒ¨ç½²ä»¥å®ç°æ›´çµæ´»çš„é›†ç¾¤èƒ½åŠ›ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### å…ˆå¯åŠ¨broker</span></span><br><span class=\"line\">$ <span class=\"built_in\">nohup</span> sh bin/mqbroker -n localhost:9876 --enable-proxy &amp;</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œ é»˜è®¤å°±æ˜¯ conf/broker.conf</span></span><br><span class=\"line\">$ <span class=\"built_in\">nohup</span> sh bin/mqbroker -n localhost:9876 -c conf/broker.conf --enable-proxy &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸Šé¢çš„å¯åŠ¨æ–¹å¼ä¸ä¸‹é¢çš„å¯åŠ¨æ–¹å¼æ•ˆæœä¸€æ ·</span></span><br><span class=\"line\">$ <span class=\"built_in\">nohup</span> sh bin/mqproxy -n localhost:9876 -pc /usr/local/soft/rocketmq/rocketmq5/conf/rmq-proxy.json -bc /usr/local/soft/rocketmq/rocketmq5/conf/broker.conf -pm <span class=\"built_in\">local</span> &amp;</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># -n, --namesrvAddr NameServer çš„åœ°å€</span></span><br><span class=\"line\"><span class=\"comment\"># -pc, --proxyConfigPath Proxy é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -bc, --brokerConfigPath Broker é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -pm, --proxyMode Proxy æ¨¡å¼ï¼Œlocal or cluster</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### éªŒè¯brokeræ˜¯å¦å¯åŠ¨æˆåŠŸ, æ¯”å¦‚, brokerçš„ipæ˜¯192.168.1.2 ç„¶ååå­—æ˜¯broker-a</span></span><br><span class=\"line\">$ <span class=\"built_in\">tail</span> -f ~/logs/rocketmqlogs/proxy.log</span><br><span class=\"line\"><span class=\"comment\"># æˆ‘ä»¬å¯ä»¥åœ¨ proxy.log ä¸­çœ‹åˆ°â€œThe broker[brokerName,ip:port] boot success..â€ï¼Œè¿™è¡¨æ˜ broker å·²æˆåŠŸå¯åŠ¨ã€‚</span></span><br><span class=\"line\">The broker[broker-a, 10.250.0.175:10911] boot success. serializeType=JSON and name server is localhost:9876</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…³é—­æœåŠ¡å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…ˆåœæ­¢ Broker</span></span><br><span class=\"line\">$ sh bin/mqshutdown broker</span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢ NameServer</span></span><br><span class=\"line\">$ sh bin/mqshutdown namesrv</span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤å®‰è£…-å¤šèŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰å¤šå‰¯æœ¬æ¨¡å¼-å¼‚æ­¥å¤åˆ¶\">é›†ç¾¤å®‰è£…:å¤šèŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰å¤šå‰¯æœ¬æ¨¡å¼-å¼‚æ­¥å¤åˆ¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/docs/deploymentOperations/01deploy\">å®˜ç½‘æ–‡æ¡£</a> å¯¹é›†ç¾¤å®‰è£…çš„æ–¹å¼ä»‹ç»äº†å¤šç§ï¼Œæœ¬æ–‡ä»…å®æˆ˜ä¸€ç§ï¼š<code>å¤šèŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰å¤šå‰¯æœ¬æ¨¡å¼-å¼‚æ­¥å¤åˆ¶</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯ä¸ªMasteré…ç½®ä¸€ä¸ªSlaveï¼Œæœ‰å¤šç»„ Master-Slaveï¼ŒHAé‡‡ç”¨å¼‚æ­¥å¤åˆ¶æ–¹å¼ï¼Œä¸»å¤‡æœ‰çŸ­æš‚æ¶ˆæ¯å»¶è¿Ÿï¼ˆæ¯«ç§’çº§ï¼‰ï¼Œè¿™ç§æ¨¡å¼çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">ä¼˜ç‚¹ï¼šå³ä½¿ç£ç›˜æŸåï¼Œæ¶ˆæ¯ä¸¢å¤±çš„éå¸¸å°‘ï¼Œä¸”æ¶ˆæ¯å®æ—¶æ€§ä¸ä¼šå—å½±å“ï¼ŒåŒæ—¶Masterå®•æœºåï¼Œæ¶ˆè´¹è€…ä»ç„¶å¯ä»¥ä»Slaveæ¶ˆè´¹ï¼Œè€Œä¸”æ­¤è¿‡ç¨‹å¯¹åº”ç”¨é€æ˜ï¼Œä¸éœ€è¦äººå·¥å¹²é¢„ï¼Œæ€§èƒ½åŒå¤šMasteræ¨¡å¼å‡ ä¹ä¸€æ ·ï¼›</li>\n<li class=\"lvl-6\">ç¼ºç‚¹ï¼šMasterå®•æœºï¼Œç£ç›˜æŸåæƒ…å†µä¸‹ä¼šä¸¢å¤±å°‘é‡æ¶ˆæ¯ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>è¯¥æ¨¡å¼ä¸‹ï¼ŒMaster èŠ‚ç‚¹å’Œ Slave èŠ‚ç‚¹ä¹‹é—´æ˜¯å¼‚æ­¥å¤åˆ¶çš„ï¼ŒMaster èŠ‚ç‚¹æŒ‚æ‰åï¼ŒSlave èŠ‚ç‚¹ä¸ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸º Master èŠ‚ç‚¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é›†ç¾¤è§„åˆ’</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># NameServer 3 å°</span></span><br><span class=\"line\">NameServer1 10.250.0.175</span><br><span class=\"line\">NameServer2 10.250.0.188</span><br><span class=\"line\">NameServer3 10.250.0.31</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Broker 2 Master 2 Replicas</span></span><br><span class=\"line\">Broker1 10.250.0.188 broker-a,broker-b-s</span><br><span class=\"line\">Broker2 10.250.0.31  broker-b,broker-a-s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Proxy 3 å°</span></span><br><span class=\"line\">Proxy1 10.250.0.175</span><br><span class=\"line\">Proxy2 10.250.0.188</span><br><span class=\"line\">Proxy3 10.250.0.31</span><br></pre></td></tr></table></figure>\n<h4 id=\"éƒ¨ç½²-NameServer\">éƒ¨ç½² NameServer</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ä¸‰å°æœåŠ¡å™¨ä¸Šåˆ†åˆ«å¯åŠ¨RocketMQ NameServer</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/soft/rocketmq/rocketmq5</span><br><span class=\"line\"><span class=\"built_in\">nohup</span> sh bin/mqnamesrv &amp;</span><br></pre></td></tr></table></figure>\n<h4 id=\"éƒ¨ç½²Broker\">éƒ¨ç½²Broker</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>broker-a.properties</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brokerClusterName=DefaultCluster <span class=\"comment\"># é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´</span></span><br><span class=\"line\">brokerName=broker-a              <span class=\"comment\"># broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´</span></span><br><span class=\"line\">brokerId=0                       <span class=\"comment\"># brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” master çš„ brokerId å¿…é¡»ä¸º 0</span></span><br><span class=\"line\">deleteWhen=04                    <span class=\"comment\"># è¡¨ç¤ºå‡Œæ™¨ 4 ç‚¹æ¸…ç†</span></span><br><span class=\"line\">fileReservedTime=48              <span class=\"comment\"># è¡¨ç¤ºä¿å­˜ 48 å°æ—¶çš„æ•°æ®</span></span><br><span class=\"line\">brokerRole=ASYNC_MASTER          <span class=\"comment\"># è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\">flushDiskType=ASYNC_FLUSH        <span class=\"comment\"># è¡¨ç¤ºå¼‚æ­¥åˆ·ç›˜</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£</span></span><br><span class=\"line\"><span class=\"comment\"># å­˜å‚¨æ•°æ®è·¯å¾„ï¼Œåé¢ä¼šä»‹ç»</span></span><br><span class=\"line\">storePathRootDir=/usr/local/soft/rocketmq/data/store-a</span><br><span class=\"line\">storePathCommitLog=/usr/local/soft/rocketmq/data/store-a/commitlog</span><br><span class=\"line\">storePathConsumeQueue=/usr/local/soft/rocketmq/data/store-a/consumequeue</span><br><span class=\"line\">storePathIndex=/usr/local/soft/rocketmq/data/store-a/index</span><br><span class=\"line\">storePathConfig=/usr/local/soft/rocketmq/data/store-a/config</span><br><span class=\"line\">storeCheckpoint=/usr/local/soft/rocketmq/data/store-a/checkpoint</span><br><span class=\"line\">abortFile=/usr/local/soft/rocketmq/data/store-a/abort</span><br><span class=\"line\"><span class=\"comment\">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£</span></span><br><span class=\"line\">listenPort=10911</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>broker-a-s.properties</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brokerClusterName=DefaultCluster <span class=\"comment\"># é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´</span></span><br><span class=\"line\">brokerName=broker-a              <span class=\"comment\"># broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´</span></span><br><span class=\"line\">brokerId=1                       <span class=\"comment\"># brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” slave çš„ brokerId å¿…é¡»å¤§äº 0</span></span><br><span class=\"line\">deleteWhen=04</span><br><span class=\"line\">fileReservedTime=48</span><br><span class=\"line\">brokerRole=SLAVE                 <span class=\"comment\"># è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä»èŠ‚ç‚¹</span></span><br><span class=\"line\">flushDiskType=ASYNC_FLUSH</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£</span></span><br><span class=\"line\"><span class=\"comment\"># å­˜å‚¨æ•°æ®è·¯å¾„</span></span><br><span class=\"line\">storePathRootDir=/usr/local/soft/rocketmq/data/store-a</span><br><span class=\"line\">storePathCommitLog=/usr/local/soft/rocketmq/data/store-a/commitlog</span><br><span class=\"line\">storePathConsumeQueue=/usr/local/soft/rocketmq/data/store-a/consumequeue</span><br><span class=\"line\">storePathIndex=/usr/local/soft/rocketmq/data/store-a/index</span><br><span class=\"line\">storePathConfig=/usr/local/soft/rocketmq/data/store-a/config</span><br><span class=\"line\">storeCheckpoint=/usr/local/soft/rocketmq/data/store-a/checkpoint</span><br><span class=\"line\">abortFile=/usr/local/soft/rocketmq/data/store-a/abort</span><br><span class=\"line\"><span class=\"comment\">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£</span></span><br><span class=\"line\">listenPort=11011</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>broker-b.properties</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brokerClusterName=DefaultCluster <span class=\"comment\"># é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´</span></span><br><span class=\"line\">brokerName=broker-b              <span class=\"comment\"># broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´</span></span><br><span class=\"line\">brokerId=0                       <span class=\"comment\"># brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” master çš„ brokerId å¿…é¡»ä¸º 0</span></span><br><span class=\"line\">deleteWhen=04                    <span class=\"comment\"># è¡¨ç¤ºå‡Œæ™¨ 4 ç‚¹æ¸…ç†</span></span><br><span class=\"line\">fileReservedTime=48              <span class=\"comment\"># è¡¨ç¤ºä¿å­˜ 48 å°æ—¶çš„æ•°æ®</span></span><br><span class=\"line\">brokerRole=ASYNC_MASTER          <span class=\"comment\"># è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\">flushDiskType=ASYNC_FLUSH        <span class=\"comment\"># è¡¨ç¤ºå¼‚æ­¥åˆ·ç›˜</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£</span></span><br><span class=\"line\"><span class=\"comment\"># å­˜å‚¨æ•°æ®è·¯å¾„</span></span><br><span class=\"line\">storePathRootDir=/usr/local/soft/rocketmq/data/store-b</span><br><span class=\"line\">storePathCommitLog=/usr/local/soft/rocketmq/data/store-b/commitlog</span><br><span class=\"line\">storePathConsumeQueue=/usr/local/soft/rocketmq/data/store-b/consumequeue</span><br><span class=\"line\">storePathIndex=/usr/local/soft/rocketmq/data/store-b/index</span><br><span class=\"line\">storePathConfig=/usr/local/soft/rocketmq/data/store-b/config</span><br><span class=\"line\">storeCheckpoint=/usr/local/soft/rocketmq/data/store-b/checkpoint</span><br><span class=\"line\">abortFile=/usr/local/soft/rocketmq/data/store-b/abort</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£</span></span><br><span class=\"line\">listenPort=10911</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>broker-b-s.properties</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brokerClusterName=DefaultCluster <span class=\"comment\"># é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´</span></span><br><span class=\"line\">brokerName=broker-b              <span class=\"comment\"># broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´</span></span><br><span class=\"line\">brokerId=1                       <span class=\"comment\"># brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” slave çš„ brokerId å¿…é¡»å¤§äº 0</span></span><br><span class=\"line\">deleteWhen=04</span><br><span class=\"line\">fileReservedTime=48</span><br><span class=\"line\">brokerRole=SLAVE                 <span class=\"comment\"># è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä»èŠ‚ç‚¹</span></span><br><span class=\"line\">flushDiskType=ASYNC_FLUSH</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£</span></span><br><span class=\"line\"><span class=\"comment\"># å­˜å‚¨æ•°æ®è·¯å¾„</span></span><br><span class=\"line\">storePathRootDir=/usr/local/soft/rocketmq/data/store-b</span><br><span class=\"line\">storePathCommitLog=/usr/local/soft/rocketmq/data/store-b/commitlog</span><br><span class=\"line\">storePathConsumeQueue=/usr/local/soft/rocketmq/data/store-b/consumequeue</span><br><span class=\"line\">storePathIndex=/usr/local/soft/rocketmq/data/store-b/index</span><br><span class=\"line\">storePathConfig=/usr/local/soft/rocketmq/data/store-b/config</span><br><span class=\"line\">storeCheckpoint=/usr/local/soft/rocketmq/data/store-b/checkpoint</span><br><span class=\"line\">abortFile=/usr/local/soft/rocketmq/data/store-b/abort</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£</span></span><br><span class=\"line\">listenPort=11011</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Broker1 10.250.0.188 ä¸Šå¯åŠ¨ broker-a å’Œ broker-b-s</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ broker-a</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> sh bin/mqbroker -n <span class=\"string\">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -c conf/2m-2s-async/broker-a.properties &amp;</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ broker-b-s</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> sh bin/mqbroker -n <span class=\"string\">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -c conf/2m-2s-async/broker-b-s.properties &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## nohup.out ä¸­çš„è¾“å‡ºç±»ä¼¼ä¸ä¸‹é¢è¿™ç§å°±è¡¨ç¤ºå¯åŠ¨æˆåŠŸ</span></span><br><span class=\"line\">The broker[broker-a, 10.250.0.31:11011] boot success. serializeType=JSON and name server is 10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Broker2 10.250.0.31 ä¸Šå¯åŠ¨ broker-b å’Œ broker-a-s</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ broker-b</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> sh bin/mqbroker -n <span class=\"string\">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -c conf/2m-2s-async/broker-b.properties &amp;</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ broker-a-s</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> sh bin/mqbroker -n <span class=\"string\">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -c conf/2m-2s-async/broker-a-s.properties &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ£€æŸ¥æœºå™¨çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¡®è®¤ Broker æ˜¯å¦å·²ç»æˆåŠŸæ³¨å†Œåˆ° Nameserverï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆåœ¨ä»»æ„ä¸€å°æœºå™¨ä¸Šï¼‰</span></span><br><span class=\"line\">sh bin/mqadmin clusterList -n 10.250.0.175:9876</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç±»ä¼¼å¦‚ä¸‹</span></span><br><span class=\"line\"><span class=\"comment\">#Cluster Name           #Broker Name            #BID  #Addr                  #Version              #InTPS(LOAD)                   #OutTPS(LOAD)  #Timer(Progress)        #PCWait(ms)  #Hour         #SPACE    #ACTIVATED</span></span><br><span class=\"line\">DefaultCluster          broker-a                0     10.250.0.188:10911     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489250.72     0.2900          <span class=\"literal\">true</span></span><br><span class=\"line\">DefaultCluster          broker-a                1     10.250.0.31:11011      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  3-0(0.0w, 0.0, 0.0)               0  489250.72     0.2600         <span class=\"literal\">false</span></span><br><span class=\"line\">DefaultCluster          broker-b                0     10.250.0.31:10911      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489250.72     0.2600          <span class=\"literal\">true</span></span><br><span class=\"line\">DefaultCluster          broker-b                1     10.250.0.188:11011     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  3-0(0.0w, 0.0, 0.0)               0  489250.72     0.2900         <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"é…ç½®-Proxy\">é…ç½® Proxy</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ä¸‰å°æœåŠ¡å™¨ä¸Šåˆ†åˆ«å¯åŠ¨RocketMQ NameServer</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">nohup</span> sh bin/mqproxy -n <span class=\"string\">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œé›†ç¾¤çš„åç§°è¦ä¸ conf/rmq-proxy.json ä¸­é…ç½®çš„é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´ï¼Œé»˜è®¤æ˜¯ DefaultCluster</span></span><br><span class=\"line\"><span class=\"comment\">## é»˜è®¤çš„é…ç½®æ–‡ä»¶å°±æ˜¯ conf/rmq-proxy.jsonï¼Œä½†å¦‚æœé€šè¿‡ -pc æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> sh bin/mqproxy -n <span class=\"string\">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -pc /usr/local/soft/rocketmq/rocketmq5/conf/rmq-proxy.json &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## æŸ¥çœ‹æ—¥å¿—ï¼Œè¾“å‡ºå¦‚ä¸‹å†…å®¹å°±è¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼Œtail -f nohup.out</span></span><br><span class=\"line\">rocketmq-proxy startup successfully</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>rmq-proxy.json ç¤ºä¾‹</p>\n</blockquote>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;rocketMQClusterName&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;DefaultCluster&quot;</span><span class=\"punctuation\">,</span> # é›†ç¾¤åç§°</span><br><span class=\"line\">  <span class=\"attr\">&quot;remotingListenPort&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">8080</span><span class=\"punctuation\">,</span>              # ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ <span class=\"number\">8080</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;grpcServerPort&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">8081</span>                   # grpc ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ <span class=\"number\">8081</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœæ­¢Proxy</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœæ­¢ Proxy</span></span><br><span class=\"line\">sh bin/mqshutdown proxy</span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤å®‰è£…-ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼éƒ¨ç½²\">é›†ç¾¤å®‰è£…:ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼éƒ¨ç½²</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RocketMQ 5.x æä¾›äº†ä¸€ç§æ–°çš„éƒ¨ç½²æ–¹å¼ <code>Controller</code>ï¼Œå¯ä»¥åœ¨ä¸»ä»æ¨¡å¼ä¸‹å®ç°ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä»èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://rocketmq.apache.org/zh/docs/deploymentOperations/03autofailover\">å®˜æ–¹æ–‡æ¡£:ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼éƒ¨ç½²</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Controller ç»„ä»¶æä¾›é€‰ä¸»èƒ½åŠ›ï¼Œè‹¥éœ€è¦ä¿è¯ Controller å…·å¤‡å®¹é”™èƒ½åŠ›ï¼ŒController éƒ¨ç½²éœ€è¦ä¸‰å‰¯æœ¬åŠä»¥ä¸Šï¼ˆéµå¾ª Raft çš„å¤šæ•°æ´¾åè®®ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åœ¨ä¸Šæ–‡â€œé›†ç¾¤å®‰è£…:å¤šèŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰å¤šå‰¯æœ¬æ¨¡å¼-å¼‚æ­¥å¤åˆ¶â€çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹</p>\n</li>\n<li class=\"lvl-2\">\n<p>Controller éƒ¨ç½²æœ‰ä¸¤ç§æ–¹å¼ã€‚ä¸€ç§æ˜¯åµŒå…¥äº NameServer è¿›è¡Œéƒ¨ç½²ï¼Œå¦ä¸€ç§æ˜¯ç‹¬ç«‹éƒ¨ç½²ï¼Œæœ¬æ–‡é‡‡ç”¨ç‹¬ç«‹éƒ¨ç½² Controller ç»„ä»¶çš„æ–¹å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é›†ç¾¤è§„åˆ’</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Controller 3 å°</span></span><br><span class=\"line\">Controller1 10.250.0.175</span><br><span class=\"line\">Controller2 10.250.0.188</span><br><span class=\"line\">Controller3 10.250.0.31</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«åœ¨æ¯å°æœºå™¨ä¸Šåˆ›å»º<code>controller.conf</code>é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹(æ³¨æ„ä¿®æ”¹èŠ‚ç‚¹Id)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># controller.conf</span></span><br><span class=\"line\"><span class=\"comment\"># ---------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"># DLedger Raft Group çš„åå­—ï¼ŒåŒä¸€é›†ç¾¤ä¿æŒä¸€è‡´</span></span><br><span class=\"line\">controllerDLegerGroup = group1</span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤ä¸­ä¸‰ä¸ªèŠ‚ç‚¹çš„æˆå‘˜å®šä¹‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»ä¸€è‡´</span></span><br><span class=\"line\">controllerDLegerPeers = n0-10.250.0.175:9877;n1-10.250.0.188:9877;n2-10.250.0.31:9877</span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹ idï¼Œå¿…é¡»å±äº controllerDLegerPeers ä¸­çš„ä¸€ä¸ªï¼›åŒ Group å†…å„ä¸ªèŠ‚ç‚¹è¦å”¯ä¸€</span></span><br><span class=\"line\">controllerDLegerSelfId = n0</span><br><span class=\"line\"><span class=\"comment\"># Controller æ•°æ®å­˜å‚¨è·¯å¾„ï¼ˆéå¸¸å…³é”®ï¼ä¸è¦åˆ é™¤ï¼‰</span></span><br><span class=\"line\">controllerStorePath = /usr/local/soft/rocketmq/data/DledgerController</span><br><span class=\"line\"><span class=\"comment\"># æ˜¯å¦å…è®¸ä» SyncStateSet å¤–é€‰ä¸¾ Master</span></span><br><span class=\"line\"><span class=\"comment\"># true ä¼šåŠ å¿«é€‰ä¸¾ä½†å¯èƒ½ä¸¢æ¶ˆæ¯ï¼Œå»ºè®®ç”Ÿäº§ä¿æŒ false</span></span><br><span class=\"line\">enableElectUncleanMaster = <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># å½“ Broker å‰¯æœ¬è§’è‰²å˜åŒ–æ—¶æ˜¯å¦ä¸»åŠ¨é€šçŸ¥ï¼ˆå»ºè®®å¼€å¯ï¼‰</span></span><br><span class=\"line\">notifyBrokerRoleChanged = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ç«¯å£ï¼Œç«¯å£ä¸èƒ½ä¸ NameServerã€Brokerã€Proxy ç«¯å£å†²çª</span></span><br><span class=\"line\">listenPort = 9877</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«å¯åŠ¨æ¯å°æœºå™¨ä¸Šçš„ Controller</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">nohup</span> sh bin/mqcontroller -n <span class=\"string\">&quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot;</span> -c conf/controller.conf &amp;</span><br><span class=\"line\"><span class=\"comment\">## å¯åŠ¨æˆåŠŸåï¼ŒæŸ¥çœ‹ nohup.out æ–‡ä»¶ï¼Œè¾“å‡ºå¦‚ä¸‹å†…å®¹å°±è¡¨ç¤ºå¯åŠ¨æˆåŠŸ</span></span><br><span class=\"line\">load config properties file OK, conf/controller.conf</span><br><span class=\"line\">The Controller Server boot success. serializeType=JSON</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹ broker é…ç½®æ–‡ä»¶ï¼Œä»¥ <code>broker-a.properties</code> ä¸ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å»æ‰å¦‚ä¸‹é…ç½®ï¼ŒController æ¨¡å¼ä¸‹ ä¼šè‡ªåŠ¨åˆ†é…</span></span><br><span class=\"line\"><span class=\"comment\"># brokerId=1                       # brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” slave çš„ brokerId å¿…é¡»å¤§äº 0</span></span><br><span class=\"line\"><span class=\"comment\"># brokerRole=ASYNC_MASTER          # è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä¸»èŠ‚ç‚¹</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ å¦‚ä¸‹é…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ç”¨ Controller æ¨¡å¼ï¼ˆè‡ªåŠ¨ä¸»ä»åˆ‡æ¢æ¨¡å¼çš„æ€»å¼€å…³ï¼‰</span></span><br><span class=\"line\">enableControllerMode = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># Controller é›†ç¾¤åœ°å€åˆ—è¡¨ï¼ˆå»ºè®®ä¸ Controller é›†ç¾¤ä¿æŒä¸€è‡´ï¼‰</span></span><br><span class=\"line\">controllerAddr = 10.250.0.175:9877;10.250.0.188:9877;10.250.0.31:9877</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>RocketMQ 5 Broker Controller æ¨¡å¼é…ç½®å‚æ•°è¡¨</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å‚æ•°å</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n<th style=\"text-align:center\">é»˜è®¤å€¼</th>\n<th style=\"text-align:left\">å¤‡æ³¨ / å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>enableControllerMode</strong></td>\n<td style=\"text-align:left\">æ˜¯å¦å¯ç”¨ Controller æ¨¡å¼ï¼ˆè‡ªåŠ¨ä¸»ä»åˆ‡æ¢æ€»å¼€å…³ï¼‰</td>\n<td style=\"text-align:center\"><code>false</code></td>\n<td style=\"text-align:left\">å¿…é¡»è®¾ä¸º <code>true</code> æ‰èƒ½å¯ç”¨è‡ªåŠ¨ä¸»ä»åˆ‡æ¢</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>controllerAddr</strong></td>\n<td style=\"text-align:left\">Controller é›†ç¾¤åœ°å€åˆ—è¡¨ï¼ˆä»¥åˆ†å·åˆ†éš”ï¼‰</td>\n<td style=\"text-align:center\">æ— </td>\n<td style=\"text-align:left\">æ‰€æœ‰ Broker é…ç½®åº”ä¸€è‡´ï¼Œä¾‹å¦‚ <code>10.250.0.175:9877;10.250.0.188:9877;10.250.0.31:9877</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>syncBrokerMetadataPeriod</strong></td>\n<td style=\"text-align:left\">å‘ Controller åŒæ­¥ Broker å‰¯æœ¬ä¿¡æ¯çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰</td>\n<td style=\"text-align:center\"><code>5000</code> (5s)</td>\n<td style=\"text-align:left\">ä¿æŒé»˜è®¤å³å¯ï¼›ç”¨äºä¸ŠæŠ¥å¿ƒè·³ä¸å…ƒæ•°æ®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>checkSyncStateSetPeriod</strong></td>\n<td style=\"text-align:left\">æ£€æŸ¥åŒæ­¥çŠ¶æ€é›†ï¼ˆSyncStateSetï¼‰çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰</td>\n<td style=\"text-align:center\"><code>5000</code> (5s)</td>\n<td style=\"text-align:left\">Controller ä¼šå®šæœŸå‰”é™¤è½åå‰¯æœ¬</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>syncControllerMetadataPeriod</strong></td>\n<td style=\"text-align:left\">åŒæ­¥ Controller å…ƒæ•°æ®çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰</td>\n<td style=\"text-align:center\"><code>10000</code> (10s)</td>\n<td style=\"text-align:left\">Broker å®šæœŸä»é›†ç¾¤è·å–å½“å‰æ´»è·ƒ Controller åœ°å€</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>haMaxTimeSlaveNotCatchup</strong></td>\n<td style=\"text-align:left\">Slave æœªè·Ÿä¸Š Master çš„æœ€å¤§æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰</td>\n<td style=\"text-align:center\"><code>15000</code> (15s)</td>\n<td style=\"text-align:left\">è¶…è¿‡è¯¥æ—¶é—´å°† Slave ç§»å‡º SyncStateSet</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>storePathEpochFile</strong></td>\n<td style=\"text-align:left\">Epoch æ–‡ä»¶å­˜å‚¨è·¯å¾„</td>\n<td style=\"text-align:center\"><code>store/epochFile</code></td>\n<td style=\"text-align:left\">éå¸¸é‡è¦ï¼ä¸è¦åˆ é™¤ï¼›å­˜å‚¨ä¸»ä»ä»»æœŸã€epoch ç­‰å…ƒä¿¡æ¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>allAckInSyncStateSet</strong></td>\n<td style=\"text-align:left\">æ˜¯å¦è¦æ±‚æ‰€æœ‰åŒæ­¥å‰¯æœ¬éƒ½ ACK åæ‰è¿”å›æˆåŠŸ</td>\n<td style=\"text-align:center\"><code>false</code></td>\n<td style=\"text-align:left\"><code>true</code> å¯ä¿è¯å¼ºä¸€è‡´ä½†æ€§èƒ½ä¸‹é™ï¼›å»ºè®®ä¿æŒé»˜è®¤</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>syncFromLastFile</strong></td>\n<td style=\"text-align:left\">Slave æ˜¯å¦ä»æœ€åä¸€ä¸ªæ–‡ä»¶å¼€å§‹å¤åˆ¶ï¼ˆç©ºç›˜å¯åŠ¨æ—¶ï¼‰</td>\n<td style=\"text-align:center\"><code>false</code></td>\n<td style=\"text-align:left\">è‹¥å†å²æ—¥å¿—å¾ˆå¤§ä¸” Slave æ–°å»ºï¼Œå¯è®¾ä¸º <code>true</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>asyncLearner</strong></td>\n<td style=\"text-align:left\">æ˜¯å¦ä¸ºå¼‚æ­¥ learner å‰¯æœ¬ï¼ˆä¸å‚ä¸é€‰ä¸»ï¼‰</td>\n<td style=\"text-align:center\"><code>false</code></td>\n<td style=\"text-align:left\">ç”¨äºè¿œç¨‹ç¾å¤‡å‰¯æœ¬ï¼Œä¸ä¼šè¢«é€‰ä¸¾ä¸º Master</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>inSyncReplicas</strong></td>\n<td style=\"text-align:left\">éœ€ä¿æŒåŒæ­¥çš„å‰¯æœ¬ç»„æ•°é‡</td>\n<td style=\"text-align:center\"><code>1</code></td>\n<td style=\"text-align:left\">è‹¥ <code>allAckInSyncStateSet=true</code>ï¼Œè¯¥å‚æ•°æ— æ•ˆ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>minInSyncReplicas</strong></td>\n<td style=\"text-align:left\">æœ€å°åŒæ­¥å‰¯æœ¬æ•°é‡ï¼Œä½äºè¯¥å€¼åˆ™æ‹’ç»å†™å…¥</td>\n<td style=\"text-align:center\"><code>1</code></td>\n<td style=\"text-align:left\">é˜²æ­¢å†™å…¥è¿‡å¤šæœªåŒæ­¥å‰¯æœ¬å¯¼è‡´æ•°æ®ä¸¢å¤±é£é™©</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡æ–°å¯åŠ¨ Brokerï¼Œä¸ºä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§åœ¨é‡å¯æ—¶ä¸è¢«ç ´åï¼Œå¯åŠ¨é¡ºåºåº”ä¸ºå…ˆé‡æ–°åŸMasterï¼Œå†é‡å¯åŸSlave</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ£€æŸ¥æœºå™¨çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°é›†ç¾¤å†…éƒ¨è‡ªåŠ¨åˆ†é…äº†ä¸»ä»</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¡®è®¤ Broker æ˜¯å¦å·²ç»æˆåŠŸæ³¨å†Œåˆ° Nameserverï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆåœ¨ä»»æ„ä¸€å°æœºå™¨ä¸Šï¼‰</span></span><br><span class=\"line\">sh bin/mqadmin clusterList -n 10.250.0.175:9876</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç±»ä¼¼å¦‚ä¸‹</span></span><br><span class=\"line\"><span class=\"comment\">#Cluster Name           #Broker Name            #BID  #Addr                  #Version              #InTPS(LOAD)                   #OutTPS(LOAD)  #Timer(Progress)        #PCWait(ms)  #Hour         #SPACE    #ACTIVATED</span></span><br><span class=\"line\">DefaultCluster          broker-a                0     10.250.0.188:10911     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489268.48     0.2900          <span class=\"literal\">true</span></span><br><span class=\"line\">DefaultCluster          broker-a                2     10.250.0.31:11011      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  2-0(0.0w, 0.0, 0.0)               0  489268.48     0.2700         <span class=\"literal\">false</span></span><br><span class=\"line\">DefaultCluster          broker-b                0     10.250.0.31:10911      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489268.48     0.2700          <span class=\"literal\">true</span></span><br><span class=\"line\">DefaultCluster          broker-b                2     10.250.0.188:11011     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  3-0(0.0w, 0.0, 0.0)               0  489268.48     0.2900         <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éªŒè¯ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢ï¼Œæ­¤æ—¶å…³é—­ <code>broker-b</code> çš„ Masterï¼Œå¹¶æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/mqadmin clusterList -n 10.250.0.175:9876</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç±»ä¼¼å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°`broker-b`åŸæ¥çš„ Slave è¢«åˆ‡æ¢ä¸º Master</span></span><br><span class=\"line\"><span class=\"comment\">#Cluster Name           #Broker Name            #BID  #Addr                  #Version              #InTPS(LOAD)                   #OutTPS(LOAD)  #Timer(Progress)        #PCWait(ms)  #Hour         #SPACE    #ACTIVATED</span></span><br><span class=\"line\">DefaultCluster          broker-a                0     10.250.0.188:10911     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489268.58     0.2900          <span class=\"literal\">true</span></span><br><span class=\"line\">DefaultCluster          broker-a                2     10.250.0.31:11011      V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  1-0(0.0w, 0.0, 0.0)               0  489268.58     0.2700         <span class=\"literal\">false</span></span><br><span class=\"line\">DefaultCluster          broker-b                0     10.250.0.188:11011     V5_3_2                 0.00(0,0ms)               0.00(0,0ms|0,0ms)  0-0(0.0w, 0.0, 0.0)               0  489268.58     0.2900          <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡æ–°å¯åŠ¨åˆšæ‰å…³é—­çš„ <code>broker-b</code> ï¼ŒèŠ‚ç‚¹ä¼šè‡ªåŠ¨åŠ å…¥é›†ç¾¤ï¼Œè§’è‰²ä¸º Slave</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœæ­¢ Controller</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœæ­¢ PrControlleroxy</span></span><br><span class=\"line\">sh bin/mqshutdown controller</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç«¯å£è¯´æ˜\">ç«¯å£è¯´æ˜</h2>\n<table>\n<thead>\n<tr>\n<th>ç«¯å£å·</th>\n<th>åè®®</th>\n<th>ç»„ä»¶/æœåŠ¡</th>\n<th>ä½œç”¨è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>9876</strong></td>\n<td>TCP</td>\n<td><strong>NameServer</strong></td>\n<td>RocketMQ é›†ç¾¤çš„ <strong>NameServer</strong> æœåŠ¡ç«¯å£ã€‚<br>ç”¨äº Broker æ³¨å†Œã€å®¢æˆ·ç«¯è·¯ç”±å‘ç°ã€‚<br>Producer/Consumer è¿æ¥æ­¤ç«¯å£ä»¥è·å– Broker åœ°å€ã€‚</td>\n</tr>\n<tr>\n<td><strong>8080</strong></td>\n<td>TCP</td>\n<td><strong>Proxy (gRPC / HTTP)</strong></td>\n<td>RocketMQ 5 å¼•å…¥çš„ <strong>Proxy æœåŠ¡</strong> é»˜è®¤ç«¯å£ä¹‹ä¸€ã€‚<br>ç”¨äº <strong>HTTP/gRPC å®¢æˆ·ç«¯æ¥å…¥</strong>ï¼Œä¾‹å¦‚ RocketMQ Proxy REST APIã€å¼‚æ­¥æ¶ˆæ¯æ¥å£ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>8081</strong></td>\n<td>TCP</td>\n<td><strong>Proxy Admin / Dashboard / gRPC Alt</strong></td>\n<td>é€šå¸¸æ˜¯ Proxy çš„ <strong>ç®¡ç†æ¥å£</strong> æˆ– <strong>gRPC è¾…åŠ©ç«¯å£</strong>ï¼ˆä¾é…ç½®è€Œå®šï¼‰ã€‚<br>ä¹Ÿå¯èƒ½æ˜¯æ§åˆ¶é¢æ¥å£ï¼Œç”¨äºä¸ Console æˆ–æ§åˆ¶å·¥å…·é€šä¿¡ã€‚</td>\n</tr>\n<tr>\n<td><strong>10909</strong></td>\n<td>TCP</td>\n<td><strong>Broker HA (High Availability)</strong></td>\n<td>Broker <strong>ä¸»ä»åŒæ­¥ç«¯å£</strong>ï¼ˆMaster â†” Slave ä¹‹é—´çš„æ•°æ®å¤åˆ¶ï¼‰ã€‚<br>ç”¨äºæ¶ˆæ¯æ•°æ®ä¸å…ƒæ•°æ®çš„åŒæ­¥ã€‚</td>\n</tr>\n<tr>\n<td><strong>10911</strong></td>\n<td>TCP</td>\n<td><strong>Broker æœåŠ¡ç«¯å£</strong></td>\n<td>Broker çš„ <strong>ä¸»é€šä¿¡ç«¯å£</strong>ï¼Œå®¢æˆ·ç«¯è¿æ¥å‘é€æ¶ˆæ¯ã€æ¶ˆè´¹æ¶ˆæ¯ã€å¿ƒè·³ç­‰ã€‚<br>Producer å’Œ Consumer é€šè¿‡ NameServer è·å–è¯¥ç«¯å£åœ°å€åè¿›è¡Œé€šä¿¡ã€‚</td>\n</tr>\n<tr>\n<td><strong>10912</strong></td>\n<td>TCP</td>\n<td><strong>Broker HA å®¢æˆ·ç«¯ç«¯å£</strong></td>\n<td>Broker <strong>ä¸»ä»å¤åˆ¶ä¸­çš„ Slave è¿æ¥ Master</strong> æ—¶ä½¿ç”¨çš„ <strong>å®¢æˆ·ç«¯ç›‘å¬ç«¯å£</strong>ã€‚<br>é€šå¸¸ä¸ 10909 é…åˆä½¿ç”¨ï¼Œä¸€ä¸»å¤šä»æ¨¡å¼ä¸­ Slave ä¸»åŠ¨è¿æ¥ Masterã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"æ—¥å¿—åŠæ•°æ®å­˜å‚¨è·¯å¾„\">æ—¥å¿—åŠæ•°æ®å­˜å‚¨è·¯å¾„</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RocketMQ 5 ä¸»è¦æœ‰ä¸‰ç±»æœåŠ¡ç»„ä»¶éœ€è¦å…³æ³¨å®ƒä»¬çš„å­˜å‚¨ç›®å½•</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">ç»„ä»¶</th>\n<th style=\"text-align:left\">åŠŸèƒ½</th>\n<th style=\"text-align:left\">é»˜è®¤å­˜å‚¨å†…å®¹</th>\n<th style=\"text-align:left\">é»˜è®¤è·¯å¾„ï¼ˆLinux ç¯å¢ƒï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>NameServer</strong></td>\n<td style=\"text-align:left\">è·¯ç”±æœåŠ¡ï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰</td>\n<td style=\"text-align:left\">å„ä¸ªç»„ä»¶çš„çš„æ³¨å†Œ</td>\n<td style=\"text-align:left\">æ—¥å¿—æ–‡ä»¶ï¼š<code>~/logs/rocketmqlogs/namesrv.log</code><br>æ—¥å¿—é…ç½®ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/rmq.namesrv.logback.xml</code> <br> é…ç½®æ–‡ä»¶ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/namesrv.conf</code>ï¼ˆå¯é€‰ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Broker</strong></td>\n<td style=\"text-align:left\">æ ¸å¿ƒæ¶ˆæ¯å­˜å‚¨ä¸è½¬å‘æœåŠ¡</td>\n<td style=\"text-align:left\">æ¶ˆæ¯æ•°æ®ï¼ˆCommitLogã€ConsumeQueueã€Indexã€Configï¼‰<br><strong>ç›®å½•ç»“æ„ï¼š</strong><br>â”œâ”€â”€ <code>commitlog/</code> â†’ æ¶ˆæ¯ç‰©ç†æ–‡ä»¶<br>â”œâ”€â”€ <code>consumequeue/</code> â†’ æ¶ˆè´¹é˜Ÿåˆ—ç´¢å¼•<br>â”œâ”€â”€ <code>index/</code> â†’ æ¶ˆæ¯ç´¢å¼•<br>â”œâ”€â”€ <code>config/</code> â†’ topicã€offsetã€subscription ä¿¡æ¯<br>â”œâ”€â”€ <code>checkpoint</code> â†’ å­˜å‚¨æ ¡éªŒç‚¹<br>â”œâ”€â”€ <code>abort</code> â†’ å¼‚å¸¸é€€å‡ºæ ‡å¿—</td>\n<td style=\"text-align:left\"><strong>æ•°æ®ç›®å½•</strong>ï¼š<code>~/store</code><br>æ—¥å¿—æ–‡ä»¶ï¼š<code>~/logs/rocketmqlogs/broker.log</code><br>æ—¥å¿—é…ç½®ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/rmq.broker.logback.xml</code><br>é…ç½®æ–‡ä»¶ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/broker.conf</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Proxy</strong></td>\n<td style=\"text-align:left\">å®¢æˆ·ç«¯è®¿é—®å…¥å£å±‚ï¼ˆæ— çŠ¶æ€ä»£ç†ï¼‰<br>ï¼ˆ5.x æ–°å¼•å…¥ç»„ä»¶ï¼‰</td>\n<td style=\"text-align:left\">è½¬å‘æ—¥å¿—ã€è®¿é—®æ—¥å¿—</td>\n<td style=\"text-align:left\">æ—¥å¿—é…ç½®ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/rmq.proxy.logback.xml</code><br>æ—¥å¿—æ–‡ä»¶ï¼š<code>~/logs/rocketmqlogs/proxy.log</code><br>é…ç½®æ–‡ä»¶ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/rmq-proxy.json</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>Controller</strong></td>\n<td style=\"text-align:left\"><strong>Broker ä¸»ä»åè°ƒä¸é«˜å¯ç”¨ç®¡ç†</strong><br>ï¼ˆ5.x æ–°å¼•å…¥ç»„ä»¶ï¼‰</td>\n<td style=\"text-align:left\">- é›†ç¾¤ä¸»ä»å…ƒæ•°æ®ï¼ˆä¸»ä»å…³ç³»ã€brokeræ³¨å†Œä¿¡æ¯ï¼‰<br>- Controller è‡ªèº«è¿è¡ŒçŠ¶æ€ä¸é€‰ä¸¾å…ƒæ•°æ®</td>\n<td style=\"text-align:left\"><strong>æ•°æ®ç›®å½•</strong>ï¼š<code>~/store/controller</code><br>æ—¥å¿—æ–‡ä»¶ï¼š<code>~/logs/rocketmqlogs/controller.log</code><br>æ—¥å¿—é…ç½®ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/rmq.controller.logback.xml</code><br>é…ç½®æ–‡ä»¶ï¼š<code>$&#123;ROCKETMQ_HOME&#125;/conf/controller.conf</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>NameServer å’Œ Proxy éƒ½æ˜¯æ— çŠ¶æ€ï¼ˆstatelessï¼‰ç»„ä»¶ï¼Œä¸ä¼šæŒä¹…åŒ–ä¸šåŠ¡æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Broker æ•°æ®è·¯å¾„è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">é…ç½®é¡¹</th>\n<th style=\"text-align:left\">é»˜è®¤è·¯å¾„</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n<th style=\"text-align:left\">ä¸»è¦ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>storePathRootDir</strong></td>\n<td style=\"text-align:left\"><code>/home/rocketmq/store</code><br>ï¼ˆé»˜è®¤ï¼‰</td>\n<td style=\"text-align:left\">æ¶ˆæ¯å­˜å‚¨çš„æ ¹ç›®å½•</td>\n<td style=\"text-align:left\">ä½œä¸ºæ‰€æœ‰å­˜å‚¨æ–‡ä»¶çš„çˆ¶çº§ç›®å½•ï¼Œå…¶ä»–è·¯å¾„è‹¥æœªå•ç‹¬é…ç½®ï¼Œåˆ™åœ¨æ­¤ç›®å½•ä¸‹åˆ›å»º</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>storePathCommitLog</strong></td>\n<td style=\"text-align:left\"><code>$&#123;storePathRootDir&#125;/commitlog</code></td>\n<td style=\"text-align:left\">CommitLog æ–‡ä»¶å­˜æ”¾è·¯å¾„</td>\n<td style=\"text-align:left\">å­˜å‚¨æ¶ˆæ¯ä¸»ä½“å†…å®¹ï¼Œæ˜¯æœ€æ ¸å¿ƒçš„æ•°æ®æ–‡ä»¶ï¼ˆé¡ºåºå†™å…¥ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>storePathConsumeQueue</strong></td>\n<td style=\"text-align:left\"><code>$&#123;storePathRootDir&#125;/consumequeue</code></td>\n<td style=\"text-align:left\">æ¶ˆè´¹é˜Ÿåˆ—æ–‡ä»¶å­˜æ”¾è·¯å¾„</td>\n<td style=\"text-align:left\">å­˜å‚¨æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­çš„ç´¢å¼•ï¼ˆé€»è¾‘é˜Ÿåˆ—ï¼‰ï¼ŒæŒ‡å‘ CommitLog çš„ç‰©ç†ä½ç½®</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>storePathIndex</strong></td>\n<td style=\"text-align:left\"><code>$&#123;storePathRootDir&#125;/index</code></td>\n<td style=\"text-align:left\">ç´¢å¼•æ–‡ä»¶å­˜æ”¾è·¯å¾„</td>\n<td style=\"text-align:left\">æä¾›æŒ‰ Key æŸ¥è¯¢æ¶ˆæ¯çš„ç´¢å¼•ç»“æ„ï¼Œä¾¿äºé€šè¿‡ Message Key å¿«é€Ÿæ£€ç´¢æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>storePathConfig</strong></td>\n<td style=\"text-align:left\"><code>$&#123;storePathRootDir&#125;/config</code></td>\n<td style=\"text-align:left\">Broker è¿è¡Œæ—¶é…ç½®å­˜å‚¨è·¯å¾„</td>\n<td style=\"text-align:left\">å­˜å‚¨è¿è¡Œæ—¶ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ topicã€consumerOffsetã€subscriptionGroup ç­‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>storeCheckpoint</strong></td>\n<td style=\"text-align:left\"><code>$&#123;storePathRootDir&#125;/checkpoint</code></td>\n<td style=\"text-align:left\">Checkpoint æ–‡ä»¶è·¯å¾„</td>\n<td style=\"text-align:left\">è®°å½• CommitLogã€ConsumeQueueã€Index ä¸‰è€…çš„åˆ·ç›˜è¿›åº¦ï¼Œç”¨äºå´©æºƒæ¢å¤</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>abortFile</strong></td>\n<td style=\"text-align:left\"><code>$&#123;storePathRootDir&#125;/abort</code></td>\n<td style=\"text-align:left\">å¼‚å¸¸é€€å‡ºæ ‡å¿—æ–‡ä»¶è·¯å¾„</td>\n<td style=\"text-align:left\">ç”¨äºæ ‡è¯† Broker æ˜¯å¦å¼‚å¸¸é€€å‡ºï¼Œå¯åŠ¨æ—¶æ®æ­¤åˆ¤æ–­æ˜¯å¦æ‰§è¡Œæ¢å¤æµç¨‹</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜\">å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜</h2>\n<h3 id=\"1-å¯åŠ¨-Proxy-å¤±è´¥\">1.å¯åŠ¨ Proxy å¤±è´¥</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ— è®ºæ˜¯ <code>Broker+Proxy</code> å¯åŠ¨ï¼Œè¿˜æ˜¯ å•ç‹¬å¯åŠ¨ <code>Proxy</code>ï¼Œéƒ½æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é”™è¯¯ä¼šåœ¨ nohup.out ä¸­è¾“å‡º</span></span><br><span class=\"line\">Exception <span class=\"keyword\">in</span> thread <span class=\"string\">&quot;main&quot;</span> java.lang.UnsatisfiedLinkError: failed to load the required native library</span><br><span class=\"line\"></span><br><span class=\"line\">Caused by: java.lang.IllegalArgumentException: Failed to load any of the given libraries: [netty_tcnative_linux_x86_64_fedora, netty_tcnative_linux_x86_64, netty_tcnative_x86_64, netty_tcnative]</span><br><span class=\"line\"></span><br><span class=\"line\">Suppressed: java.lang.UnsatisfiedLinkError: /tmp/libnetty_tcnative_linux_x86_642308675901892111861.so: libcrypt.so.1: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŸå› åˆ†æ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">\n<ol>\n<li class=\"lvl-7\">Netty-tcnative çš„ç¼–è¯‘ä¾èµ–ï¼šRocketMQ ä½¿ç”¨çš„ Netty çš„ tcnative æ¨¡å—æ˜¯åœ¨è¾ƒæ—§çš„ç¯å¢ƒä¸­ç¼–è¯‘çš„ï¼Œè€ŒåŠ¨æ€é“¾æ¥çš„ç‰ˆæœ¬é”å®šï¼šç¼–è¯‘æ—¶é“¾æ¥çš„æ˜¯ libcrypt.so.1ï¼Œè¿è¡Œæ—¶å¿…é¡»æ‰¾åˆ°ç›¸åŒä¸»ç‰ˆæœ¬å·çš„åº“</li>\n</ol>\n</li>\n<li class=\"lvl-4\">\n<ol start=\"2\">\n<li class=\"lvl-7\">è€Œæˆ‘å½“å‰ä½¿ç”¨çš„ç³»ç»Ÿä¸º Amazon Linux 2023ï¼ŒåŸºäºæ›´æ–°çš„ glibcï¼Œå…¶åŠ å¯†åŠŸèƒ½å·²ç»è¿ç§»åˆ° libcrypt.so.2ã€‚ï¼ˆAmazon Linux 2ï¼šåŸºäºè¾ƒæ—§çš„ glibc ç‰ˆæœ¬ï¼Œlibcrypt.so.1 æ˜¯ä¸»è¦çš„åŠ å¯†åº“ï¼‰</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥ libcrypt æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\">$ ldconfig -p | grep libcrypt</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">  libcryptsetup.so.12 (libc6,x86-64) =&gt; /lib64/libcryptsetup.so.12</span><br><span class=\"line\">\tlibcrypto.so.3 (libc6,x86-64) =&gt; /lib64/libcrypto.so.3</span><br><span class=\"line\">\tlibcrypto.so (libc6,x86-64) =&gt; /lib64/libcrypto.so</span><br><span class=\"line\">\tlibcrypt.so.2 (libc6,x86-64) =&gt; /lib64/libcrypt.so.2</span><br><span class=\"line\">\tlibcrypt.so (libc6,x86-64) =&gt; /lib64/libcrypt.so</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å†³åŠæ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…å…¼å®¹æ€§åŒ…</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> yum install libxcrypt-compat</span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥ libcrypt æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\">$ ldconfig -p | grep libcrypt</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">  libcryptsetup.so.12 (libc6,x86-64) =&gt; /lib64/libcryptsetup.so.12</span><br><span class=\"line\">\tlibcrypto.so.3 (libc6,x86-64) =&gt; /lib64/libcrypto.so.3</span><br><span class=\"line\">\tlibcrypto.so (libc6,x86-64) =&gt; /lib64/libcrypto.so</span><br><span class=\"line\">\tlibcrypt.so.2 (libc6,x86-64) =&gt; /lib64/libcrypt.so.2</span><br><span class=\"line\">\tlibcrypt.so.1 (libc6,x86-64) =&gt; /lib64/libcrypt.so.1</span><br><span class=\"line\">\tlibcrypt.so (libc6,x86-64) =&gt; /lib64/libcrypt.so</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-å†™å…¥æ¶ˆæ¯å¤±è´¥ï¼Œå¹¶æŠ¥å¦‚ä¸‹é”™è¯¯\">2.å†™å…¥æ¶ˆæ¯å¤±è´¥ï¼Œå¹¶æŠ¥å¦‚ä¸‹é”™è¯¯</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14 DESC: service not available now. It may be caused by one of the following reasons: the broker<span class=\"string\">&#x27;s disk is full [CL: 0.95 CQ: 0.95 INDEX: -1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 10.250.0.175:10911</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é”™è¯¯åŸå› </p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">RocketMQ è¿”å›çš„ CODE: 14 è¡¨ç¤ºï¼šBroker å½“å‰ ä¸æ¥å—æ¶ˆæ¯å†™å…¥ï¼ˆæœåŠ¡æš‚ä¸å¯ç”¨ï¼‰ã€‚</li>\n<li class=\"lvl-4\">the brokerâ€™s disk is full [CL: 0.95 CQ: 0.95 INDEX: -1.00]: Broker çš„ç£ç›˜å·²æ»¡</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CL: 0.95 â†’ CommitLog 95% å·²ä½¿ç”¨</span><br><span class=\"line\">CQ: 0.95 â†’ ConsumeQueue 95% å·²ä½¿ç”¨</span><br><span class=\"line\">INDEX: -1.00 â†’ ç´¢å¼•å¼‚å¸¸æˆ–æœªé‡‡é›†</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>å«ä¹‰</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>diskMaxUsedSpaceRatio</code></td>\n<td>Broker ç£ç›˜æœ€å¤§å¯ç”¨æ¯”ä¾‹ï¼ˆè¶…è¿‡åç¦æ­¢å†™å…¥ï¼‰</td>\n<td><strong>75%</strong></td>\n</tr>\n<tr>\n<td><code>storePathCommitLog</code></td>\n<td>æ¶ˆæ¯å­˜å‚¨è·¯å¾„ï¼ˆCommitLogï¼‰</td>\n<td><code>~/store/commitlog</code></td>\n</tr>\n<tr>\n<td><code>storePathConsumeQueue</code></td>\n<td>æ¶ˆè´¹é˜Ÿåˆ—è·¯å¾„ï¼ˆConsumeQueueï¼‰</td>\n<td><code>~/store/consumequeue</code></td>\n</tr>\n<tr>\n<td><code>storePathIndex</code></td>\n<td>ç´¢å¼•è·¯å¾„</td>\n<td><code>~/store/index</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>æ€»ç»“ï¼šå¯ä»¥ç¡®è®¤æ˜¯ ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜ å¯¼è‡´ Broker è‡ªåŠ¨è¿›å…¥ â€œå†™ä¿æŠ¤â€ æ¨¡å¼ã€‚</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è§£å†³æ–¹æ³•</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">\n<ol>\n<li class=\"lvl-9\">æ¸…ç†ç£ç›˜ï¼šç¡®è®¤ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜ï¼Œå¹¶æ¸…ç†ç£ç›˜ç©ºé—´ï¼Œæ—¢é™ä½ç£ç›˜ä½¿ç”¨ç‡</li>\n</ol>\n</li>\n<li class=\"lvl-6\">\n<ol start=\"2\">\n<li class=\"lvl-9\">ç£ç›˜æ‰©å®¹ï¼šå¦‚æœæ¸…ç†ç£ç›˜ç©ºé—´åï¼Œç£ç›˜ä½¿ç”¨ç‡ä¾ç„¶è¿‡é«˜ï¼Œåˆ™éœ€è¦æ‰©å®¹ç£ç›˜</li>\n</ol>\n</li>\n<li class=\"lvl-6\">\n<ol start=\"3\">\n<li class=\"lvl-9\">é…ç½®è°ƒæ•´ï¼šè°ƒæ•´ Broker é…ç½®(<code>broker.conf</code>)ï¼Œå°† <code>diskMaxUsedSpaceRatio</code> é…ç½®é€‚å½“æé«˜ï¼Œå¦‚ 96%(<code>diskMaxUsedSpaceRatio=96</code>)ï¼Œè°ƒæ•´åé‡å¯ Brokerã€‚ä»…å»ºè®®åœ¨ç´§æ€¥æƒ…å†µä¸‹ä¸´æ—¶è§£å†³ã€‚</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RocketMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚ Apache RocketMQ ç®€ä»‹ ä¸€ã€RocketMQ æ˜¯ä»€ä¹ˆï¼Ÿ RocketMQ æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€é˜Ÿåˆ—æ¨¡å‹çš„æ¶ˆæ¯ä¸­é—´ä»¶ã€‚å®ƒç”±é˜¿é‡Œå·´å·´åœ¨2012å¹´å¼€æºï¼Œå¹¶äº2017å¹´æ­£å¼æˆä¸º Apache åŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ã€‚ ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è´Ÿè´£å¯é ä¼ é€’æ¶ˆæ¯çš„â€œé‚®å±€â€æˆ–â€œå¿«é€’ç³»ç»Ÿâ€ã€‚å½“ç³»ç»ŸAéœ€è¦å‘é€æ•°æ®ç»™ç³»ç»ŸBï¼Œä½†å®ƒä»¬ä¹‹é—´ä¸ç›´æ¥é€šä¿¡æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ RocketMQ æ¥ä¸­è½¬ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ã€ä¸é‡å¤ï¼Œå¹¶ä¸”èƒ½æŒ‰é¡ºåºé€è¾¾ã€‚ RocketMQ æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯é ã€é«˜å®æ—¶çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ã€‚å®ƒå°±åƒåˆ†å¸ƒå¼ç³»ç»Ÿçš„â€œä¸­æ¢ç¥ç»ç³»ç»Ÿâ€ï¼Œè´Ÿè´£åœ¨å„ä¸ªæœåŠ¡ä¹‹é—´å¯é ã€é«˜æ•ˆåœ°ä¼ é€’æ•°æ®ï¼Œæ˜¯ç°ä»£äº’è”ç½‘æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„åŸºç¡€ç»„ä»¶ä¹‹ä¸€ã€‚ RocketMQ 5.x é€šè¿‡å¼•å…¥ Proxy æ¨¡å¼ï¼Œæå¤§åœ°æå‡äº†æ¶æ„çš„çµæ´»æ€§ã€å¤šè¯­è¨€æ”¯æŒèƒ½åŠ›å’Œäº‘åŸç”Ÿäº²å’ŒåŠ›ï¼Œæ˜¯å…¶åœ¨æ¶ˆæ¯ä¸­é—´ä»¶é¢†åŸŸæŒç»­æ¼”è¿›çš„é‡è¦é‡Œç¨‹ç¢‘ã€‚ å®ƒä¸ Kafkaã€RabbitMQ ç­‰éƒ½æ˜¯ä¸šç•Œé¡¶çº§çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½†å„æœ‰ä¾§é‡ã€‚RocketMQ åœ¨äº‹åŠ¡æ¶ˆæ¯ã€é¡ºåºæ¶ˆæ¯å’Œå¯¹åœ¨çº¿ä¸šåŠ¡çš„ç¨³å®šæ€§æ”¯æŒæ–¹é¢è¡¨ç°å°¤ä¸ºå‡ºè‰²ã€‚ äºŒã€æ ¸å¿ƒç‰¹ç‚¹ä¸ä¼˜åŠ¿ åºå· ç‰¹æ€§ å…¸å‹åœºæ™¯ ä¸»è¦ä½œç”¨ 1 å‰Šå³°å¡«è°· ç”µå•†ç§’æ€ã€å¤§ä¿ƒæ´»åŠ¨æ—¶å¤§é‡ä¸‹å•è¯·æ±‚ç¬é—´æ¶Œå…¥ å°†çªå‘è¯·æ±‚å…ˆç¼“å­˜ä¸ºæ¶ˆæ¯ï¼Œåç«¯ç³»ç»ŸæŒ‰è‡ªèº«èƒ½åŠ›å¹³ç¨³æ¶ˆè´¹ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½å´©æºƒ 2 å¼‚æ­¥è§£è€¦ ç”¨æˆ·æ³¨å†Œåè§¦å‘å¤šç³»ç»Ÿä»»åŠ¡ï¼ˆé‚®ä»¶ã€ä¼˜æƒ åˆ¸ã€ç§¯åˆ†ï¼‰ ä¸»æµç¨‹åªè´Ÿè´£å‘é€æ¶ˆæ¯ï¼Œå…¶ä»–ç³»ç»Ÿç‹¬ç«‹å¼‚æ­¥å¤„ç†ï¼Œé™ä½ç³»ç»Ÿé—´è€¦åˆã€æé«˜æ‰©å±•æ€§ 3 é¡ºåºæ¶ˆæ¯ è®¢å•çŠ¶æ€å˜æ›´ï¼ˆåˆ›å»º â†’ ä»˜æ¬¾ â†’ å‘è´§ â†’ æ”¶è´§ï¼‰ åŒä¸€ä¸šåŠ¡é”®ï¼ˆå¦‚è®¢å•IDï¼‰çš„æ¶ˆæ¯æŒ‰é¡ºåºå‘é€å’Œæ¶ˆè´¹ï¼Œä¿è¯ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§ 4 æŒä¹…åŒ–ä¸é«˜å¯é æ€§ å…³é”®ä¸šåŠ¡æ¶ˆæ¯å¿…é¡»ä¸ä¸¢å¤±ï¼ˆäº¤æ˜“ã€æ”¯ä»˜ã€æ—¥å¿—ï¼‰ æ‰€æœ‰æ¶ˆæ¯å†™å…¥ç£ç›˜å¹¶æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œå³ä½¿æœåŠ¡å™¨é‡å¯ä¹Ÿèƒ½æ¢å¤ï¼Œä¿è¯é«˜å¯ç”¨ 5 æ¶ˆæ¯å›æº¯ æ¶ˆè´¹é€»è¾‘å‡ºé”™ã€æ•°æ®é‡ç®—ã€è¡¥å¿ä»»åŠ¡ æ”¯æŒé‡ç½®æ¶ˆè´¹ä½ç‚¹ï¼Œé‡æ–°æ¶ˆè´¹å†å²æ¶ˆæ¯ï¼Œå®ç°ä¸šåŠ¡è¡¥å¿ä¸è¿½æº¯ 6 æµ·é‡æ¶ˆæ¯å †ç§¯èƒ½åŠ› å¤§è§„æ¨¡å¼‚æ­¥æ—¥å¿—æ”¶é›†ã€IoT æ•°æ®æ±‡èšã€åŸ‹ç‚¹åˆ†æ æ”¯æŒä¸‡äº¿çº§æ¶ˆæ¯å †ç§¯ï¼Œæ€§èƒ½ç¨³å®šä¸è¡°å‡ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®åœºæ™¯ ä¸‰ã€æ ¸å¿ƒæ¶æ„ä¸æ¦‚å¿µ è¦ç†è§£ RocketMQï¼Œéœ€è¦çŸ¥é“å‡ ä¸ªå…³é”®è§’è‰²ï¼š ç»å…¸æ ¸å¿ƒç»„ä»¶ åºå· ç»„ä»¶åç§° ä¸»è¦ä½œç”¨ è¯´æ˜ / ç‰¹ç‚¹ 1 Producerï¼ˆç”Ÿäº§è€…ï¼‰ å‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯ è´Ÿè´£å°†ä¸šåŠ¡ç³»ç»Ÿçš„æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„ Topicï¼Œæ”¯æŒåŒæ­¥ã€å¼‚æ­¥ã€å•å‘ä¸‰ç§å‘é€æ–¹å¼ 2 Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰ æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯çš„å®¢æˆ·ç«¯ ä» Broker æ‹‰å–æ¶ˆæ¯å¹¶è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¯åˆ†ä¸º Push å’Œ Pull ä¸¤ç§æ¶ˆè´¹æ¨¡å¼ 3 Consumer Groupï¼ˆæ¶ˆè´¹è€…ç»„ï¼‰ å®ç°è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨æ¶ˆè´¹ å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…åŒä¸€ Topic æ—¶ç»„æˆæ¶ˆè´¹è€…ç»„ï¼Œä¸€ä¸ªåˆ†åŒºåªä¼šè¢«ç»„å†…ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ 4 Brokerï¼ˆæ¶ˆæ¯æœåŠ¡å™¨ï¼‰ å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯ RocketMQ çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£æ¶ˆæ¯çš„æŒä¹…åŒ–ã€è½¬å‘ã€ä¸»ä»å¤åˆ¶å’Œé«˜å¯ç”¨ 5 Topicï¼ˆä¸»é¢˜ï¼‰ æ¶ˆæ¯çš„åˆ†ç±»ä¸è·¯ç”±å•å…ƒ Producer å‘é€æ¶ˆæ¯åˆ°æŒ‡å®š Topicï¼ŒConsumer è®¢é˜… Topic æ¶ˆè´¹æ¶ˆæ¯ï¼›ä¸€ä¸ª Topic å¯åŒ…å«å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆåˆ†åŒºï¼‰ 6 Name Serverï¼ˆåå­—æœåŠ¡ï¼‰ ç®¡ç† Broker åœ°å€ä¿¡æ¯ ç±»ä¼¼è½»é‡çº§æ³¨å†Œä¸­å¿ƒï¼Œç»´æŠ¤ Broker å…ƒæ•°æ®ï¼Œå¸®åŠ© Producer å’Œ Consumer å®šä½æ¶ˆæ¯å­˜å‚¨ä½ç½® 7 Controllerï¼ˆæ§åˆ¶å™¨ï¼‰ ä¸»ä»è‡ªåŠ¨åˆ‡æ¢ä¸é«˜å¯ç”¨æ§åˆ¶ RocketMQ 5.x å¼•å…¥ï¼ŒåŸºäº Raftï¼ˆDLedgerï¼‰åè®®å®ç° Broker è‡ªåŠ¨é€‰ä¸»å’Œå…ƒæ•°æ®ç®¡ç† 8 Proxyï¼ˆä»£ç†å±‚ï¼‰ å®¢æˆ·ç«¯è®¿é—®å…¥å£ä¸åè®®è½¬æ¢ RocketMQ 5.x æ–°ç»„ä»¶ï¼Œæ— çŠ¶æ€ï¼Œå¯æ¨ªå‘æ‰©å±•ï¼›ç»Ÿä¸€æ¥å…¥å±‚ï¼Œæ”¯æŒå¤šåè®®ï¼ˆå¦‚ HTTPã€gRPCï¼‰ï¼Œéš”ç¦»å®¢æˆ·ç«¯ä¸ Broker å¼•å…¥ Proxy æ¨¡å¼çš„ä¼˜åŠ¿ï¼š 1234**æ¶æ„è§£è€¦ä¸è¯­è¨€æ— å…³**ï¼šProxy ä½œä¸ºé€šç”¨ä»£ç†ï¼Œå°†å¤æ‚çš„ Broker åè®®å°è£…æˆæ›´ç®€å•çš„æ¥å£ï¼ˆå¦‚ gRPCï¼‰ï¼Œä½¿å¾—ç”¨ä¸åŒç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Go, Python, C++ ç­‰ï¼‰å¼€å‘çš„å®¢æˆ·ç«¯æ›´å®¹æ˜“æ¥å…¥ï¼Œè€Œæ— éœ€å®ç°å¤æ‚çš„åŸç”Ÿåè®®ã€‚**ç®€åŒ–å®¢æˆ·ç«¯**ï¼šå®¢æˆ·ç«¯ä¸å†éœ€è¦æ„ŸçŸ¥ Name Server å’Œ Broker çš„åœ°å€å˜åŒ–ï¼Œåªéœ€è¿æ¥å›ºå®šçš„ Proxy åœ°å€å³å¯ï¼Œå¤§å¤§é™ä½äº†å®¢æˆ·ç«¯çš„å¤æ‚åº¦ã€‚**å¢å¼ºå®‰å…¨æ€§**ï¼šå¯ä»¥åœ¨ Proxy å±‚ç»Ÿä¸€å®ç°å®‰å…¨è®¤è¯ã€é™æµã€å®¡è®¡ç­‰ç­–ç•¥ï¼Œä½œä¸ºBrokeré›†ç¾¤çš„å®‰å…¨å±éšœã€‚**äº‘åŸç”Ÿå‹å¥½**ï¼šæ— çŠ¶æ€çš„ Proxy éå¸¸é€‚åˆåœ¨ Kubernetes ç­‰å®¹å™¨åŒ–ç¯å¢ƒä¸­è¿›è¡Œéƒ¨ç½²å’Œå¼¹æ€§ä¼¸ç¼©ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶åŠŸèƒ½å¯¹æ¯”è¡¨ï¼ˆActiveMQ vs Kafka vs RabbitMQ vs RocketMQï¼‰ å‚è€ƒèµ„æ–™ åŠŸèƒ½é¡¹ ActiveMQ Kafka RabbitMQ RocketMQ å®¢æˆ·ç«¯ SDK Javaã€.NETã€C++ ç­‰ Javaã€Scala ç­‰ Javaã€.NETã€Goã€Pythonã€C ç­‰ Javaã€C++ã€Go é€šä¿¡åè®®ä¸è§„èŒƒ æ¨é€æ¨¡å‹ï¼ˆPushï¼‰ï¼Œæ”¯æŒ OpenWireã€STOMPã€AMQPã€MQTTã€JMS æ‹‰å–æ¨¡å‹ï¼ˆPullï¼‰ï¼Œæ”¯æŒ TCP æ¨é€æ¨¡å‹ï¼ˆPushï¼‰ï¼Œæ”¯æŒ AMQPã€MQTTã€STOMPã€HTTPã€WebSocket æ‹‰å–æ¨¡å‹ï¼ˆPullï¼‰ï¼Œæ”¯æŒ TCPã€JMSã€OpenMessaging æ¶ˆæ¯æœ‰åºæ€§ é€šè¿‡ç‹¬å æ¶ˆè´¹è€…ï¼ˆExclusive Consumerï¼‰æˆ–ç‹¬å é˜Ÿåˆ—ï¼ˆExclusive Queuesï¼‰ä¿è¯é¡ºåº ä¿è¯åˆ†åŒºå†…æ¶ˆæ¯é¡ºåº å•é˜Ÿåˆ—å†…æ¶ˆæ¯å¤©ç„¶æœ‰åº ä¸¥æ ¼é¡ºåºæ¶ˆæ¯ï¼Œå¯å¹³æ»‘æ‰©å±• å®šæ—¶/å»¶è¿Ÿæ¶ˆæ¯ æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒï¼ˆä½¿ç”¨å»¶è¿Ÿæ’ä»¶ï¼‰ æ”¯æŒ æ‰¹é‡æ¶ˆæ¯ ä¸æ”¯æŒ æ”¯æŒï¼ˆå¼‚æ­¥ç”Ÿäº§è€…ï¼‰ æ”¯æŒï¼ˆPublisher Confirms æ¨¡å¼ä¸‹ï¼‰ æ”¯æŒï¼ˆåŒæ­¥æ¨¡å¼å¯é¿å…æ¶ˆæ¯ä¸¢å¤±ï¼‰ å¹¿æ’­æ¶ˆæ¯ æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒï¼ˆFanout äº¤æ¢æœºï¼‰ æ”¯æŒ æ¶ˆæ¯è¿‡æ»¤ æ”¯æŒ æ”¯æŒï¼ˆå¯ç”¨ Kafka Streams å®ç°ï¼‰ æ”¯æŒï¼ˆåŸºäº Exchange çš„è·¯ç”±é”®æˆ– Headerï¼‰ æ”¯æŒï¼ˆåŸºäº SQL92 å±æ€§è¿‡æ»¤ï¼‰ æœåŠ¡å™¨ç«¯è§¦å‘é‡æŠ•é€’ ä¸æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒï¼ˆNack æˆ– TTL+DLXï¼‰ æ”¯æŒ æ¶ˆæ¯å­˜å‚¨ æ”¯æŒé«˜æ€§èƒ½æŒä¹…åŒ–ï¼ˆJDBC + LevelDB/KahaDBï¼‰ é«˜æ€§èƒ½æ–‡ä»¶å­˜å‚¨ å†…å­˜+ç£ç›˜æ··åˆå­˜å‚¨ï¼ˆMnesia/åŸºäº Erlang çš„æ—¥å¿—ï¼‰ é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿæ–‡ä»¶å­˜å‚¨ æ¶ˆæ¯å›æº¯ï¼ˆå†å²æ¶ˆæ¯æŸ¥è¯¢ï¼‰ æ”¯æŒ æ”¯æŒï¼ˆé€šè¿‡ offsetï¼‰ ä¸æ”¯æŒï¼ˆæ¶ˆæ¯è¢«æ¶ˆè´¹åæ— æ³•å›æº¯ï¼‰ æ”¯æŒï¼ˆæ—¶é—´æˆ³ä¸ offsetï¼‰ æ¶ˆæ¯ä¼˜å…ˆçº§ æ”¯æŒ ä¸æ”¯æŒ æ”¯æŒï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰ ä¸æ”¯æŒ é«˜å¯ç”¨ä¸æ•…éšœè½¬ç§» ä¾èµ–å­˜å‚¨ï¼Œå¦‚ LevelDB éœ€ ZooKeeper éœ€è¦ ZooKeeper æ”¯æŒé•œåƒé˜Ÿåˆ—ï¼ˆClassic / Quorum æ¨¡å¼ï¼‰ æ”¯æŒä¸»ä»æ¨¡å¼ï¼ˆæ— éœ€é¢å¤–ç»„ä»¶ï¼‰ æ¶ˆæ¯è½¨è¿¹ï¼ˆMessage Trackï¼‰ ä¸æ”¯æŒ ä¸æ”¯æŒ ä¸æ”¯æŒï¼ˆå¯é€šè¿‡æ’ä»¶æ‰©å±•ï¼‰ æ”¯æŒ é…ç½®å¤æ‚åº¦ é»˜è®¤é…ç½®è¾ƒä½ï¼Œéœ€æ‰‹åŠ¨ä¼˜åŒ– é…ç½®ä¸ºé”®å€¼å¯¹ï¼Œå¯æ–‡ä»¶æˆ–ä»£ç æä¾› å¼€ç®±å³ç”¨ï¼Œé…ç½®çµæ´»ä½†é€‰é¡¹è¾ƒå¤š å¼€ç®±å³ç”¨ï¼Œä»…éœ€å…³æ³¨å°‘é‡é…ç½® ç®¡ç†ä¸è¿ç»´å·¥å…· æ”¯æŒ æ”¯æŒï¼ˆå‘½ä»¤è¡Œç›‘æ§ï¼‰ æ”¯æŒï¼ˆWeb ç®¡ç†æ§åˆ¶å°ã€CLIï¼‰ æ”¯æŒï¼ˆä¸°å¯Œçš„ Web ä¸å‘½ä»¤è¡Œå·¥å…·ï¼‰ RocketMQ çš„å®‰è£… RocketMQ 5.x ä¾èµ– JDK 1.8+ã€‚ å•æœºå®‰è£… å®˜æ–¹æ–‡æ¡£ ä¸‹è½½RocketMQ 12345mkdir -p /usr/local/soft/rocketmq/wget https://dist.apache.org/repos/dist/release/rocketmq/5.3.2/rocketmq-all-5.3.2-bin-release.zipunzip rocketmq-all-5.3.2-bin-release.zipln -s rocketmq-all-5.3.2-bin-release rocketmq5cd rocketmq5 å°è´´å£« é»˜è®¤è„šæœ¬ä¸­ï¼ŒNameServeréœ€è¦4Gå†…å­˜ï¼ŒBroker éœ€è¦8Gå†…å­˜ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿï¼Œå¯ä»¥è¿›å…¥binç›®å½•ï¼Œå¯¹å…¶ä¸­çš„runserver.shå’Œrunbroker.shä¸¤ä¸ªè„šæœ¬è¿›è¡Œä¸€ä¸‹ä¿®æ”¹ 12345678910# ä½¿ç”¨vi runserver.shæŒ‡ä»¤ï¼Œç¼–è¾‘è¿™ä¸ªè„šæœ¬ï¼Œæ‰¾åˆ°ä¸‹é¢çš„ä¸€è¡Œé…ç½®ï¼Œè°ƒæ•´Javaè¿›ç¨‹çš„å†…å­˜å¤§å°ã€‚# NameServer,Controller,Proxy éƒ½ä½¿ç”¨è¿™ä¸ªè„šæœ¬å¯åŠ¨JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms4g -Xmx4g -Xmn2G -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;ä¿®æ”¹ä¸ºï¼šJAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms1g -Xmx1g -Xmn512m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;# æ¥ä¸‹æ¥ï¼ŒåŒæ ·è°ƒæ•´runbroker.shä¸­çš„å†…å­˜å¤§å°ã€‚Broker ä½¿ç”¨è¿™ä¸ªè„šæœ¬å¯åŠ¨JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms8g -Xmx8g&quot;ä¿®æ”¹ä¸ºï¼šJAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms2g -Xmx2g&quot; å¯åŠ¨ NameServer å®‰è£…å®ŒRocketMQåŒ…åï¼Œæˆ‘ä»¬å¯åŠ¨NameServer 123456789### å¯åŠ¨namesrv$ nohup sh bin/mqnamesrv &amp;## æŒ‡å®šé…ç½®æ–‡ä»¶$ nohup sh bin/mqnamesrv -c namesrv.conf &amp;### éªŒè¯namesrvæ˜¯å¦å¯åŠ¨æˆåŠŸ$ tail -f ~/logs/rocketmqlogs/namesrv.log# æˆ‘ä»¬å¯ä»¥åœ¨namesrv.log ä¸­çœ‹åˆ° &#x27;The Name Server boot success..&#x27;ï¼Œ è¡¨ç¤ºNameServer å·²æˆåŠŸå¯åŠ¨ã€‚The Name Server boot success. serializeType=JSON, address 0.0.0.0:9876 namesrv.conf ç¤ºä¾‹ 12# The port of nameserverlistenPort = 9876 å¯åŠ¨ Broker+Proxy NameServeræˆåŠŸå¯åŠ¨åï¼Œæˆ‘ä»¬å¯åŠ¨Brokerå’ŒProxyã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Local æ¨¡å¼éƒ¨ç½²ï¼Œå³ Broker å’Œ Proxy åŒè¿›ç¨‹éƒ¨ç½²ã€‚5.x ç‰ˆæœ¬ä¹Ÿæ”¯æŒ Broker å’Œ Proxy åˆ†ç¦»éƒ¨ç½²ä»¥å®ç°æ›´çµæ´»çš„é›†ç¾¤èƒ½åŠ›ã€‚ 1234567891011121314151617### å…ˆå¯åŠ¨broker$ nohup sh bin/mqbroker -n localhost:9876 --enable-proxy &amp;# æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œ é»˜è®¤å°±æ˜¯ conf/broker.conf$ nohup sh bin/mqbroker -n localhost:9876 -c conf/broker.conf --enable-proxy &amp;# ä¸Šé¢çš„å¯åŠ¨æ–¹å¼ä¸ä¸‹é¢çš„å¯åŠ¨æ–¹å¼æ•ˆæœä¸€æ ·$ nohup sh bin/mqproxy -n localhost:9876 -pc /usr/local/soft/rocketmq/rocketmq5/conf/rmq-proxy.json -bc /usr/local/soft/rocketmq/rocketmq5/conf/broker.conf -pm local &amp;## å‚æ•°è¯´æ˜# -n, --namesrvAddr NameServer çš„åœ°å€# -pc, --proxyConfigPath Proxy é…ç½®æ–‡ä»¶è·¯å¾„# -bc, --brokerConfigPath Broker é…ç½®æ–‡ä»¶è·¯å¾„# -pm, --proxyMode Proxy æ¨¡å¼ï¼Œlocal or cluster### éªŒè¯brokeræ˜¯å¦å¯åŠ¨æˆåŠŸ, æ¯”å¦‚, brokerçš„ipæ˜¯192.168.1.2 ç„¶ååå­—æ˜¯broker-a$ tail -f ~/logs/rocketmqlogs/proxy.log# æˆ‘ä»¬å¯ä»¥åœ¨ proxy.log ä¸­çœ‹åˆ°â€œThe broker[brokerName,ip:port] boot success..â€ï¼Œè¿™è¡¨æ˜ broker å·²æˆåŠŸå¯åŠ¨ã€‚The broker[broker-a, 10.250.0.175:10911] boot success. serializeType=JSON and name server is localhost:9876 å…³é—­æœåŠ¡å™¨ 1234# å…ˆåœæ­¢ Broker$ sh bin/mqshutdown broker# åœæ­¢ NameServer$ sh bin/mqshutdown namesrv é›†ç¾¤å®‰è£…:å¤šèŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰å¤šå‰¯æœ¬æ¨¡å¼-å¼‚æ­¥å¤åˆ¶ å®˜ç½‘æ–‡æ¡£ å¯¹é›†ç¾¤å®‰è£…çš„æ–¹å¼ä»‹ç»äº†å¤šç§ï¼Œæœ¬æ–‡ä»…å®æˆ˜ä¸€ç§ï¼šå¤šèŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰å¤šå‰¯æœ¬æ¨¡å¼-å¼‚æ­¥å¤åˆ¶ æ¯ä¸ªMasteré…ç½®ä¸€ä¸ªSlaveï¼Œæœ‰å¤šç»„ Master-Slaveï¼ŒHAé‡‡ç”¨å¼‚æ­¥å¤åˆ¶æ–¹å¼ï¼Œä¸»å¤‡æœ‰çŸ­æš‚æ¶ˆæ¯å»¶è¿Ÿï¼ˆæ¯«ç§’çº§ï¼‰ï¼Œè¿™ç§æ¨¡å¼çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š ä¼˜ç‚¹ï¼šå³ä½¿ç£ç›˜æŸåï¼Œæ¶ˆæ¯ä¸¢å¤±çš„éå¸¸å°‘ï¼Œä¸”æ¶ˆæ¯å®æ—¶æ€§ä¸ä¼šå—å½±å“ï¼ŒåŒæ—¶Masterå®•æœºåï¼Œæ¶ˆè´¹è€…ä»ç„¶å¯ä»¥ä»Slaveæ¶ˆè´¹ï¼Œè€Œä¸”æ­¤è¿‡ç¨‹å¯¹åº”ç”¨é€æ˜ï¼Œä¸éœ€è¦äººå·¥å¹²é¢„ï¼Œæ€§èƒ½åŒå¤šMasteræ¨¡å¼å‡ ä¹ä¸€æ ·ï¼› ç¼ºç‚¹ï¼šMasterå®•æœºï¼Œç£ç›˜æŸåæƒ…å†µä¸‹ä¼šä¸¢å¤±å°‘é‡æ¶ˆæ¯ã€‚ è¯¥æ¨¡å¼ä¸‹ï¼ŒMaster èŠ‚ç‚¹å’Œ Slave èŠ‚ç‚¹ä¹‹é—´æ˜¯å¼‚æ­¥å¤åˆ¶çš„ï¼ŒMaster èŠ‚ç‚¹æŒ‚æ‰åï¼ŒSlave èŠ‚ç‚¹ä¸ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸º Master èŠ‚ç‚¹ã€‚ é›†ç¾¤è§„åˆ’ 12345678910111213# NameServer 3 å°NameServer1 10.250.0.175NameServer2 10.250.0.188NameServer3 10.250.0.31# Broker 2 Master 2 ReplicasBroker1 10.250.0.188 broker-a,broker-b-sBroker2 10.250.0.31 broker-b,broker-a-s# Proxy 3 å°Proxy1 10.250.0.175Proxy2 10.250.0.188Proxy3 10.250.0.31 éƒ¨ç½² NameServer åœ¨ä¸‰å°æœåŠ¡å™¨ä¸Šåˆ†åˆ«å¯åŠ¨RocketMQ NameServer 12cd /usr/local/soft/rocketmq/rocketmq5nohup sh bin/mqnamesrv &amp; éƒ¨ç½²Broker broker-a.properties 12345678910111213141516171819brokerClusterName=DefaultCluster # é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´brokerName=broker-a # broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´brokerId=0 # brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” master çš„ brokerId å¿…é¡»ä¸º 0deleteWhen=04 # è¡¨ç¤ºå‡Œæ™¨ 4 ç‚¹æ¸…ç†fileReservedTime=48 # è¡¨ç¤ºä¿å­˜ 48 å°æ—¶çš„æ•°æ®brokerRole=ASYNC_MASTER # è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä¸»èŠ‚ç‚¹flushDiskType=ASYNC_FLUSH # è¡¨ç¤ºå¼‚æ­¥åˆ·ç›˜# å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£# å­˜å‚¨æ•°æ®è·¯å¾„ï¼Œåé¢ä¼šä»‹ç»storePathRootDir=/usr/local/soft/rocketmq/data/store-astorePathCommitLog=/usr/local/soft/rocketmq/data/store-a/commitlogstorePathConsumeQueue=/usr/local/soft/rocketmq/data/store-a/consumequeuestorePathIndex=/usr/local/soft/rocketmq/data/store-a/indexstorePathConfig=/usr/local/soft/rocketmq/data/store-a/configstoreCheckpoint=/usr/local/soft/rocketmq/data/store-a/checkpointabortFile=/usr/local/soft/rocketmq/data/store-a/abort#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£listenPort=10911 broker-a-s.properties 12345678910111213141516171819brokerClusterName=DefaultCluster # é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´brokerName=broker-a # broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´brokerId=1 # brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” slave çš„ brokerId å¿…é¡»å¤§äº 0deleteWhen=04fileReservedTime=48brokerRole=SLAVE # è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä»èŠ‚ç‚¹flushDiskType=ASYNC_FLUSH# å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£# å­˜å‚¨æ•°æ®è·¯å¾„storePathRootDir=/usr/local/soft/rocketmq/data/store-astorePathCommitLog=/usr/local/soft/rocketmq/data/store-a/commitlogstorePathConsumeQueue=/usr/local/soft/rocketmq/data/store-a/consumequeuestorePathIndex=/usr/local/soft/rocketmq/data/store-a/indexstorePathConfig=/usr/local/soft/rocketmq/data/store-a/configstoreCheckpoint=/usr/local/soft/rocketmq/data/store-a/checkpointabortFile=/usr/local/soft/rocketmq/data/store-a/abort#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£listenPort=11011 broker-b.properties 1234567891011121314151617181920brokerClusterName=DefaultCluster # é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´brokerName=broker-b # broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´brokerId=0 # brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” master çš„ brokerId å¿…é¡»ä¸º 0deleteWhen=04 # è¡¨ç¤ºå‡Œæ™¨ 4 ç‚¹æ¸…ç†fileReservedTime=48 # è¡¨ç¤ºä¿å­˜ 48 å°æ—¶çš„æ•°æ®brokerRole=ASYNC_MASTER # è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä¸»èŠ‚ç‚¹flushDiskType=ASYNC_FLUSH # è¡¨ç¤ºå¼‚æ­¥åˆ·ç›˜# å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£# å­˜å‚¨æ•°æ®è·¯å¾„storePathRootDir=/usr/local/soft/rocketmq/data/store-bstorePathCommitLog=/usr/local/soft/rocketmq/data/store-b/commitlogstorePathConsumeQueue=/usr/local/soft/rocketmq/data/store-b/consumequeuestorePathIndex=/usr/local/soft/rocketmq/data/store-b/indexstorePathConfig=/usr/local/soft/rocketmq/data/store-b/configstoreCheckpoint=/usr/local/soft/rocketmq/data/store-b/checkpointabortFile=/usr/local/soft/rocketmq/data/store-b/abort#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£listenPort=10911 broker-b-s.properties 1234567891011121314151617181920brokerClusterName=DefaultCluster # é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´brokerName=broker-b # broker åç§°ï¼Œmaster å’Œ slave çš„ brokerName å¿…é¡»ä¸€è‡´brokerId=1 # brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” slave çš„ brokerId å¿…é¡»å¤§äº 0deleteWhen=04fileReservedTime=48brokerRole=SLAVE # è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä»èŠ‚ç‚¹flushDiskType=ASYNC_FLUSH# å› ä¸ºåŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª Brokerï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸åŒçš„å­˜å‚¨è·¯å¾„å’Œç«¯å£# å­˜å‚¨æ•°æ®è·¯å¾„storePathRootDir=/usr/local/soft/rocketmq/data/store-bstorePathCommitLog=/usr/local/soft/rocketmq/data/store-b/commitlogstorePathConsumeQueue=/usr/local/soft/rocketmq/data/store-b/consumequeuestorePathIndex=/usr/local/soft/rocketmq/data/store-b/indexstorePathConfig=/usr/local/soft/rocketmq/data/store-b/configstoreCheckpoint=/usr/local/soft/rocketmq/data/store-b/checkpointabortFile=/usr/local/soft/rocketmq/data/store-b/abort#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ï¼ŒåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªBrokerï¼Œéœ€è¦æŒ‡å®šä¸åŒçš„ç«¯å£listenPort=11011 åœ¨ Broker1 10.250.0.188 ä¸Šå¯åŠ¨ broker-a å’Œ broker-b-s 1234567# å¯åŠ¨ broker-anohup sh bin/mqbroker -n &quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot; -c conf/2m-2s-async/broker-a.properties &amp;# å¯åŠ¨ broker-b-snohup sh bin/mqbroker -n &quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot; -c conf/2m-2s-async/broker-b-s.properties &amp;## nohup.out ä¸­çš„è¾“å‡ºç±»ä¼¼ä¸ä¸‹é¢è¿™ç§å°±è¡¨ç¤ºå¯åŠ¨æˆåŠŸThe broker[broker-a, 10.250.0.31:11011] boot success. serializeType=JSON and name server is 10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876 åœ¨ Broker2 10.250.0.31 ä¸Šå¯åŠ¨ broker-b å’Œ broker-a-s 1234# å¯åŠ¨ broker-bnohup sh bin/mqbroker -n &quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot; -c conf/2m-2s-async/broker-b.properties &amp;# å¯åŠ¨ broker-a-snohup sh bin/mqbroker -n &quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot; -c conf/2m-2s-async/broker-a-s.properties &amp; å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ£€æŸ¥æœºå™¨çŠ¶æ€ 12345678# ç¡®è®¤ Broker æ˜¯å¦å·²ç»æˆåŠŸæ³¨å†Œåˆ° Nameserverï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆåœ¨ä»»æ„ä¸€å°æœºå™¨ä¸Šï¼‰sh bin/mqadmin clusterList -n 10.250.0.175:9876## è¾“å‡ºç±»ä¼¼å¦‚ä¸‹#Cluster Name #Broker Name #BID #Addr #Version #InTPS(LOAD) #OutTPS(LOAD) #Timer(Progress) #PCWait(ms) #Hour #SPACE #ACTIVATEDDefaultCluster broker-a 0 10.250.0.188:10911 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 0-0(0.0w, 0.0, 0.0) 0 489250.72 0.2900 trueDefaultCluster broker-a 1 10.250.0.31:11011 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 3-0(0.0w, 0.0, 0.0) 0 489250.72 0.2600 falseDefaultCluster broker-b 0 10.250.0.31:10911 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 0-0(0.0w, 0.0, 0.0) 0 489250.72 0.2600 trueDefaultCluster broker-b 1 10.250.0.188:11011 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 3-0(0.0w, 0.0, 0.0) 0 489250.72 0.2900 false é…ç½® Proxy åœ¨ä¸‰å°æœåŠ¡å™¨ä¸Šåˆ†åˆ«å¯åŠ¨RocketMQ NameServer 12345678nohup sh bin/mqproxy -n &quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot; &amp;## æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œé›†ç¾¤çš„åç§°è¦ä¸ conf/rmq-proxy.json ä¸­é…ç½®çš„é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´ï¼Œé»˜è®¤æ˜¯ DefaultCluster## é»˜è®¤çš„é…ç½®æ–‡ä»¶å°±æ˜¯ conf/rmq-proxy.jsonï¼Œä½†å¦‚æœé€šè¿‡ -pc æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„nohup sh bin/mqproxy -n &quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot; -pc /usr/local/soft/rocketmq/rocketmq5/conf/rmq-proxy.json &amp;## æŸ¥çœ‹æ—¥å¿—ï¼Œè¾“å‡ºå¦‚ä¸‹å†…å®¹å°±è¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼Œtail -f nohup.outrocketmq-proxy startup successfully rmq-proxy.json ç¤ºä¾‹ 12345&#123; &quot;rocketMQClusterName&quot;: &quot;DefaultCluster&quot;, # é›†ç¾¤åç§° &quot;remotingListenPort&quot;: 8080, # ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ 8080 &quot;grpcServerPort&quot;: 8081 # grpc ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ 8081&#125; åœæ­¢Proxy 12# åœæ­¢ Proxysh bin/mqshutdown proxy é›†ç¾¤å®‰è£…:ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼éƒ¨ç½² RocketMQ 5.x æä¾›äº†ä¸€ç§æ–°çš„éƒ¨ç½²æ–¹å¼ Controllerï¼Œå¯ä»¥åœ¨ä¸»ä»æ¨¡å¼ä¸‹å®ç°ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä»èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ å®˜æ–¹æ–‡æ¡£:ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼éƒ¨ç½² Controller ç»„ä»¶æä¾›é€‰ä¸»èƒ½åŠ›ï¼Œè‹¥éœ€è¦ä¿è¯ Controller å…·å¤‡å®¹é”™èƒ½åŠ›ï¼ŒController éƒ¨ç½²éœ€è¦ä¸‰å‰¯æœ¬åŠä»¥ä¸Šï¼ˆéµå¾ª Raft çš„å¤šæ•°æ´¾åè®®ï¼‰ã€‚ æœ¬æ–‡åœ¨ä¸Šæ–‡â€œé›†ç¾¤å®‰è£…:å¤šèŠ‚ç‚¹ï¼ˆé›†ç¾¤ï¼‰å¤šå‰¯æœ¬æ¨¡å¼-å¼‚æ­¥å¤åˆ¶â€çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ Controller éƒ¨ç½²æœ‰ä¸¤ç§æ–¹å¼ã€‚ä¸€ç§æ˜¯åµŒå…¥äº NameServer è¿›è¡Œéƒ¨ç½²ï¼Œå¦ä¸€ç§æ˜¯ç‹¬ç«‹éƒ¨ç½²ï¼Œæœ¬æ–‡é‡‡ç”¨ç‹¬ç«‹éƒ¨ç½² Controller ç»„ä»¶çš„æ–¹å¼ã€‚ é›†ç¾¤è§„åˆ’ 1234# Controller 3 å°Controller1 10.250.0.175Controller2 10.250.0.188Controller3 10.250.0.31 åˆ†åˆ«åœ¨æ¯å°æœºå™¨ä¸Šåˆ›å»ºcontroller.confé…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹(æ³¨æ„ä¿®æ”¹èŠ‚ç‚¹Id) 1234567891011121314151617# controller.conf# ---------------------------------------------------------# DLedger Raft Group çš„åå­—ï¼ŒåŒä¸€é›†ç¾¤ä¿æŒä¸€è‡´controllerDLegerGroup = group1# é›†ç¾¤ä¸­ä¸‰ä¸ªèŠ‚ç‚¹çš„æˆå‘˜å®šä¹‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»ä¸€è‡´controllerDLegerPeers = n0-10.250.0.175:9877;n1-10.250.0.188:9877;n2-10.250.0.31:9877# èŠ‚ç‚¹ idï¼Œå¿…é¡»å±äº controllerDLegerPeers ä¸­çš„ä¸€ä¸ªï¼›åŒ Group å†…å„ä¸ªèŠ‚ç‚¹è¦å”¯ä¸€controllerDLegerSelfId = n0# Controller æ•°æ®å­˜å‚¨è·¯å¾„ï¼ˆéå¸¸å…³é”®ï¼ä¸è¦åˆ é™¤ï¼‰controllerStorePath = /usr/local/soft/rocketmq/data/DledgerController# æ˜¯å¦å…è®¸ä» SyncStateSet å¤–é€‰ä¸¾ Master# true ä¼šåŠ å¿«é€‰ä¸¾ä½†å¯èƒ½ä¸¢æ¶ˆæ¯ï¼Œå»ºè®®ç”Ÿäº§ä¿æŒ falseenableElectUncleanMaster = false# å½“ Broker å‰¯æœ¬è§’è‰²å˜åŒ–æ—¶æ˜¯å¦ä¸»åŠ¨é€šçŸ¥ï¼ˆå»ºè®®å¼€å¯ï¼‰notifyBrokerRoleChanged = true# å¯åŠ¨ç«¯å£ï¼Œç«¯å£ä¸èƒ½ä¸ NameServerã€Brokerã€Proxy ç«¯å£å†²çªlistenPort = 9877 åˆ†åˆ«å¯åŠ¨æ¯å°æœºå™¨ä¸Šçš„ Controller 1234nohup sh bin/mqcontroller -n &quot;10.250.0.175:9876;10.250.0.188:9876;10.250.0.31:9876&quot; -c conf/controller.conf &amp;## å¯åŠ¨æˆåŠŸåï¼ŒæŸ¥çœ‹ nohup.out æ–‡ä»¶ï¼Œè¾“å‡ºå¦‚ä¸‹å†…å®¹å°±è¡¨ç¤ºå¯åŠ¨æˆåŠŸload config properties file OK, conf/controller.confThe Controller Server boot success. serializeType=JSON ä¿®æ”¹ broker é…ç½®æ–‡ä»¶ï¼Œä»¥ broker-a.properties ä¸ºä¾‹ 123456789# å»æ‰å¦‚ä¸‹é…ç½®ï¼ŒController æ¨¡å¼ä¸‹ ä¼šè‡ªåŠ¨åˆ†é…# brokerId=1 # brokerId å¿…é¡»å”¯ä¸€ ï¼Œä¸” slave çš„ brokerId å¿…é¡»å¤§äº 0# brokerRole=ASYNC_MASTER # è§’è‰²ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤åˆ¶çš„ä¸»èŠ‚ç‚¹# æ·»åŠ å¦‚ä¸‹é…ç½®# å¯ç”¨ Controller æ¨¡å¼ï¼ˆè‡ªåŠ¨ä¸»ä»åˆ‡æ¢æ¨¡å¼çš„æ€»å¼€å…³ï¼‰enableControllerMode = true# Controller é›†ç¾¤åœ°å€åˆ—è¡¨ï¼ˆå»ºè®®ä¸ Controller é›†ç¾¤ä¿æŒä¸€è‡´ï¼‰controllerAddr = 10.250.0.175:9877;10.250.0.188:9877;10.250.0.31:9877 RocketMQ 5 Broker Controller æ¨¡å¼é…ç½®å‚æ•°è¡¨ å‚æ•°å è¯´æ˜ é»˜è®¤å€¼ å¤‡æ³¨ / å»ºè®® enableControllerMode æ˜¯å¦å¯ç”¨ Controller æ¨¡å¼ï¼ˆè‡ªåŠ¨ä¸»ä»åˆ‡æ¢æ€»å¼€å…³ï¼‰ false å¿…é¡»è®¾ä¸º true æ‰èƒ½å¯ç”¨è‡ªåŠ¨ä¸»ä»åˆ‡æ¢ controllerAddr Controller é›†ç¾¤åœ°å€åˆ—è¡¨ï¼ˆä»¥åˆ†å·åˆ†éš”ï¼‰ æ—  æ‰€æœ‰ Broker é…ç½®åº”ä¸€è‡´ï¼Œä¾‹å¦‚ 10.250.0.175:9877;10.250.0.188:9877;10.250.0.31:9877 syncBrokerMetadataPeriod å‘ Controller åŒæ­¥ Broker å‰¯æœ¬ä¿¡æ¯çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰ 5000 (5s) ä¿æŒé»˜è®¤å³å¯ï¼›ç”¨äºä¸ŠæŠ¥å¿ƒè·³ä¸å…ƒæ•°æ® checkSyncStateSetPeriod æ£€æŸ¥åŒæ­¥çŠ¶æ€é›†ï¼ˆSyncStateSetï¼‰çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰ 5000 (5s) Controller ä¼šå®šæœŸå‰”é™¤è½åå‰¯æœ¬ syncControllerMetadataPeriod åŒæ­¥ Controller å…ƒæ•°æ®çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰ 10000 (10s) Broker å®šæœŸä»é›†ç¾¤è·å–å½“å‰æ´»è·ƒ Controller åœ°å€ haMaxTimeSlaveNotCatchup Slave æœªè·Ÿä¸Š Master çš„æœ€å¤§æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰ 15000 (15s) è¶…è¿‡è¯¥æ—¶é—´å°† Slave ç§»å‡º SyncStateSet storePathEpochFile Epoch æ–‡ä»¶å­˜å‚¨è·¯å¾„ store/epochFile éå¸¸é‡è¦ï¼ä¸è¦åˆ é™¤ï¼›å­˜å‚¨ä¸»ä»ä»»æœŸã€epoch ç­‰å…ƒä¿¡æ¯ allAckInSyncStateSet æ˜¯å¦è¦æ±‚æ‰€æœ‰åŒæ­¥å‰¯æœ¬éƒ½ ACK åæ‰è¿”å›æˆåŠŸ false true å¯ä¿è¯å¼ºä¸€è‡´ä½†æ€§èƒ½ä¸‹é™ï¼›å»ºè®®ä¿æŒé»˜è®¤ syncFromLastFile Slave æ˜¯å¦ä»æœ€åä¸€ä¸ªæ–‡ä»¶å¼€å§‹å¤åˆ¶ï¼ˆç©ºç›˜å¯åŠ¨æ—¶ï¼‰ false è‹¥å†å²æ—¥å¿—å¾ˆå¤§ä¸” Slave æ–°å»ºï¼Œå¯è®¾ä¸º true asyncLearner æ˜¯å¦ä¸ºå¼‚æ­¥ learner å‰¯æœ¬ï¼ˆä¸å‚ä¸é€‰ä¸»ï¼‰ false ç”¨äºè¿œç¨‹ç¾å¤‡å‰¯æœ¬ï¼Œä¸ä¼šè¢«é€‰ä¸¾ä¸º Master inSyncReplicas éœ€ä¿æŒåŒæ­¥çš„å‰¯æœ¬ç»„æ•°é‡ 1 è‹¥ allAckInSyncStateSet=trueï¼Œè¯¥å‚æ•°æ— æ•ˆ minInSyncReplicas æœ€å°åŒæ­¥å‰¯æœ¬æ•°é‡ï¼Œä½äºè¯¥å€¼åˆ™æ‹’ç»å†™å…¥ 1 é˜²æ­¢å†™å…¥è¿‡å¤šæœªåŒæ­¥å‰¯æœ¬å¯¼è‡´æ•°æ®ä¸¢å¤±é£é™© é‡æ–°å¯åŠ¨ Brokerï¼Œä¸ºä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§åœ¨é‡å¯æ—¶ä¸è¢«ç ´åï¼Œå¯åŠ¨é¡ºåºåº”ä¸ºå…ˆé‡æ–°åŸMasterï¼Œå†é‡å¯åŸSlave å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ£€æŸ¥æœºå™¨çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°é›†ç¾¤å†…éƒ¨è‡ªåŠ¨åˆ†é…äº†ä¸»ä» 12345678# ç¡®è®¤ Broker æ˜¯å¦å·²ç»æˆåŠŸæ³¨å†Œåˆ° Nameserverï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆåœ¨ä»»æ„ä¸€å°æœºå™¨ä¸Šï¼‰sh bin/mqadmin clusterList -n 10.250.0.175:9876## è¾“å‡ºç±»ä¼¼å¦‚ä¸‹#Cluster Name #Broker Name #BID #Addr #Version #InTPS(LOAD) #OutTPS(LOAD) #Timer(Progress) #PCWait(ms) #Hour #SPACE #ACTIVATEDDefaultCluster broker-a 0 10.250.0.188:10911 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 0-0(0.0w, 0.0, 0.0) 0 489268.48 0.2900 trueDefaultCluster broker-a 2 10.250.0.31:11011 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 2-0(0.0w, 0.0, 0.0) 0 489268.48 0.2700 falseDefaultCluster broker-b 0 10.250.0.31:10911 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 0-0(0.0w, 0.0, 0.0) 0 489268.48 0.2700 trueDefaultCluster broker-b 2 10.250.0.188:11011 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 3-0(0.0w, 0.0, 0.0) 0 489268.48 0.2900 false éªŒè¯ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢ï¼Œæ­¤æ—¶å…³é—­ broker-b çš„ Masterï¼Œå¹¶æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 123456sh bin/mqadmin clusterList -n 10.250.0.175:9876## è¾“å‡ºç±»ä¼¼å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°`broker-b`åŸæ¥çš„ Slave è¢«åˆ‡æ¢ä¸º Master#Cluster Name #Broker Name #BID #Addr #Version #InTPS(LOAD) #OutTPS(LOAD) #Timer(Progress) #PCWait(ms) #Hour #SPACE #ACTIVATEDDefaultCluster broker-a 0 10.250.0.188:10911 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 0-0(0.0w, 0.0, 0.0) 0 489268.58 0.2900 trueDefaultCluster broker-a 2 10.250.0.31:11011 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 1-0(0.0w, 0.0, 0.0) 0 489268.58 0.2700 falseDefaultCluster broker-b 0 10.250.0.188:11011 V5_3_2 0.00(0,0ms) 0.00(0,0ms|0,0ms) 0-0(0.0w, 0.0, 0.0) 0 489268.58 0.2900 true é‡æ–°å¯åŠ¨åˆšæ‰å…³é—­çš„ broker-b ï¼ŒèŠ‚ç‚¹ä¼šè‡ªåŠ¨åŠ å…¥é›†ç¾¤ï¼Œè§’è‰²ä¸º Slave åœæ­¢ Controller 12# åœæ­¢ PrControlleroxysh bin/mqshutdown controller ç«¯å£è¯´æ˜ ç«¯å£å· åè®® ç»„ä»¶/æœåŠ¡ ä½œç”¨è¯´æ˜ 9876 TCP NameServer RocketMQ é›†ç¾¤çš„ NameServer æœåŠ¡ç«¯å£ã€‚ç”¨äº Broker æ³¨å†Œã€å®¢æˆ·ç«¯è·¯ç”±å‘ç°ã€‚Producer/Consumer è¿æ¥æ­¤ç«¯å£ä»¥è·å– Broker åœ°å€ã€‚ 8080 TCP Proxy (gRPC / HTTP) RocketMQ 5 å¼•å…¥çš„ Proxy æœåŠ¡ é»˜è®¤ç«¯å£ä¹‹ä¸€ã€‚ç”¨äº HTTP/gRPC å®¢æˆ·ç«¯æ¥å…¥ï¼Œä¾‹å¦‚ RocketMQ Proxy REST APIã€å¼‚æ­¥æ¶ˆæ¯æ¥å£ç­‰ã€‚ 8081 TCP Proxy Admin / Dashboard / gRPC Alt é€šå¸¸æ˜¯ Proxy çš„ ç®¡ç†æ¥å£ æˆ– gRPC è¾…åŠ©ç«¯å£ï¼ˆä¾é…ç½®è€Œå®šï¼‰ã€‚ä¹Ÿå¯èƒ½æ˜¯æ§åˆ¶é¢æ¥å£ï¼Œç”¨äºä¸ Console æˆ–æ§åˆ¶å·¥å…·é€šä¿¡ã€‚ 10909 TCP Broker HA (High Availability) Broker ä¸»ä»åŒæ­¥ç«¯å£ï¼ˆMaster â†” Slave ä¹‹é—´çš„æ•°æ®å¤åˆ¶ï¼‰ã€‚ç”¨äºæ¶ˆæ¯æ•°æ®ä¸å…ƒæ•°æ®çš„åŒæ­¥ã€‚ 10911 TCP Broker æœåŠ¡ç«¯å£ Broker çš„ ä¸»é€šä¿¡ç«¯å£ï¼Œå®¢æˆ·ç«¯è¿æ¥å‘é€æ¶ˆæ¯ã€æ¶ˆè´¹æ¶ˆæ¯ã€å¿ƒè·³ç­‰ã€‚Producer å’Œ Consumer é€šè¿‡ NameServer è·å–è¯¥ç«¯å£åœ°å€åè¿›è¡Œé€šä¿¡ã€‚ 10912 TCP Broker HA å®¢æˆ·ç«¯ç«¯å£ Broker ä¸»ä»å¤åˆ¶ä¸­çš„ Slave è¿æ¥ Master æ—¶ä½¿ç”¨çš„ å®¢æˆ·ç«¯ç›‘å¬ç«¯å£ã€‚é€šå¸¸ä¸ 10909 é…åˆä½¿ç”¨ï¼Œä¸€ä¸»å¤šä»æ¨¡å¼ä¸­ Slave ä¸»åŠ¨è¿æ¥ Masterã€‚ æ—¥å¿—åŠæ•°æ®å­˜å‚¨è·¯å¾„ RocketMQ 5 ä¸»è¦æœ‰ä¸‰ç±»æœåŠ¡ç»„ä»¶éœ€è¦å…³æ³¨å®ƒä»¬çš„å­˜å‚¨ç›®å½• ç»„ä»¶ åŠŸèƒ½ é»˜è®¤å­˜å‚¨å†…å®¹ é»˜è®¤è·¯å¾„ï¼ˆLinux ç¯å¢ƒï¼‰ NameServer è·¯ç”±æœåŠ¡ï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰ å„ä¸ªç»„ä»¶çš„çš„æ³¨å†Œ æ—¥å¿—æ–‡ä»¶ï¼š~/logs/rocketmqlogs/namesrv.logæ—¥å¿—é…ç½®ï¼š$&#123;ROCKETMQ_HOME&#125;/conf/rmq.namesrv.logback.xml é…ç½®æ–‡ä»¶ï¼š$&#123;ROCKETMQ_HOME&#125;/conf/namesrv.confï¼ˆå¯é€‰ï¼‰ Broker æ ¸å¿ƒæ¶ˆæ¯å­˜å‚¨ä¸è½¬å‘æœåŠ¡ æ¶ˆæ¯æ•°æ®ï¼ˆCommitLogã€ConsumeQueueã€Indexã€Configï¼‰ç›®å½•ç»“æ„ï¼šâ”œâ”€â”€ commitlog/ â†’ æ¶ˆæ¯ç‰©ç†æ–‡ä»¶â”œâ”€â”€ consumequeue/ â†’ æ¶ˆè´¹é˜Ÿåˆ—ç´¢å¼•â”œâ”€â”€ index/ â†’ æ¶ˆæ¯ç´¢å¼•â”œâ”€â”€ config/ â†’ topicã€offsetã€subscription ä¿¡æ¯â”œâ”€â”€ checkpoint â†’ å­˜å‚¨æ ¡éªŒç‚¹â”œâ”€â”€ abort â†’ å¼‚å¸¸é€€å‡ºæ ‡å¿— æ•°æ®ç›®å½•ï¼š~/storeæ—¥å¿—æ–‡ä»¶ï¼š~/logs/rocketmqlogs/broker.logæ—¥å¿—é…ç½®ï¼š$&#123;ROCKETMQ_HOME&#125;/conf/rmq.broker.logback.xmlé…ç½®æ–‡ä»¶ï¼š$&#123;ROCKETMQ_HOME&#125;/conf/broker.conf Proxy å®¢æˆ·ç«¯è®¿é—®å…¥å£å±‚ï¼ˆæ— çŠ¶æ€ä»£ç†ï¼‰ï¼ˆ5.x æ–°å¼•å…¥ç»„ä»¶ï¼‰ è½¬å‘æ—¥å¿—ã€è®¿é—®æ—¥å¿— æ—¥å¿—é…ç½®ï¼š$&#123;ROCKETMQ_HOME&#125;/conf/rmq.proxy.logback.xmlæ—¥å¿—æ–‡ä»¶ï¼š~/logs/rocketmqlogs/proxy.logé…ç½®æ–‡ä»¶ï¼š$&#123;ROCKETMQ_HOME&#125;/conf/rmq-proxy.json Controller Broker ä¸»ä»åè°ƒä¸é«˜å¯ç”¨ç®¡ç†ï¼ˆ5.x æ–°å¼•å…¥ç»„ä»¶ï¼‰ - é›†ç¾¤ä¸»ä»å…ƒæ•°æ®ï¼ˆä¸»ä»å…³ç³»ã€brokeræ³¨å†Œä¿¡æ¯ï¼‰- Controller è‡ªèº«è¿è¡ŒçŠ¶æ€ä¸é€‰ä¸¾å…ƒæ•°æ® æ•°æ®ç›®å½•ï¼š~/store/controlleræ—¥å¿—æ–‡ä»¶ï¼š~/logs/rocketmqlogs/controller.logæ—¥å¿—é…ç½®ï¼š$&#123;ROCKETMQ_HOME&#125;/conf/rmq.controller.logback.xmlé…ç½®æ–‡ä»¶ï¼š$&#123;ROCKETMQ_HOME&#125;/conf/controller.conf NameServer å’Œ Proxy éƒ½æ˜¯æ— çŠ¶æ€ï¼ˆstatelessï¼‰ç»„ä»¶ï¼Œä¸ä¼šæŒä¹…åŒ–ä¸šåŠ¡æ•°æ®ã€‚ Broker æ•°æ®è·¯å¾„è¯´æ˜ é…ç½®é¡¹ é»˜è®¤è·¯å¾„ è¯´æ˜ ä¸»è¦ä½œç”¨ storePathRootDir /home/rocketmq/storeï¼ˆé»˜è®¤ï¼‰ æ¶ˆæ¯å­˜å‚¨çš„æ ¹ç›®å½• ä½œä¸ºæ‰€æœ‰å­˜å‚¨æ–‡ä»¶çš„çˆ¶çº§ç›®å½•ï¼Œå…¶ä»–è·¯å¾„è‹¥æœªå•ç‹¬é…ç½®ï¼Œåˆ™åœ¨æ­¤ç›®å½•ä¸‹åˆ›å»º storePathCommitLog $&#123;storePathRootDir&#125;/commitlog CommitLog æ–‡ä»¶å­˜æ”¾è·¯å¾„ å­˜å‚¨æ¶ˆæ¯ä¸»ä½“å†…å®¹ï¼Œæ˜¯æœ€æ ¸å¿ƒçš„æ•°æ®æ–‡ä»¶ï¼ˆé¡ºåºå†™å…¥ï¼‰ storePathConsumeQueue $&#123;storePathRootDir&#125;/consumequeue æ¶ˆè´¹é˜Ÿåˆ—æ–‡ä»¶å­˜æ”¾è·¯å¾„ å­˜å‚¨æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­çš„ç´¢å¼•ï¼ˆé€»è¾‘é˜Ÿåˆ—ï¼‰ï¼ŒæŒ‡å‘ CommitLog çš„ç‰©ç†ä½ç½® storePathIndex $&#123;storePathRootDir&#125;/index ç´¢å¼•æ–‡ä»¶å­˜æ”¾è·¯å¾„ æä¾›æŒ‰ Key æŸ¥è¯¢æ¶ˆæ¯çš„ç´¢å¼•ç»“æ„ï¼Œä¾¿äºé€šè¿‡ Message Key å¿«é€Ÿæ£€ç´¢æ¶ˆæ¯ storePathConfig $&#123;storePathRootDir&#125;/config Broker è¿è¡Œæ—¶é…ç½®å­˜å‚¨è·¯å¾„ å­˜å‚¨è¿è¡Œæ—¶ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ topicã€consumerOffsetã€subscriptionGroup ç­‰ storeCheckpoint $&#123;storePathRootDir&#125;/checkpoint Checkpoint æ–‡ä»¶è·¯å¾„ è®°å½• CommitLogã€ConsumeQueueã€Index ä¸‰è€…çš„åˆ·ç›˜è¿›åº¦ï¼Œç”¨äºå´©æºƒæ¢å¤ abortFile $&#123;storePathRootDir&#125;/abort å¼‚å¸¸é€€å‡ºæ ‡å¿—æ–‡ä»¶è·¯å¾„ ç”¨äºæ ‡è¯† Broker æ˜¯å¦å¼‚å¸¸é€€å‡ºï¼Œå¯åŠ¨æ—¶æ®æ­¤åˆ¤æ–­æ˜¯å¦æ‰§è¡Œæ¢å¤æµç¨‹ å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ 1.å¯åŠ¨ Proxy å¤±è´¥ æ— è®ºæ˜¯ Broker+Proxy å¯åŠ¨ï¼Œè¿˜æ˜¯ å•ç‹¬å¯åŠ¨ Proxyï¼Œéƒ½æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š 123456# é”™è¯¯ä¼šåœ¨ nohup.out ä¸­è¾“å‡ºException in thread &quot;main&quot; java.lang.UnsatisfiedLinkError: failed to load the required native libraryCaused by: java.lang.IllegalArgumentException: Failed to load any of the given libraries: [netty_tcnative_linux_x86_64_fedora, netty_tcnative_linux_x86_64, netty_tcnative_x86_64, netty_tcnative]Suppressed: java.lang.UnsatisfiedLinkError: /tmp/libnetty_tcnative_linux_x86_642308675901892111861.so: libcrypt.so.1: cannot open shared object file: No such file or directory åŸå› åˆ†æ Netty-tcnative çš„ç¼–è¯‘ä¾èµ–ï¼šRocketMQ ä½¿ç”¨çš„ Netty çš„ tcnative æ¨¡å—æ˜¯åœ¨è¾ƒæ—§çš„ç¯å¢ƒä¸­ç¼–è¯‘çš„ï¼Œè€ŒåŠ¨æ€é“¾æ¥çš„ç‰ˆæœ¬é”å®šï¼šç¼–è¯‘æ—¶é“¾æ¥çš„æ˜¯ libcrypt.so.1ï¼Œè¿è¡Œæ—¶å¿…é¡»æ‰¾åˆ°ç›¸åŒä¸»ç‰ˆæœ¬å·çš„åº“ è€Œæˆ‘å½“å‰ä½¿ç”¨çš„ç³»ç»Ÿä¸º Amazon Linux 2023ï¼ŒåŸºäºæ›´æ–°çš„ glibcï¼Œå…¶åŠ å¯†åŠŸèƒ½å·²ç»è¿ç§»åˆ° libcrypt.so.2ã€‚ï¼ˆAmazon Linux 2ï¼šåŸºäºè¾ƒæ—§çš„ glibc ç‰ˆæœ¬ï¼Œlibcrypt.so.1 æ˜¯ä¸»è¦çš„åŠ å¯†åº“ï¼‰ 12345678# æ£€æŸ¥ libcrypt æ˜¯å¦å­˜åœ¨$ ldconfig -p | grep libcrypt## è¾“å‡º libcryptsetup.so.12 (libc6,x86-64) =&gt; /lib64/libcryptsetup.so.12 libcrypto.so.3 (libc6,x86-64) =&gt; /lib64/libcrypto.so.3 libcrypto.so (libc6,x86-64) =&gt; /lib64/libcrypto.so libcrypt.so.2 (libc6,x86-64) =&gt; /lib64/libcrypt.so.2 libcrypt.so (libc6,x86-64) =&gt; /lib64/libcrypt.so è§£å†³åŠæ³• 1234567891011# å®‰è£…å…¼å®¹æ€§åŒ…sudo yum install libxcrypt-compat# æ£€æŸ¥ libcrypt æ˜¯å¦å­˜åœ¨$ ldconfig -p | grep libcrypt## è¾“å‡º libcryptsetup.so.12 (libc6,x86-64) =&gt; /lib64/libcryptsetup.so.12 libcrypto.so.3 (libc6,x86-64) =&gt; /lib64/libcrypto.so.3 libcrypto.so (libc6,x86-64) =&gt; /lib64/libcrypto.so libcrypt.so.2 (libc6,x86-64) =&gt; /lib64/libcrypt.so.2 libcrypt.so.1 (libc6,x86-64) =&gt; /lib64/libcrypt.so.1 libcrypt.so (libc6,x86-64) =&gt; /lib64/libcrypt.so 2.å†™å…¥æ¶ˆæ¯å¤±è´¥ï¼Œå¹¶æŠ¥å¦‚ä¸‹é”™è¯¯ 1Caused by: org.apache.rocketmq.client.exception.MQBrokerException: CODE: 14 DESC: service not available now. It may be caused by one of the following reasons: the broker&#x27;s disk is full [CL: 0.95 CQ: 0.95 INDEX: -1.00], messages are put to the slave, message store has been shut down, etc. BROKER: 10.250.0.175:10911 é”™è¯¯åŸå›  RocketMQ è¿”å›çš„ CODE: 14 è¡¨ç¤ºï¼šBroker å½“å‰ ä¸æ¥å—æ¶ˆæ¯å†™å…¥ï¼ˆæœåŠ¡æš‚ä¸å¯ç”¨ï¼‰ã€‚ the brokerâ€™s disk is full [CL: 0.95 CQ: 0.95 INDEX: -1.00]: Broker çš„ç£ç›˜å·²æ»¡ 123CL: 0.95 â†’ CommitLog 95% å·²ä½¿ç”¨CQ: 0.95 â†’ ConsumeQueue 95% å·²ä½¿ç”¨INDEX: -1.00 â†’ ç´¢å¼•å¼‚å¸¸æˆ–æœªé‡‡é›† é…ç½®é¡¹ å«ä¹‰ é»˜è®¤å€¼ diskMaxUsedSpaceRatio Broker ç£ç›˜æœ€å¤§å¯ç”¨æ¯”ä¾‹ï¼ˆè¶…è¿‡åç¦æ­¢å†™å…¥ï¼‰ 75% storePathCommitLog æ¶ˆæ¯å­˜å‚¨è·¯å¾„ï¼ˆCommitLogï¼‰ ~/store/commitlog storePathConsumeQueue æ¶ˆè´¹é˜Ÿåˆ—è·¯å¾„ï¼ˆConsumeQueueï¼‰ ~/store/consumequeue storePathIndex ç´¢å¼•è·¯å¾„ ~/store/index æ€»ç»“ï¼šå¯ä»¥ç¡®è®¤æ˜¯ ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜ å¯¼è‡´ Broker è‡ªåŠ¨è¿›å…¥ â€œå†™ä¿æŠ¤â€ æ¨¡å¼ã€‚ è§£å†³æ–¹æ³• æ¸…ç†ç£ç›˜ï¼šç¡®è®¤ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜ï¼Œå¹¶æ¸…ç†ç£ç›˜ç©ºé—´ï¼Œæ—¢é™ä½ç£ç›˜ä½¿ç”¨ç‡ ç£ç›˜æ‰©å®¹ï¼šå¦‚æœæ¸…ç†ç£ç›˜ç©ºé—´åï¼Œç£ç›˜ä½¿ç”¨ç‡ä¾ç„¶è¿‡é«˜ï¼Œåˆ™éœ€è¦æ‰©å®¹ç£ç›˜ é…ç½®è°ƒæ•´ï¼šè°ƒæ•´ Broker é…ç½®(broker.conf)ï¼Œå°† diskMaxUsedSpaceRatio é…ç½®é€‚å½“æé«˜ï¼Œå¦‚ 96%(diskMaxUsedSpaceRatio=96)ï¼Œè°ƒæ•´åé‡å¯ Brokerã€‚ä»…å»ºè®®åœ¨ç´§æ€¥æƒ…å†µä¸‹ä¸´æ—¶è§£å†³ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RocketMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ RocketMQå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RocketMQ ç‰ˆæœ¬ä¸º 5.3.2ã€‚","date_published":"2025-10-23T13:30:05.000Z","tags":["æŠ€æœ¯","rocketmq","åˆ†å¸ƒå¼","rocketmq"]},{"id":"https://blog.hanqunfeng.com/2025/10/16/kafka-06-zk-to-kraft/","url":"https://blog.hanqunfeng.com/2025/10/16/kafka-06-zk-to-kraft/","title":"Kafka ä» Zookeeper è¿ç§»åˆ° KRaft","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» å¦‚ä½•å°† Kafka é›†ç¾¤ä» Zookeeper æ¨¡å¼è¿ç§»åˆ° KRaft æ¨¡å¼</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org/39/documentation.html#kraft_zk_migration\">å®˜æ–¹æ–‡æ¡£ï¼šZooKeeperåˆ°KRaftè¿ç§»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ä»-Zookeeper-æ¨¡å¼è¿ç§»åˆ°-KRaft-æ¨¡å¼ï¼ˆå¹³æ»‘è¿ç§»ï¼‰\">ä» Zookeeper æ¨¡å¼è¿ç§»åˆ° KRaft æ¨¡å¼ï¼ˆå¹³æ»‘è¿ç§»ï¼‰</h2>\n<p><em><strong>ï¼ï¼ï¼è¿ç§»åå°†æ— æ³•å†æ¢å¤åˆ° ZooKeeper æ¨¡å¼ï¼ï¼ï¼</strong></em></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kafka å®˜æ–¹åœ¨ 3.4+ å¼•å…¥äº†å®Œæ•´çš„ Zookeeper â†’ KRaft å¹³æ»‘è¿ç§»æœºåˆ¶ï¼Œç§°ä¸º <code>ZK to KRaft (ZkMigration)</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿ç§»èƒŒæ™¯ä¸å‰æ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">é¡¹ç›®</th>\n<th style=\"text-align:left\">è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">æ”¯æŒç‰ˆæœ¬</td>\n<td style=\"text-align:left\">Kafka <strong>3.4.0+</strong>ï¼ˆå»ºè®®è‡³å°‘ä½¿ç”¨ <strong>3.6.x ï¼Œç›®å‰æœ€æ–°ç‰ˆä¸º 3.9.x</strong>ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">è¿ç§»ç›®çš„</td>\n<td style=\"text-align:left\">æ‘†è„± ZooKeeperï¼Œå®Œå…¨åˆ‡æ¢ä¸º KRaft è‡ªç®¡ç†æ¨¡å¼</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">è¿ç§»æ¨¡å¼</td>\n<td style=\"text-align:left\"><strong>åœ¨çº¿è¿ç§»</strong>ï¼ˆæ— åœæœºæˆ–æœ€å°åœæœºï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æœ€ç»ˆç›®æ ‡</td>\n<td style=\"text-align:left\">Kafka çš„æ§åˆ¶å™¨ä¸å…ƒæ•°æ®å®Œå…¨ç”± KRaft ç®¡ç†ï¼Œä¸å†ä¾èµ– ZooKeeperã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ•´ä½“è¿ç§»æµç¨‹æ¦‚è§ˆ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é˜¶æ®µ</th>\n<th>æ§åˆ¶å™¨ç±»å‹</th>\n<th>Broker æ¨¡å¼</th>\n<th>ZooKeeper è§’è‰²</th>\n<th>KRaft è§’è‰²</th>\n<th>ç‰¹å¾è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>åˆå§‹é˜¶æ®µ</strong></td>\n<td>ZooKeeper æ§åˆ¶å™¨</td>\n<td>å…¨éƒ¨ä¸º ZK æ¨¡å¼</td>\n<td>ç®¡ç†æ‰€æœ‰å…ƒæ•°æ®</td>\n<td>å°šæœªå¯ç”¨</td>\n<td>æ‰€æœ‰ Broker éƒ½è¿è¡Œåœ¨ ZK æ¨¡å¼ä¸‹ï¼Œç”± ZK æ§åˆ¶å™¨ç®¡ç†é›†ç¾¤ã€‚</td>\n</tr>\n<tr>\n<td><strong>åˆå§‹å…ƒæ•°æ®åŠ è½½é˜¶æ®µ</strong></td>\n<td>KRaft æ§åˆ¶å™¨å¼€å§‹åŠ è½½</td>\n<td>éƒ¨åˆ†ï¼ˆæˆ–å…¨éƒ¨ï¼‰ä»ä¸º ZK æ¨¡å¼</td>\n<td>æä¾›å…ƒæ•°æ®æº</td>\n<td>ä» ZK åŠ è½½å…ƒæ•°æ®</td>\n<td>KRaft æ³•å®šèŠ‚ç‚¹ï¼ˆcontroller.quorum.votersï¼‰ä» ZK ä¸­è¯»å–å¹¶åŒæ­¥å½“å‰é›†ç¾¤å…ƒæ•°æ®ã€‚</td>\n</tr>\n<tr>\n<td><strong>æ··åˆé˜¶æ®µ</strong></td>\n<td>KRaft æ§åˆ¶å™¨</td>\n<td>éƒ¨åˆ† ZK æ¨¡å¼ï¼Œéƒ¨åˆ† KRaft æ¨¡å¼</td>\n<td>ä¿ç•™åªè¯»å…ƒæ•°æ®</td>\n<td>ç®¡ç†å¹¶æ›´æ–°å…ƒæ•°æ®</td>\n<td>KRaft æ§åˆ¶å™¨æˆä¸ºä¸»æ§ï¼ŒZK ä»å­˜åœ¨ä½†åªæä¾›è¯»å–ï¼ŒBroker å¯å¤„äºä¸åŒæ¨¡å¼ï¼ˆæ··åˆçŠ¶æ€ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>åŒå†™é˜¶æ®µ</strong></td>\n<td>KRaft æ§åˆ¶å™¨</td>\n<td>å…¨éƒ¨ä¸º KRaft æ¨¡å¼</td>\n<td>æ¥æ”¶ KRaft åŒæ­¥å†™å…¥</td>\n<td>ç®¡ç†å…ƒæ•°æ®å¹¶å†™å…¥ ZK</td>\n<td>æ‰€æœ‰ Broker éƒ½è¿è¡Œåœ¨ KRaft æ¨¡å¼ï¼Œæ§åˆ¶å™¨å°†å…ƒæ•°æ®åŒæ—¶å†™å…¥ ZK å’Œ KRaft æ—¥å¿—ã€‚</td>\n</tr>\n<tr>\n<td><strong>è¿ç§»å®Œæˆé˜¶æ®µ</strong></td>\n<td>KRaft æ§åˆ¶å™¨</td>\n<td>å…¨éƒ¨ä¸º KRaft æ¨¡å¼</td>\n<td>ä¸å†ä½¿ç”¨</td>\n<td>ç‹¬ç«‹è¿è¡Œ</td>\n<td>åœæ­¢å‘ ZK å†™å…¥å…ƒæ•°æ®ï¼ŒZK å¯å®‰å…¨å…³é—­ï¼ŒKafka å®Œå…¨è¿è¡Œåœ¨æ—  Zookeeper çš„ KRaft æ¨¡å¼ä¸‹ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å¼€å§‹è¿ç§»\">å¼€å§‹è¿ç§»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä»¥å‰æ–‡ <a href=\"/2025/10/13/kafka-01-install-zookeeper/\" title=\"Kafka çš„å®‰è£…ï¼šåŸºäº Zookeeper\">Kafka çš„å®‰è£…ï¼šåŸºäº Zookeeper</a> ä¸­çš„3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸ºä¾‹ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å¯åŠ¨ä¸€ä¸ª-Controller-èŠ‚ç‚¹\">å¯åŠ¨ä¸€ä¸ª Controller èŠ‚ç‚¹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨ä¸€ä¸ª Controller èŠ‚ç‚¹ï¼Œè¿™é‡Œä¸º worker1</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯åŠ¨å‰éœ€è¦å…ˆè·å–å½“å‰ Kafka é›†ç¾¤çš„ Cluster ID</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ zookeeper-shell.sh localhost:2181 get /cluster/id</span><br><span class=\"line\">Connecting to localhost:2181</span><br><span class=\"line\"></span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:SyncConnected <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\">&#123;<span class=\"string\">&quot;version&quot;</span>:<span class=\"string\">&quot;1&quot;</span>,<span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;hp_Q0pihQ0ORcIvXlfHobQ&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡†å¤‡å¥½ Controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œå¯ä»¥ç”¨ <code>config/kraft/controller.properties</code> ä¸ºæ¨¡æ¿è¿›è¡Œä¿®æ”¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ï¼Œè¿™é‡Œåªèƒ½æ˜¯controller</span></span><br><span class=\"line\">process.roles=controller</span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹IDï¼Œä¸èƒ½ä¸ç°æœ‰BrokerèŠ‚ç‚¹çš„IDä¸€è‡´</span></span><br><span class=\"line\">node.id=3000</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å½“å‰åªå¯åŠ¨äº†ä¸€ä¸ªcontrollerèŠ‚ç‚¹ï¼Œæ‰€ä»¥åªèƒ½é…ç½®ä¸€ä¸ªæŠ•ç¥¨èŠ‚ç‚¹</span></span><br><span class=\"line\">controller.quorum.bootstrap.servers=worker1:9098</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç›‘å¬å™¨ï¼Œæ³¨æ„ç«¯å£ä¸èƒ½é‡å¤</span></span><br><span class=\"line\">listeners=CONTROLLER://:9098</span><br><span class=\"line\">advertised.listeners=CONTROLLER://worker1:9098</span><br><span class=\"line\">controller.listener.names=CONTROLLER</span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜æ”¾ç›®å½•ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯å…ƒæ•°æ®ï¼Œåœ¨æ ¼å¼åŒ–æ—¶è¿™ä¸ªç›®å½•å¿…é¡»ä¸ºç©ºç›®å½•</span></span><br><span class=\"line\">log.dirs=/usr/local/kafka/dataDir/kraft-meta</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹</span></span><br><span class=\"line\">zookeeper.metadata.migration.enable=<span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ZooKeeper client è¿æ¥</span></span><br><span class=\"line\">zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š Kafka é›†ç¾¤å†…éƒ¨ï¼ˆbroker ä¸ brokerã€KRaft æ§åˆ¶å™¨ä¸ brokerï¼‰é€šä¿¡æ‰€ä½¿ç”¨çš„ç›‘å¬å™¨ï¼ˆlistenerï¼‰åç§°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œè¦ä¸åŸå…ˆçš„ server.properties ä¸­é…ç½®çš„ç›‘å¬å™¨åç§°ä¸€è‡´</span></span><br><span class=\"line\">inter.broker.listener.name=PLAINTEXT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…¶å®ƒå‚æ•°å°½é‡ä¿æŒä¸æ—§é›†ç¾¤çš„é…ç½®ä¸€è‡´</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ Controller èŠ‚ç‚¹</p>\n</li>\n</ul>\n<blockquote>\n<p>åƒä¸‡ä¸è¦åœ¨å·²æœ‰ broker çš„æ•°æ®ç›®å½•ï¼ˆåŒ…å«æ¶ˆæ¯æ•°æ®çš„ log.dirsï¼‰ä¸Šè¿è¡Œ <a href=\"http://kafka-storage.sh\">kafka-storage.sh</a> format ï¼Œé‚£ä¼šæŠŠåŸæœ‰æ•°æ®ç»“æ„é‡ç½®æˆ–è¸©åã€‚<br>\nå¿…é¡»æ˜ç¡®ï¼šæ ¼å¼åŒ–åªé’ˆå¯¹ æ–° controller çš„ metadata ç›®å½•ï¼ˆä¸”è¯¥ç›®å½•å¿…é¡»ä¸ºç©ºï¼‰ã€‚</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ ¼å¼åŒ–å…ƒæ•°æ®ç›®å½•ï¼Œlog.dirs å‚æ•°æŒ‡å®šå…ƒæ•°æ®å­˜æ”¾ç›®å½•ï¼Œé¦–æ¬¡è¿è¡Œå‰å¿…é¡»ä¸ºç©ºç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\"># -t å‚æ•°æŒ‡å®šé›†ç¾¤çš„ Cluster IDï¼Œå°±æ˜¯å‰é¢è·å–çš„ Cluster ID</span></span><br><span class=\"line\">kafka-storage.sh format --standalone -t hp_Q0pihQ0ORcIvXlfHobQ -c /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ï¼Œè¿™é‡Œæ²¡æœ‰åå°å¯åŠ¨æ˜¯ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿæ—¥å¿—è¾“å‡º</span></span><br><span class=\"line\">kafka-server-start.sh /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>æ¨¡å¼</th>\n<th>format å‘½ä»¤</th>\n<th>quorum çŠ¶æ€</th>\n<th>æ˜¯å¦ä» ZK åŠ è½½</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>è¿ç§»é˜¶æ®µï¼ˆstandaloneï¼‰</td>\n<td><code>--standalone</code></td>\n<td>æ— ï¼ˆå•èŠ‚ç‚¹ï¼‰</td>\n<td>âœ… æ˜¯</td>\n</tr>\n<tr>\n<td>æ­£å¼ KRaft æ¨¡å¼</td>\n<td>æ—  <code>--standalone</code></td>\n<td>âœ… å¤šèŠ‚ç‚¹</td>\n<td>âŒ å¦ï¼ˆç‹¬ç«‹è¿è¡Œï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å°†åŸå…ˆçš„ä¸‰ä¸ªèŠ‚ç‚¹ä½œä¸º-Broker-èŠ‚ç‚¹é‡æ–°å¯åŠ¨\">å°†åŸå…ˆçš„ä¸‰ä¸ªèŠ‚ç‚¹ä½œä¸º Broker èŠ‚ç‚¹é‡æ–°å¯åŠ¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹åŸå…ˆçš„é…ç½®æ–‡ä»¶ <code>server.properties</code>ï¼Œåªéœ€è¦ä¿®æ”¹å¦‚ä¸‹å†…å®¹å³å¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨æœ€ååŠ å…¥ CONTROLLER:PLAINTEXT</span></span><br><span class=\"line\">listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL,CONTROLLER:PLAINTEXT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ä»¥ä¸‹æ˜¯æ–°åŠ å…¥çš„ é…ç½®é¡¹</span></span><br><span class=\"line\"><span class=\"comment\"># Set the IBPï¼Œå½“å‰ kafka ç‰ˆæœ¬æ˜¯ 3.9.1ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸º 3.9</span></span><br><span class=\"line\">inter.broker.protocol.version=3.9</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹</span></span><br><span class=\"line\">zookeeper.metadata.migration.enable=<span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># KRaft controller quorum configurationï¼Œå› ä¸ºç›®å‰åªå¯åŠ¨äº†ä¸€ä¸ª controller èŠ‚ç‚¹ï¼Œæ‰€ä»¥åªèƒ½é…ç½®ä¸€ä¸ªæŠ•ç¥¨èŠ‚ç‚¹</span></span><br><span class=\"line\">controller.quorum.bootstrap.servers=worker1:9098</span><br><span class=\"line\"><span class=\"comment\"># æ§åˆ¶å™¨ç›‘å¬å™¨åç§°ï¼Œè¦ä¸ contreller èŠ‚ç‚¹é…ç½®æ–‡ä»¶ controller.properties ä¸­çš„é…ç½®ä¸€è‡´</span></span><br><span class=\"line\">controller.listener.names=CONTROLLER</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«é‡æ–°å¯åŠ¨ä¸‰ä¸ªèŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­ kafka</span></span><br><span class=\"line\">kafka-server-stop.sh</span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè¦æ³¨æ„ worker1 ä¸Šä¸è¦ä½¿ç”¨ kafka-server-stop.sh è¿›è¡Œå…³é—­ï¼Œå› ä¸º worker1 ä¸Šçš„ controller èŠ‚ç‚¹ ä¹Ÿåœ¨è¿è¡Œï¼Œä¼šæœ‰ä¸¤ä¸ª kafka è¿›ç¨‹è¿è¡Œï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå…³é—­ï¼›å› ä¸º controller èŠ‚ç‚¹ å¯åŠ¨ä½¿ç”¨çš„æ˜¯ controller.properties</span></span><br><span class=\"line\">ps -ef | grep kafka | grep  <span class=\"string\">&quot;server\\.properties&quot;</span> | grep -v grep | awk <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class=\"built_in\">kill</span> -9</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°å¯åŠ¨ kafka</span></span><br><span class=\"line\">kafka-server-start.sh /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“ä¸‰ä¸ªèŠ‚ç‚¹éƒ½ä»¥å¿…è¦çš„é…ç½®é‡æ–°å¯åŠ¨åï¼Œè¿ç§»å°†è‡ªåŠ¨å¼€å§‹ã€‚è¿ç§»å®Œæˆåï¼Œå¯ä»¥åœ¨ Controller(worker1)èŠ‚ç‚¹ ä¸Šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹æ—¥å¿—ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># âœ… æ„å‘³ï¼šä» ZooKeeper åˆ° KRaft çš„åˆå§‹å…ƒæ•°æ®è¿ç§»å·²æˆåŠŸï¼Œå…±å†™å…¥ 62 æ¡è®°å½•ï¼Œå½“å‰ KRaft metadata offset ä¸º 3179ã€‚è¿™æ˜¯è¿ç§»æˆåŠŸçš„æ˜ç¡®è¯æ®ã€‚</span></span><br><span class=\"line\">Completed migration of metadata from ZooKeeper to KRaft. 62 records were generated <span class=\"keyword\">in</span> 300 ms across 1 batches. The average time spent waiting on a batch was 97.00 ms. The record types were &#123;TOPIC_RECORD=3, PARTITION_RECORD=56, CONFIG_RECORD=3&#125;. The current metadata offset is now 3179 with an epoch of 2. Saw 3 brokers <span class=\"keyword\">in</span> the migrated metadata [1, 2, 3]. (org.apache.kafka.metadata.migration.KRaftMigrationDriver)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># âœ… æ„å‘³ï¼šæ§åˆ¶å™¨å·²åŠ è½½å¹¶ç”Ÿæ•ˆæ–°å…ƒæ•°æ®ä¸ feature setï¼ˆä¸ offset 3179 å¯¹åº”ï¼‰ã€‚</span></span><br><span class=\"line\">Loaded new metadata Features(metadataVersion=3.9-IV0, finalizedFeatures=&#123;metadata.version=21&#125;, finalizedFeaturesEpoch=3179). (org.apache.kafka.metadata.publisher.FeaturesPublisher)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># âœ… æ„å‘³ï¼šå†…éƒ¨è¿ç§»çŠ¶æ€å·²æ›´æ–°ï¼ŒKRaft ä¸Šæœ‰äº†å†™å…¥ä½ç½®è®°å½•ã€‚</span></span><br><span class=\"line\">Finished initial migration of ZK metadata to KRaft <span class=\"keyword\">in</span> 3486479 ns. Transitioned migration state from ZkMigrationLeadershipState&#123;kraftControllerId=3000, kraftControllerEpoch=2, kraftMetadataOffset=-1, kraftMetadataEpoch=-1, lastUpdatedTimeMs=1760682050169, migrationZkVersion=1, controllerZkEpoch=3, controllerZkVersion=3&#125; to ZkMigrationLeadershipState&#123;kraftControllerId=3000, kraftControllerEpoch=2, kraftMetadataOffset=3179, kraftMetadataEpoch=2, lastUpdatedTimeMs=1760682050169, migrationZkVersion=2, controllerZkEpoch=3, controllerZkVersion=3&#125; (org.apache.kafka.metadata.migration.KRaftMigrationDriver)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># âœ… æ„å‘³ï¼šè¿ç§»æµç¨‹æŒ‰é¢„æœŸæ¨è¿›ï¼šå…ˆæŠŠ KRaft çš„å…ƒæ•°æ®ä¸ ZK å¯¹é½ï¼ˆsyncï¼‰ï¼Œç„¶åä¸ brokers å»ºç«‹é€šä¿¡ï¼Œæœ€ç»ˆè¿›å…¥ DUAL_WRITEï¼ˆåŒå†™ï¼‰ã€‚DUAL_WRITE é˜¶æ®µè¡¨ç¤ºæ§åˆ¶å™¨åœ¨å†™å…¥ KRaft metadata log çš„åŒæ—¶ï¼Œä»ç„¶ä¼šæŠŠå¿…è¦çš„å†™æ“ä½œä¹Ÿå†™å› ZooKeeperï¼ˆåŒå†™ï¼‰â€”â€”ç›´åˆ°è¿ç§»å®Œå…¨å®Œæˆå¹¶ç¡®è®¤å¯ä»¥åœæ­¢å†™ ZK ä¸ºæ­¢ã€‚</span></span><br><span class=\"line\">3000 transitioning from ZK_MIGRATION to SYNC_KRAFT_TO_ZK state</span><br><span class=\"line\">...</span><br><span class=\"line\">Performing a full metadata <span class=\"built_in\">sync</span> from KRaft to ZK.</span><br><span class=\"line\">Did not make any ZK writes when reconciling with KRaft state.</span><br><span class=\"line\">3000 transitioning ... to KRAFT_CONTROLLER_TO_BROKER_COMM</span><br><span class=\"line\">...</span><br><span class=\"line\">Sending RPCs to broker before moving to dual-write mode using at offset and epoch OffsetAndEpoch(offset=3179, epoch=2)</span><br><span class=\"line\">...</span><br><span class=\"line\">3000 transitioning ... to DUAL_WRITE state</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çš„æ—¥å¿—æ€»ä½“ä¸Šè¡¨æ˜ï¼Œå…ƒæ•°æ®è¿ç§»å·²æˆåŠŸå®Œæˆå¹¶ä¸”æ§åˆ¶å™¨è¿›å…¥äº†åŒå†™ï¼ˆDUAL_WRITEï¼‰é˜¶æ®µã€‚</p>\n</li>\n</ul>\n<h3 id=\"å°†ä¸‰ä¸ªBrokerèŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º-KRaft-æ¨¡å¼çš„-broker-èŠ‚ç‚¹\">å°†ä¸‰ä¸ªBrokerèŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º KRaft æ¨¡å¼çš„ broker èŠ‚ç‚¹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹ä¸‰ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ <code>server.properties</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ process.roles=broker</span></span><br><span class=\"line\">process.roles=broker</span><br><span class=\"line\"><span class=\"comment\"># ç”¨ node.id æ›¿æ¢ broker.idï¼Œæ³¨æ„ï¼Œnode.id éœ€è¦ä¸ broker.id ä¸€è‡´</span></span><br><span class=\"line\"><span class=\"comment\"># broker.id=1</span></span><br><span class=\"line\">node.id=1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å»æ‰ zookeeper ç›¸å…³é…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># Don&#x27;t set the IBP, KRaft uses &quot;metadata.version&quot; feature flag</span></span><br><span class=\"line\"><span class=\"comment\"># inter.broker.protocol.version=3.9</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Remove the migration enabled flag</span></span><br><span class=\"line\"><span class=\"comment\"># zookeeper.metadata.migration.enable=true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Remove ZooKeeper client configuration</span></span><br><span class=\"line\"><span class=\"comment\"># zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«é‡æ–°å¯åŠ¨ä¸‰ä¸ªèŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­ kafka</span></span><br><span class=\"line\">kafka-server-stop.sh</span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè¦æ³¨æ„ worker1 ä¸Šä¸è¦ä½¿ç”¨ kafka-server-stop.sh è¿›è¡Œå…³é—­ï¼Œå› ä¸º worker1 ä¸Šçš„ controller èŠ‚ç‚¹ ä¹Ÿåœ¨è¿è¡Œï¼Œä¼šæœ‰ä¸¤ä¸ª kafka è¿›ç¨‹è¿è¡Œï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå…³é—­ï¼›å› ä¸º controller èŠ‚ç‚¹ å¯åŠ¨ä½¿ç”¨çš„æ˜¯ controller.properties</span></span><br><span class=\"line\">ps -ef | grep kafka | grep  <span class=\"string\">&quot;server\\.properties&quot;</span> | grep -v grep | awk <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class=\"built_in\">kill</span> -9</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°å¯åŠ¨ kafka</span></span><br><span class=\"line\">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure>\n<h3 id=\"å°†-Controller-èŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º-KRaft-æ¨¡å¼çš„-controller-èŠ‚ç‚¹\">å°† Controller èŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º KRaft æ¨¡å¼çš„ controller èŠ‚ç‚¹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹ controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ <code>controller.properties</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## å»æ‰å»ä¸‹å†…å®¹</span></span><br><span class=\"line\"><span class=\"comment\"># æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹</span></span><br><span class=\"line\"><span class=\"comment\"># zookeeper.metadata.migration.enable=true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ZooKeeper client è¿æ¥</span></span><br><span class=\"line\"><span class=\"comment\"># zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡å¯å¯åŠ¨ controller èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­åé‡æ–°å¯åŠ¨</span></span><br><span class=\"line\">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶ä½ å¯ä»¥å…³é—­ zookeeper é›†ç¾¤äº†ï¼Œæ–°çš„ kafka é›†ç¾¤å°†ä¸å†ä½¿ç”¨ ZooKeeperï¼Œä¹Ÿæ— æ³•åœ¨æ¢å¤åˆ° ZooKeeper æ¨¡å¼ã€‚</p>\n</li>\n</ul>\n<h3 id=\"åŠ å…¥æ–°çš„-Controller-èŠ‚ç‚¹\">åŠ å…¥æ–°çš„ Controller èŠ‚ç‚¹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Controller å°½é‡ä¿æŒ å¥‡æ•°ä¸ªèŠ‚ç‚¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¹‹å‰å·²ç»åœ¨ <code>worker1</code> èŠ‚ç‚¹ä¸Šå¯åŠ¨äº† controller ï¼Œç°åœ¨ <code>worker2</code> å’Œ <code>worker3</code> ä¸Šä¹Ÿæ¥å¯åŠ¨ controller èŠ‚ç‚¹ï¼Œå¹¶å°†å®ƒä»¬åŠ å…¥åˆ° kafka é›†ç¾¤ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨å¼€å§‹é…ç½®å‰ï¼Œå…ˆå°†ä¸Šé¢çš„ controller èŠ‚ç‚¹ å’Œ ä¸‰ä¸ª broker èŠ‚ç‚¹ çš„å¦‚ä¸‹é…ç½®è¿›è¡Œä¿®æ”¹ï¼Œå¹¶é‡å¯å¯åŠ¨ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°† controller.quorum.bootstrap.servers æ›¿æ¢ä¸º controller.quorum.voters</span></span><br><span class=\"line\">controller.quorum.voters=3000@worker1:9098,3001@worker2:9098,3002@worker3:9098</span><br><span class=\"line\"><span class=\"comment\"># controller.quorum.bootstrap.servers=worker1:9098</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># controller.quorum.voters = è°æ˜¯æ­£å¼æŠ•ç¥¨æˆå‘˜ï¼ˆå›ºå®šé…ç½®ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># controller.quorum.bootstrap.servers = ä¸´æ—¶æ‰¾è°å¼•å¯¼è¿æ¥ï¼ˆè¿ç§»æˆ–åˆå§‹åŒ–ç”¨ï¼‰</span></span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>ä½œç”¨</th>\n<th>é€‚ç”¨é˜¶æ®µ</th>\n<th>æ˜¯å¦å¿…éœ€</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><code>controller.quorum.voters</code></strong></td>\n<td>å®šä¹‰ <strong>æ­£å¼çš„ KRaft æ§åˆ¶å™¨æŠ•ç¥¨æˆå‘˜åˆ—è¡¨ï¼ˆvoter setï¼‰</strong></td>\n<td>é›†ç¾¤æ­£å¸¸è¿è¡Œæ—¶</td>\n<td>âœ… æ˜¯</td>\n<td>æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»é…ç½®ç›¸åŒçš„å€¼</td>\n</tr>\n<tr>\n<td><strong><code>controller.quorum.bootstrap.servers</code></strong></td>\n<td>å®šä¹‰ <strong>è¿ç§»é˜¶æ®µæˆ–åˆå§‹åŒ–é˜¶æ®µçš„æ§åˆ¶å™¨è¿æ¥åœ°å€ï¼ˆbootstrap controller endpointï¼‰</strong></td>\n<td><strong>ZK â†’ KRaft è¿ç§»é˜¶æ®µ</strong> æˆ– <strong>KRaft é›†ç¾¤åˆæ¬¡å¯åŠ¨</strong></td>\n<td>âš™ï¸ å¯é€‰ï¼ˆä»…ç‰¹å®šé˜¶æ®µï¼‰</td>\n<td>ç”¨äºåœ¨ controller quorum å°šæœªå½¢æˆæ—¶çš„ä¸´æ—¶å‘ç°</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚è€ƒ worker1 ä¸Šçš„ controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ <code>controller.properties</code>ï¼Œé…ç½® woker2 çš„ controller èŠ‚ç‚¹é…ç½®æ–‡ä»¶<code>controller.properties</code> ï¼Œworker3 ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ï¼Œè¿™é‡Œåªèƒ½æ˜¯controller</span></span><br><span class=\"line\">process.roles=controller</span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹IDï¼Œä¸èƒ½ä¸ç°æœ‰BrokerèŠ‚ç‚¹çš„IDä¸€è‡´</span></span><br><span class=\"line\">node.id=3001</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹</span></span><br><span class=\"line\">controller.quorum.voters=3000@worker1:9098,3001@worker2:9098,3002@worker3:9098</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç›‘å¬å™¨ï¼Œæ³¨æ„ç«¯å£ä¸èƒ½é‡å¤</span></span><br><span class=\"line\">listeners=CONTROLLER://:9098</span><br><span class=\"line\">advertised.listeners=CONTROLLER://worker2:9098</span><br><span class=\"line\">controller.listener.names=CONTROLLER</span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜æ”¾ç›®å½•ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯å…ƒæ•°æ®</span></span><br><span class=\"line\">log.dirs=/usr/local/kafka/dataDir/kraft-meta</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š Kafka é›†ç¾¤å†…éƒ¨ï¼ˆbroker ä¸ brokerã€KRaft æ§åˆ¶å™¨ä¸ brokerï¼‰é€šä¿¡æ‰€ä½¿ç”¨çš„ç›‘å¬å™¨ï¼ˆlistenerï¼‰åç§°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œè¦ä¸åŸå…ˆçš„ server.properties ä¸­é…ç½®çš„ç›‘å¬å™¨åç§°ä¸€è‡´</span></span><br><span class=\"line\">inter.broker.listener.name=PLAINTEXT</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆå§‹åŒ–æ—¥å¿—ç›®å½•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åªæœ‰ Controller èŠ‚ç‚¹æ‰éœ€è¦åˆå§‹åŒ–æ—¥å¿—ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\"># -t å‚æ•°æŒ‡å®šé›†ç¾¤çš„ Cluster IDï¼Œå°±æ˜¯å‰é¢è·å–çš„ Cluster ID</span></span><br><span class=\"line\">kafka-storage.sh format -t hp_Q0pihQ0ORcIvXlfHobQ -c /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«å¯åŠ¨ worker2 å’Œ worker3 ä¸Šçš„ controller èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/controller.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶æ–°çš„ controller èŠ‚ç‚¹ä¸ä¼šç«‹åˆ»åŠ å…¥é€‰ä¸¾é˜Ÿåˆ—ï¼Œæ–°èŠ‚ç‚¹åˆå§‹çŠ¶æ€é»˜è®¤æ˜¯ observerï¼Œéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†èŠ‚ç‚¹åŠ å…¥é€‰ä¸¾é˜Ÿåˆ—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ†åˆ«åœ¨ worker2 å’Œ worker3 ä¸Šæ‰§è¡Œ</span></span><br><span class=\"line\">kafka-metadata-quorum.sh --bootstrap-server localhost:9092 --command-config /usr/local/kafka/kafka3/config/kraft/controller.properties add-controller</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kafka-metadata-quorum.sh --bootstrap-server worker1:9092 describe --replication</span><br><span class=\"line\">NodeId\tDirectoryId           \tLogEndOffset\tLag\tLastFetchTimestamp\tLastCaughtUpTimestamp\tStatus</span><br><span class=\"line\">3000  \tRJ4oOPGgTw-KxHFNn4SmiQ\t27820       \t0  \t1760696136345     \t1760696136345        \tLeader</span><br><span class=\"line\">3001  \tzGnWA7zYmRHG6bcTlFV2qA\t27820       \t0  \t1760696136259     \t1760696136259        \tFollower</span><br><span class=\"line\">3002  \tgIDkhOQJEHqg-GJBdezU1Q\t27820       \t0  \t1760696136257     \t1760696136257        \tFollower</span><br><span class=\"line\">2     \t9KeeAYKEQHT92DxqNSwYuA\t27820       \t0  \t1760696136257     \t1760696136257        \tObserver</span><br><span class=\"line\">1     \tQ8lr8JQ2vrDS35_DrI1MxA\t27820       \t0  \t1760696136257     \t1760696136257        \tObserver</span><br><span class=\"line\">3     \trgQR5wd_i5hLgU97dCKIvA\t27820       \t0  \t1760696136257     \t1760696136257        \tObserver</span><br><span class=\"line\"></span><br><span class=\"line\">$ kafka-metadata-quorum.sh --bootstrap-server worker1:9092 describe --status</span><br><span class=\"line\">ClusterId:              hp_Q0pihQ0ORcIvXlfHobQ</span><br><span class=\"line\">LeaderId:               3000</span><br><span class=\"line\">LeaderEpoch:            5</span><br><span class=\"line\">HighWatermark:          30094</span><br><span class=\"line\">MaxFollowerLag:         0</span><br><span class=\"line\">MaxFollowerLagTimeMs:   0</span><br><span class=\"line\">CurrentVoters:          [&#123;<span class=\"string\">&quot;id&quot;</span>: 3000, <span class=\"string\">&quot;directoryId&quot;</span>: <span class=\"string\">&quot;RJ4oOPGgTw-KxHFNn4SmiQ&quot;</span>, <span class=\"string\">&quot;endpoints&quot;</span>: [<span class=\"string\">&quot;CONTROLLER://worker1:9098&quot;</span>]&#125;, &#123;<span class=\"string\">&quot;id&quot;</span>: 3001, <span class=\"string\">&quot;directoryId&quot;</span>: <span class=\"string\">&quot;zGnWA7zYmRHG6bcTlFV2qA&quot;</span>, <span class=\"string\">&quot;endpoints&quot;</span>: [<span class=\"string\">&quot;CONTROLLER://worker2:9098&quot;</span>]&#125;, &#123;<span class=\"string\">&quot;id&quot;</span>: 3002, <span class=\"string\">&quot;directoryId&quot;</span>: <span class=\"string\">&quot;gIDkhOQJEHqg-GJBdezU1Q&quot;</span>, <span class=\"string\">&quot;endpoints&quot;</span>: [<span class=\"string\">&quot;CONTROLLER://worker3:9098&quot;</span>]&#125;]</span><br><span class=\"line\">CurrentObservers:       [&#123;<span class=\"string\">&quot;id&quot;</span>: 2, <span class=\"string\">&quot;directoryId&quot;</span>: <span class=\"string\">&quot;9KeeAYKEQHT92DxqNSwYuA&quot;</span>&#125;, &#123;<span class=\"string\">&quot;id&quot;</span>: 1, <span class=\"string\">&quot;directoryId&quot;</span>: <span class=\"string\">&quot;Q8lr8JQ2vrDS35_DrI1MxA&quot;</span>&#125;, &#123;<span class=\"string\">&quot;id&quot;</span>: 3, <span class=\"string\">&quot;directoryId&quot;</span>: <span class=\"string\">&quot;rgQR5wd_i5hLgU97dCKIvA&quot;</span>&#125;]</span><br></pre></td></tr></table></figure>\n<h3 id=\"åŠ å…¥-æ–°çš„-Broker-èŠ‚ç‚¹\">åŠ å…¥ æ–°çš„ Broker èŠ‚ç‚¹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºæ–°çš„ Broker èŠ‚ç‚¹æ—¶ï¼Œå‚è€ƒå…¶å®ƒ Broker èŠ‚ç‚¹ é…ç½®å¥½é…ç½®æ–‡ä»¶ <code>server.properties</code>ï¼Œå¹¶å¯åŠ¨ Broker èŠ‚ç‚¹å³å¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ— éœ€è¿è¡Œæ—¥å¿—ç›®å½•åˆå§‹åŒ–å‘½ä»¤ï¼Œå› ä¸º Broker èŠ‚ç‚¹åªå­˜æ”¾ æ¶ˆæ¯ æ•°æ®ã€‚</p>\n</li>\n</ul>\n<h2 id=\"è¿ç§»åæ³¨æ„äº‹é¡¹\">è¿ç§»åæ³¨æ„äº‹é¡¹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿ç§»å®Œæˆåï¼ŒKafka å®¢æˆ·ç«¯ï¼ˆProducer / Consumer / AdminClientï¼‰ä¾ç„¶è¿æ¥çš„æ˜¯ Broker èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ Controller èŠ‚ç‚¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kafka åœ¨ ZooKeeper æ¨¡å¼ä¸ KRaft æ¨¡å¼ä¸‹çš„åŒºåˆ«ä¸»è¦åœ¨äºï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ§åˆ¶å¹³é¢ï¼ˆControl Planeï¼‰ï¼šZK æ¨¡å¼ä¸‹ç”± ZooKeeper + Controller Broker å…±åŒç®¡ç†ï¼›KRaft æ¨¡å¼ä¸‹ç”± ç‹¬ç«‹çš„ Controller è¿›ç¨‹æˆ–è§’è‰² ç®¡ç†ï¼ˆé€šè¿‡ Raft åè®®åŒæ­¥å…ƒæ•°æ®ï¼‰ã€‚</li>\n<li class=\"lvl-4\">æ•°æ®å¹³é¢ï¼ˆData Planeï¼‰ï¼šæ— è®ºæ˜¯å“ªä¸ªæ¨¡å¼ï¼Œå®¢æˆ·ç«¯å‘é€ã€æ¶ˆè´¹æ¶ˆæ¯ä»ç„¶æ˜¯é€šè¿‡ Broker èŠ‚ç‚¹ å®Œæˆçš„ã€‚</li>\n<li class=\"lvl-4\">ä¹Ÿå°±æ˜¯è¯´ï¼ŒController ç®¡ç†é›†ç¾¤å…ƒæ•°æ®ï¼ˆä¸»é¢˜ã€åˆ†åŒºã€å‰¯æœ¬ã€Leader é€‰ä¸¾ç­‰ï¼‰ï¼Œè€Œ Broker èŠ‚ç‚¹å¤„ç†å®é™…çš„æ¶ˆæ¯æµã€‚</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» å¦‚ä½•å°† Kafka é›†ç¾¤ä» Zookeeper æ¨¡å¼è¿ç§»åˆ° KRaft æ¨¡å¼ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ å®˜æ–¹æ–‡æ¡£ï¼šZooKeeperåˆ°KRaftè¿ç§» ä» Zookeeper æ¨¡å¼è¿ç§»åˆ° KRaft æ¨¡å¼ï¼ˆå¹³æ»‘è¿ç§»ï¼‰ ï¼ï¼ï¼è¿ç§»åå°†æ— æ³•å†æ¢å¤åˆ° ZooKeeper æ¨¡å¼ï¼ï¼ï¼ Kafka å®˜æ–¹åœ¨ 3.4+ å¼•å…¥äº†å®Œæ•´çš„ Zookeeper â†’ KRaft å¹³æ»‘è¿ç§»æœºåˆ¶ï¼Œç§°ä¸º ZK to KRaft (ZkMigration)ã€‚ è¿ç§»èƒŒæ™¯ä¸å‰æ é¡¹ç›® è¯´æ˜ æ”¯æŒç‰ˆæœ¬ Kafka 3.4.0+ï¼ˆå»ºè®®è‡³å°‘ä½¿ç”¨ 3.6.x ï¼Œç›®å‰æœ€æ–°ç‰ˆä¸º 3.9.xï¼‰ è¿ç§»ç›®çš„ æ‘†è„± ZooKeeperï¼Œå®Œå…¨åˆ‡æ¢ä¸º KRaft è‡ªç®¡ç†æ¨¡å¼ è¿ç§»æ¨¡å¼ åœ¨çº¿è¿ç§»ï¼ˆæ— åœæœºæˆ–æœ€å°åœæœºï¼‰ æœ€ç»ˆç›®æ ‡ Kafka çš„æ§åˆ¶å™¨ä¸å…ƒæ•°æ®å®Œå…¨ç”± KRaft ç®¡ç†ï¼Œä¸å†ä¾èµ– ZooKeeperã€‚ æ•´ä½“è¿ç§»æµç¨‹æ¦‚è§ˆ é˜¶æ®µ æ§åˆ¶å™¨ç±»å‹ Broker æ¨¡å¼ ZooKeeper è§’è‰² KRaft è§’è‰² ç‰¹å¾è¯´æ˜ åˆå§‹é˜¶æ®µ ZooKeeper æ§åˆ¶å™¨ å…¨éƒ¨ä¸º ZK æ¨¡å¼ ç®¡ç†æ‰€æœ‰å…ƒæ•°æ® å°šæœªå¯ç”¨ æ‰€æœ‰ Broker éƒ½è¿è¡Œåœ¨ ZK æ¨¡å¼ä¸‹ï¼Œç”± ZK æ§åˆ¶å™¨ç®¡ç†é›†ç¾¤ã€‚ åˆå§‹å…ƒæ•°æ®åŠ è½½é˜¶æ®µ KRaft æ§åˆ¶å™¨å¼€å§‹åŠ è½½ éƒ¨åˆ†ï¼ˆæˆ–å…¨éƒ¨ï¼‰ä»ä¸º ZK æ¨¡å¼ æä¾›å…ƒæ•°æ®æº ä» ZK åŠ è½½å…ƒæ•°æ® KRaft æ³•å®šèŠ‚ç‚¹ï¼ˆcontroller.quorum.votersï¼‰ä» ZK ä¸­è¯»å–å¹¶åŒæ­¥å½“å‰é›†ç¾¤å…ƒæ•°æ®ã€‚ æ··åˆé˜¶æ®µ KRaft æ§åˆ¶å™¨ éƒ¨åˆ† ZK æ¨¡å¼ï¼Œéƒ¨åˆ† KRaft æ¨¡å¼ ä¿ç•™åªè¯»å…ƒæ•°æ® ç®¡ç†å¹¶æ›´æ–°å…ƒæ•°æ® KRaft æ§åˆ¶å™¨æˆä¸ºä¸»æ§ï¼ŒZK ä»å­˜åœ¨ä½†åªæä¾›è¯»å–ï¼ŒBroker å¯å¤„äºä¸åŒæ¨¡å¼ï¼ˆæ··åˆçŠ¶æ€ï¼‰ã€‚ åŒå†™é˜¶æ®µ KRaft æ§åˆ¶å™¨ å…¨éƒ¨ä¸º KRaft æ¨¡å¼ æ¥æ”¶ KRaft åŒæ­¥å†™å…¥ ç®¡ç†å…ƒæ•°æ®å¹¶å†™å…¥ ZK æ‰€æœ‰ Broker éƒ½è¿è¡Œåœ¨ KRaft æ¨¡å¼ï¼Œæ§åˆ¶å™¨å°†å…ƒæ•°æ®åŒæ—¶å†™å…¥ ZK å’Œ KRaft æ—¥å¿—ã€‚ è¿ç§»å®Œæˆé˜¶æ®µ KRaft æ§åˆ¶å™¨ å…¨éƒ¨ä¸º KRaft æ¨¡å¼ ä¸å†ä½¿ç”¨ ç‹¬ç«‹è¿è¡Œ åœæ­¢å‘ ZK å†™å…¥å…ƒæ•°æ®ï¼ŒZK å¯å®‰å…¨å…³é—­ï¼ŒKafka å®Œå…¨è¿è¡Œåœ¨æ—  Zookeeper çš„ KRaft æ¨¡å¼ä¸‹ã€‚ å¼€å§‹è¿ç§» è¿™é‡Œä»¥å‰æ–‡ Kafka çš„å®‰è£…ï¼šåŸºäº Zookeeper ä¸­çš„3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸ºä¾‹ã€‚ å¯åŠ¨ä¸€ä¸ª Controller èŠ‚ç‚¹ åœ¨ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨ä¸€ä¸ª Controller èŠ‚ç‚¹ï¼Œè¿™é‡Œä¸º worker1 å¯åŠ¨å‰éœ€è¦å…ˆè·å–å½“å‰ Kafka é›†ç¾¤çš„ Cluster ID 1234567$ zookeeper-shell.sh localhost:2181 get /cluster/idConnecting to localhost:2181WATCHER::WatchedEvent state:SyncConnected type:None path:null&#123;&quot;version&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hp_Q0pihQ0ORcIvXlfHobQ&quot;&#125; å‡†å¤‡å¥½ Controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œå¯ä»¥ç”¨ config/kraft/controller.properties ä¸ºæ¨¡æ¿è¿›è¡Œä¿®æ”¹ 123456789101112131415161718192021222324# é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ï¼Œè¿™é‡Œåªèƒ½æ˜¯controllerprocess.roles=controller# èŠ‚ç‚¹IDï¼Œä¸èƒ½ä¸ç°æœ‰BrokerèŠ‚ç‚¹çš„IDä¸€è‡´node.id=3000# é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å½“å‰åªå¯åŠ¨äº†ä¸€ä¸ªcontrollerèŠ‚ç‚¹ï¼Œæ‰€ä»¥åªèƒ½é…ç½®ä¸€ä¸ªæŠ•ç¥¨èŠ‚ç‚¹controller.quorum.bootstrap.servers=worker1:9098# é…ç½®ç›‘å¬å™¨ï¼Œæ³¨æ„ç«¯å£ä¸èƒ½é‡å¤listeners=CONTROLLER://:9098advertised.listeners=CONTROLLER://worker1:9098controller.listener.names=CONTROLLER# æ—¥å¿—å­˜æ”¾ç›®å½•ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯å…ƒæ•°æ®ï¼Œåœ¨æ ¼å¼åŒ–æ—¶è¿™ä¸ªç›®å½•å¿…é¡»ä¸ºç©ºç›®å½•log.dirs=/usr/local/kafka/dataDir/kraft-meta# æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹zookeeper.metadata.migration.enable=true# ZooKeeper client è¿æ¥zookeeper.connect=worker1:2181,worker2:2181,worker3:2181# æŒ‡å®š Kafka é›†ç¾¤å†…éƒ¨ï¼ˆbroker ä¸ brokerã€KRaft æ§åˆ¶å™¨ä¸ brokerï¼‰é€šä¿¡æ‰€ä½¿ç”¨çš„ç›‘å¬å™¨ï¼ˆlistenerï¼‰åç§°ã€‚# æ³¨æ„è¿™é‡Œè¦ä¸åŸå…ˆçš„ server.properties ä¸­é…ç½®çš„ç›‘å¬å™¨åç§°ä¸€è‡´inter.broker.listener.name=PLAINTEXT# å…¶å®ƒå‚æ•°å°½é‡ä¿æŒä¸æ—§é›†ç¾¤çš„é…ç½®ä¸€è‡´ å¯åŠ¨ Controller èŠ‚ç‚¹ åƒä¸‡ä¸è¦åœ¨å·²æœ‰ broker çš„æ•°æ®ç›®å½•ï¼ˆåŒ…å«æ¶ˆæ¯æ•°æ®çš„ log.dirsï¼‰ä¸Šè¿è¡Œ kafka-storage.sh format ï¼Œé‚£ä¼šæŠŠåŸæœ‰æ•°æ®ç»“æ„é‡ç½®æˆ–è¸©åã€‚ å¿…é¡»æ˜ç¡®ï¼šæ ¼å¼åŒ–åªé’ˆå¯¹ æ–° controller çš„ metadata ç›®å½•ï¼ˆä¸”è¯¥ç›®å½•å¿…é¡»ä¸ºç©ºï¼‰ã€‚ 12345# æ ¼å¼åŒ–å…ƒæ•°æ®ç›®å½•ï¼Œlog.dirs å‚æ•°æŒ‡å®šå…ƒæ•°æ®å­˜æ”¾ç›®å½•ï¼Œé¦–æ¬¡è¿è¡Œå‰å¿…é¡»ä¸ºç©ºç›®å½•# -t å‚æ•°æŒ‡å®šé›†ç¾¤çš„ Cluster IDï¼Œå°±æ˜¯å‰é¢è·å–çš„ Cluster IDkafka-storage.sh format --standalone -t hp_Q0pihQ0ORcIvXlfHobQ -c /usr/local/kafka/kafka3/config/kraft/controller.properties# å¯åŠ¨ï¼Œè¿™é‡Œæ²¡æœ‰åå°å¯åŠ¨æ˜¯ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿæ—¥å¿—è¾“å‡ºkafka-server-start.sh /usr/local/kafka/kafka3/config/kraft/controller.properties æ¨¡å¼ format å‘½ä»¤ quorum çŠ¶æ€ æ˜¯å¦ä» ZK åŠ è½½ è¿ç§»é˜¶æ®µï¼ˆstandaloneï¼‰ --standalone æ— ï¼ˆå•èŠ‚ç‚¹ï¼‰ âœ… æ˜¯ æ­£å¼ KRaft æ¨¡å¼ æ—  --standalone âœ… å¤šèŠ‚ç‚¹ âŒ å¦ï¼ˆç‹¬ç«‹è¿è¡Œï¼‰ å°†åŸå…ˆçš„ä¸‰ä¸ªèŠ‚ç‚¹ä½œä¸º Broker èŠ‚ç‚¹é‡æ–°å¯åŠ¨ ä¿®æ”¹åŸå…ˆçš„é…ç½®æ–‡ä»¶ server.propertiesï¼Œåªéœ€è¦ä¿®æ”¹å¦‚ä¸‹å†…å®¹å³å¯ 1234567891011121314# åœ¨æœ€ååŠ å…¥ CONTROLLER:PLAINTEXTlistener.security.protocol.map=PLAINTEXT:PLAINTEXT,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL,CONTROLLER:PLAINTEXT## ä»¥ä¸‹æ˜¯æ–°åŠ å…¥çš„ é…ç½®é¡¹# Set the IBPï¼Œå½“å‰ kafka ç‰ˆæœ¬æ˜¯ 3.9.1ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸º 3.9inter.broker.protocol.version=3.9# æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹zookeeper.metadata.migration.enable=true# KRaft controller quorum configurationï¼Œå› ä¸ºç›®å‰åªå¯åŠ¨äº†ä¸€ä¸ª controller èŠ‚ç‚¹ï¼Œæ‰€ä»¥åªèƒ½é…ç½®ä¸€ä¸ªæŠ•ç¥¨èŠ‚ç‚¹controller.quorum.bootstrap.servers=worker1:9098# æ§åˆ¶å™¨ç›‘å¬å™¨åç§°ï¼Œè¦ä¸ contreller èŠ‚ç‚¹é…ç½®æ–‡ä»¶ controller.properties ä¸­çš„é…ç½®ä¸€è‡´controller.listener.names=CONTROLLER åˆ†åˆ«é‡æ–°å¯åŠ¨ä¸‰ä¸ªèŠ‚ç‚¹ 1234567# å…³é—­ kafkakafka-server-stop.sh# è¿™é‡Œè¦æ³¨æ„ worker1 ä¸Šä¸è¦ä½¿ç”¨ kafka-server-stop.sh è¿›è¡Œå…³é—­ï¼Œå› ä¸º worker1 ä¸Šçš„ controller èŠ‚ç‚¹ ä¹Ÿåœ¨è¿è¡Œï¼Œä¼šæœ‰ä¸¤ä¸ª kafka è¿›ç¨‹è¿è¡Œï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå…³é—­ï¼›å› ä¸º controller èŠ‚ç‚¹ å¯åŠ¨ä½¿ç”¨çš„æ˜¯ controller.propertiesps -ef | grep kafka | grep &quot;server\\.properties&quot; | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9# é‡æ–°å¯åŠ¨ kafkakafka-server-start.sh /usr/local/kafka/kafka3/config/server.properties å½“ä¸‰ä¸ªèŠ‚ç‚¹éƒ½ä»¥å¿…è¦çš„é…ç½®é‡æ–°å¯åŠ¨åï¼Œè¿ç§»å°†è‡ªåŠ¨å¼€å§‹ã€‚è¿ç§»å®Œæˆåï¼Œå¯ä»¥åœ¨ Controller(worker1)èŠ‚ç‚¹ ä¸Šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹æ—¥å¿—ï¼š 1234567891011121314151617181920# âœ… æ„å‘³ï¼šä» ZooKeeper åˆ° KRaft çš„åˆå§‹å…ƒæ•°æ®è¿ç§»å·²æˆåŠŸï¼Œå…±å†™å…¥ 62 æ¡è®°å½•ï¼Œå½“å‰ KRaft metadata offset ä¸º 3179ã€‚è¿™æ˜¯è¿ç§»æˆåŠŸçš„æ˜ç¡®è¯æ®ã€‚Completed migration of metadata from ZooKeeper to KRaft. 62 records were generated in 300 ms across 1 batches. The average time spent waiting on a batch was 97.00 ms. The record types were &#123;TOPIC_RECORD=3, PARTITION_RECORD=56, CONFIG_RECORD=3&#125;. The current metadata offset is now 3179 with an epoch of 2. Saw 3 brokers in the migrated metadata [1, 2, 3]. (org.apache.kafka.metadata.migration.KRaftMigrationDriver)# âœ… æ„å‘³ï¼šæ§åˆ¶å™¨å·²åŠ è½½å¹¶ç”Ÿæ•ˆæ–°å…ƒæ•°æ®ä¸ feature setï¼ˆä¸ offset 3179 å¯¹åº”ï¼‰ã€‚Loaded new metadata Features(metadataVersion=3.9-IV0, finalizedFeatures=&#123;metadata.version=21&#125;, finalizedFeaturesEpoch=3179). (org.apache.kafka.metadata.publisher.FeaturesPublisher)# âœ… æ„å‘³ï¼šå†…éƒ¨è¿ç§»çŠ¶æ€å·²æ›´æ–°ï¼ŒKRaft ä¸Šæœ‰äº†å†™å…¥ä½ç½®è®°å½•ã€‚Finished initial migration of ZK metadata to KRaft in 3486479 ns. Transitioned migration state from ZkMigrationLeadershipState&#123;kraftControllerId=3000, kraftControllerEpoch=2, kraftMetadataOffset=-1, kraftMetadataEpoch=-1, lastUpdatedTimeMs=1760682050169, migrationZkVersion=1, controllerZkEpoch=3, controllerZkVersion=3&#125; to ZkMigrationLeadershipState&#123;kraftControllerId=3000, kraftControllerEpoch=2, kraftMetadataOffset=3179, kraftMetadataEpoch=2, lastUpdatedTimeMs=1760682050169, migrationZkVersion=2, controllerZkEpoch=3, controllerZkVersion=3&#125; (org.apache.kafka.metadata.migration.KRaftMigrationDriver)# âœ… æ„å‘³ï¼šè¿ç§»æµç¨‹æŒ‰é¢„æœŸæ¨è¿›ï¼šå…ˆæŠŠ KRaft çš„å…ƒæ•°æ®ä¸ ZK å¯¹é½ï¼ˆsyncï¼‰ï¼Œç„¶åä¸ brokers å»ºç«‹é€šä¿¡ï¼Œæœ€ç»ˆè¿›å…¥ DUAL_WRITEï¼ˆåŒå†™ï¼‰ã€‚DUAL_WRITE é˜¶æ®µè¡¨ç¤ºæ§åˆ¶å™¨åœ¨å†™å…¥ KRaft metadata log çš„åŒæ—¶ï¼Œä»ç„¶ä¼šæŠŠå¿…è¦çš„å†™æ“ä½œä¹Ÿå†™å› ZooKeeperï¼ˆåŒå†™ï¼‰â€”â€”ç›´åˆ°è¿ç§»å®Œå…¨å®Œæˆå¹¶ç¡®è®¤å¯ä»¥åœæ­¢å†™ ZK ä¸ºæ­¢ã€‚3000 transitioning from ZK_MIGRATION to SYNC_KRAFT_TO_ZK state...Performing a full metadata sync from KRaft to ZK.Did not make any ZK writes when reconciling with KRaft state.3000 transitioning ... to KRAFT_CONTROLLER_TO_BROKER_COMM...Sending RPCs to broker before moving to dual-write mode using at offset and epoch OffsetAndEpoch(offset=3179, epoch=2)...3000 transitioning ... to DUAL_WRITE state ä¸Šé¢çš„æ—¥å¿—æ€»ä½“ä¸Šè¡¨æ˜ï¼Œå…ƒæ•°æ®è¿ç§»å·²æˆåŠŸå®Œæˆå¹¶ä¸”æ§åˆ¶å™¨è¿›å…¥äº†åŒå†™ï¼ˆDUAL_WRITEï¼‰é˜¶æ®µã€‚ å°†ä¸‰ä¸ªBrokerèŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º KRaft æ¨¡å¼çš„ broker èŠ‚ç‚¹ ä¿®æ”¹ä¸‰ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ server.properties 123456789101112131415# æ·»åŠ process.roles=brokerprocess.roles=broker# ç”¨ node.id æ›¿æ¢ broker.idï¼Œæ³¨æ„ï¼Œnode.id éœ€è¦ä¸ broker.id ä¸€è‡´# broker.id=1node.id=1# å»æ‰ zookeeper ç›¸å…³é…ç½®# Don&#x27;t set the IBP, KRaft uses &quot;metadata.version&quot; feature flag# inter.broker.protocol.version=3.9# Remove the migration enabled flag# zookeeper.metadata.migration.enable=true# Remove ZooKeeper client configuration# zookeeper.connect=worker1:2181,worker2:2181,worker3:2181 åˆ†åˆ«é‡æ–°å¯åŠ¨ä¸‰ä¸ªèŠ‚ç‚¹ 1234567# å…³é—­ kafkakafka-server-stop.sh# è¿™é‡Œè¦æ³¨æ„ worker1 ä¸Šä¸è¦ä½¿ç”¨ kafka-server-stop.sh è¿›è¡Œå…³é—­ï¼Œå› ä¸º worker1 ä¸Šçš„ controller èŠ‚ç‚¹ ä¹Ÿåœ¨è¿è¡Œï¼Œä¼šæœ‰ä¸¤ä¸ª kafka è¿›ç¨‹è¿è¡Œï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå…³é—­ï¼›å› ä¸º controller èŠ‚ç‚¹ å¯åŠ¨ä½¿ç”¨çš„æ˜¯ controller.propertiesps -ef | grep kafka | grep &quot;server\\.properties&quot; | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9# é‡æ–°å¯åŠ¨ kafkakafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties å°† Controller èŠ‚ç‚¹çš„é…ç½®ä¿®æ”¹ä¸º KRaft æ¨¡å¼çš„ controller èŠ‚ç‚¹ ä¿®æ”¹ controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ controller.properties 123456## å»æ‰å»ä¸‹å†…å®¹# æ§åˆ¶æ˜¯å¦å¯ç”¨ ZooKeeper â†’ KRaft çš„å…ƒæ•°æ®è¿ç§»è¿‡ç¨‹# zookeeper.metadata.migration.enable=true# ZooKeeper client è¿æ¥# zookeeper.connect=worker1:2181,worker2:2181,worker3:2181 é‡å¯å¯åŠ¨ controller èŠ‚ç‚¹ 12# å…³é—­åé‡æ–°å¯åŠ¨kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/controller.properties æ­¤æ—¶ä½ å¯ä»¥å…³é—­ zookeeper é›†ç¾¤äº†ï¼Œæ–°çš„ kafka é›†ç¾¤å°†ä¸å†ä½¿ç”¨ ZooKeeperï¼Œä¹Ÿæ— æ³•åœ¨æ¢å¤åˆ° ZooKeeper æ¨¡å¼ã€‚ åŠ å…¥æ–°çš„ Controller èŠ‚ç‚¹ Controller å°½é‡ä¿æŒ å¥‡æ•°ä¸ªèŠ‚ç‚¹ã€‚ ä¹‹å‰å·²ç»åœ¨ worker1 èŠ‚ç‚¹ä¸Šå¯åŠ¨äº† controller ï¼Œç°åœ¨ worker2 å’Œ worker3 ä¸Šä¹Ÿæ¥å¯åŠ¨ controller èŠ‚ç‚¹ï¼Œå¹¶å°†å®ƒä»¬åŠ å…¥åˆ° kafka é›†ç¾¤ä¸­ã€‚ åœ¨å¼€å§‹é…ç½®å‰ï¼Œå…ˆå°†ä¸Šé¢çš„ controller èŠ‚ç‚¹ å’Œ ä¸‰ä¸ª broker èŠ‚ç‚¹ çš„å¦‚ä¸‹é…ç½®è¿›è¡Œä¿®æ”¹ï¼Œå¹¶é‡å¯å¯åŠ¨ã€‚ 123456# å°† controller.quorum.bootstrap.servers æ›¿æ¢ä¸º controller.quorum.voterscontroller.quorum.voters=3000@worker1:9098,3001@worker2:9098,3002@worker3:9098# controller.quorum.bootstrap.servers=worker1:9098# controller.quorum.voters = è°æ˜¯æ­£å¼æŠ•ç¥¨æˆå‘˜ï¼ˆå›ºå®šé…ç½®ï¼‰# controller.quorum.bootstrap.servers = ä¸´æ—¶æ‰¾è°å¼•å¯¼è¿æ¥ï¼ˆè¿ç§»æˆ–åˆå§‹åŒ–ç”¨ï¼‰ é…ç½®é¡¹ ä½œç”¨ é€‚ç”¨é˜¶æ®µ æ˜¯å¦å¿…éœ€ è¯´æ˜ controller.quorum.voters å®šä¹‰ æ­£å¼çš„ KRaft æ§åˆ¶å™¨æŠ•ç¥¨æˆå‘˜åˆ—è¡¨ï¼ˆvoter setï¼‰ é›†ç¾¤æ­£å¸¸è¿è¡Œæ—¶ âœ… æ˜¯ æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»é…ç½®ç›¸åŒçš„å€¼ controller.quorum.bootstrap.servers å®šä¹‰ è¿ç§»é˜¶æ®µæˆ–åˆå§‹åŒ–é˜¶æ®µçš„æ§åˆ¶å™¨è¿æ¥åœ°å€ï¼ˆbootstrap controller endpointï¼‰ ZK â†’ KRaft è¿ç§»é˜¶æ®µ æˆ– KRaft é›†ç¾¤åˆæ¬¡å¯åŠ¨ âš™ï¸ å¯é€‰ï¼ˆä»…ç‰¹å®šé˜¶æ®µï¼‰ ç”¨äºåœ¨ controller quorum å°šæœªå½¢æˆæ—¶çš„ä¸´æ—¶å‘ç° å‚è€ƒ worker1 ä¸Šçš„ controller èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ controller.propertiesï¼Œé…ç½® woker2 çš„ controller èŠ‚ç‚¹é…ç½®æ–‡ä»¶controller.properties ï¼Œworker3 ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚ 12345678910111213141516# é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ï¼Œè¿™é‡Œåªèƒ½æ˜¯controllerprocess.roles=controller# èŠ‚ç‚¹IDï¼Œä¸èƒ½ä¸ç°æœ‰BrokerèŠ‚ç‚¹çš„IDä¸€è‡´node.id=3001# é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹controller.quorum.voters=3000@worker1:9098,3001@worker2:9098,3002@worker3:9098# é…ç½®ç›‘å¬å™¨ï¼Œæ³¨æ„ç«¯å£ä¸èƒ½é‡å¤listeners=CONTROLLER://:9098advertised.listeners=CONTROLLER://worker2:9098controller.listener.names=CONTROLLER# æ—¥å¿—å­˜æ”¾ç›®å½•ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯å…ƒæ•°æ®log.dirs=/usr/local/kafka/dataDir/kraft-meta# æŒ‡å®š Kafka é›†ç¾¤å†…éƒ¨ï¼ˆbroker ä¸ brokerã€KRaft æ§åˆ¶å™¨ä¸ brokerï¼‰é€šä¿¡æ‰€ä½¿ç”¨çš„ç›‘å¬å™¨ï¼ˆlistenerï¼‰åç§°ã€‚# æ³¨æ„è¿™é‡Œè¦ä¸åŸå…ˆçš„ server.properties ä¸­é…ç½®çš„ç›‘å¬å™¨åç§°ä¸€è‡´inter.broker.listener.name=PLAINTEXT åˆå§‹åŒ–æ—¥å¿—ç›®å½• 123# åªæœ‰ Controller èŠ‚ç‚¹æ‰éœ€è¦åˆå§‹åŒ–æ—¥å¿—ç›®å½•# -t å‚æ•°æŒ‡å®šé›†ç¾¤çš„ Cluster IDï¼Œå°±æ˜¯å‰é¢è·å–çš„ Cluster IDkafka-storage.sh format -t hp_Q0pihQ0ORcIvXlfHobQ -c /usr/local/kafka/kafka3/config/kraft/controller.properties åˆ†åˆ«å¯åŠ¨ worker2 å’Œ worker3 ä¸Šçš„ controller èŠ‚ç‚¹ 1kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/controller.properties æ­¤æ—¶æ–°çš„ controller èŠ‚ç‚¹ä¸ä¼šç«‹åˆ»åŠ å…¥é€‰ä¸¾é˜Ÿåˆ—ï¼Œæ–°èŠ‚ç‚¹åˆå§‹çŠ¶æ€é»˜è®¤æ˜¯ observerï¼Œéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†èŠ‚ç‚¹åŠ å…¥é€‰ä¸¾é˜Ÿåˆ— 12# åˆ†åˆ«åœ¨ worker2 å’Œ worker3 ä¸Šæ‰§è¡Œkafka-metadata-quorum.sh --bootstrap-server localhost:9092 --command-config /usr/local/kafka/kafka3/config/kraft/controller.properties add-controller æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€ 123456789101112131415161718$ kafka-metadata-quorum.sh --bootstrap-server worker1:9092 describe --replicationNodeId DirectoryId LogEndOffset Lag LastFetchTimestamp LastCaughtUpTimestamp Status3000 RJ4oOPGgTw-KxHFNn4SmiQ 27820 0 1760696136345 1760696136345 Leader3001 zGnWA7zYmRHG6bcTlFV2qA 27820 0 1760696136259 1760696136259 Follower3002 gIDkhOQJEHqg-GJBdezU1Q 27820 0 1760696136257 1760696136257 Follower2 9KeeAYKEQHT92DxqNSwYuA 27820 0 1760696136257 1760696136257 Observer1 Q8lr8JQ2vrDS35_DrI1MxA 27820 0 1760696136257 1760696136257 Observer3 rgQR5wd_i5hLgU97dCKIvA 27820 0 1760696136257 1760696136257 Observer$ kafka-metadata-quorum.sh --bootstrap-server worker1:9092 describe --statusClusterId: hp_Q0pihQ0ORcIvXlfHobQLeaderId: 3000LeaderEpoch: 5HighWatermark: 30094MaxFollowerLag: 0MaxFollowerLagTimeMs: 0CurrentVoters: [&#123;&quot;id&quot;: 3000, &quot;directoryId&quot;: &quot;RJ4oOPGgTw-KxHFNn4SmiQ&quot;, &quot;endpoints&quot;: [&quot;CONTROLLER://worker1:9098&quot;]&#125;, &#123;&quot;id&quot;: 3001, &quot;directoryId&quot;: &quot;zGnWA7zYmRHG6bcTlFV2qA&quot;, &quot;endpoints&quot;: [&quot;CONTROLLER://worker2:9098&quot;]&#125;, &#123;&quot;id&quot;: 3002, &quot;directoryId&quot;: &quot;gIDkhOQJEHqg-GJBdezU1Q&quot;, &quot;endpoints&quot;: [&quot;CONTROLLER://worker3:9098&quot;]&#125;]CurrentObservers: [&#123;&quot;id&quot;: 2, &quot;directoryId&quot;: &quot;9KeeAYKEQHT92DxqNSwYuA&quot;&#125;, &#123;&quot;id&quot;: 1, &quot;directoryId&quot;: &quot;Q8lr8JQ2vrDS35_DrI1MxA&quot;&#125;, &#123;&quot;id&quot;: 3, &quot;directoryId&quot;: &quot;rgQR5wd_i5hLgU97dCKIvA&quot;&#125;] åŠ å…¥ æ–°çš„ Broker èŠ‚ç‚¹ åˆ›å»ºæ–°çš„ Broker èŠ‚ç‚¹æ—¶ï¼Œå‚è€ƒå…¶å®ƒ Broker èŠ‚ç‚¹ é…ç½®å¥½é…ç½®æ–‡ä»¶ server.propertiesï¼Œå¹¶å¯åŠ¨ Broker èŠ‚ç‚¹å³å¯ã€‚ æ— éœ€è¿è¡Œæ—¥å¿—ç›®å½•åˆå§‹åŒ–å‘½ä»¤ï¼Œå› ä¸º Broker èŠ‚ç‚¹åªå­˜æ”¾ æ¶ˆæ¯ æ•°æ®ã€‚ è¿ç§»åæ³¨æ„äº‹é¡¹ è¿ç§»å®Œæˆåï¼ŒKafka å®¢æˆ·ç«¯ï¼ˆProducer / Consumer / AdminClientï¼‰ä¾ç„¶è¿æ¥çš„æ˜¯ Broker èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ Controller èŠ‚ç‚¹ã€‚ Kafka åœ¨ ZooKeeper æ¨¡å¼ä¸ KRaft æ¨¡å¼ä¸‹çš„åŒºåˆ«ä¸»è¦åœ¨äºï¼š æ§åˆ¶å¹³é¢ï¼ˆControl Planeï¼‰ï¼šZK æ¨¡å¼ä¸‹ç”± ZooKeeper + Controller Broker å…±åŒç®¡ç†ï¼›KRaft æ¨¡å¼ä¸‹ç”± ç‹¬ç«‹çš„ Controller è¿›ç¨‹æˆ–è§’è‰² ç®¡ç†ï¼ˆé€šè¿‡ Raft åè®®åŒæ­¥å…ƒæ•°æ®ï¼‰ã€‚ æ•°æ®å¹³é¢ï¼ˆData Planeï¼‰ï¼šæ— è®ºæ˜¯å“ªä¸ªæ¨¡å¼ï¼Œå®¢æˆ·ç«¯å‘é€ã€æ¶ˆè´¹æ¶ˆæ¯ä»ç„¶æ˜¯é€šè¿‡ Broker èŠ‚ç‚¹ å®Œæˆçš„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒController ç®¡ç†é›†ç¾¤å…ƒæ•°æ®ï¼ˆä¸»é¢˜ã€åˆ†åŒºã€å‰¯æœ¬ã€Leader é€‰ä¸¾ç­‰ï¼‰ï¼Œè€Œ Broker èŠ‚ç‚¹å¤„ç†å®é™…çš„æ¶ˆæ¯æµã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» å¦‚ä½•å°† Kafka é›†ç¾¤ä» Zookeeper æ¨¡å¼è¿ç§»åˆ° KRaft æ¨¡å¼ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ å®˜æ–¹æ–‡æ¡£ï¼šZooKeeperåˆ°KRaftè¿ç§»","date_published":"2025-10-16T14:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/10/16/kafka-05-install-kraft/","url":"https://blog.hanqunfeng.com/2025/10/16/kafka-05-install-kraft/","title":"Kafka çš„å®‰è£…ï¼šåŸºäº KRaft æ¨¡å¼","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº KRaft æ¨¡å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡çš„å®‰è£…æ–¹æ³•åŒæ ·é€‚ç”¨äº Kafka 4.x ç‰ˆæœ¬ï¼Œåªä¸è¿‡ Kafka 4.x ä¸­å·²ç»ä¸å†åŒ…å« ZooKeeper ç›¸å…³çš„é…ç½®æ–‡ä»¶ä»¥åŠç›¸å…³çš„å‘½ä»¤ï¼Œå¦å¤–è¦æ±‚JDK17+ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"KRaft-ç®€ä»‹\">KRaft ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kraft æ˜¯ Kafka ä» 2.8.0 ç‰ˆæœ¬ å¼€å§‹â½€æŒçš„â¼€ç§æ–°çš„é›†ç¾¤æ¶æ„â½…å¼ã€‚å…¶â½¬çš„ä¸»è¦æ˜¯ä¸ºäº†æ‘†è„±Kafkaå¯¹Zookeeperçš„ä¾èµ–ã€‚å› ä¸ºä»¥å¾€åŸºäºZookeeperæ­å»ºçš„é›†ç¾¤ï¼Œå¢åŠ äº†Kafkaæ¼”è¿›ä¸è¿ç»´çš„éš¾åº¦ï¼Œé€æ¸å¼€å§‹æˆä¸ºKakfaæ‹¥æŠ±äº‘åŸâ½£çš„â¼€ç§éšœç¢ã€‚ä½¿â½¤Krafté›†ç¾¤åï¼ŒKafkaé›†ç¾¤å°±ä¸å†éœ€è¦ä¾èµ–Zookeeperï¼Œå°†ä¹‹å‰åŸºäºZookeeperç®¡ç†çš„é›†ç¾¤æ•°æ®ï¼Œè½¬ä¸ºç”±Kafkaé›†ç¾¤â¾ƒâ¼°ç®¡ç†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¼ ç»Ÿçš„Kafkaé›†ç¾¤ï¼Œä¼šå°†æ¯ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ç»Ÿä¸€ä¿å­˜åœ¨Zookeeperä¸­ï¼Œå¹¶é€šè¿‡ZookeeperåŠ¨æ€é€‰ä¸¾äº§ç”Ÿä¸€ä¸ªControllerèŠ‚ç‚¹ï¼Œé€šè¿‡ControllerèŠ‚ç‚¹æ¥ç®¡ç†Kafkaé›†ç¾¤ï¼Œæ¯”å¦‚è§¦å‘Partitionçš„é€‰ä¸¾ã€‚è€Œåœ¨Krafté›†ç¾¤ä¸­ï¼Œä¼šå›ºå®šé…ç½®å‡ å°BrokerèŠ‚ç‚¹æ¥å…±åŒæ‹…ä»»Controllerçš„è§’è‰²ï¼Œå„ç»„Partitionçš„LeaderèŠ‚ç‚¹å°±ä¼šç”±è¿™äº›Controlleré€‰ä¸¾äº§ç”Ÿã€‚åŸæœ¬ä¿å­˜åœ¨Zookeeperä¸­çš„å…ƒæ•°æ®ä¹Ÿè½¬è€Œä¿å­˜åˆ°ControllerèŠ‚ç‚¹ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ğŸ§­ Kafka KRaft æ¨¡å¼ vs Zookeeper æ¨¡å¼ å¯¹æ¯”è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">å¯¹æ¯”é¡¹</th>\n<th style=\"text-align:left\"><strong>KRaft æ¨¡å¼ï¼ˆKafka Raft æ¨¡å¼ï¼‰</strong></th>\n<th style=\"text-align:left\"><strong>Zookeeper æ¨¡å¼ï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>æ¶æ„ç»“æ„</strong></td>\n<td style=\"text-align:left\">å»ä¸­å¿ƒåŒ–æ¶æ„ï¼ŒKafka è‡ªèº«å†…ç½®æ§åˆ¶å¹³é¢ï¼Œä¸ä¾èµ–å¤–éƒ¨ Zookeeperã€‚</td>\n<td style=\"text-align:left\">æ§åˆ¶å¹³é¢ä¾èµ–å¤–éƒ¨ Zookeeper é›†ç¾¤ï¼ŒKafka Broker åªè´Ÿè´£æ•°æ®å¹³é¢ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>ç»„ä»¶æ•°é‡</strong></td>\n<td style=\"text-align:left\">æ— éœ€éƒ¨ç½² Zookeeperï¼Œåªæœ‰ Kafka Broker èŠ‚ç‚¹ã€‚</td>\n<td style=\"text-align:left\">éœ€è¦å•ç‹¬ç»´æŠ¤ Zookeeper é›†ç¾¤ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å…ƒæ•°æ®å­˜å‚¨</strong></td>\n<td style=\"text-align:left\">å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka è‡ªèº«çš„å†…ç½®æ—¥å¿—ä¸­ï¼ˆ<code>__cluster_metadata</code> topicï¼‰ã€‚</td>\n<td style=\"text-align:left\">å…ƒæ•°æ®å­˜å‚¨åœ¨ Zookeeper çš„ znode æ ‘ç»“æ„ä¸­ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>ä¸€è‡´æ€§åè®®</strong></td>\n<td style=\"text-align:left\">ä½¿ç”¨ Kafka è‡ªå·±å®ç°çš„ Raft åè®®ï¼ˆKRaftï¼‰æ¥ä¿è¯å…ƒæ•°æ®ä¸€è‡´æ€§ã€‚</td>\n<td style=\"text-align:left\">ä½¿ç”¨ ZABï¼ˆZookeeper Atomic Broadcastï¼‰åè®®ä¿è¯ä¸€è‡´æ€§ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å¯åŠ¨é€Ÿåº¦</strong></td>\n<td style=\"text-align:left\">æ›´å¿«ï¼Œæ§åˆ¶å™¨å†…åµŒäº Broker ä¸­ï¼Œä¸éœ€è¦ç­‰å¾…å¤–éƒ¨ Zookeeper å¯åŠ¨ã€‚</td>\n<td style=\"text-align:left\">å¯åŠ¨ä¾èµ– Zookeeperï¼Œå¯åŠ¨é¡ºåºå’Œè¿é€šæ€§è¦æ±‚æ›´ä¸¥æ ¼ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å®¹é”™æ€§</strong></td>\n<td style=\"text-align:left\">Raft æ§åˆ¶å™¨å…·å¤‡æ—¥å¿—å¤åˆ¶æœºåˆ¶ï¼Œå®¹é”™æ€§ä¸ Kafka æ•°æ®å‰¯æœ¬ä¸€è‡´ã€‚</td>\n<td style=\"text-align:left\">å®¹é”™æ€§ç”± Zookeeper å†³å®šï¼ŒZookeeper æŒ‚æ‰å¯èƒ½å¯¼è‡´ Kafka æ§åˆ¶é¢ä¸å¯ç”¨ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>æ‰©å±•æ€§</strong></td>\n<td style=\"text-align:left\">å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka ä¸»é¢˜ä¸­ï¼Œæ°´å¹³æ‰©å±•èƒ½åŠ›æ›´å¼ºã€‚</td>\n<td style=\"text-align:left\">Zookeeper åœ¨é«˜åˆ†åŒºæ•°åœºæ™¯ä¸‹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>è¿ç»´å¤æ‚åº¦</strong></td>\n<td style=\"text-align:left\">æ— éœ€ç»´æŠ¤ Zookeeper é›†ç¾¤ï¼Œç»Ÿä¸€è¿ç»´ Kafka å³å¯ã€‚</td>\n<td style=\"text-align:left\">éœ€è¦é¢å¤–ç»´æŠ¤ Zookeeper é›†ç¾¤ï¼ˆç›‘æ§ã€æ‰©å®¹ã€å‡çº§ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>æ•°æ®æ¢å¤</strong></td>\n<td style=\"text-align:left\">å…ƒæ•°æ®æ¢å¤ä¸ Kafka ä¸»é¢˜ä¸€è‡´ï¼Œå¯é€šè¿‡æ—¥å¿—å›æ”¾æ¢å¤ã€‚</td>\n<td style=\"text-align:left\">Zookeeper æ•°æ®æ¢å¤ç›¸å¯¹å¤æ‚ï¼Œä¾èµ–å¿«ç…§å’Œäº‹åŠ¡æ—¥å¿—ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å®‰å…¨æœºåˆ¶</strong></td>\n<td style=\"text-align:left\">ç»Ÿä¸€ Kafka çš„å®‰å…¨æœºåˆ¶ï¼ˆSASLã€SSLã€ACL ç­‰ï¼‰ã€‚</td>\n<td style=\"text-align:left\">Zookeeper æœ‰ç‹¬ç«‹çš„å®‰å…¨é…ç½®ä½“ç³»ï¼Œéœ€å•ç‹¬ç®¡ç†ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>æ€§èƒ½è¡¨ç°</strong></td>\n<td style=\"text-align:left\">å…ƒæ•°æ®æ“ä½œå»¶è¿Ÿæ›´ä½ï¼ˆæ§åˆ¶å™¨ä¸ Broker æœ¬åœ°é€šä¿¡ï¼‰ã€‚</td>\n<td style=\"text-align:left\">å…ƒæ•°æ®æ“ä½œéœ€è¦è·¨è¿›ç¨‹ç½‘ç»œé€šä¿¡ï¼Œå»¶è¿Ÿæ›´é«˜ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>æ§åˆ¶å™¨è§’è‰²</strong></td>\n<td style=\"text-align:left\">ç”± Broker ä¸­çš„æ§åˆ¶å™¨ quorum é€‰ä¸¾äº§ç”Ÿï¼ˆæ”¯æŒå¤šæ§åˆ¶å™¨å€™é€‰ï¼‰ã€‚</td>\n<td style=\"text-align:left\">ç”± Zookeeper é€‰ä¸¾æ§åˆ¶å™¨ï¼ˆå•ç‚¹æ§åˆ¶å™¨ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>åˆ†åŒºä¸å‰¯æœ¬ç®¡ç†</strong></td>\n<td style=\"text-align:left\">å…¨éƒ¨å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka è‡ªèº«ï¼Œå¯å®ç°æ›´å¿«çš„åˆ†åŒºå˜æ›´å’Œæ‰©å®¹ã€‚</td>\n<td style=\"text-align:left\">åˆ†åŒºã€å‰¯æœ¬å…ƒæ•°æ®åŒæ­¥ä¾èµ– Zookeeperï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒä½ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>ç‰ˆæœ¬æ”¯æŒ</strong></td>\n<td style=\"text-align:left\">ä» Kafka 2.8 å¼€å§‹å¼•å…¥ï¼ŒKafka 3.3+ å·²ç»éå¸¸ç¨³å®šï¼ŒKafka 3.5+ é»˜è®¤æ¨èã€‚</td>\n<td style=\"text-align:left\">Kafka 3.5 å¼€å§‹æ ‡è®°ä¸ºâ€œLegacyâ€ï¼Œæœªæ¥ç‰ˆæœ¬è®¡åˆ’ç§»é™¤æ”¯æŒã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>å…¼å®¹æ€§</strong></td>\n<td style=\"text-align:left\">å¯é€šè¿‡å…ƒæ•°æ®è¿ç§»å·¥å…·ä» Zookeeper æ¨¡å¼å¹³æ»‘è¿ç§»ã€‚</td>\n<td style=\"text-align:left\">ä¸èƒ½ç›´æ¥è¿ç§»åˆ° KRaftï¼Œéœ€è¦å·¥å…·è¾…åŠ©ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>è¿ç»´ç›‘æ§</strong></td>\n<td style=\"text-align:left\">å•ä¸€ç³»ç»Ÿå¯ç›‘æ§ï¼ˆKafka è‡ªå¸¦çš„ JMXã€Prometheus ç­‰ï¼‰ã€‚</td>\n<td style=\"text-align:left\">Kafka ä¸ Zookeeper å„è‡ªéœ€è¦ç‹¬ç«‹ç›‘æ§ä½“ç³»ã€‚</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>æœªæ¥å‘å±•æ–¹å‘</strong></td>\n<td style=\"text-align:left\">å®˜æ–¹æ¨èå’Œé»˜è®¤æ¨¡å¼ï¼ˆZookeeper æ¨¡å¼å°†é€æ­¥æ·˜æ±°ï¼‰ã€‚</td>\n<td style=\"text-align:left\">å®˜æ–¹å·²ä¸å†å»ºè®®æ–°é›†ç¾¤ä½¿ç”¨ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Kafka-çš„-KRaft-é›†ç¾¤é…ç½®\">Kafka çš„ KRaft é›†ç¾¤é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨Kafkaçš„configç›®å½•ä¸‹ï¼Œæä¾›äº†ä¸€ä¸ªkraftçš„æ–‡ä»¶å¤¹ï¼Œåœ¨è¿™é‡Œé¢æä¾›äº†ä¸‰ä¸ªKraftåè®®çš„å‚è€ƒé…ç½®æ–‡ä»¶</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">broker.properties: æ•°æ®èŠ‚ç‚¹ï¼Œclientè¿æ¥æ—¶åªè¿æ¥brokeræ•°æ®èŠ‚ç‚¹</li>\n<li class=\"lvl-4\">controller.properties: Controlleræ§åˆ¶èŠ‚ç‚¹</li>\n<li class=\"lvl-4\">server.properties: å³å¯ä»¥æ˜¯æ•°æ®èŠ‚ç‚¹ï¼Œåˆå¯ä»¥æ˜¯Controlleræ§åˆ¶èŠ‚ç‚¹ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Šè¿™äº›é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹åŸºæœ¬ä¸ serrver.properties ä¸€è‡´ï¼Œåªæ˜¯å»é™¤äº†ä¸ zookeeper ç›¸å…³çš„é…ç½®é¡¹ï¼ŒåŒæ—¶å¢åŠ äº†ä¸€äº› Kraft æ¨¡å¼ä¸‹çš„é…ç½®é¡¹ã€‚å…³äº server.properties çš„é…ç½®é¡¹ï¼Œè¯·å‚è€ƒ <a href=\"https://kafka.apache.org/39/documentation/#brokerconfigs\">Kafka å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä»¥ <code>kraft/serrver.properties</code> ä¸ºä¾‹è¿›è¡Œä¿®æ”¹ï¼Œé…ç½®ä¸‰ä¸ªèŠ‚ç‚¹çš„Kafkaé›†ç¾¤ï¼Œæ¯ä¸ªèŠ‚ç‚¹å³æ˜¯ controller èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯ broker èŠ‚ç‚¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹é¢è¿™å››ä¸ªé…ç½®é¡¹æ˜¯ kraft æ¨¡å¼ä¸‹æ–°å¢åŠ çš„</span></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ã€‚Controllerç›¸å½“äºZookeeperçš„åŠŸèƒ½ï¼Œè´Ÿè´£é›†ç¾¤ç®¡ç†ã€‚Brokeræä¾›å…·ä½“çš„æ¶ˆæ¯è½¬å‘æœåŠ¡ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å³æ˜¯ Controller åˆæ˜¯ Brokerï¼Œä¹Ÿå¯ä»¥åªæ˜¯ Controller æˆ– Brokerã€‚</span></span><br><span class=\"line\">process.roles=broker,controller</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®å½“å‰èŠ‚ç‚¹çš„idã€‚ä¸æ™®é€šé›†ç¾¤ä¸€æ ·ï¼Œè¦æ±‚é›†ç¾¤å†…æ¯ä¸ªèŠ‚ç‚¹çš„IDä¸èƒ½é‡å¤ã€‚</span></span><br><span class=\"line\">node.id=1</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹ã€‚å…¶ä¸­@å‰é¢çš„æ˜¯èŠ‚ç‚¹çš„idï¼Œåé¢æ˜¯èŠ‚ç‚¹çš„åœ°å€å’Œç«¯å£ï¼Œè¿™ä¸ªç«¯å£è·Ÿå®¢æˆ·ç«¯è®¿é—®çš„ç«¯å£æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¦ä¸ CONTROLLER åè®®å¯¹åº”çš„ç«¯å£ä¸€è‡´ï¼Œè¿™é‡Œé…ç½®ä¸º 9098</span></span><br><span class=\"line\"><span class=\"comment\"># é€šå¸¸å°†é›†ç¾¤å†…çš„æ‰€æœ‰ControllorèŠ‚ç‚¹éƒ½é…ç½®è¿›å»ã€‚</span></span><br><span class=\"line\">controller.quorum.voters=1@worker1:9098,2@worker2:9098,3@worker3:9098</span><br><span class=\"line\"><span class=\"comment\"># ControlleræœåŠ¡åè®®çš„åˆ«åã€‚é»˜è®¤å°±æ˜¯CONTROLLER</span></span><br><span class=\"line\">controller.listener.names=CONTROLLER</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»¥ä¸‹é…ç½®é¡¹ä¸ä¹‹å‰ä¸€æ ·ï¼ŒæŒ‰éœ€è¿›è¡Œé…ç½®å³å¯</span></span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤é—´é€šä¿¡ä»ä½¿ç”¨å†…ç½‘</span></span><br><span class=\"line\">inter.broker.listener.name=PLAINTEXT</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç›‘å¬æœåŠ¡ã€‚ä¸åŒçš„æœåŠ¡å¯ä»¥ç»‘å®šä¸åŒçš„æ¥å£ã€‚è¿™ç§é…ç½®æ–¹å¼åœ¨ç«¯å£å‰é¢æ˜¯çœç•¥äº†ä¸€ä¸ªä¸»æœºIPçš„ï¼Œä¸»æœºIPé»˜è®¤æ˜¯ä½¿ç”¨çš„java.net.InetAddress.getCanonicalHostName()ï¼Œè¿™é‡ŒåŒæ—¶å¼€å¯å¤–ç½‘è®¿é—®ï¼Œå…³äº sasl_plaintext ã€sasl_sslåè®® çš„é…ç½®æ–¹å¼å‚è€ƒå‰æ–‡ kafka é€šä¿¡åè®®</span></span><br><span class=\"line\">listeners=PLAINTEXT://:9092,CONTROLLER://:9098,EXTERNAL://0.0.0.0:9093</span><br><span class=\"line\"><span class=\"comment\"># Brokerå¯¹å®¢æˆ·ç«¯æš´éœ²çš„æœåŠ¡åœ°å€ã€‚åŸºäºPLAINTEXTåè®®ã€‚è¿™é‡Œè¦æ›¿æ¢ä¸ºå„ä¸ªèŠ‚ç‚¹çš„IPåœ°å€</span></span><br><span class=\"line\">advertised.listeners=PLAINTEXT://worker1:9092,CONTROLLER://worker1:9098,EXTERNAL://161.189.227.200:9093</span><br><span class=\"line\"><span class=\"comment\"># å°†ç›‘å¬å™¨åç§°æ˜ å°„åˆ°å®‰å…¨åè®®ç±»å‹ï¼Œè¿™é‡Œ CONTROLLER åè®®å¯¹åº”çš„å®‰å…¨åè®®ç±»å‹ä¸º PLAINTEXT</span></span><br><span class=\"line\">listener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL,EXTERNAL:PLAINTEXT</span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®æ–‡ä»¶åœ°å€ã€‚é»˜è®¤é…ç½®åœ¨/tmpç›®å½•ä¸‹ã€‚</span></span><br><span class=\"line\">log.dirs=/usr/local/kafka/dataDir/kraft-logs</span><br><span class=\"line\"><span class=\"comment\"># topicé»˜è®¤çš„partitionåˆ†åŒºæ•°ã€‚</span></span><br><span class=\"line\">num.partitions=2</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¯åŠ¨Kafkaé›†ç¾¤\">å¯åŠ¨Kafkaé›†ç¾¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨å‰è¦å¯¹æ—¥å¿—ç›®å½•è¿›è¡Œæ ¼å¼åŒ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨worker1èŠ‚ç‚¹ä¸Šç”Ÿæˆé›†ç¾¤ID</span></span><br><span class=\"line\">$ kafka-storage.sh random-uuid</span><br><span class=\"line\">oGwJsVANRDKYwE7Lhn2zIA</span><br><span class=\"line\"><span class=\"comment\"># ç„¶ååœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ ¼å¼åŒ–æ—¥å¿—ç›®å½•ï¼Œæ³¨æ„ --cluster-id å¿…é¡»ä¸€è‡´</span></span><br><span class=\"line\"><span class=\"comment\"># å¿…é¡»åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨å‰æ‰§è¡Œ</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸å¯ä»¥é‡å¤æ‰§è¡Œï¼Œå¦åˆ™ä¼šæ¸…ç©ºæ•°æ®ç›®å½•å¹¶ç ´åå·²æœ‰å…ƒæ•°æ®</span></span><br><span class=\"line\"><span class=\"comment\"># åƒä¸‡ä¸è¦åœ¨å·²æœ‰ broker çš„æ•°æ®ç›®å½•ï¼ˆåŒ…å«æ¶ˆæ¯æ•°æ®çš„ log.dirsï¼‰ä¸Šè¿è¡Œ kafka-storage.sh format ï¼Œé‚£ä¼šæŠŠåŸæœ‰æ•°æ®ç»“æ„é‡ç½®æˆ–è¸©åã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å¿…é¡»æ˜ç¡®ï¼šæ ¼å¼åŒ–åªé’ˆå¯¹ æ–° controller çš„ metadata ç›®å½•ï¼ˆä¸”è¯¥ç›®å½•å¿…é¡»ä¸ºç©ºï¼‰ã€‚</span></span><br><span class=\"line\">$ kafka-storage.sh format --cluster-id oGwJsVANRDKYwE7Lhn2zIA --config /usr/local/kafka/kafka3/config/kraft/server.properties</span><br><span class=\"line\"><span class=\"comment\">## æ ¼å¼åŒ–åä¼šåœ¨æ—¥å¿—ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># bootstrap.checkpoint # å­˜å‚¨å…ƒæ•°æ®æ—¥å¿—ï¼ˆMetadata Logï¼‰å¯¹åº”çš„åˆå§‹å¿«ç…§åç§»é‡ï¼ˆsnapshot offsetï¼‰ã€‚ç”¨äºæ§åˆ¶å™¨åœ¨å¯åŠ¨æ—¶æ¢å¤çŠ¶æ€çš„èµ·ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># meta.properties # å­˜å‚¨èŠ‚ç‚¹å…ƒä¿¡æ¯ï¼šcluster.idã€node.idã€version ç­‰</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨é›†ç¾¤ï¼Œæ‰€ä»¥èŠ‚ç‚¹å¯åŠ¨ kafka æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/server.properties</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ³¨æ„äº‹é¡¹\">æ³¨æ„äº‹é¡¹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kafka é›†ç¾¤çš„å¯åŠ¨é¡ºåºä¸èƒ½ä¹±ï¼Œå¿…é¡»å…ˆå¯åŠ¨ Controller èŠ‚ç‚¹ï¼Œå†å¯åŠ¨ Broker èŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¿™é‡Œæ˜¯å°†èŠ‚ç‚¹åŒæ—¶åšä¸ºController å’Œ Broker ï¼Œå®é™…ç”Ÿäº§ç¯å¢ƒå»ºè®®åˆ†å¼€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Controller èŠ‚ç‚¹è‡³å°‘3ä¸ªï¼Œå»ºè®®é…ç½®ä¸ºå¥‡æ•°ä¸ªã€‚Broker èŠ‚ç‚¹æ•°é‡ä»»æ„ï¼Œä½†å»ºè®®è‡³å°‘2ä¸ªä»¥ä¸Šï¼Œä»¥ä¿è¯åˆ†åŒºçš„å¤‡ä»½å¯ä»¥åˆ†å¼€å­˜å‚¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Client ä»…èƒ½ä¸ Broker èŠ‚ç‚¹é€šä¿¡ï¼Œä¸èƒ½ä¸ Controller èŠ‚ç‚¹é€šä¿¡ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Kafka-4-0-çš„æ–°ç‰¹æ€§\">Kafka 4.0 çš„æ–°ç‰¹æ€§</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½»åº•ä»¥ KRaftï¼ˆKafka Raftï¼‰å–ä»£ ZooKeeperï¼ˆKRaft æˆä¸ºé»˜è®¤ä¸”å”¯ä¸€çš„å…ƒæ•°æ®ç®¡ç†ï¼‰</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è¯´æ˜ï¼š4.x ç³»åˆ—æ ‡å¿—æ€§å˜åŒ–æ˜¯å®Œå…¨ç§»é™¤ ZooKeeperï¼Œå…ƒæ•°æ®ç”± KRaft ç®¡ç†ï¼ˆController ä¸ Broker æ›´ç´§å¯†é›†æˆï¼‰ã€‚å¯¹è¿ç»´è€Œè¨€ï¼šä¸å†éƒ¨ç½²/ç»´æŠ¤ ZooKeeper é›†ç¾¤ã€å…ƒæ•°æ®è¿ç§»/æ ¼å¼åŒ–æ­¥éª¤æ˜¯å‡çº§æ—¶çš„å…³é”®ã€‚</li>\n<li class=\"lvl-4\">å½±å“/æç¤ºï¼šå¿…é¡»æŒ‰å®˜æ–¹è¿ç§»æµç¨‹æŠŠå…ƒæ•°æ®ä» ZK å¯¼å…¥ KRaftï¼ˆè‹¥ä»æ—§ç‰ˆæœ¬å‡çº§ï¼‰ã€‚æµ‹è¯•è¿ç§»/å¤‡ä»½å…ƒæ•°æ®æ˜¯å¿…é¡»é¡¹ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ–°çš„ consumer-group åè®®ï¼ˆæ›´é«˜æ•ˆçš„ rebalance/ç¾¤ç»„ç®¡ç†ï¼‰ä¸æ¶ˆè´¹æ¨¡å‹æ”¹è¿›ï¼ˆåŒ…æ‹¬â€œQueues/Shared Groupâ€æ”¯æŒï¼‰</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è¯´æ˜ï¼šå¼•å…¥/ç¨³å®šäº†æ–°çš„ Consumer Group åè®®ï¼ˆç›¸å…³ KIPï¼‰ï¼Œæ˜¾è‘—æ”¹å–„å¤§ç¾¤ç»„ä¸‹çš„é‡å¹³è¡¡å»¶è¿Ÿä¸ç¨³å®šæ€§ï¼›åŒæ—¶å¼•å…¥äº†ç±»ä¼¼â€œé˜Ÿåˆ—/å…±äº«ç»„ï¼ˆQueues for Kafkaï¼‰â€çš„æ¶ˆè´¹æ¨¡å¼ï¼ˆç”¨ä¾‹ï¼šç‚¹å¯¹ç‚¹æ¶ˆè´¹ï¼‰ï¼Œå…è®¸å¤šæ¶ˆè´¹è€…åŒæ—¶å¤„ç†åŒä¸€åˆ†åŒºæ¶ˆæ¯ã€‚</li>\n<li class=\"lvl-4\">å½±å“/æç¤ºï¼šå¦‚æœä½ æœ‰å¤§è§„æ¨¡æ¶ˆè´¹è€…ç¾¤ç»„æˆ–ä¾èµ–æ—§ rebalance è¡Œä¸ºï¼Œéœ€è¦æµ‹è¯•æ–°åè®®è¡Œä¸ºï¼›æŸäº›å®¢æˆ·ç«¯é…ç½®/è¡Œä¸ºå¯èƒ½éœ€è¦è°ƒæ•´ã€‚</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æŒ‡æ ‡ç±»åˆ«</th>\n<th>æ—§åè®®ï¼ˆEager Rebalanceï¼‰</th>\n<th>æ–°åè®®ï¼ˆIncremental / Cooperative Rebalanceï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é‡å¹³è¡¡å»¶è¿Ÿï¼ˆå¤§è§„æ¨¡ç¾¤ç»„ï¼‰</td>\n<td>çº¦ <strong>60 ç§’</strong>ï¼ˆä¸‡çº§æ¶ˆè´¹è€…è§„æ¨¡ï¼‰</td>\n<td>å°äº <strong>1 ç§’</strong>ï¼ˆæµ‹è¯•æ˜¾ç¤ºåœ¨åƒçº§ä»»åŠ¡æ—¶å¯åœ¨ä¸€åˆ†é’Ÿå†…å®Œæˆï¼‰ (<a href=\"https://www.confluent.io/blog/incremental-cooperative-rebalancing-in-kafka/?utm_source=chatgpt.com\" title=\"Incremental Cooperative Rebalancing in Apache Kafka\">Confluent</a>)</td>\n</tr>\n<tr>\n<td>èµ„æºæ¶ˆè€—ï¼ˆCPUï¼‰</td>\n<td>è¾ƒé«˜ï¼ˆåœ¨é‡å¹³è¡¡æœŸé—´ç³»ç»Ÿåœæ­¢æˆ–å¤§è§„æ¨¡è¿ç§»èµ„æºï¼‰</td>\n<td>æ®ç§°å¯é™ä½çº¦ <strong>70%</strong> çš„ CPUï¼ç³»ç»Ÿä¸­æ–­è´Ÿè·ï¼ˆç¤¾åŒºç»éªŒï¼‰</td>\n</tr>\n<tr>\n<td>æ¶ˆè´¹è€…ç¾¤ç»„æ‰©å±•ä¸Šé™</td>\n<td>é€‚ç”¨äºâ€œåƒçº§æ¶ˆè´¹è€…â€è§„æ¨¡</td>\n<td>å¯æ‰©å±•è‡³â€œåä¸‡çº§æ¶ˆè´¹è€…â€è§„æ¨¡ï¼ˆç†è®º/ç¤¾åŒºå®£ç§°ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th><strong>ç‰¹æ€§</strong></th>\n<th><strong>ä¼ ç»Ÿæ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰</strong></th>\n<th><strong>å…±äº«ç»„ï¼ˆShared Group / Queues for Kafkaï¼‰</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¹¶è¡Œæ¶ˆè´¹æ¨¡å‹</strong></td>\n<td>åˆ†åŒºæ•° = æ¶ˆè´¹è€…æ•°ï¼ˆä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼‰</td>\n<td>æ¶ˆè´¹è€…æ•° &gt; åˆ†åŒºæ•°ï¼ˆåŒä¸€åˆ†åŒºå¯ç”±å¤šä¸ªæ¶ˆè´¹è€…å¹¶è¡Œå¤„ç†ï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</strong></td>\n<td>é€šè¿‡æäº¤åç§»é‡ï¼ˆOffset Commitï¼‰å®ç°ç¡®è®¤</td>\n<td>æ¯æ¡æ¶ˆæ¯å•ç‹¬ç¡®è®¤ï¼ˆACK/NACK æœºåˆ¶ï¼‰</td>\n</tr>\n<tr>\n<td><strong>æŠ•é€’è¯­ä¹‰</strong></td>\n<td><strong>At-Least-Once</strong>ï¼ˆè‡³å°‘ä¸€æ¬¡æŠ•é€’ï¼‰</td>\n<td><strong>Exactly-Onceï¼ˆå¯é€‰ï¼‰</strong>ï¼Œæ”¯æŒç²¾ç¡®ä¸€æ¬¡å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>å…¸å‹åœºæ™¯</strong></td>\n<td>æµå¼æ—¥å¿—ã€ç›‘æ§ã€é¡ºåºæ€§è¦æ±‚é«˜çš„åœºæ™¯</td>\n<td>ä»»åŠ¡é˜Ÿåˆ—ã€å¹¶è¡Œè®¡ç®—ã€é«˜ååä»»åŠ¡å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>å®ç°æ–¹å¼</strong></td>\n<td>åŸºäº Topic-Partition åˆ†é…ä¸åç§»ç®¡ç†</td>\n<td>åŸºäºå…±äº«é˜Ÿåˆ—æ¨¡å‹ï¼Œå…è®¸å¤šæ¶ˆè´¹è€…ç«äº‰æ¶ˆè´¹åŒä¸€åˆ†åŒº</td>\n</tr>\n<tr>\n<td><strong>Kafka ç‰ˆæœ¬æ”¯æŒ</strong></td>\n<td>Kafka â‰¤ 3.x</td>\n<td>Kafka 4.x å¼•å…¥ï¼ˆKIP-932 â€œQueues for Kafkaâ€ï¼‰</td>\n</tr>\n<tr>\n<td><strong>ä¼˜åŠ¿</strong></td>\n<td>é¡ºåºä¿è¯å¼ºã€æ¨¡å‹æˆç†Ÿç¨³å®š</td>\n<td>å¹¶è¡Œèƒ½åŠ›å¼ºã€ååæå‡ã€æ”¯æŒç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰</td>\n</tr>\n<tr>\n<td><strong>åŠ£åŠ¿</strong></td>\n<td>åˆ†åŒºé™åˆ¶ååï¼Œæ‰©å±•å—é™</td>\n<td>é¡ºåºæ€§å¯èƒ½å‡å¼±ï¼Œå®ç°æ›´å¤æ‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤é•¿æœŸå¼ƒç”¨çš„æ—§ API / åè®®ï¼ˆå‘åä¸å…¼å®¹çš„æ¸…ç†ï¼‰</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è¯´æ˜ï¼š4.x ç§»é™¤äº†é‚£äº›å·²å¼ƒç”¨ â‰¥12 ä¸ªæœˆçš„æ¥å£/åè®®ï¼Œæ—¨åœ¨ç®€åŒ–ä»£ç åº“å¹¶é¼“åŠ±é‡‡ç”¨æ–°åŠŸèƒ½ã€‚</li>\n<li class=\"lvl-4\">å½±å“/æç¤ºï¼šå‡çº§å‰åŠ¡å¿…æ£€æŸ¥ä½ ä½¿ç”¨åˆ°çš„ Broker/Client/Streams/Connect API æ˜¯å¦ä¾èµ–è¢«ç§»é™¤çš„åŠŸèƒ½ï¼›æµ‹è¯•å®¢æˆ·ç«¯ä¸ç¬¬ä¸‰æ–¹ Connector/æ’ä»¶å…¼å®¹æ€§ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Java è¿è¡Œç¯å¢ƒæœ€ä½ç‰ˆæœ¬æ›´æ–°ï¼šClients/Streams ä¸ Broker/Tools çš„ JDK è¦æ±‚æé«˜</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è¯´æ˜ï¼šKafka 4.x å°†å®¢æˆ·ç«¯ï¼ˆKafka Clientsã€Kafka Streamsï¼‰ä¸ Broker/Connect/å·¥å…·åˆ†åˆ«æå‡ºäº†æ›´é«˜çš„ Java baselineï¼ˆClients/Streams æœ€ä½ Java 11ï¼ŒBroker/Connect/Tools æœ€ä½ Java 17 ç­‰ï¼‰ã€‚</li>\n<li class=\"lvl-4\">å½±å“/æç¤ºï¼šå‡çº§é›†ç¾¤å‰å…ˆç»Ÿä¸€å¹³å° JDK ç‰ˆæœ¬ï¼ŒCI/CD/å®¹å™¨é•œåƒä¹Ÿè¦å¯¹åº”æ›´æ–°ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>è®¸å¤šæ–°çš„ KIPï¼ˆåŠŸèƒ½å¢å¼ºï¼‰ä¸æ€§èƒ½/å¯è§‚æµ‹æ€§æ”¹è¿›</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è¯´æ˜ï¼šåŒ…å«æ”¹è¿›çš„ Streams rebalanceã€æ›´å¤š Admin/è¿ç»´å‘½ä»¤ã€èŠ‚ç‚¹æ³¨å†Œ/åˆ—ä¸¾èƒ½åŠ›ã€æ’ä»¶/æŒ‡æ ‡æ‰©å±•ç‚¹ç­‰ï¼ˆå¤šé¡¹ KIP åœ¨ 4.0/4.1 é™†ç»­è½åœ°ï¼‰ã€‚è¿™äº›æ”¹è¿›è¦†ç›– Brokerã€Controllerã€Producerã€Consumerã€Admin å’Œ Streams å­ç³»ç»Ÿã€‚</li>\n<li class=\"lvl-4\">å½±å“/æç¤ºï¼šè¿ç»´ä¸ç›‘æ§é¢æ¿å¯èƒ½å—ç›Šï¼ˆæ–°å¢å¯è§‚æµ‹æŒ‡æ ‡/APIï¼‰ï¼›å¦‚æœä½ æœ‰è‡ªå®šä¹‰æ’ä»¶æˆ–ç›‘æ§æ¥å…¥ï¼Œéœ€è¦æ£€æŸ¥æ–°çš„æ’ä»¶/metrics æ³¨å†Œæœºåˆ¶ã€‚</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº KRaft æ¨¡å¼ã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ æœ¬æ–‡çš„å®‰è£…æ–¹æ³•åŒæ ·é€‚ç”¨äº Kafka 4.x ç‰ˆæœ¬ï¼Œåªä¸è¿‡ Kafka 4.x ä¸­å·²ç»ä¸å†åŒ…å« ZooKeeper ç›¸å…³çš„é…ç½®æ–‡ä»¶ä»¥åŠç›¸å…³çš„å‘½ä»¤ï¼Œå¦å¤–è¦æ±‚JDK17+ã€‚ KRaft ç®€ä»‹ Kraft æ˜¯ Kafka ä» 2.8.0 ç‰ˆæœ¬ å¼€å§‹â½€æŒçš„â¼€ç§æ–°çš„é›†ç¾¤æ¶æ„â½…å¼ã€‚å…¶â½¬çš„ä¸»è¦æ˜¯ä¸ºäº†æ‘†è„±Kafkaå¯¹Zookeeperçš„ä¾èµ–ã€‚å› ä¸ºä»¥å¾€åŸºäºZookeeperæ­å»ºçš„é›†ç¾¤ï¼Œå¢åŠ äº†Kafkaæ¼”è¿›ä¸è¿ç»´çš„éš¾åº¦ï¼Œé€æ¸å¼€å§‹æˆä¸ºKakfaæ‹¥æŠ±äº‘åŸâ½£çš„â¼€ç§éšœç¢ã€‚ä½¿â½¤Krafté›†ç¾¤åï¼ŒKafkaé›†ç¾¤å°±ä¸å†éœ€è¦ä¾èµ–Zookeeperï¼Œå°†ä¹‹å‰åŸºäºZookeeperç®¡ç†çš„é›†ç¾¤æ•°æ®ï¼Œè½¬ä¸ºç”±Kafkaé›†ç¾¤â¾ƒâ¼°ç®¡ç†ã€‚ ä¼ ç»Ÿçš„Kafkaé›†ç¾¤ï¼Œä¼šå°†æ¯ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ç»Ÿä¸€ä¿å­˜åœ¨Zookeeperä¸­ï¼Œå¹¶é€šè¿‡ZookeeperåŠ¨æ€é€‰ä¸¾äº§ç”Ÿä¸€ä¸ªControllerèŠ‚ç‚¹ï¼Œé€šè¿‡ControllerèŠ‚ç‚¹æ¥ç®¡ç†Kafkaé›†ç¾¤ï¼Œæ¯”å¦‚è§¦å‘Partitionçš„é€‰ä¸¾ã€‚è€Œåœ¨Krafté›†ç¾¤ä¸­ï¼Œä¼šå›ºå®šé…ç½®å‡ å°BrokerèŠ‚ç‚¹æ¥å…±åŒæ‹…ä»»Controllerçš„è§’è‰²ï¼Œå„ç»„Partitionçš„LeaderèŠ‚ç‚¹å°±ä¼šç”±è¿™äº›Controlleré€‰ä¸¾äº§ç”Ÿã€‚åŸæœ¬ä¿å­˜åœ¨Zookeeperä¸­çš„å…ƒæ•°æ®ä¹Ÿè½¬è€Œä¿å­˜åˆ°ControllerèŠ‚ç‚¹ä¸­ã€‚ ğŸ§­ Kafka KRaft æ¨¡å¼ vs Zookeeper æ¨¡å¼ å¯¹æ¯”è¡¨ å¯¹æ¯”é¡¹ KRaft æ¨¡å¼ï¼ˆKafka Raft æ¨¡å¼ï¼‰ Zookeeper æ¨¡å¼ï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰ æ¶æ„ç»“æ„ å»ä¸­å¿ƒåŒ–æ¶æ„ï¼ŒKafka è‡ªèº«å†…ç½®æ§åˆ¶å¹³é¢ï¼Œä¸ä¾èµ–å¤–éƒ¨ Zookeeperã€‚ æ§åˆ¶å¹³é¢ä¾èµ–å¤–éƒ¨ Zookeeper é›†ç¾¤ï¼ŒKafka Broker åªè´Ÿè´£æ•°æ®å¹³é¢ã€‚ ç»„ä»¶æ•°é‡ æ— éœ€éƒ¨ç½² Zookeeperï¼Œåªæœ‰ Kafka Broker èŠ‚ç‚¹ã€‚ éœ€è¦å•ç‹¬ç»´æŠ¤ Zookeeper é›†ç¾¤ã€‚ å…ƒæ•°æ®å­˜å‚¨ å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka è‡ªèº«çš„å†…ç½®æ—¥å¿—ä¸­ï¼ˆ__cluster_metadata topicï¼‰ã€‚ å…ƒæ•°æ®å­˜å‚¨åœ¨ Zookeeper çš„ znode æ ‘ç»“æ„ä¸­ã€‚ ä¸€è‡´æ€§åè®® ä½¿ç”¨ Kafka è‡ªå·±å®ç°çš„ Raft åè®®ï¼ˆKRaftï¼‰æ¥ä¿è¯å…ƒæ•°æ®ä¸€è‡´æ€§ã€‚ ä½¿ç”¨ ZABï¼ˆZookeeper Atomic Broadcastï¼‰åè®®ä¿è¯ä¸€è‡´æ€§ã€‚ å¯åŠ¨é€Ÿåº¦ æ›´å¿«ï¼Œæ§åˆ¶å™¨å†…åµŒäº Broker ä¸­ï¼Œä¸éœ€è¦ç­‰å¾…å¤–éƒ¨ Zookeeper å¯åŠ¨ã€‚ å¯åŠ¨ä¾èµ– Zookeeperï¼Œå¯åŠ¨é¡ºåºå’Œè¿é€šæ€§è¦æ±‚æ›´ä¸¥æ ¼ã€‚ å®¹é”™æ€§ Raft æ§åˆ¶å™¨å…·å¤‡æ—¥å¿—å¤åˆ¶æœºåˆ¶ï¼Œå®¹é”™æ€§ä¸ Kafka æ•°æ®å‰¯æœ¬ä¸€è‡´ã€‚ å®¹é”™æ€§ç”± Zookeeper å†³å®šï¼ŒZookeeper æŒ‚æ‰å¯èƒ½å¯¼è‡´ Kafka æ§åˆ¶é¢ä¸å¯ç”¨ã€‚ æ‰©å±•æ€§ å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka ä¸»é¢˜ä¸­ï¼Œæ°´å¹³æ‰©å±•èƒ½åŠ›æ›´å¼ºã€‚ Zookeeper åœ¨é«˜åˆ†åŒºæ•°åœºæ™¯ä¸‹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚ è¿ç»´å¤æ‚åº¦ æ— éœ€ç»´æŠ¤ Zookeeper é›†ç¾¤ï¼Œç»Ÿä¸€è¿ç»´ Kafka å³å¯ã€‚ éœ€è¦é¢å¤–ç»´æŠ¤ Zookeeper é›†ç¾¤ï¼ˆç›‘æ§ã€æ‰©å®¹ã€å‡çº§ï¼‰ã€‚ æ•°æ®æ¢å¤ å…ƒæ•°æ®æ¢å¤ä¸ Kafka ä¸»é¢˜ä¸€è‡´ï¼Œå¯é€šè¿‡æ—¥å¿—å›æ”¾æ¢å¤ã€‚ Zookeeper æ•°æ®æ¢å¤ç›¸å¯¹å¤æ‚ï¼Œä¾èµ–å¿«ç…§å’Œäº‹åŠ¡æ—¥å¿—ã€‚ å®‰å…¨æœºåˆ¶ ç»Ÿä¸€ Kafka çš„å®‰å…¨æœºåˆ¶ï¼ˆSASLã€SSLã€ACL ç­‰ï¼‰ã€‚ Zookeeper æœ‰ç‹¬ç«‹çš„å®‰å…¨é…ç½®ä½“ç³»ï¼Œéœ€å•ç‹¬ç®¡ç†ã€‚ æ€§èƒ½è¡¨ç° å…ƒæ•°æ®æ“ä½œå»¶è¿Ÿæ›´ä½ï¼ˆæ§åˆ¶å™¨ä¸ Broker æœ¬åœ°é€šä¿¡ï¼‰ã€‚ å…ƒæ•°æ®æ“ä½œéœ€è¦è·¨è¿›ç¨‹ç½‘ç»œé€šä¿¡ï¼Œå»¶è¿Ÿæ›´é«˜ã€‚ æ§åˆ¶å™¨è§’è‰² ç”± Broker ä¸­çš„æ§åˆ¶å™¨ quorum é€‰ä¸¾äº§ç”Ÿï¼ˆæ”¯æŒå¤šæ§åˆ¶å™¨å€™é€‰ï¼‰ã€‚ ç”± Zookeeper é€‰ä¸¾æ§åˆ¶å™¨ï¼ˆå•ç‚¹æ§åˆ¶å™¨ï¼‰ã€‚ åˆ†åŒºä¸å‰¯æœ¬ç®¡ç† å…¨éƒ¨å…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka è‡ªèº«ï¼Œå¯å®ç°æ›´å¿«çš„åˆ†åŒºå˜æ›´å’Œæ‰©å®¹ã€‚ åˆ†åŒºã€å‰¯æœ¬å…ƒæ•°æ®åŒæ­¥ä¾èµ– Zookeeperï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒä½ã€‚ ç‰ˆæœ¬æ”¯æŒ ä» Kafka 2.8 å¼€å§‹å¼•å…¥ï¼ŒKafka 3.3+ å·²ç»éå¸¸ç¨³å®šï¼ŒKafka 3.5+ é»˜è®¤æ¨èã€‚ Kafka 3.5 å¼€å§‹æ ‡è®°ä¸ºâ€œLegacyâ€ï¼Œæœªæ¥ç‰ˆæœ¬è®¡åˆ’ç§»é™¤æ”¯æŒã€‚ å…¼å®¹æ€§ å¯é€šè¿‡å…ƒæ•°æ®è¿ç§»å·¥å…·ä» Zookeeper æ¨¡å¼å¹³æ»‘è¿ç§»ã€‚ ä¸èƒ½ç›´æ¥è¿ç§»åˆ° KRaftï¼Œéœ€è¦å·¥å…·è¾…åŠ©ã€‚ è¿ç»´ç›‘æ§ å•ä¸€ç³»ç»Ÿå¯ç›‘æ§ï¼ˆKafka è‡ªå¸¦çš„ JMXã€Prometheus ç­‰ï¼‰ã€‚ Kafka ä¸ Zookeeper å„è‡ªéœ€è¦ç‹¬ç«‹ç›‘æ§ä½“ç³»ã€‚ æœªæ¥å‘å±•æ–¹å‘ å®˜æ–¹æ¨èå’Œé»˜è®¤æ¨¡å¼ï¼ˆZookeeper æ¨¡å¼å°†é€æ­¥æ·˜æ±°ï¼‰ã€‚ å®˜æ–¹å·²ä¸å†å»ºè®®æ–°é›†ç¾¤ä½¿ç”¨ã€‚ Kafka çš„ KRaft é›†ç¾¤é…ç½® åœ¨Kafkaçš„configç›®å½•ä¸‹ï¼Œæä¾›äº†ä¸€ä¸ªkraftçš„æ–‡ä»¶å¤¹ï¼Œåœ¨è¿™é‡Œé¢æä¾›äº†ä¸‰ä¸ªKraftåè®®çš„å‚è€ƒé…ç½®æ–‡ä»¶ broker.properties: æ•°æ®èŠ‚ç‚¹ï¼Œclientè¿æ¥æ—¶åªè¿æ¥brokeræ•°æ®èŠ‚ç‚¹ controller.properties: Controlleræ§åˆ¶èŠ‚ç‚¹ server.properties: å³å¯ä»¥æ˜¯æ•°æ®èŠ‚ç‚¹ï¼Œåˆå¯ä»¥æ˜¯Controlleræ§åˆ¶èŠ‚ç‚¹ã€‚ å®é™…ä¸Šè¿™äº›é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹åŸºæœ¬ä¸ serrver.properties ä¸€è‡´ï¼Œåªæ˜¯å»é™¤äº†ä¸ zookeeper ç›¸å…³çš„é…ç½®é¡¹ï¼ŒåŒæ—¶å¢åŠ äº†ä¸€äº› Kraft æ¨¡å¼ä¸‹çš„é…ç½®é¡¹ã€‚å…³äº server.properties çš„é…ç½®é¡¹ï¼Œè¯·å‚è€ƒ Kafka å®˜æ–¹æ–‡æ¡£ è¿™é‡Œä»¥ kraft/serrver.properties ä¸ºä¾‹è¿›è¡Œä¿®æ”¹ï¼Œé…ç½®ä¸‰ä¸ªèŠ‚ç‚¹çš„Kafkaé›†ç¾¤ï¼Œæ¯ä¸ªèŠ‚ç‚¹å³æ˜¯ controller èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯ broker èŠ‚ç‚¹ 12345678910111213141516171819202122232425# ä¸‹é¢è¿™å››ä¸ªé…ç½®é¡¹æ˜¯ kraft æ¨¡å¼ä¸‹æ–°å¢åŠ çš„# é…ç½®å½“å‰èŠ‚ç‚¹çš„è§’è‰²ã€‚Controllerç›¸å½“äºZookeeperçš„åŠŸèƒ½ï¼Œè´Ÿè´£é›†ç¾¤ç®¡ç†ã€‚Brokeræä¾›å…·ä½“çš„æ¶ˆæ¯è½¬å‘æœåŠ¡ã€‚# ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å³æ˜¯ Controller åˆæ˜¯ Brokerï¼Œä¹Ÿå¯ä»¥åªæ˜¯ Controller æˆ– Brokerã€‚process.roles=broker,controller# é…ç½®å½“å‰èŠ‚ç‚¹çš„idã€‚ä¸æ™®é€šé›†ç¾¤ä¸€æ ·ï¼Œè¦æ±‚é›†ç¾¤å†…æ¯ä¸ªèŠ‚ç‚¹çš„IDä¸èƒ½é‡å¤ã€‚node.id=1# é…ç½®é›†ç¾¤çš„æŠ•ç¥¨èŠ‚ç‚¹ã€‚å…¶ä¸­@å‰é¢çš„æ˜¯èŠ‚ç‚¹çš„idï¼Œåé¢æ˜¯èŠ‚ç‚¹çš„åœ°å€å’Œç«¯å£ï¼Œè¿™ä¸ªç«¯å£è·Ÿå®¢æˆ·ç«¯è®¿é—®çš„ç«¯å£æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¦ä¸ CONTROLLER åè®®å¯¹åº”çš„ç«¯å£ä¸€è‡´ï¼Œè¿™é‡Œé…ç½®ä¸º 9098# é€šå¸¸å°†é›†ç¾¤å†…çš„æ‰€æœ‰ControllorèŠ‚ç‚¹éƒ½é…ç½®è¿›å»ã€‚controller.quorum.voters=1@worker1:9098,2@worker2:9098,3@worker3:9098# ControlleræœåŠ¡åè®®çš„åˆ«åã€‚é»˜è®¤å°±æ˜¯CONTROLLERcontroller.listener.names=CONTROLLER# ä»¥ä¸‹é…ç½®é¡¹ä¸ä¹‹å‰ä¸€æ ·ï¼ŒæŒ‰éœ€è¿›è¡Œé…ç½®å³å¯# é›†ç¾¤é—´é€šä¿¡ä»ä½¿ç”¨å†…ç½‘inter.broker.listener.name=PLAINTEXT# é…ç½®ç›‘å¬æœåŠ¡ã€‚ä¸åŒçš„æœåŠ¡å¯ä»¥ç»‘å®šä¸åŒçš„æ¥å£ã€‚è¿™ç§é…ç½®æ–¹å¼åœ¨ç«¯å£å‰é¢æ˜¯çœç•¥äº†ä¸€ä¸ªä¸»æœºIPçš„ï¼Œä¸»æœºIPé»˜è®¤æ˜¯ä½¿ç”¨çš„java.net.InetAddress.getCanonicalHostName()ï¼Œè¿™é‡ŒåŒæ—¶å¼€å¯å¤–ç½‘è®¿é—®ï¼Œå…³äº sasl_plaintext ã€sasl_sslåè®® çš„é…ç½®æ–¹å¼å‚è€ƒå‰æ–‡ kafka é€šä¿¡åè®®listeners=PLAINTEXT://:9092,CONTROLLER://:9098,EXTERNAL://0.0.0.0:9093# Brokerå¯¹å®¢æˆ·ç«¯æš´éœ²çš„æœåŠ¡åœ°å€ã€‚åŸºäºPLAINTEXTåè®®ã€‚è¿™é‡Œè¦æ›¿æ¢ä¸ºå„ä¸ªèŠ‚ç‚¹çš„IPåœ°å€advertised.listeners=PLAINTEXT://worker1:9092,CONTROLLER://worker1:9098,EXTERNAL://161.189.227.200:9093# å°†ç›‘å¬å™¨åç§°æ˜ å°„åˆ°å®‰å…¨åè®®ç±»å‹ï¼Œè¿™é‡Œ CONTROLLER åè®®å¯¹åº”çš„å®‰å…¨åè®®ç±»å‹ä¸º PLAINTEXTlistener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL,EXTERNAL:PLAINTEXT# æ•°æ®æ–‡ä»¶åœ°å€ã€‚é»˜è®¤é…ç½®åœ¨/tmpç›®å½•ä¸‹ã€‚log.dirs=/usr/local/kafka/dataDir/kraft-logs# topicé»˜è®¤çš„partitionåˆ†åŒºæ•°ã€‚num.partitions=2 å¯åŠ¨Kafkaé›†ç¾¤ å¯åŠ¨å‰è¦å¯¹æ—¥å¿—ç›®å½•è¿›è¡Œæ ¼å¼åŒ– 123456789101112# åœ¨worker1èŠ‚ç‚¹ä¸Šç”Ÿæˆé›†ç¾¤ID$ kafka-storage.sh random-uuidoGwJsVANRDKYwE7Lhn2zIA# ç„¶ååœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ ¼å¼åŒ–æ—¥å¿—ç›®å½•ï¼Œæ³¨æ„ --cluster-id å¿…é¡»ä¸€è‡´# å¿…é¡»åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨å‰æ‰§è¡Œ# ä¸å¯ä»¥é‡å¤æ‰§è¡Œï¼Œå¦åˆ™ä¼šæ¸…ç©ºæ•°æ®ç›®å½•å¹¶ç ´åå·²æœ‰å…ƒæ•°æ®# åƒä¸‡ä¸è¦åœ¨å·²æœ‰ broker çš„æ•°æ®ç›®å½•ï¼ˆåŒ…å«æ¶ˆæ¯æ•°æ®çš„ log.dirsï¼‰ä¸Šè¿è¡Œ kafka-storage.sh format ï¼Œé‚£ä¼šæŠŠåŸæœ‰æ•°æ®ç»“æ„é‡ç½®æˆ–è¸©åã€‚# å¿…é¡»æ˜ç¡®ï¼šæ ¼å¼åŒ–åªé’ˆå¯¹ æ–° controller çš„ metadata ç›®å½•ï¼ˆä¸”è¯¥ç›®å½•å¿…é¡»ä¸ºç©ºï¼‰ã€‚$ kafka-storage.sh format --cluster-id oGwJsVANRDKYwE7Lhn2zIA --config /usr/local/kafka/kafka3/config/kraft/server.properties## æ ¼å¼åŒ–åä¼šåœ¨æ—¥å¿—ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶# bootstrap.checkpoint # å­˜å‚¨å…ƒæ•°æ®æ—¥å¿—ï¼ˆMetadata Logï¼‰å¯¹åº”çš„åˆå§‹å¿«ç…§åç§»é‡ï¼ˆsnapshot offsetï¼‰ã€‚ç”¨äºæ§åˆ¶å™¨åœ¨å¯åŠ¨æ—¶æ¢å¤çŠ¶æ€çš„èµ·ç‚¹ã€‚# meta.properties # å­˜å‚¨èŠ‚ç‚¹å…ƒä¿¡æ¯ï¼šcluster.idã€node.idã€version ç­‰ å¯åŠ¨é›†ç¾¤ï¼Œæ‰€ä»¥èŠ‚ç‚¹å¯åŠ¨ kafka æœåŠ¡ 1kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/kraft/server.properties æ³¨æ„äº‹é¡¹ Kafka é›†ç¾¤çš„å¯åŠ¨é¡ºåºä¸èƒ½ä¹±ï¼Œå¿…é¡»å…ˆå¯åŠ¨ Controller èŠ‚ç‚¹ï¼Œå†å¯åŠ¨ Broker èŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¿™é‡Œæ˜¯å°†èŠ‚ç‚¹åŒæ—¶åšä¸ºController å’Œ Broker ï¼Œå®é™…ç”Ÿäº§ç¯å¢ƒå»ºè®®åˆ†å¼€ã€‚ Controller èŠ‚ç‚¹è‡³å°‘3ä¸ªï¼Œå»ºè®®é…ç½®ä¸ºå¥‡æ•°ä¸ªã€‚Broker èŠ‚ç‚¹æ•°é‡ä»»æ„ï¼Œä½†å»ºè®®è‡³å°‘2ä¸ªä»¥ä¸Šï¼Œä»¥ä¿è¯åˆ†åŒºçš„å¤‡ä»½å¯ä»¥åˆ†å¼€å­˜å‚¨ã€‚ Client ä»…èƒ½ä¸ Broker èŠ‚ç‚¹é€šä¿¡ï¼Œä¸èƒ½ä¸ Controller èŠ‚ç‚¹é€šä¿¡ã€‚ Kafka 4.0 çš„æ–°ç‰¹æ€§ å½»åº•ä»¥ KRaftï¼ˆKafka Raftï¼‰å–ä»£ ZooKeeperï¼ˆKRaft æˆä¸ºé»˜è®¤ä¸”å”¯ä¸€çš„å…ƒæ•°æ®ç®¡ç†ï¼‰ è¯´æ˜ï¼š4.x ç³»åˆ—æ ‡å¿—æ€§å˜åŒ–æ˜¯å®Œå…¨ç§»é™¤ ZooKeeperï¼Œå…ƒæ•°æ®ç”± KRaft ç®¡ç†ï¼ˆController ä¸ Broker æ›´ç´§å¯†é›†æˆï¼‰ã€‚å¯¹è¿ç»´è€Œè¨€ï¼šä¸å†éƒ¨ç½²/ç»´æŠ¤ ZooKeeper é›†ç¾¤ã€å…ƒæ•°æ®è¿ç§»/æ ¼å¼åŒ–æ­¥éª¤æ˜¯å‡çº§æ—¶çš„å…³é”®ã€‚ å½±å“/æç¤ºï¼šå¿…é¡»æŒ‰å®˜æ–¹è¿ç§»æµç¨‹æŠŠå…ƒæ•°æ®ä» ZK å¯¼å…¥ KRaftï¼ˆè‹¥ä»æ—§ç‰ˆæœ¬å‡çº§ï¼‰ã€‚æµ‹è¯•è¿ç§»/å¤‡ä»½å…ƒæ•°æ®æ˜¯å¿…é¡»é¡¹ã€‚ æ–°çš„ consumer-group åè®®ï¼ˆæ›´é«˜æ•ˆçš„ rebalance/ç¾¤ç»„ç®¡ç†ï¼‰ä¸æ¶ˆè´¹æ¨¡å‹æ”¹è¿›ï¼ˆåŒ…æ‹¬â€œQueues/Shared Groupâ€æ”¯æŒï¼‰ è¯´æ˜ï¼šå¼•å…¥/ç¨³å®šäº†æ–°çš„ Consumer Group åè®®ï¼ˆç›¸å…³ KIPï¼‰ï¼Œæ˜¾è‘—æ”¹å–„å¤§ç¾¤ç»„ä¸‹çš„é‡å¹³è¡¡å»¶è¿Ÿä¸ç¨³å®šæ€§ï¼›åŒæ—¶å¼•å…¥äº†ç±»ä¼¼â€œé˜Ÿåˆ—/å…±äº«ç»„ï¼ˆQueues for Kafkaï¼‰â€çš„æ¶ˆè´¹æ¨¡å¼ï¼ˆç”¨ä¾‹ï¼šç‚¹å¯¹ç‚¹æ¶ˆè´¹ï¼‰ï¼Œå…è®¸å¤šæ¶ˆè´¹è€…åŒæ—¶å¤„ç†åŒä¸€åˆ†åŒºæ¶ˆæ¯ã€‚ å½±å“/æç¤ºï¼šå¦‚æœä½ æœ‰å¤§è§„æ¨¡æ¶ˆè´¹è€…ç¾¤ç»„æˆ–ä¾èµ–æ—§ rebalance è¡Œä¸ºï¼Œéœ€è¦æµ‹è¯•æ–°åè®®è¡Œä¸ºï¼›æŸäº›å®¢æˆ·ç«¯é…ç½®/è¡Œä¸ºå¯èƒ½éœ€è¦è°ƒæ•´ã€‚ æŒ‡æ ‡ç±»åˆ« æ—§åè®®ï¼ˆEager Rebalanceï¼‰ æ–°åè®®ï¼ˆIncremental / Cooperative Rebalanceï¼‰ é‡å¹³è¡¡å»¶è¿Ÿï¼ˆå¤§è§„æ¨¡ç¾¤ç»„ï¼‰ çº¦ 60 ç§’ï¼ˆä¸‡çº§æ¶ˆè´¹è€…è§„æ¨¡ï¼‰ å°äº 1 ç§’ï¼ˆæµ‹è¯•æ˜¾ç¤ºåœ¨åƒçº§ä»»åŠ¡æ—¶å¯åœ¨ä¸€åˆ†é’Ÿå†…å®Œæˆï¼‰ (Confluent) èµ„æºæ¶ˆè€—ï¼ˆCPUï¼‰ è¾ƒé«˜ï¼ˆåœ¨é‡å¹³è¡¡æœŸé—´ç³»ç»Ÿåœæ­¢æˆ–å¤§è§„æ¨¡è¿ç§»èµ„æºï¼‰ æ®ç§°å¯é™ä½çº¦ 70% çš„ CPUï¼ç³»ç»Ÿä¸­æ–­è´Ÿè·ï¼ˆç¤¾åŒºç»éªŒï¼‰ æ¶ˆè´¹è€…ç¾¤ç»„æ‰©å±•ä¸Šé™ é€‚ç”¨äºâ€œåƒçº§æ¶ˆè´¹è€…â€è§„æ¨¡ å¯æ‰©å±•è‡³â€œåä¸‡çº§æ¶ˆè´¹è€…â€è§„æ¨¡ï¼ˆç†è®º/ç¤¾åŒºå®£ç§°ï¼‰ ç‰¹æ€§ ä¼ ç»Ÿæ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰ å…±äº«ç»„ï¼ˆShared Group / Queues for Kafkaï¼‰ å¹¶è¡Œæ¶ˆè´¹æ¨¡å‹ åˆ†åŒºæ•° = æ¶ˆè´¹è€…æ•°ï¼ˆä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼‰ æ¶ˆè´¹è€…æ•° &gt; åˆ†åŒºæ•°ï¼ˆåŒä¸€åˆ†åŒºå¯ç”±å¤šä¸ªæ¶ˆè´¹è€…å¹¶è¡Œå¤„ç†ï¼‰ æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ é€šè¿‡æäº¤åç§»é‡ï¼ˆOffset Commitï¼‰å®ç°ç¡®è®¤ æ¯æ¡æ¶ˆæ¯å•ç‹¬ç¡®è®¤ï¼ˆACK/NACK æœºåˆ¶ï¼‰ æŠ•é€’è¯­ä¹‰ At-Least-Onceï¼ˆè‡³å°‘ä¸€æ¬¡æŠ•é€’ï¼‰ Exactly-Onceï¼ˆå¯é€‰ï¼‰ï¼Œæ”¯æŒç²¾ç¡®ä¸€æ¬¡å¤„ç† å…¸å‹åœºæ™¯ æµå¼æ—¥å¿—ã€ç›‘æ§ã€é¡ºåºæ€§è¦æ±‚é«˜çš„åœºæ™¯ ä»»åŠ¡é˜Ÿåˆ—ã€å¹¶è¡Œè®¡ç®—ã€é«˜ååä»»åŠ¡å¤„ç† å®ç°æ–¹å¼ åŸºäº Topic-Partition åˆ†é…ä¸åç§»ç®¡ç† åŸºäºå…±äº«é˜Ÿåˆ—æ¨¡å‹ï¼Œå…è®¸å¤šæ¶ˆè´¹è€…ç«äº‰æ¶ˆè´¹åŒä¸€åˆ†åŒº Kafka ç‰ˆæœ¬æ”¯æŒ Kafka â‰¤ 3.x Kafka 4.x å¼•å…¥ï¼ˆKIP-932 â€œQueues for Kafkaâ€ï¼‰ ä¼˜åŠ¿ é¡ºåºä¿è¯å¼ºã€æ¨¡å‹æˆç†Ÿç¨³å®š å¹¶è¡Œèƒ½åŠ›å¼ºã€ååæå‡ã€æ”¯æŒç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰ åŠ£åŠ¿ åˆ†åŒºé™åˆ¶ååï¼Œæ‰©å±•å—é™ é¡ºåºæ€§å¯èƒ½å‡å¼±ï¼Œå®ç°æ›´å¤æ‚ åˆ é™¤é•¿æœŸå¼ƒç”¨çš„æ—§ API / åè®®ï¼ˆå‘åä¸å…¼å®¹çš„æ¸…ç†ï¼‰ è¯´æ˜ï¼š4.x ç§»é™¤äº†é‚£äº›å·²å¼ƒç”¨ â‰¥12 ä¸ªæœˆçš„æ¥å£/åè®®ï¼Œæ—¨åœ¨ç®€åŒ–ä»£ç åº“å¹¶é¼“åŠ±é‡‡ç”¨æ–°åŠŸèƒ½ã€‚ å½±å“/æç¤ºï¼šå‡çº§å‰åŠ¡å¿…æ£€æŸ¥ä½ ä½¿ç”¨åˆ°çš„ Broker/Client/Streams/Connect API æ˜¯å¦ä¾èµ–è¢«ç§»é™¤çš„åŠŸèƒ½ï¼›æµ‹è¯•å®¢æˆ·ç«¯ä¸ç¬¬ä¸‰æ–¹ Connector/æ’ä»¶å…¼å®¹æ€§ã€‚ Java è¿è¡Œç¯å¢ƒæœ€ä½ç‰ˆæœ¬æ›´æ–°ï¼šClients/Streams ä¸ Broker/Tools çš„ JDK è¦æ±‚æé«˜ è¯´æ˜ï¼šKafka 4.x å°†å®¢æˆ·ç«¯ï¼ˆKafka Clientsã€Kafka Streamsï¼‰ä¸ Broker/Connect/å·¥å…·åˆ†åˆ«æå‡ºäº†æ›´é«˜çš„ Java baselineï¼ˆClients/Streams æœ€ä½ Java 11ï¼ŒBroker/Connect/Tools æœ€ä½ Java 17 ç­‰ï¼‰ã€‚ å½±å“/æç¤ºï¼šå‡çº§é›†ç¾¤å‰å…ˆç»Ÿä¸€å¹³å° JDK ç‰ˆæœ¬ï¼ŒCI/CD/å®¹å™¨é•œåƒä¹Ÿè¦å¯¹åº”æ›´æ–°ã€‚ è®¸å¤šæ–°çš„ KIPï¼ˆåŠŸèƒ½å¢å¼ºï¼‰ä¸æ€§èƒ½/å¯è§‚æµ‹æ€§æ”¹è¿› è¯´æ˜ï¼šåŒ…å«æ”¹è¿›çš„ Streams rebalanceã€æ›´å¤š Admin/è¿ç»´å‘½ä»¤ã€èŠ‚ç‚¹æ³¨å†Œ/åˆ—ä¸¾èƒ½åŠ›ã€æ’ä»¶/æŒ‡æ ‡æ‰©å±•ç‚¹ç­‰ï¼ˆå¤šé¡¹ KIP åœ¨ 4.0/4.1 é™†ç»­è½åœ°ï¼‰ã€‚è¿™äº›æ”¹è¿›è¦†ç›– Brokerã€Controllerã€Producerã€Consumerã€Admin å’Œ Streams å­ç³»ç»Ÿã€‚ å½±å“/æç¤ºï¼šè¿ç»´ä¸ç›‘æ§é¢æ¿å¯èƒ½å—ç›Šï¼ˆæ–°å¢å¯è§‚æµ‹æŒ‡æ ‡/APIï¼‰ï¼›å¦‚æœä½ æœ‰è‡ªå®šä¹‰æ’ä»¶æˆ–ç›‘æ§æ¥å…¥ï¼Œéœ€è¦æ£€æŸ¥æ–°çš„æ’ä»¶/metrics æ³¨å†Œæœºåˆ¶ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº KRaft æ¨¡å¼ã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ æœ¬æ–‡çš„å®‰è£…æ–¹æ³•åŒæ ·é€‚ç”¨äº Kafka 4.x ç‰ˆæœ¬ï¼Œåªä¸è¿‡ Kafka 4.x ä¸­å·²ç»ä¸å†åŒ…å« ZooKeeper ç›¸å…³çš„é…ç½®æ–‡ä»¶ä»¥åŠç›¸å…³çš„å‘½ä»¤ï¼Œå¦å¤–è¦æ±‚JDK17+ã€‚","date_published":"2025-10-16T13:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/10/15/kafka-04-command/","url":"https://blog.hanqunfeng.com/2025/10/15/kafka-04-command/","title":"Kafka çš„ å¸¸ç”¨å‘½ä»¤","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Kafka çš„ å¸¸ç”¨å‘½ä»¤</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/kafka-3-demo\">Java-Client ä»£ç ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"topic\">topic</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º topic</span></span><br><span class=\"line\">kafka-topics.sh --create --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span> --partitions 3 --replication-factor 2</span><br><span class=\"line\"><span class=\"comment\"># --bootstrap-server æŒ‡å®š kafka é›†ç¾¤åœ°å€</span></span><br><span class=\"line\"><span class=\"comment\"># --topic åˆ›å»ºçš„ topic åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># --partitions æŒ‡å®šåˆ†åŒºæ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼</span></span><br><span class=\"line\"><span class=\"comment\"># --replication-factor æŒ‡å®šå‰¯æœ¬æ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡º topic</span></span><br><span class=\"line\">kafka-topics.sh --list --bootstrap-server localhost:9092</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ topic è¯¦æƒ…</span></span><br><span class=\"line\">kafka-topics.sh --describe --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">Topic: <span class=\"built_in\">test</span>\tTopicId: Ru0tWQJ4RMWcjjGsKAdWQg\tPartitionCount: 3\tReplicationFactor: 3\tConfigs:</span><br><span class=\"line\">\tTopic: <span class=\"built_in\">test</span>\tPartition: 0\tLeader: 3\tReplicas: 3,1,2\tIsr: 3,2,1\tElr: N/A\tLastKnownElr: N/A</span><br><span class=\"line\">\tTopic: <span class=\"built_in\">test</span>\tPartition: 1\tLeader: 1\tReplicas: 1,2,3\tIsr: 3,2,1\tElr: N/A\tLastKnownElr: N/A</span><br><span class=\"line\">\tTopic: <span class=\"built_in\">test</span>\tPartition: 2\tLeader: 2\tReplicas: 2,3,1\tIsr: 3,2,1\tElr: N/A\tLastKnownElr: N/A</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºè¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># æ€»ä½“ä¿¡æ¯ï¼ˆTopic æ¦‚è§ˆï¼‰Topic: test\tTopicId: Ru0tWQJ4RMWcjjGsKAdWQg\tPartitionCount: 3\tReplicationFactor: 3\tConfigs:</span></span><br><span class=\"line\">| å­—æ®µ                                  | å«ä¹‰                                                            |</span><br><span class=\"line\">| ----------------------------------- | ------------------------------------------------------------- |</span><br><span class=\"line\">| **Topic: disTopic**                 | Topic åç§°ï¼Œå³å½“å‰æè¿°çš„ä¸»é¢˜ã€‚                                            |</span><br><span class=\"line\">| **TopicId: VUK7Mc9oQdS1mjGG7OhQzQ** | Kafka å†…éƒ¨è‡ªåŠ¨ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUUIDï¼‰ï¼ŒKafka 3.x ä¹‹åå¼•å…¥ï¼Œç”¨äºåŒºåˆ†åŒåä½†ä¸åŒç”Ÿå‘½å‘¨æœŸçš„ topicã€‚ |</span><br><span class=\"line\">| **PartitionCount: 3**               | è¯¥ä¸»é¢˜æœ‰ 3 ä¸ªåˆ†åŒºï¼ˆpartitionï¼‰ã€‚æ¯ä¸ªåˆ†åŒºå­˜å‚¨ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚                            |</span><br><span class=\"line\">| **ReplicationFactor:**              | å‰¯æœ¬å› å­ã€‚è¿™é‡Œè™½ç„¶è¾“å‡ºä¸­æ²¡æ˜¾ç¤ºå…·ä½“å€¼ï¼Œä½†å¯ä»æ¯è¡Œåˆ†åŒºé…ç½®æ¨æ–­æ˜¯ **3**ï¼ˆæ¯ä¸ªåˆ†åŒºæœ‰ 3 ä¸ªå‰¯æœ¬ï¼‰ã€‚           |</span><br><span class=\"line\">| **Configs:**                        | topic çš„é…ç½®é¡¹ï¼ˆä¾‹å¦‚æ¸…ç†ç­–ç•¥ã€å‹ç¼©ç±»å‹ç­‰ï¼‰ï¼Œå¦‚æœä¸ºç©ºï¼Œè¯´æ˜ä½¿ç”¨é»˜è®¤é…ç½®ã€‚                       |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ†åŒºè¯¦æƒ…ï¼ˆæ¯ä¸ª Partition ä¸€è¡Œï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">| å­—æ®µ                                | å«ä¹‰                                                          |</span><br><span class=\"line\">| --------------------------------- | ----------------------------------------------------------- |</span><br><span class=\"line\">| **Partition: 0**                  | ç¬¬ 0 å·åˆ†åŒºã€‚                                                    |</span><br><span class=\"line\">| **Leader: 2**                     | è¯¥åˆ†åŒºå½“å‰çš„ **Leader Broker æ˜¯ broker ID = 2**ï¼Œåªæœ‰ Leader æ‰å¤„ç†è¯»å†™è¯·æ±‚ã€‚ |</span><br><span class=\"line\">| **Replicas: 2,3,1**               | è¯¥åˆ†åŒºçš„æ‰€æœ‰å‰¯æœ¬å­˜æ”¾åœ¨å“ªäº› Broker ä¸Šï¼ˆå³å‰¯æœ¬åˆ†å¸ƒ,ARï¼‰ï¼Œåˆ†åˆ«æ˜¯ broker 2ã€3ã€1ã€‚             |</span><br><span class=\"line\">| **Isr (In-Sync Replicas): 2,3,1** | å½“å‰ä¸ Leader ä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆã€‚è¿™é‡Œæ‰€æœ‰å‰¯æœ¬éƒ½åœ¨åŒæ­¥ä¸­ï¼ˆå¥åº·çŠ¶æ€ ğŸ‘ï¼‰ã€‚                  |</span><br><span class=\"line\">| **Elr / LastKnownElr**            | Kafka æ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„ <span class=\"string\">&quot;Enhanced Leader Replica&quot;</span> çŠ¶æ€ï¼Œç›®å‰æœªå¯ç”¨ï¼ˆN/Aï¼‰ã€‚      |</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ topic</span></span><br><span class=\"line\">kafka-topics.sh --delete --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"consumer\">consumer</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º consumer</span></span><br><span class=\"line\">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span> --group <span class=\"built_in\">test</span></span><br><span class=\"line\"><span class=\"comment\"># --topic æŒ‡å®š topic</span></span><br><span class=\"line\"><span class=\"comment\"># --group æŒ‡å®š consumer ç»„</span></span><br><span class=\"line\"></span><br><span class=\"line\">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span>  --from-beginning</span><br><span class=\"line\"><span class=\"comment\"># --from-beginning ä» topic çš„æœ€å¼€å§‹æ¶ˆè´¹</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"consumer-group\">consumer-group</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡º consumer ç»„</span></span><br><span class=\"line\">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list</span><br><span class=\"line\"><span class=\"comment\"># --bootstrap-server é›†ç¾¤åœ°å€</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ consumer ç»„è¯¦æƒ…</span></span><br><span class=\"line\">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group <span class=\"built_in\">test</span></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">GROUP  TOPIC  PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG  CONSUMER-ID                                             HOST         CLIENT-ID</span><br><span class=\"line\"><span class=\"built_in\">test</span>   <span class=\"built_in\">test</span>   0          2               2               0    console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1  /10.250.0.7   console-consumer</span><br><span class=\"line\"><span class=\"built_in\">test</span>   <span class=\"built_in\">test</span>   1          2               2               0    console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1  /10.250.0.7   console-consumer</span><br><span class=\"line\"><span class=\"built_in\">test</span>   <span class=\"built_in\">test</span>   2          1               1               0    console-consumer-9ac45b29-d8f3-4649-ab09-7b567aa2ba53  /10.250.0.108 console-consumer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºè¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># GROUP       æ¶ˆè´¹ç»„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># TOPIC       topic åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># PARTITION   åˆ†åŒºç¼–å·</span></span><br><span class=\"line\"><span class=\"comment\"># CURRENT-OFFSET  å½“å‰æ¶ˆè´¹çš„ offset</span></span><br><span class=\"line\"><span class=\"comment\"># LOG-END-OFFSET   topic ä¸­æœ€å¤§çš„ offset</span></span><br><span class=\"line\"><span class=\"comment\"># LAG         å½“å‰æ¶ˆè´¹çš„ offset ä¸ topic ä¸­æœ€å¤§çš„ offset çš„å·®å€¼ï¼Œå³å‰©ä½™æœªæ¶ˆè´¹çš„ æ¶ˆæ¯æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># CONSUMER-ID  å½“å‰æ¶ˆè´¹çš„ consumer çš„ id</span></span><br><span class=\"line\"><span class=\"comment\"># HOST        å½“å‰æ¶ˆè´¹çš„ consumer çš„ä¸»æœºå</span></span><br><span class=\"line\"><span class=\"comment\"># CLIENT-ID   å½“å‰æ¶ˆè´¹çš„ consumer çš„å®¢æˆ·ç«¯åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ consumer ç»„</span></span><br><span class=\"line\">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --delete --group <span class=\"built_in\">test</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"producer\">producer</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º producer</span></span><br><span class=\"line\">kafka-console-producer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span></span><br><span class=\"line\"><span class=\"comment\"># --topic æŒ‡å®š topic</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ‰‹åŠ¨è§¦å‘-Kafka-Partitoin-çš„-Leader-é€‰ä¸¾-è‡ªå¹³è¡¡\">æ‰‹åŠ¨è§¦å‘ Kafka Partitoin çš„ Leader é€‰ä¸¾(è‡ªå¹³è¡¡)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>kafkaçš„è‡ªå¹³è¡¡é»˜è®¤å¼€å¯ï¼Œæ¯éš” 300ç§’æ‰«æä¸€æ¬¡ï¼Œå¦‚æœéœ€è¦å¹³è¡¡çš„æ¯”ä¾‹é«˜äº 10%ï¼Œåˆ™ä¼šè§¦å‘ä¸€æ¬¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¼€å¯è‡ªåŠ¨å¹³è¡¡</span></span><br><span class=\"line\">auto.leader.rebalance.enable=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># é—´éš”æ‰«ææ—¶é—´ é»˜è®¤ 300 ç§’</span></span><br><span class=\"line\">eader.imbalance.check.interval.seconds=300</span><br><span class=\"line\"><span class=\"comment\"># è§¦å‘æ¯”ä¾‹ï¼Œå³æ‰«æçš„ broker ä¸Šéœ€è¦å¹³è¡¡çš„ partition å å½“å‰ broker å…¨éƒ¨ partition çš„æ¯”ä¾‹ï¼Œé»˜è®¤ 10%</span></span><br><span class=\"line\">leader.imbalance.per.broker.percentage=10</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å»ºè®®å…³é—­ï¼Œæ”¹ä¸ºä¸šåŠ¡ä½å³°æ—¶æ‰‹åŠ¨è§¦å‘</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è‡ªåŠ¨å¹³è¡¡</span></span><br><span class=\"line\">kafka-leader-election.sh --bootstrap-server localhost:9092  --election-type preferred --topic <span class=\"built_in\">test</span> --partition 0</span><br><span class=\"line\"><span class=\"comment\"># --topic æŒ‡å®šè¦è§¦å‘çš„ topic</span></span><br><span class=\"line\"><span class=\"comment\"># --partition 0 è§¦å‘ partition 0 çš„ leader é€‰ä¸¾</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ğŸ§© å‚æ•°è¯´æ˜ï¼šâ€“election-type</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°å€¼</th>\n<th>å«ä¹‰</th>\n<th>è§¦å‘æ¡ä»¶</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><code>preferred</code></strong></td>\n<td><strong>é¦–é€‰ Leader é€‰ä¸¾</strong>ï¼ˆPreferred Leader Electionï¼‰<br>Kafka ä¼šå°è¯•å°†åˆ†åŒºçš„ leader é‡æ–°åˆ‡æ¢ä¸ºã€Œé¦–é€‰å‰¯æœ¬ã€ï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªå‰¯æœ¬ï¼‰ã€‚</td>\n<td>åªæœ‰å½“å‰ leader <strong>ä¸æ˜¯</strong> é¦–é€‰å‰¯æœ¬æ—¶æ‰æ‰§è¡Œã€‚</td>\n<td>æŸäº›å‰¯æœ¬è¢«è‡ªåŠ¨é€‰ä¸¾æˆ leader åï¼Œå¸Œæœ›æ¢å¤åŸæœ‰ã€Œé¦–é€‰ leaderã€ç»“æ„ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</td>\n</tr>\n<tr>\n<td><strong><code>unclean</code></strong></td>\n<td><strong>éå¹²å‡€ Leader é€‰ä¸¾</strong>ï¼ˆUnclean Leader Electionï¼‰<br>å…è®¸ä»ä¸åŒæ­¥çš„å‰¯æœ¬ä¸­é€‰ä¸¾æ–°çš„ leaderã€‚</td>\n<td>ä»…åœ¨åˆ†åŒº <strong>æ²¡æœ‰å¯ç”¨ leader</strong> æ—¶æ‰§è¡Œã€‚</td>\n<td>åœ¨ç´§æ€¥æ¢å¤åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚æ‰€æœ‰ ISR å‰¯æœ¬éƒ½ä¸‹çº¿ï¼‰ï¼Œä¸ºäº†æ¢å¤æœåŠ¡å¯ç”¨æ€§ï¼Œå³ä½¿ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Leader Partitionâ¾ƒåŠ¨å¹³è¡¡æœºåˆ¶</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-6\">Leader Partitoiné€‰ä¸¾æœºåˆ¶èƒ½å¤Ÿä¿è¯æ¯â¼€ä¸ªPartitionåŒâ¼€æ—¶åˆ»æœ‰ä¸”ä»…æœ‰â¼€ä¸ªLeader Partitionã€‚ä½†æ˜¯ï¼Œæ˜¯ä¸æ˜¯åªè¦åˆ†é…å¥½äº†Leader Partitionå°±å¤Ÿäº†å‘¢ï¼Ÿ</li>\n<li class=\"lvl-6\">åœ¨â¼€ç»„Partitonä¸­ï¼ŒLeader Partitioné€šå¸¸æ˜¯â½è¾ƒç¹å¿™çš„èŠ‚ç‚¹ï¼Œå› ä¸ºä»–è¦è´Ÿè´£ä¸å®¢æˆ·ç«¯çš„æ•°æ®äº¤äº’ï¼Œä»¥åŠå‘FolloweråŒæ­¥æ•°æ®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKafkaä¼šå°½é‡å°†Leader Partitionåˆ†é…åˆ°ä¸åŒçš„BrokerèŠ‚ç‚¹ä¸Šï¼Œâ½¤ä»¥ä¿è¯æ•´ä¸ªé›†ç¾¤çš„æ€§èƒ½å‹â¼’èƒ½å¤Ÿâ½è¾ƒå¹³å‡ã€‚</li>\n<li class=\"lvl-6\">ä½†æ˜¯ï¼Œç»è¿‡Leader Partitioné€‰ä¸¾åï¼Œè¿™ç§å¹³è¡¡å°±æœ‰å¯èƒ½ä¼šè¢«æ‰“ç ´ï¼Œè®©Leader Partitionè¿‡å¤šçš„é›†ä¸­åˆ°åŒâ¼€ä¸ªBrokerä¸Šã€‚è¿™æ ·ï¼Œè¿™ä¸ªBrokerçš„å‹â¼’å°±ä¼šæ˜æ˜¾â¾¼äºå…¶ä»–Brokerï¼Œä»â½½å½±å“åˆ°é›†ç¾¤çš„æ•´ä½“æ€§èƒ½ã€‚</li>\n<li class=\"lvl-6\">ä¸ºæ­¤ï¼ŒKafkaè®¾è®¡äº†Leader Partitionâ¾ƒåŠ¨å¹³è¡¡æœºåˆ¶ï¼Œå½“å‘ç°Leaderåˆ†é…ä¸å‡è¡¡æ—¶ï¼Œâ¾ƒåŠ¨è¿›â¾Leader Partitionè°ƒæ•´ã€‚</li>\n<li class=\"lvl-6\">Kafkaåœ¨è¿›â¾Leader Partitionâ¾ƒå¹³è¡¡æ—¶çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼šä»–ä¼šè®¤ä¸ºAR(Replicaså‰¯æœ¬é›†)å½“ä¸­çš„ç¬¬â¼€ä¸ªèŠ‚ç‚¹å°±åº”è¯¥æ˜¯LeaderèŠ‚ç‚¹ã€‚è¿™ç§é€‰ä¸¾ç»“æœæˆä¸ºpreferred election ç†æƒ³é€‰ä¸¾ç»“æœã€‚</li>\n<li class=\"lvl-6\">Controllerä¼šå®šæœŸæ£€æµ‹é›†ç¾¤çš„Partitionå¹³è¡¡æƒ…å†µï¼Œåœ¨å¼€å§‹æ£€æµ‹æ—¶ï¼ŒControllerä¼šä¾æ¬¡æ£€æŸ¥æ‰€æœ‰çš„Brokerã€‚å½“å‘ç°è¿™ä¸ªBrokerä¸Šçš„ä¸å¹³è¡¡çš„Partitionâ½ä¾‹â¾¼äº<code>leader.imbalance.per.broker.percentage</code>é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè§¦å‘â¼€æ¬¡Leader Partitonçš„â¾ƒå¹³è¡¡ã€‚</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ å¸¸ç”¨å‘½ä»¤ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Java-Client ä»£ç ç¤ºä¾‹ topic 12345678910111213141516171819202122232425262728293031323334353637383940# åˆ›å»º topickafka-topics.sh --create --bootstrap-server localhost:9092 --topic test --partitions 3 --replication-factor 2# --bootstrap-server æŒ‡å®š kafka é›†ç¾¤åœ°å€# --topic åˆ›å»ºçš„ topic åç§°# --partitions æŒ‡å®šåˆ†åŒºæ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼# --replication-factor æŒ‡å®šå‰¯æœ¬æ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼# åˆ—å‡º topickafka-topics.sh --list --bootstrap-server localhost:9092# æŸ¥çœ‹ topic è¯¦æƒ…kafka-topics.sh --describe --bootstrap-server localhost:9092 --topic test## è¾“å‡ºTopic: test TopicId: Ru0tWQJ4RMWcjjGsKAdWQg PartitionCount: 3 ReplicationFactor: 3 Configs: Topic: test Partition: 0 Leader: 3 Replicas: 3,1,2 Isr: 3,2,1 Elr: N/A LastKnownElr: N/A Topic: test Partition: 1 Leader: 1 Replicas: 1,2,3 Isr: 3,2,1 Elr: N/A LastKnownElr: N/A Topic: test Partition: 2 Leader: 2 Replicas: 2,3,1 Isr: 3,2,1 Elr: N/A LastKnownElr: N/A## è¾“å‡ºè¯´æ˜# æ€»ä½“ä¿¡æ¯ï¼ˆTopic æ¦‚è§ˆï¼‰Topic: test TopicId: Ru0tWQJ4RMWcjjGsKAdWQg PartitionCount: 3 ReplicationFactor: 3 Configs:| å­—æ®µ | å«ä¹‰ || ----------------------------------- | ------------------------------------------------------------- || **Topic: disTopic** | Topic åç§°ï¼Œå³å½“å‰æè¿°çš„ä¸»é¢˜ã€‚ || **TopicId: VUK7Mc9oQdS1mjGG7OhQzQ** | Kafka å†…éƒ¨è‡ªåŠ¨ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUUIDï¼‰ï¼ŒKafka 3.x ä¹‹åå¼•å…¥ï¼Œç”¨äºåŒºåˆ†åŒåä½†ä¸åŒç”Ÿå‘½å‘¨æœŸçš„ topicã€‚ || **PartitionCount: 3** | è¯¥ä¸»é¢˜æœ‰ 3 ä¸ªåˆ†åŒºï¼ˆpartitionï¼‰ã€‚æ¯ä¸ªåˆ†åŒºå­˜å‚¨ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚ || **ReplicationFactor:** | å‰¯æœ¬å› å­ã€‚è¿™é‡Œè™½ç„¶è¾“å‡ºä¸­æ²¡æ˜¾ç¤ºå…·ä½“å€¼ï¼Œä½†å¯ä»æ¯è¡Œåˆ†åŒºé…ç½®æ¨æ–­æ˜¯ **3**ï¼ˆæ¯ä¸ªåˆ†åŒºæœ‰ 3 ä¸ªå‰¯æœ¬ï¼‰ã€‚ || **Configs:** | topic çš„é…ç½®é¡¹ï¼ˆä¾‹å¦‚æ¸…ç†ç­–ç•¥ã€å‹ç¼©ç±»å‹ç­‰ï¼‰ï¼Œå¦‚æœä¸ºç©ºï¼Œè¯´æ˜ä½¿ç”¨é»˜è®¤é…ç½®ã€‚ |# åˆ†åŒºè¯¦æƒ…ï¼ˆæ¯ä¸ª Partition ä¸€è¡Œï¼‰| å­—æ®µ | å«ä¹‰ || --------------------------------- | ----------------------------------------------------------- || **Partition: 0** | ç¬¬ 0 å·åˆ†åŒºã€‚ || **Leader: 2** | è¯¥åˆ†åŒºå½“å‰çš„ **Leader Broker æ˜¯ broker ID = 2**ï¼Œåªæœ‰ Leader æ‰å¤„ç†è¯»å†™è¯·æ±‚ã€‚ || **Replicas: 2,3,1** | è¯¥åˆ†åŒºçš„æ‰€æœ‰å‰¯æœ¬å­˜æ”¾åœ¨å“ªäº› Broker ä¸Šï¼ˆå³å‰¯æœ¬åˆ†å¸ƒ,ARï¼‰ï¼Œåˆ†åˆ«æ˜¯ broker 2ã€3ã€1ã€‚ || **Isr (In-Sync Replicas): 2,3,1** | å½“å‰ä¸ Leader ä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆã€‚è¿™é‡Œæ‰€æœ‰å‰¯æœ¬éƒ½åœ¨åŒæ­¥ä¸­ï¼ˆå¥åº·çŠ¶æ€ ğŸ‘ï¼‰ã€‚ || **Elr / LastKnownElr** | Kafka æ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„ &quot;Enhanced Leader Replica&quot; çŠ¶æ€ï¼Œç›®å‰æœªå¯ç”¨ï¼ˆN/Aï¼‰ã€‚ |# åˆ é™¤ topickafka-topics.sh --delete --bootstrap-server localhost:9092 --topic test consumer 1234567# åˆ›å»º consumerkafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --group test# --topic æŒ‡å®š topic# --group æŒ‡å®š consumer ç»„kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning# --from-beginning ä» topic çš„æœ€å¼€å§‹æ¶ˆè´¹ consumer-group 12345678910111213141516171819202122232425# åˆ—å‡º consumer ç»„kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list# --bootstrap-server é›†ç¾¤åœ°å€# æŸ¥çœ‹ consumer ç»„è¯¦æƒ…kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group test## è¾“å‡ºGROUP TOPIC PARTITION CURRENT-OFFSET LOG-END-OFFSET LAG CONSUMER-ID HOST CLIENT-IDtest test 0 2 2 0 console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1 /10.250.0.7 console-consumertest test 1 2 2 0 console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1 /10.250.0.7 console-consumertest test 2 1 1 0 console-consumer-9ac45b29-d8f3-4649-ab09-7b567aa2ba53 /10.250.0.108 console-consumer## è¾“å‡ºè¯´æ˜# GROUP æ¶ˆè´¹ç»„åç§°# TOPIC topic åç§°# PARTITION åˆ†åŒºç¼–å·# CURRENT-OFFSET å½“å‰æ¶ˆè´¹çš„ offset# LOG-END-OFFSET topic ä¸­æœ€å¤§çš„ offset# LAG å½“å‰æ¶ˆè´¹çš„ offset ä¸ topic ä¸­æœ€å¤§çš„ offset çš„å·®å€¼ï¼Œå³å‰©ä½™æœªæ¶ˆè´¹çš„ æ¶ˆæ¯æ•°é‡# CONSUMER-ID å½“å‰æ¶ˆè´¹çš„ consumer çš„ id# HOST å½“å‰æ¶ˆè´¹çš„ consumer çš„ä¸»æœºå# CLIENT-ID å½“å‰æ¶ˆè´¹çš„ consumer çš„å®¢æˆ·ç«¯åç§°# åˆ é™¤ consumer ç»„kafka-consumer-groups.sh --bootstrap-server localhost:9092 --delete --group test producer 123# åˆ›å»º producerkafka-console-producer.sh --bootstrap-server localhost:9092 --topic test# --topic æŒ‡å®š topic æ‰‹åŠ¨è§¦å‘ Kafka Partitoin çš„ Leader é€‰ä¸¾(è‡ªå¹³è¡¡) kafkaçš„è‡ªå¹³è¡¡é»˜è®¤å¼€å¯ï¼Œæ¯éš” 300ç§’æ‰«æä¸€æ¬¡ï¼Œå¦‚æœéœ€è¦å¹³è¡¡çš„æ¯”ä¾‹é«˜äº 10%ï¼Œåˆ™ä¼šè§¦å‘ä¸€æ¬¡ 123456# å¼€å¯è‡ªåŠ¨å¹³è¡¡auto.leader.rebalance.enable=true# é—´éš”æ‰«ææ—¶é—´ é»˜è®¤ 300 ç§’eader.imbalance.check.interval.seconds=300# è§¦å‘æ¯”ä¾‹ï¼Œå³æ‰«æçš„ broker ä¸Šéœ€è¦å¹³è¡¡çš„ partition å å½“å‰ broker å…¨éƒ¨ partition çš„æ¯”ä¾‹ï¼Œé»˜è®¤ 10%leader.imbalance.per.broker.percentage=10 å»ºè®®å…³é—­ï¼Œæ”¹ä¸ºä¸šåŠ¡ä½å³°æ—¶æ‰‹åŠ¨è§¦å‘ 1234# è‡ªåŠ¨å¹³è¡¡kafka-leader-election.sh --bootstrap-server localhost:9092 --election-type preferred --topic test --partition 0# --topic æŒ‡å®šè¦è§¦å‘çš„ topic# --partition 0 è§¦å‘ partition 0 çš„ leader é€‰ä¸¾ ğŸ§© å‚æ•°è¯´æ˜ï¼šâ€“election-type å‚æ•°å€¼ å«ä¹‰ è§¦å‘æ¡ä»¶ å…¸å‹ä½¿ç”¨åœºæ™¯ preferred é¦–é€‰ Leader é€‰ä¸¾ï¼ˆPreferred Leader Electionï¼‰Kafka ä¼šå°è¯•å°†åˆ†åŒºçš„ leader é‡æ–°åˆ‡æ¢ä¸ºã€Œé¦–é€‰å‰¯æœ¬ã€ï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªå‰¯æœ¬ï¼‰ã€‚ åªæœ‰å½“å‰ leader ä¸æ˜¯ é¦–é€‰å‰¯æœ¬æ—¶æ‰æ‰§è¡Œã€‚ æŸäº›å‰¯æœ¬è¢«è‡ªåŠ¨é€‰ä¸¾æˆ leader åï¼Œå¸Œæœ›æ¢å¤åŸæœ‰ã€Œé¦–é€‰ leaderã€ç»“æ„ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ unclean éå¹²å‡€ Leader é€‰ä¸¾ï¼ˆUnclean Leader Electionï¼‰å…è®¸ä»ä¸åŒæ­¥çš„å‰¯æœ¬ä¸­é€‰ä¸¾æ–°çš„ leaderã€‚ ä»…åœ¨åˆ†åŒº æ²¡æœ‰å¯ç”¨ leader æ—¶æ‰§è¡Œã€‚ åœ¨ç´§æ€¥æ¢å¤åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚æ‰€æœ‰ ISR å‰¯æœ¬éƒ½ä¸‹çº¿ï¼‰ï¼Œä¸ºäº†æ¢å¤æœåŠ¡å¯ç”¨æ€§ï¼Œå³ä½¿ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ Leader Partitionâ¾ƒåŠ¨å¹³è¡¡æœºåˆ¶ Leader Partitoiné€‰ä¸¾æœºåˆ¶èƒ½å¤Ÿä¿è¯æ¯â¼€ä¸ªPartitionåŒâ¼€æ—¶åˆ»æœ‰ä¸”ä»…æœ‰â¼€ä¸ªLeader Partitionã€‚ä½†æ˜¯ï¼Œæ˜¯ä¸æ˜¯åªè¦åˆ†é…å¥½äº†Leader Partitionå°±å¤Ÿäº†å‘¢ï¼Ÿ åœ¨â¼€ç»„Partitonä¸­ï¼ŒLeader Partitioné€šå¸¸æ˜¯â½è¾ƒç¹å¿™çš„èŠ‚ç‚¹ï¼Œå› ä¸ºä»–è¦è´Ÿè´£ä¸å®¢æˆ·ç«¯çš„æ•°æ®äº¤äº’ï¼Œä»¥åŠå‘FolloweråŒæ­¥æ•°æ®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKafkaä¼šå°½é‡å°†Leader Partitionåˆ†é…åˆ°ä¸åŒçš„BrokerèŠ‚ç‚¹ä¸Šï¼Œâ½¤ä»¥ä¿è¯æ•´ä¸ªé›†ç¾¤çš„æ€§èƒ½å‹â¼’èƒ½å¤Ÿâ½è¾ƒå¹³å‡ã€‚ ä½†æ˜¯ï¼Œç»è¿‡Leader Partitioné€‰ä¸¾åï¼Œè¿™ç§å¹³è¡¡å°±æœ‰å¯èƒ½ä¼šè¢«æ‰“ç ´ï¼Œè®©Leader Partitionè¿‡å¤šçš„é›†ä¸­åˆ°åŒâ¼€ä¸ªBrokerä¸Šã€‚è¿™æ ·ï¼Œè¿™ä¸ªBrokerçš„å‹â¼’å°±ä¼šæ˜æ˜¾â¾¼äºå…¶ä»–Brokerï¼Œä»â½½å½±å“åˆ°é›†ç¾¤çš„æ•´ä½“æ€§èƒ½ã€‚ ä¸ºæ­¤ï¼ŒKafkaè®¾è®¡äº†Leader Partitionâ¾ƒåŠ¨å¹³è¡¡æœºåˆ¶ï¼Œå½“å‘ç°Leaderåˆ†é…ä¸å‡è¡¡æ—¶ï¼Œâ¾ƒåŠ¨è¿›â¾Leader Partitionè°ƒæ•´ã€‚ Kafkaåœ¨è¿›â¾Leader Partitionâ¾ƒå¹³è¡¡æ—¶çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼šä»–ä¼šè®¤ä¸ºAR(Replicaså‰¯æœ¬é›†)å½“ä¸­çš„ç¬¬â¼€ä¸ªèŠ‚ç‚¹å°±åº”è¯¥æ˜¯LeaderèŠ‚ç‚¹ã€‚è¿™ç§é€‰ä¸¾ç»“æœæˆä¸ºpreferred election ç†æƒ³é€‰ä¸¾ç»“æœã€‚ Controllerä¼šå®šæœŸæ£€æµ‹é›†ç¾¤çš„Partitionå¹³è¡¡æƒ…å†µï¼Œåœ¨å¼€å§‹æ£€æµ‹æ—¶ï¼ŒControllerä¼šä¾æ¬¡æ£€æŸ¥æ‰€æœ‰çš„Brokerã€‚å½“å‘ç°è¿™ä¸ªBrokerä¸Šçš„ä¸å¹³è¡¡çš„Partitionâ½ä¾‹â¾¼äºleader.imbalance.per.broker.percentageé˜ˆå€¼æ—¶ï¼Œå°±ä¼šè§¦å‘â¼€æ¬¡Leader Partitonçš„â¾ƒå¹³è¡¡ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ å¸¸ç”¨å‘½ä»¤ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Java-Client ä»£ç ç¤ºä¾‹","date_published":"2025-10-15T12:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/10/14/kafka-01-server-config/","url":"https://blog.hanqunfeng.com/2025/10/14/kafka-01-server-config/","title":"Kafka çš„ server.properties é…ç½®é¡¹","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„ server.properties çš„é…ç½®é¡¹ï¼ŒåŸºäº Zookeeperã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Kafka-3-x-server-properties-ä¸»è¦é…ç½®é¡¹æ¸…å•\">Kafka 3.x server.properties ä¸»è¦é…ç½®é¡¹æ¸…å•</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…³äº server.properties çš„é…ç½®é¡¹ï¼Œè¯·å‚è€ƒ <a href=\"https://kafka.apache.org/39/documentation/#brokerconfigs\">Kafka å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åˆ†ç±»</th>\n<th>å‚æ•°å</th>\n<th>é»˜è®¤å€¼</th>\n<th>è¯´æ˜</th>\n<th>æ¨è/å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ğŸ—‚ï¸ <strong>åŸºæœ¬ä¿¡æ¯</strong></td>\n<td><code>broker.id</code></td>\n<td>0</td>\n<td>Broker å”¯ä¸€æ ‡è¯†</td>\n<td>é›†ç¾¤ä¸­å¿…é¡»å”¯ä¸€</td>\n</tr>\n<tr>\n<td></td>\n<td><code>node.id</code></td>\n<td>-</td>\n<td>Raft æ¨¡å¼ï¼ˆKRaftï¼‰ä¸‹ä½¿ç”¨</td>\n<td>ZK æ¨¡å¼å¿½ç•¥</td>\n</tr>\n<tr>\n<td></td>\n<td><code>process.roles</code></td>\n<td>-</td>\n<td>KRaft æ¨¡å¼è§’è‰²ï¼ˆcontroller, brokerï¼‰</td>\n<td>ZK æ¨¡å¼ä¸é…ç½®</td>\n</tr>\n<tr>\n<td>ğŸ”Œ <strong>ç½‘ç»œä¸ç›‘å¬é…ç½®</strong></td>\n<td><code>listeners</code></td>\n<td>PLAINTEXT://:9092</td>\n<td>Broker ç›‘å¬åœ°å€</td>\n<td>å¯ç”¨å¤šä¸ªåè®®ï¼Œå¦‚ SASL_PLAINTEXT, SSL</td>\n</tr>\n<tr>\n<td></td>\n<td><code>advertised.listeners</code></td>\n<td>-</td>\n<td>å®¢æˆ·ç«¯è¿æ¥æ—¶çœ‹åˆ°çš„åœ°å€</td>\n<td>å¤–ç½‘è®¿é—®éœ€é…ç½®</td>\n</tr>\n<tr>\n<td></td>\n<td><code>listener.security.protocol.map</code></td>\n<td>PLAINTEXT:PLAINTEXT</td>\n<td>æ˜ å°„ç›‘å¬å™¨åè®®</td>\n<td>å¤šåè®®æ—¶é…ç½®</td>\n</tr>\n<tr>\n<td></td>\n<td><code>inter.broker.listener.name</code></td>\n<td>-ï¼ˆKafka 2.4+ é»˜è®¤ç¬¬ä¸€ä¸ª listenerï¼‰</td>\n<td>æŒ‡å®š broker é—´é€šä¿¡ä½¿ç”¨å“ªä¸ª listenerï¼ˆå¦‚ INTERNALï¼‰</td>\n<td>é›†ç¾¤å†…éƒ¨é€šä¿¡å¿…é¡»ä¸€è‡´ï¼›å¸¸é…åˆå¤š listener ä½¿ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>num.network.threads</code></td>\n<td>3</td>\n<td>ç½‘ç»œçº¿ç¨‹æ•°</td>\n<td>ä¸€èˆ¬ä¸éœ€ä¿®æ”¹</td>\n</tr>\n<tr>\n<td></td>\n<td><code>num.io.threads</code></td>\n<td>8</td>\n<td>å¤„ç†è¯·æ±‚çš„ IO çº¿ç¨‹æ•°</td>\n<td>æ ¹æ® CPU è°ƒæ•´</td>\n</tr>\n<tr>\n<td></td>\n<td><code>socket.send.buffer.bytes</code></td>\n<td>102400</td>\n<td>å‘é€ç¼“å†²åŒºå¤§å°</td>\n<td>ç½‘ç»œä¼˜åŒ–å‚æ•°</td>\n</tr>\n<tr>\n<td></td>\n<td><code>socket.receive.buffer.bytes</code></td>\n<td>102400</td>\n<td>æ¥æ”¶ç¼“å†²åŒºå¤§å°</td>\n<td>ç½‘ç»œä¼˜åŒ–å‚æ•°</td>\n</tr>\n<tr>\n<td></td>\n<td><code>socket.request.max.bytes</code></td>\n<td>104857600</td>\n<td>å•è¯·æ±‚æœ€å¤§å¤§å° (100MB)</td>\n<td>å¤§æ¶ˆæ¯éœ€è°ƒå¤§</td>\n</tr>\n<tr>\n<td>âš™ï¸ <strong>é›†ç¾¤ä¸å…ƒæ•°æ®</strong></td>\n<td><code>log.dirs</code></td>\n<td>/tmp/kafka-logs</td>\n<td>æ•°æ®å­˜å‚¨è·¯å¾„</td>\n<td>å¤šç›®å½•å¯æå‡æ€§èƒ½</td>\n</tr>\n<tr>\n<td></td>\n<td><code>num.recovery.threads.per.data.dir</code></td>\n<td>1</td>\n<td>æ¯ä¸ªæ•°æ®ç›®å½•çš„æ¢å¤çº¿ç¨‹æ•°</td>\n<td>å¤šç£ç›˜æ—¶å¯å¢åŠ </td>\n</tr>\n<tr>\n<td></td>\n<td><code>auto.create.topics.enable</code></td>\n<td>true</td>\n<td>æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topic</td>\n<td>ç”Ÿäº§å»ºè®®ç¦ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>controlled.shutdown.enable</code></td>\n<td>true</td>\n<td>ä¼˜é›…å…³é—­ Broker</td>\n<td>å»ºè®®å¼€å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>delete.topic.enable</code></td>\n<td>true</td>\n<td>æ˜¯å¦å…è®¸åˆ é™¤ Topic</td>\n<td>ç”Ÿäº§æ…ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>auto.leader.rebalance.enable</code></td>\n<td>true</td>\n<td>æ˜¯å¦è‡ªåŠ¨å‡è¡¡ Leader</td>\n<td>å»ºè®®å¼€å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>leader.imbalance.check.interval.seconds</code></td>\n<td>300</td>\n<td>æ£€æŸ¥ leader å¤±è¡¡é—´éš”</td>\n<td>ä¸ä¸Šé…åˆä½¿ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>leader.imbalance.per.broker.percentage</code></td>\n<td>10</td>\n<td>è§¦å‘ leader é‡å¹³è¡¡çš„é˜ˆå€¼</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td>ğŸ§± <strong>å‰¯æœ¬ä¸å¤åˆ¶æœºåˆ¶</strong></td>\n<td><code>default.replication.factor</code></td>\n<td>1</td>\n<td>æ–° Topic é»˜è®¤å‰¯æœ¬æ•°</td>\n<td>ç”Ÿäº§å»ºè®® 3</td>\n</tr>\n<tr>\n<td></td>\n<td><code>offsets.topic.replication.factor</code></td>\n<td>1</td>\n<td>æ¶ˆè´¹ç»„åç§»ä¸»é¢˜å‰¯æœ¬æ•°</td>\n<td>å»ºè®® 3</td>\n</tr>\n<tr>\n<td></td>\n<td><code>transaction.state.log.replication.factor</code></td>\n<td>1</td>\n<td>äº‹åŠ¡çŠ¶æ€ä¸»é¢˜å‰¯æœ¬æ•°</td>\n<td>å»ºè®® 3</td>\n</tr>\n<tr>\n<td></td>\n<td><code>transaction.state.log.min.isr</code></td>\n<td>1</td>\n<td>äº‹åŠ¡çŠ¶æ€æ—¥å¿—æœ€å° ISR æ•°</td>\n<td>å»ºè®® 2</td>\n</tr>\n<tr>\n<td></td>\n<td><code>min.insync.replicas</code></td>\n<td>1</td>\n<td>Leader å†™å…¥æ—¶è¦æ±‚çš„æœ€å° ISR å‰¯æœ¬æ•°</td>\n<td>å»ºè®® <code>replication.factor - 1</code></td>\n</tr>\n<tr>\n<td></td>\n<td><code>unclean.leader.election.enable</code></td>\n<td>false</td>\n<td>æ˜¯å¦å…è®¸éåŒæ­¥å‰¯æœ¬é€‰ä¸º leader</td>\n<td>ç”Ÿäº§å»ºè®® false</td>\n</tr>\n<tr>\n<td></td>\n<td><code>num.replica.fetchers</code></td>\n<td>1</td>\n<td>follower æ‹‰å–çº¿ç¨‹æ•°</td>\n<td>å¯æå‡å¤åˆ¶æ€§èƒ½</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetch.max.bytes</code></td>\n<td>1048576 (1MB)</td>\n<td>follower æ‹‰å–å•åˆ†åŒºæœ€å¤§æ•°æ®é‡</td>\n<td>å¢å¤§å¯æé€Ÿ</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetch.response.max.bytes</code></td>\n<td>10485760 (10MB)</td>\n<td>follower ä¸€æ¬¡æ‹‰å–å“åº”æ€»é‡</td>\n<td>å¯è°ƒå¤§</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetch.wait.max.ms</code></td>\n<td>500</td>\n<td>follower ç­‰å¾…æ–°æ•°æ®çš„æœ€å¤§æ—¶é•¿</td>\n<td>å»¶è¿Ÿä¸ååæŠ˜ä¸­</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetch.backoff.ms</code></td>\n<td>1000</td>\n<td>æ‹‰å–å¤±è´¥åé€€é¿æ—¶é—´</td>\n<td>ç½‘ç»œä¸ç¨³æ—¶è°ƒæ•´</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.socket.timeout.ms</code></td>\n<td>30000</td>\n<td>follower ä¸ leader é€šä¿¡è¶…æ—¶</td>\n<td>â‰¥ <a href=\"http://fetch.wait.ms\">fetch.wait.ms</a></td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.socket.receive.buffer.bytes</code></td>\n<td>65536</td>\n<td>æ‹‰å– socket ç¼“å†²åŒº</td>\n<td>è°ƒå¤§å¯æé€Ÿ</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.lag.time.max.ms</code></td>\n<td>10000</td>\n<td>follower è½å leader çš„æœ€å¤§æ—¶é—´</td>\n<td>å½±å“ ISR</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.high.watermark.checkpoint.interval.ms</code></td>\n<td>5000</td>\n<td>é«˜æ°´ä½å†™å…¥ checkpoint å‘¨æœŸ</td>\n<td>å½±å“æ¢å¤é€Ÿåº¦</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.selector.class</code></td>\n<td>-</td>\n<td>è‡ªå®šä¹‰å‰¯æœ¬é€‰æ‹©ç±»</td>\n<td>ä¸€èˆ¬ä¿æŒé»˜è®¤</td>\n</tr>\n<tr>\n<td>ğŸ§® <strong>æ—¥å¿—ä¸æ®µæ–‡ä»¶</strong></td>\n<td><code>log.segment.bytes</code></td>\n<td>1073741824 (1GB)</td>\n<td>å•æ—¥å¿—æ®µæ–‡ä»¶å¤§å°</td>\n<td>è°ƒå°ä¾¿äºåˆ é™¤</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.segment.ms</code></td>\n<td>604800000 (7å¤©)</td>\n<td>å¼ºåˆ¶æ»šåŠ¨æ—¥å¿—çš„æ—¶é—´</td>\n<td>é€‚ç”¨äºæ—¶é—´æ§åˆ¶</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.retention.hours</code></td>\n<td>168</td>\n<td>æ—¥å¿—ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰</td>\n<td>ä¸ç£ç›˜ç©ºé—´ç›¸å…³</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.retention.bytes</code></td>\n<td>-1</td>\n<td>æ—¥å¿—æ€»å¤§å°é™åˆ¶</td>\n<td>-1 è¡¨ç¤ºä¸é™åˆ¶</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.retention.check.interval.ms</code></td>\n<td>300000</td>\n<td>æ£€æŸ¥æ—¥å¿—ä¿ç•™ç­–ç•¥é—´éš”</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.cleaner.enable</code></td>\n<td>true</td>\n<td>æ˜¯å¦å¯ç”¨æ—¥å¿—å‹ç¼©</td>\n<td>compact ä¸»é¢˜éœ€å¯ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.cleaner.threads</code></td>\n<td>1</td>\n<td>æ¸…ç†çº¿ç¨‹æ•°</td>\n<td>å¤§é›†ç¾¤å¯å¢åŠ </td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.cleaner.io.max.bytes.per.second</code></td>\n<td>None</td>\n<td>é™åˆ¶æ¸…ç† IO å¸¦å®½</td>\n<td>æ§åˆ¶ç£ç›˜è´Ÿè½½</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.flush.interval.messages</code></td>\n<td>Long.MAX_VALUE</td>\n<td>ç´¯è®¡æ¶ˆæ¯æ•°è¾¾åˆ°åå¼ºåˆ¶ flush</td>\n<td>é€šå¸¸ä¿æŒé»˜è®¤</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.flush.interval.ms</code></td>\n<td>None</td>\n<td>æ¯éš”å¤šä¹…å¼ºåˆ¶ flush</td>\n<td>SSD å¯è°ƒå¤§</td>\n</tr>\n<tr>\n<td></td>\n<td><code>num.partitions</code></td>\n<td>1</td>\n<td>æ–° Topic é»˜è®¤åˆ†åŒºæ•°</td>\n<td>é€šå¸¸ 3~6 èµ·æ­¥</td>\n</tr>\n<tr>\n<td>ğŸ§µ <strong>ç”Ÿäº§ä¸æ¶ˆè´¹ç›¸å…³</strong></td>\n<td><code>message.max.bytes</code></td>\n<td>1048576</td>\n<td>å…è®¸çš„æœ€å¤§æ¶ˆæ¯å¤§å°</td>\n<td>ä¸ Producer <code>max.request.size</code> å¯¹é½</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetch.max.bytes</code></td>\n<td>1048576</td>\n<td>ä¸ Producer/Consumer å¯¹åº”çš„é™åˆ¶</td>\n<td>é˜²æ­¢å¤§æ¶ˆæ¯å¡æ­»</td>\n</tr>\n<tr>\n<td></td>\n<td><code>compression.type</code></td>\n<td>producer</td>\n<td>å‹ç¼©ç®—æ³•ï¼ˆnone, gzip, snappy, lz4, zstdï¼‰</td>\n<td>å»ºè®® zstd</td>\n</tr>\n<tr>\n<td></td>\n<td><code>queued.max.requests</code></td>\n<td>500</td>\n<td>Broker æœ€å¤§æ’é˜Ÿè¯·æ±‚æ•°</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td>ğŸ› ï¸ <strong>æ§åˆ¶å™¨ä¸åè°ƒå™¨</strong></td>\n<td><code>controller.socket.timeout.ms</code></td>\n<td>30000</td>\n<td>æ§åˆ¶å™¨é€šä¿¡è¶…æ—¶</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>controller.quorum.voters</code></td>\n<td>-</td>\n<td>KRaft æ¨¡å¼é€‰ä¸¾æˆå‘˜</td>\n<td>ZK æ¨¡å¼ä¸éœ€</td>\n</tr>\n<tr>\n<td></td>\n<td><code>controller.listener.names</code></td>\n<td>-</td>\n<td>æ§åˆ¶å™¨ç›‘å¬å</td>\n<td>ZK æ¨¡å¼å¿½ç•¥</td>\n</tr>\n<tr>\n<td>ğŸ“ˆ <strong>ç›‘æ§ä¸æŒ‡æ ‡</strong></td>\n<td><code>metric.reporters</code></td>\n<td>ç©º</td>\n<td>æŒ‡æ ‡ä¸ŠæŠ¥ç±»</td>\n<td>å¯æ¥ Prometheus</td>\n</tr>\n<tr>\n<td></td>\n<td><code>metrics.num.samples</code></td>\n<td>2</td>\n<td>æŒ‡æ ‡é‡‡æ ·æ•°</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>metrics.sample.window.ms</code></td>\n<td>30000</td>\n<td>æŒ‡æ ‡é‡‡æ ·çª—å£</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetchers.metrics.enabled</code></td>\n<td>true</td>\n<td>æ˜¯å¦å¯ç”¨å‰¯æœ¬æ‹‰å–æŒ‡æ ‡</td>\n<td>Kafka 3.x æ–°å¢</td>\n</tr>\n<tr>\n<td>ğŸ”’ <strong>å®‰å…¨</strong></td>\n<td><code>authorizer.class.name</code></td>\n<td>ç©º</td>\n<td>æˆæƒç±»å®ç°</td>\n<td>å¼€å¯ ACL æ—¶é…ç½®</td>\n</tr>\n<tr>\n<td></td>\n<td><code>super.users</code></td>\n<td>ç©º</td>\n<td>è¶…çº§ç”¨æˆ·åˆ—è¡¨</td>\n<td>ACL æ¨¡å¼ä¸‹é…ç½®</td>\n</tr>\n<tr>\n<td></td>\n<td><code>ssl.keystore.location</code></td>\n<td>-</td>\n<td>SSL è¯ä¹¦è·¯å¾„</td>\n<td>å¯ç”¨ SSL æ—¶ä½¿ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>ssl.truststore.location</code></td>\n<td>-</td>\n<td>ä¿¡ä»»è¯ä¹¦è·¯å¾„</td>\n<td>å¯ç”¨ SSL æ—¶ä½¿ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å‚æ•°ä½¿ç”¨å»ºè®®æ€»ç»“\">å‚æ•°ä½¿ç”¨å»ºè®®æ€»ç»“</h2>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>æ¨èé…ç½®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>é«˜å¯é æ€§é›†ç¾¤</strong></td>\n<td><code>default.replication.factor=3</code>, <code>min.insync.replicas=2</code>, <code>unclean.leader.election.enable=false</code></td>\n</tr>\n<tr>\n<td><strong>ååä¼˜å…ˆ</strong></td>\n<td>æé«˜ <code>num.replica.fetchers</code>ã€<code>replica.fetch.max.bytes</code></td>\n</tr>\n<tr>\n<td><strong>å¿«é€Ÿæ¢å¤</strong></td>\n<td>å‡å°‘ <code>replica.high.watermark.checkpoint.interval.ms</code></td>\n</tr>\n<tr>\n<td><strong>èŠ‚çœç£ç›˜</strong></td>\n<td>å¯ç”¨ <code>log.cleaner.enable</code> å¹¶è®¾ç½® <code>log.retention.hours</code></td>\n</tr>\n<tr>\n<td><strong>äº‹åŠ¡æˆ–ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰</strong></td>\n<td>è®¾ç½® <code>transaction.state.log.replication.factor=3</code>ã€<code>transaction.state.log.min.isr=2</code></td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„ server.properties çš„é…ç½®é¡¹ï¼ŒåŸºäº Zookeeperã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Kafka 3.x server.properties ä¸»è¦é…ç½®é¡¹æ¸…å• å…³äº server.properties çš„é…ç½®é¡¹ï¼Œè¯·å‚è€ƒ Kafka å®˜æ–¹æ–‡æ¡£ åˆ†ç±» å‚æ•°å é»˜è®¤å€¼ è¯´æ˜ æ¨è/å¤‡æ³¨ ğŸ—‚ï¸ åŸºæœ¬ä¿¡æ¯ broker.id 0 Broker å”¯ä¸€æ ‡è¯† é›†ç¾¤ä¸­å¿…é¡»å”¯ä¸€ node.id - Raft æ¨¡å¼ï¼ˆKRaftï¼‰ä¸‹ä½¿ç”¨ ZK æ¨¡å¼å¿½ç•¥ process.roles - KRaft æ¨¡å¼è§’è‰²ï¼ˆcontroller, brokerï¼‰ ZK æ¨¡å¼ä¸é…ç½® ğŸ”Œ ç½‘ç»œä¸ç›‘å¬é…ç½® listeners PLAINTEXT://:9092 Broker ç›‘å¬åœ°å€ å¯ç”¨å¤šä¸ªåè®®ï¼Œå¦‚ SASL_PLAINTEXT, SSL advertised.listeners - å®¢æˆ·ç«¯è¿æ¥æ—¶çœ‹åˆ°çš„åœ°å€ å¤–ç½‘è®¿é—®éœ€é…ç½® listener.security.protocol.map PLAINTEXT:PLAINTEXT æ˜ å°„ç›‘å¬å™¨åè®® å¤šåè®®æ—¶é…ç½® inter.broker.listener.name -ï¼ˆKafka 2.4+ é»˜è®¤ç¬¬ä¸€ä¸ª listenerï¼‰ æŒ‡å®š broker é—´é€šä¿¡ä½¿ç”¨å“ªä¸ª listenerï¼ˆå¦‚ INTERNALï¼‰ é›†ç¾¤å†…éƒ¨é€šä¿¡å¿…é¡»ä¸€è‡´ï¼›å¸¸é…åˆå¤š listener ä½¿ç”¨ num.network.threads 3 ç½‘ç»œçº¿ç¨‹æ•° ä¸€èˆ¬ä¸éœ€ä¿®æ”¹ num.io.threads 8 å¤„ç†è¯·æ±‚çš„ IO çº¿ç¨‹æ•° æ ¹æ® CPU è°ƒæ•´ socket.send.buffer.bytes 102400 å‘é€ç¼“å†²åŒºå¤§å° ç½‘ç»œä¼˜åŒ–å‚æ•° socket.receive.buffer.bytes 102400 æ¥æ”¶ç¼“å†²åŒºå¤§å° ç½‘ç»œä¼˜åŒ–å‚æ•° socket.request.max.bytes 104857600 å•è¯·æ±‚æœ€å¤§å¤§å° (100MB) å¤§æ¶ˆæ¯éœ€è°ƒå¤§ âš™ï¸ é›†ç¾¤ä¸å…ƒæ•°æ® log.dirs /tmp/kafka-logs æ•°æ®å­˜å‚¨è·¯å¾„ å¤šç›®å½•å¯æå‡æ€§èƒ½ num.recovery.threads.per.data.dir 1 æ¯ä¸ªæ•°æ®ç›®å½•çš„æ¢å¤çº¿ç¨‹æ•° å¤šç£ç›˜æ—¶å¯å¢åŠ  auto.create.topics.enable true æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topic ç”Ÿäº§å»ºè®®ç¦ç”¨ controlled.shutdown.enable true ä¼˜é›…å…³é—­ Broker å»ºè®®å¼€å¯ delete.topic.enable true æ˜¯å¦å…è®¸åˆ é™¤ Topic ç”Ÿäº§æ…ç”¨ auto.leader.rebalance.enable true æ˜¯å¦è‡ªåŠ¨å‡è¡¡ Leader å»ºè®®å¼€å¯ leader.imbalance.check.interval.seconds 300 æ£€æŸ¥ leader å¤±è¡¡é—´éš” ä¸ä¸Šé…åˆä½¿ç”¨ leader.imbalance.per.broker.percentage 10 è§¦å‘ leader é‡å¹³è¡¡çš„é˜ˆå€¼ é»˜è®¤å³å¯ ğŸ§± å‰¯æœ¬ä¸å¤åˆ¶æœºåˆ¶ default.replication.factor 1 æ–° Topic é»˜è®¤å‰¯æœ¬æ•° ç”Ÿäº§å»ºè®® 3 offsets.topic.replication.factor 1 æ¶ˆè´¹ç»„åç§»ä¸»é¢˜å‰¯æœ¬æ•° å»ºè®® 3 transaction.state.log.replication.factor 1 äº‹åŠ¡çŠ¶æ€ä¸»é¢˜å‰¯æœ¬æ•° å»ºè®® 3 transaction.state.log.min.isr 1 äº‹åŠ¡çŠ¶æ€æ—¥å¿—æœ€å° ISR æ•° å»ºè®® 2 min.insync.replicas 1 Leader å†™å…¥æ—¶è¦æ±‚çš„æœ€å° ISR å‰¯æœ¬æ•° å»ºè®® replication.factor - 1 unclean.leader.election.enable false æ˜¯å¦å…è®¸éåŒæ­¥å‰¯æœ¬é€‰ä¸º leader ç”Ÿäº§å»ºè®® false num.replica.fetchers 1 follower æ‹‰å–çº¿ç¨‹æ•° å¯æå‡å¤åˆ¶æ€§èƒ½ replica.fetch.max.bytes 1048576 (1MB) follower æ‹‰å–å•åˆ†åŒºæœ€å¤§æ•°æ®é‡ å¢å¤§å¯æé€Ÿ replica.fetch.response.max.bytes 10485760 (10MB) follower ä¸€æ¬¡æ‹‰å–å“åº”æ€»é‡ å¯è°ƒå¤§ replica.fetch.wait.max.ms 500 follower ç­‰å¾…æ–°æ•°æ®çš„æœ€å¤§æ—¶é•¿ å»¶è¿Ÿä¸ååæŠ˜ä¸­ replica.fetch.backoff.ms 1000 æ‹‰å–å¤±è´¥åé€€é¿æ—¶é—´ ç½‘ç»œä¸ç¨³æ—¶è°ƒæ•´ replica.socket.timeout.ms 30000 follower ä¸ leader é€šä¿¡è¶…æ—¶ â‰¥ fetch.wait.ms replica.socket.receive.buffer.bytes 65536 æ‹‰å– socket ç¼“å†²åŒº è°ƒå¤§å¯æé€Ÿ replica.lag.time.max.ms 10000 follower è½å leader çš„æœ€å¤§æ—¶é—´ å½±å“ ISR replica.high.watermark.checkpoint.interval.ms 5000 é«˜æ°´ä½å†™å…¥ checkpoint å‘¨æœŸ å½±å“æ¢å¤é€Ÿåº¦ replica.selector.class - è‡ªå®šä¹‰å‰¯æœ¬é€‰æ‹©ç±» ä¸€èˆ¬ä¿æŒé»˜è®¤ ğŸ§® æ—¥å¿—ä¸æ®µæ–‡ä»¶ log.segment.bytes 1073741824 (1GB) å•æ—¥å¿—æ®µæ–‡ä»¶å¤§å° è°ƒå°ä¾¿äºåˆ é™¤ log.segment.ms 604800000 (7å¤©) å¼ºåˆ¶æ»šåŠ¨æ—¥å¿—çš„æ—¶é—´ é€‚ç”¨äºæ—¶é—´æ§åˆ¶ log.retention.hours 168 æ—¥å¿—ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰ ä¸ç£ç›˜ç©ºé—´ç›¸å…³ log.retention.bytes -1 æ—¥å¿—æ€»å¤§å°é™åˆ¶ -1 è¡¨ç¤ºä¸é™åˆ¶ log.retention.check.interval.ms 300000 æ£€æŸ¥æ—¥å¿—ä¿ç•™ç­–ç•¥é—´éš” é»˜è®¤å³å¯ log.cleaner.enable true æ˜¯å¦å¯ç”¨æ—¥å¿—å‹ç¼© compact ä¸»é¢˜éœ€å¯ç”¨ log.cleaner.threads 1 æ¸…ç†çº¿ç¨‹æ•° å¤§é›†ç¾¤å¯å¢åŠ  log.cleaner.io.max.bytes.per.second None é™åˆ¶æ¸…ç† IO å¸¦å®½ æ§åˆ¶ç£ç›˜è´Ÿè½½ log.flush.interval.messages Long.MAX_VALUE ç´¯è®¡æ¶ˆæ¯æ•°è¾¾åˆ°åå¼ºåˆ¶ flush é€šå¸¸ä¿æŒé»˜è®¤ log.flush.interval.ms None æ¯éš”å¤šä¹…å¼ºåˆ¶ flush SSD å¯è°ƒå¤§ num.partitions 1 æ–° Topic é»˜è®¤åˆ†åŒºæ•° é€šå¸¸ 3~6 èµ·æ­¥ ğŸ§µ ç”Ÿäº§ä¸æ¶ˆè´¹ç›¸å…³ message.max.bytes 1048576 å…è®¸çš„æœ€å¤§æ¶ˆæ¯å¤§å° ä¸ Producer max.request.size å¯¹é½ replica.fetch.max.bytes 1048576 ä¸ Producer/Consumer å¯¹åº”çš„é™åˆ¶ é˜²æ­¢å¤§æ¶ˆæ¯å¡æ­» compression.type producer å‹ç¼©ç®—æ³•ï¼ˆnone, gzip, snappy, lz4, zstdï¼‰ å»ºè®® zstd queued.max.requests 500 Broker æœ€å¤§æ’é˜Ÿè¯·æ±‚æ•° é»˜è®¤å³å¯ ğŸ› ï¸ æ§åˆ¶å™¨ä¸åè°ƒå™¨ controller.socket.timeout.ms 30000 æ§åˆ¶å™¨é€šä¿¡è¶…æ—¶ é»˜è®¤å³å¯ controller.quorum.voters - KRaft æ¨¡å¼é€‰ä¸¾æˆå‘˜ ZK æ¨¡å¼ä¸éœ€ controller.listener.names - æ§åˆ¶å™¨ç›‘å¬å ZK æ¨¡å¼å¿½ç•¥ ğŸ“ˆ ç›‘æ§ä¸æŒ‡æ ‡ metric.reporters ç©º æŒ‡æ ‡ä¸ŠæŠ¥ç±» å¯æ¥ Prometheus metrics.num.samples 2 æŒ‡æ ‡é‡‡æ ·æ•° é»˜è®¤å³å¯ metrics.sample.window.ms 30000 æŒ‡æ ‡é‡‡æ ·çª—å£ é»˜è®¤å³å¯ replica.fetchers.metrics.enabled true æ˜¯å¦å¯ç”¨å‰¯æœ¬æ‹‰å–æŒ‡æ ‡ Kafka 3.x æ–°å¢ ğŸ”’ å®‰å…¨ authorizer.class.name ç©º æˆæƒç±»å®ç° å¼€å¯ ACL æ—¶é…ç½® super.users ç©º è¶…çº§ç”¨æˆ·åˆ—è¡¨ ACL æ¨¡å¼ä¸‹é…ç½® ssl.keystore.location - SSL è¯ä¹¦è·¯å¾„ å¯ç”¨ SSL æ—¶ä½¿ç”¨ ssl.truststore.location - ä¿¡ä»»è¯ä¹¦è·¯å¾„ å¯ç”¨ SSL æ—¶ä½¿ç”¨ å‚æ•°ä½¿ç”¨å»ºè®®æ€»ç»“ åœºæ™¯ æ¨èé…ç½® é«˜å¯é æ€§é›†ç¾¤ default.replication.factor=3, min.insync.replicas=2, unclean.leader.election.enable=false ååä¼˜å…ˆ æé«˜ num.replica.fetchersã€replica.fetch.max.bytes å¿«é€Ÿæ¢å¤ å‡å°‘ replica.high.watermark.checkpoint.interval.ms èŠ‚çœç£ç›˜ å¯ç”¨ log.cleaner.enable å¹¶è®¾ç½® log.retention.hours äº‹åŠ¡æˆ–ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰ è®¾ç½® transaction.state.log.replication.factor=3ã€transaction.state.log.min.isr=2","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„ server.properties çš„é…ç½®é¡¹ï¼ŒåŸºäº Zookeeperã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚","date_published":"2025-10-14T13:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/10/13/kafka-03-webui/","url":"https://blog.hanqunfeng.com/2025/10/13/kafka-03-webui/","title":"Kafka çš„ Web UI ä¹‹ Kafbat UI","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Kafka çš„ Web UI ä¹‹ Kafbat UI</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafbat.io\">Kafbat UI å®˜ç½‘</a>ï¼Œ<a href=\"https://github.com/kafbat/kafka-ui\">Kafbat UI Github</a>ï¼Œ<a href=\"https://ui.docs.kafbat.io\">Kafbat UI æ–‡æ¡£</a>ï¼ŒKafbat UI æ”¯æŒ Docker å’Œ Jar åŒ…ä¸¤ç§æ–¹å¼è¿è¡Œï¼Œæ”¯æŒåŒæ—¶è¿æ¥å¤šä¸ª Kafka é›†ç¾¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ Kafbat UI ç±»ä¼¼çš„ Kafka Web UI è¿˜æœ‰ä¸€ä¸ª <a href=\"https://github.com/obsidiandynamics/kafdrop\">kafdrop</a>ï¼ŒåŒæ ·æ”¯æŒ Docker å’Œ Jar åŒ…ä¸¤ç§æ–¹å¼è¿è¡Œï¼Œåªä¸è¿‡å…¶ä»…æ”¯æŒå•ä¸ª Kafka é›†ç¾¤ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±ä½“éªŒã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Kafbat-UI-ç®€ä»‹\">Kafbat UI ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kafbat UI æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æº Web ç”¨æˆ·ç•Œé¢ï¼Œç”¨äºç›‘æ§å’Œç®¡ç† Apache Kafka é›†ç¾¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kafbat UI æ˜¯ä¸€ä¸ªç®€å•çš„å·¥å…·ï¼Œä½¿æ‚¨çš„æ•°æ®æµå˜å¾—å¯è§‚å¯Ÿï¼Œå¸®åŠ©æ›´å¿«åœ°å‘ç°å’Œæ’é™¤é—®é¢˜ï¼Œå¹¶æä¾›æœ€ä½³æ€§èƒ½ã€‚å…¶è½»é‡çº§çš„ä»ªè¡¨ç›˜ä½¿æ‚¨èƒ½å¤Ÿè½»æ¾è·Ÿè¸ª Kafka é›†ç¾¤çš„å…³é”®æŒ‡æ ‡: åŒ…æ‹¬ Brokersã€Topicsã€Partitionsã€ç”Ÿäº§å’Œæ¶ˆè´¹æƒ…å†µã€‚</p>\n</li>\n</ul>\n<h2 id=\"è¿è¡Œ-Kafbat-UI\">è¿è¡Œ Kafbat UI</h2>\n<h3 id=\"Docker-è¿è¡Œ\">Docker è¿è¡Œ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it -p 8080:8080 \\</span><br><span class=\"line\">    --name kafka-ui \\</span><br><span class=\"line\">    -e KAFKA_CLUSTERS_0_NAME=kafka_c01 \\</span><br><span class=\"line\">    -e KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=localhost:9092 \\</span><br><span class=\"line\">    -e TZ=Asia/Shanghai \\</span><br><span class=\"line\">    -d ghcr.io/kafbat/kafka-ui:latest</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"Jar-è¿è¡Œ\">Jar è¿è¡Œ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»<a href=\"https://github.com/kafbat/kafka-ui/releases\">Github</a>ä¸Šä¸‹è½½æœ€æ–°ç‰ˆjaråŒ…ï¼Œè¦æ±‚ <code>jdk 21+</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /Users/hanqf/myservice_dir/kafka_webui</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®kafkaé›†ç¾¤ï¼Œå¯ä»¥åŒæ—¶é…ç½®å¤šä¸ªï¼Œåºå·ä»0å¼€å§‹ä¾æ¬¡é€’å¢</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_NAME=kafka_c01</span><br><span class=\"line\"><span class=\"comment\"># =============================================================================================================</span></span><br><span class=\"line\"><span class=\"comment\"># å¤–ç½‘PLAINTEXTè®¿é—®</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9093,68.79.13.235:9093,43.192.84.195:9093</span></span><br><span class=\"line\"><span class=\"comment\"># =============================================================================================================</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =============================================================================================================</span></span><br><span class=\"line\"><span class=\"comment\"># å¤–ç½‘SASL_PLAINTEXTè®¿é—®</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9094,68.79.13.235:9094,43.192.84.195:9094</span></span><br><span class=\"line\"><span class=\"comment\"># # SASL_PLAINTEXTè®¤è¯é…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL=SASL_PLAINTEXT</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM=PLAIN</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG=&#x27;org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;alice&quot; password=&quot;alice-secret&quot;;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># =============================================================================================================</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =============================================================================================================</span></span><br><span class=\"line\"><span class=\"comment\"># å¤–ç½‘SASL_SSLè®¿é—®</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9095,68.79.13.235:9095,43.192.84.195:9095</span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL=SASL_SSL</span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM=PLAIN</span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG=<span class=\"string\">&#x27;org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;alice&quot; password=&quot;alice-secret&quot;;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># SSLé…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># JKS æ ¼å¼è¯ä¹¦</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_LOCATION=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/kafka.truststore.jks</span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_PASSWORD=123456</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># PEM æ ¼å¼è¯ä¹¦</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_LOCATION=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/server.crt</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_TYPE=PEM</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¦ç”¨ä¸»æœºåéªŒè¯</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM=<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># ============================================================================================================</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬äºŒä¸ªé›†ç¾¤é…ç½®ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_1_NAME=kafka_c02</span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_1_BOOTSTRAPSERVERS=161.189.227.200:9093,68.79.13.235:9093,43.192.84.195:9093</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—¶åŒº</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> TZ=Asia/Shanghai</span><br><span class=\"line\"><span class=\"comment\"># è¯­è¨€</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LANG=zh_CN.UTF-8</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># webuiè®¿é—®è·¯å¾„</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> SERVER_SERVLET_CONTEXT_PATH=/</span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯æ–¹å¼ï¼Œæ”¯æŒNONE(æ— è®¤è¯)ï¼ŒLOGIN_FORM(ç™»å½•è¡¨å•è®¤è¯)</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> AUTH_TYPE=LOGIN_FORM</span><br><span class=\"line\"><span class=\"comment\"># webuiè®¤è¯ç”¨æˆ·åå¯†ç </span></span><br><span class=\"line\"><span class=\"built_in\">export</span> SPRING_SECURITY_USER_NAME=admin</span><br><span class=\"line\"><span class=\"built_in\">export</span> SPRING_SECURITY_USER_PASSWORD=admin</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">JAVA_OPTS=<span class=\"string\">&quot;-Xms512m -Xmx1024m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨</span></span><br><span class=\"line\">/Users/hanqf/develop_soft/jdk21/bin/java --add-opens java.rmi/javax.rmi.ssl=ALL-UNNAMED  <span class=\"variable\">$JAVA_OPTS</span> -jar api-v1.3.0.jar</span><br></pre></td></tr></table></figure>\n<h2 id=\"è®¿é—®-Kafbat-UI\">è®¿é—® Kafbat UI</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—® <a href=\"http://localhost:8080\">http://localhost:8080</a><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/ykd6F4.png\" alt=\"\"></p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ Web UI ä¹‹ Kafbat UI Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Kafbat UI å®˜ç½‘ï¼ŒKafbat UI Githubï¼ŒKafbat UI æ–‡æ¡£ï¼ŒKafbat UI æ”¯æŒ Docker å’Œ Jar åŒ…ä¸¤ç§æ–¹å¼è¿è¡Œï¼Œæ”¯æŒåŒæ—¶è¿æ¥å¤šä¸ª Kafka é›†ç¾¤ã€‚ ä¸ Kafbat UI ç±»ä¼¼çš„ Kafka Web UI è¿˜æœ‰ä¸€ä¸ª kafdropï¼ŒåŒæ ·æ”¯æŒ Docker å’Œ Jar åŒ…ä¸¤ç§æ–¹å¼è¿è¡Œï¼Œåªä¸è¿‡å…¶ä»…æ”¯æŒå•ä¸ª Kafka é›†ç¾¤ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±ä½“éªŒã€‚ Kafbat UI ç®€ä»‹ Kafbat UI æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æº Web ç”¨æˆ·ç•Œé¢ï¼Œç”¨äºç›‘æ§å’Œç®¡ç† Apache Kafka é›†ç¾¤ã€‚ Kafbat UI æ˜¯ä¸€ä¸ªç®€å•çš„å·¥å…·ï¼Œä½¿æ‚¨çš„æ•°æ®æµå˜å¾—å¯è§‚å¯Ÿï¼Œå¸®åŠ©æ›´å¿«åœ°å‘ç°å’Œæ’é™¤é—®é¢˜ï¼Œå¹¶æä¾›æœ€ä½³æ€§èƒ½ã€‚å…¶è½»é‡çº§çš„ä»ªè¡¨ç›˜ä½¿æ‚¨èƒ½å¤Ÿè½»æ¾è·Ÿè¸ª Kafka é›†ç¾¤çš„å…³é”®æŒ‡æ ‡: åŒ…æ‹¬ Brokersã€Topicsã€Partitionsã€ç”Ÿäº§å’Œæ¶ˆè´¹æƒ…å†µã€‚ è¿è¡Œ Kafbat UI Docker è¿è¡Œ 1234567docker run -it -p 8080:8080 \\ --name kafka-ui \\ -e KAFKA_CLUSTERS_0_NAME=kafka_c01 \\ -e KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=localhost:9092 \\ -e TZ=Asia/Shanghai \\ -d ghcr.io/kafbat/kafka-ui:latest Jar è¿è¡Œ ä»Githubä¸Šä¸‹è½½æœ€æ–°ç‰ˆjaråŒ…ï¼Œè¦æ±‚ jdk 21+ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859cd /Users/hanqf/myservice_dir/kafka_webui# é…ç½®kafkaé›†ç¾¤ï¼Œå¯ä»¥åŒæ—¶é…ç½®å¤šä¸ªï¼Œåºå·ä»0å¼€å§‹ä¾æ¬¡é€’å¢export KAFKA_CLUSTERS_0_NAME=kafka_c01# =============================================================================================================# å¤–ç½‘PLAINTEXTè®¿é—®# export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9093,68.79.13.235:9093,43.192.84.195:9093# =============================================================================================================# =============================================================================================================# å¤–ç½‘SASL_PLAINTEXTè®¿é—®# export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9094,68.79.13.235:9094,43.192.84.195:9094# # SASL_PLAINTEXTè®¤è¯é…ç½®# export KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL=SASL_PLAINTEXT# export KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM=PLAIN# export KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG=&#x27;org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;alice&quot; password=&quot;alice-secret&quot;;&#x27;# =============================================================================================================# =============================================================================================================# å¤–ç½‘SASL_SSLè®¿é—®export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9095,68.79.13.235:9095,43.192.84.195:9095export KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL=SASL_SSLexport KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM=PLAINexport KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG=&#x27;org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;alice&quot; password=&quot;alice-secret&quot;;&#x27;# SSLé…ç½®# JKS æ ¼å¼è¯ä¹¦export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_LOCATION=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/kafka.truststore.jksexport KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_PASSWORD=123456# PEM æ ¼å¼è¯ä¹¦# export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_LOCATION=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/server.crt# export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_TYPE=PEM# ç¦ç”¨ä¸»æœºåéªŒè¯export KAFKA_CLUSTERS_0_PROPERTIES_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM=&#x27;&#x27;# ============================================================================================================# ç¬¬äºŒä¸ªé›†ç¾¤é…ç½®ç¤ºä¾‹export KAFKA_CLUSTERS_1_NAME=kafka_c02export KAFKA_CLUSTERS_1_BOOTSTRAPSERVERS=161.189.227.200:9093,68.79.13.235:9093,43.192.84.195:9093# æ—¶åŒºexport TZ=Asia/Shanghai# è¯­è¨€export LANG=zh_CN.UTF-8# webuiè®¿é—®è·¯å¾„export SERVER_SERVLET_CONTEXT_PATH=/# è®¤è¯æ–¹å¼ï¼Œæ”¯æŒNONE(æ— è®¤è¯)ï¼ŒLOGIN_FORM(ç™»å½•è¡¨å•è®¤è¯)export AUTH_TYPE=LOGIN_FORM# webuiè®¤è¯ç”¨æˆ·åå¯†ç export SPRING_SECURITY_USER_NAME=adminexport SPRING_SECURITY_USER_PASSWORD=adminJAVA_OPTS=&quot;-Xms512m -Xmx1024m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m&quot;# å¯åŠ¨/Users/hanqf/develop_soft/jdk21/bin/java --add-opens java.rmi/javax.rmi.ssl=ALL-UNNAMED $JAVA_OPTS -jar api-v1.3.0.jar è®¿é—® Kafbat UI è®¿é—® http://localhost:8080","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ Web UI ä¹‹ Kafbat UI Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Kafbat UI å®˜ç½‘ï¼ŒKafbat UI Githubï¼ŒKafbat UI æ–‡æ¡£ï¼ŒKafbat UI æ”¯æŒ Docker å’Œ Jar åŒ…ä¸¤ç§æ–¹å¼è¿è¡Œï¼Œæ”¯æŒåŒæ—¶è¿æ¥å¤šä¸ª Kafka é›†ç¾¤ã€‚ ä¸ Kafbat UI ç±»ä¼¼çš„ Kafka Web UI è¿˜æœ‰ä¸€ä¸ª kafdropï¼ŒåŒæ ·æ”¯æŒ Docker å’Œ Jar åŒ…ä¸¤ç§æ–¹å¼è¿è¡Œï¼Œåªä¸è¿‡å…¶ä»…æ”¯æŒå•ä¸ª Kafka é›†ç¾¤ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±ä½“éªŒã€‚","date_published":"2025-10-13T15:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/10/13/kafka-02-protocol/","url":"https://blog.hanqunfeng.com/2025/10/13/kafka-02-protocol/","title":"Kafka é€šä¿¡åè®®ã€SSLåŠ å¯†å’Œèº«ä»½éªŒè¯","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Kafka çš„ é€šä¿¡åè®®ï¼Œä»¥åŠå¦‚ä½•å¼€å¯å¤–ç½‘è®¿é—®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Kafka-çš„-é€šä¿¡åè®®\">Kafka çš„ é€šä¿¡åè®®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kafka ä¸»è¦æ”¯æŒå››ç§å®‰å…¨åè®®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åè®®åç§°</th>\n<th>åŠ å¯†</th>\n<th>è®¤è¯</th>\n<th>è¯´æ˜</th>\n<th>æ¨èåœºæ™¯</th>\n<th>ç†ç”±</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>PLAINTEXT</strong></td>\n<td>âŒ å¦</td>\n<td>âŒ å¦</td>\n<td>æ— åŠ å¯†ã€æ— è®¤è¯ï¼ˆé»˜è®¤æœ€ç®€å•ï¼‰</td>\n<td>å¼€å‘ / æµ‹è¯•ç¯å¢ƒã€å†…ç½‘é›†ç¾¤é€šä¿¡</td>\n<td>ç®€å•ã€æ˜“è°ƒè¯•ï¼›ç½‘ç»œå¯ä¿¡ï¼Œæ€§èƒ½ä¼˜å…ˆ</td>\n</tr>\n<tr>\n<td><strong>SSL</strong></td>\n<td>âœ… æ˜¯</td>\n<td>âœ… å¯é€‰</td>\n<td>ä½¿ç”¨ TLS/SSL åŠ å¯†é€šä¿¡ï¼Œå¯é…ç½®å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯</td>\n<td>å¤–ç½‘å®¢æˆ·ç«¯è®¿é—®</td>\n<td>æ”¯æŒæ•°æ®åŠ å¯†ï¼Œå¯é€‰è®¤è¯ï¼Œä¿è¯å®‰å…¨</td>\n</tr>\n<tr>\n<td><strong>SASL_PLAINTEXT</strong></td>\n<td>âŒ å¦</td>\n<td>âœ… æ˜¯</td>\n<td>ä½¿ç”¨ SASLï¼ˆç”¨æˆ·åå¯†ç ï¼‰è®¤è¯ï¼Œä½†ä¸åŠ å¯†æ•°æ®</td>\n<td>éœ€è¦ç”¨æˆ·è®¤è¯ä½†å±€åŸŸç½‘ç¯å¢ƒ</td>\n<td>æœ‰è®¤è¯ï¼Œä½†ä¸åŠ å¯†ï¼Œæ€§èƒ½å¼€é”€ä½</td>\n</tr>\n<tr>\n<td><strong>SASL_SSL</strong></td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n<td>åŒæ—¶æ”¯æŒ SASL è®¤è¯å’Œ SSL åŠ å¯†ï¼ˆæœ€å®‰å…¨ï¼‰</td>\n<td>å¤–ç½‘å®¢æˆ·ç«¯è®¿é—®</td>\n<td>æ—¢æœ‰è®¤è¯åˆåŠ å¯†ï¼Œå®‰å…¨æ€§æœ€é«˜</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ <code>config/server.properties</code> æ–‡ä»¶ä¸­ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¥—æ¥å­—æœåŠ¡å™¨ç›‘å¬çš„åœ°å€ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœæœªé…ç½®ï¼Œåˆ™ä¸»æœºåé»˜è®¤ç­‰äº `java.net.InetAddress.getCanonicalHostName()` çš„è¿”å›å€¼ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ç›‘å¬å™¨åç§° `PLAINTEXT`ï¼Œç«¯å£å·ä¸º 9092ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">#   æ ¼å¼ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#     listeners = listener_name://host_name:port</span></span><br><span class=\"line\"><span class=\"comment\">#   ç¤ºä¾‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#     listeners = PLAINTEXT://your.host.name:9092</span></span><br><span class=\"line\"><span class=\"comment\">#listeners=PLAINTEXT://:9092</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Broker å‘å®¢æˆ·ç«¯â€œé€šå‘Šâ€çš„ç›‘å¬å™¨åç§°ã€ä¸»æœºåå’Œç«¯å£ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å®¢æˆ·ç«¯å®é™…ä¼šè¿æ¥è¿™ä¸ªåœ°å€ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ listeners çš„åœ°å€ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœæœªè®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ `listeners` çš„å€¼ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">#advertised.listeners=PLAINTEXT://your.host.name:9092</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°†ç›‘å¬å™¨åç§°æ˜ å°„åˆ°å®‰å…¨åè®®ç±»å‹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤æƒ…å†µä¸‹ï¼Œç›‘å¬å™¨åç§°ä¸å®‰å…¨åè®®åŒåã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ä¾‹å¦‚ï¼šPLAINTEXTâ†’PLAINTEXTã€SSLâ†’SSLã€SASL_PLAINTEXTâ†’SASL_PLAINTEXTã€SASL_SSLâ†’SASL_SSLã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># æ›´å¤šç»†èŠ‚å¯å‚è€ƒ Kafka å®˜æ–¹é…ç½®æ–‡æ¡£ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span></span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>ä½œç”¨</th>\n<th>è¯´æ˜å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>listeners</code></td>\n<td>Kafka å®é™…ç›‘å¬çš„åœ°å€ï¼ˆBroker å¯¹å¤–å¼€æ”¾çš„ç«¯å£ï¼‰</td>\n<td><code>PLAINTEXT://:9092</code>è¿™é‡Œ PLAINTEXT æ˜¯ç›‘å¬å™¨åç§°ï¼Œå¹¶ä¸æ˜¯åè®®åç§°ï¼Œå®é™…ä¸Šå¯ä»¥é…ç½®ä¸ºä»»ä½•å€¼ï¼Œå…·ä½“åè®®æ˜¯é€šè¿‡ <code>listener.security.protocol.map</code> é…ç½®çš„æ˜ å°„å…³ç³»æ¥ç¡®å®šã€‚</td>\n</tr>\n<tr>\n<td><code>advertised.listeners</code></td>\n<td>Kafka å‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç”¨å“ªä¸ªåœ°å€è¿æ¥ï¼ˆå®¢æˆ·ç«¯æœ€ç»ˆè¿çš„ï¼‰</td>\n<td>é»˜è®¤ä½¿ç”¨ <code>listeners</code> çš„å€¼</td>\n</tr>\n<tr>\n<td><code>listener.security.protocol.map</code></td>\n<td>æ˜ å°„ç›‘å¬å™¨åç§°åˆ°é€šä¿¡å®‰å…¨åè®®ï¼ˆå¦‚æ˜æ–‡ã€SSLã€SASL ç­‰ï¼‰</td>\n<td><code>PLAINTEXT:PLAINTEXT</code>ï¼Œå‰é¢æ˜¯ç›‘å¬å™¨åç§°ï¼Œåé¢æ˜¯åè®®åç§°</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ä»…éœ€å†…ç½‘è®¿é—®\">ä»…éœ€å†…ç½‘è®¿é—®</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listeners=PLAINTEXT://0.0.0.0:9092</span><br><span class=\"line\">advertised.listeners=PLAINTEXT://worker1:9092 <span class=\"comment\"># è¿™é‡Œæ˜¯å†…ç½‘ip</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å…è®¸å¤–ç½‘è®¿é—®\">å…è®¸å¤–ç½‘è®¿é—®</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listeners=PLAINTEXT://0.0.0.0:9092</span><br><span class=\"line\">advertised.listeners=PLAINTEXT://161.189.227.200:9092 <span class=\"comment\"># è¿™é‡Œæ˜¯å¤–ç½‘ip</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å†…å¤–ç½‘éƒ½è¦è®¿é—®ï¼ˆæ¨èåŒé€šé“æ–¹å¼ï¼‰\">å†…å¤–ç½‘éƒ½è¦è®¿é—®ï¼ˆæ¨èåŒé€šé“æ–¹å¼ï¼‰</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œ INTERNAL å’Œ EXTERNAL åˆ†åˆ«æ˜¯è‡ªå®šä¹‰çš„ç›‘å¬å™¨åç§°ï¼Œæ­¤æ—¶å†…ç½‘ç«¯å£ä¸º 9092ï¼Œå¤–ç½‘ç«¯å£ä¸º 9093</span></span><br><span class=\"line\">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9093</span><br><span class=\"line\"><span class=\"comment\"># å‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç”¨å“ªä¸ªåœ°å€è¿æ¥</span></span><br><span class=\"line\">advertised.listeners=INTERNAL://worker1:9092,EXTERNAL://161.189.227.200:9093</span><br><span class=\"line\"><span class=\"comment\"># æ˜ å°„ç›‘å¬å™¨åç§°åˆ°é€šä¿¡å®‰å…¨åè®®çš„æ˜ å°„å…³ç³»</span></span><br><span class=\"line\">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT</span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤é—´é€šä¿¡ä»ä½¿ç”¨å†…ç½‘</span></span><br><span class=\"line\">inter.broker.listener.name=INTERNAL</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¼€å¯-SASL-PLAINTEXT\">å¼€å¯ SASL_PLAINTEXT</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè®¾ç½®å¤–ç½‘è®¿é—®æ—¶å¼€å¯ SASL_PLAINTEXT</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®</span></span><br><span class=\"line\">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9094</span><br><span class=\"line\"><span class=\"comment\"># å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€</span></span><br><span class=\"line\">advertised.listeners=INTERNAL://worker1:9092,EXTERNAL://161.189.227.200:9094</span><br><span class=\"line\">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_PLAINTEXT</span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤é—´é€šä¿¡ still use INTERNAL</span></span><br><span class=\"line\">inter.broker.listener.name=INTERNAL</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># client è¿æ¥æ—¶</span></span><br><span class=\"line\">sasl.enabled.mechanisms=PLAIN</span><br><span class=\"line\"><span class=\"comment\"># broker ä¹‹é—´è¿æ¥æ—¶ï¼Œå› ä¸º inter.broker.listener.name=INTERNALï¼Œæ‰€ä»¥ INTERNAL:SASL_PLAINTEXT æ‰æœ‰æ•ˆ</span></span><br><span class=\"line\"><span class=\"comment\">#sasl.mechanism.inter.broker.protocol=PLAIN</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º kafka_jaas.conf</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">############################</span></span><br><span class=\"line\"><span class=\"comment\"># Kafka Broker (æœåŠ¡ç«¯)</span></span><br><span class=\"line\"><span class=\"comment\">############################</span></span><br><span class=\"line\">KafkaServer &#123;</span><br><span class=\"line\">    <span class=\"comment\"># å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule required</span></span><br><span class=\"line\">    org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class=\"line\">    <span class=\"comment\"># Broker è‡ªå·±çš„èº«ä»½ï¼ˆç”¨äº broker ä¹‹é—´é€šä¿¡ï¼Œæœ¬ç¤ºä¾‹ä¸­æ²¡æœ‰ä½¿ç”¨ï¼‰</span></span><br><span class=\"line\">    username=<span class=\"string\">&quot;admin&quot;</span></span><br><span class=\"line\">    password=<span class=\"string\">&quot;admin-secret&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># å®¢æˆ·ç«¯å¯ç”¨è´¦å·ï¼Œå³ user_xxxï¼Œè¿™é‡Œ xxx ä¸ºç”¨æˆ·åï¼Œ= å³è¾¹çš„ä¸ºå¯†ç </span></span><br><span class=\"line\">    user_admin=<span class=\"string\">&quot;admin-secret&quot;</span></span><br><span class=\"line\">    user_alice=<span class=\"string\">&quot;alice-secret&quot;</span></span><br><span class=\"line\">    user_bob=<span class=\"string\">&quot;bob-secret&quot;</span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ kafka</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨å¯åŠ¨ Kafka Broker å‰ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡æŒ‡å‘ JAAS æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_OPTS=<span class=\"string\">&quot;-Djava.security.auth.login.config=/usr/local/kafka/kafka3/config/kafka_jaas.conf&quot;</span></span><br><span class=\"line\">kafka-server-start.sh config/server.properties</span><br></pre></td></tr></table></figure>\n<h3 id=\"å®¢æˆ·ç«¯è®¿é—®\">å®¢æˆ·ç«¯è®¿é—®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º client.conf</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">security.protocol=SASL_PLAINTEXT</span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒ PLAINã€SCRAM-SHA-256ã€SCRAM-SHA-512ï¼Œè¦ä¸ æœåŠ¡ç«¯ä¸€è‡´</span></span><br><span class=\"line\">sasl.mechanism=PLAIN</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule required</span></span><br><span class=\"line\">sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=<span class=\"string\">&quot;admin&quot;</span> password=<span class=\"string\">&quot;admin-secret&quot;</span>;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œè®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºtopic</span></span><br><span class=\"line\">kafka-topics.sh --create --topic test-topic --bootstrap-server=161.189.227.200:9094 --command-config=client.conf</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹topic</span></span><br><span class=\"line\">kafka-topics.sh --list --bootstrap-server=161.189.227.200:9094 --command-config=client.conf</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºæ¶ˆè´¹è€…ï¼Œ--group æŒ‡å®šæ¶ˆè´¹è€…ç»„åç§°</span></span><br><span class=\"line\">kafka-console-consumer.sh --bootstrap-server=161.189.227.200:9094 --topic test-topic --consumer.config=client.conf --group=test-group</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç”Ÿäº§è€…</span></span><br><span class=\"line\">kafka-console-producer.sh --bootstrap-server=161.189.227.200:9094 --topic test-topic --producer.config=client.conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¼€å¯-SASL-SSL\">å¼€å¯ SASL_SSL</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè®¾ç½®å¤–ç½‘è®¿é—®æ—¶å¼€å¯ SASL_SSL</p>\n</li>\n</ul>\n<h3 id=\"åˆ›å»ºè¯ä¹¦\">åˆ›å»ºè¯ä¹¦</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org/39/documentation.html#security_ssl\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”Ÿæˆ Broker keystoreï¼Œç”¨äº å­˜å‚¨ broker çš„ç§é’¥å’Œè¯ä¹¦ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">keytool -keystore kafka.server.keystore.jks \\</span><br><span class=\"line\">  -<span class=\"built_in\">alias</span> broker -validity 3650 \\</span><br><span class=\"line\">  -genkey -keyalg RSA \\</span><br><span class=\"line\">  -dname <span class=\"string\">&quot;CN=broker, OU=Kafka, O=YourOrg, L=City, ST=State, C=CN&quot;</span> \\</span><br><span class=\"line\">  -storepass 123456 \\</span><br><span class=\"line\">  -keypass 123456</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># -keystoreï¼šç”Ÿæˆçš„ keystore æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -alias brokerï¼šè¯ä¹¦åˆ«å</span></span><br><span class=\"line\"><span class=\"comment\"># -validity 3650ï¼šæœ‰æ•ˆæœŸ 3650 å¤©</span></span><br><span class=\"line\"><span class=\"comment\"># -keyalg RSAï¼šå¯†é’¥ç®—æ³•</span></span><br><span class=\"line\"><span class=\"comment\"># -dnameï¼šè¯ä¹¦ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\"># -storepassï¼škeystore å¯†ç </span></span><br><span class=\"line\"><span class=\"comment\"># -keypassï¼šå¯†é’¥å¯†ç </span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¼å‡º Broker è¯ä¹¦ï¼ˆç”¨äºå®¢æˆ·ç«¯ truststoreï¼‰,ç”Ÿæˆ kafka.server.crtï¼Œå®¢æˆ·ç«¯ä¼šç”¨å®ƒæ¥éªŒè¯ brokerã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">keytool -keystore kafka.server.keystore.jks \\</span><br><span class=\"line\">  -<span class=\"built_in\">alias</span> broker -<span class=\"built_in\">export</span> -file kafka.server.crt \\</span><br><span class=\"line\">  -storepass 123456</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># -keystoreï¼škeystore æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -alias brokerï¼šè¯ä¹¦åˆ«å</span></span><br><span class=\"line\"><span class=\"comment\"># -file kafka.server.crtï¼šå¯¼å‡ºçš„è¯ä¹¦æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -storepassï¼škeystore å¯†ç </span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”Ÿæˆ Broker truststoreï¼Œtruststore ç”¨äº å­˜å‚¨ä¿¡ä»»çš„è¯ä¹¦ï¼ˆè¿™é‡ŒæŠŠè‡ªå·±ç”Ÿæˆçš„è¯ä¹¦å¯¼å…¥è¿›å»å³å¯ï¼‰,ç”Ÿæˆ kafka.truststore.jks</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„ï¼šè¿™é‡Œ server ç«¯ å’Œ client ç«¯ å¯ä»¥å…±ç”¨ä¸€ä¸ª truststoreï¼Œä¹Ÿå¯ä»¥åˆ†åˆ«åˆ›å»º</span></span><br><span class=\"line\">keytool -keystore kafka.truststore.jks \\</span><br><span class=\"line\">  -<span class=\"built_in\">alias</span> broker -import -file kafka.server.crt \\</span><br><span class=\"line\">  -storepass 123456 -noprompt</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># -keystoreï¼šç”Ÿæˆçš„ truststore æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -alias brokerï¼šè¯ä¹¦åˆ«å</span></span><br><span class=\"line\"><span class=\"comment\"># -file kafka.server.crtï¼šå¯¼å…¥çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -storepassï¼štruststore å¯†ç </span></span><br><span class=\"line\"><span class=\"comment\"># -nopromptï¼šä¸æç¤º</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"server-properties-é…ç½®-SASL-SSL\">server.properties é…ç½® SASL_SSL</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®</span></span><br><span class=\"line\">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9095</span><br><span class=\"line\"><span class=\"comment\"># å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€</span></span><br><span class=\"line\">advertised.listeners=INTERNAL://worker2:9092,EXTERNAL://161.189.227.200:9095</span><br><span class=\"line\">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_SSL</span><br><span class=\"line\">inter.broker.listener.name=INTERNAL</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SASL</span></span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># client è¿æ¥æ—¶</span></span><br><span class=\"line\">sasl.enabled.mechanisms=PLAIN</span><br><span class=\"line\"><span class=\"comment\"># broker ä¹‹é—´è¿æ¥æ—¶ï¼Œéœ€è¦ inter.broker.listener.name=SASL_PLAINTEXT æ‰æœ‰æ•ˆ</span></span><br><span class=\"line\"><span class=\"comment\">#sasl.mechanism.inter.broker.protocol=PLAIN</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SSL</span></span><br><span class=\"line\">ssl.keystore.location=/usr/local/kafka/kafka3/config/ssl/kafka.server.keystore.jks</span><br><span class=\"line\">ssl.keystore.password=123456</span><br><span class=\"line\">ssl.key.password=123456</span><br><span class=\"line\">ssl.truststore.location=/usr/local/kafka/kafka3/config/ssl/kafka.truststore.jks</span><br><span class=\"line\">ssl.truststore.password=123456</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä¸è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¯ä»¥è®¾ç½® none ï¼Œè¦æ±‚åˆ™è®¾ç½®ä¸º required</span></span><br><span class=\"line\">ssl.client.auth=none</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ kafka å‰åŒæ ·éœ€è¦å…ˆåˆ›å»ºå¥½ kafka_jaas.confï¼Œä¸ SASL_PLAINTEXT ä¸€æ ·ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å®¢æˆ·ç«¯è®¿é—®-2\">å®¢æˆ·ç«¯è®¿é—®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† <code>kafka.truststore.jks</code> æ‹·è´åˆ°å®¢æˆ·ç«¯</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ SASL_PLAINTEXT ä¸€æ ·ï¼Œåˆ›å»º client.confï¼Œå¹¶æ·»åŠ å¦‚ä¸‹ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">security.protocol=SASL_SSL</span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒ PLAINã€SCRAM-SHA-256ã€SCRAM-SHA-512ï¼Œè¦ä¸ æœåŠ¡ç«¯ä¸€è‡´</span></span><br><span class=\"line\">sasl.mechanism=PLAIN</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule required</span></span><br><span class=\"line\">sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=<span class=\"string\">&quot;admin&quot;</span> password=<span class=\"string\">&quot;admin-secret&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SSL é…ç½®</span></span><br><span class=\"line\">ssl.truststore.location=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/kafka.truststore.jks</span><br><span class=\"line\">ssl.truststore.password=123456</span><br><span class=\"line\"><span class=\"comment\"># ç¦ç”¨ä¸»æœºåéªŒè¯ï¼Œå¦åˆ™ä¼šæ ¡éªŒè¯ä¹¦çš„ SANï¼Œè¯ä¹¦åŸŸåæ ¡éªŒå¼€å…³ï¼Œä¸ºç©ºåˆ™è¡¨ç¤ºå…³é—­ï¼Œè¿™é‡Œéœ€è¦ä¿æŒå…³é—­çŠ¶æ€ï¼Œå¿…é¡»è®¾ç½®ä¸ºç©º</span></span><br><span class=\"line\">ssl.endpoint.identification.algorithm=</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œè®¿é—® ä¸ SASL_PLAINTEXT ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿°</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äº Kafka JKSæ ¼å¼çš„SSLè¯ä¹¦çš„åˆ›å»ºåŠé…ç½®å¯ä»¥å‚è€ƒ<a href=\"https://support.huaweicloud.com/usermanual-kafka/kafka-ug-0008.html\">åˆ¶ä½œå’Œæ›¿æ¢Kafka JKSæ ¼å¼çš„SSLè¯ä¹¦</a></p>\n</li>\n</ul>\n<h4 id=\"PEM-è¯ä¹¦\">PEM è¯ä¹¦</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kafka çš„ è¯ä¹¦ é»˜è®¤ä½¿ç”¨ JKS æ ¼å¼ï¼Œä½†ä» 2.7.0 å¼€å§‹æ”¯æŒ PEM æ ¼å¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®</span></span><br><span class=\"line\">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9095</span><br><span class=\"line\"><span class=\"comment\"># å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€</span></span><br><span class=\"line\">advertised.listeners=INTERNAL://worker2:9092,EXTERNAL://161.189.227.200:9095</span><br><span class=\"line\">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_SSL</span><br><span class=\"line\">inter.broker.listener.name=INTERNAL</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SASL</span></span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ CRAM-SHA-256ã€SCRAM-SHA-512ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># client è¿æ¥æ—¶</span></span><br><span class=\"line\">sasl.enabled.mechanisms=PLAIN</span><br><span class=\"line\"><span class=\"comment\"># broker ä¹‹é—´è¿æ¥æ—¶ï¼Œéœ€è¦ inter.broker.listener.name=SASL_PLAINTEXT æ‰æœ‰æ•ˆ</span></span><br><span class=\"line\"><span class=\"comment\">#sasl.mechanism.inter.broker.protocol=PLAIN</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SSL-PEM</span></span><br><span class=\"line\">ssl.keystore.type=PEM <span class=\"comment\"># æŒ‡å®šè¯ä¹¦ç±»å‹æ˜¯PEMï¼Œæ”¯æŒçš„ç±»å‹ PEMã€JKS</span></span><br><span class=\"line\">ssl.keystore.location=/usr/local/kafka/kafka3/config/ssl/fullchain.pem <span class=\"comment\"># åŒ…å«ç§é’¥å’Œå…¬é’¥</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨çš„è¯ä¹¦ç±»å‹æ˜¯PEM</span></span><br><span class=\"line\">ssl.truststore.type=PEM</span><br><span class=\"line\">ssl.truststore.location=/usr/local/kafka/kafka3/config/ssl/server.crt <span class=\"comment\"># å…¬é’¥</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä¸è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¯ä»¥è®¾ç½® none ï¼Œè¦æ±‚åˆ™è®¾ç½®ä¸º required</span></span><br><span class=\"line\">ssl.client.auth=none</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>client.conf é…ç½®å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">security.protocol=SASL_SSL</span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒ PLAINã€SCRAM-SHA-256ã€SCRAM-SHA-512ï¼Œè¦ä¸ æœåŠ¡ç«¯ä¸€è‡´</span></span><br><span class=\"line\">sasl.mechanism=PLAIN</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule required</span></span><br><span class=\"line\">sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=<span class=\"string\">&quot;admin&quot;</span> password=<span class=\"string\">&quot;admin-secret&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SSL é…ç½®ï¼Œå°† server ç«¯çš„ server.crt æ‹·è´åˆ° client ç«¯</span></span><br><span class=\"line\">ssl.truststore.location=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/server.crt</span><br><span class=\"line\">ssl.truststore.type=PEM</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¦ç”¨ä¸»æœºåéªŒè¯</span></span><br><span class=\"line\">ssl.endpoint.identification.algorithm=</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>jks è¯ä¹¦è½¬æ¢ä¸º pem æ ¼å¼</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">ä» JKS å¯¼å‡ºä¸º PKCS#12 (.p12)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">keytool -importkeystore \\</span><br><span class=\"line\">  -srckeystore kafka.server.keystore.jks \\</span><br><span class=\"line\">  -srcstoretype JKS \\</span><br><span class=\"line\">  -destkeystore kafka.server.p12 \\</span><br><span class=\"line\">  -deststoretype PKCS12 \\</span><br><span class=\"line\">  -srcstorepass 123456 \\</span><br><span class=\"line\">  -deststorepass 123456 \\</span><br><span class=\"line\">  -J<span class=\"string\">&quot;-Djdk.tls.disabledAlgorithms=&quot;</span> \\</span><br><span class=\"line\">  -J<span class=\"string\">&quot;-Dkeystore.pkcs12.legacy=false&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜ï¼š</span></span><br><span class=\"line\">  <span class=\"comment\"># -srcstoretype JKSï¼šåŸå§‹æ ¼å¼ï¼›</span></span><br><span class=\"line\">  <span class=\"comment\"># -deststoretype PKCS12ï¼šè½¬æ¢ä¸ºé€šç”¨æ ¼å¼ï¼›</span></span><br><span class=\"line\">  <span class=\"comment\"># .p12 æ˜¯ PEM çš„â€œä¸­é—´æ ¼å¼â€ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">å¯¼å‡ºè¯ä¹¦[å…¬é’¥] (.crtï¼Œè¿™é‡Œæ˜¯ PEM æ ¼å¼)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> kafka.server.p12 -clcerts -nokeys -out server.crt -password pass:123456 -provider legacy -provider default</span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># -clcertsï¼šåªå¯¼å‡ºè¯ä¹¦ï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># -nokeysï¼šä¸å¯¼å‡ºå¯†é’¥ï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># -out server.crtï¼šå¯¼å‡ºæ–‡ä»¶åï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># -passwordï¼škafka.server.p12çš„å¯†é’¥å¯†ç ï¼Œæ³¨æ„å¯†ç å‰é¢åŠ ä¸Š pass:</span></span><br><span class=\"line\"><span class=\"comment\"># -provider legacyï¼šå¯ç”¨æ—§ç®—æ³•æ”¯æŒæ¨¡å—ï¼Œåœ¨ OpenSSL 3.0ï¼ˆåŠæ›´é«˜ç‰ˆæœ¬ï¼‰ä¸­ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°æœºåˆ¶ â€”â€” Providerï¼ˆç®—æ³•æä¾›è€…ï¼‰,é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenSSL åªåŠ è½½ modern providerï¼ˆdefault providerï¼‰ï¼Œè€Œè®¸å¤šè€æ—§ç®—æ³•ï¼ˆä¾‹å¦‚ RC2ã€MD5ã€DESã€SHA1ï¼‰è¢«ç§»åˆ°äº†ä¸€ä¸ªå•ç‹¬çš„ legacy provider æ¨¡å—ä¸­ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># -provider defaultï¼šåŒæ—¶å¯ç”¨é»˜è®¤ providerï¼Œå› ä¸ºæœ‰äº›å‘½ä»¤ï¼ˆæ¯”å¦‚æ¶‰åŠç°ä»£åŠ å¯†ç®—æ³•æˆ–è¯ä¹¦ç­¾åï¼‰è¿˜ä¾èµ–é»˜è®¤ providerï¼Œæ‰€ä»¥ä¸¤è€…ä¸€èµ·ä½¿ç”¨æœ€å®‰å…¨ã€æœ€å…¼å®¹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">å¯¼å‡ºç§é’¥ (.keyï¼Œè¿™é‡Œæ˜¯ PEM æ ¼å¼)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> kafka.server.p12 -nocerts -out server.key -nodes -password pass:123456 -provider legacy -provider default</span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># -nocertsï¼šåªå¯¼å‡ºå¯†é’¥ï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># -out server.keyï¼šå¯¼å‡ºæ–‡ä»¶åï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># -nodesï¼šä¸åŠ å¯†å¯¼å‡ºçš„å¯†é’¥æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># -passwordï¼škafka.server.p12çš„å¯†é’¥å¯†ç ï¼Œæ³¨æ„å¯†ç å‰é¢åŠ ä¸Š pass:</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">fullchain.pem</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> kafka.server.p12 -out fullchain.pem -nodes -password pass:123456 -provider legacy -provider default</span><br></pre></td></tr></table></figure>\n</div>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ é€šä¿¡åè®®ï¼Œä»¥åŠå¦‚ä½•å¼€å¯å¤–ç½‘è®¿é—®ã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Kafka çš„ é€šä¿¡åè®® Kafka ä¸»è¦æ”¯æŒå››ç§å®‰å…¨åè®® åè®®åç§° åŠ å¯† è®¤è¯ è¯´æ˜ æ¨èåœºæ™¯ ç†ç”± PLAINTEXT âŒ å¦ âŒ å¦ æ— åŠ å¯†ã€æ— è®¤è¯ï¼ˆé»˜è®¤æœ€ç®€å•ï¼‰ å¼€å‘ / æµ‹è¯•ç¯å¢ƒã€å†…ç½‘é›†ç¾¤é€šä¿¡ ç®€å•ã€æ˜“è°ƒè¯•ï¼›ç½‘ç»œå¯ä¿¡ï¼Œæ€§èƒ½ä¼˜å…ˆ SSL âœ… æ˜¯ âœ… å¯é€‰ ä½¿ç”¨ TLS/SSL åŠ å¯†é€šä¿¡ï¼Œå¯é…ç½®å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯ å¤–ç½‘å®¢æˆ·ç«¯è®¿é—® æ”¯æŒæ•°æ®åŠ å¯†ï¼Œå¯é€‰è®¤è¯ï¼Œä¿è¯å®‰å…¨ SASL_PLAINTEXT âŒ å¦ âœ… æ˜¯ ä½¿ç”¨ SASLï¼ˆç”¨æˆ·åå¯†ç ï¼‰è®¤è¯ï¼Œä½†ä¸åŠ å¯†æ•°æ® éœ€è¦ç”¨æˆ·è®¤è¯ä½†å±€åŸŸç½‘ç¯å¢ƒ æœ‰è®¤è¯ï¼Œä½†ä¸åŠ å¯†ï¼Œæ€§èƒ½å¼€é”€ä½ SASL_SSL âœ… æ˜¯ âœ… æ˜¯ åŒæ—¶æ”¯æŒ SASL è®¤è¯å’Œ SSL åŠ å¯†ï¼ˆæœ€å®‰å…¨ï¼‰ å¤–ç½‘å®¢æˆ·ç«¯è®¿é—® æ—¢æœ‰è®¤è¯åˆåŠ å¯†ï¼Œå®‰å…¨æ€§æœ€é«˜ åœ¨ config/server.properties æ–‡ä»¶ä¸­ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é…ç½® 12345678910111213141516171819# å¥—æ¥å­—æœåŠ¡å™¨ç›‘å¬çš„åœ°å€ã€‚# å¦‚æœæœªé…ç½®ï¼Œåˆ™ä¸»æœºåé»˜è®¤ç­‰äº `java.net.InetAddress.getCanonicalHostName()` çš„è¿”å›å€¼ï¼Œ# ä½¿ç”¨ç›‘å¬å™¨åç§° `PLAINTEXT`ï¼Œç«¯å£å·ä¸º 9092ã€‚# æ ¼å¼ï¼š# listeners = listener_name://host_name:port# ç¤ºä¾‹ï¼š# listeners = PLAINTEXT://your.host.name:9092#listeners=PLAINTEXT://:9092# Broker å‘å®¢æˆ·ç«¯â€œé€šå‘Šâ€çš„ç›‘å¬å™¨åç§°ã€ä¸»æœºåå’Œç«¯å£ã€‚# å®¢æˆ·ç«¯å®é™…ä¼šè¿æ¥è¿™ä¸ªåœ°å€ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ listeners çš„åœ°å€ã€‚# å¦‚æœæœªè®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ `listeners` çš„å€¼ã€‚#advertised.listeners=PLAINTEXT://your.host.name:9092# å°†ç›‘å¬å™¨åç§°æ˜ å°„åˆ°å®‰å…¨åè®®ç±»å‹ã€‚# é»˜è®¤æƒ…å†µä¸‹ï¼Œç›‘å¬å™¨åç§°ä¸å®‰å…¨åè®®åŒåã€‚# ä¾‹å¦‚ï¼šPLAINTEXTâ†’PLAINTEXTã€SSLâ†’SSLã€SASL_PLAINTEXTâ†’SASL_PLAINTEXTã€SASL_SSLâ†’SASL_SSLã€‚# æ›´å¤šç»†èŠ‚å¯å‚è€ƒ Kafka å®˜æ–¹é…ç½®æ–‡æ¡£ã€‚#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL é…ç½®é¡¹ ä½œç”¨ è¯´æ˜å€¼ listeners Kafka å®é™…ç›‘å¬çš„åœ°å€ï¼ˆBroker å¯¹å¤–å¼€æ”¾çš„ç«¯å£ï¼‰ PLAINTEXT://:9092è¿™é‡Œ PLAINTEXT æ˜¯ç›‘å¬å™¨åç§°ï¼Œå¹¶ä¸æ˜¯åè®®åç§°ï¼Œå®é™…ä¸Šå¯ä»¥é…ç½®ä¸ºä»»ä½•å€¼ï¼Œå…·ä½“åè®®æ˜¯é€šè¿‡ listener.security.protocol.map é…ç½®çš„æ˜ å°„å…³ç³»æ¥ç¡®å®šã€‚ advertised.listeners Kafka å‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç”¨å“ªä¸ªåœ°å€è¿æ¥ï¼ˆå®¢æˆ·ç«¯æœ€ç»ˆè¿çš„ï¼‰ é»˜è®¤ä½¿ç”¨ listeners çš„å€¼ listener.security.protocol.map æ˜ å°„ç›‘å¬å™¨åç§°åˆ°é€šä¿¡å®‰å…¨åè®®ï¼ˆå¦‚æ˜æ–‡ã€SSLã€SASL ç­‰ï¼‰ PLAINTEXT:PLAINTEXTï¼Œå‰é¢æ˜¯ç›‘å¬å™¨åç§°ï¼Œåé¢æ˜¯åè®®åç§° ä»…éœ€å†…ç½‘è®¿é—® 12listeners=PLAINTEXT://0.0.0.0:9092advertised.listeners=PLAINTEXT://worker1:9092 # è¿™é‡Œæ˜¯å†…ç½‘ip å…è®¸å¤–ç½‘è®¿é—® 12listeners=PLAINTEXT://0.0.0.0:9092advertised.listeners=PLAINTEXT://161.189.227.200:9092 # è¿™é‡Œæ˜¯å¤–ç½‘ip å†…å¤–ç½‘éƒ½è¦è®¿é—®ï¼ˆæ¨èåŒé€šé“æ–¹å¼ï¼‰ 12345678# è¿™é‡Œ INTERNAL å’Œ EXTERNAL åˆ†åˆ«æ˜¯è‡ªå®šä¹‰çš„ç›‘å¬å™¨åç§°ï¼Œæ­¤æ—¶å†…ç½‘ç«¯å£ä¸º 9092ï¼Œå¤–ç½‘ç«¯å£ä¸º 9093listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9093# å‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç”¨å“ªä¸ªåœ°å€è¿æ¥advertised.listeners=INTERNAL://worker1:9092,EXTERNAL://161.189.227.200:9093# æ˜ å°„ç›‘å¬å™¨åç§°åˆ°é€šä¿¡å®‰å…¨åè®®çš„æ˜ å°„å…³ç³»listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT# é›†ç¾¤é—´é€šä¿¡ä»ä½¿ç”¨å†…ç½‘inter.broker.listener.name=INTERNAL å¼€å¯ SASL_PLAINTEXT è¿™é‡Œè®¾ç½®å¤–ç½‘è®¿é—®æ—¶å¼€å¯ SASL_PLAINTEXT 12345678910111213# ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9094# å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€advertised.listeners=INTERNAL://worker1:9092,EXTERNAL://161.189.227.200:9094listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_PLAINTEXT# é›†ç¾¤é—´é€šä¿¡ still use INTERNALinter.broker.listener.name=INTERNAL# è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512ï¼‰# client è¿æ¥æ—¶sasl.enabled.mechanisms=PLAIN# broker ä¹‹é—´è¿æ¥æ—¶ï¼Œå› ä¸º inter.broker.listener.name=INTERNALï¼Œæ‰€ä»¥ INTERNAL:SASL_PLAINTEXT æ‰æœ‰æ•ˆ#sasl.mechanism.inter.broker.protocol=PLAIN åˆ›å»º kafka_jaas.conf 123456789101112131415############################# Kafka Broker (æœåŠ¡ç«¯)############################KafkaServer &#123; # å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule required org.apache.kafka.common.security.plain.PlainLoginModule required # Broker è‡ªå·±çš„èº«ä»½ï¼ˆç”¨äº broker ä¹‹é—´é€šä¿¡ï¼Œæœ¬ç¤ºä¾‹ä¸­æ²¡æœ‰ä½¿ç”¨ï¼‰ username=&quot;admin&quot; password=&quot;admin-secret&quot; # å®¢æˆ·ç«¯å¯ç”¨è´¦å·ï¼Œå³ user_xxxï¼Œè¿™é‡Œ xxx ä¸ºç”¨æˆ·åï¼Œ= å³è¾¹çš„ä¸ºå¯†ç  user_admin=&quot;admin-secret&quot; user_alice=&quot;alice-secret&quot; user_bob=&quot;bob-secret&quot;;&#125;; å¯åŠ¨ kafka 123# åœ¨å¯åŠ¨ Kafka Broker å‰ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡æŒ‡å‘ JAAS æ–‡ä»¶export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/usr/local/kafka/kafka3/config/kafka_jaas.conf&quot;kafka-server-start.sh config/server.properties å®¢æˆ·ç«¯è®¿é—® åˆ›å»º client.conf 12345security.protocol=SASL_PLAINTEXT# è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒ PLAINã€SCRAM-SHA-256ã€SCRAM-SHA-512ï¼Œè¦ä¸ æœåŠ¡ç«¯ä¸€è‡´sasl.mechanism=PLAIN# å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule requiredsasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;admin&quot; password=&quot;admin-secret&quot;; å‘½ä»¤è¡Œè®¿é—® 12345678# åˆ›å»ºtopickafka-topics.sh --create --topic test-topic --bootstrap-server=161.189.227.200:9094 --command-config=client.conf# æŸ¥çœ‹topickafka-topics.sh --list --bootstrap-server=161.189.227.200:9094 --command-config=client.conf# åˆ›å»ºæ¶ˆè´¹è€…ï¼Œ--group æŒ‡å®šæ¶ˆè´¹è€…ç»„åç§°kafka-console-consumer.sh --bootstrap-server=161.189.227.200:9094 --topic test-topic --consumer.config=client.conf --group=test-group# åˆ›å»ºç”Ÿäº§è€…kafka-console-producer.sh --bootstrap-server=161.189.227.200:9094 --topic test-topic --producer.config=client.conf å¼€å¯ SASL_SSL è¿™é‡Œè®¾ç½®å¤–ç½‘è®¿é—®æ—¶å¼€å¯ SASL_SSL åˆ›å»ºè¯ä¹¦ å®˜æ–¹æ–‡æ¡£ ç”Ÿæˆ Broker keystoreï¼Œç”¨äº å­˜å‚¨ broker çš„ç§é’¥å’Œè¯ä¹¦ã€‚ 1234567891011121314keytool -keystore kafka.server.keystore.jks \\ -alias broker -validity 3650 \\ -genkey -keyalg RSA \\ -dname &quot;CN=broker, OU=Kafka, O=YourOrg, L=City, ST=State, C=CN&quot; \\ -storepass 123456 \\ -keypass 123456## å‚æ•°è¯´æ˜ï¼š# -keystoreï¼šç”Ÿæˆçš„ keystore æ–‡ä»¶è·¯å¾„# -alias brokerï¼šè¯ä¹¦åˆ«å# -validity 3650ï¼šæœ‰æ•ˆæœŸ 3650 å¤©# -keyalg RSAï¼šå¯†é’¥ç®—æ³•# -dnameï¼šè¯ä¹¦ä¿¡æ¯# -storepassï¼škeystore å¯†ç # -keypassï¼šå¯†é’¥å¯†ç  å¯¼å‡º Broker è¯ä¹¦ï¼ˆç”¨äºå®¢æˆ·ç«¯ truststoreï¼‰,ç”Ÿæˆ kafka.server.crtï¼Œå®¢æˆ·ç«¯ä¼šç”¨å®ƒæ¥éªŒè¯ brokerã€‚ 12345678keytool -keystore kafka.server.keystore.jks \\ -alias broker -export -file kafka.server.crt \\ -storepass 123456## å‚æ•°è¯´æ˜ï¼š# -keystoreï¼škeystore æ–‡ä»¶è·¯å¾„# -alias brokerï¼šè¯ä¹¦åˆ«å# -file kafka.server.crtï¼šå¯¼å‡ºçš„è¯ä¹¦æ–‡ä»¶è·¯å¾„# -storepassï¼škeystore å¯†ç  ç”Ÿæˆ Broker truststoreï¼Œtruststore ç”¨äº å­˜å‚¨ä¿¡ä»»çš„è¯ä¹¦ï¼ˆè¿™é‡ŒæŠŠè‡ªå·±ç”Ÿæˆçš„è¯ä¹¦å¯¼å…¥è¿›å»å³å¯ï¼‰,ç”Ÿæˆ kafka.truststore.jks 12345678910# æ³¨æ„ï¼šè¿™é‡Œ server ç«¯ å’Œ client ç«¯ å¯ä»¥å…±ç”¨ä¸€ä¸ª truststoreï¼Œä¹Ÿå¯ä»¥åˆ†åˆ«åˆ›å»ºkeytool -keystore kafka.truststore.jks \\ -alias broker -import -file kafka.server.crt \\ -storepass 123456 -noprompt# å‚æ•°è¯´æ˜ï¼š# -keystoreï¼šç”Ÿæˆçš„ truststore æ–‡ä»¶è·¯å¾„# -alias brokerï¼šè¯ä¹¦åˆ«å# -file kafka.server.crtï¼šå¯¼å…¥çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„# -storepassï¼štruststore å¯†ç # -nopromptï¼šä¸æç¤º server.properties é…ç½® SASL_SSL 1234567891011121314151617181920212223# ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9095# å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€advertised.listeners=INTERNAL://worker2:9092,EXTERNAL://161.189.227.200:9095listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_SSLinter.broker.listener.name=INTERNAL# SASL# è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512ï¼‰# client è¿æ¥æ—¶sasl.enabled.mechanisms=PLAIN# broker ä¹‹é—´è¿æ¥æ—¶ï¼Œéœ€è¦ inter.broker.listener.name=SASL_PLAINTEXT æ‰æœ‰æ•ˆ#sasl.mechanism.inter.broker.protocol=PLAIN# SSLssl.keystore.location=/usr/local/kafka/kafka3/config/ssl/kafka.server.keystore.jksssl.keystore.password=123456ssl.key.password=123456ssl.truststore.location=/usr/local/kafka/kafka3/config/ssl/kafka.truststore.jksssl.truststore.password=123456# å¦‚æœä¸è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¯ä»¥è®¾ç½® none ï¼Œè¦æ±‚åˆ™è®¾ç½®ä¸º requiredssl.client.auth=none å¯åŠ¨ kafka å‰åŒæ ·éœ€è¦å…ˆåˆ›å»ºå¥½ kafka_jaas.confï¼Œä¸ SASL_PLAINTEXT ä¸€æ ·ã€‚ å®¢æˆ·ç«¯è®¿é—® å°† kafka.truststore.jks æ‹·è´åˆ°å®¢æˆ·ç«¯ ä¸ SASL_PLAINTEXT ä¸€æ ·ï¼Œåˆ›å»º client.confï¼Œå¹¶æ·»åŠ å¦‚ä¸‹ä¿¡æ¯ 1234567891011security.protocol=SASL_SSL# è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒ PLAINã€SCRAM-SHA-256ã€SCRAM-SHA-512ï¼Œè¦ä¸ æœåŠ¡ç«¯ä¸€è‡´sasl.mechanism=PLAIN# å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule requiredsasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;admin&quot; password=&quot;admin-secret&quot;;# SSL é…ç½®ssl.truststore.location=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/kafka.truststore.jksssl.truststore.password=123456# ç¦ç”¨ä¸»æœºåéªŒè¯ï¼Œå¦åˆ™ä¼šæ ¡éªŒè¯ä¹¦çš„ SANï¼Œè¯ä¹¦åŸŸåæ ¡éªŒå¼€å…³ï¼Œä¸ºç©ºåˆ™è¡¨ç¤ºå…³é—­ï¼Œè¿™é‡Œéœ€è¦ä¿æŒå…³é—­çŠ¶æ€ï¼Œå¿…é¡»è®¾ç½®ä¸ºç©ºssl.endpoint.identification.algorithm= å‘½ä»¤è¡Œè®¿é—® ä¸ SASL_PLAINTEXT ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿° å…³äº Kafka JKSæ ¼å¼çš„SSLè¯ä¹¦çš„åˆ›å»ºåŠé…ç½®å¯ä»¥å‚è€ƒåˆ¶ä½œå’Œæ›¿æ¢Kafka JKSæ ¼å¼çš„SSLè¯ä¹¦ PEM è¯ä¹¦ Kafka çš„ è¯ä¹¦ é»˜è®¤ä½¿ç”¨ JKS æ ¼å¼ï¼Œä½†ä» 2.7.0 å¼€å§‹æ”¯æŒ PEM æ ¼å¼ 123456789101112131415161718192021222324# ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9095# å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€advertised.listeners=INTERNAL://worker2:9092,EXTERNAL://161.189.227.200:9095listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_SSLinter.broker.listener.name=INTERNAL# SASL# è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ CRAM-SHA-256ã€SCRAM-SHA-512ï¼‰# client è¿æ¥æ—¶sasl.enabled.mechanisms=PLAIN# broker ä¹‹é—´è¿æ¥æ—¶ï¼Œéœ€è¦ inter.broker.listener.name=SASL_PLAINTEXT æ‰æœ‰æ•ˆ#sasl.mechanism.inter.broker.protocol=PLAIN# SSL-PEMssl.keystore.type=PEM # æŒ‡å®šè¯ä¹¦ç±»å‹æ˜¯PEMï¼Œæ”¯æŒçš„ç±»å‹ PEMã€JKSssl.keystore.location=/usr/local/kafka/kafka3/config/ssl/fullchain.pem # åŒ…å«ç§é’¥å’Œå…¬é’¥# æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨çš„è¯ä¹¦ç±»å‹æ˜¯PEMssl.truststore.type=PEMssl.truststore.location=/usr/local/kafka/kafka3/config/ssl/server.crt # å…¬é’¥# å¦‚æœä¸è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¯ä»¥è®¾ç½® none ï¼Œè¦æ±‚åˆ™è®¾ç½®ä¸º requiredssl.client.auth=none client.conf é…ç½®å¦‚ä¸‹ï¼š 123456789101112security.protocol=SASL_SSL# è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒ PLAINã€SCRAM-SHA-256ã€SCRAM-SHA-512ï¼Œè¦ä¸ æœåŠ¡ç«¯ä¸€è‡´sasl.mechanism=PLAIN# å¦‚æœä½¿ç”¨ SCRAM-SHA-256 æˆ–è€… SCRAM-SHA-512 è®¤è¯ï¼Œåˆ™éœ€è¦é…ç½® ä¸º org.apache.kafka.common.security.scram.ScramLoginModule requiredsasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;admin&quot; password=&quot;admin-secret&quot;;# SSL é…ç½®ï¼Œå°† server ç«¯çš„ server.crt æ‹·è´åˆ° client ç«¯ssl.truststore.location=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/server.crtssl.truststore.type=PEM# ç¦ç”¨ä¸»æœºåéªŒè¯ssl.endpoint.identification.algorithm= jks è¯ä¹¦è½¬æ¢ä¸º pem æ ¼å¼ ä» JKS å¯¼å‡ºä¸º PKCS#12 (.p12) 1234567891011121314keytool -importkeystore \\ -srckeystore kafka.server.keystore.jks \\ -srcstoretype JKS \\ -destkeystore kafka.server.p12 \\ -deststoretype PKCS12 \\ -srcstorepass 123456 \\ -deststorepass 123456 \\ -J&quot;-Djdk.tls.disabledAlgorithms=&quot; \\ -J&quot;-Dkeystore.pkcs12.legacy=false&quot;## è¯´æ˜ï¼š # -srcstoretype JKSï¼šåŸå§‹æ ¼å¼ï¼› # -deststoretype PKCS12ï¼šè½¬æ¢ä¸ºé€šç”¨æ ¼å¼ï¼› # .p12 æ˜¯ PEM çš„â€œä¸­é—´æ ¼å¼â€ã€‚ å¯¼å‡ºè¯ä¹¦[å…¬é’¥] (.crtï¼Œè¿™é‡Œæ˜¯ PEM æ ¼å¼) 12345678openssl pkcs12 -in kafka.server.p12 -clcerts -nokeys -out server.crt -password pass:123456 -provider legacy -provider default## è¯´æ˜ï¼š# -clcertsï¼šåªå¯¼å‡ºè¯ä¹¦ï¼›# -nokeysï¼šä¸å¯¼å‡ºå¯†é’¥ï¼›# -out server.crtï¼šå¯¼å‡ºæ–‡ä»¶åï¼›# -passwordï¼škafka.server.p12çš„å¯†é’¥å¯†ç ï¼Œæ³¨æ„å¯†ç å‰é¢åŠ ä¸Š pass:# -provider legacyï¼šå¯ç”¨æ—§ç®—æ³•æ”¯æŒæ¨¡å—ï¼Œåœ¨ OpenSSL 3.0ï¼ˆåŠæ›´é«˜ç‰ˆæœ¬ï¼‰ä¸­ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°æœºåˆ¶ â€”â€” Providerï¼ˆç®—æ³•æä¾›è€…ï¼‰,é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenSSL åªåŠ è½½ modern providerï¼ˆdefault providerï¼‰ï¼Œè€Œè®¸å¤šè€æ—§ç®—æ³•ï¼ˆä¾‹å¦‚ RC2ã€MD5ã€DESã€SHA1ï¼‰è¢«ç§»åˆ°äº†ä¸€ä¸ªå•ç‹¬çš„ legacy provider æ¨¡å—ä¸­ã€‚# -provider defaultï¼šåŒæ—¶å¯ç”¨é»˜è®¤ providerï¼Œå› ä¸ºæœ‰äº›å‘½ä»¤ï¼ˆæ¯”å¦‚æ¶‰åŠç°ä»£åŠ å¯†ç®—æ³•æˆ–è¯ä¹¦ç­¾åï¼‰è¿˜ä¾èµ–é»˜è®¤ providerï¼Œæ‰€ä»¥ä¸¤è€…ä¸€èµ·ä½¿ç”¨æœ€å®‰å…¨ã€æœ€å…¼å®¹ å¯¼å‡ºç§é’¥ (.keyï¼Œè¿™é‡Œæ˜¯ PEM æ ¼å¼) 123456openssl pkcs12 -in kafka.server.p12 -nocerts -out server.key -nodes -password pass:123456 -provider legacy -provider default## è¯´æ˜ï¼š# -nocertsï¼šåªå¯¼å‡ºå¯†é’¥ï¼›# -out server.keyï¼šå¯¼å‡ºæ–‡ä»¶åï¼›# -nodesï¼šä¸åŠ å¯†å¯¼å‡ºçš„å¯†é’¥æ–‡ä»¶# -passwordï¼škafka.server.p12çš„å¯†é’¥å¯†ç ï¼Œæ³¨æ„å¯†ç å‰é¢åŠ ä¸Š pass: fullchain.pem 1openssl pkcs12 -in kafka.server.p12 -out fullchain.pem -nodes -password pass:123456 -provider legacy -provider default","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ é€šä¿¡åè®®ï¼Œä»¥åŠå¦‚ä½•å¼€å¯å¤–ç½‘è®¿é—®ã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚","date_published":"2025-10-13T14:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/10/13/kafka-01-install-zookeeper/","url":"https://blog.hanqunfeng.com/2025/10/13/kafka-01-install-zookeeper/","title":"Kafka çš„å®‰è£…ï¼šåŸºäº Zookeeper","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº Zookeeperã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Kafka-ç®€ä»‹\">Kafka ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Apache Kafka æ˜¯ä¸€ä¸ª <code>åˆ†å¸ƒå¼çš„æµå¤„ç†/äº‹ä»¶æµå¹³å°</code>ï¼Œæ—¢å¯ä»¥ä½œä¸º<code>æ¶ˆæ¯ç³»ç»Ÿ</code>ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæŒä¹…åŒ–çš„ <code>æ—¥å¿—/è®°å½•å­˜å‚¨ä¸æµå¤„ç†å¹³å°</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯é«˜ååã€ä½å»¶è¿Ÿã€å¯æ°´å¹³æ‰©å±•ã€å®¹é”™ï¼Œä»¥åŠå¯æŒä¹…åŒ–æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ Kafka ä¸­ï¼Œæ¶ˆæ¯è¢«å½’ç±»ä¸º <code>ä¸»é¢˜ï¼ˆTopicï¼‰</code>ï¼Œæ¯ä¸ªä¸»é¢˜å¯ä»¥æ ¹æ®é…ç½®è¢«æ‹†åˆ†ä¸ºå¤šä¸ª <code>åˆ†åŒºï¼ˆPartitionï¼‰</code>ï¼Œæ¯ä¸ªåˆ†åŒºå†…éƒ¨æ¶ˆæ¯æ˜¯<code>ä¸¥æ ¼æœ‰åº</code>çš„ï¼Œå¹¶ä»¥<code>è¿½åŠ </code>æ–¹å¼å†™å…¥ã€‚æ¶ˆè´¹è€…å¯ä»¥æŒ‰<code>åç§»é‡ï¼ˆoffsetï¼‰</code>è¯»å–æ¶ˆæ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kafka æä¾›å¤šä¸ª APIï¼šProducerã€Consumerã€Streamsï¼ˆæµå¤„ç†ï¼‰ã€Connectï¼ˆä¸å¤–éƒ¨ç³»ç»Ÿæ•´åˆï¼‰ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kafka çš„æ ¸å¿ƒæ¶æ„è¦ç´ ä¸å·¥ä½œæœºåˆ¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç»„ä»¶ / æ¦‚å¿µ</th>\n<th>ä½œç”¨ / æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Brokerï¼ˆèŠ‚ç‚¹ / æœåŠ¡å™¨ï¼‰</td>\n<td>Kafka é›†ç¾¤ä¸­çš„æœåŠ¡å™¨å®ä¾‹ï¼Œè´Ÿè´£æ¥æ”¶ã€å­˜å‚¨ã€åˆ†å‘æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td>Topic</td>\n<td>æ¶ˆæ¯çš„â€œåˆ†ç±»â€é€»è¾‘å•å…ƒï¼ŒProducer å†™å…¥ã€Consumer è¯»å–</td>\n</tr>\n<tr>\n<td>Partition</td>\n<td>ä¸€ä¸ª Topic è¢«åˆ’åˆ†çš„å­å•å…ƒã€‚åˆ†åŒºä½¿å¾—ä¸»é¢˜å¯ä»¥æ¨ªå‘æ‰©å±•ï¼Œå¹¶æ”¯æŒå¹¶è¡Œè¯»å†™</td>\n</tr>\n<tr>\n<td>Offset</td>\n<td>æ¯æ¡æ¶ˆæ¯åœ¨æŸä¸ªåˆ†åŒºä¸­çš„å”¯ä¸€ä½ç½®æ ‡è¯†ï¼Œæ¶ˆè´¹è€…æ ¹æ® offset æ¥å†³å®šä¸‹ä¸€æ¡è¯»å–</td>\n</tr>\n<tr>\n<td>Replicationï¼ˆå‰¯æœ¬ï¼‰</td>\n<td>ä¸ºäº†å®¹é”™æ€§ï¼Œæ¯ä¸ªåˆ†åŒºå¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆå‰¯æœ¬åˆ†å¸ƒåœ¨ä¸åŒ Broker ä¸Šï¼‰</td>\n</tr>\n<tr>\n<td>Leader / Follower</td>\n<td>åœ¨å‰¯æœ¬ä¸­ï¼Œä¸€ä¸ªå‰¯æœ¬ä¸º Leaderï¼Œæ¥å—è¯»å†™è¯·æ±‚ï¼›å…¶ä»–ä¸º Followerï¼Œä» Leader åŒæ­¥æ•°æ®</td>\n</tr>\n<tr>\n<td>Consumer Group</td>\n<td>ä¸€ç»„æ¶ˆè´¹è€…å…±åŒæ¶ˆè´¹ä¸€ä¸ª Topicã€‚æ¯ä¸ªåˆ†åŒºåœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­é€šå¸¸åªè¢«ä¸€ä¸ªæ¶ˆè´¹è€… â€œæ‹¥æœ‰â€</td>\n</tr>\n<tr>\n<td>ZooKeeper / KRaft</td>\n<td>ç”¨äºå…ƒæ•°æ®ç®¡ç†ã€é›†ç¾¤åè°ƒï¼ˆåœ¨è¾ƒè€ç‰ˆæœ¬ä¸­æ˜¯ ZooKeeperï¼›æ–°ç‰ˆæœ¬æ¨å‘ KRaftï¼‰</td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/Xe43JY.png\" alt=\"\" width=\"900\" height=\"600\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¶ˆæ¯å†™å…¥æµç¨‹ï¼ˆç®€åŒ–ï¼‰ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Producer å°†æ¶ˆæ¯å‘é€ç»™æŸä¸ª Topic çš„ Leader åˆ†åŒºèŠ‚ç‚¹</li>\n<li class=\"lvl-4\">Leader æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†å…¶è¿½åŠ å†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œå¹¶è¿”å›ç¡®è®¤ï¼ˆACKï¼‰</li>\n<li class=\"lvl-4\">Follower å‰¯æœ¬ä» Leader æ‹‰å–æ•°æ®è¿›è¡ŒåŒæ­¥</li>\n<li class=\"lvl-4\">æ¶ˆè´¹è€…æ ¹æ®è‡ªå·±çš„ offset ä»å¯¹åº” Partition ä¸­è¯»å–æ¶ˆæ¯</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ¶ˆè´¹æ§åˆ¶ä¸å®¹é”™ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ¶ˆè´¹è€…ç»´æŠ¤è‡ªå·±çš„ offsetï¼ˆå¯ä»¥è‡ªåŠ¨æäº¤ï¼Œä¹Ÿå¯æ‰‹åŠ¨æ§åˆ¶ï¼‰ï¼Œè¿™æ ·å³ä½¿æ¶ˆè´¹è€…é‡å¯ï¼Œä¹Ÿå¯ä»¥ä»ä¸Šæ¬¡åœæ­¢çš„ä½ç½®ç»§ç»­ã€‚</li>\n<li class=\"lvl-4\">å¦‚æœæŸä¸ª Broker å®•æœºï¼Œå‰¯æœ¬å¯ä»¥åˆ‡æ¢ï¼ˆLeader é€‰ä¸¾ï¼‰ï¼Œä¿è¯æœåŠ¡ç»§ç»­ã€‚</li>\n<li class=\"lvl-4\">åˆ†åŒºä¸å‰¯æœ¬æœºåˆ¶ä½¿å¾— Kafka èƒ½å¤Ÿæ‰©å±•å®¹é‡ &amp; æé«˜å¯é æ€§ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Kafka çš„å…¸å‹ä½¿ç”¨åœºæ™¯</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯ç±»åˆ«</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å®æ—¶æ•°æ®ç®¡é“ / æ•°æ®é›†æˆ</strong></td>\n<td>ç”¨äºå°†å„ç§æ•°æ®æºï¼ˆå¦‚æ—¥å¿—ã€æ•°æ®åº“å˜æ›´ã€ä¼ æ„Ÿå™¨ã€ç”¨æˆ·äº‹ä»¶ç­‰ï¼‰å®æ—¶é‡‡é›†ã€ä¼ è¾“ã€åˆ†å‘åˆ°ä¸‹æ¸¸ç³»ç»Ÿï¼ˆå¦‚ OLAPã€æœç´¢å¼•æ“ã€ç›‘æ§å¹³å°ç­‰ï¼‰ï¼Œæ„å»ºé«˜æ•ˆçš„æ•°æ®é€šé“ã€‚</td>\n</tr>\n<tr>\n<td><strong>äº‹ä»¶é©±åŠ¨ / äº‹ä»¶æº¯æº</strong></td>\n<td>è®°å½•ç³»ç»Ÿå†…éƒ¨æˆ–è·¨ç³»ç»Ÿçš„äº‹ä»¶ï¼ˆçŠ¶æ€å˜åŒ–ï¼‰ï¼Œå®ç°äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰æˆ–äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰ï¼Œå¯ç”¨äºå®¡è®¡ã€å›æ”¾ã€çŠ¶æ€é‡å»ºç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>æ—¥å¿—èšåˆ / åˆ†æ</strong></td>\n<td>å°†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨æ—¥å¿—ã€ç›‘æ§æŒ‡æ ‡ã€æ“ä½œæ—¥å¿—ç­‰ç»Ÿä¸€æ”¶é›†åˆ° Kafka ä¸­ï¼Œé›†ä¸­å­˜å‚¨ä¸åˆ†æï¼Œå¸¸ä¸ ELKã€ClickHouse ç­‰ç»“åˆã€‚</td>\n</tr>\n<tr>\n<td><strong>æµå¤„ç†</strong></td>\n<td>ä¸ Kafka Streamsã€Apache Flinkã€Spark Streaming ç­‰æµå¤„ç†æ¡†æ¶é…åˆï¼Œå¯¹æµç» Kafka çš„æ•°æ®è¿›è¡Œå®æ—¶è®¡ç®—ã€èšåˆã€è¿‡æ»¤ã€çª—å£ç»Ÿè®¡ç­‰æ“ä½œã€‚</td>\n</tr>\n<tr>\n<td><strong>ç³»ç»Ÿè§£è€¦ / å¼‚æ­¥é€šä¿¡</strong></td>\n<td>ä½œä¸ºç³»ç»Ÿé—´çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œå‡å°‘ç³»ç»Ÿé—´è€¦åˆï¼Œæ”¯æŒå¼‚æ­¥é€šä¿¡ã€æµé‡å‰Šå³°ã€ç¼“å†²ç­‰ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ä¸æ‰©å±•æ€§ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Kafka-å®‰è£…\">Kafka å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œå…ˆä»‹ç»åŸºäº Zookeeper çš„å®‰è£…æ–¹å¼ï¼Œä¸‹æ–‡ä¼šä»‹ç»åŸºäº KRaft çš„å®‰è£…æ–¹å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kafka 3.9.1 çš„å®‰è£…ä¸è¿è¡Œéœ€è¦ JDK 8+ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦æå‰å®‰è£… JDK 8+ã€‚å¯ä»¥é€‰æ‹©OpenJDKï¼Œ<a href=\"https://mirrors.tuna.tsinghua.edu.cn/Adoptium/\">æ¸…åå¤§å­¦é•œåƒç«™</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># root ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/jdk</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/jdk</span><br><span class=\"line\"><span class=\"comment\"># ä¸‹è½½JDK</span></span><br><span class=\"line\">wget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/8/jdk/x64/linux/OpenJDK8U-jdk_x64_linux_hotspot_8u462b08.tar.gz</span><br><span class=\"line\">tar -zxvf OpenJDK8U-jdk_x64_linux_hotspot_8u462b08.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s jdk8u462-b08 jdk8</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export JAVA_HOME=/usr/local/jdk/jdk8&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œæ˜¯ å•å¼•å·ï¼ŒåŒå¼•å·ä¼šè§£æå˜é‡ï¼Œå¯¼è‡´é…ç½®å¤±è´¥</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export PATH=$JAVA_HOME/bin:$PATH&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥JDKå®‰è£…</span></span><br><span class=\"line\">java -version</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…è¿‡ç¨‹å‚è€ƒå®˜ç½‘æ–‡æ¡£<a href=\"https://kafka.apache.org/39/documentation.html#quickstart\">Kafka Quick Start</a>ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å•æœºå®‰è£…\">å•æœºå®‰è£…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éƒ¨ç½²kafkaéƒ½ä¼šä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼Œå•æœºæ¨¡å¼åªä½œä¸ºå­¦ä¹ è¯•ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹è½½Kafkaï¼Œ<a href=\"https://kafka.apache.org/downloads\">ä¸‹è½½é¡µé¢</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># root ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/kafka</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/kafka</span><br><span class=\"line\"><span class=\"comment\"># ä¸‹è½½Kafka</span></span><br><span class=\"line\">wget https://dlcdn.apache.org/kafka/3.9.1/kafka_2.13-3.9.1.tgz</span><br><span class=\"line\">tar -zxvf kafka_2.13-3.9.1.tgz</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s kafka_2.13-3.9.1 kafka3</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export KAFKA_HOME=/usr/local/kafka/kafka3&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export PATH=$KAFKA_HOME/bin:$PATH&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹Kafkaç‰ˆæœ¬</span></span><br><span class=\"line\">kafka-topics.sh --version</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ Zookeeperï¼Œkafkaå†…ç½®äº†zookeeperï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬å®‰è£…ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‰å°è¿è¡Œ</span></span><br><span class=\"line\">zookeeper-server-start.sh /usr/local/kafka/kafka3/config/zookeeper.properties</span><br><span class=\"line\"><span class=\"comment\"># åå°è¿è¡Œ</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> zookeeper-server-start.sh /usr/local/kafka/kafka3/config/zookeeper.properties &gt; zookeeper.log 2&gt;&amp;1 &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…³é—­zookeeperï¼Œkillè¿›ç¨‹ï¼Œè¿‡æ»¤ java &amp; QuorumPeerMain</span></span><br><span class=\"line\">zookeeper-server-stop.sh</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ kafka</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -daemon åå°è¿è¡Œ</span></span><br><span class=\"line\">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥kafkaæ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class=\"line\">jps -l | grep kafka</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢ kafkaï¼Œkillè¿›ç¨‹ï¼Œè¿‡æ»¤ java &amp; &#x27;kafka\\.Kafka&#x27;</span></span><br><span class=\"line\">kafka-server-stop.sh</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ å¯åŠ¨ kafka éœ€è¦çš„å†…å­˜å¤§å°ä¸º 1Gï¼Œè¿™ä¸€ç‚¹å¯ä»¥åœ¨ <a href=\"http://kafka-server-start.sh\">kafka-server-start.sh</a> è„šæœ¬ä¸­æŸ¥çœ‹åˆ°</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;x<span class=\"variable\">$KAFKA_HEAP_OPTS</span>&quot;</span> = <span class=\"string\">&quot;x&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">export</span> KAFKA_HEAP_OPTS=<span class=\"string\">&quot;-Xmx1G -Xms1G&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ‰€ä»¥å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡åå†å¯åŠ¨kafka</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_HEAP_OPTS=<span class=\"string\">&quot;-Xmx512M -Xms512M&quot;</span></span><br><span class=\"line\">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º topic</span></span><br><span class=\"line\">kafka-topics.sh --create --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨æ¶ˆè´¹è€…</span></span><br><span class=\"line\">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span> --from-beginning</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ç”Ÿäº§è€…</span></span><br><span class=\"line\">kafka-console-producer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span></span><br><span class=\"line\">&gt; hello world <span class=\"comment\"># è¾“å…¥å†…å®¹ï¼Œæ¶ˆè´¹è€…ä¼šæ”¶åˆ°</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤å®‰è£…\">é›†ç¾¤å®‰è£…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤å®‰è£…éœ€è¦å‡†å¤‡å¤šä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘å‡†å¤‡ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.250.0.7</span><br><span class=\"line\">10.250.0.174</span><br><span class=\"line\">10.250.0.108</span><br></pre></td></tr></table></figure>\n<h4 id=\"æ­å»º-Zookeeper-é›†ç¾¤\">æ­å»º Zookeeper é›†ç¾¤</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…³äºå¦‚ä½•æ­å»º Zookeeper é›†ç¾¤ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  <a href=\"/2025/09/15/zookeeper-study/\" title=\"Zookeeper çš„å®‰è£…åŠä½¿ç”¨\">Zookeeper çš„å®‰è£…åŠä½¿ç”¨</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœå›¾çœäº‹ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Kafka è‡ªå¸¦çš„ zookeeperï¼Œç¼–è¾‘å…¶é…ç½®æ–‡ä»¶ <code>config/zookeeper.properties</code>å¦‚ä¸‹ï¼Œæ³¨æ„è¦åœ¨ <code>dataDir</code> ç›®å½•ä¸‹åˆ›å»º<code>myid</code>æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataDir=/usr/local/kafka/dataDir/zookeeper</span><br><span class=\"line\"><span class=\"comment\"># the port at which the clients will connect</span></span><br><span class=\"line\">clientPort=2181</span><br><span class=\"line\"><span class=\"comment\"># disable the per-ip limit on the number of connections since this is a non-production config</span></span><br><span class=\"line\">maxClientCnxns=0</span><br><span class=\"line\"><span class=\"comment\"># Disable the adminserver by default to avoid port conflicts.</span></span><br><span class=\"line\"><span class=\"comment\"># Set the port to something non-conflicting if choosing to enable this</span></span><br><span class=\"line\">admin.enableServer=<span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># admin.serverPort=8080</span></span><br><span class=\"line\"></span><br><span class=\"line\">initLimit=10</span><br><span class=\"line\">syncLimit=5</span><br><span class=\"line\"></span><br><span class=\"line\">server.1=10.250.0.7:2888:3888</span><br><span class=\"line\">server.2=10.250.0.174:2888:3888</span><br><span class=\"line\">server.3=10.250.0.108:2888:3888</span><br></pre></td></tr></table></figure>\n<h4 id=\"é…ç½®-Kafka-é›†ç¾¤\">é…ç½® Kafka é›†ç¾¤</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹ä¸»æœºçš„ä¸»æœºå</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hostnamectl hostname worker1</span><br><span class=\"line\"><span class=\"comment\"># hostnamectl hostname worker2</span></span><br><span class=\"line\"><span class=\"comment\"># hostnamectl hostname worker3</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºäº†åç»­æ–¹ä¾¿ç»´æŠ¤ï¼Œå°†ipåœ°å€æ˜ å°„åˆ° hosts æ–‡ä»¶ä¸­</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.250.0.7 worker1</span><br><span class=\"line\">10.250.0.174 worker2</span><br><span class=\"line\">10.250.0.108 worker3</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¾‘ <code>config/server.properties</code> æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹å¦‚ä¸‹é…ç½®é¡¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#broker çš„å…¨å±€å”¯â¼€ç¼–å·ï¼Œä¸èƒ½é‡å¤ï¼Œåªèƒ½æ˜¯æ•°å­—ã€‚</span></span><br><span class=\"line\">broker.id=1 <span class=\"comment\"># è¿™é‡Œåˆ†åˆ«è®¾ç½®ä¸º1ã€2ã€3</span></span><br><span class=\"line\"><span class=\"comment\">#æœåŠ¡ç›‘å¬åœ°å€</span></span><br><span class=\"line\">listeners=PLAINTEXT://worker1:9092</span><br><span class=\"line\"><span class=\"comment\">#æ•°æ®â½‚ä»¶åœ°å€ã€‚åŒæ ·é»˜è®¤æ˜¯ç»™çš„/tmpâ½¬å½•ã€‚</span></span><br><span class=\"line\">log.dirs=/usr/local/kafka/dataDir/kafka-logs</span><br><span class=\"line\"><span class=\"comment\">#é»˜è®¤çš„æ¯ä¸ªTopicçš„åˆ†åŒºæ•°ï¼Œåˆ›å»ºTopicæ—¶ï¼Œå¦‚æœæœªæŒ‡å®šåˆ†åŒºæ•°ï¼Œåˆ™é»˜è®¤ä¸º1ä¸ªåˆ†åŒºã€‚</span></span><br><span class=\"line\">num.partitions=1</span><br><span class=\"line\"><span class=\"comment\"># æ¯ä¸ªâ½‡å¿—â½‚ä»¶åˆ é™¤ä¹‹å‰ä¿å­˜çš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯168å°æ—¶ï¼Œå³7å¤©ã€‚</span></span><br><span class=\"line\">log.retention.hours=168</span><br><span class=\"line\"><span class=\"comment\">#zookeeperçš„æœåŠ¡åœ°å€ï¼Œå¦‚æœæ˜¯è‡ªå»ºçš„ Zookeeper é›†ç¾¤ï¼Œåˆ™è¿™é‡Œéœ€è¦å¡«å†™é›†ç¾¤çš„è¿æ¥åœ°å€</span></span><br><span class=\"line\">zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨ Kafka</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º topic</span></span><br><span class=\"line\">kafka-topics.sh --bootstrap-server worker1:9092 --create --replication-factor 3 --partitions 3 --topic disTopic</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># --replication-factor 3 è¡¨ç¤ºåˆ›å»ºçš„å‰¯æœ¬æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># --partitions 3 è¡¨ç¤ºåˆ›å»ºçš„åˆ†åŒºæ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ topic è¯¦æƒ…</span></span><br><span class=\"line\">kafka-topics.sh --bootstrap-server worker1:9092 --describe --topic disTopic</span><br><span class=\"line\">Topic: disTopic\tTopicId: VUK7Mc9oQdS1mjGG7OhQzQ\tPartitionCount: 3\tReplicationFactor: Configs:</span><br><span class=\"line\">\tTopic: disTopic\tPartition: 0\tLeader: 2\tReplicas: 2,3,1\tIsr: 2,3,1\tElr: N/A\tLastKnownElr: N/A</span><br><span class=\"line\">\tTopic: disTopic\tPartition: 1\tLeader: 3\tReplicas: 3,1,2\tIsr: 3,1,2\tElr: N/A\tLastKnownElr: N/A</span><br><span class=\"line\">\tTopic: disTopic\tPartition: 2\tLeader: 1\tReplicas: 1,2,3\tIsr: 1,2,3\tElr: N/A\tLastKnownElr: N/A</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº Zookeeperã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Kafka ç®€ä»‹ Apache Kafka æ˜¯ä¸€ä¸ª åˆ†å¸ƒå¼çš„æµå¤„ç†/äº‹ä»¶æµå¹³å°ï¼Œæ—¢å¯ä»¥ä½œä¸ºæ¶ˆæ¯ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæŒä¹…åŒ–çš„ æ—¥å¿—/è®°å½•å­˜å‚¨ä¸æµå¤„ç†å¹³å°ã€‚ å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯é«˜ååã€ä½å»¶è¿Ÿã€å¯æ°´å¹³æ‰©å±•ã€å®¹é”™ï¼Œä»¥åŠå¯æŒä¹…åŒ–æ•°æ®ã€‚ åœ¨ Kafka ä¸­ï¼Œæ¶ˆæ¯è¢«å½’ç±»ä¸º ä¸»é¢˜ï¼ˆTopicï¼‰ï¼Œæ¯ä¸ªä¸»é¢˜å¯ä»¥æ ¹æ®é…ç½®è¢«æ‹†åˆ†ä¸ºå¤šä¸ª åˆ†åŒºï¼ˆPartitionï¼‰ï¼Œæ¯ä¸ªåˆ†åŒºå†…éƒ¨æ¶ˆæ¯æ˜¯ä¸¥æ ¼æœ‰åºçš„ï¼Œå¹¶ä»¥è¿½åŠ æ–¹å¼å†™å…¥ã€‚æ¶ˆè´¹è€…å¯ä»¥æŒ‰åç§»é‡ï¼ˆoffsetï¼‰è¯»å–æ¶ˆæ¯ã€‚ Kafka æä¾›å¤šä¸ª APIï¼šProducerã€Consumerã€Streamsï¼ˆæµå¤„ç†ï¼‰ã€Connectï¼ˆä¸å¤–éƒ¨ç³»ç»Ÿæ•´åˆï¼‰ç­‰ã€‚ Kafka çš„æ ¸å¿ƒæ¶æ„è¦ç´ ä¸å·¥ä½œæœºåˆ¶ ç»„ä»¶ / æ¦‚å¿µ ä½œç”¨ / æè¿° Brokerï¼ˆèŠ‚ç‚¹ / æœåŠ¡å™¨ï¼‰ Kafka é›†ç¾¤ä¸­çš„æœåŠ¡å™¨å®ä¾‹ï¼Œè´Ÿè´£æ¥æ”¶ã€å­˜å‚¨ã€åˆ†å‘æ¶ˆæ¯ Topic æ¶ˆæ¯çš„â€œåˆ†ç±»â€é€»è¾‘å•å…ƒï¼ŒProducer å†™å…¥ã€Consumer è¯»å– Partition ä¸€ä¸ª Topic è¢«åˆ’åˆ†çš„å­å•å…ƒã€‚åˆ†åŒºä½¿å¾—ä¸»é¢˜å¯ä»¥æ¨ªå‘æ‰©å±•ï¼Œå¹¶æ”¯æŒå¹¶è¡Œè¯»å†™ Offset æ¯æ¡æ¶ˆæ¯åœ¨æŸä¸ªåˆ†åŒºä¸­çš„å”¯ä¸€ä½ç½®æ ‡è¯†ï¼Œæ¶ˆè´¹è€…æ ¹æ® offset æ¥å†³å®šä¸‹ä¸€æ¡è¯»å– Replicationï¼ˆå‰¯æœ¬ï¼‰ ä¸ºäº†å®¹é”™æ€§ï¼Œæ¯ä¸ªåˆ†åŒºå¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆå‰¯æœ¬åˆ†å¸ƒåœ¨ä¸åŒ Broker ä¸Šï¼‰ Leader / Follower åœ¨å‰¯æœ¬ä¸­ï¼Œä¸€ä¸ªå‰¯æœ¬ä¸º Leaderï¼Œæ¥å—è¯»å†™è¯·æ±‚ï¼›å…¶ä»–ä¸º Followerï¼Œä» Leader åŒæ­¥æ•°æ® Consumer Group ä¸€ç»„æ¶ˆè´¹è€…å…±åŒæ¶ˆè´¹ä¸€ä¸ª Topicã€‚æ¯ä¸ªåˆ†åŒºåœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­é€šå¸¸åªè¢«ä¸€ä¸ªæ¶ˆè´¹è€… â€œæ‹¥æœ‰â€ ZooKeeper / KRaft ç”¨äºå…ƒæ•°æ®ç®¡ç†ã€é›†ç¾¤åè°ƒï¼ˆåœ¨è¾ƒè€ç‰ˆæœ¬ä¸­æ˜¯ ZooKeeperï¼›æ–°ç‰ˆæœ¬æ¨å‘ KRaftï¼‰ æ¶ˆæ¯å†™å…¥æµç¨‹ï¼ˆç®€åŒ–ï¼‰ï¼š Producer å°†æ¶ˆæ¯å‘é€ç»™æŸä¸ª Topic çš„ Leader åˆ†åŒºèŠ‚ç‚¹ Leader æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†å…¶è¿½åŠ å†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œå¹¶è¿”å›ç¡®è®¤ï¼ˆACKï¼‰ Follower å‰¯æœ¬ä» Leader æ‹‰å–æ•°æ®è¿›è¡ŒåŒæ­¥ æ¶ˆè´¹è€…æ ¹æ®è‡ªå·±çš„ offset ä»å¯¹åº” Partition ä¸­è¯»å–æ¶ˆæ¯ æ¶ˆè´¹æ§åˆ¶ä¸å®¹é”™ï¼š æ¶ˆè´¹è€…ç»´æŠ¤è‡ªå·±çš„ offsetï¼ˆå¯ä»¥è‡ªåŠ¨æäº¤ï¼Œä¹Ÿå¯æ‰‹åŠ¨æ§åˆ¶ï¼‰ï¼Œè¿™æ ·å³ä½¿æ¶ˆè´¹è€…é‡å¯ï¼Œä¹Ÿå¯ä»¥ä»ä¸Šæ¬¡åœæ­¢çš„ä½ç½®ç»§ç»­ã€‚ å¦‚æœæŸä¸ª Broker å®•æœºï¼Œå‰¯æœ¬å¯ä»¥åˆ‡æ¢ï¼ˆLeader é€‰ä¸¾ï¼‰ï¼Œä¿è¯æœåŠ¡ç»§ç»­ã€‚ åˆ†åŒºä¸å‰¯æœ¬æœºåˆ¶ä½¿å¾— Kafka èƒ½å¤Ÿæ‰©å±•å®¹é‡ &amp; æé«˜å¯é æ€§ã€‚ Kafka çš„å…¸å‹ä½¿ç”¨åœºæ™¯ åœºæ™¯ç±»åˆ« è¯´æ˜ å®æ—¶æ•°æ®ç®¡é“ / æ•°æ®é›†æˆ ç”¨äºå°†å„ç§æ•°æ®æºï¼ˆå¦‚æ—¥å¿—ã€æ•°æ®åº“å˜æ›´ã€ä¼ æ„Ÿå™¨ã€ç”¨æˆ·äº‹ä»¶ç­‰ï¼‰å®æ—¶é‡‡é›†ã€ä¼ è¾“ã€åˆ†å‘åˆ°ä¸‹æ¸¸ç³»ç»Ÿï¼ˆå¦‚ OLAPã€æœç´¢å¼•æ“ã€ç›‘æ§å¹³å°ç­‰ï¼‰ï¼Œæ„å»ºé«˜æ•ˆçš„æ•°æ®é€šé“ã€‚ äº‹ä»¶é©±åŠ¨ / äº‹ä»¶æº¯æº è®°å½•ç³»ç»Ÿå†…éƒ¨æˆ–è·¨ç³»ç»Ÿçš„äº‹ä»¶ï¼ˆçŠ¶æ€å˜åŒ–ï¼‰ï¼Œå®ç°äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰æˆ–äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰ï¼Œå¯ç”¨äºå®¡è®¡ã€å›æ”¾ã€çŠ¶æ€é‡å»ºç­‰ã€‚ æ—¥å¿—èšåˆ / åˆ†æ å°†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨æ—¥å¿—ã€ç›‘æ§æŒ‡æ ‡ã€æ“ä½œæ—¥å¿—ç­‰ç»Ÿä¸€æ”¶é›†åˆ° Kafka ä¸­ï¼Œé›†ä¸­å­˜å‚¨ä¸åˆ†æï¼Œå¸¸ä¸ ELKã€ClickHouse ç­‰ç»“åˆã€‚ æµå¤„ç† ä¸ Kafka Streamsã€Apache Flinkã€Spark Streaming ç­‰æµå¤„ç†æ¡†æ¶é…åˆï¼Œå¯¹æµç» Kafka çš„æ•°æ®è¿›è¡Œå®æ—¶è®¡ç®—ã€èšåˆã€è¿‡æ»¤ã€çª—å£ç»Ÿè®¡ç­‰æ“ä½œã€‚ ç³»ç»Ÿè§£è€¦ / å¼‚æ­¥é€šä¿¡ ä½œä¸ºç³»ç»Ÿé—´çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œå‡å°‘ç³»ç»Ÿé—´è€¦åˆï¼Œæ”¯æŒå¼‚æ­¥é€šä¿¡ã€æµé‡å‰Šå³°ã€ç¼“å†²ç­‰ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ä¸æ‰©å±•æ€§ã€‚ Kafka å®‰è£… è¿™é‡Œå…ˆä»‹ç»åŸºäº Zookeeper çš„å®‰è£…æ–¹å¼ï¼Œä¸‹æ–‡ä¼šä»‹ç»åŸºäº KRaft çš„å®‰è£…æ–¹å¼ã€‚ Kafka 3.9.1 çš„å®‰è£…ä¸è¿è¡Œéœ€è¦ JDK 8+ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦æå‰å®‰è£… JDK 8+ã€‚å¯ä»¥é€‰æ‹©OpenJDKï¼Œæ¸…åå¤§å­¦é•œåƒç«™ 123456789101112131415# root ç”¨æˆ·# åˆ›å»ºå®‰è£…ç›®å½•mkdir /usr/local/jdkcd /usr/local/jdk# ä¸‹è½½JDKwget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/8/jdk/x64/linux/OpenJDK8U-jdk_x64_linux_hotspot_8u462b08.tar.gztar -zxvf OpenJDK8U-jdk_x64_linux_hotspot_8u462b08.tar.gzln -s jdk8u462-b08 jdk8# é…ç½®ç¯å¢ƒå˜é‡echo &#x27;export JAVA_HOME=/usr/local/jdk/jdk8&#x27; &gt;&gt; /etc/profile# æ³¨æ„è¿™é‡Œæ˜¯ å•å¼•å·ï¼ŒåŒå¼•å·ä¼šè§£æå˜é‡ï¼Œå¯¼è‡´é…ç½®å¤±è´¥echo &#x27;export PATH=$JAVA_HOME/bin:$PATH&#x27; &gt;&gt; /etc/profilesource /etc/profile# æ£€æŸ¥JDKå®‰è£…java -version å®‰è£…è¿‡ç¨‹å‚è€ƒå®˜ç½‘æ–‡æ¡£Kafka Quick Startã€‚ å•æœºå®‰è£… éƒ¨ç½²kafkaéƒ½ä¼šä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼Œå•æœºæ¨¡å¼åªä½œä¸ºå­¦ä¹ è¯•ç”¨ã€‚ ä¸‹è½½Kafkaï¼Œä¸‹è½½é¡µé¢ 1234567891011121314# root ç”¨æˆ·# åˆ›å»ºå®‰è£…ç›®å½•mkdir /usr/local/kafkacd /usr/local/kafka# ä¸‹è½½Kafkawget https://dlcdn.apache.org/kafka/3.9.1/kafka_2.13-3.9.1.tgztar -zxvf kafka_2.13-3.9.1.tgzln -s kafka_2.13-3.9.1 kafka3# é…ç½®ç¯å¢ƒå˜é‡echo &#x27;export KAFKA_HOME=/usr/local/kafka/kafka3&#x27; &gt;&gt; /etc/profileecho &#x27;export PATH=$KAFKA_HOME/bin:$PATH&#x27; &gt;&gt; /etc/profilesource /etc/profile# æŸ¥çœ‹Kafkaç‰ˆæœ¬kafka-topics.sh --version å¯åŠ¨ Zookeeperï¼Œkafkaå†…ç½®äº†zookeeperï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬å®‰è£…ã€‚ 1234567# å‰å°è¿è¡Œzookeeper-server-start.sh /usr/local/kafka/kafka3/config/zookeeper.properties# åå°è¿è¡Œnohup zookeeper-server-start.sh /usr/local/kafka/kafka3/config/zookeeper.properties &gt; zookeeper.log 2&gt;&amp;1 &amp;# å…³é—­zookeeperï¼Œkillè¿›ç¨‹ï¼Œè¿‡æ»¤ java &amp; QuorumPeerMainzookeeper-server-stop.sh å¯åŠ¨ kafka 12345678# -daemon åå°è¿è¡Œkafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties# æ£€æŸ¥kafkaæ˜¯å¦å¯åŠ¨æˆåŠŸjps -l | grep kafka# åœæ­¢ kafkaï¼Œkillè¿›ç¨‹ï¼Œè¿‡æ»¤ java &amp; &#x27;kafka\\.Kafka&#x27;kafka-server-stop.sh å°è´´å£« æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ å¯åŠ¨ kafka éœ€è¦çš„å†…å­˜å¤§å°ä¸º 1Gï¼Œè¿™ä¸€ç‚¹å¯ä»¥åœ¨ kafka-server-start.sh è„šæœ¬ä¸­æŸ¥çœ‹åˆ° 123if [ &quot;x$KAFKA_HEAP_OPTS&quot; = &quot;x&quot; ]; then export KAFKA_HEAP_OPTS=&quot;-Xmx1G -Xms1G&quot;fi æ‰€ä»¥å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡åå†å¯åŠ¨kafka 12export KAFKA_HEAP_OPTS=&quot;-Xmx512M -Xms512M&quot;kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties æµ‹è¯• 123456789# åˆ›å»º topickafka-topics.sh --create --bootstrap-server localhost:9092 --topic test# å¯åŠ¨æ¶ˆè´¹è€…kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning# å¯åŠ¨ç”Ÿäº§è€…kafka-console-producer.sh --bootstrap-server localhost:9092 --topic test&gt; hello world # è¾“å…¥å†…å®¹ï¼Œæ¶ˆè´¹è€…ä¼šæ”¶åˆ° é›†ç¾¤å®‰è£… é›†ç¾¤å®‰è£…éœ€è¦å‡†å¤‡å¤šä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘å‡†å¤‡ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š 12310.250.0.710.250.0.17410.250.0.108 æ­å»º Zookeeper é›†ç¾¤ å…³äºå¦‚ä½•æ­å»º Zookeeper é›†ç¾¤ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  Zookeeper çš„å®‰è£…åŠä½¿ç”¨ å¦‚æœå›¾çœäº‹ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Kafka è‡ªå¸¦çš„ zookeeperï¼Œç¼–è¾‘å…¶é…ç½®æ–‡ä»¶ config/zookeeper.propertieså¦‚ä¸‹ï¼Œæ³¨æ„è¦åœ¨ dataDir ç›®å½•ä¸‹åˆ›å»ºmyidæ–‡ä»¶ 12345678910111213141516dataDir=/usr/local/kafka/dataDir/zookeeper# the port at which the clients will connectclientPort=2181# disable the per-ip limit on the number of connections since this is a non-production configmaxClientCnxns=0# Disable the adminserver by default to avoid port conflicts.# Set the port to something non-conflicting if choosing to enable thisadmin.enableServer=false# admin.serverPort=8080initLimit=10syncLimit=5server.1=10.250.0.7:2888:3888server.2=10.250.0.174:2888:3888server.3=10.250.0.108:2888:3888 é…ç½® Kafka é›†ç¾¤ ä¿®æ”¹ä¸»æœºçš„ä¸»æœºå 123hostnamectl hostname worker1# hostnamectl hostname worker2# hostnamectl hostname worker3 ä¸ºäº†åç»­æ–¹ä¾¿ç»´æŠ¤ï¼Œå°†ipåœ°å€æ˜ å°„åˆ° hosts æ–‡ä»¶ä¸­ 12310.250.0.7 worker110.250.0.174 worker210.250.0.108 worker3 ç¼–è¾‘ config/server.properties æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹å¦‚ä¸‹é…ç½®é¡¹ 123456789101112#broker çš„å…¨å±€å”¯â¼€ç¼–å·ï¼Œä¸èƒ½é‡å¤ï¼Œåªèƒ½æ˜¯æ•°å­—ã€‚broker.id=1 # è¿™é‡Œåˆ†åˆ«è®¾ç½®ä¸º1ã€2ã€3#æœåŠ¡ç›‘å¬åœ°å€listeners=PLAINTEXT://worker1:9092#æ•°æ®â½‚ä»¶åœ°å€ã€‚åŒæ ·é»˜è®¤æ˜¯ç»™çš„/tmpâ½¬å½•ã€‚log.dirs=/usr/local/kafka/dataDir/kafka-logs#é»˜è®¤çš„æ¯ä¸ªTopicçš„åˆ†åŒºæ•°ï¼Œåˆ›å»ºTopicæ—¶ï¼Œå¦‚æœæœªæŒ‡å®šåˆ†åŒºæ•°ï¼Œåˆ™é»˜è®¤ä¸º1ä¸ªåˆ†åŒºã€‚num.partitions=1# æ¯ä¸ªâ½‡å¿—â½‚ä»¶åˆ é™¤ä¹‹å‰ä¿å­˜çš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯168å°æ—¶ï¼Œå³7å¤©ã€‚log.retention.hours=168#zookeeperçš„æœåŠ¡åœ°å€ï¼Œå¦‚æœæ˜¯è‡ªå»ºçš„ Zookeeper é›†ç¾¤ï¼Œåˆ™è¿™é‡Œéœ€è¦å¡«å†™é›†ç¾¤çš„è¿æ¥åœ°å€zookeeper.connect=worker1:2181,worker2:2181,worker3:2181 åˆ†åˆ«åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨ Kafka 1kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties æµ‹è¯• 123456789101112# åˆ›å»º topickafka-topics.sh --bootstrap-server worker1:9092 --create --replication-factor 3 --partitions 3 --topic disTopic## å‚æ•°è¯´æ˜# --replication-factor 3 è¡¨ç¤ºåˆ›å»ºçš„å‰¯æœ¬æ•°# --partitions 3 è¡¨ç¤ºåˆ›å»ºçš„åˆ†åŒºæ•°# æŸ¥çœ‹ topic è¯¦æƒ…kafka-topics.sh --bootstrap-server worker1:9092 --describe --topic disTopicTopic: disTopic TopicId: VUK7Mc9oQdS1mjGG7OhQzQ PartitionCount: 3 ReplicationFactor: Configs: Topic: disTopic Partition: 0 Leader: 2 Replicas: 2,3,1 Isr: 2,3,1 Elr: N/A LastKnownElr: N/A Topic: disTopic Partition: 1 Leader: 3 Replicas: 3,1,2 Isr: 3,1,2 Elr: N/A LastKnownElr: N/A Topic: disTopic Partition: 2 Leader: 1 Replicas: 1,2,3 Isr: 1,2,3 Elr: N/A LastKnownElr: N/A","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº Zookeeperã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚","date_published":"2025-10-13T13:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/09/25/rabbitmq-cluster/","url":"https://blog.hanqunfeng.com/2025/09/25/rabbitmq-cluster/","title":"RabbitMQ ä¹‹ Cluster","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Cluster çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo\">Java Client ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RabbitMQ-Cluster-é›†ç¾¤-ç®€ä»‹\">RabbitMQ Cluster(é›†ç¾¤) ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ RabbitMQ ä¸­ï¼Œ<a href=\"https://www.rabbitmq.com/docs/clustering\">Clusterï¼ˆé›†ç¾¤ï¼‰</a> æ˜¯å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œç”¨äºå®ç°é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ é›†ç¾¤æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆä¸‰ä¸ªã€äº”ä¸ªã€ä¸ƒä¸ªæˆ–æ›´å¤šï¼‰èŠ‚ç‚¹çš„é€»è¾‘åˆ†ç»„ï¼Œ æ¯ä¸ªèŠ‚ç‚¹å…±äº« ç”¨æˆ·ã€è™šæ‹Ÿä¸»æœºã€é˜Ÿåˆ—ã€æµã€äº¤æ¢ã€ç»‘å®šã€è¿è¡Œæ—¶å‚æ•°å’Œå…¶ä»–åˆ†å¸ƒå¼çŠ¶æ€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ RabbitMQ ä¸­ï¼ŒClusterï¼ˆé›†ç¾¤ï¼‰çš„èŠ‚ç‚¹åˆ†ä¸ºä¸¤ç§ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ç£ç›˜èŠ‚ç‚¹(disk)ï¼šä¼šæŠŠé›†ç¾¤çš„æ‰€æœ‰å…ƒæ•°æ®ä¿¡æ¯ï¼ˆæ¯”å¦‚äº¤æ¢æœºã€ç»‘å®šã€é˜Ÿåˆ—ã€è™šæ‹Ÿä¸»æœºç­‰ä¿¡æ¯ï¼‰æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚Master èŠ‚ç‚¹å¿…é¡»æ˜¯ç£ç›˜èŠ‚ç‚¹ã€‚</li>\n<li class=\"lvl-4\">å†…å­˜èŠ‚ç‚¹(ram)ï¼šåªä¼šå°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹å®•æœºæˆ–é‡å¯ï¼Œå†…å­˜èŠ‚ç‚¹çš„æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±ï¼Œè€Œç£ç›˜èŠ‚ç‚¹çš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚Slave èŠ‚ç‚¹å¯ä»¥æ˜¯å†…å­˜èŠ‚ç‚¹ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ 4.0 å¼€å§‹ï¼Œ é›†ç¾¤ä¸å†åŒºåˆ† <code>æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆClassic Clusterï¼‰</code> ä¸ <code>é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆMirrored Queue Clusterï¼‰</code> ï¼Œé›†ç¾¤åˆ›å»ºå¥½åï¼Œä¼šæ ¹æ®é˜Ÿåˆ—çš„<code>åˆå§‹å¤åˆ¶å› å­å‚æ•°</code>å†³å®šä¸ºè¯¥é˜Ÿåˆ—åˆ›å»ºå¤šå°‘ä¸ªå‰¯æœ¬ï¼Œæ¯”å¦‚ <code>Quroum Queue</code> çš„å‚æ•°æ˜¯ <code>x-quorum-initial-group-size</code>ï¼Œé»˜è®¤ä¸º3ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ 4.0 å¼€å§‹ï¼Œ<code>Quroum Queue</code> å’Œ <code>Stream Queue</code> é»˜è®¤å¼€å¯èŠ‚ç‚¹é—´<code>æ¶ˆæ¯å¤åˆ¶</code>ï¼Œä½†æ˜¯ <code>Classic Queue</code> é˜Ÿåˆ—ä¸æ”¯æŒèŠ‚ç‚¹é—´çš„<code>æ¶ˆæ¯å¤åˆ¶</code>;</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>RabbitMQ 4.0ä»¥å‰çš„ é›†ç¾¤åˆ†ä¸ºä¸¤ç§æ¨¡å¼</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<ol>\n<li class=\"lvl-5\">æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆClassic Clusterï¼‰</li>\n</ol>\n<ul class=\"lvl-3\">\n<li class=\"lvl-4\">åœ¨ æ™®é€šé›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒRabbitMQ èŠ‚ç‚¹é€šè¿‡ Erlang åˆ†å¸ƒå¼ç³»ç»Ÿå®ç°äº’è”ï¼Œé›†ç¾¤å†…çš„å„ä¸ªèŠ‚ç‚¹å…±äº« æ¶ˆæ¯é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šç­‰å…ƒç´ ã€‚</li>\n<li class=\"lvl-4\">æ™®é€šé›†ç¾¤çš„ç‰¹ç‚¹ï¼š\n<ul class=\"lvl-5\">\n<li class=\"lvl-6\">å…±äº«é˜Ÿåˆ—ï¼šé˜Ÿåˆ—æ•°æ®ä»…å­˜å‚¨åœ¨å•ä¸€èŠ‚ç‚¹ä¸Šï¼Œåªæœ‰è¯¥èŠ‚ç‚¹å¯ä»¥å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li>\n<li class=\"lvl-6\">ä¸è‡ªåŠ¨å¤åˆ¶æ•°æ®ï¼šåœ¨æ™®é€šé›†ç¾¤ä¸­ï¼Œæ¶ˆæ¯å¹¶ä¸ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼Œé˜Ÿåˆ—ä¸Šçš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±ï¼Œæ— æ³•æ¢å¤ã€‚</li>\n<li class=\"lvl-6\">è´Ÿè½½å‡è¡¡ï¼šäº¤æ¢æœºï¼ˆExchangeï¼‰ä¼šæŠŠæ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—ï¼Œä½†é˜Ÿåˆ—æ•°æ®ä»ç„¶åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚å› æ­¤ï¼Œæ™®é€šé›†ç¾¤é€‚åˆä¸è¦æ±‚æé«˜å¯ç”¨æ€§çš„åœºæ™¯ã€‚</li>\n<li class=\"lvl-6\">ä¸å…·å¤‡é«˜å¯ç”¨æ€§ï¼šç”±äºæ•°æ®ä¸ä¼šåœ¨é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ä¸­å¤åˆ¶ï¼Œæ™®é€šé›†ç¾¤åœ¨æŸä¸ªèŠ‚ç‚¹å®•æœºæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±å’Œç³»ç»Ÿä¸å¯ç”¨ã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<ol start=\"2\">\n<li class=\"lvl-5\">é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆMirrored Queue Clusterï¼‰</li>\n</ol>\n<ul class=\"lvl-3\">\n<li class=\"lvl-4\">é•œåƒé›†ç¾¤æ¨¡å¼ æ˜¯ä¸ºäº† é«˜å¯ç”¨æ€§ è®¾è®¡çš„ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œé˜Ÿåˆ—çš„æ•°æ®ä¼šåœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œ å¤åˆ¶ï¼ˆé•œåƒï¼‰ï¼Œä»è€Œä¿è¯å³ä½¿æŸä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li>\n<li class=\"lvl-4\">é•œåƒé›†ç¾¤çš„ç‰¹ç‚¹ï¼š\n<ul class=\"lvl-5\">\n<li class=\"lvl-6\">é˜Ÿåˆ—é•œåƒï¼šåœ¨é•œåƒé›†ç¾¤æ¨¡å¼ä¸­ï¼Œé˜Ÿåˆ—æ•°æ®ä¼šåœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šå¤åˆ¶ã€‚æ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œå¤šä¸ªé•œåƒèŠ‚ç‚¹ã€‚</li>\n<li class=\"lvl-6\">é«˜å¯ç”¨æ€§ï¼šæ¶ˆæ¯ä¼šè¢«å¤åˆ¶åˆ°é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œä»è€Œä¿è¯å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œç³»ç»Ÿèƒ½è¿…é€Ÿæ¢å¤ã€‚</li>\n<li class=\"lvl-6\">èŠ‚ç‚¹æ•…éšœæ¢å¤ï¼šå½“ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šç»§ç»­å¤„ç†è¯¥é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä¿è¯ä¸šåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚</li>\n<li class=\"lvl-6\">ç½‘ç»œè´Ÿæ‹…è¾ƒé‡ï¼šç”±äºéœ€è¦åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥å’Œå¤åˆ¶ï¼Œæ‰€ä»¥é•œåƒé˜Ÿåˆ—æ¨¡å¼ä¼šå¢åŠ é›†ç¾¤çš„ç½‘ç»œè´Ÿæ‹…å’Œç£ç›˜ I/Oã€‚</li>\n<li class=\"lvl-6\">æ€§èƒ½å½±å“ï¼šé•œåƒé˜Ÿåˆ—æ¨¡å¼ä¼šç¨å¾®å½±å“æ€§èƒ½ï¼Œå› ä¸ºæ¯æ¬¡æ¶ˆæ¯å¤„ç†åï¼Œéƒ½éœ€è¦å°†æ•°æ®åŒæ­¥åˆ°å…¶ä»–é•œåƒèŠ‚ç‚¹ï¼Œå¢åŠ äº†å»¶è¿Ÿã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"é›†ç¾¤æ­å»º\">é›†ç¾¤æ­å»º</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«å®‰è£… RabbitMQ ï¼Œå®‰è£…æ–¹æ³•å‚çœ‹ <a href=\"/2025/09/18/rabbitmq-install-01/\" title=\"RabbitMQ çš„å®‰è£…åŠä½¿ç”¨\">RabbitMQ çš„å®‰è£…åŠä½¿ç”¨</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å¼€æ”¾ç«¯å£</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><strong>ç«¯å£èŒƒå›´</strong></th>\n<th><strong>ç”¨é€”</strong></th>\n<th><strong>å¤‡æ³¨</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>4369</strong></td>\n<td>epmdï¼ˆErlang Port Mapper Daemonï¼‰</td>\n<td>RabbitMQ èŠ‚ç‚¹å’Œ CLI å·¥å…·ä½¿ç”¨çš„å¸®åŠ©ç¨‹åºå‘ç°å®ˆæŠ¤è¿›ç¨‹ã€‚</td>\n</tr>\n<tr>\n<td><strong>6000-6500</strong></td>\n<td>RabbitMQ Stream å¤åˆ¶ä½¿ç”¨</td>\n<td>ç”¨äº RabbitMQ Stream çš„æ•°æ®å¤åˆ¶ã€‚</td>\n</tr>\n<tr>\n<td><strong>25672</strong></td>\n<td>Erlang åˆ†å‘æœåŠ¡å™¨ç«¯å£</td>\n<td>ç”¨äºèŠ‚ç‚¹é—´å’Œ CLI å·¥å…·é€šä¿¡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»…é™äºå•ä¸ªç«¯å£ï¼ˆAMQPç«¯å£ + 20000ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>35672-35682</strong></td>\n<td>Erlang åˆ†å‘å®¢æˆ·ç«¯ç«¯å£</td>\n<td>ç”¨äº CLI å·¥å…·ä¸èŠ‚ç‚¹é€šä¿¡ï¼Œè®¡ç®—ä¸ºæœåŠ¡å™¨åˆ†å‘ç«¯å£ + 10000 åˆ° æœåŠ¡å™¨åˆ†å‘ç«¯å£ + 10010ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«ä¿®æ”¹ä¸‰å°æœåŠ¡å™¨çš„ <code>hostname</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hostnamectl hostname rabbitmq01</span><br><span class=\"line\"><span class=\"comment\"># hostnamectl hostname rabbitmq02</span></span><br><span class=\"line\"><span class=\"comment\"># hostnamectl hostname rabbitmq03</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«ä¿®æ”¹ä¸‰å°æœåŠ¡å™¨çš„ <code>/etc/hosts</code> æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.250.0.56  rabbitmq01</span><br><span class=\"line\">10.250.0.232 rabbitmq02</span><br><span class=\"line\">10.250.0.97  rabbitmq03</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒæ­¥é›†ç¾¤èŠ‚ç‚¹ä¸­çš„cookie</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">é»˜è®¤ä¼šåœ¨ <code>/var/lib/rabbitmq/</code>ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code>.erlang.cookie</code>ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li>\n<li class=\"lvl-4\">æˆ‘ä»¬ä½¿ç”¨ <code>rabbitmq01</code> èŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„ä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„æˆå‘˜èŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯ä¿è¯é›†ç¾¤ä¸­ä¸‰ä¸ªèŠ‚ç‚¹çš„è¿™ä¸ª<code>cookieå­—ç¬¦ä¸²ä¸€è‡´</code>ã€‚</li>\n<li class=\"lvl-4\">å°† <code>rabbitmq01</code> çš„ <code>/var/lib/rabbitmq/.erlang.cookie</code> æ–‡ä»¶ä¸­çš„<code>cookieå­—ç¬¦ä¸²</code>å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„ <code>/var/lib/rabbitmq/.erlang.cookie</code> æ–‡ä»¶ä¸­ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«å¯åŠ¨ä¸‰å°æœåŠ¡å™¨çš„ RabbitMQ æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start rabbitmq-server</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«ç™»å½• <code>rabbitmq02</code> å’Œ <code>rabbitmq03</code> èŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœæ‰rabbitmqåº”ç”¨</span></span><br><span class=\"line\">rabbitmqctl stop_app</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡ç½®rabbitmqã€äº¤æ¢æœºã€é˜Ÿåˆ—</span></span><br><span class=\"line\">rabbitmqctl reset</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åŠ å…¥é›†ç¾¤ï¼Œæ³¨æ„æ­¤æ—¶ rabbitmq01 æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå¿…é¡»å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\"># --ram è¡¨ç¤ºä»¥ ram å†…å­˜èŠ‚ç‚¹ åŠ å…¥é›†ç¾¤ã€‚å¦‚æœä¸å¸¦å‚æ•°é»˜è®¤ä¸º disk ç£ç›˜èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"># RabbitMQçš„é›†ç¾¤èŠ‚ç‚¹åˆ†ä¸º disk å’Œ ramï¼ŒdiskèŠ‚ç‚¹ä¼šå°†å…ƒæ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜å½“ä¸­ï¼Œè€ŒramèŠ‚ç‚¹åªæ˜¯åœ¨å†…å­˜ä¸­ä¿å­˜å…ƒæ•°æ®ã€‚</span></span><br><span class=\"line\">rabbitmqctl join_cluster rabbit@rabbitmq01 --ram</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨rabbitmqåº”ç”¨</span></span><br><span class=\"line\">rabbitmqctl start_app</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½• ä»»æ„ èŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl cluster_status</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç±»ä¼¼</span></span><br><span class=\"line\">Cluster status of node rabbit@rabbitmq01 ...</span><br><span class=\"line\">Basics</span><br><span class=\"line\"></span><br><span class=\"line\">Cluster name: rabbit@rabbitmq01</span><br><span class=\"line\">Total CPU cores available cluster-wide: 6</span><br><span class=\"line\"></span><br><span class=\"line\">Cluster Tags</span><br><span class=\"line\"></span><br><span class=\"line\">(none)</span><br><span class=\"line\"></span><br><span class=\"line\">Disk Nodes</span><br><span class=\"line\"></span><br><span class=\"line\">rabbit@rabbitmq01</span><br><span class=\"line\"></span><br><span class=\"line\">RAM Nodes</span><br><span class=\"line\"></span><br><span class=\"line\">rabbit@rabbitmq02</span><br><span class=\"line\">rabbit@rabbitmq03</span><br><span class=\"line\"></span><br><span class=\"line\">Running Nodes</span><br><span class=\"line\"></span><br><span class=\"line\">rabbit@rabbitmq01</span><br><span class=\"line\">rabbit@rabbitmq02</span><br><span class=\"line\">rabbit@rabbitmq03</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>PS: ç”±äºramèŠ‚ç‚¹å‡å°‘äº†å¾ˆå¤šä¸ç¡¬ç›˜çš„äº¤äº’ï¼Œæ‰€ä»¥ï¼ŒramèŠ‚ç‚¹çš„å…ƒæ•°æ®ä½¿ç”¨æ€§èƒ½ä¼šæ¯”è¾ƒé«˜ã€‚ä½†æ˜¯ï¼ŒåŒæ—¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€å…ƒæ•°æ®çš„å®‰å…¨æ€§æ˜¯ä¸å¦‚diskèŠ‚ç‚¹çš„ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªé›†ç¾¤ä¸­ï¼Œ rabbitmq02 å’Œ rabbitmq03 éƒ½ä»¥ ramèŠ‚ç‚¹ çš„èº«ä»½åŠ å…¥åˆ° rabbitmq01 é›†ç¾¤é‡Œï¼Œå› æ­¤ï¼Œæ˜¯å­˜åœ¨å•ç‚¹æ•…éšœçš„ã€‚å¦‚æœ rabbitmq01 èŠ‚ç‚¹æœåŠ¡å´©æºƒï¼Œé‚£ä¹ˆå…ƒæ•°æ®å°±æœ‰å¯èƒ½ä¸¢å¤±ã€‚åœ¨ä¼ä¸šè¿›è¡Œéƒ¨ç½²æ—¶ï¼Œæ€§èƒ½ä¸å®‰å…¨æ€§éœ€è¦è‡ªå·±è¿›è¡Œå¹³è¡¡ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½•ä»»æ„èŠ‚ç‚¹çš„ç®¡ç†é¡µé¢ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/R195gJ.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶æˆ‘ä»¬åœ¨ä»»æ„èŠ‚ç‚¹ä¸­åˆ›å»ºè™šæ‹Ÿä¸»æœºã€é˜Ÿåˆ—ã€äº¤æ¢æœºå’Œç»‘å®šå…³ç³» ç­‰å…ƒæ•°æ®ï¼Œéƒ½ä¼šè‡ªåŠ¨åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ ç®¡ç†æ§åˆ¶å° ä¸­æŸ¥çœ‹é˜Ÿåˆ—æ—¶çœ‹åˆ°ï¼Œæ­¤æ—¶å¤šä¸ªä¸€åˆ—ï¼Œ<code>Node</code>åˆ—ï¼Œæ˜¾ç¤ºè¯¥é˜Ÿåˆ—åœ¨å“ªäº›èŠ‚ç‚¹ä¸­å­˜åœ¨ã€‚åªæœ‰ <code>Quorum é˜Ÿåˆ—</code> å’Œ <code>Stream é˜Ÿåˆ—</code> æ‰ä¼šæ˜¾ç¤ºå¤šä¸ªèŠ‚ç‚¹ï¼Œå› ä¸º <code>Classic é˜Ÿåˆ—</code> ä¸æ”¯æŒå¤šèŠ‚ç‚¹å¤åˆ¶ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/GjHcLN.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æŸä¸ªå…·ä½“çš„ <code>Quorum é˜Ÿåˆ—</code> æˆ– <code>Stream é˜Ÿåˆ—</code>ï¼Œå¯ä»¥çœ‹åˆ°æ›´è¯¦ç»†çš„è¯´æ˜<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/XtIkpp.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶æ–°å»ºé˜Ÿåˆ—ï¼Œä¼šè¦æ±‚æˆ‘ä»¬æŒ‡å®šä¸»èŠ‚ç‚¹(Leader)ï¼Œå³è´Ÿè´£å­˜å‚¨æ¶ˆæ¯çš„çš„èŠ‚ç‚¹ï¼Œè€Œ <code>Quorum é˜Ÿåˆ—</code> æˆ– <code>Stream é˜Ÿåˆ—</code>ï¼Œä¼šè‡ªåŠ¨å°†æ¶ˆæ¯å¤åˆ¶åˆ°å…¶å®ƒèŠ‚ç‚¹(Members)ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Leader: é˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€‚</li>\n<li class=\"lvl-4\">Members: é˜Ÿåˆ—çš„æˆå‘˜èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯çš„å‰¯æœ¬ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æ¼”ç¤ºé˜Ÿåˆ—å¤åˆ¶\">æ¼”ç¤ºé˜Ÿåˆ—å¤åˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Quorum é˜Ÿåˆ—</code> å’Œ <code>Stream é˜Ÿåˆ—</code> çš„ å¤åˆ¶æ•° éƒ½ä¸º 3ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘åœ¨å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ <code>rabbitmq04</code>ï¼Œè¯·è‡ªè¡ŒæŒ‰ä¸Šé¢çš„æ–¹æ³•æ·»åŠ ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Quorum-é˜Ÿåˆ—\">Quorum é˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨é¡µé¢ä¸Šåˆ›å»ºä¸€ä¸ª <code>Quorum é˜Ÿåˆ—</code>ï¼Œä¸å•èŠ‚ç‚¹ä¸Šåˆ›å»ºé˜Ÿåˆ—çš„åŒºåˆ«å°±æ˜¯éœ€è¦æˆ‘ä»¬é€‰æ‹©ä¸»èŠ‚ç‚¹ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/JYfKgg.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ å®¢æˆ·ç«¯ åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿æ¥å“ªä¸ªèŠ‚ç‚¹ï¼Œå“ªä¸ªèŠ‚ç‚¹å°±æ˜¯Leaderï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°<code>x-queue-leader-locator</code>æŒ‡å®šä¸»èŠ‚ç‚¹çš„é€‰æ‹©ç­–ç•¥ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqadmin queues <span class=\"built_in\">declare</span> --vhost <span class=\"string\">&quot;/vtest&quot;</span> --name <span class=\"string\">&quot;target.quorum.queue.name&quot;</span> --<span class=\"built_in\">type</span> <span class=\"string\">&quot;quorum&quot;</span> --durable <span class=\"literal\">true</span> --arguments <span class=\"string\">&#x27;&#123;&quot;x-queue-leader-locator&quot;:&quot;balanced&quot;&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># x-queue-leader-locator æœ‰ä¸¤ç§é€‰æ‹©ç­–ç•¥</span></span><br><span class=\"line\"><span class=\"comment\">## client-localï¼šé€‰æ‹©å£°æ˜é˜Ÿåˆ—çš„å®¢æˆ·ç«¯æ‰€è¿æ¥çš„èŠ‚ç‚¹ã€‚è¿™æ˜¯é»˜è®¤å€¼ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">## balancedï¼šå¦‚æœé˜Ÿåˆ—æ€»æ•°å°‘äº 1000 ä¸ªï¼ˆç»å…¸é˜Ÿåˆ—ã€ä»²è£é˜Ÿåˆ—å’Œæµï¼‰ï¼Œ é€‰æ‹©æ‰˜ç®¡æœ€å°æ•°é‡çš„ä»²è£é˜Ÿåˆ—é¢†å¯¼è€…çš„èŠ‚ç‚¹ã€‚ å¦‚æœé˜Ÿåˆ—æ€»ä½“è¶…è¿‡ 1000 ä¸ªï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ° <code>Quorum é˜Ÿåˆ—</code> çš„ä¸»èŠ‚ç‚¹å’Œæˆå‘˜èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæˆå‘˜èŠ‚ç‚¹æœ‰ä¸‰ä¸ªï¼Œé™¤äº†ä¸»èŠ‚ç‚¹å¤–ï¼Œå…¶ä½™èŠ‚ç‚¹ç”±é›†ç¾¤è‡ªåŠ¨é€‰æ‹©ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/qBfNNh.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Quorum é˜Ÿåˆ—</code> çš„å¤åˆ¶æ•°æ˜¯ <code>3</code>ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æ”¹å˜å¤åˆ¶æ•°ï¼Œå¯ä»¥åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶æŒ‡å®šå‚æ•° <code>x-quorum-initial-group-size</code>ï¼Œå…¶å€¼ä¸º <code>å¤§äº 0 çš„æ•´æ•°</code>ï¼Œè‹¥è®¾ç½®å€¼å¤§äºå®é™…æˆå‘˜èŠ‚ç‚¹æ•°ï¼Œåˆ™ä»¥å®é™…æˆå‘˜èŠ‚ç‚¹æ•°ä¸ºå‡†ã€‚<code>x-quorum-initial-group-size</code> è®¾ç½®ä¸º <code>1</code> æ—¶ä¾¿ä¸è¿›è¡Œå¤åˆ¶äº†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœé›†ç¾¤ä¸­å¢åŠ äº†æ–°çš„èŠ‚ç‚¹ï¼Œå¸Œæœ›é˜Ÿåˆ—ä¹Ÿè¢«å¤åˆ¶åˆ°æ–°çš„èŠ‚ç‚¹ä¸­ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œå°†æ–°çš„èŠ‚ç‚¹åŠ å…¥æˆå‘˜èŠ‚ç‚¹ä¸­:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-queues add_member [-p &lt;vhost&gt;] &lt;queue-name&gt; &lt;node&gt;</span></span><br><span class=\"line\">rabbitmq-queues add_member -p /vtest q_4 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœå¸Œæœ›å°†èŠ‚ç‚¹ä»æˆå‘˜èŠ‚ç‚¹ä¸­ç§»é™¤ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-queues delete_member [-p &lt;vhost&gt;] &lt;queue-name&gt; &lt;node&gt;</span></span><br><span class=\"line\">rabbitmq-queues delete_member -p /vtest q_4 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦å¤–ï¼Œå½“é€šè¿‡ <code>forget_cluster_node</code> å‘½ä»¤ä»é›†ç¾¤ä¸­æ°¸ä¹…åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œä¼šè‡ªåŠ¨å°†é˜Ÿåˆ—å…³è”çš„èŠ‚ç‚¹ä»æˆå‘˜èŠ‚ç‚¹ä¸­ç§»é™¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å› ä¸ºè¦åˆ é™¤ rabbitmq04 èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä»¥ä¸‹å‘½ä»¤ä¸èƒ½åœ¨ rabbitmq04 èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å‰éœ€è¦å…ˆå…³é—­åº”ç”¨</span></span><br><span class=\"line\">rabbitmqctl -n rabbit@rabbitmq04 stop_app</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"># rabbitmqctl forget_cluster_node &lt;node&gt;</span></span><br><span class=\"line\">rabbitmqctl forget_cluster_node rabbit@rabbitmq04</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ–°å¢èŠ‚ç‚¹åï¼Œä¸€ä¸ªä¸ªçš„å¯¹åŸæœ‰çš„é˜Ÿåˆ—è¿›è¡Œå¤åˆ¶æ‰©å±•éå¸¸éº»çƒ¦ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¿«é€Ÿå¯¹ç¬¦åˆæ¡ä»¶çš„é˜Ÿåˆ—è¿›è¡Œå¤åˆ¶æ‰©å±•:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-queues grow &lt;node&gt; &lt;all | even&gt; [--vhost-pattern &lt;pattern&gt;] [--queue-pattern &lt;pattern&gt;]</span></span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;node&gt;: è¿™ä¸ªå‚æ•°æŒ‡å®šäº† RabbitMQ èŠ‚ç‚¹çš„åç§°ï¼Œé€šå¸¸æ˜¯ rabbit@&lt;hostname&gt;ã€‚å®ƒè¡¨ç¤ºåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¢é•¿æ“ä½œã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;all | even&gt;: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦æ‰©å±•çš„é˜Ÿåˆ—ç±»å‹ã€‚all è¡¨ç¤ºæ‰©å±•æ‰€æœ‰é˜Ÿåˆ—ï¼Œeven è¡¨ç¤ºæ‰©å±•å¶æ•°ç¼–å·çš„é˜Ÿåˆ—ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># --vhost-pattern &lt;pattern&gt; ï¼ˆå¯é€‰ï¼‰: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦åŒ¹é…çš„è™šæ‹Ÿä¸»æœºåç§°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># --queue-pattern &lt;pattern&gt; ï¼ˆå¯é€‰ï¼‰: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦åŒ¹é…çš„é˜Ÿåˆ—åç§°ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># æ‰©å±•æ‰€æœ‰è™šæ‹Ÿä¸»æœºä¸‹çš„æ‰€æœ‰é˜Ÿåˆ—çš„å‰¯æœ¬ï¼š</span></span><br><span class=\"line\">rabbitmq-queues grow rabbit@rabbitmq04 all</span><br><span class=\"line\"><span class=\"comment\"># æ‰©å±•æ‰€æœ‰è™šæ‹Ÿä¸»æœºä¸‹çš„å¶æ•°ç¼–å·çš„é˜Ÿåˆ—çš„å‰¯æœ¬ï¼š</span></span><br><span class=\"line\">rabbitmq-queues grow rabbit@rabbitmq04 even</span><br><span class=\"line\"><span class=\"comment\"># æ‰©å±•ç‰¹å®šè™šæ‹Ÿä¸»æœºå’Œé˜Ÿåˆ—åç§°çš„é˜Ÿåˆ—</span></span><br><span class=\"line\">rabbitmq-queues grow rabbit@rabbitmq04 all --vhost-pattern /vtest --queue-pattern <span class=\"string\">&quot;^q_&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Stream-é˜Ÿåˆ—\">Stream é˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Stream é˜Ÿåˆ— ä¸ Quorum é˜Ÿåˆ— ç±»ä¼¼ï¼Œé€šè¿‡å“ªä¸ªèŠ‚ç‚¹åˆ›å»ºé˜Ÿåˆ—ï¼Œå“ªä¸ªèŠ‚ç‚¹å°±æ˜¯ Leaderï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡å‚æ•° <code>x-queue-leader-locator</code> æŒ‡å®šä¸»èŠ‚ç‚¹çš„é€‰æ‹©ç­–ç•¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»º Stream é˜Ÿåˆ—æ—¶ï¼Œé»˜è®¤å¤åˆ¶æ•°å°±æ˜¯å½“å‰é›†ç¾¤çš„èŠ‚ç‚¹æ•°ï¼ˆQuorum é˜Ÿåˆ— é»˜è®¤æ˜¯ 3ï¼‰ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šå‚æ•° <code>x-initial-cluster-size</code> è¿›è¡Œåˆå§‹è®¾ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ·»åŠ æ–°çš„èŠ‚ç‚¹æ—¶ï¼Œä¸ Quorum é˜Ÿåˆ— ç±»ä¼¼ï¼ŒStream é˜Ÿåˆ— ä¹Ÿä¸ä¼šè‡ªåŠ¨è¿›è¡Œå¤åˆ¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ‰‹åŠ¨å¤åˆ¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-streams add_replica [-p &lt;vhost&gt;] &lt;stream-name&gt; &lt;node&gt;</span></span><br><span class=\"line\">rabbitmq-streams add_replica -p /vtest sq_2 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤æˆå‘˜èŠ‚ç‚¹æ—¶ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-streams delete_replica [-p &lt;vhost&gt;] &lt;stream-name&gt; &lt;node&gt;</span></span><br><span class=\"line\">rabbitmq-streams delete_replica -p /vtest sq_2 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹èŠ‚ç‚¹å¤åˆ¶çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-streams stream_status [-p &lt;vhost&gt;] &lt;stream-name&gt;</span></span><br><span class=\"line\">rabbitmq-streams stream_status -p /vtest sq_2</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æµå‡ºç°å¼‚å¸¸çŠ¶æ€ï¼ˆå¦‚å‰¯æœ¬åˆ†å¸ƒå¼‚å¸¸ã€é¢†å¯¼èŠ‚ç‚¹æŒ‚æ‰ï¼‰æ—¶ï¼Œä¸ºäº†æ¢å¤å¯ç”¨æ€§ï¼Œå¯ä»¥é‡å¯æµ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-streams restart_stream [-p &lt;vhost&gt;] &lt;stream-name&gt;</span></span><br><span class=\"line\">rabbitmq-streams restart_stream -p /vtest sq_2</span><br><span class=\"line\"><span class=\"comment\">## é‡å¯æ“ä½œ</span></span><br><span class=\"line\"><span class=\"comment\"># 1.åœæ­¢æµçš„å½“å‰å‰¯æœ¬/åˆ†åŒºã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># 2.é‡æ–°åˆå§‹åŒ–æµçš„å­˜å‚¨å’Œå…ƒæ•°æ®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># 3.è®©æµåœ¨é›†ç¾¤ä¸­æ¢å¤ä¸ºå¯ç”¨çŠ¶æ€ã€‚</span></span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Cluster çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹ RabbitMQ Cluster(é›†ç¾¤) ç®€ä»‹ åœ¨ RabbitMQ ä¸­ï¼ŒClusterï¼ˆé›†ç¾¤ï¼‰ æ˜¯å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œç”¨äºå®ç°é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡ã€‚ RabbitMQ é›†ç¾¤æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆä¸‰ä¸ªã€äº”ä¸ªã€ä¸ƒä¸ªæˆ–æ›´å¤šï¼‰èŠ‚ç‚¹çš„é€»è¾‘åˆ†ç»„ï¼Œ æ¯ä¸ªèŠ‚ç‚¹å…±äº« ç”¨æˆ·ã€è™šæ‹Ÿä¸»æœºã€é˜Ÿåˆ—ã€æµã€äº¤æ¢ã€ç»‘å®šã€è¿è¡Œæ—¶å‚æ•°å’Œå…¶ä»–åˆ†å¸ƒå¼çŠ¶æ€ã€‚ åœ¨ RabbitMQ ä¸­ï¼ŒClusterï¼ˆé›†ç¾¤ï¼‰çš„èŠ‚ç‚¹åˆ†ä¸ºä¸¤ç§ï¼š ç£ç›˜èŠ‚ç‚¹(disk)ï¼šä¼šæŠŠé›†ç¾¤çš„æ‰€æœ‰å…ƒæ•°æ®ä¿¡æ¯ï¼ˆæ¯”å¦‚äº¤æ¢æœºã€ç»‘å®šã€é˜Ÿåˆ—ã€è™šæ‹Ÿä¸»æœºç­‰ä¿¡æ¯ï¼‰æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚Master èŠ‚ç‚¹å¿…é¡»æ˜¯ç£ç›˜èŠ‚ç‚¹ã€‚ å†…å­˜èŠ‚ç‚¹(ram)ï¼šåªä¼šå°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹å®•æœºæˆ–é‡å¯ï¼Œå†…å­˜èŠ‚ç‚¹çš„æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±ï¼Œè€Œç£ç›˜èŠ‚ç‚¹çš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚Slave èŠ‚ç‚¹å¯ä»¥æ˜¯å†…å­˜èŠ‚ç‚¹ã€‚ RabbitMQ 4.0 å¼€å§‹ï¼Œ é›†ç¾¤ä¸å†åŒºåˆ† æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆClassic Clusterï¼‰ ä¸ é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆMirrored Queue Clusterï¼‰ ï¼Œé›†ç¾¤åˆ›å»ºå¥½åï¼Œä¼šæ ¹æ®é˜Ÿåˆ—çš„åˆå§‹å¤åˆ¶å› å­å‚æ•°å†³å®šä¸ºè¯¥é˜Ÿåˆ—åˆ›å»ºå¤šå°‘ä¸ªå‰¯æœ¬ï¼Œæ¯”å¦‚ Quroum Queue çš„å‚æ•°æ˜¯ x-quorum-initial-group-sizeï¼Œé»˜è®¤ä¸º3ã€‚ RabbitMQ 4.0 å¼€å§‹ï¼ŒQuroum Queue å’Œ Stream Queue é»˜è®¤å¼€å¯èŠ‚ç‚¹é—´æ¶ˆæ¯å¤åˆ¶ï¼Œä½†æ˜¯ Classic Queue é˜Ÿåˆ—ä¸æ”¯æŒèŠ‚ç‚¹é—´çš„æ¶ˆæ¯å¤åˆ¶; RabbitMQ 4.0ä»¥å‰çš„ é›†ç¾¤åˆ†ä¸ºä¸¤ç§æ¨¡å¼ æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆClassic Clusterï¼‰ åœ¨ æ™®é€šé›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒRabbitMQ èŠ‚ç‚¹é€šè¿‡ Erlang åˆ†å¸ƒå¼ç³»ç»Ÿå®ç°äº’è”ï¼Œé›†ç¾¤å†…çš„å„ä¸ªèŠ‚ç‚¹å…±äº« æ¶ˆæ¯é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šç­‰å…ƒç´ ã€‚ æ™®é€šé›†ç¾¤çš„ç‰¹ç‚¹ï¼š å…±äº«é˜Ÿåˆ—ï¼šé˜Ÿåˆ—æ•°æ®ä»…å­˜å‚¨åœ¨å•ä¸€èŠ‚ç‚¹ä¸Šï¼Œåªæœ‰è¯¥èŠ‚ç‚¹å¯ä»¥å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ ä¸è‡ªåŠ¨å¤åˆ¶æ•°æ®ï¼šåœ¨æ™®é€šé›†ç¾¤ä¸­ï¼Œæ¶ˆæ¯å¹¶ä¸ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼Œé˜Ÿåˆ—ä¸Šçš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±ï¼Œæ— æ³•æ¢å¤ã€‚ è´Ÿè½½å‡è¡¡ï¼šäº¤æ¢æœºï¼ˆExchangeï¼‰ä¼šæŠŠæ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—ï¼Œä½†é˜Ÿåˆ—æ•°æ®ä»ç„¶åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚å› æ­¤ï¼Œæ™®é€šé›†ç¾¤é€‚åˆä¸è¦æ±‚æé«˜å¯ç”¨æ€§çš„åœºæ™¯ã€‚ ä¸å…·å¤‡é«˜å¯ç”¨æ€§ï¼šç”±äºæ•°æ®ä¸ä¼šåœ¨é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ä¸­å¤åˆ¶ï¼Œæ™®é€šé›†ç¾¤åœ¨æŸä¸ªèŠ‚ç‚¹å®•æœºæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±å’Œç³»ç»Ÿä¸å¯ç”¨ã€‚ é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆMirrored Queue Clusterï¼‰ é•œåƒé›†ç¾¤æ¨¡å¼ æ˜¯ä¸ºäº† é«˜å¯ç”¨æ€§ è®¾è®¡çš„ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œé˜Ÿåˆ—çš„æ•°æ®ä¼šåœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œ å¤åˆ¶ï¼ˆé•œåƒï¼‰ï¼Œä»è€Œä¿è¯å³ä½¿æŸä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ é•œåƒé›†ç¾¤çš„ç‰¹ç‚¹ï¼š é˜Ÿåˆ—é•œåƒï¼šåœ¨é•œåƒé›†ç¾¤æ¨¡å¼ä¸­ï¼Œé˜Ÿåˆ—æ•°æ®ä¼šåœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šå¤åˆ¶ã€‚æ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œå¤šä¸ªé•œåƒèŠ‚ç‚¹ã€‚ é«˜å¯ç”¨æ€§ï¼šæ¶ˆæ¯ä¼šè¢«å¤åˆ¶åˆ°é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œä»è€Œä¿è¯å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œç³»ç»Ÿèƒ½è¿…é€Ÿæ¢å¤ã€‚ èŠ‚ç‚¹æ•…éšœæ¢å¤ï¼šå½“ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šç»§ç»­å¤„ç†è¯¥é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä¿è¯ä¸šåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚ ç½‘ç»œè´Ÿæ‹…è¾ƒé‡ï¼šç”±äºéœ€è¦åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥å’Œå¤åˆ¶ï¼Œæ‰€ä»¥é•œåƒé˜Ÿåˆ—æ¨¡å¼ä¼šå¢åŠ é›†ç¾¤çš„ç½‘ç»œè´Ÿæ‹…å’Œç£ç›˜ I/Oã€‚ æ€§èƒ½å½±å“ï¼šé•œåƒé˜Ÿåˆ—æ¨¡å¼ä¼šç¨å¾®å½±å“æ€§èƒ½ï¼Œå› ä¸ºæ¯æ¬¡æ¶ˆæ¯å¤„ç†åï¼Œéƒ½éœ€è¦å°†æ•°æ®åŒæ­¥åˆ°å…¶ä»–é•œåƒèŠ‚ç‚¹ï¼Œå¢åŠ äº†å»¶è¿Ÿã€‚ é›†ç¾¤æ­å»º å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«å®‰è£… RabbitMQ ï¼Œå®‰è£…æ–¹æ³•å‚çœ‹ RabbitMQ çš„å®‰è£…åŠä½¿ç”¨ å¼€æ”¾ç«¯å£ ç«¯å£èŒƒå›´ ç”¨é€” å¤‡æ³¨ 4369 epmdï¼ˆErlang Port Mapper Daemonï¼‰ RabbitMQ èŠ‚ç‚¹å’Œ CLI å·¥å…·ä½¿ç”¨çš„å¸®åŠ©ç¨‹åºå‘ç°å®ˆæŠ¤è¿›ç¨‹ã€‚ 6000-6500 RabbitMQ Stream å¤åˆ¶ä½¿ç”¨ ç”¨äº RabbitMQ Stream çš„æ•°æ®å¤åˆ¶ã€‚ 25672 Erlang åˆ†å‘æœåŠ¡å™¨ç«¯å£ ç”¨äºèŠ‚ç‚¹é—´å’Œ CLI å·¥å…·é€šä¿¡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»…é™äºå•ä¸ªç«¯å£ï¼ˆAMQPç«¯å£ + 20000ï¼‰ã€‚ 35672-35682 Erlang åˆ†å‘å®¢æˆ·ç«¯ç«¯å£ ç”¨äº CLI å·¥å…·ä¸èŠ‚ç‚¹é€šä¿¡ï¼Œè®¡ç®—ä¸ºæœåŠ¡å™¨åˆ†å‘ç«¯å£ + 10000 åˆ° æœåŠ¡å™¨åˆ†å‘ç«¯å£ + 10010ã€‚ åˆ†åˆ«ä¿®æ”¹ä¸‰å°æœåŠ¡å™¨çš„ hostname 123hostnamectl hostname rabbitmq01# hostnamectl hostname rabbitmq02# hostnamectl hostname rabbitmq03 åˆ†åˆ«ä¿®æ”¹ä¸‰å°æœåŠ¡å™¨çš„ /etc/hosts æ–‡ä»¶ 12310.250.0.56 rabbitmq0110.250.0.232 rabbitmq0210.250.0.97 rabbitmq03 åŒæ­¥é›†ç¾¤èŠ‚ç‚¹ä¸­çš„cookie é»˜è®¤ä¼šåœ¨ /var/lib/rabbitmq/ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª.erlang.cookieï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ æˆ‘ä»¬ä½¿ç”¨ rabbitmq01 èŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„ä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„æˆå‘˜èŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯ä¿è¯é›†ç¾¤ä¸­ä¸‰ä¸ªèŠ‚ç‚¹çš„è¿™ä¸ªcookieå­—ç¬¦ä¸²ä¸€è‡´ã€‚ å°† rabbitmq01 çš„ /var/lib/rabbitmq/.erlang.cookie æ–‡ä»¶ä¸­çš„cookieå­—ç¬¦ä¸²å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„ /var/lib/rabbitmq/.erlang.cookie æ–‡ä»¶ä¸­ã€‚ åˆ†åˆ«å¯åŠ¨ä¸‰å°æœåŠ¡å™¨çš„ RabbitMQ æœåŠ¡ 1systemctl start rabbitmq-server åˆ†åˆ«ç™»å½• rabbitmq02 å’Œ rabbitmq03 èŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ 12345678910111213# åœæ‰rabbitmqåº”ç”¨rabbitmqctl stop_app# é‡ç½®rabbitmqã€äº¤æ¢æœºã€é˜Ÿåˆ—rabbitmqctl reset# åŠ å…¥é›†ç¾¤ï¼Œæ³¨æ„æ­¤æ—¶ rabbitmq01 æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå¿…é¡»å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œ# --ram è¡¨ç¤ºä»¥ ram å†…å­˜èŠ‚ç‚¹ åŠ å…¥é›†ç¾¤ã€‚å¦‚æœä¸å¸¦å‚æ•°é»˜è®¤ä¸º disk ç£ç›˜èŠ‚ç‚¹# RabbitMQçš„é›†ç¾¤èŠ‚ç‚¹åˆ†ä¸º disk å’Œ ramï¼ŒdiskèŠ‚ç‚¹ä¼šå°†å…ƒæ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜å½“ä¸­ï¼Œè€ŒramèŠ‚ç‚¹åªæ˜¯åœ¨å†…å­˜ä¸­ä¿å­˜å…ƒæ•°æ®ã€‚rabbitmqctl join_cluster rabbit@rabbitmq01 --ram# å¯åŠ¨rabbitmqåº”ç”¨rabbitmqctl start_app ç™»å½• ä»»æ„ èŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 1234567891011121314151617181920212223242526rabbitmqctl cluster_status## è¾“å‡ºç±»ä¼¼Cluster status of node rabbit@rabbitmq01 ...BasicsCluster name: rabbit@rabbitmq01Total CPU cores available cluster-wide: 6Cluster Tags(none)Disk Nodesrabbit@rabbitmq01RAM Nodesrabbit@rabbitmq02rabbit@rabbitmq03Running Nodesrabbit@rabbitmq01rabbit@rabbitmq02rabbit@rabbitmq03 PS: ç”±äºramèŠ‚ç‚¹å‡å°‘äº†å¾ˆå¤šä¸ç¡¬ç›˜çš„äº¤äº’ï¼Œæ‰€ä»¥ï¼ŒramèŠ‚ç‚¹çš„å…ƒæ•°æ®ä½¿ç”¨æ€§èƒ½ä¼šæ¯”è¾ƒé«˜ã€‚ä½†æ˜¯ï¼ŒåŒæ—¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€å…ƒæ•°æ®çš„å®‰å…¨æ€§æ˜¯ä¸å¦‚diskèŠ‚ç‚¹çš„ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªé›†ç¾¤ä¸­ï¼Œ rabbitmq02 å’Œ rabbitmq03 éƒ½ä»¥ ramèŠ‚ç‚¹ çš„èº«ä»½åŠ å…¥åˆ° rabbitmq01 é›†ç¾¤é‡Œï¼Œå› æ­¤ï¼Œæ˜¯å­˜åœ¨å•ç‚¹æ•…éšœçš„ã€‚å¦‚æœ rabbitmq01 èŠ‚ç‚¹æœåŠ¡å´©æºƒï¼Œé‚£ä¹ˆå…ƒæ•°æ®å°±æœ‰å¯èƒ½ä¸¢å¤±ã€‚åœ¨ä¼ä¸šè¿›è¡Œéƒ¨ç½²æ—¶ï¼Œæ€§èƒ½ä¸å®‰å…¨æ€§éœ€è¦è‡ªå·±è¿›è¡Œå¹³è¡¡ã€‚ ç™»å½•ä»»æ„èŠ‚ç‚¹çš„ç®¡ç†é¡µé¢ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ æ­¤æ—¶æˆ‘ä»¬åœ¨ä»»æ„èŠ‚ç‚¹ä¸­åˆ›å»ºè™šæ‹Ÿä¸»æœºã€é˜Ÿåˆ—ã€äº¤æ¢æœºå’Œç»‘å®šå…³ç³» ç­‰å…ƒæ•°æ®ï¼Œéƒ½ä¼šè‡ªåŠ¨åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ä¸­ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ ç®¡ç†æ§åˆ¶å° ä¸­æŸ¥çœ‹é˜Ÿåˆ—æ—¶çœ‹åˆ°ï¼Œæ­¤æ—¶å¤šä¸ªä¸€åˆ—ï¼ŒNodeåˆ—ï¼Œæ˜¾ç¤ºè¯¥é˜Ÿåˆ—åœ¨å“ªäº›èŠ‚ç‚¹ä¸­å­˜åœ¨ã€‚åªæœ‰ Quorum é˜Ÿåˆ— å’Œ Stream é˜Ÿåˆ— æ‰ä¼šæ˜¾ç¤ºå¤šä¸ªèŠ‚ç‚¹ï¼Œå› ä¸º Classic é˜Ÿåˆ— ä¸æ”¯æŒå¤šèŠ‚ç‚¹å¤åˆ¶ã€‚ æŸ¥çœ‹æŸä¸ªå…·ä½“çš„ Quorum é˜Ÿåˆ— æˆ– Stream é˜Ÿåˆ—ï¼Œå¯ä»¥çœ‹åˆ°æ›´è¯¦ç»†çš„è¯´æ˜ æ­¤æ—¶æ–°å»ºé˜Ÿåˆ—ï¼Œä¼šè¦æ±‚æˆ‘ä»¬æŒ‡å®šä¸»èŠ‚ç‚¹(Leader)ï¼Œå³è´Ÿè´£å­˜å‚¨æ¶ˆæ¯çš„çš„èŠ‚ç‚¹ï¼Œè€Œ Quorum é˜Ÿåˆ— æˆ– Stream é˜Ÿåˆ—ï¼Œä¼šè‡ªåŠ¨å°†æ¶ˆæ¯å¤åˆ¶åˆ°å…¶å®ƒèŠ‚ç‚¹(Members)ã€‚ Leader: é˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€‚ Members: é˜Ÿåˆ—çš„æˆå‘˜èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯çš„å‰¯æœ¬ã€‚ æ¼”ç¤ºé˜Ÿåˆ—å¤åˆ¶ é»˜è®¤æƒ…å†µä¸‹ï¼ŒQuorum é˜Ÿåˆ— å’Œ Stream é˜Ÿåˆ— çš„ å¤åˆ¶æ•° éƒ½ä¸º 3ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘åœ¨å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ rabbitmq04ï¼Œè¯·è‡ªè¡ŒæŒ‰ä¸Šé¢çš„æ–¹æ³•æ·»åŠ ã€‚ Quorum é˜Ÿåˆ— åœ¨é¡µé¢ä¸Šåˆ›å»ºä¸€ä¸ª Quorum é˜Ÿåˆ—ï¼Œä¸å•èŠ‚ç‚¹ä¸Šåˆ›å»ºé˜Ÿåˆ—çš„åŒºåˆ«å°±æ˜¯éœ€è¦æˆ‘ä»¬é€‰æ‹©ä¸»èŠ‚ç‚¹ã€‚ é€šè¿‡ å®¢æˆ·ç«¯ åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿æ¥å“ªä¸ªèŠ‚ç‚¹ï¼Œå“ªä¸ªèŠ‚ç‚¹å°±æ˜¯Leaderï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°x-queue-leader-locatoræŒ‡å®šä¸»èŠ‚ç‚¹çš„é€‰æ‹©ç­–ç•¥ã€‚ 1234rabbitmqadmin queues declare --vhost &quot;/vtest&quot; --name &quot;target.quorum.queue.name&quot; --type &quot;quorum&quot; --durable true --arguments &#x27;&#123;&quot;x-queue-leader-locator&quot;:&quot;balanced&quot;&#125;&#x27;# x-queue-leader-locator æœ‰ä¸¤ç§é€‰æ‹©ç­–ç•¥## client-localï¼šé€‰æ‹©å£°æ˜é˜Ÿåˆ—çš„å®¢æˆ·ç«¯æ‰€è¿æ¥çš„èŠ‚ç‚¹ã€‚è¿™æ˜¯é»˜è®¤å€¼ã€‚## balancedï¼šå¦‚æœé˜Ÿåˆ—æ€»æ•°å°‘äº 1000 ä¸ªï¼ˆç»å…¸é˜Ÿåˆ—ã€ä»²è£é˜Ÿåˆ—å’Œæµï¼‰ï¼Œ é€‰æ‹©æ‰˜ç®¡æœ€å°æ•°é‡çš„ä»²è£é˜Ÿåˆ—é¢†å¯¼è€…çš„èŠ‚ç‚¹ã€‚ å¦‚æœé˜Ÿåˆ—æ€»ä½“è¶…è¿‡ 1000 ä¸ªï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ã€‚ åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ° Quorum é˜Ÿåˆ— çš„ä¸»èŠ‚ç‚¹å’Œæˆå‘˜èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæˆå‘˜èŠ‚ç‚¹æœ‰ä¸‰ä¸ªï¼Œé™¤äº†ä¸»èŠ‚ç‚¹å¤–ï¼Œå…¶ä½™èŠ‚ç‚¹ç”±é›†ç¾¤è‡ªåŠ¨é€‰æ‹©ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒQuorum é˜Ÿåˆ— çš„å¤åˆ¶æ•°æ˜¯ 3ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æ”¹å˜å¤åˆ¶æ•°ï¼Œå¯ä»¥åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶æŒ‡å®šå‚æ•° x-quorum-initial-group-sizeï¼Œå…¶å€¼ä¸º å¤§äº 0 çš„æ•´æ•°ï¼Œè‹¥è®¾ç½®å€¼å¤§äºå®é™…æˆå‘˜èŠ‚ç‚¹æ•°ï¼Œåˆ™ä»¥å®é™…æˆå‘˜èŠ‚ç‚¹æ•°ä¸ºå‡†ã€‚x-quorum-initial-group-size è®¾ç½®ä¸º 1 æ—¶ä¾¿ä¸è¿›è¡Œå¤åˆ¶äº†ã€‚ å¦‚æœé›†ç¾¤ä¸­å¢åŠ äº†æ–°çš„èŠ‚ç‚¹ï¼Œå¸Œæœ›é˜Ÿåˆ—ä¹Ÿè¢«å¤åˆ¶åˆ°æ–°çš„èŠ‚ç‚¹ä¸­ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œå°†æ–°çš„èŠ‚ç‚¹åŠ å…¥æˆå‘˜èŠ‚ç‚¹ä¸­: 12# rabbitmq-queues add_member [-p &lt;vhost&gt;] &lt;queue-name&gt; &lt;node&gt;rabbitmq-queues add_member -p /vtest q_4 rabbit@rabbitmq02 å¦‚æœå¸Œæœ›å°†èŠ‚ç‚¹ä»æˆå‘˜èŠ‚ç‚¹ä¸­ç§»é™¤ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤: 12# rabbitmq-queues delete_member [-p &lt;vhost&gt;] &lt;queue-name&gt; &lt;node&gt;rabbitmq-queues delete_member -p /vtest q_4 rabbit@rabbitmq02 å¦å¤–ï¼Œå½“é€šè¿‡ forget_cluster_node å‘½ä»¤ä»é›†ç¾¤ä¸­æ°¸ä¹…åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œä¼šè‡ªåŠ¨å°†é˜Ÿåˆ—å…³è”çš„èŠ‚ç‚¹ä»æˆå‘˜èŠ‚ç‚¹ä¸­ç§»é™¤ã€‚ åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤: 123456# å› ä¸ºè¦åˆ é™¤ rabbitmq04 èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä»¥ä¸‹å‘½ä»¤ä¸èƒ½åœ¨ rabbitmq04 èŠ‚ç‚¹æ‰§è¡Œ# åˆ é™¤å‰éœ€è¦å…ˆå…³é—­åº”ç”¨rabbitmqctl -n rabbit@rabbitmq04 stop_app# åˆ é™¤èŠ‚ç‚¹# rabbitmqctl forget_cluster_node &lt;node&gt;rabbitmqctl forget_cluster_node rabbit@rabbitmq04 æ–°å¢èŠ‚ç‚¹åï¼Œä¸€ä¸ªä¸ªçš„å¯¹åŸæœ‰çš„é˜Ÿåˆ—è¿›è¡Œå¤åˆ¶æ‰©å±•éå¸¸éº»çƒ¦ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¿«é€Ÿå¯¹ç¬¦åˆæ¡ä»¶çš„é˜Ÿåˆ—è¿›è¡Œå¤åˆ¶æ‰©å±•: 1234567891011121314# rabbitmq-queues grow &lt;node&gt; &lt;all | even&gt; [--vhost-pattern &lt;pattern&gt;] [--queue-pattern &lt;pattern&gt;]## å‚æ•°è¯´æ˜ï¼š# &lt;node&gt;: è¿™ä¸ªå‚æ•°æŒ‡å®šäº† RabbitMQ èŠ‚ç‚¹çš„åç§°ï¼Œé€šå¸¸æ˜¯ rabbit@&lt;hostname&gt;ã€‚å®ƒè¡¨ç¤ºåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¢é•¿æ“ä½œã€‚# &lt;all | even&gt;: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦æ‰©å±•çš„é˜Ÿåˆ—ç±»å‹ã€‚all è¡¨ç¤ºæ‰©å±•æ‰€æœ‰é˜Ÿåˆ—ï¼Œeven è¡¨ç¤ºæ‰©å±•å¶æ•°ç¼–å·çš„é˜Ÿåˆ—ã€‚# --vhost-pattern &lt;pattern&gt; ï¼ˆå¯é€‰ï¼‰: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦åŒ¹é…çš„è™šæ‹Ÿä¸»æœºåç§°ã€‚# --queue-pattern &lt;pattern&gt; ï¼ˆå¯é€‰ï¼‰: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦åŒ¹é…çš„é˜Ÿåˆ—åç§°ã€‚## ç¤ºä¾‹# æ‰©å±•æ‰€æœ‰è™šæ‹Ÿä¸»æœºä¸‹çš„æ‰€æœ‰é˜Ÿåˆ—çš„å‰¯æœ¬ï¼šrabbitmq-queues grow rabbit@rabbitmq04 all# æ‰©å±•æ‰€æœ‰è™šæ‹Ÿä¸»æœºä¸‹çš„å¶æ•°ç¼–å·çš„é˜Ÿåˆ—çš„å‰¯æœ¬ï¼šrabbitmq-queues grow rabbit@rabbitmq04 even# æ‰©å±•ç‰¹å®šè™šæ‹Ÿä¸»æœºå’Œé˜Ÿåˆ—åç§°çš„é˜Ÿåˆ—rabbitmq-queues grow rabbit@rabbitmq04 all --vhost-pattern /vtest --queue-pattern &quot;^q_&quot; Stream é˜Ÿåˆ— Stream é˜Ÿåˆ— ä¸ Quorum é˜Ÿåˆ— ç±»ä¼¼ï¼Œé€šè¿‡å“ªä¸ªèŠ‚ç‚¹åˆ›å»ºé˜Ÿåˆ—ï¼Œå“ªä¸ªèŠ‚ç‚¹å°±æ˜¯ Leaderï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡å‚æ•° x-queue-leader-locator æŒ‡å®šä¸»èŠ‚ç‚¹çš„é€‰æ‹©ç­–ç•¥ã€‚ åˆ›å»º Stream é˜Ÿåˆ—æ—¶ï¼Œé»˜è®¤å¤åˆ¶æ•°å°±æ˜¯å½“å‰é›†ç¾¤çš„èŠ‚ç‚¹æ•°ï¼ˆQuorum é˜Ÿåˆ— é»˜è®¤æ˜¯ 3ï¼‰ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šå‚æ•° x-initial-cluster-size è¿›è¡Œåˆå§‹è®¾ç½®ã€‚ æ·»åŠ æ–°çš„èŠ‚ç‚¹æ—¶ï¼Œä¸ Quorum é˜Ÿåˆ— ç±»ä¼¼ï¼ŒStream é˜Ÿåˆ— ä¹Ÿä¸ä¼šè‡ªåŠ¨è¿›è¡Œå¤åˆ¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ‰‹åŠ¨å¤åˆ¶ 12# rabbitmq-streams add_replica [-p &lt;vhost&gt;] &lt;stream-name&gt; &lt;node&gt;rabbitmq-streams add_replica -p /vtest sq_2 rabbit@rabbitmq02 åˆ é™¤æˆå‘˜èŠ‚ç‚¹æ—¶ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤: 12# rabbitmq-streams delete_replica [-p &lt;vhost&gt;] &lt;stream-name&gt; &lt;node&gt;rabbitmq-streams delete_replica -p /vtest sq_2 rabbit@rabbitmq02 æŸ¥çœ‹èŠ‚ç‚¹å¤åˆ¶çŠ¶æ€ 12# rabbitmq-streams stream_status [-p &lt;vhost&gt;] &lt;stream-name&gt;rabbitmq-streams stream_status -p /vtest sq_2 å½“æµå‡ºç°å¼‚å¸¸çŠ¶æ€ï¼ˆå¦‚å‰¯æœ¬åˆ†å¸ƒå¼‚å¸¸ã€é¢†å¯¼èŠ‚ç‚¹æŒ‚æ‰ï¼‰æ—¶ï¼Œä¸ºäº†æ¢å¤å¯ç”¨æ€§ï¼Œå¯ä»¥é‡å¯æµ 123456# rabbitmq-streams restart_stream [-p &lt;vhost&gt;] &lt;stream-name&gt;rabbitmq-streams restart_stream -p /vtest sq_2## é‡å¯æ“ä½œ# 1.åœæ­¢æµçš„å½“å‰å‰¯æœ¬/åˆ†åŒºã€‚# 2.é‡æ–°åˆå§‹åŒ–æµçš„å­˜å‚¨å’Œå…ƒæ•°æ®ã€‚# 3.è®©æµåœ¨é›†ç¾¤ä¸­æ¢å¤ä¸ºå¯ç”¨çŠ¶æ€ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Cluster çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹","date_published":"2025-09-25T14:30:05.000Z","tags":["æŠ€æœ¯","rabbitmq","åˆ†å¸ƒå¼","rabbitmq"]},{"id":"https://blog.hanqunfeng.com/2025/09/21/rabbitmq-message/","url":"https://blog.hanqunfeng.com/2025/09/21/rabbitmq-message/","title":"RabbitMQ ä¹‹ Message","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Message çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo\">Java Client ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Message-æ¶ˆæ¯-æ˜¯ä»€ä¹ˆï¼Ÿ\">Message(æ¶ˆæ¯) æ˜¯ä»€ä¹ˆï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ RabbitMQ ä¸­ï¼ŒMessageï¼ˆæ¶ˆæ¯ï¼‰æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®å•å…ƒã€‚æ¶ˆæ¯åŒ…å«æ¶ˆæ¯å†…å®¹ã€æ¶ˆæ¯å±æ€§ç­‰ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Message ç»„æˆï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">\n<ol>\n<li class=\"lvl-7\">æ¶ˆæ¯å†…å®¹ï¼šæ¶ˆæ¯çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä»»æ„æ•°æ®ã€‚</li>\n</ol>\n</li>\n<li class=\"lvl-4\">\n<ol start=\"2\">\n<li class=\"lvl-7\">æ¶ˆæ¯å±æ€§ï¼šæ¶ˆæ¯çš„å±æ€§ï¼Œå¦‚æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ã€æ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€æ¶ˆæ¯çš„æ ‡ç­¾ç­‰ã€‚</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Web-æ§åˆ¶å°-ä¸­-Message-çš„ä½¿ç”¨\">Web æ§åˆ¶å° ä¸­ Message çš„ä½¿ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Exchange å’Œ Queue çš„ç®¡ç†ç•Œé¢ä¸­ï¼Œéƒ½å¯ä»¥åœ¨å…¶è¯¦æƒ…é¡µé¢æµ‹è¯• Message çš„ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äºå¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨ Messageï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­è¯¦ç»†ä»‹ç»ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Publish-message\">Publish message</h3>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/dHsDyt.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Payloadï¼šæ¶ˆæ¯çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä»»æ„æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Payload encodingï¼šæ¶ˆæ¯å†…å®¹çš„ç¼–ç æ–¹å¼ï¼Œ<code>String</code> æˆ–è€… <code>Base64</code>ï¼Œé»˜è®¤ä¸º <code>String</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Delivery modeï¼šæ¶ˆæ¯çš„æŒä¹…åŒ–æ¨¡å¼ï¼Œ1-Non-persistent è¡¨ç¤ºéæŒä¹…åŒ–ï¼Œ2-Persistent è¡¨ç¤ºæŒä¹…åŒ–ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Headersï¼šæ¶ˆæ¯çš„å¤´ä¿¡æ¯ï¼Œç”¨äºä¸ <code>Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰</code>ä¸­çš„é…ç½®è¿›è¡ŒåŒ¹é…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Propertiesï¼šæ¶ˆæ¯çš„å±æ€§ï¼Œå¦‚æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ã€æ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€æ¶ˆæ¯çš„æ ‡ç­¾ç­‰ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å±æ€§å</th>\n<th>ä¸­æ–‡å«ä¹‰</th>\n<th>æ•°æ®ç±»å‹</th>\n<th>é»˜è®¤å€¼</th>\n<th>å…¸å‹ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>content_type</td>\n<td>å†…å®¹ç±»å‹</td>\n<td>String</td>\n<td>null</td>\n<td>æŒ‡å®šæ¶ˆæ¯çš„ MIME ç±»å‹ï¼Œå¦‚ <code>&quot;text/plain&quot;</code>ã€<code>&quot;application/json&quot;</code></td>\n</tr>\n<tr>\n<td>content_encoding</td>\n<td>å†…å®¹ç¼–ç </td>\n<td>String</td>\n<td>null</td>\n<td>æŒ‡å®šæ¶ˆæ¯å†…å®¹çš„ç¼–ç æ–¹å¼ï¼Œå¦‚ <code>&quot;gzip&quot;</code></td>\n</tr>\n<tr>\n<td>priority</td>\n<td>æ¶ˆæ¯ä¼˜å…ˆçº§</td>\n<td>Integer (0-255)</td>\n<td>0</td>\n<td>ç»“åˆ <code>x-max-priority</code> æ§åˆ¶æ¶ˆæ¯å¤„ç†é¡ºåºï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜</td>\n</tr>\n<tr>\n<td>correlation_id</td>\n<td>å…³è” ID</td>\n<td>String</td>\n<td>null</td>\n<td>RPC æ¨¡å¼ä¸­å…³è”è¯·æ±‚ä¸å“åº”</td>\n</tr>\n<tr>\n<td>reply_to</td>\n<td>å›å¤é˜Ÿåˆ—å</td>\n<td>String</td>\n<td>null</td>\n<td>RPC æ¨¡å¼ä¸­æŒ‡å®šå“åº”æ¶ˆæ¯çš„è¿”å›é˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td>expiration</td>\n<td>æ¶ˆæ¯è¿‡æœŸæ—¶é—´</td>\n<td>String (ms)</td>\n<td>null</td>\n<td>æ¶ˆæ¯çš„ TTLï¼Œæ¯«ç§’ä¸ºå•ä½ï¼Œè¿‡æœŸåå°†è¢«ä¸¢å¼ƒæˆ–è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td>message_id</td>\n<td>æ¶ˆæ¯ ID</td>\n<td>String</td>\n<td>null</td>\n<td>å”¯ä¸€æ ‡è¯†ä¸€æ¡æ¶ˆæ¯ï¼Œé€šå¸¸ç”±ç”Ÿäº§è€…æŒ‡å®š</td>\n</tr>\n<tr>\n<td>timestamp</td>\n<td>æ—¶é—´æˆ³</td>\n<td>Date / Long</td>\n<td>null</td>\n<td>æ¶ˆæ¯å‘é€æ—¶é—´ï¼Œé€šå¸¸æ˜¯ Unix æ—¶é—´æˆ³</td>\n</tr>\n<tr>\n<td>type</td>\n<td>æ¶ˆæ¯ç±»å‹</td>\n<td>String</td>\n<td>null</td>\n<td>æè¿°æ¶ˆæ¯ç±»å‹ï¼Œå¦‚ <code>&quot;order&quot;</code> æˆ– <code>&quot;event&quot;</code></td>\n</tr>\n<tr>\n<td>user_id</td>\n<td>ç”¨æˆ· ID</td>\n<td>String</td>\n<td>null</td>\n<td>æ ‡è¯†å‘é€æ¶ˆæ¯çš„ç”¨æˆ·ï¼Œé€šå¸¸ç”¨äºå®‰å…¨æˆ–å®¡è®¡</td>\n</tr>\n<tr>\n<td>app_id</td>\n<td>åº”ç”¨ ID</td>\n<td>String</td>\n<td>null</td>\n<td>æ ‡è¯†å‘é€æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº</td>\n</tr>\n<tr>\n<td>cluster_id</td>\n<td>é›†ç¾¤ ID</td>\n<td>String</td>\n<td>null</td>\n<td>RabbitMQ é›†ç¾¤ IDï¼Œå®é™…ä¸­å¾ˆå°‘ä½¿ç”¨</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸é˜Ÿåˆ—é‡å çš„å±æ€§ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°åç§°</th>\n<th>é˜Ÿåˆ—å‚æ•°ï¼ˆQueue Argumentsï¼‰</th>\n<th>æ¶ˆæ¯å±æ€§ï¼ˆMessage Propertiesï¼‰</th>\n<th>è°çš„ä¼˜å…ˆçº§æ›´é«˜ / ç”Ÿæ•ˆæ–¹å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>priority / x-max-priority</strong></td>\n<td><code>x-max-priority</code>: å®šä¹‰é˜Ÿåˆ—æ”¯æŒçš„<strong>æœ€å¤§ä¼˜å…ˆçº§å€¼</strong></td>\n<td><code>priority</code>: ä¸ºå•ä¸ªæ¶ˆæ¯è®¾ç½®ä¼˜å…ˆçº§</td>\n<td>é˜Ÿåˆ—å…ˆå®šä¹‰èŒƒå›´ï¼Œæ¶ˆæ¯åªèƒ½åœ¨è¿™ä¸ªèŒƒå›´å†…å–å€¼ <br> è‹¥ <code>priority &gt; x-max-priority</code>ï¼Œåˆ™ä»¥<code>x-max-priority</code>ä¸ºå‡†</td>\n</tr>\n<tr>\n<td><strong>expiration / x-message-ttl</strong></td>\n<td><code>x-message-ttl</code>: é˜Ÿåˆ—çº§åˆ«çš„æ¶ˆæ¯<strong>ç»Ÿä¸€ TTL</strong></td>\n<td><code>expiration</code>: ä¸ºå•ä¸ªæ¶ˆæ¯è®¾ç½® TTLï¼ˆæ¯«ç§’ï¼‰</td>\n<td>å¦‚æœåŒæ—¶è®¾ç½®ï¼Œ<strong>è¾ƒçŸ­çš„ TTL</strong> ä¼šç”Ÿæ•ˆ</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"Get-message\">Get message</h3>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/Ar9qob.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ack Modeï¼šæ¶ˆæ¯ç¡®è®¤æ¨¡å¼</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Nack message requeue true: ç¡®è®¤å¤±è´¥ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿï¼Œè¿™æ˜¯é»˜è®¤é€‰æ‹©ï¼Œä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•åæ¶ˆæ¯ä¾æ—§å­˜åœ¨ã€‚</li>\n<li class=\"lvl-4\">Automatic ack: è‡ªåŠ¨ç¡®è®¤</li>\n<li class=\"lvl-4\">Reject requeue true: æ‹’ç»ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ</li>\n<li class=\"lvl-4\">Reject requeue false: æ‹’ç»ï¼Œæ¶ˆæ¯ä¸é‡æ–°å…¥é˜Ÿ</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Encodingï¼šæ¶ˆæ¯å†…å®¹ç¼–ç æ–¹å¼</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\"><code>Auto String / Base64</code>ï¼Œé»˜è®¤ã€‚å¦‚æœæ¶ˆæ¯è½½è·å¯ä»¥è§£é‡Šä¸ºUTF-8ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå°±æ˜¯ <code>String</code>ï¼Œå¦åˆ™å°±æ˜¯ <code>Base64</code>ã€‚</li>\n<li class=\"lvl-4\"><code>Base64</code>ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Messages: ä¸€æ¬¡è·å–æ¶ˆæ¯æ•°é‡ï¼Œé»˜è®¤ä¸º 1ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Message çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹ Message(æ¶ˆæ¯) æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨ RabbitMQ ä¸­ï¼ŒMessageï¼ˆæ¶ˆæ¯ï¼‰æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®å•å…ƒã€‚æ¶ˆæ¯åŒ…å«æ¶ˆæ¯å†…å®¹ã€æ¶ˆæ¯å±æ€§ç­‰ä¿¡æ¯ã€‚ Message ç»„æˆï¼š æ¶ˆæ¯å†…å®¹ï¼šæ¶ˆæ¯çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä»»æ„æ•°æ®ã€‚ æ¶ˆæ¯å±æ€§ï¼šæ¶ˆæ¯çš„å±æ€§ï¼Œå¦‚æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ã€æ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€æ¶ˆæ¯çš„æ ‡ç­¾ç­‰ã€‚ Web æ§åˆ¶å° ä¸­ Message çš„ä½¿ç”¨ åœ¨ Exchange å’Œ Queue çš„ç®¡ç†ç•Œé¢ä¸­ï¼Œéƒ½å¯ä»¥åœ¨å…¶è¯¦æƒ…é¡µé¢æµ‹è¯• Message çš„ä½¿ç”¨ã€‚ å…³äºå¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨ Messageï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­è¯¦ç»†ä»‹ç»ã€‚ Publish message Payloadï¼šæ¶ˆæ¯çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä»»æ„æ•°æ®ã€‚ Payload encodingï¼šæ¶ˆæ¯å†…å®¹çš„ç¼–ç æ–¹å¼ï¼ŒString æˆ–è€… Base64ï¼Œé»˜è®¤ä¸º Stringã€‚ Delivery modeï¼šæ¶ˆæ¯çš„æŒä¹…åŒ–æ¨¡å¼ï¼Œ1-Non-persistent è¡¨ç¤ºéæŒä¹…åŒ–ï¼Œ2-Persistent è¡¨ç¤ºæŒä¹…åŒ–ã€‚ Headersï¼šæ¶ˆæ¯çš„å¤´ä¿¡æ¯ï¼Œç”¨äºä¸ Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰ä¸­çš„é…ç½®è¿›è¡ŒåŒ¹é…ã€‚ Propertiesï¼šæ¶ˆæ¯çš„å±æ€§ï¼Œå¦‚æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ã€æ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€æ¶ˆæ¯çš„æ ‡ç­¾ç­‰ã€‚ å±æ€§å ä¸­æ–‡å«ä¹‰ æ•°æ®ç±»å‹ é»˜è®¤å€¼ å…¸å‹ç”¨é€” content_type å†…å®¹ç±»å‹ String null æŒ‡å®šæ¶ˆæ¯çš„ MIME ç±»å‹ï¼Œå¦‚ &quot;text/plain&quot;ã€&quot;application/json&quot; content_encoding å†…å®¹ç¼–ç  String null æŒ‡å®šæ¶ˆæ¯å†…å®¹çš„ç¼–ç æ–¹å¼ï¼Œå¦‚ &quot;gzip&quot; priority æ¶ˆæ¯ä¼˜å…ˆçº§ Integer (0-255) 0 ç»“åˆ x-max-priority æ§åˆ¶æ¶ˆæ¯å¤„ç†é¡ºåºï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ correlation_id å…³è” ID String null RPC æ¨¡å¼ä¸­å…³è”è¯·æ±‚ä¸å“åº” reply_to å›å¤é˜Ÿåˆ—å String null RPC æ¨¡å¼ä¸­æŒ‡å®šå“åº”æ¶ˆæ¯çš„è¿”å›é˜Ÿåˆ— expiration æ¶ˆæ¯è¿‡æœŸæ—¶é—´ String (ms) null æ¶ˆæ¯çš„ TTLï¼Œæ¯«ç§’ä¸ºå•ä½ï¼Œè¿‡æœŸåå°†è¢«ä¸¢å¼ƒæˆ–è¿›å…¥æ­»ä¿¡é˜Ÿåˆ— message_id æ¶ˆæ¯ ID String null å”¯ä¸€æ ‡è¯†ä¸€æ¡æ¶ˆæ¯ï¼Œé€šå¸¸ç”±ç”Ÿäº§è€…æŒ‡å®š timestamp æ—¶é—´æˆ³ Date / Long null æ¶ˆæ¯å‘é€æ—¶é—´ï¼Œé€šå¸¸æ˜¯ Unix æ—¶é—´æˆ³ type æ¶ˆæ¯ç±»å‹ String null æè¿°æ¶ˆæ¯ç±»å‹ï¼Œå¦‚ &quot;order&quot; æˆ– &quot;event&quot; user_id ç”¨æˆ· ID String null æ ‡è¯†å‘é€æ¶ˆæ¯çš„ç”¨æˆ·ï¼Œé€šå¸¸ç”¨äºå®‰å…¨æˆ–å®¡è®¡ app_id åº”ç”¨ ID String null æ ‡è¯†å‘é€æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº cluster_id é›†ç¾¤ ID String null RabbitMQ é›†ç¾¤ IDï¼Œå®é™…ä¸­å¾ˆå°‘ä½¿ç”¨ ä¸é˜Ÿåˆ—é‡å çš„å±æ€§ï¼š å‚æ•°åç§° é˜Ÿåˆ—å‚æ•°ï¼ˆQueue Argumentsï¼‰ æ¶ˆæ¯å±æ€§ï¼ˆMessage Propertiesï¼‰ è°çš„ä¼˜å…ˆçº§æ›´é«˜ / ç”Ÿæ•ˆæ–¹å¼ priority / x-max-priority x-max-priority: å®šä¹‰é˜Ÿåˆ—æ”¯æŒçš„æœ€å¤§ä¼˜å…ˆçº§å€¼ priority: ä¸ºå•ä¸ªæ¶ˆæ¯è®¾ç½®ä¼˜å…ˆçº§ é˜Ÿåˆ—å…ˆå®šä¹‰èŒƒå›´ï¼Œæ¶ˆæ¯åªèƒ½åœ¨è¿™ä¸ªèŒƒå›´å†…å–å€¼ è‹¥ priority &gt; x-max-priorityï¼Œåˆ™ä»¥x-max-priorityä¸ºå‡† expiration / x-message-ttl x-message-ttl: é˜Ÿåˆ—çº§åˆ«çš„æ¶ˆæ¯ç»Ÿä¸€ TTL expiration: ä¸ºå•ä¸ªæ¶ˆæ¯è®¾ç½® TTLï¼ˆæ¯«ç§’ï¼‰ å¦‚æœåŒæ—¶è®¾ç½®ï¼Œè¾ƒçŸ­çš„ TTL ä¼šç”Ÿæ•ˆ Get message Ack Modeï¼šæ¶ˆæ¯ç¡®è®¤æ¨¡å¼ Nack message requeue true: ç¡®è®¤å¤±è´¥ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿï¼Œè¿™æ˜¯é»˜è®¤é€‰æ‹©ï¼Œä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•åæ¶ˆæ¯ä¾æ—§å­˜åœ¨ã€‚ Automatic ack: è‡ªåŠ¨ç¡®è®¤ Reject requeue true: æ‹’ç»ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ Reject requeue false: æ‹’ç»ï¼Œæ¶ˆæ¯ä¸é‡æ–°å…¥é˜Ÿ Encodingï¼šæ¶ˆæ¯å†…å®¹ç¼–ç æ–¹å¼ Auto String / Base64ï¼Œé»˜è®¤ã€‚å¦‚æœæ¶ˆæ¯è½½è·å¯ä»¥è§£é‡Šä¸ºUTF-8ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå°±æ˜¯ Stringï¼Œå¦åˆ™å°±æ˜¯ Base64ã€‚ Base64ã€‚ Messages: ä¸€æ¬¡è·å–æ¶ˆæ¯æ•°é‡ï¼Œé»˜è®¤ä¸º 1ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Message çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹","date_published":"2025-09-21T14:30:05.000Z","tags":["æŠ€æœ¯","rabbitmq","åˆ†å¸ƒå¼","rabbitmq"]},{"id":"https://blog.hanqunfeng.com/2025/09/21/rabbitmq-exchange/","url":"https://blog.hanqunfeng.com/2025/09/21/rabbitmq-exchange/","title":"RabbitMQ ä¹‹ Exchange","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Exchange çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo\">Java Client ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Exchange-äº¤æ¢æœº-æ˜¯ä»€ä¹ˆï¼Ÿ\">Exchange(äº¤æ¢æœº) æ˜¯ä»€ä¹ˆï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ RabbitMQ ä¸­ï¼Œ<a href=\"https://www.rabbitmq.com/docs/exchanges\">Exchangeï¼ˆäº¤æ¢æœºï¼‰</a> æ˜¯æ¶ˆæ¯è·¯ç”±çš„æ ¸å¿ƒç»„ä»¶ã€‚å®ƒè´Ÿè´£æ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®é¢„å®šä¹‰çš„è·¯ç”±è§„åˆ™å°†æ¶ˆæ¯è½¬å‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Exchange ç±»å‹å†³å®šäº†æ¶ˆæ¯çš„è·¯ç”±æ–¹å¼ã€‚RabbitMQ æ”¯æŒçš„ Exchange ç±»å‹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Exchange ç±»å‹</th>\n<th>å£°æ˜ç±»å‹</th>\n<th>è·¯ç”±è§„åˆ™æè¿°</th>\n<th>å…¸å‹ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Direct</strong></td>\n<td><code>direct</code></td>\n<td>æ¶ˆæ¯æ ¹æ® <strong>è·¯ç”±é”®ï¼ˆrouting keyï¼‰</strong> ç²¾ç¡®åŒ¹é…ç»‘å®šé”®ï¼ˆbinding keyï¼‰è¿›è¡Œè·¯ç”±ã€‚</td>\n<td>ç²¾ç¡®æ¶ˆæ¯ä¼ é€’ï¼Œå¦‚æ—¥å¿—åˆ†ç±»ã€ä»»åŠ¡åˆ†å‘ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>Fanout</strong></td>\n<td><code>fanout</code></td>\n<td>æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼Œ<strong>å¿½ç•¥è·¯ç”±é”®</strong>ã€‚</td>\n<td>å¹¿æ’­æ¶ˆæ¯ï¼Œå¦‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€å®æ—¶é€šçŸ¥ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>Topic</strong></td>\n<td><code>topic</code></td>\n<td>æ¶ˆæ¯æ ¹æ®è·¯ç”±é”®ä¸ç»‘å®šé”®æ¨¡å¼çš„åŒ¹é…è¿›è¡Œè·¯ç”±ï¼Œæ”¯æŒé€šé…ç¬¦ <code>*</code>ï¼ˆåŒ¹é…ä¸€ä¸ªè¯ï¼‰å’Œ <code>#</code>ï¼ˆåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯ï¼‰ã€‚</td>\n<td>æ¨¡å—åŒ–è·¯ç”±ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>Headers</strong></td>\n<td><code>headers</code></td>\n<td>æ¶ˆæ¯æ ¹æ® <strong>æ¶ˆæ¯å¤´éƒ¨ï¼ˆheadersï¼‰</strong> ä¸ç»‘å®šæ—¶æŒ‡å®šçš„å¤´éƒ¨åŒ¹é…è¿›è¡Œè·¯ç”±ï¼Œæ”¯æŒ <code>x-match</code> å‚æ•°ï¼ˆ<code>any</code> æˆ– <code>all</code>ï¼‰ã€‚</td>\n<td>å¤šæ¡ä»¶è·¯ç”±ï¼Œå¦‚å¤æ‚è¿‡æ»¤ã€åŠ¨æ€è·¯ç”±ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>Local Random Exchange</strong></td>\n<td><code>x-local-random</code></td>\n<td>æ¶ˆæ¯å§‹ç»ˆè¢«è·¯ç”±åˆ°æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å¤šä¸ªæœ¬åœ°é˜Ÿåˆ—ç»‘å®šï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡ŒæŠ•é€’ã€‚</td>\n<td>è¯·æ±‚-å“åº”ï¼ˆRPCï¼‰æ¨¡å¼ï¼Œä½å»¶è¿Ÿé€šä¿¡</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ é»˜è®¤ä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹çš„äº¤æ¢æœº<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/SKlqQK.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯æ–°åˆ›å»ºä¸€ä¸ª Vhostï¼ŒRabbitMQ å°±ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹äº¤æ¢æœºï¼Œæ¯”å¦‚ <code>/vtest</code><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/oGJ1oj.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæ–°çš„äº¤æ¢æœº<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/QjnZin.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>é…ç½®è¯´æ˜</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Durability: æŒ‡å®š Exchange æ˜¯å¦æŒä¹…åŒ–ã€‚\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">Durable: æŒä¹…åŒ–çš„ Exchange ä¼šè¢«ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œé‡å¯ RabbitMQ æ—¶ä¼šè‡ªåŠ¨æ¢å¤ã€‚</li>\n<li class=\"lvl-6\">Transient: éæŒä¹…åŒ–çš„ Exchange ä¼šè¢«ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé‡å¯ RabbitMQ æ—¶ä¼šä¸¢å¤±ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">Auto-delete: æŒ‡å®š Exchange æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">yes: å¦‚æœæ²¡æœ‰é˜Ÿåˆ—æˆ–äº¤æ¢æœºç»‘å®šè¯¥ Exchangeï¼Œåˆ™è¯¥ Exchange ä¼šè‡ªåŠ¨åˆ é™¤ã€‚</li>\n<li class=\"lvl-6\">no: è¯¥ Exchange ä¸ä¼šè‡ªåŠ¨åˆ é™¤ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">Internal: ç”¨äºæ§åˆ¶äº¤æ¢æœºæ˜¯å¦å¯ä»¥è¢«ç”Ÿäº§è€…ç›´æ¥å‘å¸ƒæ¶ˆæ¯\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">yes: ä¸èƒ½è¢«ç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯ï¼Œè¯¥äº¤æ¢æœºåªèƒ½ç”¨äº å°†æ¶ˆæ¯ä»å…¶ä»–äº¤æ¢æœºè½¬å‘åˆ°è¯¥äº¤æ¢æœºã€‚</li>\n<li class=\"lvl-6\">no: å¯ä»¥è¢«ç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">Arguments: ç”¨äºè®¾ç½® Exchange çš„å…¶ä»–å‚æ•°ï¼Œç›®å‰ä»…æ”¯æŒä¸€ä¸ªå‚æ•°\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">Alternate exchange(alternate-exchange): æŒ‡å®šè¯¥ Exchange çš„å¤‡ç”¨äº¤æ¢æœºï¼Œå¦‚æœæ— æ³•ä»¥å…¶ä»–æ–¹å¼å°†å‘å¾€æ­¤äº¤æ¢æœºçš„æ¶ˆæ¯è·¯ç”±å‡ºå»ï¼Œåˆ™å°†å®ƒä»¬å‘é€è‡³æ­¤å¤„æŒ‡å®šçš„å¤‡ç”¨äº¤æ¢æœºã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Direct-Exchangeï¼ˆç›´æ¥äº¤æ¢æœºï¼‰\">Direct Exchangeï¼ˆç›´æ¥äº¤æ¢æœºï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®å®Œå…¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šé”®ä¸º errorï¼Œåˆ™åªæœ‰è·¯ç”±é”®ä¸º error çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šéœ€è¦ç²¾ç¡®åŒ¹é…çš„åœºæ™¯ï¼Œå¦‚æ—¥å¿—åˆ†ç±»ã€ä»»åŠ¡åˆ†å‘ç­‰ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Fanout-Exchangeï¼ˆæ‰‡å‡ºäº¤æ¢æœºï¼‰\">Fanout Exchangeï¼ˆæ‰‡å‡ºäº¤æ¢æœºï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå¿½ç•¥è·¯ç”±é”®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæ— è®ºæ¶ˆæ¯çš„è·¯ç”±é”®æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šè¢«è·¯ç”±åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šå¹¿æ’­æ¶ˆæ¯ï¼Œå¦‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€å®æ—¶é€šçŸ¥ç­‰ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Topic-Exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰\">Topic Exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®æ¨¡å¼åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚æ”¯æŒé€šé…ç¬¦ *ï¼ˆåŒ¹é…ä¸€ä¸ªè¯ï¼‰å’Œ #ï¼ˆåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šé”®ä¸º <em>.orange.</em>ï¼Œåˆ™è·¯ç”±é”®ä¸º quick.orange.rabbit çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šæ¨¡å—åŒ–è·¯ç”±ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Headers-Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰\">Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„å¤´éƒ¨ä¸é˜Ÿåˆ—çš„ç»‘å®šå¤´éƒ¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚æ”¯æŒ x-match å‚æ•°ï¼ˆany æˆ– allï¼‰ã€‚å³ä½¿é…ç½®äº†è·¯ç”±é”®ä¹Ÿä¼šå¿½ç•¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šå¤´éƒ¨ä¸º { â€œx-matchâ€: â€œallâ€, â€œformatâ€: â€œpdfâ€, â€œpriorityâ€: â€œhighâ€ }ï¼Œåˆ™åªæœ‰åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šå¤šæ¡ä»¶è·¯ç”±ï¼Œå¦‚å¤æ‚è¿‡æ»¤ã€åŠ¨æ€è·¯ç”±ç­‰ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Local-Random-Exchangeï¼ˆæœ¬åœ°éšæœºäº¤æ¢æœºï¼‰\">Local Random Exchangeï¼ˆæœ¬åœ°éšæœºäº¤æ¢æœºï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Local Random Exchange æ˜¯ RabbitMQ 4.0 å¼•å…¥çš„äº¤æ¢æœºç±»å‹ï¼Œæ—¨åœ¨ä¼˜åŒ–<code>è¯·æ±‚-å“åº”</code>æ¨¡å¼ä¸‹çš„æ¶ˆæ¯è·¯ç”±ï¼Œç‰¹åˆ«é€‚ç”¨äºä½å»¶è¿Ÿå’Œé«˜ååé‡çš„åœºæ™¯ã€‚é€šè¿‡ç»“åˆç‹¬å é˜Ÿåˆ—ä½¿ç”¨ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯å¿«é€Ÿä¼ é€’åˆ°æœ¬åœ°æ¶ˆè´¹è€…ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯å§‹ç»ˆè¢«è·¯ç”±åˆ°æœ¬åœ°é˜Ÿåˆ—ï¼ˆä½äºåŒä¸€èŠ‚ç‚¹ä¸Šï¼‰ï¼Œå¦‚æœæœ‰å¤šä¸ªæœ¬åœ°é˜Ÿåˆ—ç»‘å®šï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡ŒæŠ•é€’ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå‡è®¾èŠ‚ç‚¹ A ä¸Šæœ‰ä¸¤ä¸ªç»‘å®šäº† x-local-random äº¤æ¢æœºçš„é˜Ÿåˆ— Q1 å’Œ Q2ï¼Œå‘å¸ƒçš„æ¶ˆæ¯ä¼šéšæœºè·¯ç”±åˆ° Q1 æˆ– Q2ï¼Œä½†ä¸ä¼šè·¯ç”±åˆ°å…¶ä»–èŠ‚ç‚¹çš„é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šè¯·æ±‚-å“åº”ï¼ˆRPCï¼‰æ¨¡å¼ä¸‹çš„ä½å»¶è¿Ÿé€šä¿¡ï¼Œé€‚åˆå¾®æœåŠ¡æ¶æ„ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰æ¶ˆè´¹è€…çš„åœºæ™¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ä½¿ç”¨ Local Random Exchange æ—¶ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ç‹¬å é˜Ÿåˆ—ï¼šæ¶ˆè´¹è€…åº”å£°æ˜ç‹¬å é˜Ÿåˆ—ï¼Œä»¥ç¡®ä¿é˜Ÿåˆ—ä»…ç»‘å®šåˆ°å½“å‰èŠ‚ç‚¹ã€‚</li>\n<li class=\"lvl-4\">æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘ä¸€ä¸ªæ¶ˆè´¹è€…ï¼šæ¯ä¸ª RabbitMQ èŠ‚ç‚¹ä¸Šåº”è‡³å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¦åˆ™åœ¨è¯¥èŠ‚ç‚¹ä¸Šå‘å¸ƒçš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒã€‚</li>\n<li class=\"lvl-4\">äº¤æ¢æœºç±»å‹å£°æ˜ï¼šä½¿ç”¨ <code>x-local-random</code> ç±»å‹å£°æ˜äº¤æ¢æœºã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Exchange-ä¸-Queue-ç»‘å®š-Binding\">Exchange ä¸ Queue ç»‘å®š(Binding)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºå¥½ Exchange ä¹‹åï¼Œéœ€è¦å°† Exchange ä¸ Queue ç»‘å®šï¼Œæ‰èƒ½å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Exchange ä¸ Queue çš„ç»‘å®šå…³ç³»ï¼Œå³ Exchange å‘é€çš„æ¶ˆæ¯ï¼Œä¼šæ ¹æ®è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ Exchange é¡µé¢ç‚¹å‡» Exchange çš„åç§°ï¼Œè¿›å…¥ Exchange è¯¦æƒ…é¡µé¢ï¼Œæ­¤å¤„å¯ä»¥è¿›è¡Œ Exchange ä¸ Queue ç»‘å®šé…ç½®<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/taKUjm.png\" alt=\"\"></p>\n<blockquote>\n<p>è¿™é‡Œçš„<code>Arguments</code>ç”¨äºè®¾ç½® ç»‘å®š çš„å…¶ä»–å‚æ•°ï¼Œæ¯”å¦‚ <code>Headers Exchange</code> éœ€è¦è®¾ç½® <code>x-match</code> å‚æ•°ç­‰ã€‚</p>\n</blockquote>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Exchange çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹ Exchange(äº¤æ¢æœº) æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨ RabbitMQ ä¸­ï¼ŒExchangeï¼ˆäº¤æ¢æœºï¼‰ æ˜¯æ¶ˆæ¯è·¯ç”±çš„æ ¸å¿ƒç»„ä»¶ã€‚å®ƒè´Ÿè´£æ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®é¢„å®šä¹‰çš„è·¯ç”±è§„åˆ™å°†æ¶ˆæ¯è½¬å‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚ Exchange ç±»å‹å†³å®šäº†æ¶ˆæ¯çš„è·¯ç”±æ–¹å¼ã€‚RabbitMQ æ”¯æŒçš„ Exchange ç±»å‹ Exchange ç±»å‹ å£°æ˜ç±»å‹ è·¯ç”±è§„åˆ™æè¿° å…¸å‹ç”¨é€” Direct direct æ¶ˆæ¯æ ¹æ® è·¯ç”±é”®ï¼ˆrouting keyï¼‰ ç²¾ç¡®åŒ¹é…ç»‘å®šé”®ï¼ˆbinding keyï¼‰è¿›è¡Œè·¯ç”±ã€‚ ç²¾ç¡®æ¶ˆæ¯ä¼ é€’ï¼Œå¦‚æ—¥å¿—åˆ†ç±»ã€ä»»åŠ¡åˆ†å‘ç­‰ã€‚ Fanout fanout æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå¿½ç•¥è·¯ç”±é”®ã€‚ å¹¿æ’­æ¶ˆæ¯ï¼Œå¦‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€å®æ—¶é€šçŸ¥ç­‰ã€‚ Topic topic æ¶ˆæ¯æ ¹æ®è·¯ç”±é”®ä¸ç»‘å®šé”®æ¨¡å¼çš„åŒ¹é…è¿›è¡Œè·¯ç”±ï¼Œæ”¯æŒé€šé…ç¬¦ *ï¼ˆåŒ¹é…ä¸€ä¸ªè¯ï¼‰å’Œ #ï¼ˆåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯ï¼‰ã€‚ æ¨¡å—åŒ–è·¯ç”±ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚ Headers headers æ¶ˆæ¯æ ¹æ® æ¶ˆæ¯å¤´éƒ¨ï¼ˆheadersï¼‰ ä¸ç»‘å®šæ—¶æŒ‡å®šçš„å¤´éƒ¨åŒ¹é…è¿›è¡Œè·¯ç”±ï¼Œæ”¯æŒ x-match å‚æ•°ï¼ˆany æˆ– allï¼‰ã€‚ å¤šæ¡ä»¶è·¯ç”±ï¼Œå¦‚å¤æ‚è¿‡æ»¤ã€åŠ¨æ€è·¯ç”±ç­‰ã€‚ Local Random Exchange x-local-random æ¶ˆæ¯å§‹ç»ˆè¢«è·¯ç”±åˆ°æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å¤šä¸ªæœ¬åœ°é˜Ÿåˆ—ç»‘å®šï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡ŒæŠ•é€’ã€‚ è¯·æ±‚-å“åº”ï¼ˆRPCï¼‰æ¨¡å¼ï¼Œä½å»¶è¿Ÿé€šä¿¡ RabbitMQ é»˜è®¤ä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹çš„äº¤æ¢æœº æ¯æ–°åˆ›å»ºä¸€ä¸ª Vhostï¼ŒRabbitMQ å°±ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹äº¤æ¢æœºï¼Œæ¯”å¦‚ /vtest å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæ–°çš„äº¤æ¢æœº é…ç½®è¯´æ˜ Durability: æŒ‡å®š Exchange æ˜¯å¦æŒä¹…åŒ–ã€‚ Durable: æŒä¹…åŒ–çš„ Exchange ä¼šè¢«ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œé‡å¯ RabbitMQ æ—¶ä¼šè‡ªåŠ¨æ¢å¤ã€‚ Transient: éæŒä¹…åŒ–çš„ Exchange ä¼šè¢«ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé‡å¯ RabbitMQ æ—¶ä¼šä¸¢å¤±ã€‚ Auto-delete: æŒ‡å®š Exchange æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚ yes: å¦‚æœæ²¡æœ‰é˜Ÿåˆ—æˆ–äº¤æ¢æœºç»‘å®šè¯¥ Exchangeï¼Œåˆ™è¯¥ Exchange ä¼šè‡ªåŠ¨åˆ é™¤ã€‚ no: è¯¥ Exchange ä¸ä¼šè‡ªåŠ¨åˆ é™¤ã€‚ Internal: ç”¨äºæ§åˆ¶äº¤æ¢æœºæ˜¯å¦å¯ä»¥è¢«ç”Ÿäº§è€…ç›´æ¥å‘å¸ƒæ¶ˆæ¯ yes: ä¸èƒ½è¢«ç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯ï¼Œè¯¥äº¤æ¢æœºåªèƒ½ç”¨äº å°†æ¶ˆæ¯ä»å…¶ä»–äº¤æ¢æœºè½¬å‘åˆ°è¯¥äº¤æ¢æœºã€‚ no: å¯ä»¥è¢«ç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯ã€‚ Arguments: ç”¨äºè®¾ç½® Exchange çš„å…¶ä»–å‚æ•°ï¼Œç›®å‰ä»…æ”¯æŒä¸€ä¸ªå‚æ•° Alternate exchange(alternate-exchange): æŒ‡å®šè¯¥ Exchange çš„å¤‡ç”¨äº¤æ¢æœºï¼Œå¦‚æœæ— æ³•ä»¥å…¶ä»–æ–¹å¼å°†å‘å¾€æ­¤äº¤æ¢æœºçš„æ¶ˆæ¯è·¯ç”±å‡ºå»ï¼Œåˆ™å°†å®ƒä»¬å‘é€è‡³æ­¤å¤„æŒ‡å®šçš„å¤‡ç”¨äº¤æ¢æœºã€‚ Direct Exchangeï¼ˆç›´æ¥äº¤æ¢æœºï¼‰ è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®å®Œå…¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚ ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šé”®ä¸º errorï¼Œåˆ™åªæœ‰è·¯ç”±é”®ä¸º error çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚ é€‚ç”¨åœºæ™¯ï¼šéœ€è¦ç²¾ç¡®åŒ¹é…çš„åœºæ™¯ï¼Œå¦‚æ—¥å¿—åˆ†ç±»ã€ä»»åŠ¡åˆ†å‘ç­‰ã€‚ Fanout Exchangeï¼ˆæ‰‡å‡ºäº¤æ¢æœºï¼‰ è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå¿½ç•¥è·¯ç”±é”®ã€‚ ç¤ºä¾‹ï¼šæ— è®ºæ¶ˆæ¯çš„è·¯ç”±é”®æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šè¢«è·¯ç”±åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ã€‚ é€‚ç”¨åœºæ™¯ï¼šå¹¿æ’­æ¶ˆæ¯ï¼Œå¦‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€å®æ—¶é€šçŸ¥ç­‰ã€‚ Topic Exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰ è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®æ¨¡å¼åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚æ”¯æŒé€šé…ç¬¦ *ï¼ˆåŒ¹é…ä¸€ä¸ªè¯ï¼‰å’Œ #ï¼ˆåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯ï¼‰ã€‚ ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šé”®ä¸º .orange.ï¼Œåˆ™è·¯ç”±é”®ä¸º quick.orange.rabbit çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚ é€‚ç”¨åœºæ™¯ï¼šæ¨¡å—åŒ–è·¯ç”±ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚ Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰ è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„å¤´éƒ¨ä¸é˜Ÿåˆ—çš„ç»‘å®šå¤´éƒ¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚æ”¯æŒ x-match å‚æ•°ï¼ˆany æˆ– allï¼‰ã€‚å³ä½¿é…ç½®äº†è·¯ç”±é”®ä¹Ÿä¼šå¿½ç•¥ã€‚ ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šå¤´éƒ¨ä¸º { â€œx-matchâ€: â€œallâ€, â€œformatâ€: â€œpdfâ€, â€œpriorityâ€: â€œhighâ€ }ï¼Œåˆ™åªæœ‰åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚ é€‚ç”¨åœºæ™¯ï¼šå¤šæ¡ä»¶è·¯ç”±ï¼Œå¦‚å¤æ‚è¿‡æ»¤ã€åŠ¨æ€è·¯ç”±ç­‰ã€‚ Local Random Exchangeï¼ˆæœ¬åœ°éšæœºäº¤æ¢æœºï¼‰ Local Random Exchange æ˜¯ RabbitMQ 4.0 å¼•å…¥çš„äº¤æ¢æœºç±»å‹ï¼Œæ—¨åœ¨ä¼˜åŒ–è¯·æ±‚-å“åº”æ¨¡å¼ä¸‹çš„æ¶ˆæ¯è·¯ç”±ï¼Œç‰¹åˆ«é€‚ç”¨äºä½å»¶è¿Ÿå’Œé«˜ååé‡çš„åœºæ™¯ã€‚é€šè¿‡ç»“åˆç‹¬å é˜Ÿåˆ—ä½¿ç”¨ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯å¿«é€Ÿä¼ é€’åˆ°æœ¬åœ°æ¶ˆè´¹è€…ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚ è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯å§‹ç»ˆè¢«è·¯ç”±åˆ°æœ¬åœ°é˜Ÿåˆ—ï¼ˆä½äºåŒä¸€èŠ‚ç‚¹ä¸Šï¼‰ï¼Œå¦‚æœæœ‰å¤šä¸ªæœ¬åœ°é˜Ÿåˆ—ç»‘å®šï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡ŒæŠ•é€’ã€‚ ç¤ºä¾‹ï¼šå‡è®¾èŠ‚ç‚¹ A ä¸Šæœ‰ä¸¤ä¸ªç»‘å®šäº† x-local-random äº¤æ¢æœºçš„é˜Ÿåˆ— Q1 å’Œ Q2ï¼Œå‘å¸ƒçš„æ¶ˆæ¯ä¼šéšæœºè·¯ç”±åˆ° Q1 æˆ– Q2ï¼Œä½†ä¸ä¼šè·¯ç”±åˆ°å…¶ä»–èŠ‚ç‚¹çš„é˜Ÿåˆ—ã€‚ é€‚ç”¨åœºæ™¯ï¼šè¯·æ±‚-å“åº”ï¼ˆRPCï¼‰æ¨¡å¼ä¸‹çš„ä½å»¶è¿Ÿé€šä¿¡ï¼Œé€‚åˆå¾®æœåŠ¡æ¶æ„ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰æ¶ˆè´¹è€…çš„åœºæ™¯ã€‚ åœ¨ä½¿ç”¨ Local Random Exchange æ—¶ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š ç‹¬å é˜Ÿåˆ—ï¼šæ¶ˆè´¹è€…åº”å£°æ˜ç‹¬å é˜Ÿåˆ—ï¼Œä»¥ç¡®ä¿é˜Ÿåˆ—ä»…ç»‘å®šåˆ°å½“å‰èŠ‚ç‚¹ã€‚ æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘ä¸€ä¸ªæ¶ˆè´¹è€…ï¼šæ¯ä¸ª RabbitMQ èŠ‚ç‚¹ä¸Šåº”è‡³å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¦åˆ™åœ¨è¯¥èŠ‚ç‚¹ä¸Šå‘å¸ƒçš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒã€‚ äº¤æ¢æœºç±»å‹å£°æ˜ï¼šä½¿ç”¨ x-local-random ç±»å‹å£°æ˜äº¤æ¢æœºã€‚ Exchange ä¸ Queue ç»‘å®š(Binding) åˆ›å»ºå¥½ Exchange ä¹‹åï¼Œéœ€è¦å°† Exchange ä¸ Queue ç»‘å®šï¼Œæ‰èƒ½å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚ Exchange ä¸ Queue çš„ç»‘å®šå…³ç³»ï¼Œå³ Exchange å‘é€çš„æ¶ˆæ¯ï¼Œä¼šæ ¹æ®è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚ åœ¨ Exchange é¡µé¢ç‚¹å‡» Exchange çš„åç§°ï¼Œè¿›å…¥ Exchange è¯¦æƒ…é¡µé¢ï¼Œæ­¤å¤„å¯ä»¥è¿›è¡Œ Exchange ä¸ Queue ç»‘å®šé…ç½® è¿™é‡Œçš„Argumentsç”¨äºè®¾ç½® ç»‘å®š çš„å…¶ä»–å‚æ•°ï¼Œæ¯”å¦‚ Headers Exchange éœ€è¦è®¾ç½® x-match å‚æ•°ç­‰ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Exchange çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹","date_published":"2025-09-21T13:30:05.000Z","tags":["æŠ€æœ¯","rabbitmq","åˆ†å¸ƒå¼","rabbitmq"]},{"id":"https://blog.hanqunfeng.com/2025/09/20/rabbitmq-queue/","url":"https://blog.hanqunfeng.com/2025/09/20/rabbitmq-queue/","title":"RabbitMQ ä¹‹ Queue","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Queue çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo\">Java Client ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Queue-é˜Ÿåˆ—-æ˜¯ä»€ä¹ˆï¼Ÿ\">Queue(é˜Ÿåˆ—) æ˜¯ä»€ä¹ˆï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ RabbitMQ ä¸­ï¼Œ<a href=\"https://www.rabbitmq.com/docs/queues\">é˜Ÿåˆ—ï¼ˆQueueï¼‰</a> æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨æ¶ˆæ¯çš„ æ•°æ®ç»“æ„ï¼Œæ¶ˆæ¯ä¼šä¸€ç›´ä¿å­˜åœ¨é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°è¢«åº”ç”¨ç¨‹åºæˆ–æœåŠ¡æ¶ˆè´¹ä¸ºæ­¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”Ÿäº§è€…ï¼ˆPublisherï¼‰ æŠŠæ¶ˆæ¯æ”¾è¿›é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ã€‚é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šæŒ‰ç…§ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„é¡ºåºè¿›è¡Œæ¶ˆè´¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é˜Ÿåˆ—åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´èµ·åˆ°ç¼“å†²åŒºçš„ä½œç”¨ã€‚ç”Ÿäº§è€…ä¸éœ€è¦çŸ¥é“æ¶ˆè´¹è€…çš„å­˜åœ¨ï¼Œå®ƒä»¬åªéœ€æŠŠæ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ã€‚æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®è‡ªèº«å¤„ç†é€Ÿåº¦ï¼ŒæŒ‰éœ€æ¶ˆè´¹æ¶ˆæ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ ç›®å‰ æ”¯æŒä¸‰ç§é˜Ÿåˆ—ç±»å‹ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é˜Ÿåˆ—ç±»å‹</th>\n<th>æè¿°</th>\n<th>ç‰¹ç‚¹</th>\n<th>å…¸å‹ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Classic Queueï¼ˆç»å…¸é˜Ÿåˆ—ï¼‰</strong></td>\n<td>æœ€å¸¸ç”¨çš„é˜Ÿåˆ—ç±»å‹ï¼Œæ¶ˆæ¯æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰é¡ºåºå­˜å‚¨å’Œæ¶ˆè´¹</td>\n<td>æ”¯æŒæŒä¹…åŒ–ã€ä¼˜å…ˆçº§ã€TTLã€æ­»ä¿¡ç­‰</td>\n<td>å¤§å¤šæ•°å¸¸è§„æ¶ˆæ¯åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>Quorum Queueï¼ˆä»²è£é˜Ÿåˆ—ï¼‰</strong></td>\n<td>åŸºäº Raft åè®®çš„é˜Ÿåˆ—ï¼Œç¡®ä¿é«˜å¯ç”¨å’Œæ•°æ®ä¸€è‡´æ€§</td>\n<td>å†…ç½®å¤åˆ¶ï¼ˆå‰¯æœ¬æ•°é‡å¯é…ç½®ï¼‰ã€é€‚åˆé«˜å¯é æ€§åœºæ™¯ï¼Œä½†ååé‡ç•¥ä½äºç»å…¸é˜Ÿåˆ—</td>\n<td>å…³é”®ä»»åŠ¡æ¶ˆæ¯ã€é«˜å¯é æ€§åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>Stream Queueï¼ˆæµå¼é˜Ÿåˆ—ï¼‰</strong></td>\n<td>é¢å‘å¤§é‡æ¶ˆæ¯çš„é«˜ååé˜Ÿåˆ—ï¼Œæ”¯æŒæ¶ˆæ¯æŒ‰åç§»é‡è¯»å–</td>\n<td>ç±»ä¼¼ Kafkaï¼Œå¯éšæœºè®¿é—®å†å²æ¶ˆæ¯ã€é¡ºåºè¯»å–ã€å¯æŒä¹…åŒ–å¤§é‡æ¶ˆæ¯</td>\n<td>å¤§æ•°æ®æµã€æ—¥å¿—å¤„ç†ã€äº‹ä»¶æº¯æº</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Classic-Queue-ç»å…¸é˜Ÿåˆ—\">Classic Queue(ç»å…¸é˜Ÿåˆ—)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com/docs/classic-queues\">RabbitMQ ç»å…¸é˜Ÿåˆ—ï¼ˆåŸå§‹é˜Ÿåˆ—ç±»å‹ï¼‰</a>æ˜¯ä¸€ç§é€šç”¨é˜Ÿåˆ—ç±»å‹ã€‚å®é™…ä¸Šå®ƒæ˜¯åœ¨ 3.8.x ç‰ˆæœ¬ä¹‹å‰å”¯ä¸€çš„é˜Ÿåˆ—ç±»å‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç»å…¸é˜Ÿåˆ—é€‚ç”¨äºæ•°æ®å®‰å…¨ä¸æ˜¯ä¼˜å…ˆäº‹é¡¹çš„ç”¨ä¾‹ï¼Œå› ä¸ºå­˜å‚¨åœ¨ç»å…¸é˜Ÿåˆ—ä¸­çš„æ•°æ®ä¸ä¼šè¢«å¤åˆ¶ã€‚ ç»å…¸é˜Ÿåˆ—ä½¿ç”¨éå¤åˆ¶çš„ FIFO é˜Ÿåˆ—å®ç°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç»å…¸é˜Ÿåˆ—ä¸é€‚åˆç§¯ç´¯å¤ªå¤šçš„æ¶ˆæ¯ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­ç§¯ç´¯çš„æ¶ˆæ¯å¤ªå¤šäº†ï¼Œä¼šä¸¥é‡å½±å“å®¢æˆ·ç«¯ç”Ÿäº§æ¶ˆæ¯ä»¥åŠæ¶ˆè´¹æ¶ˆæ¯çš„æ€§èƒ½ã€‚å› æ­¤ï¼Œç»å…¸é˜Ÿåˆ—ä¸»è¦ç”¨åœ¨æ•°æ®é‡æ¯”è¾ƒå°ï¼Œå¹¶ä¸”ç”Ÿäº§æ¶ˆæ¯å’Œæ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦æ¯”è¾ƒç¨³å®šçš„ä¸šåŠ¡åœºæ™¯ã€‚æ¯”å¦‚å†…éƒ¨ç³»ç»Ÿä¹‹é—´çš„æœåŠ¡è°ƒç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ 4.0 åˆ é™¤äº†å¯¹ç»å…¸é˜Ÿåˆ— <code>version1</code> çš„æ”¯æŒï¼ŒåŒæ—¶ä¹Ÿä¸å†æ”¯æŒå°† ç»å…¸é˜Ÿåˆ— çš„æ¶ˆæ¯åœ¨èŠ‚ç‚¹é—´å¤åˆ¶ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/MAdpRV.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°åç§°</th>\n<th>é…ç½®å‚æ•°å</th>\n<th>æ•°æ®ç±»å‹</th>\n<th>ä½œç”¨è¯´æ˜</th>\n<th>å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Auto expire</strong></td>\n<td><code>x-expires</code></td>\n<td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td>\n<td>é˜Ÿåˆ—åœ¨ <strong>æŒ‡å®šæ—¶é—´å†…æ— äººä½¿ç”¨ï¼ˆæ— æ¶ˆè´¹è€…ã€æ— å‘å¸ƒã€æ— è®¿é—®ï¼‰</strong> æ—¶è‡ªåŠ¨åˆ é™¤</td>\n<td>ç±»ä¼¼â€œé˜Ÿåˆ—ç©ºé—²è¿‡æœŸæ—¶é—´â€ï¼ŒèŠ‚çœèµ„æº</td>\n</tr>\n<tr>\n<td><strong>Message TTL</strong></td>\n<td><code>x-message-ttl</code></td>\n<td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td>\n<td>æ¶ˆæ¯çš„ <strong>å­˜æ´»æ—¶é—´</strong>ï¼Œè¶…è¿‡æ—¶é—´åæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—</td>\n<td>ç”¨äºé™åˆ¶æ¶ˆæ¯æ—¶æ•ˆæ€§ï¼Œå¦‚å»¶è¿Ÿæ¶ˆæ¯æˆ–çŸ­æœŸç¼“å­˜</td>\n</tr>\n<tr>\n<td><strong>Overflow behaviour</strong></td>\n<td><code>x-overflow</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>drop-head</code> æˆ– <code>reject-publish</code>ï¼‰</td>\n<td>å½“é˜Ÿåˆ—è¾¾åˆ° <strong>æœ€å¤§é•¿åº¦</strong> æˆ– <strong>æœ€å¤§å­—èŠ‚æ•°</strong> æ—¶çš„è¡Œä¸º</td>\n<td>- <code>drop-head</code>ï¼šä¸¢å¼ƒæœ€æ—©çš„æ¶ˆæ¯ <br> - <code>reject-publish</code>ï¼šæ‹’ç»æ–°çš„æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Single active consumer</strong></td>\n<td><code>x-single-active-consumer</code></td>\n<td>å¸ƒå°”å€¼ï¼ˆtrue/falseï¼‰</td>\n<td>æ˜¯å¦å¯ç”¨ <strong>å•æ´»æ¶ˆè´¹è€…æ¨¡å¼</strong>ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ—</td>\n<td>ç”¨äºä¸¥æ ¼é¡ºåºæ¶ˆè´¹ï¼Œä¿è¯æŸä¸ªæ¶ˆæ¯ä¸ä¼šè¢«å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>Dead letter exchange (DLX)</strong></td>\n<td><code>x-dead-letter-exchange</code></td>\n<td>å­—ç¬¦ä¸²</td>\n<td>æŒ‡å®šé˜Ÿåˆ—çš„ <strong>æ­»ä¿¡äº¤æ¢æœº</strong>ï¼Œç”¨äºæ¥æ”¶æ— æ³•æ¶ˆè´¹æˆ–è¿‡æœŸçš„æ¶ˆæ¯</td>\n<td>å¸¸ç”¨äºå¤±è´¥é‡è¯•ã€æ¶ˆæ¯è¡¥å¿åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>Dead letter routing key</strong></td>\n<td><code>x-dead-letter-routing-key</code></td>\n<td>å­—ç¬¦ä¸²</td>\n<td>æ¶ˆæ¯è½¬å‘åˆ° DLX æ—¶çš„ <strong>è·¯ç”±é”®</strong></td>\n<td>å¯ä»¥çµæ´»è½¬å‘åˆ°ä¸åŒé˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td><strong>Max length</strong></td>\n<td><code>x-max-length</code></td>\n<td>æ•´æ•°</td>\n<td>é˜Ÿåˆ—ä¸­ <strong>æœ€å¤§æ¶ˆæ¯æ¡æ•°</strong></td>\n<td>è¶…è¿‡æ—¶æŒ‰ç…§ Overflow behaviour å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>Max length bytes</strong></td>\n<td><code>x-max-length-bytes</code></td>\n<td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td>\n<td>é˜Ÿåˆ—ä¸­ <strong>æ¶ˆæ¯æ€»å­—èŠ‚æ•°ä¸Šé™</strong></td>\n<td>è¶…è¿‡æ—¶æŒ‰ç…§ Overflow behaviour å¤„ç†ï¼Œé€‚åˆå¤§æ¶ˆæ¯åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>Maximum priority</strong></td>\n<td><code>x-max-priority</code></td>\n<td>æ•´æ•°</td>\n<td>å¯ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—å¯è®¾ç½®çš„ <strong>æœ€å¤§ä¼˜å…ˆçº§å€¼</strong></td>\n<td>æ¶ˆæ¯ä¼˜å…ˆçº§èŒƒå›´æ˜¯ 0 åˆ°è¿™ä¸ªå€¼ï¼Œä¼˜å…ˆçº§é«˜çš„æ¶ˆæ¯å…ˆè¢«æ¶ˆè´¹</td>\n</tr>\n<tr>\n<td><strong>Leader locator</strong></td>\n<td><code>x-queue-leader-locator</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>client-local</code>ã€<code>balanced</code>ï¼‰</td>\n<td>è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—ä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™</td>\n<td><code>client-local</code>ï¼ˆé»˜è®¤ï¼‰ï¼šé€‰æ‹©å®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸ºLeader <br> <code>balanced</code>ï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡Leaderåˆ†å¸ƒï¼Œç”¨äº HA é˜Ÿåˆ—ä¼˜åŒ–</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Quorum-Queue-ä»²è£é˜Ÿåˆ—\">Quorum Queue(ä»²è£é˜Ÿåˆ—)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com/docs/quorum-queues\">ä»²è£é˜Ÿåˆ—ï¼ˆQuorum Queueï¼‰</a> æ˜¯ RabbitMQ ä»3.8.0ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„ä¸€ç§ç°ä»£é˜Ÿåˆ—ç±»å‹ï¼Œä¹Ÿæ˜¯ç›®å‰å®˜æ–¹æ¯”è¾ƒæ¨èçš„ä¸€ç§å¯¹åˆ—ç±»å‹ã€‚æœªæ¥æœ‰å¯èƒ½å–ä»£ ç»å…¸é˜Ÿåˆ— æˆä¸ºé»˜è®¤é˜Ÿåˆ—ç±»å‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…¶åŸºäº Raft å…±è¯†ç®—æ³• å®ç° æŒä¹…åŒ–ã€å¤åˆ¶å’Œé«˜å¯ç”¨ã€‚å®ƒä¿è¯ æ•°æ®å®‰å…¨æ€§ã€å¯é çš„ä¸»èŠ‚ç‚¹é€‰ä¸¾ï¼Œå³ä½¿åœ¨å‡çº§æˆ–é›†ç¾¤æ³¢åŠ¨æœŸé—´ä¹Ÿèƒ½ä¿æŒé«˜å¯ç”¨æ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»²è£é˜Ÿåˆ—æ”¯æŒ æ¯’æ¶ˆæ¯å¤„ç†ã€è‡³å°‘ä¸€æ¬¡æ­»ä¿¡æŠ•é€’ ä»¥åŠ AMQP ä¿®æ”¹ï¼ˆAMQP.modifiedï¼‰çš„å¤„ç†ç»“æœã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒé€‚åˆ ä»¥æ•°æ®å®‰å…¨ä¸ºé¦–è¦ç›®æ ‡ çš„åœºæ™¯ã€‚ä¸ç»å…¸é˜Ÿåˆ—ç›¸æ¯”ï¼ŒQuorumæ˜¯ä»¥ç‰ºç‰²å¾ˆå¤šé«˜çº§é˜Ÿåˆ—ç‰¹æ€§ä¸ºä»£ä»·ï¼Œæ¥è¿›ä¸€æ­¥ä¿è¯æ¶ˆæ¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é«˜å¯é ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/oQ8YiT.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»²è£é˜Ÿåˆ—ï¼ˆQuorum Queueï¼‰çš„ <code>Durability</code> åªèƒ½è®¾ç½®ä¸º Durable(true)ã€‚<code>Auto delete</code> åªèƒ½ä¸º No(false)ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°åç§°</th>\n<th>é…ç½®å‚æ•°å</th>\n<th>æ•°æ®ç±»å‹</th>\n<th>ä½œç”¨è¯´æ˜</th>\n<th>å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Auto expire</strong></td>\n<td><code>x-expires</code></td>\n<td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td>\n<td>é˜Ÿåˆ—åœ¨æŒ‡å®šæ—¶é—´å†…æ— äººä½¿ç”¨ï¼ˆæ— æ¶ˆè´¹è€…ã€æ— å‘å¸ƒã€æ— è®¿é—®ï¼‰æ—¶è‡ªåŠ¨åˆ é™¤</td>\n<td>èŠ‚çœèµ„æºï¼Œé˜Ÿåˆ—ç©ºé—²è¿‡æœŸæ—¶é—´</td>\n</tr>\n<tr>\n<td><strong>Message TTL</strong></td>\n<td><code>x-message-ttl</code></td>\n<td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td>\n<td>é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„ç”Ÿå­˜æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´åæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–è½¬å…¥æ­»ä¿¡é˜Ÿåˆ—</td>\n<td>æ§åˆ¶æ¶ˆæ¯æ—¶æ•ˆæ€§</td>\n</tr>\n<tr>\n<td><strong>Overflow behaviour</strong></td>\n<td><code>x-overflow</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>drop-head</code> æˆ– <code>reject-publish</code>ï¼‰</td>\n<td>å½“é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦æ—¶çš„å¤„ç†æ–¹å¼</td>\n<td><code>drop-head</code>ï¼šä¸¢å¼ƒæœ€æ—©æ¶ˆæ¯ï¼Œ<code>reject-publish</code>ï¼šæ‹’ç»æ–°æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Single active consumer</strong></td>\n<td><code>x-single-active-consumer</code></td>\n<td>å¸ƒå°”å€¼ï¼ˆtrue/falseï¼‰</td>\n<td>æ˜¯å¦å¯ç”¨å•æ´»æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ—</td>\n<td>ä¿è¯ä¸¥æ ¼é¡ºåºæ¶ˆè´¹</td>\n</tr>\n<tr>\n<td><strong>Dead letter exchange (DLX)</strong></td>\n<td><code>x-dead-letter-exchange</code></td>\n<td>å­—ç¬¦ä¸²</td>\n<td>æŒ‡å®šé˜Ÿåˆ—çš„æ­»ä¿¡äº¤æ¢æœºï¼Œç”¨äºæ¥æ”¶æ— æ³•æ¶ˆè´¹æˆ–è¿‡æœŸçš„æ¶ˆæ¯</td>\n<td>ä¸ DLX é…åˆä½¿ç”¨å¤„ç†å¤±è´¥æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Dead letter routing key</strong></td>\n<td><code>x-dead-letter-routing-key</code></td>\n<td>å­—ç¬¦ä¸²</td>\n<td>æ¶ˆæ¯è½¬å‘åˆ° DLX æ—¶çš„è·¯ç”±é”®</td>\n<td>çµæ´»è·¯ç”±æ­»ä¿¡æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Max length</strong></td>\n<td><code>x-max-length</code></td>\n<td>æ•´æ•°</td>\n<td>é˜Ÿåˆ—ä¸­æœ€å¤§æ¶ˆæ¯æ¡æ•°</td>\n<td>è¶…è¿‡æ—¶æŒ‰ Overflow behaviour å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>Max length bytes</strong></td>\n<td><code>x-max-length-bytes</code></td>\n<td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td>\n<td>é˜Ÿåˆ—æ¶ˆæ¯æ€»å­—èŠ‚æ•°ä¸Šé™</td>\n<td>è¶…è¿‡æ—¶æŒ‰ Overflow behaviour å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>Delivery limit</strong></td>\n<td><code>x-delivery-limit</code></td>\n<td>æ•´æ•°</td>\n<td>æ¶ˆæ¯å…è®¸æŠ•é€’çš„æœ€å¤§æ¬¡æ•°ï¼Œè¶…è¿‡åå˜ä¸ºæ­»ä¿¡</td>\n<td>æ§åˆ¶æ¶ˆæ¯é‡è¯•æ¬¡æ•°</td>\n</tr>\n<tr>\n<td><strong>Initial cluster size</strong></td>\n<td><code>x-quorum-initial-group-size</code></td>\n<td>æ•´æ•°</td>\n<td>é˜Ÿåˆ—åœ¨åˆ›å»ºæ—¶éœ€è¦çš„æœ€å°èŠ‚ç‚¹æ•°</td>\n<td>ç”¨äºä¿è¯ä»²è£é˜Ÿåˆ—çš„é«˜å¯ç”¨æ€§</td>\n</tr>\n<tr>\n<td><strong>Target cluster size</strong></td>\n<td><code>x-quorum-target-group-size</code></td>\n<td>æ•´æ•°</td>\n<td>é˜Ÿåˆ—è¿è¡Œæ—¶çš„ç›®æ ‡èŠ‚ç‚¹æ•°</td>\n<td>å½“é›†ç¾¤èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œä»²è£é˜Ÿåˆ—ä¼šå°è¯•è°ƒæ•´å‰¯æœ¬æ•°é‡</td>\n</tr>\n<tr>\n<td><strong>Dead letter strategy</strong></td>\n<td><code>x-dead-letter-strategy</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>at-most-once</code>ã€<code>at-least-once</code>ï¼‰</td>\n<td>è®¾ç½®ä»²è£é˜Ÿåˆ—çš„æ­»ä¿¡å¤„ç†ç­–ç•¥</td>\n<td>ä»…é€‚ç”¨äº Quorum Queueã€‚<br><code>at-most-once</code>ï¼ˆé»˜è®¤ï¼‰ï¼šæ¶ˆæ¯æœ€å¤šæŠ•é€’ä¸€æ¬¡ï¼Œå¯èƒ½ä¸¢å¤±ã€‚<br><code>at-least-once</code>ï¼šç¡®ä¿æ¶ˆæ¯è‡³å°‘æŠ•é€’ä¸€æ¬¡ï¼Œå¿…é¡»å°† Overflow behaviour è®¾ç½®ä¸º <code>reject-publish</code>ï¼Œå¦åˆ™å›é€€åˆ° <code>at-most-once</code>ã€‚</td>\n</tr>\n<tr>\n<td><strong>Leader locator</strong></td>\n<td><code>x-queue-leader-locator</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>client-local</code>ã€<code>balanced</code>ï¼‰</td>\n<td>è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—ä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™</td>\n<td><code>client-local</code>ï¼šé€‰æ‹©å®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸º Leader <br> <code>balanced</code>ï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡ Leader åˆ†å¸ƒ</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Quorum Queues å’Œ Classic Queues çš„åŠŸèƒ½å¯¹æ¯”å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Feature</th>\n<th>ä¸­æ–‡å«ä¹‰</th>\n<th>Classic queues</th>\n<th>Quorum queues</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Non-durable queues</td>\n<td>éæŒä¹…åŒ–é˜Ÿåˆ—</td>\n<td>yes</td>\n<td>no</td>\n<td>Quorum queues æ€»æ˜¯æŒä¹…åŒ–ï¼Œä¸æ”¯æŒéæŒä¹…åŒ–</td>\n</tr>\n<tr>\n<td>Message replication</td>\n<td>æ¶ˆæ¯å¤åˆ¶</td>\n<td>no</td>\n<td>yes</td>\n<td>Quorum queues å†…ç½®æ¶ˆæ¯å¤åˆ¶ï¼ŒClassic queues éœ€é•œåƒç­–ç•¥</td>\n</tr>\n<tr>\n<td>Exclusivity</td>\n<td>ç‹¬å é˜Ÿåˆ—</td>\n<td>yes</td>\n<td>no</td>\n<td>Classic queues æ”¯æŒç‹¬å é˜Ÿåˆ—ï¼ŒQuorum queues ä¸æ”¯æŒç‹¬å </td>\n</tr>\n<tr>\n<td>Per message persistence</td>\n<td>æ¶ˆæ¯çº§æŒä¹…åŒ–</td>\n<td>per message</td>\n<td>always</td>\n<td>Quorum queues æ¶ˆæ¯æ€»æ˜¯æŒä¹…åŒ–</td>\n</tr>\n<tr>\n<td>Membership changes</td>\n<td>èŠ‚ç‚¹æˆå‘˜å˜æ›´</td>\n<td>no</td>\n<td>semi-automatic</td>\n<td>Quorum queues èŠ‚ç‚¹å˜åŒ–æ—¶åŠè‡ªåŠ¨å¤„ç†å¤åˆ¶</td>\n</tr>\n<tr>\n<td>Message TTL (Time-To-Live)</td>\n<td>æ¶ˆæ¯å­˜æ´»æ—¶é—´</td>\n<td>yes</td>\n<td>yes</td>\n<td>ä¸¤è€…éƒ½æ”¯æŒæ¶ˆæ¯è¿‡æœŸæ—¶é—´</td>\n</tr>\n<tr>\n<td>Queue TTL</td>\n<td>é˜Ÿåˆ—å­˜æ´»æ—¶é—´</td>\n<td>yes</td>\n<td>partially</td>\n<td>Quorum queues çš„ lease ä¸ä¼šå› é‡æ–°å£°æ˜è€Œç»­æœŸ</td>\n</tr>\n<tr>\n<td>Queue length limits</td>\n<td>é˜Ÿåˆ—é•¿åº¦é™åˆ¶</td>\n<td>yes</td>\n<td>yes</td>\n<td>Quorum queues æ”¯æŒé•¿åº¦é™åˆ¶ï¼Œä½† <code>x-overflow=reject-publish-dlx</code> ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td>Keeps messages in memory</td>\n<td>æ¶ˆæ¯å†…å­˜ä¿å­˜</td>\n<td>see Classic Queues</td>\n<td>never</td>\n<td>Quorum queues æ¶ˆæ¯æ€»æ˜¯å†™å…¥ç£ç›˜ï¼Œä¸ä¿ç•™åœ¨å†…å­˜</td>\n</tr>\n<tr>\n<td>Message priority</td>\n<td>æ¶ˆæ¯ä¼˜å…ˆçº§</td>\n<td>yes</td>\n<td>yes</td>\n<td>æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§</td>\n</tr>\n<tr>\n<td>Single Active Consumer</td>\n<td>å•æ´»æ¶ˆè´¹è€…</td>\n<td>yes</td>\n<td>yes</td>\n<td>æ”¯æŒå•æ´»æ¶ˆè´¹è€…</td>\n</tr>\n<tr>\n<td>Consumer exclusivity</td>\n<td>ç‹¬å æ¶ˆè´¹è€…</td>\n<td>yes</td>\n<td>no</td>\n<td>Quorum queues ä¸æ”¯æŒç‹¬å æ¶ˆè´¹è€…ï¼Œéœ€ä½¿ç”¨ Single Active Consumer</td>\n</tr>\n<tr>\n<td>Consumer priority</td>\n<td>æ¶ˆè´¹è€…ä¼˜å…ˆçº§</td>\n<td>yes</td>\n<td>yes</td>\n<td>æ”¯æŒæ¶ˆè´¹è€…ä¼˜å…ˆçº§</td>\n</tr>\n<tr>\n<td>Dead letter exchanges</td>\n<td>æ­»ä¿¡äº¤æ¢æœº</td>\n<td>yes</td>\n<td>yes</td>\n<td>æ”¯æŒæ­»ä¿¡äº¤æ¢æœº</td>\n</tr>\n<tr>\n<td>Adheres to policies</td>\n<td>éµå¾ªç­–ç•¥</td>\n<td>yes</td>\n<td>yes</td>\n<td>æ”¯æŒç­–ç•¥ï¼Œä½† Quorum queues çš„éƒ¨åˆ†ç­–ç•¥è¡Œä¸ºä¸åŒ</td>\n</tr>\n<tr>\n<td>Poison message handling</td>\n<td>æ¯’æ¶ˆæ¯å¤„ç†</td>\n<td>no</td>\n<td>yes</td>\n<td>Quorum queues æ”¯æŒæ¯’æ¶ˆæ¯å¤„ç†</td>\n</tr>\n<tr>\n<td>Server-named queues</td>\n<td>æœåŠ¡å™¨è‡ªåŠ¨å‘½åé˜Ÿåˆ—</td>\n<td>yes</td>\n<td>no</td>\n<td>Quorum queues ä¸æ”¯æŒæœåŠ¡å™¨è‡ªåŠ¨å‘½åé˜Ÿåˆ—</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Stream-æµ\">Stream(æµ)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com/docs/streams\">Stream</a> æ˜¯RabbitMQè‡ª 3.9.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ç§æ–°çš„æ•°æ®é˜Ÿåˆ—ç±»å‹ã€‚è¿™ç§é˜Ÿåˆ—ç±»å‹çš„æ¶ˆæ¯æ˜¯æŒä¹…åŒ–åˆ°ç£ç›˜å¹¶ä¸”å…·å¤‡åˆ†å¸ƒå¼å¤‡ä»½çš„ï¼Œæ›´é€‚åˆäºæ¶ˆè´¹è€…å¤šï¼Œè¯»æ¶ˆæ¯éå¸¸é¢‘ç¹çš„åœºæ™¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Stream çš„æ ¸å¿ƒæ˜¯ä»¥append-onlyåªæ·»åŠ çš„æ—¥å¿—æ¥è®°å½•æ¶ˆæ¯ï¼Œæ•´ä½“æ¥è¯´ï¼Œå°±æ˜¯æ¶ˆæ¯å°†ä»¥append-onlyçš„æ–¹å¼æŒä¹…åŒ–åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡è°ƒæ•´æ¯ä¸ªæ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦offsetï¼Œæ¥å®ç°æ¶ˆæ¯çš„å¤šæ¬¡åˆ†å‘ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Stream ä¸æ”¯æŒæ­»ä¿¡äº¤æ¢æœºï¼Œä¸æ”¯æŒå¤„ç†æ¯’æ¶ˆæ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š Stream ä¸å±äºé˜Ÿåˆ—ï¼Œæµï¼ˆStreamsï¼‰ æ˜¯ä¸€ç§ æŒä¹…åŒ–ã€å¯å¤åˆ¶çš„æ•°æ®ç»“æ„ï¼ŒåŠŸèƒ½ä¸Šç±»ä¼¼é˜Ÿåˆ—ï¼šä»ç”Ÿäº§è€…ç¼“å†²æ¶ˆæ¯ä¾›æ¶ˆè´¹è€…è¯»å–ã€‚ä½†å®ƒä¸é˜Ÿåˆ—æœ‰ä¸¤ä¸ªé‡è¦åŒºåˆ«ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å­˜å‚¨æ¨¡å‹ â€“ æµæ˜¯ è¿½åŠ æ—¥å¿—ï¼ˆappend-only logï¼‰ï¼Œæ¶ˆæ¯å¯ä»¥ é‡å¤è¯»å–ç›´åˆ°è¿‡æœŸã€‚</li>\n<li class=\"lvl-4\">æ¶ˆè´¹æ¨¡å‹ â€“ æµæä¾› éç ´åæ€§æ¶ˆè´¹è¯­ä¹‰ï¼ˆnon-destructive consumer semanticsï¼‰ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å¤šæ¬¡è¯»å–åŒä¸€æ¡æ¶ˆæ¯è€Œä¸ä¼šåˆ é™¤å®ƒã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Stream å§‹ç»ˆæ˜¯æŒä¹…åŒ–å’Œå¤åˆ¶çš„ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚æ¶ˆè´¹è€…å¯ä»¥é€šè¿‡ RabbitMQ å®¢æˆ·ç«¯åº“ æˆ– ä¸“ç”¨äºŒè¿›åˆ¶åè®®æ’ä»¶ è¯»å–æµï¼Œå…¶ä¸­æ’ä»¶æ–¹å¼å¯ä»¥ è®¿é—®æ‰€æœ‰æµç‰¹æ€§ å¹¶æä¾› æœ€ä½³æ€§èƒ½ã€‚åˆç†çš„å®¢æˆ·ç«¯è¿æ¥ç­–ç•¥æœ‰åŠ©äºæå‡ ååé‡å’Œæ•ˆç‡ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/8KqZY9.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°åç§°</th>\n<th>é…ç½®å‚æ•°å</th>\n<th>æ•°æ®ç±»å‹</th>\n<th>ä½œç”¨è¯´æ˜</th>\n<th>å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Max length bytes</strong></td>\n<td><code>x-max-length-bytes</code></td>\n<td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td>\n<td>æµä¸­å…è®¸å­˜å‚¨çš„ <strong>æœ€å¤§æ•°æ®æ€»å­—èŠ‚æ•°</strong></td>\n<td>è¶…è¿‡æ—¶æµå°†åœæ­¢æ¥æ”¶æ–°æ¶ˆæ¯ï¼Œé€‚åˆæ§åˆ¶å­˜å‚¨å®¹é‡</td>\n</tr>\n<tr>\n<td><strong>Max time retention</strong></td>\n<td><code>x-max-age</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆæ—¶é—´å•ä½ï¼Œä¾‹å¦‚ <code>1h</code>, <code>30m</code>, <code>1d</code>ï¼‰</td>\n<td>è®¾ç½®æµé˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„ <strong>æœ€å¤§ä¿ç•™æ—¶é—´</strong>ï¼Œè¶…è¿‡æ—¶é—´çš„æ¶ˆæ¯ä¼šè¢«åˆ é™¤</td>\n<td>æ”¯æŒæ—¶é—´å•ä½ï¼šY=å¹´, M=æœˆ, D=å¤©, h=å°æ—¶, m=åˆ†é’Ÿ, s=ç§’ã€‚ä¾‹å¦‚ <code>&quot;1h&quot;</code> è¡¨ç¤ºåªä¿ç•™æœ€è¿‘ 1 å°æ—¶çš„æ¶ˆæ¯ï¼Œç”¨äºæ§åˆ¶æ•°æ®é‡å’Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Max segment size in bytes</strong></td>\n<td><code>x-stream-max-segment-size</code></td>\n<td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td>\n<td>æµåˆ†æ®µå­˜å‚¨æ—¶çš„ <strong>æ¯ä¸ªæ®µçš„æœ€å¤§å­—èŠ‚æ•°</strong></td>\n<td>æ§åˆ¶å•ä¸ªæ–‡ä»¶æ®µå¤§å°ï¼Œæœ‰åˆ©äº I/O æ€§èƒ½å’Œç®¡ç†</td>\n</tr>\n<tr>\n<td><strong>Filter size (per chunk) in bytes</strong></td>\n<td><code>x-stream-filter-size-bytes</code></td>\n<td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td>\n<td>æµå†…éƒ¨ <strong>è¿‡æ»¤ç´¢å¼•æ¯å—çš„å¤§å°</strong></td>\n<td>ç”¨äºåŠ é€Ÿæ¶ˆæ¯å®šä½å’Œè¯»å–ï¼Œå½±å“å†…å­˜ä½¿ç”¨å’Œæ£€ç´¢æ•ˆç‡</td>\n</tr>\n<tr>\n<td><strong>Initial cluster size</strong></td>\n<td><code>x-initial-cluster-size</code></td>\n<td>æ•´æ•°</td>\n<td>æµåœ¨åˆ›å»ºæ—¶çš„ <strong>æœ€å°èŠ‚ç‚¹æ•°</strong></td>\n<td>ä¿è¯æµçš„å¤åˆ¶å’Œé«˜å¯ç”¨æ€§</td>\n</tr>\n<tr>\n<td><strong>Leader locator</strong></td>\n<td><code>x-queue-leader-locator</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>client-local</code>ã€<code>balanced</code>ï¼‰</td>\n<td>è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜æµæ—¶ï¼Œä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™</td>\n<td><code>client-local</code>ï¼šå®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸º Leaderï¼ˆé»˜è®¤ï¼‰<br><code>balanced</code>ï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡ Leader åˆ†å¸ƒï¼Œç”¨äºä¼˜åŒ– HA</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Classic Queue vs Stream Queue Feature Matrix</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Feature</th>\n<th>ä¸­æ–‡å«ä¹‰</th>\n<th>Classic queues</th>\n<th>Stream queues</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Non-durable queues</td>\n<td>éæŒä¹…åŒ–é˜Ÿåˆ—</td>\n<td>yes</td>\n<td>no</td>\n<td>Stream é˜Ÿåˆ—æ€»æ˜¯æŒä¹…åŒ–ï¼Œä¸æ”¯æŒéæŒä¹…åŒ–</td>\n</tr>\n<tr>\n<td>Exclusivity</td>\n<td>ç‹¬å é˜Ÿåˆ—</td>\n<td>yes</td>\n<td>no</td>\n<td>Classic é˜Ÿåˆ—æ”¯æŒç‹¬å ï¼ŒStream é˜Ÿåˆ—ä¸æ”¯æŒç‹¬å </td>\n</tr>\n<tr>\n<td>Per message persistence</td>\n<td>æ¶ˆæ¯çº§æŒä¹…åŒ–</td>\n<td>per message</td>\n<td>always</td>\n<td>Stream é˜Ÿåˆ—çš„æ¶ˆæ¯æ€»æ˜¯æŒä¹…åŒ–</td>\n</tr>\n<tr>\n<td>Membership changes</td>\n<td>èŠ‚ç‚¹æˆå‘˜å˜æ›´</td>\n<td>no</td>\n<td>manual</td>\n<td>Stream é˜Ÿåˆ—èŠ‚ç‚¹å˜æ›´éœ€è¦æ‰‹åŠ¨ç®¡ç†</td>\n</tr>\n<tr>\n<td>TTL</td>\n<td>æ¶ˆæ¯å­˜æ´»æ—¶é—´</td>\n<td>yes</td>\n<td>no (but see Retention)</td>\n<td>Stream é˜Ÿåˆ—æ²¡æœ‰æ¶ˆæ¯ TTLï¼Œä½†å¯é€šè¿‡ Retention æ§åˆ¶è¿‡æœŸ</td>\n</tr>\n<tr>\n<td>Queue length limits</td>\n<td>é˜Ÿåˆ—é•¿åº¦é™åˆ¶</td>\n<td>yes</td>\n<td>no (but see Retention)</td>\n<td>Stream é˜Ÿåˆ—æ²¡æœ‰å›ºå®šé•¿åº¦é™åˆ¶ï¼Œé€šè¿‡ Retention æ§åˆ¶æ•°æ®é‡</td>\n</tr>\n<tr>\n<td>Keeps messages in memory</td>\n<td>æ¶ˆæ¯å†…å­˜ä¿å­˜</td>\n<td>see Classic Queues</td>\n<td>never</td>\n<td>Stream é˜Ÿåˆ—æ¶ˆæ¯ä¸ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œåªå†™å…¥ç£ç›˜</td>\n</tr>\n<tr>\n<td>Message priority</td>\n<td>æ¶ˆæ¯ä¼˜å…ˆçº§</td>\n<td>yes</td>\n<td>no</td>\n<td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§</td>\n</tr>\n<tr>\n<td>Consumer priority</td>\n<td>æ¶ˆè´¹è€…ä¼˜å…ˆçº§</td>\n<td>yes</td>\n<td>no</td>\n<td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¶ˆè´¹è€…ä¼˜å…ˆçº§</td>\n</tr>\n<tr>\n<td>Dead letter exchanges</td>\n<td>æ­»ä¿¡äº¤æ¢æœº</td>\n<td>yes</td>\n<td>no</td>\n<td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ­»ä¿¡äº¤æ¢æœº</td>\n</tr>\n<tr>\n<td>Adheres to policies</td>\n<td>éµå¾ªç­–ç•¥</td>\n<td>yes</td>\n<td>yes (see Retention)</td>\n<td>Stream é˜Ÿåˆ—æ”¯æŒç­–ç•¥ï¼Œä½†ä¸»è¦é€šè¿‡ Retention æ§åˆ¶è¡Œä¸º</td>\n</tr>\n<tr>\n<td>Reacts to memory alarms</td>\n<td>å†…å­˜å‘Šè­¦å“åº”</td>\n<td>yes</td>\n<td>no (uses minimal RAM)</td>\n<td>Stream é˜Ÿåˆ—ä½¿ç”¨æœ€å°å†…å­˜ï¼Œä¸è§¦å‘å†…å­˜å‘Šè­¦</td>\n</tr>\n<tr>\n<td>Poison message handling</td>\n<td>æ¯’æ¶ˆæ¯å¤„ç†</td>\n<td>no</td>\n<td>no</td>\n<td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¯’æ¶ˆæ¯å¤„ç†</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å¯ä»¥æ¿€æ´»<code>æµæ’ä»¶</code>æ¥ä½¿ç”¨æµçš„ç‰¹æœ‰åŠŸèƒ½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmq-plugins <span class=\"built_in\">enable</span> rabbitmq_stream rabbitmq_stream_management</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¿€æ´»<code>æµæ’ä»¶</code>åï¼ŒStreamé˜Ÿåˆ—çš„æ“ä½œæ–¹å¼å¯ä»¥æ›´é«˜çº§ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href=\"https://www.rabbitmq.com/tutorials/tutorial-two-java-stream\">å®˜æ–¹æ–‡æ¡£</a>ï¼Œä½œè€…åœ¨<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo/rabbitmq-stream\">Java Client ç¤ºä¾‹</a>ä¸­ä¹Ÿç»™å‡ºäº†ç¤ºä¾‹ä»£ç ã€‚</p>\n</li>\n</ul>\n<h3 id=\"è¶…çº§æµ-Super-Streams\">è¶…çº§æµ(Super Streams)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¶…çº§æµï¼ˆSuper streamsï¼‰ æ˜¯ä¸€ç§é€šè¿‡å°†ä¸€ä¸ªå¤§çš„æµåˆ†åŒºæˆæ›´å°çš„æµæ¥å®ç°æ‰©å±•çš„æ–¹å¼ã€‚å®ƒä»¬ä¸ å•ä¸ªæ¶ˆè´¹è€…ï¼ˆSingle Active Consumerï¼‰ é›†æˆï¼Œä»¥åœ¨åˆ†åŒºå†…ä¿æŒæ¶ˆæ¯é¡ºåºã€‚è¶…çº§æµä» RabbitMQ 3.11 å¼€å§‹å¯ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªè¶…çº§æµæ˜¯ç”±å¤šä¸ªæ™®é€šæµç»„æˆçš„é€»è¾‘æµã€‚å®ƒæ˜¯ä¸€ç§é€šè¿‡ RabbitMQ Streams æ¥æ‰©å±•å‘å¸ƒå’Œæ¶ˆè´¹çš„æ–¹æ³•ï¼šä¸€ä¸ªå¤§å‹é€»è¾‘æµè¢«åˆ’åˆ†æˆå¤šä¸ªåˆ†åŒºæµï¼Œå°†å­˜å‚¨å’Œæµé‡åˆ†æ•£åˆ°å¤šä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¶…çº§æµä¾ç„¶æ˜¯ä¸€ä¸ªé€»è¾‘å®ä½“ï¼šç”±äºå®¢æˆ·ç«¯åº“çš„æ™ºèƒ½åŒ–å¤„ç†ï¼Œåº”ç”¨ç¨‹åºä¼šæŠŠå®ƒè§†ä¸ºä¸€ä¸ªâ€œå¤§å‹â€æµã€‚è¶…çº§æµçš„æ‹“æ‰‘ç»“æ„åŸºäº AMQP 0.9.1 æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯äº¤æ¢æœºï¼ˆexchangeï¼‰ã€é˜Ÿåˆ—ï¼ˆqueueï¼‰å’Œå®ƒä»¬ä¹‹é—´çš„ç»‘å®šï¼ˆbindingï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ä»¥ä½¿ç”¨ä»»ä½• AMQP 0.9.1 åº“æˆ–ç®¡ç†æ’ä»¶åˆ›å»ºè¶…çº§æµçš„æ‹“æ‰‘ã€‚å®ƒéœ€è¦åˆ›å»ºä¸€ä¸ªç›´è¿äº¤æ¢æœºï¼ˆdirect exchangeï¼‰ã€åˆ†åŒºæµï¼ˆpartition streamsï¼‰ï¼Œå¹¶å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ç®¡ç†æ§åˆ¶å°åˆ›å»ºè¶…çº§æµ<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/j2G1HC.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤åˆ›å»ºè¶…çº§æµï¼Œä»¥ä¸‹æ˜¯å¦‚ä½•ç”¨å‘½ä»¤åˆ›å»ºä¸€ä¸ªåŒ…å« 3 ä¸ªåˆ†åŒºçš„è¶…çº§æµï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-streams add_super_stream [-p &lt;vhost&gt;] &lt;stream-name&gt; [--partitions &lt;number&gt;]</span></span><br><span class=\"line\">rabbitmq-streams add_super_stream -p /vtest sq_3 --partitions 3</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>åˆ›å»ºçš„Stream<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/4py5OE.png\" alt=\"\"><br>\nåˆ›å»ºçš„ Exchangeï¼Œåç§° sq_3<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/EwfTRM.png\" alt=\"\"><br>\nç»‘å®šå…³ç³»<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/NErhQX.png\" alt=\"\"></p>\n</blockquote>\n<h2 id=\"é˜Ÿåˆ—ç±»å‹æ‰©å±•\">é˜Ÿåˆ—ç±»å‹æ‰©å±•</h2>\n<h3 id=\"æ‡’é˜Ÿåˆ—\">æ‡’é˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»3.6.xç‰ˆæœ¬åˆ°3.12.xç‰ˆæœ¬ï¼ŒRabbitMQæä¾›äº†ä¸€ç§é’ˆå¯¹Classic Queueçš„ä¼˜åŒ–é…ç½®ï¼Œ<code>lazy-mode</code>ï¼Œ<a href=\"https://www.rabbitmq.com/docs/lazy-queues\">æ‡’å¯¹åˆ—</a>ã€‚æ‡’é˜Ÿåˆ—ä¼šå°½å¯èƒ½æ—©çš„å°†æ¶ˆæ¯å†…å®¹ä¿å­˜åˆ°ç¡¬ç›˜å½“ä¸­ï¼Œå¹¶ä¸”åªæœ‰åœ¨ç”¨æˆ·è¯·æ±‚åˆ°æ—¶ï¼Œæ‰ä¸´æ—¶ä»ç¡¬ç›˜åŠ è½½åˆ°RAMå†…å­˜å½“ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQæ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œä¼šä¿å­˜åˆ°å†…å­˜ä»¥ä¾¿ä½¿ç”¨ï¼ŒåŒæ—¶æŠŠæ¶ˆæ¯å†™åˆ°ç¡¬ç›˜ã€‚ä½†æ˜¯ï¼Œæ¶ˆæ¯å†™å…¥ç¡¬ç›˜çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¼šé˜»å¡é˜Ÿåˆ—çš„ã€‚RabbitMQè™½ç„¶é’ˆå¯¹å†™å…¥ç¡¬ç›˜é€Ÿåº¦åšäº†å¾ˆå¤šç®—æ³•ä¼˜åŒ–ï¼Œä½†æ˜¯åœ¨é•¿é˜Ÿåˆ—ä¸­ï¼Œä¾ç„¶è¡¨ç°ä¸æ˜¯å¾ˆç†æƒ³ï¼Œæ‰€ä»¥å°±æœ‰äº†æ‡’é˜Ÿåˆ—çš„å‡ºç°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‡’é˜Ÿåˆ—ä¼šå°è¯•å°½å¯èƒ½æ—©çš„æŠŠæ¶ˆæ¯å†™åˆ°ç¡¬ç›˜ä¸­ã€‚è¿™æ„å‘³ç€åœ¨æ­£å¸¸æ“ä½œçš„å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒRAMä¸­è¦ä¿å­˜çš„æ¶ˆæ¯è¦å°‘å¾—å¤šã€‚å½“ç„¶ï¼Œè¿™æ˜¯ä»¥å¢åŠ ç£ç›˜IOä¸ºä»£ä»·çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‡’é˜Ÿåˆ—é€‚åˆæ¶ˆæ¯é‡å¤§ä¸”é•¿æœŸæœ‰å †ç§¯çš„é˜Ÿåˆ—ï¼Œå¯ä»¥å‡å°‘å†…å­˜ä½¿ç”¨ï¼ŒåŠ å¿«æ¶ˆè´¹é€Ÿåº¦ã€‚ä½†æ˜¯è¿™æ˜¯ä»¥å¤§é‡æ¶ˆè€—é›†ç¾¤çš„ç½‘ç»œåŠç£ç›˜IOä¸ºä»£ä»·çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»3.12å¾€åçš„ç‰ˆæœ¬ä¸­ï¼ŒRabbitMQ ä¸å†æ”¯æŒâ€œæƒ°æ€§â€æ¨¡å¼ï¼Œå› ä¸º ç»å…¸é˜Ÿåˆ— å½“å‰çš„ç‰¹æ€§å°±ç±»ä¼¼äºä»¥å‰çš„ æ‡’é˜Ÿåˆ—ã€‚</p>\n</li>\n</ul>\n<h3 id=\"æ­»ä¿¡é˜Ÿåˆ—\">æ­»ä¿¡é˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com/docs/dlx\">æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead Letter Queueï¼‰</a>ï¼Œæ–°ç‰ˆä¸­å«åš æ­»ä¿¡äº¤æ¢æœºï¼ˆDead Letter Exchange, DLXï¼‰ï¼Œæ˜¯RabbitMQå¯¹äºæœªèƒ½æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯è¿›è¡Œçš„ä¸€ç§è¡¥æ•‘æœºåˆ¶ï¼Œç”¨äºä¿å­˜æ— æ³•è¢«æ­£å¸¸å¤„ç†çš„æ¶ˆæ¯ã€‚å½“æ¶ˆæ¯è¢«æ¶ˆè´¹è€…å¤„ç†å¤±è´¥æ—¶ï¼ŒRabbitMQä¼šå°†æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­»ä¿¡é˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„é˜Ÿåˆ—ï¼ŒåŒæ ·å¯ä»¥åœ¨é˜Ÿåˆ—ä¸Šå£°æ˜æ¶ˆè´¹è€…ï¼Œç»§ç»­å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹å¤„ç†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼ŒRabbitMQä¼šå°†ä¸€ä¸ªæ­£å¸¸æ¶ˆæ¯è½¬æˆæ­»ä¿¡</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆMessage rejectionï¼‰\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">ç”± AMQP 1.0 æ¥æ”¶ç«¯ä½¿ç”¨ rejected ç»“æœæ‹’ç»</li>\n<li class=\"lvl-6\">ç”± AMQP 0.9.1 æ¶ˆè´¹è€…ä½¿ç”¨ basic.reject æˆ– basic.nackï¼Œå¹¶ä¸”å‚æ•° requeue=false</li>\n</ul>\n</li>\n<li class=\"lvl-4\">æ¶ˆæ¯è¿‡æœŸï¼ˆMessage expirationï¼‰\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">æ¶ˆæ¯è¶…è¿‡å…¶é…ç½®çš„ TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰ åè¿‡æœŸã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">é˜Ÿåˆ—é•¿åº¦è¶…é™ï¼ˆQueue length exceededï¼‰\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ•°é‡æˆ–æ€»å­—èŠ‚æ•°è¾¾åˆ°é…ç½®çš„æœ€å¤§é™åˆ¶åï¼Œè¢«ä¸¢å¼ƒçš„æ¶ˆæ¯ä¼šæ­»ä¿¡åŒ–ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">æŠ•é€’æ¬¡æ•°è¶…é™ï¼ˆä»…é€‚ç”¨äºä»²è£é˜Ÿåˆ— Quorum Queueï¼‰\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">æ¶ˆæ¯çš„æŠ•é€’æ¬¡æ•°è¶…è¿‡äº†ä»²è£é˜Ÿåˆ—ä¸­é…ç½®çš„ delivery-limitã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨åœºæ™¯</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ä½ å¯ä»¥åœ¨é˜Ÿåˆ—ä¸Šé…ç½® æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰ å’Œ æ­»ä¿¡è·¯ç”±é”®ï¼ˆDead Letter Routing Keyï¼‰ã€‚</li>\n<li class=\"lvl-4\">å½“æ¶ˆæ¯æˆä¸ºæ­»ä¿¡æ—¶ï¼Œä¼šè¢« é‡æ–°å‘å¸ƒåˆ° DLXï¼Œè¿™æ ·ä½ å¯ä»¥ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">åšé”™è¯¯æ—¥å¿—è®°å½•</li>\n<li class=\"lvl-6\">è¿›è¡Œå¤±è´¥æ¶ˆæ¯é‡è¯•</li>\n<li class=\"lvl-6\">ç”¨äºç›‘æ§å’Œå‘Šè­¦</li>\n</ul>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ­»ä¿¡äº¤æ¢æœºçš„é…ç½®æ–¹æ³•ï¼ˆHow Dead Lettering is Configuredï¼‰</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åœ¨ RabbitMQ ä¸­ï¼Œä»»ä½•é˜Ÿåˆ—éƒ½å¯ä»¥é€šè¿‡ å®¢æˆ·ç«¯ æˆ–è€… ç­–ç•¥ï¼ˆpoliciesï¼‰ æ¥é…ç½® æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰ã€‚</li>\n<li class=\"lvl-4\">é…ç½®æ—¶ä¸»è¦æ¶‰åŠä¸¤ä¸ªæ ¸å¿ƒå‚æ•°ï¼š</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é…ç½®å‚æ•°å</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>dead-letter-exchange</strong></td>\n<td>æŒ‡å®šç”¨äºæ¥æ”¶æ­»ä¿¡æ¶ˆæ¯çš„ <strong>æ­»ä¿¡äº¤æ¢æœºåç§°</strong></td>\n</tr>\n<tr>\n<td><strong>dead-letter-routing-key</strong></td>\n<td>æŒ‡å®šæ­»ä¿¡æ¶ˆæ¯é‡æ–°å‘å¸ƒæ—¶ä½¿ç”¨çš„ <strong>è·¯ç”±é”®ï¼ˆRouting Keyï¼‰</strong></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>æ­»ä¿¡åœ¨è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—æ—¶ï¼Œä»–çš„ routingkey ä¹Ÿä¼šä¿å­˜ä¸‹æ¥ã€‚ä½†æ˜¯å¦‚æœé…ç½®äº† <code>x-dead-letter-routing-key</code> è¿™ä¸ªå‚æ•°çš„è¯ï¼Œroutingkey å°±ä¼šè¢«æ›¿æ¢ä¸ºé…ç½®çš„è¿™ä¸ªå€¼ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºé˜Ÿåˆ—æ·»åŠ  <code>x-dead-letter-exchange</code> å’Œ <code>x-dead-letter-routing-key</code> å‚æ•°ï¼Œæ¥æŒ‡å®š æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰å’Œ æ­»ä¿¡è·¯ç”±é”®ï¼ˆDead Letter Routing Keyï¼‰ã€‚ä½†æ˜¯è¿™æ ·åšå¾ˆéº»çƒ¦ï¼Œæ¯ä¸ªé˜Ÿåˆ—éƒ½è¦å•ç‹¬é…ç½®ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ç­–ç•¥ï¼ˆpoliciesï¼‰ æ¥ç»Ÿä¸€é…ç½®ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»…æŒ‡å®šæ­»ä¿¡äº¤æ¢æœºï¼Œè¿™é‡Œäº¤æ¢æœºçš„åç§°æ˜¯ my-dlxï¼Œäº¤æ¢æœºè¦æå‰åˆ›å»ºå¥½</span></span><br><span class=\"line\">rabbitmqctl set_policy DLX <span class=\"string\">&quot;.*&quot;</span> <span class=\"string\">&#x27;&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;&#125;&#x27;</span> --apply-to queues --priority 7</span><br><span class=\"line\"><span class=\"comment\"># åŒæ—¶æŒ‡å®š æ­»ä¿¡äº¤æ¢æœº å’Œ è·¯ç”±é”®</span></span><br><span class=\"line\">rabbitmqctl set_policy DLX <span class=\"string\">&quot;.*&quot;</span> <span class=\"string\">&#x27;&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;, &quot;dead-letter-routing-key&quot;:&quot;my-routing-key&quot;&#125;&#x27;</span> --apply-to queues --priority 7</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>éƒ¨åˆ†</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>rabbitmqctl</code></td>\n<td>RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·</td>\n</tr>\n<tr>\n<td><code>set_policy</code></td>\n<td>è®¾ç½®ä¸€ä¸ªç­–ç•¥ï¼ˆPolicyï¼‰ï¼Œç”¨äºåŠ¨æ€é…ç½®äº¤æ¢æœºã€é˜Ÿåˆ—æˆ–ç»‘å®šçš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>DLX</code></td>\n<td>ç­–ç•¥çš„åç§°ï¼Œç”¨æˆ·è‡ªå®šä¹‰ï¼Œä¾‹å¦‚è¿™é‡Œå« <code>DLX</code></td>\n</tr>\n<tr>\n<td><code>&quot;.*&quot;</code></td>\n<td>æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å¯¹è±¡çš„åç§°ã€‚<code>.*</code> è¡¨ç¤ºåŒ¹é… <strong>æ‰€æœ‰é˜Ÿåˆ—</strong>ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“é˜Ÿåˆ—åï¼Œæ¯”å¦‚ <code>^my-queue$</code></td>\n</tr>\n<tr>\n<td><code>&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;, &quot;dead-letter-routing-key&quot;:&quot;my-routing-key&quot;&#125;</code></td>\n<td>ç­–ç•¥å†…å®¹ï¼Œè¿™é‡Œè®¾ç½®äº†æ­»ä¿¡äº¤æ¢æœºåç§°å’Œè·¯ç”±é”®ï¼š<br> - <code>dead-letter-exchange</code>: è®¾ç½®æ­»ä¿¡äº¤æ¢æœºåç§°ä¸º <code>my-dlx</code><br> - <code>dead-letter-routing-key</code>: è®¾ç½®è·¯ç”±é”®ä¸º <code>my-routing-key</code></td>\n</tr>\n<tr>\n<td><code>--apply-to queues</code></td>\n<td>æŒ‡å®šç­–ç•¥ä½œç”¨å¯¹è±¡ä¸º <strong>é˜Ÿåˆ—ï¼ˆqueuesï¼‰</strong>ï¼Œè€Œä¸æ˜¯äº¤æ¢æœºï¼ˆexchangesï¼‰æˆ–ç»‘å®šï¼ˆbindingsï¼‰</td>\n</tr>\n<tr>\n<td><code>--priority 7</code></td>\n<td>ç­–ç•¥çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ã€‚å¤šä¸ªç­–ç•¥ä½œç”¨åœ¨åŒä¸€å¯¹è±¡æ—¶ï¼Œä¼˜å…ˆçº§é«˜çš„ä¼šè¦†ç›–ä½çš„</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œè¿™æ¡å‘½ä»¤åï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Š <code>x-dead-letter-exchange=my-dlx</code> å’Œ <code>x-dead-letter-routing-key=my-routing-key</code> é…ç½®ã€‚</li>\n<li class=\"lvl-4\">é˜Ÿåˆ—ä¸­è¢«æ‹’ç»ã€è¿‡æœŸã€è¶…é•¿æˆ–è¶…è¿‡æŠ•é€’æ¬¡æ•°çš„æ¶ˆæ¯ä¼šè¢«é‡æ–°å‘å¸ƒåˆ° <code>my-dlx</code> äº¤æ¢æœºï¼Œå¹¶ä½¿ç”¨ <code>my-routing-key</code> ä½œä¸ºè·¯ç”±é”®ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ¶ˆæ¯è¢«ä½œä¸ºæ­»ä¿¡è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—åï¼Œä¼šåœ¨Headerå½“ä¸­å¢åŠ â¼€äº›æ¶ˆæ¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x-first-death-queueï¼šè¯¥æ¶ˆæ¯é¦–æ¬¡æˆä¸ºæ­»ä¿¡æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—åç§°</span><br><span class=\"line\">x-first-death-reasonï¼šè¯¥æ¶ˆæ¯é¦–æ¬¡è¢«åˆ¤å®šä¸ºæ­»ä¿¡çš„åŸå› </span><br><span class=\"line\">x-first-death-exchangeï¼šè¯¥æ¶ˆæ¯åœ¨é¦–æ¬¡æˆä¸ºæ­»ä¿¡å‰è¢«å‘å¸ƒåˆ°çš„äº¤æ¢æœºåç§°</span><br><span class=\"line\">x-last-death-queueï¼šè¯¥æ¶ˆæ¯æœ€è¿‘ä¸€æ¬¡æˆä¸ºæ­»ä¿¡æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—åç§°</span><br><span class=\"line\">x-last-death-reasonï¼šè¯¥æ¶ˆæ¯æœ€è¿‘ä¸€æ¬¡è¢«åˆ¤å®šä¸ºæ­»ä¿¡çš„åŸå› </span><br><span class=\"line\">x-last-death-exchangeï¼šè¯¥æ¶ˆæ¯åœ¨æœ€è¿‘ä¸€æ¬¡æˆä¸ºæ­»ä¿¡å‰è¢«å‘å¸ƒåˆ°çš„äº¤æ¢æœºåç§°</span><br></pre></td></tr></table></figure>\n<h3 id=\"å»¶è¿Ÿé˜Ÿåˆ—\">å»¶è¿Ÿé˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆDelayed Message Queueï¼‰: å»¶è¿Ÿé˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„é˜Ÿåˆ—ï¼Œç”¨äºå»¶è¿Ÿæ¶ˆæ¯çš„æŠ•é€’ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQä¸­ï¼Œæ˜¯ä¸å­˜åœ¨å»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½çš„ï¼Œè€Œé€šå¸¸å¦‚æœè¦ç”¨åˆ°å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå°±ä¼šé‡‡ç”¨ <code>TTL</code> + <code>æ­»ä¿¡é˜Ÿåˆ—</code> çš„æ–¹å¼æ¥å®ç°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°åŸç†ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åˆ›å»ºä¸€ä¸ªæ™®é€šé˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®é˜Ÿåˆ—çš„ TTLï¼ˆx-message-ttlï¼‰å‚æ•°ï¼Œä»¥åŠæŒ‡å®šä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—(x-dead-letter-exchange)</li>\n<li class=\"lvl-4\">å½“æ¶ˆæ¯çš„ TTL åˆ°æœŸæ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨ä»å½“å‰é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œå¹¶è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚</li>\n<li class=\"lvl-4\">ä¸ºæ­»ä¿¡é˜Ÿåˆ—åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¤„ç†å»¶è¿Ÿæ¶ˆæ¯ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ä¼˜å…ˆçº§é˜Ÿåˆ—\">ä¼˜å…ˆçº§é˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆPriority Queueï¼‰: RabbitMQ æ”¯æŒä¸ºç»å…¸é˜Ÿåˆ—ï¼ˆclassic queuesï¼‰æ·»åŠ â€œä¼˜å…ˆçº§â€åŠŸèƒ½ã€‚å¯ç”¨â€œä¼˜å…ˆçº§â€åŠŸèƒ½çš„ç»å…¸é˜Ÿåˆ—é€šå¸¸è¢«ç§°ä¸ºâ€œä¼˜å…ˆçº§é˜Ÿåˆ—â€ï¼ˆpriority queuesï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ æ”¯æŒ 1 åˆ° 255 ä¹‹é—´çš„ä¼˜å…ˆçº§å€¼ï¼Œä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨ 1 åˆ° 5 ä¹‹é—´çš„å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼˜å…ˆçº§å€¼è¶Šé«˜ï¼Œä¼šæ¶ˆè€—æ›´å¤šçš„ CPU å’Œå†…å­˜èµ„æºï¼Œå› ä¸º RabbitMQ åœ¨å†…éƒ¨éœ€è¦ä¸ºæ¯ä¸ªä¼˜å…ˆçº§ï¼ˆä» 1 åˆ°æœ€å¤§é…ç½®å€¼ï¼‰ç»´æŠ¤ä¸€ä¸ªå­é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åªæœ‰ç»å…¸é˜Ÿåˆ—æ”¯æŒé€šè¿‡å‚æ•°<code>x-max-priority</code>æŒ‡å®šé˜Ÿåˆ—æ”¯æŒçš„æœ€å¤§ä¼˜å…ˆçº§ï¼Œä¸”ä¸æ”¯æŒ é€šè¿‡ ç­–ç•¥ï¼ˆpoliciesï¼‰ å°†ç»å…¸é˜Ÿåˆ—å£°æ˜ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€šè¿‡å‚æ•° <code>priority</code> æŒ‡å®šæ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€‚æ˜¯çš„ï¼Œæ¶ˆæ¯ä¹Ÿæ˜¯å¯ä»¥è®¾ç½®å‚æ•°çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¼˜å…ˆçº§é˜Ÿåˆ—å¦‚ä½•ä¸æ¶ˆè´¹è€…ååŒå·¥ä½œ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è‹¥æ¶ˆè´¹è€…è¿æ¥åˆ°ä¸€ä¸ª ç©ºé˜Ÿåˆ—ï¼Œç„¶åæ¶ˆæ¯é™†ç»­è¢«å‘å¸ƒï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆæ¯å¯èƒ½ ä¸ä¼š åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼ˆå³åˆšå‘å¸ƒå°±è¢«æ¶ˆè´¹è€…æ¥æ”¶ï¼‰ï¼Œæ­¤æ—¶ä¼˜å…ˆçº§åŠŸèƒ½æ²¡æœ‰æœºä¼šä¸Šåœºã€‚ä¼˜å…ˆçº§æ˜¯åœ¨æ¶ˆæ¯æ’é˜Ÿï¼ˆready æ¶ˆæ¯ï¼‰çŠ¶æ€æ—¶æ‰èƒ½ä½“ç°å…¶ä½œç”¨ã€‚</li>\n<li class=\"lvl-4\">æ¨èåœ¨æ¶ˆè´¹è€…ç«¯ä½¿ç”¨ basic.qos(prefetch) è®¾ç½®ï¼ˆåœ¨ manual ack æ¨¡å¼ä¸‹ï¼‰ï¼Œä»¥é™åˆ¶æ¶ˆè´¹è€…åŒæ—¶å¤„ç†çš„æœªç¡®è®¤æ¶ˆæ¯æ•°ã€‚è¿™æ ·èƒ½è®©ä¼˜å…ˆçº§çš„åˆ†çº§æ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œå› ä¸ºå¦‚æœ prefetch æ•°é‡æœªæ»¡ï¼Œé«˜ä¼˜å…ˆçº§æ¶ˆæ¯å¯ä»¥å…ˆè¢«å–å‡ºã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ³¨æ„äº‹é¡¹</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æœªè®¾ç½® <code>priority</code> çš„æ¶ˆæ¯ ä¼šè¢«å½“ä½œä¼˜å…ˆçº§ 0 å¤„ç†ã€‚è‹¥æ¶ˆæ¯æŒ‡å®šçš„ä¼˜å…ˆçº§å¤§äºé˜Ÿåˆ—çš„æœ€å¤§å€¼ï¼ˆx-max-priorityï¼‰ï¼Œåˆ™è¯¥æ¶ˆæ¯çš„ä¼˜å…ˆçº§å°±æ˜¯<code>x-max-priority</code>ã€‚</li>\n<li class=\"lvl-4\">TTL / æ¶ˆæ¯è¿‡æœŸ (message expiration)ï¼šå³ä½¿è®¾ç½®äº† TTLï¼Œè¿‡æœŸçš„æ¶ˆæ¯åªä¼šåœ¨é˜Ÿåˆ—å¤´è¢«æ£€æŸ¥ã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªä½ä¼˜å…ˆçº§çš„æ¶ˆæ¯åœ¨å‰é¢ä½†è¿˜æ²¡è¿‡æœŸï¼Œè€Œé«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯åœ¨åé¢ï¼Œä½ä¼˜å…ˆçº§çš„æ¶ˆæ¯å¯èƒ½ä¼šé˜»å¡é˜Ÿåˆ—å¤´ï¼Œå¯¼è‡´é«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯è¢«å»¶è¿Ÿã€‚</li>\n<li class=\"lvl-4\">é˜Ÿåˆ—æœ€å¤§é•¿åº¦é™åˆ¶ (max-length)ï¼šå¦‚æœé˜Ÿåˆ—è®¾ç½®äº†æœ€å¤§é•¿åº¦ï¼Œé˜Ÿåˆ—ä¼šä»å¤´éƒ¨ (head) ä¸¢å¼ƒæ¶ˆæ¯ä»¥ç»´æŒé•¿åº¦é™åˆ¶ã€‚è¿™å¯èƒ½å¯¼è‡´é«˜ä¼˜å…ˆçº§æ¶ˆæ¯ä¹Ÿè¢«ä¸¢å¼ƒï¼Œä»è€Œè¿èƒŒç›´è§‰ã€‚</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Queue çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹ Queue(é˜Ÿåˆ—) æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨ RabbitMQ ä¸­ï¼Œé˜Ÿåˆ—ï¼ˆQueueï¼‰ æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨æ¶ˆæ¯çš„ æ•°æ®ç»“æ„ï¼Œæ¶ˆæ¯ä¼šä¸€ç›´ä¿å­˜åœ¨é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°è¢«åº”ç”¨ç¨‹åºæˆ–æœåŠ¡æ¶ˆè´¹ä¸ºæ­¢ã€‚ ç”Ÿäº§è€…ï¼ˆPublisherï¼‰ æŠŠæ¶ˆæ¯æ”¾è¿›é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ã€‚é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šæŒ‰ç…§ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„é¡ºåºè¿›è¡Œæ¶ˆè´¹ã€‚ é˜Ÿåˆ—åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´èµ·åˆ°ç¼“å†²åŒºçš„ä½œç”¨ã€‚ç”Ÿäº§è€…ä¸éœ€è¦çŸ¥é“æ¶ˆè´¹è€…çš„å­˜åœ¨ï¼Œå®ƒä»¬åªéœ€æŠŠæ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ã€‚æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®è‡ªèº«å¤„ç†é€Ÿåº¦ï¼ŒæŒ‰éœ€æ¶ˆè´¹æ¶ˆæ¯ã€‚ RabbitMQ ç›®å‰ æ”¯æŒä¸‰ç§é˜Ÿåˆ—ç±»å‹ï¼š é˜Ÿåˆ—ç±»å‹ æè¿° ç‰¹ç‚¹ å…¸å‹ç”¨é€” Classic Queueï¼ˆç»å…¸é˜Ÿåˆ—ï¼‰ æœ€å¸¸ç”¨çš„é˜Ÿåˆ—ç±»å‹ï¼Œæ¶ˆæ¯æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰é¡ºåºå­˜å‚¨å’Œæ¶ˆè´¹ æ”¯æŒæŒä¹…åŒ–ã€ä¼˜å…ˆçº§ã€TTLã€æ­»ä¿¡ç­‰ å¤§å¤šæ•°å¸¸è§„æ¶ˆæ¯åœºæ™¯ Quorum Queueï¼ˆä»²è£é˜Ÿåˆ—ï¼‰ åŸºäº Raft åè®®çš„é˜Ÿåˆ—ï¼Œç¡®ä¿é«˜å¯ç”¨å’Œæ•°æ®ä¸€è‡´æ€§ å†…ç½®å¤åˆ¶ï¼ˆå‰¯æœ¬æ•°é‡å¯é…ç½®ï¼‰ã€é€‚åˆé«˜å¯é æ€§åœºæ™¯ï¼Œä½†ååé‡ç•¥ä½äºç»å…¸é˜Ÿåˆ— å…³é”®ä»»åŠ¡æ¶ˆæ¯ã€é«˜å¯é æ€§åœºæ™¯ Stream Queueï¼ˆæµå¼é˜Ÿåˆ—ï¼‰ é¢å‘å¤§é‡æ¶ˆæ¯çš„é«˜ååé˜Ÿåˆ—ï¼Œæ”¯æŒæ¶ˆæ¯æŒ‰åç§»é‡è¯»å– ç±»ä¼¼ Kafkaï¼Œå¯éšæœºè®¿é—®å†å²æ¶ˆæ¯ã€é¡ºåºè¯»å–ã€å¯æŒä¹…åŒ–å¤§é‡æ¶ˆæ¯ å¤§æ•°æ®æµã€æ—¥å¿—å¤„ç†ã€äº‹ä»¶æº¯æº Classic Queue(ç»å…¸é˜Ÿåˆ—) RabbitMQ ç»å…¸é˜Ÿåˆ—ï¼ˆåŸå§‹é˜Ÿåˆ—ç±»å‹ï¼‰æ˜¯ä¸€ç§é€šç”¨é˜Ÿåˆ—ç±»å‹ã€‚å®é™…ä¸Šå®ƒæ˜¯åœ¨ 3.8.x ç‰ˆæœ¬ä¹‹å‰å”¯ä¸€çš„é˜Ÿåˆ—ç±»å‹ã€‚ ç»å…¸é˜Ÿåˆ—é€‚ç”¨äºæ•°æ®å®‰å…¨ä¸æ˜¯ä¼˜å…ˆäº‹é¡¹çš„ç”¨ä¾‹ï¼Œå› ä¸ºå­˜å‚¨åœ¨ç»å…¸é˜Ÿåˆ—ä¸­çš„æ•°æ®ä¸ä¼šè¢«å¤åˆ¶ã€‚ ç»å…¸é˜Ÿåˆ—ä½¿ç”¨éå¤åˆ¶çš„ FIFO é˜Ÿåˆ—å®ç°ã€‚ ç»å…¸é˜Ÿåˆ—ä¸é€‚åˆç§¯ç´¯å¤ªå¤šçš„æ¶ˆæ¯ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­ç§¯ç´¯çš„æ¶ˆæ¯å¤ªå¤šäº†ï¼Œä¼šä¸¥é‡å½±å“å®¢æˆ·ç«¯ç”Ÿäº§æ¶ˆæ¯ä»¥åŠæ¶ˆè´¹æ¶ˆæ¯çš„æ€§èƒ½ã€‚å› æ­¤ï¼Œç»å…¸é˜Ÿåˆ—ä¸»è¦ç”¨åœ¨æ•°æ®é‡æ¯”è¾ƒå°ï¼Œå¹¶ä¸”ç”Ÿäº§æ¶ˆæ¯å’Œæ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦æ¯”è¾ƒç¨³å®šçš„ä¸šåŠ¡åœºæ™¯ã€‚æ¯”å¦‚å†…éƒ¨ç³»ç»Ÿä¹‹é—´çš„æœåŠ¡è°ƒç”¨ã€‚ RabbitMQ 4.0 åˆ é™¤äº†å¯¹ç»å…¸é˜Ÿåˆ— version1 çš„æ”¯æŒï¼ŒåŒæ—¶ä¹Ÿä¸å†æ”¯æŒå°† ç»å…¸é˜Ÿåˆ— çš„æ¶ˆæ¯åœ¨èŠ‚ç‚¹é—´å¤åˆ¶ã€‚ å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†) å‚æ•°åç§° é…ç½®å‚æ•°å æ•°æ®ç±»å‹ ä½œç”¨è¯´æ˜ å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯ Auto expire x-expires æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰ é˜Ÿåˆ—åœ¨ æŒ‡å®šæ—¶é—´å†…æ— äººä½¿ç”¨ï¼ˆæ— æ¶ˆè´¹è€…ã€æ— å‘å¸ƒã€æ— è®¿é—®ï¼‰ æ—¶è‡ªåŠ¨åˆ é™¤ ç±»ä¼¼â€œé˜Ÿåˆ—ç©ºé—²è¿‡æœŸæ—¶é—´â€ï¼ŒèŠ‚çœèµ„æº Message TTL x-message-ttl æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰ æ¶ˆæ¯çš„ å­˜æ´»æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´åæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ— ç”¨äºé™åˆ¶æ¶ˆæ¯æ—¶æ•ˆæ€§ï¼Œå¦‚å»¶è¿Ÿæ¶ˆæ¯æˆ–çŸ­æœŸç¼“å­˜ Overflow behaviour x-overflow å­—ç¬¦ä¸²ï¼ˆdrop-head æˆ– reject-publishï¼‰ å½“é˜Ÿåˆ—è¾¾åˆ° æœ€å¤§é•¿åº¦ æˆ– æœ€å¤§å­—èŠ‚æ•° æ—¶çš„è¡Œä¸º - drop-headï¼šä¸¢å¼ƒæœ€æ—©çš„æ¶ˆæ¯ - reject-publishï¼šæ‹’ç»æ–°çš„æ¶ˆæ¯ Single active consumer x-single-active-consumer å¸ƒå°”å€¼ï¼ˆtrue/falseï¼‰ æ˜¯å¦å¯ç”¨ å•æ´»æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ— ç”¨äºä¸¥æ ¼é¡ºåºæ¶ˆè´¹ï¼Œä¿è¯æŸä¸ªæ¶ˆæ¯ä¸ä¼šè¢«å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶å¤„ç† Dead letter exchange (DLX) x-dead-letter-exchange å­—ç¬¦ä¸² æŒ‡å®šé˜Ÿåˆ—çš„ æ­»ä¿¡äº¤æ¢æœºï¼Œç”¨äºæ¥æ”¶æ— æ³•æ¶ˆè´¹æˆ–è¿‡æœŸçš„æ¶ˆæ¯ å¸¸ç”¨äºå¤±è´¥é‡è¯•ã€æ¶ˆæ¯è¡¥å¿åœºæ™¯ Dead letter routing key x-dead-letter-routing-key å­—ç¬¦ä¸² æ¶ˆæ¯è½¬å‘åˆ° DLX æ—¶çš„ è·¯ç”±é”® å¯ä»¥çµæ´»è½¬å‘åˆ°ä¸åŒé˜Ÿåˆ— Max length x-max-length æ•´æ•° é˜Ÿåˆ—ä¸­ æœ€å¤§æ¶ˆæ¯æ¡æ•° è¶…è¿‡æ—¶æŒ‰ç…§ Overflow behaviour å¤„ç† Max length bytes x-max-length-bytes æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰ é˜Ÿåˆ—ä¸­ æ¶ˆæ¯æ€»å­—èŠ‚æ•°ä¸Šé™ è¶…è¿‡æ—¶æŒ‰ç…§ Overflow behaviour å¤„ç†ï¼Œé€‚åˆå¤§æ¶ˆæ¯åœºæ™¯ Maximum priority x-max-priority æ•´æ•° å¯ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—å¯è®¾ç½®çš„ æœ€å¤§ä¼˜å…ˆçº§å€¼ æ¶ˆæ¯ä¼˜å…ˆçº§èŒƒå›´æ˜¯ 0 åˆ°è¿™ä¸ªå€¼ï¼Œä¼˜å…ˆçº§é«˜çš„æ¶ˆæ¯å…ˆè¢«æ¶ˆè´¹ Leader locator x-queue-leader-locator å­—ç¬¦ä¸²ï¼ˆclient-localã€balancedï¼‰ è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—ä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™ client-localï¼ˆé»˜è®¤ï¼‰ï¼šé€‰æ‹©å®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸ºLeader balancedï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡Leaderåˆ†å¸ƒï¼Œç”¨äº HA é˜Ÿåˆ—ä¼˜åŒ– Quorum Queue(ä»²è£é˜Ÿåˆ—) ä»²è£é˜Ÿåˆ—ï¼ˆQuorum Queueï¼‰ æ˜¯ RabbitMQ ä»3.8.0ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„ä¸€ç§ç°ä»£é˜Ÿåˆ—ç±»å‹ï¼Œä¹Ÿæ˜¯ç›®å‰å®˜æ–¹æ¯”è¾ƒæ¨èçš„ä¸€ç§å¯¹åˆ—ç±»å‹ã€‚æœªæ¥æœ‰å¯èƒ½å–ä»£ ç»å…¸é˜Ÿåˆ— æˆä¸ºé»˜è®¤é˜Ÿåˆ—ç±»å‹ã€‚ å…¶åŸºäº Raft å…±è¯†ç®—æ³• å®ç° æŒä¹…åŒ–ã€å¤åˆ¶å’Œé«˜å¯ç”¨ã€‚å®ƒä¿è¯ æ•°æ®å®‰å…¨æ€§ã€å¯é çš„ä¸»èŠ‚ç‚¹é€‰ä¸¾ï¼Œå³ä½¿åœ¨å‡çº§æˆ–é›†ç¾¤æ³¢åŠ¨æœŸé—´ä¹Ÿèƒ½ä¿æŒé«˜å¯ç”¨æ€§ã€‚ ä»²è£é˜Ÿåˆ—æ”¯æŒ æ¯’æ¶ˆæ¯å¤„ç†ã€è‡³å°‘ä¸€æ¬¡æ­»ä¿¡æŠ•é€’ ä»¥åŠ AMQP ä¿®æ”¹ï¼ˆAMQP.modifiedï¼‰çš„å¤„ç†ç»“æœã€‚ å®ƒé€‚åˆ ä»¥æ•°æ®å®‰å…¨ä¸ºé¦–è¦ç›®æ ‡ çš„åœºæ™¯ã€‚ä¸ç»å…¸é˜Ÿåˆ—ç›¸æ¯”ï¼ŒQuorumæ˜¯ä»¥ç‰ºç‰²å¾ˆå¤šé«˜çº§é˜Ÿåˆ—ç‰¹æ€§ä¸ºä»£ä»·ï¼Œæ¥è¿›ä¸€æ­¥ä¿è¯æ¶ˆæ¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é«˜å¯é ã€‚ ä»²è£é˜Ÿåˆ—ï¼ˆQuorum Queueï¼‰çš„ Durability åªèƒ½è®¾ç½®ä¸º Durable(true)ã€‚Auto delete åªèƒ½ä¸º No(false)ã€‚ å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†) å‚æ•°åç§° é…ç½®å‚æ•°å æ•°æ®ç±»å‹ ä½œç”¨è¯´æ˜ å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯ Auto expire x-expires æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰ é˜Ÿåˆ—åœ¨æŒ‡å®šæ—¶é—´å†…æ— äººä½¿ç”¨ï¼ˆæ— æ¶ˆè´¹è€…ã€æ— å‘å¸ƒã€æ— è®¿é—®ï¼‰æ—¶è‡ªåŠ¨åˆ é™¤ èŠ‚çœèµ„æºï¼Œé˜Ÿåˆ—ç©ºé—²è¿‡æœŸæ—¶é—´ Message TTL x-message-ttl æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰ é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„ç”Ÿå­˜æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´åæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–è½¬å…¥æ­»ä¿¡é˜Ÿåˆ— æ§åˆ¶æ¶ˆæ¯æ—¶æ•ˆæ€§ Overflow behaviour x-overflow å­—ç¬¦ä¸²ï¼ˆdrop-head æˆ– reject-publishï¼‰ å½“é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦æ—¶çš„å¤„ç†æ–¹å¼ drop-headï¼šä¸¢å¼ƒæœ€æ—©æ¶ˆæ¯ï¼Œreject-publishï¼šæ‹’ç»æ–°æ¶ˆæ¯ Single active consumer x-single-active-consumer å¸ƒå°”å€¼ï¼ˆtrue/falseï¼‰ æ˜¯å¦å¯ç”¨å•æ´»æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ— ä¿è¯ä¸¥æ ¼é¡ºåºæ¶ˆè´¹ Dead letter exchange (DLX) x-dead-letter-exchange å­—ç¬¦ä¸² æŒ‡å®šé˜Ÿåˆ—çš„æ­»ä¿¡äº¤æ¢æœºï¼Œç”¨äºæ¥æ”¶æ— æ³•æ¶ˆè´¹æˆ–è¿‡æœŸçš„æ¶ˆæ¯ ä¸ DLX é…åˆä½¿ç”¨å¤„ç†å¤±è´¥æ¶ˆæ¯ Dead letter routing key x-dead-letter-routing-key å­—ç¬¦ä¸² æ¶ˆæ¯è½¬å‘åˆ° DLX æ—¶çš„è·¯ç”±é”® çµæ´»è·¯ç”±æ­»ä¿¡æ¶ˆæ¯ Max length x-max-length æ•´æ•° é˜Ÿåˆ—ä¸­æœ€å¤§æ¶ˆæ¯æ¡æ•° è¶…è¿‡æ—¶æŒ‰ Overflow behaviour å¤„ç† Max length bytes x-max-length-bytes æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰ é˜Ÿåˆ—æ¶ˆæ¯æ€»å­—èŠ‚æ•°ä¸Šé™ è¶…è¿‡æ—¶æŒ‰ Overflow behaviour å¤„ç† Delivery limit x-delivery-limit æ•´æ•° æ¶ˆæ¯å…è®¸æŠ•é€’çš„æœ€å¤§æ¬¡æ•°ï¼Œè¶…è¿‡åå˜ä¸ºæ­»ä¿¡ æ§åˆ¶æ¶ˆæ¯é‡è¯•æ¬¡æ•° Initial cluster size x-quorum-initial-group-size æ•´æ•° é˜Ÿåˆ—åœ¨åˆ›å»ºæ—¶éœ€è¦çš„æœ€å°èŠ‚ç‚¹æ•° ç”¨äºä¿è¯ä»²è£é˜Ÿåˆ—çš„é«˜å¯ç”¨æ€§ Target cluster size x-quorum-target-group-size æ•´æ•° é˜Ÿåˆ—è¿è¡Œæ—¶çš„ç›®æ ‡èŠ‚ç‚¹æ•° å½“é›†ç¾¤èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œä»²è£é˜Ÿåˆ—ä¼šå°è¯•è°ƒæ•´å‰¯æœ¬æ•°é‡ Dead letter strategy x-dead-letter-strategy å­—ç¬¦ä¸²ï¼ˆat-most-onceã€at-least-onceï¼‰ è®¾ç½®ä»²è£é˜Ÿåˆ—çš„æ­»ä¿¡å¤„ç†ç­–ç•¥ ä»…é€‚ç”¨äº Quorum Queueã€‚at-most-onceï¼ˆé»˜è®¤ï¼‰ï¼šæ¶ˆæ¯æœ€å¤šæŠ•é€’ä¸€æ¬¡ï¼Œå¯èƒ½ä¸¢å¤±ã€‚at-least-onceï¼šç¡®ä¿æ¶ˆæ¯è‡³å°‘æŠ•é€’ä¸€æ¬¡ï¼Œå¿…é¡»å°† Overflow behaviour è®¾ç½®ä¸º reject-publishï¼Œå¦åˆ™å›é€€åˆ° at-most-onceã€‚ Leader locator x-queue-leader-locator å­—ç¬¦ä¸²ï¼ˆclient-localã€balancedï¼‰ è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—ä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™ client-localï¼šé€‰æ‹©å®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸º Leader balancedï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡ Leader åˆ†å¸ƒ Quorum Queues å’Œ Classic Queues çš„åŠŸèƒ½å¯¹æ¯”å¦‚ä¸‹ï¼š Feature ä¸­æ–‡å«ä¹‰ Classic queues Quorum queues è¯´æ˜ Non-durable queues éæŒä¹…åŒ–é˜Ÿåˆ— yes no Quorum queues æ€»æ˜¯æŒä¹…åŒ–ï¼Œä¸æ”¯æŒéæŒä¹…åŒ– Message replication æ¶ˆæ¯å¤åˆ¶ no yes Quorum queues å†…ç½®æ¶ˆæ¯å¤åˆ¶ï¼ŒClassic queues éœ€é•œåƒç­–ç•¥ Exclusivity ç‹¬å é˜Ÿåˆ— yes no Classic queues æ”¯æŒç‹¬å é˜Ÿåˆ—ï¼ŒQuorum queues ä¸æ”¯æŒç‹¬å  Per message persistence æ¶ˆæ¯çº§æŒä¹…åŒ– per message always Quorum queues æ¶ˆæ¯æ€»æ˜¯æŒä¹…åŒ– Membership changes èŠ‚ç‚¹æˆå‘˜å˜æ›´ no semi-automatic Quorum queues èŠ‚ç‚¹å˜åŒ–æ—¶åŠè‡ªåŠ¨å¤„ç†å¤åˆ¶ Message TTL (Time-To-Live) æ¶ˆæ¯å­˜æ´»æ—¶é—´ yes yes ä¸¤è€…éƒ½æ”¯æŒæ¶ˆæ¯è¿‡æœŸæ—¶é—´ Queue TTL é˜Ÿåˆ—å­˜æ´»æ—¶é—´ yes partially Quorum queues çš„ lease ä¸ä¼šå› é‡æ–°å£°æ˜è€Œç»­æœŸ Queue length limits é˜Ÿåˆ—é•¿åº¦é™åˆ¶ yes yes Quorum queues æ”¯æŒé•¿åº¦é™åˆ¶ï¼Œä½† x-overflow=reject-publish-dlx ä¸æ”¯æŒ Keeps messages in memory æ¶ˆæ¯å†…å­˜ä¿å­˜ see Classic Queues never Quorum queues æ¶ˆæ¯æ€»æ˜¯å†™å…¥ç£ç›˜ï¼Œä¸ä¿ç•™åœ¨å†…å­˜ Message priority æ¶ˆæ¯ä¼˜å…ˆçº§ yes yes æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§ Single Active Consumer å•æ´»æ¶ˆè´¹è€… yes yes æ”¯æŒå•æ´»æ¶ˆè´¹è€… Consumer exclusivity ç‹¬å æ¶ˆè´¹è€… yes no Quorum queues ä¸æ”¯æŒç‹¬å æ¶ˆè´¹è€…ï¼Œéœ€ä½¿ç”¨ Single Active Consumer Consumer priority æ¶ˆè´¹è€…ä¼˜å…ˆçº§ yes yes æ”¯æŒæ¶ˆè´¹è€…ä¼˜å…ˆçº§ Dead letter exchanges æ­»ä¿¡äº¤æ¢æœº yes yes æ”¯æŒæ­»ä¿¡äº¤æ¢æœº Adheres to policies éµå¾ªç­–ç•¥ yes yes æ”¯æŒç­–ç•¥ï¼Œä½† Quorum queues çš„éƒ¨åˆ†ç­–ç•¥è¡Œä¸ºä¸åŒ Poison message handling æ¯’æ¶ˆæ¯å¤„ç† no yes Quorum queues æ”¯æŒæ¯’æ¶ˆæ¯å¤„ç† Server-named queues æœåŠ¡å™¨è‡ªåŠ¨å‘½åé˜Ÿåˆ— yes no Quorum queues ä¸æ”¯æŒæœåŠ¡å™¨è‡ªåŠ¨å‘½åé˜Ÿåˆ— Stream(æµ) Stream æ˜¯RabbitMQè‡ª 3.9.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ç§æ–°çš„æ•°æ®é˜Ÿåˆ—ç±»å‹ã€‚è¿™ç§é˜Ÿåˆ—ç±»å‹çš„æ¶ˆæ¯æ˜¯æŒä¹…åŒ–åˆ°ç£ç›˜å¹¶ä¸”å…·å¤‡åˆ†å¸ƒå¼å¤‡ä»½çš„ï¼Œæ›´é€‚åˆäºæ¶ˆè´¹è€…å¤šï¼Œè¯»æ¶ˆæ¯éå¸¸é¢‘ç¹çš„åœºæ™¯ã€‚ Stream çš„æ ¸å¿ƒæ˜¯ä»¥append-onlyåªæ·»åŠ çš„æ—¥å¿—æ¥è®°å½•æ¶ˆæ¯ï¼Œæ•´ä½“æ¥è¯´ï¼Œå°±æ˜¯æ¶ˆæ¯å°†ä»¥append-onlyçš„æ–¹å¼æŒä¹…åŒ–åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡è°ƒæ•´æ¯ä¸ªæ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦offsetï¼Œæ¥å®ç°æ¶ˆæ¯çš„å¤šæ¬¡åˆ†å‘ã€‚ Stream ä¸æ”¯æŒæ­»ä¿¡äº¤æ¢æœºï¼Œä¸æ”¯æŒå¤„ç†æ¯’æ¶ˆæ¯ã€‚ å®é™…ä¸Š Stream ä¸å±äºé˜Ÿåˆ—ï¼Œæµï¼ˆStreamsï¼‰ æ˜¯ä¸€ç§ æŒä¹…åŒ–ã€å¯å¤åˆ¶çš„æ•°æ®ç»“æ„ï¼ŒåŠŸèƒ½ä¸Šç±»ä¼¼é˜Ÿåˆ—ï¼šä»ç”Ÿäº§è€…ç¼“å†²æ¶ˆæ¯ä¾›æ¶ˆè´¹è€…è¯»å–ã€‚ä½†å®ƒä¸é˜Ÿåˆ—æœ‰ä¸¤ä¸ªé‡è¦åŒºåˆ«ï¼š å­˜å‚¨æ¨¡å‹ â€“ æµæ˜¯ è¿½åŠ æ—¥å¿—ï¼ˆappend-only logï¼‰ï¼Œæ¶ˆæ¯å¯ä»¥ é‡å¤è¯»å–ç›´åˆ°è¿‡æœŸã€‚ æ¶ˆè´¹æ¨¡å‹ â€“ æµæä¾› éç ´åæ€§æ¶ˆè´¹è¯­ä¹‰ï¼ˆnon-destructive consumer semanticsï¼‰ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å¤šæ¬¡è¯»å–åŒä¸€æ¡æ¶ˆæ¯è€Œä¸ä¼šåˆ é™¤å®ƒã€‚ Stream å§‹ç»ˆæ˜¯æŒä¹…åŒ–å’Œå¤åˆ¶çš„ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚æ¶ˆè´¹è€…å¯ä»¥é€šè¿‡ RabbitMQ å®¢æˆ·ç«¯åº“ æˆ– ä¸“ç”¨äºŒè¿›åˆ¶åè®®æ’ä»¶ è¯»å–æµï¼Œå…¶ä¸­æ’ä»¶æ–¹å¼å¯ä»¥ è®¿é—®æ‰€æœ‰æµç‰¹æ€§ å¹¶æä¾› æœ€ä½³æ€§èƒ½ã€‚åˆç†çš„å®¢æˆ·ç«¯è¿æ¥ç­–ç•¥æœ‰åŠ©äºæå‡ ååé‡å’Œæ•ˆç‡ã€‚ å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†) å‚æ•°åç§° é…ç½®å‚æ•°å æ•°æ®ç±»å‹ ä½œç”¨è¯´æ˜ å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯ Max length bytes x-max-length-bytes æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰ æµä¸­å…è®¸å­˜å‚¨çš„ æœ€å¤§æ•°æ®æ€»å­—èŠ‚æ•° è¶…è¿‡æ—¶æµå°†åœæ­¢æ¥æ”¶æ–°æ¶ˆæ¯ï¼Œé€‚åˆæ§åˆ¶å­˜å‚¨å®¹é‡ Max time retention x-max-age å­—ç¬¦ä¸²ï¼ˆæ—¶é—´å•ä½ï¼Œä¾‹å¦‚ 1h, 30m, 1dï¼‰ è®¾ç½®æµé˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„ æœ€å¤§ä¿ç•™æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´çš„æ¶ˆæ¯ä¼šè¢«åˆ é™¤ æ”¯æŒæ—¶é—´å•ä½ï¼šY=å¹´, M=æœˆ, D=å¤©, h=å°æ—¶, m=åˆ†é’Ÿ, s=ç§’ã€‚ä¾‹å¦‚ &quot;1h&quot; è¡¨ç¤ºåªä¿ç•™æœ€è¿‘ 1 å°æ—¶çš„æ¶ˆæ¯ï¼Œç”¨äºæ§åˆ¶æ•°æ®é‡å’Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ¶ˆæ¯ Max segment size in bytes x-stream-max-segment-size æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰ æµåˆ†æ®µå­˜å‚¨æ—¶çš„ æ¯ä¸ªæ®µçš„æœ€å¤§å­—èŠ‚æ•° æ§åˆ¶å•ä¸ªæ–‡ä»¶æ®µå¤§å°ï¼Œæœ‰åˆ©äº I/O æ€§èƒ½å’Œç®¡ç† Filter size (per chunk) in bytes x-stream-filter-size-bytes æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰ æµå†…éƒ¨ è¿‡æ»¤ç´¢å¼•æ¯å—çš„å¤§å° ç”¨äºåŠ é€Ÿæ¶ˆæ¯å®šä½å’Œè¯»å–ï¼Œå½±å“å†…å­˜ä½¿ç”¨å’Œæ£€ç´¢æ•ˆç‡ Initial cluster size x-initial-cluster-size æ•´æ•° æµåœ¨åˆ›å»ºæ—¶çš„ æœ€å°èŠ‚ç‚¹æ•° ä¿è¯æµçš„å¤åˆ¶å’Œé«˜å¯ç”¨æ€§ Leader locator x-queue-leader-locator å­—ç¬¦ä¸²ï¼ˆclient-localã€balancedï¼‰ è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜æµæ—¶ï¼Œä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™ client-localï¼šå®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸º Leaderï¼ˆé»˜è®¤ï¼‰balancedï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡ Leader åˆ†å¸ƒï¼Œç”¨äºä¼˜åŒ– HA Classic Queue vs Stream Queue Feature Matrix Feature ä¸­æ–‡å«ä¹‰ Classic queues Stream queues è¯´æ˜ Non-durable queues éæŒä¹…åŒ–é˜Ÿåˆ— yes no Stream é˜Ÿåˆ—æ€»æ˜¯æŒä¹…åŒ–ï¼Œä¸æ”¯æŒéæŒä¹…åŒ– Exclusivity ç‹¬å é˜Ÿåˆ— yes no Classic é˜Ÿåˆ—æ”¯æŒç‹¬å ï¼ŒStream é˜Ÿåˆ—ä¸æ”¯æŒç‹¬å  Per message persistence æ¶ˆæ¯çº§æŒä¹…åŒ– per message always Stream é˜Ÿåˆ—çš„æ¶ˆæ¯æ€»æ˜¯æŒä¹…åŒ– Membership changes èŠ‚ç‚¹æˆå‘˜å˜æ›´ no manual Stream é˜Ÿåˆ—èŠ‚ç‚¹å˜æ›´éœ€è¦æ‰‹åŠ¨ç®¡ç† TTL æ¶ˆæ¯å­˜æ´»æ—¶é—´ yes no (but see Retention) Stream é˜Ÿåˆ—æ²¡æœ‰æ¶ˆæ¯ TTLï¼Œä½†å¯é€šè¿‡ Retention æ§åˆ¶è¿‡æœŸ Queue length limits é˜Ÿåˆ—é•¿åº¦é™åˆ¶ yes no (but see Retention) Stream é˜Ÿåˆ—æ²¡æœ‰å›ºå®šé•¿åº¦é™åˆ¶ï¼Œé€šè¿‡ Retention æ§åˆ¶æ•°æ®é‡ Keeps messages in memory æ¶ˆæ¯å†…å­˜ä¿å­˜ see Classic Queues never Stream é˜Ÿåˆ—æ¶ˆæ¯ä¸ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œåªå†™å…¥ç£ç›˜ Message priority æ¶ˆæ¯ä¼˜å…ˆçº§ yes no Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§ Consumer priority æ¶ˆè´¹è€…ä¼˜å…ˆçº§ yes no Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¶ˆè´¹è€…ä¼˜å…ˆçº§ Dead letter exchanges æ­»ä¿¡äº¤æ¢æœº yes no Stream é˜Ÿåˆ—ä¸æ”¯æŒæ­»ä¿¡äº¤æ¢æœº Adheres to policies éµå¾ªç­–ç•¥ yes yes (see Retention) Stream é˜Ÿåˆ—æ”¯æŒç­–ç•¥ï¼Œä½†ä¸»è¦é€šè¿‡ Retention æ§åˆ¶è¡Œä¸º Reacts to memory alarms å†…å­˜å‘Šè­¦å“åº” yes no (uses minimal RAM) Stream é˜Ÿåˆ—ä½¿ç”¨æœ€å°å†…å­˜ï¼Œä¸è§¦å‘å†…å­˜å‘Šè­¦ Poison message handling æ¯’æ¶ˆæ¯å¤„ç† no no Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¯’æ¶ˆæ¯å¤„ç† æˆ‘ä»¬å¯ä»¥æ¿€æ´»æµæ’ä»¶æ¥ä½¿ç”¨æµçš„ç‰¹æœ‰åŠŸèƒ½ 1rabbitmq-plugins enable rabbitmq_stream rabbitmq_stream_management æ¿€æ´»æµæ’ä»¶åï¼ŒStreamé˜Ÿåˆ—çš„æ“ä½œæ–¹å¼å¯ä»¥æ›´é«˜çº§ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œä½œè€…åœ¨Java Client ç¤ºä¾‹ä¸­ä¹Ÿç»™å‡ºäº†ç¤ºä¾‹ä»£ç ã€‚ è¶…çº§æµ(Super Streams) è¶…çº§æµï¼ˆSuper streamsï¼‰ æ˜¯ä¸€ç§é€šè¿‡å°†ä¸€ä¸ªå¤§çš„æµåˆ†åŒºæˆæ›´å°çš„æµæ¥å®ç°æ‰©å±•çš„æ–¹å¼ã€‚å®ƒä»¬ä¸ å•ä¸ªæ¶ˆè´¹è€…ï¼ˆSingle Active Consumerï¼‰ é›†æˆï¼Œä»¥åœ¨åˆ†åŒºå†…ä¿æŒæ¶ˆæ¯é¡ºåºã€‚è¶…çº§æµä» RabbitMQ 3.11 å¼€å§‹å¯ç”¨ã€‚ ä¸€ä¸ªè¶…çº§æµæ˜¯ç”±å¤šä¸ªæ™®é€šæµç»„æˆçš„é€»è¾‘æµã€‚å®ƒæ˜¯ä¸€ç§é€šè¿‡ RabbitMQ Streams æ¥æ‰©å±•å‘å¸ƒå’Œæ¶ˆè´¹çš„æ–¹æ³•ï¼šä¸€ä¸ªå¤§å‹é€»è¾‘æµè¢«åˆ’åˆ†æˆå¤šä¸ªåˆ†åŒºæµï¼Œå°†å­˜å‚¨å’Œæµé‡åˆ†æ•£åˆ°å¤šä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šã€‚ è¶…çº§æµä¾ç„¶æ˜¯ä¸€ä¸ªé€»è¾‘å®ä½“ï¼šç”±äºå®¢æˆ·ç«¯åº“çš„æ™ºèƒ½åŒ–å¤„ç†ï¼Œåº”ç”¨ç¨‹åºä¼šæŠŠå®ƒè§†ä¸ºä¸€ä¸ªâ€œå¤§å‹â€æµã€‚è¶…çº§æµçš„æ‹“æ‰‘ç»“æ„åŸºäº AMQP 0.9.1 æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯äº¤æ¢æœºï¼ˆexchangeï¼‰ã€é˜Ÿåˆ—ï¼ˆqueueï¼‰å’Œå®ƒä»¬ä¹‹é—´çš„ç»‘å®šï¼ˆbindingï¼‰ã€‚ å¯ä»¥ä½¿ç”¨ä»»ä½• AMQP 0.9.1 åº“æˆ–ç®¡ç†æ’ä»¶åˆ›å»ºè¶…çº§æµçš„æ‹“æ‰‘ã€‚å®ƒéœ€è¦åˆ›å»ºä¸€ä¸ªç›´è¿äº¤æ¢æœºï¼ˆdirect exchangeï¼‰ã€åˆ†åŒºæµï¼ˆpartition streamsï¼‰ï¼Œå¹¶å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ã€‚ é€šè¿‡ç®¡ç†æ§åˆ¶å°åˆ›å»ºè¶…çº§æµ ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤åˆ›å»ºè¶…çº§æµï¼Œä»¥ä¸‹æ˜¯å¦‚ä½•ç”¨å‘½ä»¤åˆ›å»ºä¸€ä¸ªåŒ…å« 3 ä¸ªåˆ†åŒºçš„è¶…çº§æµï¼š 12# rabbitmq-streams add_super_stream [-p &lt;vhost&gt;] &lt;stream-name&gt; [--partitions &lt;number&gt;]rabbitmq-streams add_super_stream -p /vtest sq_3 --partitions 3 åˆ›å»ºçš„Stream åˆ›å»ºçš„ Exchangeï¼Œåç§° sq_3 ç»‘å®šå…³ç³» é˜Ÿåˆ—ç±»å‹æ‰©å±• æ‡’é˜Ÿåˆ— ä»3.6.xç‰ˆæœ¬åˆ°3.12.xç‰ˆæœ¬ï¼ŒRabbitMQæä¾›äº†ä¸€ç§é’ˆå¯¹Classic Queueçš„ä¼˜åŒ–é…ç½®ï¼Œlazy-modeï¼Œæ‡’å¯¹åˆ—ã€‚æ‡’é˜Ÿåˆ—ä¼šå°½å¯èƒ½æ—©çš„å°†æ¶ˆæ¯å†…å®¹ä¿å­˜åˆ°ç¡¬ç›˜å½“ä¸­ï¼Œå¹¶ä¸”åªæœ‰åœ¨ç”¨æˆ·è¯·æ±‚åˆ°æ—¶ï¼Œæ‰ä¸´æ—¶ä»ç¡¬ç›˜åŠ è½½åˆ°RAMå†…å­˜å½“ä¸­ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQæ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œä¼šä¿å­˜åˆ°å†…å­˜ä»¥ä¾¿ä½¿ç”¨ï¼ŒåŒæ—¶æŠŠæ¶ˆæ¯å†™åˆ°ç¡¬ç›˜ã€‚ä½†æ˜¯ï¼Œæ¶ˆæ¯å†™å…¥ç¡¬ç›˜çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¼šé˜»å¡é˜Ÿåˆ—çš„ã€‚RabbitMQè™½ç„¶é’ˆå¯¹å†™å…¥ç¡¬ç›˜é€Ÿåº¦åšäº†å¾ˆå¤šç®—æ³•ä¼˜åŒ–ï¼Œä½†æ˜¯åœ¨é•¿é˜Ÿåˆ—ä¸­ï¼Œä¾ç„¶è¡¨ç°ä¸æ˜¯å¾ˆç†æƒ³ï¼Œæ‰€ä»¥å°±æœ‰äº†æ‡’é˜Ÿåˆ—çš„å‡ºç°ã€‚ æ‡’é˜Ÿåˆ—ä¼šå°è¯•å°½å¯èƒ½æ—©çš„æŠŠæ¶ˆæ¯å†™åˆ°ç¡¬ç›˜ä¸­ã€‚è¿™æ„å‘³ç€åœ¨æ­£å¸¸æ“ä½œçš„å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒRAMä¸­è¦ä¿å­˜çš„æ¶ˆæ¯è¦å°‘å¾—å¤šã€‚å½“ç„¶ï¼Œè¿™æ˜¯ä»¥å¢åŠ ç£ç›˜IOä¸ºä»£ä»·çš„ã€‚ æ‡’é˜Ÿåˆ—é€‚åˆæ¶ˆæ¯é‡å¤§ä¸”é•¿æœŸæœ‰å †ç§¯çš„é˜Ÿåˆ—ï¼Œå¯ä»¥å‡å°‘å†…å­˜ä½¿ç”¨ï¼ŒåŠ å¿«æ¶ˆè´¹é€Ÿåº¦ã€‚ä½†æ˜¯è¿™æ˜¯ä»¥å¤§é‡æ¶ˆè€—é›†ç¾¤çš„ç½‘ç»œåŠç£ç›˜IOä¸ºä»£ä»·çš„ã€‚ ä»3.12å¾€åçš„ç‰ˆæœ¬ä¸­ï¼ŒRabbitMQ ä¸å†æ”¯æŒâ€œæƒ°æ€§â€æ¨¡å¼ï¼Œå› ä¸º ç»å…¸é˜Ÿåˆ— å½“å‰çš„ç‰¹æ€§å°±ç±»ä¼¼äºä»¥å‰çš„ æ‡’é˜Ÿåˆ—ã€‚ æ­»ä¿¡é˜Ÿåˆ— æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead Letter Queueï¼‰ï¼Œæ–°ç‰ˆä¸­å«åš æ­»ä¿¡äº¤æ¢æœºï¼ˆDead Letter Exchange, DLXï¼‰ï¼Œæ˜¯RabbitMQå¯¹äºæœªèƒ½æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯è¿›è¡Œçš„ä¸€ç§è¡¥æ•‘æœºåˆ¶ï¼Œç”¨äºä¿å­˜æ— æ³•è¢«æ­£å¸¸å¤„ç†çš„æ¶ˆæ¯ã€‚å½“æ¶ˆæ¯è¢«æ¶ˆè´¹è€…å¤„ç†å¤±è´¥æ—¶ï¼ŒRabbitMQä¼šå°†æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†ã€‚ æ­»ä¿¡é˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„é˜Ÿåˆ—ï¼ŒåŒæ ·å¯ä»¥åœ¨é˜Ÿåˆ—ä¸Šå£°æ˜æ¶ˆè´¹è€…ï¼Œç»§ç»­å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹å¤„ç†ã€‚ æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼ŒRabbitMQä¼šå°†ä¸€ä¸ªæ­£å¸¸æ¶ˆæ¯è½¬æˆæ­»ä¿¡ æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆMessage rejectionï¼‰ ç”± AMQP 1.0 æ¥æ”¶ç«¯ä½¿ç”¨ rejected ç»“æœæ‹’ç» ç”± AMQP 0.9.1 æ¶ˆè´¹è€…ä½¿ç”¨ basic.reject æˆ– basic.nackï¼Œå¹¶ä¸”å‚æ•° requeue=false æ¶ˆæ¯è¿‡æœŸï¼ˆMessage expirationï¼‰ æ¶ˆæ¯è¶…è¿‡å…¶é…ç½®çš„ TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰ åè¿‡æœŸã€‚ é˜Ÿåˆ—é•¿åº¦è¶…é™ï¼ˆQueue length exceededï¼‰ é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ•°é‡æˆ–æ€»å­—èŠ‚æ•°è¾¾åˆ°é…ç½®çš„æœ€å¤§é™åˆ¶åï¼Œè¢«ä¸¢å¼ƒçš„æ¶ˆæ¯ä¼šæ­»ä¿¡åŒ–ã€‚ æŠ•é€’æ¬¡æ•°è¶…é™ï¼ˆä»…é€‚ç”¨äºä»²è£é˜Ÿåˆ— Quorum Queueï¼‰ æ¶ˆæ¯çš„æŠ•é€’æ¬¡æ•°è¶…è¿‡äº†ä»²è£é˜Ÿåˆ—ä¸­é…ç½®çš„ delivery-limitã€‚ ä½¿ç”¨åœºæ™¯ ä½ å¯ä»¥åœ¨é˜Ÿåˆ—ä¸Šé…ç½® æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰ å’Œ æ­»ä¿¡è·¯ç”±é”®ï¼ˆDead Letter Routing Keyï¼‰ã€‚ å½“æ¶ˆæ¯æˆä¸ºæ­»ä¿¡æ—¶ï¼Œä¼šè¢« é‡æ–°å‘å¸ƒåˆ° DLXï¼Œè¿™æ ·ä½ å¯ä»¥ï¼š åšé”™è¯¯æ—¥å¿—è®°å½• è¿›è¡Œå¤±è´¥æ¶ˆæ¯é‡è¯• ç”¨äºç›‘æ§å’Œå‘Šè­¦ æ­»ä¿¡äº¤æ¢æœºçš„é…ç½®æ–¹æ³•ï¼ˆHow Dead Lettering is Configuredï¼‰ åœ¨ RabbitMQ ä¸­ï¼Œä»»ä½•é˜Ÿåˆ—éƒ½å¯ä»¥é€šè¿‡ å®¢æˆ·ç«¯ æˆ–è€… ç­–ç•¥ï¼ˆpoliciesï¼‰ æ¥é…ç½® æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰ã€‚ é…ç½®æ—¶ä¸»è¦æ¶‰åŠä¸¤ä¸ªæ ¸å¿ƒå‚æ•°ï¼š é…ç½®å‚æ•°å è¯´æ˜ dead-letter-exchange æŒ‡å®šç”¨äºæ¥æ”¶æ­»ä¿¡æ¶ˆæ¯çš„ æ­»ä¿¡äº¤æ¢æœºåç§° dead-letter-routing-key æŒ‡å®šæ­»ä¿¡æ¶ˆæ¯é‡æ–°å‘å¸ƒæ—¶ä½¿ç”¨çš„ è·¯ç”±é”®ï¼ˆRouting Keyï¼‰ æ­»ä¿¡åœ¨è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—æ—¶ï¼Œä»–çš„ routingkey ä¹Ÿä¼šä¿å­˜ä¸‹æ¥ã€‚ä½†æ˜¯å¦‚æœé…ç½®äº† x-dead-letter-routing-key è¿™ä¸ªå‚æ•°çš„è¯ï¼Œroutingkey å°±ä¼šè¢«æ›¿æ¢ä¸ºé…ç½®çš„è¿™ä¸ªå€¼ã€‚ åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºé˜Ÿåˆ—æ·»åŠ  x-dead-letter-exchange å’Œ x-dead-letter-routing-key å‚æ•°ï¼Œæ¥æŒ‡å®š æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰å’Œ æ­»ä¿¡è·¯ç”±é”®ï¼ˆDead Letter Routing Keyï¼‰ã€‚ä½†æ˜¯è¿™æ ·åšå¾ˆéº»çƒ¦ï¼Œæ¯ä¸ªé˜Ÿåˆ—éƒ½è¦å•ç‹¬é…ç½®ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ç­–ç•¥ï¼ˆpoliciesï¼‰ æ¥ç»Ÿä¸€é…ç½®ã€‚ 1234# ä»…æŒ‡å®šæ­»ä¿¡äº¤æ¢æœºï¼Œè¿™é‡Œäº¤æ¢æœºçš„åç§°æ˜¯ my-dlxï¼Œäº¤æ¢æœºè¦æå‰åˆ›å»ºå¥½rabbitmqctl set_policy DLX &quot;.*&quot; &#x27;&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;&#125;&#x27; --apply-to queues --priority 7# åŒæ—¶æŒ‡å®š æ­»ä¿¡äº¤æ¢æœº å’Œ è·¯ç”±é”®rabbitmqctl set_policy DLX &quot;.*&quot; &#x27;&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;, &quot;dead-letter-routing-key&quot;:&quot;my-routing-key&quot;&#125;&#x27; --apply-to queues --priority 7 å‚æ•°è¯´æ˜ï¼š éƒ¨åˆ† å«ä¹‰ rabbitmqctl RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…· set_policy è®¾ç½®ä¸€ä¸ªç­–ç•¥ï¼ˆPolicyï¼‰ï¼Œç”¨äºåŠ¨æ€é…ç½®äº¤æ¢æœºã€é˜Ÿåˆ—æˆ–ç»‘å®šçš„å‚æ•° DLX ç­–ç•¥çš„åç§°ï¼Œç”¨æˆ·è‡ªå®šä¹‰ï¼Œä¾‹å¦‚è¿™é‡Œå« DLX &quot;.*&quot; æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å¯¹è±¡çš„åç§°ã€‚.* è¡¨ç¤ºåŒ¹é… æ‰€æœ‰é˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“é˜Ÿåˆ—åï¼Œæ¯”å¦‚ ^my-queue$ &#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;, &quot;dead-letter-routing-key&quot;:&quot;my-routing-key&quot;&#125; ç­–ç•¥å†…å®¹ï¼Œè¿™é‡Œè®¾ç½®äº†æ­»ä¿¡äº¤æ¢æœºåç§°å’Œè·¯ç”±é”®ï¼š - dead-letter-exchange: è®¾ç½®æ­»ä¿¡äº¤æ¢æœºåç§°ä¸º my-dlx - dead-letter-routing-key: è®¾ç½®è·¯ç”±é”®ä¸º my-routing-key --apply-to queues æŒ‡å®šç­–ç•¥ä½œç”¨å¯¹è±¡ä¸º é˜Ÿåˆ—ï¼ˆqueuesï¼‰ï¼Œè€Œä¸æ˜¯äº¤æ¢æœºï¼ˆexchangesï¼‰æˆ–ç»‘å®šï¼ˆbindingsï¼‰ --priority 7 ç­–ç•¥çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ã€‚å¤šä¸ªç­–ç•¥ä½œç”¨åœ¨åŒä¸€å¯¹è±¡æ—¶ï¼Œä¼˜å…ˆçº§é«˜çš„ä¼šè¦†ç›–ä½çš„ æ‰§è¡Œè¿™æ¡å‘½ä»¤åï¼š æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Š x-dead-letter-exchange=my-dlx å’Œ x-dead-letter-routing-key=my-routing-key é…ç½®ã€‚ é˜Ÿåˆ—ä¸­è¢«æ‹’ç»ã€è¿‡æœŸã€è¶…é•¿æˆ–è¶…è¿‡æŠ•é€’æ¬¡æ•°çš„æ¶ˆæ¯ä¼šè¢«é‡æ–°å‘å¸ƒåˆ° my-dlx äº¤æ¢æœºï¼Œå¹¶ä½¿ç”¨ my-routing-key ä½œä¸ºè·¯ç”±é”®ã€‚ æ¶ˆæ¯è¢«ä½œä¸ºæ­»ä¿¡è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—åï¼Œä¼šåœ¨Headerå½“ä¸­å¢åŠ â¼€äº›æ¶ˆæ¯ã€‚ 123456x-first-death-queueï¼šè¯¥æ¶ˆæ¯é¦–æ¬¡æˆä¸ºæ­»ä¿¡æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—åç§°x-first-death-reasonï¼šè¯¥æ¶ˆæ¯é¦–æ¬¡è¢«åˆ¤å®šä¸ºæ­»ä¿¡çš„åŸå› x-first-death-exchangeï¼šè¯¥æ¶ˆæ¯åœ¨é¦–æ¬¡æˆä¸ºæ­»ä¿¡å‰è¢«å‘å¸ƒåˆ°çš„äº¤æ¢æœºåç§°x-last-death-queueï¼šè¯¥æ¶ˆæ¯æœ€è¿‘ä¸€æ¬¡æˆä¸ºæ­»ä¿¡æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—åç§°x-last-death-reasonï¼šè¯¥æ¶ˆæ¯æœ€è¿‘ä¸€æ¬¡è¢«åˆ¤å®šä¸ºæ­»ä¿¡çš„åŸå› x-last-death-exchangeï¼šè¯¥æ¶ˆæ¯åœ¨æœ€è¿‘ä¸€æ¬¡æˆä¸ºæ­»ä¿¡å‰è¢«å‘å¸ƒåˆ°çš„äº¤æ¢æœºåç§° å»¶è¿Ÿé˜Ÿåˆ— å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆDelayed Message Queueï¼‰: å»¶è¿Ÿé˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„é˜Ÿåˆ—ï¼Œç”¨äºå»¶è¿Ÿæ¶ˆæ¯çš„æŠ•é€’ã€‚ RabbitMQä¸­ï¼Œæ˜¯ä¸å­˜åœ¨å»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½çš„ï¼Œè€Œé€šå¸¸å¦‚æœè¦ç”¨åˆ°å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå°±ä¼šé‡‡ç”¨ TTL + æ­»ä¿¡é˜Ÿåˆ— çš„æ–¹å¼æ¥å®ç°ã€‚ å»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°åŸç†ï¼š åˆ›å»ºä¸€ä¸ªæ™®é€šé˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®é˜Ÿåˆ—çš„ TTLï¼ˆx-message-ttlï¼‰å‚æ•°ï¼Œä»¥åŠæŒ‡å®šä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—(x-dead-letter-exchange) å½“æ¶ˆæ¯çš„ TTL åˆ°æœŸæ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨ä»å½“å‰é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œå¹¶è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚ ä¸ºæ­»ä¿¡é˜Ÿåˆ—åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¤„ç†å»¶è¿Ÿæ¶ˆæ¯ã€‚ ä¼˜å…ˆçº§é˜Ÿåˆ— ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆPriority Queueï¼‰: RabbitMQ æ”¯æŒä¸ºç»å…¸é˜Ÿåˆ—ï¼ˆclassic queuesï¼‰æ·»åŠ â€œä¼˜å…ˆçº§â€åŠŸèƒ½ã€‚å¯ç”¨â€œä¼˜å…ˆçº§â€åŠŸèƒ½çš„ç»å…¸é˜Ÿåˆ—é€šå¸¸è¢«ç§°ä¸ºâ€œä¼˜å…ˆçº§é˜Ÿåˆ—â€ï¼ˆpriority queuesï¼‰ã€‚ RabbitMQ æ”¯æŒ 1 åˆ° 255 ä¹‹é—´çš„ä¼˜å…ˆçº§å€¼ï¼Œä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨ 1 åˆ° 5 ä¹‹é—´çš„å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼˜å…ˆçº§å€¼è¶Šé«˜ï¼Œä¼šæ¶ˆè€—æ›´å¤šçš„ CPU å’Œå†…å­˜èµ„æºï¼Œå› ä¸º RabbitMQ åœ¨å†…éƒ¨éœ€è¦ä¸ºæ¯ä¸ªä¼˜å…ˆçº§ï¼ˆä» 1 åˆ°æœ€å¤§é…ç½®å€¼ï¼‰ç»´æŠ¤ä¸€ä¸ªå­é˜Ÿåˆ—ã€‚ åªæœ‰ç»å…¸é˜Ÿåˆ—æ”¯æŒé€šè¿‡å‚æ•°x-max-priorityæŒ‡å®šé˜Ÿåˆ—æ”¯æŒçš„æœ€å¤§ä¼˜å…ˆçº§ï¼Œä¸”ä¸æ”¯æŒ é€šè¿‡ ç­–ç•¥ï¼ˆpoliciesï¼‰ å°†ç»å…¸é˜Ÿåˆ—å£°æ˜ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚ å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€šè¿‡å‚æ•° priority æŒ‡å®šæ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€‚æ˜¯çš„ï¼Œæ¶ˆæ¯ä¹Ÿæ˜¯å¯ä»¥è®¾ç½®å‚æ•°çš„ã€‚ ä¼˜å…ˆçº§é˜Ÿåˆ—å¦‚ä½•ä¸æ¶ˆè´¹è€…ååŒå·¥ä½œ è‹¥æ¶ˆè´¹è€…è¿æ¥åˆ°ä¸€ä¸ª ç©ºé˜Ÿåˆ—ï¼Œç„¶åæ¶ˆæ¯é™†ç»­è¢«å‘å¸ƒï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆæ¯å¯èƒ½ ä¸ä¼š åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼ˆå³åˆšå‘å¸ƒå°±è¢«æ¶ˆè´¹è€…æ¥æ”¶ï¼‰ï¼Œæ­¤æ—¶ä¼˜å…ˆçº§åŠŸèƒ½æ²¡æœ‰æœºä¼šä¸Šåœºã€‚ä¼˜å…ˆçº§æ˜¯åœ¨æ¶ˆæ¯æ’é˜Ÿï¼ˆready æ¶ˆæ¯ï¼‰çŠ¶æ€æ—¶æ‰èƒ½ä½“ç°å…¶ä½œç”¨ã€‚ æ¨èåœ¨æ¶ˆè´¹è€…ç«¯ä½¿ç”¨ basic.qos(prefetch) è®¾ç½®ï¼ˆåœ¨ manual ack æ¨¡å¼ä¸‹ï¼‰ï¼Œä»¥é™åˆ¶æ¶ˆè´¹è€…åŒæ—¶å¤„ç†çš„æœªç¡®è®¤æ¶ˆæ¯æ•°ã€‚è¿™æ ·èƒ½è®©ä¼˜å…ˆçº§çš„åˆ†çº§æ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œå› ä¸ºå¦‚æœ prefetch æ•°é‡æœªæ»¡ï¼Œé«˜ä¼˜å…ˆçº§æ¶ˆæ¯å¯ä»¥å…ˆè¢«å–å‡ºã€‚ æ³¨æ„äº‹é¡¹ æœªè®¾ç½® priority çš„æ¶ˆæ¯ ä¼šè¢«å½“ä½œä¼˜å…ˆçº§ 0 å¤„ç†ã€‚è‹¥æ¶ˆæ¯æŒ‡å®šçš„ä¼˜å…ˆçº§å¤§äºé˜Ÿåˆ—çš„æœ€å¤§å€¼ï¼ˆx-max-priorityï¼‰ï¼Œåˆ™è¯¥æ¶ˆæ¯çš„ä¼˜å…ˆçº§å°±æ˜¯x-max-priorityã€‚ TTL / æ¶ˆæ¯è¿‡æœŸ (message expiration)ï¼šå³ä½¿è®¾ç½®äº† TTLï¼Œè¿‡æœŸçš„æ¶ˆæ¯åªä¼šåœ¨é˜Ÿåˆ—å¤´è¢«æ£€æŸ¥ã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªä½ä¼˜å…ˆçº§çš„æ¶ˆæ¯åœ¨å‰é¢ä½†è¿˜æ²¡è¿‡æœŸï¼Œè€Œé«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯åœ¨åé¢ï¼Œä½ä¼˜å…ˆçº§çš„æ¶ˆæ¯å¯èƒ½ä¼šé˜»å¡é˜Ÿåˆ—å¤´ï¼Œå¯¼è‡´é«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯è¢«å»¶è¿Ÿã€‚ é˜Ÿåˆ—æœ€å¤§é•¿åº¦é™åˆ¶ (max-length)ï¼šå¦‚æœé˜Ÿåˆ—è®¾ç½®äº†æœ€å¤§é•¿åº¦ï¼Œé˜Ÿåˆ—ä¼šä»å¤´éƒ¨ (head) ä¸¢å¼ƒæ¶ˆæ¯ä»¥ç»´æŒé•¿åº¦é™åˆ¶ã€‚è¿™å¯èƒ½å¯¼è‡´é«˜ä¼˜å…ˆçº§æ¶ˆæ¯ä¹Ÿè¢«ä¸¢å¼ƒï¼Œä»è€Œè¿èƒŒç›´è§‰ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Queue çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹","date_published":"2025-09-20T13:30:05.000Z","tags":["æŠ€æœ¯","rabbitmq","åˆ†å¸ƒå¼","rabbitmq"]},{"id":"https://blog.hanqunfeng.com/2025/09/18/rabbitmq-install-01/","url":"https://blog.hanqunfeng.com/2025/09/18/rabbitmq-install-01/","title":"RabbitMQ çš„å®‰è£…åŠä½¿ç”¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RabbitMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo\">Java Client ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RabbitMQ-ç®€ä»‹\">RabbitMQ ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ æ˜¯ä¸€ä¸ªå¼€æºçš„ æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼ŒåŸºäº AMQPï¼ˆAdvanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰ å®ç°ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ è§£è€¦ã€ç¼“å†²å’Œå¼‚æ­¥å¤„ç†æ¶ˆæ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯è®© <code>ä¸åŒç³»ç»Ÿ</code> æˆ– <code>åº”ç”¨</code> ä¹‹é—´å¯é åœ°ä¼ é€’æ¶ˆæ¯ï¼Œå³ä½¿å‘é€æ–¹æˆ–æ¥æ”¶æ–¹æš‚æ—¶ä¸å¯ç”¨ï¼Œä¹Ÿèƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ çš„æ ¸å¿ƒç‰¹ç‚¹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ ¸å¿ƒç‰¹ç‚¹</th>\n<th>å…·ä½“è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¯é æ€§</strong></td>\n<td>- æ”¯æŒæ¶ˆæ¯ç¡®è®¤ï¼ˆACKï¼‰æœºåˆ¶<br>- æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜<br>- æ”¯æŒäº‹åŠ¡æˆ–ç¡®è®¤æ¨¡å¼ï¼Œä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±</td>\n</tr>\n<tr>\n<td><strong>çµæ´»çš„è·¯ç”±</strong></td>\n<td>- é€šè¿‡ <strong>äº¤æ¢æœºï¼ˆExchangeï¼‰</strong> å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„ <strong>é˜Ÿåˆ—ï¼ˆQueueï¼‰</strong><br>- æ”¯æŒå¤šç§è·¯ç”±ç­–ç•¥ï¼š<br>  â€¢ directï¼šç›´è¿ï¼ŒæŒ‰é˜Ÿåˆ—åè·¯ç”±<br>  â€¢ fanoutï¼šå¹¿æ’­ï¼Œæ‰€æœ‰é˜Ÿåˆ—éƒ½æ”¶åˆ°<br>  â€¢ topicï¼šä¸»é¢˜åŒ¹é…ï¼Œç±»ä¼¼è®¢é˜…æ¨¡å¼<br>  â€¢ headersï¼šæŒ‰æ¶ˆæ¯å¤´åŒ¹é…</td>\n</tr>\n<tr>\n<td><strong>é«˜æ€§èƒ½</strong></td>\n<td>- å†…å­˜é˜Ÿåˆ—å¿«é€Ÿå¤„ç†æ¶ˆæ¯<br>- æ”¯æŒå¼‚æ­¥ IO å’Œ Erlang çš„å¹¶å‘æ¨¡å‹</td>\n</tr>\n<tr>\n<td><strong>å¤šè¯­è¨€æ”¯æŒ</strong></td>\n<td>- å®¢æˆ·ç«¯åº“ä¸°å¯Œï¼šJavaã€Pythonã€Goã€C#ã€Node.js ç­‰<br>- å¯åœ¨å¤šç§å¹³å°å’Œæ¡†æ¶ä¸­ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><strong>é›†ç¾¤ä¸é«˜å¯ç”¨</strong></td>\n<td>- æ”¯æŒé›†ç¾¤æ¨¡å¼<br>- é˜Ÿåˆ—å¯ä»¥é•œåƒåˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä¿è¯é«˜å¯ç”¨</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ çš„æ ¸å¿ƒæ¦‚å¿µ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ¦‚å¿µ</th>\n<th>å«ä¹‰</th>\n<th>ä½œç”¨èŒƒå›´</th>\n<th>ç±»æ¯”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Broker</strong></td>\n<td>ä¸€ä¸ª <strong>RabbitMQ æœåŠ¡å®ä¾‹</strong>ï¼ŒåŒ…å«æ•´ä¸ª AMQP æœåŠ¡ã€ç®¡ç†æ’ä»¶ã€é˜Ÿåˆ—ã€äº¤æ¢æœºç­‰èµ„æº</td>\n<td>è¿è¡Œåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œæˆ–é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹</td>\n<td>ç±»ä¼¼äºæ•°æ®åº“çš„ <strong>å®ä¾‹</strong></td>\n</tr>\n<tr>\n<td><strong>Vhost</strong></td>\n<td>Broker å†…éƒ¨çš„ <strong>é€»è¾‘åˆ†åŒº</strong>ï¼Œç”¨äºéš”ç¦»ä¸åŒçš„é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šç­‰èµ„æº</td>\n<td>ä¸€ä¸ª Broker å¯ä»¥æœ‰å¤šä¸ª vhostï¼Œæ¯ä¸ª vhost å½¼æ­¤éš”ç¦»</td>\n<td>ç±»ä¼¼äºæ•°æ®åº“å®ä¾‹é‡Œçš„ <strong>schema</strong>ï¼Œå®é™…ä½¿ç”¨ä¸­å»ºè®®ä¸ºæ¯ä¸ªä¸šåŠ¡é…ç½®ä¸€ä¸ªç‹¬ç«‹çš„ vhostï¼Œå¹¶ä¸ºæ¯ä¸ªvhostå•ç‹¬é…ç½®ä¸€ä¸ªç®¡ç†ç”¨æˆ·</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Producer</strong></td>\n<td>æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå‘é€æ¶ˆæ¯åˆ° RabbitMQ</td>\n</tr>\n<tr>\n<td><strong>Queue</strong></td>\n<td>é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯çš„åœ°æ–¹</td>\n</tr>\n<tr>\n<td><strong>Consumer</strong></td>\n<td>æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œä»é˜Ÿåˆ—è·å–æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Exchange</strong></td>\n<td>äº¤æ¢æœºï¼Œæ¥æ”¶ Producer çš„æ¶ˆæ¯å¹¶æ ¹æ®è§„åˆ™è·¯ç”±åˆ°é˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td><strong>Binding</strong></td>\n<td>ç»‘å®šï¼Œå®šä¹‰ Exchange ä¸ Queue çš„è·¯ç”±è§„åˆ™</td>\n</tr>\n<tr>\n<td><strong>Message</strong></td>\n<td>æ¶ˆæ¯ï¼ŒRabbitMQ ä¼ é€’çš„æ•°æ®å•å…ƒ</td>\n</tr>\n<tr>\n<td><strong>Connection</strong></td>\n<td>è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¸ RabbitMQ Broker ä¹‹é—´çš„ <strong>TCP è¿æ¥</strong>ï¼Œæ˜¯é€šä¿¡çš„ç‰©ç†é€šé“</td>\n</tr>\n<tr>\n<td><strong>Channel</strong></td>\n<td>é€šé“ï¼ŒConnection å†…éƒ¨çš„ <strong>é€»è¾‘è¿æ¥</strong>ï¼Œè½»é‡çº§ä¸”å¤šè·¯å¤ç”¨ï¼Œä¸€ä¸ªè¿æ¥å¯å¼€å¤šä¸ªé€šé“</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                        â”Œâ”€ Broker (RabbitMQ å®ä¾‹)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class=\"line\">                        â”‚                                 â”‚</span><br><span class=\"line\">                        â”‚    â”Œâ”€â”€â”€â”€â”€ Virtual Host â”€â”€â”€â”€â”€â”   â”‚</span><br><span class=\"line\">        Producer â”€â”€â”€ TCP â”€â”€â”€â”€â”€â”€&gt; Exchange â”€â”€&gt; Queue â”€â”€â”€â”€â”€â”€â”€â”€&gt; TCP â”€â”€ Consumer</span><br><span class=\"line\">(Connection â”€â”€&gt; Channel)â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span><br><span class=\"line\">                        â”‚                                 â”‚</span><br><span class=\"line\">                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/qgdFHL.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ çš„å…¸å‹åº”ç”¨åœºæ™¯</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åº”ç”¨åœºæ™¯</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¼‚æ­¥å¤„ç†</strong></td>\n<td>ç”¨æˆ·è¯·æ±‚ä¸ç›´æ¥å¤„ç†ï¼Œæ¶ˆæ¯å…¥é˜Ÿåç”±åå°å¼‚æ­¥æ¶ˆè´¹ï¼Œä¾‹å¦‚é‚®ä»¶å‘é€ã€å›¾ç‰‡å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>å‰Šå³°å¡«è°·</strong></td>\n<td>ç¼“å†²é«˜å³°æµé‡ï¼Œå¹³æ»‘ç³»ç»Ÿå‹åŠ›</td>\n</tr>\n<tr>\n<td><strong>ç³»ç»Ÿè§£è€¦</strong></td>\n<td>ä¸åŒæœåŠ¡ä¹‹é—´ä¸ç›´æ¥è°ƒç”¨ï¼Œé™ä½è€¦åˆ</td>\n</tr>\n<tr>\n<td><strong>å¹¿æ’­/é€šçŸ¥</strong></td>\n<td>å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œå®ç°å¤šæœåŠ¡åŒæ—¶æ”¶åˆ°æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>æ—¥å¿—æ”¶é›†</strong></td>\n<td>ç»Ÿä¸€æ¥æ”¶ã€åˆ†å‘æ—¥å¿—åˆ°ä¸åŒå¤„ç†ç³»ç»Ÿ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RabbitMQ-4-0-æœ‰å“ªäº›å‡çº§\">RabbitMQ 4.0+ æœ‰å“ªäº›å‡çº§</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç‰¹æ€§æ ‡å¿—ï¼ˆFeature Flagsï¼‰çš„ä¼˜åŒ–ä¸å¼ºåˆ¶æ€§è¦æ±‚</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-3\">\n<p>åœ¨å‡çº§åˆ° 4.0 ä¹‹å‰ï¼Œç”¨æˆ·å¿…é¡»å…ˆå‡çº§åˆ° 3.13.x ç‰ˆæœ¬å¹¶æ‰‹åŠ¨å¯ç”¨æ‰€æœ‰ç¨³å®šçš„ç‰¹æ€§æ ‡å¿—ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>ä» 4.0+ å¼€å§‹ï¼Œå¦‚æœé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ”¯æŒæŸä¸ªå¿…éœ€çš„ç‰¹æ€§æ ‡å¿—ï¼Œç³»ç»Ÿä¼šåœ¨èŠ‚ç‚¹å¯åŠ¨æ—¶è‡ªåŠ¨å¯ç”¨è¯¥æ ‡å¿—ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>AMQP åè®®çš„å¢å¼º</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-3\">\n<p>æ–°å¢äº†å¯¹ AMQP è¿‡æ»¤è¡¨è¾¾å¼ï¼ˆAMQP Filter Expressionsï¼‰Version 1.0 Working Draft 09 çš„æ”¯æŒã€‚</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>MQTT åè®®çš„æ”¹è¿›</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-3\">\n<p>é»˜è®¤çš„ MQTT æœ€å¤§åŒ…å¤§å°ä»ä¹‹å‰çš„ 256 MiB é™ä½åˆ° 16 MiBï¼ŒåŒæ—¶ä»å…è®¸ç”¨æˆ·é€šè¿‡é…ç½®é¡¹Â mqtt.max_packet_size_authenticatedÂ è‡ªå®šä¹‰è¯¥å€¼</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Classicé˜Ÿåˆ—çš„å˜åŒ–</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-3\">\n<p>åˆ é™¤äº†å¯¹ Classicé˜Ÿåˆ— <code>version1</code> çš„æ”¯æŒï¼Œé»˜è®¤å°±æ˜¯ <code>version2</code></p>\n</li>\n<li class=\"lvl-3\">\n<p>ä¸å†æ”¯æŒ Classicé˜Ÿåˆ— çš„é•œåƒåŠŸèƒ½ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Quorum é˜Ÿåˆ— ï¼Œæœªæ¥ä¼šå°† Quorum é˜Ÿåˆ— ä½œä¸ºé»˜è®¤é˜Ÿåˆ—ã€‚</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤çŠ¶æ€ä¸‹åˆ›å»º Quorum é˜Ÿåˆ— å’Œ Stream é˜Ÿåˆ— ä¼šè‡ªåŠ¨å‡çº§ä¸º å¤åˆ¶é˜Ÿåˆ—ï¼ˆé•œåƒï¼‰</p>\n</li>\n</ul>\n<h2 id=\"RabbitMQ-å•æœºå®‰è£…\">RabbitMQ å•æœºå®‰è£…</h2>\n<h3 id=\"å®‰è£…Erlang\">å®‰è£…Erlang</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQæ˜¯åŸºäºErlangè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥å®‰è£…RabbitMQä¹‹å‰éœ€è¦å®‰è£…Erlangè¯­è¨€ç¯å¢ƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯RabbitMQä¸Erlangè¯­è¨€ä¹‹é—´æ˜¯æœ‰ç‰ˆæœ¬å¯¹åº”å…³ç³»çš„ã€‚å‚è€ƒå®˜æ–¹æ–‡æ¡£<a href=\"https://www.rabbitmq.com/docs/which-erlang\">Erlang Version Requirements</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›®å‰RabbitMQæœ€æ–°ç‰ˆæœ¬æ˜¯<code>4.1.4</code>ï¼ŒErlangç‰ˆæœ¬å¯ä»¥é€‰æ‹© <code>27.x</code>ï¼Œ<a href=\"https://github.com/rabbitmq/erlang-rpm/releases\">GitHubä¸‹è½½åœ°å€</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½ el9 çš„ç‰ˆæœ¬ï¼Œå¯¹åº” CentOS 9</span></span><br><span class=\"line\">wget https://github.com/rabbitmq/erlang-rpm/releases/download/v27.3.4.3/erlang-27.3.4.3-1.el9.x86_64.rpm</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rpm -ivh erlang-27.3.4.3-1.el9.x86_64.rpm</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å®‰è£…çš„ç‰ˆæœ¬</span></span><br><span class=\"line\">erl</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç±»ä¼¼äºï¼Œè¿™é‡Œ Erlang/OTP 27 å°±è¡¨ç¤ºå®‰è£…çš„æ˜¯ 27.x ç‰ˆæœ¬</span></span><br><span class=\"line\">Erlang/OTP 27 [erts-15.2.7.2] [<span class=\"built_in\">source</span>] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:1] [jit:ns]</span><br><span class=\"line\"></span><br><span class=\"line\">Eshell V15.2.7.2 (press Ctrl+G to abort, <span class=\"built_in\">type</span> <span class=\"built_in\">help</span>(). <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>)</span><br><span class=\"line\">1&gt; q().  <span class=\"comment\"># é€€å‡ºå‘½ä»¤ï¼Œæ³¨æ„æ˜¯æ‹¬å·åé¢è¿˜æœ‰ä¸€ä¸ªç‚¹ã€‚è¾“å…¥ help(). æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span></span><br><span class=\"line\">ok</span><br></pre></td></tr></table></figure>\n<h3 id=\"å®‰è£…-RabbitMQ\">å®‰è£… RabbitMQ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›®å‰RabbitMQæœ€æ–°ç‰ˆæœ¬æ˜¯<code>4.1.4</code>ï¼Œ<a href=\"https://github.com/rabbitmq/rabbitmq-server/releases\">GitHubä¸‹è½½åœ°å€</a>]</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½ï¼Œnoarch è¡¨ç¤ºæ¶æ„æ— å…³ï¼Œå³ X86_64 å’Œ ARM64 éƒ½å¯ä»¥</span></span><br><span class=\"line\"><span class=\"comment\"># å› ä¸ºæ²¡æœ‰å¯¹åº”çš„ el9 çš„åŒ…ï¼Œæ‰€ä»¥åªèƒ½ç”¨ el8 çš„åŒ…äº†ï¼Œå®é™…ä½¿ç”¨ä¸­æ²¡æœ‰é—®é¢˜ã€‚</span></span><br><span class=\"line\">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v4.1.4/rabbitmq-server-4.1.4-1.el8.noarch.rpm</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rpm -ivh rabbitmq-server-4.1.4-1.el8.noarch.rpm</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class=\"line\">rabbitmq-diagnostics version <span class=\"comment\"># æ— éœ€å¯åŠ¨æœåŠ¡</span></span><br><span class=\"line\"><span class=\"comment\"># RabbitMQ æœåŠ¡å¯åŠ¨åæ–¹å¯æ­£ç¡®è¾“å‡º</span></span><br><span class=\"line\">rabbitmqctl version</span><br></pre></td></tr></table></figure>\n<h3 id=\"RabbitMQ-å¯åŠ¨ä¸åœæ­¢å‘½ä»¤\">RabbitMQ å¯åŠ¨ä¸åœæ­¢å‘½ä»¤</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Erlang VM æ˜¯ Erlang è¯­è¨€è¿è¡Œç¯å¢ƒï¼ŒRabbitMQ åº”ç”¨è¿è¡Œåœ¨ Erlang VM ä¸‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start rabbitmq-server</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…ï¼Œ--detached åå°è¿è¡Œï¼Œä¸åŠ å°±æ˜¯å‰å°è¿è¡Œ</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmq-server -detached</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å•ç‹¬å¯åŠ¨ åº”ç”¨ï¼Œæ­¤æ—¶éœ€è¦ä¿è¯ RabbitMQ æœåŠ¡(Erlang VM) æ­£åœ¨è¿è¡Œï¼Œä¸€èˆ¬é‡å¯ åº”ç”¨ æ—¶ä½¿ç”¨è¯¥å‘½ä»¤</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl start_app</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœæ­¢ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœæ­¢ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl stop rabbitmq-server</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…ï¼Œå•æœºæ¨¡å¼ stopï¼Œé›†ç¾¤æ¨¡å¼ shutdown</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl stop / shutdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å•ç‹¬åœæ­¢ RabbitMQ åº”ç”¨ï¼Œæ­¤æ—¶éœ€è¦ä¿è¯ RabbitMQ æœåŠ¡(Erlang VM) æ­£åœ¨è¿è¡Œï¼Œä¸€èˆ¬é‡å¯ åº”ç”¨ æ—¶ä½¿ç”¨è¯¥å‘½ä»¤</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl stop_app</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹RabbitMQ æœåŠ¡çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl status rabbitmq-server</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl status</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ åœ¨ CentOS 9 (RPM å®‰è£…) çš„ç›®å½•ç»“æ„</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>ç›®å½•è·¯å¾„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é…ç½®æ–‡ä»¶</td>\n<td><code>/etc/rabbitmq</code></td>\n<td><code>rabbitmq.conf</code>ã€<code>advanced.config</code> ç­‰é…ç½®</td>\n</tr>\n<tr>\n<td>æ—¥å¿—æ–‡ä»¶</td>\n<td><code>/var/log/rabbitmq</code></td>\n<td>RabbitMQ è¿è¡Œæ—¥å¿—ï¼Œé»˜è®¤å­˜æ”¾åœ¨è¿™é‡Œ</td>\n</tr>\n<tr>\n<td>æ•°æ®ç›®å½•</td>\n<td><code>/var/lib/rabbitmq/mnesia</code></td>\n<td>æ¶ˆæ¯é˜Ÿåˆ—ã€å…ƒæ•°æ®å­˜å‚¨ç›®å½•</td>\n</tr>\n<tr>\n<td>Erlang Cookie</td>\n<td><code>/var/lib/rabbitmq/.erlang.cookie</code></td>\n<td>Erlang èŠ‚ç‚¹é—´é€šä¿¡çš„ cookie æ–‡ä»¶</td>\n</tr>\n<tr>\n<td>å¯æ‰§è¡Œæ–‡ä»¶</td>\n<td><code>/usr/lib/rabbitmq/bin</code></td>\n<td><code>rabbitmq-server</code>ã€<code>rabbitmqctl</code> ç­‰å‘½ä»¤</td>\n</tr>\n<tr>\n<td>å¯åŠ¨è„šæœ¬</td>\n<td><code>/usr/lib/systemd/system/rabbitmq-server.service</code></td>\n<td>systemd ç®¡ç† RabbitMQ çš„å¯åŠ¨è„šæœ¬</td>\n</tr>\n<tr>\n<td>æ’ä»¶ç›®å½•</td>\n<td><code>/usr/lib/rabbitmq/lib/rabbitmq_server-&lt;version&gt;/plugins</code></td>\n<td>æ‰€æœ‰æ’ä»¶æ–‡ä»¶å­˜æ”¾è·¯å¾„</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æ¿€æ´»Webç®¡ç†æ§åˆ¶å°æ’ä»¶\">æ¿€æ´»Webç®¡ç†æ§åˆ¶å°æ’ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹äº RabbitMQ æ‰€æœ‰çš„æ“ä½œåŸºæœ¬éƒ½å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå®Œæˆï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥å¹¶ä¸æ–¹ä¾¿ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥æ¿€æ´» <code>rabbitmq_management</code> æ’ä»¶ï¼Œè¯¥æ’ä»¶æä¾›äº† Web ç®¡ç†æ§åˆ¶å°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Web ç®¡ç†æ§åˆ¶å°æ¥ç®¡ç† RabbitMQ</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com/docs/management\">rabbitmq_management</a> æ’ä»¶ä¸º å®˜æ–¹æ’ä»¶ï¼Œé»˜è®¤å·²ç»å®‰è£…ï¼Œä¸éœ€è¦ä¸‹è½½ï¼Œç›´æ¥æ¿€æ´»å³å¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ¿€æ´»æ’ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmq-plugins <span class=\"built_in\">enable</span> rabbitmq_management</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯¥æ’ä»¶é™¤äº†æä¾›äº† <code>Web ç®¡ç†æ§åˆ¶å°</code> ï¼Œè¿˜æä¾› <code>åŸºäº HTTP çš„ API</code> ç”¨äºç®¡ç†å’Œç›‘æ§ RabbitMQ èŠ‚ç‚¹å’Œé›†ç¾¤ï¼Œä»¥åŠ <code>å‘½ä»¤è¡Œå·¥å…· rabbitmqadmin</code>ï¼Œè¿™ä¸ªåé¢ä¼šä»‹ç»ã€‚</p>\n</li>\n</ul>\n<h4 id=\"è®¾ç½®è¿œç¨‹è®¿é—®å¸å·\">è®¾ç½®è¿œç¨‹è®¿é—®å¸å·</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ’ä»¶æ¿€æ´»åå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://&lt;ip&gt;:15672</code>ï¼Œrabbitmq_management æ’ä»¶é»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ <code>guest</code>ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹å…¶åªèƒ½é€šè¿‡ <code>127.0.0.1</code> è®¿é—®ï¼Œæ­¤æ—¶æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³</p>\n</li>\n</ul>\n<h5 id=\"1-å…è®¸-guest-è´¦å·è¿œç¨‹è®¿é—®\">1. å…è®¸ <code>guest</code> è´¦å·è¿œç¨‹è®¿é—®</h5>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹ /etc/rabbitmq/rabbitmq.conf æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># å…è®¸guestç”¨æˆ·è¿œç¨‹è®¿é—®ï¼Œ`å®˜æ–¹ä¸æ¨è` ä¸€ç›´å¼€å¯ï¼Œå»ºè®®å¼€å¯ååœ¨ web æ§åˆ¶å°ä¸­åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ï¼Œç„¶åç«‹åˆ»å…³é—­è¯¥é…ç½®</span></span><br><span class=\"line\">loopback_users.guest = <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ³¨æ„è¿™é‡Œ user å¦‚æœæ”¹æˆ adminï¼Œåˆ™ä¸Šé¢çš„å¼€å¯è¿œç¨‹è®¿é—®ä¸­çš„ guest ä¹Ÿè¦æ”¹æˆ admin</span></span><br><span class=\"line\">default_user = guest</span><br><span class=\"line\">default_pass = guest</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹å®Œæˆåï¼Œé‡å¯ RabbitMQ æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure>\n<h5 id=\"2-æ–°åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿œç¨‹è®¿é—®çš„ç®¡ç†å‘˜è´¦å·\">2. æ–°åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿œç¨‹è®¿é—®çš„ç®¡ç†å‘˜è´¦å·</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œæ¯”å¦‚è¿™é‡Œ ç”¨æˆ·åä¸º <code>admin</code>ï¼Œå¯†ç ä¸º <code>rabbitmq</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl add_user admin rabbitmq</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»™ç®¡ç†å‘˜è´¦å·æ·»åŠ èµ„æºç®¡ç†æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl set_permissions -p / admin <span class=\"string\">&quot;.*&quot;</span> <span class=\"string\">&quot;.*&quot;</span> <span class=\"string\">&quot;.*&quot;</span></span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>éƒ¨åˆ†</th>\n<th>è§£é‡Š</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>rabbitmqctl</code></td>\n<td>RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†ç”¨æˆ·ã€æƒé™ã€é˜Ÿåˆ—ã€äº¤æ¢æœºç­‰ã€‚</td>\n</tr>\n<tr>\n<td><code>set_permissions</code></td>\n<td>è®¾ç½®æŒ‡å®šç”¨æˆ·åœ¨æŸä¸ªè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ä¸‹çš„æƒé™ã€‚</td>\n</tr>\n<tr>\n<td><code>-p /</code></td>\n<td>æŒ‡å®šè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ã€‚è¿™é‡Œçš„ <code>/</code> æ˜¯é»˜è®¤è™šæ‹Ÿä¸»æœºã€‚</td>\n</tr>\n<tr>\n<td><code>admin</code></td>\n<td>ç”¨æˆ·åï¼Œè¿™é‡Œæ˜¯ä¸º <code>admin</code> ç”¨æˆ·è®¾ç½®æƒé™ã€‚</td>\n</tr>\n<tr>\n<td><code>&quot;.*&quot;</code>ï¼ˆé…ç½®æƒé™ï¼‰</td>\n<td>ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·å¯¹èµ„æºé…ç½®çš„æƒé™ï¼Œæ¯”å¦‚åˆ›å»ºäº¤æ¢æœºã€é˜Ÿåˆ—ã€ç»‘å®šç­‰ã€‚<code>&quot;.*&quot;</code> è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚</td>\n</tr>\n<tr>\n<td><code>&quot;.*&quot;</code>ï¼ˆå†™æƒé™ï¼‰</td>\n<td>ç¬¬äºŒä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·å‘å“ªäº›èµ„æºå‘é€æ¶ˆæ¯ã€‚<code>&quot;.*&quot;</code> è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚</td>\n</tr>\n<tr>\n<td><code>&quot;.*&quot;</code>ï¼ˆè¯»æƒé™ï¼‰</td>\n<td>ç¬¬ä¸‰ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·ä»å“ªäº›èµ„æºæ¶ˆè´¹æ¶ˆæ¯ã€‚<code>&quot;.*&quot;</code> è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®adminè´¦å·ä¸ºæ§åˆ¶å°ç®¡ç†å‘˜</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl set_user_tags admin administrator</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>éƒ¨åˆ†</th>\n<th>è§£é‡Š</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>rabbitmqctl</code></td>\n<td>RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ã€‚</td>\n</tr>\n<tr>\n<td><code>set_user_tags</code></td>\n<td>ç”¨æ¥ä¸ºç”¨æˆ·è®¾ç½®æ ‡ç­¾ï¼ˆtagï¼‰ï¼Œæ ‡ç­¾å†³å®šäº†ç”¨æˆ·åœ¨ç®¡ç†ç•Œé¢æˆ– API ä¸­çš„æƒé™çº§åˆ«ã€‚</td>\n</tr>\n<tr>\n<td><code>admin</code></td>\n<td>ç”¨æˆ·åï¼Œè¿™é‡Œæ˜¯ä¸º <code>admin</code> ç”¨æˆ·è®¾ç½®æ ‡ç­¾ã€‚</td>\n</tr>\n<tr>\n<td><code>administrator</code></td>\n<td>æ ‡ç­¾åï¼Œè¡¨ç¤ºç»™è¯¥ç”¨æˆ·èµ‹äºˆç®¡ç†å‘˜æƒé™ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸è§çš„ç”¨æˆ·æ ‡ç­¾</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ ‡ç­¾</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>administrator</code></td>\n<td>ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æœ€é«˜æƒé™ï¼Œå¯é€šè¿‡ Web ç®¡ç†ç•Œé¢ã€CLIã€API ç®¡ç† RabbitMQ æ‰€æœ‰å†…å®¹</td>\n</tr>\n<tr>\n<td><code>monitoring</code></td>\n<td>ç›‘æ§ç”¨æˆ·ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰ç›‘æ§ä¿¡æ¯ï¼Œä½†ä¸èƒ½ä¿®æ”¹é…ç½®</td>\n</tr>\n<tr>\n<td><code>management</code></td>\n<td>æ™®é€šç®¡ç†ç”¨æˆ·ï¼Œå¯ä»¥ç™»å½•ç®¡ç†ç•Œé¢ï¼Œä½†æƒé™å—é™</td>\n</tr>\n<tr>\n<td><code>policymaker</code></td>\n<td>ç­–ç•¥ç®¡ç†ç”¨æˆ·ï¼Œå¯ä»¥ç®¡ç†ç­–ç•¥å’Œå‚æ•°ï¼Œä½†ä¸èƒ½ç®¡ç†å…¶ä»–ç”¨æˆ·</td>\n</tr>\n<tr>\n<td>æ— æ ‡ç­¾</td>\n<td>æ™®é€šç”¨æˆ·ï¼Œåªèƒ½æ”¶å‘æ¶ˆæ¯ï¼Œä¸èƒ½ç™»å½•ç®¡ç†ç•Œé¢</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>set_permissions</code> ä¸ <code>set_user_tags</code> æ€»ç»“å¯¹æ¯”</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>æ§åˆ¶èŒƒå›´</th>\n<th>ä¸»è¦ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>set_permissions</code></td>\n<td>vhost å†…çš„èµ„æº</td>\n<td>å‘æ¶ˆæ¯ã€æ”¶æ¶ˆæ¯ã€åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœº</td>\n</tr>\n<tr>\n<td><code>set_user_tags</code></td>\n<td>ç®¡ç†ç•Œé¢ã€ç®¡ç† API</td>\n<td>ç”¨æˆ·ç®¡ç†ã€ç­–ç•¥ç®¡ç†ã€é›†ç¾¤ç®¡ç†</td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/4lP2cD.png\" alt=\"\"></p>\n<h3 id=\"å¯ç”¨æ‰€æœ‰ç¨³å®šçš„-Feature-Flags\">å¯ç”¨æ‰€æœ‰ç¨³å®šçš„ Feature Flags</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½•æ§åˆ¶å°åæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€æ¡å‘Šè­¦ä¿¡æ¯ï¼Œå‚è€ƒï¼š<a href=\"https://www.rabbitmq.com/docs/feature-flags\">Feature Flags</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âš  All stable feature flags must be enabled after completing an upgrade.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®ƒçš„æ„æ€æ˜¯ï¼šRabbitMQ åœ¨æ–°ç‰ˆæœ¬ä¸­å¼•å…¥äº†ä¸€äº› Feature Flagsï¼ˆç‰¹æ€§æ ‡å¿—ï¼‰ï¼Œè¿™äº›ç‰¹æ€§æ ‡å¿—ç”¨äºæ§åˆ¶ä¸€äº›æ–°çš„åŠŸèƒ½æˆ–è¡Œä¸ºæ˜¯å¦å¯ç”¨ã€‚å‡çº§ RabbitMQ åï¼Œæœ‰äº›åŠŸèƒ½ä¼šå¤„äº <code>æœªå¯ç”¨çŠ¶æ€</code>ï¼Œéœ€è¦ä½ æ‰‹åŠ¨å¼€å¯ï¼Œç¡®ä¿é›†ç¾¤å®Œå…¨è¿è¡Œåœ¨æœ€æ–°çš„åŠŸèƒ½æ¨¡å¼ä¸‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆæœ‰ Feature Flagsï¼Ÿ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å‘åå…¼å®¹ï¼šRabbitMQ å‡çº§æ—¶ï¼Œå¯èƒ½å¼•å…¥äº†æ–°çš„æ•°æ®æ ¼å¼æˆ–å†…éƒ¨æœºåˆ¶ï¼Œå¦‚æœç«‹å³å¯ç”¨ï¼Œæ—§ç‰ˆæœ¬èŠ‚ç‚¹å¯èƒ½æ— æ³•ç†è§£ã€‚</li>\n<li class=\"lvl-4\">æ»šåŠ¨å‡çº§æ”¯æŒï¼šå‡çº§é›†ç¾¤æ—¶ï¼Œå¯ä»¥å…ˆå‡çº§èŠ‚ç‚¹ï¼Œå†ç»Ÿä¸€å¯ç”¨åŠŸèƒ½ï¼Œé¿å…ä¸­é€”å‡ºé—®é¢˜ã€‚</li>\n<li class=\"lvl-4\">å¯æ§æ€§ï¼šä½ å¯ä»¥é€‰æ‹©åœ¨ç¡®è®¤é›†ç¾¤ç¨³å®šåå†å¯ç”¨æ–°åŠŸèƒ½ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å½“å‰ Feature Flags çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl -q --formatter pretty_table list_feature_flags</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºä¼šç±»ä¼¼è¿™æ ·ï¼š</span></span><br><span class=\"line\">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class=\"line\">â”‚ name                                 â”‚ state    â”‚</span><br><span class=\"line\">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class=\"line\">â”‚ classic_mirrored_queue_version       â”‚ enabled  â”‚</span><br><span class=\"line\">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class=\"line\">â”‚ classic_queue_type_delivery_support  â”‚ enabled  â”‚</span><br><span class=\"line\">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class=\"line\">â”‚ detailed_queues_endpoint             â”‚ disabled â”‚</span><br><span class=\"line\">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class=\"line\">â”‚ direct_exchange_routing_v2           â”‚ enabled  â”‚</span><br><span class=\"line\">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; enabledï¼šç‰¹æ€§å·²å¯ç”¨</span><br><span class=\"line\">&gt; disabledï¼šç‰¹æ€§æœªå¯ç”¨</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥è¾“å‡º å…¶å®ƒ æ ¼å¼ï¼Œæ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># json</span></span><br><span class=\"line\">rabbitmqctl -q --formatter json list_feature_flags name state provided_by desc doc_url | jq</span><br><span class=\"line\"><span class=\"comment\"># table</span></span><br><span class=\"line\">rabbitmqctl -q --formatter pretty_table list_feature_flags name state provided_by desc doc_url</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ç”¨æ‰€æœ‰å·²æ ‡è®°ä¸º stable çš„ç‰¹æ€§ï¼Œå»ºè®®å‡çº§ä¸‹ä¸€ä¸ª RabbitMQ ç‰ˆæœ¬ å‰ä¸€å®šè¦ç¡®ä¿å½“å‰ç‰ˆæœ¬çš„ Feature Flags éƒ½æ˜¯å¯ç”¨çš„ï¼Œé¿å…å‡çº§åæ— æ³•é¡ºåˆ©å¯åŠ¨æœåŠ¡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl enable_feature_flag all</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨æ§åˆ¶å°ä¸­ä¹Ÿå¯ä»¥æŸ¥çœ‹å’Œå¼€å¯è¿™äº› Feature Flags çš„çŠ¶æ€<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/VqNm1y.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„ï¼Œ<strong>Feature Flags ä¸€æ—¦å¼€å¯å°±æ— æ³•å…³é—­ã€‚</strong></p>\n</li>\n</ul>\n<h2 id=\"RabbitMQ-é…ç½®æ–‡ä»¶\">RabbitMQ é…ç½®æ–‡ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹äº RPM/YUM/DNF å®‰è£…çš„ RabbitMQï¼Œé…ç½®æ–‡ä»¶é»˜è®¤è·¯å¾„æ˜¯</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–‡ä»¶ç±»å‹</th>\n<th>é»˜è®¤ä½ç½®</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ä¸»é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰</td>\n<td><code>/etc/rabbitmq/rabbitmq.conf</code></td>\n<td>ä½¿ç”¨ <strong>INI æ ¼å¼</strong>ï¼Œä¸»è¦é…ç½®éƒ½åœ¨è¿™é‡Œ</td>\n</tr>\n<tr>\n<td>ç¯å¢ƒå˜é‡é…ç½®</td>\n<td><code>/etc/rabbitmq/rabbitmq-env.conf</code></td>\n<td>å®šä¹‰èŠ‚ç‚¹åã€Cookie ä½ç½®ã€æ•°æ®/æ—¥å¿—ç›®å½•ç­‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…å <code>/etc/rabbitmq/</code> ç›®å½•å¯èƒ½æ˜¯ç©ºçš„ï¼Œä½ éœ€è¦æ‰‹åŠ¨åˆ›å»º <code>rabbitmq.conf</code>ï¼Œè¯¦ç»†çš„å‚æ•°è¯´æ˜å¯ä»¥å‚çœ‹<a href=\"https://rabbitmq.com/configure.html\">å®˜ç½‘æŒ‡å—</a>ï¼Œ<a href=\"https://github.com/rabbitmq/rabbitmq-server/blob/main/deps/rabbit/docs/rabbitmq.conf.example\">rabbitmq.conf ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/rabbitmq/rabbitmq.conf</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç›‘å¬ç«¯å£</span></span><br><span class=\"line\">listeners.tcp.default = 5672</span><br><span class=\"line\"><span class=\"comment\"># ç®¡ç†ç•Œé¢ç«¯å£</span></span><br><span class=\"line\">management.tcp.port = 15672</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmq-env.conf</code> ç”¨æ¥ å®šä¹‰èŠ‚ç‚¹åã€Cookie ã€æ•°æ®/æ—¥å¿—ç›®å½•ç­‰çš„ç¯å¢ƒå˜é‡ï¼ŒRabbitMQ å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¯»å–è¯¥æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯é€šè¿‡ RPM å®‰è£…çš„ RabbitMQ çš„é»˜è®¤å€¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/rabbitmq/rabbitmq-env.conf</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤ä½¿ç”¨ä¸»æœºçŸ­å(hostname -s)ï¼Œä¾‹å¦‚ rabbit@myhost</span></span><br><span class=\"line\">NODENAME=rabbit@&lt;hostname&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç»‘å®šçš„ IP åœ°å€ï¼Œç•™ç©ºè¡¨ç¤ºç›‘å¬æ‰€æœ‰åœ°å€ï¼Œç­‰ä»·äº 0.0.0.0</span></span><br><span class=\"line\">NODE_IP_ADDRESS=</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># AMQP åè®®ç«¯å£ï¼Œé»˜è®¤ 5672</span></span><br><span class=\"line\">NODE_PORT=5672</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># RabbitMQ æ•°æ®åº“å­˜å‚¨ç›®å½•</span></span><br><span class=\"line\">MNESIA_BASE=/var/lib/rabbitmq/mnesia</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜æ”¾ç›®å½•</span></span><br><span class=\"line\">LOG_BASE=/var/log/rabbitmq</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œä¸å¸¦ .conf åç¼€</span></span><br><span class=\"line\">CONFIG_FILE=/etc/rabbitmq/rabbitmq</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¯å¦ä½¿ç”¨é•¿ä¸»æœºåï¼Œtrue/false (é•¿ä¸»æœºå hostname -f)</span></span><br><span class=\"line\">USE_LONGNAME=<span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸¤ä¸ªæ–‡ä»¶çš„ä½œç”¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–‡ä»¶</th>\n<th>ä½œç”¨èŒƒå›´</th>\n<th>å…¸å‹å‚æ•°</th>\n<th>ä½•æ—¶åŠ è½½</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>rabbitmq-env.conf</strong></td>\n<td>è®¾ç½® RabbitMQ å¯åŠ¨æ—¶çš„ <strong>ç¯å¢ƒå˜é‡</strong></td>\n<td>NODENAME, NODE_IP_ADDRESS, NODE_PORT, LOG_BASE, MNESIA_BASE</td>\n<td>åœ¨å¯åŠ¨ RabbitMQ æœåŠ¡å‰ç”± <code>rabbitmq-env</code> è„šæœ¬è¯»å–</td>\n</tr>\n<tr>\n<td><strong>rabbitmq.conf</strong></td>\n<td>RabbitMQ <strong>è¿è¡Œæ—¶é…ç½®</strong>ï¼ˆå†…éƒ¨å‚æ•°ã€æ’ä»¶é…ç½®ç­‰ï¼‰</td>\n<td>listeners.tcp.default, log, cluster_formation ç­‰</td>\n<td>RabbitMQ å¯åŠ¨åç”± Erlang VM å†…éƒ¨è¯»å–</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p><code>rabbitmq-env.conf</code> å†³å®š RabbitMQ å¯åŠ¨æ—¶çš„åŸºæœ¬ç¯å¢ƒï¼Œæ¯”å¦‚èŠ‚ç‚¹åã€æ•°æ®ç›®å½•ã€ç›‘å¬ IP ç­‰ï¼Œå¿…é¡»åœ¨å¯åŠ¨å‰å°±ç¡®å®šã€‚</p>\n</li>\n<li class=\"lvl-4\">\n<p><code>rabbitmq.conf</code> å†³å®šè¿è¡Œæ—¶çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç«¯å£ç›‘å¬ã€æ—¥å¿—ç­‰çº§ã€é›†ç¾¤é…ç½®ç­‰ï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œé‡å¯åº”ç”¨åç”Ÿæ•ˆã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><code>rabbitmq-env.conf</code> å˜é‡</th>\n<th><code>rabbitmq.conf</code> å¯¹åº”é…ç½®</th>\n<th>ä¼˜å…ˆçº§</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NODE_IP_ADDRESS</td>\n<td><code>listeners.tcp.default = &lt;IP&gt;</code></td>\n<td><code>rabbitmq.conf</code></td>\n<td>åªè¦åœ¨ <code>rabbitmq.conf</code> é‡Œé…ç½®ï¼Œå°±è¦†ç›–ç¯å¢ƒå˜é‡</td>\n</tr>\n<tr>\n<td>NODE_PORT</td>\n<td><code>listeners.tcp.default = &lt;Port&gt;</code></td>\n<td><code>rabbitmq.conf</code></td>\n<td>åŒä¸Šï¼ŒIP å’Œç«¯å£å¯ä»¥ä¸€èµ·é…ç½®</td>\n</tr>\n<tr>\n<td>NODENAME</td>\n<td><strong>æ— ç›´æ¥å¯¹åº”</strong></td>\n<td><code>rabbitmq-env.conf</code></td>\n<td>èŠ‚ç‚¹ååªèƒ½é€šè¿‡ <code>rabbitmq-env.conf</code> æˆ–ç¯å¢ƒå˜é‡è®¾å®š</td>\n</tr>\n<tr>\n<td>MNESIA_BASE</td>\n<td><strong>æ— ç›´æ¥å¯¹åº”</strong></td>\n<td><code>rabbitmq-env.conf</code></td>\n<td>æ•°æ®ç›®å½•åªèƒ½åœ¨å¯åŠ¨å‰è®¾å®š</td>\n</tr>\n<tr>\n<td>LOG_BASE</td>\n<td><code>log.dir = &lt;path&gt;</code></td>\n<td><code>rabbitmq.conf</code></td>\n<td>è¿è¡Œæ—¶é…ç½®è¦†ç›–ç¯å¢ƒå˜é‡</td>\n</tr>\n<tr>\n<td>CONFIG_FILE</td>\n<td><strong>æ— ç›´æ¥å¯¹åº”</strong></td>\n<td><code>rabbitmq-env.conf</code></td>\n<td>è¿™ä¸ªåªå†³å®šåŠ è½½å“ªä¸ª <code>rabbitmq.conf</code> æ–‡ä»¶</td>\n</tr>\n<tr>\n<td>USE_LONGNAME</td>\n<td><strong>æ— ç›´æ¥å¯¹åº”</strong></td>\n<td><code>rabbitmq-env.conf</code></td>\n<td>èŠ‚ç‚¹åæ˜¯å¦ä½¿ç”¨é•¿ä¸»æœºååªèƒ½å¯åŠ¨å‰å†³å®š</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RabbitMQ-ç¯å¢ƒå˜é‡\">RabbitMQ ç¯å¢ƒå˜é‡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmq-env.conf</code> æ–‡ä»¶å°±æ˜¯ç”¨æ¥å®šä¹‰ç¯å¢ƒå˜é‡çš„ï¼Œä½†è¦æ³¨æ„ï¼Œ<code>rabbitmq-env.conf</code> æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ å»æ‰äº† <code>RABBITMQ_</code> å‰ç¼€ï¼Œä¾‹å¦‚åœ¨ç¯å¢ƒä¸­è®¾ç½®çš„å˜é‡åé€šå¸¸æ˜¯ <code>RABBITMQ_NODENAME</code>ï¼Œä½†åœ¨ <code>rabbitmq-env.conf</code> ä¸­ï¼Œè®¾ç½®å˜é‡æ—¶ä¼šå»æ‰ <code>RABBITMQ_</code> å‰ç¼€ï¼Œç›´æ¥ä½¿ç”¨ <code>NODENAME</code>ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨ rabbitmq-env.conf ä¸­é…ç½®</span></span><br><span class=\"line\">NODENAME=rabbit@localhost</span><br><span class=\"line\">NODE_PORT=5672</span><br><span class=\"line\">LOG_BASE=/var/log/rabbitmq</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è€Œåœ¨ç¯å¢ƒä¸­ï¼Œä½ å®é™…è®¾ç½®çš„å˜é‡æ˜¯</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> RABBITMQ_NODENAME=rabbit@localhost</span><br><span class=\"line\"><span class=\"built_in\">export</span> RABBITMQ_NODE_PORT=5672</span><br><span class=\"line\"><span class=\"built_in\">export</span> RABBITMQ_LOG_BASE=/var/log/rabbitmq</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>ç¯å¢ƒå˜é‡åç§°</th>\n<th>æè¿°</th>\n<th>Linux RPM å®‰è£…çš„é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>RABBITMQ_BASE</strong></td>\n<td>åªé’ˆå¯¹ Windows ç³»ç»Ÿã€‚è¯¥åŸºç›®å½•åŒ…å« RabbitMQ æœåŠ¡å™¨çš„æ•°æ®åº“å’Œæ—¥å¿—æ–‡ä»¶çš„å­ç›®å½•ã€‚</td>\n<td>æ— ï¼ˆä»…é€‚ç”¨äº Windowsï¼‰</td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_CONFIG_FILE</strong></td>\n<td>é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œæ²¡æœ‰ <code>.config</code> æ‰©å±•åã€‚RabbitMQ æœåŠ¡å™¨ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶æ¥é…ç½®ç»„ä»¶ã€‚</td>\n<td>é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ï¼š<code>/etc/rabbitmq/rabbitmq.conf</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_GENERATED_CONFIG_DIR</strong></td>\n<td>RabbitMQ å†™å…¥å…¶ç”Ÿæˆçš„é…ç½®æ–‡ä»¶çš„ç›®å½•ã€‚</td>\n<td>é»˜è®¤ç”Ÿæˆè·¯å¾„ï¼š<code>/var/lib/rabbitmq/mnesia</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_MNESIA_BASE</strong></td>\n<td>RabbitMQ æœåŠ¡å™¨èŠ‚ç‚¹æ•°æ®åº“ã€æ¶ˆæ¯å­˜å‚¨å’Œé›†ç¾¤çŠ¶æ€æ–‡ä»¶çš„åŸºç›®å½•ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªã€‚é€šå¸¸ä¼šè¦†ç›– <code>RABBITMQ_MNESIA_DIR</code>ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/mnesia</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_MNESIA_DIR</strong></td>\n<td>å­˜å‚¨ RabbitMQ èŠ‚ç‚¹æ•°æ®çš„ç›®å½•ï¼ŒåŒ…å«æ¨¡å¼æ•°æ®åº“ã€æ¶ˆæ¯å­˜å‚¨ã€é›†ç¾¤æˆå‘˜ä¿¡æ¯å’Œå…¶ä»–æŒä¹…èŠ‚ç‚¹çŠ¶æ€ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/mnesia/rabbit@&lt;hostname&gt;</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_SCHEMA_DIR</strong></td>\n<td>RabbitMQ ä¿å­˜æ–°æ ¼å¼é…ç½®æ–‡ä»¶ä½¿ç”¨çš„é…ç½®æ¨¡å¼çš„ç›®å½•ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/etc/rabbitmq</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_LOG_BASE</strong></td>\n<td>è¯¥åŸºç›®å½•åŒ…å« RabbitMQ æœåŠ¡å™¨çš„æ—¥å¿—æ–‡ä»¶ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/log/rabbitmq</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_LOGS</strong></td>\n<td>RabbitMQ æœåŠ¡å™¨çš„ Erlang æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/log/rabbitmq/rabbitmq.log</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_PLUGINS_DIR</strong></td>\n<td>RabbitMQ çš„æ’ä»¶ç›®å½•ã€‚è·¯å¾„ç”±ç‰¹å®šæ“ä½œç³»ç»Ÿçš„åˆ†éš”ç¬¦å®šä¹‰ï¼ˆUnix ä½¿ç”¨ <code>:</code>ï¼ŒWindows ä½¿ç”¨ <code>;</code>ï¼‰ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/usr/lib/rabbitmq/plugins</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_PLUGINS_EXPAND_DIR</strong></td>\n<td>ç”¨äºå±•å¼€å¯ç”¨çš„æ’ä»¶çš„å·¥ä½œç›®å½•ã€‚ç¡®ä¿æœ‰æ•ˆçš„ RabbitMQ ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™è¯»å–å’Œåˆ›å»ºè¯¥ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/mnesia</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_ENABLED_PLUGINS_FILE</strong></td>\n<td>æ˜¾å¼è®°å½•å¯ç”¨çš„æ’ä»¶çš„æ–‡ä»¶ï¼Œå¯ç”¨æˆ–ç¦ç”¨æ’ä»¶æ—¶ä¼šé‡æ–°åˆ›å»ºè¯¥æ–‡ä»¶ã€‚ç¡®ä¿æœ‰æ•ˆçš„ RabbitMQ ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™éšæ—¶è¯»å–ã€å†™å…¥å’Œåˆ›å»ºè¯¥æ–‡ä»¶ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/.enabled_plugins</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_PID_FILE</strong></td>\n<td>ç”¨äº <code>rabbitmqctl</code> çš„è¿›ç¨‹ ID æ–‡ä»¶ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/run/rabbitmq/rabbitmq.pid</code></td>\n</tr>\n</tbody>\n</table>\n<div class=\"warning\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">å®‰è£…å¥½ RabbitMQ åï¼Œä¸è¦éšä¾¿ä¿®æ”¹ <code>hostname</code>ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQ çš„æ•°æ®ç›®å½•æ˜¯åŸºäº <code>hostname</code> åˆ›å»ºçš„ï¼Œå¦‚æœä¿®æ”¹äº† <code>hostname</code>ï¼ŒRabbitMQ å°±ä¼šæŒ‡å‘æ–°çš„æ•°æ®ç›®å½•</li>\n<li class=\"lvl-2\">æ•°æ®ç›®å½•é»˜è®¤æ˜¯ <code>/var/lib/rabbitmq/mnesia/rabbit@&lt;hostname&gt;</code></li>\n<li class=\"lvl-2\">å¦‚æœä¿®æ”¹äº† <code>hostname</code>ï¼Œä½†ä»è¦ä½¿ç”¨åŸæ¥çš„æ•°æ®ç›®å½•ï¼Œå¯ä»¥è®¾ç½® <code>RABBITMQ_MNESIA_DIR</code> ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å‘åŸæ¥çš„æ•°æ®ç›®å½•</li>\n</ul>\n</div>\n<h2 id=\"RabbitMQ-ç›¸å…³å‘½ä»¤\">RabbitMQ ç›¸å…³å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ—¥å¸¸ä½¿ç”¨ä¸­ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ Web ç®¡ç†ç•Œé¢æ“ä½œï¼Œè¿™é‡Œä»…å¯¹å‘½ä»¤è¿›è¡Œç®€è¦ä»‹ç»ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨ï¼ˆç®€è¦ï¼‰</th>\n<th>å¸¸ç”¨ç¤ºä¾‹ï¼ˆå…¸å‹ç”¨æ³• + ä¸­æ–‡è¯´æ˜ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>rabbitmq-defaults</code></td>\n<td>å®šä¹‰/æ˜¾ç¤º RabbitMQ å®‰è£…é»˜è®¤ç›®å½•å’Œè¿è¡Œæ—¶å‰ç¼€</td>\n<td><code>ç¼–è¾‘ sbin/rabbitmq-defaults ä¸­ PREFIX/SYS_PREFIX</code>ï¼ˆä¿®æ”¹é»˜è®¤ç›®å½•åˆ°ç³»ç»Ÿç›®å½•ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-diagnostics</code></td>\n<td>å¥åº·æ£€æŸ¥ / è¯Šæ–­å·¥å…·ï¼Œå¯ç”¨äºç›‘æ§</td>\n<td><code>rabbitmq-diagnostics -q ping</code>ï¼ˆæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ï¼‰<br><code>rabbitmq-diagnostics -q status</code>ï¼ˆæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼‰<br><code>rabbitmq-diagnostics -q check_running</code>ï¼ˆç¡®è®¤èŠ‚ç‚¹è¿è¡Œä¸­ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-env</code></td>\n<td><code>rabbitmq-env</code> å…¶å®ä¸æ˜¯ä¸€ä¸ªç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œå•ç‹¬ä½¿ç”¨çš„å·¥å…·ï¼Œè€Œæ˜¯ RabbitMQ æœåŠ¡å¯åŠ¨è„šæœ¬ ä¸­ç”¨æ¥åŠ è½½ RabbitMQ ç¯å¢ƒå˜é‡çš„è„šæœ¬ã€‚</td>\n<td>åœ¨ <code>/etc/rabbitmq/rabbitmq-env.conf</code> ä¸­è®¾ç½®ï¼š<br><code>RABBITMQ_NODENAME=myrabbit</code>ï¼ˆè®¾ç½®èŠ‚ç‚¹åï¼‰<br>æˆ–ç”¨ <code>rabbitmq-env</code> è¾“å‡ºæŸ¥çœ‹å®é™…ç¯å¢ƒ</td>\n</tr>\n<tr>\n<td><code>rabbitmq-plugins</code></td>\n<td>æ’ä»¶ç®¡ç†ï¼šåˆ—å‡º/å¯ç”¨/ç¦ç”¨æ’ä»¶</td>\n<td><code>rabbitmq-plugins list</code>ï¼ˆåˆ—å‡ºæ‰€æœ‰æ’ä»¶ï¼‰<br><code>rabbitmq-plugins enable rabbitmq_management</code>ï¼ˆå¯ç”¨ Web ç®¡ç†æ’ä»¶ï¼‰<br><code>rabbitmq-plugins disable --offline plugin</code>ï¼ˆç¦»çº¿ç¦ç”¨æ’ä»¶ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-queues</code></td>\n<td>é˜Ÿåˆ—å‰¯æœ¬ç®¡ç†ï¼šrebalance/grow/shrink</td>\n<td><code>rabbitmq-queues rebalance all --vhost-pattern &quot;.*&quot; --queue-pattern &quot;.*&quot;</code>ï¼ˆé‡å¹³è¡¡æ‰€æœ‰é˜Ÿåˆ—å‰¯æœ¬ï¼‰<br><code>rabbitmq-queues add_member --vhost / qname rabbit@node</code>ï¼ˆä¸ºé˜Ÿåˆ—å¢åŠ èŠ‚ç‚¹å‰¯æœ¬ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-server</code></td>\n<td>å¯åŠ¨ RabbitMQ èŠ‚ç‚¹ï¼ˆå‰å°/åå°ï¼‰</td>\n<td><code>rabbitmq-server</code>ï¼ˆå‰å°å¯åŠ¨ï¼‰<br><code>rabbitmq-server -detached</code>ï¼ˆåå°å¯åŠ¨ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-upgrade</code></td>\n<td>å‡çº§ç›¸å…³æ“ä½œï¼šdrain/æ¢å¤ç­‰</td>\n<td><code>rabbitmq-upgrade drain</code>ï¼ˆè®©èŠ‚ç‚¹è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œåœæ­¢æ¥æ”¶æ–°è¿æ¥ï¼‰<br><code>rabbitmq-upgrade post_upgrade</code>ï¼ˆæ‰§è¡Œå‡çº§åæ”¶å°¾æ“ä½œï¼‰<br><code>rabbitmq-upgrade revive</code>ï¼ˆæ¢å¤ç»´æŠ¤æ¨¡å¼ä¸­çš„èŠ‚ç‚¹ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmqctl</code></td>\n<td>æœ€å¸¸ç”¨ç®¡ç†å‘½ä»¤ï¼šç”¨æˆ·ã€é˜Ÿåˆ—ã€é›†ç¾¤ç®¡ç†</td>\n<td><code>rabbitmqctl status</code>ï¼ˆæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼‰<br><code>rabbitmqctl list_queues</code>ï¼ˆåˆ—å‡ºæ‰€æœ‰é˜Ÿåˆ—ï¼‰<br><code>rabbitmqctl add_user bob s3cr3t</code>ï¼ˆæ·»åŠ ç”¨æˆ· bobï¼Œå¯†ç  s3cr3tï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-streams</code></td>\n<td>ç®¡ç† Streamsï¼ˆæµå¼é˜Ÿåˆ—ï¼‰</td>\n<td><code>rabbitmq-streams stream_status --vhost / my-stream</code>ï¼ˆæŸ¥çœ‹ my-stream çŠ¶æ€ï¼‰<br><code>rabbitmq-streams add_replica --vhost / my-stream rabbit@node</code>ï¼ˆä¸º my-stream å¢åŠ å‰¯æœ¬èŠ‚ç‚¹ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æœ€å¸¸ç”¨çš„å‘½ä»¤-rabbitmqctl\">æœ€å¸¸ç”¨çš„å‘½ä»¤ <code>rabbitmqctl</code></h3>\n<h4 id=\"å‘½ä»¤è‡ªåŠ¨è¡¥å…¨\">å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmqctl</code> æœ‰ä¸€ä¸ª <code>autocomplete</code> å‚æ•°ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆå‘½ä»¤å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‘½ä»¤æ¥å®ç°å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>vim ~/.bashrc</code> æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">_rabbitmqctl_completion</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">local</span> cur opts</span><br><span class=\"line\">    cur=<span class=\"string\">&quot;<span class=\"variable\">$&#123;COMP_WORDS[COMP_CWORD]&#125;</span>&quot;</span>           <span class=\"comment\"># å½“å‰å…‰æ ‡æ‰€åœ¨å•è¯</span></span><br><span class=\"line\">    opts=$(rabbitmqctl autocomplete <span class=\"string\">&quot;<span class=\"variable\">$cur</span>&quot;</span>)   <span class=\"comment\"># åªä¼ å½“å‰å•è¯ä½œä¸ºå‰ç¼€</span></span><br><span class=\"line\">    COMPREPLY=( $(compgen -W <span class=\"string\">&quot;<span class=\"variable\">$&#123;opts&#125;</span>&quot;</span> -- <span class=\"string\">&quot;<span class=\"variable\">$cur</span>&quot;</span>) )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">complete -F _rabbitmqctl_completion rabbitmqctl</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š RabbitMQ çš„å¤§éƒ¨åˆ†å‘½ä»¤éƒ½æœ‰ <code>autocomplete</code> å‚æ•°ï¼Œéƒ½å¯ä»¥è‡ªåŠ¨å®Œæˆå‘½ä»¤å‚æ•°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®šä¹‰é€šç”¨è¡¥å…¨å‡½æ•°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">_rabbitmq_completion</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">local</span> cur opts</span><br><span class=\"line\">    cur=<span class=\"string\">&quot;<span class=\"variable\">$&#123;COMP_WORDS[COMP_CWORD]&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># å½“å‰å‘½ä»¤åï¼Œè‡ªåŠ¨åˆ¤æ–­</span></span><br><span class=\"line\">    <span class=\"built_in\">local</span> cmd=<span class=\"string\">&quot;<span class=\"variable\">$&#123;COMP_WORDS[0]&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># ç»™å¯¹åº”å‘½ä»¤ä¼ å½“å‰å‰ç¼€</span></span><br><span class=\"line\">    opts=$(<span class=\"variable\">$cmd</span> autocomplete <span class=\"string\">&quot;<span class=\"variable\">$cur</span>&quot;</span> 2&gt;/dev/null)</span><br><span class=\"line\">    COMPREPLY=( $(compgen -W <span class=\"string\">&quot;<span class=\"variable\">$&#123;opts&#125;</span>&quot;</span> -- <span class=\"string\">&quot;<span class=\"variable\">$cur</span>&quot;</span>) )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸€æ¬¡æ€§ç»‘å®šå¤šä¸ªå‘½ä»¤</span></span><br><span class=\"line\">complete -F _rabbitmq_completion rabbitmqctl rabbitmq-plugins rabbitmq-diagnostics rabbitmq-queues rabbitmq-upgrade</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿è¡¥å…¨ç”Ÿæ•ˆ</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"><span class=\"comment\"># tab è¡¥å…¨</span></span><br><span class=\"line\">rabbitmqctl st&lt;TAB&gt;</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">start_app  status     stop       stop_app</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¸¸ç”¨å‘½ä»¤å‚æ•°\">å¸¸ç”¨å‘½ä»¤å‚æ•°</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmqctl help</code> è·å–æ‰€æœ‰å‘½ä»¤å‚æ•°çš„ç®€ä»‹</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>rabbitmqctl help &lt;command&gt;</code> è·å–æŒ‡å®šå‘½ä»¤çš„å¸®åŠ©</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ—¥å¸¸ä½¿ç”¨ä¸­åŸºæœ¬éƒ½æ˜¯é€šè¿‡ <code>web æ§åˆ¶å°</code> å®Œæˆï¼Œè¿™é‡Œåªåšäº†è§£ã€‚</p>\n</li>\n</ul>\n<h5 id=\"1-èŠ‚ç‚¹ç®¡ç†\">1.èŠ‚ç‚¹ç®¡ç†</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>status</code></td>\n<td>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼ŒåŒ…æ‹¬è¿è¡ŒçŠ¶æ€ã€ç‰ˆæœ¬ã€å†…å­˜ã€é˜Ÿåˆ—æ•°é‡ç­‰</td>\n<td><code>rabbitmqctl status</code></td>\n</tr>\n<tr>\n<td><code>stop</code></td>\n<td>åœæ­¢ RabbitMQ èŠ‚ç‚¹</td>\n<td><code>rabbitmqctl stop</code></td>\n</tr>\n<tr>\n<td><code>stop_app</code></td>\n<td>åœæ­¢ RabbitMQ åº”ç”¨ï¼ˆä¿ç•™èŠ‚ç‚¹è¿è¡Œï¼‰</td>\n<td><code>rabbitmqctl stop_app</code></td>\n</tr>\n<tr>\n<td><code>start_app</code></td>\n<td>å¯åŠ¨ RabbitMQ åº”ç”¨</td>\n<td><code>rabbitmqctl start_app</code></td>\n</tr>\n<tr>\n<td><code>reset</code></td>\n<td>é‡ç½® RabbitMQ èŠ‚ç‚¹ï¼Œåˆ é™¤æ‰€æœ‰é˜Ÿåˆ—å’Œæ•°æ®ï¼ˆæ…ç”¨ï¼‰</td>\n<td><code>rabbitmqctl reset</code></td>\n</tr>\n<tr>\n<td><code>force_reset</code></td>\n<td>å¼ºåˆ¶é‡ç½®èŠ‚ç‚¹ï¼ˆå³ä½¿åœ¨é›†ç¾¤ä¸­ä¹Ÿä¼šé‡ç½®ï¼‰</td>\n<td><code>rabbitmqctl force_reset</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"2-ç”¨æˆ·å’Œæƒé™ç®¡ç†\">2. ç”¨æˆ·å’Œæƒé™ç®¡ç†</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>list_users</code></td>\n<td>åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·</td>\n<td><code>rabbitmqctl list_users</code></td>\n</tr>\n<tr>\n<td><code>add_user &lt;user&gt; &lt;password&gt;</code></td>\n<td>æ·»åŠ æ–°ç”¨æˆ·</td>\n<td><code>rabbitmqctl add_user alice mypassword</code></td>\n</tr>\n<tr>\n<td><code>delete_user &lt;user&gt;</code></td>\n<td>åˆ é™¤ç”¨æˆ·</td>\n<td><code>rabbitmqctl delete_user alice</code></td>\n</tr>\n<tr>\n<td><code>change_password &lt;user&gt; &lt;password&gt;</code></td>\n<td>ä¿®æ”¹ç”¨æˆ·å¯†ç </td>\n<td><code>rabbitmqctl change_password alice newpass</code></td>\n</tr>\n<tr>\n<td><code>list_permissions &lt;user&gt;</code></td>\n<td>æŸ¥çœ‹æŸç”¨æˆ·çš„æƒé™</td>\n<td><code>rabbitmqctl list_permissions alice</code></td>\n</tr>\n<tr>\n<td><code>set_permissions -p &lt;vhost&gt; &lt;user&gt; &quot;&lt;conf&gt;&quot; &quot;&lt;write&gt;&quot; &quot;&lt;read&gt;&quot;</code></td>\n<td>è®¾ç½®ç”¨æˆ·åœ¨è™šæ‹Ÿä¸»æœºçš„æƒé™</td>\n<td><code>rabbitmqctl set_permissions -p / alice &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"3-è™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ç®¡ç†\">3. è™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ç®¡ç†</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>list_vhosts</code></td>\n<td>åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿä¸»æœº</td>\n<td><code>rabbitmqctl list_vhosts</code></td>\n</tr>\n<tr>\n<td><code>add_vhost &lt;vhost&gt;</code></td>\n<td>æ·»åŠ è™šæ‹Ÿä¸»æœº</td>\n<td><code>rabbitmqctl add_vhost my_vhost</code></td>\n</tr>\n<tr>\n<td><code>delete_vhost &lt;vhost&gt;</code></td>\n<td>åˆ é™¤è™šæ‹Ÿä¸»æœº</td>\n<td><code>rabbitmqctl delete_vhost my_vhost</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"4-é˜Ÿåˆ—ç®¡ç†\">4. é˜Ÿåˆ—ç®¡ç†</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é˜Ÿåˆ—å¯ä»¥é€šè¿‡ <code>web æ§åˆ¶å°</code> åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ <code>å®¢æˆ·ç«¯(æ¯”å¦‚Java)</code> åˆ›å»ºï¼Œ<code>rabbitmqctl</code> åªèƒ½æŸ¥çœ‹å’Œåˆ é™¤é˜Ÿåˆ—</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>list_queues</code></td>\n<td>åˆ—å‡ºé˜Ÿåˆ—</td>\n<td><code>rabbitmqctl list_queues</code></td>\n</tr>\n<tr>\n<td><code>list_queues name messages consumers</code></td>\n<td>åˆ—å‡ºé˜Ÿåˆ—åŠæ¶ˆæ¯æ•°ã€æ¶ˆè´¹è€…æ•°</td>\n<td><code>rabbitmqctl list_queues name messages consumers</code></td>\n</tr>\n<tr>\n<td><code>purge_queue &lt;queue&gt;</code></td>\n<td>æ¸…ç©ºé˜Ÿåˆ—æ¶ˆæ¯</td>\n<td><code>rabbitmqctl purge_queue my_queue</code></td>\n</tr>\n<tr>\n<td><code>delete_queue &lt;queue&gt;</code></td>\n<td>åˆ é™¤é˜Ÿåˆ—</td>\n<td><code>rabbitmqctl delete_queue my_queue</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"5-äº¤æ¢æœºå’Œç»‘å®š\">5. äº¤æ¢æœºå’Œç»‘å®š</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>äº¤æ¢æœºå¯ä»¥é€šè¿‡ <code>web æ§åˆ¶å°</code> åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ <code>å®¢æˆ·ç«¯(æ¯”å¦‚Java)</code> åˆ›å»ºï¼Œ<code>rabbitmqctl</code> åªèƒ½æŸ¥çœ‹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>list_exchanges</code></td>\n<td>åˆ—å‡ºäº¤æ¢æœº</td>\n<td><code>rabbitmqctl list_exchanges</code></td>\n</tr>\n<tr>\n<td><code>list_bindings</code></td>\n<td>åˆ—å‡ºç»‘å®šå…³ç³»</td>\n<td><code>rabbitmqctl list_bindings</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"6-é›†ç¾¤ç®¡ç†\">6. é›†ç¾¤ç®¡ç†</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>cluster_status</code></td>\n<td>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</td>\n<td><code>rabbitmqctl cluster_status</code></td>\n</tr>\n<tr>\n<td><code>join_cluster &lt;node&gt;</code></td>\n<td>èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</td>\n<td><code>rabbitmqctl join_cluster rabbit@node1</code></td>\n</tr>\n<tr>\n<td><code>forget_cluster_node &lt;node&gt;</code></td>\n<td>å°†èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤</td>\n<td><code>rabbitmqctl forget_cluster_node rabbit@node2</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"7-æ—¥å¿—å’Œè°ƒè¯•\">7. æ—¥å¿—å’Œè°ƒè¯•</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>report</code></td>\n<td>è¾“å‡ºèŠ‚ç‚¹è¯Šæ–­æŠ¥å‘Š</td>\n<td><code>rabbitmqctl report</code></td>\n</tr>\n<tr>\n<td><code>eval &lt;expression&gt;</code></td>\n<td>æ‰§è¡Œ Erlang è¡¨è¾¾å¼</td>\n<td><code>rabbitmqctl eval 'rabbit_mnesia:info().'</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"8-å…¶ä»–å‘½ä»¤\">8. å…¶ä»–å‘½ä»¤</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>help</code></td>\n<td>æŸ¥çœ‹å¸®åŠ©å‘½ä»¤</td>\n<td><code>rabbitmqctl help</code></td>\n</tr>\n<tr>\n<td><code>version</code></td>\n<td>æŸ¥çœ‹ RabbitMQ ç‰ˆæœ¬</td>\n<td><code>rabbitmqctl version</code></td>\n</tr>\n<tr>\n<td><code>authenticate_user &lt;user&gt; &lt;password&gt;</code></td>\n<td>éªŒè¯ç”¨æˆ·å¯†ç </td>\n<td><code>rabbitmqctl authenticate_user alice mypassword</code></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RabbitMQ-HTTP-API\">RabbitMQ HTTP API</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ çš„ HTTP API æ˜¯ä¸€ä¸ª åŸºäº REST çš„ç®¡ç†æ¥å£ï¼Œä¸»è¦ç”¨äºå¯¹ RabbitMQ çš„ èµ„æºç®¡ç†å’Œç›‘æ§ï¼Œå®ƒæ˜¯ ç®¡ç†æ’ä»¶ <code>rabbitmq_management</code> æä¾›çš„åŠŸèƒ½ã€‚é€šè¿‡ HTTP APIï¼Œä½ å¯ä»¥ä¸ç”¨ <code>rabbitmqctl</code> å°±èƒ½æ“ä½œ RabbitMQã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¦ä½¿ç”¨ HTTP APIï¼Œä½ éœ€è¦åœ¨ RabbitMQ èŠ‚ç‚¹ä¸Šç¡®ä¿ <code>rabbitmq_management</code> æ’ä»¶å·²ç»å¯åŠ¨ã€‚å‰é¢æˆ‘ä»¬ä»‹ç»<code>web ç®¡ç†æ§åˆ¶å°</code>æ—¶å·²ç»å¯åŠ¨äº†è¯¥æ’ä»¶ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š <code>Webç®¡ç†æ§åˆ¶å°</code> å°±æ˜¯é€šè¿‡å‘é€ AJAX è¯·æ±‚åˆ° <code>/api/â€¦</code> æ¥å£æ¥è·å–æ•°æ®å’Œæ‰§è¡Œæ“ä½œã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/980Wwu.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œæœ‰ HTTP API çš„è¯¦ç»†è¯´æ˜ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚</p>\n</li>\n</ul>\n<h2 id=\"rabbitmqadmin\">rabbitmqadmin</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmqadmin</code> æ˜¯ ç®¡ç†æ’ä»¶ <code>rabbitmq_management</code> æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† RabbitMQ çš„èµ„æºï¼Œå¦‚åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»ã€æŸ¥çœ‹é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>rabbitmqadmin</code> æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>HTTP API</code> çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ‰€ä»¥åº•å±‚å®é™…ä¸Šæ˜¯è°ƒç”¨äº† <code>HTTP API</code> ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/rabbitmq/rabbitmqadmin-ng/releases\">ä¸‹è½½åœ°å€</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> wget -O /usr/local/bin/rabbitmqadmin https://github.com/rabbitmq/rabbitmqadmin-ng/releases/download/v2.10.0/rabbitmqadmin-2.10.0-x86_64-unknown-linux-gnu</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®æƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> +x /usr/local/bin/rabbitmqadmin</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å¸®åŠ©</span></span><br><span class=\"line\">rabbitmqadmin <span class=\"built_in\">help</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å­å‘½ä»¤å¸®åŠ©</span></span><br><span class=\"line\">rabbitmqadmin <span class=\"built_in\">help</span> &lt;<span class=\"built_in\">command</span>&gt;</span><br><span class=\"line\"><span class=\"comment\">## ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ é˜Ÿåˆ— å¸®åŠ©</span></span><br><span class=\"line\">rabbitmqadmin <span class=\"built_in\">help</span> queues</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ é˜Ÿåˆ—å£°æ˜ å¸®åŠ©ï¼Œå­å­å‘½ä»¤</span></span><br><span class=\"line\">rabbitmqadmin <span class=\"built_in\">help</span> queues <span class=\"built_in\">declare</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmqadmin</code> çš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯å› ä¸º<code>HTTP API</code>æ•…æ„æ²¡æœ‰å…¬å¼€æŸäº›æ“ä½œï¼Œæ‰€ä»¥å…¶ä¸èƒ½æ›¿ä»£ <code>rabbitmqctl</code> æˆ– <code>rabbitmq-plugins</code>ç­‰å‘½ä»¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å› ä¸ºå®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œï¼Œæ‰€ä»¥è¿™é‡Œåªåšç®€å•ä»‹ç»ã€‚ä¸Šæ–‡æåˆ°äº† <code>rabbitmqctl</code> ä¸æ”¯æŒå£°æ˜(åˆ›å»º) äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼Œè¿™ä¸ªé€šè¿‡ <code>rabbitmqadmin</code> å®ç°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè™šæ‹Ÿä¸»æœº</span></span><br><span class=\"line\">rabbitmqadmin vhosts <span class=\"built_in\">declare</span> --name <span class=\"string\">&quot;my-vhost&quot;</span> --default-queue-type <span class=\"string\">&quot;quorum&quot;</span> --description <span class=\"string\">&quot;Used to test&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å£°æ˜é˜Ÿåˆ—</span></span><br><span class=\"line\">rabbitmqadmin queues <span class=\"built_in\">declare</span> --vhost <span class=\"string\">&quot;my-vhost&quot;</span> --name <span class=\"string\">&quot;target.classic.queue.name&quot;</span> --<span class=\"built_in\">type</span> <span class=\"string\">&quot;classic&quot;</span> --durable <span class=\"literal\">true</span> --auto-delete <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># å£°æ˜äº¤æ¢æœº</span></span><br><span class=\"line\">rabbitmqadmin exchanges <span class=\"built_in\">declare</span> --vhost <span class=\"string\">&quot;my-vhost&quot;</span> --name <span class=\"string\">&quot;target.direct.exchange.name&quot;</span> --<span class=\"built_in\">type</span> <span class=\"string\">&quot;direct&quot;</span> --durable <span class=\"literal\">true</span> --auto-delete <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class=\"line\">rabbitmqadmin bindings <span class=\"built_in\">declare</span> --vhost <span class=\"string\">&quot;my-vhost&quot;</span> --<span class=\"built_in\">source</span> <span class=\"string\">&quot;target.direct.exchange.name&quot;</span> --destination <span class=\"string\">&quot;target.classic.queue.name&quot;</span> --destination-type <span class=\"string\">&quot;queue&quot;</span> --routing-key <span class=\"string\">&quot;target.routing.key&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿˜æœ‰å°±æ˜¯å®šæœŸå¤‡ä»½ RabbitMQ çš„ç»“æ„æ•°æ®(ä¸åŒ…æ‹¬æ¶ˆæ¯)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯¼å‡º</span></span><br><span class=\"line\">abbitmqadmin definitions <span class=\"built_in\">export</span> --file backup.json</span><br><span class=\"line\"><span class=\"comment\"># å¯¼å…¥</span></span><br><span class=\"line\">rabbitmqadmin definitions import --file backup.json</span><br></pre></td></tr></table></figure>\n<h2 id=\"RabbitMQ-éœ€è¦å¼€æ”¾å“ªäº›ç«¯å£\">RabbitMQ éœ€è¦å¼€æ”¾å“ªäº›ç«¯å£</h2>\n<table>\n<thead>\n<tr>\n<th>ç«¯å£å·</th>\n<th>åè®®</th>\n<th>ç”¨é€”è¯´æ˜</th>\n<th>é»˜è®¤çŠ¶æ€</th>\n<th>å®‰å…¨å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>5672</td>\n<td>AMQP</td>\n<td>ä¸»å®¢æˆ·ç«¯è¿æ¥ç«¯å£</td>\n<td>å¼€æ”¾</td>\n<td>å¿…é¡»å¼€æ”¾ï¼Œé™åˆ¶IP</td>\n</tr>\n<tr>\n<td>5671</td>\n<td>AMQP/SSL</td>\n<td>TLSåŠ å¯†è¿æ¥ç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨TLSåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>15672</td>\n<td>HTTP</td>\n<td>ç®¡ç†ç•Œé¢ç«¯å£</td>\n<td>å…³é—­</td>\n<td>å»ºè®®å†…ç½‘è®¿é—®</td>\n</tr>\n<tr>\n<td>15671</td>\n<td>HTTPS</td>\n<td>TLSç®¡ç†ç•Œé¢ç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨HTTPSåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>25672</td>\n<td>Erlang Distribution</td>\n<td>é›†ç¾¤èŠ‚ç‚¹é€šä¿¡</td>\n<td>å¼€æ”¾</td>\n<td>é›†ç¾¤å†…éƒ¨ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>35672-35682</td>\n<td>Erlang Distribution</td>\n<td>é›†ç¾¤èŠ‚ç‚¹å‘ç°</td>\n<td>å¼€æ”¾</td>\n<td>é›†ç¾¤å†…éƒ¨ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>5552</td>\n<td>Stream Protocol</td>\n<td>æµåè®®ç«¯å£,RabbitMQ 3.9+</td>\n<td>å…³é—­</td>\n<td>ä½¿ç”¨æµåŠŸèƒ½æ—¶å¼€æ”¾</td>\n</tr>\n<tr>\n<td>5551</td>\n<td>Stream Protocol/SSL</td>\n<td>æµåè®®TLSç«¯å£,RabbitMQ 3.9+</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨TLSåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>61613</td>\n<td>STOMP</td>\n<td>STOMPåè®®æ”¯æŒç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨STOMPåè®®åˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>61614</td>\n<td>STOMP/SSL</td>\n<td>STOMP TLSåŠ å¯†ç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨STOMP over TLSåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>1883</td>\n<td>MQTT</td>\n<td>MQTTåè®®æ”¯æŒç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨MQTTåè®®åˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>8883</td>\n<td>MQTT/SSL</td>\n<td>MQTT TLSåŠ å¯†ç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨MQTT over TLSåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>15674</td>\n<td>Web STOMP</td>\n<td>WebSocket STOMPæ”¯æŒç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨Web STOMPåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>15675</td>\n<td>Web MQTT</td>\n<td>WebSocket MQTTæ”¯æŒç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨Web MQTTåˆ™å¼€æ”¾</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RabbitMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹ RabbitMQ ç®€ä»‹ RabbitMQ æ˜¯ä¸€ä¸ªå¼€æºçš„ æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼ŒåŸºäº AMQPï¼ˆAdvanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰ å®ç°ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ è§£è€¦ã€ç¼“å†²å’Œå¼‚æ­¥å¤„ç†æ¶ˆæ¯ã€‚ å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯è®© ä¸åŒç³»ç»Ÿ æˆ– åº”ç”¨ ä¹‹é—´å¯é åœ°ä¼ é€’æ¶ˆæ¯ï¼Œå³ä½¿å‘é€æ–¹æˆ–æ¥æ”¶æ–¹æš‚æ—¶ä¸å¯ç”¨ï¼Œä¹Ÿèƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚ RabbitMQ çš„æ ¸å¿ƒç‰¹ç‚¹ æ ¸å¿ƒç‰¹ç‚¹ å…·ä½“è¯´æ˜ å¯é æ€§ - æ”¯æŒæ¶ˆæ¯ç¡®è®¤ï¼ˆACKï¼‰æœºåˆ¶- æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜- æ”¯æŒäº‹åŠ¡æˆ–ç¡®è®¤æ¨¡å¼ï¼Œä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤± çµæ´»çš„è·¯ç”± - é€šè¿‡ äº¤æ¢æœºï¼ˆExchangeï¼‰ å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„ é˜Ÿåˆ—ï¼ˆQueueï¼‰- æ”¯æŒå¤šç§è·¯ç”±ç­–ç•¥ï¼š â€¢ directï¼šç›´è¿ï¼ŒæŒ‰é˜Ÿåˆ—åè·¯ç”± â€¢ fanoutï¼šå¹¿æ’­ï¼Œæ‰€æœ‰é˜Ÿåˆ—éƒ½æ”¶åˆ° â€¢ topicï¼šä¸»é¢˜åŒ¹é…ï¼Œç±»ä¼¼è®¢é˜…æ¨¡å¼ â€¢ headersï¼šæŒ‰æ¶ˆæ¯å¤´åŒ¹é… é«˜æ€§èƒ½ - å†…å­˜é˜Ÿåˆ—å¿«é€Ÿå¤„ç†æ¶ˆæ¯- æ”¯æŒå¼‚æ­¥ IO å’Œ Erlang çš„å¹¶å‘æ¨¡å‹ å¤šè¯­è¨€æ”¯æŒ - å®¢æˆ·ç«¯åº“ä¸°å¯Œï¼šJavaã€Pythonã€Goã€C#ã€Node.js ç­‰- å¯åœ¨å¤šç§å¹³å°å’Œæ¡†æ¶ä¸­ä½¿ç”¨ é›†ç¾¤ä¸é«˜å¯ç”¨ - æ”¯æŒé›†ç¾¤æ¨¡å¼- é˜Ÿåˆ—å¯ä»¥é•œåƒåˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä¿è¯é«˜å¯ç”¨ RabbitMQ çš„æ ¸å¿ƒæ¦‚å¿µ æ¦‚å¿µ å«ä¹‰ ä½œç”¨èŒƒå›´ ç±»æ¯” Broker ä¸€ä¸ª RabbitMQ æœåŠ¡å®ä¾‹ï¼ŒåŒ…å«æ•´ä¸ª AMQP æœåŠ¡ã€ç®¡ç†æ’ä»¶ã€é˜Ÿåˆ—ã€äº¤æ¢æœºç­‰èµ„æº è¿è¡Œåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œæˆ–é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ ç±»ä¼¼äºæ•°æ®åº“çš„ å®ä¾‹ Vhost Broker å†…éƒ¨çš„ é€»è¾‘åˆ†åŒºï¼Œç”¨äºéš”ç¦»ä¸åŒçš„é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šç­‰èµ„æº ä¸€ä¸ª Broker å¯ä»¥æœ‰å¤šä¸ª vhostï¼Œæ¯ä¸ª vhost å½¼æ­¤éš”ç¦» ç±»ä¼¼äºæ•°æ®åº“å®ä¾‹é‡Œçš„ schemaï¼Œå®é™…ä½¿ç”¨ä¸­å»ºè®®ä¸ºæ¯ä¸ªä¸šåŠ¡é…ç½®ä¸€ä¸ªç‹¬ç«‹çš„ vhostï¼Œå¹¶ä¸ºæ¯ä¸ªvhostå•ç‹¬é…ç½®ä¸€ä¸ªç®¡ç†ç”¨æˆ· åç§° è¯´æ˜ Producer æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå‘é€æ¶ˆæ¯åˆ° RabbitMQ Queue é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯çš„åœ°æ–¹ Consumer æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œä»é˜Ÿåˆ—è·å–æ¶ˆæ¯ Exchange äº¤æ¢æœºï¼Œæ¥æ”¶ Producer çš„æ¶ˆæ¯å¹¶æ ¹æ®è§„åˆ™è·¯ç”±åˆ°é˜Ÿåˆ— Binding ç»‘å®šï¼Œå®šä¹‰ Exchange ä¸ Queue çš„è·¯ç”±è§„åˆ™ Message æ¶ˆæ¯ï¼ŒRabbitMQ ä¼ é€’çš„æ•°æ®å•å…ƒ Connection è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¸ RabbitMQ Broker ä¹‹é—´çš„ TCP è¿æ¥ï¼Œæ˜¯é€šä¿¡çš„ç‰©ç†é€šé“ Channel é€šé“ï¼ŒConnection å†…éƒ¨çš„ é€»è¾‘è¿æ¥ï¼Œè½»é‡çº§ä¸”å¤šè·¯å¤ç”¨ï¼Œä¸€ä¸ªè¿æ¥å¯å¼€å¤šä¸ªé€šé“ 1234567 â”Œâ”€ Broker (RabbitMQ å®ä¾‹)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€ Virtual Host â”€â”€â”€â”€â”€â” â”‚ Producer â”€â”€â”€ TCP â”€â”€â”€â”€â”€â”€&gt; Exchange â”€â”€&gt; Queue â”€â”€â”€â”€â”€â”€â”€â”€&gt; TCP â”€â”€ Consumer(Connection â”€â”€&gt; Channel)â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ RabbitMQ çš„å…¸å‹åº”ç”¨åœºæ™¯ åº”ç”¨åœºæ™¯ è¯´æ˜ å¼‚æ­¥å¤„ç† ç”¨æˆ·è¯·æ±‚ä¸ç›´æ¥å¤„ç†ï¼Œæ¶ˆæ¯å…¥é˜Ÿåç”±åå°å¼‚æ­¥æ¶ˆè´¹ï¼Œä¾‹å¦‚é‚®ä»¶å‘é€ã€å›¾ç‰‡å¤„ç† å‰Šå³°å¡«è°· ç¼“å†²é«˜å³°æµé‡ï¼Œå¹³æ»‘ç³»ç»Ÿå‹åŠ› ç³»ç»Ÿè§£è€¦ ä¸åŒæœåŠ¡ä¹‹é—´ä¸ç›´æ¥è°ƒç”¨ï¼Œé™ä½è€¦åˆ å¹¿æ’­/é€šçŸ¥ å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œå®ç°å¤šæœåŠ¡åŒæ—¶æ”¶åˆ°æ¶ˆæ¯ æ—¥å¿—æ”¶é›† ç»Ÿä¸€æ¥æ”¶ã€åˆ†å‘æ—¥å¿—åˆ°ä¸åŒå¤„ç†ç³»ç»Ÿ RabbitMQ 4.0+ æœ‰å“ªäº›å‡çº§ ç‰¹æ€§æ ‡å¿—ï¼ˆFeature Flagsï¼‰çš„ä¼˜åŒ–ä¸å¼ºåˆ¶æ€§è¦æ±‚ åœ¨å‡çº§åˆ° 4.0 ä¹‹å‰ï¼Œç”¨æˆ·å¿…é¡»å…ˆå‡çº§åˆ° 3.13.x ç‰ˆæœ¬å¹¶æ‰‹åŠ¨å¯ç”¨æ‰€æœ‰ç¨³å®šçš„ç‰¹æ€§æ ‡å¿—ã€‚ ä» 4.0+ å¼€å§‹ï¼Œå¦‚æœé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ”¯æŒæŸä¸ªå¿…éœ€çš„ç‰¹æ€§æ ‡å¿—ï¼Œç³»ç»Ÿä¼šåœ¨èŠ‚ç‚¹å¯åŠ¨æ—¶è‡ªåŠ¨å¯ç”¨è¯¥æ ‡å¿—ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚ AMQP åè®®çš„å¢å¼º æ–°å¢äº†å¯¹ AMQP è¿‡æ»¤è¡¨è¾¾å¼ï¼ˆAMQP Filter Expressionsï¼‰Version 1.0 Working Draft 09 çš„æ”¯æŒã€‚ MQTT åè®®çš„æ”¹è¿› é»˜è®¤çš„ MQTT æœ€å¤§åŒ…å¤§å°ä»ä¹‹å‰çš„ 256 MiB é™ä½åˆ° 16 MiBï¼ŒåŒæ—¶ä»å…è®¸ç”¨æˆ·é€šè¿‡é…ç½®é¡¹ mqtt.max_packet_size_authenticated è‡ªå®šä¹‰è¯¥å€¼ Classicé˜Ÿåˆ—çš„å˜åŒ– åˆ é™¤äº†å¯¹ Classicé˜Ÿåˆ— version1 çš„æ”¯æŒï¼Œé»˜è®¤å°±æ˜¯ version2 ä¸å†æ”¯æŒ Classicé˜Ÿåˆ— çš„é•œåƒåŠŸèƒ½ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Quorum é˜Ÿåˆ— ï¼Œæœªæ¥ä¼šå°† Quorum é˜Ÿåˆ— ä½œä¸ºé»˜è®¤é˜Ÿåˆ—ã€‚ é›†ç¾¤çŠ¶æ€ä¸‹åˆ›å»º Quorum é˜Ÿåˆ— å’Œ Stream é˜Ÿåˆ— ä¼šè‡ªåŠ¨å‡çº§ä¸º å¤åˆ¶é˜Ÿåˆ—ï¼ˆé•œåƒï¼‰ RabbitMQ å•æœºå®‰è£… å®‰è£…Erlang RabbitMQæ˜¯åŸºäºErlangè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥å®‰è£…RabbitMQä¹‹å‰éœ€è¦å®‰è£…Erlangè¯­è¨€ç¯å¢ƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯RabbitMQä¸Erlangè¯­è¨€ä¹‹é—´æ˜¯æœ‰ç‰ˆæœ¬å¯¹åº”å…³ç³»çš„ã€‚å‚è€ƒå®˜æ–¹æ–‡æ¡£Erlang Version Requirements ç›®å‰RabbitMQæœ€æ–°ç‰ˆæœ¬æ˜¯4.1.4ï¼ŒErlangç‰ˆæœ¬å¯ä»¥é€‰æ‹© 27.xï¼ŒGitHubä¸‹è½½åœ°å€ 123456789101112# ä¸‹è½½ el9 çš„ç‰ˆæœ¬ï¼Œå¯¹åº” CentOS 9wget https://github.com/rabbitmq/erlang-rpm/releases/download/v27.3.4.3/erlang-27.3.4.3-1.el9.x86_64.rpm# å®‰è£…sudo rpm -ivh erlang-27.3.4.3-1.el9.x86_64.rpm# æŸ¥çœ‹å®‰è£…çš„ç‰ˆæœ¬erl# è¾“å‡ºç±»ä¼¼äºï¼Œè¿™é‡Œ Erlang/OTP 27 å°±è¡¨ç¤ºå®‰è£…çš„æ˜¯ 27.x ç‰ˆæœ¬Erlang/OTP 27 [erts-15.2.7.2] [source] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:1] [jit:ns]Eshell V15.2.7.2 (press Ctrl+G to abort, type help(). for help)1&gt; q(). # é€€å‡ºå‘½ä»¤ï¼Œæ³¨æ„æ˜¯æ‹¬å·åé¢è¿˜æœ‰ä¸€ä¸ªç‚¹ã€‚è¾“å…¥ help(). æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ok å®‰è£… RabbitMQ ç›®å‰RabbitMQæœ€æ–°ç‰ˆæœ¬æ˜¯4.1.4ï¼ŒGitHubä¸‹è½½åœ°å€] 123456789# ä¸‹è½½ï¼Œnoarch è¡¨ç¤ºæ¶æ„æ— å…³ï¼Œå³ X86_64 å’Œ ARM64 éƒ½å¯ä»¥# å› ä¸ºæ²¡æœ‰å¯¹åº”çš„ el9 çš„åŒ…ï¼Œæ‰€ä»¥åªèƒ½ç”¨ el8 çš„åŒ…äº†ï¼Œå®é™…ä½¿ç”¨ä¸­æ²¡æœ‰é—®é¢˜ã€‚wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v4.1.4/rabbitmq-server-4.1.4-1.el8.noarch.rpm# å®‰è£…sudo rpm -ivh rabbitmq-server-4.1.4-1.el8.noarch.rpm# æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯rabbitmq-diagnostics version # æ— éœ€å¯åŠ¨æœåŠ¡# RabbitMQ æœåŠ¡å¯åŠ¨åæ–¹å¯æ­£ç¡®è¾“å‡ºrabbitmqctl version RabbitMQ å¯åŠ¨ä¸åœæ­¢å‘½ä»¤ Erlang VM æ˜¯ Erlang è¯­è¨€è¿è¡Œç¯å¢ƒï¼ŒRabbitMQ åº”ç”¨è¿è¡Œåœ¨ Erlang VM ä¸‹ã€‚ å¯åŠ¨ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨ 1234567# å¯åŠ¨ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨sudo systemctl start rabbitmq-server# æˆ–è€…ï¼Œ--detached åå°è¿è¡Œï¼Œä¸åŠ å°±æ˜¯å‰å°è¿è¡Œsudo rabbitmq-server -detached# å•ç‹¬å¯åŠ¨ åº”ç”¨ï¼Œæ­¤æ—¶éœ€è¦ä¿è¯ RabbitMQ æœåŠ¡(Erlang VM) æ­£åœ¨è¿è¡Œï¼Œä¸€èˆ¬é‡å¯ åº”ç”¨ æ—¶ä½¿ç”¨è¯¥å‘½ä»¤sudo rabbitmqctl start_app åœæ­¢ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨ 1234567# åœæ­¢ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨sudo systemctl stop rabbitmq-server# æˆ–è€…ï¼Œå•æœºæ¨¡å¼ stopï¼Œé›†ç¾¤æ¨¡å¼ shutdownsudo rabbitmqctl stop / shutdown# å•ç‹¬åœæ­¢ RabbitMQ åº”ç”¨ï¼Œæ­¤æ—¶éœ€è¦ä¿è¯ RabbitMQ æœåŠ¡(Erlang VM) æ­£åœ¨è¿è¡Œï¼Œä¸€èˆ¬é‡å¯ åº”ç”¨ æ—¶ä½¿ç”¨è¯¥å‘½ä»¤sudo rabbitmqctl stop_app æŸ¥çœ‹RabbitMQ æœåŠ¡çŠ¶æ€ 123sudo systemctl status rabbitmq-server# æˆ–è€…sudo rabbitmqctl status RabbitMQ åœ¨ CentOS 9 (RPM å®‰è£…) çš„ç›®å½•ç»“æ„ ç±»å‹ ç›®å½•è·¯å¾„ è¯´æ˜ é…ç½®æ–‡ä»¶ /etc/rabbitmq rabbitmq.confã€advanced.config ç­‰é…ç½® æ—¥å¿—æ–‡ä»¶ /var/log/rabbitmq RabbitMQ è¿è¡Œæ—¥å¿—ï¼Œé»˜è®¤å­˜æ”¾åœ¨è¿™é‡Œ æ•°æ®ç›®å½• /var/lib/rabbitmq/mnesia æ¶ˆæ¯é˜Ÿåˆ—ã€å…ƒæ•°æ®å­˜å‚¨ç›®å½• Erlang Cookie /var/lib/rabbitmq/.erlang.cookie Erlang èŠ‚ç‚¹é—´é€šä¿¡çš„ cookie æ–‡ä»¶ å¯æ‰§è¡Œæ–‡ä»¶ /usr/lib/rabbitmq/bin rabbitmq-serverã€rabbitmqctl ç­‰å‘½ä»¤ å¯åŠ¨è„šæœ¬ /usr/lib/systemd/system/rabbitmq-server.service systemd ç®¡ç† RabbitMQ çš„å¯åŠ¨è„šæœ¬ æ’ä»¶ç›®å½• /usr/lib/rabbitmq/lib/rabbitmq_server-&lt;version&gt;/plugins æ‰€æœ‰æ’ä»¶æ–‡ä»¶å­˜æ”¾è·¯å¾„ æ¿€æ´»Webç®¡ç†æ§åˆ¶å°æ’ä»¶ å¯¹äº RabbitMQ æ‰€æœ‰çš„æ“ä½œåŸºæœ¬éƒ½å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå®Œæˆï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥å¹¶ä¸æ–¹ä¾¿ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥æ¿€æ´» rabbitmq_management æ’ä»¶ï¼Œè¯¥æ’ä»¶æä¾›äº† Web ç®¡ç†æ§åˆ¶å°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Web ç®¡ç†æ§åˆ¶å°æ¥ç®¡ç† RabbitMQ rabbitmq_management æ’ä»¶ä¸º å®˜æ–¹æ’ä»¶ï¼Œé»˜è®¤å·²ç»å®‰è£…ï¼Œä¸éœ€è¦ä¸‹è½½ï¼Œç›´æ¥æ¿€æ´»å³å¯ 12# æ¿€æ´»æ’ä»¶sudo rabbitmq-plugins enable rabbitmq_management è¯¥æ’ä»¶é™¤äº†æä¾›äº† Web ç®¡ç†æ§åˆ¶å° ï¼Œè¿˜æä¾› åŸºäº HTTP çš„ API ç”¨äºç®¡ç†å’Œç›‘æ§ RabbitMQ èŠ‚ç‚¹å’Œé›†ç¾¤ï¼Œä»¥åŠ å‘½ä»¤è¡Œå·¥å…· rabbitmqadminï¼Œè¿™ä¸ªåé¢ä¼šä»‹ç»ã€‚ è®¾ç½®è¿œç¨‹è®¿é—®å¸å· æ’ä»¶æ¿€æ´»åå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® http://&lt;ip&gt;:15672ï¼Œrabbitmq_management æ’ä»¶é»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ guestï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹å…¶åªèƒ½é€šè¿‡ 127.0.0.1 è®¿é—®ï¼Œæ­¤æ—¶æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ 1. å…è®¸ guest è´¦å·è¿œç¨‹è®¿é—® 123456# ä¿®æ”¹ /etc/rabbitmq/rabbitmq.conf æ–‡ä»¶# å…è®¸guestç”¨æˆ·è¿œç¨‹è®¿é—®ï¼Œ`å®˜æ–¹ä¸æ¨è` ä¸€ç›´å¼€å¯ï¼Œå»ºè®®å¼€å¯ååœ¨ web æ§åˆ¶å°ä¸­åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ï¼Œç„¶åç«‹åˆ»å…³é—­è¯¥é…ç½®loopback_users.guest = false# é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ³¨æ„è¿™é‡Œ user å¦‚æœæ”¹æˆ adminï¼Œåˆ™ä¸Šé¢çš„å¼€å¯è¿œç¨‹è®¿é—®ä¸­çš„ guest ä¹Ÿè¦æ”¹æˆ admindefault_user = guestdefault_pass = guest ä¿®æ”¹å®Œæˆåï¼Œé‡å¯ RabbitMQ æœåŠ¡ 1sudo systemctl restart rabbitmq-server 2. æ–°åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿œç¨‹è®¿é—®çš„ç®¡ç†å‘˜è´¦å· åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œæ¯”å¦‚è¿™é‡Œ ç”¨æˆ·åä¸º adminï¼Œå¯†ç ä¸º rabbitmq 1sudo rabbitmqctl add_user admin rabbitmq ç»™ç®¡ç†å‘˜è´¦å·æ·»åŠ èµ„æºç®¡ç†æƒé™ 1sudo rabbitmqctl set_permissions -p / admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot; éƒ¨åˆ† è§£é‡Š rabbitmqctl RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†ç”¨æˆ·ã€æƒé™ã€é˜Ÿåˆ—ã€äº¤æ¢æœºç­‰ã€‚ set_permissions è®¾ç½®æŒ‡å®šç”¨æˆ·åœ¨æŸä¸ªè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ä¸‹çš„æƒé™ã€‚ -p / æŒ‡å®šè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ã€‚è¿™é‡Œçš„ / æ˜¯é»˜è®¤è™šæ‹Ÿä¸»æœºã€‚ admin ç”¨æˆ·åï¼Œè¿™é‡Œæ˜¯ä¸º admin ç”¨æˆ·è®¾ç½®æƒé™ã€‚ &quot;.*&quot;ï¼ˆé…ç½®æƒé™ï¼‰ ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·å¯¹èµ„æºé…ç½®çš„æƒé™ï¼Œæ¯”å¦‚åˆ›å»ºäº¤æ¢æœºã€é˜Ÿåˆ—ã€ç»‘å®šç­‰ã€‚&quot;.*&quot; è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚ &quot;.*&quot;ï¼ˆå†™æƒé™ï¼‰ ç¬¬äºŒä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·å‘å“ªäº›èµ„æºå‘é€æ¶ˆæ¯ã€‚&quot;.*&quot; è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚ &quot;.*&quot;ï¼ˆè¯»æƒé™ï¼‰ ç¬¬ä¸‰ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·ä»å“ªäº›èµ„æºæ¶ˆè´¹æ¶ˆæ¯ã€‚&quot;.*&quot; è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚ è®¾ç½®adminè´¦å·ä¸ºæ§åˆ¶å°ç®¡ç†å‘˜ 1sudo rabbitmqctl set_user_tags admin administrator éƒ¨åˆ† è§£é‡Š rabbitmqctl RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ã€‚ set_user_tags ç”¨æ¥ä¸ºç”¨æˆ·è®¾ç½®æ ‡ç­¾ï¼ˆtagï¼‰ï¼Œæ ‡ç­¾å†³å®šäº†ç”¨æˆ·åœ¨ç®¡ç†ç•Œé¢æˆ– API ä¸­çš„æƒé™çº§åˆ«ã€‚ admin ç”¨æˆ·åï¼Œè¿™é‡Œæ˜¯ä¸º admin ç”¨æˆ·è®¾ç½®æ ‡ç­¾ã€‚ administrator æ ‡ç­¾åï¼Œè¡¨ç¤ºç»™è¯¥ç”¨æˆ·èµ‹äºˆç®¡ç†å‘˜æƒé™ã€‚ å¸¸è§çš„ç”¨æˆ·æ ‡ç­¾ æ ‡ç­¾ è¯´æ˜ administrator ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æœ€é«˜æƒé™ï¼Œå¯é€šè¿‡ Web ç®¡ç†ç•Œé¢ã€CLIã€API ç®¡ç† RabbitMQ æ‰€æœ‰å†…å®¹ monitoring ç›‘æ§ç”¨æˆ·ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰ç›‘æ§ä¿¡æ¯ï¼Œä½†ä¸èƒ½ä¿®æ”¹é…ç½® management æ™®é€šç®¡ç†ç”¨æˆ·ï¼Œå¯ä»¥ç™»å½•ç®¡ç†ç•Œé¢ï¼Œä½†æƒé™å—é™ policymaker ç­–ç•¥ç®¡ç†ç”¨æˆ·ï¼Œå¯ä»¥ç®¡ç†ç­–ç•¥å’Œå‚æ•°ï¼Œä½†ä¸èƒ½ç®¡ç†å…¶ä»–ç”¨æˆ· æ— æ ‡ç­¾ æ™®é€šç”¨æˆ·ï¼Œåªèƒ½æ”¶å‘æ¶ˆæ¯ï¼Œä¸èƒ½ç™»å½•ç®¡ç†ç•Œé¢ set_permissions ä¸ set_user_tags æ€»ç»“å¯¹æ¯” å‘½ä»¤ æ§åˆ¶èŒƒå›´ ä¸»è¦ä½œç”¨ set_permissions vhost å†…çš„èµ„æº å‘æ¶ˆæ¯ã€æ”¶æ¶ˆæ¯ã€åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœº set_user_tags ç®¡ç†ç•Œé¢ã€ç®¡ç† API ç”¨æˆ·ç®¡ç†ã€ç­–ç•¥ç®¡ç†ã€é›†ç¾¤ç®¡ç† å¯ç”¨æ‰€æœ‰ç¨³å®šçš„ Feature Flags ç™»å½•æ§åˆ¶å°åæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€æ¡å‘Šè­¦ä¿¡æ¯ï¼Œå‚è€ƒï¼šFeature Flags 1âš  All stable feature flags must be enabled after completing an upgrade. å®ƒçš„æ„æ€æ˜¯ï¼šRabbitMQ åœ¨æ–°ç‰ˆæœ¬ä¸­å¼•å…¥äº†ä¸€äº› Feature Flagsï¼ˆç‰¹æ€§æ ‡å¿—ï¼‰ï¼Œè¿™äº›ç‰¹æ€§æ ‡å¿—ç”¨äºæ§åˆ¶ä¸€äº›æ–°çš„åŠŸèƒ½æˆ–è¡Œä¸ºæ˜¯å¦å¯ç”¨ã€‚å‡çº§ RabbitMQ åï¼Œæœ‰äº›åŠŸèƒ½ä¼šå¤„äº æœªå¯ç”¨çŠ¶æ€ï¼Œéœ€è¦ä½ æ‰‹åŠ¨å¼€å¯ï¼Œç¡®ä¿é›†ç¾¤å®Œå…¨è¿è¡Œåœ¨æœ€æ–°çš„åŠŸèƒ½æ¨¡å¼ä¸‹ã€‚ èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆæœ‰ Feature Flagsï¼Ÿ å‘åå…¼å®¹ï¼šRabbitMQ å‡çº§æ—¶ï¼Œå¯èƒ½å¼•å…¥äº†æ–°çš„æ•°æ®æ ¼å¼æˆ–å†…éƒ¨æœºåˆ¶ï¼Œå¦‚æœç«‹å³å¯ç”¨ï¼Œæ—§ç‰ˆæœ¬èŠ‚ç‚¹å¯èƒ½æ— æ³•ç†è§£ã€‚ æ»šåŠ¨å‡çº§æ”¯æŒï¼šå‡çº§é›†ç¾¤æ—¶ï¼Œå¯ä»¥å…ˆå‡çº§èŠ‚ç‚¹ï¼Œå†ç»Ÿä¸€å¯ç”¨åŠŸèƒ½ï¼Œé¿å…ä¸­é€”å‡ºé—®é¢˜ã€‚ å¯æ§æ€§ï¼šä½ å¯ä»¥é€‰æ‹©åœ¨ç¡®è®¤é›†ç¾¤ç¨³å®šåå†å¯ç”¨æ–°åŠŸèƒ½ã€‚ æŸ¥çœ‹å½“å‰ Feature Flags çŠ¶æ€ 1234567891011121314151617rabbitmqctl -q --formatter pretty_table list_feature_flags# è¾“å‡ºä¼šç±»ä¼¼è¿™æ ·ï¼šâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ name â”‚ state â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ classic_mirrored_queue_version â”‚ enabled â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ classic_queue_type_delivery_support â”‚ enabled â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ detailed_queues_endpoint â”‚ disabled â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ direct_exchange_routing_v2 â”‚ enabled â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&gt; enabledï¼šç‰¹æ€§å·²å¯ç”¨&gt; disabledï¼šç‰¹æ€§æœªå¯ç”¨ å¯ä»¥è¾“å‡º å…¶å®ƒ æ ¼å¼ï¼Œæ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯ 1234# jsonrabbitmqctl -q --formatter json list_feature_flags name state provided_by desc doc_url | jq# tablerabbitmqctl -q --formatter pretty_table list_feature_flags name state provided_by desc doc_url å¯ç”¨æ‰€æœ‰å·²æ ‡è®°ä¸º stable çš„ç‰¹æ€§ï¼Œå»ºè®®å‡çº§ä¸‹ä¸€ä¸ª RabbitMQ ç‰ˆæœ¬ å‰ä¸€å®šè¦ç¡®ä¿å½“å‰ç‰ˆæœ¬çš„ Feature Flags éƒ½æ˜¯å¯ç”¨çš„ï¼Œé¿å…å‡çº§åæ— æ³•é¡ºåˆ©å¯åŠ¨æœåŠ¡ã€‚ 1rabbitmqctl enable_feature_flag all åœ¨æ§åˆ¶å°ä¸­ä¹Ÿå¯ä»¥æŸ¥çœ‹å’Œå¼€å¯è¿™äº› Feature Flags çš„çŠ¶æ€ è¿™é‡Œè¦æ³¨æ„ï¼ŒFeature Flags ä¸€æ—¦å¼€å¯å°±æ— æ³•å…³é—­ã€‚ RabbitMQ é…ç½®æ–‡ä»¶ å¯¹äº RPM/YUM/DNF å®‰è£…çš„ RabbitMQï¼Œé…ç½®æ–‡ä»¶é»˜è®¤è·¯å¾„æ˜¯ æ–‡ä»¶ç±»å‹ é»˜è®¤ä½ç½® ä½œç”¨ ä¸»é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰ /etc/rabbitmq/rabbitmq.conf ä½¿ç”¨ INI æ ¼å¼ï¼Œä¸»è¦é…ç½®éƒ½åœ¨è¿™é‡Œ ç¯å¢ƒå˜é‡é…ç½® /etc/rabbitmq/rabbitmq-env.conf å®šä¹‰èŠ‚ç‚¹åã€Cookie ä½ç½®ã€æ•°æ®/æ—¥å¿—ç›®å½•ç­‰ å®‰è£…å /etc/rabbitmq/ ç›®å½•å¯èƒ½æ˜¯ç©ºçš„ï¼Œä½ éœ€è¦æ‰‹åŠ¨åˆ›å»º rabbitmq.confï¼Œè¯¦ç»†çš„å‚æ•°è¯´æ˜å¯ä»¥å‚çœ‹å®˜ç½‘æŒ‡å—ï¼Œrabbitmq.conf ç¤ºä¾‹ 123456# /etc/rabbitmq/rabbitmq.conf# ç›‘å¬ç«¯å£listeners.tcp.default = 5672# ç®¡ç†ç•Œé¢ç«¯å£management.tcp.port = 15672 rabbitmq-env.conf ç”¨æ¥ å®šä¹‰èŠ‚ç‚¹åã€Cookie ã€æ•°æ®/æ—¥å¿—ç›®å½•ç­‰çš„ç¯å¢ƒå˜é‡ï¼ŒRabbitMQ å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¯»å–è¯¥æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯é€šè¿‡ RPM å®‰è£…çš„ RabbitMQ çš„é»˜è®¤å€¼ 12345678910111213141516171819202122# /etc/rabbitmq/rabbitmq-env.conf# èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤ä½¿ç”¨ä¸»æœºçŸ­å(hostname -s)ï¼Œä¾‹å¦‚ rabbit@myhostNODENAME=rabbit@&lt;hostname&gt;# ç»‘å®šçš„ IP åœ°å€ï¼Œç•™ç©ºè¡¨ç¤ºç›‘å¬æ‰€æœ‰åœ°å€ï¼Œç­‰ä»·äº 0.0.0.0NODE_IP_ADDRESS=# AMQP åè®®ç«¯å£ï¼Œé»˜è®¤ 5672NODE_PORT=5672# RabbitMQ æ•°æ®åº“å­˜å‚¨ç›®å½•MNESIA_BASE=/var/lib/rabbitmq/mnesia# æ—¥å¿—å­˜æ”¾ç›®å½•LOG_BASE=/var/log/rabbitmq# é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œä¸å¸¦ .conf åç¼€CONFIG_FILE=/etc/rabbitmq/rabbitmq# æ˜¯å¦ä½¿ç”¨é•¿ä¸»æœºåï¼Œtrue/false (é•¿ä¸»æœºå hostname -f)USE_LONGNAME=false ä¸¤ä¸ªæ–‡ä»¶çš„ä½œç”¨ æ–‡ä»¶ ä½œç”¨èŒƒå›´ å…¸å‹å‚æ•° ä½•æ—¶åŠ è½½ rabbitmq-env.conf è®¾ç½® RabbitMQ å¯åŠ¨æ—¶çš„ ç¯å¢ƒå˜é‡ NODENAME, NODE_IP_ADDRESS, NODE_PORT, LOG_BASE, MNESIA_BASE åœ¨å¯åŠ¨ RabbitMQ æœåŠ¡å‰ç”± rabbitmq-env è„šæœ¬è¯»å– rabbitmq.conf RabbitMQ è¿è¡Œæ—¶é…ç½®ï¼ˆå†…éƒ¨å‚æ•°ã€æ’ä»¶é…ç½®ç­‰ï¼‰ listeners.tcp.default, log, cluster_formation ç­‰ RabbitMQ å¯åŠ¨åç”± Erlang VM å†…éƒ¨è¯»å– rabbitmq-env.conf å†³å®š RabbitMQ å¯åŠ¨æ—¶çš„åŸºæœ¬ç¯å¢ƒï¼Œæ¯”å¦‚èŠ‚ç‚¹åã€æ•°æ®ç›®å½•ã€ç›‘å¬ IP ç­‰ï¼Œå¿…é¡»åœ¨å¯åŠ¨å‰å°±ç¡®å®šã€‚ rabbitmq.conf å†³å®šè¿è¡Œæ—¶çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç«¯å£ç›‘å¬ã€æ—¥å¿—ç­‰çº§ã€é›†ç¾¤é…ç½®ç­‰ï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œé‡å¯åº”ç”¨åç”Ÿæ•ˆã€‚ rabbitmq-env.conf å˜é‡ rabbitmq.conf å¯¹åº”é…ç½® ä¼˜å…ˆçº§ è¯´æ˜ NODE_IP_ADDRESS listeners.tcp.default = &lt;IP&gt; rabbitmq.conf åªè¦åœ¨ rabbitmq.conf é‡Œé…ç½®ï¼Œå°±è¦†ç›–ç¯å¢ƒå˜é‡ NODE_PORT listeners.tcp.default = &lt;Port&gt; rabbitmq.conf åŒä¸Šï¼ŒIP å’Œç«¯å£å¯ä»¥ä¸€èµ·é…ç½® NODENAME æ— ç›´æ¥å¯¹åº” rabbitmq-env.conf èŠ‚ç‚¹ååªèƒ½é€šè¿‡ rabbitmq-env.conf æˆ–ç¯å¢ƒå˜é‡è®¾å®š MNESIA_BASE æ— ç›´æ¥å¯¹åº” rabbitmq-env.conf æ•°æ®ç›®å½•åªèƒ½åœ¨å¯åŠ¨å‰è®¾å®š LOG_BASE log.dir = &lt;path&gt; rabbitmq.conf è¿è¡Œæ—¶é…ç½®è¦†ç›–ç¯å¢ƒå˜é‡ CONFIG_FILE æ— ç›´æ¥å¯¹åº” rabbitmq-env.conf è¿™ä¸ªåªå†³å®šåŠ è½½å“ªä¸ª rabbitmq.conf æ–‡ä»¶ USE_LONGNAME æ— ç›´æ¥å¯¹åº” rabbitmq-env.conf èŠ‚ç‚¹åæ˜¯å¦ä½¿ç”¨é•¿ä¸»æœºååªèƒ½å¯åŠ¨å‰å†³å®š RabbitMQ ç¯å¢ƒå˜é‡ rabbitmq-env.conf æ–‡ä»¶å°±æ˜¯ç”¨æ¥å®šä¹‰ç¯å¢ƒå˜é‡çš„ï¼Œä½†è¦æ³¨æ„ï¼Œrabbitmq-env.conf æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ å»æ‰äº† RABBITMQ_ å‰ç¼€ï¼Œä¾‹å¦‚åœ¨ç¯å¢ƒä¸­è®¾ç½®çš„å˜é‡åé€šå¸¸æ˜¯ RABBITMQ_NODENAMEï¼Œä½†åœ¨ rabbitmq-env.conf ä¸­ï¼Œè®¾ç½®å˜é‡æ—¶ä¼šå»æ‰ RABBITMQ_ å‰ç¼€ï¼Œç›´æ¥ä½¿ç”¨ NODENAMEã€‚ 123456789# åœ¨ rabbitmq-env.conf ä¸­é…ç½®NODENAME=rabbit@localhostNODE_PORT=5672LOG_BASE=/var/log/rabbitmq# è€Œåœ¨ç¯å¢ƒä¸­ï¼Œä½ å®é™…è®¾ç½®çš„å˜é‡æ˜¯export RABBITMQ_NODENAME=rabbit@localhostexport RABBITMQ_NODE_PORT=5672export RABBITMQ_LOG_BASE=/var/log/rabbitmq ç¯å¢ƒå˜é‡åç§° æè¿° Linux RPM å®‰è£…çš„é»˜è®¤å€¼ RABBITMQ_BASE åªé’ˆå¯¹ Windows ç³»ç»Ÿã€‚è¯¥åŸºç›®å½•åŒ…å« RabbitMQ æœåŠ¡å™¨çš„æ•°æ®åº“å’Œæ—¥å¿—æ–‡ä»¶çš„å­ç›®å½•ã€‚ æ— ï¼ˆä»…é€‚ç”¨äº Windowsï¼‰ RABBITMQ_CONFIG_FILE é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œæ²¡æœ‰ .config æ‰©å±•åã€‚RabbitMQ æœåŠ¡å™¨ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶æ¥é…ç½®ç»„ä»¶ã€‚ é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ï¼š/etc/rabbitmq/rabbitmq.conf RABBITMQ_GENERATED_CONFIG_DIR RabbitMQ å†™å…¥å…¶ç”Ÿæˆçš„é…ç½®æ–‡ä»¶çš„ç›®å½•ã€‚ é»˜è®¤ç”Ÿæˆè·¯å¾„ï¼š/var/lib/rabbitmq/mnesia RABBITMQ_MNESIA_BASE RabbitMQ æœåŠ¡å™¨èŠ‚ç‚¹æ•°æ®åº“ã€æ¶ˆæ¯å­˜å‚¨å’Œé›†ç¾¤çŠ¶æ€æ–‡ä»¶çš„åŸºç›®å½•ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªã€‚é€šå¸¸ä¼šè¦†ç›– RABBITMQ_MNESIA_DIRã€‚ é»˜è®¤å€¼ï¼š/var/lib/rabbitmq/mnesia RABBITMQ_MNESIA_DIR å­˜å‚¨ RabbitMQ èŠ‚ç‚¹æ•°æ®çš„ç›®å½•ï¼ŒåŒ…å«æ¨¡å¼æ•°æ®åº“ã€æ¶ˆæ¯å­˜å‚¨ã€é›†ç¾¤æˆå‘˜ä¿¡æ¯å’Œå…¶ä»–æŒä¹…èŠ‚ç‚¹çŠ¶æ€ã€‚ é»˜è®¤å€¼ï¼š/var/lib/rabbitmq/mnesia/rabbit@&lt;hostname&gt; RABBITMQ_SCHEMA_DIR RabbitMQ ä¿å­˜æ–°æ ¼å¼é…ç½®æ–‡ä»¶ä½¿ç”¨çš„é…ç½®æ¨¡å¼çš„ç›®å½•ã€‚ é»˜è®¤å€¼ï¼š/etc/rabbitmq RABBITMQ_LOG_BASE è¯¥åŸºç›®å½•åŒ…å« RabbitMQ æœåŠ¡å™¨çš„æ—¥å¿—æ–‡ä»¶ã€‚ é»˜è®¤å€¼ï¼š/var/log/rabbitmq RABBITMQ_LOGS RabbitMQ æœåŠ¡å™¨çš„ Erlang æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚ é»˜è®¤å€¼ï¼š/var/log/rabbitmq/rabbitmq.log RABBITMQ_PLUGINS_DIR RabbitMQ çš„æ’ä»¶ç›®å½•ã€‚è·¯å¾„ç”±ç‰¹å®šæ“ä½œç³»ç»Ÿçš„åˆ†éš”ç¬¦å®šä¹‰ï¼ˆUnix ä½¿ç”¨ :ï¼ŒWindows ä½¿ç”¨ ;ï¼‰ã€‚ é»˜è®¤å€¼ï¼š/usr/lib/rabbitmq/plugins RABBITMQ_PLUGINS_EXPAND_DIR ç”¨äºå±•å¼€å¯ç”¨çš„æ’ä»¶çš„å·¥ä½œç›®å½•ã€‚ç¡®ä¿æœ‰æ•ˆçš„ RabbitMQ ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™è¯»å–å’Œåˆ›å»ºè¯¥ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ é»˜è®¤å€¼ï¼š/var/lib/rabbitmq/mnesia RABBITMQ_ENABLED_PLUGINS_FILE æ˜¾å¼è®°å½•å¯ç”¨çš„æ’ä»¶çš„æ–‡ä»¶ï¼Œå¯ç”¨æˆ–ç¦ç”¨æ’ä»¶æ—¶ä¼šé‡æ–°åˆ›å»ºè¯¥æ–‡ä»¶ã€‚ç¡®ä¿æœ‰æ•ˆçš„ RabbitMQ ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™éšæ—¶è¯»å–ã€å†™å…¥å’Œåˆ›å»ºè¯¥æ–‡ä»¶ã€‚ é»˜è®¤å€¼ï¼š/var/lib/rabbitmq/.enabled_plugins RABBITMQ_PID_FILE ç”¨äº rabbitmqctl çš„è¿›ç¨‹ ID æ–‡ä»¶ã€‚ é»˜è®¤å€¼ï¼š/var/run/rabbitmq/rabbitmq.pid å°è´´å£« å®‰è£…å¥½ RabbitMQ åï¼Œä¸è¦éšä¾¿ä¿®æ”¹ hostnameï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQ çš„æ•°æ®ç›®å½•æ˜¯åŸºäº hostname åˆ›å»ºçš„ï¼Œå¦‚æœä¿®æ”¹äº† hostnameï¼ŒRabbitMQ å°±ä¼šæŒ‡å‘æ–°çš„æ•°æ®ç›®å½• æ•°æ®ç›®å½•é»˜è®¤æ˜¯ /var/lib/rabbitmq/mnesia/rabbit@&lt;hostname&gt; å¦‚æœä¿®æ”¹äº† hostnameï¼Œä½†ä»è¦ä½¿ç”¨åŸæ¥çš„æ•°æ®ç›®å½•ï¼Œå¯ä»¥è®¾ç½® RABBITMQ_MNESIA_DIR ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å‘åŸæ¥çš„æ•°æ®ç›®å½• RabbitMQ ç›¸å…³å‘½ä»¤ æ—¥å¸¸ä½¿ç”¨ä¸­ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ Web ç®¡ç†ç•Œé¢æ“ä½œï¼Œè¿™é‡Œä»…å¯¹å‘½ä»¤è¿›è¡Œç®€è¦ä»‹ç»ã€‚ å‘½ä»¤ ä½œç”¨ï¼ˆç®€è¦ï¼‰ å¸¸ç”¨ç¤ºä¾‹ï¼ˆå…¸å‹ç”¨æ³• + ä¸­æ–‡è¯´æ˜ï¼‰ rabbitmq-defaults å®šä¹‰/æ˜¾ç¤º RabbitMQ å®‰è£…é»˜è®¤ç›®å½•å’Œè¿è¡Œæ—¶å‰ç¼€ ç¼–è¾‘ sbin/rabbitmq-defaults ä¸­ PREFIX/SYS_PREFIXï¼ˆä¿®æ”¹é»˜è®¤ç›®å½•åˆ°ç³»ç»Ÿç›®å½•ï¼‰ rabbitmq-diagnostics å¥åº·æ£€æŸ¥ / è¯Šæ–­å·¥å…·ï¼Œå¯ç”¨äºç›‘æ§ rabbitmq-diagnostics -q pingï¼ˆæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ï¼‰rabbitmq-diagnostics -q statusï¼ˆæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼‰rabbitmq-diagnostics -q check_runningï¼ˆç¡®è®¤èŠ‚ç‚¹è¿è¡Œä¸­ï¼‰ rabbitmq-env rabbitmq-env å…¶å®ä¸æ˜¯ä¸€ä¸ªç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œå•ç‹¬ä½¿ç”¨çš„å·¥å…·ï¼Œè€Œæ˜¯ RabbitMQ æœåŠ¡å¯åŠ¨è„šæœ¬ ä¸­ç”¨æ¥åŠ è½½ RabbitMQ ç¯å¢ƒå˜é‡çš„è„šæœ¬ã€‚ åœ¨ /etc/rabbitmq/rabbitmq-env.conf ä¸­è®¾ç½®ï¼šRABBITMQ_NODENAME=myrabbitï¼ˆè®¾ç½®èŠ‚ç‚¹åï¼‰æˆ–ç”¨ rabbitmq-env è¾“å‡ºæŸ¥çœ‹å®é™…ç¯å¢ƒ rabbitmq-plugins æ’ä»¶ç®¡ç†ï¼šåˆ—å‡º/å¯ç”¨/ç¦ç”¨æ’ä»¶ rabbitmq-plugins listï¼ˆåˆ—å‡ºæ‰€æœ‰æ’ä»¶ï¼‰rabbitmq-plugins enable rabbitmq_managementï¼ˆå¯ç”¨ Web ç®¡ç†æ’ä»¶ï¼‰rabbitmq-plugins disable --offline pluginï¼ˆç¦»çº¿ç¦ç”¨æ’ä»¶ï¼‰ rabbitmq-queues é˜Ÿåˆ—å‰¯æœ¬ç®¡ç†ï¼šrebalance/grow/shrink rabbitmq-queues rebalance all --vhost-pattern &quot;.*&quot; --queue-pattern &quot;.*&quot;ï¼ˆé‡å¹³è¡¡æ‰€æœ‰é˜Ÿåˆ—å‰¯æœ¬ï¼‰rabbitmq-queues add_member --vhost / qname rabbit@nodeï¼ˆä¸ºé˜Ÿåˆ—å¢åŠ èŠ‚ç‚¹å‰¯æœ¬ï¼‰ rabbitmq-server å¯åŠ¨ RabbitMQ èŠ‚ç‚¹ï¼ˆå‰å°/åå°ï¼‰ rabbitmq-serverï¼ˆå‰å°å¯åŠ¨ï¼‰rabbitmq-server -detachedï¼ˆåå°å¯åŠ¨ï¼‰ rabbitmq-upgrade å‡çº§ç›¸å…³æ“ä½œï¼šdrain/æ¢å¤ç­‰ rabbitmq-upgrade drainï¼ˆè®©èŠ‚ç‚¹è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œåœæ­¢æ¥æ”¶æ–°è¿æ¥ï¼‰rabbitmq-upgrade post_upgradeï¼ˆæ‰§è¡Œå‡çº§åæ”¶å°¾æ“ä½œï¼‰rabbitmq-upgrade reviveï¼ˆæ¢å¤ç»´æŠ¤æ¨¡å¼ä¸­çš„èŠ‚ç‚¹ï¼‰ rabbitmqctl æœ€å¸¸ç”¨ç®¡ç†å‘½ä»¤ï¼šç”¨æˆ·ã€é˜Ÿåˆ—ã€é›†ç¾¤ç®¡ç† rabbitmqctl statusï¼ˆæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼‰rabbitmqctl list_queuesï¼ˆåˆ—å‡ºæ‰€æœ‰é˜Ÿåˆ—ï¼‰rabbitmqctl add_user bob s3cr3tï¼ˆæ·»åŠ ç”¨æˆ· bobï¼Œå¯†ç  s3cr3tï¼‰ rabbitmq-streams ç®¡ç† Streamsï¼ˆæµå¼é˜Ÿåˆ—ï¼‰ rabbitmq-streams stream_status --vhost / my-streamï¼ˆæŸ¥çœ‹ my-stream çŠ¶æ€ï¼‰rabbitmq-streams add_replica --vhost / my-stream rabbit@nodeï¼ˆä¸º my-stream å¢åŠ å‰¯æœ¬èŠ‚ç‚¹ï¼‰ æœ€å¸¸ç”¨çš„å‘½ä»¤ rabbitmqctl å‘½ä»¤è‡ªåŠ¨è¡¥å…¨ rabbitmqctl æœ‰ä¸€ä¸ª autocomplete å‚æ•°ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆå‘½ä»¤å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‘½ä»¤æ¥å®ç°å‘½ä»¤è‡ªåŠ¨è¡¥å…¨ vim ~/.bashrc æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 12345678_rabbitmqctl_completion() &#123; local cur opts cur=&quot;$&#123;COMP_WORDS[COMP_CWORD]&#125;&quot; # å½“å‰å…‰æ ‡æ‰€åœ¨å•è¯ opts=$(rabbitmqctl autocomplete &quot;$cur&quot;) # åªä¼ å½“å‰å•è¯ä½œä¸ºå‰ç¼€ COMPREPLY=( $(compgen -W &quot;$&#123;opts&#125;&quot; -- &quot;$cur&quot;) )&#125;complete -F _rabbitmqctl_completion rabbitmqctl å®é™…ä¸Š RabbitMQ çš„å¤§éƒ¨åˆ†å‘½ä»¤éƒ½æœ‰ autocomplete å‚æ•°ï¼Œéƒ½å¯ä»¥è‡ªåŠ¨å®Œæˆå‘½ä»¤å‚æ•° 12345678910111213# å®šä¹‰é€šç”¨è¡¥å…¨å‡½æ•°_rabbitmq_completion() &#123; local cur opts cur=&quot;$&#123;COMP_WORDS[COMP_CWORD]&#125;&quot; # å½“å‰å‘½ä»¤åï¼Œè‡ªåŠ¨åˆ¤æ–­ local cmd=&quot;$&#123;COMP_WORDS[0]&#125;&quot; # ç»™å¯¹åº”å‘½ä»¤ä¼ å½“å‰å‰ç¼€ opts=$($cmd autocomplete &quot;$cur&quot; 2&gt;/dev/null) COMPREPLY=( $(compgen -W &quot;$&#123;opts&#125;&quot; -- &quot;$cur&quot;) )&#125;# ä¸€æ¬¡æ€§ç»‘å®šå¤šä¸ªå‘½ä»¤complete -F _rabbitmq_completion rabbitmqctl rabbitmq-plugins rabbitmq-diagnostics rabbitmq-queues rabbitmq-upgrade æµ‹è¯• 123456# ä½¿è¡¥å…¨ç”Ÿæ•ˆsource ~/.bashrc# tab è¡¥å…¨rabbitmqctl st&lt;TAB&gt;# è¾“å‡ºstart_app status stop stop_app å¸¸ç”¨å‘½ä»¤å‚æ•° rabbitmqctl help è·å–æ‰€æœ‰å‘½ä»¤å‚æ•°çš„ç®€ä»‹ rabbitmqctl help &lt;command&gt; è·å–æŒ‡å®šå‘½ä»¤çš„å¸®åŠ© æ—¥å¸¸ä½¿ç”¨ä¸­åŸºæœ¬éƒ½æ˜¯é€šè¿‡ web æ§åˆ¶å° å®Œæˆï¼Œè¿™é‡Œåªåšäº†è§£ã€‚ 1.èŠ‚ç‚¹ç®¡ç† å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ status æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼ŒåŒ…æ‹¬è¿è¡ŒçŠ¶æ€ã€ç‰ˆæœ¬ã€å†…å­˜ã€é˜Ÿåˆ—æ•°é‡ç­‰ rabbitmqctl status stop åœæ­¢ RabbitMQ èŠ‚ç‚¹ rabbitmqctl stop stop_app åœæ­¢ RabbitMQ åº”ç”¨ï¼ˆä¿ç•™èŠ‚ç‚¹è¿è¡Œï¼‰ rabbitmqctl stop_app start_app å¯åŠ¨ RabbitMQ åº”ç”¨ rabbitmqctl start_app reset é‡ç½® RabbitMQ èŠ‚ç‚¹ï¼Œåˆ é™¤æ‰€æœ‰é˜Ÿåˆ—å’Œæ•°æ®ï¼ˆæ…ç”¨ï¼‰ rabbitmqctl reset force_reset å¼ºåˆ¶é‡ç½®èŠ‚ç‚¹ï¼ˆå³ä½¿åœ¨é›†ç¾¤ä¸­ä¹Ÿä¼šé‡ç½®ï¼‰ rabbitmqctl force_reset 2. ç”¨æˆ·å’Œæƒé™ç®¡ç† å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ list_users åˆ—å‡ºæ‰€æœ‰ç”¨æˆ· rabbitmqctl list_users add_user &lt;user&gt; &lt;password&gt; æ·»åŠ æ–°ç”¨æˆ· rabbitmqctl add_user alice mypassword delete_user &lt;user&gt; åˆ é™¤ç”¨æˆ· rabbitmqctl delete_user alice change_password &lt;user&gt; &lt;password&gt; ä¿®æ”¹ç”¨æˆ·å¯†ç  rabbitmqctl change_password alice newpass list_permissions &lt;user&gt; æŸ¥çœ‹æŸç”¨æˆ·çš„æƒé™ rabbitmqctl list_permissions alice set_permissions -p &lt;vhost&gt; &lt;user&gt; &quot;&lt;conf&gt;&quot; &quot;&lt;write&gt;&quot; &quot;&lt;read&gt;&quot; è®¾ç½®ç”¨æˆ·åœ¨è™šæ‹Ÿä¸»æœºçš„æƒé™ rabbitmqctl set_permissions -p / alice &quot;.*&quot; &quot;.*&quot; &quot;.*&quot; 3. è™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ç®¡ç† å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ list_vhosts åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿä¸»æœº rabbitmqctl list_vhosts add_vhost &lt;vhost&gt; æ·»åŠ è™šæ‹Ÿä¸»æœº rabbitmqctl add_vhost my_vhost delete_vhost &lt;vhost&gt; åˆ é™¤è™šæ‹Ÿä¸»æœº rabbitmqctl delete_vhost my_vhost 4. é˜Ÿåˆ—ç®¡ç† é˜Ÿåˆ—å¯ä»¥é€šè¿‡ web æ§åˆ¶å° åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ å®¢æˆ·ç«¯(æ¯”å¦‚Java) åˆ›å»ºï¼Œrabbitmqctl åªèƒ½æŸ¥çœ‹å’Œåˆ é™¤é˜Ÿåˆ— å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ list_queues åˆ—å‡ºé˜Ÿåˆ— rabbitmqctl list_queues list_queues name messages consumers åˆ—å‡ºé˜Ÿåˆ—åŠæ¶ˆæ¯æ•°ã€æ¶ˆè´¹è€…æ•° rabbitmqctl list_queues name messages consumers purge_queue &lt;queue&gt; æ¸…ç©ºé˜Ÿåˆ—æ¶ˆæ¯ rabbitmqctl purge_queue my_queue delete_queue &lt;queue&gt; åˆ é™¤é˜Ÿåˆ— rabbitmqctl delete_queue my_queue 5. äº¤æ¢æœºå’Œç»‘å®š äº¤æ¢æœºå¯ä»¥é€šè¿‡ web æ§åˆ¶å° åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ å®¢æˆ·ç«¯(æ¯”å¦‚Java) åˆ›å»ºï¼Œrabbitmqctl åªèƒ½æŸ¥çœ‹ å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ list_exchanges åˆ—å‡ºäº¤æ¢æœº rabbitmqctl list_exchanges list_bindings åˆ—å‡ºç»‘å®šå…³ç³» rabbitmqctl list_bindings 6. é›†ç¾¤ç®¡ç† å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ cluster_status æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ rabbitmqctl cluster_status join_cluster &lt;node&gt; èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ rabbitmqctl join_cluster rabbit@node1 forget_cluster_node &lt;node&gt; å°†èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤ rabbitmqctl forget_cluster_node rabbit@node2 7. æ—¥å¿—å’Œè°ƒè¯• å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ report è¾“å‡ºèŠ‚ç‚¹è¯Šæ–­æŠ¥å‘Š rabbitmqctl report eval &lt;expression&gt; æ‰§è¡Œ Erlang è¡¨è¾¾å¼ rabbitmqctl eval 'rabbit_mnesia:info().' 8. å…¶ä»–å‘½ä»¤ å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ help æŸ¥çœ‹å¸®åŠ©å‘½ä»¤ rabbitmqctl help version æŸ¥çœ‹ RabbitMQ ç‰ˆæœ¬ rabbitmqctl version authenticate_user &lt;user&gt; &lt;password&gt; éªŒè¯ç”¨æˆ·å¯†ç  rabbitmqctl authenticate_user alice mypassword RabbitMQ HTTP API RabbitMQ çš„ HTTP API æ˜¯ä¸€ä¸ª åŸºäº REST çš„ç®¡ç†æ¥å£ï¼Œä¸»è¦ç”¨äºå¯¹ RabbitMQ çš„ èµ„æºç®¡ç†å’Œç›‘æ§ï¼Œå®ƒæ˜¯ ç®¡ç†æ’ä»¶ rabbitmq_management æä¾›çš„åŠŸèƒ½ã€‚é€šè¿‡ HTTP APIï¼Œä½ å¯ä»¥ä¸ç”¨ rabbitmqctl å°±èƒ½æ“ä½œ RabbitMQã€‚ è¦ä½¿ç”¨ HTTP APIï¼Œä½ éœ€è¦åœ¨ RabbitMQ èŠ‚ç‚¹ä¸Šç¡®ä¿ rabbitmq_management æ’ä»¶å·²ç»å¯åŠ¨ã€‚å‰é¢æˆ‘ä»¬ä»‹ç»web ç®¡ç†æ§åˆ¶å°æ—¶å·²ç»å¯åŠ¨äº†è¯¥æ’ä»¶ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ å®é™…ä¸Š Webç®¡ç†æ§åˆ¶å° å°±æ˜¯é€šè¿‡å‘é€ AJAX è¯·æ±‚åˆ° /api/â€¦ æ¥å£æ¥è·å–æ•°æ®å’Œæ‰§è¡Œæ“ä½œã€‚ è¿™é‡Œæœ‰ HTTP API çš„è¯¦ç»†è¯´æ˜ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚ rabbitmqadmin rabbitmqadmin æ˜¯ ç®¡ç†æ’ä»¶ rabbitmq_management æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† RabbitMQ çš„èµ„æºï¼Œå¦‚åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»ã€æŸ¥çœ‹é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»ç­‰ã€‚ rabbitmqadmin æ˜¯ä¸€ä¸ªä½¿ç”¨ HTTP API çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ‰€ä»¥åº•å±‚å®é™…ä¸Šæ˜¯è°ƒç”¨äº† HTTP API ã€‚ ä¸‹è½½åœ°å€ 12345678910111213# ä¸‹è½½sudo wget -O /usr/local/bin/rabbitmqadmin https://github.com/rabbitmq/rabbitmqadmin-ng/releases/download/v2.10.0/rabbitmqadmin-2.10.0-x86_64-unknown-linux-gnu# è®¾ç½®æƒé™sudo chmod +x /usr/local/bin/rabbitmqadmin# æŸ¥çœ‹å¸®åŠ©rabbitmqadmin help# æŸ¥çœ‹å­å‘½ä»¤å¸®åŠ©rabbitmqadmin help &lt;command&gt;## ç¤ºä¾‹# æŸ¥çœ‹ é˜Ÿåˆ— å¸®åŠ©rabbitmqadmin help queues# æŸ¥çœ‹ é˜Ÿåˆ—å£°æ˜ å¸®åŠ©ï¼Œå­å­å‘½ä»¤rabbitmqadmin help queues declare rabbitmqadmin çš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯å› ä¸ºHTTP APIæ•…æ„æ²¡æœ‰å…¬å¼€æŸäº›æ“ä½œï¼Œæ‰€ä»¥å…¶ä¸èƒ½æ›¿ä»£ rabbitmqctl æˆ– rabbitmq-pluginsç­‰å‘½ä»¤ã€‚ å› ä¸ºå®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œï¼Œæ‰€ä»¥è¿™é‡Œåªåšç®€å•ä»‹ç»ã€‚ä¸Šæ–‡æåˆ°äº† rabbitmqctl ä¸æ”¯æŒå£°æ˜(åˆ›å»º) äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼Œè¿™ä¸ªé€šè¿‡ rabbitmqadmin å®ç° 12345678# åˆ›å»ºè™šæ‹Ÿä¸»æœºrabbitmqadmin vhosts declare --name &quot;my-vhost&quot; --default-queue-type &quot;quorum&quot; --description &quot;Used to test&quot;# å£°æ˜é˜Ÿåˆ—rabbitmqadmin queues declare --vhost &quot;my-vhost&quot; --name &quot;target.classic.queue.name&quot; --type &quot;classic&quot; --durable true --auto-delete false# å£°æ˜äº¤æ¢æœºrabbitmqadmin exchanges declare --vhost &quot;my-vhost&quot; --name &quot;target.direct.exchange.name&quot; --type &quot;direct&quot; --durable true --auto-delete false# ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºrabbitmqadmin bindings declare --vhost &quot;my-vhost&quot; --source &quot;target.direct.exchange.name&quot; --destination &quot;target.classic.queue.name&quot; --destination-type &quot;queue&quot; --routing-key &quot;target.routing.key&quot; è¿˜æœ‰å°±æ˜¯å®šæœŸå¤‡ä»½ RabbitMQ çš„ç»“æ„æ•°æ®(ä¸åŒ…æ‹¬æ¶ˆæ¯) 1234# å¯¼å‡ºabbitmqadmin definitions export --file backup.json# å¯¼å…¥rabbitmqadmin definitions import --file backup.json RabbitMQ éœ€è¦å¼€æ”¾å“ªäº›ç«¯å£ ç«¯å£å· åè®® ç”¨é€”è¯´æ˜ é»˜è®¤çŠ¶æ€ å®‰å…¨å»ºè®® 5672 AMQP ä¸»å®¢æˆ·ç«¯è¿æ¥ç«¯å£ å¼€æ”¾ å¿…é¡»å¼€æ”¾ï¼Œé™åˆ¶IP 5671 AMQP/SSL TLSåŠ å¯†è¿æ¥ç«¯å£ å…³é—­ å¦‚ä½¿ç”¨TLSåˆ™å¼€æ”¾ 15672 HTTP ç®¡ç†ç•Œé¢ç«¯å£ å…³é—­ å»ºè®®å†…ç½‘è®¿é—® 15671 HTTPS TLSç®¡ç†ç•Œé¢ç«¯å£ å…³é—­ å¦‚ä½¿ç”¨HTTPSåˆ™å¼€æ”¾ 25672 Erlang Distribution é›†ç¾¤èŠ‚ç‚¹é€šä¿¡ å¼€æ”¾ é›†ç¾¤å†…éƒ¨ä½¿ç”¨ 35672-35682 Erlang Distribution é›†ç¾¤èŠ‚ç‚¹å‘ç° å¼€æ”¾ é›†ç¾¤å†…éƒ¨ä½¿ç”¨ 5552 Stream Protocol æµåè®®ç«¯å£,RabbitMQ 3.9+ å…³é—­ ä½¿ç”¨æµåŠŸèƒ½æ—¶å¼€æ”¾ 5551 Stream Protocol/SSL æµåè®®TLSç«¯å£,RabbitMQ 3.9+ å…³é—­ å¦‚ä½¿ç”¨TLSåˆ™å¼€æ”¾ 61613 STOMP STOMPåè®®æ”¯æŒç«¯å£ å…³é—­ å¦‚ä½¿ç”¨STOMPåè®®åˆ™å¼€æ”¾ 61614 STOMP/SSL STOMP TLSåŠ å¯†ç«¯å£ å…³é—­ å¦‚ä½¿ç”¨STOMP over TLSåˆ™å¼€æ”¾ 1883 MQTT MQTTåè®®æ”¯æŒç«¯å£ å…³é—­ å¦‚ä½¿ç”¨MQTTåè®®åˆ™å¼€æ”¾ 8883 MQTT/SSL MQTT TLSåŠ å¯†ç«¯å£ å…³é—­ å¦‚ä½¿ç”¨MQTT over TLSåˆ™å¼€æ”¾ 15674 Web STOMP WebSocket STOMPæ”¯æŒç«¯å£ å…³é—­ å¦‚ä½¿ç”¨Web STOMPåˆ™å¼€æ”¾ 15675 Web MQTT WebSocket MQTTæ”¯æŒç«¯å£ å…³é—­ å¦‚ä½¿ç”¨Web MQTTåˆ™å¼€æ”¾","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RabbitMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹","date_published":"2025-09-18T13:30:05.000Z","tags":["æŠ€æœ¯","rabbitmq","åˆ†å¸ƒå¼","rabbitmq"]},{"id":"https://blog.hanqunfeng.com/2025/09/15/zookeeper-study/","url":"https://blog.hanqunfeng.com/2025/09/15/zookeeper-study/","title":"Zookeeper çš„å®‰è£…åŠä½¿ç”¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://zookeeper.apache.org\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Zookeeper ç‰ˆæœ¬ä¸º 3.8.4ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Zookeeper-ç®€ä»‹\">Zookeeper ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper æ˜¯ä¸€ä¸ªé›†ä¸­å¼æœåŠ¡ï¼Œç”¨äºï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>ZooKeeper å®˜æ–¹åŠŸèƒ½</th>\n<th>ä¸»è¦èŠ‚ç‚¹ç±»å‹</th>\n<th>å…·ä½“åœºæ™¯ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é…ç½®ä¸­å¿ƒ (Config Center)</td>\n<td>ç»´æŠ¤é…ç½®ä¿¡æ¯ (Configuration Management)</td>\n<td>æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰</td>\n<td>æŠŠæ•°æ®åº“è¿æ¥ä¿¡æ¯ã€ç³»ç»Ÿå‚æ•°ç­‰æ”¾åœ¨ ZooKeeper é‡Œï¼ŒåŠ¨æ€æ›´æ–°ï¼Œåƒ Apolloã€Spring Cloud Config ä¸€æ ·ã€‚</td>\n</tr>\n<tr>\n<td>æ³¨å†Œä¸­å¿ƒ (Service Registry)</td>\n<td>æä¾›å‘½åæœåŠ¡ (Naming Service)</td>\n<td>ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEphemeralï¼‰</td>\n<td>æœåŠ¡å®ä¾‹å¯åŠ¨æ—¶åœ¨ ZooKeeper é‡Œæ³¨å†Œè‡ªå·±çš„åœ°å€ï¼Œå®¢æˆ·ç«¯ä» ZooKeeper è·å–æœåŠ¡åˆ—è¡¨ï¼Œç±»ä¼¼äº Nacosã€Eurekaã€‚</td>\n</tr>\n<tr>\n<td>åˆ†å¸ƒå¼é” (Distributed Lock)</td>\n<td>åˆ†å¸ƒå¼åŒæ­¥ (Distributed Synchronization)</td>\n<td>ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEphemeral Sequentialï¼‰</td>\n<td>ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨æ‰§è¡Œå…³é”®ä»»åŠ¡ï¼Œå…¸å‹åº”ç”¨æ˜¯åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚</td>\n</tr>\n<tr>\n<td>æ¶ˆæ¯é˜Ÿåˆ— (Message Queue)</td>\n<td>é›†ç¾¤ç®¡ç†æœåŠ¡ (Cluster Management)</td>\n<td>æŒä¹…/ä¸´æ—¶èŠ‚ç‚¹ + Watch æœºåˆ¶</td>\n<td>é€šè¿‡ Watch æœºåˆ¶ç›‘å¬ ZNode å˜åŒ–ï¼ŒèŠ‚ç‚¹é—´ç”¨æ•°æ®å˜æ›´å½“â€œä¿¡å·â€ä¼ é€’æ¶ˆæ¯ï¼Œæ—©æœŸ Kafka ç”¨è¿‡è¿™ç§æ–¹å¼ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ª ZNodeã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸åŒäºæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä¿å­˜æ•°æ®ï¼Œæ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ 1MB çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬(version)ï¼Œç‰ˆæœ¬ä»0å¼€å§‹è®¡æ•°ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/QgdBSR.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"Zookeeper-å®‰è£…\">Zookeeper å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œ Zookeeper éœ€è¦å®‰è£… JDK1.8+ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ <a href=\"https://mirrors.tuna.tsinghua.edu.cn/Adoptium/\">OpenJDK11</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /usr/local/jdk</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/jdk</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> wget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">ln</span> -s jdk-11.0.28+6 jdk11</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">vim /etc/profile <span class=\"comment\"># æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class=\"line\">  <span class=\"built_in\">export</span> JAVA_HOME=/usr/local/jdk/jdk11</span><br><span class=\"line\">  <span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"comment\"># ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹javaç‰ˆæœ¬</span></span><br><span class=\"line\">java -version</span><br><span class=\"line\">openjdk version <span class=\"string\">&quot;11.0.28&quot;</span> 2025-07-15</span><br><span class=\"line\">OpenJDK Runtime Environment Temurin-11.0.28+6 (build 11.0.28+6)</span><br><span class=\"line\">OpenJDK 64-Bit Server VM Temurin-11.0.28+6 (build 11.0.28+6, mixed mode)</span><br></pre></td></tr></table></figure>\n<h3 id=\"å•æœºå®‰è£…\">å•æœºå®‰è£…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://zookeeper.apache.org/releases.html\">ä¸‹è½½ Zookeeper</a>ï¼Œç›®å‰æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ä¸º <code>3.8.4</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½</span></span><br><span class=\"line\">wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz</span><br><span class=\"line\"><span class=\"comment\"># è§£å‹</span></span><br><span class=\"line\">tar -zxvf apache-zookeeper-3.8.4-bin.tar.gz</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ä¸ªè½¯è¿æ¥ï¼Œæ–¹ä¾¿ä»¥åå‡çº§</span></span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s apache-zookeeper-3.8.4-bin zookeeper</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> zookeeper/conf</span><br><span class=\"line\"><span class=\"built_in\">cp</span> zoo_sample.cfg zoo.cfg</span><br><span class=\"line\"><span class=\"comment\"># å»ºè®®ä¿®æ”¹ zoo.cfg é…ç½®æ–‡ä»¶ï¼Œå°† dataDir=/tmp/zookeeper ä¿®æ”¹ä¸ºæŒ‡å®šçš„dataç›®å½•</span></span><br><span class=\"line\">vim zoo.cfg</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>zoo.cfg å‚æ•°è¯´æ˜</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼</th>\n<th>å•ä½ / å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>tickTime</strong></td>\n<td>ZooKeeper æ—¶é—´é…ç½®ä¸­çš„åŸºæœ¬å•ä½</td>\n<td>2000</td>\n<td>æ¯«ç§’</td>\n</tr>\n<tr>\n<td><strong>initLimit</strong></td>\n<td>follower åˆå§‹åŒ–è¿æ¥åˆ° leader çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•°</td>\n<td>10</td>\n<td>10 Ã— tickTime = 20000 ms</td>\n</tr>\n<tr>\n<td><strong>syncLimit</strong></td>\n<td>follower ä¸ leader æ•°æ®åŒæ­¥çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•°</td>\n<td>5</td>\n<td>5 Ã— tickTime = 10000 ms</td>\n</tr>\n<tr>\n<td><strong>dataDir</strong></td>\n<td>æ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•ï¼ˆæœªæŒ‡å®š dataLogDir æ—¶ï¼Œæ—¥å¿—ä¹Ÿä¼šä¿å­˜åœ¨æ­¤ç›®å½•ï¼‰</td>\n<td>/tmp/zookeeper</td>\n<td>ç›®å½•è·¯å¾„</td>\n</tr>\n<tr>\n<td><strong>clientPort</strong></td>\n<td>å®¢æˆ·ç«¯è¿æ¥ ZooKeeper çš„ç«¯å£å·</td>\n<td>2181</td>\n<td>é»˜è®¤ 2181</td>\n</tr>\n<tr>\n<td><strong>maxClientCnxns</strong></td>\n<td>å•ä¸ªå®¢æˆ·ç«¯æœ€å¤§å¹¶å‘è¿æ¥æ•°</td>\n<td>60</td>\n<td>è¶…è¿‡é™åˆ¶åæ–°è¿æ¥ä¼šè¢«æ‹’ç»</td>\n</tr>\n<tr>\n<td><strong>autopurge.snapRetainCount</strong></td>\n<td>å¿«ç…§æ–‡ä»¶ä¿ç•™ä¸ªæ•°ï¼Œè¶…è¿‡æ•°é‡çš„å°†ä¼šè¢«æ¸…ç†</td>\n<td>3</td>\n<td>é»˜è®¤ 3</td>\n</tr>\n<tr>\n<td><strong>autopurge.purgeInterval</strong></td>\n<td>æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš”æ—¶é—´ï¼Œå•ä½å°æ—¶ï¼Œ0 è¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†</td>\n<td>1</td>\n<td>1 å°æ—¶</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ zookeeper</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> zookeeper</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨</span></span><br><span class=\"line\">bin/zkServer.sh start</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">bin/zkServer.sh start conf/zoo.cfg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢</span></span><br><span class=\"line\">bin/zkServer.sh stop</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class=\"line\">bin/zkServer.sh status</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class=\"line\">./bin/zkServer.sh version</span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤å®‰è£…\">é›†ç¾¤å®‰è£…</h3>\n<h4 id=\"ZooKeeper-é›†ç¾¤è§’è‰²\">ZooKeeper é›†ç¾¤è§’è‰²</h4>\n<h5 id=\"1-Leaderï¼ˆé¢†å¯¼è€…ï¼‰\">1. Leaderï¼ˆé¢†å¯¼è€…ï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>èŒè´£ï¼š</strong></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">äº‹åŠ¡è¯·æ±‚ï¼ˆå†™æ“ä½œï¼‰çš„å”¯ä¸€è°ƒåº¦è€…å’Œå¤„ç†è€…ï¼Œä¿è¯é›†ç¾¤äº‹åŠ¡å¤„ç†çš„é¡ºåºæ€§ï¼›</li>\n<li class=\"lvl-4\">é›†ç¾¤å†…éƒ¨å„ä¸ªæœåŠ¡å™¨çš„è°ƒåº¦è€…ï¼›</li>\n<li class=\"lvl-4\">å¯¹äº <code>create</code>ã€<code>setData</code>ã€<code>delete</code> ç­‰å†™æ“ä½œè¯·æ±‚ï¼Œç»Ÿä¸€è½¬å‘ç»™ Leader å¤„ç†ï¼›</li>\n<li class=\"lvl-4\">Leader è´Ÿè´£å†³å®šç¼–å·ã€æ‰§è¡Œæ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º <strong>äº‹åŠ¡</strong>ã€‚</li>\n</ul>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‰å°è™šæ‹Ÿæœº zoo.cfg æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é€‰ä¸¾å‡º Leader è§’è‰²ï¼Œåˆ™å…¶ä½™å°±æ˜¯ Follower è§’è‰²ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.1=10.250.0.229:2888:3888</span><br><span class=\"line\">server.2=10.250.0.152:2888:3888</span><br><span class=\"line\">server.3=10.250.0.36:2888:3888</span><br></pre></td></tr></table></figure>\n<h5 id=\"2-Followerï¼ˆè·Ÿéšè€…ï¼‰\">2. Followerï¼ˆè·Ÿéšè€…ï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>èŒè´£ï¼š</strong></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡ï¼ˆè¯»æ“ä½œï¼‰è¯·æ±‚ï¼ˆå¯ä»¥ç›´æ¥å“åº”ï¼‰ï¼›</li>\n<li class=\"lvl-4\">è½¬å‘äº‹åŠ¡è¯·æ±‚ç»™ Leaderï¼›</li>\n<li class=\"lvl-4\">å‚ä¸é›†ç¾¤ Leader é€‰ä¸¾æŠ•ç¥¨ã€‚</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>leaderèŠ‚ç‚¹å¯ä»¥å¤„ç†è¯»å†™è¯·æ±‚ï¼Œfolloweråªå¯ä»¥å¤„ç†è¯»è¯·æ±‚ã€‚followeråœ¨æ¥åˆ°å†™è¯·æ±‚æ—¶ä¼šæŠŠå†™è¯·æ±‚è½¬å‘ç»™leaderæ¥å¤„ç†ã€‚</p>\n</blockquote>\n<h5 id=\"3-Observerï¼ˆè§‚å¯Ÿè€…ï¼‰\">3. Observerï¼ˆè§‚å¯Ÿè€…ï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>èŒè´£ï¼š</strong></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¯¹äºéäº‹åŠ¡è¯·æ±‚ï¼ˆè¯»æ“ä½œï¼‰å¯ä»¥ç‹¬ç«‹å¤„ç†ï¼›</li>\n<li class=\"lvl-4\">å¯¹äºäº‹åŠ¡è¯·æ±‚ä¼šè½¬å‘ç»™ Leader å¤„ç†ï¼›</li>\n<li class=\"lvl-4\">æ¥æ”¶æ¥è‡ª Leader çš„ <code>inform</code> ä¿¡æ¯ï¼Œæ›´æ–°æœ¬åœ°å­˜å‚¨ï¼›</li>\n<li class=\"lvl-4\">ä¸å‚ä¸æäº¤å’Œé€‰ä¸¾æŠ•ç¥¨ï¼›</li>\n<li class=\"lvl-4\">é€šå¸¸ç”¨äº <strong>æå‡é›†ç¾¤éäº‹åŠ¡å¤„ç†èƒ½åŠ›</strong>ï¼Œä¸å½±å“é›†ç¾¤äº‹åŠ¡å¤„ç†æ€§èƒ½ã€‚</li>\n</ul>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®ä¸€ä¸ª ID ä¸º 4 çš„è§‚å¯Ÿè€…èŠ‚ç‚¹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.4=10.250.0.56:2888:3888:observer</span><br></pre></td></tr></table></figure>\n<h4 id=\"é›†ç¾¤æ­å»º\">é›†ç¾¤æ­å»º</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¯å¢ƒå‡†å¤‡ï¼š4å°æœåŠ¡å™¨ï¼ŒæŒ‰ç…§ <code>å•æœºå®‰è£…</code> çš„æ–¹å¼å‡†å¤‡å¥½ Zookeeper ç¯å¢ƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.250.0.229</span><br><span class=\"line\">10.250.0.152</span><br><span class=\"line\">10.250.0.36</span><br><span class=\"line\">10.250.0.56</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>zoo.cfg</code> æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.1=10.250.0.229:2888:3888</span><br><span class=\"line\">server.2=10.250.0.152:2888:3888</span><br><span class=\"line\">server.3=10.250.0.36:2888:3888</span><br><span class=\"line\">server.4=10.250.0.56:2888:3888:observer</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«åœ¨ <code>dataDir</code> ç›®å½•ä¸‹åˆ›å»º <code>myid</code> æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸ server å¯¹åº”çš„ç¼–å·ï¼ˆæ³¨æ„ï¼šä¸Šä¸‹ä¸è¦æœ‰ç©ºè¡Œï¼Œå·¦å³ä¸è¦æœ‰ç©ºæ ¼ï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„ èŠ‚ç‚¹ç¼–å·ä¸èƒ½é‡å¤ï¼Œè€Œä¸”è¦ä¸ zoo.cfg æ–‡ä»¶ä¸­çš„ server.id ä¸€è‡´</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> 1 &gt; myid</span><br><span class=\"line\"><span class=\"comment\"># echo 2 &gt; myid</span></span><br><span class=\"line\"><span class=\"comment\"># echo 3 &gt; myid</span></span><br><span class=\"line\"><span class=\"comment\"># echo 4 &gt; myid</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«å¯åŠ¨ Zookeeper æœåŠ¡å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ†åˆ«å¯åŠ¨4ä¸ªèŠ‚ç‚¹çš„zookeeper server</span></span><br><span class=\"line\">bin/zkServer.sh start</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°èŠ‚ç‚¹è§’è‰²ç±»å‹</span></span><br><span class=\"line\">bin/zkServer.sh status</span><br></pre></td></tr></table></figure>\n<h4 id=\"é›†ç¾¤æœ€å°‘èŠ‚ç‚¹è¦æ±‚å’Œæ‰©å®¹è§„åˆ™\">é›†ç¾¤æœ€å°‘èŠ‚ç‚¹è¦æ±‚å’Œæ‰©å®¹è§„åˆ™</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper ä½¿ç”¨ å¤šæ•°æ´¾ï¼ˆquorumï¼‰æœºåˆ¶ æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.é›†ç¾¤æ€»èŠ‚ç‚¹æ•° N</span><br><span class=\"line\">2.å®¹å¿çš„å®•æœºèŠ‚ç‚¹æ•° F = (N-1)/2ï¼ˆå‘ä¸‹å–æ•´ï¼‰</span><br><span class=\"line\">3.è¦ä¿è¯é›†ç¾¤å¯ç”¨ï¼Œéœ€è¦ å¤§äº N/2 çš„èŠ‚ç‚¹å­˜æ´»</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤æ‰©å®¹è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.èŠ‚ç‚¹æ€»æ•°å¿…é¡»æ˜¯å¥‡æ•°</span><br><span class=\"line\">  å¥‡æ•°èŠ‚ç‚¹å¯ä»¥ä¿è¯å¤šæ•°æ´¾æŠ•ç¥¨æœºåˆ¶æ­£å¸¸</span><br><span class=\"line\">  å¶æ•°èŠ‚ç‚¹ä¸æ¨èï¼Œå®¹é”™èƒ½åŠ›ä¸å¢åŠ ï¼ˆæ¯”å¦‚ 4 å°ï¼Œä»ç„¶åªå®¹å¿ 1 å°å®•æœºï¼‰</span><br><span class=\"line\"></span><br><span class=\"line\">2.æ¯æ¬¡æ‰©å®¹å»ºè®® +2 èŠ‚ç‚¹</span><br><span class=\"line\">  è¿™æ ·æ—¢ä¿æŒå¥‡æ•°ï¼Œåˆå¢åŠ  quorum å®¹é”™èƒ½åŠ›</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ€å°‘èŠ‚ç‚¹ä¸å®¹é”™èƒ½åŠ›è¡¨æ ¼</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é›†ç¾¤æ€»èŠ‚ç‚¹æ•° N</th>\n<th>å®¹å¿å®•æœºæ•° F</th>\n<th>å¯ç”¨ quorum èŠ‚ç‚¹æ•°</th>\n<th>å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>0</td>\n<td>1</td>\n<td>ä¸æ¨èï¼Œæ— æ³•å®¹å¿æ•…éšœ</td>\n</tr>\n<tr>\n<td>2</td>\n<td>0</td>\n<td>2</td>\n<td>ä¸æ¨èï¼Œ1 å°å®•æœºå°±ä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td>3</td>\n<td>1</td>\n<td>2</td>\n<td>æœ€å°å¯ç”¨ç”Ÿäº§é›†ç¾¤</td>\n</tr>\n<tr>\n<td>5</td>\n<td>2</td>\n<td>3</td>\n<td>æ¨èç”Ÿäº§é›†ç¾¤è§„æ¨¡</td>\n</tr>\n<tr>\n<td>7</td>\n<td>3</td>\n<td>4</td>\n<td>é«˜å¯ç”¨å¤§é›†ç¾¤</td>\n</tr>\n<tr>\n<td>9</td>\n<td>4</td>\n<td>5</td>\n<td>æ›´å¤§é›†ç¾¤ï¼Œé«˜å®¹é”™</td>\n</tr>\n<tr>\n<td>11</td>\n<td>5</td>\n<td>6</td>\n<td>æé«˜å¯ç”¨åœºæ™¯</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ZooKeeper-é»˜è®¤ç«¯å£è¯´æ˜\">ZooKeeper é»˜è®¤ç«¯å£è¯´æ˜</h2>\n<table>\n<thead>\n<tr>\n<th>ç«¯å£</th>\n<th>ç”¨é€”</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2181</td>\n<td>å®¢æˆ·ç«¯è¿æ¥ç«¯å£</td>\n<td>å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªç«¯å£è®¿é—® ZooKeeper</td>\n</tr>\n<tr>\n<td>2888</td>\n<td>é›†ç¾¤å†…éƒ¨é€šä¿¡</td>\n<td>follower ä¸ leader ä¹‹é—´åŒæ­¥æ•°æ®</td>\n</tr>\n<tr>\n<td>3888</td>\n<td>leader é€‰ä¸¾ç«¯å£</td>\n<td>é›†ç¾¤é€‰ä¸¾ leader ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>8080 (å¯é€‰)</td>\n<td>admin/metrics webç«¯å£</td>\n<td>å¦‚æœå¼€å¯äº† adminServer</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ°¸ä¹…å¼€å¯ç«¯å£</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=2181/tcp</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=2888/tcp</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=3888/tcp</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½¿ç”¨ adminServer</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=8080/tcp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --reload</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ˜¯å¦å¼€æ”¾æˆåŠŸ</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --list-all</span><br></pre></td></tr></table></figure>\n<h2 id=\"å®¢æˆ·ç«¯è¿æ¥\">å®¢æˆ·ç«¯è¿æ¥</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é»˜è®¤è¿æ¥ 127.0.0.1:2181</span></span><br><span class=\"line\">bin/zkCli.sh</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š -server ip:portï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œåˆ™è¿æ¥ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒZooKeeper ä¼šè‡ªåŠ¨å¤„ç†ä¸ Leader/Follower çš„äº¤äº’</span></span><br><span class=\"line\">bin/zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å®¢æˆ·ç«¯å‘½ä»¤ç®€ä»‹ï¼š<a href=\"https://zookeeper.apache.org/doc/r3.8.4/zookeeperCLI.html\">å‚è€ƒå®˜ç½‘</a></p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>è¯­æ³•ç¤ºä¾‹</th>\n<th>åŠŸèƒ½æè¿°</th>\n<th>å¸¸ç”¨å‚æ•°åŠè¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>help</strong></td>\n<td><code>help</code></td>\n<td>æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤</td>\n<td>æ— </td>\n<td><code>help</code></td>\n</tr>\n<tr>\n<td><strong>version</strong></td>\n<td><code>version</code></td>\n<td>æŸ¥çœ‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯</td>\n<td>æ— </td>\n<td><code>version</code></td>\n</tr>\n<tr>\n<td><strong>connect</strong></td>\n<td><code>connect host:port</code></td>\n<td>è¿æ¥åˆ°æŒ‡å®š ZooKeeper æœåŠ¡å™¨</td>\n<td><code>host:port</code>: æœåŠ¡å™¨åœ°å€</td>\n<td><code>connect 127.0.0.1:2181</code></td>\n</tr>\n<tr>\n<td><strong>close</strong></td>\n<td><code>close</code></td>\n<td>å…³é—­å½“å‰ä¼šè¯ ,é€šè¿‡ <code>connect</code> å¯é‡è¿</td>\n<td>æ— </td>\n<td><code>close</code></td>\n</tr>\n<tr>\n<td><strong>quit</strong></td>\n<td><code>quit</code></td>\n<td>é€€å‡ºå®¢æˆ·ç«¯</td>\n<td>æ— </td>\n<td><code>quit</code></td>\n</tr>\n<tr>\n<td><strong>ls</strong></td>\n<td><code>ls [-s] [-w] [-R] path</code></td>\n<td>æŸ¥çœ‹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</td>\n<td>- <code>-w</code>: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–<br>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-R</code>: é€’å½’æŸ¥çœ‹</td>\n<td><code>ls -s -w /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>getAllChildrenNumber</strong></td>\n<td><code>getAllChildrenNumber path</code></td>\n<td>è·å–æŸèŠ‚ç‚¹æ‰€æœ‰å­èŠ‚ç‚¹çš„æ€»æ•°</td>\n<td>æ— </td>\n<td><code>getAllChildrenNumber /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>getEphemerals</strong></td>\n<td><code>getEphemerals path</code></td>\n<td>è·å–æŸè·¯å¾„ä¸‹æ‰€æœ‰ä¸´æ—¶èŠ‚ç‚¹</td>\n<td>æ— </td>\n<td><code>getEphemerals /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>create</strong></td>\n<td><code>create [-s] [-e] [-c] [-t ttl] path [data] [acl]</code></td>\n<td>åˆ›å»ºèŠ‚ç‚¹</td>\n<td>- <code>-s</code>: é¡ºåºèŠ‚ç‚¹<br>- <code>-e</code>: ä¸´æ—¶èŠ‚ç‚¹<br>- <code>-c</code>: å®¹å™¨èŠ‚ç‚¹<br>- <code>-t ttl</code>: TTLèŠ‚ç‚¹ï¼Œå•ä½æ¯«ç§’</td>\n<td><code>create -e /zk_test_ephemeral &quot;temp_data&quot;</code></td>\n</tr>\n<tr>\n<td><strong>get</strong></td>\n<td><code>get [-s] [-w] path</code></td>\n<td>è·å–èŠ‚ç‚¹æ•°æ®ä¿¡æ¯</td>\n<td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-w</code>: ç›‘å¬èŠ‚ç‚¹å˜åŒ–</td>\n<td><code>get -s -w /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>set</strong></td>\n<td><code>set [-s] [-v version] path data</code></td>\n<td>è®¾ç½®èŠ‚ç‚¹æ•°æ®</td>\n<td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-v</code>: æŒ‡å®šç‰ˆæœ¬å·</td>\n<td><code>set /zk_test &quot;new_data&quot;</code></td>\n</tr>\n<tr>\n<td><strong>stat</strong></td>\n<td><code>stat [-w] path</code></td>\n<td>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</td>\n<td>- <code>-w</code>: ç›‘å¬èŠ‚ç‚¹å˜åŒ–</td>\n<td><code>stat -w /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>sync</strong></td>\n<td><code>sync path</code></td>\n<td>åŒæ­¥æŒ‡å®šèŠ‚ç‚¹æ•°æ®</td>\n<td>æ— </td>\n<td><code>sync /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>delete</strong></td>\n<td><code>delete [-v version] path</code></td>\n<td>åˆ é™¤æŸä¸€èŠ‚ç‚¹ï¼ˆæ— å­èŠ‚ç‚¹ï¼‰</td>\n<td>- <code>-v</code>: èŠ‚ç‚¹ç‰ˆæœ¬å·</td>\n<td><code>delete /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>deleteall</strong></td>\n<td><code>deleteall path</code></td>\n<td>é€’å½’åˆ é™¤æŸä¸€èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹</td>\n<td>æ— </td>\n<td><code>deleteall /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>getAcl</strong></td>\n<td><code>getAcl [-s] path</code></td>\n<td>è·å–èŠ‚ç‚¹è®¿é—®æ§åˆ¶ä¿¡æ¯</td>\n<td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</td>\n<td><code>getAcl /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>setAcl</strong></td>\n<td><code>setAcl [-s] [-v version] [-R] path acl</code></td>\n<td>è®¾ç½®èŠ‚ç‚¹è®¿é—®æ§åˆ¶åˆ—è¡¨</td>\n<td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-v</code>: æŒ‡å®šç‰ˆæœ¬å·<br>- <code>-R</code>: é€’å½’è®¾ç½®</td>\n<td><code>setAcl /zk_test world:anyone:r</code></td>\n</tr>\n<tr>\n<td><strong>listquota</strong></td>\n<td><code>listquota path</code></td>\n<td>æŸ¥çœ‹èŠ‚ç‚¹é…é¢ä¿¡æ¯</td>\n<td>æ— </td>\n<td><code>listquota /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>setquota</strong></td>\n<td><code>setquota [-n] [-b] val path</code></td>\n<td>å¯¹èŠ‚ç‚¹å¢åŠ é™åˆ¶</td>\n<td>- <code>-n</code>: å­èŠ‚ç‚¹æœ€å¤§ä¸ªæ•°<br>- <code>-b</code>: æ•°æ®å€¼æœ€å¤§é•¿åº¦ï¼Œ-1 è¡¨ç¤ºæ— é™åˆ¶</td>\n<td><code>setquota -n 5 /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>delquota</strong></td>\n<td><code>delquota [-n                                    | -b] path</code></td>\n<td>åˆ é™¤èŠ‚ç‚¹é…é¢é™åˆ¶</td>\n<td>- <code>-n</code>: åˆ é™¤å­èŠ‚ç‚¹æ•°é™åˆ¶<br>- <code>-b</code>: åˆ é™¤æ•°æ®å€¼å¤§å°é™åˆ¶</td>\n<td><code>delquota -n /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>config</strong></td>\n<td><code>config</code></td>\n<td>æŸ¥çœ‹æœåŠ¡å™¨é…ç½®</td>\n<td>æ— </td>\n<td><code>config</code></td>\n</tr>\n<tr>\n<td><strong>whoami</strong></td>\n<td><code>whoami</code></td>\n<td>æŸ¥çœ‹å½“å‰ä¼šè¯èº«ä»½</td>\n<td>æ— </td>\n<td><code>whoami</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>GUI å·¥å…·</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>ç±»å‹ / è¿è¡Œæ–¹å¼</th>\n<th>ä¼˜ç‚¹</th>\n<th>æ³¨æ„äº‹é¡¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>PrettyZoo</strong></td>\n<td>æ¡Œé¢åº”ç”¨ï¼ˆJavaFXï¼‰(<a href=\"https://github.com/vran-dev/PrettyZoo\" title=\"vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...\">GitHub</a>)</td>\n<td>æ”¯æŒ Mac/Windows/Linuxï¼Œç•Œé¢å‹å¥½ï¼›æ”¯æŒèŠ‚ç‚¹åˆ›å»º/åˆ é™¤/æ›´æ–°/æŸ¥è¯¢ï¼ŒACL ç®¡ç†ï¼Œå¤š ZK å®ä¾‹ç®¡ç†ï¼ŒSSH éš§é“ç­‰åŠŸèƒ½ã€‚(<a href=\"https://github.com/vran-dev/PrettyZoo\" title=\"vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...\">GitHub</a>)</td>\n<td>é¡¹ç›®å·²ç» archivedï¼Œç»´æŠ¤å¯èƒ½ä¸æ´»è·ƒã€‚æœ€æ–°ç‰ˆå¯èƒ½åœ¨å…¼å®¹æ€§æˆ– Bug ä¿®å¤æ–¹é¢ä¸å¦‚æ´»è·ƒé¡¹ç›®ã€‚ä¹Ÿå¯èƒ½éœ€è¦è‡ªå·±æ„å»ºæˆ–è°ƒè¯•ã€‚(<a href=\"https://github.com/vran-dev/PrettyZoo\" title=\"vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...\">GitHub</a>)</td>\n</tr>\n<tr>\n<td><strong>ZooNavigator</strong></td>\n<td>Web ç•Œé¢ + å¯ Docker éƒ¨ç½²æˆ–æœ¬åœ°å¯åŠ¨(<a href=\"https://github.com/elkozmon/zoonavigator\" title=\"elkozmon/zoonavigator: Web-based ZooKeeper UI\">GitHub</a>)</td>\n<td>åŠŸèƒ½ä¸°å¯Œï¼›æ”¯æŒå¤šä¸ª Zookeeper ç‰ˆæœ¬ï¼ˆå¦‚ 3.5.x ï½ 3.9.xï¼‰ï¼›æµè§ˆ / ç¼–è¾‘ /æœç´¢èŠ‚ç‚¹ï¼›å¯¼å…¥å¯¼å‡ºé…ç½®ï¼›æ”¯æŒæµè§ˆå™¨è®¿é—®ï¼Œæ— éœ€æœ¬åœ° heavy GUIã€‚(<a href=\"https://github.com/elkozmon/zoonavigator\" title=\"elkozmon/zoonavigator: Web-based ZooKeeper UI\">GitHub</a>)</td>\n<td>å› ä¸º Web åº”ç”¨ï¼Œå¯èƒ½å¯¹æµè§ˆå™¨å®‰å…¨ç­–ç•¥ä¸ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿï¼›éœ€è¦éƒ¨ç½²è‡ªå·±ç‰ˆæœ¬æˆ– Dockerï¼›å¦‚æœè¦æ±‚æœ¬åœ°è„±æœºæ“ä½œæ—¶ï¼Œæœ‰äº›åŠŸèƒ½å¯èƒ½ç¨ä¸å¦‚æ¡Œé¢åº”ç”¨ã€‚</td>\n</tr>\n<tr>\n<td><strong>ZooKeeper Assistant</strong></td>\n<td>æ¡Œé¢ï¼ç®¡ç†å‘˜é¢æ¿ç±»å‹ï¼ˆæ”¯æŒç›‘æ§ç•Œé¢ç­‰ï¼‰(<a href=\"https://dev.to/redisant/an-exciting-apache-zookeeper-desktop-gui-1fdo\" title=\"An exciting Apache ZooKeeper Desktop GUI\">DEV Community</a>)</td>\n<td>é™¤äº†æµè§ˆèŠ‚ç‚¹æ ‘ä»¥å¤–ï¼Œè¿˜æä¾›å¥åº·çŠ¶æ€ç›‘æ§ï¼ˆå»¶è¿Ÿã€è¯·æ±‚æ•°ç­‰ï¼‰ã€ä¸åŒæ•°æ®æ ¼å¼æ”¯æŒï¼ˆJSON/XML ç­‰ï¼‰ã€å¯¼å…¥/å¯¼å‡ºèŠ‚ç‚¹æ•°æ®ã€å‘½ä»¤è¡Œæ“ä½œé›†æˆã€‚(<a href=\"https://dev.to/redisant/an-exciting-apache-zookeeper-desktop-gui-1fdo\" title=\"An exciting Apache ZooKeeper Desktop GUI\">DEV Community</a>)</td>\n<td>æœ‰äº›åŠŸèƒ½å¯èƒ½åœ¨ Mac ä¸Šå…¼å®¹æ€§æˆ–è§†è§‰ä½“éªŒéœ€è¦è°ƒè¯•ï¼›å…·ä½“ç‰ˆæœ¬æ”¯æŒæƒ…å†µè¦çœ‹æœ€è¿‘æ›´æ–°ã€‚æŸäº›ç›‘æ§ç•Œé¢å¯èƒ½ä¾èµ–äº ZK çš„æŒ‡æ ‡æˆ–æ’ä»¶ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Zookeeper-èŠ‚ç‚¹ç±»å‹\">Zookeeper èŠ‚ç‚¹ç±»å‹</h2>\n<table>\n<thead>\n<tr>\n<th>èŠ‚ç‚¹ç±»å‹</th>\n<th>ç”Ÿå‘½å‘¨æœŸè¯´æ˜</th>\n<th>åˆ›å»ºå‘½ä»¤ç¤ºä¾‹</th>\n<th>ç‰¹ç‚¹è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æŒä¹…èŠ‚ç‚¹</strong> (Persistent)</td>\n<td>èŠ‚ç‚¹ä¸€ç›´å­˜åœ¨ï¼Œé™¤éæ‰‹åŠ¨åˆ é™¤ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ŒèŠ‚ç‚¹ä¹Ÿä¸ä¼šæ¶ˆå¤±</td>\n<td><code>create /locks</code></td>\n<td>é€‚åˆå­˜å‚¨é…ç½®ä¿¡æ¯ã€å…ƒæ•°æ®ç­‰æŒä¹…æ•°æ®</td>\n</tr>\n<tr>\n<td><strong>ä¸´æ—¶èŠ‚ç‚¹</strong> (Ephemeral)</td>\n<td>å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ˆå¼‚å¸¸æˆ–è¶…æ—¶ï¼‰æ—¶ï¼ŒèŠ‚ç‚¹è‡ªåŠ¨è¢«åˆ é™¤</td>\n<td><code>create -e /locks/DBLock</code></td>\n<td>å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€ä¸´æ—¶ä¼šè¯æ•°æ®</td>\n</tr>\n<tr>\n<td><strong>æœ‰åºèŠ‚ç‚¹</strong> (Sequential)</td>\n<td>åœ¨æŒä¹…æˆ–ä¸´æ—¶èŠ‚ç‚¹åŸºç¡€ä¸Šï¼Œå¢åŠ æœ‰åºç¼–å·ï¼ŒZooKeeper è‡ªåŠ¨åœ¨èŠ‚ç‚¹åååŠ é€’å¢åºå·</td>\n<td><code>create -e -s /jobs/job</code></td>\n<td>å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€é˜Ÿåˆ—ç­‰éœ€è¦é¡ºåºçš„åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>å®¹å™¨èŠ‚ç‚¹</strong> (Container)</td>\n<td>V3.5.3+ï¼Œå½“å®¹å™¨èŠ‚ç‚¹ä¸‹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œå®¹å™¨èŠ‚ç‚¹ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤</td>\n<td><code>create -c /work</code></td>\n<td>é€‚åˆåˆ†å¸ƒå¼ä»»åŠ¡ä¸´æ—¶ç›®å½•ã€åŠ¨æ€æ•°æ®ç›®å½•</td>\n</tr>\n<tr>\n<td><strong>TTL èŠ‚ç‚¹</strong> (TTL)</td>\n<td>åœ¨æŒ‡å®š TTL æ—¶é—´å†…æœªä¿®æ”¹ä¸”æ— å­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆéœ€å¼€å¯ <code>extendedTypesEnabled=true</code> é…ç½®ï¼‰</td>\n<td><code>create -t 3000 /ttl_node</code></td>\n<td>é€‚åˆä¸´æ—¶ç¼“å­˜ã€ä¸´æ—¶çŠ¶æ€æ•°æ®ï¼Œè¿‡æœŸè‡ªåŠ¨æ¸…ç†</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åŒä¸€çº§èŠ‚ç‚¹ key åç§°æ˜¯å”¯ä¸€çš„</li>\n<li class=\"lvl-4\">åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå¿…é¡»è¦å¸¦ä¸Šå…¨è·¯å¾„</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[zk: localhost:2181(CONNECTED) 16] <span class=\"built_in\">stat</span> /test</span><br><span class=\"line\">cZxid = 0x100000002                   <span class=\"comment\"># Znodeåˆ›å»ºçš„äº‹åŠ¡id</span></span><br><span class=\"line\">ctime = Mon Sep 15 09:44:51 UTC 2025  <span class=\"comment\"># åˆ›å»ºæ—¶é—´</span></span><br><span class=\"line\">mZxid = 0x100000004                   <span class=\"comment\"># æœ€åä¸€æ¬¡ä¿®æ”¹äº‹åŠ¡id</span></span><br><span class=\"line\">mtime = Mon Sep 15 09:47:12 UTC 2025  <span class=\"comment\"># æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´</span></span><br><span class=\"line\">pZxid = 0x400000004                   <span class=\"comment\"># è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡ä¿®æ”¹çš„äº‹åŠ¡IDï¼Œæ·»åŠ å­èŠ‚ç‚¹æˆ–åˆ é™¤å­èŠ‚ç‚¹å°±ä¼šå½±å“å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œä½†æ˜¯ä¿®æ”¹å­èŠ‚ç‚¹çš„æ•°æ®å†…å®¹åˆ™ä¸å½±å“è¯¥IDï¼ˆæ³¨æ„: åªæœ‰å­èŠ‚ç‚¹åˆ—è¡¨å˜æ›´äº†æ‰ä¼šå˜æ›´pzxidï¼Œå­èŠ‚ç‚¹å†…å®¹å˜æ›´ä¸ä¼šå½±å“pzxidï¼‰</span></span><br><span class=\"line\">cversion = 1                          <span class=\"comment\"># å­èŠ‚ç‚¹çš„ç‰ˆæœ¬å·ã€‚å½“znodeçš„å­èŠ‚ç‚¹æœ‰å˜åŒ–æ—¶ï¼Œcversion çš„å€¼å°±ä¼šå¢åŠ 1ã€‚</span></span><br><span class=\"line\">dataVersion = 1                       <span class=\"comment\"># znodeçš„æ•°æ®ç‰ˆæœ¬å·ã€‚æ¯æ¬¡å¯¹èŠ‚ç‚¹è¿›è¡Œsetæ“ä½œï¼ŒdataVersionçš„å€¼éƒ½ä¼šå¢åŠ 1ï¼ˆå³ä½¿è®¾ç½®çš„æ˜¯ç›¸åŒçš„æ•°æ®ï¼‰ï¼Œå¯æœ‰æ•ˆé¿å…äº†æ•°æ®æ›´æ–°æ—¶å‡ºç°çš„å…ˆåé¡ºåºé—®é¢˜</span></span><br><span class=\"line\">aclVersion = 0                        <span class=\"comment\"># znodeçš„ACLç‰ˆæœ¬å·ã€‚æ¯æ¬¡å¯¹èŠ‚ç‚¹è¿›è¡ŒACLè®¾ç½®ï¼ŒaclVersionçš„å€¼éƒ½ä¼šå¢åŠ 1</span></span><br><span class=\"line\">ephemeralOwner = 0x0                  <span class=\"comment\"># å¦‚æœè¯¥èŠ‚ç‚¹ä¸ºä¸´æ—¶èŠ‚ç‚¹, ephemeralOwnerå€¼è¡¨ç¤ºä¸è¯¥èŠ‚ç‚¹ç»‘å®šçš„session idã€‚å¦‚æœä¸æ˜¯, ephemeralOwnerå€¼ä¸º0(æŒä¹…èŠ‚ç‚¹)ã€‚</span></span><br><span class=\"line\">dataLength = 3                        <span class=\"comment\"># znodeçš„æ•°æ®é•¿åº¦</span></span><br><span class=\"line\">numChildren = 1                       <span class=\"comment\"># znodeçš„å­èŠ‚ç‚¹æ•°é‡ï¼ˆåªç»Ÿè®¡ç›´æ¥å­èŠ‚ç‚¹çš„æ•°é‡ï¼‰</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Zookeeper-ç›‘å¬æœºåˆ¶\">Zookeeper ç›‘å¬æœºåˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>watchæœºåˆ¶ï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªç›‘å¬æœºåˆ¶ã€‚Zookeeperä¸­çš„watchæœºåˆ¶ï¼Œå¿…é¡»å®¢æˆ·ç«¯å…ˆå»æœåŠ¡ç«¯æ³¨å†Œç›‘å¬ï¼Œè¿™æ ·äº‹ä»¶å‘ç”Ÿæ—¶æ‰ä¼šè§¦å‘ç›‘å¬ï¼Œé€šçŸ¥ç»™å®¢æˆ·ç«¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›‘å¬çš„å¯¹è±¡æ˜¯äº‹ä»¶ï¼Œæ”¯æŒçš„äº‹ä»¶ç±»å‹å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- None: è¿æ¥å»ºç«‹äº‹ä»¶</span><br><span class=\"line\">- NodeCreatedï¼š èŠ‚ç‚¹åˆ›å»º</span><br><span class=\"line\">- NodeDeletedï¼š èŠ‚ç‚¹åˆ é™¤</span><br><span class=\"line\">- NodeDataChangedï¼šèŠ‚ç‚¹æ•°æ®å˜åŒ–</span><br><span class=\"line\">- NodeChildrenChangedï¼šå­èŠ‚ç‚¹åˆ—è¡¨å˜åŒ–</span><br><span class=\"line\">- DataWatchRemovedï¼šèŠ‚ç‚¹ç›‘å¬è¢«ç§»é™¤</span><br><span class=\"line\">- ChildWatchRemovedï¼šå­èŠ‚ç‚¹ç›‘å¬è¢«ç§»é™¤</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›‘å¬ç‰¹æ€§</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ä¸€æ¬¡æ€§è§¦å‘</strong></td>\n<td>Watch æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸€æ—¦è¢«è§¦å‘å°±ä¼šè¢«ç§»é™¤ã€‚å†æ¬¡ä½¿ç”¨æ—¶éœ€è¦é‡æ–°æ³¨å†Œã€‚</td>\n</tr>\n<tr>\n<td><strong>å®¢æˆ·ç«¯é¡ºåºå›è°ƒ</strong></td>\n<td>Watch å›è°ƒæ˜¯é¡ºåºä¸²è¡Œæ‰§è¡Œçš„ï¼Œå®¢æˆ·ç«¯åªæœ‰åœ¨å›è°ƒå®Œæˆåæ‰èƒ½çœ‹åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚</td>\n</tr>\n<tr>\n<td><strong>è½»é‡çº§</strong></td>\n<td>Watcher å›è°ƒé€»è¾‘ä¸åº”è¿‡å¤šï¼Œä»¥å…é˜»å¡æˆ–å½±å“å…¶ä»– Watch çš„æ‰§è¡Œã€‚</td>\n</tr>\n<tr>\n<td><strong>æœ€å°é€šä¿¡å•ä½</strong></td>\n<td><code>WatchEvent</code> æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼ŒåªåŒ…å«é€šçŸ¥çŠ¶æ€ã€äº‹ä»¶ç±»å‹å’ŒèŠ‚ç‚¹è·¯å¾„ï¼Œä¸åŒ…å«èŠ‚ç‚¹æ•°æ®å˜åŒ–å‰åçš„å…·ä½“å†…å®¹ã€‚</td>\n</tr>\n<tr>\n<td><strong>æ—¶æ•ˆæ€§</strong></td>\n<td>Watcher ä»…åœ¨å½“å‰ Session å®Œå…¨å¤±æ•ˆæ—¶æ‰æ— æ•ˆã€‚å¦‚æœ Session å¿«é€Ÿé‡è¿æˆåŠŸï¼ŒWatcher ä¾ç„¶æœ‰æ•ˆï¼Œå¯ç»§ç»­æ¥æ”¶é€šçŸ¥ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥å¼€å¯ç›‘å¬çš„å‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#ç›‘å¬èŠ‚ç‚¹æ•°æ®çš„å˜åŒ–</span></span><br><span class=\"line\">get -w path</span><br><span class=\"line\"><span class=\"built_in\">stat</span> -w path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#ç›‘å¬å­èŠ‚ç‚¹å¢å‡çš„å˜åŒ–</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -w path</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ°¸ä¹…æ€§-Watch\">æ°¸ä¹…æ€§ Watch</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨è¢«è§¦å‘ä¹‹åï¼Œä»ç„¶ä¿ç•™ï¼Œå¯ä»¥ç»§ç»­ç›‘å¬ZNodeä¸Šçš„å˜æ›´ï¼Œæ˜¯Zookeeper 3.6.0ç‰ˆæœ¬æ–°å¢çš„åŠŸèƒ½</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç›‘å¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addWatch [-m mode] path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># mode:</span></span><br><span class=\"line\"><span class=\"comment\"># - PERSISTENT: æŒä¹…åŒ–è®¢é˜…ï¼Œé’ˆå¯¹å½“å‰èŠ‚ç‚¹çš„ä¿®æ”¹å’Œåˆ é™¤äº‹ä»¶ï¼Œä»¥åŠå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„åˆ é™¤å’Œæ–°å¢äº‹ä»¶ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - PERSISTENT_RECURSIVE: æŒä¹…åŒ–é€’å½’è®¢é˜…(è¿™ä¸ªæ˜¯é»˜è®¤å€¼)ï¼Œåœ¨PERSISTENTçš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†å­èŠ‚ç‚¹ä¿®æ”¹çš„äº‹ä»¶è§¦å‘ï¼Œä»¥åŠå­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„æ•°æ®å˜åŒ–éƒ½ä¼šè§¦å‘ç›¸å…³äº‹ä»¶ï¼ˆæ»¡è¶³é€’å½’è®¢é˜…ç‰¹æ€§ï¼‰</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ç›‘å¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ™®é€šä¸€æ¬¡æ€§ Watch ä¸éœ€è¦æ‰‹åŠ¨åˆ é™¤ï¼Œè§¦å‘åä¼šè‡ªåŠ¨ç§»é™¤ï¼›removewatches ä¸»è¦ç”¨äºæŒä¹… Watchï¼ˆpersistent watchï¼‰ã€‚</span></span><br><span class=\"line\">removewatches path [-c|-d|-a] [-l]</span><br><span class=\"line\"><span class=\"comment\"># -c: ä»…åˆ é™¤å½“å‰å®¢æˆ·ç«¯çš„ Watch</span></span><br><span class=\"line\"><span class=\"comment\"># -d: åˆ é™¤æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰ Watch(åŒ…æ‹¬å…¶ä»–å®¢æˆ·ç«¯æ³¨å†Œçš„)</span></span><br><span class=\"line\"><span class=\"comment\"># -a: åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹çš„æ‰€æœ‰ Watchï¼ˆåŒ…æ‹¬å…¶ä»–å®¢æˆ·ç«¯çš„ Watchï¼‰ï¼Œæ…ç”¨ï¼ï¼ï¼</span></span><br><span class=\"line\"><span class=\"comment\"># -l: æ˜¾ç¤ºè¢«åˆ é™¤çš„ Watch åˆ—è¡¨</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ç›‘å¬å™¨åº”ç”¨åœºæ™¯\">ç›‘å¬å™¨åº”ç”¨åœºæ™¯</h3>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>ç‰¹ç‚¹</th>\n<th>åº”ç”¨åœºæ™¯ä¸¾ä¾‹</th>\n<th>é€‚åˆçš„èŠ‚ç‚¹ç±»å‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ä¸´æ—¶ç›‘å¬</strong>ï¼ˆä¸€æ¬¡æ€§ Watchï¼‰</td>\n<td>- è§¦å‘ä¸€æ¬¡åè‡ªåŠ¨ç§»é™¤<br>- å®¢æˆ·ç«¯éœ€æ‰‹åŠ¨é‡æ–°æ³¨å†Œ<br>- è½»é‡çº§ï¼Œé€‚åˆå•æ¬¡é€šçŸ¥</td>\n<td>1. <strong>é…ç½®ä¸­å¿ƒ</strong>ï¼šé…ç½®å˜åŒ–æ—¶é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥åé‡æ–°æ‹‰å–æœ€æ–°é…ç½® <br> 2. <strong>åˆ†å¸ƒå¼é”</strong>ï¼šèŠ‚ç‚¹åˆ é™¤ï¼ˆé”é‡Šæ”¾ï¼‰åé€šçŸ¥ç­‰å¾…çš„å®¢æˆ·ç«¯é‡æ–°ç«äº‰é” <br> 3. <strong>ä¸»ä»é€‰ä¸¾</strong>ï¼šä¸»èŠ‚ç‚¹å®•æœºåï¼Œå…¶ä»–èŠ‚ç‚¹æ”¶åˆ°é€šçŸ¥é‡æ–°é€‰ä¸»</td>\n<td><strong>æŒä¹…èŠ‚ç‚¹</strong>ï¼ˆPersistentï¼‰ <br><strong>ä¸´æ—¶èŠ‚ç‚¹</strong>ï¼ˆEphemeralï¼Œç”¨äºé”å’Œé€‰ä¸»ï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ°¸ä¹…ç›‘å¬</strong>ï¼ˆPersistent Watchï¼‰</td>\n<td>- æ³¨å†ŒåæŒç»­æœ‰æ•ˆï¼Œç›´åˆ°å®¢æˆ·ç«¯ä¸»åŠ¨ç§»é™¤<br>- æ”¯æŒå­èŠ‚ç‚¹å˜åŒ–ã€æ•°æ®å˜åŒ–çš„é•¿æœŸç›‘å¬</td>\n<td>1. <strong>æœåŠ¡å‘ç°</strong>ï¼šå®¢æˆ·ç«¯é•¿æœŸç›‘å¬æœåŠ¡èŠ‚ç‚¹å˜åŒ–ï¼ŒèŠ‚ç‚¹ä¸Šçº¿/ä¸‹çº¿æ—¶è‡ªåŠ¨æ›´æ–°æœ¬åœ°æœåŠ¡åˆ—è¡¨ <br> 2. <strong>ç›‘æ§å‘Šè­¦</strong>ï¼šç›‘æ§é‡è¦èŠ‚ç‚¹çŠ¶æ€ï¼ŒèŠ‚ç‚¹æ•°æ®å˜åŒ–æˆ–è¢«åˆ é™¤æ—¶è‡ªåŠ¨è§¦å‘å‘Šè­¦ <br> 3. <strong>åˆ†å¸ƒå¼ç¼“å­˜</strong>ï¼šç¼“å­˜èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œé€šçŸ¥å®¢æˆ·ç«¯åˆ·æ–°ç¼“å­˜</td>\n<td><strong>æŒä¹…èŠ‚ç‚¹</strong>ï¼ˆPersistentï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ACLæƒé™æ§åˆ¶\">ACLæƒé™æ§åˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æƒé™éƒ½æ˜¯ <code>OPEN_ACL_UNSAFE</code> ï¼Œä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¯»å†™ä»»æ„èŠ‚ç‚¹æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸éœ€è¦é™åˆ¶å¯¹èŠ‚ç‚¹çš„è®¿é—®æƒé™ï¼Œå³ <code>ACL</code> æƒé™æ§åˆ¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ZooKeeper é‡Œçš„ ACLï¼ˆAccess Control Listï¼Œè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ ä¸»è¦ç”¨äºæ§åˆ¶ è°å¯ä»¥å¯¹æŸä¸ªèŠ‚ç‚¹åšä»€ä¹ˆæ“ä½œï¼Œå®ƒæ˜¯ ZooKeeper æä¾›çš„å®‰å…¨æœºåˆ¶ä¹‹ä¸€ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ACL-çš„ä½œç”¨\">ACL çš„ä½œç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é™åˆ¶è®¿é—®ï¼šåªå…è®¸æˆæƒç”¨æˆ·æˆ–å®¢æˆ·ç«¯å¯¹æŒ‡å®šèŠ‚ç‚¹è¿›è¡Œè¯»ã€å†™ã€åˆ é™¤ç­‰æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é˜²æ­¢è¯¯æ“ä½œï¼šä¿æŠ¤é‡è¦èŠ‚ç‚¹ä¸è¢«æœªæˆæƒçš„å®¢æˆ·ç«¯ä¿®æ”¹æˆ–åˆ é™¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰å…¨éš”ç¦»ï¼šä¸åŒçš„åº”ç”¨æˆ–å›¢é˜Ÿå¯ä»¥åœ¨åŒä¸€ ZooKeeper é›†ç¾¤é‡Œå®‰å…¨å…±å­˜ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ACL-çš„ç»„æˆ\">ACL çš„ç»„æˆ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>zookeeper çš„ acl é€šè¿‡ <code>scheme:id:permissions</code> æ¥æ„æˆæƒé™åˆ—è¡¨ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">schemeï¼šæˆæƒçš„æ¨¡å¼ï¼Œä»£è¡¨é‡‡ç”¨çš„æŸç§æƒé™æœºåˆ¶ï¼ŒåŒ…æ‹¬ worldã€authã€digestã€ipã€super å‡ ç§ã€‚</li>\n<li class=\"lvl-4\">idï¼šæˆæƒå¯¹è±¡ï¼Œä»£è¡¨å…è®¸è®¿é—®çš„ç”¨æˆ·ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹©é‡‡ç”¨ IP æ–¹å¼ï¼Œä½¿ç”¨çš„æˆæƒå¯¹è±¡å¯ä»¥æ˜¯ä¸€ä¸ª IP åœ°å€æˆ– IP åœ°å€æ®µï¼›è€Œå¦‚æœä½¿ç”¨ Digest æˆ– Super æ–¹å¼ï¼Œåˆ™å¯¹åº”äºä¸€ä¸ªç”¨æˆ·åã€‚å¦‚æœæ˜¯ World æ¨¡å¼ï¼Œæ˜¯æˆæƒç³»ç»Ÿä¸­æ‰€æœ‰çš„ç”¨æˆ·ã€‚</li>\n<li class=\"lvl-4\">permissionsï¼šæˆæƒçš„æƒé™ï¼Œæƒé™ç»„åˆå­—ç¬¦ä¸²ï¼Œç”± cdrwa ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªå­—æ¯ä»£è¡¨æ”¯æŒä¸åŒæƒé™ï¼Œ åˆ›å»ºæƒé™ createÂ©ã€åˆ é™¤æƒé™ delete(d)ã€è¯»æƒé™ readÂ®ã€å†™æƒé™ write(w)ã€ç®¡ç†æƒé™admin(a)ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å¸¸è§çš„-scheme-ç±»å‹\">å¸¸è§çš„ scheme ç±»å‹</h3>\n<table>\n<thead>\n<tr>\n<th>Scheme</th>\n<th>è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>world</code></td>\n<td>å¼€æ”¾ç»™æ‰€æœ‰ç”¨æˆ·ï¼Œä»…å¯è®¾ç½®ä¸º <code>anyone</code> ä»£è¡¨æ‰€æœ‰å®¢æˆ·ç«¯</td>\n<td><code>world:anyone:r</code></td>\n</tr>\n<tr>\n<td><code>auth</code></td>\n<td>å·²é€šè¿‡ <code>addauth</code> æ·»åŠ è®¤è¯çš„å®¢æˆ·ç«¯</td>\n<td><code>auth:user1:rw</code></td>\n</tr>\n<tr>\n<td><code>digest</code></td>\n<td>ç”¨æˆ·å+å¯†ç è®¤è¯ï¼ˆå¸¸ç”¨ï¼‰ï¼Œ<code>user:pwd</code> éœ€è¦åŠ å¯†å­˜å‚¨</td>\n<td><code>digest:user1:password:rw</code></td>\n</tr>\n<tr>\n<td><code>ip</code></td>\n<td>åŸºäº IP åœ°å€æ§åˆ¶è®¿é—®</td>\n<td><code>ip:192.168.1.10:r</code></td>\n</tr>\n<tr>\n<td><code>super</code></td>\n<td>è¶…çº§ç”¨æˆ·ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™</td>\n<td><code>super:admin:secret</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æƒé™ç±»å‹\">æƒé™ç±»å‹</h3>\n<table>\n<thead>\n<tr>\n<th>æƒé™å­—ç¬¦</th>\n<th>æƒé™åç§°</th>\n<th>å…è®¸çš„æ“ä½œ/å‘½ä»¤ç¤ºä¾‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><code>r</code></strong></td>\n<td>è¯»å–(Read)</td>\n<td><code>get /node</code> <br> <code>ls /node</code> <br> <code>getAcl /node</code></td>\n<td>å…è®¸è¯»å–èŠ‚ç‚¹æ•°æ®å’Œå­èŠ‚ç‚¹åˆ—è¡¨</td>\n</tr>\n<tr>\n<td><strong><code>w</code></strong></td>\n<td>å†™å…¥(Write)</td>\n<td><code>set /node data</code></td>\n<td>å…è®¸ä¿®æ”¹èŠ‚ç‚¹æ•°æ®</td>\n</tr>\n<tr>\n<td><strong><code>c</code></strong></td>\n<td>åˆ›å»º(Create)</td>\n<td><code>create /node/sub &quot;data&quot;</code></td>\n<td>å…è®¸åœ¨å½“å‰èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹</td>\n</tr>\n<tr>\n<td><strong><code>d</code></strong></td>\n<td>åˆ é™¤(Delete)</td>\n<td><code>delete /node/sub</code></td>\n<td>å…è®¸åˆ é™¤å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</td>\n</tr>\n<tr>\n<td><strong><code>a</code></strong></td>\n<td>ç®¡ç†(Admin)</td>\n<td><code>setAcl /node acl</code></td>\n<td>å…è®¸ä¿®æ”¹ ACL æƒé™</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å…¸å‹åº”ç”¨åœºæ™¯\">å…¸å‹åº”ç”¨åœºæ™¯</h3>\n<table>\n<thead>\n<tr>\n<th>è®¤è¯æ–¹å¼ï¼ˆschemeï¼‰</th>\n<th>æƒé™ç±»å‹ï¼ˆpermissionsï¼‰</th>\n<th>å…¸å‹ ACL é…ç½®ç¤ºä¾‹</th>\n<th>åº”ç”¨åœºæ™¯</th>\n<th>ç‰¹ç‚¹è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>world</strong></td>\n<td><code>r</code>ï¼ˆåªè¯»ï¼‰</td>\n<td><code>world:anyone:r</code></td>\n<td>å…¬å…±é…ç½®èŠ‚ç‚¹ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½å¯è¯»å–</td>\n<td>ç®€å•ã€æ— è®¤è¯ï¼Œé€‚åˆå¯¹å®‰å…¨æ€§è¦æ±‚ä¸é«˜çš„åªè¯»åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>auth</strong></td>\n<td><code>r,w,c,d,a</code>ï¼ˆå¯ç»„åˆï¼‰</td>\n<td><code>auth:user:rwcd</code></td>\n<td>å†…éƒ¨åº”ç”¨å…±äº«èŠ‚ç‚¹ï¼Œéœ€å®¢æˆ·ç«¯è®¤è¯</td>\n<td>éœ€å…ˆ <code>addauth digest user1:password</code> æ·»åŠ è®¤è¯ï¼Œé€‚åˆå¤šå®¢æˆ·ç«¯å…±äº«</td>\n</tr>\n<tr>\n<td><strong>digest</strong>ï¼ˆå¸¸ç”¨ï¼‰</td>\n<td><code>r,w,c,d,a</code>ï¼ˆå¯ç»„åˆï¼‰</td>\n<td><code>digest:user:secret:crwda</code></td>\n<td>é«˜å®‰å…¨èŠ‚ç‚¹ï¼Œé…ç½®ä¸­å¿ƒï¼Œåˆ†å¸ƒå¼é”</td>\n<td>ç”¨æˆ·å+å¯†ç è®¤è¯ï¼Œéœ€åŠ å¯†å­˜å‚¨å¯†ç ï¼Œçµæ´»å®‰å…¨</td>\n</tr>\n<tr>\n<td><strong>ip</strong></td>\n<td><code>r,w,c,d,a</code>ï¼ˆå¯ç»„åˆï¼‰</td>\n<td><code>ip:192.168.1.100:r</code></td>\n<td>åŸºäº IP é™åˆ¶è®¿é—®çš„åœºæ™¯</td>\n<td>å¿«é€Ÿæ§åˆ¶æŸäº›å›ºå®š IP å¯è®¿é—®ï¼Œé€‚åˆå†…éƒ¨ç½‘ç»œåº”ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ACL-ç›¸å…³å‘½ä»¤\">ACL ç›¸å…³å‘½ä»¤</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>è¯­æ³•</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>getAcl</strong></td>\n<td><code>getAcl path</code></td>\n<td>è¯»å–æŒ‡å®šèŠ‚ç‚¹çš„ ACL</td>\n<td><code>getAcl /my_node</code></td>\n</tr>\n<tr>\n<td><strong>setAcl</strong></td>\n<td><code>setAcl path acl</code></td>\n<td>è®¾ç½®æŒ‡å®šèŠ‚ç‚¹çš„ ACL</td>\n<td><code>setAcl /my_node world:anyone:crdwa</code></td>\n</tr>\n<tr>\n<td><strong>create</strong></td>\n<td><code>create path data [acl]</code></td>\n<td>åˆ›å»ºèŠ‚ç‚¹æ—¶æŒ‡å®š ACL</td>\n<td><code>create /secure_node &quot;secret_data&quot; digest:user1:pwd:crwa</code></td>\n</tr>\n<tr>\n<td><strong>addAuth</strong></td>\n<td><code>addauth scheme auth</code></td>\n<td>æ·»åŠ è®¤è¯ç”¨æˆ·ï¼ˆç±»ä¼¼ç™»å½•ï¼‰</td>\n<td><code>addauth digest user1:password</code></td>\n</tr>\n<tr>\n<td><strong>deleteAcl(ä¸å­˜åœ¨)</strong></td>\n<td><code>setAcl path world:anyone:</code></td>\n<td>åˆ é™¤èŠ‚ç‚¹ ACLï¼ˆè®¾ä¸ºç©ºæˆ–å…¨å¼€æ”¾ï¼‰</td>\n<td><code>setAcl /my_node world:anyone:</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"auth-ä¸-digest-çš„åŒºåˆ«\"><code>auth</code> ä¸ <code>digest</code> çš„åŒºåˆ«</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ <code>auth</code> æ—¶ï¼Œéœ€å…ˆ <code>addauth digest user1:password</code> æ·»åŠ è®¤è¯ï¼Œ<code>setAcl</code> æ—¶ï¼Œä½¿ç”¨ <code>auth:user1:rw</code>ï¼Œè¿™é‡Œæ˜¯ä¸ºå·²ç»ç™»å½•çš„ç”¨æˆ·è®¾ç½®èŠ‚ç‚¹æƒé™ï¼Œæ‰€ä»¥ä¸éœ€è¦è®¾ç½®å¯†ç </p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ <code>digest</code> æ—¶ï¼Œæ— éœ€è¿›è¡Œç™»å½•è®¤è¯ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šå¯†ç ï¼Œå³<code>setAcl</code> æ—¶ï¼Œä½¿ç”¨ <code>digest:user1:password:rw</code></p>\n</li>\n<li class=\"lvl-2\">\n<p><code>digest</code> çš„å¯†ç æ˜¯ç»è¿‡åŠ å¯†çš„ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨æ˜æ–‡å¯†ç </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŠ å¯†å¯†ç </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n user:123456 | openssl dgst -binary -sha1 | openssl <span class=\"built_in\">base64</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">6DY5WhzOfGsWQ1XFuIyzxkpwdPo=</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># zookeeperå®¢æˆ·ç«¯ä¸­è®¾ç½®æƒé™</span></span><br><span class=\"line\">setAcl /name digest:user:6DY5WhzOfGsWQ1XFuIyzxkpwdPo=:cdrwa</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•æ—¶å¯†ç æ˜¯æ˜æ–‡</span></span><br><span class=\"line\">addauth digest user:123456</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ— è®ºä½¿ç”¨ <code>digest</code> è¿˜æ˜¯ <code>auth</code>ï¼Œåœ¨éœ€è¦è®¿é—®èŠ‚ç‚¹å‰ï¼Œéƒ½éœ€è¦å…ˆç™»å½•ã€‚</p>\n</li>\n</ul>\n<h3 id=\"super-è¶…çº§ç®¡ç†å‘˜\"><code>super</code> è¶…çº§ç®¡ç†å‘˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‹¥æœ‰å…¨éƒ¨èŠ‚ç‚¹çš„æ‰€æœ‰æƒé™: <code>crwda</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>è®¾ç½®è¶…çº§ç®¡ç†å‘˜</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŠ å¯†å¯†ç ï¼Œç”¨æˆ·å’Œå¯†ç å¯ä»¥éšæ„è®¾ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n admin:123456 | openssl dgst -binary -sha1 | openssl <span class=\"built_in\">base64</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">0uek/hZ/V9fgiM35b0Z2226acMQ=</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å¼€ conf/zoo.cfg æ–‡ä»¶å¹¶ç¼–è¾‘ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢å†…å®¹</span></span><br><span class=\"line\">DigestAuthenticationProvider.superDigest=admin:0uek/hZ/V9fgiM35b0Z2226acMQ=</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡æ–°å¯åŠ¨æœåŠ¡åç™»å½•å®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºèŠ‚ç‚¹å¹¶è®¾ç½®æƒé™ï¼Œè¿™é‡Œå°†èŠ‚ç‚¹æˆæƒç»™ç”¨æˆ·user</span></span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 10] create /testNode 666 digest:user:6DY5WhzOfGsWQ1XFuIyzxkpwdPo=:rw</span><br><span class=\"line\">Created /testNode</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹è¢«æ‹’ç»</span></span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 11] get /testNode</span><br><span class=\"line\">Insufficient permission : /testNode</span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•superç”¨æˆ·ï¼ŒéªŒè¯è¶…çº§ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®èŠ‚ç‚¹</span></span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 12] addauth digest admin:123456</span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹å°±å¯ä»¥äº†</span></span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 13] get /testNode</span><br><span class=\"line\">666</span><br></pre></td></tr></table></figure>\n<h2 id=\"4å­—æ¯å‘½ä»¤\">4å­—æ¯å‘½ä»¤</h2>\n<h3 id=\"ä»€ä¹ˆæ˜¯-4-å­—æ¯å‘½ä»¤\">ä»€ä¹ˆæ˜¯ <code>4 å­—æ¯å‘½ä»¤</code>?</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper æä¾›äº†ä¸€ç»„ç®€çŸ­çš„ <code>4ä¸ªå­—æ¯çš„ç®¡ç†å‘½ä»¤</code>(Four Letter Words Commands, 4lw)ï¼Œå¯ä»¥é€šè¿‡ TCP è¿æ¥ ZooKeeper ç«¯å£ï¼ˆé»˜è®¤ 2181ï¼‰å‘é€è¿™äº›å‘½ä»¤ï¼Œå¿«é€ŸæŸ¥çœ‹æˆ–ç®¡ç† ZooKeeper çŠ¶æ€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨çš„ <code>4å­—æ¯å‘½ä»¤</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>å¼•å…¥ç‰ˆæœ¬</th>\n<th>åŠŸèƒ½æè¿°</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>conf</code></td>\n<td>3.3.0</td>\n<td>æ‰“å°æœåŠ¡ç›¸å…³é…ç½®çš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo conf | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>cons</code></td>\n<td>3.3.0</td>\n<td>åˆ—å‡ºæ‰€æœ‰è¿æ¥åˆ°è¯¥æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥/ä¼šè¯è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥æ”¶/å‘é€çš„åŒ…æ•°é‡ã€ä¼šè¯IDã€æ“ä½œå»¶è¿Ÿã€æœ€åæ“ä½œæ‰§è¡Œæ—¶é—´ç­‰</td>\n<td><code>echo cons | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>crst</code></td>\n<td>3.3.0</td>\n<td>é‡ç½®æ‰€æœ‰è¿æ¥çš„è¿æ¥å’Œä¼šè¯ç»Ÿè®¡ä¿¡æ¯</td>\n<td><code>echo crst | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>dump</code></td>\n<td>-</td>\n<td>åˆ—å‡ºé‡è¦çš„ä¼šè¯å’Œä¸´æ—¶èŠ‚ç‚¹ä¿¡æ¯ï¼Œä»…åœ¨ Leader èŠ‚ç‚¹ä¸Šæœ‰æ•ˆ</td>\n<td><code>echo dump | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>envi</code></td>\n<td>-</td>\n<td>æ‰“å°æœåŠ¡ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo envi | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>reqs</code></td>\n<td>-</td>\n<td>åˆ—å‡ºæœªç»å¤„ç†çš„è¯·æ±‚</td>\n<td><code>echo reqs | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>ruok</code></td>\n<td>-</td>\n<td>æµ‹è¯•æœåŠ¡æ˜¯å¦å¤„äºæ­£å¸¸çŠ¶æ€ï¼›æ­£å¸¸è¿”å› <code>imok</code></td>\n<td><code>echo ruok | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>stat</code></td>\n<td>-</td>\n<td>è¾“å‡ºå…³äºæ€§èƒ½å’Œå®¢æˆ·ç«¯è¿æ¥çš„åˆ—è¡¨ä¿¡æ¯</td>\n<td><code>echo stat | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>srst</code></td>\n<td>-</td>\n<td>é‡ç½®æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯</td>\n<td><code>echo srst | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>srvr</code></td>\n<td>3.3.0</td>\n<td>åˆ—å‡ºè¿æ¥æœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo srvr | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>wchs</code></td>\n<td>3.3.0</td>\n<td>åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo wchs | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>wchc</code></td>\n<td>3.3.0</td>\n<td>é€šè¿‡ä¼šè¯åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ Watch ç›¸å…³çš„ä¼šè¯åˆ—è¡¨</td>\n<td><code>echo wchc | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>wchp</code></td>\n<td>3.3.0</td>\n<td>é€šè¿‡è·¯å¾„åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ä¼šè¯ç›¸å…³çš„è·¯å¾„</td>\n<td><code>echo wchp | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>mntr</code></td>\n<td>3.4.0</td>\n<td>è¾“å‡ºå¯ç”¨äºæ£€æµ‹é›†ç¾¤å¥åº·çŠ¶æ€çš„å…³é”®æŒ‡æ ‡å˜é‡åˆ—è¡¨</td>\n<td><code>echo mntr | nc 127.0.0.1 2181</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å¼€å¯-4å­—æ¯å‘½ä»¤\">å¼€å¯ <code>4å­—æ¯å‘½ä»¤</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ ZooKeeper 3.5.0 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œ4lw å‘½ä»¤é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå¿…é¡»åœ¨é…ç½®æ–‡ä»¶(zoo.cfg)ä¸­æ˜¾å¼å¼€å¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¡¨ç¤ºå…è®¸æ‰€æœ‰ 4lw å‘½ä»¤éƒ½èƒ½ç”¨ï¼ˆé£é™©æœ€å¤§ï¼‰</span></span><br><span class=\"line\">4lw.commands.whitelist=*</span><br><span class=\"line\"><span class=\"comment\"># è¿™æ ·åªå…è®¸æ‰§è¡Œ statã€confã€ruok è¿™å‡ ä¸ªå‘½ä»¤ã€‚</span></span><br><span class=\"line\">4lw.commands.whitelist=<span class=\"built_in\">stat</span>,conf,ruok</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨æ–¹æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœæ²¡æœ‰å®‰è£… ncï¼Œå¯ä»¥ä½¿ç”¨ yum å®‰è£…</span></span><br><span class=\"line\">yum install nc -y</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"built_in\">stat</span> | nc 127.0.0.1 2181</span><br></pre></td></tr></table></figure>\n<h2 id=\"Zookeeper-Java-Client\">Zookeeper Java Client</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é¡¹ç›®ç¤ºä¾‹ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/zookeeper-demo/\">Githubåœ°å€</a>ï¼Œå•å…ƒæµ‹è¯•ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Zookeeper-å®˜æ–¹Javaå®¢æˆ·ç«¯\">Zookeeper å®˜æ–¹Javaå®¢æˆ·ç«¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeperå®˜æ–¹çš„å®¢æˆ·ç«¯APIæä¾›äº†åŸºæœ¬çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¼šè¯ã€åˆ›å»ºèŠ‚ç‚¹ã€è¯»å–èŠ‚ç‚¹ã€æ›´æ–°æ•°æ®ã€åˆ é™¤èŠ‚ç‚¹å’Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ç­‰ã€‚ä¸è¿‡ï¼Œå¯¹äºå®é™…å¼€å‘æ¥è¯´ï¼ŒZooKeeperå®˜æ–¹APIæœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ZooKeeperçš„Watcherç›‘æµ‹æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ¯æ¬¡è§¦å‘ä¹‹åéƒ½éœ€è¦é‡æ–°è¿›è¡Œæ³¨å†Œã€‚</li>\n<li class=\"lvl-4\">ä¼šè¯è¶…æ—¶ä¹‹åæ²¡æœ‰å®ç°é‡è¿æœºåˆ¶ã€‚</li>\n<li class=\"lvl-4\">å¼‚å¸¸å¤„ç†çƒ¦çï¼ŒZooKeeperæä¾›äº†å¾ˆå¤šå¼‚å¸¸ï¼Œå¯¹äºå¼€å‘äººå‘˜æ¥è¯´å¯èƒ½æ ¹æœ¬ä¸çŸ¥é“åº”è¯¥å¦‚ä½•å¤„ç†è¿™äº›æŠ›å‡ºçš„å¼‚å¸¸ã€‚</li>\n<li class=\"lvl-4\">ä»…æä¾›äº†ç®€å•çš„byte[]æ•°ç»„ç±»å‹çš„æ¥å£ï¼Œæ²¡æœ‰æä¾›Java POJOçº§åˆ«çš„åºåˆ—åŒ–æ•°æ®å¤„ç†æ¥å£ã€‚</li>\n<li class=\"lvl-4\">åˆ›å»ºèŠ‚ç‚¹æ—¶å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦è‡ªè¡Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ã€‚</li>\n<li class=\"lvl-4\">æ— æ³•å®ç°çº§è”åˆ é™¤ã€‚</li>\n<li class=\"lvl-4\">æ€»ä¹‹ï¼ŒZooKeeperå®˜æ–¹APIåŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­æ¯”è¾ƒç¬¨é‡ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>é¡¹ç›®å¼•å…¥ä¾èµ–æ—¶ï¼Œæœ€å¥½ä¿æŒä¸æœåŠ¡ç«¯ç‰ˆæœ¬ä¸€è‡´ï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰ä¸€äº›å…¼å®¹æ€§çš„é—®é¢˜</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- zookeeper client --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.zookeeper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.8.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Zookeeper-ç¬¬ä¸‰æ–¹Javaå®¢æˆ·ç«¯-Curator\">Zookeeper ç¬¬ä¸‰æ–¹Javaå®¢æˆ·ç«¯ Curator</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://curator.apache.org/docs/about\">Curator</a>æ˜¯Netflixå…¬å¸å¼€æºçš„ä¸€å¥—ZooKeeperå®¢æˆ·ç«¯æ¡†æ¶ï¼Œå’ŒZkClientä¸€æ ·å®ƒè§£å†³äº†éå¸¸åº•å±‚çš„ç»†èŠ‚å¼€å‘å·¥ä½œï¼ŒåŒ…æ‹¬è¿æ¥ã€é‡è¿ã€åå¤æ³¨å†ŒWatcherçš„é—®é¢˜ä»¥åŠNodeExistsExceptionå¼‚å¸¸ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Curatoræ˜¯ApacheåŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ä¹‹ä¸€ï¼ŒCuratorå…·æœ‰æ›´åŠ å®Œå–„çš„æ–‡æ¡£ï¼Œå¦å¤–è¿˜æä¾›äº†ä¸€å¥—æ˜“ç”¨æ€§å’Œå¯è¯»æ€§æ›´å¼ºçš„Fluenté£æ ¼çš„å®¢æˆ·ç«¯APIæ¡†æ¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Curatorè¿˜ä¸ºZooKeeperå®¢æˆ·ç«¯æ¡†æ¶æä¾›äº†ä¸€äº›æ¯”è¾ƒæ™®éçš„ã€å¼€ç®±å³ç”¨çš„ã€åˆ†å¸ƒå¼å¼€å‘ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚Recipeã€å…±äº«é”æœåŠ¡ã€Masteré€‰ä¸¾æœºåˆ¶å’Œåˆ†å¸ƒå¼è®¡ç®—å™¨ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…é¿å…äº†â€œé‡å¤é€ è½®å­â€çš„æ— æ•ˆå¼€å‘å·¥ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨å®é™…çš„å¼€å‘åœºæ™¯ä¸­ï¼Œä½¿ç”¨Curatorå®¢æˆ·ç«¯å°±è¶³ä»¥åº”ä»˜æ—¥å¸¸çš„ZooKeeperé›†ç¾¤æ“ä½œçš„éœ€æ±‚ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¼•å…¥ä¾èµ–è¯´æ˜ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ¨¡å—</th>\n<th>ä¾èµ–å…³ç³»</th>\n<th>åŠŸèƒ½å®šä½</th>\n<th>å…¸å‹åŠŸèƒ½ä¸¾ä¾‹</th>\n<th>å¸¸ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>curator-client</strong></td>\n<td>ä¾èµ– zookeeper</td>\n<td>è¿æ¥ç®¡ç†ã€é‡è¯•ç­–ç•¥ã€åº•å±‚ API</td>\n<td>è¿æ¥ä¼šè¯ç®¡ç†ã€RetryPolicy</td>\n<td>éœ€è¦æœ€è½»é‡çš„ ZooKeeper å®¢æˆ·ç«¯</td>\n</tr>\n<tr>\n<td><strong>curator-framework</strong></td>\n<td>ä¾èµ– curator-client</td>\n<td>é«˜å±‚ API å°è£…ï¼Œç®€åŒ– ZK æ“ä½œ</td>\n<td>åˆ›å»ºèŠ‚ç‚¹ã€Watcher ç®¡ç†ã€è‡ªåŠ¨é‡è¿</td>\n<td>é€šç”¨ ZooKeeper å®¢æˆ·ç«¯å¼€å‘</td>\n</tr>\n<tr>\n<td><strong>curator-recipes</strong></td>\n<td>ä¾èµ– curator-framework â†’ curator-client</td>\n<td>åˆ†å¸ƒå¼æ¨¡å¼ç°æˆå®ç°</td>\n<td>åˆ†å¸ƒå¼é”ã€Leader é€‰ä¸¾ã€é˜Ÿåˆ—ã€Barrier</td>\n<td>ç›´æ¥ç”¨åˆ†å¸ƒå¼å·¥å…·ï¼Œæ— éœ€è‡ªå·±å®ç°</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ä½¿ç”¨å»ºè®®</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>å¦‚æœä½ åªæƒ³è½»é‡è®¿é—® ZooKeeper â†’ <code>curator-client</code> å°±å¤Ÿäº†ï¼Œä½†å‡ ä¹æ²¡äººå•ç‹¬ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-4\">\n<p>å¦‚æœä½ æƒ³æ–¹ä¾¿æ“ä½œ ZooKeeper API â†’ <code>curator-framework</code>ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½é€‚ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-4\">\n<p>å¦‚æœä½ æƒ³ç”¨åˆ†å¸ƒå¼é”ã€é€‰ä¸¾ã€Barrier â†’ <code>curator-recipes</code>ï¼ˆå®ƒä¼šè‡ªåŠ¨å¼•å…¥å‰ä¸¤ä¸ªï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- zookeeper client --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.zookeeper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.8.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!--curator--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-recipes<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.9.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.zookeeper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Zookeeper ç‰ˆæœ¬ä¸º 3.8.4ã€‚ Zookeeper ç®€ä»‹ ZooKeeper æ˜¯ä¸€ä¸ªé›†ä¸­å¼æœåŠ¡ï¼Œç”¨äºï¼š åœºæ™¯ ZooKeeper å®˜æ–¹åŠŸèƒ½ ä¸»è¦èŠ‚ç‚¹ç±»å‹ å…·ä½“åœºæ™¯ç¤ºä¾‹ é…ç½®ä¸­å¿ƒ (Config Center) ç»´æŠ¤é…ç½®ä¿¡æ¯ (Configuration Management) æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰ æŠŠæ•°æ®åº“è¿æ¥ä¿¡æ¯ã€ç³»ç»Ÿå‚æ•°ç­‰æ”¾åœ¨ ZooKeeper é‡Œï¼ŒåŠ¨æ€æ›´æ–°ï¼Œåƒ Apolloã€Spring Cloud Config ä¸€æ ·ã€‚ æ³¨å†Œä¸­å¿ƒ (Service Registry) æä¾›å‘½åæœåŠ¡ (Naming Service) ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEphemeralï¼‰ æœåŠ¡å®ä¾‹å¯åŠ¨æ—¶åœ¨ ZooKeeper é‡Œæ³¨å†Œè‡ªå·±çš„åœ°å€ï¼Œå®¢æˆ·ç«¯ä» ZooKeeper è·å–æœåŠ¡åˆ—è¡¨ï¼Œç±»ä¼¼äº Nacosã€Eurekaã€‚ åˆ†å¸ƒå¼é” (Distributed Lock) åˆ†å¸ƒå¼åŒæ­¥ (Distributed Synchronization) ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEphemeral Sequentialï¼‰ ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨æ‰§è¡Œå…³é”®ä»»åŠ¡ï¼Œå…¸å‹åº”ç”¨æ˜¯åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚ æ¶ˆæ¯é˜Ÿåˆ— (Message Queue) é›†ç¾¤ç®¡ç†æœåŠ¡ (Cluster Management) æŒä¹…/ä¸´æ—¶èŠ‚ç‚¹ + Watch æœºåˆ¶ é€šè¿‡ Watch æœºåˆ¶ç›‘å¬ ZNode å˜åŒ–ï¼ŒèŠ‚ç‚¹é—´ç”¨æ•°æ®å˜æ›´å½“â€œä¿¡å·â€ä¼ é€’æ¶ˆæ¯ï¼Œæ—©æœŸ Kafka ç”¨è¿‡è¿™ç§æ–¹å¼ã€‚ ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ª ZNodeã€‚ ä¸åŒäºæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä¿å­˜æ•°æ®ï¼Œæ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ 1MB çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬(version)ï¼Œç‰ˆæœ¬ä»0å¼€å§‹è®¡æ•°ã€‚ Zookeeper å®‰è£… è¿è¡Œ Zookeeper éœ€è¦å®‰è£… JDK1.8+ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ OpenJDK11 12345678910111213141516sudo mkdir -p /usr/local/jdkcd /usr/local/jdksudo wget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gzsudo tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gzsudo ln -s jdk-11.0.28+6 jdk11# é…ç½®ç¯å¢ƒå˜é‡vim /etc/profile # æ·»åŠ å¦‚ä¸‹å†…å®¹ export JAVA_HOME=/usr/local/jdk/jdk11 export PATH=$JAVA_HOME/bin:$PATH# ç«‹å³ç”Ÿæ•ˆsource /etc/profile# æŸ¥çœ‹javaç‰ˆæœ¬java -versionopenjdk version &quot;11.0.28&quot; 2025-07-15OpenJDK Runtime Environment Temurin-11.0.28+6 (build 11.0.28+6)OpenJDK 64-Bit Server VM Temurin-11.0.28+6 (build 11.0.28+6, mixed mode) å•æœºå®‰è£… ä¸‹è½½ Zookeeperï¼Œç›®å‰æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ä¸º 3.8.4 123456# ä¸‹è½½wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz# è§£å‹tar -zxvf apache-zookeeper-3.8.4-bin.tar.gz# é…ç½®ä¸ªè½¯è¿æ¥ï¼Œæ–¹ä¾¿ä»¥åå‡çº§ln -s apache-zookeeper-3.8.4-bin zookeeper ä¿®æ”¹é…ç½®æ–‡ä»¶ 1234cd zookeeper/confcp zoo_sample.cfg zoo.cfg# å»ºè®®ä¿®æ”¹ zoo.cfg é…ç½®æ–‡ä»¶ï¼Œå°† dataDir=/tmp/zookeeper ä¿®æ”¹ä¸ºæŒ‡å®šçš„dataç›®å½•vim zoo.cfg zoo.cfg å‚æ•°è¯´æ˜ é…ç½®é¡¹ è¯´æ˜ é»˜è®¤å€¼ å•ä½ / å¤‡æ³¨ tickTime ZooKeeper æ—¶é—´é…ç½®ä¸­çš„åŸºæœ¬å•ä½ 2000 æ¯«ç§’ initLimit follower åˆå§‹åŒ–è¿æ¥åˆ° leader çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•° 10 10 Ã— tickTime = 20000 ms syncLimit follower ä¸ leader æ•°æ®åŒæ­¥çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•° 5 5 Ã— tickTime = 10000 ms dataDir æ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•ï¼ˆæœªæŒ‡å®š dataLogDir æ—¶ï¼Œæ—¥å¿—ä¹Ÿä¼šä¿å­˜åœ¨æ­¤ç›®å½•ï¼‰ /tmp/zookeeper ç›®å½•è·¯å¾„ clientPort å®¢æˆ·ç«¯è¿æ¥ ZooKeeper çš„ç«¯å£å· 2181 é»˜è®¤ 2181 maxClientCnxns å•ä¸ªå®¢æˆ·ç«¯æœ€å¤§å¹¶å‘è¿æ¥æ•° 60 è¶…è¿‡é™åˆ¶åæ–°è¿æ¥ä¼šè¢«æ‹’ç» autopurge.snapRetainCount å¿«ç…§æ–‡ä»¶ä¿ç•™ä¸ªæ•°ï¼Œè¶…è¿‡æ•°é‡çš„å°†ä¼šè¢«æ¸…ç† 3 é»˜è®¤ 3 autopurge.purgeInterval æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš”æ—¶é—´ï¼Œå•ä½å°æ—¶ï¼Œ0 è¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç† 1 1 å°æ—¶ å¯åŠ¨ zookeeper 123456789101112cd zookeeper# å¯åŠ¨bin/zkServer.sh start# æŒ‡å®šé…ç½®æ–‡ä»¶bin/zkServer.sh start conf/zoo.cfg# åœæ­¢bin/zkServer.sh stop# æŸ¥çœ‹çŠ¶æ€bin/zkServer.sh status# æŸ¥çœ‹ç‰ˆæœ¬./bin/zkServer.sh version é›†ç¾¤å®‰è£… ZooKeeper é›†ç¾¤è§’è‰² 1. Leaderï¼ˆé¢†å¯¼è€…ï¼‰ èŒè´£ï¼š äº‹åŠ¡è¯·æ±‚ï¼ˆå†™æ“ä½œï¼‰çš„å”¯ä¸€è°ƒåº¦è€…å’Œå¤„ç†è€…ï¼Œä¿è¯é›†ç¾¤äº‹åŠ¡å¤„ç†çš„é¡ºåºæ€§ï¼› é›†ç¾¤å†…éƒ¨å„ä¸ªæœåŠ¡å™¨çš„è°ƒåº¦è€…ï¼› å¯¹äº createã€setDataã€delete ç­‰å†™æ“ä½œè¯·æ±‚ï¼Œç»Ÿä¸€è½¬å‘ç»™ Leader å¤„ç†ï¼› Leader è´Ÿè´£å†³å®šç¼–å·ã€æ‰§è¡Œæ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º äº‹åŠ¡ã€‚ ä¸‰å°è™šæ‹Ÿæœº zoo.cfg æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é€‰ä¸¾å‡º Leader è§’è‰²ï¼Œåˆ™å…¶ä½™å°±æ˜¯ Follower è§’è‰²ã€‚ 123server.1=10.250.0.229:2888:3888server.2=10.250.0.152:2888:3888server.3=10.250.0.36:2888:3888 2. Followerï¼ˆè·Ÿéšè€…ï¼‰ èŒè´£ï¼š å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡ï¼ˆè¯»æ“ä½œï¼‰è¯·æ±‚ï¼ˆå¯ä»¥ç›´æ¥å“åº”ï¼‰ï¼› è½¬å‘äº‹åŠ¡è¯·æ±‚ç»™ Leaderï¼› å‚ä¸é›†ç¾¤ Leader é€‰ä¸¾æŠ•ç¥¨ã€‚ leaderèŠ‚ç‚¹å¯ä»¥å¤„ç†è¯»å†™è¯·æ±‚ï¼Œfolloweråªå¯ä»¥å¤„ç†è¯»è¯·æ±‚ã€‚followeråœ¨æ¥åˆ°å†™è¯·æ±‚æ—¶ä¼šæŠŠå†™è¯·æ±‚è½¬å‘ç»™leaderæ¥å¤„ç†ã€‚ 3. Observerï¼ˆè§‚å¯Ÿè€…ï¼‰ èŒè´£ï¼š å¯¹äºéäº‹åŠ¡è¯·æ±‚ï¼ˆè¯»æ“ä½œï¼‰å¯ä»¥ç‹¬ç«‹å¤„ç†ï¼› å¯¹äºäº‹åŠ¡è¯·æ±‚ä¼šè½¬å‘ç»™ Leader å¤„ç†ï¼› æ¥æ”¶æ¥è‡ª Leader çš„ inform ä¿¡æ¯ï¼Œæ›´æ–°æœ¬åœ°å­˜å‚¨ï¼› ä¸å‚ä¸æäº¤å’Œé€‰ä¸¾æŠ•ç¥¨ï¼› é€šå¸¸ç”¨äº æå‡é›†ç¾¤éäº‹åŠ¡å¤„ç†èƒ½åŠ›ï¼Œä¸å½±å“é›†ç¾¤äº‹åŠ¡å¤„ç†æ€§èƒ½ã€‚ é…ç½®ä¸€ä¸ª ID ä¸º 4 çš„è§‚å¯Ÿè€…èŠ‚ç‚¹ï¼š 1server.4=10.250.0.56:2888:3888:observer é›†ç¾¤æ­å»º ç¯å¢ƒå‡†å¤‡ï¼š4å°æœåŠ¡å™¨ï¼ŒæŒ‰ç…§ å•æœºå®‰è£… çš„æ–¹å¼å‡†å¤‡å¥½ Zookeeper ç¯å¢ƒ 123410.250.0.22910.250.0.15210.250.0.3610.250.0.56 zoo.cfg æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½® 1234server.1=10.250.0.229:2888:3888server.2=10.250.0.152:2888:3888server.3=10.250.0.36:2888:3888server.4=10.250.0.56:2888:3888:observer åˆ†åˆ«åœ¨ dataDir ç›®å½•ä¸‹åˆ›å»º myid æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸ server å¯¹åº”çš„ç¼–å·ï¼ˆæ³¨æ„ï¼šä¸Šä¸‹ä¸è¦æœ‰ç©ºè¡Œï¼Œå·¦å³ä¸è¦æœ‰ç©ºæ ¼ï¼‰ 12345# æ³¨æ„ èŠ‚ç‚¹ç¼–å·ä¸èƒ½é‡å¤ï¼Œè€Œä¸”è¦ä¸ zoo.cfg æ–‡ä»¶ä¸­çš„ server.id ä¸€è‡´echo 1 &gt; myid# echo 2 &gt; myid# echo 3 &gt; myid# echo 4 &gt; myid åˆ†åˆ«å¯åŠ¨ Zookeeper æœåŠ¡å™¨ 12345# åˆ†åˆ«å¯åŠ¨4ä¸ªèŠ‚ç‚¹çš„zookeeper serverbin/zkServer.sh start# æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°èŠ‚ç‚¹è§’è‰²ç±»å‹bin/zkServer.sh status é›†ç¾¤æœ€å°‘èŠ‚ç‚¹è¦æ±‚å’Œæ‰©å®¹è§„åˆ™ ZooKeeper ä½¿ç”¨ å¤šæ•°æ´¾ï¼ˆquorumï¼‰æœºåˆ¶ æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ 1231.é›†ç¾¤æ€»èŠ‚ç‚¹æ•° N2.å®¹å¿çš„å®•æœºèŠ‚ç‚¹æ•° F = (N-1)/2ï¼ˆå‘ä¸‹å–æ•´ï¼‰3.è¦ä¿è¯é›†ç¾¤å¯ç”¨ï¼Œéœ€è¦ å¤§äº N/2 çš„èŠ‚ç‚¹å­˜æ´» é›†ç¾¤æ‰©å®¹è§„åˆ™ 1234561.èŠ‚ç‚¹æ€»æ•°å¿…é¡»æ˜¯å¥‡æ•° å¥‡æ•°èŠ‚ç‚¹å¯ä»¥ä¿è¯å¤šæ•°æ´¾æŠ•ç¥¨æœºåˆ¶æ­£å¸¸ å¶æ•°èŠ‚ç‚¹ä¸æ¨èï¼Œå®¹é”™èƒ½åŠ›ä¸å¢åŠ ï¼ˆæ¯”å¦‚ 4 å°ï¼Œä»ç„¶åªå®¹å¿ 1 å°å®•æœºï¼‰2.æ¯æ¬¡æ‰©å®¹å»ºè®® +2 èŠ‚ç‚¹ è¿™æ ·æ—¢ä¿æŒå¥‡æ•°ï¼Œåˆå¢åŠ  quorum å®¹é”™èƒ½åŠ› æœ€å°‘èŠ‚ç‚¹ä¸å®¹é”™èƒ½åŠ›è¡¨æ ¼ é›†ç¾¤æ€»èŠ‚ç‚¹æ•° N å®¹å¿å®•æœºæ•° F å¯ç”¨ quorum èŠ‚ç‚¹æ•° å¤‡æ³¨ 1 0 1 ä¸æ¨èï¼Œæ— æ³•å®¹å¿æ•…éšœ 2 0 2 ä¸æ¨èï¼Œ1 å°å®•æœºå°±ä¸å¯ç”¨ 3 1 2 æœ€å°å¯ç”¨ç”Ÿäº§é›†ç¾¤ 5 2 3 æ¨èç”Ÿäº§é›†ç¾¤è§„æ¨¡ 7 3 4 é«˜å¯ç”¨å¤§é›†ç¾¤ 9 4 5 æ›´å¤§é›†ç¾¤ï¼Œé«˜å®¹é”™ 11 5 6 æé«˜å¯ç”¨åœºæ™¯ ZooKeeper é»˜è®¤ç«¯å£è¯´æ˜ ç«¯å£ ç”¨é€” è¯´æ˜ 2181 å®¢æˆ·ç«¯è¿æ¥ç«¯å£ å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªç«¯å£è®¿é—® ZooKeeper 2888 é›†ç¾¤å†…éƒ¨é€šä¿¡ follower ä¸ leader ä¹‹é—´åŒæ­¥æ•°æ® 3888 leader é€‰ä¸¾ç«¯å£ é›†ç¾¤é€‰ä¸¾ leader ä½¿ç”¨ 8080 (å¯é€‰) admin/metrics webç«¯å£ å¦‚æœå¼€å¯äº† adminServer 123456789101112# æ°¸ä¹…å¼€å¯ç«¯å£sudo firewall-cmd --permanent --add-port=2181/tcpsudo firewall-cmd --permanent --add-port=2888/tcpsudo firewall-cmd --permanent --add-port=3888/tcp# å¦‚æœä½¿ç”¨ adminServersudo firewall-cmd --permanent --add-port=8080/tcp# é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½®sudo firewall-cmd --reload# æŸ¥çœ‹æ˜¯å¦å¼€æ”¾æˆåŠŸsudo firewall-cmd --list-all å®¢æˆ·ç«¯è¿æ¥ å‘½ä»¤è¡Œ 1234# é»˜è®¤è¿æ¥ 127.0.0.1:2181bin/zkCli.sh# æŒ‡å®š -server ip:portï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œåˆ™è¿æ¥ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒZooKeeper ä¼šè‡ªåŠ¨å¤„ç†ä¸ Leader/Follower çš„äº¤äº’bin/zkCli.sh -server 127.0.0.1:2181 å®¢æˆ·ç«¯å‘½ä»¤ç®€ä»‹ï¼šå‚è€ƒå®˜ç½‘ å‘½ä»¤ è¯­æ³•ç¤ºä¾‹ åŠŸèƒ½æè¿° å¸¸ç”¨å‚æ•°åŠè¯´æ˜ ç¤ºä¾‹ help help æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤ æ—  help version version æŸ¥çœ‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯ æ—  version connect connect host:port è¿æ¥åˆ°æŒ‡å®š ZooKeeper æœåŠ¡å™¨ host:port: æœåŠ¡å™¨åœ°å€ connect 127.0.0.1:2181 close close å…³é—­å½“å‰ä¼šè¯ ,é€šè¿‡ connect å¯é‡è¿ æ—  close quit quit é€€å‡ºå®¢æˆ·ç«¯ æ—  quit ls ls [-s] [-w] [-R] path æŸ¥çœ‹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ - -w: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–- -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯- -R: é€’å½’æŸ¥çœ‹ ls -s -w /zk_test getAllChildrenNumber getAllChildrenNumber path è·å–æŸèŠ‚ç‚¹æ‰€æœ‰å­èŠ‚ç‚¹çš„æ€»æ•° æ—  getAllChildrenNumber /zk_test getEphemerals getEphemerals path è·å–æŸè·¯å¾„ä¸‹æ‰€æœ‰ä¸´æ—¶èŠ‚ç‚¹ æ—  getEphemerals /zk_test create create [-s] [-e] [-c] [-t ttl] path [data] [acl] åˆ›å»ºèŠ‚ç‚¹ - -s: é¡ºåºèŠ‚ç‚¹- -e: ä¸´æ—¶èŠ‚ç‚¹- -c: å®¹å™¨èŠ‚ç‚¹- -t ttl: TTLèŠ‚ç‚¹ï¼Œå•ä½æ¯«ç§’ create -e /zk_test_ephemeral &quot;temp_data&quot; get get [-s] [-w] path è·å–èŠ‚ç‚¹æ•°æ®ä¿¡æ¯ - -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯- -w: ç›‘å¬èŠ‚ç‚¹å˜åŒ– get -s -w /zk_test set set [-s] [-v version] path data è®¾ç½®èŠ‚ç‚¹æ•°æ® - -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯- -v: æŒ‡å®šç‰ˆæœ¬å· set /zk_test &quot;new_data&quot; stat stat [-w] path æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ - -w: ç›‘å¬èŠ‚ç‚¹å˜åŒ– stat -w /zk_test sync sync path åŒæ­¥æŒ‡å®šèŠ‚ç‚¹æ•°æ® æ—  sync /zk_test delete delete [-v version] path åˆ é™¤æŸä¸€èŠ‚ç‚¹ï¼ˆæ— å­èŠ‚ç‚¹ï¼‰ - -v: èŠ‚ç‚¹ç‰ˆæœ¬å· delete /zk_test deleteall deleteall path é€’å½’åˆ é™¤æŸä¸€èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ æ—  deleteall /zk_test getAcl getAcl [-s] path è·å–èŠ‚ç‚¹è®¿é—®æ§åˆ¶ä¿¡æ¯ - -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ getAcl /zk_test setAcl setAcl [-s] [-v version] [-R] path acl è®¾ç½®èŠ‚ç‚¹è®¿é—®æ§åˆ¶åˆ—è¡¨ - -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯- -v: æŒ‡å®šç‰ˆæœ¬å·- -R: é€’å½’è®¾ç½® setAcl /zk_test world:anyone:r listquota listquota path æŸ¥çœ‹èŠ‚ç‚¹é…é¢ä¿¡æ¯ æ—  listquota /zk_test setquota setquota [-n] [-b] val path å¯¹èŠ‚ç‚¹å¢åŠ é™åˆ¶ - -n: å­èŠ‚ç‚¹æœ€å¤§ä¸ªæ•°- -b: æ•°æ®å€¼æœ€å¤§é•¿åº¦ï¼Œ-1 è¡¨ç¤ºæ— é™åˆ¶ setquota -n 5 /zk_test delquota delquota [-n | -b] path åˆ é™¤èŠ‚ç‚¹é…é¢é™åˆ¶ - -n: åˆ é™¤å­èŠ‚ç‚¹æ•°é™åˆ¶- -b: åˆ é™¤æ•°æ®å€¼å¤§å°é™åˆ¶ delquota -n /zk_test config config æŸ¥çœ‹æœåŠ¡å™¨é…ç½® æ—  config whoami whoami æŸ¥çœ‹å½“å‰ä¼šè¯èº«ä»½ æ—  whoami GUI å·¥å…· åç§° ç±»å‹ / è¿è¡Œæ–¹å¼ ä¼˜ç‚¹ æ³¨æ„äº‹é¡¹ PrettyZoo æ¡Œé¢åº”ç”¨ï¼ˆJavaFXï¼‰(GitHub) æ”¯æŒ Mac/Windows/Linuxï¼Œç•Œé¢å‹å¥½ï¼›æ”¯æŒèŠ‚ç‚¹åˆ›å»º/åˆ é™¤/æ›´æ–°/æŸ¥è¯¢ï¼ŒACL ç®¡ç†ï¼Œå¤š ZK å®ä¾‹ç®¡ç†ï¼ŒSSH éš§é“ç­‰åŠŸèƒ½ã€‚(GitHub) é¡¹ç›®å·²ç» archivedï¼Œç»´æŠ¤å¯èƒ½ä¸æ´»è·ƒã€‚æœ€æ–°ç‰ˆå¯èƒ½åœ¨å…¼å®¹æ€§æˆ– Bug ä¿®å¤æ–¹é¢ä¸å¦‚æ´»è·ƒé¡¹ç›®ã€‚ä¹Ÿå¯èƒ½éœ€è¦è‡ªå·±æ„å»ºæˆ–è°ƒè¯•ã€‚(GitHub) ZooNavigator Web ç•Œé¢ + å¯ Docker éƒ¨ç½²æˆ–æœ¬åœ°å¯åŠ¨(GitHub) åŠŸèƒ½ä¸°å¯Œï¼›æ”¯æŒå¤šä¸ª Zookeeper ç‰ˆæœ¬ï¼ˆå¦‚ 3.5.x ï½ 3.9.xï¼‰ï¼›æµè§ˆ / ç¼–è¾‘ /æœç´¢èŠ‚ç‚¹ï¼›å¯¼å…¥å¯¼å‡ºé…ç½®ï¼›æ”¯æŒæµè§ˆå™¨è®¿é—®ï¼Œæ— éœ€æœ¬åœ° heavy GUIã€‚(GitHub) å› ä¸º Web åº”ç”¨ï¼Œå¯èƒ½å¯¹æµè§ˆå™¨å®‰å…¨ç­–ç•¥ä¸ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿï¼›éœ€è¦éƒ¨ç½²è‡ªå·±ç‰ˆæœ¬æˆ– Dockerï¼›å¦‚æœè¦æ±‚æœ¬åœ°è„±æœºæ“ä½œæ—¶ï¼Œæœ‰äº›åŠŸèƒ½å¯èƒ½ç¨ä¸å¦‚æ¡Œé¢åº”ç”¨ã€‚ ZooKeeper Assistant æ¡Œé¢ï¼ç®¡ç†å‘˜é¢æ¿ç±»å‹ï¼ˆæ”¯æŒç›‘æ§ç•Œé¢ç­‰ï¼‰(DEV Community) é™¤äº†æµè§ˆèŠ‚ç‚¹æ ‘ä»¥å¤–ï¼Œè¿˜æä¾›å¥åº·çŠ¶æ€ç›‘æ§ï¼ˆå»¶è¿Ÿã€è¯·æ±‚æ•°ç­‰ï¼‰ã€ä¸åŒæ•°æ®æ ¼å¼æ”¯æŒï¼ˆJSON/XML ç­‰ï¼‰ã€å¯¼å…¥/å¯¼å‡ºèŠ‚ç‚¹æ•°æ®ã€å‘½ä»¤è¡Œæ“ä½œé›†æˆã€‚(DEV Community) æœ‰äº›åŠŸèƒ½å¯èƒ½åœ¨ Mac ä¸Šå…¼å®¹æ€§æˆ–è§†è§‰ä½“éªŒéœ€è¦è°ƒè¯•ï¼›å…·ä½“ç‰ˆæœ¬æ”¯æŒæƒ…å†µè¦çœ‹æœ€è¿‘æ›´æ–°ã€‚æŸäº›ç›‘æ§ç•Œé¢å¯èƒ½ä¾èµ–äº ZK çš„æŒ‡æ ‡æˆ–æ’ä»¶ã€‚ Zookeeper èŠ‚ç‚¹ç±»å‹ èŠ‚ç‚¹ç±»å‹ ç”Ÿå‘½å‘¨æœŸè¯´æ˜ åˆ›å»ºå‘½ä»¤ç¤ºä¾‹ ç‰¹ç‚¹è¯´æ˜ æŒä¹…èŠ‚ç‚¹ (Persistent) èŠ‚ç‚¹ä¸€ç›´å­˜åœ¨ï¼Œé™¤éæ‰‹åŠ¨åˆ é™¤ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ŒèŠ‚ç‚¹ä¹Ÿä¸ä¼šæ¶ˆå¤± create /locks é€‚åˆå­˜å‚¨é…ç½®ä¿¡æ¯ã€å…ƒæ•°æ®ç­‰æŒä¹…æ•°æ® ä¸´æ—¶èŠ‚ç‚¹ (Ephemeral) å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ˆå¼‚å¸¸æˆ–è¶…æ—¶ï¼‰æ—¶ï¼ŒèŠ‚ç‚¹è‡ªåŠ¨è¢«åˆ é™¤ create -e /locks/DBLock å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€ä¸´æ—¶ä¼šè¯æ•°æ® æœ‰åºèŠ‚ç‚¹ (Sequential) åœ¨æŒä¹…æˆ–ä¸´æ—¶èŠ‚ç‚¹åŸºç¡€ä¸Šï¼Œå¢åŠ æœ‰åºç¼–å·ï¼ŒZooKeeper è‡ªåŠ¨åœ¨èŠ‚ç‚¹åååŠ é€’å¢åºå· create -e -s /jobs/job å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€é˜Ÿåˆ—ç­‰éœ€è¦é¡ºåºçš„åœºæ™¯ å®¹å™¨èŠ‚ç‚¹ (Container) V3.5.3+ï¼Œå½“å®¹å™¨èŠ‚ç‚¹ä¸‹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œå®¹å™¨èŠ‚ç‚¹ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤ create -c /work é€‚åˆåˆ†å¸ƒå¼ä»»åŠ¡ä¸´æ—¶ç›®å½•ã€åŠ¨æ€æ•°æ®ç›®å½• TTL èŠ‚ç‚¹ (TTL) åœ¨æŒ‡å®š TTL æ—¶é—´å†…æœªä¿®æ”¹ä¸”æ— å­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆéœ€å¼€å¯ extendedTypesEnabled=true é…ç½®ï¼‰ create -t 3000 /ttl_node é€‚åˆä¸´æ—¶ç¼“å­˜ã€ä¸´æ—¶çŠ¶æ€æ•°æ®ï¼Œè¿‡æœŸè‡ªåŠ¨æ¸…ç† æ³¨æ„ åŒä¸€çº§èŠ‚ç‚¹ key åç§°æ˜¯å”¯ä¸€çš„ åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå¿…é¡»è¦å¸¦ä¸Šå…¨è·¯å¾„ èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ 123456789101112[zk: localhost:2181(CONNECTED) 16] stat /testcZxid = 0x100000002 # Znodeåˆ›å»ºçš„äº‹åŠ¡idctime = Mon Sep 15 09:44:51 UTC 2025 # åˆ›å»ºæ—¶é—´mZxid = 0x100000004 # æœ€åä¸€æ¬¡ä¿®æ”¹äº‹åŠ¡idmtime = Mon Sep 15 09:47:12 UTC 2025 # æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´pZxid = 0x400000004 # è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡ä¿®æ”¹çš„äº‹åŠ¡IDï¼Œæ·»åŠ å­èŠ‚ç‚¹æˆ–åˆ é™¤å­èŠ‚ç‚¹å°±ä¼šå½±å“å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œä½†æ˜¯ä¿®æ”¹å­èŠ‚ç‚¹çš„æ•°æ®å†…å®¹åˆ™ä¸å½±å“è¯¥IDï¼ˆæ³¨æ„: åªæœ‰å­èŠ‚ç‚¹åˆ—è¡¨å˜æ›´äº†æ‰ä¼šå˜æ›´pzxidï¼Œå­èŠ‚ç‚¹å†…å®¹å˜æ›´ä¸ä¼šå½±å“pzxidï¼‰cversion = 1 # å­èŠ‚ç‚¹çš„ç‰ˆæœ¬å·ã€‚å½“znodeçš„å­èŠ‚ç‚¹æœ‰å˜åŒ–æ—¶ï¼Œcversion çš„å€¼å°±ä¼šå¢åŠ 1ã€‚dataVersion = 1 # znodeçš„æ•°æ®ç‰ˆæœ¬å·ã€‚æ¯æ¬¡å¯¹èŠ‚ç‚¹è¿›è¡Œsetæ“ä½œï¼ŒdataVersionçš„å€¼éƒ½ä¼šå¢åŠ 1ï¼ˆå³ä½¿è®¾ç½®çš„æ˜¯ç›¸åŒçš„æ•°æ®ï¼‰ï¼Œå¯æœ‰æ•ˆé¿å…äº†æ•°æ®æ›´æ–°æ—¶å‡ºç°çš„å…ˆåé¡ºåºé—®é¢˜aclVersion = 0 # znodeçš„ACLç‰ˆæœ¬å·ã€‚æ¯æ¬¡å¯¹èŠ‚ç‚¹è¿›è¡ŒACLè®¾ç½®ï¼ŒaclVersionçš„å€¼éƒ½ä¼šå¢åŠ 1ephemeralOwner = 0x0 # å¦‚æœè¯¥èŠ‚ç‚¹ä¸ºä¸´æ—¶èŠ‚ç‚¹, ephemeralOwnerå€¼è¡¨ç¤ºä¸è¯¥èŠ‚ç‚¹ç»‘å®šçš„session idã€‚å¦‚æœä¸æ˜¯, ephemeralOwnerå€¼ä¸º0(æŒä¹…èŠ‚ç‚¹)ã€‚dataLength = 3 # znodeçš„æ•°æ®é•¿åº¦numChildren = 1 # znodeçš„å­èŠ‚ç‚¹æ•°é‡ï¼ˆåªç»Ÿè®¡ç›´æ¥å­èŠ‚ç‚¹çš„æ•°é‡ï¼‰ Zookeeper ç›‘å¬æœºåˆ¶ watchæœºåˆ¶ï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªç›‘å¬æœºåˆ¶ã€‚Zookeeperä¸­çš„watchæœºåˆ¶ï¼Œå¿…é¡»å®¢æˆ·ç«¯å…ˆå»æœåŠ¡ç«¯æ³¨å†Œç›‘å¬ï¼Œè¿™æ ·äº‹ä»¶å‘ç”Ÿæ—¶æ‰ä¼šè§¦å‘ç›‘å¬ï¼Œé€šçŸ¥ç»™å®¢æˆ·ç«¯ã€‚ ç›‘å¬çš„å¯¹è±¡æ˜¯äº‹ä»¶ï¼Œæ”¯æŒçš„äº‹ä»¶ç±»å‹å¦‚ä¸‹ï¼š 1234567- None: è¿æ¥å»ºç«‹äº‹ä»¶- NodeCreatedï¼š èŠ‚ç‚¹åˆ›å»º- NodeDeletedï¼š èŠ‚ç‚¹åˆ é™¤- NodeDataChangedï¼šèŠ‚ç‚¹æ•°æ®å˜åŒ–- NodeChildrenChangedï¼šå­èŠ‚ç‚¹åˆ—è¡¨å˜åŒ–- DataWatchRemovedï¼šèŠ‚ç‚¹ç›‘å¬è¢«ç§»é™¤- ChildWatchRemovedï¼šå­èŠ‚ç‚¹ç›‘å¬è¢«ç§»é™¤ ç›‘å¬ç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ä¸€æ¬¡æ€§è§¦å‘ Watch æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸€æ—¦è¢«è§¦å‘å°±ä¼šè¢«ç§»é™¤ã€‚å†æ¬¡ä½¿ç”¨æ—¶éœ€è¦é‡æ–°æ³¨å†Œã€‚ å®¢æˆ·ç«¯é¡ºåºå›è°ƒ Watch å›è°ƒæ˜¯é¡ºåºä¸²è¡Œæ‰§è¡Œçš„ï¼Œå®¢æˆ·ç«¯åªæœ‰åœ¨å›è°ƒå®Œæˆåæ‰èƒ½çœ‹åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚ è½»é‡çº§ Watcher å›è°ƒé€»è¾‘ä¸åº”è¿‡å¤šï¼Œä»¥å…é˜»å¡æˆ–å½±å“å…¶ä»– Watch çš„æ‰§è¡Œã€‚ æœ€å°é€šä¿¡å•ä½ WatchEvent æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼ŒåªåŒ…å«é€šçŸ¥çŠ¶æ€ã€äº‹ä»¶ç±»å‹å’ŒèŠ‚ç‚¹è·¯å¾„ï¼Œä¸åŒ…å«èŠ‚ç‚¹æ•°æ®å˜åŒ–å‰åçš„å…·ä½“å†…å®¹ã€‚ æ—¶æ•ˆæ€§ Watcher ä»…åœ¨å½“å‰ Session å®Œå…¨å¤±æ•ˆæ—¶æ‰æ— æ•ˆã€‚å¦‚æœ Session å¿«é€Ÿé‡è¿æˆåŠŸï¼ŒWatcher ä¾ç„¶æœ‰æ•ˆï¼Œå¯ç»§ç»­æ¥æ”¶é€šçŸ¥ã€‚ å¯ä»¥å¼€å¯ç›‘å¬çš„å‘½ä»¤ 123456#ç›‘å¬èŠ‚ç‚¹æ•°æ®çš„å˜åŒ–get -w pathstat -w path#ç›‘å¬å­èŠ‚ç‚¹å¢å‡çš„å˜åŒ–ls -w path æ°¸ä¹…æ€§ Watch åœ¨è¢«è§¦å‘ä¹‹åï¼Œä»ç„¶ä¿ç•™ï¼Œå¯ä»¥ç»§ç»­ç›‘å¬ZNodeä¸Šçš„å˜æ›´ï¼Œæ˜¯Zookeeper 3.6.0ç‰ˆæœ¬æ–°å¢çš„åŠŸèƒ½ åˆ›å»ºç›‘å¬ 12345addWatch [-m mode] path# mode:# - PERSISTENT: æŒä¹…åŒ–è®¢é˜…ï¼Œé’ˆå¯¹å½“å‰èŠ‚ç‚¹çš„ä¿®æ”¹å’Œåˆ é™¤äº‹ä»¶ï¼Œä»¥åŠå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„åˆ é™¤å’Œæ–°å¢äº‹ä»¶ã€‚# - PERSISTENT_RECURSIVE: æŒä¹…åŒ–é€’å½’è®¢é˜…(è¿™ä¸ªæ˜¯é»˜è®¤å€¼)ï¼Œåœ¨PERSISTENTçš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†å­èŠ‚ç‚¹ä¿®æ”¹çš„äº‹ä»¶è§¦å‘ï¼Œä»¥åŠå­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„æ•°æ®å˜åŒ–éƒ½ä¼šè§¦å‘ç›¸å…³äº‹ä»¶ï¼ˆæ»¡è¶³é€’å½’è®¢é˜…ç‰¹æ€§ï¼‰ åˆ é™¤ç›‘å¬ 123456# æ™®é€šä¸€æ¬¡æ€§ Watch ä¸éœ€è¦æ‰‹åŠ¨åˆ é™¤ï¼Œè§¦å‘åä¼šè‡ªåŠ¨ç§»é™¤ï¼›removewatches ä¸»è¦ç”¨äºæŒä¹… Watchï¼ˆpersistent watchï¼‰ã€‚removewatches path [-c|-d|-a] [-l]# -c: ä»…åˆ é™¤å½“å‰å®¢æˆ·ç«¯çš„ Watch# -d: åˆ é™¤æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰ Watch(åŒ…æ‹¬å…¶ä»–å®¢æˆ·ç«¯æ³¨å†Œçš„)# -a: åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹çš„æ‰€æœ‰ Watchï¼ˆåŒ…æ‹¬å…¶ä»–å®¢æˆ·ç«¯çš„ Watchï¼‰ï¼Œæ…ç”¨ï¼ï¼ï¼# -l: æ˜¾ç¤ºè¢«åˆ é™¤çš„ Watch åˆ—è¡¨ ç›‘å¬å™¨åº”ç”¨åœºæ™¯ ç±»å‹ ç‰¹ç‚¹ åº”ç”¨åœºæ™¯ä¸¾ä¾‹ é€‚åˆçš„èŠ‚ç‚¹ç±»å‹ ä¸´æ—¶ç›‘å¬ï¼ˆä¸€æ¬¡æ€§ Watchï¼‰ - è§¦å‘ä¸€æ¬¡åè‡ªåŠ¨ç§»é™¤- å®¢æˆ·ç«¯éœ€æ‰‹åŠ¨é‡æ–°æ³¨å†Œ- è½»é‡çº§ï¼Œé€‚åˆå•æ¬¡é€šçŸ¥ 1. é…ç½®ä¸­å¿ƒï¼šé…ç½®å˜åŒ–æ—¶é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥åé‡æ–°æ‹‰å–æœ€æ–°é…ç½® 2. åˆ†å¸ƒå¼é”ï¼šèŠ‚ç‚¹åˆ é™¤ï¼ˆé”é‡Šæ”¾ï¼‰åé€šçŸ¥ç­‰å¾…çš„å®¢æˆ·ç«¯é‡æ–°ç«äº‰é” 3. ä¸»ä»é€‰ä¸¾ï¼šä¸»èŠ‚ç‚¹å®•æœºåï¼Œå…¶ä»–èŠ‚ç‚¹æ”¶åˆ°é€šçŸ¥é‡æ–°é€‰ä¸» æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰ ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEphemeralï¼Œç”¨äºé”å’Œé€‰ä¸»ï¼‰ æ°¸ä¹…ç›‘å¬ï¼ˆPersistent Watchï¼‰ - æ³¨å†ŒåæŒç»­æœ‰æ•ˆï¼Œç›´åˆ°å®¢æˆ·ç«¯ä¸»åŠ¨ç§»é™¤- æ”¯æŒå­èŠ‚ç‚¹å˜åŒ–ã€æ•°æ®å˜åŒ–çš„é•¿æœŸç›‘å¬ 1. æœåŠ¡å‘ç°ï¼šå®¢æˆ·ç«¯é•¿æœŸç›‘å¬æœåŠ¡èŠ‚ç‚¹å˜åŒ–ï¼ŒèŠ‚ç‚¹ä¸Šçº¿/ä¸‹çº¿æ—¶è‡ªåŠ¨æ›´æ–°æœ¬åœ°æœåŠ¡åˆ—è¡¨ 2. ç›‘æ§å‘Šè­¦ï¼šç›‘æ§é‡è¦èŠ‚ç‚¹çŠ¶æ€ï¼ŒèŠ‚ç‚¹æ•°æ®å˜åŒ–æˆ–è¢«åˆ é™¤æ—¶è‡ªåŠ¨è§¦å‘å‘Šè­¦ 3. åˆ†å¸ƒå¼ç¼“å­˜ï¼šç¼“å­˜èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œé€šçŸ¥å®¢æˆ·ç«¯åˆ·æ–°ç¼“å­˜ æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰ ACLæƒé™æ§åˆ¶ ZooKeeper é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æƒé™éƒ½æ˜¯ OPEN_ACL_UNSAFE ï¼Œä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¯»å†™ä»»æ„èŠ‚ç‚¹æ•°æ®ã€‚ ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸éœ€è¦é™åˆ¶å¯¹èŠ‚ç‚¹çš„è®¿é—®æƒé™ï¼Œå³ ACL æƒé™æ§åˆ¶ã€‚ ZooKeeper é‡Œçš„ ACLï¼ˆAccess Control Listï¼Œè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ ä¸»è¦ç”¨äºæ§åˆ¶ è°å¯ä»¥å¯¹æŸä¸ªèŠ‚ç‚¹åšä»€ä¹ˆæ“ä½œï¼Œå®ƒæ˜¯ ZooKeeper æä¾›çš„å®‰å…¨æœºåˆ¶ä¹‹ä¸€ã€‚ ACL çš„ä½œç”¨ é™åˆ¶è®¿é—®ï¼šåªå…è®¸æˆæƒç”¨æˆ·æˆ–å®¢æˆ·ç«¯å¯¹æŒ‡å®šèŠ‚ç‚¹è¿›è¡Œè¯»ã€å†™ã€åˆ é™¤ç­‰æ“ä½œã€‚ é˜²æ­¢è¯¯æ“ä½œï¼šä¿æŠ¤é‡è¦èŠ‚ç‚¹ä¸è¢«æœªæˆæƒçš„å®¢æˆ·ç«¯ä¿®æ”¹æˆ–åˆ é™¤ã€‚ å®‰å…¨éš”ç¦»ï¼šä¸åŒçš„åº”ç”¨æˆ–å›¢é˜Ÿå¯ä»¥åœ¨åŒä¸€ ZooKeeper é›†ç¾¤é‡Œå®‰å…¨å…±å­˜ã€‚ ACL çš„ç»„æˆ zookeeper çš„ acl é€šè¿‡ scheme:id:permissions æ¥æ„æˆæƒé™åˆ—è¡¨ã€‚ schemeï¼šæˆæƒçš„æ¨¡å¼ï¼Œä»£è¡¨é‡‡ç”¨çš„æŸç§æƒé™æœºåˆ¶ï¼ŒåŒ…æ‹¬ worldã€authã€digestã€ipã€super å‡ ç§ã€‚ idï¼šæˆæƒå¯¹è±¡ï¼Œä»£è¡¨å…è®¸è®¿é—®çš„ç”¨æˆ·ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹©é‡‡ç”¨ IP æ–¹å¼ï¼Œä½¿ç”¨çš„æˆæƒå¯¹è±¡å¯ä»¥æ˜¯ä¸€ä¸ª IP åœ°å€æˆ– IP åœ°å€æ®µï¼›è€Œå¦‚æœä½¿ç”¨ Digest æˆ– Super æ–¹å¼ï¼Œåˆ™å¯¹åº”äºä¸€ä¸ªç”¨æˆ·åã€‚å¦‚æœæ˜¯ World æ¨¡å¼ï¼Œæ˜¯æˆæƒç³»ç»Ÿä¸­æ‰€æœ‰çš„ç”¨æˆ·ã€‚ permissionsï¼šæˆæƒçš„æƒé™ï¼Œæƒé™ç»„åˆå­—ç¬¦ä¸²ï¼Œç”± cdrwa ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªå­—æ¯ä»£è¡¨æ”¯æŒä¸åŒæƒé™ï¼Œ åˆ›å»ºæƒé™ createÂ©ã€åˆ é™¤æƒé™ delete(d)ã€è¯»æƒé™ readÂ®ã€å†™æƒé™ write(w)ã€ç®¡ç†æƒé™admin(a)ã€‚ å¸¸è§çš„ scheme ç±»å‹ Scheme è¯´æ˜ ç¤ºä¾‹ world å¼€æ”¾ç»™æ‰€æœ‰ç”¨æˆ·ï¼Œä»…å¯è®¾ç½®ä¸º anyone ä»£è¡¨æ‰€æœ‰å®¢æˆ·ç«¯ world:anyone:r auth å·²é€šè¿‡ addauth æ·»åŠ è®¤è¯çš„å®¢æˆ·ç«¯ auth:user1:rw digest ç”¨æˆ·å+å¯†ç è®¤è¯ï¼ˆå¸¸ç”¨ï¼‰ï¼Œuser:pwd éœ€è¦åŠ å¯†å­˜å‚¨ digest:user1:password:rw ip åŸºäº IP åœ°å€æ§åˆ¶è®¿é—® ip:192.168.1.10:r super è¶…çº§ç”¨æˆ·ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ super:admin:secret æƒé™ç±»å‹ æƒé™å­—ç¬¦ æƒé™åç§° å…è®¸çš„æ“ä½œ/å‘½ä»¤ç¤ºä¾‹ è¯´æ˜ r è¯»å–(Read) get /node ls /node getAcl /node å…è®¸è¯»å–èŠ‚ç‚¹æ•°æ®å’Œå­èŠ‚ç‚¹åˆ—è¡¨ w å†™å…¥(Write) set /node data å…è®¸ä¿®æ”¹èŠ‚ç‚¹æ•°æ® c åˆ›å»º(Create) create /node/sub &quot;data&quot; å…è®¸åœ¨å½“å‰èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹ d åˆ é™¤(Delete) delete /node/sub å…è®¸åˆ é™¤å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ a ç®¡ç†(Admin) setAcl /node acl å…è®¸ä¿®æ”¹ ACL æƒé™ å…¸å‹åº”ç”¨åœºæ™¯ è®¤è¯æ–¹å¼ï¼ˆschemeï¼‰ æƒé™ç±»å‹ï¼ˆpermissionsï¼‰ å…¸å‹ ACL é…ç½®ç¤ºä¾‹ åº”ç”¨åœºæ™¯ ç‰¹ç‚¹è¯´æ˜ world rï¼ˆåªè¯»ï¼‰ world:anyone:r å…¬å…±é…ç½®èŠ‚ç‚¹ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½å¯è¯»å– ç®€å•ã€æ— è®¤è¯ï¼Œé€‚åˆå¯¹å®‰å…¨æ€§è¦æ±‚ä¸é«˜çš„åªè¯»åœºæ™¯ auth r,w,c,d,aï¼ˆå¯ç»„åˆï¼‰ auth:user:rwcd å†…éƒ¨åº”ç”¨å…±äº«èŠ‚ç‚¹ï¼Œéœ€å®¢æˆ·ç«¯è®¤è¯ éœ€å…ˆ addauth digest user1:password æ·»åŠ è®¤è¯ï¼Œé€‚åˆå¤šå®¢æˆ·ç«¯å…±äº« digestï¼ˆå¸¸ç”¨ï¼‰ r,w,c,d,aï¼ˆå¯ç»„åˆï¼‰ digest:user:secret:crwda é«˜å®‰å…¨èŠ‚ç‚¹ï¼Œé…ç½®ä¸­å¿ƒï¼Œåˆ†å¸ƒå¼é” ç”¨æˆ·å+å¯†ç è®¤è¯ï¼Œéœ€åŠ å¯†å­˜å‚¨å¯†ç ï¼Œçµæ´»å®‰å…¨ ip r,w,c,d,aï¼ˆå¯ç»„åˆï¼‰ ip:192.168.1.100:r åŸºäº IP é™åˆ¶è®¿é—®çš„åœºæ™¯ å¿«é€Ÿæ§åˆ¶æŸäº›å›ºå®š IP å¯è®¿é—®ï¼Œé€‚åˆå†…éƒ¨ç½‘ç»œåº”ç”¨ ACL ç›¸å…³å‘½ä»¤ å‘½ä»¤ è¯­æ³• åŠŸèƒ½è¯´æ˜ ç¤ºä¾‹ getAcl getAcl path è¯»å–æŒ‡å®šèŠ‚ç‚¹çš„ ACL getAcl /my_node setAcl setAcl path acl è®¾ç½®æŒ‡å®šèŠ‚ç‚¹çš„ ACL setAcl /my_node world:anyone:crdwa create create path data [acl] åˆ›å»ºèŠ‚ç‚¹æ—¶æŒ‡å®š ACL create /secure_node &quot;secret_data&quot; digest:user1:pwd:crwa addAuth addauth scheme auth æ·»åŠ è®¤è¯ç”¨æˆ·ï¼ˆç±»ä¼¼ç™»å½•ï¼‰ addauth digest user1:password deleteAcl(ä¸å­˜åœ¨) setAcl path world:anyone: åˆ é™¤èŠ‚ç‚¹ ACLï¼ˆè®¾ä¸ºç©ºæˆ–å…¨å¼€æ”¾ï¼‰ setAcl /my_node world:anyone: auth ä¸ digest çš„åŒºåˆ« ä½¿ç”¨ auth æ—¶ï¼Œéœ€å…ˆ addauth digest user1:password æ·»åŠ è®¤è¯ï¼ŒsetAcl æ—¶ï¼Œä½¿ç”¨ auth:user1:rwï¼Œè¿™é‡Œæ˜¯ä¸ºå·²ç»ç™»å½•çš„ç”¨æˆ·è®¾ç½®èŠ‚ç‚¹æƒé™ï¼Œæ‰€ä»¥ä¸éœ€è¦è®¾ç½®å¯†ç  ä½¿ç”¨ digest æ—¶ï¼Œæ— éœ€è¿›è¡Œç™»å½•è®¤è¯ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šå¯†ç ï¼Œå³setAcl æ—¶ï¼Œä½¿ç”¨ digest:user1:password:rw digest çš„å¯†ç æ˜¯ç»è¿‡åŠ å¯†çš„ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨æ˜æ–‡å¯†ç  12345678910# åŠ å¯†å¯†ç echo -n user:123456 | openssl dgst -binary -sha1 | openssl base64# è¾“å‡º6DY5WhzOfGsWQ1XFuIyzxkpwdPo=# zookeeperå®¢æˆ·ç«¯ä¸­è®¾ç½®æƒé™setAcl /name digest:user:6DY5WhzOfGsWQ1XFuIyzxkpwdPo=:cdrwa# ç™»å½•æ—¶å¯†ç æ˜¯æ˜æ–‡addauth digest user:123456 æ— è®ºä½¿ç”¨ digest è¿˜æ˜¯ authï¼Œåœ¨éœ€è¦è®¿é—®èŠ‚ç‚¹å‰ï¼Œéƒ½éœ€è¦å…ˆç™»å½•ã€‚ super è¶…çº§ç®¡ç†å‘˜ æ‹¥æœ‰å…¨éƒ¨èŠ‚ç‚¹çš„æ‰€æœ‰æƒé™: crwda è®¾ç½®è¶…çº§ç®¡ç†å‘˜ 1234567# åŠ å¯†å¯†ç ï¼Œç”¨æˆ·å’Œå¯†ç å¯ä»¥éšæ„è®¾ç½®echo -n admin:123456 | openssl dgst -binary -sha1 | openssl base64# è¾“å‡º0uek/hZ/V9fgiM35b0Z2226acMQ=# æ‰“å¼€ conf/zoo.cfg æ–‡ä»¶å¹¶ç¼–è¾‘ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢å†…å®¹DigestAuthenticationProvider.superDigest=admin:0uek/hZ/V9fgiM35b0Z2226acMQ= é‡æ–°å¯åŠ¨æœåŠ¡åç™»å½•å®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯• 1234567891011# åˆ›å»ºèŠ‚ç‚¹å¹¶è®¾ç½®æƒé™ï¼Œè¿™é‡Œå°†èŠ‚ç‚¹æˆæƒç»™ç”¨æˆ·user[zk: localhost:2181(CONNECTED) 10] create /testNode 666 digest:user:6DY5WhzOfGsWQ1XFuIyzxkpwdPo=:rwCreated /testNode# æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹è¢«æ‹’ç»[zk: localhost:2181(CONNECTED) 11] get /testNodeInsufficient permission : /testNode# ç™»å½•superç”¨æˆ·ï¼ŒéªŒè¯è¶…çº§ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®èŠ‚ç‚¹[zk: localhost:2181(CONNECTED) 12] addauth digest admin:123456# æ­¤æ—¶æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹å°±å¯ä»¥äº†[zk: localhost:2181(CONNECTED) 13] get /testNode666 4å­—æ¯å‘½ä»¤ ä»€ä¹ˆæ˜¯ 4 å­—æ¯å‘½ä»¤? ZooKeeper æä¾›äº†ä¸€ç»„ç®€çŸ­çš„ 4ä¸ªå­—æ¯çš„ç®¡ç†å‘½ä»¤(Four Letter Words Commands, 4lw)ï¼Œå¯ä»¥é€šè¿‡ TCP è¿æ¥ ZooKeeper ç«¯å£ï¼ˆé»˜è®¤ 2181ï¼‰å‘é€è¿™äº›å‘½ä»¤ï¼Œå¿«é€ŸæŸ¥çœ‹æˆ–ç®¡ç† ZooKeeper çŠ¶æ€ã€‚ å¸¸ç”¨çš„ 4å­—æ¯å‘½ä»¤ å‘½ä»¤ å¼•å…¥ç‰ˆæœ¬ åŠŸèƒ½æè¿° ç¤ºä¾‹ conf 3.3.0 æ‰“å°æœåŠ¡ç›¸å…³é…ç½®çš„è¯¦ç»†ä¿¡æ¯ echo conf | nc 127.0.0.1 2181 cons 3.3.0 åˆ—å‡ºæ‰€æœ‰è¿æ¥åˆ°è¯¥æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥/ä¼šè¯è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥æ”¶/å‘é€çš„åŒ…æ•°é‡ã€ä¼šè¯IDã€æ“ä½œå»¶è¿Ÿã€æœ€åæ“ä½œæ‰§è¡Œæ—¶é—´ç­‰ echo cons | nc 127.0.0.1 2181 crst 3.3.0 é‡ç½®æ‰€æœ‰è¿æ¥çš„è¿æ¥å’Œä¼šè¯ç»Ÿè®¡ä¿¡æ¯ echo crst | nc 127.0.0.1 2181 dump - åˆ—å‡ºé‡è¦çš„ä¼šè¯å’Œä¸´æ—¶èŠ‚ç‚¹ä¿¡æ¯ï¼Œä»…åœ¨ Leader èŠ‚ç‚¹ä¸Šæœ‰æ•ˆ echo dump | nc 127.0.0.1 2181 envi - æ‰“å°æœåŠ¡ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯ echo envi | nc 127.0.0.1 2181 reqs - åˆ—å‡ºæœªç»å¤„ç†çš„è¯·æ±‚ echo reqs | nc 127.0.0.1 2181 ruok - æµ‹è¯•æœåŠ¡æ˜¯å¦å¤„äºæ­£å¸¸çŠ¶æ€ï¼›æ­£å¸¸è¿”å› imok echo ruok | nc 127.0.0.1 2181 stat - è¾“å‡ºå…³äºæ€§èƒ½å’Œå®¢æˆ·ç«¯è¿æ¥çš„åˆ—è¡¨ä¿¡æ¯ echo stat | nc 127.0.0.1 2181 srst - é‡ç½®æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯ echo srst | nc 127.0.0.1 2181 srvr 3.3.0 åˆ—å‡ºè¿æ¥æœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯ echo srvr | nc 127.0.0.1 2181 wchs 3.3.0 åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ echo wchs | nc 127.0.0.1 2181 wchc 3.3.0 é€šè¿‡ä¼šè¯åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ Watch ç›¸å…³çš„ä¼šè¯åˆ—è¡¨ echo wchc | nc 127.0.0.1 2181 wchp 3.3.0 é€šè¿‡è·¯å¾„åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ä¼šè¯ç›¸å…³çš„è·¯å¾„ echo wchp | nc 127.0.0.1 2181 mntr 3.4.0 è¾“å‡ºå¯ç”¨äºæ£€æµ‹é›†ç¾¤å¥åº·çŠ¶æ€çš„å…³é”®æŒ‡æ ‡å˜é‡åˆ—è¡¨ echo mntr | nc 127.0.0.1 2181 å¼€å¯ 4å­—æ¯å‘½ä»¤ åœ¨ ZooKeeper 3.5.0 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œ4lw å‘½ä»¤é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå¿…é¡»åœ¨é…ç½®æ–‡ä»¶(zoo.cfg)ä¸­æ˜¾å¼å¼€å¯ã€‚ 1234# è¡¨ç¤ºå…è®¸æ‰€æœ‰ 4lw å‘½ä»¤éƒ½èƒ½ç”¨ï¼ˆé£é™©æœ€å¤§ï¼‰4lw.commands.whitelist=*# è¿™æ ·åªå…è®¸æ‰§è¡Œ statã€confã€ruok è¿™å‡ ä¸ªå‘½ä»¤ã€‚4lw.commands.whitelist=stat,conf,ruok ä½¿ç”¨æ–¹æ³• 1234# å¦‚æœæ²¡æœ‰å®‰è£… ncï¼Œå¯ä»¥ä½¿ç”¨ yum å®‰è£…yum install nc -y# æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€echo stat | nc 127.0.0.1 2181 Zookeeper Java Client é¡¹ç›®ç¤ºä¾‹ï¼šGithubåœ°å€ï¼Œå•å…ƒæµ‹è¯•ã€‚ Zookeeper å®˜æ–¹Javaå®¢æˆ·ç«¯ ZooKeeperå®˜æ–¹çš„å®¢æˆ·ç«¯APIæä¾›äº†åŸºæœ¬çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¼šè¯ã€åˆ›å»ºèŠ‚ç‚¹ã€è¯»å–èŠ‚ç‚¹ã€æ›´æ–°æ•°æ®ã€åˆ é™¤èŠ‚ç‚¹å’Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ç­‰ã€‚ä¸è¿‡ï¼Œå¯¹äºå®é™…å¼€å‘æ¥è¯´ï¼ŒZooKeeperå®˜æ–¹APIæœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š ZooKeeperçš„Watcherç›‘æµ‹æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ¯æ¬¡è§¦å‘ä¹‹åéƒ½éœ€è¦é‡æ–°è¿›è¡Œæ³¨å†Œã€‚ ä¼šè¯è¶…æ—¶ä¹‹åæ²¡æœ‰å®ç°é‡è¿æœºåˆ¶ã€‚ å¼‚å¸¸å¤„ç†çƒ¦çï¼ŒZooKeeperæä¾›äº†å¾ˆå¤šå¼‚å¸¸ï¼Œå¯¹äºå¼€å‘äººå‘˜æ¥è¯´å¯èƒ½æ ¹æœ¬ä¸çŸ¥é“åº”è¯¥å¦‚ä½•å¤„ç†è¿™äº›æŠ›å‡ºçš„å¼‚å¸¸ã€‚ ä»…æä¾›äº†ç®€å•çš„byte[]æ•°ç»„ç±»å‹çš„æ¥å£ï¼Œæ²¡æœ‰æä¾›Java POJOçº§åˆ«çš„åºåˆ—åŒ–æ•°æ®å¤„ç†æ¥å£ã€‚ åˆ›å»ºèŠ‚ç‚¹æ—¶å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦è‡ªè¡Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ã€‚ æ— æ³•å®ç°çº§è”åˆ é™¤ã€‚ æ€»ä¹‹ï¼ŒZooKeeperå®˜æ–¹APIåŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­æ¯”è¾ƒç¬¨é‡ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚ é¡¹ç›®å¼•å…¥ä¾èµ–æ—¶ï¼Œæœ€å¥½ä¿æŒä¸æœåŠ¡ç«¯ç‰ˆæœ¬ä¸€è‡´ï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰ä¸€äº›å…¼å®¹æ€§çš„é—®é¢˜ 123456&lt;!-- zookeeper client --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.8.4&lt;/version&gt;&lt;/dependency&gt; Zookeeper ç¬¬ä¸‰æ–¹Javaå®¢æˆ·ç«¯ Curator Curatoræ˜¯Netflixå…¬å¸å¼€æºçš„ä¸€å¥—ZooKeeperå®¢æˆ·ç«¯æ¡†æ¶ï¼Œå’ŒZkClientä¸€æ ·å®ƒè§£å†³äº†éå¸¸åº•å±‚çš„ç»†èŠ‚å¼€å‘å·¥ä½œï¼ŒåŒ…æ‹¬è¿æ¥ã€é‡è¿ã€åå¤æ³¨å†ŒWatcherçš„é—®é¢˜ä»¥åŠNodeExistsExceptionå¼‚å¸¸ç­‰ã€‚ Curatoræ˜¯ApacheåŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ä¹‹ä¸€ï¼ŒCuratorå…·æœ‰æ›´åŠ å®Œå–„çš„æ–‡æ¡£ï¼Œå¦å¤–è¿˜æä¾›äº†ä¸€å¥—æ˜“ç”¨æ€§å’Œå¯è¯»æ€§æ›´å¼ºçš„Fluenté£æ ¼çš„å®¢æˆ·ç«¯APIæ¡†æ¶ã€‚ Curatorè¿˜ä¸ºZooKeeperå®¢æˆ·ç«¯æ¡†æ¶æä¾›äº†ä¸€äº›æ¯”è¾ƒæ™®éçš„ã€å¼€ç®±å³ç”¨çš„ã€åˆ†å¸ƒå¼å¼€å‘ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚Recipeã€å…±äº«é”æœåŠ¡ã€Masteré€‰ä¸¾æœºåˆ¶å’Œåˆ†å¸ƒå¼è®¡ç®—å™¨ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…é¿å…äº†â€œé‡å¤é€ è½®å­â€çš„æ— æ•ˆå¼€å‘å·¥ä½œã€‚ åœ¨å®é™…çš„å¼€å‘åœºæ™¯ä¸­ï¼Œä½¿ç”¨Curatorå®¢æˆ·ç«¯å°±è¶³ä»¥åº”ä»˜æ—¥å¸¸çš„ZooKeeperé›†ç¾¤æ“ä½œçš„éœ€æ±‚ã€‚ å¼•å…¥ä¾èµ–è¯´æ˜ï¼š æ¨¡å— ä¾èµ–å…³ç³» åŠŸèƒ½å®šä½ å…¸å‹åŠŸèƒ½ä¸¾ä¾‹ å¸¸ç”¨åœºæ™¯ curator-client ä¾èµ– zookeeper è¿æ¥ç®¡ç†ã€é‡è¯•ç­–ç•¥ã€åº•å±‚ API è¿æ¥ä¼šè¯ç®¡ç†ã€RetryPolicy éœ€è¦æœ€è½»é‡çš„ ZooKeeper å®¢æˆ·ç«¯ curator-framework ä¾èµ– curator-client é«˜å±‚ API å°è£…ï¼Œç®€åŒ– ZK æ“ä½œ åˆ›å»ºèŠ‚ç‚¹ã€Watcher ç®¡ç†ã€è‡ªåŠ¨é‡è¿ é€šç”¨ ZooKeeper å®¢æˆ·ç«¯å¼€å‘ curator-recipes ä¾èµ– curator-framework â†’ curator-client åˆ†å¸ƒå¼æ¨¡å¼ç°æˆå®ç° åˆ†å¸ƒå¼é”ã€Leader é€‰ä¸¾ã€é˜Ÿåˆ—ã€Barrier ç›´æ¥ç”¨åˆ†å¸ƒå¼å·¥å…·ï¼Œæ— éœ€è‡ªå·±å®ç° ä½¿ç”¨å»ºè®® å¦‚æœä½ åªæƒ³è½»é‡è®¿é—® ZooKeeper â†’ curator-client å°±å¤Ÿäº†ï¼Œä½†å‡ ä¹æ²¡äººå•ç‹¬ç”¨ã€‚ å¦‚æœä½ æƒ³æ–¹ä¾¿æ“ä½œ ZooKeeper API â†’ curator-frameworkï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½é€‚ç”¨ã€‚ å¦‚æœä½ æƒ³ç”¨åˆ†å¸ƒå¼é”ã€é€‰ä¸¾ã€Barrier â†’ curator-recipesï¼ˆå®ƒä¼šè‡ªåŠ¨å¼•å…¥å‰ä¸¤ä¸ªï¼‰ã€‚ 12345678910111213141516171819&lt;!-- zookeeper client --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.8.4&lt;/version&gt;&lt;/dependency&gt;&lt;!--curator--&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.curator&lt;/groupId&gt; &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt; &lt;version&gt;5.9.0&lt;/version&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Zookeeper ç‰ˆæœ¬ä¸º 3.8.4ã€‚","date_published":"2025-09-15T13:30:05.000Z","tags":["æŠ€æœ¯","zookeeper","åˆ†å¸ƒå¼","zookeeper"]}]}