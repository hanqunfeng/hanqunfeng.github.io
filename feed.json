{"version":"https://jsonfeed.org/version/1","name":"é£˜é€¸å³°çš„åšå®¢","home_page_url":"https://blog.hanqunfeng.com","feed_url":"https://blog.hanqunfeng.com/feed.json","author":{"name":"é£˜é€¸å³°"},"items":[{"id":"https://blog.hanqunfeng.com/2025/10/15/kafka-04-command/","url":"https://blog.hanqunfeng.com/2025/10/15/kafka-04-command/","title":"Kafka çš„ å¸¸ç”¨å‘½ä»¤","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Kafka çš„ å¸¸ç”¨å‘½ä»¤</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"topic\">topic</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º topic</span></span><br><span class=\"line\">kafka-topics.sh --create --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span> --partitions 3 --replication-factor 2</span><br><span class=\"line\"><span class=\"comment\"># --bootstrap-server æŒ‡å®š kafka é›†ç¾¤åœ°å€</span></span><br><span class=\"line\"><span class=\"comment\"># --topic åˆ›å»ºçš„ topic åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># --partitions æŒ‡å®šåˆ†åŒºæ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼</span></span><br><span class=\"line\"><span class=\"comment\"># --replication-factor æŒ‡å®šå‰¯æœ¬æ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ—å‡º topic</span></span><br><span class=\"line\">kafka-topics.sh --list --bootstrap-server localhost:9092</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ topic è¯¦æƒ…</span></span><br><span class=\"line\">kafka-topics.sh --describe --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">Topic: <span class=\"built_in\">test</span>\tTopicId: Ru0tWQJ4RMWcjjGsKAdWQg\tPartitionCount: 3\tReplicationFactor: 3\tConfigs:</span><br><span class=\"line\">\tTopic: <span class=\"built_in\">test</span>\tPartition: 0\tLeader: 3\tReplicas: 3,1,2\tIsr: 3,2,1\tElr: N/A\tLastKnownElr: N/A</span><br><span class=\"line\">\tTopic: <span class=\"built_in\">test</span>\tPartition: 1\tLeader: 1\tReplicas: 1,2,3\tIsr: 3,2,1\tElr: N/A\tLastKnownElr: N/A</span><br><span class=\"line\">\tTopic: <span class=\"built_in\">test</span>\tPartition: 2\tLeader: 2\tReplicas: 2,3,1\tIsr: 3,2,1\tElr: N/A\tLastKnownElr: N/A</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºè¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># æ€»ä½“ä¿¡æ¯ï¼ˆTopic æ¦‚è§ˆï¼‰Topic: test\tTopicId: Ru0tWQJ4RMWcjjGsKAdWQg\tPartitionCount: 3\tReplicationFactor: 3\tConfigs:</span></span><br><span class=\"line\">| å­—æ®µ                                  | å«ä¹‰                                                            |</span><br><span class=\"line\">| ----------------------------------- | ------------------------------------------------------------- |</span><br><span class=\"line\">| **Topic: disTopic**                 | Topic åç§°ï¼Œå³å½“å‰æè¿°çš„ä¸»é¢˜ã€‚                                            |</span><br><span class=\"line\">| **TopicId: VUK7Mc9oQdS1mjGG7OhQzQ** | Kafka å†…éƒ¨è‡ªåŠ¨ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUUIDï¼‰ï¼ŒKafka 3.x ä¹‹åå¼•å…¥ï¼Œç”¨äºåŒºåˆ†åŒåä½†ä¸åŒç”Ÿå‘½å‘¨æœŸçš„ topicã€‚ |</span><br><span class=\"line\">| **PartitionCount: 3**               | è¯¥ä¸»é¢˜æœ‰ 3 ä¸ªåˆ†åŒºï¼ˆpartitionï¼‰ã€‚æ¯ä¸ªåˆ†åŒºå­˜å‚¨ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚                            |</span><br><span class=\"line\">| **ReplicationFactor:**              | å‰¯æœ¬å› å­ã€‚è¿™é‡Œè™½ç„¶è¾“å‡ºä¸­æ²¡æ˜¾ç¤ºå…·ä½“å€¼ï¼Œä½†å¯ä»æ¯è¡Œåˆ†åŒºé…ç½®æ¨æ–­æ˜¯ **3**ï¼ˆæ¯ä¸ªåˆ†åŒºæœ‰ 3 ä¸ªå‰¯æœ¬ï¼‰ã€‚           |</span><br><span class=\"line\">| **Configs:**                        | topic çš„é…ç½®é¡¹ï¼ˆä¾‹å¦‚æ¸…ç†ç­–ç•¥ã€å‹ç¼©ç±»å‹ç­‰ï¼‰ï¼Œå¦‚æœä¸ºç©ºï¼Œè¯´æ˜ä½¿ç”¨é»˜è®¤é…ç½®ã€‚                       |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ†åŒºè¯¦æƒ…ï¼ˆæ¯ä¸ª Partition ä¸€è¡Œï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">| å­—æ®µ                                | å«ä¹‰                                                          |</span><br><span class=\"line\">| --------------------------------- | ----------------------------------------------------------- |</span><br><span class=\"line\">| **Partition: 0**                  | ç¬¬ 0 å·åˆ†åŒºã€‚                                                    |</span><br><span class=\"line\">| **Leader: 2**                     | è¯¥åˆ†åŒºå½“å‰çš„ **Leader Broker æ˜¯ broker ID = 2**ï¼Œåªæœ‰ Leader æ‰å¤„ç†è¯»å†™è¯·æ±‚ã€‚ |</span><br><span class=\"line\">| **Replicas: 2,3,1**               | è¯¥åˆ†åŒºçš„æ‰€æœ‰å‰¯æœ¬å­˜æ”¾åœ¨å“ªäº› Broker ä¸Šï¼ˆå³å‰¯æœ¬åˆ†å¸ƒï¼‰ï¼Œåˆ†åˆ«æ˜¯ broker 2ã€3ã€1ã€‚             |</span><br><span class=\"line\">| **Isr (In-Sync Replicas): 2,3,1** | å½“å‰ä¸ Leader ä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆã€‚è¿™é‡Œæ‰€æœ‰å‰¯æœ¬éƒ½åœ¨åŒæ­¥ä¸­ï¼ˆå¥åº·çŠ¶æ€ ğŸ‘ï¼‰ã€‚                  |</span><br><span class=\"line\">| **Elr / LastKnownElr**            | Kafka æ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„ <span class=\"string\">&quot;Enhanced Leader Replica&quot;</span> çŠ¶æ€ï¼Œç›®å‰æœªå¯ç”¨ï¼ˆN/Aï¼‰ã€‚      |</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ topic</span></span><br><span class=\"line\">kafka-topics.sh --delete --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"consumer\">consumer</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º consumer</span></span><br><span class=\"line\">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span> --group <span class=\"built_in\">test</span></span><br><span class=\"line\"><span class=\"comment\"># --topic æŒ‡å®š topic</span></span><br><span class=\"line\"><span class=\"comment\"># --group æŒ‡å®š consumer ç»„</span></span><br><span class=\"line\"></span><br><span class=\"line\">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span>  --from-beginning</span><br><span class=\"line\"><span class=\"comment\"># --from-beginning ä» topic çš„æœ€å¼€å§‹æ¶ˆè´¹</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"consumer-group\">consumer-group</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡º consumer ç»„</span></span><br><span class=\"line\">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list</span><br><span class=\"line\"><span class=\"comment\"># --bootstrap-server é›†ç¾¤åœ°å€</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ consumer ç»„è¯¦æƒ…</span></span><br><span class=\"line\">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group <span class=\"built_in\">test</span></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">GROUP  TOPIC  PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG  CONSUMER-ID                                             HOST         CLIENT-ID</span><br><span class=\"line\"><span class=\"built_in\">test</span>   <span class=\"built_in\">test</span>   0          2               2               0    console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1  /10.250.0.7   console-consumer</span><br><span class=\"line\"><span class=\"built_in\">test</span>   <span class=\"built_in\">test</span>   1          2               2               0    console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1  /10.250.0.7   console-consumer</span><br><span class=\"line\"><span class=\"built_in\">test</span>   <span class=\"built_in\">test</span>   2          1               1               0    console-consumer-9ac45b29-d8f3-4649-ab09-7b567aa2ba53  /10.250.0.108 console-consumer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºè¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># GROUP       æ¶ˆè´¹ç»„åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># TOPIC       topic åç§°</span></span><br><span class=\"line\"><span class=\"comment\"># PARTITION   åˆ†åŒºç¼–å·</span></span><br><span class=\"line\"><span class=\"comment\"># CURRENT-OFFSET  å½“å‰æ¶ˆè´¹çš„ offset</span></span><br><span class=\"line\"><span class=\"comment\"># LOG-END-OFFSET   topic ä¸­æœ€å¤§çš„ offset</span></span><br><span class=\"line\"><span class=\"comment\"># LAG         å½“å‰æ¶ˆè´¹çš„ offset ä¸ topic ä¸­æœ€å¤§çš„ offset çš„å·®å€¼ï¼Œå³å‰©ä½™æœªæ¶ˆè´¹çš„ æ¶ˆæ¯æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"># CONSUMER-ID  å½“å‰æ¶ˆè´¹çš„ consumer çš„ id</span></span><br><span class=\"line\"><span class=\"comment\"># HOST        å½“å‰æ¶ˆè´¹çš„ consumer çš„ä¸»æœºå</span></span><br><span class=\"line\"><span class=\"comment\"># CLIENT-ID   å½“å‰æ¶ˆè´¹çš„ consumer çš„å®¢æˆ·ç«¯åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ consumer ç»„</span></span><br><span class=\"line\">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --delete --group <span class=\"built_in\">test</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"producer\">producer</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º producer</span></span><br><span class=\"line\">kafka-console-producer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span></span><br><span class=\"line\"><span class=\"comment\"># --topic æŒ‡å®š topic</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"ç”¨äºæ‰‹åŠ¨è§¦å‘-Kafka-åˆ†åŒº-Leader-é€‰ä¸¾-è‡ªå¹³è¡¡\">ç”¨äºæ‰‹åŠ¨è§¦å‘ Kafka åˆ†åŒº Leader é€‰ä¸¾(è‡ªå¹³è¡¡)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>kafkaçš„è‡ªå¹³è¡¡é»˜è®¤å¼€å¯ï¼Œæ¯éš” 300ç§’æ‰«æä¸€æ¬¡ï¼Œå¦‚æœéœ€è¦å¹³è¡¡çš„æ¯”ä¾‹é«˜äº 10%ï¼Œåˆ™ä¼šè§¦å‘ä¸€æ¬¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¼€å¯è‡ªåŠ¨å¹³è¡¡</span></span><br><span class=\"line\">auto.leader.rebalance.enable=<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># é—´éš”æ‰«ææ—¶é—´ é»˜è®¤ 300 ç§’</span></span><br><span class=\"line\">eader.imbalance.check.interval.seconds=300</span><br><span class=\"line\"><span class=\"comment\"># è§¦å‘æ¯”ä¾‹ï¼Œå³éœ€è¦å¹³è¡¡çš„ partition å å…¨éƒ¨ partition çš„æ¯”ä¾‹ï¼Œé»˜è®¤ 10%</span></span><br><span class=\"line\">leader.imbalance.per.broker.percentage=10</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å»ºè®®å…³é—­ï¼Œæ”¹ä¸ºä¸šåŠ¡ä½å³°æ—¶æ‰‹åŠ¨è§¦å‘</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ—å‡ºæ¶ˆè´¹è€…è‡ªåŠ¨å¹³è¡¡</span></span><br><span class=\"line\">kafka-leader-election.sh --bootstrap-server localhost:9092  --election-type preferred --topic <span class=\"built_in\">test</span> --partition 0</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ğŸ§© å‚æ•°è¯´æ˜ï¼šâ€“election-type</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°å€¼</th>\n<th>å«ä¹‰</th>\n<th>è§¦å‘æ¡ä»¶</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><code>preferred</code></strong></td>\n<td><strong>é¦–é€‰ Leader é€‰ä¸¾</strong>ï¼ˆPreferred Leader Electionï¼‰<br>Kafka ä¼šå°è¯•å°†åˆ†åŒºçš„ leader é‡æ–°åˆ‡æ¢ä¸ºã€Œé¦–é€‰å‰¯æœ¬ã€ï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªå‰¯æœ¬ï¼‰ã€‚</td>\n<td>åªæœ‰å½“å‰ leader <strong>ä¸æ˜¯</strong> é¦–é€‰å‰¯æœ¬æ—¶æ‰æ‰§è¡Œã€‚</td>\n<td>æŸäº›å‰¯æœ¬è¢«è‡ªåŠ¨é€‰ä¸¾æˆ leader åï¼Œå¸Œæœ›æ¢å¤åŸæœ‰ã€Œé¦–é€‰ leaderã€ç»“æ„ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</td>\n</tr>\n<tr>\n<td><strong><code>unclean</code></strong></td>\n<td><strong>éå¹²å‡€ Leader é€‰ä¸¾</strong>ï¼ˆUnclean Leader Electionï¼‰<br>å…è®¸ä»ä¸åŒæ­¥çš„å‰¯æœ¬ä¸­é€‰ä¸¾æ–°çš„ leaderã€‚</td>\n<td>ä»…åœ¨åˆ†åŒº <strong>æ²¡æœ‰å¯ç”¨ leader</strong> æ—¶æ‰§è¡Œã€‚</td>\n<td>åœ¨ç´§æ€¥æ¢å¤åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚æ‰€æœ‰ ISR å‰¯æœ¬éƒ½ä¸‹çº¿ï¼‰ï¼Œä¸ºäº†æ¢å¤æœåŠ¡å¯ç”¨æ€§ï¼Œå³ä½¿ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ å¸¸ç”¨å‘½ä»¤ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ topic 12345678910111213141516171819202122232425262728293031323334353637383940# åˆ›å»º topickafka-topics.sh --create --bootstrap-server localhost:9092 --topic test --partitions 3 --replication-factor 2# --bootstrap-server æŒ‡å®š kafka é›†ç¾¤åœ°å€# --topic åˆ›å»ºçš„ topic åç§°# --partitions æŒ‡å®šåˆ†åŒºæ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼# --replication-factor æŒ‡å®šå‰¯æœ¬æ•°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä½¿ç”¨ server.properties ä¸­è®¾ç½®çš„é»˜è®¤å€¼# åˆ—å‡º topickafka-topics.sh --list --bootstrap-server localhost:9092# æŸ¥çœ‹ topic è¯¦æƒ…kafka-topics.sh --describe --bootstrap-server localhost:9092 --topic test## è¾“å‡ºTopic: test TopicId: Ru0tWQJ4RMWcjjGsKAdWQg PartitionCount: 3 ReplicationFactor: 3 Configs: Topic: test Partition: 0 Leader: 3 Replicas: 3,1,2 Isr: 3,2,1 Elr: N/A LastKnownElr: N/A Topic: test Partition: 1 Leader: 1 Replicas: 1,2,3 Isr: 3,2,1 Elr: N/A LastKnownElr: N/A Topic: test Partition: 2 Leader: 2 Replicas: 2,3,1 Isr: 3,2,1 Elr: N/A LastKnownElr: N/A## è¾“å‡ºè¯´æ˜# æ€»ä½“ä¿¡æ¯ï¼ˆTopic æ¦‚è§ˆï¼‰Topic: test TopicId: Ru0tWQJ4RMWcjjGsKAdWQg PartitionCount: 3 ReplicationFactor: 3 Configs:| å­—æ®µ | å«ä¹‰ || ----------------------------------- | ------------------------------------------------------------- || **Topic: disTopic** | Topic åç§°ï¼Œå³å½“å‰æè¿°çš„ä¸»é¢˜ã€‚ || **TopicId: VUK7Mc9oQdS1mjGG7OhQzQ** | Kafka å†…éƒ¨è‡ªåŠ¨ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆUUIDï¼‰ï¼ŒKafka 3.x ä¹‹åå¼•å…¥ï¼Œç”¨äºåŒºåˆ†åŒåä½†ä¸åŒç”Ÿå‘½å‘¨æœŸçš„ topicã€‚ || **PartitionCount: 3** | è¯¥ä¸»é¢˜æœ‰ 3 ä¸ªåˆ†åŒºï¼ˆpartitionï¼‰ã€‚æ¯ä¸ªåˆ†åŒºå­˜å‚¨ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚ || **ReplicationFactor:** | å‰¯æœ¬å› å­ã€‚è¿™é‡Œè™½ç„¶è¾“å‡ºä¸­æ²¡æ˜¾ç¤ºå…·ä½“å€¼ï¼Œä½†å¯ä»æ¯è¡Œåˆ†åŒºé…ç½®æ¨æ–­æ˜¯ **3**ï¼ˆæ¯ä¸ªåˆ†åŒºæœ‰ 3 ä¸ªå‰¯æœ¬ï¼‰ã€‚ || **Configs:** | topic çš„é…ç½®é¡¹ï¼ˆä¾‹å¦‚æ¸…ç†ç­–ç•¥ã€å‹ç¼©ç±»å‹ç­‰ï¼‰ï¼Œå¦‚æœä¸ºç©ºï¼Œè¯´æ˜ä½¿ç”¨é»˜è®¤é…ç½®ã€‚ |# åˆ†åŒºè¯¦æƒ…ï¼ˆæ¯ä¸ª Partition ä¸€è¡Œï¼‰| å­—æ®µ | å«ä¹‰ || --------------------------------- | ----------------------------------------------------------- || **Partition: 0** | ç¬¬ 0 å·åˆ†åŒºã€‚ || **Leader: 2** | è¯¥åˆ†åŒºå½“å‰çš„ **Leader Broker æ˜¯ broker ID = 2**ï¼Œåªæœ‰ Leader æ‰å¤„ç†è¯»å†™è¯·æ±‚ã€‚ || **Replicas: 2,3,1** | è¯¥åˆ†åŒºçš„æ‰€æœ‰å‰¯æœ¬å­˜æ”¾åœ¨å“ªäº› Broker ä¸Šï¼ˆå³å‰¯æœ¬åˆ†å¸ƒï¼‰ï¼Œåˆ†åˆ«æ˜¯ broker 2ã€3ã€1ã€‚ || **Isr (In-Sync Replicas): 2,3,1** | å½“å‰ä¸ Leader ä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆã€‚è¿™é‡Œæ‰€æœ‰å‰¯æœ¬éƒ½åœ¨åŒæ­¥ä¸­ï¼ˆå¥åº·çŠ¶æ€ ğŸ‘ï¼‰ã€‚ || **Elr / LastKnownElr** | Kafka æ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„ &quot;Enhanced Leader Replica&quot; çŠ¶æ€ï¼Œç›®å‰æœªå¯ç”¨ï¼ˆN/Aï¼‰ã€‚ |# åˆ é™¤ topickafka-topics.sh --delete --bootstrap-server localhost:9092 --topic test consumer 1234567# åˆ›å»º consumerkafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --group test# --topic æŒ‡å®š topic# --group æŒ‡å®š consumer ç»„kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning# --from-beginning ä» topic çš„æœ€å¼€å§‹æ¶ˆè´¹ consumer-group 12345678910111213141516171819202122232425# åˆ—å‡º consumer ç»„kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list# --bootstrap-server é›†ç¾¤åœ°å€# æŸ¥çœ‹ consumer ç»„è¯¦æƒ…kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group test## è¾“å‡ºGROUP TOPIC PARTITION CURRENT-OFFSET LOG-END-OFFSET LAG CONSUMER-ID HOST CLIENT-IDtest test 0 2 2 0 console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1 /10.250.0.7 console-consumertest test 1 2 2 0 console-consumer-2102b86e-895c-4ee3-8304-6df83523d1c1 /10.250.0.7 console-consumertest test 2 1 1 0 console-consumer-9ac45b29-d8f3-4649-ab09-7b567aa2ba53 /10.250.0.108 console-consumer## è¾“å‡ºè¯´æ˜# GROUP æ¶ˆè´¹ç»„åç§°# TOPIC topic åç§°# PARTITION åˆ†åŒºç¼–å·# CURRENT-OFFSET å½“å‰æ¶ˆè´¹çš„ offset# LOG-END-OFFSET topic ä¸­æœ€å¤§çš„ offset# LAG å½“å‰æ¶ˆè´¹çš„ offset ä¸ topic ä¸­æœ€å¤§çš„ offset çš„å·®å€¼ï¼Œå³å‰©ä½™æœªæ¶ˆè´¹çš„ æ¶ˆæ¯æ•°é‡# CONSUMER-ID å½“å‰æ¶ˆè´¹çš„ consumer çš„ id# HOST å½“å‰æ¶ˆè´¹çš„ consumer çš„ä¸»æœºå# CLIENT-ID å½“å‰æ¶ˆè´¹çš„ consumer çš„å®¢æˆ·ç«¯åç§°# åˆ é™¤ consumer ç»„kafka-consumer-groups.sh --bootstrap-server localhost:9092 --delete --group test producer 123# åˆ›å»º producerkafka-console-producer.sh --bootstrap-server localhost:9092 --topic test# --topic æŒ‡å®š topic ç”¨äºæ‰‹åŠ¨è§¦å‘ Kafka åˆ†åŒº Leader é€‰ä¸¾(è‡ªå¹³è¡¡) kafkaçš„è‡ªå¹³è¡¡é»˜è®¤å¼€å¯ï¼Œæ¯éš” 300ç§’æ‰«æä¸€æ¬¡ï¼Œå¦‚æœéœ€è¦å¹³è¡¡çš„æ¯”ä¾‹é«˜äº 10%ï¼Œåˆ™ä¼šè§¦å‘ä¸€æ¬¡ 123456# å¼€å¯è‡ªåŠ¨å¹³è¡¡auto.leader.rebalance.enable=true# é—´éš”æ‰«ææ—¶é—´ é»˜è®¤ 300 ç§’eader.imbalance.check.interval.seconds=300# è§¦å‘æ¯”ä¾‹ï¼Œå³éœ€è¦å¹³è¡¡çš„ partition å å…¨éƒ¨ partition çš„æ¯”ä¾‹ï¼Œé»˜è®¤ 10%leader.imbalance.per.broker.percentage=10 å»ºè®®å…³é—­ï¼Œæ”¹ä¸ºä¸šåŠ¡ä½å³°æ—¶æ‰‹åŠ¨è§¦å‘ 12# åˆ—å‡ºæ¶ˆè´¹è€…è‡ªåŠ¨å¹³è¡¡kafka-leader-election.sh --bootstrap-server localhost:9092 --election-type preferred --topic test --partition 0 ğŸ§© å‚æ•°è¯´æ˜ï¼šâ€“election-type å‚æ•°å€¼ å«ä¹‰ è§¦å‘æ¡ä»¶ å…¸å‹ä½¿ç”¨åœºæ™¯ preferred é¦–é€‰ Leader é€‰ä¸¾ï¼ˆPreferred Leader Electionï¼‰Kafka ä¼šå°è¯•å°†åˆ†åŒºçš„ leader é‡æ–°åˆ‡æ¢ä¸ºã€Œé¦–é€‰å‰¯æœ¬ã€ï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªå‰¯æœ¬ï¼‰ã€‚ åªæœ‰å½“å‰ leader ä¸æ˜¯ é¦–é€‰å‰¯æœ¬æ—¶æ‰æ‰§è¡Œã€‚ æŸäº›å‰¯æœ¬è¢«è‡ªåŠ¨é€‰ä¸¾æˆ leader åï¼Œå¸Œæœ›æ¢å¤åŸæœ‰ã€Œé¦–é€‰ leaderã€ç»“æ„ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ unclean éå¹²å‡€ Leader é€‰ä¸¾ï¼ˆUnclean Leader Electionï¼‰å…è®¸ä»ä¸åŒæ­¥çš„å‰¯æœ¬ä¸­é€‰ä¸¾æ–°çš„ leaderã€‚ ä»…åœ¨åˆ†åŒº æ²¡æœ‰å¯ç”¨ leader æ—¶æ‰§è¡Œã€‚ åœ¨ç´§æ€¥æ¢å¤åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚æ‰€æœ‰ ISR å‰¯æœ¬éƒ½ä¸‹çº¿ï¼‰ï¼Œä¸ºäº†æ¢å¤æœåŠ¡å¯ç”¨æ€§ï¼Œå³ä½¿ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ å¸¸ç”¨å‘½ä»¤ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚","date_published":"2025-10-15T12:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/10/14/kafka-01-server-config/","url":"https://blog.hanqunfeng.com/2025/10/14/kafka-01-server-config/","title":"Kafka çš„ server.properties é…ç½®é¡¹","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„ server.properties çš„é…ç½®é¡¹ï¼ŒåŸºäº Zookeeperã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Kafka-3-x-server-properties-ä¸»è¦é…ç½®é¡¹æ¸…å•\">Kafka 3.x server.properties ä¸»è¦é…ç½®é¡¹æ¸…å•</h2>\n<table>\n<thead>\n<tr>\n<th>åˆ†ç±»</th>\n<th>å‚æ•°å</th>\n<th>é»˜è®¤å€¼</th>\n<th>è¯´æ˜</th>\n<th>æ¨è/å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ğŸ—‚ï¸ <strong>åŸºæœ¬ä¿¡æ¯</strong></td>\n<td><code>broker.id</code></td>\n<td>0</td>\n<td>Broker å”¯ä¸€æ ‡è¯†</td>\n<td>é›†ç¾¤ä¸­å¿…é¡»å”¯ä¸€</td>\n</tr>\n<tr>\n<td></td>\n<td><code>node.id</code></td>\n<td>-</td>\n<td>Raft æ¨¡å¼ï¼ˆKRaftï¼‰ä¸‹ä½¿ç”¨</td>\n<td>ZK æ¨¡å¼å¿½ç•¥</td>\n</tr>\n<tr>\n<td></td>\n<td><code>process.roles</code></td>\n<td>-</td>\n<td>KRaft æ¨¡å¼è§’è‰²ï¼ˆcontroller, brokerï¼‰</td>\n<td>ZK æ¨¡å¼ä¸é…ç½®</td>\n</tr>\n<tr>\n<td>ğŸ”Œ <strong>ç½‘ç»œä¸ç›‘å¬é…ç½®</strong></td>\n<td><code>listeners</code></td>\n<td>PLAINTEXT://:9092</td>\n<td>Broker ç›‘å¬åœ°å€</td>\n<td>å¯ç”¨å¤šä¸ªåè®®ï¼Œå¦‚ SASL_PLAINTEXT, SSL</td>\n</tr>\n<tr>\n<td></td>\n<td><code>advertised.listeners</code></td>\n<td>-</td>\n<td>å®¢æˆ·ç«¯è¿æ¥æ—¶çœ‹åˆ°çš„åœ°å€</td>\n<td>å¤–ç½‘è®¿é—®éœ€é…ç½®</td>\n</tr>\n<tr>\n<td></td>\n<td><code>listener.security.protocol.map</code></td>\n<td>PLAINTEXT:PLAINTEXT</td>\n<td>æ˜ å°„ç›‘å¬å™¨åè®®</td>\n<td>å¤šåè®®æ—¶é…ç½®</td>\n</tr>\n<tr>\n<td></td>\n<td><code>inter.broker.listener.name</code></td>\n<td>-ï¼ˆKafka 2.4+ é»˜è®¤ç¬¬ä¸€ä¸ª listenerï¼‰</td>\n<td>æŒ‡å®š broker é—´é€šä¿¡ä½¿ç”¨å“ªä¸ª listenerï¼ˆå¦‚ INTERNALï¼‰</td>\n<td>é›†ç¾¤å†…éƒ¨é€šä¿¡å¿…é¡»ä¸€è‡´ï¼›å¸¸é…åˆå¤š listener ä½¿ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>num.network.threads</code></td>\n<td>3</td>\n<td>ç½‘ç»œçº¿ç¨‹æ•°</td>\n<td>ä¸€èˆ¬ä¸éœ€ä¿®æ”¹</td>\n</tr>\n<tr>\n<td></td>\n<td><code>num.io.threads</code></td>\n<td>8</td>\n<td>å¤„ç†è¯·æ±‚çš„ IO çº¿ç¨‹æ•°</td>\n<td>æ ¹æ® CPU è°ƒæ•´</td>\n</tr>\n<tr>\n<td></td>\n<td><code>socket.send.buffer.bytes</code></td>\n<td>102400</td>\n<td>å‘é€ç¼“å†²åŒºå¤§å°</td>\n<td>ç½‘ç»œä¼˜åŒ–å‚æ•°</td>\n</tr>\n<tr>\n<td></td>\n<td><code>socket.receive.buffer.bytes</code></td>\n<td>102400</td>\n<td>æ¥æ”¶ç¼“å†²åŒºå¤§å°</td>\n<td>ç½‘ç»œä¼˜åŒ–å‚æ•°</td>\n</tr>\n<tr>\n<td></td>\n<td><code>socket.request.max.bytes</code></td>\n<td>104857600</td>\n<td>å•è¯·æ±‚æœ€å¤§å¤§å° (100MB)</td>\n<td>å¤§æ¶ˆæ¯éœ€è°ƒå¤§</td>\n</tr>\n<tr>\n<td>âš™ï¸ <strong>é›†ç¾¤ä¸å…ƒæ•°æ®</strong></td>\n<td><code>log.dirs</code></td>\n<td>/tmp/kafka-logs</td>\n<td>æ•°æ®å­˜å‚¨è·¯å¾„</td>\n<td>å¤šç›®å½•å¯æå‡æ€§èƒ½</td>\n</tr>\n<tr>\n<td></td>\n<td><code>num.recovery.threads.per.data.dir</code></td>\n<td>1</td>\n<td>æ¯ä¸ªæ•°æ®ç›®å½•çš„æ¢å¤çº¿ç¨‹æ•°</td>\n<td>å¤šç£ç›˜æ—¶å¯å¢åŠ </td>\n</tr>\n<tr>\n<td></td>\n<td><code>auto.create.topics.enable</code></td>\n<td>true</td>\n<td>æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topic</td>\n<td>ç”Ÿäº§å»ºè®®ç¦ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>controlled.shutdown.enable</code></td>\n<td>true</td>\n<td>ä¼˜é›…å…³é—­ Broker</td>\n<td>å»ºè®®å¼€å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>delete.topic.enable</code></td>\n<td>true</td>\n<td>æ˜¯å¦å…è®¸åˆ é™¤ Topic</td>\n<td>ç”Ÿäº§æ…ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>auto.leader.rebalance.enable</code></td>\n<td>true</td>\n<td>æ˜¯å¦è‡ªåŠ¨å‡è¡¡ Leader</td>\n<td>å»ºè®®å¼€å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>leader.imbalance.check.interval.seconds</code></td>\n<td>300</td>\n<td>æ£€æŸ¥ leader å¤±è¡¡é—´éš”</td>\n<td>ä¸ä¸Šé…åˆä½¿ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>leader.imbalance.per.broker.percentage</code></td>\n<td>10</td>\n<td>è§¦å‘ leader é‡å¹³è¡¡çš„é˜ˆå€¼</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td>ğŸ§± <strong>å‰¯æœ¬ä¸å¤åˆ¶æœºåˆ¶</strong></td>\n<td><code>default.replication.factor</code></td>\n<td>1</td>\n<td>æ–° Topic é»˜è®¤å‰¯æœ¬æ•°</td>\n<td>ç”Ÿäº§å»ºè®® 3</td>\n</tr>\n<tr>\n<td></td>\n<td><code>offsets.topic.replication.factor</code></td>\n<td>1</td>\n<td>æ¶ˆè´¹ç»„åç§»ä¸»é¢˜å‰¯æœ¬æ•°</td>\n<td>å»ºè®® 3</td>\n</tr>\n<tr>\n<td></td>\n<td><code>transaction.state.log.replication.factor</code></td>\n<td>1</td>\n<td>äº‹åŠ¡çŠ¶æ€ä¸»é¢˜å‰¯æœ¬æ•°</td>\n<td>å»ºè®® 3</td>\n</tr>\n<tr>\n<td></td>\n<td><code>transaction.state.log.min.isr</code></td>\n<td>1</td>\n<td>äº‹åŠ¡çŠ¶æ€æ—¥å¿—æœ€å° ISR æ•°</td>\n<td>å»ºè®® 2</td>\n</tr>\n<tr>\n<td></td>\n<td><code>min.insync.replicas</code></td>\n<td>1</td>\n<td>Leader å†™å…¥æ—¶è¦æ±‚çš„æœ€å° ISR å‰¯æœ¬æ•°</td>\n<td>å»ºè®® <code>replication.factor - 1</code></td>\n</tr>\n<tr>\n<td></td>\n<td><code>unclean.leader.election.enable</code></td>\n<td>false</td>\n<td>æ˜¯å¦å…è®¸éåŒæ­¥å‰¯æœ¬é€‰ä¸º leader</td>\n<td>ç”Ÿäº§å»ºè®® false</td>\n</tr>\n<tr>\n<td></td>\n<td><code>num.replica.fetchers</code></td>\n<td>1</td>\n<td>follower æ‹‰å–çº¿ç¨‹æ•°</td>\n<td>å¯æå‡å¤åˆ¶æ€§èƒ½</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetch.max.bytes</code></td>\n<td>1048576 (1MB)</td>\n<td>follower æ‹‰å–å•åˆ†åŒºæœ€å¤§æ•°æ®é‡</td>\n<td>å¢å¤§å¯æé€Ÿ</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetch.response.max.bytes</code></td>\n<td>10485760 (10MB)</td>\n<td>follower ä¸€æ¬¡æ‹‰å–å“åº”æ€»é‡</td>\n<td>å¯è°ƒå¤§</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetch.wait.max.ms</code></td>\n<td>500</td>\n<td>follower ç­‰å¾…æ–°æ•°æ®çš„æœ€å¤§æ—¶é•¿</td>\n<td>å»¶è¿Ÿä¸ååæŠ˜ä¸­</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetch.backoff.ms</code></td>\n<td>1000</td>\n<td>æ‹‰å–å¤±è´¥åé€€é¿æ—¶é—´</td>\n<td>ç½‘ç»œä¸ç¨³æ—¶è°ƒæ•´</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.socket.timeout.ms</code></td>\n<td>30000</td>\n<td>follower ä¸ leader é€šä¿¡è¶…æ—¶</td>\n<td>â‰¥ <a href=\"http://fetch.wait.ms\">fetch.wait.ms</a></td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.socket.receive.buffer.bytes</code></td>\n<td>65536</td>\n<td>æ‹‰å– socket ç¼“å†²åŒº</td>\n<td>è°ƒå¤§å¯æé€Ÿ</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.lag.time.max.ms</code></td>\n<td>10000</td>\n<td>follower è½å leader çš„æœ€å¤§æ—¶é—´</td>\n<td>å½±å“ ISR</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.high.watermark.checkpoint.interval.ms</code></td>\n<td>5000</td>\n<td>é«˜æ°´ä½å†™å…¥ checkpoint å‘¨æœŸ</td>\n<td>å½±å“æ¢å¤é€Ÿåº¦</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.selector.class</code></td>\n<td>-</td>\n<td>è‡ªå®šä¹‰å‰¯æœ¬é€‰æ‹©ç±»</td>\n<td>ä¸€èˆ¬ä¿æŒé»˜è®¤</td>\n</tr>\n<tr>\n<td>ğŸ§® <strong>æ—¥å¿—ä¸æ®µæ–‡ä»¶</strong></td>\n<td><code>log.segment.bytes</code></td>\n<td>1073741824 (1GB)</td>\n<td>å•æ—¥å¿—æ®µæ–‡ä»¶å¤§å°</td>\n<td>è°ƒå°ä¾¿äºåˆ é™¤</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.segment.ms</code></td>\n<td>604800000 (7å¤©)</td>\n<td>å¼ºåˆ¶æ»šåŠ¨æ—¥å¿—çš„æ—¶é—´</td>\n<td>é€‚ç”¨äºæ—¶é—´æ§åˆ¶</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.retention.hours</code></td>\n<td>168</td>\n<td>æ—¥å¿—ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰</td>\n<td>ä¸ç£ç›˜ç©ºé—´ç›¸å…³</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.retention.bytes</code></td>\n<td>-1</td>\n<td>æ—¥å¿—æ€»å¤§å°é™åˆ¶</td>\n<td>-1 è¡¨ç¤ºä¸é™åˆ¶</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.retention.check.interval.ms</code></td>\n<td>300000</td>\n<td>æ£€æŸ¥æ—¥å¿—ä¿ç•™ç­–ç•¥é—´éš”</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.cleaner.enable</code></td>\n<td>true</td>\n<td>æ˜¯å¦å¯ç”¨æ—¥å¿—å‹ç¼©</td>\n<td>compact ä¸»é¢˜éœ€å¯ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.cleaner.threads</code></td>\n<td>1</td>\n<td>æ¸…ç†çº¿ç¨‹æ•°</td>\n<td>å¤§é›†ç¾¤å¯å¢åŠ </td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.cleaner.io.max.bytes.per.second</code></td>\n<td>None</td>\n<td>é™åˆ¶æ¸…ç† IO å¸¦å®½</td>\n<td>æ§åˆ¶ç£ç›˜è´Ÿè½½</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.flush.interval.messages</code></td>\n<td>Long.MAX_VALUE</td>\n<td>ç´¯è®¡æ¶ˆæ¯æ•°è¾¾åˆ°åå¼ºåˆ¶ flush</td>\n<td>é€šå¸¸ä¿æŒé»˜è®¤</td>\n</tr>\n<tr>\n<td></td>\n<td><code>log.flush.interval.ms</code></td>\n<td>None</td>\n<td>æ¯éš”å¤šä¹…å¼ºåˆ¶ flush</td>\n<td>SSD å¯è°ƒå¤§</td>\n</tr>\n<tr>\n<td></td>\n<td><code>num.partitions</code></td>\n<td>1</td>\n<td>æ–° Topic é»˜è®¤åˆ†åŒºæ•°</td>\n<td>é€šå¸¸ 3~6 èµ·æ­¥</td>\n</tr>\n<tr>\n<td>ğŸ§µ <strong>ç”Ÿäº§ä¸æ¶ˆè´¹ç›¸å…³</strong></td>\n<td><code>message.max.bytes</code></td>\n<td>1048576</td>\n<td>å…è®¸çš„æœ€å¤§æ¶ˆæ¯å¤§å°</td>\n<td>ä¸ Producer <code>max.request.size</code> å¯¹é½</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetch.max.bytes</code></td>\n<td>1048576</td>\n<td>ä¸ Producer/Consumer å¯¹åº”çš„é™åˆ¶</td>\n<td>é˜²æ­¢å¤§æ¶ˆæ¯å¡æ­»</td>\n</tr>\n<tr>\n<td></td>\n<td><code>compression.type</code></td>\n<td>producer</td>\n<td>å‹ç¼©ç®—æ³•ï¼ˆnone, gzip, snappy, lz4, zstdï¼‰</td>\n<td>å»ºè®® zstd</td>\n</tr>\n<tr>\n<td></td>\n<td><code>queued.max.requests</code></td>\n<td>500</td>\n<td>Broker æœ€å¤§æ’é˜Ÿè¯·æ±‚æ•°</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td>ğŸ› ï¸ <strong>æ§åˆ¶å™¨ä¸åè°ƒå™¨</strong></td>\n<td><code>controller.socket.timeout.ms</code></td>\n<td>30000</td>\n<td>æ§åˆ¶å™¨é€šä¿¡è¶…æ—¶</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>controller.quorum.voters</code></td>\n<td>-</td>\n<td>KRaft æ¨¡å¼é€‰ä¸¾æˆå‘˜</td>\n<td>ZK æ¨¡å¼ä¸éœ€</td>\n</tr>\n<tr>\n<td></td>\n<td><code>controller.listener.names</code></td>\n<td>-</td>\n<td>æ§åˆ¶å™¨ç›‘å¬å</td>\n<td>ZK æ¨¡å¼å¿½ç•¥</td>\n</tr>\n<tr>\n<td>ğŸ“ˆ <strong>ç›‘æ§ä¸æŒ‡æ ‡</strong></td>\n<td><code>metric.reporters</code></td>\n<td>ç©º</td>\n<td>æŒ‡æ ‡ä¸ŠæŠ¥ç±»</td>\n<td>å¯æ¥ Prometheus</td>\n</tr>\n<tr>\n<td></td>\n<td><code>metrics.num.samples</code></td>\n<td>2</td>\n<td>æŒ‡æ ‡é‡‡æ ·æ•°</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>metrics.sample.window.ms</code></td>\n<td>30000</td>\n<td>æŒ‡æ ‡é‡‡æ ·çª—å£</td>\n<td>é»˜è®¤å³å¯</td>\n</tr>\n<tr>\n<td></td>\n<td><code>replica.fetchers.metrics.enabled</code></td>\n<td>true</td>\n<td>æ˜¯å¦å¯ç”¨å‰¯æœ¬æ‹‰å–æŒ‡æ ‡</td>\n<td>Kafka 3.x æ–°å¢</td>\n</tr>\n<tr>\n<td>ğŸ”’ <strong>å®‰å…¨</strong></td>\n<td><code>authorizer.class.name</code></td>\n<td>ç©º</td>\n<td>æˆæƒç±»å®ç°</td>\n<td>å¼€å¯ ACL æ—¶é…ç½®</td>\n</tr>\n<tr>\n<td></td>\n<td><code>super.users</code></td>\n<td>ç©º</td>\n<td>è¶…çº§ç”¨æˆ·åˆ—è¡¨</td>\n<td>ACL æ¨¡å¼ä¸‹é…ç½®</td>\n</tr>\n<tr>\n<td></td>\n<td><code>ssl.keystore.location</code></td>\n<td>-</td>\n<td>SSL è¯ä¹¦è·¯å¾„</td>\n<td>å¯ç”¨ SSL æ—¶ä½¿ç”¨</td>\n</tr>\n<tr>\n<td></td>\n<td><code>ssl.truststore.location</code></td>\n<td>-</td>\n<td>ä¿¡ä»»è¯ä¹¦è·¯å¾„</td>\n<td>å¯ç”¨ SSL æ—¶ä½¿ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å‚æ•°ä½¿ç”¨å»ºè®®æ€»ç»“\">å‚æ•°ä½¿ç”¨å»ºè®®æ€»ç»“</h2>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>æ¨èé…ç½®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>é«˜å¯é æ€§é›†ç¾¤</strong></td>\n<td><code>default.replication.factor=3</code>, <code>min.insync.replicas=2</code>, <code>unclean.leader.election.enable=false</code></td>\n</tr>\n<tr>\n<td><strong>ååä¼˜å…ˆ</strong></td>\n<td>æé«˜ <code>num.replica.fetchers</code>ã€<code>replica.fetch.max.bytes</code></td>\n</tr>\n<tr>\n<td><strong>å¿«é€Ÿæ¢å¤</strong></td>\n<td>å‡å°‘ <code>replica.high.watermark.checkpoint.interval.ms</code></td>\n</tr>\n<tr>\n<td><strong>èŠ‚çœç£ç›˜</strong></td>\n<td>å¯ç”¨ <code>log.cleaner.enable</code> å¹¶è®¾ç½® <code>log.retention.hours</code></td>\n</tr>\n<tr>\n<td><strong>äº‹åŠ¡æˆ–ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰</strong></td>\n<td>è®¾ç½® <code>transaction.state.log.replication.factor=3</code>ã€<code>transaction.state.log.min.isr=2</code></td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„ server.properties çš„é…ç½®é¡¹ï¼ŒåŸºäº Zookeeperã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Kafka 3.x server.properties ä¸»è¦é…ç½®é¡¹æ¸…å• åˆ†ç±» å‚æ•°å é»˜è®¤å€¼ è¯´æ˜ æ¨è/å¤‡æ³¨ ğŸ—‚ï¸ åŸºæœ¬ä¿¡æ¯ broker.id 0 Broker å”¯ä¸€æ ‡è¯† é›†ç¾¤ä¸­å¿…é¡»å”¯ä¸€ node.id - Raft æ¨¡å¼ï¼ˆKRaftï¼‰ä¸‹ä½¿ç”¨ ZK æ¨¡å¼å¿½ç•¥ process.roles - KRaft æ¨¡å¼è§’è‰²ï¼ˆcontroller, brokerï¼‰ ZK æ¨¡å¼ä¸é…ç½® ğŸ”Œ ç½‘ç»œä¸ç›‘å¬é…ç½® listeners PLAINTEXT://:9092 Broker ç›‘å¬åœ°å€ å¯ç”¨å¤šä¸ªåè®®ï¼Œå¦‚ SASL_PLAINTEXT, SSL advertised.listeners - å®¢æˆ·ç«¯è¿æ¥æ—¶çœ‹åˆ°çš„åœ°å€ å¤–ç½‘è®¿é—®éœ€é…ç½® listener.security.protocol.map PLAINTEXT:PLAINTEXT æ˜ å°„ç›‘å¬å™¨åè®® å¤šåè®®æ—¶é…ç½® inter.broker.listener.name -ï¼ˆKafka 2.4+ é»˜è®¤ç¬¬ä¸€ä¸ª listenerï¼‰ æŒ‡å®š broker é—´é€šä¿¡ä½¿ç”¨å“ªä¸ª listenerï¼ˆå¦‚ INTERNALï¼‰ é›†ç¾¤å†…éƒ¨é€šä¿¡å¿…é¡»ä¸€è‡´ï¼›å¸¸é…åˆå¤š listener ä½¿ç”¨ num.network.threads 3 ç½‘ç»œçº¿ç¨‹æ•° ä¸€èˆ¬ä¸éœ€ä¿®æ”¹ num.io.threads 8 å¤„ç†è¯·æ±‚çš„ IO çº¿ç¨‹æ•° æ ¹æ® CPU è°ƒæ•´ socket.send.buffer.bytes 102400 å‘é€ç¼“å†²åŒºå¤§å° ç½‘ç»œä¼˜åŒ–å‚æ•° socket.receive.buffer.bytes 102400 æ¥æ”¶ç¼“å†²åŒºå¤§å° ç½‘ç»œä¼˜åŒ–å‚æ•° socket.request.max.bytes 104857600 å•è¯·æ±‚æœ€å¤§å¤§å° (100MB) å¤§æ¶ˆæ¯éœ€è°ƒå¤§ âš™ï¸ é›†ç¾¤ä¸å…ƒæ•°æ® log.dirs /tmp/kafka-logs æ•°æ®å­˜å‚¨è·¯å¾„ å¤šç›®å½•å¯æå‡æ€§èƒ½ num.recovery.threads.per.data.dir 1 æ¯ä¸ªæ•°æ®ç›®å½•çš„æ¢å¤çº¿ç¨‹æ•° å¤šç£ç›˜æ—¶å¯å¢åŠ  auto.create.topics.enable true æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topic ç”Ÿäº§å»ºè®®ç¦ç”¨ controlled.shutdown.enable true ä¼˜é›…å…³é—­ Broker å»ºè®®å¼€å¯ delete.topic.enable true æ˜¯å¦å…è®¸åˆ é™¤ Topic ç”Ÿäº§æ…ç”¨ auto.leader.rebalance.enable true æ˜¯å¦è‡ªåŠ¨å‡è¡¡ Leader å»ºè®®å¼€å¯ leader.imbalance.check.interval.seconds 300 æ£€æŸ¥ leader å¤±è¡¡é—´éš” ä¸ä¸Šé…åˆä½¿ç”¨ leader.imbalance.per.broker.percentage 10 è§¦å‘ leader é‡å¹³è¡¡çš„é˜ˆå€¼ é»˜è®¤å³å¯ ğŸ§± å‰¯æœ¬ä¸å¤åˆ¶æœºåˆ¶ default.replication.factor 1 æ–° Topic é»˜è®¤å‰¯æœ¬æ•° ç”Ÿäº§å»ºè®® 3 offsets.topic.replication.factor 1 æ¶ˆè´¹ç»„åç§»ä¸»é¢˜å‰¯æœ¬æ•° å»ºè®® 3 transaction.state.log.replication.factor 1 äº‹åŠ¡çŠ¶æ€ä¸»é¢˜å‰¯æœ¬æ•° å»ºè®® 3 transaction.state.log.min.isr 1 äº‹åŠ¡çŠ¶æ€æ—¥å¿—æœ€å° ISR æ•° å»ºè®® 2 min.insync.replicas 1 Leader å†™å…¥æ—¶è¦æ±‚çš„æœ€å° ISR å‰¯æœ¬æ•° å»ºè®® replication.factor - 1 unclean.leader.election.enable false æ˜¯å¦å…è®¸éåŒæ­¥å‰¯æœ¬é€‰ä¸º leader ç”Ÿäº§å»ºè®® false num.replica.fetchers 1 follower æ‹‰å–çº¿ç¨‹æ•° å¯æå‡å¤åˆ¶æ€§èƒ½ replica.fetch.max.bytes 1048576 (1MB) follower æ‹‰å–å•åˆ†åŒºæœ€å¤§æ•°æ®é‡ å¢å¤§å¯æé€Ÿ replica.fetch.response.max.bytes 10485760 (10MB) follower ä¸€æ¬¡æ‹‰å–å“åº”æ€»é‡ å¯è°ƒå¤§ replica.fetch.wait.max.ms 500 follower ç­‰å¾…æ–°æ•°æ®çš„æœ€å¤§æ—¶é•¿ å»¶è¿Ÿä¸ååæŠ˜ä¸­ replica.fetch.backoff.ms 1000 æ‹‰å–å¤±è´¥åé€€é¿æ—¶é—´ ç½‘ç»œä¸ç¨³æ—¶è°ƒæ•´ replica.socket.timeout.ms 30000 follower ä¸ leader é€šä¿¡è¶…æ—¶ â‰¥ fetch.wait.ms replica.socket.receive.buffer.bytes 65536 æ‹‰å– socket ç¼“å†²åŒº è°ƒå¤§å¯æé€Ÿ replica.lag.time.max.ms 10000 follower è½å leader çš„æœ€å¤§æ—¶é—´ å½±å“ ISR replica.high.watermark.checkpoint.interval.ms 5000 é«˜æ°´ä½å†™å…¥ checkpoint å‘¨æœŸ å½±å“æ¢å¤é€Ÿåº¦ replica.selector.class - è‡ªå®šä¹‰å‰¯æœ¬é€‰æ‹©ç±» ä¸€èˆ¬ä¿æŒé»˜è®¤ ğŸ§® æ—¥å¿—ä¸æ®µæ–‡ä»¶ log.segment.bytes 1073741824 (1GB) å•æ—¥å¿—æ®µæ–‡ä»¶å¤§å° è°ƒå°ä¾¿äºåˆ é™¤ log.segment.ms 604800000 (7å¤©) å¼ºåˆ¶æ»šåŠ¨æ—¥å¿—çš„æ—¶é—´ é€‚ç”¨äºæ—¶é—´æ§åˆ¶ log.retention.hours 168 æ—¥å¿—ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰ ä¸ç£ç›˜ç©ºé—´ç›¸å…³ log.retention.bytes -1 æ—¥å¿—æ€»å¤§å°é™åˆ¶ -1 è¡¨ç¤ºä¸é™åˆ¶ log.retention.check.interval.ms 300000 æ£€æŸ¥æ—¥å¿—ä¿ç•™ç­–ç•¥é—´éš” é»˜è®¤å³å¯ log.cleaner.enable true æ˜¯å¦å¯ç”¨æ—¥å¿—å‹ç¼© compact ä¸»é¢˜éœ€å¯ç”¨ log.cleaner.threads 1 æ¸…ç†çº¿ç¨‹æ•° å¤§é›†ç¾¤å¯å¢åŠ  log.cleaner.io.max.bytes.per.second None é™åˆ¶æ¸…ç† IO å¸¦å®½ æ§åˆ¶ç£ç›˜è´Ÿè½½ log.flush.interval.messages Long.MAX_VALUE ç´¯è®¡æ¶ˆæ¯æ•°è¾¾åˆ°åå¼ºåˆ¶ flush é€šå¸¸ä¿æŒé»˜è®¤ log.flush.interval.ms None æ¯éš”å¤šä¹…å¼ºåˆ¶ flush SSD å¯è°ƒå¤§ num.partitions 1 æ–° Topic é»˜è®¤åˆ†åŒºæ•° é€šå¸¸ 3~6 èµ·æ­¥ ğŸ§µ ç”Ÿäº§ä¸æ¶ˆè´¹ç›¸å…³ message.max.bytes 1048576 å…è®¸çš„æœ€å¤§æ¶ˆæ¯å¤§å° ä¸ Producer max.request.size å¯¹é½ replica.fetch.max.bytes 1048576 ä¸ Producer/Consumer å¯¹åº”çš„é™åˆ¶ é˜²æ­¢å¤§æ¶ˆæ¯å¡æ­» compression.type producer å‹ç¼©ç®—æ³•ï¼ˆnone, gzip, snappy, lz4, zstdï¼‰ å»ºè®® zstd queued.max.requests 500 Broker æœ€å¤§æ’é˜Ÿè¯·æ±‚æ•° é»˜è®¤å³å¯ ğŸ› ï¸ æ§åˆ¶å™¨ä¸åè°ƒå™¨ controller.socket.timeout.ms 30000 æ§åˆ¶å™¨é€šä¿¡è¶…æ—¶ é»˜è®¤å³å¯ controller.quorum.voters - KRaft æ¨¡å¼é€‰ä¸¾æˆå‘˜ ZK æ¨¡å¼ä¸éœ€ controller.listener.names - æ§åˆ¶å™¨ç›‘å¬å ZK æ¨¡å¼å¿½ç•¥ ğŸ“ˆ ç›‘æ§ä¸æŒ‡æ ‡ metric.reporters ç©º æŒ‡æ ‡ä¸ŠæŠ¥ç±» å¯æ¥ Prometheus metrics.num.samples 2 æŒ‡æ ‡é‡‡æ ·æ•° é»˜è®¤å³å¯ metrics.sample.window.ms 30000 æŒ‡æ ‡é‡‡æ ·çª—å£ é»˜è®¤å³å¯ replica.fetchers.metrics.enabled true æ˜¯å¦å¯ç”¨å‰¯æœ¬æ‹‰å–æŒ‡æ ‡ Kafka 3.x æ–°å¢ ğŸ”’ å®‰å…¨ authorizer.class.name ç©º æˆæƒç±»å®ç° å¼€å¯ ACL æ—¶é…ç½® super.users ç©º è¶…çº§ç”¨æˆ·åˆ—è¡¨ ACL æ¨¡å¼ä¸‹é…ç½® ssl.keystore.location - SSL è¯ä¹¦è·¯å¾„ å¯ç”¨ SSL æ—¶ä½¿ç”¨ ssl.truststore.location - ä¿¡ä»»è¯ä¹¦è·¯å¾„ å¯ç”¨ SSL æ—¶ä½¿ç”¨ å‚æ•°ä½¿ç”¨å»ºè®®æ€»ç»“ åœºæ™¯ æ¨èé…ç½® é«˜å¯é æ€§é›†ç¾¤ default.replication.factor=3, min.insync.replicas=2, unclean.leader.election.enable=false ååä¼˜å…ˆ æé«˜ num.replica.fetchersã€replica.fetch.max.bytes å¿«é€Ÿæ¢å¤ å‡å°‘ replica.high.watermark.checkpoint.interval.ms èŠ‚çœç£ç›˜ å¯ç”¨ log.cleaner.enable å¹¶è®¾ç½® log.retention.hours äº‹åŠ¡æˆ–ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰ è®¾ç½® transaction.state.log.replication.factor=3ã€transaction.state.log.min.isr=2","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„ server.properties çš„é…ç½®é¡¹ï¼ŒåŸºäº Zookeeperã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚","date_published":"2025-10-14T13:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/10/13/kafka-03-webui/","url":"https://blog.hanqunfeng.com/2025/10/13/kafka-03-webui/","title":"Kafka çš„ Web UI ä¹‹ Kafbat UI","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Kafka çš„ Web UI ä¹‹ Kafbat UI</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafbat.io\">Kafbat UI å®˜ç½‘</a>,<a href=\"https://github.com/kafbat/kafka-ui\">Kafbat UI Github</a>,<a href=\"https://ui.docs.kafbat.io\">Kafbat UI æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Kafbat-UI-ç®€ä»‹\">Kafbat UI ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kafbat UI æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æº Web ç”¨æˆ·ç•Œé¢ï¼Œç”¨äºç›‘æ§å’Œç®¡ç† Apache Kafka é›†ç¾¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kafbat UI æ˜¯ä¸€ä¸ªç®€å•çš„å·¥å…·ï¼Œä½¿æ‚¨çš„æ•°æ®æµå˜å¾—å¯è§‚å¯Ÿï¼Œå¸®åŠ©æ›´å¿«åœ°å‘ç°å’Œæ’é™¤é—®é¢˜ï¼Œå¹¶æä¾›æœ€ä½³æ€§èƒ½ã€‚å…¶è½»é‡çº§çš„ä»ªè¡¨ç›˜ä½¿æ‚¨èƒ½å¤Ÿè½»æ¾è·Ÿè¸ª Kafka é›†ç¾¤çš„å…³é”®æŒ‡æ ‡: åŒ…æ‹¬ Brokersã€Topicsã€Partitionsã€ç”Ÿäº§å’Œæ¶ˆè´¹æƒ…å†µã€‚</p>\n</li>\n</ul>\n<h2 id=\"è¿è¡Œ-Kafbat-UI\">è¿è¡Œ Kafbat UI</h2>\n<h3 id=\"Docker-è¿è¡Œ\">Docker è¿è¡Œ</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it -p 8080:8080 \\</span><br><span class=\"line\">    --name kafka-ui \\</span><br><span class=\"line\">    -e KAFKA_CLUSTERS_0_NAME=kafka_c01 \\</span><br><span class=\"line\">    -e KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=localhost:9092 \\</span><br><span class=\"line\">    -e TZ=Asia/Shanghai \\</span><br><span class=\"line\">    -d ghcr.io/kafbat/kafka-ui:latest</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"Jar-è¿è¡Œ\">Jar è¿è¡Œ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»<a href=\"https://github.com/kafbat/kafka-ui/releases\">Github</a>ä¸Šä¸‹è½½æœ€æ–°ç‰ˆjaråŒ…ï¼Œè¦æ±‚ <code>jdk 21+</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /Users/hanqf/myservice_dir/kafka_webui</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®kafkaé›†ç¾¤ï¼Œå¯ä»¥åŒæ—¶é…ç½®å¤šä¸ªï¼Œåºå·ä»0å¼€å§‹ä¾æ¬¡é€’å¢</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_NAME=kafka_c01</span><br><span class=\"line\"><span class=\"comment\"># =============================================================================================================</span></span><br><span class=\"line\"><span class=\"comment\"># å¤–ç½‘PLAINTEXTè®¿é—®</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9093,68.79.13.235:9093,43.192.84.195:9093</span></span><br><span class=\"line\"><span class=\"comment\"># =============================================================================================================</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =============================================================================================================</span></span><br><span class=\"line\"><span class=\"comment\"># å¤–ç½‘SASL_PLAINTEXTè®¿é—®</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9094,68.79.13.235:9094,43.192.84.195:9094</span></span><br><span class=\"line\"><span class=\"comment\"># # SASL_PLAINTEXTè®¤è¯é…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL=SASL_PLAINTEXT</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM=PLAIN</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG=&#x27;org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;alice&quot; password=&quot;alice-secret&quot;;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># =============================================================================================================</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =============================================================================================================</span></span><br><span class=\"line\"><span class=\"comment\"># å¤–ç½‘SASL_SSLè®¿é—®</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9095,68.79.13.235:9095,43.192.84.195:9095</span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL=SASL_SSL</span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM=PLAIN</span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG=<span class=\"string\">&#x27;org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;alice&quot; password=&quot;alice-secret&quot;;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># SSLé…ç½®</span></span><br><span class=\"line\"><span class=\"comment\"># JKS æ ¼å¼è¯ä¹¦</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_LOCATION=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/kafka.truststore.jks</span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_PASSWORD=123456</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># PEM æ ¼å¼è¯ä¹¦</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_LOCATION=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/server.crt</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_TYPE=PEM</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¦ç”¨ä¸»æœºåéªŒè¯</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_CLUSTERS_0_PROPERTIES_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM=<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># ============================================================================================================</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬äºŒä¸ªé›†ç¾¤é…ç½®ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_1_NAME=kafka_c02</span></span><br><span class=\"line\"><span class=\"comment\"># export KAFKA_CLUSTERS_1_BOOTSTRAPSERVERS=localhost:9093</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—¶åŒº</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> TZ=Asia/Shanghai</span><br><span class=\"line\"><span class=\"comment\"># è¯­è¨€</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> LANG=zh_CN.UTF-8</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># webuiè®¿é—®è·¯å¾„</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> SERVER_SERVLET_CONTEXT_PATH=/</span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯æ–¹å¼ï¼Œæ”¯æŒNONE(æ— è®¤è¯)ï¼ŒLOGIN_FORM(ç™»å½•è¡¨å•è®¤è¯)</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> AUTH_TYPE=LOGIN_FORM</span><br><span class=\"line\"><span class=\"comment\"># webuiè®¤è¯ç”¨æˆ·åå¯†ç </span></span><br><span class=\"line\"><span class=\"built_in\">export</span> SPRING_SECURITY_USER_NAME=admin</span><br><span class=\"line\"><span class=\"built_in\">export</span> SPRING_SECURITY_USER_PASSWORD=admin</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">JAVA_OPTS=<span class=\"string\">&quot;-Xms512m -Xmx1024m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨</span></span><br><span class=\"line\">/Users/hanqf/develop_soft/jdk21/bin/java --add-opens java.rmi/javax.rmi.ssl=ALL-UNNAMED  <span class=\"variable\">$JAVA_OPTS</span> -jar api-v1.3.0.jar</span><br></pre></td></tr></table></figure>\n<h2 id=\"è®¿é—®-Kafbat-UI\">è®¿é—® Kafbat UI</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—® <a href=\"http://localhost:8080\">http://localhost:8080</a><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/ykd6F4.png\" alt=\"\"></p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ Web UI ä¹‹ Kafbat UI Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Kafbat UI å®˜ç½‘,Kafbat UI Github,Kafbat UI æ–‡æ¡£ Kafbat UI ç®€ä»‹ Kafbat UI æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æº Web ç”¨æˆ·ç•Œé¢ï¼Œç”¨äºç›‘æ§å’Œç®¡ç† Apache Kafka é›†ç¾¤ã€‚ Kafbat UI æ˜¯ä¸€ä¸ªç®€å•çš„å·¥å…·ï¼Œä½¿æ‚¨çš„æ•°æ®æµå˜å¾—å¯è§‚å¯Ÿï¼Œå¸®åŠ©æ›´å¿«åœ°å‘ç°å’Œæ’é™¤é—®é¢˜ï¼Œå¹¶æä¾›æœ€ä½³æ€§èƒ½ã€‚å…¶è½»é‡çº§çš„ä»ªè¡¨ç›˜ä½¿æ‚¨èƒ½å¤Ÿè½»æ¾è·Ÿè¸ª Kafka é›†ç¾¤çš„å…³é”®æŒ‡æ ‡: åŒ…æ‹¬ Brokersã€Topicsã€Partitionsã€ç”Ÿäº§å’Œæ¶ˆè´¹æƒ…å†µã€‚ è¿è¡Œ Kafbat UI Docker è¿è¡Œ 1234567docker run -it -p 8080:8080 \\ --name kafka-ui \\ -e KAFKA_CLUSTERS_0_NAME=kafka_c01 \\ -e KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=localhost:9092 \\ -e TZ=Asia/Shanghai \\ -d ghcr.io/kafbat/kafka-ui:latest Jar è¿è¡Œ ä»Githubä¸Šä¸‹è½½æœ€æ–°ç‰ˆjaråŒ…ï¼Œè¦æ±‚ jdk 21+ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859cd /Users/hanqf/myservice_dir/kafka_webui# é…ç½®kafkaé›†ç¾¤ï¼Œå¯ä»¥åŒæ—¶é…ç½®å¤šä¸ªï¼Œåºå·ä»0å¼€å§‹ä¾æ¬¡é€’å¢export KAFKA_CLUSTERS_0_NAME=kafka_c01# =============================================================================================================# å¤–ç½‘PLAINTEXTè®¿é—®# export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9093,68.79.13.235:9093,43.192.84.195:9093# =============================================================================================================# =============================================================================================================# å¤–ç½‘SASL_PLAINTEXTè®¿é—®# export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9094,68.79.13.235:9094,43.192.84.195:9094# # SASL_PLAINTEXTè®¤è¯é…ç½®# export KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL=SASL_PLAINTEXT# export KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM=PLAIN# export KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG=&#x27;org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;alice&quot; password=&quot;alice-secret&quot;;&#x27;# =============================================================================================================# =============================================================================================================# å¤–ç½‘SASL_SSLè®¿é—®export KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=161.189.227.200:9095,68.79.13.235:9095,43.192.84.195:9095export KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL=SASL_SSLexport KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM=PLAINexport KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG=&#x27;org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;alice&quot; password=&quot;alice-secret&quot;;&#x27;# SSLé…ç½®# JKS æ ¼å¼è¯ä¹¦export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_LOCATION=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/kafka.truststore.jksexport KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_PASSWORD=123456# PEM æ ¼å¼è¯ä¹¦# export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_LOCATION=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/server.crt# export KAFKA_CLUSTERS_0_PROPERTIES_SSL_TRUSTSTORE_TYPE=PEM# ç¦ç”¨ä¸»æœºåéªŒè¯export KAFKA_CLUSTERS_0_PROPERTIES_SSL_ENDPOINT_IDENTIFICATION_ALGORITHM=&#x27;&#x27;# ============================================================================================================# ç¬¬äºŒä¸ªé›†ç¾¤é…ç½®ç¤ºä¾‹# export KAFKA_CLUSTERS_1_NAME=kafka_c02# export KAFKA_CLUSTERS_1_BOOTSTRAPSERVERS=localhost:9093# æ—¶åŒºexport TZ=Asia/Shanghai# è¯­è¨€export LANG=zh_CN.UTF-8# webuiè®¿é—®è·¯å¾„export SERVER_SERVLET_CONTEXT_PATH=/# è®¤è¯æ–¹å¼ï¼Œæ”¯æŒNONE(æ— è®¤è¯)ï¼ŒLOGIN_FORM(ç™»å½•è¡¨å•è®¤è¯)export AUTH_TYPE=LOGIN_FORM# webuiè®¤è¯ç”¨æˆ·åå¯†ç export SPRING_SECURITY_USER_NAME=adminexport SPRING_SECURITY_USER_PASSWORD=adminJAVA_OPTS=&quot;-Xms512m -Xmx1024m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m&quot;# å¯åŠ¨/Users/hanqf/develop_soft/jdk21/bin/java --add-opens java.rmi/javax.rmi.ssl=ALL-UNNAMED $JAVA_OPTS -jar api-v1.3.0.jar è®¿é—® Kafbat UI è®¿é—® http://localhost:8080","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ Web UI ä¹‹ Kafbat UI Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Kafbat UI å®˜ç½‘,Kafbat UI Github,Kafbat UI æ–‡æ¡£","date_published":"2025-10-13T15:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/10/13/kafka-02-protocol/","url":"https://blog.hanqunfeng.com/2025/10/13/kafka-02-protocol/","title":"Kafka é€šä¿¡åè®®ã€SSLåŠ å¯†å’Œèº«ä»½éªŒè¯","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Kafka çš„ é€šä¿¡åè®®ï¼Œä»¥åŠå¦‚ä½•å¼€å¯å¤–ç½‘è®¿é—®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Kafka-çš„-é€šä¿¡åè®®\">Kafka çš„ é€šä¿¡åè®®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kafka ä¸»è¦æ”¯æŒå››ç§å®‰å…¨åè®®</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åè®®åç§°</th>\n<th>åŠ å¯†</th>\n<th>è®¤è¯</th>\n<th>è¯´æ˜</th>\n<th>æ¨èåœºæ™¯</th>\n<th>ç†ç”±</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>PLAINTEXT</strong></td>\n<td>âŒ å¦</td>\n<td>âŒ å¦</td>\n<td>æ— åŠ å¯†ã€æ— è®¤è¯ï¼ˆé»˜è®¤æœ€ç®€å•ï¼‰</td>\n<td>å¼€å‘ / æµ‹è¯•ç¯å¢ƒã€å†…ç½‘é›†ç¾¤é€šä¿¡</td>\n<td>ç®€å•ã€æ˜“è°ƒè¯•ï¼›ç½‘ç»œå¯ä¿¡ï¼Œæ€§èƒ½ä¼˜å…ˆ</td>\n</tr>\n<tr>\n<td><strong>SSL</strong></td>\n<td>âœ… æ˜¯</td>\n<td>âœ… å¯é€‰</td>\n<td>ä½¿ç”¨ TLS/SSL åŠ å¯†é€šä¿¡ï¼Œå¯é…ç½®å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯</td>\n<td>å¤–ç½‘å®¢æˆ·ç«¯è®¿é—®</td>\n<td>æ”¯æŒæ•°æ®åŠ å¯†ï¼Œå¯é€‰è®¤è¯ï¼Œä¿è¯å®‰å…¨</td>\n</tr>\n<tr>\n<td><strong>SASL_PLAINTEXT</strong></td>\n<td>âŒ å¦</td>\n<td>âœ… æ˜¯</td>\n<td>ä½¿ç”¨ SASLï¼ˆç”¨æˆ·åå¯†ç ï¼‰è®¤è¯ï¼Œä½†ä¸åŠ å¯†æ•°æ®</td>\n<td>éœ€è¦ç”¨æˆ·è®¤è¯ä½†å±€åŸŸç½‘ç¯å¢ƒ</td>\n<td>æœ‰è®¤è¯ï¼Œä½†ä¸åŠ å¯†ï¼Œæ€§èƒ½å¼€é”€ä½</td>\n</tr>\n<tr>\n<td><strong>SASL_SSL</strong></td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n<td>åŒæ—¶æ”¯æŒ SASL è®¤è¯å’Œ SSL åŠ å¯†ï¼ˆæœ€å®‰å…¨ï¼‰</td>\n<td>å¤–ç½‘å®¢æˆ·ç«¯è®¿é—®</td>\n<td>æ—¢æœ‰è®¤è¯åˆåŠ å¯†ï¼Œå®‰å…¨æ€§æœ€é«˜</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ <code>config/server.properties</code> æ–‡ä»¶ä¸­ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¥—æ¥å­—æœåŠ¡å™¨ç›‘å¬çš„åœ°å€ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœæœªé…ç½®ï¼Œåˆ™ä¸»æœºåé»˜è®¤ç­‰äº `java.net.InetAddress.getCanonicalHostName()` çš„è¿”å›å€¼ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ç›‘å¬å™¨åç§° `PLAINTEXT`ï¼Œç«¯å£å·ä¸º 9092ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">#   æ ¼å¼ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#     listeners = listener_name://host_name:port</span></span><br><span class=\"line\"><span class=\"comment\">#   ç¤ºä¾‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">#     listeners = PLAINTEXT://your.host.name:9092</span></span><br><span class=\"line\"><span class=\"comment\">#listeners=PLAINTEXT://:9092</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Broker å‘å®¢æˆ·ç«¯â€œé€šå‘Šâ€çš„ç›‘å¬å™¨åç§°ã€ä¸»æœºåå’Œç«¯å£ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å®¢æˆ·ç«¯å®é™…ä¼šè¿æ¥è¿™ä¸ªåœ°å€ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ listeners çš„åœ°å€ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœæœªè®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ `listeners` çš„å€¼ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">#advertised.listeners=PLAINTEXT://your.host.name:9092</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°†ç›‘å¬å™¨åç§°æ˜ å°„åˆ°å®‰å…¨åè®®ç±»å‹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤æƒ…å†µä¸‹ï¼Œç›‘å¬å™¨åç§°ä¸å®‰å…¨åè®®åŒåã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ä¾‹å¦‚ï¼šPLAINTEXTâ†’PLAINTEXTã€SSLâ†’SSLã€SASL_PLAINTEXTâ†’SASL_PLAINTEXTã€SASL_SSLâ†’SASL_SSLã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># æ›´å¤šç»†èŠ‚å¯å‚è€ƒ Kafka å®˜æ–¹é…ç½®æ–‡æ¡£ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span></span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>ä½œç”¨</th>\n<th>è¯´æ˜å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>listeners</code></td>\n<td>Kafka å®é™…ç›‘å¬çš„åœ°å€ï¼ˆBroker å¯¹å¤–å¼€æ”¾çš„ç«¯å£ï¼‰</td>\n<td><code>PLAINTEXT://:9092</code>è¿™é‡Œ PLAINTEXT æ˜¯ç›‘å¬å™¨åç§°ï¼Œå¹¶ä¸æ˜¯åè®®åç§°ï¼Œå®é™…ä¸Šå¯ä»¥é…ç½®ä¸ºä»»ä½•å€¼ï¼Œå…·ä½“åè®®æ˜¯é€šè¿‡ <code>listener.security.protocol.map</code> é…ç½®çš„æ˜ å°„å…³ç³»æ¥ç¡®å®šã€‚</td>\n</tr>\n<tr>\n<td><code>advertised.listeners</code></td>\n<td>Kafka å‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç”¨å“ªä¸ªåœ°å€è¿æ¥ï¼ˆå®¢æˆ·ç«¯æœ€ç»ˆè¿çš„ï¼‰</td>\n<td>é»˜è®¤ä½¿ç”¨ <code>listeners</code> çš„å€¼</td>\n</tr>\n<tr>\n<td><code>listener.security.protocol.map</code></td>\n<td>æ˜ å°„ç›‘å¬å™¨åç§°åˆ°é€šä¿¡å®‰å…¨åè®®ï¼ˆå¦‚æ˜æ–‡ã€SSLã€SASL ç­‰ï¼‰</td>\n<td><code>PLAINTEXT:PLAINTEXT</code>ï¼Œå‰é¢æ˜¯ç›‘å¬å™¨åç§°ï¼Œåé¢æ˜¯åè®®åç§°</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ä»…éœ€å†…ç½‘è®¿é—®\">ä»…éœ€å†…ç½‘è®¿é—®</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listeners=PLAINTEXT://0.0.0.0:9092</span><br><span class=\"line\">advertised.listeners=PLAINTEXT://worker1:9092 <span class=\"comment\"># è¿™é‡Œæ˜¯å†…ç½‘ip</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å…è®¸å¤–ç½‘è®¿é—®\">å…è®¸å¤–ç½‘è®¿é—®</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listeners=PLAINTEXT://0.0.0.0:9092</span><br><span class=\"line\">advertised.listeners=PLAINTEXT://161.189.227.200:9092 <span class=\"comment\"># è¿™é‡Œæ˜¯å¤–ç½‘ip</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å†…å¤–ç½‘éƒ½è¦è®¿é—®ï¼ˆæ¨èåŒé€šé“æ–¹å¼ï¼‰\">å†…å¤–ç½‘éƒ½è¦è®¿é—®ï¼ˆæ¨èåŒé€šé“æ–¹å¼ï¼‰</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œ INTERNAL å’Œ EXTERNAL åˆ†åˆ«æ˜¯è‡ªå®šä¹‰çš„ç›‘å¬å™¨åç§°ï¼Œæ­¤æ—¶å†…ç½‘ç«¯å£ä¸º 9092ï¼Œå¤–ç½‘ç«¯å£ä¸º 9093</span></span><br><span class=\"line\">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9093</span><br><span class=\"line\"><span class=\"comment\"># å‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç”¨å“ªä¸ªåœ°å€è¿æ¥</span></span><br><span class=\"line\">advertised.listeners=INTERNAL://worker1:9092,EXTERNAL://161.189.227.200:9093</span><br><span class=\"line\"><span class=\"comment\"># æ˜ å°„ç›‘å¬å™¨åç§°åˆ°é€šä¿¡å®‰å…¨åè®®çš„æ˜ å°„å…³ç³»</span></span><br><span class=\"line\">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT</span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤é—´é€šä¿¡ä»ä½¿ç”¨å†…ç½‘</span></span><br><span class=\"line\">inter.broker.listener.name=INTERNAL</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¼€å¯-SASL-PLAINTEXT\">å¼€å¯ SASL_PLAINTEXT</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè®¾ç½®å¤–ç½‘è®¿é—®æ—¶å¼€å¯ SASL_PLAINTEXT</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®</span></span><br><span class=\"line\">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9094</span><br><span class=\"line\"><span class=\"comment\"># å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€</span></span><br><span class=\"line\">advertised.listeners=INTERNAL://worker1:9092,EXTERNAL://161.189.227.200:9094</span><br><span class=\"line\">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_PLAINTEXT</span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤é—´é€šä¿¡ still use INTERNAL</span></span><br><span class=\"line\">inter.broker.listener.name=INTERNAL</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256/512ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># client è¿æ¥æ—¶</span></span><br><span class=\"line\">sasl.enabled.mechanisms=PLAIN</span><br><span class=\"line\"><span class=\"comment\"># broker ä¹‹é—´è¿æ¥æ—¶ï¼Œå› ä¸º inter.broker.listener.name=INTERNALï¼Œæ‰€ä»¥ INTERNAL:SASL_PLAINTEXT æ‰æœ‰æ•ˆ</span></span><br><span class=\"line\"><span class=\"comment\">#sasl.mechanism.inter.broker.protocol=PLAIN</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º kafka_jaas.conf</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">############################</span></span><br><span class=\"line\"><span class=\"comment\"># Kafka Broker (æœåŠ¡ç«¯)</span></span><br><span class=\"line\"><span class=\"comment\">############################</span></span><br><span class=\"line\">KafkaServer &#123;</span><br><span class=\"line\">    org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class=\"line\">    <span class=\"comment\"># Broker è‡ªå·±çš„èº«ä»½ï¼ˆç”¨äº broker ä¹‹é—´é€šä¿¡ï¼Œæœ¬ç¤ºä¾‹ä¸­æ²¡æœ‰ä½¿ç”¨ï¼‰</span></span><br><span class=\"line\">    username=<span class=\"string\">&quot;admin&quot;</span></span><br><span class=\"line\">    password=<span class=\"string\">&quot;admin-secret&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># å®¢æˆ·ç«¯å¯ç”¨è´¦å·ï¼Œå³ user_xxxï¼Œè¿™é‡Œ xxx ä¸ºç”¨æˆ·åï¼Œ= å³è¾¹çš„ä¸ºå¯†ç </span></span><br><span class=\"line\">    user_admin=<span class=\"string\">&quot;admin-secret&quot;</span></span><br><span class=\"line\">    user_alice=<span class=\"string\">&quot;alice-secret&quot;</span></span><br><span class=\"line\">    user_bob=<span class=\"string\">&quot;bob-secret&quot;</span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ kafka</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨å¯åŠ¨ Kafka Broker å‰ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡æŒ‡å‘ JAAS æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_OPTS=<span class=\"string\">&quot;-Djava.security.auth.login.config=/path/to/kafka_jaas.conf&quot;</span></span><br><span class=\"line\">kafka-server-start.sh config/server.properties</span><br></pre></td></tr></table></figure>\n<h3 id=\"å®¢æˆ·ç«¯è®¿é—®\">å®¢æˆ·ç«¯è®¿é—®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º client.conf</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">security.protocol=SASL_PLAINTEXT</span><br><span class=\"line\">sasl.mechanism=PLAIN</span><br><span class=\"line\">sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=<span class=\"string\">&quot;admin&quot;</span> password=<span class=\"string\">&quot;admin-secret&quot;</span>;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œè®¿é—®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºtopic</span></span><br><span class=\"line\">kafka-topics.sh --create --topic test-topic --bootstrap-server=161.189.227.200:9094 --command-config=client.conf</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹topic</span></span><br><span class=\"line\">kafka-topics.sh --list --bootstrap-server=161.189.227.200:9094 --command-config=client.conf</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºæ¶ˆè´¹è€…ï¼Œ--group æŒ‡å®šæ¶ˆè´¹è€…ç»„åç§°</span></span><br><span class=\"line\">kafka-console-consumer.sh --bootstrap-server=161.189.227.200:9094 --topic test-topic --consumer.config=client.conf --group=test-group</span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç”Ÿäº§è€…</span></span><br><span class=\"line\">kafka-console-producer.sh --bootstrap-server=161.189.227.200:9094 --topic test-topic --producer.config=client.conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¼€å¯-SASL-SSL\">å¼€å¯ SASL_SSL</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè®¾ç½®å¤–ç½‘è®¿é—®æ—¶å¼€å¯ SASL_SSL</p>\n</li>\n</ul>\n<h3 id=\"åˆ›å»ºè¯ä¹¦\">åˆ›å»ºè¯ä¹¦</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org/39/documentation.html#security_ssl\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”Ÿæˆ Broker keystoreï¼Œç”¨äº å­˜å‚¨ broker çš„ç§é’¥å’Œè¯ä¹¦ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">keytool -keystore kafka.server.keystore.jks \\</span><br><span class=\"line\">  -<span class=\"built_in\">alias</span> broker -validity 3650 \\</span><br><span class=\"line\">  -genkey -keyalg RSA \\</span><br><span class=\"line\">  -dname <span class=\"string\">&quot;CN=broker, OU=Kafka, O=YourOrg, L=City, ST=State, C=CN&quot;</span> \\</span><br><span class=\"line\">  -storepass 123456 \\</span><br><span class=\"line\">  -keypass 123456</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># -keystoreï¼šç”Ÿæˆçš„ keystore æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -alias brokerï¼šè¯ä¹¦åˆ«å</span></span><br><span class=\"line\"><span class=\"comment\"># -validity 3650ï¼šæœ‰æ•ˆæœŸ 3650 å¤©</span></span><br><span class=\"line\"><span class=\"comment\"># -keyalg RSAï¼šå¯†é’¥ç®—æ³•</span></span><br><span class=\"line\"><span class=\"comment\"># -dnameï¼šè¯ä¹¦ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\"># -storepassï¼škeystore å¯†ç </span></span><br><span class=\"line\"><span class=\"comment\"># -keypassï¼šå¯†é’¥å¯†ç </span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¼å‡º Broker è¯ä¹¦ï¼ˆç”¨äºå®¢æˆ·ç«¯ truststoreï¼‰,ç”Ÿæˆ kafka.server.crtï¼Œå®¢æˆ·ç«¯ä¼šç”¨å®ƒæ¥éªŒè¯ brokerã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">keytool -keystore kafka.server.keystore.jks \\</span><br><span class=\"line\">  -<span class=\"built_in\">alias</span> broker -<span class=\"built_in\">export</span> -file kafka.server.crt \\</span><br><span class=\"line\">  -storepass 123456</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># -keystoreï¼škeystore æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -alias brokerï¼šè¯ä¹¦åˆ«å</span></span><br><span class=\"line\"><span class=\"comment\"># -file kafka.server.crtï¼šå¯¼å‡ºçš„è¯ä¹¦æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -storepassï¼škeystore å¯†ç </span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç”Ÿæˆ Broker truststoreï¼Œtruststore ç”¨äº å­˜å‚¨ä¿¡ä»»çš„è¯ä¹¦ï¼ˆè¿™é‡ŒæŠŠè‡ªå·±ç”Ÿæˆçš„è¯ä¹¦å¯¼å…¥è¿›å»å³å¯ï¼‰,ç”Ÿæˆ kafka.truststore.jks</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„ï¼šè¿™é‡Œ server ç«¯ å’Œ client ç«¯ å¯ä»¥å…±ç”¨ä¸€ä¸ª truststoreï¼Œä¹Ÿå¯ä»¥åˆ†åˆ«åˆ›å»º</span></span><br><span class=\"line\">keytool -keystore kafka.truststore.jks \\</span><br><span class=\"line\">  -<span class=\"built_in\">alias</span> broker -import -file kafka.server.crt \\</span><br><span class=\"line\">  -storepass 123456 -noprompt</span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># -keystoreï¼šç”Ÿæˆçš„ truststore æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -alias brokerï¼šè¯ä¹¦åˆ«å</span></span><br><span class=\"line\"><span class=\"comment\"># -file kafka.server.crtï¼šå¯¼å…¥çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\"># -storepassï¼štruststore å¯†ç </span></span><br><span class=\"line\"><span class=\"comment\"># -nopromptï¼šä¸æç¤º</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"server-properties-é…ç½®-SASL-SSL\">server.properties é…ç½® SASL_SSL</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®</span></span><br><span class=\"line\">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9095</span><br><span class=\"line\"><span class=\"comment\"># å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€</span></span><br><span class=\"line\">advertised.listeners=INTERNAL://worker2:9092,EXTERNAL://161.189.227.200:9095</span><br><span class=\"line\">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_SSL</span><br><span class=\"line\">inter.broker.listener.name=INTERNAL</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SASL</span></span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256/512ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># client è¿æ¥æ—¶</span></span><br><span class=\"line\">sasl.enabled.mechanisms=PLAIN</span><br><span class=\"line\"><span class=\"comment\"># broker ä¹‹é—´è¿æ¥æ—¶ï¼Œéœ€è¦ inter.broker.listener.name=SASL_PLAINTEXT æ‰æœ‰æ•ˆ</span></span><br><span class=\"line\"><span class=\"comment\">#sasl.mechanism.inter.broker.protocol=PLAIN</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SSL</span></span><br><span class=\"line\">ssl.keystore.location=/usr/local/kafka/kafka3/config/ssl/kafka.server.keystore.jks</span><br><span class=\"line\">ssl.keystore.password=123456</span><br><span class=\"line\">ssl.key.password=123456</span><br><span class=\"line\">ssl.truststore.location=/usr/local/kafka/kafka3/config/ssl/kafka.truststore.jks</span><br><span class=\"line\">ssl.truststore.password=123456</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä¸è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¯ä»¥è®¾ç½® none ï¼Œè¦æ±‚åˆ™è®¾ç½®ä¸º required</span></span><br><span class=\"line\">ssl.client.auth=none</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ kafka å‰åŒæ ·éœ€è¦å…ˆåˆ›å»ºå¥½ kafka_jaas.confï¼Œä¸ SASL_PLAINTEXT ä¸€æ ·ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å®¢æˆ·ç«¯è®¿é—®-2\">å®¢æˆ·ç«¯è®¿é—®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† <code>kafka.truststore.jks</code> æ‹·è´åˆ°å®¢æˆ·ç«¯</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ SASL_PLAINTEXT ä¸€æ ·ï¼Œåˆ›å»º client.confï¼Œå¹¶æ·»åŠ å¦‚ä¸‹ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">security.protocol=SASL_SSL</span><br><span class=\"line\">sasl.mechanism=PLAIN</span><br><span class=\"line\">sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=<span class=\"string\">&quot;admin&quot;</span> password=<span class=\"string\">&quot;admin-secret&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SSL é…ç½®</span></span><br><span class=\"line\">ssl.truststore.location=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/kafka.truststore.jks</span><br><span class=\"line\">ssl.truststore.password=123456</span><br><span class=\"line\"><span class=\"comment\"># ç¦ç”¨ä¸»æœºåéªŒè¯ï¼Œå¦åˆ™ä¼šæ ¡éªŒè¯ä¹¦çš„ SANï¼Œè¯ä¹¦åŸŸåæ ¡éªŒå¼€å…³ï¼Œä¸ºç©ºåˆ™è¡¨ç¤ºå…³é—­ï¼Œè¿™é‡Œéœ€è¦ä¿æŒå…³é—­çŠ¶æ€ï¼Œå¿…é¡»è®¾ç½®ä¸ºç©º</span></span><br><span class=\"line\">ssl.endpoint.identification.algorithm=</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œè®¿é—® ä¸ SASL_PLAINTEXT ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿°</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äº Kafka JKSæ ¼å¼çš„SSLè¯ä¹¦çš„åˆ›å»ºåŠé…ç½®å¯ä»¥å‚è€ƒ<a href=\"https://support.huaweicloud.com/usermanual-kafka/kafka-ug-0008.html\">åˆ¶ä½œå’Œæ›¿æ¢Kafka JKSæ ¼å¼çš„SSLè¯ä¹¦</a></p>\n</li>\n</ul>\n<h4 id=\"PEM-è¯ä¹¦\">PEM è¯ä¹¦</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kafka çš„ è¯ä¹¦ é»˜è®¤ä½¿ç”¨ JKS æ ¼å¼ï¼Œä½†ä» 2.7.0 å¼€å§‹æ”¯æŒ PEM æ ¼å¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®</span></span><br><span class=\"line\">listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9095</span><br><span class=\"line\"><span class=\"comment\"># å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€</span></span><br><span class=\"line\">advertised.listeners=INTERNAL://worker2:9092,EXTERNAL://161.189.227.200:9095</span><br><span class=\"line\">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_SSL</span><br><span class=\"line\">inter.broker.listener.name=INTERNAL</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SASL</span></span><br><span class=\"line\"><span class=\"comment\"># è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256/512ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\"># client è¿æ¥æ—¶</span></span><br><span class=\"line\">sasl.enabled.mechanisms=PLAIN</span><br><span class=\"line\"><span class=\"comment\"># broker ä¹‹é—´è¿æ¥æ—¶ï¼Œéœ€è¦ inter.broker.listener.name=SASL_PLAINTEXT æ‰æœ‰æ•ˆ</span></span><br><span class=\"line\"><span class=\"comment\">#sasl.mechanism.inter.broker.protocol=PLAIN</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SSL-PEM</span></span><br><span class=\"line\">ssl.keystore.type=PEM <span class=\"comment\"># æŒ‡å®šè¯ä¹¦ç±»å‹æ˜¯PEMï¼Œæ”¯æŒçš„ç±»å‹ PEMã€JKS</span></span><br><span class=\"line\">ssl.keystore.location=/usr/local/kafka/kafka3/config/ssl/fullchain.pem <span class=\"comment\"># åŒ…å«ç§é’¥å’Œå…¬é’¥</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨çš„è¯ä¹¦ç±»å‹æ˜¯PEM</span></span><br><span class=\"line\">ssl.truststore.type=PEM</span><br><span class=\"line\">ssl.truststore.location=/usr/local/kafka/kafka3/config/ssl/server.crt <span class=\"comment\"># å…¬é’¥</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä¸è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¯ä»¥è®¾ç½® none ï¼Œè¦æ±‚åˆ™è®¾ç½®ä¸º required</span></span><br><span class=\"line\">ssl.client.auth=none</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>client.conf é…ç½®å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">security.protocol=SASL_SSL</span><br><span class=\"line\">sasl.mechanism=PLAIN</span><br><span class=\"line\">sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=<span class=\"string\">&quot;admin&quot;</span> password=<span class=\"string\">&quot;admin-secret&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SSL é…ç½®ï¼Œå°† server ç«¯çš„ server.crt æ‹·è´åˆ° client ç«¯</span></span><br><span class=\"line\">ssl.truststore.location=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/server.crt</span><br><span class=\"line\">ssl.truststore.type=PEM</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¦ç”¨ä¸»æœºåéªŒè¯</span></span><br><span class=\"line\">ssl.endpoint.identification.algorithm=</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>jks è¯ä¹¦è½¬æ¢ä¸º pem æ ¼å¼</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">ä» JKS å¯¼å‡ºä¸º PKCS#12 (.p12)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">keytool -importkeystore \\</span><br><span class=\"line\">  -srckeystore kafka.server.keystore.jks \\</span><br><span class=\"line\">  -srcstoretype JKS \\</span><br><span class=\"line\">  -destkeystore kafka.server.p12 \\</span><br><span class=\"line\">  -deststoretype PKCS12 \\</span><br><span class=\"line\">  -srcstorepass 123456 \\</span><br><span class=\"line\">  -deststorepass 123456 \\</span><br><span class=\"line\">  -J<span class=\"string\">&quot;-Djdk.tls.disabledAlgorithms=&quot;</span> \\</span><br><span class=\"line\">  -J<span class=\"string\">&quot;-Dkeystore.pkcs12.legacy=false&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜ï¼š</span></span><br><span class=\"line\">  <span class=\"comment\"># -srcstoretype JKSï¼šåŸå§‹æ ¼å¼ï¼›</span></span><br><span class=\"line\">  <span class=\"comment\"># -deststoretype PKCS12ï¼šè½¬æ¢ä¸ºé€šç”¨æ ¼å¼ï¼›</span></span><br><span class=\"line\">  <span class=\"comment\"># .p12 æ˜¯ PEM çš„â€œä¸­é—´æ ¼å¼â€ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">å¯¼å‡ºè¯ä¹¦[å…¬é’¥] (.crtï¼Œè¿™é‡Œæ˜¯ PEM æ ¼å¼)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> kafka.server.p12 -clcerts -nokeys -out server.crt -password pass:123456 -provider legacy -provider default</span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># -clcertsï¼šåªå¯¼å‡ºè¯ä¹¦ï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># -nokeysï¼šä¸å¯¼å‡ºå¯†é’¥ï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># -out server.crtï¼šå¯¼å‡ºæ–‡ä»¶åï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># -passwordï¼škafka.server.p12çš„å¯†é’¥å¯†ç ï¼Œæ³¨æ„å¯†ç å‰é¢åŠ ä¸Š pass:</span></span><br><span class=\"line\"><span class=\"comment\"># -provider legacyï¼šå¯ç”¨æ—§ç®—æ³•æ”¯æŒæ¨¡å—ï¼Œåœ¨ OpenSSL 3.0ï¼ˆåŠæ›´é«˜ç‰ˆæœ¬ï¼‰ä¸­ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°æœºåˆ¶ â€”â€” Providerï¼ˆç®—æ³•æä¾›è€…ï¼‰,é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenSSL åªåŠ è½½ modern providerï¼ˆdefault providerï¼‰ï¼Œè€Œè®¸å¤šè€æ—§ç®—æ³•ï¼ˆä¾‹å¦‚ RC2ã€MD5ã€DESã€SHA1ï¼‰è¢«ç§»åˆ°äº†ä¸€ä¸ªå•ç‹¬çš„ legacy provider æ¨¡å—ä¸­ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># -provider defaultï¼šåŒæ—¶å¯ç”¨é»˜è®¤ providerï¼Œå› ä¸ºæœ‰äº›å‘½ä»¤ï¼ˆæ¯”å¦‚æ¶‰åŠç°ä»£åŠ å¯†ç®—æ³•æˆ–è¯ä¹¦ç­¾åï¼‰è¿˜ä¾èµ–é»˜è®¤ providerï¼Œæ‰€ä»¥ä¸¤è€…ä¸€èµ·ä½¿ç”¨æœ€å®‰å…¨ã€æœ€å…¼å®¹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">å¯¼å‡ºç§é’¥ (.keyï¼Œè¿™é‡Œæ˜¯ PEM æ ¼å¼)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> kafka.server.p12 -nocerts -out server.key -nodes -password pass:123456 -provider legacy -provider default</span><br><span class=\"line\"><span class=\"comment\">## è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># -nocertsï¼šåªå¯¼å‡ºå¯†é’¥ï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># -out server.keyï¼šå¯¼å‡ºæ–‡ä»¶åï¼›</span></span><br><span class=\"line\"><span class=\"comment\"># -nodesï¼šä¸åŠ å¯†å¯¼å‡ºçš„å¯†é’¥æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># -passwordï¼škafka.server.p12çš„å¯†é’¥å¯†ç ï¼Œæ³¨æ„å¯†ç å‰é¢åŠ ä¸Š pass:</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">fullchain.pem</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> kafka.server.p12 -out fullchain.pem -nodes -password pass:123456 -provider legacy -provider default</span><br></pre></td></tr></table></figure>\n</div>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ é€šä¿¡åè®®ï¼Œä»¥åŠå¦‚ä½•å¼€å¯å¤–ç½‘è®¿é—®ã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Kafka çš„ é€šä¿¡åè®® Kafka ä¸»è¦æ”¯æŒå››ç§å®‰å…¨åè®® åè®®åç§° åŠ å¯† è®¤è¯ è¯´æ˜ æ¨èåœºæ™¯ ç†ç”± PLAINTEXT âŒ å¦ âŒ å¦ æ— åŠ å¯†ã€æ— è®¤è¯ï¼ˆé»˜è®¤æœ€ç®€å•ï¼‰ å¼€å‘ / æµ‹è¯•ç¯å¢ƒã€å†…ç½‘é›†ç¾¤é€šä¿¡ ç®€å•ã€æ˜“è°ƒè¯•ï¼›ç½‘ç»œå¯ä¿¡ï¼Œæ€§èƒ½ä¼˜å…ˆ SSL âœ… æ˜¯ âœ… å¯é€‰ ä½¿ç”¨ TLS/SSL åŠ å¯†é€šä¿¡ï¼Œå¯é…ç½®å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯ å¤–ç½‘å®¢æˆ·ç«¯è®¿é—® æ”¯æŒæ•°æ®åŠ å¯†ï¼Œå¯é€‰è®¤è¯ï¼Œä¿è¯å®‰å…¨ SASL_PLAINTEXT âŒ å¦ âœ… æ˜¯ ä½¿ç”¨ SASLï¼ˆç”¨æˆ·åå¯†ç ï¼‰è®¤è¯ï¼Œä½†ä¸åŠ å¯†æ•°æ® éœ€è¦ç”¨æˆ·è®¤è¯ä½†å±€åŸŸç½‘ç¯å¢ƒ æœ‰è®¤è¯ï¼Œä½†ä¸åŠ å¯†ï¼Œæ€§èƒ½å¼€é”€ä½ SASL_SSL âœ… æ˜¯ âœ… æ˜¯ åŒæ—¶æ”¯æŒ SASL è®¤è¯å’Œ SSL åŠ å¯†ï¼ˆæœ€å®‰å…¨ï¼‰ å¤–ç½‘å®¢æˆ·ç«¯è®¿é—® æ—¢æœ‰è®¤è¯åˆåŠ å¯†ï¼Œå®‰å…¨æ€§æœ€é«˜ åœ¨ config/server.properties æ–‡ä»¶ä¸­ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é…ç½® 12345678910111213141516171819# å¥—æ¥å­—æœåŠ¡å™¨ç›‘å¬çš„åœ°å€ã€‚# å¦‚æœæœªé…ç½®ï¼Œåˆ™ä¸»æœºåé»˜è®¤ç­‰äº `java.net.InetAddress.getCanonicalHostName()` çš„è¿”å›å€¼ï¼Œ# ä½¿ç”¨ç›‘å¬å™¨åç§° `PLAINTEXT`ï¼Œç«¯å£å·ä¸º 9092ã€‚# æ ¼å¼ï¼š# listeners = listener_name://host_name:port# ç¤ºä¾‹ï¼š# listeners = PLAINTEXT://your.host.name:9092#listeners=PLAINTEXT://:9092# Broker å‘å®¢æˆ·ç«¯â€œé€šå‘Šâ€çš„ç›‘å¬å™¨åç§°ã€ä¸»æœºåå’Œç«¯å£ã€‚# å®¢æˆ·ç«¯å®é™…ä¼šè¿æ¥è¿™ä¸ªåœ°å€ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ listeners çš„åœ°å€ã€‚# å¦‚æœæœªè®¾ç½®ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ `listeners` çš„å€¼ã€‚#advertised.listeners=PLAINTEXT://your.host.name:9092# å°†ç›‘å¬å™¨åç§°æ˜ å°„åˆ°å®‰å…¨åè®®ç±»å‹ã€‚# é»˜è®¤æƒ…å†µä¸‹ï¼Œç›‘å¬å™¨åç§°ä¸å®‰å…¨åè®®åŒåã€‚# ä¾‹å¦‚ï¼šPLAINTEXTâ†’PLAINTEXTã€SSLâ†’SSLã€SASL_PLAINTEXTâ†’SASL_PLAINTEXTã€SASL_SSLâ†’SASL_SSLã€‚# æ›´å¤šç»†èŠ‚å¯å‚è€ƒ Kafka å®˜æ–¹é…ç½®æ–‡æ¡£ã€‚#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL é…ç½®é¡¹ ä½œç”¨ è¯´æ˜å€¼ listeners Kafka å®é™…ç›‘å¬çš„åœ°å€ï¼ˆBroker å¯¹å¤–å¼€æ”¾çš„ç«¯å£ï¼‰ PLAINTEXT://:9092è¿™é‡Œ PLAINTEXT æ˜¯ç›‘å¬å™¨åç§°ï¼Œå¹¶ä¸æ˜¯åè®®åç§°ï¼Œå®é™…ä¸Šå¯ä»¥é…ç½®ä¸ºä»»ä½•å€¼ï¼Œå…·ä½“åè®®æ˜¯é€šè¿‡ listener.security.protocol.map é…ç½®çš„æ˜ å°„å…³ç³»æ¥ç¡®å®šã€‚ advertised.listeners Kafka å‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç”¨å“ªä¸ªåœ°å€è¿æ¥ï¼ˆå®¢æˆ·ç«¯æœ€ç»ˆè¿çš„ï¼‰ é»˜è®¤ä½¿ç”¨ listeners çš„å€¼ listener.security.protocol.map æ˜ å°„ç›‘å¬å™¨åç§°åˆ°é€šä¿¡å®‰å…¨åè®®ï¼ˆå¦‚æ˜æ–‡ã€SSLã€SASL ç­‰ï¼‰ PLAINTEXT:PLAINTEXTï¼Œå‰é¢æ˜¯ç›‘å¬å™¨åç§°ï¼Œåé¢æ˜¯åè®®åç§° ä»…éœ€å†…ç½‘è®¿é—® 12listeners=PLAINTEXT://0.0.0.0:9092advertised.listeners=PLAINTEXT://worker1:9092 # è¿™é‡Œæ˜¯å†…ç½‘ip å…è®¸å¤–ç½‘è®¿é—® 12listeners=PLAINTEXT://0.0.0.0:9092advertised.listeners=PLAINTEXT://161.189.227.200:9092 # è¿™é‡Œæ˜¯å¤–ç½‘ip å†…å¤–ç½‘éƒ½è¦è®¿é—®ï¼ˆæ¨èåŒé€šé“æ–¹å¼ï¼‰ 12345678# è¿™é‡Œ INTERNAL å’Œ EXTERNAL åˆ†åˆ«æ˜¯è‡ªå®šä¹‰çš„ç›‘å¬å™¨åç§°ï¼Œæ­¤æ—¶å†…ç½‘ç«¯å£ä¸º 9092ï¼Œå¤–ç½‘ç«¯å£ä¸º 9093listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9093# å‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç”¨å“ªä¸ªåœ°å€è¿æ¥advertised.listeners=INTERNAL://worker1:9092,EXTERNAL://161.189.227.200:9093# æ˜ å°„ç›‘å¬å™¨åç§°åˆ°é€šä¿¡å®‰å…¨åè®®çš„æ˜ å°„å…³ç³»listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT# é›†ç¾¤é—´é€šä¿¡ä»ä½¿ç”¨å†…ç½‘inter.broker.listener.name=INTERNAL å¼€å¯ SASL_PLAINTEXT è¿™é‡Œè®¾ç½®å¤–ç½‘è®¿é—®æ—¶å¼€å¯ SASL_PLAINTEXT 12345678910111213# ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9094# å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€advertised.listeners=INTERNAL://worker1:9092,EXTERNAL://161.189.227.200:9094listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_PLAINTEXT# é›†ç¾¤é—´é€šä¿¡ still use INTERNALinter.broker.listener.name=INTERNAL# è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256/512ï¼‰# client è¿æ¥æ—¶sasl.enabled.mechanisms=PLAIN# broker ä¹‹é—´è¿æ¥æ—¶ï¼Œå› ä¸º inter.broker.listener.name=INTERNALï¼Œæ‰€ä»¥ INTERNAL:SASL_PLAINTEXT æ‰æœ‰æ•ˆ#sasl.mechanism.inter.broker.protocol=PLAIN åˆ›å»º kafka_jaas.conf 1234567891011121314############################# Kafka Broker (æœåŠ¡ç«¯)############################KafkaServer &#123; org.apache.kafka.common.security.plain.PlainLoginModule required # Broker è‡ªå·±çš„èº«ä»½ï¼ˆç”¨äº broker ä¹‹é—´é€šä¿¡ï¼Œæœ¬ç¤ºä¾‹ä¸­æ²¡æœ‰ä½¿ç”¨ï¼‰ username=&quot;admin&quot; password=&quot;admin-secret&quot; # å®¢æˆ·ç«¯å¯ç”¨è´¦å·ï¼Œå³ user_xxxï¼Œè¿™é‡Œ xxx ä¸ºç”¨æˆ·åï¼Œ= å³è¾¹çš„ä¸ºå¯†ç  user_admin=&quot;admin-secret&quot; user_alice=&quot;alice-secret&quot; user_bob=&quot;bob-secret&quot;;&#125;; å¯åŠ¨ kafka 123# åœ¨å¯åŠ¨ Kafka Broker å‰ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡æŒ‡å‘ JAAS æ–‡ä»¶export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/path/to/kafka_jaas.conf&quot;kafka-server-start.sh config/server.properties å®¢æˆ·ç«¯è®¿é—® åˆ›å»º client.conf 123security.protocol=SASL_PLAINTEXTsasl.mechanism=PLAINsasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;admin&quot; password=&quot;admin-secret&quot;; å‘½ä»¤è¡Œè®¿é—® 12345678# åˆ›å»ºtopickafka-topics.sh --create --topic test-topic --bootstrap-server=161.189.227.200:9094 --command-config=client.conf# æŸ¥çœ‹topickafka-topics.sh --list --bootstrap-server=161.189.227.200:9094 --command-config=client.conf# åˆ›å»ºæ¶ˆè´¹è€…ï¼Œ--group æŒ‡å®šæ¶ˆè´¹è€…ç»„åç§°kafka-console-consumer.sh --bootstrap-server=161.189.227.200:9094 --topic test-topic --consumer.config=client.conf --group=test-group# åˆ›å»ºç”Ÿäº§è€…kafka-console-producer.sh --bootstrap-server=161.189.227.200:9094 --topic test-topic --producer.config=client.conf å¼€å¯ SASL_SSL è¿™é‡Œè®¾ç½®å¤–ç½‘è®¿é—®æ—¶å¼€å¯ SASL_SSL åˆ›å»ºè¯ä¹¦ å®˜æ–¹æ–‡æ¡£ ç”Ÿæˆ Broker keystoreï¼Œç”¨äº å­˜å‚¨ broker çš„ç§é’¥å’Œè¯ä¹¦ã€‚ 1234567891011121314keytool -keystore kafka.server.keystore.jks \\ -alias broker -validity 3650 \\ -genkey -keyalg RSA \\ -dname &quot;CN=broker, OU=Kafka, O=YourOrg, L=City, ST=State, C=CN&quot; \\ -storepass 123456 \\ -keypass 123456## å‚æ•°è¯´æ˜ï¼š# -keystoreï¼šç”Ÿæˆçš„ keystore æ–‡ä»¶è·¯å¾„# -alias brokerï¼šè¯ä¹¦åˆ«å# -validity 3650ï¼šæœ‰æ•ˆæœŸ 3650 å¤©# -keyalg RSAï¼šå¯†é’¥ç®—æ³•# -dnameï¼šè¯ä¹¦ä¿¡æ¯# -storepassï¼škeystore å¯†ç # -keypassï¼šå¯†é’¥å¯†ç  å¯¼å‡º Broker è¯ä¹¦ï¼ˆç”¨äºå®¢æˆ·ç«¯ truststoreï¼‰,ç”Ÿæˆ kafka.server.crtï¼Œå®¢æˆ·ç«¯ä¼šç”¨å®ƒæ¥éªŒè¯ brokerã€‚ 12345678keytool -keystore kafka.server.keystore.jks \\ -alias broker -export -file kafka.server.crt \\ -storepass 123456## å‚æ•°è¯´æ˜ï¼š# -keystoreï¼škeystore æ–‡ä»¶è·¯å¾„# -alias brokerï¼šè¯ä¹¦åˆ«å# -file kafka.server.crtï¼šå¯¼å‡ºçš„è¯ä¹¦æ–‡ä»¶è·¯å¾„# -storepassï¼škeystore å¯†ç  ç”Ÿæˆ Broker truststoreï¼Œtruststore ç”¨äº å­˜å‚¨ä¿¡ä»»çš„è¯ä¹¦ï¼ˆè¿™é‡ŒæŠŠè‡ªå·±ç”Ÿæˆçš„è¯ä¹¦å¯¼å…¥è¿›å»å³å¯ï¼‰,ç”Ÿæˆ kafka.truststore.jks 12345678910# æ³¨æ„ï¼šè¿™é‡Œ server ç«¯ å’Œ client ç«¯ å¯ä»¥å…±ç”¨ä¸€ä¸ª truststoreï¼Œä¹Ÿå¯ä»¥åˆ†åˆ«åˆ›å»ºkeytool -keystore kafka.truststore.jks \\ -alias broker -import -file kafka.server.crt \\ -storepass 123456 -noprompt# å‚æ•°è¯´æ˜ï¼š# -keystoreï¼šç”Ÿæˆçš„ truststore æ–‡ä»¶è·¯å¾„# -alias brokerï¼šè¯ä¹¦åˆ«å# -file kafka.server.crtï¼šå¯¼å…¥çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„# -storepassï¼štruststore å¯†ç # -nopromptï¼šä¸æç¤º server.properties é…ç½® SASL_SSL 1234567891011121314151617181920212223# ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9095# å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€advertised.listeners=INTERNAL://worker2:9092,EXTERNAL://161.189.227.200:9095listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_SSLinter.broker.listener.name=INTERNAL# SASL# è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256/512ï¼‰# client è¿æ¥æ—¶sasl.enabled.mechanisms=PLAIN# broker ä¹‹é—´è¿æ¥æ—¶ï¼Œéœ€è¦ inter.broker.listener.name=SASL_PLAINTEXT æ‰æœ‰æ•ˆ#sasl.mechanism.inter.broker.protocol=PLAIN# SSLssl.keystore.location=/usr/local/kafka/kafka3/config/ssl/kafka.server.keystore.jksssl.keystore.password=123456ssl.key.password=123456ssl.truststore.location=/usr/local/kafka/kafka3/config/ssl/kafka.truststore.jksssl.truststore.password=123456# å¦‚æœä¸è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¯ä»¥è®¾ç½® none ï¼Œè¦æ±‚åˆ™è®¾ç½®ä¸º requiredssl.client.auth=none å¯åŠ¨ kafka å‰åŒæ ·éœ€è¦å…ˆåˆ›å»ºå¥½ kafka_jaas.confï¼Œä¸ SASL_PLAINTEXT ä¸€æ ·ã€‚ å®¢æˆ·ç«¯è®¿é—® å°† kafka.truststore.jks æ‹·è´åˆ°å®¢æˆ·ç«¯ ä¸ SASL_PLAINTEXT ä¸€æ ·ï¼Œåˆ›å»º client.confï¼Œå¹¶æ·»åŠ å¦‚ä¸‹ä¿¡æ¯ 123456789security.protocol=SASL_SSLsasl.mechanism=PLAINsasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;admin&quot; password=&quot;admin-secret&quot;;# SSL é…ç½®ssl.truststore.location=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/kafka.truststore.jksssl.truststore.password=123456# ç¦ç”¨ä¸»æœºåéªŒè¯ï¼Œå¦åˆ™ä¼šæ ¡éªŒè¯ä¹¦çš„ SANï¼Œè¯ä¹¦åŸŸåæ ¡éªŒå¼€å…³ï¼Œä¸ºç©ºåˆ™è¡¨ç¤ºå…³é—­ï¼Œè¿™é‡Œéœ€è¦ä¿æŒå…³é—­çŠ¶æ€ï¼Œå¿…é¡»è®¾ç½®ä¸ºç©ºssl.endpoint.identification.algorithm= å‘½ä»¤è¡Œè®¿é—® ä¸ SASL_PLAINTEXT ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿° å…³äº Kafka JKSæ ¼å¼çš„SSLè¯ä¹¦çš„åˆ›å»ºåŠé…ç½®å¯ä»¥å‚è€ƒåˆ¶ä½œå’Œæ›¿æ¢Kafka JKSæ ¼å¼çš„SSLè¯ä¹¦ PEM è¯ä¹¦ Kafka çš„ è¯ä¹¦ é»˜è®¤ä½¿ç”¨ JKS æ ¼å¼ï¼Œä½†ä» 2.7.0 å¼€å§‹æ”¯æŒ PEM æ ¼å¼ 123456789101112131415161718192021222324# ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œè¿™é‡Œå†…ç½‘å’Œå¤–ç½‘åˆ†å¼€é…ç½®listeners=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9095# å®¢æˆ·ç«¯å»ºç«‹è¿æ¥åå®é™…è¿”å›ç»™å®¢æˆ·ç«¯çš„åœ°å€advertised.listeners=INTERNAL://worker2:9092,EXTERNAL://161.189.227.200:9095listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:SASL_SSLinter.broker.listener.name=INTERNAL# SASL# è®¤è¯æœºåˆ¶ï¼ˆå¸¸è§ä¸º PLAINï¼Œä¹Ÿå¯ä»¥æ˜¯ SCRAM-SHA-256/512ï¼‰# client è¿æ¥æ—¶sasl.enabled.mechanisms=PLAIN# broker ä¹‹é—´è¿æ¥æ—¶ï¼Œéœ€è¦ inter.broker.listener.name=SASL_PLAINTEXT æ‰æœ‰æ•ˆ#sasl.mechanism.inter.broker.protocol=PLAIN# SSL-PEMssl.keystore.type=PEM # æŒ‡å®šè¯ä¹¦ç±»å‹æ˜¯PEMï¼Œæ”¯æŒçš„ç±»å‹ PEMã€JKSssl.keystore.location=/usr/local/kafka/kafka3/config/ssl/fullchain.pem # åŒ…å«ç§é’¥å’Œå…¬é’¥# æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨çš„è¯ä¹¦ç±»å‹æ˜¯PEMssl.truststore.type=PEMssl.truststore.location=/usr/local/kafka/kafka3/config/ssl/server.crt # å…¬é’¥# å¦‚æœä¸è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¯ä»¥è®¾ç½® none ï¼Œè¦æ±‚åˆ™è®¾ç½®ä¸º requiredssl.client.auth=none client.conf é…ç½®å¦‚ä¸‹ï¼š 12345678910security.protocol=SASL_SSLsasl.mechanism=PLAINsasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username=&quot;admin&quot; password=&quot;admin-secret&quot;;# SSL é…ç½®ï¼Œå°† server ç«¯çš„ server.crt æ‹·è´åˆ° client ç«¯ssl.truststore.location=/Users/hanqf/develop_soft/kafka/kafka3/config/ssl/server.crtssl.truststore.type=PEM# ç¦ç”¨ä¸»æœºåéªŒè¯ssl.endpoint.identification.algorithm= jks è¯ä¹¦è½¬æ¢ä¸º pem æ ¼å¼ ä» JKS å¯¼å‡ºä¸º PKCS#12 (.p12) 1234567891011121314keytool -importkeystore \\ -srckeystore kafka.server.keystore.jks \\ -srcstoretype JKS \\ -destkeystore kafka.server.p12 \\ -deststoretype PKCS12 \\ -srcstorepass 123456 \\ -deststorepass 123456 \\ -J&quot;-Djdk.tls.disabledAlgorithms=&quot; \\ -J&quot;-Dkeystore.pkcs12.legacy=false&quot;## è¯´æ˜ï¼š # -srcstoretype JKSï¼šåŸå§‹æ ¼å¼ï¼› # -deststoretype PKCS12ï¼šè½¬æ¢ä¸ºé€šç”¨æ ¼å¼ï¼› # .p12 æ˜¯ PEM çš„â€œä¸­é—´æ ¼å¼â€ã€‚ å¯¼å‡ºè¯ä¹¦[å…¬é’¥] (.crtï¼Œè¿™é‡Œæ˜¯ PEM æ ¼å¼) 12345678openssl pkcs12 -in kafka.server.p12 -clcerts -nokeys -out server.crt -password pass:123456 -provider legacy -provider default## è¯´æ˜ï¼š# -clcertsï¼šåªå¯¼å‡ºè¯ä¹¦ï¼›# -nokeysï¼šä¸å¯¼å‡ºå¯†é’¥ï¼›# -out server.crtï¼šå¯¼å‡ºæ–‡ä»¶åï¼›# -passwordï¼škafka.server.p12çš„å¯†é’¥å¯†ç ï¼Œæ³¨æ„å¯†ç å‰é¢åŠ ä¸Š pass:# -provider legacyï¼šå¯ç”¨æ—§ç®—æ³•æ”¯æŒæ¨¡å—ï¼Œåœ¨ OpenSSL 3.0ï¼ˆåŠæ›´é«˜ç‰ˆæœ¬ï¼‰ä¸­ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°æœºåˆ¶ â€”â€” Providerï¼ˆç®—æ³•æä¾›è€…ï¼‰,é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenSSL åªåŠ è½½ modern providerï¼ˆdefault providerï¼‰ï¼Œè€Œè®¸å¤šè€æ—§ç®—æ³•ï¼ˆä¾‹å¦‚ RC2ã€MD5ã€DESã€SHA1ï¼‰è¢«ç§»åˆ°äº†ä¸€ä¸ªå•ç‹¬çš„ legacy provider æ¨¡å—ä¸­ã€‚# -provider defaultï¼šåŒæ—¶å¯ç”¨é»˜è®¤ providerï¼Œå› ä¸ºæœ‰äº›å‘½ä»¤ï¼ˆæ¯”å¦‚æ¶‰åŠç°ä»£åŠ å¯†ç®—æ³•æˆ–è¯ä¹¦ç­¾åï¼‰è¿˜ä¾èµ–é»˜è®¤ providerï¼Œæ‰€ä»¥ä¸¤è€…ä¸€èµ·ä½¿ç”¨æœ€å®‰å…¨ã€æœ€å…¼å®¹ å¯¼å‡ºç§é’¥ (.keyï¼Œè¿™é‡Œæ˜¯ PEM æ ¼å¼) 123456openssl pkcs12 -in kafka.server.p12 -nocerts -out server.key -nodes -password pass:123456 -provider legacy -provider default## è¯´æ˜ï¼š# -nocertsï¼šåªå¯¼å‡ºå¯†é’¥ï¼›# -out server.keyï¼šå¯¼å‡ºæ–‡ä»¶åï¼›# -nodesï¼šä¸åŠ å¯†å¯¼å‡ºçš„å¯†é’¥æ–‡ä»¶# -passwordï¼škafka.server.p12çš„å¯†é’¥å¯†ç ï¼Œæ³¨æ„å¯†ç å‰é¢åŠ ä¸Š pass: fullchain.pem 1openssl pkcs12 -in kafka.server.p12 -out fullchain.pem -nodes -password pass:123456 -provider legacy -provider default","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Kafka çš„ é€šä¿¡åè®®ï¼Œä»¥åŠå¦‚ä½•å¼€å¯å¤–ç½‘è®¿é—®ã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚","date_published":"2025-10-13T14:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/10/13/kafka-01-install-zookeeper/","url":"https://blog.hanqunfeng.com/2025/10/13/kafka-01-install-zookeeper/","title":"Kafka çš„å®‰è£…ï¼šåŸºäº Zookeeper","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº Zookeeperã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kafka.apache.org\">Kafkaå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Kafka-ç®€ä»‹\">Kafka ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Apache Kafka æ˜¯ä¸€ä¸ª <code>åˆ†å¸ƒå¼çš„æµå¤„ç†/äº‹ä»¶æµå¹³å°</code>ï¼Œæ—¢å¯ä»¥ä½œä¸º<code>æ¶ˆæ¯ç³»ç»Ÿ</code>ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæŒä¹…åŒ–çš„ <code>æ—¥å¿—/è®°å½•å­˜å‚¨ä¸æµå¤„ç†å¹³å°</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯é«˜ååã€ä½å»¶è¿Ÿã€å¯æ°´å¹³æ‰©å±•ã€å®¹é”™ï¼Œä»¥åŠå¯æŒä¹…åŒ–æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ Kafka ä¸­ï¼Œæ¶ˆæ¯è¢«å½’ç±»ä¸º <code>ä¸»é¢˜ï¼ˆTopicï¼‰</code>ï¼Œæ¯ä¸ªä¸»é¢˜å¯ä»¥æ ¹æ®é…ç½®è¢«æ‹†åˆ†ä¸ºå¤šä¸ª <code>åˆ†åŒºï¼ˆPartitionï¼‰</code>ï¼Œæ¯ä¸ªåˆ†åŒºå†…éƒ¨æ¶ˆæ¯æ˜¯<code>ä¸¥æ ¼æœ‰åº</code>çš„ï¼Œå¹¶ä»¥<code>è¿½åŠ </code>æ–¹å¼å†™å…¥ã€‚æ¶ˆè´¹è€…å¯ä»¥æŒ‰<code>åç§»é‡ï¼ˆoffsetï¼‰</code>è¯»å–æ¶ˆæ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kafka æä¾›å¤šä¸ª APIï¼šProducerã€Consumerã€Streamsï¼ˆæµå¤„ç†ï¼‰ã€Connectï¼ˆä¸å¤–éƒ¨ç³»ç»Ÿæ•´åˆï¼‰ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kafka çš„æ ¸å¿ƒæ¶æ„è¦ç´ ä¸å·¥ä½œæœºåˆ¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç»„ä»¶ / æ¦‚å¿µ</th>\n<th>ä½œç”¨ / æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Brokerï¼ˆèŠ‚ç‚¹ / æœåŠ¡å™¨ï¼‰</td>\n<td>Kafka é›†ç¾¤ä¸­çš„æœåŠ¡å™¨å®ä¾‹ï¼Œè´Ÿè´£æ¥æ”¶ã€å­˜å‚¨ã€åˆ†å‘æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td>Topic</td>\n<td>æ¶ˆæ¯çš„â€œåˆ†ç±»â€é€»è¾‘å•å…ƒï¼ŒProducer å†™å…¥ã€Consumer è¯»å–</td>\n</tr>\n<tr>\n<td>Partition</td>\n<td>ä¸€ä¸ª Topic è¢«åˆ’åˆ†çš„å­å•å…ƒã€‚åˆ†åŒºä½¿å¾—ä¸»é¢˜å¯ä»¥æ¨ªå‘æ‰©å±•ï¼Œå¹¶æ”¯æŒå¹¶è¡Œè¯»å†™</td>\n</tr>\n<tr>\n<td>Offset</td>\n<td>æ¯æ¡æ¶ˆæ¯åœ¨æŸä¸ªåˆ†åŒºä¸­çš„å”¯ä¸€ä½ç½®æ ‡è¯†ï¼Œæ¶ˆè´¹è€…æ ¹æ® offset æ¥å†³å®šä¸‹ä¸€æ¡è¯»å–</td>\n</tr>\n<tr>\n<td>Replicationï¼ˆå‰¯æœ¬ï¼‰</td>\n<td>ä¸ºäº†å®¹é”™æ€§ï¼Œæ¯ä¸ªåˆ†åŒºå¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆå‰¯æœ¬åˆ†å¸ƒåœ¨ä¸åŒ Broker ä¸Šï¼‰</td>\n</tr>\n<tr>\n<td>Leader / Follower</td>\n<td>åœ¨å‰¯æœ¬ä¸­ï¼Œä¸€ä¸ªå‰¯æœ¬ä¸º Leaderï¼Œæ¥å—è¯»å†™è¯·æ±‚ï¼›å…¶ä»–ä¸º Followerï¼Œä» Leader åŒæ­¥æ•°æ®</td>\n</tr>\n<tr>\n<td>Consumer Group</td>\n<td>ä¸€ç»„æ¶ˆè´¹è€…å…±åŒæ¶ˆè´¹ä¸€ä¸ª Topicã€‚æ¯ä¸ªåˆ†åŒºåœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­é€šå¸¸åªè¢«ä¸€ä¸ªæ¶ˆè´¹è€… â€œæ‹¥æœ‰â€</td>\n</tr>\n<tr>\n<td>ZooKeeper / KRaft</td>\n<td>ç”¨äºå…ƒæ•°æ®ç®¡ç†ã€é›†ç¾¤åè°ƒï¼ˆåœ¨è¾ƒè€ç‰ˆæœ¬ä¸­æ˜¯ ZooKeeperï¼›æ–°ç‰ˆæœ¬æ¨å‘ KRaftï¼‰</td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/Xe43JY.png\" alt=\"\" width=\"900\" height=\"600\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¶ˆæ¯å†™å…¥æµç¨‹ï¼ˆç®€åŒ–ï¼‰ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Producer å°†æ¶ˆæ¯å‘é€ç»™æŸä¸ª Topic çš„ Leader åˆ†åŒºèŠ‚ç‚¹</li>\n<li class=\"lvl-4\">Leader æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†å…¶è¿½åŠ å†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œå¹¶è¿”å›ç¡®è®¤ï¼ˆACKï¼‰</li>\n<li class=\"lvl-4\">Follower å‰¯æœ¬ä» Leader æ‹‰å–æ•°æ®è¿›è¡ŒåŒæ­¥</li>\n<li class=\"lvl-4\">æ¶ˆè´¹è€…æ ¹æ®è‡ªå·±çš„ offset ä»å¯¹åº” Partition ä¸­è¯»å–æ¶ˆæ¯</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ¶ˆè´¹æ§åˆ¶ä¸å®¹é”™ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ¶ˆè´¹è€…ç»´æŠ¤è‡ªå·±çš„ offsetï¼ˆå¯ä»¥è‡ªåŠ¨æäº¤ï¼Œä¹Ÿå¯æ‰‹åŠ¨æ§åˆ¶ï¼‰ï¼Œè¿™æ ·å³ä½¿æ¶ˆè´¹è€…é‡å¯ï¼Œä¹Ÿå¯ä»¥ä»ä¸Šæ¬¡åœæ­¢çš„ä½ç½®ç»§ç»­ã€‚</li>\n<li class=\"lvl-4\">å¦‚æœæŸä¸ª Broker å®•æœºï¼Œå‰¯æœ¬å¯ä»¥åˆ‡æ¢ï¼ˆLeader é€‰ä¸¾ï¼‰ï¼Œä¿è¯æœåŠ¡ç»§ç»­ã€‚</li>\n<li class=\"lvl-4\">åˆ†åŒºä¸å‰¯æœ¬æœºåˆ¶ä½¿å¾— Kafka èƒ½å¤Ÿæ‰©å±•å®¹é‡ &amp; æé«˜å¯é æ€§ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Kafka çš„å…¸å‹ä½¿ç”¨åœºæ™¯</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯ç±»åˆ«</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å®æ—¶æ•°æ®ç®¡é“ / æ•°æ®é›†æˆ</strong></td>\n<td>ç”¨äºå°†å„ç§æ•°æ®æºï¼ˆå¦‚æ—¥å¿—ã€æ•°æ®åº“å˜æ›´ã€ä¼ æ„Ÿå™¨ã€ç”¨æˆ·äº‹ä»¶ç­‰ï¼‰å®æ—¶é‡‡é›†ã€ä¼ è¾“ã€åˆ†å‘åˆ°ä¸‹æ¸¸ç³»ç»Ÿï¼ˆå¦‚ OLAPã€æœç´¢å¼•æ“ã€ç›‘æ§å¹³å°ç­‰ï¼‰ï¼Œæ„å»ºé«˜æ•ˆçš„æ•°æ®é€šé“ã€‚</td>\n</tr>\n<tr>\n<td><strong>äº‹ä»¶é©±åŠ¨ / äº‹ä»¶æº¯æº</strong></td>\n<td>è®°å½•ç³»ç»Ÿå†…éƒ¨æˆ–è·¨ç³»ç»Ÿçš„äº‹ä»¶ï¼ˆçŠ¶æ€å˜åŒ–ï¼‰ï¼Œå®ç°äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰æˆ–äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰ï¼Œå¯ç”¨äºå®¡è®¡ã€å›æ”¾ã€çŠ¶æ€é‡å»ºç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>æ—¥å¿—èšåˆ / åˆ†æ</strong></td>\n<td>å°†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨æ—¥å¿—ã€ç›‘æ§æŒ‡æ ‡ã€æ“ä½œæ—¥å¿—ç­‰ç»Ÿä¸€æ”¶é›†åˆ° Kafka ä¸­ï¼Œé›†ä¸­å­˜å‚¨ä¸åˆ†æï¼Œå¸¸ä¸ ELKã€ClickHouse ç­‰ç»“åˆã€‚</td>\n</tr>\n<tr>\n<td><strong>æµå¤„ç†</strong></td>\n<td>ä¸ Kafka Streamsã€Apache Flinkã€Spark Streaming ç­‰æµå¤„ç†æ¡†æ¶é…åˆï¼Œå¯¹æµç» Kafka çš„æ•°æ®è¿›è¡Œå®æ—¶è®¡ç®—ã€èšåˆã€è¿‡æ»¤ã€çª—å£ç»Ÿè®¡ç­‰æ“ä½œã€‚</td>\n</tr>\n<tr>\n<td><strong>ç³»ç»Ÿè§£è€¦ / å¼‚æ­¥é€šä¿¡</strong></td>\n<td>ä½œä¸ºç³»ç»Ÿé—´çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œå‡å°‘ç³»ç»Ÿé—´è€¦åˆï¼Œæ”¯æŒå¼‚æ­¥é€šä¿¡ã€æµé‡å‰Šå³°ã€ç¼“å†²ç­‰ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ä¸æ‰©å±•æ€§ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Kafka-å®‰è£…\">Kafka å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œå…ˆä»‹ç»åŸºäº Zookeeper çš„å®‰è£…æ–¹å¼ï¼Œä¸‹æ–‡ä¼šä»‹ç»åŸºäº KRaft çš„å®‰è£…æ–¹å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Kafka 3.9.1 çš„å®‰è£…ä¸è¿è¡Œéœ€è¦ JDK 8+ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦æå‰å®‰è£… JDK 8+ã€‚å¯ä»¥é€‰æ‹©OpenJDKï¼Œ<a href=\"https://mirrors.tuna.tsinghua.edu.cn/Adoptium/\">æ¸…åå¤§å­¦é•œåƒç«™</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># root ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/jdk</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/jdk</span><br><span class=\"line\"><span class=\"comment\"># ä¸‹è½½JDK</span></span><br><span class=\"line\">wget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/8/jdk/x64/linux/OpenJDK8U-jdk_x64_linux_hotspot_8u462b08.tar.gz</span><br><span class=\"line\">tar -zxvf OpenJDK8U-jdk_x64_linux_hotspot_8u462b08.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s jdk8u462-b08 jdk8</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export JAVA_HOME=/usr/local/jdk/jdk8&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œæ˜¯ å•å¼•å·ï¼ŒåŒå¼•å·ä¼šè§£æå˜é‡ï¼Œå¯¼è‡´é…ç½®å¤±è´¥</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export PATH=$JAVA_HOME/bin:$PATH&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥JDKå®‰è£…</span></span><br><span class=\"line\">java -version</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…è¿‡ç¨‹å‚è€ƒå®˜ç½‘æ–‡æ¡£<a href=\"https://kafka.apache.org/39/documentation.html#quickstart\">Kafka Quick Start</a>ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å•æœºå®‰è£…\">å•æœºå®‰è£…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éƒ¨ç½²kafkaéƒ½ä¼šä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼Œå•æœºæ¨¡å¼åªä½œä¸ºå­¦ä¹ è¯•ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹è½½Kafkaï¼Œ<a href=\"https://kafka.apache.org/downloads\">ä¸‹è½½é¡µé¢</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># root ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå®‰è£…ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /usr/local/kafka</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/kafka</span><br><span class=\"line\"><span class=\"comment\"># ä¸‹è½½Kafka</span></span><br><span class=\"line\">wget https://dlcdn.apache.org/kafka/3.9.1/kafka_2.13-3.9.1.tgz</span><br><span class=\"line\">tar -zxvf kafka_2.13-3.9.1.tgz</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s kafka_2.13-3.9.1 kafka3</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export KAFKA_HOME=/usr/local/kafka/kafka3&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export PATH=$KAFKA_HOME/bin:$PATH&#x27;</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹Kafkaç‰ˆæœ¬</span></span><br><span class=\"line\">kafka-topics.sh --version</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ Zookeeperï¼Œkafkaå†…ç½®äº†zookeeperï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬å®‰è£…ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å‰å°è¿è¡Œ</span></span><br><span class=\"line\">zookeeper-server-start.sh /usr/local/kafka/kafka3/config/zookeeper.properties</span><br><span class=\"line\"><span class=\"comment\"># åå°è¿è¡Œ</span></span><br><span class=\"line\"><span class=\"built_in\">nohup</span> zookeeper-server-start.sh /usr/local/kafka/kafka3/config/zookeeper.properties &gt; zookeeper.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ kafka</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -daemon åå°è¿è¡Œ</span></span><br><span class=\"line\">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ£€æŸ¥kafkaæ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class=\"line\">jps -l | grep kafka</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ å¯åŠ¨ kafka éœ€è¦çš„å†…å­˜å¤§å°ä¸º 1Gï¼Œè¿™ä¸€ç‚¹å¯ä»¥åœ¨ <a href=\"http://kafka-server-start.sh\">kafka-server-start.sh</a> è„šæœ¬ä¸­æŸ¥çœ‹åˆ°</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;x<span class=\"variable\">$KAFKA_HEAP_OPTS</span>&quot;</span> = <span class=\"string\">&quot;x&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">export</span> KAFKA_HEAP_OPTS=<span class=\"string\">&quot;-Xmx1G -Xms1G&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">æ‰€ä»¥å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡åå†å¯åŠ¨kafka</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> KAFKA_HEAP_OPTS=<span class=\"string\">&quot;-Xmx512M -Xms512M&quot;</span></span><br><span class=\"line\">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º topic</span></span><br><span class=\"line\">kafka-topics.sh --create --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨æ¶ˆè´¹è€…</span></span><br><span class=\"line\">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span> --from-beginning</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ç”Ÿäº§è€…</span></span><br><span class=\"line\">kafka-console-producer.sh --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span></span><br><span class=\"line\">&gt; hello world <span class=\"comment\"># è¾“å…¥å†…å®¹ï¼Œæ¶ˆè´¹è€…ä¼šæ”¶åˆ°</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤å®‰è£…\">é›†ç¾¤å®‰è£…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤å®‰è£…éœ€è¦å‡†å¤‡å¤šä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘å‡†å¤‡ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.250.0.7</span><br><span class=\"line\">10.250.0.174</span><br><span class=\"line\">10.250.0.108</span><br></pre></td></tr></table></figure>\n<h4 id=\"æ­å»º-Zookeeper-é›†ç¾¤\">æ­å»º Zookeeper é›†ç¾¤</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…³äºå¦‚ä½•æ­å»º Zookeeper é›†ç¾¤ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  <a href=\"/2025/09/15/zookeeper-study/\" title=\"Zookeeper çš„å®‰è£…åŠä½¿ç”¨\">Zookeeper çš„å®‰è£…åŠä½¿ç”¨</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœå›¾çœäº‹ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Kafka è‡ªå¸¦çš„ zookeeperï¼Œç¼–è¾‘å…¶é…ç½®æ–‡ä»¶ <code>config/zookeeper.properties</code>å¦‚ä¸‹ï¼Œæ³¨æ„è¦åœ¨ <code>dataDir</code> ç›®å½•ä¸‹åˆ›å»º<code>myid</code>æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataDir=/usr/local/kafka/dataDir/zookeeper</span><br><span class=\"line\"><span class=\"comment\"># the port at which the clients will connect</span></span><br><span class=\"line\">clientPort=2181</span><br><span class=\"line\"><span class=\"comment\"># disable the per-ip limit on the number of connections since this is a non-production config</span></span><br><span class=\"line\">maxClientCnxns=0</span><br><span class=\"line\"><span class=\"comment\"># Disable the adminserver by default to avoid port conflicts.</span></span><br><span class=\"line\"><span class=\"comment\"># Set the port to something non-conflicting if choosing to enable this</span></span><br><span class=\"line\">admin.enableServer=<span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># admin.serverPort=8080</span></span><br><span class=\"line\"></span><br><span class=\"line\">initLimit=10</span><br><span class=\"line\">syncLimit=5</span><br><span class=\"line\"></span><br><span class=\"line\">server.1=10.250.0.7:2888:3888</span><br><span class=\"line\">server.2=10.250.0.174:2888:3888</span><br><span class=\"line\">server.3=10.250.0.108:2888:3888</span><br></pre></td></tr></table></figure>\n<h4 id=\"é…ç½®-Kafka-é›†ç¾¤\">é…ç½® Kafka é›†ç¾¤</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹ä¸»æœºçš„ä¸»æœºå</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hostnamectl hostname worker1</span><br><span class=\"line\"><span class=\"comment\"># hostnamectl hostname worker2</span></span><br><span class=\"line\"><span class=\"comment\"># hostnamectl hostname worker3</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸ºäº†åç»­æ–¹ä¾¿ç»´æŠ¤ï¼Œå°†ipåœ°å€æ˜ å°„åˆ° hosts æ–‡ä»¶ä¸­</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.250.0.7 worker1</span><br><span class=\"line\">10.250.0.174 worker2</span><br><span class=\"line\">10.250.0.108 worker3</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¾‘ <code>config/server.properties</code> æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹å¦‚ä¸‹é…ç½®é¡¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#broker çš„å…¨å±€å”¯â¼€ç¼–å·ï¼Œä¸èƒ½é‡å¤ï¼Œåªèƒ½æ˜¯æ•°å­—ã€‚</span></span><br><span class=\"line\">broker.id=1 <span class=\"comment\"># è¿™é‡Œåˆ†åˆ«è®¾ç½®ä¸º1ã€2ã€3</span></span><br><span class=\"line\"><span class=\"comment\">#æœåŠ¡ç›‘å¬åœ°å€</span></span><br><span class=\"line\">listeners=PLAINTEXT://worker1:9092</span><br><span class=\"line\"><span class=\"comment\">#æ•°æ®â½‚ä»¶åœ°å€ã€‚åŒæ ·é»˜è®¤æ˜¯ç»™çš„/tmpâ½¬å½•ã€‚</span></span><br><span class=\"line\">log.dirs=/usr/local/kafka/dataDir/kafka-logs</span><br><span class=\"line\"><span class=\"comment\">#é»˜è®¤çš„æ¯ä¸ªTopicçš„åˆ†åŒºæ•°ï¼Œåˆ›å»ºTopicæ—¶ï¼Œå¦‚æœæœªæŒ‡å®šåˆ†åŒºæ•°ï¼Œåˆ™é»˜è®¤ä¸º1ä¸ªåˆ†åŒºã€‚</span></span><br><span class=\"line\">num.partitions=1</span><br><span class=\"line\"><span class=\"comment\"># æ¯ä¸ªâ½‡å¿—â½‚ä»¶åˆ é™¤ä¹‹å‰ä¿å­˜çš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯168å°æ—¶ï¼Œå³7å¤©ã€‚</span></span><br><span class=\"line\">log.retention.hours=168</span><br><span class=\"line\"><span class=\"comment\">#zookeeperçš„æœåŠ¡åœ°å€ï¼Œå¦‚æœæ˜¯è‡ªå»ºçš„ Zookeeper é›†ç¾¤ï¼Œåˆ™è¿™é‡Œéœ€è¦å¡«å†™é›†ç¾¤çš„è¿æ¥åœ°å€</span></span><br><span class=\"line\">zookeeper.connect=worker1:2181,worker2:2181,worker3:2181</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨ Kafka</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º topic</span></span><br><span class=\"line\">kafka-topics.sh --bootstrap-server worker1:9092 --create --replication-factor 3 --partitions 3 --topic disTopic</span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># --replication-factor 3 è¡¨ç¤ºåˆ›å»ºçš„å‰¯æœ¬æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># --partitions 3 è¡¨ç¤ºåˆ›å»ºçš„åˆ†åŒºæ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ topic è¯¦æƒ…</span></span><br><span class=\"line\">kafka-topics.sh --bootstrap-server worker1:9092 --describe --topic disTopic</span><br><span class=\"line\">Topic: disTopic\tTopicId: VUK7Mc9oQdS1mjGG7OhQzQ\tPartitionCount: 3\tReplicationFactor: Configs:</span><br><span class=\"line\">\tTopic: disTopic\tPartition: 0\tLeader: 2\tReplicas: 2,3,1\tIsr: 2,3,1\tElr: N/A\tLastKnownElr: N/A</span><br><span class=\"line\">\tTopic: disTopic\tPartition: 1\tLeader: 3\tReplicas: 3,1,2\tIsr: 3,1,2\tElr: N/A\tLastKnownElr: N/A</span><br><span class=\"line\">\tTopic: disTopic\tPartition: 2\tLeader: 1\tReplicas: 1,2,3\tIsr: 1,2,3\tElr: N/A\tLastKnownElr: N/A</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº Zookeeperã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚ Kafka ç®€ä»‹ Apache Kafka æ˜¯ä¸€ä¸ª åˆ†å¸ƒå¼çš„æµå¤„ç†/äº‹ä»¶æµå¹³å°ï¼Œæ—¢å¯ä»¥ä½œä¸ºæ¶ˆæ¯ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæŒä¹…åŒ–çš„ æ—¥å¿—/è®°å½•å­˜å‚¨ä¸æµå¤„ç†å¹³å°ã€‚ å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯é«˜ååã€ä½å»¶è¿Ÿã€å¯æ°´å¹³æ‰©å±•ã€å®¹é”™ï¼Œä»¥åŠå¯æŒä¹…åŒ–æ•°æ®ã€‚ åœ¨ Kafka ä¸­ï¼Œæ¶ˆæ¯è¢«å½’ç±»ä¸º ä¸»é¢˜ï¼ˆTopicï¼‰ï¼Œæ¯ä¸ªä¸»é¢˜å¯ä»¥æ ¹æ®é…ç½®è¢«æ‹†åˆ†ä¸ºå¤šä¸ª åˆ†åŒºï¼ˆPartitionï¼‰ï¼Œæ¯ä¸ªåˆ†åŒºå†…éƒ¨æ¶ˆæ¯æ˜¯ä¸¥æ ¼æœ‰åºçš„ï¼Œå¹¶ä»¥è¿½åŠ æ–¹å¼å†™å…¥ã€‚æ¶ˆè´¹è€…å¯ä»¥æŒ‰åç§»é‡ï¼ˆoffsetï¼‰è¯»å–æ¶ˆæ¯ã€‚ Kafka æä¾›å¤šä¸ª APIï¼šProducerã€Consumerã€Streamsï¼ˆæµå¤„ç†ï¼‰ã€Connectï¼ˆä¸å¤–éƒ¨ç³»ç»Ÿæ•´åˆï¼‰ç­‰ã€‚ Kafka çš„æ ¸å¿ƒæ¶æ„è¦ç´ ä¸å·¥ä½œæœºåˆ¶ ç»„ä»¶ / æ¦‚å¿µ ä½œç”¨ / æè¿° Brokerï¼ˆèŠ‚ç‚¹ / æœåŠ¡å™¨ï¼‰ Kafka é›†ç¾¤ä¸­çš„æœåŠ¡å™¨å®ä¾‹ï¼Œè´Ÿè´£æ¥æ”¶ã€å­˜å‚¨ã€åˆ†å‘æ¶ˆæ¯ Topic æ¶ˆæ¯çš„â€œåˆ†ç±»â€é€»è¾‘å•å…ƒï¼ŒProducer å†™å…¥ã€Consumer è¯»å– Partition ä¸€ä¸ª Topic è¢«åˆ’åˆ†çš„å­å•å…ƒã€‚åˆ†åŒºä½¿å¾—ä¸»é¢˜å¯ä»¥æ¨ªå‘æ‰©å±•ï¼Œå¹¶æ”¯æŒå¹¶è¡Œè¯»å†™ Offset æ¯æ¡æ¶ˆæ¯åœ¨æŸä¸ªåˆ†åŒºä¸­çš„å”¯ä¸€ä½ç½®æ ‡è¯†ï¼Œæ¶ˆè´¹è€…æ ¹æ® offset æ¥å†³å®šä¸‹ä¸€æ¡è¯»å– Replicationï¼ˆå‰¯æœ¬ï¼‰ ä¸ºäº†å®¹é”™æ€§ï¼Œæ¯ä¸ªåˆ†åŒºå¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆå‰¯æœ¬åˆ†å¸ƒåœ¨ä¸åŒ Broker ä¸Šï¼‰ Leader / Follower åœ¨å‰¯æœ¬ä¸­ï¼Œä¸€ä¸ªå‰¯æœ¬ä¸º Leaderï¼Œæ¥å—è¯»å†™è¯·æ±‚ï¼›å…¶ä»–ä¸º Followerï¼Œä» Leader åŒæ­¥æ•°æ® Consumer Group ä¸€ç»„æ¶ˆè´¹è€…å…±åŒæ¶ˆè´¹ä¸€ä¸ª Topicã€‚æ¯ä¸ªåˆ†åŒºåœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­é€šå¸¸åªè¢«ä¸€ä¸ªæ¶ˆè´¹è€… â€œæ‹¥æœ‰â€ ZooKeeper / KRaft ç”¨äºå…ƒæ•°æ®ç®¡ç†ã€é›†ç¾¤åè°ƒï¼ˆåœ¨è¾ƒè€ç‰ˆæœ¬ä¸­æ˜¯ ZooKeeperï¼›æ–°ç‰ˆæœ¬æ¨å‘ KRaftï¼‰ æ¶ˆæ¯å†™å…¥æµç¨‹ï¼ˆç®€åŒ–ï¼‰ï¼š Producer å°†æ¶ˆæ¯å‘é€ç»™æŸä¸ª Topic çš„ Leader åˆ†åŒºèŠ‚ç‚¹ Leader æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†å…¶è¿½åŠ å†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œå¹¶è¿”å›ç¡®è®¤ï¼ˆACKï¼‰ Follower å‰¯æœ¬ä» Leader æ‹‰å–æ•°æ®è¿›è¡ŒåŒæ­¥ æ¶ˆè´¹è€…æ ¹æ®è‡ªå·±çš„ offset ä»å¯¹åº” Partition ä¸­è¯»å–æ¶ˆæ¯ æ¶ˆè´¹æ§åˆ¶ä¸å®¹é”™ï¼š æ¶ˆè´¹è€…ç»´æŠ¤è‡ªå·±çš„ offsetï¼ˆå¯ä»¥è‡ªåŠ¨æäº¤ï¼Œä¹Ÿå¯æ‰‹åŠ¨æ§åˆ¶ï¼‰ï¼Œè¿™æ ·å³ä½¿æ¶ˆè´¹è€…é‡å¯ï¼Œä¹Ÿå¯ä»¥ä»ä¸Šæ¬¡åœæ­¢çš„ä½ç½®ç»§ç»­ã€‚ å¦‚æœæŸä¸ª Broker å®•æœºï¼Œå‰¯æœ¬å¯ä»¥åˆ‡æ¢ï¼ˆLeader é€‰ä¸¾ï¼‰ï¼Œä¿è¯æœåŠ¡ç»§ç»­ã€‚ åˆ†åŒºä¸å‰¯æœ¬æœºåˆ¶ä½¿å¾— Kafka èƒ½å¤Ÿæ‰©å±•å®¹é‡ &amp; æé«˜å¯é æ€§ã€‚ Kafka çš„å…¸å‹ä½¿ç”¨åœºæ™¯ åœºæ™¯ç±»åˆ« è¯´æ˜ å®æ—¶æ•°æ®ç®¡é“ / æ•°æ®é›†æˆ ç”¨äºå°†å„ç§æ•°æ®æºï¼ˆå¦‚æ—¥å¿—ã€æ•°æ®åº“å˜æ›´ã€ä¼ æ„Ÿå™¨ã€ç”¨æˆ·äº‹ä»¶ç­‰ï¼‰å®æ—¶é‡‡é›†ã€ä¼ è¾“ã€åˆ†å‘åˆ°ä¸‹æ¸¸ç³»ç»Ÿï¼ˆå¦‚ OLAPã€æœç´¢å¼•æ“ã€ç›‘æ§å¹³å°ç­‰ï¼‰ï¼Œæ„å»ºé«˜æ•ˆçš„æ•°æ®é€šé“ã€‚ äº‹ä»¶é©±åŠ¨ / äº‹ä»¶æº¯æº è®°å½•ç³»ç»Ÿå†…éƒ¨æˆ–è·¨ç³»ç»Ÿçš„äº‹ä»¶ï¼ˆçŠ¶æ€å˜åŒ–ï¼‰ï¼Œå®ç°äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEDAï¼‰æˆ–äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰ï¼Œå¯ç”¨äºå®¡è®¡ã€å›æ”¾ã€çŠ¶æ€é‡å»ºç­‰ã€‚ æ—¥å¿—èšåˆ / åˆ†æ å°†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨æ—¥å¿—ã€ç›‘æ§æŒ‡æ ‡ã€æ“ä½œæ—¥å¿—ç­‰ç»Ÿä¸€æ”¶é›†åˆ° Kafka ä¸­ï¼Œé›†ä¸­å­˜å‚¨ä¸åˆ†æï¼Œå¸¸ä¸ ELKã€ClickHouse ç­‰ç»“åˆã€‚ æµå¤„ç† ä¸ Kafka Streamsã€Apache Flinkã€Spark Streaming ç­‰æµå¤„ç†æ¡†æ¶é…åˆï¼Œå¯¹æµç» Kafka çš„æ•°æ®è¿›è¡Œå®æ—¶è®¡ç®—ã€èšåˆã€è¿‡æ»¤ã€çª—å£ç»Ÿè®¡ç­‰æ“ä½œã€‚ ç³»ç»Ÿè§£è€¦ / å¼‚æ­¥é€šä¿¡ ä½œä¸ºç³»ç»Ÿé—´çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œå‡å°‘ç³»ç»Ÿé—´è€¦åˆï¼Œæ”¯æŒå¼‚æ­¥é€šä¿¡ã€æµé‡å‰Šå³°ã€ç¼“å†²ç­‰ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ä¸æ‰©å±•æ€§ã€‚ Kafka å®‰è£… è¿™é‡Œå…ˆä»‹ç»åŸºäº Zookeeper çš„å®‰è£…æ–¹å¼ï¼Œä¸‹æ–‡ä¼šä»‹ç»åŸºäº KRaft çš„å®‰è£…æ–¹å¼ã€‚ Kafka 3.9.1 çš„å®‰è£…ä¸è¿è¡Œéœ€è¦ JDK 8+ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦æå‰å®‰è£… JDK 8+ã€‚å¯ä»¥é€‰æ‹©OpenJDKï¼Œæ¸…åå¤§å­¦é•œåƒç«™ 123456789101112131415# root ç”¨æˆ·# åˆ›å»ºå®‰è£…ç›®å½•mkdir /usr/local/jdkcd /usr/local/jdk# ä¸‹è½½JDKwget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/8/jdk/x64/linux/OpenJDK8U-jdk_x64_linux_hotspot_8u462b08.tar.gztar -zxvf OpenJDK8U-jdk_x64_linux_hotspot_8u462b08.tar.gzln -s jdk8u462-b08 jdk8# é…ç½®ç¯å¢ƒå˜é‡echo &#x27;export JAVA_HOME=/usr/local/jdk/jdk8&#x27; &gt;&gt; /etc/profile# æ³¨æ„è¿™é‡Œæ˜¯ å•å¼•å·ï¼ŒåŒå¼•å·ä¼šè§£æå˜é‡ï¼Œå¯¼è‡´é…ç½®å¤±è´¥echo &#x27;export PATH=$JAVA_HOME/bin:$PATH&#x27; &gt;&gt; /etc/profilesource /etc/profile# æ£€æŸ¥JDKå®‰è£…java -version å®‰è£…è¿‡ç¨‹å‚è€ƒå®˜ç½‘æ–‡æ¡£Kafka Quick Startã€‚ å•æœºå®‰è£… éƒ¨ç½²kafkaéƒ½ä¼šä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼Œå•æœºæ¨¡å¼åªä½œä¸ºå­¦ä¹ è¯•ç”¨ã€‚ ä¸‹è½½Kafkaï¼Œä¸‹è½½é¡µé¢ 1234567891011121314# root ç”¨æˆ·# åˆ›å»ºå®‰è£…ç›®å½•mkdir /usr/local/kafkacd /usr/local/kafka# ä¸‹è½½Kafkawget https://dlcdn.apache.org/kafka/3.9.1/kafka_2.13-3.9.1.tgztar -zxvf kafka_2.13-3.9.1.tgzln -s kafka_2.13-3.9.1 kafka3# é…ç½®ç¯å¢ƒå˜é‡echo &#x27;export KAFKA_HOME=/usr/local/kafka/kafka3&#x27; &gt;&gt; /etc/profileecho &#x27;export PATH=$KAFKA_HOME/bin:$PATH&#x27; &gt;&gt; /etc/profilesource /etc/profile# æŸ¥çœ‹Kafkaç‰ˆæœ¬kafka-topics.sh --version å¯åŠ¨ Zookeeperï¼Œkafkaå†…ç½®äº†zookeeperï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬å®‰è£…ã€‚ 1234# å‰å°è¿è¡Œzookeeper-server-start.sh /usr/local/kafka/kafka3/config/zookeeper.properties# åå°è¿è¡Œnohup zookeeper-server-start.sh /usr/local/kafka/kafka3/config/zookeeper.properties &gt; zookeeper.log 2&gt;&amp;1 &amp; å¯åŠ¨ kafka 12345# -daemon åå°è¿è¡Œkafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties# æ£€æŸ¥kafkaæ˜¯å¦å¯åŠ¨æˆåŠŸjps -l | grep kafka å°è´´å£« æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ å¯åŠ¨ kafka éœ€è¦çš„å†…å­˜å¤§å°ä¸º 1Gï¼Œè¿™ä¸€ç‚¹å¯ä»¥åœ¨ kafka-server-start.sh è„šæœ¬ä¸­æŸ¥çœ‹åˆ° 123if [ &quot;x$KAFKA_HEAP_OPTS&quot; = &quot;x&quot; ]; then export KAFKA_HEAP_OPTS=&quot;-Xmx1G -Xms1G&quot;fi æ‰€ä»¥å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡åå†å¯åŠ¨kafka 12export KAFKA_HEAP_OPTS=&quot;-Xmx512M -Xms512M&quot;kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties æµ‹è¯• 123456789# åˆ›å»º topickafka-topics.sh --create --bootstrap-server localhost:9092 --topic test# å¯åŠ¨æ¶ˆè´¹è€…kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning# å¯åŠ¨ç”Ÿäº§è€…kafka-console-producer.sh --bootstrap-server localhost:9092 --topic test&gt; hello world # è¾“å…¥å†…å®¹ï¼Œæ¶ˆè´¹è€…ä¼šæ”¶åˆ° é›†ç¾¤å®‰è£… é›†ç¾¤å®‰è£…éœ€è¦å‡†å¤‡å¤šä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘å‡†å¤‡ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š 12310.250.0.710.250.0.17410.250.0.108 æ­å»º Zookeeper é›†ç¾¤ å…³äºå¦‚ä½•æ­å»º Zookeeper é›†ç¾¤ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  Zookeeper çš„å®‰è£…åŠä½¿ç”¨ å¦‚æœå›¾çœäº‹ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Kafka è‡ªå¸¦çš„ zookeeperï¼Œç¼–è¾‘å…¶é…ç½®æ–‡ä»¶ config/zookeeper.propertieså¦‚ä¸‹ï¼Œæ³¨æ„è¦åœ¨ dataDir ç›®å½•ä¸‹åˆ›å»ºmyidæ–‡ä»¶ 12345678910111213141516dataDir=/usr/local/kafka/dataDir/zookeeper# the port at which the clients will connectclientPort=2181# disable the per-ip limit on the number of connections since this is a non-production configmaxClientCnxns=0# Disable the adminserver by default to avoid port conflicts.# Set the port to something non-conflicting if choosing to enable thisadmin.enableServer=false# admin.serverPort=8080initLimit=10syncLimit=5server.1=10.250.0.7:2888:3888server.2=10.250.0.174:2888:3888server.3=10.250.0.108:2888:3888 é…ç½® Kafka é›†ç¾¤ ä¿®æ”¹ä¸»æœºçš„ä¸»æœºå 123hostnamectl hostname worker1# hostnamectl hostname worker2# hostnamectl hostname worker3 ä¸ºäº†åç»­æ–¹ä¾¿ç»´æŠ¤ï¼Œå°†ipåœ°å€æ˜ å°„åˆ° hosts æ–‡ä»¶ä¸­ 12310.250.0.7 worker110.250.0.174 worker210.250.0.108 worker3 ç¼–è¾‘ config/server.properties æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹å¦‚ä¸‹é…ç½®é¡¹ 123456789101112#broker çš„å…¨å±€å”¯â¼€ç¼–å·ï¼Œä¸èƒ½é‡å¤ï¼Œåªèƒ½æ˜¯æ•°å­—ã€‚broker.id=1 # è¿™é‡Œåˆ†åˆ«è®¾ç½®ä¸º1ã€2ã€3#æœåŠ¡ç›‘å¬åœ°å€listeners=PLAINTEXT://worker1:9092#æ•°æ®â½‚ä»¶åœ°å€ã€‚åŒæ ·é»˜è®¤æ˜¯ç»™çš„/tmpâ½¬å½•ã€‚log.dirs=/usr/local/kafka/dataDir/kafka-logs#é»˜è®¤çš„æ¯ä¸ªTopicçš„åˆ†åŒºæ•°ï¼Œåˆ›å»ºTopicæ—¶ï¼Œå¦‚æœæœªæŒ‡å®šåˆ†åŒºæ•°ï¼Œåˆ™é»˜è®¤ä¸º1ä¸ªåˆ†åŒºã€‚num.partitions=1# æ¯ä¸ªâ½‡å¿—â½‚ä»¶åˆ é™¤ä¹‹å‰ä¿å­˜çš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯168å°æ—¶ï¼Œå³7å¤©ã€‚log.retention.hours=168#zookeeperçš„æœåŠ¡åœ°å€ï¼Œå¦‚æœæ˜¯è‡ªå»ºçš„ Zookeeper é›†ç¾¤ï¼Œåˆ™è¿™é‡Œéœ€è¦å¡«å†™é›†ç¾¤çš„è¿æ¥åœ°å€zookeeper.connect=worker1:2181,worker2:2181,worker3:2181 åˆ†åˆ«åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šå¯åŠ¨ Kafka 1kafka-server-start.sh -daemon /usr/local/kafka/kafka3/config/server.properties æµ‹è¯• 123456789101112# åˆ›å»º topickafka-topics.sh --bootstrap-server worker1:9092 --create --replication-factor 3 --partitions 3 --topic disTopic## å‚æ•°è¯´æ˜# --replication-factor 3 è¡¨ç¤ºåˆ›å»ºçš„å‰¯æœ¬æ•°# --partitions 3 è¡¨ç¤ºåˆ›å»ºçš„åˆ†åŒºæ•°# æŸ¥çœ‹ topic è¯¦æƒ…kafka-topics.sh --bootstrap-server worker1:9092 --describe --topic disTopicTopic: disTopic TopicId: VUK7Mc9oQdS1mjGG7OhQzQ PartitionCount: 3 ReplicationFactor: Configs: Topic: disTopic Partition: 0 Leader: 2 Replicas: 2,3,1 Isr: 2,3,1 Elr: N/A LastKnownElr: N/A Topic: disTopic Partition: 1 Leader: 3 Replicas: 3,1,2 Isr: 3,1,2 Elr: N/A LastKnownElr: N/A Topic: disTopic Partition: 2 Leader: 1 Replicas: 1,2,3 Isr: 1,2,3 Elr: N/A LastKnownElr: N/A","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Kafka çš„å®‰è£…ä¸ä½¿ç”¨ï¼ŒåŸºäº Zookeeperã€‚ Kafkaå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Kafka ç‰ˆæœ¬ä¸º 3.9.1ã€‚Kafka å›¢é˜Ÿå®£å¸ƒ 3.9 ä¼šæ˜¯ æœ€åä¸€ä¸ªè¿˜å¸¦æœ‰è¢«å¼ƒç”¨çš„ ZooKeeper æ¨¡å¼ çš„ä¸»è¦ç‰ˆæœ¬ã€‚ä»¥åç‰ˆæœ¬ï¼ˆå¦‚ 4.0ï¼‰å°†å®Œå…¨å¼ƒç”¨ ZooKeeperã€‚","date_published":"2025-10-13T13:30:05.000Z","tags":["æŠ€æœ¯","kafka","åˆ†å¸ƒå¼","kafka"]},{"id":"https://blog.hanqunfeng.com/2025/09/25/rabbitmq-cluster/","url":"https://blog.hanqunfeng.com/2025/09/25/rabbitmq-cluster/","title":"RabbitMQ ä¹‹ Cluster","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Cluster çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo\">Java Client ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RabbitMQ-Cluster-é›†ç¾¤-ç®€ä»‹\">RabbitMQ Cluster(é›†ç¾¤) ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ RabbitMQ ä¸­ï¼Œ<a href=\"https://www.rabbitmq.com/docs/clustering\">Clusterï¼ˆé›†ç¾¤ï¼‰</a> æ˜¯å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œç”¨äºå®ç°é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ é›†ç¾¤æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆä¸‰ä¸ªã€äº”ä¸ªã€ä¸ƒä¸ªæˆ–æ›´å¤šï¼‰èŠ‚ç‚¹çš„é€»è¾‘åˆ†ç»„ï¼Œ æ¯ä¸ªèŠ‚ç‚¹å…±äº« ç”¨æˆ·ã€è™šæ‹Ÿä¸»æœºã€é˜Ÿåˆ—ã€æµã€äº¤æ¢ã€ç»‘å®šã€è¿è¡Œæ—¶å‚æ•°å’Œå…¶ä»–åˆ†å¸ƒå¼çŠ¶æ€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ RabbitMQ ä¸­ï¼ŒClusterï¼ˆé›†ç¾¤ï¼‰çš„èŠ‚ç‚¹åˆ†ä¸ºä¸¤ç§ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ç£ç›˜èŠ‚ç‚¹(disk)ï¼šä¼šæŠŠé›†ç¾¤çš„æ‰€æœ‰å…ƒæ•°æ®ä¿¡æ¯ï¼ˆæ¯”å¦‚äº¤æ¢æœºã€ç»‘å®šã€é˜Ÿåˆ—ã€è™šæ‹Ÿä¸»æœºç­‰ä¿¡æ¯ï¼‰æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚Master èŠ‚ç‚¹å¿…é¡»æ˜¯ç£ç›˜èŠ‚ç‚¹ã€‚</li>\n<li class=\"lvl-4\">å†…å­˜èŠ‚ç‚¹(ram)ï¼šåªä¼šå°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹å®•æœºæˆ–é‡å¯ï¼Œå†…å­˜èŠ‚ç‚¹çš„æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±ï¼Œè€Œç£ç›˜èŠ‚ç‚¹çš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚Slave èŠ‚ç‚¹å¯ä»¥æ˜¯å†…å­˜èŠ‚ç‚¹ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ 4.0 å¼€å§‹ï¼Œ é›†ç¾¤ä¸å†åŒºåˆ† <code>æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆClassic Clusterï¼‰</code> ä¸ <code>é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆMirrored Queue Clusterï¼‰</code> ï¼Œé›†ç¾¤åˆ›å»ºå¥½åï¼Œä¼šæ ¹æ®é˜Ÿåˆ—çš„<code>åˆå§‹å¤åˆ¶å› å­å‚æ•°</code>å†³å®šä¸ºè¯¥é˜Ÿåˆ—åˆ›å»ºå¤šå°‘ä¸ªå‰¯æœ¬ï¼Œæ¯”å¦‚ <code>Quroum Queue</code> çš„å‚æ•°æ˜¯ <code>x-quorum-initial-group-size</code>ï¼Œé»˜è®¤ä¸º3ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ 4.0 å¼€å§‹ï¼Œ<code>Quroum Queue</code> å’Œ <code>Stream Queue</code> é»˜è®¤å¼€å¯èŠ‚ç‚¹é—´<code>æ¶ˆæ¯å¤åˆ¶</code>ï¼Œä½†æ˜¯ <code>Classic Queue</code> é˜Ÿåˆ—ä¸æ”¯æŒèŠ‚ç‚¹é—´çš„<code>æ¶ˆæ¯å¤åˆ¶</code>;</p>\n</li>\n</ul>\n<div class=\"tips\">\n<p><em><strong>RabbitMQ 4.0ä»¥å‰çš„ é›†ç¾¤åˆ†ä¸ºä¸¤ç§æ¨¡å¼</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<ol>\n<li class=\"lvl-5\">æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆClassic Clusterï¼‰</li>\n</ol>\n<ul class=\"lvl-3\">\n<li class=\"lvl-4\">åœ¨ æ™®é€šé›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒRabbitMQ èŠ‚ç‚¹é€šè¿‡ Erlang åˆ†å¸ƒå¼ç³»ç»Ÿå®ç°äº’è”ï¼Œé›†ç¾¤å†…çš„å„ä¸ªèŠ‚ç‚¹å…±äº« æ¶ˆæ¯é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šç­‰å…ƒç´ ã€‚</li>\n<li class=\"lvl-4\">æ™®é€šé›†ç¾¤çš„ç‰¹ç‚¹ï¼š\n<ul class=\"lvl-5\">\n<li class=\"lvl-6\">å…±äº«é˜Ÿåˆ—ï¼šé˜Ÿåˆ—æ•°æ®ä»…å­˜å‚¨åœ¨å•ä¸€èŠ‚ç‚¹ä¸Šï¼Œåªæœ‰è¯¥èŠ‚ç‚¹å¯ä»¥å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li>\n<li class=\"lvl-6\">ä¸è‡ªåŠ¨å¤åˆ¶æ•°æ®ï¼šåœ¨æ™®é€šé›†ç¾¤ä¸­ï¼Œæ¶ˆæ¯å¹¶ä¸ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼Œé˜Ÿåˆ—ä¸Šçš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±ï¼Œæ— æ³•æ¢å¤ã€‚</li>\n<li class=\"lvl-6\">è´Ÿè½½å‡è¡¡ï¼šäº¤æ¢æœºï¼ˆExchangeï¼‰ä¼šæŠŠæ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—ï¼Œä½†é˜Ÿåˆ—æ•°æ®ä»ç„¶åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚å› æ­¤ï¼Œæ™®é€šé›†ç¾¤é€‚åˆä¸è¦æ±‚æé«˜å¯ç”¨æ€§çš„åœºæ™¯ã€‚</li>\n<li class=\"lvl-6\">ä¸å…·å¤‡é«˜å¯ç”¨æ€§ï¼šç”±äºæ•°æ®ä¸ä¼šåœ¨é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ä¸­å¤åˆ¶ï¼Œæ™®é€šé›†ç¾¤åœ¨æŸä¸ªèŠ‚ç‚¹å®•æœºæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±å’Œç³»ç»Ÿä¸å¯ç”¨ã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<ol start=\"2\">\n<li class=\"lvl-5\">é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆMirrored Queue Clusterï¼‰</li>\n</ol>\n<ul class=\"lvl-3\">\n<li class=\"lvl-4\">é•œåƒé›†ç¾¤æ¨¡å¼ æ˜¯ä¸ºäº† é«˜å¯ç”¨æ€§ è®¾è®¡çš„ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œé˜Ÿåˆ—çš„æ•°æ®ä¼šåœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œ å¤åˆ¶ï¼ˆé•œåƒï¼‰ï¼Œä»è€Œä¿è¯å³ä½¿æŸä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li>\n<li class=\"lvl-4\">é•œåƒé›†ç¾¤çš„ç‰¹ç‚¹ï¼š\n<ul class=\"lvl-5\">\n<li class=\"lvl-6\">é˜Ÿåˆ—é•œåƒï¼šåœ¨é•œåƒé›†ç¾¤æ¨¡å¼ä¸­ï¼Œé˜Ÿåˆ—æ•°æ®ä¼šåœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šå¤åˆ¶ã€‚æ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œå¤šä¸ªé•œåƒèŠ‚ç‚¹ã€‚</li>\n<li class=\"lvl-6\">é«˜å¯ç”¨æ€§ï¼šæ¶ˆæ¯ä¼šè¢«å¤åˆ¶åˆ°é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œä»è€Œä¿è¯å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œç³»ç»Ÿèƒ½è¿…é€Ÿæ¢å¤ã€‚</li>\n<li class=\"lvl-6\">èŠ‚ç‚¹æ•…éšœæ¢å¤ï¼šå½“ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šç»§ç»­å¤„ç†è¯¥é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä¿è¯ä¸šåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚</li>\n<li class=\"lvl-6\">ç½‘ç»œè´Ÿæ‹…è¾ƒé‡ï¼šç”±äºéœ€è¦åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥å’Œå¤åˆ¶ï¼Œæ‰€ä»¥é•œåƒé˜Ÿåˆ—æ¨¡å¼ä¼šå¢åŠ é›†ç¾¤çš„ç½‘ç»œè´Ÿæ‹…å’Œç£ç›˜ I/Oã€‚</li>\n<li class=\"lvl-6\">æ€§èƒ½å½±å“ï¼šé•œåƒé˜Ÿåˆ—æ¨¡å¼ä¼šç¨å¾®å½±å“æ€§èƒ½ï¼Œå› ä¸ºæ¯æ¬¡æ¶ˆæ¯å¤„ç†åï¼Œéƒ½éœ€è¦å°†æ•°æ®åŒæ­¥åˆ°å…¶ä»–é•œåƒèŠ‚ç‚¹ï¼Œå¢åŠ äº†å»¶è¿Ÿã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"é›†ç¾¤æ­å»º\">é›†ç¾¤æ­å»º</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«å®‰è£… RabbitMQ ï¼Œå®‰è£…æ–¹æ³•å‚çœ‹ <a href=\"/2025/09/18/rabbitmq-install-01/\" title=\"RabbitMQ çš„å®‰è£…åŠä½¿ç”¨\">RabbitMQ çš„å®‰è£…åŠä½¿ç”¨</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>å¼€æ”¾ç«¯å£</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><strong>ç«¯å£èŒƒå›´</strong></th>\n<th><strong>ç”¨é€”</strong></th>\n<th><strong>å¤‡æ³¨</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>4369</strong></td>\n<td>epmdï¼ˆErlang Port Mapper Daemonï¼‰</td>\n<td>RabbitMQ èŠ‚ç‚¹å’Œ CLI å·¥å…·ä½¿ç”¨çš„å¸®åŠ©ç¨‹åºå‘ç°å®ˆæŠ¤è¿›ç¨‹ã€‚</td>\n</tr>\n<tr>\n<td><strong>6000-6500</strong></td>\n<td>RabbitMQ Stream å¤åˆ¶ä½¿ç”¨</td>\n<td>ç”¨äº RabbitMQ Stream çš„æ•°æ®å¤åˆ¶ã€‚</td>\n</tr>\n<tr>\n<td><strong>25672</strong></td>\n<td>Erlang åˆ†å‘æœåŠ¡å™¨ç«¯å£</td>\n<td>ç”¨äºèŠ‚ç‚¹é—´å’Œ CLI å·¥å…·é€šä¿¡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»…é™äºå•ä¸ªç«¯å£ï¼ˆAMQPç«¯å£ + 20000ï¼‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>35672-35682</strong></td>\n<td>Erlang åˆ†å‘å®¢æˆ·ç«¯ç«¯å£</td>\n<td>ç”¨äº CLI å·¥å…·ä¸èŠ‚ç‚¹é€šä¿¡ï¼Œè®¡ç®—ä¸ºæœåŠ¡å™¨åˆ†å‘ç«¯å£ + 10000 åˆ° æœåŠ¡å™¨åˆ†å‘ç«¯å£ + 10010ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«ä¿®æ”¹ä¸‰å°æœåŠ¡å™¨çš„ <code>hostname</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hostnamectl hostname rabbitmq01</span><br><span class=\"line\"><span class=\"comment\"># hostnamectl hostname rabbitmq02</span></span><br><span class=\"line\"><span class=\"comment\"># hostnamectl hostname rabbitmq03</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«ä¿®æ”¹ä¸‰å°æœåŠ¡å™¨çš„ <code>/etc/hosts</code> æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.250.0.56  rabbitmq01</span><br><span class=\"line\">10.250.0.232 rabbitmq02</span><br><span class=\"line\">10.250.0.97  rabbitmq03</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒæ­¥é›†ç¾¤èŠ‚ç‚¹ä¸­çš„cookie</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">é»˜è®¤ä¼šåœ¨ <code>/var/lib/rabbitmq/</code>ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code>.erlang.cookie</code>ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li>\n<li class=\"lvl-4\">æˆ‘ä»¬ä½¿ç”¨ <code>rabbitmq01</code> èŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„ä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„æˆå‘˜èŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯ä¿è¯é›†ç¾¤ä¸­ä¸‰ä¸ªèŠ‚ç‚¹çš„è¿™ä¸ª<code>cookieå­—ç¬¦ä¸²ä¸€è‡´</code>ã€‚</li>\n<li class=\"lvl-4\">å°† <code>rabbitmq01</code> çš„ <code>/var/lib/rabbitmq/.erlang.cookie</code> æ–‡ä»¶ä¸­çš„<code>cookieå­—ç¬¦ä¸²</code>å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„ <code>/var/lib/rabbitmq/.erlang.cookie</code> æ–‡ä»¶ä¸­ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«å¯åŠ¨ä¸‰å°æœåŠ¡å™¨çš„ RabbitMQ æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start rabbitmq-server</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«ç™»å½• <code>rabbitmq02</code> å’Œ <code>rabbitmq03</code> èŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœæ‰rabbitmqåº”ç”¨</span></span><br><span class=\"line\">rabbitmqctl stop_app</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡ç½®rabbitmqã€äº¤æ¢æœºã€é˜Ÿåˆ—</span></span><br><span class=\"line\">rabbitmqctl reset</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åŠ å…¥é›†ç¾¤ï¼Œæ³¨æ„æ­¤æ—¶ rabbitmq01 æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå¿…é¡»å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\"># --ram è¡¨ç¤ºä»¥ ram å†…å­˜èŠ‚ç‚¹ åŠ å…¥é›†ç¾¤ã€‚å¦‚æœä¸å¸¦å‚æ•°é»˜è®¤ä¸º disk ç£ç›˜èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"># RabbitMQçš„é›†ç¾¤èŠ‚ç‚¹åˆ†ä¸º disk å’Œ ramï¼ŒdiskèŠ‚ç‚¹ä¼šå°†å…ƒæ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜å½“ä¸­ï¼Œè€ŒramèŠ‚ç‚¹åªæ˜¯åœ¨å†…å­˜ä¸­ä¿å­˜å…ƒæ•°æ®ã€‚</span></span><br><span class=\"line\">rabbitmqctl join_cluster rabbit@rabbitmq01 --ram</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨rabbitmqåº”ç”¨</span></span><br><span class=\"line\">rabbitmqctl start_app</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½• ä»»æ„ èŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl cluster_status</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡ºç±»ä¼¼</span></span><br><span class=\"line\">Cluster status of node rabbit@rabbitmq01 ...</span><br><span class=\"line\">Basics</span><br><span class=\"line\"></span><br><span class=\"line\">Cluster name: rabbit@rabbitmq01</span><br><span class=\"line\">Total CPU cores available cluster-wide: 6</span><br><span class=\"line\"></span><br><span class=\"line\">Cluster Tags</span><br><span class=\"line\"></span><br><span class=\"line\">(none)</span><br><span class=\"line\"></span><br><span class=\"line\">Disk Nodes</span><br><span class=\"line\"></span><br><span class=\"line\">rabbit@rabbitmq01</span><br><span class=\"line\"></span><br><span class=\"line\">RAM Nodes</span><br><span class=\"line\"></span><br><span class=\"line\">rabbit@rabbitmq02</span><br><span class=\"line\">rabbit@rabbitmq03</span><br><span class=\"line\"></span><br><span class=\"line\">Running Nodes</span><br><span class=\"line\"></span><br><span class=\"line\">rabbit@rabbitmq01</span><br><span class=\"line\">rabbit@rabbitmq02</span><br><span class=\"line\">rabbit@rabbitmq03</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>PS: ç”±äºramèŠ‚ç‚¹å‡å°‘äº†å¾ˆå¤šä¸ç¡¬ç›˜çš„äº¤äº’ï¼Œæ‰€ä»¥ï¼ŒramèŠ‚ç‚¹çš„å…ƒæ•°æ®ä½¿ç”¨æ€§èƒ½ä¼šæ¯”è¾ƒé«˜ã€‚ä½†æ˜¯ï¼ŒåŒæ—¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€å…ƒæ•°æ®çš„å®‰å…¨æ€§æ˜¯ä¸å¦‚diskèŠ‚ç‚¹çš„ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªé›†ç¾¤ä¸­ï¼Œ rabbitmq02 å’Œ rabbitmq03 éƒ½ä»¥ ramèŠ‚ç‚¹ çš„èº«ä»½åŠ å…¥åˆ° rabbitmq01 é›†ç¾¤é‡Œï¼Œå› æ­¤ï¼Œæ˜¯å­˜åœ¨å•ç‚¹æ•…éšœçš„ã€‚å¦‚æœ rabbitmq01 èŠ‚ç‚¹æœåŠ¡å´©æºƒï¼Œé‚£ä¹ˆå…ƒæ•°æ®å°±æœ‰å¯èƒ½ä¸¢å¤±ã€‚åœ¨ä¼ä¸šè¿›è¡Œéƒ¨ç½²æ—¶ï¼Œæ€§èƒ½ä¸å®‰å…¨æ€§éœ€è¦è‡ªå·±è¿›è¡Œå¹³è¡¡ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½•ä»»æ„èŠ‚ç‚¹çš„ç®¡ç†é¡µé¢ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/R195gJ.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶æˆ‘ä»¬åœ¨ä»»æ„èŠ‚ç‚¹ä¸­åˆ›å»ºè™šæ‹Ÿä¸»æœºã€é˜Ÿåˆ—ã€äº¤æ¢æœºå’Œç»‘å®šå…³ç³» ç­‰å…ƒæ•°æ®ï¼Œéƒ½ä¼šè‡ªåŠ¨åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ ç®¡ç†æ§åˆ¶å° ä¸­æŸ¥çœ‹é˜Ÿåˆ—æ—¶çœ‹åˆ°ï¼Œæ­¤æ—¶å¤šä¸ªä¸€åˆ—ï¼Œ<code>Node</code>åˆ—ï¼Œæ˜¾ç¤ºè¯¥é˜Ÿåˆ—åœ¨å“ªäº›èŠ‚ç‚¹ä¸­å­˜åœ¨ã€‚åªæœ‰ <code>Quorum é˜Ÿåˆ—</code> å’Œ <code>Stream é˜Ÿåˆ—</code> æ‰ä¼šæ˜¾ç¤ºå¤šä¸ªèŠ‚ç‚¹ï¼Œå› ä¸º <code>Classic é˜Ÿåˆ—</code> ä¸æ”¯æŒå¤šèŠ‚ç‚¹å¤åˆ¶ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/GjHcLN.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹æŸä¸ªå…·ä½“çš„ <code>Quorum é˜Ÿåˆ—</code> æˆ– <code>Stream é˜Ÿåˆ—</code>ï¼Œå¯ä»¥çœ‹åˆ°æ›´è¯¦ç»†çš„è¯´æ˜<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/XtIkpp.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶æ–°å»ºé˜Ÿåˆ—ï¼Œä¼šè¦æ±‚æˆ‘ä»¬æŒ‡å®šä¸»èŠ‚ç‚¹(Leader)ï¼Œå³è´Ÿè´£å­˜å‚¨æ¶ˆæ¯çš„çš„èŠ‚ç‚¹ï¼Œè€Œ <code>Quorum é˜Ÿåˆ—</code> æˆ– <code>Stream é˜Ÿåˆ—</code>ï¼Œä¼šè‡ªåŠ¨å°†æ¶ˆæ¯å¤åˆ¶åˆ°å…¶å®ƒèŠ‚ç‚¹(Members)ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Leader: é˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€‚</li>\n<li class=\"lvl-4\">Members: é˜Ÿåˆ—çš„æˆå‘˜èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯çš„å‰¯æœ¬ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æ¼”ç¤ºé˜Ÿåˆ—å¤åˆ¶\">æ¼”ç¤ºé˜Ÿåˆ—å¤åˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Quorum é˜Ÿåˆ—</code> å’Œ <code>Stream é˜Ÿåˆ—</code> çš„ å¤åˆ¶æ•° éƒ½ä¸º 3ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘åœ¨å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ <code>rabbitmq04</code>ï¼Œè¯·è‡ªè¡ŒæŒ‰ä¸Šé¢çš„æ–¹æ³•æ·»åŠ ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Quorum-é˜Ÿåˆ—\">Quorum é˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨é¡µé¢ä¸Šåˆ›å»ºä¸€ä¸ª <code>Quorum é˜Ÿåˆ—</code>ï¼Œä¸å•èŠ‚ç‚¹ä¸Šåˆ›å»ºé˜Ÿåˆ—çš„åŒºåˆ«å°±æ˜¯éœ€è¦æˆ‘ä»¬é€‰æ‹©ä¸»èŠ‚ç‚¹ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/JYfKgg.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ å®¢æˆ·ç«¯ åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿æ¥å“ªä¸ªèŠ‚ç‚¹ï¼Œå“ªä¸ªèŠ‚ç‚¹å°±æ˜¯Leaderï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°<code>x-queue-leader-locator</code>æŒ‡å®šä¸»èŠ‚ç‚¹çš„é€‰æ‹©ç­–ç•¥ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqadmin queues <span class=\"built_in\">declare</span> --vhost <span class=\"string\">&quot;/vtest&quot;</span> --name <span class=\"string\">&quot;target.quorum.queue.name&quot;</span> --<span class=\"built_in\">type</span> <span class=\"string\">&quot;quorum&quot;</span> --durable <span class=\"literal\">true</span> --arguments <span class=\"string\">&#x27;&#123;&quot;x-queue-leader-locator&quot;:&quot;balanced&quot;&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># x-queue-leader-locator æœ‰ä¸¤ç§é€‰æ‹©ç­–ç•¥</span></span><br><span class=\"line\"><span class=\"comment\">## client-localï¼šé€‰æ‹©å£°æ˜é˜Ÿåˆ—çš„å®¢æˆ·ç«¯æ‰€è¿æ¥çš„èŠ‚ç‚¹ã€‚è¿™æ˜¯é»˜è®¤å€¼ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">## balancedï¼šå¦‚æœé˜Ÿåˆ—æ€»æ•°å°‘äº 1000 ä¸ªï¼ˆç»å…¸é˜Ÿåˆ—ã€ä»²è£é˜Ÿåˆ—å’Œæµï¼‰ï¼Œ é€‰æ‹©æ‰˜ç®¡æœ€å°æ•°é‡çš„ä»²è£é˜Ÿåˆ—é¢†å¯¼è€…çš„èŠ‚ç‚¹ã€‚ å¦‚æœé˜Ÿåˆ—æ€»ä½“è¶…è¿‡ 1000 ä¸ªï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ° <code>Quorum é˜Ÿåˆ—</code> çš„ä¸»èŠ‚ç‚¹å’Œæˆå‘˜èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæˆå‘˜èŠ‚ç‚¹æœ‰ä¸‰ä¸ªï¼Œé™¤äº†ä¸»èŠ‚ç‚¹å¤–ï¼Œå…¶ä½™èŠ‚ç‚¹ç”±é›†ç¾¤è‡ªåŠ¨é€‰æ‹©ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/qBfNNh.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Quorum é˜Ÿåˆ—</code> çš„å¤åˆ¶æ•°æ˜¯ <code>3</code>ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æ”¹å˜å¤åˆ¶æ•°ï¼Œå¯ä»¥åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶æŒ‡å®šå‚æ•° <code>x-quorum-initial-group-size</code>ï¼Œå…¶å€¼ä¸º <code>å¤§äº 0 çš„æ•´æ•°</code>ï¼Œè‹¥è®¾ç½®å€¼å¤§äºå®é™…æˆå‘˜èŠ‚ç‚¹æ•°ï¼Œåˆ™ä»¥å®é™…æˆå‘˜èŠ‚ç‚¹æ•°ä¸ºå‡†ã€‚<code>x-quorum-initial-group-size</code> è®¾ç½®ä¸º <code>1</code> æ—¶ä¾¿ä¸è¿›è¡Œå¤åˆ¶äº†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœé›†ç¾¤ä¸­å¢åŠ äº†æ–°çš„èŠ‚ç‚¹ï¼Œå¸Œæœ›é˜Ÿåˆ—ä¹Ÿè¢«å¤åˆ¶åˆ°æ–°çš„èŠ‚ç‚¹ä¸­ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œå°†æ–°çš„èŠ‚ç‚¹åŠ å…¥æˆå‘˜èŠ‚ç‚¹ä¸­:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-queues add_member [-p &lt;vhost&gt;] &lt;queue-name&gt; &lt;node&gt;</span></span><br><span class=\"line\">rabbitmq-queues add_member -p /vtest q_4 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœå¸Œæœ›å°†èŠ‚ç‚¹ä»æˆå‘˜èŠ‚ç‚¹ä¸­ç§»é™¤ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-queues delete_member [-p &lt;vhost&gt;] &lt;queue-name&gt; &lt;node&gt;</span></span><br><span class=\"line\">rabbitmq-queues delete_member -p /vtest q_4 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦å¤–ï¼Œå½“é€šè¿‡ <code>forget_cluster_node</code> å‘½ä»¤ä»é›†ç¾¤ä¸­æ°¸ä¹…åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œä¼šè‡ªåŠ¨å°†é˜Ÿåˆ—å…³è”çš„èŠ‚ç‚¹ä»æˆå‘˜èŠ‚ç‚¹ä¸­ç§»é™¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å› ä¸ºè¦åˆ é™¤ rabbitmq04 èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä»¥ä¸‹å‘½ä»¤ä¸èƒ½åœ¨ rabbitmq04 èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å‰éœ€è¦å…ˆå…³é—­åº”ç”¨</span></span><br><span class=\"line\">rabbitmqctl -n rabbit@rabbitmq04 stop_app</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"># rabbitmqctl forget_cluster_node &lt;node&gt;</span></span><br><span class=\"line\">rabbitmqctl forget_cluster_node rabbit@rabbitmq04</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ–°å¢èŠ‚ç‚¹åï¼Œä¸€ä¸ªä¸ªçš„å¯¹åŸæœ‰çš„é˜Ÿåˆ—è¿›è¡Œå¤åˆ¶æ‰©å±•éå¸¸éº»çƒ¦ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¿«é€Ÿå¯¹ç¬¦åˆæ¡ä»¶çš„é˜Ÿåˆ—è¿›è¡Œå¤åˆ¶æ‰©å±•:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-queues grow &lt;node&gt; &lt;all | even&gt; [--vhost-pattern &lt;pattern&gt;] [--queue-pattern &lt;pattern&gt;]</span></span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;node&gt;: è¿™ä¸ªå‚æ•°æŒ‡å®šäº† RabbitMQ èŠ‚ç‚¹çš„åç§°ï¼Œé€šå¸¸æ˜¯ rabbit@&lt;hostname&gt;ã€‚å®ƒè¡¨ç¤ºåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¢é•¿æ“ä½œã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;all | even&gt;: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦æ‰©å±•çš„é˜Ÿåˆ—ç±»å‹ã€‚all è¡¨ç¤ºæ‰©å±•æ‰€æœ‰é˜Ÿåˆ—ï¼Œeven è¡¨ç¤ºæ‰©å±•å¶æ•°ç¼–å·çš„é˜Ÿåˆ—ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># --vhost-pattern &lt;pattern&gt; ï¼ˆå¯é€‰ï¼‰: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦åŒ¹é…çš„è™šæ‹Ÿä¸»æœºåç§°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># --queue-pattern &lt;pattern&gt; ï¼ˆå¯é€‰ï¼‰: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦åŒ¹é…çš„é˜Ÿåˆ—åç§°ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># æ‰©å±•æ‰€æœ‰è™šæ‹Ÿä¸»æœºä¸‹çš„æ‰€æœ‰é˜Ÿåˆ—çš„å‰¯æœ¬ï¼š</span></span><br><span class=\"line\">rabbitmq-queues grow rabbit@rabbitmq04 all</span><br><span class=\"line\"><span class=\"comment\"># æ‰©å±•æ‰€æœ‰è™šæ‹Ÿä¸»æœºä¸‹çš„å¶æ•°ç¼–å·çš„é˜Ÿåˆ—çš„å‰¯æœ¬ï¼š</span></span><br><span class=\"line\">rabbitmq-queues grow rabbit@rabbitmq04 even</span><br><span class=\"line\"><span class=\"comment\"># æ‰©å±•ç‰¹å®šè™šæ‹Ÿä¸»æœºå’Œé˜Ÿåˆ—åç§°çš„é˜Ÿåˆ—</span></span><br><span class=\"line\">rabbitmq-queues grow rabbit@rabbitmq04 all --vhost-pattern /vtest --queue-pattern <span class=\"string\">&quot;^q_&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Stream-é˜Ÿåˆ—\">Stream é˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Stream é˜Ÿåˆ— ä¸ Quorum é˜Ÿåˆ— ç±»ä¼¼ï¼Œé€šè¿‡å“ªä¸ªèŠ‚ç‚¹åˆ›å»ºé˜Ÿåˆ—ï¼Œå“ªä¸ªèŠ‚ç‚¹å°±æ˜¯ Leaderï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡å‚æ•° <code>x-queue-leader-locator</code> æŒ‡å®šä¸»èŠ‚ç‚¹çš„é€‰æ‹©ç­–ç•¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»º Stream é˜Ÿåˆ—æ—¶ï¼Œé»˜è®¤å¤åˆ¶æ•°å°±æ˜¯å½“å‰é›†ç¾¤çš„èŠ‚ç‚¹æ•°ï¼ˆQuorum é˜Ÿåˆ— é»˜è®¤æ˜¯ 3ï¼‰ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šå‚æ•° <code>x-initial-cluster-size</code> è¿›è¡Œåˆå§‹è®¾ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ·»åŠ æ–°çš„èŠ‚ç‚¹æ—¶ï¼Œä¸ Quorum é˜Ÿåˆ— ç±»ä¼¼ï¼ŒStream é˜Ÿåˆ— ä¹Ÿä¸ä¼šè‡ªåŠ¨è¿›è¡Œå¤åˆ¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ‰‹åŠ¨å¤åˆ¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-streams add_replica [-p &lt;vhost&gt;] &lt;stream-name&gt; &lt;node&gt;</span></span><br><span class=\"line\">rabbitmq-streams add_replica -p /vtest sq_2 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤æˆå‘˜èŠ‚ç‚¹æ—¶ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-streams delete_replica [-p &lt;vhost&gt;] &lt;stream-name&gt; &lt;node&gt;</span></span><br><span class=\"line\">rabbitmq-streams delete_replica -p /vtest sq_2 rabbit@rabbitmq02</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹èŠ‚ç‚¹å¤åˆ¶çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-streams stream_status [-p &lt;vhost&gt;] &lt;stream-name&gt;</span></span><br><span class=\"line\">rabbitmq-streams stream_status -p /vtest sq_2</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æµå‡ºç°å¼‚å¸¸çŠ¶æ€ï¼ˆå¦‚å‰¯æœ¬åˆ†å¸ƒå¼‚å¸¸ã€é¢†å¯¼èŠ‚ç‚¹æŒ‚æ‰ï¼‰æ—¶ï¼Œä¸ºäº†æ¢å¤å¯ç”¨æ€§ï¼Œå¯ä»¥é‡å¯æµ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-streams restart_stream [-p &lt;vhost&gt;] &lt;stream-name&gt;</span></span><br><span class=\"line\">rabbitmq-streams restart_stream -p /vtest sq_2</span><br><span class=\"line\"><span class=\"comment\">## é‡å¯æ“ä½œ</span></span><br><span class=\"line\"><span class=\"comment\"># 1.åœæ­¢æµçš„å½“å‰å‰¯æœ¬/åˆ†åŒºã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># 2.é‡æ–°åˆå§‹åŒ–æµçš„å­˜å‚¨å’Œå…ƒæ•°æ®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># 3.è®©æµåœ¨é›†ç¾¤ä¸­æ¢å¤ä¸ºå¯ç”¨çŠ¶æ€ã€‚</span></span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Cluster çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹ RabbitMQ Cluster(é›†ç¾¤) ç®€ä»‹ åœ¨ RabbitMQ ä¸­ï¼ŒClusterï¼ˆé›†ç¾¤ï¼‰ æ˜¯å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œç”¨äºå®ç°é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡ã€‚ RabbitMQ é›†ç¾¤æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆä¸‰ä¸ªã€äº”ä¸ªã€ä¸ƒä¸ªæˆ–æ›´å¤šï¼‰èŠ‚ç‚¹çš„é€»è¾‘åˆ†ç»„ï¼Œ æ¯ä¸ªèŠ‚ç‚¹å…±äº« ç”¨æˆ·ã€è™šæ‹Ÿä¸»æœºã€é˜Ÿåˆ—ã€æµã€äº¤æ¢ã€ç»‘å®šã€è¿è¡Œæ—¶å‚æ•°å’Œå…¶ä»–åˆ†å¸ƒå¼çŠ¶æ€ã€‚ åœ¨ RabbitMQ ä¸­ï¼ŒClusterï¼ˆé›†ç¾¤ï¼‰çš„èŠ‚ç‚¹åˆ†ä¸ºä¸¤ç§ï¼š ç£ç›˜èŠ‚ç‚¹(disk)ï¼šä¼šæŠŠé›†ç¾¤çš„æ‰€æœ‰å…ƒæ•°æ®ä¿¡æ¯ï¼ˆæ¯”å¦‚äº¤æ¢æœºã€ç»‘å®šã€é˜Ÿåˆ—ã€è™šæ‹Ÿä¸»æœºç­‰ä¿¡æ¯ï¼‰æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚Master èŠ‚ç‚¹å¿…é¡»æ˜¯ç£ç›˜èŠ‚ç‚¹ã€‚ å†…å­˜èŠ‚ç‚¹(ram)ï¼šåªä¼šå°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹å®•æœºæˆ–é‡å¯ï¼Œå†…å­˜èŠ‚ç‚¹çš„æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±ï¼Œè€Œç£ç›˜èŠ‚ç‚¹çš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚Slave èŠ‚ç‚¹å¯ä»¥æ˜¯å†…å­˜èŠ‚ç‚¹ã€‚ RabbitMQ 4.0 å¼€å§‹ï¼Œ é›†ç¾¤ä¸å†åŒºåˆ† æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆClassic Clusterï¼‰ ä¸ é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆMirrored Queue Clusterï¼‰ ï¼Œé›†ç¾¤åˆ›å»ºå¥½åï¼Œä¼šæ ¹æ®é˜Ÿåˆ—çš„åˆå§‹å¤åˆ¶å› å­å‚æ•°å†³å®šä¸ºè¯¥é˜Ÿåˆ—åˆ›å»ºå¤šå°‘ä¸ªå‰¯æœ¬ï¼Œæ¯”å¦‚ Quroum Queue çš„å‚æ•°æ˜¯ x-quorum-initial-group-sizeï¼Œé»˜è®¤ä¸º3ã€‚ RabbitMQ 4.0 å¼€å§‹ï¼ŒQuroum Queue å’Œ Stream Queue é»˜è®¤å¼€å¯èŠ‚ç‚¹é—´æ¶ˆæ¯å¤åˆ¶ï¼Œä½†æ˜¯ Classic Queue é˜Ÿåˆ—ä¸æ”¯æŒèŠ‚ç‚¹é—´çš„æ¶ˆæ¯å¤åˆ¶; RabbitMQ 4.0ä»¥å‰çš„ é›†ç¾¤åˆ†ä¸ºä¸¤ç§æ¨¡å¼ æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆClassic Clusterï¼‰ åœ¨ æ™®é€šé›†ç¾¤æ¨¡å¼ä¸‹ï¼ŒRabbitMQ èŠ‚ç‚¹é€šè¿‡ Erlang åˆ†å¸ƒå¼ç³»ç»Ÿå®ç°äº’è”ï¼Œé›†ç¾¤å†…çš„å„ä¸ªèŠ‚ç‚¹å…±äº« æ¶ˆæ¯é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šç­‰å…ƒç´ ã€‚ æ™®é€šé›†ç¾¤çš„ç‰¹ç‚¹ï¼š å…±äº«é˜Ÿåˆ—ï¼šé˜Ÿåˆ—æ•°æ®ä»…å­˜å‚¨åœ¨å•ä¸€èŠ‚ç‚¹ä¸Šï¼Œåªæœ‰è¯¥èŠ‚ç‚¹å¯ä»¥å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ ä¸è‡ªåŠ¨å¤åˆ¶æ•°æ®ï¼šåœ¨æ™®é€šé›†ç¾¤ä¸­ï¼Œæ¶ˆæ¯å¹¶ä¸ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼Œé˜Ÿåˆ—ä¸Šçš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±ï¼Œæ— æ³•æ¢å¤ã€‚ è´Ÿè½½å‡è¡¡ï¼šäº¤æ¢æœºï¼ˆExchangeï¼‰ä¼šæŠŠæ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—ï¼Œä½†é˜Ÿåˆ—æ•°æ®ä»ç„¶åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚å› æ­¤ï¼Œæ™®é€šé›†ç¾¤é€‚åˆä¸è¦æ±‚æé«˜å¯ç”¨æ€§çš„åœºæ™¯ã€‚ ä¸å…·å¤‡é«˜å¯ç”¨æ€§ï¼šç”±äºæ•°æ®ä¸ä¼šåœ¨é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ä¸­å¤åˆ¶ï¼Œæ™®é€šé›†ç¾¤åœ¨æŸä¸ªèŠ‚ç‚¹å®•æœºæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±å’Œç³»ç»Ÿä¸å¯ç”¨ã€‚ é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆMirrored Queue Clusterï¼‰ é•œåƒé›†ç¾¤æ¨¡å¼ æ˜¯ä¸ºäº† é«˜å¯ç”¨æ€§ è®¾è®¡çš„ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œé˜Ÿåˆ—çš„æ•°æ®ä¼šåœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œ å¤åˆ¶ï¼ˆé•œåƒï¼‰ï¼Œä»è€Œä¿è¯å³ä½¿æŸä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ é•œåƒé›†ç¾¤çš„ç‰¹ç‚¹ï¼š é˜Ÿåˆ—é•œåƒï¼šåœ¨é•œåƒé›†ç¾¤æ¨¡å¼ä¸­ï¼Œé˜Ÿåˆ—æ•°æ®ä¼šåœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šå¤åˆ¶ã€‚æ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œå¤šä¸ªé•œåƒèŠ‚ç‚¹ã€‚ é«˜å¯ç”¨æ€§ï¼šæ¶ˆæ¯ä¼šè¢«å¤åˆ¶åˆ°é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œä»è€Œä¿è¯å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œç³»ç»Ÿèƒ½è¿…é€Ÿæ¢å¤ã€‚ èŠ‚ç‚¹æ•…éšœæ¢å¤ï¼šå½“ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šç»§ç»­å¤„ç†è¯¥é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œä¿è¯ä¸šåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚ ç½‘ç»œè´Ÿæ‹…è¾ƒé‡ï¼šç”±äºéœ€è¦åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥å’Œå¤åˆ¶ï¼Œæ‰€ä»¥é•œåƒé˜Ÿåˆ—æ¨¡å¼ä¼šå¢åŠ é›†ç¾¤çš„ç½‘ç»œè´Ÿæ‹…å’Œç£ç›˜ I/Oã€‚ æ€§èƒ½å½±å“ï¼šé•œåƒé˜Ÿåˆ—æ¨¡å¼ä¼šç¨å¾®å½±å“æ€§èƒ½ï¼Œå› ä¸ºæ¯æ¬¡æ¶ˆæ¯å¤„ç†åï¼Œéƒ½éœ€è¦å°†æ•°æ®åŒæ­¥åˆ°å…¶ä»–é•œåƒèŠ‚ç‚¹ï¼Œå¢åŠ äº†å»¶è¿Ÿã€‚ é›†ç¾¤æ­å»º å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«å®‰è£… RabbitMQ ï¼Œå®‰è£…æ–¹æ³•å‚çœ‹ RabbitMQ çš„å®‰è£…åŠä½¿ç”¨ å¼€æ”¾ç«¯å£ ç«¯å£èŒƒå›´ ç”¨é€” å¤‡æ³¨ 4369 epmdï¼ˆErlang Port Mapper Daemonï¼‰ RabbitMQ èŠ‚ç‚¹å’Œ CLI å·¥å…·ä½¿ç”¨çš„å¸®åŠ©ç¨‹åºå‘ç°å®ˆæŠ¤è¿›ç¨‹ã€‚ 6000-6500 RabbitMQ Stream å¤åˆ¶ä½¿ç”¨ ç”¨äº RabbitMQ Stream çš„æ•°æ®å¤åˆ¶ã€‚ 25672 Erlang åˆ†å‘æœåŠ¡å™¨ç«¯å£ ç”¨äºèŠ‚ç‚¹é—´å’Œ CLI å·¥å…·é€šä¿¡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»…é™äºå•ä¸ªç«¯å£ï¼ˆAMQPç«¯å£ + 20000ï¼‰ã€‚ 35672-35682 Erlang åˆ†å‘å®¢æˆ·ç«¯ç«¯å£ ç”¨äº CLI å·¥å…·ä¸èŠ‚ç‚¹é€šä¿¡ï¼Œè®¡ç®—ä¸ºæœåŠ¡å™¨åˆ†å‘ç«¯å£ + 10000 åˆ° æœåŠ¡å™¨åˆ†å‘ç«¯å£ + 10010ã€‚ åˆ†åˆ«ä¿®æ”¹ä¸‰å°æœåŠ¡å™¨çš„ hostname 123hostnamectl hostname rabbitmq01# hostnamectl hostname rabbitmq02# hostnamectl hostname rabbitmq03 åˆ†åˆ«ä¿®æ”¹ä¸‰å°æœåŠ¡å™¨çš„ /etc/hosts æ–‡ä»¶ 12310.250.0.56 rabbitmq0110.250.0.232 rabbitmq0210.250.0.97 rabbitmq03 åŒæ­¥é›†ç¾¤èŠ‚ç‚¹ä¸­çš„cookie é»˜è®¤ä¼šåœ¨ /var/lib/rabbitmq/ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª.erlang.cookieï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ æˆ‘ä»¬ä½¿ç”¨ rabbitmq01 èŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„ä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹ä½œä¸ºé›†ç¾¤çš„æˆå‘˜èŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯ä¿è¯é›†ç¾¤ä¸­ä¸‰ä¸ªèŠ‚ç‚¹çš„è¿™ä¸ªcookieå­—ç¬¦ä¸²ä¸€è‡´ã€‚ å°† rabbitmq01 çš„ /var/lib/rabbitmq/.erlang.cookie æ–‡ä»¶ä¸­çš„cookieå­—ç¬¦ä¸²å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„ /var/lib/rabbitmq/.erlang.cookie æ–‡ä»¶ä¸­ã€‚ åˆ†åˆ«å¯åŠ¨ä¸‰å°æœåŠ¡å™¨çš„ RabbitMQ æœåŠ¡ 1systemctl start rabbitmq-server åˆ†åˆ«ç™»å½• rabbitmq02 å’Œ rabbitmq03 èŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ 12345678910111213# åœæ‰rabbitmqåº”ç”¨rabbitmqctl stop_app# é‡ç½®rabbitmqã€äº¤æ¢æœºã€é˜Ÿåˆ—rabbitmqctl reset# åŠ å…¥é›†ç¾¤ï¼Œæ³¨æ„æ­¤æ—¶ rabbitmq01 æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå¿…é¡»å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œ# --ram è¡¨ç¤ºä»¥ ram å†…å­˜èŠ‚ç‚¹ åŠ å…¥é›†ç¾¤ã€‚å¦‚æœä¸å¸¦å‚æ•°é»˜è®¤ä¸º disk ç£ç›˜èŠ‚ç‚¹# RabbitMQçš„é›†ç¾¤èŠ‚ç‚¹åˆ†ä¸º disk å’Œ ramï¼ŒdiskèŠ‚ç‚¹ä¼šå°†å…ƒæ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜å½“ä¸­ï¼Œè€ŒramèŠ‚ç‚¹åªæ˜¯åœ¨å†…å­˜ä¸­ä¿å­˜å…ƒæ•°æ®ã€‚rabbitmqctl join_cluster rabbit@rabbitmq01 --ram# å¯åŠ¨rabbitmqåº”ç”¨rabbitmqctl start_app ç™»å½• ä»»æ„ èŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 1234567891011121314151617181920212223242526rabbitmqctl cluster_status## è¾“å‡ºç±»ä¼¼Cluster status of node rabbit@rabbitmq01 ...BasicsCluster name: rabbit@rabbitmq01Total CPU cores available cluster-wide: 6Cluster Tags(none)Disk Nodesrabbit@rabbitmq01RAM Nodesrabbit@rabbitmq02rabbit@rabbitmq03Running Nodesrabbit@rabbitmq01rabbit@rabbitmq02rabbit@rabbitmq03 PS: ç”±äºramèŠ‚ç‚¹å‡å°‘äº†å¾ˆå¤šä¸ç¡¬ç›˜çš„äº¤äº’ï¼Œæ‰€ä»¥ï¼ŒramèŠ‚ç‚¹çš„å…ƒæ•°æ®ä½¿ç”¨æ€§èƒ½ä¼šæ¯”è¾ƒé«˜ã€‚ä½†æ˜¯ï¼ŒåŒæ—¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€å…ƒæ•°æ®çš„å®‰å…¨æ€§æ˜¯ä¸å¦‚diskèŠ‚ç‚¹çš„ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªé›†ç¾¤ä¸­ï¼Œ rabbitmq02 å’Œ rabbitmq03 éƒ½ä»¥ ramèŠ‚ç‚¹ çš„èº«ä»½åŠ å…¥åˆ° rabbitmq01 é›†ç¾¤é‡Œï¼Œå› æ­¤ï¼Œæ˜¯å­˜åœ¨å•ç‚¹æ•…éšœçš„ã€‚å¦‚æœ rabbitmq01 èŠ‚ç‚¹æœåŠ¡å´©æºƒï¼Œé‚£ä¹ˆå…ƒæ•°æ®å°±æœ‰å¯èƒ½ä¸¢å¤±ã€‚åœ¨ä¼ä¸šè¿›è¡Œéƒ¨ç½²æ—¶ï¼Œæ€§èƒ½ä¸å®‰å…¨æ€§éœ€è¦è‡ªå·±è¿›è¡Œå¹³è¡¡ã€‚ ç™»å½•ä»»æ„èŠ‚ç‚¹çš„ç®¡ç†é¡µé¢ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ æ­¤æ—¶æˆ‘ä»¬åœ¨ä»»æ„èŠ‚ç‚¹ä¸­åˆ›å»ºè™šæ‹Ÿä¸»æœºã€é˜Ÿåˆ—ã€äº¤æ¢æœºå’Œç»‘å®šå…³ç³» ç­‰å…ƒæ•°æ®ï¼Œéƒ½ä¼šè‡ªåŠ¨åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ä¸­ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ ç®¡ç†æ§åˆ¶å° ä¸­æŸ¥çœ‹é˜Ÿåˆ—æ—¶çœ‹åˆ°ï¼Œæ­¤æ—¶å¤šä¸ªä¸€åˆ—ï¼ŒNodeåˆ—ï¼Œæ˜¾ç¤ºè¯¥é˜Ÿåˆ—åœ¨å“ªäº›èŠ‚ç‚¹ä¸­å­˜åœ¨ã€‚åªæœ‰ Quorum é˜Ÿåˆ— å’Œ Stream é˜Ÿåˆ— æ‰ä¼šæ˜¾ç¤ºå¤šä¸ªèŠ‚ç‚¹ï¼Œå› ä¸º Classic é˜Ÿåˆ— ä¸æ”¯æŒå¤šèŠ‚ç‚¹å¤åˆ¶ã€‚ æŸ¥çœ‹æŸä¸ªå…·ä½“çš„ Quorum é˜Ÿåˆ— æˆ– Stream é˜Ÿåˆ—ï¼Œå¯ä»¥çœ‹åˆ°æ›´è¯¦ç»†çš„è¯´æ˜ æ­¤æ—¶æ–°å»ºé˜Ÿåˆ—ï¼Œä¼šè¦æ±‚æˆ‘ä»¬æŒ‡å®šä¸»èŠ‚ç‚¹(Leader)ï¼Œå³è´Ÿè´£å­˜å‚¨æ¶ˆæ¯çš„çš„èŠ‚ç‚¹ï¼Œè€Œ Quorum é˜Ÿåˆ— æˆ– Stream é˜Ÿåˆ—ï¼Œä¼šè‡ªåŠ¨å°†æ¶ˆæ¯å¤åˆ¶åˆ°å…¶å®ƒèŠ‚ç‚¹(Members)ã€‚ Leader: é˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€‚ Members: é˜Ÿåˆ—çš„æˆå‘˜èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯çš„å‰¯æœ¬ã€‚ æ¼”ç¤ºé˜Ÿåˆ—å¤åˆ¶ é»˜è®¤æƒ…å†µä¸‹ï¼ŒQuorum é˜Ÿåˆ— å’Œ Stream é˜Ÿåˆ— çš„ å¤åˆ¶æ•° éƒ½ä¸º 3ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘åœ¨å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ rabbitmq04ï¼Œè¯·è‡ªè¡ŒæŒ‰ä¸Šé¢çš„æ–¹æ³•æ·»åŠ ã€‚ Quorum é˜Ÿåˆ— åœ¨é¡µé¢ä¸Šåˆ›å»ºä¸€ä¸ª Quorum é˜Ÿåˆ—ï¼Œä¸å•èŠ‚ç‚¹ä¸Šåˆ›å»ºé˜Ÿåˆ—çš„åŒºåˆ«å°±æ˜¯éœ€è¦æˆ‘ä»¬é€‰æ‹©ä¸»èŠ‚ç‚¹ã€‚ é€šè¿‡ å®¢æˆ·ç«¯ åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿æ¥å“ªä¸ªèŠ‚ç‚¹ï¼Œå“ªä¸ªèŠ‚ç‚¹å°±æ˜¯Leaderï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°x-queue-leader-locatoræŒ‡å®šä¸»èŠ‚ç‚¹çš„é€‰æ‹©ç­–ç•¥ã€‚ 1234rabbitmqadmin queues declare --vhost &quot;/vtest&quot; --name &quot;target.quorum.queue.name&quot; --type &quot;quorum&quot; --durable true --arguments &#x27;&#123;&quot;x-queue-leader-locator&quot;:&quot;balanced&quot;&#125;&#x27;# x-queue-leader-locator æœ‰ä¸¤ç§é€‰æ‹©ç­–ç•¥## client-localï¼šé€‰æ‹©å£°æ˜é˜Ÿåˆ—çš„å®¢æˆ·ç«¯æ‰€è¿æ¥çš„èŠ‚ç‚¹ã€‚è¿™æ˜¯é»˜è®¤å€¼ã€‚## balancedï¼šå¦‚æœé˜Ÿåˆ—æ€»æ•°å°‘äº 1000 ä¸ªï¼ˆç»å…¸é˜Ÿåˆ—ã€ä»²è£é˜Ÿåˆ—å’Œæµï¼‰ï¼Œ é€‰æ‹©æ‰˜ç®¡æœ€å°æ•°é‡çš„ä»²è£é˜Ÿåˆ—é¢†å¯¼è€…çš„èŠ‚ç‚¹ã€‚ å¦‚æœé˜Ÿåˆ—æ€»ä½“è¶…è¿‡ 1000 ä¸ªï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ã€‚ åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ° Quorum é˜Ÿåˆ— çš„ä¸»èŠ‚ç‚¹å’Œæˆå‘˜èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæˆå‘˜èŠ‚ç‚¹æœ‰ä¸‰ä¸ªï¼Œé™¤äº†ä¸»èŠ‚ç‚¹å¤–ï¼Œå…¶ä½™èŠ‚ç‚¹ç”±é›†ç¾¤è‡ªåŠ¨é€‰æ‹©ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒQuorum é˜Ÿåˆ— çš„å¤åˆ¶æ•°æ˜¯ 3ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æ”¹å˜å¤åˆ¶æ•°ï¼Œå¯ä»¥åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶æŒ‡å®šå‚æ•° x-quorum-initial-group-sizeï¼Œå…¶å€¼ä¸º å¤§äº 0 çš„æ•´æ•°ï¼Œè‹¥è®¾ç½®å€¼å¤§äºå®é™…æˆå‘˜èŠ‚ç‚¹æ•°ï¼Œåˆ™ä»¥å®é™…æˆå‘˜èŠ‚ç‚¹æ•°ä¸ºå‡†ã€‚x-quorum-initial-group-size è®¾ç½®ä¸º 1 æ—¶ä¾¿ä¸è¿›è¡Œå¤åˆ¶äº†ã€‚ å¦‚æœé›†ç¾¤ä¸­å¢åŠ äº†æ–°çš„èŠ‚ç‚¹ï¼Œå¸Œæœ›é˜Ÿåˆ—ä¹Ÿè¢«å¤åˆ¶åˆ°æ–°çš„èŠ‚ç‚¹ä¸­ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œå°†æ–°çš„èŠ‚ç‚¹åŠ å…¥æˆå‘˜èŠ‚ç‚¹ä¸­: 12# rabbitmq-queues add_member [-p &lt;vhost&gt;] &lt;queue-name&gt; &lt;node&gt;rabbitmq-queues add_member -p /vtest q_4 rabbit@rabbitmq02 å¦‚æœå¸Œæœ›å°†èŠ‚ç‚¹ä»æˆå‘˜èŠ‚ç‚¹ä¸­ç§»é™¤ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤: 12# rabbitmq-queues delete_member [-p &lt;vhost&gt;] &lt;queue-name&gt; &lt;node&gt;rabbitmq-queues delete_member -p /vtest q_4 rabbit@rabbitmq02 å¦å¤–ï¼Œå½“é€šè¿‡ forget_cluster_node å‘½ä»¤ä»é›†ç¾¤ä¸­æ°¸ä¹…åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œä¼šè‡ªåŠ¨å°†é˜Ÿåˆ—å…³è”çš„èŠ‚ç‚¹ä»æˆå‘˜èŠ‚ç‚¹ä¸­ç§»é™¤ã€‚ åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤: 123456# å› ä¸ºè¦åˆ é™¤ rabbitmq04 èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä»¥ä¸‹å‘½ä»¤ä¸èƒ½åœ¨ rabbitmq04 èŠ‚ç‚¹æ‰§è¡Œ# åˆ é™¤å‰éœ€è¦å…ˆå…³é—­åº”ç”¨rabbitmqctl -n rabbit@rabbitmq04 stop_app# åˆ é™¤èŠ‚ç‚¹# rabbitmqctl forget_cluster_node &lt;node&gt;rabbitmqctl forget_cluster_node rabbit@rabbitmq04 æ–°å¢èŠ‚ç‚¹åï¼Œä¸€ä¸ªä¸ªçš„å¯¹åŸæœ‰çš„é˜Ÿåˆ—è¿›è¡Œå¤åˆ¶æ‰©å±•éå¸¸éº»çƒ¦ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¿«é€Ÿå¯¹ç¬¦åˆæ¡ä»¶çš„é˜Ÿåˆ—è¿›è¡Œå¤åˆ¶æ‰©å±•: 1234567891011121314# rabbitmq-queues grow &lt;node&gt; &lt;all | even&gt; [--vhost-pattern &lt;pattern&gt;] [--queue-pattern &lt;pattern&gt;]## å‚æ•°è¯´æ˜ï¼š# &lt;node&gt;: è¿™ä¸ªå‚æ•°æŒ‡å®šäº† RabbitMQ èŠ‚ç‚¹çš„åç§°ï¼Œé€šå¸¸æ˜¯ rabbit@&lt;hostname&gt;ã€‚å®ƒè¡¨ç¤ºåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¢é•¿æ“ä½œã€‚# &lt;all | even&gt;: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦æ‰©å±•çš„é˜Ÿåˆ—ç±»å‹ã€‚all è¡¨ç¤ºæ‰©å±•æ‰€æœ‰é˜Ÿåˆ—ï¼Œeven è¡¨ç¤ºæ‰©å±•å¶æ•°ç¼–å·çš„é˜Ÿåˆ—ã€‚# --vhost-pattern &lt;pattern&gt; ï¼ˆå¯é€‰ï¼‰: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦åŒ¹é…çš„è™šæ‹Ÿä¸»æœºåç§°ã€‚# --queue-pattern &lt;pattern&gt; ï¼ˆå¯é€‰ï¼‰: è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¦åŒ¹é…çš„é˜Ÿåˆ—åç§°ã€‚## ç¤ºä¾‹# æ‰©å±•æ‰€æœ‰è™šæ‹Ÿä¸»æœºä¸‹çš„æ‰€æœ‰é˜Ÿåˆ—çš„å‰¯æœ¬ï¼šrabbitmq-queues grow rabbit@rabbitmq04 all# æ‰©å±•æ‰€æœ‰è™šæ‹Ÿä¸»æœºä¸‹çš„å¶æ•°ç¼–å·çš„é˜Ÿåˆ—çš„å‰¯æœ¬ï¼šrabbitmq-queues grow rabbit@rabbitmq04 even# æ‰©å±•ç‰¹å®šè™šæ‹Ÿä¸»æœºå’Œé˜Ÿåˆ—åç§°çš„é˜Ÿåˆ—rabbitmq-queues grow rabbit@rabbitmq04 all --vhost-pattern /vtest --queue-pattern &quot;^q_&quot; Stream é˜Ÿåˆ— Stream é˜Ÿåˆ— ä¸ Quorum é˜Ÿåˆ— ç±»ä¼¼ï¼Œé€šè¿‡å“ªä¸ªèŠ‚ç‚¹åˆ›å»ºé˜Ÿåˆ—ï¼Œå“ªä¸ªèŠ‚ç‚¹å°±æ˜¯ Leaderï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡å‚æ•° x-queue-leader-locator æŒ‡å®šä¸»èŠ‚ç‚¹çš„é€‰æ‹©ç­–ç•¥ã€‚ åˆ›å»º Stream é˜Ÿåˆ—æ—¶ï¼Œé»˜è®¤å¤åˆ¶æ•°å°±æ˜¯å½“å‰é›†ç¾¤çš„èŠ‚ç‚¹æ•°ï¼ˆQuorum é˜Ÿåˆ— é»˜è®¤æ˜¯ 3ï¼‰ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šå‚æ•° x-initial-cluster-size è¿›è¡Œåˆå§‹è®¾ç½®ã€‚ æ·»åŠ æ–°çš„èŠ‚ç‚¹æ—¶ï¼Œä¸ Quorum é˜Ÿåˆ— ç±»ä¼¼ï¼ŒStream é˜Ÿåˆ— ä¹Ÿä¸ä¼šè‡ªåŠ¨è¿›è¡Œå¤åˆ¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ‰‹åŠ¨å¤åˆ¶ 12# rabbitmq-streams add_replica [-p &lt;vhost&gt;] &lt;stream-name&gt; &lt;node&gt;rabbitmq-streams add_replica -p /vtest sq_2 rabbit@rabbitmq02 åˆ é™¤æˆå‘˜èŠ‚ç‚¹æ—¶ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤: 12# rabbitmq-streams delete_replica [-p &lt;vhost&gt;] &lt;stream-name&gt; &lt;node&gt;rabbitmq-streams delete_replica -p /vtest sq_2 rabbit@rabbitmq02 æŸ¥çœ‹èŠ‚ç‚¹å¤åˆ¶çŠ¶æ€ 12# rabbitmq-streams stream_status [-p &lt;vhost&gt;] &lt;stream-name&gt;rabbitmq-streams stream_status -p /vtest sq_2 å½“æµå‡ºç°å¼‚å¸¸çŠ¶æ€ï¼ˆå¦‚å‰¯æœ¬åˆ†å¸ƒå¼‚å¸¸ã€é¢†å¯¼èŠ‚ç‚¹æŒ‚æ‰ï¼‰æ—¶ï¼Œä¸ºäº†æ¢å¤å¯ç”¨æ€§ï¼Œå¯ä»¥é‡å¯æµ 123456# rabbitmq-streams restart_stream [-p &lt;vhost&gt;] &lt;stream-name&gt;rabbitmq-streams restart_stream -p /vtest sq_2## é‡å¯æ“ä½œ# 1.åœæ­¢æµçš„å½“å‰å‰¯æœ¬/åˆ†åŒºã€‚# 2.é‡æ–°åˆå§‹åŒ–æµçš„å­˜å‚¨å’Œå…ƒæ•°æ®ã€‚# 3.è®©æµåœ¨é›†ç¾¤ä¸­æ¢å¤ä¸ºå¯ç”¨çŠ¶æ€ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Cluster çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹","date_published":"2025-09-25T14:30:05.000Z","tags":["æŠ€æœ¯","rabbitmq","åˆ†å¸ƒå¼","rabbitmq"]},{"id":"https://blog.hanqunfeng.com/2025/09/21/rabbitmq-message/","url":"https://blog.hanqunfeng.com/2025/09/21/rabbitmq-message/","title":"RabbitMQ ä¹‹ Message","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Message çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo\">Java Client ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Message-æ¶ˆæ¯-æ˜¯ä»€ä¹ˆï¼Ÿ\">Message(æ¶ˆæ¯) æ˜¯ä»€ä¹ˆï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ RabbitMQ ä¸­ï¼ŒMessageï¼ˆæ¶ˆæ¯ï¼‰æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®å•å…ƒã€‚æ¶ˆæ¯åŒ…å«æ¶ˆæ¯å†…å®¹ã€æ¶ˆæ¯å±æ€§ç­‰ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Message ç»„æˆï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">\n<ol>\n<li class=\"lvl-7\">æ¶ˆæ¯å†…å®¹ï¼šæ¶ˆæ¯çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä»»æ„æ•°æ®ã€‚</li>\n</ol>\n</li>\n<li class=\"lvl-4\">\n<ol start=\"2\">\n<li class=\"lvl-7\">æ¶ˆæ¯å±æ€§ï¼šæ¶ˆæ¯çš„å±æ€§ï¼Œå¦‚æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ã€æ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€æ¶ˆæ¯çš„æ ‡ç­¾ç­‰ã€‚</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Web-æ§åˆ¶å°-ä¸­-Message-çš„ä½¿ç”¨\">Web æ§åˆ¶å° ä¸­ Message çš„ä½¿ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ Exchange å’Œ Queue çš„ç®¡ç†ç•Œé¢ä¸­ï¼Œéƒ½å¯ä»¥åœ¨å…¶è¯¦æƒ…é¡µé¢æµ‹è¯• Message çš„ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…³äºå¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨ Messageï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­è¯¦ç»†ä»‹ç»ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Publish-message\">Publish message</h3>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/dHsDyt.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Payloadï¼šæ¶ˆæ¯çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä»»æ„æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Payload encodingï¼šæ¶ˆæ¯å†…å®¹çš„ç¼–ç æ–¹å¼ï¼Œ<code>String</code> æˆ–è€… <code>Base64</code>ï¼Œé»˜è®¤ä¸º <code>String</code>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Delivery modeï¼šæ¶ˆæ¯çš„æŒä¹…åŒ–æ¨¡å¼ï¼Œ1-Non-persistent è¡¨ç¤ºéæŒä¹…åŒ–ï¼Œ2-Persistent è¡¨ç¤ºæŒä¹…åŒ–ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Headersï¼šæ¶ˆæ¯çš„å¤´ä¿¡æ¯ï¼Œç”¨äºä¸ <code>Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰</code>ä¸­çš„é…ç½®è¿›è¡ŒåŒ¹é…ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Propertiesï¼šæ¶ˆæ¯çš„å±æ€§ï¼Œå¦‚æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ã€æ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€æ¶ˆæ¯çš„æ ‡ç­¾ç­‰ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å±æ€§å</th>\n<th>ä¸­æ–‡å«ä¹‰</th>\n<th>æ•°æ®ç±»å‹</th>\n<th>é»˜è®¤å€¼</th>\n<th>å…¸å‹ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>content_type</td>\n<td>å†…å®¹ç±»å‹</td>\n<td>String</td>\n<td>null</td>\n<td>æŒ‡å®šæ¶ˆæ¯çš„ MIME ç±»å‹ï¼Œå¦‚ <code>&quot;text/plain&quot;</code>ã€<code>&quot;application/json&quot;</code></td>\n</tr>\n<tr>\n<td>content_encoding</td>\n<td>å†…å®¹ç¼–ç </td>\n<td>String</td>\n<td>null</td>\n<td>æŒ‡å®šæ¶ˆæ¯å†…å®¹çš„ç¼–ç æ–¹å¼ï¼Œå¦‚ <code>&quot;gzip&quot;</code></td>\n</tr>\n<tr>\n<td>priority</td>\n<td>æ¶ˆæ¯ä¼˜å…ˆçº§</td>\n<td>Integer (0-255)</td>\n<td>0</td>\n<td>ç»“åˆ <code>x-max-priority</code> æ§åˆ¶æ¶ˆæ¯å¤„ç†é¡ºåºï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜</td>\n</tr>\n<tr>\n<td>correlation_id</td>\n<td>å…³è” ID</td>\n<td>String</td>\n<td>null</td>\n<td>RPC æ¨¡å¼ä¸­å…³è”è¯·æ±‚ä¸å“åº”</td>\n</tr>\n<tr>\n<td>reply_to</td>\n<td>å›å¤é˜Ÿåˆ—å</td>\n<td>String</td>\n<td>null</td>\n<td>RPC æ¨¡å¼ä¸­æŒ‡å®šå“åº”æ¶ˆæ¯çš„è¿”å›é˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td>expiration</td>\n<td>æ¶ˆæ¯è¿‡æœŸæ—¶é—´</td>\n<td>String (ms)</td>\n<td>null</td>\n<td>æ¶ˆæ¯çš„ TTLï¼Œæ¯«ç§’ä¸ºå•ä½ï¼Œè¿‡æœŸåå°†è¢«ä¸¢å¼ƒæˆ–è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td>message_id</td>\n<td>æ¶ˆæ¯ ID</td>\n<td>String</td>\n<td>null</td>\n<td>å”¯ä¸€æ ‡è¯†ä¸€æ¡æ¶ˆæ¯ï¼Œé€šå¸¸ç”±ç”Ÿäº§è€…æŒ‡å®š</td>\n</tr>\n<tr>\n<td>timestamp</td>\n<td>æ—¶é—´æˆ³</td>\n<td>Date / Long</td>\n<td>null</td>\n<td>æ¶ˆæ¯å‘é€æ—¶é—´ï¼Œé€šå¸¸æ˜¯ Unix æ—¶é—´æˆ³</td>\n</tr>\n<tr>\n<td>type</td>\n<td>æ¶ˆæ¯ç±»å‹</td>\n<td>String</td>\n<td>null</td>\n<td>æè¿°æ¶ˆæ¯ç±»å‹ï¼Œå¦‚ <code>&quot;order&quot;</code> æˆ– <code>&quot;event&quot;</code></td>\n</tr>\n<tr>\n<td>user_id</td>\n<td>ç”¨æˆ· ID</td>\n<td>String</td>\n<td>null</td>\n<td>æ ‡è¯†å‘é€æ¶ˆæ¯çš„ç”¨æˆ·ï¼Œé€šå¸¸ç”¨äºå®‰å…¨æˆ–å®¡è®¡</td>\n</tr>\n<tr>\n<td>app_id</td>\n<td>åº”ç”¨ ID</td>\n<td>String</td>\n<td>null</td>\n<td>æ ‡è¯†å‘é€æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº</td>\n</tr>\n<tr>\n<td>cluster_id</td>\n<td>é›†ç¾¤ ID</td>\n<td>String</td>\n<td>null</td>\n<td>RabbitMQ é›†ç¾¤ IDï¼Œå®é™…ä¸­å¾ˆå°‘ä½¿ç”¨</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸é˜Ÿåˆ—é‡å çš„å±æ€§ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°åç§°</th>\n<th>é˜Ÿåˆ—å‚æ•°ï¼ˆQueue Argumentsï¼‰</th>\n<th>æ¶ˆæ¯å±æ€§ï¼ˆMessage Propertiesï¼‰</th>\n<th>è°çš„ä¼˜å…ˆçº§æ›´é«˜ / ç”Ÿæ•ˆæ–¹å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>priority / x-max-priority</strong></td>\n<td><code>x-max-priority</code>: å®šä¹‰é˜Ÿåˆ—æ”¯æŒçš„<strong>æœ€å¤§ä¼˜å…ˆçº§å€¼</strong></td>\n<td><code>priority</code>: ä¸ºå•ä¸ªæ¶ˆæ¯è®¾ç½®ä¼˜å…ˆçº§</td>\n<td>é˜Ÿåˆ—å…ˆå®šä¹‰èŒƒå›´ï¼Œæ¶ˆæ¯åªèƒ½åœ¨è¿™ä¸ªèŒƒå›´å†…å–å€¼ <br> è‹¥ <code>priority &gt; x-max-priority</code>ï¼Œåˆ™ä»¥<code>x-max-priority</code>ä¸ºå‡†</td>\n</tr>\n<tr>\n<td><strong>expiration / x-message-ttl</strong></td>\n<td><code>x-message-ttl</code>: é˜Ÿåˆ—çº§åˆ«çš„æ¶ˆæ¯<strong>ç»Ÿä¸€ TTL</strong></td>\n<td><code>expiration</code>: ä¸ºå•ä¸ªæ¶ˆæ¯è®¾ç½® TTLï¼ˆæ¯«ç§’ï¼‰</td>\n<td>å¦‚æœåŒæ—¶è®¾ç½®ï¼Œ<strong>è¾ƒçŸ­çš„ TTL</strong> ä¼šç”Ÿæ•ˆ</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"Get-message\">Get message</h3>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/Ar9qob.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Ack Modeï¼šæ¶ˆæ¯ç¡®è®¤æ¨¡å¼</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Nack message requeue true: ç¡®è®¤å¤±è´¥ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿï¼Œè¿™æ˜¯é»˜è®¤é€‰æ‹©ï¼Œä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•åæ¶ˆæ¯ä¾æ—§å­˜åœ¨ã€‚</li>\n<li class=\"lvl-4\">Automatic ack: è‡ªåŠ¨ç¡®è®¤</li>\n<li class=\"lvl-4\">Reject requeue true: æ‹’ç»ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ</li>\n<li class=\"lvl-4\">Reject requeue false: æ‹’ç»ï¼Œæ¶ˆæ¯ä¸é‡æ–°å…¥é˜Ÿ</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Encodingï¼šæ¶ˆæ¯å†…å®¹ç¼–ç æ–¹å¼</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\"><code>Auto String / Base64</code>ï¼Œé»˜è®¤ã€‚å¦‚æœæ¶ˆæ¯è½½è·å¯ä»¥è§£é‡Šä¸ºUTF-8ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå°±æ˜¯ <code>String</code>ï¼Œå¦åˆ™å°±æ˜¯ <code>Base64</code>ã€‚</li>\n<li class=\"lvl-4\"><code>Base64</code>ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Messages: ä¸€æ¬¡è·å–æ¶ˆæ¯æ•°é‡ï¼Œé»˜è®¤ä¸º 1ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Message çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹ Message(æ¶ˆæ¯) æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨ RabbitMQ ä¸­ï¼ŒMessageï¼ˆæ¶ˆæ¯ï¼‰æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®å•å…ƒã€‚æ¶ˆæ¯åŒ…å«æ¶ˆæ¯å†…å®¹ã€æ¶ˆæ¯å±æ€§ç­‰ä¿¡æ¯ã€‚ Message ç»„æˆï¼š æ¶ˆæ¯å†…å®¹ï¼šæ¶ˆæ¯çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä»»æ„æ•°æ®ã€‚ æ¶ˆæ¯å±æ€§ï¼šæ¶ˆæ¯çš„å±æ€§ï¼Œå¦‚æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ã€æ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€æ¶ˆæ¯çš„æ ‡ç­¾ç­‰ã€‚ Web æ§åˆ¶å° ä¸­ Message çš„ä½¿ç”¨ åœ¨ Exchange å’Œ Queue çš„ç®¡ç†ç•Œé¢ä¸­ï¼Œéƒ½å¯ä»¥åœ¨å…¶è¯¦æƒ…é¡µé¢æµ‹è¯• Message çš„ä½¿ç”¨ã€‚ å…³äºå¦‚ä½•åœ¨ä»£ç ä¸­ä½¿ç”¨ Messageï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­è¯¦ç»†ä»‹ç»ã€‚ Publish message Payloadï¼šæ¶ˆæ¯çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä»»æ„æ•°æ®ã€‚ Payload encodingï¼šæ¶ˆæ¯å†…å®¹çš„ç¼–ç æ–¹å¼ï¼ŒString æˆ–è€… Base64ï¼Œé»˜è®¤ä¸º Stringã€‚ Delivery modeï¼šæ¶ˆæ¯çš„æŒä¹…åŒ–æ¨¡å¼ï¼Œ1-Non-persistent è¡¨ç¤ºéæŒä¹…åŒ–ï¼Œ2-Persistent è¡¨ç¤ºæŒä¹…åŒ–ã€‚ Headersï¼šæ¶ˆæ¯çš„å¤´ä¿¡æ¯ï¼Œç”¨äºä¸ Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰ä¸­çš„é…ç½®è¿›è¡ŒåŒ¹é…ã€‚ Propertiesï¼šæ¶ˆæ¯çš„å±æ€§ï¼Œå¦‚æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ã€æ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€æ¶ˆæ¯çš„æ ‡ç­¾ç­‰ã€‚ å±æ€§å ä¸­æ–‡å«ä¹‰ æ•°æ®ç±»å‹ é»˜è®¤å€¼ å…¸å‹ç”¨é€” content_type å†…å®¹ç±»å‹ String null æŒ‡å®šæ¶ˆæ¯çš„ MIME ç±»å‹ï¼Œå¦‚ &quot;text/plain&quot;ã€&quot;application/json&quot; content_encoding å†…å®¹ç¼–ç  String null æŒ‡å®šæ¶ˆæ¯å†…å®¹çš„ç¼–ç æ–¹å¼ï¼Œå¦‚ &quot;gzip&quot; priority æ¶ˆæ¯ä¼˜å…ˆçº§ Integer (0-255) 0 ç»“åˆ x-max-priority æ§åˆ¶æ¶ˆæ¯å¤„ç†é¡ºåºï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ correlation_id å…³è” ID String null RPC æ¨¡å¼ä¸­å…³è”è¯·æ±‚ä¸å“åº” reply_to å›å¤é˜Ÿåˆ—å String null RPC æ¨¡å¼ä¸­æŒ‡å®šå“åº”æ¶ˆæ¯çš„è¿”å›é˜Ÿåˆ— expiration æ¶ˆæ¯è¿‡æœŸæ—¶é—´ String (ms) null æ¶ˆæ¯çš„ TTLï¼Œæ¯«ç§’ä¸ºå•ä½ï¼Œè¿‡æœŸåå°†è¢«ä¸¢å¼ƒæˆ–è¿›å…¥æ­»ä¿¡é˜Ÿåˆ— message_id æ¶ˆæ¯ ID String null å”¯ä¸€æ ‡è¯†ä¸€æ¡æ¶ˆæ¯ï¼Œé€šå¸¸ç”±ç”Ÿäº§è€…æŒ‡å®š timestamp æ—¶é—´æˆ³ Date / Long null æ¶ˆæ¯å‘é€æ—¶é—´ï¼Œé€šå¸¸æ˜¯ Unix æ—¶é—´æˆ³ type æ¶ˆæ¯ç±»å‹ String null æè¿°æ¶ˆæ¯ç±»å‹ï¼Œå¦‚ &quot;order&quot; æˆ– &quot;event&quot; user_id ç”¨æˆ· ID String null æ ‡è¯†å‘é€æ¶ˆæ¯çš„ç”¨æˆ·ï¼Œé€šå¸¸ç”¨äºå®‰å…¨æˆ–å®¡è®¡ app_id åº”ç”¨ ID String null æ ‡è¯†å‘é€æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº cluster_id é›†ç¾¤ ID String null RabbitMQ é›†ç¾¤ IDï¼Œå®é™…ä¸­å¾ˆå°‘ä½¿ç”¨ ä¸é˜Ÿåˆ—é‡å çš„å±æ€§ï¼š å‚æ•°åç§° é˜Ÿåˆ—å‚æ•°ï¼ˆQueue Argumentsï¼‰ æ¶ˆæ¯å±æ€§ï¼ˆMessage Propertiesï¼‰ è°çš„ä¼˜å…ˆçº§æ›´é«˜ / ç”Ÿæ•ˆæ–¹å¼ priority / x-max-priority x-max-priority: å®šä¹‰é˜Ÿåˆ—æ”¯æŒçš„æœ€å¤§ä¼˜å…ˆçº§å€¼ priority: ä¸ºå•ä¸ªæ¶ˆæ¯è®¾ç½®ä¼˜å…ˆçº§ é˜Ÿåˆ—å…ˆå®šä¹‰èŒƒå›´ï¼Œæ¶ˆæ¯åªèƒ½åœ¨è¿™ä¸ªèŒƒå›´å†…å–å€¼ è‹¥ priority &gt; x-max-priorityï¼Œåˆ™ä»¥x-max-priorityä¸ºå‡† expiration / x-message-ttl x-message-ttl: é˜Ÿåˆ—çº§åˆ«çš„æ¶ˆæ¯ç»Ÿä¸€ TTL expiration: ä¸ºå•ä¸ªæ¶ˆæ¯è®¾ç½® TTLï¼ˆæ¯«ç§’ï¼‰ å¦‚æœåŒæ—¶è®¾ç½®ï¼Œè¾ƒçŸ­çš„ TTL ä¼šç”Ÿæ•ˆ Get message Ack Modeï¼šæ¶ˆæ¯ç¡®è®¤æ¨¡å¼ Nack message requeue true: ç¡®è®¤å¤±è´¥ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿï¼Œè¿™æ˜¯é»˜è®¤é€‰æ‹©ï¼Œä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•åæ¶ˆæ¯ä¾æ—§å­˜åœ¨ã€‚ Automatic ack: è‡ªåŠ¨ç¡®è®¤ Reject requeue true: æ‹’ç»ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ Reject requeue false: æ‹’ç»ï¼Œæ¶ˆæ¯ä¸é‡æ–°å…¥é˜Ÿ Encodingï¼šæ¶ˆæ¯å†…å®¹ç¼–ç æ–¹å¼ Auto String / Base64ï¼Œé»˜è®¤ã€‚å¦‚æœæ¶ˆæ¯è½½è·å¯ä»¥è§£é‡Šä¸ºUTF-8ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå°±æ˜¯ Stringï¼Œå¦åˆ™å°±æ˜¯ Base64ã€‚ Base64ã€‚ Messages: ä¸€æ¬¡è·å–æ¶ˆæ¯æ•°é‡ï¼Œé»˜è®¤ä¸º 1ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Message çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹","date_published":"2025-09-21T14:30:05.000Z","tags":["æŠ€æœ¯","rabbitmq","åˆ†å¸ƒå¼","rabbitmq"]},{"id":"https://blog.hanqunfeng.com/2025/09/21/rabbitmq-exchange/","url":"https://blog.hanqunfeng.com/2025/09/21/rabbitmq-exchange/","title":"RabbitMQ ä¹‹ Exchange","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Exchange çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo\">Java Client ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Exchange-äº¤æ¢æœº-æ˜¯ä»€ä¹ˆï¼Ÿ\">Exchange(äº¤æ¢æœº) æ˜¯ä»€ä¹ˆï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ RabbitMQ ä¸­ï¼Œ<a href=\"https://www.rabbitmq.com/docs/exchanges\">Exchangeï¼ˆäº¤æ¢æœºï¼‰</a> æ˜¯æ¶ˆæ¯è·¯ç”±çš„æ ¸å¿ƒç»„ä»¶ã€‚å®ƒè´Ÿè´£æ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®é¢„å®šä¹‰çš„è·¯ç”±è§„åˆ™å°†æ¶ˆæ¯è½¬å‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Exchange ç±»å‹å†³å®šäº†æ¶ˆæ¯çš„è·¯ç”±æ–¹å¼ã€‚RabbitMQ æ”¯æŒçš„ Exchange ç±»å‹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Exchange ç±»å‹</th>\n<th>å£°æ˜ç±»å‹</th>\n<th>è·¯ç”±è§„åˆ™æè¿°</th>\n<th>å…¸å‹ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Direct</strong></td>\n<td><code>direct</code></td>\n<td>æ¶ˆæ¯æ ¹æ® <strong>è·¯ç”±é”®ï¼ˆrouting keyï¼‰</strong> ç²¾ç¡®åŒ¹é…ç»‘å®šé”®ï¼ˆbinding keyï¼‰è¿›è¡Œè·¯ç”±ã€‚</td>\n<td>ç²¾ç¡®æ¶ˆæ¯ä¼ é€’ï¼Œå¦‚æ—¥å¿—åˆ†ç±»ã€ä»»åŠ¡åˆ†å‘ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>Fanout</strong></td>\n<td><code>fanout</code></td>\n<td>æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼Œ<strong>å¿½ç•¥è·¯ç”±é”®</strong>ã€‚</td>\n<td>å¹¿æ’­æ¶ˆæ¯ï¼Œå¦‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€å®æ—¶é€šçŸ¥ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>Topic</strong></td>\n<td><code>topic</code></td>\n<td>æ¶ˆæ¯æ ¹æ®è·¯ç”±é”®ä¸ç»‘å®šé”®æ¨¡å¼çš„åŒ¹é…è¿›è¡Œè·¯ç”±ï¼Œæ”¯æŒé€šé…ç¬¦ <code>*</code>ï¼ˆåŒ¹é…ä¸€ä¸ªè¯ï¼‰å’Œ <code>#</code>ï¼ˆåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯ï¼‰ã€‚</td>\n<td>æ¨¡å—åŒ–è·¯ç”±ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>Headers</strong></td>\n<td><code>headers</code></td>\n<td>æ¶ˆæ¯æ ¹æ® <strong>æ¶ˆæ¯å¤´éƒ¨ï¼ˆheadersï¼‰</strong> ä¸ç»‘å®šæ—¶æŒ‡å®šçš„å¤´éƒ¨åŒ¹é…è¿›è¡Œè·¯ç”±ï¼Œæ”¯æŒ <code>x-match</code> å‚æ•°ï¼ˆ<code>any</code> æˆ– <code>all</code>ï¼‰ã€‚</td>\n<td>å¤šæ¡ä»¶è·¯ç”±ï¼Œå¦‚å¤æ‚è¿‡æ»¤ã€åŠ¨æ€è·¯ç”±ç­‰ã€‚</td>\n</tr>\n<tr>\n<td><strong>Local Random Exchange</strong></td>\n<td><code>x-local-random</code></td>\n<td>æ¶ˆæ¯å§‹ç»ˆè¢«è·¯ç”±åˆ°æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å¤šä¸ªæœ¬åœ°é˜Ÿåˆ—ç»‘å®šï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡ŒæŠ•é€’ã€‚</td>\n<td>è¯·æ±‚-å“åº”ï¼ˆRPCï¼‰æ¨¡å¼ï¼Œä½å»¶è¿Ÿé€šä¿¡</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ é»˜è®¤ä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹çš„äº¤æ¢æœº<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/SKlqQK.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯æ–°åˆ›å»ºä¸€ä¸ª Vhostï¼ŒRabbitMQ å°±ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹äº¤æ¢æœºï¼Œæ¯”å¦‚ <code>/vtest</code><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/oGJ1oj.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæ–°çš„äº¤æ¢æœº<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/QjnZin.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>é…ç½®è¯´æ˜</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">Durability: æŒ‡å®š Exchange æ˜¯å¦æŒä¹…åŒ–ã€‚\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">Durable: æŒä¹…åŒ–çš„ Exchange ä¼šè¢«ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œé‡å¯ RabbitMQ æ—¶ä¼šè‡ªåŠ¨æ¢å¤ã€‚</li>\n<li class=\"lvl-6\">Transient: éæŒä¹…åŒ–çš„ Exchange ä¼šè¢«ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé‡å¯ RabbitMQ æ—¶ä¼šä¸¢å¤±ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">Auto-delete: æŒ‡å®š Exchange æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">yes: å¦‚æœæ²¡æœ‰é˜Ÿåˆ—æˆ–äº¤æ¢æœºç»‘å®šè¯¥ Exchangeï¼Œåˆ™è¯¥ Exchange ä¼šè‡ªåŠ¨åˆ é™¤ã€‚</li>\n<li class=\"lvl-6\">no: è¯¥ Exchange ä¸ä¼šè‡ªåŠ¨åˆ é™¤ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">Internal: ç”¨äºæ§åˆ¶äº¤æ¢æœºæ˜¯å¦å¯ä»¥è¢«ç”Ÿäº§è€…ç›´æ¥å‘å¸ƒæ¶ˆæ¯\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">yes: ä¸èƒ½è¢«ç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯ï¼Œè¯¥äº¤æ¢æœºåªèƒ½ç”¨äº å°†æ¶ˆæ¯ä»å…¶ä»–äº¤æ¢æœºè½¬å‘åˆ°è¯¥äº¤æ¢æœºã€‚</li>\n<li class=\"lvl-6\">no: å¯ä»¥è¢«ç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">Arguments: ç”¨äºè®¾ç½® Exchange çš„å…¶ä»–å‚æ•°ï¼Œç›®å‰ä»…æ”¯æŒä¸€ä¸ªå‚æ•°\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">Alternate exchange(alternate-exchange): æŒ‡å®šè¯¥ Exchange çš„å¤‡ç”¨äº¤æ¢æœºï¼Œå¦‚æœæ— æ³•ä»¥å…¶ä»–æ–¹å¼å°†å‘å¾€æ­¤äº¤æ¢æœºçš„æ¶ˆæ¯è·¯ç”±å‡ºå»ï¼Œåˆ™å°†å®ƒä»¬å‘é€è‡³æ­¤å¤„æŒ‡å®šçš„å¤‡ç”¨äº¤æ¢æœºã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Direct-Exchangeï¼ˆç›´æ¥äº¤æ¢æœºï¼‰\">Direct Exchangeï¼ˆç›´æ¥äº¤æ¢æœºï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®å®Œå…¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šé”®ä¸º errorï¼Œåˆ™åªæœ‰è·¯ç”±é”®ä¸º error çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šéœ€è¦ç²¾ç¡®åŒ¹é…çš„åœºæ™¯ï¼Œå¦‚æ—¥å¿—åˆ†ç±»ã€ä»»åŠ¡åˆ†å‘ç­‰ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Fanout-Exchangeï¼ˆæ‰‡å‡ºäº¤æ¢æœºï¼‰\">Fanout Exchangeï¼ˆæ‰‡å‡ºäº¤æ¢æœºï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå¿½ç•¥è·¯ç”±é”®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šæ— è®ºæ¶ˆæ¯çš„è·¯ç”±é”®æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šè¢«è·¯ç”±åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šå¹¿æ’­æ¶ˆæ¯ï¼Œå¦‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€å®æ—¶é€šçŸ¥ç­‰ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Topic-Exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰\">Topic Exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®æ¨¡å¼åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚æ”¯æŒé€šé…ç¬¦ *ï¼ˆåŒ¹é…ä¸€ä¸ªè¯ï¼‰å’Œ #ï¼ˆåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šé”®ä¸º <em>.orange.</em>ï¼Œåˆ™è·¯ç”±é”®ä¸º quick.orange.rabbit çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šæ¨¡å—åŒ–è·¯ç”±ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Headers-Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰\">Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„å¤´éƒ¨ä¸é˜Ÿåˆ—çš„ç»‘å®šå¤´éƒ¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚æ”¯æŒ x-match å‚æ•°ï¼ˆany æˆ– allï¼‰ã€‚å³ä½¿é…ç½®äº†è·¯ç”±é”®ä¹Ÿä¼šå¿½ç•¥ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šå¤´éƒ¨ä¸º { â€œx-matchâ€: â€œallâ€, â€œformatâ€: â€œpdfâ€, â€œpriorityâ€: â€œhighâ€ }ï¼Œåˆ™åªæœ‰åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šå¤šæ¡ä»¶è·¯ç”±ï¼Œå¦‚å¤æ‚è¿‡æ»¤ã€åŠ¨æ€è·¯ç”±ç­‰ã€‚</p>\n</li>\n</ul>\n<h2 id=\"Local-Random-Exchangeï¼ˆæœ¬åœ°éšæœºäº¤æ¢æœºï¼‰\">Local Random Exchangeï¼ˆæœ¬åœ°éšæœºäº¤æ¢æœºï¼‰</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Local Random Exchange æ˜¯ RabbitMQ 4.0 å¼•å…¥çš„äº¤æ¢æœºç±»å‹ï¼Œæ—¨åœ¨ä¼˜åŒ–<code>è¯·æ±‚-å“åº”</code>æ¨¡å¼ä¸‹çš„æ¶ˆæ¯è·¯ç”±ï¼Œç‰¹åˆ«é€‚ç”¨äºä½å»¶è¿Ÿå’Œé«˜ååé‡çš„åœºæ™¯ã€‚é€šè¿‡ç»“åˆç‹¬å é˜Ÿåˆ—ä½¿ç”¨ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯å¿«é€Ÿä¼ é€’åˆ°æœ¬åœ°æ¶ˆè´¹è€…ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯å§‹ç»ˆè¢«è·¯ç”±åˆ°æœ¬åœ°é˜Ÿåˆ—ï¼ˆä½äºåŒä¸€èŠ‚ç‚¹ä¸Šï¼‰ï¼Œå¦‚æœæœ‰å¤šä¸ªæœ¬åœ°é˜Ÿåˆ—ç»‘å®šï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡ŒæŠ•é€’ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹ï¼šå‡è®¾èŠ‚ç‚¹ A ä¸Šæœ‰ä¸¤ä¸ªç»‘å®šäº† x-local-random äº¤æ¢æœºçš„é˜Ÿåˆ— Q1 å’Œ Q2ï¼Œå‘å¸ƒçš„æ¶ˆæ¯ä¼šéšæœºè·¯ç”±åˆ° Q1 æˆ– Q2ï¼Œä½†ä¸ä¼šè·¯ç”±åˆ°å…¶ä»–èŠ‚ç‚¹çš„é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨åœºæ™¯ï¼šè¯·æ±‚-å“åº”ï¼ˆRPCï¼‰æ¨¡å¼ä¸‹çš„ä½å»¶è¿Ÿé€šä¿¡ï¼Œé€‚åˆå¾®æœåŠ¡æ¶æ„ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰æ¶ˆè´¹è€…çš„åœºæ™¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ä½¿ç”¨ Local Random Exchange æ—¶ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ç‹¬å é˜Ÿåˆ—ï¼šæ¶ˆè´¹è€…åº”å£°æ˜ç‹¬å é˜Ÿåˆ—ï¼Œä»¥ç¡®ä¿é˜Ÿåˆ—ä»…ç»‘å®šåˆ°å½“å‰èŠ‚ç‚¹ã€‚</li>\n<li class=\"lvl-4\">æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘ä¸€ä¸ªæ¶ˆè´¹è€…ï¼šæ¯ä¸ª RabbitMQ èŠ‚ç‚¹ä¸Šåº”è‡³å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¦åˆ™åœ¨è¯¥èŠ‚ç‚¹ä¸Šå‘å¸ƒçš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒã€‚</li>\n<li class=\"lvl-4\">äº¤æ¢æœºç±»å‹å£°æ˜ï¼šä½¿ç”¨ <code>x-local-random</code> ç±»å‹å£°æ˜äº¤æ¢æœºã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Exchange-ä¸-Queue-ç»‘å®š-Binding\">Exchange ä¸ Queue ç»‘å®š(Binding)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºå¥½ Exchange ä¹‹åï¼Œéœ€è¦å°† Exchange ä¸ Queue ç»‘å®šï¼Œæ‰èƒ½å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Exchange ä¸ Queue çš„ç»‘å®šå…³ç³»ï¼Œå³ Exchange å‘é€çš„æ¶ˆæ¯ï¼Œä¼šæ ¹æ®è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ Exchange é¡µé¢ç‚¹å‡» Exchange çš„åç§°ï¼Œè¿›å…¥ Exchange è¯¦æƒ…é¡µé¢ï¼Œæ­¤å¤„å¯ä»¥è¿›è¡Œ Exchange ä¸ Queue ç»‘å®šé…ç½®<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/taKUjm.png\" alt=\"\"></p>\n<blockquote>\n<p>è¿™é‡Œçš„<code>Arguments</code>ç”¨äºè®¾ç½® ç»‘å®š çš„å…¶ä»–å‚æ•°ï¼Œæ¯”å¦‚ <code>Headers Exchange</code> éœ€è¦è®¾ç½® <code>x-match</code> å‚æ•°ç­‰ã€‚</p>\n</blockquote>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Exchange çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹ Exchange(äº¤æ¢æœº) æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨ RabbitMQ ä¸­ï¼ŒExchangeï¼ˆäº¤æ¢æœºï¼‰ æ˜¯æ¶ˆæ¯è·¯ç”±çš„æ ¸å¿ƒç»„ä»¶ã€‚å®ƒè´Ÿè´£æ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®é¢„å®šä¹‰çš„è·¯ç”±è§„åˆ™å°†æ¶ˆæ¯è½¬å‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚ Exchange ç±»å‹å†³å®šäº†æ¶ˆæ¯çš„è·¯ç”±æ–¹å¼ã€‚RabbitMQ æ”¯æŒçš„ Exchange ç±»å‹ Exchange ç±»å‹ å£°æ˜ç±»å‹ è·¯ç”±è§„åˆ™æè¿° å…¸å‹ç”¨é€” Direct direct æ¶ˆæ¯æ ¹æ® è·¯ç”±é”®ï¼ˆrouting keyï¼‰ ç²¾ç¡®åŒ¹é…ç»‘å®šé”®ï¼ˆbinding keyï¼‰è¿›è¡Œè·¯ç”±ã€‚ ç²¾ç¡®æ¶ˆæ¯ä¼ é€’ï¼Œå¦‚æ—¥å¿—åˆ†ç±»ã€ä»»åŠ¡åˆ†å‘ç­‰ã€‚ Fanout fanout æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå¿½ç•¥è·¯ç”±é”®ã€‚ å¹¿æ’­æ¶ˆæ¯ï¼Œå¦‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€å®æ—¶é€šçŸ¥ç­‰ã€‚ Topic topic æ¶ˆæ¯æ ¹æ®è·¯ç”±é”®ä¸ç»‘å®šé”®æ¨¡å¼çš„åŒ¹é…è¿›è¡Œè·¯ç”±ï¼Œæ”¯æŒé€šé…ç¬¦ *ï¼ˆåŒ¹é…ä¸€ä¸ªè¯ï¼‰å’Œ #ï¼ˆåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯ï¼‰ã€‚ æ¨¡å—åŒ–è·¯ç”±ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚ Headers headers æ¶ˆæ¯æ ¹æ® æ¶ˆæ¯å¤´éƒ¨ï¼ˆheadersï¼‰ ä¸ç»‘å®šæ—¶æŒ‡å®šçš„å¤´éƒ¨åŒ¹é…è¿›è¡Œè·¯ç”±ï¼Œæ”¯æŒ x-match å‚æ•°ï¼ˆany æˆ– allï¼‰ã€‚ å¤šæ¡ä»¶è·¯ç”±ï¼Œå¦‚å¤æ‚è¿‡æ»¤ã€åŠ¨æ€è·¯ç”±ç­‰ã€‚ Local Random Exchange x-local-random æ¶ˆæ¯å§‹ç»ˆè¢«è·¯ç”±åˆ°æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å¤šä¸ªæœ¬åœ°é˜Ÿåˆ—ç»‘å®šï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡ŒæŠ•é€’ã€‚ è¯·æ±‚-å“åº”ï¼ˆRPCï¼‰æ¨¡å¼ï¼Œä½å»¶è¿Ÿé€šä¿¡ RabbitMQ é»˜è®¤ä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹çš„äº¤æ¢æœº æ¯æ–°åˆ›å»ºä¸€ä¸ª Vhostï¼ŒRabbitMQ å°±ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹äº¤æ¢æœºï¼Œæ¯”å¦‚ /vtest å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæ–°çš„äº¤æ¢æœº é…ç½®è¯´æ˜ Durability: æŒ‡å®š Exchange æ˜¯å¦æŒä¹…åŒ–ã€‚ Durable: æŒä¹…åŒ–çš„ Exchange ä¼šè¢«ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œé‡å¯ RabbitMQ æ—¶ä¼šè‡ªåŠ¨æ¢å¤ã€‚ Transient: éæŒä¹…åŒ–çš„ Exchange ä¼šè¢«ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé‡å¯ RabbitMQ æ—¶ä¼šä¸¢å¤±ã€‚ Auto-delete: æŒ‡å®š Exchange æ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚ yes: å¦‚æœæ²¡æœ‰é˜Ÿåˆ—æˆ–äº¤æ¢æœºç»‘å®šè¯¥ Exchangeï¼Œåˆ™è¯¥ Exchange ä¼šè‡ªåŠ¨åˆ é™¤ã€‚ no: è¯¥ Exchange ä¸ä¼šè‡ªåŠ¨åˆ é™¤ã€‚ Internal: ç”¨äºæ§åˆ¶äº¤æ¢æœºæ˜¯å¦å¯ä»¥è¢«ç”Ÿäº§è€…ç›´æ¥å‘å¸ƒæ¶ˆæ¯ yes: ä¸èƒ½è¢«ç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯ï¼Œè¯¥äº¤æ¢æœºåªèƒ½ç”¨äº å°†æ¶ˆæ¯ä»å…¶ä»–äº¤æ¢æœºè½¬å‘åˆ°è¯¥äº¤æ¢æœºã€‚ no: å¯ä»¥è¢«ç”Ÿäº§è€…ç›´æ¥å‘é€æ¶ˆæ¯ã€‚ Arguments: ç”¨äºè®¾ç½® Exchange çš„å…¶ä»–å‚æ•°ï¼Œç›®å‰ä»…æ”¯æŒä¸€ä¸ªå‚æ•° Alternate exchange(alternate-exchange): æŒ‡å®šè¯¥ Exchange çš„å¤‡ç”¨äº¤æ¢æœºï¼Œå¦‚æœæ— æ³•ä»¥å…¶ä»–æ–¹å¼å°†å‘å¾€æ­¤äº¤æ¢æœºçš„æ¶ˆæ¯è·¯ç”±å‡ºå»ï¼Œåˆ™å°†å®ƒä»¬å‘é€è‡³æ­¤å¤„æŒ‡å®šçš„å¤‡ç”¨äº¤æ¢æœºã€‚ Direct Exchangeï¼ˆç›´æ¥äº¤æ¢æœºï¼‰ è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®å®Œå…¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚ ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šé”®ä¸º errorï¼Œåˆ™åªæœ‰è·¯ç”±é”®ä¸º error çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚ é€‚ç”¨åœºæ™¯ï¼šéœ€è¦ç²¾ç¡®åŒ¹é…çš„åœºæ™¯ï¼Œå¦‚æ—¥å¿—åˆ†ç±»ã€ä»»åŠ¡åˆ†å‘ç­‰ã€‚ Fanout Exchangeï¼ˆæ‰‡å‡ºäº¤æ¢æœºï¼‰ è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå¿½ç•¥è·¯ç”±é”®ã€‚ ç¤ºä¾‹ï¼šæ— è®ºæ¶ˆæ¯çš„è·¯ç”±é”®æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šè¢«è·¯ç”±åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ã€‚ é€‚ç”¨åœºæ™¯ï¼šå¹¿æ’­æ¶ˆæ¯ï¼Œå¦‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€å®æ—¶é€šçŸ¥ç­‰ã€‚ Topic Exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰ è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®æ¨¡å¼åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚æ”¯æŒé€šé…ç¬¦ *ï¼ˆåŒ¹é…ä¸€ä¸ªè¯ï¼‰å’Œ #ï¼ˆåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè¯ï¼‰ã€‚ ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šé”®ä¸º .orange.ï¼Œåˆ™è·¯ç”±é”®ä¸º quick.orange.rabbit çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚ é€‚ç”¨åœºæ™¯ï¼šæ¨¡å—åŒ–è·¯ç”±ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚ Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰ è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„å¤´éƒ¨ä¸é˜Ÿåˆ—çš„ç»‘å®šå¤´éƒ¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯è¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚æ”¯æŒ x-match å‚æ•°ï¼ˆany æˆ– allï¼‰ã€‚å³ä½¿é…ç½®äº†è·¯ç”±é”®ä¹Ÿä¼šå¿½ç•¥ã€‚ ç¤ºä¾‹ï¼šå¦‚æœé˜Ÿåˆ—ç»‘å®šå¤´éƒ¨ä¸º { â€œx-matchâ€: â€œallâ€, â€œformatâ€: â€œpdfâ€, â€œpriorityâ€: â€œhighâ€ }ï¼Œåˆ™åªæœ‰åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°è¯¥é˜Ÿåˆ—ã€‚ é€‚ç”¨åœºæ™¯ï¼šå¤šæ¡ä»¶è·¯ç”±ï¼Œå¦‚å¤æ‚è¿‡æ»¤ã€åŠ¨æ€è·¯ç”±ç­‰ã€‚ Local Random Exchangeï¼ˆæœ¬åœ°éšæœºäº¤æ¢æœºï¼‰ Local Random Exchange æ˜¯ RabbitMQ 4.0 å¼•å…¥çš„äº¤æ¢æœºç±»å‹ï¼Œæ—¨åœ¨ä¼˜åŒ–è¯·æ±‚-å“åº”æ¨¡å¼ä¸‹çš„æ¶ˆæ¯è·¯ç”±ï¼Œç‰¹åˆ«é€‚ç”¨äºä½å»¶è¿Ÿå’Œé«˜ååé‡çš„åœºæ™¯ã€‚é€šè¿‡ç»“åˆç‹¬å é˜Ÿåˆ—ä½¿ç”¨ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯å¿«é€Ÿä¼ é€’åˆ°æœ¬åœ°æ¶ˆè´¹è€…ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚ è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯å§‹ç»ˆè¢«è·¯ç”±åˆ°æœ¬åœ°é˜Ÿåˆ—ï¼ˆä½äºåŒä¸€èŠ‚ç‚¹ä¸Šï¼‰ï¼Œå¦‚æœæœ‰å¤šä¸ªæœ¬åœ°é˜Ÿåˆ—ç»‘å®šï¼Œåˆ™éšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡ŒæŠ•é€’ã€‚ ç¤ºä¾‹ï¼šå‡è®¾èŠ‚ç‚¹ A ä¸Šæœ‰ä¸¤ä¸ªç»‘å®šäº† x-local-random äº¤æ¢æœºçš„é˜Ÿåˆ— Q1 å’Œ Q2ï¼Œå‘å¸ƒçš„æ¶ˆæ¯ä¼šéšæœºè·¯ç”±åˆ° Q1 æˆ– Q2ï¼Œä½†ä¸ä¼šè·¯ç”±åˆ°å…¶ä»–èŠ‚ç‚¹çš„é˜Ÿåˆ—ã€‚ é€‚ç”¨åœºæ™¯ï¼šè¯·æ±‚-å“åº”ï¼ˆRPCï¼‰æ¨¡å¼ä¸‹çš„ä½å»¶è¿Ÿé€šä¿¡ï¼Œé€‚åˆå¾®æœåŠ¡æ¶æ„ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰æ¶ˆè´¹è€…çš„åœºæ™¯ã€‚ åœ¨ä½¿ç”¨ Local Random Exchange æ—¶ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š ç‹¬å é˜Ÿåˆ—ï¼šæ¶ˆè´¹è€…åº”å£°æ˜ç‹¬å é˜Ÿåˆ—ï¼Œä»¥ç¡®ä¿é˜Ÿåˆ—ä»…ç»‘å®šåˆ°å½“å‰èŠ‚ç‚¹ã€‚ æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘ä¸€ä¸ªæ¶ˆè´¹è€…ï¼šæ¯ä¸ª RabbitMQ èŠ‚ç‚¹ä¸Šåº”è‡³å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¦åˆ™åœ¨è¯¥èŠ‚ç‚¹ä¸Šå‘å¸ƒçš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒã€‚ äº¤æ¢æœºç±»å‹å£°æ˜ï¼šä½¿ç”¨ x-local-random ç±»å‹å£°æ˜äº¤æ¢æœºã€‚ Exchange ä¸ Queue ç»‘å®š(Binding) åˆ›å»ºå¥½ Exchange ä¹‹åï¼Œéœ€è¦å°† Exchange ä¸ Queue ç»‘å®šï¼Œæ‰èƒ½å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚ Exchange ä¸ Queue çš„ç»‘å®šå…³ç³»ï¼Œå³ Exchange å‘é€çš„æ¶ˆæ¯ï¼Œä¼šæ ¹æ®è·¯ç”±é”®ä¸é˜Ÿåˆ—çš„ç»‘å®šé”®è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚ åœ¨ Exchange é¡µé¢ç‚¹å‡» Exchange çš„åç§°ï¼Œè¿›å…¥ Exchange è¯¦æƒ…é¡µé¢ï¼Œæ­¤å¤„å¯ä»¥è¿›è¡Œ Exchange ä¸ Queue ç»‘å®šé…ç½® è¿™é‡Œçš„Argumentsç”¨äºè®¾ç½® ç»‘å®š çš„å…¶ä»–å‚æ•°ï¼Œæ¯”å¦‚ Headers Exchange éœ€è¦è®¾ç½® x-match å‚æ•°ç­‰ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Exchange çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹","date_published":"2025-09-21T13:30:05.000Z","tags":["æŠ€æœ¯","rabbitmq","åˆ†å¸ƒå¼","rabbitmq"]},{"id":"https://blog.hanqunfeng.com/2025/09/20/rabbitmq-queue/","url":"https://blog.hanqunfeng.com/2025/09/20/rabbitmq-queue/","title":"RabbitMQ ä¹‹ Queue","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Queue çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo\">Java Client ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Queue-é˜Ÿåˆ—-æ˜¯ä»€ä¹ˆï¼Ÿ\">Queue(é˜Ÿåˆ—) æ˜¯ä»€ä¹ˆï¼Ÿ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ RabbitMQ ä¸­ï¼Œ<a href=\"https://www.rabbitmq.com/docs/queues\">é˜Ÿåˆ—ï¼ˆQueueï¼‰</a> æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨æ¶ˆæ¯çš„ æ•°æ®ç»“æ„ï¼Œæ¶ˆæ¯ä¼šä¸€ç›´ä¿å­˜åœ¨é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°è¢«åº”ç”¨ç¨‹åºæˆ–æœåŠ¡æ¶ˆè´¹ä¸ºæ­¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”Ÿäº§è€…ï¼ˆPublisherï¼‰ æŠŠæ¶ˆæ¯æ”¾è¿›é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ã€‚é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šæŒ‰ç…§ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„é¡ºåºè¿›è¡Œæ¶ˆè´¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é˜Ÿåˆ—åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´èµ·åˆ°ç¼“å†²åŒºçš„ä½œç”¨ã€‚ç”Ÿäº§è€…ä¸éœ€è¦çŸ¥é“æ¶ˆè´¹è€…çš„å­˜åœ¨ï¼Œå®ƒä»¬åªéœ€æŠŠæ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ã€‚æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®è‡ªèº«å¤„ç†é€Ÿåº¦ï¼ŒæŒ‰éœ€æ¶ˆè´¹æ¶ˆæ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ ç›®å‰ æ”¯æŒä¸‰ç§é˜Ÿåˆ—ç±»å‹ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é˜Ÿåˆ—ç±»å‹</th>\n<th>æè¿°</th>\n<th>ç‰¹ç‚¹</th>\n<th>å…¸å‹ç”¨é€”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Classic Queueï¼ˆç»å…¸é˜Ÿåˆ—ï¼‰</strong></td>\n<td>æœ€å¸¸ç”¨çš„é˜Ÿåˆ—ç±»å‹ï¼Œæ¶ˆæ¯æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰é¡ºåºå­˜å‚¨å’Œæ¶ˆè´¹</td>\n<td>æ”¯æŒæŒä¹…åŒ–ã€ä¼˜å…ˆçº§ã€TTLã€æ­»ä¿¡ç­‰</td>\n<td>å¤§å¤šæ•°å¸¸è§„æ¶ˆæ¯åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>Quorum Queueï¼ˆä»²è£é˜Ÿåˆ—ï¼‰</strong></td>\n<td>åŸºäº Raft åè®®çš„é˜Ÿåˆ—ï¼Œç¡®ä¿é«˜å¯ç”¨å’Œæ•°æ®ä¸€è‡´æ€§</td>\n<td>å†…ç½®å¤åˆ¶ï¼ˆå‰¯æœ¬æ•°é‡å¯é…ç½®ï¼‰ã€é€‚åˆé«˜å¯é æ€§åœºæ™¯ï¼Œä½†ååé‡ç•¥ä½äºç»å…¸é˜Ÿåˆ—</td>\n<td>å…³é”®ä»»åŠ¡æ¶ˆæ¯ã€é«˜å¯é æ€§åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>Stream Queueï¼ˆæµå¼é˜Ÿåˆ—ï¼‰</strong></td>\n<td>é¢å‘å¤§é‡æ¶ˆæ¯çš„é«˜ååé˜Ÿåˆ—ï¼Œæ”¯æŒæ¶ˆæ¯æŒ‰åç§»é‡è¯»å–</td>\n<td>ç±»ä¼¼ Kafkaï¼Œå¯éšæœºè®¿é—®å†å²æ¶ˆæ¯ã€é¡ºåºè¯»å–ã€å¯æŒä¹…åŒ–å¤§é‡æ¶ˆæ¯</td>\n<td>å¤§æ•°æ®æµã€æ—¥å¿—å¤„ç†ã€äº‹ä»¶æº¯æº</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Classic-Queue-ç»å…¸é˜Ÿåˆ—\">Classic Queue(ç»å…¸é˜Ÿåˆ—)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com/docs/classic-queues\">RabbitMQ ç»å…¸é˜Ÿåˆ—ï¼ˆåŸå§‹é˜Ÿåˆ—ç±»å‹ï¼‰</a>æ˜¯ä¸€ç§é€šç”¨é˜Ÿåˆ—ç±»å‹ã€‚å®é™…ä¸Šå®ƒæ˜¯åœ¨ 3.8.x ç‰ˆæœ¬ä¹‹å‰å”¯ä¸€çš„é˜Ÿåˆ—ç±»å‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç»å…¸é˜Ÿåˆ—é€‚ç”¨äºæ•°æ®å®‰å…¨ä¸æ˜¯ä¼˜å…ˆäº‹é¡¹çš„ç”¨ä¾‹ï¼Œå› ä¸ºå­˜å‚¨åœ¨ç»å…¸é˜Ÿåˆ—ä¸­çš„æ•°æ®ä¸ä¼šè¢«å¤åˆ¶ã€‚ ç»å…¸é˜Ÿåˆ—ä½¿ç”¨éå¤åˆ¶çš„ FIFO é˜Ÿåˆ—å®ç°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç»å…¸é˜Ÿåˆ—ä¸é€‚åˆç§¯ç´¯å¤ªå¤šçš„æ¶ˆæ¯ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­ç§¯ç´¯çš„æ¶ˆæ¯å¤ªå¤šäº†ï¼Œä¼šä¸¥é‡å½±å“å®¢æˆ·ç«¯ç”Ÿäº§æ¶ˆæ¯ä»¥åŠæ¶ˆè´¹æ¶ˆæ¯çš„æ€§èƒ½ã€‚å› æ­¤ï¼Œç»å…¸é˜Ÿåˆ—ä¸»è¦ç”¨åœ¨æ•°æ®é‡æ¯”è¾ƒå°ï¼Œå¹¶ä¸”ç”Ÿäº§æ¶ˆæ¯å’Œæ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦æ¯”è¾ƒç¨³å®šçš„ä¸šåŠ¡åœºæ™¯ã€‚æ¯”å¦‚å†…éƒ¨ç³»ç»Ÿä¹‹é—´çš„æœåŠ¡è°ƒç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ 4.0 åˆ é™¤äº†å¯¹ç»å…¸é˜Ÿåˆ— <code>version1</code> çš„æ”¯æŒï¼ŒåŒæ—¶ä¹Ÿä¸å†æ”¯æŒå°† ç»å…¸é˜Ÿåˆ— çš„æ¶ˆæ¯åœ¨èŠ‚ç‚¹é—´å¤åˆ¶ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/MAdpRV.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°åç§°</th>\n<th>é…ç½®å‚æ•°å</th>\n<th>æ•°æ®ç±»å‹</th>\n<th>ä½œç”¨è¯´æ˜</th>\n<th>å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Auto expire</strong></td>\n<td><code>x-expires</code></td>\n<td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td>\n<td>é˜Ÿåˆ—åœ¨ <strong>æŒ‡å®šæ—¶é—´å†…æ— äººä½¿ç”¨ï¼ˆæ— æ¶ˆè´¹è€…ã€æ— å‘å¸ƒã€æ— è®¿é—®ï¼‰</strong> æ—¶è‡ªåŠ¨åˆ é™¤</td>\n<td>ç±»ä¼¼â€œé˜Ÿåˆ—ç©ºé—²è¿‡æœŸæ—¶é—´â€ï¼ŒèŠ‚çœèµ„æº</td>\n</tr>\n<tr>\n<td><strong>Message TTL</strong></td>\n<td><code>x-message-ttl</code></td>\n<td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td>\n<td>æ¶ˆæ¯çš„ <strong>å­˜æ´»æ—¶é—´</strong>ï¼Œè¶…è¿‡æ—¶é—´åæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—</td>\n<td>ç”¨äºé™åˆ¶æ¶ˆæ¯æ—¶æ•ˆæ€§ï¼Œå¦‚å»¶è¿Ÿæ¶ˆæ¯æˆ–çŸ­æœŸç¼“å­˜</td>\n</tr>\n<tr>\n<td><strong>Overflow behaviour</strong></td>\n<td><code>x-overflow</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>drop-head</code> æˆ– <code>reject-publish</code>ï¼‰</td>\n<td>å½“é˜Ÿåˆ—è¾¾åˆ° <strong>æœ€å¤§é•¿åº¦</strong> æˆ– <strong>æœ€å¤§å­—èŠ‚æ•°</strong> æ—¶çš„è¡Œä¸º</td>\n<td>- <code>drop-head</code>ï¼šä¸¢å¼ƒæœ€æ—©çš„æ¶ˆæ¯ <br> - <code>reject-publish</code>ï¼šæ‹’ç»æ–°çš„æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Single active consumer</strong></td>\n<td><code>x-single-active-consumer</code></td>\n<td>å¸ƒå°”å€¼ï¼ˆtrue/falseï¼‰</td>\n<td>æ˜¯å¦å¯ç”¨ <strong>å•æ´»æ¶ˆè´¹è€…æ¨¡å¼</strong>ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ—</td>\n<td>ç”¨äºä¸¥æ ¼é¡ºåºæ¶ˆè´¹ï¼Œä¿è¯æŸä¸ªæ¶ˆæ¯ä¸ä¼šè¢«å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>Dead letter exchange (DLX)</strong></td>\n<td><code>x-dead-letter-exchange</code></td>\n<td>å­—ç¬¦ä¸²</td>\n<td>æŒ‡å®šé˜Ÿåˆ—çš„ <strong>æ­»ä¿¡äº¤æ¢æœº</strong>ï¼Œç”¨äºæ¥æ”¶æ— æ³•æ¶ˆè´¹æˆ–è¿‡æœŸçš„æ¶ˆæ¯</td>\n<td>å¸¸ç”¨äºå¤±è´¥é‡è¯•ã€æ¶ˆæ¯è¡¥å¿åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>Dead letter routing key</strong></td>\n<td><code>x-dead-letter-routing-key</code></td>\n<td>å­—ç¬¦ä¸²</td>\n<td>æ¶ˆæ¯è½¬å‘åˆ° DLX æ—¶çš„ <strong>è·¯ç”±é”®</strong></td>\n<td>å¯ä»¥çµæ´»è½¬å‘åˆ°ä¸åŒé˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td><strong>Max length</strong></td>\n<td><code>x-max-length</code></td>\n<td>æ•´æ•°</td>\n<td>é˜Ÿåˆ—ä¸­ <strong>æœ€å¤§æ¶ˆæ¯æ¡æ•°</strong></td>\n<td>è¶…è¿‡æ—¶æŒ‰ç…§ Overflow behaviour å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>Max length bytes</strong></td>\n<td><code>x-max-length-bytes</code></td>\n<td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td>\n<td>é˜Ÿåˆ—ä¸­ <strong>æ¶ˆæ¯æ€»å­—èŠ‚æ•°ä¸Šé™</strong></td>\n<td>è¶…è¿‡æ—¶æŒ‰ç…§ Overflow behaviour å¤„ç†ï¼Œé€‚åˆå¤§æ¶ˆæ¯åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>Maximum priority</strong></td>\n<td><code>x-max-priority</code></td>\n<td>æ•´æ•°</td>\n<td>å¯ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—å¯è®¾ç½®çš„ <strong>æœ€å¤§ä¼˜å…ˆçº§å€¼</strong></td>\n<td>æ¶ˆæ¯ä¼˜å…ˆçº§èŒƒå›´æ˜¯ 0 åˆ°è¿™ä¸ªå€¼ï¼Œä¼˜å…ˆçº§é«˜çš„æ¶ˆæ¯å…ˆè¢«æ¶ˆè´¹</td>\n</tr>\n<tr>\n<td><strong>Leader locator</strong></td>\n<td><code>x-queue-leader-locator</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>client-local</code>ã€<code>balanced</code>ï¼‰</td>\n<td>è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—ä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™</td>\n<td><code>client-local</code>ï¼ˆé»˜è®¤ï¼‰ï¼šé€‰æ‹©å®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸ºLeader <br> <code>balanced</code>ï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡Leaderåˆ†å¸ƒï¼Œç”¨äº HA é˜Ÿåˆ—ä¼˜åŒ–</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Quorum-Queue-ä»²è£é˜Ÿåˆ—\">Quorum Queue(ä»²è£é˜Ÿåˆ—)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com/docs/quorum-queues\">ä»²è£é˜Ÿåˆ—ï¼ˆQuorum Queueï¼‰</a> æ˜¯ RabbitMQ ä»3.8.0ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„ä¸€ç§ç°ä»£é˜Ÿåˆ—ç±»å‹ï¼Œä¹Ÿæ˜¯ç›®å‰å®˜æ–¹æ¯”è¾ƒæ¨èçš„ä¸€ç§å¯¹åˆ—ç±»å‹ã€‚æœªæ¥æœ‰å¯èƒ½å–ä»£ ç»å…¸é˜Ÿåˆ— æˆä¸ºé»˜è®¤é˜Ÿåˆ—ç±»å‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å…¶åŸºäº Raft å…±è¯†ç®—æ³• å®ç° æŒä¹…åŒ–ã€å¤åˆ¶å’Œé«˜å¯ç”¨ã€‚å®ƒä¿è¯ æ•°æ®å®‰å…¨æ€§ã€å¯é çš„ä¸»èŠ‚ç‚¹é€‰ä¸¾ï¼Œå³ä½¿åœ¨å‡çº§æˆ–é›†ç¾¤æ³¢åŠ¨æœŸé—´ä¹Ÿèƒ½ä¿æŒé«˜å¯ç”¨æ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»²è£é˜Ÿåˆ—æ”¯æŒ æ¯’æ¶ˆæ¯å¤„ç†ã€è‡³å°‘ä¸€æ¬¡æ­»ä¿¡æŠ•é€’ ä»¥åŠ AMQP ä¿®æ”¹ï¼ˆAMQP.modifiedï¼‰çš„å¤„ç†ç»“æœã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒé€‚åˆ ä»¥æ•°æ®å®‰å…¨ä¸ºé¦–è¦ç›®æ ‡ çš„åœºæ™¯ã€‚ä¸ç»å…¸é˜Ÿåˆ—ç›¸æ¯”ï¼ŒQuorumæ˜¯ä»¥ç‰ºç‰²å¾ˆå¤šé«˜çº§é˜Ÿåˆ—ç‰¹æ€§ä¸ºä»£ä»·ï¼Œæ¥è¿›ä¸€æ­¥ä¿è¯æ¶ˆæ¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é«˜å¯é ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/oQ8YiT.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»²è£é˜Ÿåˆ—ï¼ˆQuorum Queueï¼‰çš„ <code>Durability</code> åªèƒ½è®¾ç½®ä¸º Durable(true)ã€‚<code>Auto delete</code> åªèƒ½ä¸º No(false)ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°åç§°</th>\n<th>é…ç½®å‚æ•°å</th>\n<th>æ•°æ®ç±»å‹</th>\n<th>ä½œç”¨è¯´æ˜</th>\n<th>å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Auto expire</strong></td>\n<td><code>x-expires</code></td>\n<td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td>\n<td>é˜Ÿåˆ—åœ¨æŒ‡å®šæ—¶é—´å†…æ— äººä½¿ç”¨ï¼ˆæ— æ¶ˆè´¹è€…ã€æ— å‘å¸ƒã€æ— è®¿é—®ï¼‰æ—¶è‡ªåŠ¨åˆ é™¤</td>\n<td>èŠ‚çœèµ„æºï¼Œé˜Ÿåˆ—ç©ºé—²è¿‡æœŸæ—¶é—´</td>\n</tr>\n<tr>\n<td><strong>Message TTL</strong></td>\n<td><code>x-message-ttl</code></td>\n<td>æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰</td>\n<td>é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„ç”Ÿå­˜æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´åæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–è½¬å…¥æ­»ä¿¡é˜Ÿåˆ—</td>\n<td>æ§åˆ¶æ¶ˆæ¯æ—¶æ•ˆæ€§</td>\n</tr>\n<tr>\n<td><strong>Overflow behaviour</strong></td>\n<td><code>x-overflow</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>drop-head</code> æˆ– <code>reject-publish</code>ï¼‰</td>\n<td>å½“é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦æ—¶çš„å¤„ç†æ–¹å¼</td>\n<td><code>drop-head</code>ï¼šä¸¢å¼ƒæœ€æ—©æ¶ˆæ¯ï¼Œ<code>reject-publish</code>ï¼šæ‹’ç»æ–°æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Single active consumer</strong></td>\n<td><code>x-single-active-consumer</code></td>\n<td>å¸ƒå°”å€¼ï¼ˆtrue/falseï¼‰</td>\n<td>æ˜¯å¦å¯ç”¨å•æ´»æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ—</td>\n<td>ä¿è¯ä¸¥æ ¼é¡ºåºæ¶ˆè´¹</td>\n</tr>\n<tr>\n<td><strong>Dead letter exchange (DLX)</strong></td>\n<td><code>x-dead-letter-exchange</code></td>\n<td>å­—ç¬¦ä¸²</td>\n<td>æŒ‡å®šé˜Ÿåˆ—çš„æ­»ä¿¡äº¤æ¢æœºï¼Œç”¨äºæ¥æ”¶æ— æ³•æ¶ˆè´¹æˆ–è¿‡æœŸçš„æ¶ˆæ¯</td>\n<td>ä¸ DLX é…åˆä½¿ç”¨å¤„ç†å¤±è´¥æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Dead letter routing key</strong></td>\n<td><code>x-dead-letter-routing-key</code></td>\n<td>å­—ç¬¦ä¸²</td>\n<td>æ¶ˆæ¯è½¬å‘åˆ° DLX æ—¶çš„è·¯ç”±é”®</td>\n<td>çµæ´»è·¯ç”±æ­»ä¿¡æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Max length</strong></td>\n<td><code>x-max-length</code></td>\n<td>æ•´æ•°</td>\n<td>é˜Ÿåˆ—ä¸­æœ€å¤§æ¶ˆæ¯æ¡æ•°</td>\n<td>è¶…è¿‡æ—¶æŒ‰ Overflow behaviour å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>Max length bytes</strong></td>\n<td><code>x-max-length-bytes</code></td>\n<td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td>\n<td>é˜Ÿåˆ—æ¶ˆæ¯æ€»å­—èŠ‚æ•°ä¸Šé™</td>\n<td>è¶…è¿‡æ—¶æŒ‰ Overflow behaviour å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>Delivery limit</strong></td>\n<td><code>x-delivery-limit</code></td>\n<td>æ•´æ•°</td>\n<td>æ¶ˆæ¯å…è®¸æŠ•é€’çš„æœ€å¤§æ¬¡æ•°ï¼Œè¶…è¿‡åå˜ä¸ºæ­»ä¿¡</td>\n<td>æ§åˆ¶æ¶ˆæ¯é‡è¯•æ¬¡æ•°</td>\n</tr>\n<tr>\n<td><strong>Initial cluster size</strong></td>\n<td><code>x-quorum-initial-group-size</code></td>\n<td>æ•´æ•°</td>\n<td>é˜Ÿåˆ—åœ¨åˆ›å»ºæ—¶éœ€è¦çš„æœ€å°èŠ‚ç‚¹æ•°</td>\n<td>ç”¨äºä¿è¯ä»²è£é˜Ÿåˆ—çš„é«˜å¯ç”¨æ€§</td>\n</tr>\n<tr>\n<td><strong>Target cluster size</strong></td>\n<td><code>x-quorum-target-group-size</code></td>\n<td>æ•´æ•°</td>\n<td>é˜Ÿåˆ—è¿è¡Œæ—¶çš„ç›®æ ‡èŠ‚ç‚¹æ•°</td>\n<td>å½“é›†ç¾¤èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œä»²è£é˜Ÿåˆ—ä¼šå°è¯•è°ƒæ•´å‰¯æœ¬æ•°é‡</td>\n</tr>\n<tr>\n<td><strong>Dead letter strategy</strong></td>\n<td><code>x-dead-letter-strategy</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>at-most-once</code>ã€<code>at-least-once</code>ï¼‰</td>\n<td>è®¾ç½®ä»²è£é˜Ÿåˆ—çš„æ­»ä¿¡å¤„ç†ç­–ç•¥</td>\n<td>ä»…é€‚ç”¨äº Quorum Queueã€‚<br><code>at-most-once</code>ï¼ˆé»˜è®¤ï¼‰ï¼šæ¶ˆæ¯æœ€å¤šæŠ•é€’ä¸€æ¬¡ï¼Œå¯èƒ½ä¸¢å¤±ã€‚<br><code>at-least-once</code>ï¼šç¡®ä¿æ¶ˆæ¯è‡³å°‘æŠ•é€’ä¸€æ¬¡ï¼Œå¿…é¡»å°† Overflow behaviour è®¾ç½®ä¸º <code>reject-publish</code>ï¼Œå¦åˆ™å›é€€åˆ° <code>at-most-once</code>ã€‚</td>\n</tr>\n<tr>\n<td><strong>Leader locator</strong></td>\n<td><code>x-queue-leader-locator</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>client-local</code>ã€<code>balanced</code>ï¼‰</td>\n<td>è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—ä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™</td>\n<td><code>client-local</code>ï¼šé€‰æ‹©å®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸º Leader <br> <code>balanced</code>ï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡ Leader åˆ†å¸ƒ</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Quorum Queues å’Œ Classic Queues çš„åŠŸèƒ½å¯¹æ¯”å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Feature</th>\n<th>ä¸­æ–‡å«ä¹‰</th>\n<th>Classic queues</th>\n<th>Quorum queues</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Non-durable queues</td>\n<td>éæŒä¹…åŒ–é˜Ÿåˆ—</td>\n<td>yes</td>\n<td>no</td>\n<td>Quorum queues æ€»æ˜¯æŒä¹…åŒ–ï¼Œä¸æ”¯æŒéæŒä¹…åŒ–</td>\n</tr>\n<tr>\n<td>Message replication</td>\n<td>æ¶ˆæ¯å¤åˆ¶</td>\n<td>no</td>\n<td>yes</td>\n<td>Quorum queues å†…ç½®æ¶ˆæ¯å¤åˆ¶ï¼ŒClassic queues éœ€é•œåƒç­–ç•¥</td>\n</tr>\n<tr>\n<td>Exclusivity</td>\n<td>ç‹¬å é˜Ÿåˆ—</td>\n<td>yes</td>\n<td>no</td>\n<td>Classic queues æ”¯æŒç‹¬å é˜Ÿåˆ—ï¼ŒQuorum queues ä¸æ”¯æŒç‹¬å </td>\n</tr>\n<tr>\n<td>Per message persistence</td>\n<td>æ¶ˆæ¯çº§æŒä¹…åŒ–</td>\n<td>per message</td>\n<td>always</td>\n<td>Quorum queues æ¶ˆæ¯æ€»æ˜¯æŒä¹…åŒ–</td>\n</tr>\n<tr>\n<td>Membership changes</td>\n<td>èŠ‚ç‚¹æˆå‘˜å˜æ›´</td>\n<td>no</td>\n<td>semi-automatic</td>\n<td>Quorum queues èŠ‚ç‚¹å˜åŒ–æ—¶åŠè‡ªåŠ¨å¤„ç†å¤åˆ¶</td>\n</tr>\n<tr>\n<td>Message TTL (Time-To-Live)</td>\n<td>æ¶ˆæ¯å­˜æ´»æ—¶é—´</td>\n<td>yes</td>\n<td>yes</td>\n<td>ä¸¤è€…éƒ½æ”¯æŒæ¶ˆæ¯è¿‡æœŸæ—¶é—´</td>\n</tr>\n<tr>\n<td>Queue TTL</td>\n<td>é˜Ÿåˆ—å­˜æ´»æ—¶é—´</td>\n<td>yes</td>\n<td>partially</td>\n<td>Quorum queues çš„ lease ä¸ä¼šå› é‡æ–°å£°æ˜è€Œç»­æœŸ</td>\n</tr>\n<tr>\n<td>Queue length limits</td>\n<td>é˜Ÿåˆ—é•¿åº¦é™åˆ¶</td>\n<td>yes</td>\n<td>yes</td>\n<td>Quorum queues æ”¯æŒé•¿åº¦é™åˆ¶ï¼Œä½† <code>x-overflow=reject-publish-dlx</code> ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td>Keeps messages in memory</td>\n<td>æ¶ˆæ¯å†…å­˜ä¿å­˜</td>\n<td>see Classic Queues</td>\n<td>never</td>\n<td>Quorum queues æ¶ˆæ¯æ€»æ˜¯å†™å…¥ç£ç›˜ï¼Œä¸ä¿ç•™åœ¨å†…å­˜</td>\n</tr>\n<tr>\n<td>Message priority</td>\n<td>æ¶ˆæ¯ä¼˜å…ˆçº§</td>\n<td>yes</td>\n<td>yes</td>\n<td>æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§</td>\n</tr>\n<tr>\n<td>Single Active Consumer</td>\n<td>å•æ´»æ¶ˆè´¹è€…</td>\n<td>yes</td>\n<td>yes</td>\n<td>æ”¯æŒå•æ´»æ¶ˆè´¹è€…</td>\n</tr>\n<tr>\n<td>Consumer exclusivity</td>\n<td>ç‹¬å æ¶ˆè´¹è€…</td>\n<td>yes</td>\n<td>no</td>\n<td>Quorum queues ä¸æ”¯æŒç‹¬å æ¶ˆè´¹è€…ï¼Œéœ€ä½¿ç”¨ Single Active Consumer</td>\n</tr>\n<tr>\n<td>Consumer priority</td>\n<td>æ¶ˆè´¹è€…ä¼˜å…ˆçº§</td>\n<td>yes</td>\n<td>yes</td>\n<td>æ”¯æŒæ¶ˆè´¹è€…ä¼˜å…ˆçº§</td>\n</tr>\n<tr>\n<td>Dead letter exchanges</td>\n<td>æ­»ä¿¡äº¤æ¢æœº</td>\n<td>yes</td>\n<td>yes</td>\n<td>æ”¯æŒæ­»ä¿¡äº¤æ¢æœº</td>\n</tr>\n<tr>\n<td>Adheres to policies</td>\n<td>éµå¾ªç­–ç•¥</td>\n<td>yes</td>\n<td>yes</td>\n<td>æ”¯æŒç­–ç•¥ï¼Œä½† Quorum queues çš„éƒ¨åˆ†ç­–ç•¥è¡Œä¸ºä¸åŒ</td>\n</tr>\n<tr>\n<td>Poison message handling</td>\n<td>æ¯’æ¶ˆæ¯å¤„ç†</td>\n<td>no</td>\n<td>yes</td>\n<td>Quorum queues æ”¯æŒæ¯’æ¶ˆæ¯å¤„ç†</td>\n</tr>\n<tr>\n<td>Server-named queues</td>\n<td>æœåŠ¡å™¨è‡ªåŠ¨å‘½åé˜Ÿåˆ—</td>\n<td>yes</td>\n<td>no</td>\n<td>Quorum queues ä¸æ”¯æŒæœåŠ¡å™¨è‡ªåŠ¨å‘½åé˜Ÿåˆ—</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Stream-æµ\">Stream(æµ)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com/docs/streams\">Stream</a> æ˜¯RabbitMQè‡ª 3.9.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ç§æ–°çš„æ•°æ®é˜Ÿåˆ—ç±»å‹ã€‚è¿™ç§é˜Ÿåˆ—ç±»å‹çš„æ¶ˆæ¯æ˜¯æŒä¹…åŒ–åˆ°ç£ç›˜å¹¶ä¸”å…·å¤‡åˆ†å¸ƒå¼å¤‡ä»½çš„ï¼Œæ›´é€‚åˆäºæ¶ˆè´¹è€…å¤šï¼Œè¯»æ¶ˆæ¯éå¸¸é¢‘ç¹çš„åœºæ™¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Stream çš„æ ¸å¿ƒæ˜¯ä»¥append-onlyåªæ·»åŠ çš„æ—¥å¿—æ¥è®°å½•æ¶ˆæ¯ï¼Œæ•´ä½“æ¥è¯´ï¼Œå°±æ˜¯æ¶ˆæ¯å°†ä»¥append-onlyçš„æ–¹å¼æŒä¹…åŒ–åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡è°ƒæ•´æ¯ä¸ªæ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦offsetï¼Œæ¥å®ç°æ¶ˆæ¯çš„å¤šæ¬¡åˆ†å‘ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Stream ä¸æ”¯æŒæ­»ä¿¡äº¤æ¢æœºï¼Œä¸æ”¯æŒå¤„ç†æ¯’æ¶ˆæ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š Stream ä¸å±äºé˜Ÿåˆ—ï¼Œæµï¼ˆStreamsï¼‰ æ˜¯ä¸€ç§ æŒä¹…åŒ–ã€å¯å¤åˆ¶çš„æ•°æ®ç»“æ„ï¼ŒåŠŸèƒ½ä¸Šç±»ä¼¼é˜Ÿåˆ—ï¼šä»ç”Ÿäº§è€…ç¼“å†²æ¶ˆæ¯ä¾›æ¶ˆè´¹è€…è¯»å–ã€‚ä½†å®ƒä¸é˜Ÿåˆ—æœ‰ä¸¤ä¸ªé‡è¦åŒºåˆ«ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å­˜å‚¨æ¨¡å‹ â€“ æµæ˜¯ è¿½åŠ æ—¥å¿—ï¼ˆappend-only logï¼‰ï¼Œæ¶ˆæ¯å¯ä»¥ é‡å¤è¯»å–ç›´åˆ°è¿‡æœŸã€‚</li>\n<li class=\"lvl-4\">æ¶ˆè´¹æ¨¡å‹ â€“ æµæä¾› éç ´åæ€§æ¶ˆè´¹è¯­ä¹‰ï¼ˆnon-destructive consumer semanticsï¼‰ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å¤šæ¬¡è¯»å–åŒä¸€æ¡æ¶ˆæ¯è€Œä¸ä¼šåˆ é™¤å®ƒã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>Stream å§‹ç»ˆæ˜¯æŒä¹…åŒ–å’Œå¤åˆ¶çš„ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚æ¶ˆè´¹è€…å¯ä»¥é€šè¿‡ RabbitMQ å®¢æˆ·ç«¯åº“ æˆ– ä¸“ç”¨äºŒè¿›åˆ¶åè®®æ’ä»¶ è¯»å–æµï¼Œå…¶ä¸­æ’ä»¶æ–¹å¼å¯ä»¥ è®¿é—®æ‰€æœ‰æµç‰¹æ€§ å¹¶æä¾› æœ€ä½³æ€§èƒ½ã€‚åˆç†çš„å®¢æˆ·ç«¯è¿æ¥ç­–ç•¥æœ‰åŠ©äºæå‡ ååé‡å’Œæ•ˆç‡ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/8KqZY9.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†)</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°åç§°</th>\n<th>é…ç½®å‚æ•°å</th>\n<th>æ•°æ®ç±»å‹</th>\n<th>ä½œç”¨è¯´æ˜</th>\n<th>å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Max length bytes</strong></td>\n<td><code>x-max-length-bytes</code></td>\n<td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td>\n<td>æµä¸­å…è®¸å­˜å‚¨çš„ <strong>æœ€å¤§æ•°æ®æ€»å­—èŠ‚æ•°</strong></td>\n<td>è¶…è¿‡æ—¶æµå°†åœæ­¢æ¥æ”¶æ–°æ¶ˆæ¯ï¼Œé€‚åˆæ§åˆ¶å­˜å‚¨å®¹é‡</td>\n</tr>\n<tr>\n<td><strong>Max time retention</strong></td>\n<td><code>x-max-age</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆæ—¶é—´å•ä½ï¼Œä¾‹å¦‚ <code>1h</code>, <code>30m</code>, <code>1d</code>ï¼‰</td>\n<td>è®¾ç½®æµé˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„ <strong>æœ€å¤§ä¿ç•™æ—¶é—´</strong>ï¼Œè¶…è¿‡æ—¶é—´çš„æ¶ˆæ¯ä¼šè¢«åˆ é™¤</td>\n<td>æ”¯æŒæ—¶é—´å•ä½ï¼šY=å¹´, M=æœˆ, D=å¤©, h=å°æ—¶, m=åˆ†é’Ÿ, s=ç§’ã€‚ä¾‹å¦‚ <code>&quot;1h&quot;</code> è¡¨ç¤ºåªä¿ç•™æœ€è¿‘ 1 å°æ—¶çš„æ¶ˆæ¯ï¼Œç”¨äºæ§åˆ¶æ•°æ®é‡å’Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Max segment size in bytes</strong></td>\n<td><code>x-stream-max-segment-size</code></td>\n<td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td>\n<td>æµåˆ†æ®µå­˜å‚¨æ—¶çš„ <strong>æ¯ä¸ªæ®µçš„æœ€å¤§å­—èŠ‚æ•°</strong></td>\n<td>æ§åˆ¶å•ä¸ªæ–‡ä»¶æ®µå¤§å°ï¼Œæœ‰åˆ©äº I/O æ€§èƒ½å’Œç®¡ç†</td>\n</tr>\n<tr>\n<td><strong>Filter size (per chunk) in bytes</strong></td>\n<td><code>x-stream-filter-size-bytes</code></td>\n<td>æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰</td>\n<td>æµå†…éƒ¨ <strong>è¿‡æ»¤ç´¢å¼•æ¯å—çš„å¤§å°</strong></td>\n<td>ç”¨äºåŠ é€Ÿæ¶ˆæ¯å®šä½å’Œè¯»å–ï¼Œå½±å“å†…å­˜ä½¿ç”¨å’Œæ£€ç´¢æ•ˆç‡</td>\n</tr>\n<tr>\n<td><strong>Initial cluster size</strong></td>\n<td><code>x-initial-cluster-size</code></td>\n<td>æ•´æ•°</td>\n<td>æµåœ¨åˆ›å»ºæ—¶çš„ <strong>æœ€å°èŠ‚ç‚¹æ•°</strong></td>\n<td>ä¿è¯æµçš„å¤åˆ¶å’Œé«˜å¯ç”¨æ€§</td>\n</tr>\n<tr>\n<td><strong>Leader locator</strong></td>\n<td><code>x-queue-leader-locator</code></td>\n<td>å­—ç¬¦ä¸²ï¼ˆ<code>client-local</code>ã€<code>balanced</code>ï¼‰</td>\n<td>è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜æµæ—¶ï¼Œä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™</td>\n<td><code>client-local</code>ï¼šå®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸º Leaderï¼ˆé»˜è®¤ï¼‰<br><code>balanced</code>ï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡ Leader åˆ†å¸ƒï¼Œç”¨äºä¼˜åŒ– HA</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Classic Queue vs Stream Queue Feature Matrix</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Feature</th>\n<th>ä¸­æ–‡å«ä¹‰</th>\n<th>Classic queues</th>\n<th>Stream queues</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Non-durable queues</td>\n<td>éæŒä¹…åŒ–é˜Ÿåˆ—</td>\n<td>yes</td>\n<td>no</td>\n<td>Stream é˜Ÿåˆ—æ€»æ˜¯æŒä¹…åŒ–ï¼Œä¸æ”¯æŒéæŒä¹…åŒ–</td>\n</tr>\n<tr>\n<td>Exclusivity</td>\n<td>ç‹¬å é˜Ÿåˆ—</td>\n<td>yes</td>\n<td>no</td>\n<td>Classic é˜Ÿåˆ—æ”¯æŒç‹¬å ï¼ŒStream é˜Ÿåˆ—ä¸æ”¯æŒç‹¬å </td>\n</tr>\n<tr>\n<td>Per message persistence</td>\n<td>æ¶ˆæ¯çº§æŒä¹…åŒ–</td>\n<td>per message</td>\n<td>always</td>\n<td>Stream é˜Ÿåˆ—çš„æ¶ˆæ¯æ€»æ˜¯æŒä¹…åŒ–</td>\n</tr>\n<tr>\n<td>Membership changes</td>\n<td>èŠ‚ç‚¹æˆå‘˜å˜æ›´</td>\n<td>no</td>\n<td>manual</td>\n<td>Stream é˜Ÿåˆ—èŠ‚ç‚¹å˜æ›´éœ€è¦æ‰‹åŠ¨ç®¡ç†</td>\n</tr>\n<tr>\n<td>TTL</td>\n<td>æ¶ˆæ¯å­˜æ´»æ—¶é—´</td>\n<td>yes</td>\n<td>no (but see Retention)</td>\n<td>Stream é˜Ÿåˆ—æ²¡æœ‰æ¶ˆæ¯ TTLï¼Œä½†å¯é€šè¿‡ Retention æ§åˆ¶è¿‡æœŸ</td>\n</tr>\n<tr>\n<td>Queue length limits</td>\n<td>é˜Ÿåˆ—é•¿åº¦é™åˆ¶</td>\n<td>yes</td>\n<td>no (but see Retention)</td>\n<td>Stream é˜Ÿåˆ—æ²¡æœ‰å›ºå®šé•¿åº¦é™åˆ¶ï¼Œé€šè¿‡ Retention æ§åˆ¶æ•°æ®é‡</td>\n</tr>\n<tr>\n<td>Keeps messages in memory</td>\n<td>æ¶ˆæ¯å†…å­˜ä¿å­˜</td>\n<td>see Classic Queues</td>\n<td>never</td>\n<td>Stream é˜Ÿåˆ—æ¶ˆæ¯ä¸ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œåªå†™å…¥ç£ç›˜</td>\n</tr>\n<tr>\n<td>Message priority</td>\n<td>æ¶ˆæ¯ä¼˜å…ˆçº§</td>\n<td>yes</td>\n<td>no</td>\n<td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§</td>\n</tr>\n<tr>\n<td>Consumer priority</td>\n<td>æ¶ˆè´¹è€…ä¼˜å…ˆçº§</td>\n<td>yes</td>\n<td>no</td>\n<td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¶ˆè´¹è€…ä¼˜å…ˆçº§</td>\n</tr>\n<tr>\n<td>Dead letter exchanges</td>\n<td>æ­»ä¿¡äº¤æ¢æœº</td>\n<td>yes</td>\n<td>no</td>\n<td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ­»ä¿¡äº¤æ¢æœº</td>\n</tr>\n<tr>\n<td>Adheres to policies</td>\n<td>éµå¾ªç­–ç•¥</td>\n<td>yes</td>\n<td>yes (see Retention)</td>\n<td>Stream é˜Ÿåˆ—æ”¯æŒç­–ç•¥ï¼Œä½†ä¸»è¦é€šè¿‡ Retention æ§åˆ¶è¡Œä¸º</td>\n</tr>\n<tr>\n<td>Reacts to memory alarms</td>\n<td>å†…å­˜å‘Šè­¦å“åº”</td>\n<td>yes</td>\n<td>no (uses minimal RAM)</td>\n<td>Stream é˜Ÿåˆ—ä½¿ç”¨æœ€å°å†…å­˜ï¼Œä¸è§¦å‘å†…å­˜å‘Šè­¦</td>\n</tr>\n<tr>\n<td>Poison message handling</td>\n<td>æ¯’æ¶ˆæ¯å¤„ç†</td>\n<td>no</td>\n<td>no</td>\n<td>Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¯’æ¶ˆæ¯å¤„ç†</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æˆ‘ä»¬å¯ä»¥æ¿€æ´»<code>æµæ’ä»¶</code>æ¥ä½¿ç”¨æµçš„ç‰¹æœ‰åŠŸèƒ½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmq-plugins <span class=\"built_in\">enable</span> rabbitmq_stream rabbitmq_stream_management</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¿€æ´»<code>æµæ’ä»¶</code>åï¼ŒStreamé˜Ÿåˆ—çš„æ“ä½œæ–¹å¼å¯ä»¥æ›´é«˜çº§ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href=\"https://www.rabbitmq.com/tutorials/tutorial-two-java-stream\">å®˜æ–¹æ–‡æ¡£</a>ï¼Œä½œè€…åœ¨<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo/rabbitmq-stream\">Java Client ç¤ºä¾‹</a>ä¸­ä¹Ÿç»™å‡ºäº†ç¤ºä¾‹ä»£ç ã€‚</p>\n</li>\n</ul>\n<h3 id=\"è¶…çº§æµ-Super-Streams\">è¶…çº§æµ(Super Streams)</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¶…çº§æµï¼ˆSuper streamsï¼‰ æ˜¯ä¸€ç§é€šè¿‡å°†ä¸€ä¸ªå¤§çš„æµåˆ†åŒºæˆæ›´å°çš„æµæ¥å®ç°æ‰©å±•çš„æ–¹å¼ã€‚å®ƒä»¬ä¸ å•ä¸ªæ¶ˆè´¹è€…ï¼ˆSingle Active Consumerï¼‰ é›†æˆï¼Œä»¥åœ¨åˆ†åŒºå†…ä¿æŒæ¶ˆæ¯é¡ºåºã€‚è¶…çº§æµä» RabbitMQ 3.11 å¼€å§‹å¯ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªè¶…çº§æµæ˜¯ç”±å¤šä¸ªæ™®é€šæµç»„æˆçš„é€»è¾‘æµã€‚å®ƒæ˜¯ä¸€ç§é€šè¿‡ RabbitMQ Streams æ¥æ‰©å±•å‘å¸ƒå’Œæ¶ˆè´¹çš„æ–¹æ³•ï¼šä¸€ä¸ªå¤§å‹é€»è¾‘æµè¢«åˆ’åˆ†æˆå¤šä¸ªåˆ†åŒºæµï¼Œå°†å­˜å‚¨å’Œæµé‡åˆ†æ•£åˆ°å¤šä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¶…çº§æµä¾ç„¶æ˜¯ä¸€ä¸ªé€»è¾‘å®ä½“ï¼šç”±äºå®¢æˆ·ç«¯åº“çš„æ™ºèƒ½åŒ–å¤„ç†ï¼Œåº”ç”¨ç¨‹åºä¼šæŠŠå®ƒè§†ä¸ºä¸€ä¸ªâ€œå¤§å‹â€æµã€‚è¶…çº§æµçš„æ‹“æ‰‘ç»“æ„åŸºäº AMQP 0.9.1 æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯äº¤æ¢æœºï¼ˆexchangeï¼‰ã€é˜Ÿåˆ—ï¼ˆqueueï¼‰å’Œå®ƒä»¬ä¹‹é—´çš„ç»‘å®šï¼ˆbindingï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯ä»¥ä½¿ç”¨ä»»ä½• AMQP 0.9.1 åº“æˆ–ç®¡ç†æ’ä»¶åˆ›å»ºè¶…çº§æµçš„æ‹“æ‰‘ã€‚å®ƒéœ€è¦åˆ›å»ºä¸€ä¸ªç›´è¿äº¤æ¢æœºï¼ˆdirect exchangeï¼‰ã€åˆ†åŒºæµï¼ˆpartition streamsï¼‰ï¼Œå¹¶å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ç®¡ç†æ§åˆ¶å°åˆ›å»ºè¶…çº§æµ<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/j2G1HC.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤åˆ›å»ºè¶…çº§æµï¼Œä»¥ä¸‹æ˜¯å¦‚ä½•ç”¨å‘½ä»¤åˆ›å»ºä¸€ä¸ªåŒ…å« 3 ä¸ªåˆ†åŒºçš„è¶…çº§æµï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># rabbitmq-streams add_super_stream [-p &lt;vhost&gt;] &lt;stream-name&gt; [--partitions &lt;number&gt;]</span></span><br><span class=\"line\">rabbitmq-streams add_super_stream -p /vtest sq_3 --partitions 3</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>åˆ›å»ºçš„Stream<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/4py5OE.png\" alt=\"\"><br>\nåˆ›å»ºçš„ Exchangeï¼Œåç§° sq_3<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/EwfTRM.png\" alt=\"\"><br>\nç»‘å®šå…³ç³»<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/NErhQX.png\" alt=\"\"></p>\n</blockquote>\n<h2 id=\"é˜Ÿåˆ—ç±»å‹æ‰©å±•\">é˜Ÿåˆ—ç±»å‹æ‰©å±•</h2>\n<h3 id=\"æ‡’é˜Ÿåˆ—\">æ‡’é˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»3.6.xç‰ˆæœ¬åˆ°3.12.xç‰ˆæœ¬ï¼ŒRabbitMQæä¾›äº†ä¸€ç§é’ˆå¯¹Classic Queueçš„ä¼˜åŒ–é…ç½®ï¼Œ<code>lazy-mode</code>ï¼Œ<a href=\"https://www.rabbitmq.com/docs/lazy-queues\">æ‡’å¯¹åˆ—</a>ã€‚æ‡’é˜Ÿåˆ—ä¼šå°½å¯èƒ½æ—©çš„å°†æ¶ˆæ¯å†…å®¹ä¿å­˜åˆ°ç¡¬ç›˜å½“ä¸­ï¼Œå¹¶ä¸”åªæœ‰åœ¨ç”¨æˆ·è¯·æ±‚åˆ°æ—¶ï¼Œæ‰ä¸´æ—¶ä»ç¡¬ç›˜åŠ è½½åˆ°RAMå†…å­˜å½“ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQæ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œä¼šä¿å­˜åˆ°å†…å­˜ä»¥ä¾¿ä½¿ç”¨ï¼ŒåŒæ—¶æŠŠæ¶ˆæ¯å†™åˆ°ç¡¬ç›˜ã€‚ä½†æ˜¯ï¼Œæ¶ˆæ¯å†™å…¥ç¡¬ç›˜çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¼šé˜»å¡é˜Ÿåˆ—çš„ã€‚RabbitMQè™½ç„¶é’ˆå¯¹å†™å…¥ç¡¬ç›˜é€Ÿåº¦åšäº†å¾ˆå¤šç®—æ³•ä¼˜åŒ–ï¼Œä½†æ˜¯åœ¨é•¿é˜Ÿåˆ—ä¸­ï¼Œä¾ç„¶è¡¨ç°ä¸æ˜¯å¾ˆç†æƒ³ï¼Œæ‰€ä»¥å°±æœ‰äº†æ‡’é˜Ÿåˆ—çš„å‡ºç°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‡’é˜Ÿåˆ—ä¼šå°è¯•å°½å¯èƒ½æ—©çš„æŠŠæ¶ˆæ¯å†™åˆ°ç¡¬ç›˜ä¸­ã€‚è¿™æ„å‘³ç€åœ¨æ­£å¸¸æ“ä½œçš„å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒRAMä¸­è¦ä¿å­˜çš„æ¶ˆæ¯è¦å°‘å¾—å¤šã€‚å½“ç„¶ï¼Œè¿™æ˜¯ä»¥å¢åŠ ç£ç›˜IOä¸ºä»£ä»·çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ‡’é˜Ÿåˆ—é€‚åˆæ¶ˆæ¯é‡å¤§ä¸”é•¿æœŸæœ‰å †ç§¯çš„é˜Ÿåˆ—ï¼Œå¯ä»¥å‡å°‘å†…å­˜ä½¿ç”¨ï¼ŒåŠ å¿«æ¶ˆè´¹é€Ÿåº¦ã€‚ä½†æ˜¯è¿™æ˜¯ä»¥å¤§é‡æ¶ˆè€—é›†ç¾¤çš„ç½‘ç»œåŠç£ç›˜IOä¸ºä»£ä»·çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»3.12å¾€åçš„ç‰ˆæœ¬ä¸­ï¼ŒRabbitMQ ä¸å†æ”¯æŒâ€œæƒ°æ€§â€æ¨¡å¼ï¼Œå› ä¸º ç»å…¸é˜Ÿåˆ— å½“å‰çš„ç‰¹æ€§å°±ç±»ä¼¼äºä»¥å‰çš„ æ‡’é˜Ÿåˆ—ã€‚</p>\n</li>\n</ul>\n<h3 id=\"æ­»ä¿¡é˜Ÿåˆ—\">æ­»ä¿¡é˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com/docs/dlx\">æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead Letter Queueï¼‰</a>ï¼Œæ–°ç‰ˆä¸­å«åš æ­»ä¿¡äº¤æ¢æœºï¼ˆDead Letter Exchange, DLXï¼‰ï¼Œæ˜¯RabbitMQå¯¹äºæœªèƒ½æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯è¿›è¡Œçš„ä¸€ç§è¡¥æ•‘æœºåˆ¶ï¼Œç”¨äºä¿å­˜æ— æ³•è¢«æ­£å¸¸å¤„ç†çš„æ¶ˆæ¯ã€‚å½“æ¶ˆæ¯è¢«æ¶ˆè´¹è€…å¤„ç†å¤±è´¥æ—¶ï¼ŒRabbitMQä¼šå°†æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­»ä¿¡é˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„é˜Ÿåˆ—ï¼ŒåŒæ ·å¯ä»¥åœ¨é˜Ÿåˆ—ä¸Šå£°æ˜æ¶ˆè´¹è€…ï¼Œç»§ç»­å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹å¤„ç†ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼ŒRabbitMQä¼šå°†ä¸€ä¸ªæ­£å¸¸æ¶ˆæ¯è½¬æˆæ­»ä¿¡</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆMessage rejectionï¼‰\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">ç”± AMQP 1.0 æ¥æ”¶ç«¯ä½¿ç”¨ rejected ç»“æœæ‹’ç»</li>\n<li class=\"lvl-6\">ç”± AMQP 0.9.1 æ¶ˆè´¹è€…ä½¿ç”¨ basic.reject æˆ– basic.nackï¼Œå¹¶ä¸”å‚æ•° requeue=false</li>\n</ul>\n</li>\n<li class=\"lvl-4\">æ¶ˆæ¯è¿‡æœŸï¼ˆMessage expirationï¼‰\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">æ¶ˆæ¯è¶…è¿‡å…¶é…ç½®çš„ TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰ åè¿‡æœŸã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">é˜Ÿåˆ—é•¿åº¦è¶…é™ï¼ˆQueue length exceededï¼‰\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ•°é‡æˆ–æ€»å­—èŠ‚æ•°è¾¾åˆ°é…ç½®çš„æœ€å¤§é™åˆ¶åï¼Œè¢«ä¸¢å¼ƒçš„æ¶ˆæ¯ä¼šæ­»ä¿¡åŒ–ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-4\">æŠ•é€’æ¬¡æ•°è¶…é™ï¼ˆä»…é€‚ç”¨äºä»²è£é˜Ÿåˆ— Quorum Queueï¼‰\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">æ¶ˆæ¯çš„æŠ•é€’æ¬¡æ•°è¶…è¿‡äº†ä»²è£é˜Ÿåˆ—ä¸­é…ç½®çš„ delivery-limitã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨åœºæ™¯</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ä½ å¯ä»¥åœ¨é˜Ÿåˆ—ä¸Šé…ç½® æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰ å’Œ æ­»ä¿¡è·¯ç”±é”®ï¼ˆDead Letter Routing Keyï¼‰ã€‚</li>\n<li class=\"lvl-4\">å½“æ¶ˆæ¯æˆä¸ºæ­»ä¿¡æ—¶ï¼Œä¼šè¢« é‡æ–°å‘å¸ƒåˆ° DLXï¼Œè¿™æ ·ä½ å¯ä»¥ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">åšé”™è¯¯æ—¥å¿—è®°å½•</li>\n<li class=\"lvl-6\">è¿›è¡Œå¤±è´¥æ¶ˆæ¯é‡è¯•</li>\n<li class=\"lvl-6\">ç”¨äºç›‘æ§å’Œå‘Šè­¦</li>\n</ul>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ­»ä¿¡äº¤æ¢æœºçš„é…ç½®æ–¹æ³•ï¼ˆHow Dead Lettering is Configuredï¼‰</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åœ¨ RabbitMQ ä¸­ï¼Œä»»ä½•é˜Ÿåˆ—éƒ½å¯ä»¥é€šè¿‡ å®¢æˆ·ç«¯ æˆ–è€… ç­–ç•¥ï¼ˆpoliciesï¼‰ æ¥é…ç½® æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰ã€‚</li>\n<li class=\"lvl-4\">é…ç½®æ—¶ä¸»è¦æ¶‰åŠä¸¤ä¸ªæ ¸å¿ƒå‚æ•°ï¼š</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é…ç½®å‚æ•°å</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>dead-letter-exchange</strong></td>\n<td>æŒ‡å®šç”¨äºæ¥æ”¶æ­»ä¿¡æ¶ˆæ¯çš„ <strong>æ­»ä¿¡äº¤æ¢æœºåç§°</strong></td>\n</tr>\n<tr>\n<td><strong>dead-letter-routing-key</strong></td>\n<td>æŒ‡å®šæ­»ä¿¡æ¶ˆæ¯é‡æ–°å‘å¸ƒæ—¶ä½¿ç”¨çš„ <strong>è·¯ç”±é”®ï¼ˆRouting Keyï¼‰</strong></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>æ­»ä¿¡åœ¨è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—æ—¶ï¼Œä»–çš„ routingkey ä¹Ÿä¼šä¿å­˜ä¸‹æ¥ã€‚ä½†æ˜¯å¦‚æœé…ç½®äº† <code>x-dead-letter-routing-key</code> è¿™ä¸ªå‚æ•°çš„è¯ï¼Œroutingkey å°±ä¼šè¢«æ›¿æ¢ä¸ºé…ç½®çš„è¿™ä¸ªå€¼ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºé˜Ÿåˆ—æ·»åŠ  <code>x-dead-letter-exchange</code> å’Œ <code>x-dead-letter-routing-key</code> å‚æ•°ï¼Œæ¥æŒ‡å®š æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰å’Œ æ­»ä¿¡è·¯ç”±é”®ï¼ˆDead Letter Routing Keyï¼‰ã€‚ä½†æ˜¯è¿™æ ·åšå¾ˆéº»çƒ¦ï¼Œæ¯ä¸ªé˜Ÿåˆ—éƒ½è¦å•ç‹¬é…ç½®ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ç­–ç•¥ï¼ˆpoliciesï¼‰ æ¥ç»Ÿä¸€é…ç½®ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»…æŒ‡å®šæ­»ä¿¡äº¤æ¢æœºï¼Œè¿™é‡Œäº¤æ¢æœºçš„åç§°æ˜¯ my-dlxï¼Œäº¤æ¢æœºè¦æå‰åˆ›å»ºå¥½</span></span><br><span class=\"line\">rabbitmqctl set_policy DLX <span class=\"string\">&quot;.*&quot;</span> <span class=\"string\">&#x27;&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;&#125;&#x27;</span> --apply-to queues --priority 7</span><br><span class=\"line\"><span class=\"comment\"># åŒæ—¶æŒ‡å®š æ­»ä¿¡äº¤æ¢æœº å’Œ è·¯ç”±é”®</span></span><br><span class=\"line\">rabbitmqctl set_policy DLX <span class=\"string\">&quot;.*&quot;</span> <span class=\"string\">&#x27;&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;, &quot;dead-letter-routing-key&quot;:&quot;my-routing-key&quot;&#125;&#x27;</span> --apply-to queues --priority 7</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>éƒ¨åˆ†</th>\n<th>å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>rabbitmqctl</code></td>\n<td>RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·</td>\n</tr>\n<tr>\n<td><code>set_policy</code></td>\n<td>è®¾ç½®ä¸€ä¸ªç­–ç•¥ï¼ˆPolicyï¼‰ï¼Œç”¨äºåŠ¨æ€é…ç½®äº¤æ¢æœºã€é˜Ÿåˆ—æˆ–ç»‘å®šçš„å‚æ•°</td>\n</tr>\n<tr>\n<td><code>DLX</code></td>\n<td>ç­–ç•¥çš„åç§°ï¼Œç”¨æˆ·è‡ªå®šä¹‰ï¼Œä¾‹å¦‚è¿™é‡Œå« <code>DLX</code></td>\n</tr>\n<tr>\n<td><code>&quot;.*&quot;</code></td>\n<td>æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å¯¹è±¡çš„åç§°ã€‚<code>.*</code> è¡¨ç¤ºåŒ¹é… <strong>æ‰€æœ‰é˜Ÿåˆ—</strong>ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“é˜Ÿåˆ—åï¼Œæ¯”å¦‚ <code>^my-queue$</code></td>\n</tr>\n<tr>\n<td><code>&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;, &quot;dead-letter-routing-key&quot;:&quot;my-routing-key&quot;&#125;</code></td>\n<td>ç­–ç•¥å†…å®¹ï¼Œè¿™é‡Œè®¾ç½®äº†æ­»ä¿¡äº¤æ¢æœºåç§°å’Œè·¯ç”±é”®ï¼š<br> - <code>dead-letter-exchange</code>: è®¾ç½®æ­»ä¿¡äº¤æ¢æœºåç§°ä¸º <code>my-dlx</code><br> - <code>dead-letter-routing-key</code>: è®¾ç½®è·¯ç”±é”®ä¸º <code>my-routing-key</code></td>\n</tr>\n<tr>\n<td><code>--apply-to queues</code></td>\n<td>æŒ‡å®šç­–ç•¥ä½œç”¨å¯¹è±¡ä¸º <strong>é˜Ÿåˆ—ï¼ˆqueuesï¼‰</strong>ï¼Œè€Œä¸æ˜¯äº¤æ¢æœºï¼ˆexchangesï¼‰æˆ–ç»‘å®šï¼ˆbindingsï¼‰</td>\n</tr>\n<tr>\n<td><code>--priority 7</code></td>\n<td>ç­–ç•¥çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ã€‚å¤šä¸ªç­–ç•¥ä½œç”¨åœ¨åŒä¸€å¯¹è±¡æ—¶ï¼Œä¼˜å…ˆçº§é«˜çš„ä¼šè¦†ç›–ä½çš„</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‰§è¡Œè¿™æ¡å‘½ä»¤åï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Š <code>x-dead-letter-exchange=my-dlx</code> å’Œ <code>x-dead-letter-routing-key=my-routing-key</code> é…ç½®ã€‚</li>\n<li class=\"lvl-4\">é˜Ÿåˆ—ä¸­è¢«æ‹’ç»ã€è¿‡æœŸã€è¶…é•¿æˆ–è¶…è¿‡æŠ•é€’æ¬¡æ•°çš„æ¶ˆæ¯ä¼šè¢«é‡æ–°å‘å¸ƒåˆ° <code>my-dlx</code> äº¤æ¢æœºï¼Œå¹¶ä½¿ç”¨ <code>my-routing-key</code> ä½œä¸ºè·¯ç”±é”®ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ¶ˆæ¯è¢«ä½œä¸ºæ­»ä¿¡è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—åï¼Œä¼šåœ¨Headerå½“ä¸­å¢åŠ â¼€äº›æ¶ˆæ¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x-first-death-queueï¼šè¯¥æ¶ˆæ¯é¦–æ¬¡æˆä¸ºæ­»ä¿¡æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—åç§°</span><br><span class=\"line\">x-first-death-reasonï¼šè¯¥æ¶ˆæ¯é¦–æ¬¡è¢«åˆ¤å®šä¸ºæ­»ä¿¡çš„åŸå› </span><br><span class=\"line\">x-first-death-exchangeï¼šè¯¥æ¶ˆæ¯åœ¨é¦–æ¬¡æˆä¸ºæ­»ä¿¡å‰è¢«å‘å¸ƒåˆ°çš„äº¤æ¢æœºåç§°</span><br><span class=\"line\">x-last-death-queueï¼šè¯¥æ¶ˆæ¯æœ€è¿‘ä¸€æ¬¡æˆä¸ºæ­»ä¿¡æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—åç§°</span><br><span class=\"line\">x-last-death-reasonï¼šè¯¥æ¶ˆæ¯æœ€è¿‘ä¸€æ¬¡è¢«åˆ¤å®šä¸ºæ­»ä¿¡çš„åŸå› </span><br><span class=\"line\">x-last-death-exchangeï¼šè¯¥æ¶ˆæ¯åœ¨æœ€è¿‘ä¸€æ¬¡æˆä¸ºæ­»ä¿¡å‰è¢«å‘å¸ƒåˆ°çš„äº¤æ¢æœºåç§°</span><br></pre></td></tr></table></figure>\n<h3 id=\"å»¶è¿Ÿé˜Ÿåˆ—\">å»¶è¿Ÿé˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆDelayed Message Queueï¼‰: å»¶è¿Ÿé˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„é˜Ÿåˆ—ï¼Œç”¨äºå»¶è¿Ÿæ¶ˆæ¯çš„æŠ•é€’ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQä¸­ï¼Œæ˜¯ä¸å­˜åœ¨å»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½çš„ï¼Œè€Œé€šå¸¸å¦‚æœè¦ç”¨åˆ°å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå°±ä¼šé‡‡ç”¨ <code>TTL</code> + <code>æ­»ä¿¡é˜Ÿåˆ—</code> çš„æ–¹å¼æ¥å®ç°ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°åŸç†ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åˆ›å»ºä¸€ä¸ªæ™®é€šé˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®é˜Ÿåˆ—çš„ TTLï¼ˆx-message-ttlï¼‰å‚æ•°ï¼Œä»¥åŠæŒ‡å®šä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—(x-dead-letter-exchange)</li>\n<li class=\"lvl-4\">å½“æ¶ˆæ¯çš„ TTL åˆ°æœŸæ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨ä»å½“å‰é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œå¹¶è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚</li>\n<li class=\"lvl-4\">ä¸ºæ­»ä¿¡é˜Ÿåˆ—åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¤„ç†å»¶è¿Ÿæ¶ˆæ¯ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ä¼˜å…ˆçº§é˜Ÿåˆ—\">ä¼˜å…ˆçº§é˜Ÿåˆ—</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆPriority Queueï¼‰: RabbitMQ æ”¯æŒä¸ºç»å…¸é˜Ÿåˆ—ï¼ˆclassic queuesï¼‰æ·»åŠ â€œä¼˜å…ˆçº§â€åŠŸèƒ½ã€‚å¯ç”¨â€œä¼˜å…ˆçº§â€åŠŸèƒ½çš„ç»å…¸é˜Ÿåˆ—é€šå¸¸è¢«ç§°ä¸ºâ€œä¼˜å…ˆçº§é˜Ÿåˆ—â€ï¼ˆpriority queuesï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ æ”¯æŒ 1 åˆ° 255 ä¹‹é—´çš„ä¼˜å…ˆçº§å€¼ï¼Œä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨ 1 åˆ° 5 ä¹‹é—´çš„å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼˜å…ˆçº§å€¼è¶Šé«˜ï¼Œä¼šæ¶ˆè€—æ›´å¤šçš„ CPU å’Œå†…å­˜èµ„æºï¼Œå› ä¸º RabbitMQ åœ¨å†…éƒ¨éœ€è¦ä¸ºæ¯ä¸ªä¼˜å…ˆçº§ï¼ˆä» 1 åˆ°æœ€å¤§é…ç½®å€¼ï¼‰ç»´æŠ¤ä¸€ä¸ªå­é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åªæœ‰ç»å…¸é˜Ÿåˆ—æ”¯æŒé€šè¿‡å‚æ•°<code>x-max-priority</code>æŒ‡å®šé˜Ÿåˆ—æ”¯æŒçš„æœ€å¤§ä¼˜å…ˆçº§ï¼Œä¸”ä¸æ”¯æŒ é€šè¿‡ ç­–ç•¥ï¼ˆpoliciesï¼‰ å°†ç»å…¸é˜Ÿåˆ—å£°æ˜ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€šè¿‡å‚æ•° <code>priority</code> æŒ‡å®šæ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€‚æ˜¯çš„ï¼Œæ¶ˆæ¯ä¹Ÿæ˜¯å¯ä»¥è®¾ç½®å‚æ•°çš„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¼˜å…ˆçº§é˜Ÿåˆ—å¦‚ä½•ä¸æ¶ˆè´¹è€…ååŒå·¥ä½œ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è‹¥æ¶ˆè´¹è€…è¿æ¥åˆ°ä¸€ä¸ª ç©ºé˜Ÿåˆ—ï¼Œç„¶åæ¶ˆæ¯é™†ç»­è¢«å‘å¸ƒï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆæ¯å¯èƒ½ ä¸ä¼š åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼ˆå³åˆšå‘å¸ƒå°±è¢«æ¶ˆè´¹è€…æ¥æ”¶ï¼‰ï¼Œæ­¤æ—¶ä¼˜å…ˆçº§åŠŸèƒ½æ²¡æœ‰æœºä¼šä¸Šåœºã€‚ä¼˜å…ˆçº§æ˜¯åœ¨æ¶ˆæ¯æ’é˜Ÿï¼ˆready æ¶ˆæ¯ï¼‰çŠ¶æ€æ—¶æ‰èƒ½ä½“ç°å…¶ä½œç”¨ã€‚</li>\n<li class=\"lvl-4\">æ¨èåœ¨æ¶ˆè´¹è€…ç«¯ä½¿ç”¨ basic.qos(prefetch) è®¾ç½®ï¼ˆåœ¨ manual ack æ¨¡å¼ä¸‹ï¼‰ï¼Œä»¥é™åˆ¶æ¶ˆè´¹è€…åŒæ—¶å¤„ç†çš„æœªç¡®è®¤æ¶ˆæ¯æ•°ã€‚è¿™æ ·èƒ½è®©ä¼˜å…ˆçº§çš„åˆ†çº§æ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œå› ä¸ºå¦‚æœ prefetch æ•°é‡æœªæ»¡ï¼Œé«˜ä¼˜å…ˆçº§æ¶ˆæ¯å¯ä»¥å…ˆè¢«å–å‡ºã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æ³¨æ„äº‹é¡¹</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æœªè®¾ç½® <code>priority</code> çš„æ¶ˆæ¯ ä¼šè¢«å½“ä½œä¼˜å…ˆçº§ 0 å¤„ç†ã€‚è‹¥æ¶ˆæ¯æŒ‡å®šçš„ä¼˜å…ˆçº§å¤§äºé˜Ÿåˆ—çš„æœ€å¤§å€¼ï¼ˆx-max-priorityï¼‰ï¼Œåˆ™è¯¥æ¶ˆæ¯çš„ä¼˜å…ˆçº§å°±æ˜¯<code>x-max-priority</code>ã€‚</li>\n<li class=\"lvl-4\">TTL / æ¶ˆæ¯è¿‡æœŸ (message expiration)ï¼šå³ä½¿è®¾ç½®äº† TTLï¼Œè¿‡æœŸçš„æ¶ˆæ¯åªä¼šåœ¨é˜Ÿåˆ—å¤´è¢«æ£€æŸ¥ã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªä½ä¼˜å…ˆçº§çš„æ¶ˆæ¯åœ¨å‰é¢ä½†è¿˜æ²¡è¿‡æœŸï¼Œè€Œé«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯åœ¨åé¢ï¼Œä½ä¼˜å…ˆçº§çš„æ¶ˆæ¯å¯èƒ½ä¼šé˜»å¡é˜Ÿåˆ—å¤´ï¼Œå¯¼è‡´é«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯è¢«å»¶è¿Ÿã€‚</li>\n<li class=\"lvl-4\">é˜Ÿåˆ—æœ€å¤§é•¿åº¦é™åˆ¶ (max-length)ï¼šå¦‚æœé˜Ÿåˆ—è®¾ç½®äº†æœ€å¤§é•¿åº¦ï¼Œé˜Ÿåˆ—ä¼šä»å¤´éƒ¨ (head) ä¸¢å¼ƒæ¶ˆæ¯ä»¥ç»´æŒé•¿åº¦é™åˆ¶ã€‚è¿™å¯èƒ½å¯¼è‡´é«˜ä¼˜å…ˆçº§æ¶ˆæ¯ä¹Ÿè¢«ä¸¢å¼ƒï¼Œä»è€Œè¿èƒŒç›´è§‰ã€‚</li>\n</ul>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Queue çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹ Queue(é˜Ÿåˆ—) æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨ RabbitMQ ä¸­ï¼Œé˜Ÿåˆ—ï¼ˆQueueï¼‰ æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨æ¶ˆæ¯çš„ æ•°æ®ç»“æ„ï¼Œæ¶ˆæ¯ä¼šä¸€ç›´ä¿å­˜åœ¨é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°è¢«åº”ç”¨ç¨‹åºæˆ–æœåŠ¡æ¶ˆè´¹ä¸ºæ­¢ã€‚ ç”Ÿäº§è€…ï¼ˆPublisherï¼‰ æŠŠæ¶ˆæ¯æ”¾è¿›é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ã€‚é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šæŒ‰ç…§ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„é¡ºåºè¿›è¡Œæ¶ˆè´¹ã€‚ é˜Ÿåˆ—åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´èµ·åˆ°ç¼“å†²åŒºçš„ä½œç”¨ã€‚ç”Ÿäº§è€…ä¸éœ€è¦çŸ¥é“æ¶ˆè´¹è€…çš„å­˜åœ¨ï¼Œå®ƒä»¬åªéœ€æŠŠæ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ã€‚æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®è‡ªèº«å¤„ç†é€Ÿåº¦ï¼ŒæŒ‰éœ€æ¶ˆè´¹æ¶ˆæ¯ã€‚ RabbitMQ ç›®å‰ æ”¯æŒä¸‰ç§é˜Ÿåˆ—ç±»å‹ï¼š é˜Ÿåˆ—ç±»å‹ æè¿° ç‰¹ç‚¹ å…¸å‹ç”¨é€” Classic Queueï¼ˆç»å…¸é˜Ÿåˆ—ï¼‰ æœ€å¸¸ç”¨çš„é˜Ÿåˆ—ç±»å‹ï¼Œæ¶ˆæ¯æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰é¡ºåºå­˜å‚¨å’Œæ¶ˆè´¹ æ”¯æŒæŒä¹…åŒ–ã€ä¼˜å…ˆçº§ã€TTLã€æ­»ä¿¡ç­‰ å¤§å¤šæ•°å¸¸è§„æ¶ˆæ¯åœºæ™¯ Quorum Queueï¼ˆä»²è£é˜Ÿåˆ—ï¼‰ åŸºäº Raft åè®®çš„é˜Ÿåˆ—ï¼Œç¡®ä¿é«˜å¯ç”¨å’Œæ•°æ®ä¸€è‡´æ€§ å†…ç½®å¤åˆ¶ï¼ˆå‰¯æœ¬æ•°é‡å¯é…ç½®ï¼‰ã€é€‚åˆé«˜å¯é æ€§åœºæ™¯ï¼Œä½†ååé‡ç•¥ä½äºç»å…¸é˜Ÿåˆ— å…³é”®ä»»åŠ¡æ¶ˆæ¯ã€é«˜å¯é æ€§åœºæ™¯ Stream Queueï¼ˆæµå¼é˜Ÿåˆ—ï¼‰ é¢å‘å¤§é‡æ¶ˆæ¯çš„é«˜ååé˜Ÿåˆ—ï¼Œæ”¯æŒæ¶ˆæ¯æŒ‰åç§»é‡è¯»å– ç±»ä¼¼ Kafkaï¼Œå¯éšæœºè®¿é—®å†å²æ¶ˆæ¯ã€é¡ºåºè¯»å–ã€å¯æŒä¹…åŒ–å¤§é‡æ¶ˆæ¯ å¤§æ•°æ®æµã€æ—¥å¿—å¤„ç†ã€äº‹ä»¶æº¯æº Classic Queue(ç»å…¸é˜Ÿåˆ—) RabbitMQ ç»å…¸é˜Ÿåˆ—ï¼ˆåŸå§‹é˜Ÿåˆ—ç±»å‹ï¼‰æ˜¯ä¸€ç§é€šç”¨é˜Ÿåˆ—ç±»å‹ã€‚å®é™…ä¸Šå®ƒæ˜¯åœ¨ 3.8.x ç‰ˆæœ¬ä¹‹å‰å”¯ä¸€çš„é˜Ÿåˆ—ç±»å‹ã€‚ ç»å…¸é˜Ÿåˆ—é€‚ç”¨äºæ•°æ®å®‰å…¨ä¸æ˜¯ä¼˜å…ˆäº‹é¡¹çš„ç”¨ä¾‹ï¼Œå› ä¸ºå­˜å‚¨åœ¨ç»å…¸é˜Ÿåˆ—ä¸­çš„æ•°æ®ä¸ä¼šè¢«å¤åˆ¶ã€‚ ç»å…¸é˜Ÿåˆ—ä½¿ç”¨éå¤åˆ¶çš„ FIFO é˜Ÿåˆ—å®ç°ã€‚ ç»å…¸é˜Ÿåˆ—ä¸é€‚åˆç§¯ç´¯å¤ªå¤šçš„æ¶ˆæ¯ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­ç§¯ç´¯çš„æ¶ˆæ¯å¤ªå¤šäº†ï¼Œä¼šä¸¥é‡å½±å“å®¢æˆ·ç«¯ç”Ÿäº§æ¶ˆæ¯ä»¥åŠæ¶ˆè´¹æ¶ˆæ¯çš„æ€§èƒ½ã€‚å› æ­¤ï¼Œç»å…¸é˜Ÿåˆ—ä¸»è¦ç”¨åœ¨æ•°æ®é‡æ¯”è¾ƒå°ï¼Œå¹¶ä¸”ç”Ÿäº§æ¶ˆæ¯å’Œæ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦æ¯”è¾ƒç¨³å®šçš„ä¸šåŠ¡åœºæ™¯ã€‚æ¯”å¦‚å†…éƒ¨ç³»ç»Ÿä¹‹é—´çš„æœåŠ¡è°ƒç”¨ã€‚ RabbitMQ 4.0 åˆ é™¤äº†å¯¹ç»å…¸é˜Ÿåˆ— version1 çš„æ”¯æŒï¼ŒåŒæ—¶ä¹Ÿä¸å†æ”¯æŒå°† ç»å…¸é˜Ÿåˆ— çš„æ¶ˆæ¯åœ¨èŠ‚ç‚¹é—´å¤åˆ¶ã€‚ å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†) å‚æ•°åç§° é…ç½®å‚æ•°å æ•°æ®ç±»å‹ ä½œç”¨è¯´æ˜ å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯ Auto expire x-expires æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰ é˜Ÿåˆ—åœ¨ æŒ‡å®šæ—¶é—´å†…æ— äººä½¿ç”¨ï¼ˆæ— æ¶ˆè´¹è€…ã€æ— å‘å¸ƒã€æ— è®¿é—®ï¼‰ æ—¶è‡ªåŠ¨åˆ é™¤ ç±»ä¼¼â€œé˜Ÿåˆ—ç©ºé—²è¿‡æœŸæ—¶é—´â€ï¼ŒèŠ‚çœèµ„æº Message TTL x-message-ttl æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰ æ¶ˆæ¯çš„ å­˜æ´»æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´åæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ— ç”¨äºé™åˆ¶æ¶ˆæ¯æ—¶æ•ˆæ€§ï¼Œå¦‚å»¶è¿Ÿæ¶ˆæ¯æˆ–çŸ­æœŸç¼“å­˜ Overflow behaviour x-overflow å­—ç¬¦ä¸²ï¼ˆdrop-head æˆ– reject-publishï¼‰ å½“é˜Ÿåˆ—è¾¾åˆ° æœ€å¤§é•¿åº¦ æˆ– æœ€å¤§å­—èŠ‚æ•° æ—¶çš„è¡Œä¸º - drop-headï¼šä¸¢å¼ƒæœ€æ—©çš„æ¶ˆæ¯ - reject-publishï¼šæ‹’ç»æ–°çš„æ¶ˆæ¯ Single active consumer x-single-active-consumer å¸ƒå°”å€¼ï¼ˆtrue/falseï¼‰ æ˜¯å¦å¯ç”¨ å•æ´»æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ— ç”¨äºä¸¥æ ¼é¡ºåºæ¶ˆè´¹ï¼Œä¿è¯æŸä¸ªæ¶ˆæ¯ä¸ä¼šè¢«å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶å¤„ç† Dead letter exchange (DLX) x-dead-letter-exchange å­—ç¬¦ä¸² æŒ‡å®šé˜Ÿåˆ—çš„ æ­»ä¿¡äº¤æ¢æœºï¼Œç”¨äºæ¥æ”¶æ— æ³•æ¶ˆè´¹æˆ–è¿‡æœŸçš„æ¶ˆæ¯ å¸¸ç”¨äºå¤±è´¥é‡è¯•ã€æ¶ˆæ¯è¡¥å¿åœºæ™¯ Dead letter routing key x-dead-letter-routing-key å­—ç¬¦ä¸² æ¶ˆæ¯è½¬å‘åˆ° DLX æ—¶çš„ è·¯ç”±é”® å¯ä»¥çµæ´»è½¬å‘åˆ°ä¸åŒé˜Ÿåˆ— Max length x-max-length æ•´æ•° é˜Ÿåˆ—ä¸­ æœ€å¤§æ¶ˆæ¯æ¡æ•° è¶…è¿‡æ—¶æŒ‰ç…§ Overflow behaviour å¤„ç† Max length bytes x-max-length-bytes æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰ é˜Ÿåˆ—ä¸­ æ¶ˆæ¯æ€»å­—èŠ‚æ•°ä¸Šé™ è¶…è¿‡æ—¶æŒ‰ç…§ Overflow behaviour å¤„ç†ï¼Œé€‚åˆå¤§æ¶ˆæ¯åœºæ™¯ Maximum priority x-max-priority æ•´æ•° å¯ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—å¯è®¾ç½®çš„ æœ€å¤§ä¼˜å…ˆçº§å€¼ æ¶ˆæ¯ä¼˜å…ˆçº§èŒƒå›´æ˜¯ 0 åˆ°è¿™ä¸ªå€¼ï¼Œä¼˜å…ˆçº§é«˜çš„æ¶ˆæ¯å…ˆè¢«æ¶ˆè´¹ Leader locator x-queue-leader-locator å­—ç¬¦ä¸²ï¼ˆclient-localã€balancedï¼‰ è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—ä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™ client-localï¼ˆé»˜è®¤ï¼‰ï¼šé€‰æ‹©å®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸ºLeader balancedï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡Leaderåˆ†å¸ƒï¼Œç”¨äº HA é˜Ÿåˆ—ä¼˜åŒ– Quorum Queue(ä»²è£é˜Ÿåˆ—) ä»²è£é˜Ÿåˆ—ï¼ˆQuorum Queueï¼‰ æ˜¯ RabbitMQ ä»3.8.0ç‰ˆæœ¬ä¹‹åå¼•å…¥çš„ä¸€ç§ç°ä»£é˜Ÿåˆ—ç±»å‹ï¼Œä¹Ÿæ˜¯ç›®å‰å®˜æ–¹æ¯”è¾ƒæ¨èçš„ä¸€ç§å¯¹åˆ—ç±»å‹ã€‚æœªæ¥æœ‰å¯èƒ½å–ä»£ ç»å…¸é˜Ÿåˆ— æˆä¸ºé»˜è®¤é˜Ÿåˆ—ç±»å‹ã€‚ å…¶åŸºäº Raft å…±è¯†ç®—æ³• å®ç° æŒä¹…åŒ–ã€å¤åˆ¶å’Œé«˜å¯ç”¨ã€‚å®ƒä¿è¯ æ•°æ®å®‰å…¨æ€§ã€å¯é çš„ä¸»èŠ‚ç‚¹é€‰ä¸¾ï¼Œå³ä½¿åœ¨å‡çº§æˆ–é›†ç¾¤æ³¢åŠ¨æœŸé—´ä¹Ÿèƒ½ä¿æŒé«˜å¯ç”¨æ€§ã€‚ ä»²è£é˜Ÿåˆ—æ”¯æŒ æ¯’æ¶ˆæ¯å¤„ç†ã€è‡³å°‘ä¸€æ¬¡æ­»ä¿¡æŠ•é€’ ä»¥åŠ AMQP ä¿®æ”¹ï¼ˆAMQP.modifiedï¼‰çš„å¤„ç†ç»“æœã€‚ å®ƒé€‚åˆ ä»¥æ•°æ®å®‰å…¨ä¸ºé¦–è¦ç›®æ ‡ çš„åœºæ™¯ã€‚ä¸ç»å…¸é˜Ÿåˆ—ç›¸æ¯”ï¼ŒQuorumæ˜¯ä»¥ç‰ºç‰²å¾ˆå¤šé«˜çº§é˜Ÿåˆ—ç‰¹æ€§ä¸ºä»£ä»·ï¼Œæ¥è¿›ä¸€æ­¥ä¿è¯æ¶ˆæ¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é«˜å¯é ã€‚ ä»²è£é˜Ÿåˆ—ï¼ˆQuorum Queueï¼‰çš„ Durability åªèƒ½è®¾ç½®ä¸º Durable(true)ã€‚Auto delete åªèƒ½ä¸º No(false)ã€‚ å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†) å‚æ•°åç§° é…ç½®å‚æ•°å æ•°æ®ç±»å‹ ä½œç”¨è¯´æ˜ å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯ Auto expire x-expires æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰ é˜Ÿåˆ—åœ¨æŒ‡å®šæ—¶é—´å†…æ— äººä½¿ç”¨ï¼ˆæ— æ¶ˆè´¹è€…ã€æ— å‘å¸ƒã€æ— è®¿é—®ï¼‰æ—¶è‡ªåŠ¨åˆ é™¤ èŠ‚çœèµ„æºï¼Œé˜Ÿåˆ—ç©ºé—²è¿‡æœŸæ—¶é—´ Message TTL x-message-ttl æ•´æ•°ï¼ˆæ¯«ç§’ï¼‰ é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„ç”Ÿå­˜æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´åæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–è½¬å…¥æ­»ä¿¡é˜Ÿåˆ— æ§åˆ¶æ¶ˆæ¯æ—¶æ•ˆæ€§ Overflow behaviour x-overflow å­—ç¬¦ä¸²ï¼ˆdrop-head æˆ– reject-publishï¼‰ å½“é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦æ—¶çš„å¤„ç†æ–¹å¼ drop-headï¼šä¸¢å¼ƒæœ€æ—©æ¶ˆæ¯ï¼Œreject-publishï¼šæ‹’ç»æ–°æ¶ˆæ¯ Single active consumer x-single-active-consumer å¸ƒå°”å€¼ï¼ˆtrue/falseï¼‰ æ˜¯å¦å¯ç”¨å•æ´»æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ— ä¿è¯ä¸¥æ ¼é¡ºåºæ¶ˆè´¹ Dead letter exchange (DLX) x-dead-letter-exchange å­—ç¬¦ä¸² æŒ‡å®šé˜Ÿåˆ—çš„æ­»ä¿¡äº¤æ¢æœºï¼Œç”¨äºæ¥æ”¶æ— æ³•æ¶ˆè´¹æˆ–è¿‡æœŸçš„æ¶ˆæ¯ ä¸ DLX é…åˆä½¿ç”¨å¤„ç†å¤±è´¥æ¶ˆæ¯ Dead letter routing key x-dead-letter-routing-key å­—ç¬¦ä¸² æ¶ˆæ¯è½¬å‘åˆ° DLX æ—¶çš„è·¯ç”±é”® çµæ´»è·¯ç”±æ­»ä¿¡æ¶ˆæ¯ Max length x-max-length æ•´æ•° é˜Ÿåˆ—ä¸­æœ€å¤§æ¶ˆæ¯æ¡æ•° è¶…è¿‡æ—¶æŒ‰ Overflow behaviour å¤„ç† Max length bytes x-max-length-bytes æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰ é˜Ÿåˆ—æ¶ˆæ¯æ€»å­—èŠ‚æ•°ä¸Šé™ è¶…è¿‡æ—¶æŒ‰ Overflow behaviour å¤„ç† Delivery limit x-delivery-limit æ•´æ•° æ¶ˆæ¯å…è®¸æŠ•é€’çš„æœ€å¤§æ¬¡æ•°ï¼Œè¶…è¿‡åå˜ä¸ºæ­»ä¿¡ æ§åˆ¶æ¶ˆæ¯é‡è¯•æ¬¡æ•° Initial cluster size x-quorum-initial-group-size æ•´æ•° é˜Ÿåˆ—åœ¨åˆ›å»ºæ—¶éœ€è¦çš„æœ€å°èŠ‚ç‚¹æ•° ç”¨äºä¿è¯ä»²è£é˜Ÿåˆ—çš„é«˜å¯ç”¨æ€§ Target cluster size x-quorum-target-group-size æ•´æ•° é˜Ÿåˆ—è¿è¡Œæ—¶çš„ç›®æ ‡èŠ‚ç‚¹æ•° å½“é›†ç¾¤èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œä»²è£é˜Ÿåˆ—ä¼šå°è¯•è°ƒæ•´å‰¯æœ¬æ•°é‡ Dead letter strategy x-dead-letter-strategy å­—ç¬¦ä¸²ï¼ˆat-most-onceã€at-least-onceï¼‰ è®¾ç½®ä»²è£é˜Ÿåˆ—çš„æ­»ä¿¡å¤„ç†ç­–ç•¥ ä»…é€‚ç”¨äº Quorum Queueã€‚at-most-onceï¼ˆé»˜è®¤ï¼‰ï¼šæ¶ˆæ¯æœ€å¤šæŠ•é€’ä¸€æ¬¡ï¼Œå¯èƒ½ä¸¢å¤±ã€‚at-least-onceï¼šç¡®ä¿æ¶ˆæ¯è‡³å°‘æŠ•é€’ä¸€æ¬¡ï¼Œå¿…é¡»å°† Overflow behaviour è®¾ç½®ä¸º reject-publishï¼Œå¦åˆ™å›é€€åˆ° at-most-onceã€‚ Leader locator x-queue-leader-locator å­—ç¬¦ä¸²ï¼ˆclient-localã€balancedï¼‰ è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜é˜Ÿåˆ—æ—¶ï¼Œé˜Ÿåˆ—ä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™ client-localï¼šé€‰æ‹©å®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸º Leader balancedï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡ Leader åˆ†å¸ƒ Quorum Queues å’Œ Classic Queues çš„åŠŸèƒ½å¯¹æ¯”å¦‚ä¸‹ï¼š Feature ä¸­æ–‡å«ä¹‰ Classic queues Quorum queues è¯´æ˜ Non-durable queues éæŒä¹…åŒ–é˜Ÿåˆ— yes no Quorum queues æ€»æ˜¯æŒä¹…åŒ–ï¼Œä¸æ”¯æŒéæŒä¹…åŒ– Message replication æ¶ˆæ¯å¤åˆ¶ no yes Quorum queues å†…ç½®æ¶ˆæ¯å¤åˆ¶ï¼ŒClassic queues éœ€é•œåƒç­–ç•¥ Exclusivity ç‹¬å é˜Ÿåˆ— yes no Classic queues æ”¯æŒç‹¬å é˜Ÿåˆ—ï¼ŒQuorum queues ä¸æ”¯æŒç‹¬å  Per message persistence æ¶ˆæ¯çº§æŒä¹…åŒ– per message always Quorum queues æ¶ˆæ¯æ€»æ˜¯æŒä¹…åŒ– Membership changes èŠ‚ç‚¹æˆå‘˜å˜æ›´ no semi-automatic Quorum queues èŠ‚ç‚¹å˜åŒ–æ—¶åŠè‡ªåŠ¨å¤„ç†å¤åˆ¶ Message TTL (Time-To-Live) æ¶ˆæ¯å­˜æ´»æ—¶é—´ yes yes ä¸¤è€…éƒ½æ”¯æŒæ¶ˆæ¯è¿‡æœŸæ—¶é—´ Queue TTL é˜Ÿåˆ—å­˜æ´»æ—¶é—´ yes partially Quorum queues çš„ lease ä¸ä¼šå› é‡æ–°å£°æ˜è€Œç»­æœŸ Queue length limits é˜Ÿåˆ—é•¿åº¦é™åˆ¶ yes yes Quorum queues æ”¯æŒé•¿åº¦é™åˆ¶ï¼Œä½† x-overflow=reject-publish-dlx ä¸æ”¯æŒ Keeps messages in memory æ¶ˆæ¯å†…å­˜ä¿å­˜ see Classic Queues never Quorum queues æ¶ˆæ¯æ€»æ˜¯å†™å…¥ç£ç›˜ï¼Œä¸ä¿ç•™åœ¨å†…å­˜ Message priority æ¶ˆæ¯ä¼˜å…ˆçº§ yes yes æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§ Single Active Consumer å•æ´»æ¶ˆè´¹è€… yes yes æ”¯æŒå•æ´»æ¶ˆè´¹è€… Consumer exclusivity ç‹¬å æ¶ˆè´¹è€… yes no Quorum queues ä¸æ”¯æŒç‹¬å æ¶ˆè´¹è€…ï¼Œéœ€ä½¿ç”¨ Single Active Consumer Consumer priority æ¶ˆè´¹è€…ä¼˜å…ˆçº§ yes yes æ”¯æŒæ¶ˆè´¹è€…ä¼˜å…ˆçº§ Dead letter exchanges æ­»ä¿¡äº¤æ¢æœº yes yes æ”¯æŒæ­»ä¿¡äº¤æ¢æœº Adheres to policies éµå¾ªç­–ç•¥ yes yes æ”¯æŒç­–ç•¥ï¼Œä½† Quorum queues çš„éƒ¨åˆ†ç­–ç•¥è¡Œä¸ºä¸åŒ Poison message handling æ¯’æ¶ˆæ¯å¤„ç† no yes Quorum queues æ”¯æŒæ¯’æ¶ˆæ¯å¤„ç† Server-named queues æœåŠ¡å™¨è‡ªåŠ¨å‘½åé˜Ÿåˆ— yes no Quorum queues ä¸æ”¯æŒæœåŠ¡å™¨è‡ªåŠ¨å‘½åé˜Ÿåˆ— Stream(æµ) Stream æ˜¯RabbitMQè‡ª 3.9.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ç§æ–°çš„æ•°æ®é˜Ÿåˆ—ç±»å‹ã€‚è¿™ç§é˜Ÿåˆ—ç±»å‹çš„æ¶ˆæ¯æ˜¯æŒä¹…åŒ–åˆ°ç£ç›˜å¹¶ä¸”å…·å¤‡åˆ†å¸ƒå¼å¤‡ä»½çš„ï¼Œæ›´é€‚åˆäºæ¶ˆè´¹è€…å¤šï¼Œè¯»æ¶ˆæ¯éå¸¸é¢‘ç¹çš„åœºæ™¯ã€‚ Stream çš„æ ¸å¿ƒæ˜¯ä»¥append-onlyåªæ·»åŠ çš„æ—¥å¿—æ¥è®°å½•æ¶ˆæ¯ï¼Œæ•´ä½“æ¥è¯´ï¼Œå°±æ˜¯æ¶ˆæ¯å°†ä»¥append-onlyçš„æ–¹å¼æŒä¹…åŒ–åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡è°ƒæ•´æ¯ä¸ªæ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦offsetï¼Œæ¥å®ç°æ¶ˆæ¯çš„å¤šæ¬¡åˆ†å‘ã€‚ Stream ä¸æ”¯æŒæ­»ä¿¡äº¤æ¢æœºï¼Œä¸æ”¯æŒå¤„ç†æ¯’æ¶ˆæ¯ã€‚ å®é™…ä¸Š Stream ä¸å±äºé˜Ÿåˆ—ï¼Œæµï¼ˆStreamsï¼‰ æ˜¯ä¸€ç§ æŒä¹…åŒ–ã€å¯å¤åˆ¶çš„æ•°æ®ç»“æ„ï¼ŒåŠŸèƒ½ä¸Šç±»ä¼¼é˜Ÿåˆ—ï¼šä»ç”Ÿäº§è€…ç¼“å†²æ¶ˆæ¯ä¾›æ¶ˆè´¹è€…è¯»å–ã€‚ä½†å®ƒä¸é˜Ÿåˆ—æœ‰ä¸¤ä¸ªé‡è¦åŒºåˆ«ï¼š å­˜å‚¨æ¨¡å‹ â€“ æµæ˜¯ è¿½åŠ æ—¥å¿—ï¼ˆappend-only logï¼‰ï¼Œæ¶ˆæ¯å¯ä»¥ é‡å¤è¯»å–ç›´åˆ°è¿‡æœŸã€‚ æ¶ˆè´¹æ¨¡å‹ â€“ æµæä¾› éç ´åæ€§æ¶ˆè´¹è¯­ä¹‰ï¼ˆnon-destructive consumer semanticsï¼‰ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å¤šæ¬¡è¯»å–åŒä¸€æ¡æ¶ˆæ¯è€Œä¸ä¼šåˆ é™¤å®ƒã€‚ Stream å§‹ç»ˆæ˜¯æŒä¹…åŒ–å’Œå¤åˆ¶çš„ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚æ¶ˆè´¹è€…å¯ä»¥é€šè¿‡ RabbitMQ å®¢æˆ·ç«¯åº“ æˆ– ä¸“ç”¨äºŒè¿›åˆ¶åè®®æ’ä»¶ è¯»å–æµï¼Œå…¶ä¸­æ’ä»¶æ–¹å¼å¯ä»¥ è®¿é—®æ‰€æœ‰æµç‰¹æ€§ å¹¶æä¾› æœ€ä½³æ€§èƒ½ã€‚åˆç†çš„å®¢æˆ·ç«¯è¿æ¥ç­–ç•¥æœ‰åŠ©äºæå‡ ååé‡å’Œæ•ˆç‡ã€‚ å‚æ•°è¯´æ˜(æ¯ä¸ªç‰ˆæœ¬å¯èƒ½éƒ½æœ‰å˜åŒ–ï¼Œå…·ä½“ä»¥é¡µé¢æ˜¾ç¤ºä¸ºå‡†) å‚æ•°åç§° é…ç½®å‚æ•°å æ•°æ®ç±»å‹ ä½œç”¨è¯´æ˜ å¤‡æ³¨ / ä½¿ç”¨åœºæ™¯ Max length bytes x-max-length-bytes æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰ æµä¸­å…è®¸å­˜å‚¨çš„ æœ€å¤§æ•°æ®æ€»å­—èŠ‚æ•° è¶…è¿‡æ—¶æµå°†åœæ­¢æ¥æ”¶æ–°æ¶ˆæ¯ï¼Œé€‚åˆæ§åˆ¶å­˜å‚¨å®¹é‡ Max time retention x-max-age å­—ç¬¦ä¸²ï¼ˆæ—¶é—´å•ä½ï¼Œä¾‹å¦‚ 1h, 30m, 1dï¼‰ è®¾ç½®æµé˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„ æœ€å¤§ä¿ç•™æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´çš„æ¶ˆæ¯ä¼šè¢«åˆ é™¤ æ”¯æŒæ—¶é—´å•ä½ï¼šY=å¹´, M=æœˆ, D=å¤©, h=å°æ—¶, m=åˆ†é’Ÿ, s=ç§’ã€‚ä¾‹å¦‚ &quot;1h&quot; è¡¨ç¤ºåªä¿ç•™æœ€è¿‘ 1 å°æ—¶çš„æ¶ˆæ¯ï¼Œç”¨äºæ§åˆ¶æ•°æ®é‡å’Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ¶ˆæ¯ Max segment size in bytes x-stream-max-segment-size æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰ æµåˆ†æ®µå­˜å‚¨æ—¶çš„ æ¯ä¸ªæ®µçš„æœ€å¤§å­—èŠ‚æ•° æ§åˆ¶å•ä¸ªæ–‡ä»¶æ®µå¤§å°ï¼Œæœ‰åˆ©äº I/O æ€§èƒ½å’Œç®¡ç† Filter size (per chunk) in bytes x-stream-filter-size-bytes æ•´æ•°ï¼ˆå­—èŠ‚ï¼‰ æµå†…éƒ¨ è¿‡æ»¤ç´¢å¼•æ¯å—çš„å¤§å° ç”¨äºåŠ é€Ÿæ¶ˆæ¯å®šä½å’Œè¯»å–ï¼Œå½±å“å†…å­˜ä½¿ç”¨å’Œæ£€ç´¢æ•ˆç‡ Initial cluster size x-initial-cluster-size æ•´æ•° æµåœ¨åˆ›å»ºæ—¶çš„ æœ€å°èŠ‚ç‚¹æ•° ä¿è¯æµçš„å¤åˆ¶å’Œé«˜å¯ç”¨æ€§ Leader locator x-queue-leader-locator å­—ç¬¦ä¸²ï¼ˆclient-localã€balancedï¼‰ è®¾ç½®åœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šå£°æ˜æµæ—¶ï¼Œä¸»èŠ‚ç‚¹ï¼ˆLeaderï¼‰çš„é€‰å–è§„åˆ™ client-localï¼šå®¢æˆ·ç«¯æ‰€åœ¨èŠ‚ç‚¹ä½œä¸º Leaderï¼ˆé»˜è®¤ï¼‰balancedï¼šåœ¨èŠ‚ç‚¹é—´å‡è¡¡ Leader åˆ†å¸ƒï¼Œç”¨äºä¼˜åŒ– HA Classic Queue vs Stream Queue Feature Matrix Feature ä¸­æ–‡å«ä¹‰ Classic queues Stream queues è¯´æ˜ Non-durable queues éæŒä¹…åŒ–é˜Ÿåˆ— yes no Stream é˜Ÿåˆ—æ€»æ˜¯æŒä¹…åŒ–ï¼Œä¸æ”¯æŒéæŒä¹…åŒ– Exclusivity ç‹¬å é˜Ÿåˆ— yes no Classic é˜Ÿåˆ—æ”¯æŒç‹¬å ï¼ŒStream é˜Ÿåˆ—ä¸æ”¯æŒç‹¬å  Per message persistence æ¶ˆæ¯çº§æŒä¹…åŒ– per message always Stream é˜Ÿåˆ—çš„æ¶ˆæ¯æ€»æ˜¯æŒä¹…åŒ– Membership changes èŠ‚ç‚¹æˆå‘˜å˜æ›´ no manual Stream é˜Ÿåˆ—èŠ‚ç‚¹å˜æ›´éœ€è¦æ‰‹åŠ¨ç®¡ç† TTL æ¶ˆæ¯å­˜æ´»æ—¶é—´ yes no (but see Retention) Stream é˜Ÿåˆ—æ²¡æœ‰æ¶ˆæ¯ TTLï¼Œä½†å¯é€šè¿‡ Retention æ§åˆ¶è¿‡æœŸ Queue length limits é˜Ÿåˆ—é•¿åº¦é™åˆ¶ yes no (but see Retention) Stream é˜Ÿåˆ—æ²¡æœ‰å›ºå®šé•¿åº¦é™åˆ¶ï¼Œé€šè¿‡ Retention æ§åˆ¶æ•°æ®é‡ Keeps messages in memory æ¶ˆæ¯å†…å­˜ä¿å­˜ see Classic Queues never Stream é˜Ÿåˆ—æ¶ˆæ¯ä¸ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œåªå†™å…¥ç£ç›˜ Message priority æ¶ˆæ¯ä¼˜å…ˆçº§ yes no Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§ Consumer priority æ¶ˆè´¹è€…ä¼˜å…ˆçº§ yes no Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¶ˆè´¹è€…ä¼˜å…ˆçº§ Dead letter exchanges æ­»ä¿¡äº¤æ¢æœº yes no Stream é˜Ÿåˆ—ä¸æ”¯æŒæ­»ä¿¡äº¤æ¢æœº Adheres to policies éµå¾ªç­–ç•¥ yes yes (see Retention) Stream é˜Ÿåˆ—æ”¯æŒç­–ç•¥ï¼Œä½†ä¸»è¦é€šè¿‡ Retention æ§åˆ¶è¡Œä¸º Reacts to memory alarms å†…å­˜å‘Šè­¦å“åº” yes no (uses minimal RAM) Stream é˜Ÿåˆ—ä½¿ç”¨æœ€å°å†…å­˜ï¼Œä¸è§¦å‘å†…å­˜å‘Šè­¦ Poison message handling æ¯’æ¶ˆæ¯å¤„ç† no no Stream é˜Ÿåˆ—ä¸æ”¯æŒæ¯’æ¶ˆæ¯å¤„ç† æˆ‘ä»¬å¯ä»¥æ¿€æ´»æµæ’ä»¶æ¥ä½¿ç”¨æµçš„ç‰¹æœ‰åŠŸèƒ½ 1rabbitmq-plugins enable rabbitmq_stream rabbitmq_stream_management æ¿€æ´»æµæ’ä»¶åï¼ŒStreamé˜Ÿåˆ—çš„æ“ä½œæ–¹å¼å¯ä»¥æ›´é«˜çº§ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œä½œè€…åœ¨Java Client ç¤ºä¾‹ä¸­ä¹Ÿç»™å‡ºäº†ç¤ºä¾‹ä»£ç ã€‚ è¶…çº§æµ(Super Streams) è¶…çº§æµï¼ˆSuper streamsï¼‰ æ˜¯ä¸€ç§é€šè¿‡å°†ä¸€ä¸ªå¤§çš„æµåˆ†åŒºæˆæ›´å°çš„æµæ¥å®ç°æ‰©å±•çš„æ–¹å¼ã€‚å®ƒä»¬ä¸ å•ä¸ªæ¶ˆè´¹è€…ï¼ˆSingle Active Consumerï¼‰ é›†æˆï¼Œä»¥åœ¨åˆ†åŒºå†…ä¿æŒæ¶ˆæ¯é¡ºåºã€‚è¶…çº§æµä» RabbitMQ 3.11 å¼€å§‹å¯ç”¨ã€‚ ä¸€ä¸ªè¶…çº§æµæ˜¯ç”±å¤šä¸ªæ™®é€šæµç»„æˆçš„é€»è¾‘æµã€‚å®ƒæ˜¯ä¸€ç§é€šè¿‡ RabbitMQ Streams æ¥æ‰©å±•å‘å¸ƒå’Œæ¶ˆè´¹çš„æ–¹æ³•ï¼šä¸€ä¸ªå¤§å‹é€»è¾‘æµè¢«åˆ’åˆ†æˆå¤šä¸ªåˆ†åŒºæµï¼Œå°†å­˜å‚¨å’Œæµé‡åˆ†æ•£åˆ°å¤šä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šã€‚ è¶…çº§æµä¾ç„¶æ˜¯ä¸€ä¸ªé€»è¾‘å®ä½“ï¼šç”±äºå®¢æˆ·ç«¯åº“çš„æ™ºèƒ½åŒ–å¤„ç†ï¼Œåº”ç”¨ç¨‹åºä¼šæŠŠå®ƒè§†ä¸ºä¸€ä¸ªâ€œå¤§å‹â€æµã€‚è¶…çº§æµçš„æ‹“æ‰‘ç»“æ„åŸºäº AMQP 0.9.1 æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯äº¤æ¢æœºï¼ˆexchangeï¼‰ã€é˜Ÿåˆ—ï¼ˆqueueï¼‰å’Œå®ƒä»¬ä¹‹é—´çš„ç»‘å®šï¼ˆbindingï¼‰ã€‚ å¯ä»¥ä½¿ç”¨ä»»ä½• AMQP 0.9.1 åº“æˆ–ç®¡ç†æ’ä»¶åˆ›å»ºè¶…çº§æµçš„æ‹“æ‰‘ã€‚å®ƒéœ€è¦åˆ›å»ºä¸€ä¸ªç›´è¿äº¤æ¢æœºï¼ˆdirect exchangeï¼‰ã€åˆ†åŒºæµï¼ˆpartition streamsï¼‰ï¼Œå¹¶å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ã€‚ é€šè¿‡ç®¡ç†æ§åˆ¶å°åˆ›å»ºè¶…çº§æµ ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤åˆ›å»ºè¶…çº§æµï¼Œä»¥ä¸‹æ˜¯å¦‚ä½•ç”¨å‘½ä»¤åˆ›å»ºä¸€ä¸ªåŒ…å« 3 ä¸ªåˆ†åŒºçš„è¶…çº§æµï¼š 12# rabbitmq-streams add_super_stream [-p &lt;vhost&gt;] &lt;stream-name&gt; [--partitions &lt;number&gt;]rabbitmq-streams add_super_stream -p /vtest sq_3 --partitions 3 åˆ›å»ºçš„Stream åˆ›å»ºçš„ Exchangeï¼Œåç§° sq_3 ç»‘å®šå…³ç³» é˜Ÿåˆ—ç±»å‹æ‰©å±• æ‡’é˜Ÿåˆ— ä»3.6.xç‰ˆæœ¬åˆ°3.12.xç‰ˆæœ¬ï¼ŒRabbitMQæä¾›äº†ä¸€ç§é’ˆå¯¹Classic Queueçš„ä¼˜åŒ–é…ç½®ï¼Œlazy-modeï¼Œæ‡’å¯¹åˆ—ã€‚æ‡’é˜Ÿåˆ—ä¼šå°½å¯èƒ½æ—©çš„å°†æ¶ˆæ¯å†…å®¹ä¿å­˜åˆ°ç¡¬ç›˜å½“ä¸­ï¼Œå¹¶ä¸”åªæœ‰åœ¨ç”¨æˆ·è¯·æ±‚åˆ°æ—¶ï¼Œæ‰ä¸´æ—¶ä»ç¡¬ç›˜åŠ è½½åˆ°RAMå†…å­˜å½“ä¸­ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQæ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œä¼šä¿å­˜åˆ°å†…å­˜ä»¥ä¾¿ä½¿ç”¨ï¼ŒåŒæ—¶æŠŠæ¶ˆæ¯å†™åˆ°ç¡¬ç›˜ã€‚ä½†æ˜¯ï¼Œæ¶ˆæ¯å†™å…¥ç¡¬ç›˜çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¼šé˜»å¡é˜Ÿåˆ—çš„ã€‚RabbitMQè™½ç„¶é’ˆå¯¹å†™å…¥ç¡¬ç›˜é€Ÿåº¦åšäº†å¾ˆå¤šç®—æ³•ä¼˜åŒ–ï¼Œä½†æ˜¯åœ¨é•¿é˜Ÿåˆ—ä¸­ï¼Œä¾ç„¶è¡¨ç°ä¸æ˜¯å¾ˆç†æƒ³ï¼Œæ‰€ä»¥å°±æœ‰äº†æ‡’é˜Ÿåˆ—çš„å‡ºç°ã€‚ æ‡’é˜Ÿåˆ—ä¼šå°è¯•å°½å¯èƒ½æ—©çš„æŠŠæ¶ˆæ¯å†™åˆ°ç¡¬ç›˜ä¸­ã€‚è¿™æ„å‘³ç€åœ¨æ­£å¸¸æ“ä½œçš„å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒRAMä¸­è¦ä¿å­˜çš„æ¶ˆæ¯è¦å°‘å¾—å¤šã€‚å½“ç„¶ï¼Œè¿™æ˜¯ä»¥å¢åŠ ç£ç›˜IOä¸ºä»£ä»·çš„ã€‚ æ‡’é˜Ÿåˆ—é€‚åˆæ¶ˆæ¯é‡å¤§ä¸”é•¿æœŸæœ‰å †ç§¯çš„é˜Ÿåˆ—ï¼Œå¯ä»¥å‡å°‘å†…å­˜ä½¿ç”¨ï¼ŒåŠ å¿«æ¶ˆè´¹é€Ÿåº¦ã€‚ä½†æ˜¯è¿™æ˜¯ä»¥å¤§é‡æ¶ˆè€—é›†ç¾¤çš„ç½‘ç»œåŠç£ç›˜IOä¸ºä»£ä»·çš„ã€‚ ä»3.12å¾€åçš„ç‰ˆæœ¬ä¸­ï¼ŒRabbitMQ ä¸å†æ”¯æŒâ€œæƒ°æ€§â€æ¨¡å¼ï¼Œå› ä¸º ç»å…¸é˜Ÿåˆ— å½“å‰çš„ç‰¹æ€§å°±ç±»ä¼¼äºä»¥å‰çš„ æ‡’é˜Ÿåˆ—ã€‚ æ­»ä¿¡é˜Ÿåˆ— æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead Letter Queueï¼‰ï¼Œæ–°ç‰ˆä¸­å«åš æ­»ä¿¡äº¤æ¢æœºï¼ˆDead Letter Exchange, DLXï¼‰ï¼Œæ˜¯RabbitMQå¯¹äºæœªèƒ½æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯è¿›è¡Œçš„ä¸€ç§è¡¥æ•‘æœºåˆ¶ï¼Œç”¨äºä¿å­˜æ— æ³•è¢«æ­£å¸¸å¤„ç†çš„æ¶ˆæ¯ã€‚å½“æ¶ˆæ¯è¢«æ¶ˆè´¹è€…å¤„ç†å¤±è´¥æ—¶ï¼ŒRabbitMQä¼šå°†æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†ã€‚ æ­»ä¿¡é˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„é˜Ÿåˆ—ï¼ŒåŒæ ·å¯ä»¥åœ¨é˜Ÿåˆ—ä¸Šå£°æ˜æ¶ˆè´¹è€…ï¼Œç»§ç»­å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹å¤„ç†ã€‚ æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼ŒRabbitMQä¼šå°†ä¸€ä¸ªæ­£å¸¸æ¶ˆæ¯è½¬æˆæ­»ä¿¡ æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆMessage rejectionï¼‰ ç”± AMQP 1.0 æ¥æ”¶ç«¯ä½¿ç”¨ rejected ç»“æœæ‹’ç» ç”± AMQP 0.9.1 æ¶ˆè´¹è€…ä½¿ç”¨ basic.reject æˆ– basic.nackï¼Œå¹¶ä¸”å‚æ•° requeue=false æ¶ˆæ¯è¿‡æœŸï¼ˆMessage expirationï¼‰ æ¶ˆæ¯è¶…è¿‡å…¶é…ç½®çš„ TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰ åè¿‡æœŸã€‚ é˜Ÿåˆ—é•¿åº¦è¶…é™ï¼ˆQueue length exceededï¼‰ é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ•°é‡æˆ–æ€»å­—èŠ‚æ•°è¾¾åˆ°é…ç½®çš„æœ€å¤§é™åˆ¶åï¼Œè¢«ä¸¢å¼ƒçš„æ¶ˆæ¯ä¼šæ­»ä¿¡åŒ–ã€‚ æŠ•é€’æ¬¡æ•°è¶…é™ï¼ˆä»…é€‚ç”¨äºä»²è£é˜Ÿåˆ— Quorum Queueï¼‰ æ¶ˆæ¯çš„æŠ•é€’æ¬¡æ•°è¶…è¿‡äº†ä»²è£é˜Ÿåˆ—ä¸­é…ç½®çš„ delivery-limitã€‚ ä½¿ç”¨åœºæ™¯ ä½ å¯ä»¥åœ¨é˜Ÿåˆ—ä¸Šé…ç½® æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰ å’Œ æ­»ä¿¡è·¯ç”±é”®ï¼ˆDead Letter Routing Keyï¼‰ã€‚ å½“æ¶ˆæ¯æˆä¸ºæ­»ä¿¡æ—¶ï¼Œä¼šè¢« é‡æ–°å‘å¸ƒåˆ° DLXï¼Œè¿™æ ·ä½ å¯ä»¥ï¼š åšé”™è¯¯æ—¥å¿—è®°å½• è¿›è¡Œå¤±è´¥æ¶ˆæ¯é‡è¯• ç”¨äºç›‘æ§å’Œå‘Šè­¦ æ­»ä¿¡äº¤æ¢æœºçš„é…ç½®æ–¹æ³•ï¼ˆHow Dead Lettering is Configuredï¼‰ åœ¨ RabbitMQ ä¸­ï¼Œä»»ä½•é˜Ÿåˆ—éƒ½å¯ä»¥é€šè¿‡ å®¢æˆ·ç«¯ æˆ–è€… ç­–ç•¥ï¼ˆpoliciesï¼‰ æ¥é…ç½® æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰ã€‚ é…ç½®æ—¶ä¸»è¦æ¶‰åŠä¸¤ä¸ªæ ¸å¿ƒå‚æ•°ï¼š é…ç½®å‚æ•°å è¯´æ˜ dead-letter-exchange æŒ‡å®šç”¨äºæ¥æ”¶æ­»ä¿¡æ¶ˆæ¯çš„ æ­»ä¿¡äº¤æ¢æœºåç§° dead-letter-routing-key æŒ‡å®šæ­»ä¿¡æ¶ˆæ¯é‡æ–°å‘å¸ƒæ—¶ä½¿ç”¨çš„ è·¯ç”±é”®ï¼ˆRouting Keyï¼‰ æ­»ä¿¡åœ¨è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—æ—¶ï¼Œä»–çš„ routingkey ä¹Ÿä¼šä¿å­˜ä¸‹æ¥ã€‚ä½†æ˜¯å¦‚æœé…ç½®äº† x-dead-letter-routing-key è¿™ä¸ªå‚æ•°çš„è¯ï¼Œroutingkey å°±ä¼šè¢«æ›¿æ¢ä¸ºé…ç½®çš„è¿™ä¸ªå€¼ã€‚ åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºé˜Ÿåˆ—æ·»åŠ  x-dead-letter-exchange å’Œ x-dead-letter-routing-key å‚æ•°ï¼Œæ¥æŒ‡å®š æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰å’Œ æ­»ä¿¡è·¯ç”±é”®ï¼ˆDead Letter Routing Keyï¼‰ã€‚ä½†æ˜¯è¿™æ ·åšå¾ˆéº»çƒ¦ï¼Œæ¯ä¸ªé˜Ÿåˆ—éƒ½è¦å•ç‹¬é…ç½®ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ç­–ç•¥ï¼ˆpoliciesï¼‰ æ¥ç»Ÿä¸€é…ç½®ã€‚ 1234# ä»…æŒ‡å®šæ­»ä¿¡äº¤æ¢æœºï¼Œè¿™é‡Œäº¤æ¢æœºçš„åç§°æ˜¯ my-dlxï¼Œäº¤æ¢æœºè¦æå‰åˆ›å»ºå¥½rabbitmqctl set_policy DLX &quot;.*&quot; &#x27;&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;&#125;&#x27; --apply-to queues --priority 7# åŒæ—¶æŒ‡å®š æ­»ä¿¡äº¤æ¢æœº å’Œ è·¯ç”±é”®rabbitmqctl set_policy DLX &quot;.*&quot; &#x27;&#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;, &quot;dead-letter-routing-key&quot;:&quot;my-routing-key&quot;&#125;&#x27; --apply-to queues --priority 7 å‚æ•°è¯´æ˜ï¼š éƒ¨åˆ† å«ä¹‰ rabbitmqctl RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…· set_policy è®¾ç½®ä¸€ä¸ªç­–ç•¥ï¼ˆPolicyï¼‰ï¼Œç”¨äºåŠ¨æ€é…ç½®äº¤æ¢æœºã€é˜Ÿåˆ—æˆ–ç»‘å®šçš„å‚æ•° DLX ç­–ç•¥çš„åç§°ï¼Œç”¨æˆ·è‡ªå®šä¹‰ï¼Œä¾‹å¦‚è¿™é‡Œå« DLX &quot;.*&quot; æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…å¯¹è±¡çš„åç§°ã€‚.* è¡¨ç¤ºåŒ¹é… æ‰€æœ‰é˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“é˜Ÿåˆ—åï¼Œæ¯”å¦‚ ^my-queue$ &#123;&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;, &quot;dead-letter-routing-key&quot;:&quot;my-routing-key&quot;&#125; ç­–ç•¥å†…å®¹ï¼Œè¿™é‡Œè®¾ç½®äº†æ­»ä¿¡äº¤æ¢æœºåç§°å’Œè·¯ç”±é”®ï¼š - dead-letter-exchange: è®¾ç½®æ­»ä¿¡äº¤æ¢æœºåç§°ä¸º my-dlx - dead-letter-routing-key: è®¾ç½®è·¯ç”±é”®ä¸º my-routing-key --apply-to queues æŒ‡å®šç­–ç•¥ä½œç”¨å¯¹è±¡ä¸º é˜Ÿåˆ—ï¼ˆqueuesï¼‰ï¼Œè€Œä¸æ˜¯äº¤æ¢æœºï¼ˆexchangesï¼‰æˆ–ç»‘å®šï¼ˆbindingsï¼‰ --priority 7 ç­–ç•¥çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ã€‚å¤šä¸ªç­–ç•¥ä½œç”¨åœ¨åŒä¸€å¯¹è±¡æ—¶ï¼Œä¼˜å…ˆçº§é«˜çš„ä¼šè¦†ç›–ä½çš„ æ‰§è¡Œè¿™æ¡å‘½ä»¤åï¼š æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Š x-dead-letter-exchange=my-dlx å’Œ x-dead-letter-routing-key=my-routing-key é…ç½®ã€‚ é˜Ÿåˆ—ä¸­è¢«æ‹’ç»ã€è¿‡æœŸã€è¶…é•¿æˆ–è¶…è¿‡æŠ•é€’æ¬¡æ•°çš„æ¶ˆæ¯ä¼šè¢«é‡æ–°å‘å¸ƒåˆ° my-dlx äº¤æ¢æœºï¼Œå¹¶ä½¿ç”¨ my-routing-key ä½œä¸ºè·¯ç”±é”®ã€‚ æ¶ˆæ¯è¢«ä½œä¸ºæ­»ä¿¡è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—åï¼Œä¼šåœ¨Headerå½“ä¸­å¢åŠ â¼€äº›æ¶ˆæ¯ã€‚ 123456x-first-death-queueï¼šè¯¥æ¶ˆæ¯é¦–æ¬¡æˆä¸ºæ­»ä¿¡æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—åç§°x-first-death-reasonï¼šè¯¥æ¶ˆæ¯é¦–æ¬¡è¢«åˆ¤å®šä¸ºæ­»ä¿¡çš„åŸå› x-first-death-exchangeï¼šè¯¥æ¶ˆæ¯åœ¨é¦–æ¬¡æˆä¸ºæ­»ä¿¡å‰è¢«å‘å¸ƒåˆ°çš„äº¤æ¢æœºåç§°x-last-death-queueï¼šè¯¥æ¶ˆæ¯æœ€è¿‘ä¸€æ¬¡æˆä¸ºæ­»ä¿¡æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—åç§°x-last-death-reasonï¼šè¯¥æ¶ˆæ¯æœ€è¿‘ä¸€æ¬¡è¢«åˆ¤å®šä¸ºæ­»ä¿¡çš„åŸå› x-last-death-exchangeï¼šè¯¥æ¶ˆæ¯åœ¨æœ€è¿‘ä¸€æ¬¡æˆä¸ºæ­»ä¿¡å‰è¢«å‘å¸ƒåˆ°çš„äº¤æ¢æœºåç§° å»¶è¿Ÿé˜Ÿåˆ— å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆDelayed Message Queueï¼‰: å»¶è¿Ÿé˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„é˜Ÿåˆ—ï¼Œç”¨äºå»¶è¿Ÿæ¶ˆæ¯çš„æŠ•é€’ã€‚ RabbitMQä¸­ï¼Œæ˜¯ä¸å­˜åœ¨å»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½çš„ï¼Œè€Œé€šå¸¸å¦‚æœè¦ç”¨åˆ°å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå°±ä¼šé‡‡ç”¨ TTL + æ­»ä¿¡é˜Ÿåˆ— çš„æ–¹å¼æ¥å®ç°ã€‚ å»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°åŸç†ï¼š åˆ›å»ºä¸€ä¸ªæ™®é€šé˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®é˜Ÿåˆ—çš„ TTLï¼ˆx-message-ttlï¼‰å‚æ•°ï¼Œä»¥åŠæŒ‡å®šä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—(x-dead-letter-exchange) å½“æ¶ˆæ¯çš„ TTL åˆ°æœŸæ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨ä»å½“å‰é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œå¹¶è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚ ä¸ºæ­»ä¿¡é˜Ÿåˆ—åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¤„ç†å»¶è¿Ÿæ¶ˆæ¯ã€‚ ä¼˜å…ˆçº§é˜Ÿåˆ— ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆPriority Queueï¼‰: RabbitMQ æ”¯æŒä¸ºç»å…¸é˜Ÿåˆ—ï¼ˆclassic queuesï¼‰æ·»åŠ â€œä¼˜å…ˆçº§â€åŠŸèƒ½ã€‚å¯ç”¨â€œä¼˜å…ˆçº§â€åŠŸèƒ½çš„ç»å…¸é˜Ÿåˆ—é€šå¸¸è¢«ç§°ä¸ºâ€œä¼˜å…ˆçº§é˜Ÿåˆ—â€ï¼ˆpriority queuesï¼‰ã€‚ RabbitMQ æ”¯æŒ 1 åˆ° 255 ä¹‹é—´çš„ä¼˜å…ˆçº§å€¼ï¼Œä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨ 1 åˆ° 5 ä¹‹é—´çš„å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼˜å…ˆçº§å€¼è¶Šé«˜ï¼Œä¼šæ¶ˆè€—æ›´å¤šçš„ CPU å’Œå†…å­˜èµ„æºï¼Œå› ä¸º RabbitMQ åœ¨å†…éƒ¨éœ€è¦ä¸ºæ¯ä¸ªä¼˜å…ˆçº§ï¼ˆä» 1 åˆ°æœ€å¤§é…ç½®å€¼ï¼‰ç»´æŠ¤ä¸€ä¸ªå­é˜Ÿåˆ—ã€‚ åªæœ‰ç»å…¸é˜Ÿåˆ—æ”¯æŒé€šè¿‡å‚æ•°x-max-priorityæŒ‡å®šé˜Ÿåˆ—æ”¯æŒçš„æœ€å¤§ä¼˜å…ˆçº§ï¼Œä¸”ä¸æ”¯æŒ é€šè¿‡ ç­–ç•¥ï¼ˆpoliciesï¼‰ å°†ç»å…¸é˜Ÿåˆ—å£°æ˜ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚ å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€šè¿‡å‚æ•° priority æŒ‡å®šæ¶ˆæ¯çš„ä¼˜å…ˆçº§ã€‚æ˜¯çš„ï¼Œæ¶ˆæ¯ä¹Ÿæ˜¯å¯ä»¥è®¾ç½®å‚æ•°çš„ã€‚ ä¼˜å…ˆçº§é˜Ÿåˆ—å¦‚ä½•ä¸æ¶ˆè´¹è€…ååŒå·¥ä½œ è‹¥æ¶ˆè´¹è€…è¿æ¥åˆ°ä¸€ä¸ª ç©ºé˜Ÿåˆ—ï¼Œç„¶åæ¶ˆæ¯é™†ç»­è¢«å‘å¸ƒï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆæ¯å¯èƒ½ ä¸ä¼š åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼ˆå³åˆšå‘å¸ƒå°±è¢«æ¶ˆè´¹è€…æ¥æ”¶ï¼‰ï¼Œæ­¤æ—¶ä¼˜å…ˆçº§åŠŸèƒ½æ²¡æœ‰æœºä¼šä¸Šåœºã€‚ä¼˜å…ˆçº§æ˜¯åœ¨æ¶ˆæ¯æ’é˜Ÿï¼ˆready æ¶ˆæ¯ï¼‰çŠ¶æ€æ—¶æ‰èƒ½ä½“ç°å…¶ä½œç”¨ã€‚ æ¨èåœ¨æ¶ˆè´¹è€…ç«¯ä½¿ç”¨ basic.qos(prefetch) è®¾ç½®ï¼ˆåœ¨ manual ack æ¨¡å¼ä¸‹ï¼‰ï¼Œä»¥é™åˆ¶æ¶ˆè´¹è€…åŒæ—¶å¤„ç†çš„æœªç¡®è®¤æ¶ˆæ¯æ•°ã€‚è¿™æ ·èƒ½è®©ä¼˜å…ˆçº§çš„åˆ†çº§æ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œå› ä¸ºå¦‚æœ prefetch æ•°é‡æœªæ»¡ï¼Œé«˜ä¼˜å…ˆçº§æ¶ˆæ¯å¯ä»¥å…ˆè¢«å–å‡ºã€‚ æ³¨æ„äº‹é¡¹ æœªè®¾ç½® priority çš„æ¶ˆæ¯ ä¼šè¢«å½“ä½œä¼˜å…ˆçº§ 0 å¤„ç†ã€‚è‹¥æ¶ˆæ¯æŒ‡å®šçš„ä¼˜å…ˆçº§å¤§äºé˜Ÿåˆ—çš„æœ€å¤§å€¼ï¼ˆx-max-priorityï¼‰ï¼Œåˆ™è¯¥æ¶ˆæ¯çš„ä¼˜å…ˆçº§å°±æ˜¯x-max-priorityã€‚ TTL / æ¶ˆæ¯è¿‡æœŸ (message expiration)ï¼šå³ä½¿è®¾ç½®äº† TTLï¼Œè¿‡æœŸçš„æ¶ˆæ¯åªä¼šåœ¨é˜Ÿåˆ—å¤´è¢«æ£€æŸ¥ã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªä½ä¼˜å…ˆçº§çš„æ¶ˆæ¯åœ¨å‰é¢ä½†è¿˜æ²¡è¿‡æœŸï¼Œè€Œé«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯åœ¨åé¢ï¼Œä½ä¼˜å…ˆçº§çš„æ¶ˆæ¯å¯èƒ½ä¼šé˜»å¡é˜Ÿåˆ—å¤´ï¼Œå¯¼è‡´é«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯è¢«å»¶è¿Ÿã€‚ é˜Ÿåˆ—æœ€å¤§é•¿åº¦é™åˆ¶ (max-length)ï¼šå¦‚æœé˜Ÿåˆ—è®¾ç½®äº†æœ€å¤§é•¿åº¦ï¼Œé˜Ÿåˆ—ä¼šä»å¤´éƒ¨ (head) ä¸¢å¼ƒæ¶ˆæ¯ä»¥ç»´æŒé•¿åº¦é™åˆ¶ã€‚è¿™å¯èƒ½å¯¼è‡´é«˜ä¼˜å…ˆçº§æ¶ˆæ¯ä¹Ÿè¢«ä¸¢å¼ƒï¼Œä»è€Œè¿èƒŒç›´è§‰ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» RabbitMQ çš„ Queue çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹","date_published":"2025-09-20T13:30:05.000Z","tags":["æŠ€æœ¯","rabbitmq","åˆ†å¸ƒå¼","rabbitmq"]},{"id":"https://blog.hanqunfeng.com/2025/09/18/rabbitmq-install-01/","url":"https://blog.hanqunfeng.com/2025/09/18/rabbitmq-install-01/","title":"RabbitMQ çš„å®‰è£…åŠä½¿ç”¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RabbitMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/rabbitmq-demo\">Java Client ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"RabbitMQ-ç®€ä»‹\">RabbitMQ ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ æ˜¯ä¸€ä¸ªå¼€æºçš„ æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼ŒåŸºäº AMQPï¼ˆAdvanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰ å®ç°ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ è§£è€¦ã€ç¼“å†²å’Œå¼‚æ­¥å¤„ç†æ¶ˆæ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯è®© <code>ä¸åŒç³»ç»Ÿ</code> æˆ– <code>åº”ç”¨</code> ä¹‹é—´å¯é åœ°ä¼ é€’æ¶ˆæ¯ï¼Œå³ä½¿å‘é€æ–¹æˆ–æ¥æ”¶æ–¹æš‚æ—¶ä¸å¯ç”¨ï¼Œä¹Ÿèƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>RabbitMQ çš„æ ¸å¿ƒç‰¹ç‚¹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ ¸å¿ƒç‰¹ç‚¹</th>\n<th>å…·ä½“è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¯é æ€§</strong></td>\n<td>- æ”¯æŒæ¶ˆæ¯ç¡®è®¤ï¼ˆACKï¼‰æœºåˆ¶<br>- æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜<br>- æ”¯æŒäº‹åŠ¡æˆ–ç¡®è®¤æ¨¡å¼ï¼Œä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±</td>\n</tr>\n<tr>\n<td><strong>çµæ´»çš„è·¯ç”±</strong></td>\n<td>- é€šè¿‡ <strong>äº¤æ¢æœºï¼ˆExchangeï¼‰</strong> å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„ <strong>é˜Ÿåˆ—ï¼ˆQueueï¼‰</strong><br>- æ”¯æŒå¤šç§è·¯ç”±ç­–ç•¥ï¼š<br>  â€¢ directï¼šç›´è¿ï¼ŒæŒ‰é˜Ÿåˆ—åè·¯ç”±<br>  â€¢ fanoutï¼šå¹¿æ’­ï¼Œæ‰€æœ‰é˜Ÿåˆ—éƒ½æ”¶åˆ°<br>  â€¢ topicï¼šä¸»é¢˜åŒ¹é…ï¼Œç±»ä¼¼è®¢é˜…æ¨¡å¼<br>  â€¢ headersï¼šæŒ‰æ¶ˆæ¯å¤´åŒ¹é…</td>\n</tr>\n<tr>\n<td><strong>é«˜æ€§èƒ½</strong></td>\n<td>- å†…å­˜é˜Ÿåˆ—å¿«é€Ÿå¤„ç†æ¶ˆæ¯<br>- æ”¯æŒå¼‚æ­¥ IO å’Œ Erlang çš„å¹¶å‘æ¨¡å‹</td>\n</tr>\n<tr>\n<td><strong>å¤šè¯­è¨€æ”¯æŒ</strong></td>\n<td>- å®¢æˆ·ç«¯åº“ä¸°å¯Œï¼šJavaã€Pythonã€Goã€C#ã€Node.js ç­‰<br>- å¯åœ¨å¤šç§å¹³å°å’Œæ¡†æ¶ä¸­ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><strong>é›†ç¾¤ä¸é«˜å¯ç”¨</strong></td>\n<td>- æ”¯æŒé›†ç¾¤æ¨¡å¼<br>- é˜Ÿåˆ—å¯ä»¥é•œåƒåˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä¿è¯é«˜å¯ç”¨</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ çš„æ ¸å¿ƒæ¦‚å¿µ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ¦‚å¿µ</th>\n<th>å«ä¹‰</th>\n<th>ä½œç”¨èŒƒå›´</th>\n<th>ç±»æ¯”</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Broker</strong></td>\n<td>ä¸€ä¸ª <strong>RabbitMQ æœåŠ¡å®ä¾‹</strong>ï¼ŒåŒ…å«æ•´ä¸ª AMQP æœåŠ¡ã€ç®¡ç†æ’ä»¶ã€é˜Ÿåˆ—ã€äº¤æ¢æœºç­‰èµ„æº</td>\n<td>è¿è¡Œåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œæˆ–é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹</td>\n<td>ç±»ä¼¼äºæ•°æ®åº“çš„ <strong>å®ä¾‹</strong></td>\n</tr>\n<tr>\n<td><strong>Vhost</strong></td>\n<td>Broker å†…éƒ¨çš„ <strong>é€»è¾‘åˆ†åŒº</strong>ï¼Œç”¨äºéš”ç¦»ä¸åŒçš„é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šç­‰èµ„æº</td>\n<td>ä¸€ä¸ª Broker å¯ä»¥æœ‰å¤šä¸ª vhostï¼Œæ¯ä¸ª vhost å½¼æ­¤éš”ç¦»</td>\n<td>ç±»ä¼¼äºæ•°æ®åº“å®ä¾‹é‡Œçš„ <strong>schema</strong>ï¼Œå®é™…ä½¿ç”¨ä¸­å»ºè®®ä¸ºæ¯ä¸ªä¸šåŠ¡é…ç½®ä¸€ä¸ªç‹¬ç«‹çš„ vhostï¼Œå¹¶ä¸ºæ¯ä¸ªvhostå•ç‹¬é…ç½®ä¸€ä¸ªç®¡ç†ç”¨æˆ·</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Producer</strong></td>\n<td>æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå‘é€æ¶ˆæ¯åˆ° RabbitMQ</td>\n</tr>\n<tr>\n<td><strong>Queue</strong></td>\n<td>é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯çš„åœ°æ–¹</td>\n</tr>\n<tr>\n<td><strong>Consumer</strong></td>\n<td>æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œä»é˜Ÿåˆ—è·å–æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>Exchange</strong></td>\n<td>äº¤æ¢æœºï¼Œæ¥æ”¶ Producer çš„æ¶ˆæ¯å¹¶æ ¹æ®è§„åˆ™è·¯ç”±åˆ°é˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td><strong>Binding</strong></td>\n<td>ç»‘å®šï¼Œå®šä¹‰ Exchange ä¸ Queue çš„è·¯ç”±è§„åˆ™</td>\n</tr>\n<tr>\n<td><strong>Message</strong></td>\n<td>æ¶ˆæ¯ï¼ŒRabbitMQ ä¼ é€’çš„æ•°æ®å•å…ƒ</td>\n</tr>\n<tr>\n<td><strong>Connection</strong></td>\n<td>è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¸ RabbitMQ Broker ä¹‹é—´çš„ <strong>TCP è¿æ¥</strong>ï¼Œæ˜¯é€šä¿¡çš„ç‰©ç†é€šé“</td>\n</tr>\n<tr>\n<td><strong>Channel</strong></td>\n<td>é€šé“ï¼ŒConnection å†…éƒ¨çš„ <strong>é€»è¾‘è¿æ¥</strong>ï¼Œè½»é‡çº§ä¸”å¤šè·¯å¤ç”¨ï¼Œä¸€ä¸ªè¿æ¥å¯å¼€å¤šä¸ªé€šé“</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                        â”Œâ”€ Broker (RabbitMQ å®ä¾‹)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class=\"line\">                        â”‚                                 â”‚</span><br><span class=\"line\">                        â”‚    â”Œâ”€â”€â”€â”€â”€ Virtual Host â”€â”€â”€â”€â”€â”   â”‚</span><br><span class=\"line\">        Producer â”€â”€â”€ TCP â”€â”€â”€â”€â”€â”€&gt; Exchange â”€â”€&gt; Queue â”€â”€â”€â”€â”€â”€â”€â”€&gt; TCP â”€â”€ Consumer</span><br><span class=\"line\">(Connection â”€â”€&gt; Channel)â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span><br><span class=\"line\">                        â”‚                                 â”‚</span><br><span class=\"line\">                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/qgdFHL.png\" alt=\"\"></p>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ çš„å…¸å‹åº”ç”¨åœºæ™¯</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åº”ç”¨åœºæ™¯</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å¼‚æ­¥å¤„ç†</strong></td>\n<td>ç”¨æˆ·è¯·æ±‚ä¸ç›´æ¥å¤„ç†ï¼Œæ¶ˆæ¯å…¥é˜Ÿåç”±åå°å¼‚æ­¥æ¶ˆè´¹ï¼Œä¾‹å¦‚é‚®ä»¶å‘é€ã€å›¾ç‰‡å¤„ç†</td>\n</tr>\n<tr>\n<td><strong>å‰Šå³°å¡«è°·</strong></td>\n<td>ç¼“å†²é«˜å³°æµé‡ï¼Œå¹³æ»‘ç³»ç»Ÿå‹åŠ›</td>\n</tr>\n<tr>\n<td><strong>ç³»ç»Ÿè§£è€¦</strong></td>\n<td>ä¸åŒæœåŠ¡ä¹‹é—´ä¸ç›´æ¥è°ƒç”¨ï¼Œé™ä½è€¦åˆ</td>\n</tr>\n<tr>\n<td><strong>å¹¿æ’­/é€šçŸ¥</strong></td>\n<td>å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œå®ç°å¤šæœåŠ¡åŒæ—¶æ”¶åˆ°æ¶ˆæ¯</td>\n</tr>\n<tr>\n<td><strong>æ—¥å¿—æ”¶é›†</strong></td>\n<td>ç»Ÿä¸€æ¥æ”¶ã€åˆ†å‘æ—¥å¿—åˆ°ä¸åŒå¤„ç†ç³»ç»Ÿ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RabbitMQ-4-0-æœ‰å“ªäº›å‡çº§\">RabbitMQ 4.0+ æœ‰å“ªäº›å‡çº§</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç‰¹æ€§æ ‡å¿—ï¼ˆFeature Flagsï¼‰çš„ä¼˜åŒ–ä¸å¼ºåˆ¶æ€§è¦æ±‚</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-3\">\n<p>åœ¨å‡çº§åˆ° 4.0 ä¹‹å‰ï¼Œç”¨æˆ·å¿…é¡»å…ˆå‡çº§åˆ° 3.13.x ç‰ˆæœ¬å¹¶æ‰‹åŠ¨å¯ç”¨æ‰€æœ‰ç¨³å®šçš„ç‰¹æ€§æ ‡å¿—ã€‚</p>\n</li>\n<li class=\"lvl-3\">\n<p>ä» 4.0+ å¼€å§‹ï¼Œå¦‚æœé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ”¯æŒæŸä¸ªå¿…éœ€çš„ç‰¹æ€§æ ‡å¿—ï¼Œç³»ç»Ÿä¼šåœ¨èŠ‚ç‚¹å¯åŠ¨æ—¶è‡ªåŠ¨å¯ç”¨è¯¥æ ‡å¿—ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>AMQP åè®®çš„å¢å¼º</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-3\">\n<p>æ–°å¢äº†å¯¹ AMQP è¿‡æ»¤è¡¨è¾¾å¼ï¼ˆAMQP Filter Expressionsï¼‰Version 1.0 Working Draft 09 çš„æ”¯æŒã€‚</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>MQTT åè®®çš„æ”¹è¿›</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-3\">\n<p>é»˜è®¤çš„ MQTT æœ€å¤§åŒ…å¤§å°ä»ä¹‹å‰çš„ 256 MiB é™ä½åˆ° 16 MiBï¼ŒåŒæ—¶ä»å…è®¸ç”¨æˆ·é€šè¿‡é…ç½®é¡¹Â mqtt.max_packet_size_authenticatedÂ è‡ªå®šä¹‰è¯¥å€¼</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Classicé˜Ÿåˆ—çš„å˜åŒ–</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-3\">\n<p>åˆ é™¤äº†å¯¹ Classicé˜Ÿåˆ— <code>version1</code> çš„æ”¯æŒï¼Œé»˜è®¤å°±æ˜¯ <code>version2</code></p>\n</li>\n<li class=\"lvl-3\">\n<p>ä¸å†æ”¯æŒ Classicé˜Ÿåˆ— çš„é•œåƒåŠŸèƒ½ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Quorum é˜Ÿåˆ— ï¼Œæœªæ¥ä¼šå°† Quorum é˜Ÿåˆ— ä½œä¸ºé»˜è®¤é˜Ÿåˆ—ã€‚</p>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤çŠ¶æ€ä¸‹åˆ›å»º Quorum é˜Ÿåˆ— å’Œ Stream é˜Ÿåˆ— ä¼šè‡ªåŠ¨å‡çº§ä¸º å¤åˆ¶é˜Ÿåˆ—ï¼ˆé•œåƒï¼‰</p>\n</li>\n</ul>\n<h2 id=\"RabbitMQ-å•æœºå®‰è£…\">RabbitMQ å•æœºå®‰è£…</h2>\n<h3 id=\"å®‰è£…Erlang\">å®‰è£…Erlang</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQæ˜¯åŸºäºErlangè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥å®‰è£…RabbitMQä¹‹å‰éœ€è¦å®‰è£…Erlangè¯­è¨€ç¯å¢ƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯RabbitMQä¸Erlangè¯­è¨€ä¹‹é—´æ˜¯æœ‰ç‰ˆæœ¬å¯¹åº”å…³ç³»çš„ã€‚å‚è€ƒå®˜æ–¹æ–‡æ¡£<a href=\"https://www.rabbitmq.com/docs/which-erlang\">Erlang Version Requirements</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›®å‰RabbitMQæœ€æ–°ç‰ˆæœ¬æ˜¯<code>4.1.4</code>ï¼ŒErlangç‰ˆæœ¬å¯ä»¥é€‰æ‹© <code>27.x</code>ï¼Œ<a href=\"https://github.com/rabbitmq/erlang-rpm/releases\">GitHubä¸‹è½½åœ°å€</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½ el9 çš„ç‰ˆæœ¬ï¼Œå¯¹åº” CentOS 9</span></span><br><span class=\"line\">wget https://github.com/rabbitmq/erlang-rpm/releases/download/v27.3.4.3/erlang-27.3.4.3-1.el9.x86_64.rpm</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rpm -ivh erlang-27.3.4.3-1.el9.x86_64.rpm</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å®‰è£…çš„ç‰ˆæœ¬</span></span><br><span class=\"line\">erl</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç±»ä¼¼äºï¼Œè¿™é‡Œ Erlang/OTP 27 å°±è¡¨ç¤ºå®‰è£…çš„æ˜¯ 27.x ç‰ˆæœ¬</span></span><br><span class=\"line\">Erlang/OTP 27 [erts-15.2.7.2] [<span class=\"built_in\">source</span>] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:1] [jit:ns]</span><br><span class=\"line\"></span><br><span class=\"line\">Eshell V15.2.7.2 (press Ctrl+G to abort, <span class=\"built_in\">type</span> <span class=\"built_in\">help</span>(). <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>)</span><br><span class=\"line\">1&gt; q().  <span class=\"comment\"># é€€å‡ºå‘½ä»¤ï¼Œæ³¨æ„æ˜¯æ‹¬å·åé¢è¿˜æœ‰ä¸€ä¸ªç‚¹ã€‚è¾“å…¥ help(). æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span></span><br><span class=\"line\">ok</span><br></pre></td></tr></table></figure>\n<h3 id=\"å®‰è£…-RabbitMQ\">å®‰è£… RabbitMQ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›®å‰RabbitMQæœ€æ–°ç‰ˆæœ¬æ˜¯<code>4.1.4</code>ï¼Œ<a href=\"https://github.com/rabbitmq/rabbitmq-server/releases\">GitHubä¸‹è½½åœ°å€</a>]</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½ï¼Œnoarch è¡¨ç¤ºæ¶æ„æ— å…³ï¼Œå³ X86_64 å’Œ ARM64 éƒ½å¯ä»¥</span></span><br><span class=\"line\"><span class=\"comment\"># å› ä¸ºæ²¡æœ‰å¯¹åº”çš„ el9 çš„åŒ…ï¼Œæ‰€ä»¥åªèƒ½ç”¨ el8 çš„åŒ…äº†ï¼Œå®é™…ä½¿ç”¨ä¸­æ²¡æœ‰é—®é¢˜ã€‚</span></span><br><span class=\"line\">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v4.1.4/rabbitmq-server-4.1.4-1.el8.noarch.rpm</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rpm -ivh rabbitmq-server-4.1.4-1.el8.noarch.rpm</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class=\"line\">rabbitmq-diagnostics version <span class=\"comment\"># æ— éœ€å¯åŠ¨æœåŠ¡</span></span><br><span class=\"line\"><span class=\"comment\"># RabbitMQ æœåŠ¡å¯åŠ¨åæ–¹å¯æ­£ç¡®è¾“å‡º</span></span><br><span class=\"line\">rabbitmqctl version</span><br></pre></td></tr></table></figure>\n<h3 id=\"RabbitMQ-å¯åŠ¨ä¸åœæ­¢å‘½ä»¤\">RabbitMQ å¯åŠ¨ä¸åœæ­¢å‘½ä»¤</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Erlang VM æ˜¯ Erlang è¯­è¨€è¿è¡Œç¯å¢ƒï¼ŒRabbitMQ åº”ç”¨è¿è¡Œåœ¨ Erlang VM ä¸‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start rabbitmq-server</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…ï¼Œ--detached åå°è¿è¡Œï¼Œä¸åŠ å°±æ˜¯å‰å°è¿è¡Œ</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmq-server -detached</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å•ç‹¬å¯åŠ¨ åº”ç”¨ï¼Œæ­¤æ—¶éœ€è¦ä¿è¯ RabbitMQ æœåŠ¡(Erlang VM) æ­£åœ¨è¿è¡Œï¼Œä¸€èˆ¬é‡å¯ åº”ç”¨ æ—¶ä½¿ç”¨è¯¥å‘½ä»¤</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl start_app</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœæ­¢ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœæ­¢ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl stop rabbitmq-server</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…ï¼Œå•æœºæ¨¡å¼ stopï¼Œé›†ç¾¤æ¨¡å¼ shutdown</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl stop / shutdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å•ç‹¬åœæ­¢ RabbitMQ åº”ç”¨ï¼Œæ­¤æ—¶éœ€è¦ä¿è¯ RabbitMQ æœåŠ¡(Erlang VM) æ­£åœ¨è¿è¡Œï¼Œä¸€èˆ¬é‡å¯ åº”ç”¨ æ—¶ä½¿ç”¨è¯¥å‘½ä»¤</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl stop_app</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹RabbitMQ æœåŠ¡çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl status rabbitmq-server</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl status</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ åœ¨ CentOS 9 (RPM å®‰è£…) çš„ç›®å½•ç»“æ„</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>ç›®å½•è·¯å¾„</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é…ç½®æ–‡ä»¶</td>\n<td><code>/etc/rabbitmq</code></td>\n<td><code>rabbitmq.conf</code>ã€<code>advanced.config</code> ç­‰é…ç½®</td>\n</tr>\n<tr>\n<td>æ—¥å¿—æ–‡ä»¶</td>\n<td><code>/var/log/rabbitmq</code></td>\n<td>RabbitMQ è¿è¡Œæ—¥å¿—ï¼Œé»˜è®¤å­˜æ”¾åœ¨è¿™é‡Œ</td>\n</tr>\n<tr>\n<td>æ•°æ®ç›®å½•</td>\n<td><code>/var/lib/rabbitmq/mnesia</code></td>\n<td>æ¶ˆæ¯é˜Ÿåˆ—ã€å…ƒæ•°æ®å­˜å‚¨ç›®å½•</td>\n</tr>\n<tr>\n<td>Erlang Cookie</td>\n<td><code>/var/lib/rabbitmq/.erlang.cookie</code></td>\n<td>Erlang èŠ‚ç‚¹é—´é€šä¿¡çš„ cookie æ–‡ä»¶</td>\n</tr>\n<tr>\n<td>å¯æ‰§è¡Œæ–‡ä»¶</td>\n<td><code>/usr/lib/rabbitmq/bin</code></td>\n<td><code>rabbitmq-server</code>ã€<code>rabbitmqctl</code> ç­‰å‘½ä»¤</td>\n</tr>\n<tr>\n<td>å¯åŠ¨è„šæœ¬</td>\n<td><code>/usr/lib/systemd/system/rabbitmq-server.service</code></td>\n<td>systemd ç®¡ç† RabbitMQ çš„å¯åŠ¨è„šæœ¬</td>\n</tr>\n<tr>\n<td>æ’ä»¶ç›®å½•</td>\n<td><code>/usr/lib/rabbitmq/lib/rabbitmq_server-&lt;version&gt;/plugins</code></td>\n<td>æ‰€æœ‰æ’ä»¶æ–‡ä»¶å­˜æ”¾è·¯å¾„</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æ¿€æ´»Webç®¡ç†æ§åˆ¶å°æ’ä»¶\">æ¿€æ´»Webç®¡ç†æ§åˆ¶å°æ’ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹äº RabbitMQ æ‰€æœ‰çš„æ“ä½œåŸºæœ¬éƒ½å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå®Œæˆï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥å¹¶ä¸æ–¹ä¾¿ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥æ¿€æ´» <code>rabbitmq_management</code> æ’ä»¶ï¼Œè¯¥æ’ä»¶æä¾›äº† Web ç®¡ç†æ§åˆ¶å°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Web ç®¡ç†æ§åˆ¶å°æ¥ç®¡ç† RabbitMQ</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://www.rabbitmq.com/docs/management\">rabbitmq_management</a> æ’ä»¶ä¸º å®˜æ–¹æ’ä»¶ï¼Œé»˜è®¤å·²ç»å®‰è£…ï¼Œä¸éœ€è¦ä¸‹è½½ï¼Œç›´æ¥æ¿€æ´»å³å¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ¿€æ´»æ’ä»¶</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmq-plugins <span class=\"built_in\">enable</span> rabbitmq_management</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¯¥æ’ä»¶é™¤äº†æä¾›äº† <code>Web ç®¡ç†æ§åˆ¶å°</code> ï¼Œè¿˜æä¾› <code>åŸºäº HTTP çš„ API</code> ç”¨äºç®¡ç†å’Œç›‘æ§ RabbitMQ èŠ‚ç‚¹å’Œé›†ç¾¤ï¼Œä»¥åŠ <code>å‘½ä»¤è¡Œå·¥å…· rabbitmqadmin</code>ï¼Œè¿™ä¸ªåé¢ä¼šä»‹ç»ã€‚</p>\n</li>\n</ul>\n<h4 id=\"è®¾ç½®è¿œç¨‹è®¿é—®å¸å·\">è®¾ç½®è¿œç¨‹è®¿é—®å¸å·</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ’ä»¶æ¿€æ´»åå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://&lt;ip&gt;:15672</code>ï¼Œrabbitmq_management æ’ä»¶é»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ <code>guest</code>ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹å…¶åªèƒ½é€šè¿‡ <code>127.0.0.1</code> è®¿é—®ï¼Œæ­¤æ—¶æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³</p>\n</li>\n</ul>\n<h5 id=\"1-å…è®¸-guest-è´¦å·è¿œç¨‹è®¿é—®\">1. å…è®¸ <code>guest</code> è´¦å·è¿œç¨‹è®¿é—®</h5>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹ /etc/rabbitmq/rabbitmq.conf æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># å…è®¸guestç”¨æˆ·è¿œç¨‹è®¿é—®ï¼Œ`å®˜æ–¹ä¸æ¨è` ä¸€ç›´å¼€å¯ï¼Œå»ºè®®å¼€å¯ååœ¨ web æ§åˆ¶å°ä¸­åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ï¼Œç„¶åç«‹åˆ»å…³é—­è¯¥é…ç½®</span></span><br><span class=\"line\">loopback_users.guest = <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ³¨æ„è¿™é‡Œ user å¦‚æœæ”¹æˆ adminï¼Œåˆ™ä¸Šé¢çš„å¼€å¯è¿œç¨‹è®¿é—®ä¸­çš„ guest ä¹Ÿè¦æ”¹æˆ admin</span></span><br><span class=\"line\">default_user = guest</span><br><span class=\"line\">default_pass = guest</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹å®Œæˆåï¼Œé‡å¯ RabbitMQ æœåŠ¡</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure>\n<h5 id=\"2-æ–°åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿œç¨‹è®¿é—®çš„ç®¡ç†å‘˜è´¦å·\">2. æ–°åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿œç¨‹è®¿é—®çš„ç®¡ç†å‘˜è´¦å·</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œæ¯”å¦‚è¿™é‡Œ ç”¨æˆ·åä¸º <code>admin</code>ï¼Œå¯†ç ä¸º <code>rabbitmq</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl add_user admin rabbitmq</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç»™ç®¡ç†å‘˜è´¦å·æ·»åŠ èµ„æºç®¡ç†æƒé™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl set_permissions -p / admin <span class=\"string\">&quot;.*&quot;</span> <span class=\"string\">&quot;.*&quot;</span> <span class=\"string\">&quot;.*&quot;</span></span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>éƒ¨åˆ†</th>\n<th>è§£é‡Š</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>rabbitmqctl</code></td>\n<td>RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†ç”¨æˆ·ã€æƒé™ã€é˜Ÿåˆ—ã€äº¤æ¢æœºç­‰ã€‚</td>\n</tr>\n<tr>\n<td><code>set_permissions</code></td>\n<td>è®¾ç½®æŒ‡å®šç”¨æˆ·åœ¨æŸä¸ªè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ä¸‹çš„æƒé™ã€‚</td>\n</tr>\n<tr>\n<td><code>-p /</code></td>\n<td>æŒ‡å®šè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ã€‚è¿™é‡Œçš„ <code>/</code> æ˜¯é»˜è®¤è™šæ‹Ÿä¸»æœºã€‚</td>\n</tr>\n<tr>\n<td><code>admin</code></td>\n<td>ç”¨æˆ·åï¼Œè¿™é‡Œæ˜¯ä¸º <code>admin</code> ç”¨æˆ·è®¾ç½®æƒé™ã€‚</td>\n</tr>\n<tr>\n<td><code>&quot;.*&quot;</code>ï¼ˆé…ç½®æƒé™ï¼‰</td>\n<td>ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·å¯¹èµ„æºé…ç½®çš„æƒé™ï¼Œæ¯”å¦‚åˆ›å»ºäº¤æ¢æœºã€é˜Ÿåˆ—ã€ç»‘å®šç­‰ã€‚<code>&quot;.*&quot;</code> è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚</td>\n</tr>\n<tr>\n<td><code>&quot;.*&quot;</code>ï¼ˆå†™æƒé™ï¼‰</td>\n<td>ç¬¬äºŒä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·å‘å“ªäº›èµ„æºå‘é€æ¶ˆæ¯ã€‚<code>&quot;.*&quot;</code> è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚</td>\n</tr>\n<tr>\n<td><code>&quot;.*&quot;</code>ï¼ˆè¯»æƒé™ï¼‰</td>\n<td>ç¬¬ä¸‰ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·ä»å“ªäº›èµ„æºæ¶ˆè´¹æ¶ˆæ¯ã€‚<code>&quot;.*&quot;</code> è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®adminè´¦å·ä¸ºæ§åˆ¶å°ç®¡ç†å‘˜</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> rabbitmqctl set_user_tags admin administrator</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>éƒ¨åˆ†</th>\n<th>è§£é‡Š</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>rabbitmqctl</code></td>\n<td>RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ã€‚</td>\n</tr>\n<tr>\n<td><code>set_user_tags</code></td>\n<td>ç”¨æ¥ä¸ºç”¨æˆ·è®¾ç½®æ ‡ç­¾ï¼ˆtagï¼‰ï¼Œæ ‡ç­¾å†³å®šäº†ç”¨æˆ·åœ¨ç®¡ç†ç•Œé¢æˆ– API ä¸­çš„æƒé™çº§åˆ«ã€‚</td>\n</tr>\n<tr>\n<td><code>admin</code></td>\n<td>ç”¨æˆ·åï¼Œè¿™é‡Œæ˜¯ä¸º <code>admin</code> ç”¨æˆ·è®¾ç½®æ ‡ç­¾ã€‚</td>\n</tr>\n<tr>\n<td><code>administrator</code></td>\n<td>æ ‡ç­¾åï¼Œè¡¨ç¤ºç»™è¯¥ç”¨æˆ·èµ‹äºˆç®¡ç†å‘˜æƒé™ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸¸è§çš„ç”¨æˆ·æ ‡ç­¾</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ ‡ç­¾</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>administrator</code></td>\n<td>ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æœ€é«˜æƒé™ï¼Œå¯é€šè¿‡ Web ç®¡ç†ç•Œé¢ã€CLIã€API ç®¡ç† RabbitMQ æ‰€æœ‰å†…å®¹</td>\n</tr>\n<tr>\n<td><code>monitoring</code></td>\n<td>ç›‘æ§ç”¨æˆ·ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰ç›‘æ§ä¿¡æ¯ï¼Œä½†ä¸èƒ½ä¿®æ”¹é…ç½®</td>\n</tr>\n<tr>\n<td><code>management</code></td>\n<td>æ™®é€šç®¡ç†ç”¨æˆ·ï¼Œå¯ä»¥ç™»å½•ç®¡ç†ç•Œé¢ï¼Œä½†æƒé™å—é™</td>\n</tr>\n<tr>\n<td><code>policymaker</code></td>\n<td>ç­–ç•¥ç®¡ç†ç”¨æˆ·ï¼Œå¯ä»¥ç®¡ç†ç­–ç•¥å’Œå‚æ•°ï¼Œä½†ä¸èƒ½ç®¡ç†å…¶ä»–ç”¨æˆ·</td>\n</tr>\n<tr>\n<td>æ— æ ‡ç­¾</td>\n<td>æ™®é€šç”¨æˆ·ï¼Œåªèƒ½æ”¶å‘æ¶ˆæ¯ï¼Œä¸èƒ½ç™»å½•ç®¡ç†ç•Œé¢</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>set_permissions</code> ä¸ <code>set_user_tags</code> æ€»ç»“å¯¹æ¯”</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>æ§åˆ¶èŒƒå›´</th>\n<th>ä¸»è¦ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>set_permissions</code></td>\n<td>vhost å†…çš„èµ„æº</td>\n<td>å‘æ¶ˆæ¯ã€æ”¶æ¶ˆæ¯ã€åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœº</td>\n</tr>\n<tr>\n<td><code>set_user_tags</code></td>\n<td>ç®¡ç†ç•Œé¢ã€ç®¡ç† API</td>\n<td>ç”¨æˆ·ç®¡ç†ã€ç­–ç•¥ç®¡ç†ã€é›†ç¾¤ç®¡ç†</td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/4lP2cD.png\" alt=\"\"></p>\n<h3 id=\"å¯ç”¨æ‰€æœ‰ç¨³å®šçš„-Feature-Flags\">å¯ç”¨æ‰€æœ‰ç¨³å®šçš„ Feature Flags</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½•æ§åˆ¶å°åæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€æ¡å‘Šè­¦ä¿¡æ¯ï¼Œå‚è€ƒï¼š<a href=\"https://www.rabbitmq.com/docs/feature-flags\">Feature Flags</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âš  All stable feature flags must be enabled after completing an upgrade.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®ƒçš„æ„æ€æ˜¯ï¼šRabbitMQ åœ¨æ–°ç‰ˆæœ¬ä¸­å¼•å…¥äº†ä¸€äº› Feature Flagsï¼ˆç‰¹æ€§æ ‡å¿—ï¼‰ï¼Œè¿™äº›ç‰¹æ€§æ ‡å¿—ç”¨äºæ§åˆ¶ä¸€äº›æ–°çš„åŠŸèƒ½æˆ–è¡Œä¸ºæ˜¯å¦å¯ç”¨ã€‚å‡çº§ RabbitMQ åï¼Œæœ‰äº›åŠŸèƒ½ä¼šå¤„äº <code>æœªå¯ç”¨çŠ¶æ€</code>ï¼Œéœ€è¦ä½ æ‰‹åŠ¨å¼€å¯ï¼Œç¡®ä¿é›†ç¾¤å®Œå…¨è¿è¡Œåœ¨æœ€æ–°çš„åŠŸèƒ½æ¨¡å¼ä¸‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆæœ‰ Feature Flagsï¼Ÿ</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å‘åå…¼å®¹ï¼šRabbitMQ å‡çº§æ—¶ï¼Œå¯èƒ½å¼•å…¥äº†æ–°çš„æ•°æ®æ ¼å¼æˆ–å†…éƒ¨æœºåˆ¶ï¼Œå¦‚æœç«‹å³å¯ç”¨ï¼Œæ—§ç‰ˆæœ¬èŠ‚ç‚¹å¯èƒ½æ— æ³•ç†è§£ã€‚</li>\n<li class=\"lvl-4\">æ»šåŠ¨å‡çº§æ”¯æŒï¼šå‡çº§é›†ç¾¤æ—¶ï¼Œå¯ä»¥å…ˆå‡çº§èŠ‚ç‚¹ï¼Œå†ç»Ÿä¸€å¯ç”¨åŠŸèƒ½ï¼Œé¿å…ä¸­é€”å‡ºé—®é¢˜ã€‚</li>\n<li class=\"lvl-4\">å¯æ§æ€§ï¼šä½ å¯ä»¥é€‰æ‹©åœ¨ç¡®è®¤é›†ç¾¤ç¨³å®šåå†å¯ç”¨æ–°åŠŸèƒ½ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å½“å‰ Feature Flags çŠ¶æ€</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl -q --formatter pretty_table list_feature_flags</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºä¼šç±»ä¼¼è¿™æ ·ï¼š</span></span><br><span class=\"line\">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class=\"line\">â”‚ name                                 â”‚ state    â”‚</span><br><span class=\"line\">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class=\"line\">â”‚ classic_mirrored_queue_version       â”‚ enabled  â”‚</span><br><span class=\"line\">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class=\"line\">â”‚ classic_queue_type_delivery_support  â”‚ enabled  â”‚</span><br><span class=\"line\">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class=\"line\">â”‚ detailed_queues_endpoint             â”‚ disabled â”‚</span><br><span class=\"line\">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class=\"line\">â”‚ direct_exchange_routing_v2           â”‚ enabled  â”‚</span><br><span class=\"line\">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; enabledï¼šç‰¹æ€§å·²å¯ç”¨</span><br><span class=\"line\">&gt; disabledï¼šç‰¹æ€§æœªå¯ç”¨</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥è¾“å‡º å…¶å®ƒ æ ¼å¼ï¼Œæ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># json</span></span><br><span class=\"line\">rabbitmqctl -q --formatter json list_feature_flags name state provided_by desc doc_url | jq</span><br><span class=\"line\"><span class=\"comment\"># table</span></span><br><span class=\"line\">rabbitmqctl -q --formatter pretty_table list_feature_flags name state provided_by desc doc_url</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ç”¨æ‰€æœ‰å·²æ ‡è®°ä¸º stable çš„ç‰¹æ€§ï¼Œå»ºè®®å‡çº§ä¸‹ä¸€ä¸ª RabbitMQ ç‰ˆæœ¬ å‰ä¸€å®šè¦ç¡®ä¿å½“å‰ç‰ˆæœ¬çš„ Feature Flags éƒ½æ˜¯å¯ç”¨çš„ï¼Œé¿å…å‡çº§åæ— æ³•é¡ºåˆ©å¯åŠ¨æœåŠ¡ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rabbitmqctl enable_feature_flag all</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨æ§åˆ¶å°ä¸­ä¹Ÿå¯ä»¥æŸ¥çœ‹å’Œå¼€å¯è¿™äº› Feature Flags çš„çŠ¶æ€<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/VqNm1y.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¦æ³¨æ„ï¼Œ<strong>Feature Flags ä¸€æ—¦å¼€å¯å°±æ— æ³•å…³é—­ã€‚</strong></p>\n</li>\n</ul>\n<h2 id=\"RabbitMQ-é…ç½®æ–‡ä»¶\">RabbitMQ é…ç½®æ–‡ä»¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯¹äº RPM/YUM/DNF å®‰è£…çš„ RabbitMQï¼Œé…ç½®æ–‡ä»¶é»˜è®¤è·¯å¾„æ˜¯</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–‡ä»¶ç±»å‹</th>\n<th>é»˜è®¤ä½ç½®</th>\n<th>ä½œç”¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ä¸»é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰</td>\n<td><code>/etc/rabbitmq/rabbitmq.conf</code></td>\n<td>ä½¿ç”¨ <strong>INI æ ¼å¼</strong>ï¼Œä¸»è¦é…ç½®éƒ½åœ¨è¿™é‡Œ</td>\n</tr>\n<tr>\n<td>ç¯å¢ƒå˜é‡é…ç½®</td>\n<td><code>/etc/rabbitmq/rabbitmq-env.conf</code></td>\n<td>å®šä¹‰èŠ‚ç‚¹åã€Cookie ä½ç½®ã€æ•°æ®/æ—¥å¿—ç›®å½•ç­‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®‰è£…å <code>/etc/rabbitmq/</code> ç›®å½•å¯èƒ½æ˜¯ç©ºçš„ï¼Œä½ éœ€è¦æ‰‹åŠ¨åˆ›å»º <code>rabbitmq.conf</code>ï¼Œè¯¦ç»†çš„å‚æ•°è¯´æ˜å¯ä»¥å‚çœ‹<a href=\"https://rabbitmq.com/configure.html\">å®˜ç½‘æŒ‡å—</a>ï¼Œ<a href=\"https://github.com/rabbitmq/rabbitmq-server/blob/main/deps/rabbit/docs/rabbitmq.conf.example\">rabbitmq.conf ç¤ºä¾‹</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/rabbitmq/rabbitmq.conf</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç›‘å¬ç«¯å£</span></span><br><span class=\"line\">listeners.tcp.default = 5672</span><br><span class=\"line\"><span class=\"comment\"># ç®¡ç†ç•Œé¢ç«¯å£</span></span><br><span class=\"line\">management.tcp.port = 15672</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmq-env.conf</code> ç”¨æ¥ å®šä¹‰èŠ‚ç‚¹åã€Cookie ã€æ•°æ®/æ—¥å¿—ç›®å½•ç­‰çš„ç¯å¢ƒå˜é‡ï¼ŒRabbitMQ å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¯»å–è¯¥æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯é€šè¿‡ RPM å®‰è£…çš„ RabbitMQ çš„é»˜è®¤å€¼</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/rabbitmq/rabbitmq-env.conf</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤ä½¿ç”¨ä¸»æœºçŸ­å(hostname -s)ï¼Œä¾‹å¦‚ rabbit@myhost</span></span><br><span class=\"line\">NODENAME=rabbit@&lt;hostname&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç»‘å®šçš„ IP åœ°å€ï¼Œç•™ç©ºè¡¨ç¤ºç›‘å¬æ‰€æœ‰åœ°å€ï¼Œç­‰ä»·äº 0.0.0.0</span></span><br><span class=\"line\">NODE_IP_ADDRESS=</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># AMQP åè®®ç«¯å£ï¼Œé»˜è®¤ 5672</span></span><br><span class=\"line\">NODE_PORT=5672</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># RabbitMQ æ•°æ®åº“å­˜å‚¨ç›®å½•</span></span><br><span class=\"line\">MNESIA_BASE=/var/lib/rabbitmq/mnesia</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—å­˜æ”¾ç›®å½•</span></span><br><span class=\"line\">LOG_BASE=/var/log/rabbitmq</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œä¸å¸¦ .conf åç¼€</span></span><br><span class=\"line\">CONFIG_FILE=/etc/rabbitmq/rabbitmq</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ˜¯å¦ä½¿ç”¨é•¿ä¸»æœºåï¼Œtrue/false (é•¿ä¸»æœºå hostname -f)</span></span><br><span class=\"line\">USE_LONGNAME=<span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸¤ä¸ªæ–‡ä»¶çš„ä½œç”¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–‡ä»¶</th>\n<th>ä½œç”¨èŒƒå›´</th>\n<th>å…¸å‹å‚æ•°</th>\n<th>ä½•æ—¶åŠ è½½</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>rabbitmq-env.conf</strong></td>\n<td>è®¾ç½® RabbitMQ å¯åŠ¨æ—¶çš„ <strong>ç¯å¢ƒå˜é‡</strong></td>\n<td>NODENAME, NODE_IP_ADDRESS, NODE_PORT, LOG_BASE, MNESIA_BASE</td>\n<td>åœ¨å¯åŠ¨ RabbitMQ æœåŠ¡å‰ç”± <code>rabbitmq-env</code> è„šæœ¬è¯»å–</td>\n</tr>\n<tr>\n<td><strong>rabbitmq.conf</strong></td>\n<td>RabbitMQ <strong>è¿è¡Œæ—¶é…ç½®</strong>ï¼ˆå†…éƒ¨å‚æ•°ã€æ’ä»¶é…ç½®ç­‰ï¼‰</td>\n<td>listeners.tcp.default, log, cluster_formation ç­‰</td>\n<td>RabbitMQ å¯åŠ¨åç”± Erlang VM å†…éƒ¨è¯»å–</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p><code>rabbitmq-env.conf</code> å†³å®š RabbitMQ å¯åŠ¨æ—¶çš„åŸºæœ¬ç¯å¢ƒï¼Œæ¯”å¦‚èŠ‚ç‚¹åã€æ•°æ®ç›®å½•ã€ç›‘å¬ IP ç­‰ï¼Œå¿…é¡»åœ¨å¯åŠ¨å‰å°±ç¡®å®šã€‚</p>\n</li>\n<li class=\"lvl-4\">\n<p><code>rabbitmq.conf</code> å†³å®šè¿è¡Œæ—¶çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç«¯å£ç›‘å¬ã€æ—¥å¿—ç­‰çº§ã€é›†ç¾¤é…ç½®ç­‰ï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œé‡å¯åº”ç”¨åç”Ÿæ•ˆã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th><code>rabbitmq-env.conf</code> å˜é‡</th>\n<th><code>rabbitmq.conf</code> å¯¹åº”é…ç½®</th>\n<th>ä¼˜å…ˆçº§</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NODE_IP_ADDRESS</td>\n<td><code>listeners.tcp.default = &lt;IP&gt;</code></td>\n<td><code>rabbitmq.conf</code></td>\n<td>åªè¦åœ¨ <code>rabbitmq.conf</code> é‡Œé…ç½®ï¼Œå°±è¦†ç›–ç¯å¢ƒå˜é‡</td>\n</tr>\n<tr>\n<td>NODE_PORT</td>\n<td><code>listeners.tcp.default = &lt;Port&gt;</code></td>\n<td><code>rabbitmq.conf</code></td>\n<td>åŒä¸Šï¼ŒIP å’Œç«¯å£å¯ä»¥ä¸€èµ·é…ç½®</td>\n</tr>\n<tr>\n<td>NODENAME</td>\n<td><strong>æ— ç›´æ¥å¯¹åº”</strong></td>\n<td><code>rabbitmq-env.conf</code></td>\n<td>èŠ‚ç‚¹ååªèƒ½é€šè¿‡ <code>rabbitmq-env.conf</code> æˆ–ç¯å¢ƒå˜é‡è®¾å®š</td>\n</tr>\n<tr>\n<td>MNESIA_BASE</td>\n<td><strong>æ— ç›´æ¥å¯¹åº”</strong></td>\n<td><code>rabbitmq-env.conf</code></td>\n<td>æ•°æ®ç›®å½•åªèƒ½åœ¨å¯åŠ¨å‰è®¾å®š</td>\n</tr>\n<tr>\n<td>LOG_BASE</td>\n<td><code>log.dir = &lt;path&gt;</code></td>\n<td><code>rabbitmq.conf</code></td>\n<td>è¿è¡Œæ—¶é…ç½®è¦†ç›–ç¯å¢ƒå˜é‡</td>\n</tr>\n<tr>\n<td>CONFIG_FILE</td>\n<td><strong>æ— ç›´æ¥å¯¹åº”</strong></td>\n<td><code>rabbitmq-env.conf</code></td>\n<td>è¿™ä¸ªåªå†³å®šåŠ è½½å“ªä¸ª <code>rabbitmq.conf</code> æ–‡ä»¶</td>\n</tr>\n<tr>\n<td>USE_LONGNAME</td>\n<td><strong>æ— ç›´æ¥å¯¹åº”</strong></td>\n<td><code>rabbitmq-env.conf</code></td>\n<td>èŠ‚ç‚¹åæ˜¯å¦ä½¿ç”¨é•¿ä¸»æœºååªèƒ½å¯åŠ¨å‰å†³å®š</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RabbitMQ-ç¯å¢ƒå˜é‡\">RabbitMQ ç¯å¢ƒå˜é‡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmq-env.conf</code> æ–‡ä»¶å°±æ˜¯ç”¨æ¥å®šä¹‰ç¯å¢ƒå˜é‡çš„ï¼Œä½†è¦æ³¨æ„ï¼Œ<code>rabbitmq-env.conf</code> æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ å»æ‰äº† <code>RABBITMQ_</code> å‰ç¼€ï¼Œä¾‹å¦‚åœ¨ç¯å¢ƒä¸­è®¾ç½®çš„å˜é‡åé€šå¸¸æ˜¯ <code>RABBITMQ_NODENAME</code>ï¼Œä½†åœ¨ <code>rabbitmq-env.conf</code> ä¸­ï¼Œè®¾ç½®å˜é‡æ—¶ä¼šå»æ‰ <code>RABBITMQ_</code> å‰ç¼€ï¼Œç›´æ¥ä½¿ç”¨ <code>NODENAME</code>ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨ rabbitmq-env.conf ä¸­é…ç½®</span></span><br><span class=\"line\">NODENAME=rabbit@localhost</span><br><span class=\"line\">NODE_PORT=5672</span><br><span class=\"line\">LOG_BASE=/var/log/rabbitmq</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è€Œåœ¨ç¯å¢ƒä¸­ï¼Œä½ å®é™…è®¾ç½®çš„å˜é‡æ˜¯</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> RABBITMQ_NODENAME=rabbit@localhost</span><br><span class=\"line\"><span class=\"built_in\">export</span> RABBITMQ_NODE_PORT=5672</span><br><span class=\"line\"><span class=\"built_in\">export</span> RABBITMQ_LOG_BASE=/var/log/rabbitmq</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>ç¯å¢ƒå˜é‡åç§°</th>\n<th>æè¿°</th>\n<th>Linux RPM å®‰è£…çš„é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>RABBITMQ_BASE</strong></td>\n<td>åªé’ˆå¯¹ Windows ç³»ç»Ÿã€‚è¯¥åŸºç›®å½•åŒ…å« RabbitMQ æœåŠ¡å™¨çš„æ•°æ®åº“å’Œæ—¥å¿—æ–‡ä»¶çš„å­ç›®å½•ã€‚</td>\n<td>æ— ï¼ˆä»…é€‚ç”¨äº Windowsï¼‰</td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_CONFIG_FILE</strong></td>\n<td>é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œæ²¡æœ‰ <code>.config</code> æ‰©å±•åã€‚RabbitMQ æœåŠ¡å™¨ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶æ¥é…ç½®ç»„ä»¶ã€‚</td>\n<td>é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ï¼š<code>/etc/rabbitmq/rabbitmq.conf</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_GENERATED_CONFIG_DIR</strong></td>\n<td>RabbitMQ å†™å…¥å…¶ç”Ÿæˆçš„é…ç½®æ–‡ä»¶çš„ç›®å½•ã€‚</td>\n<td>é»˜è®¤ç”Ÿæˆè·¯å¾„ï¼š<code>/var/lib/rabbitmq/mnesia</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_MNESIA_BASE</strong></td>\n<td>RabbitMQ æœåŠ¡å™¨èŠ‚ç‚¹æ•°æ®åº“ã€æ¶ˆæ¯å­˜å‚¨å’Œé›†ç¾¤çŠ¶æ€æ–‡ä»¶çš„åŸºç›®å½•ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªã€‚é€šå¸¸ä¼šè¦†ç›– <code>RABBITMQ_MNESIA_DIR</code>ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/mnesia</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_MNESIA_DIR</strong></td>\n<td>å­˜å‚¨ RabbitMQ èŠ‚ç‚¹æ•°æ®çš„ç›®å½•ï¼ŒåŒ…å«æ¨¡å¼æ•°æ®åº“ã€æ¶ˆæ¯å­˜å‚¨ã€é›†ç¾¤æˆå‘˜ä¿¡æ¯å’Œå…¶ä»–æŒä¹…èŠ‚ç‚¹çŠ¶æ€ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/mnesia/rabbit@&lt;hostname&gt;</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_SCHEMA_DIR</strong></td>\n<td>RabbitMQ ä¿å­˜æ–°æ ¼å¼é…ç½®æ–‡ä»¶ä½¿ç”¨çš„é…ç½®æ¨¡å¼çš„ç›®å½•ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/etc/rabbitmq</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_LOG_BASE</strong></td>\n<td>è¯¥åŸºç›®å½•åŒ…å« RabbitMQ æœåŠ¡å™¨çš„æ—¥å¿—æ–‡ä»¶ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/log/rabbitmq</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_LOGS</strong></td>\n<td>RabbitMQ æœåŠ¡å™¨çš„ Erlang æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/log/rabbitmq/rabbitmq.log</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_PLUGINS_DIR</strong></td>\n<td>RabbitMQ çš„æ’ä»¶ç›®å½•ã€‚è·¯å¾„ç”±ç‰¹å®šæ“ä½œç³»ç»Ÿçš„åˆ†éš”ç¬¦å®šä¹‰ï¼ˆUnix ä½¿ç”¨ <code>:</code>ï¼ŒWindows ä½¿ç”¨ <code>;</code>ï¼‰ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/usr/lib/rabbitmq/plugins</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_PLUGINS_EXPAND_DIR</strong></td>\n<td>ç”¨äºå±•å¼€å¯ç”¨çš„æ’ä»¶çš„å·¥ä½œç›®å½•ã€‚ç¡®ä¿æœ‰æ•ˆçš„ RabbitMQ ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™è¯»å–å’Œåˆ›å»ºè¯¥ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/mnesia</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_ENABLED_PLUGINS_FILE</strong></td>\n<td>æ˜¾å¼è®°å½•å¯ç”¨çš„æ’ä»¶çš„æ–‡ä»¶ï¼Œå¯ç”¨æˆ–ç¦ç”¨æ’ä»¶æ—¶ä¼šé‡æ–°åˆ›å»ºè¯¥æ–‡ä»¶ã€‚ç¡®ä¿æœ‰æ•ˆçš„ RabbitMQ ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™éšæ—¶è¯»å–ã€å†™å…¥å’Œåˆ›å»ºè¯¥æ–‡ä»¶ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/lib/rabbitmq/.enabled_plugins</code></td>\n</tr>\n<tr>\n<td><strong>RABBITMQ_PID_FILE</strong></td>\n<td>ç”¨äº <code>rabbitmqctl</code> çš„è¿›ç¨‹ ID æ–‡ä»¶ã€‚</td>\n<td>é»˜è®¤å€¼ï¼š<code>/var/run/rabbitmq/rabbitmq.pid</code></td>\n</tr>\n</tbody>\n</table>\n<div class=\"warning\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">å®‰è£…å¥½ RabbitMQ åï¼Œä¸è¦éšä¾¿ä¿®æ”¹ <code>hostname</code>ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQ çš„æ•°æ®ç›®å½•æ˜¯åŸºäº <code>hostname</code> åˆ›å»ºçš„ï¼Œå¦‚æœä¿®æ”¹äº† <code>hostname</code>ï¼ŒRabbitMQ å°±ä¼šæŒ‡å‘æ–°çš„æ•°æ®ç›®å½•</li>\n<li class=\"lvl-2\">æ•°æ®ç›®å½•é»˜è®¤æ˜¯ <code>/var/lib/rabbitmq/mnesia/rabbit@&lt;hostname&gt;</code></li>\n<li class=\"lvl-2\">å¦‚æœä¿®æ”¹äº† <code>hostname</code>ï¼Œä½†ä»è¦ä½¿ç”¨åŸæ¥çš„æ•°æ®ç›®å½•ï¼Œå¯ä»¥è®¾ç½® <code>RABBITMQ_MNESIA_DIR</code> ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å‘åŸæ¥çš„æ•°æ®ç›®å½•</li>\n</ul>\n</div>\n<h2 id=\"RabbitMQ-ç›¸å…³å‘½ä»¤\">RabbitMQ ç›¸å…³å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ—¥å¸¸ä½¿ç”¨ä¸­ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ Web ç®¡ç†ç•Œé¢æ“ä½œï¼Œè¿™é‡Œä»…å¯¹å‘½ä»¤è¿›è¡Œç®€è¦ä»‹ç»ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>ä½œç”¨ï¼ˆç®€è¦ï¼‰</th>\n<th>å¸¸ç”¨ç¤ºä¾‹ï¼ˆå…¸å‹ç”¨æ³• + ä¸­æ–‡è¯´æ˜ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>rabbitmq-defaults</code></td>\n<td>å®šä¹‰/æ˜¾ç¤º RabbitMQ å®‰è£…é»˜è®¤ç›®å½•å’Œè¿è¡Œæ—¶å‰ç¼€</td>\n<td><code>ç¼–è¾‘ sbin/rabbitmq-defaults ä¸­ PREFIX/SYS_PREFIX</code>ï¼ˆä¿®æ”¹é»˜è®¤ç›®å½•åˆ°ç³»ç»Ÿç›®å½•ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-diagnostics</code></td>\n<td>å¥åº·æ£€æŸ¥ / è¯Šæ–­å·¥å…·ï¼Œå¯ç”¨äºç›‘æ§</td>\n<td><code>rabbitmq-diagnostics -q ping</code>ï¼ˆæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ï¼‰<br><code>rabbitmq-diagnostics -q status</code>ï¼ˆæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼‰<br><code>rabbitmq-diagnostics -q check_running</code>ï¼ˆç¡®è®¤èŠ‚ç‚¹è¿è¡Œä¸­ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-env</code></td>\n<td><code>rabbitmq-env</code> å…¶å®ä¸æ˜¯ä¸€ä¸ªç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œå•ç‹¬ä½¿ç”¨çš„å·¥å…·ï¼Œè€Œæ˜¯ RabbitMQ æœåŠ¡å¯åŠ¨è„šæœ¬ ä¸­ç”¨æ¥åŠ è½½ RabbitMQ ç¯å¢ƒå˜é‡çš„è„šæœ¬ã€‚</td>\n<td>åœ¨ <code>/etc/rabbitmq/rabbitmq-env.conf</code> ä¸­è®¾ç½®ï¼š<br><code>RABBITMQ_NODENAME=myrabbit</code>ï¼ˆè®¾ç½®èŠ‚ç‚¹åï¼‰<br>æˆ–ç”¨ <code>rabbitmq-env</code> è¾“å‡ºæŸ¥çœ‹å®é™…ç¯å¢ƒ</td>\n</tr>\n<tr>\n<td><code>rabbitmq-plugins</code></td>\n<td>æ’ä»¶ç®¡ç†ï¼šåˆ—å‡º/å¯ç”¨/ç¦ç”¨æ’ä»¶</td>\n<td><code>rabbitmq-plugins list</code>ï¼ˆåˆ—å‡ºæ‰€æœ‰æ’ä»¶ï¼‰<br><code>rabbitmq-plugins enable rabbitmq_management</code>ï¼ˆå¯ç”¨ Web ç®¡ç†æ’ä»¶ï¼‰<br><code>rabbitmq-plugins disable --offline plugin</code>ï¼ˆç¦»çº¿ç¦ç”¨æ’ä»¶ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-queues</code></td>\n<td>é˜Ÿåˆ—å‰¯æœ¬ç®¡ç†ï¼šrebalance/grow/shrink</td>\n<td><code>rabbitmq-queues rebalance all --vhost-pattern &quot;.*&quot; --queue-pattern &quot;.*&quot;</code>ï¼ˆé‡å¹³è¡¡æ‰€æœ‰é˜Ÿåˆ—å‰¯æœ¬ï¼‰<br><code>rabbitmq-queues add_member --vhost / qname rabbit@node</code>ï¼ˆä¸ºé˜Ÿåˆ—å¢åŠ èŠ‚ç‚¹å‰¯æœ¬ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-server</code></td>\n<td>å¯åŠ¨ RabbitMQ èŠ‚ç‚¹ï¼ˆå‰å°/åå°ï¼‰</td>\n<td><code>rabbitmq-server</code>ï¼ˆå‰å°å¯åŠ¨ï¼‰<br><code>rabbitmq-server -detached</code>ï¼ˆåå°å¯åŠ¨ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-upgrade</code></td>\n<td>å‡çº§ç›¸å…³æ“ä½œï¼šdrain/æ¢å¤ç­‰</td>\n<td><code>rabbitmq-upgrade drain</code>ï¼ˆè®©èŠ‚ç‚¹è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œåœæ­¢æ¥æ”¶æ–°è¿æ¥ï¼‰<br><code>rabbitmq-upgrade post_upgrade</code>ï¼ˆæ‰§è¡Œå‡çº§åæ”¶å°¾æ“ä½œï¼‰<br><code>rabbitmq-upgrade revive</code>ï¼ˆæ¢å¤ç»´æŠ¤æ¨¡å¼ä¸­çš„èŠ‚ç‚¹ï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmqctl</code></td>\n<td>æœ€å¸¸ç”¨ç®¡ç†å‘½ä»¤ï¼šç”¨æˆ·ã€é˜Ÿåˆ—ã€é›†ç¾¤ç®¡ç†</td>\n<td><code>rabbitmqctl status</code>ï¼ˆæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼‰<br><code>rabbitmqctl list_queues</code>ï¼ˆåˆ—å‡ºæ‰€æœ‰é˜Ÿåˆ—ï¼‰<br><code>rabbitmqctl add_user bob s3cr3t</code>ï¼ˆæ·»åŠ ç”¨æˆ· bobï¼Œå¯†ç  s3cr3tï¼‰</td>\n</tr>\n<tr>\n<td><code>rabbitmq-streams</code></td>\n<td>ç®¡ç† Streamsï¼ˆæµå¼é˜Ÿåˆ—ï¼‰</td>\n<td><code>rabbitmq-streams stream_status --vhost / my-stream</code>ï¼ˆæŸ¥çœ‹ my-stream çŠ¶æ€ï¼‰<br><code>rabbitmq-streams add_replica --vhost / my-stream rabbit@node</code>ï¼ˆä¸º my-stream å¢åŠ å‰¯æœ¬èŠ‚ç‚¹ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æœ€å¸¸ç”¨çš„å‘½ä»¤-rabbitmqctl\">æœ€å¸¸ç”¨çš„å‘½ä»¤ <code>rabbitmqctl</code></h3>\n<h4 id=\"å‘½ä»¤è‡ªåŠ¨è¡¥å…¨\">å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmqctl</code> æœ‰ä¸€ä¸ª <code>autocomplete</code> å‚æ•°ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆå‘½ä»¤å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‘½ä»¤æ¥å®ç°å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>vim ~/.bashrc</code> æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">_rabbitmqctl_completion</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">local</span> cur opts</span><br><span class=\"line\">    cur=<span class=\"string\">&quot;<span class=\"variable\">$&#123;COMP_WORDS[COMP_CWORD]&#125;</span>&quot;</span>           <span class=\"comment\"># å½“å‰å…‰æ ‡æ‰€åœ¨å•è¯</span></span><br><span class=\"line\">    opts=$(rabbitmqctl autocomplete <span class=\"string\">&quot;<span class=\"variable\">$cur</span>&quot;</span>)   <span class=\"comment\"># åªä¼ å½“å‰å•è¯ä½œä¸ºå‰ç¼€</span></span><br><span class=\"line\">    COMPREPLY=( $(compgen -W <span class=\"string\">&quot;<span class=\"variable\">$&#123;opts&#125;</span>&quot;</span> -- <span class=\"string\">&quot;<span class=\"variable\">$cur</span>&quot;</span>) )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">complete -F _rabbitmqctl_completion rabbitmqctl</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š RabbitMQ çš„å¤§éƒ¨åˆ†å‘½ä»¤éƒ½æœ‰ <code>autocomplete</code> å‚æ•°ï¼Œéƒ½å¯ä»¥è‡ªåŠ¨å®Œæˆå‘½ä»¤å‚æ•°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®šä¹‰é€šç”¨è¡¥å…¨å‡½æ•°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">_rabbitmq_completion</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">local</span> cur opts</span><br><span class=\"line\">    cur=<span class=\"string\">&quot;<span class=\"variable\">$&#123;COMP_WORDS[COMP_CWORD]&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># å½“å‰å‘½ä»¤åï¼Œè‡ªåŠ¨åˆ¤æ–­</span></span><br><span class=\"line\">    <span class=\"built_in\">local</span> cmd=<span class=\"string\">&quot;<span class=\"variable\">$&#123;COMP_WORDS[0]&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># ç»™å¯¹åº”å‘½ä»¤ä¼ å½“å‰å‰ç¼€</span></span><br><span class=\"line\">    opts=$(<span class=\"variable\">$cmd</span> autocomplete <span class=\"string\">&quot;<span class=\"variable\">$cur</span>&quot;</span> 2&gt;/dev/null)</span><br><span class=\"line\">    COMPREPLY=( $(compgen -W <span class=\"string\">&quot;<span class=\"variable\">$&#123;opts&#125;</span>&quot;</span> -- <span class=\"string\">&quot;<span class=\"variable\">$cur</span>&quot;</span>) )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸€æ¬¡æ€§ç»‘å®šå¤šä¸ªå‘½ä»¤</span></span><br><span class=\"line\">complete -F _rabbitmq_completion rabbitmqctl rabbitmq-plugins rabbitmq-diagnostics rabbitmq-queues rabbitmq-upgrade</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿è¡¥å…¨ç”Ÿæ•ˆ</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"><span class=\"comment\"># tab è¡¥å…¨</span></span><br><span class=\"line\">rabbitmqctl st&lt;TAB&gt;</span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">start_app  status     stop       stop_app</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¸¸ç”¨å‘½ä»¤å‚æ•°\">å¸¸ç”¨å‘½ä»¤å‚æ•°</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmqctl help</code> è·å–æ‰€æœ‰å‘½ä»¤å‚æ•°çš„ç®€ä»‹</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>rabbitmqctl help &lt;command&gt;</code> è·å–æŒ‡å®šå‘½ä»¤çš„å¸®åŠ©</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ—¥å¸¸ä½¿ç”¨ä¸­åŸºæœ¬éƒ½æ˜¯é€šè¿‡ <code>web æ§åˆ¶å°</code> å®Œæˆï¼Œè¿™é‡Œåªåšäº†è§£ã€‚</p>\n</li>\n</ul>\n<h5 id=\"1-èŠ‚ç‚¹ç®¡ç†\">1.èŠ‚ç‚¹ç®¡ç†</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>status</code></td>\n<td>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼ŒåŒ…æ‹¬è¿è¡ŒçŠ¶æ€ã€ç‰ˆæœ¬ã€å†…å­˜ã€é˜Ÿåˆ—æ•°é‡ç­‰</td>\n<td><code>rabbitmqctl status</code></td>\n</tr>\n<tr>\n<td><code>stop</code></td>\n<td>åœæ­¢ RabbitMQ èŠ‚ç‚¹</td>\n<td><code>rabbitmqctl stop</code></td>\n</tr>\n<tr>\n<td><code>stop_app</code></td>\n<td>åœæ­¢ RabbitMQ åº”ç”¨ï¼ˆä¿ç•™èŠ‚ç‚¹è¿è¡Œï¼‰</td>\n<td><code>rabbitmqctl stop_app</code></td>\n</tr>\n<tr>\n<td><code>start_app</code></td>\n<td>å¯åŠ¨ RabbitMQ åº”ç”¨</td>\n<td><code>rabbitmqctl start_app</code></td>\n</tr>\n<tr>\n<td><code>reset</code></td>\n<td>é‡ç½® RabbitMQ èŠ‚ç‚¹ï¼Œåˆ é™¤æ‰€æœ‰é˜Ÿåˆ—å’Œæ•°æ®ï¼ˆæ…ç”¨ï¼‰</td>\n<td><code>rabbitmqctl reset</code></td>\n</tr>\n<tr>\n<td><code>force_reset</code></td>\n<td>å¼ºåˆ¶é‡ç½®èŠ‚ç‚¹ï¼ˆå³ä½¿åœ¨é›†ç¾¤ä¸­ä¹Ÿä¼šé‡ç½®ï¼‰</td>\n<td><code>rabbitmqctl force_reset</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"2-ç”¨æˆ·å’Œæƒé™ç®¡ç†\">2. ç”¨æˆ·å’Œæƒé™ç®¡ç†</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>list_users</code></td>\n<td>åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·</td>\n<td><code>rabbitmqctl list_users</code></td>\n</tr>\n<tr>\n<td><code>add_user &lt;user&gt; &lt;password&gt;</code></td>\n<td>æ·»åŠ æ–°ç”¨æˆ·</td>\n<td><code>rabbitmqctl add_user alice mypassword</code></td>\n</tr>\n<tr>\n<td><code>delete_user &lt;user&gt;</code></td>\n<td>åˆ é™¤ç”¨æˆ·</td>\n<td><code>rabbitmqctl delete_user alice</code></td>\n</tr>\n<tr>\n<td><code>change_password &lt;user&gt; &lt;password&gt;</code></td>\n<td>ä¿®æ”¹ç”¨æˆ·å¯†ç </td>\n<td><code>rabbitmqctl change_password alice newpass</code></td>\n</tr>\n<tr>\n<td><code>list_permissions &lt;user&gt;</code></td>\n<td>æŸ¥çœ‹æŸç”¨æˆ·çš„æƒé™</td>\n<td><code>rabbitmqctl list_permissions alice</code></td>\n</tr>\n<tr>\n<td><code>set_permissions -p &lt;vhost&gt; &lt;user&gt; &quot;&lt;conf&gt;&quot; &quot;&lt;write&gt;&quot; &quot;&lt;read&gt;&quot;</code></td>\n<td>è®¾ç½®ç”¨æˆ·åœ¨è™šæ‹Ÿä¸»æœºçš„æƒé™</td>\n<td><code>rabbitmqctl set_permissions -p / alice &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"3-è™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ç®¡ç†\">3. è™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ç®¡ç†</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>list_vhosts</code></td>\n<td>åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿä¸»æœº</td>\n<td><code>rabbitmqctl list_vhosts</code></td>\n</tr>\n<tr>\n<td><code>add_vhost &lt;vhost&gt;</code></td>\n<td>æ·»åŠ è™šæ‹Ÿä¸»æœº</td>\n<td><code>rabbitmqctl add_vhost my_vhost</code></td>\n</tr>\n<tr>\n<td><code>delete_vhost &lt;vhost&gt;</code></td>\n<td>åˆ é™¤è™šæ‹Ÿä¸»æœº</td>\n<td><code>rabbitmqctl delete_vhost my_vhost</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"4-é˜Ÿåˆ—ç®¡ç†\">4. é˜Ÿåˆ—ç®¡ç†</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é˜Ÿåˆ—å¯ä»¥é€šè¿‡ <code>web æ§åˆ¶å°</code> åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ <code>å®¢æˆ·ç«¯(æ¯”å¦‚Java)</code> åˆ›å»ºï¼Œ<code>rabbitmqctl</code> åªèƒ½æŸ¥çœ‹å’Œåˆ é™¤é˜Ÿåˆ—</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>list_queues</code></td>\n<td>åˆ—å‡ºé˜Ÿåˆ—</td>\n<td><code>rabbitmqctl list_queues</code></td>\n</tr>\n<tr>\n<td><code>list_queues name messages consumers</code></td>\n<td>åˆ—å‡ºé˜Ÿåˆ—åŠæ¶ˆæ¯æ•°ã€æ¶ˆè´¹è€…æ•°</td>\n<td><code>rabbitmqctl list_queues name messages consumers</code></td>\n</tr>\n<tr>\n<td><code>purge_queue &lt;queue&gt;</code></td>\n<td>æ¸…ç©ºé˜Ÿåˆ—æ¶ˆæ¯</td>\n<td><code>rabbitmqctl purge_queue my_queue</code></td>\n</tr>\n<tr>\n<td><code>delete_queue &lt;queue&gt;</code></td>\n<td>åˆ é™¤é˜Ÿåˆ—</td>\n<td><code>rabbitmqctl delete_queue my_queue</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"5-äº¤æ¢æœºå’Œç»‘å®š\">5. äº¤æ¢æœºå’Œç»‘å®š</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>äº¤æ¢æœºå¯ä»¥é€šè¿‡ <code>web æ§åˆ¶å°</code> åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ <code>å®¢æˆ·ç«¯(æ¯”å¦‚Java)</code> åˆ›å»ºï¼Œ<code>rabbitmqctl</code> åªèƒ½æŸ¥çœ‹</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>list_exchanges</code></td>\n<td>åˆ—å‡ºäº¤æ¢æœº</td>\n<td><code>rabbitmqctl list_exchanges</code></td>\n</tr>\n<tr>\n<td><code>list_bindings</code></td>\n<td>åˆ—å‡ºç»‘å®šå…³ç³»</td>\n<td><code>rabbitmqctl list_bindings</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"6-é›†ç¾¤ç®¡ç†\">6. é›†ç¾¤ç®¡ç†</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>cluster_status</code></td>\n<td>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</td>\n<td><code>rabbitmqctl cluster_status</code></td>\n</tr>\n<tr>\n<td><code>join_cluster &lt;node&gt;</code></td>\n<td>èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</td>\n<td><code>rabbitmqctl join_cluster rabbit@node1</code></td>\n</tr>\n<tr>\n<td><code>forget_cluster_node &lt;node&gt;</code></td>\n<td>å°†èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤</td>\n<td><code>rabbitmqctl forget_cluster_node rabbit@node2</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"7-æ—¥å¿—å’Œè°ƒè¯•\">7. æ—¥å¿—å’Œè°ƒè¯•</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>report</code></td>\n<td>è¾“å‡ºèŠ‚ç‚¹è¯Šæ–­æŠ¥å‘Š</td>\n<td><code>rabbitmqctl report</code></td>\n</tr>\n<tr>\n<td><code>eval &lt;expression&gt;</code></td>\n<td>æ‰§è¡Œ Erlang è¡¨è¾¾å¼</td>\n<td><code>rabbitmqctl eval 'rabbit_mnesia:info().'</code></td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"8-å…¶ä»–å‘½ä»¤\">8. å…¶ä»–å‘½ä»¤</h5>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>åŠŸèƒ½</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>help</code></td>\n<td>æŸ¥çœ‹å¸®åŠ©å‘½ä»¤</td>\n<td><code>rabbitmqctl help</code></td>\n</tr>\n<tr>\n<td><code>version</code></td>\n<td>æŸ¥çœ‹ RabbitMQ ç‰ˆæœ¬</td>\n<td><code>rabbitmqctl version</code></td>\n</tr>\n<tr>\n<td><code>authenticate_user &lt;user&gt; &lt;password&gt;</code></td>\n<td>éªŒè¯ç”¨æˆ·å¯†ç </td>\n<td><code>rabbitmqctl authenticate_user alice mypassword</code></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"RabbitMQ-HTTP-API\">RabbitMQ HTTP API</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>RabbitMQ çš„ HTTP API æ˜¯ä¸€ä¸ª åŸºäº REST çš„ç®¡ç†æ¥å£ï¼Œä¸»è¦ç”¨äºå¯¹ RabbitMQ çš„ èµ„æºç®¡ç†å’Œç›‘æ§ï¼Œå®ƒæ˜¯ ç®¡ç†æ’ä»¶ <code>rabbitmq_management</code> æä¾›çš„åŠŸèƒ½ã€‚é€šè¿‡ HTTP APIï¼Œä½ å¯ä»¥ä¸ç”¨ <code>rabbitmqctl</code> å°±èƒ½æ“ä½œ RabbitMQã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¦ä½¿ç”¨ HTTP APIï¼Œä½ éœ€è¦åœ¨ RabbitMQ èŠ‚ç‚¹ä¸Šç¡®ä¿ <code>rabbitmq_management</code> æ’ä»¶å·²ç»å¯åŠ¨ã€‚å‰é¢æˆ‘ä»¬ä»‹ç»<code>web ç®¡ç†æ§åˆ¶å°</code>æ—¶å·²ç»å¯åŠ¨äº†è¯¥æ’ä»¶ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š <code>Webç®¡ç†æ§åˆ¶å°</code> å°±æ˜¯é€šè¿‡å‘é€ AJAX è¯·æ±‚åˆ° <code>/api/â€¦</code> æ¥å£æ¥è·å–æ•°æ®å’Œæ‰§è¡Œæ“ä½œã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/980Wwu.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œæœ‰ HTTP API çš„è¯¦ç»†è¯´æ˜ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚</p>\n</li>\n</ul>\n<h2 id=\"rabbitmqadmin\">rabbitmqadmin</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmqadmin</code> æ˜¯ ç®¡ç†æ’ä»¶ <code>rabbitmq_management</code> æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† RabbitMQ çš„èµ„æºï¼Œå¦‚åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»ã€æŸ¥çœ‹é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>rabbitmqadmin</code> æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>HTTP API</code> çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ‰€ä»¥åº•å±‚å®é™…ä¸Šæ˜¯è°ƒç”¨äº† <code>HTTP API</code> ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/rabbitmq/rabbitmqadmin-ng/releases\">ä¸‹è½½åœ°å€</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> wget -O /usr/local/bin/rabbitmqadmin https://github.com/rabbitmq/rabbitmqadmin-ng/releases/download/v2.10.0/rabbitmqadmin-2.10.0-x86_64-unknown-linux-gnu</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®æƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> +x /usr/local/bin/rabbitmqadmin</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å¸®åŠ©</span></span><br><span class=\"line\">rabbitmqadmin <span class=\"built_in\">help</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å­å‘½ä»¤å¸®åŠ©</span></span><br><span class=\"line\">rabbitmqadmin <span class=\"built_in\">help</span> &lt;<span class=\"built_in\">command</span>&gt;</span><br><span class=\"line\"><span class=\"comment\">## ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ é˜Ÿåˆ— å¸®åŠ©</span></span><br><span class=\"line\">rabbitmqadmin <span class=\"built_in\">help</span> queues</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ é˜Ÿåˆ—å£°æ˜ å¸®åŠ©ï¼Œå­å­å‘½ä»¤</span></span><br><span class=\"line\">rabbitmqadmin <span class=\"built_in\">help</span> queues <span class=\"built_in\">declare</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>rabbitmqadmin</code> çš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯å› ä¸º<code>HTTP API</code>æ•…æ„æ²¡æœ‰å…¬å¼€æŸäº›æ“ä½œï¼Œæ‰€ä»¥å…¶ä¸èƒ½æ›¿ä»£ <code>rabbitmqctl</code> æˆ– <code>rabbitmq-plugins</code>ç­‰å‘½ä»¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å› ä¸ºå®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œï¼Œæ‰€ä»¥è¿™é‡Œåªåšç®€å•ä»‹ç»ã€‚ä¸Šæ–‡æåˆ°äº† <code>rabbitmqctl</code> ä¸æ”¯æŒå£°æ˜(åˆ›å»º) äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼Œè¿™ä¸ªé€šè¿‡ <code>rabbitmqadmin</code> å®ç°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè™šæ‹Ÿä¸»æœº</span></span><br><span class=\"line\">rabbitmqadmin vhosts <span class=\"built_in\">declare</span> --name <span class=\"string\">&quot;my-vhost&quot;</span> --default-queue-type <span class=\"string\">&quot;quorum&quot;</span> --description <span class=\"string\">&quot;Used to test&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å£°æ˜é˜Ÿåˆ—</span></span><br><span class=\"line\">rabbitmqadmin queues <span class=\"built_in\">declare</span> --vhost <span class=\"string\">&quot;my-vhost&quot;</span> --name <span class=\"string\">&quot;target.classic.queue.name&quot;</span> --<span class=\"built_in\">type</span> <span class=\"string\">&quot;classic&quot;</span> --durable <span class=\"literal\">true</span> --auto-delete <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># å£°æ˜äº¤æ¢æœº</span></span><br><span class=\"line\">rabbitmqadmin exchanges <span class=\"built_in\">declare</span> --vhost <span class=\"string\">&quot;my-vhost&quot;</span> --name <span class=\"string\">&quot;target.direct.exchange.name&quot;</span> --<span class=\"built_in\">type</span> <span class=\"string\">&quot;direct&quot;</span> --durable <span class=\"literal\">true</span> --auto-delete <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class=\"line\">rabbitmqadmin bindings <span class=\"built_in\">declare</span> --vhost <span class=\"string\">&quot;my-vhost&quot;</span> --<span class=\"built_in\">source</span> <span class=\"string\">&quot;target.direct.exchange.name&quot;</span> --destination <span class=\"string\">&quot;target.classic.queue.name&quot;</span> --destination-type <span class=\"string\">&quot;queue&quot;</span> --routing-key <span class=\"string\">&quot;target.routing.key&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿˜æœ‰å°±æ˜¯å®šæœŸå¤‡ä»½ RabbitMQ çš„ç»“æ„æ•°æ®(ä¸åŒ…æ‹¬æ¶ˆæ¯)</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯¼å‡º</span></span><br><span class=\"line\">abbitmqadmin definitions <span class=\"built_in\">export</span> --file backup.json</span><br><span class=\"line\"><span class=\"comment\"># å¯¼å…¥</span></span><br><span class=\"line\">rabbitmqadmin definitions import --file backup.json</span><br></pre></td></tr></table></figure>\n<h2 id=\"RabbitMQ-éœ€è¦å¼€æ”¾å“ªäº›ç«¯å£\">RabbitMQ éœ€è¦å¼€æ”¾å“ªäº›ç«¯å£</h2>\n<table>\n<thead>\n<tr>\n<th>ç«¯å£å·</th>\n<th>åè®®</th>\n<th>ç”¨é€”è¯´æ˜</th>\n<th>é»˜è®¤çŠ¶æ€</th>\n<th>å®‰å…¨å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>5672</td>\n<td>AMQP</td>\n<td>ä¸»å®¢æˆ·ç«¯è¿æ¥ç«¯å£</td>\n<td>å¼€æ”¾</td>\n<td>å¿…é¡»å¼€æ”¾ï¼Œé™åˆ¶IP</td>\n</tr>\n<tr>\n<td>5671</td>\n<td>AMQP/SSL</td>\n<td>TLSåŠ å¯†è¿æ¥ç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨TLSåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>15672</td>\n<td>HTTP</td>\n<td>ç®¡ç†ç•Œé¢ç«¯å£</td>\n<td>å…³é—­</td>\n<td>å»ºè®®å†…ç½‘è®¿é—®</td>\n</tr>\n<tr>\n<td>15671</td>\n<td>HTTPS</td>\n<td>TLSç®¡ç†ç•Œé¢ç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨HTTPSåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>25672</td>\n<td>Erlang Distribution</td>\n<td>é›†ç¾¤èŠ‚ç‚¹é€šä¿¡</td>\n<td>å¼€æ”¾</td>\n<td>é›†ç¾¤å†…éƒ¨ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>35672-35682</td>\n<td>Erlang Distribution</td>\n<td>é›†ç¾¤èŠ‚ç‚¹å‘ç°</td>\n<td>å¼€æ”¾</td>\n<td>é›†ç¾¤å†…éƒ¨ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>5552</td>\n<td>Stream Protocol</td>\n<td>æµåè®®ç«¯å£,RabbitMQ 3.9+</td>\n<td>å…³é—­</td>\n<td>ä½¿ç”¨æµåŠŸèƒ½æ—¶å¼€æ”¾</td>\n</tr>\n<tr>\n<td>5551</td>\n<td>Stream Protocol/SSL</td>\n<td>æµåè®®TLSç«¯å£,RabbitMQ 3.9+</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨TLSåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>61613</td>\n<td>STOMP</td>\n<td>STOMPåè®®æ”¯æŒç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨STOMPåè®®åˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>61614</td>\n<td>STOMP/SSL</td>\n<td>STOMP TLSåŠ å¯†ç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨STOMP over TLSåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>1883</td>\n<td>MQTT</td>\n<td>MQTTåè®®æ”¯æŒç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨MQTTåè®®åˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>8883</td>\n<td>MQTT/SSL</td>\n<td>MQTT TLSåŠ å¯†ç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨MQTT over TLSåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>15674</td>\n<td>Web STOMP</td>\n<td>WebSocket STOMPæ”¯æŒç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨Web STOMPåˆ™å¼€æ”¾</td>\n</tr>\n<tr>\n<td>15675</td>\n<td>Web MQTT</td>\n<td>WebSocket MQTTæ”¯æŒç«¯å£</td>\n<td>å…³é—­</td>\n<td>å¦‚ä½¿ç”¨Web MQTTåˆ™å¼€æ”¾</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RabbitMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹ RabbitMQ ç®€ä»‹ RabbitMQ æ˜¯ä¸€ä¸ªå¼€æºçš„ æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼ŒåŸºäº AMQPï¼ˆAdvanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰ å®ç°ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ è§£è€¦ã€ç¼“å†²å’Œå¼‚æ­¥å¤„ç†æ¶ˆæ¯ã€‚ å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯è®© ä¸åŒç³»ç»Ÿ æˆ– åº”ç”¨ ä¹‹é—´å¯é åœ°ä¼ é€’æ¶ˆæ¯ï¼Œå³ä½¿å‘é€æ–¹æˆ–æ¥æ”¶æ–¹æš‚æ—¶ä¸å¯ç”¨ï¼Œä¹Ÿèƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚ RabbitMQ çš„æ ¸å¿ƒç‰¹ç‚¹ æ ¸å¿ƒç‰¹ç‚¹ å…·ä½“è¯´æ˜ å¯é æ€§ - æ”¯æŒæ¶ˆæ¯ç¡®è®¤ï¼ˆACKï¼‰æœºåˆ¶- æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜- æ”¯æŒäº‹åŠ¡æˆ–ç¡®è®¤æ¨¡å¼ï¼Œä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤± çµæ´»çš„è·¯ç”± - é€šè¿‡ äº¤æ¢æœºï¼ˆExchangeï¼‰ å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„ é˜Ÿåˆ—ï¼ˆQueueï¼‰- æ”¯æŒå¤šç§è·¯ç”±ç­–ç•¥ï¼š â€¢ directï¼šç›´è¿ï¼ŒæŒ‰é˜Ÿåˆ—åè·¯ç”± â€¢ fanoutï¼šå¹¿æ’­ï¼Œæ‰€æœ‰é˜Ÿåˆ—éƒ½æ”¶åˆ° â€¢ topicï¼šä¸»é¢˜åŒ¹é…ï¼Œç±»ä¼¼è®¢é˜…æ¨¡å¼ â€¢ headersï¼šæŒ‰æ¶ˆæ¯å¤´åŒ¹é… é«˜æ€§èƒ½ - å†…å­˜é˜Ÿåˆ—å¿«é€Ÿå¤„ç†æ¶ˆæ¯- æ”¯æŒå¼‚æ­¥ IO å’Œ Erlang çš„å¹¶å‘æ¨¡å‹ å¤šè¯­è¨€æ”¯æŒ - å®¢æˆ·ç«¯åº“ä¸°å¯Œï¼šJavaã€Pythonã€Goã€C#ã€Node.js ç­‰- å¯åœ¨å¤šç§å¹³å°å’Œæ¡†æ¶ä¸­ä½¿ç”¨ é›†ç¾¤ä¸é«˜å¯ç”¨ - æ”¯æŒé›†ç¾¤æ¨¡å¼- é˜Ÿåˆ—å¯ä»¥é•œåƒåˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä¿è¯é«˜å¯ç”¨ RabbitMQ çš„æ ¸å¿ƒæ¦‚å¿µ æ¦‚å¿µ å«ä¹‰ ä½œç”¨èŒƒå›´ ç±»æ¯” Broker ä¸€ä¸ª RabbitMQ æœåŠ¡å®ä¾‹ï¼ŒåŒ…å«æ•´ä¸ª AMQP æœåŠ¡ã€ç®¡ç†æ’ä»¶ã€é˜Ÿåˆ—ã€äº¤æ¢æœºç­‰èµ„æº è¿è¡Œåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œæˆ–é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ ç±»ä¼¼äºæ•°æ®åº“çš„ å®ä¾‹ Vhost Broker å†…éƒ¨çš„ é€»è¾‘åˆ†åŒºï¼Œç”¨äºéš”ç¦»ä¸åŒçš„é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šç­‰èµ„æº ä¸€ä¸ª Broker å¯ä»¥æœ‰å¤šä¸ª vhostï¼Œæ¯ä¸ª vhost å½¼æ­¤éš”ç¦» ç±»ä¼¼äºæ•°æ®åº“å®ä¾‹é‡Œçš„ schemaï¼Œå®é™…ä½¿ç”¨ä¸­å»ºè®®ä¸ºæ¯ä¸ªä¸šåŠ¡é…ç½®ä¸€ä¸ªç‹¬ç«‹çš„ vhostï¼Œå¹¶ä¸ºæ¯ä¸ªvhostå•ç‹¬é…ç½®ä¸€ä¸ªç®¡ç†ç”¨æˆ· åç§° è¯´æ˜ Producer æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå‘é€æ¶ˆæ¯åˆ° RabbitMQ Queue é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯çš„åœ°æ–¹ Consumer æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œä»é˜Ÿåˆ—è·å–æ¶ˆæ¯ Exchange äº¤æ¢æœºï¼Œæ¥æ”¶ Producer çš„æ¶ˆæ¯å¹¶æ ¹æ®è§„åˆ™è·¯ç”±åˆ°é˜Ÿåˆ— Binding ç»‘å®šï¼Œå®šä¹‰ Exchange ä¸ Queue çš„è·¯ç”±è§„åˆ™ Message æ¶ˆæ¯ï¼ŒRabbitMQ ä¼ é€’çš„æ•°æ®å•å…ƒ Connection è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¸ RabbitMQ Broker ä¹‹é—´çš„ TCP è¿æ¥ï¼Œæ˜¯é€šä¿¡çš„ç‰©ç†é€šé“ Channel é€šé“ï¼ŒConnection å†…éƒ¨çš„ é€»è¾‘è¿æ¥ï¼Œè½»é‡çº§ä¸”å¤šè·¯å¤ç”¨ï¼Œä¸€ä¸ªè¿æ¥å¯å¼€å¤šä¸ªé€šé“ 1234567 â”Œâ”€ Broker (RabbitMQ å®ä¾‹)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€ Virtual Host â”€â”€â”€â”€â”€â” â”‚ Producer â”€â”€â”€ TCP â”€â”€â”€â”€â”€â”€&gt; Exchange â”€â”€&gt; Queue â”€â”€â”€â”€â”€â”€â”€â”€&gt; TCP â”€â”€ Consumer(Connection â”€â”€&gt; Channel)â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ RabbitMQ çš„å…¸å‹åº”ç”¨åœºæ™¯ åº”ç”¨åœºæ™¯ è¯´æ˜ å¼‚æ­¥å¤„ç† ç”¨æˆ·è¯·æ±‚ä¸ç›´æ¥å¤„ç†ï¼Œæ¶ˆæ¯å…¥é˜Ÿåç”±åå°å¼‚æ­¥æ¶ˆè´¹ï¼Œä¾‹å¦‚é‚®ä»¶å‘é€ã€å›¾ç‰‡å¤„ç† å‰Šå³°å¡«è°· ç¼“å†²é«˜å³°æµé‡ï¼Œå¹³æ»‘ç³»ç»Ÿå‹åŠ› ç³»ç»Ÿè§£è€¦ ä¸åŒæœåŠ¡ä¹‹é—´ä¸ç›´æ¥è°ƒç”¨ï¼Œé™ä½è€¦åˆ å¹¿æ’­/é€šçŸ¥ å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œå®ç°å¤šæœåŠ¡åŒæ—¶æ”¶åˆ°æ¶ˆæ¯ æ—¥å¿—æ”¶é›† ç»Ÿä¸€æ¥æ”¶ã€åˆ†å‘æ—¥å¿—åˆ°ä¸åŒå¤„ç†ç³»ç»Ÿ RabbitMQ 4.0+ æœ‰å“ªäº›å‡çº§ ç‰¹æ€§æ ‡å¿—ï¼ˆFeature Flagsï¼‰çš„ä¼˜åŒ–ä¸å¼ºåˆ¶æ€§è¦æ±‚ åœ¨å‡çº§åˆ° 4.0 ä¹‹å‰ï¼Œç”¨æˆ·å¿…é¡»å…ˆå‡çº§åˆ° 3.13.x ç‰ˆæœ¬å¹¶æ‰‹åŠ¨å¯ç”¨æ‰€æœ‰ç¨³å®šçš„ç‰¹æ€§æ ‡å¿—ã€‚ ä» 4.0+ å¼€å§‹ï¼Œå¦‚æœé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ”¯æŒæŸä¸ªå¿…éœ€çš„ç‰¹æ€§æ ‡å¿—ï¼Œç³»ç»Ÿä¼šåœ¨èŠ‚ç‚¹å¯åŠ¨æ—¶è‡ªåŠ¨å¯ç”¨è¯¥æ ‡å¿—ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚ AMQP åè®®çš„å¢å¼º æ–°å¢äº†å¯¹ AMQP è¿‡æ»¤è¡¨è¾¾å¼ï¼ˆAMQP Filter Expressionsï¼‰Version 1.0 Working Draft 09 çš„æ”¯æŒã€‚ MQTT åè®®çš„æ”¹è¿› é»˜è®¤çš„ MQTT æœ€å¤§åŒ…å¤§å°ä»ä¹‹å‰çš„ 256 MiB é™ä½åˆ° 16 MiBï¼ŒåŒæ—¶ä»å…è®¸ç”¨æˆ·é€šè¿‡é…ç½®é¡¹ mqtt.max_packet_size_authenticated è‡ªå®šä¹‰è¯¥å€¼ Classicé˜Ÿåˆ—çš„å˜åŒ– åˆ é™¤äº†å¯¹ Classicé˜Ÿåˆ— version1 çš„æ”¯æŒï¼Œé»˜è®¤å°±æ˜¯ version2 ä¸å†æ”¯æŒ Classicé˜Ÿåˆ— çš„é•œåƒåŠŸèƒ½ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Quorum é˜Ÿåˆ— ï¼Œæœªæ¥ä¼šå°† Quorum é˜Ÿåˆ— ä½œä¸ºé»˜è®¤é˜Ÿåˆ—ã€‚ é›†ç¾¤çŠ¶æ€ä¸‹åˆ›å»º Quorum é˜Ÿåˆ— å’Œ Stream é˜Ÿåˆ— ä¼šè‡ªåŠ¨å‡çº§ä¸º å¤åˆ¶é˜Ÿåˆ—ï¼ˆé•œåƒï¼‰ RabbitMQ å•æœºå®‰è£… å®‰è£…Erlang RabbitMQæ˜¯åŸºäºErlangè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥å®‰è£…RabbitMQä¹‹å‰éœ€è¦å®‰è£…Erlangè¯­è¨€ç¯å¢ƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯RabbitMQä¸Erlangè¯­è¨€ä¹‹é—´æ˜¯æœ‰ç‰ˆæœ¬å¯¹åº”å…³ç³»çš„ã€‚å‚è€ƒå®˜æ–¹æ–‡æ¡£Erlang Version Requirements ç›®å‰RabbitMQæœ€æ–°ç‰ˆæœ¬æ˜¯4.1.4ï¼ŒErlangç‰ˆæœ¬å¯ä»¥é€‰æ‹© 27.xï¼ŒGitHubä¸‹è½½åœ°å€ 123456789101112# ä¸‹è½½ el9 çš„ç‰ˆæœ¬ï¼Œå¯¹åº” CentOS 9wget https://github.com/rabbitmq/erlang-rpm/releases/download/v27.3.4.3/erlang-27.3.4.3-1.el9.x86_64.rpm# å®‰è£…sudo rpm -ivh erlang-27.3.4.3-1.el9.x86_64.rpm# æŸ¥çœ‹å®‰è£…çš„ç‰ˆæœ¬erl# è¾“å‡ºç±»ä¼¼äºï¼Œè¿™é‡Œ Erlang/OTP 27 å°±è¡¨ç¤ºå®‰è£…çš„æ˜¯ 27.x ç‰ˆæœ¬Erlang/OTP 27 [erts-15.2.7.2] [source] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:1] [jit:ns]Eshell V15.2.7.2 (press Ctrl+G to abort, type help(). for help)1&gt; q(). # é€€å‡ºå‘½ä»¤ï¼Œæ³¨æ„æ˜¯æ‹¬å·åé¢è¿˜æœ‰ä¸€ä¸ªç‚¹ã€‚è¾“å…¥ help(). æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ok å®‰è£… RabbitMQ ç›®å‰RabbitMQæœ€æ–°ç‰ˆæœ¬æ˜¯4.1.4ï¼ŒGitHubä¸‹è½½åœ°å€] 123456789# ä¸‹è½½ï¼Œnoarch è¡¨ç¤ºæ¶æ„æ— å…³ï¼Œå³ X86_64 å’Œ ARM64 éƒ½å¯ä»¥# å› ä¸ºæ²¡æœ‰å¯¹åº”çš„ el9 çš„åŒ…ï¼Œæ‰€ä»¥åªèƒ½ç”¨ el8 çš„åŒ…äº†ï¼Œå®é™…ä½¿ç”¨ä¸­æ²¡æœ‰é—®é¢˜ã€‚wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v4.1.4/rabbitmq-server-4.1.4-1.el8.noarch.rpm# å®‰è£…sudo rpm -ivh rabbitmq-server-4.1.4-1.el8.noarch.rpm# æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯rabbitmq-diagnostics version # æ— éœ€å¯åŠ¨æœåŠ¡# RabbitMQ æœåŠ¡å¯åŠ¨åæ–¹å¯æ­£ç¡®è¾“å‡ºrabbitmqctl version RabbitMQ å¯åŠ¨ä¸åœæ­¢å‘½ä»¤ Erlang VM æ˜¯ Erlang è¯­è¨€è¿è¡Œç¯å¢ƒï¼ŒRabbitMQ åº”ç”¨è¿è¡Œåœ¨ Erlang VM ä¸‹ã€‚ å¯åŠ¨ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨ 1234567# å¯åŠ¨ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨sudo systemctl start rabbitmq-server# æˆ–è€…ï¼Œ--detached åå°è¿è¡Œï¼Œä¸åŠ å°±æ˜¯å‰å°è¿è¡Œsudo rabbitmq-server -detached# å•ç‹¬å¯åŠ¨ åº”ç”¨ï¼Œæ­¤æ—¶éœ€è¦ä¿è¯ RabbitMQ æœåŠ¡(Erlang VM) æ­£åœ¨è¿è¡Œï¼Œä¸€èˆ¬é‡å¯ åº”ç”¨ æ—¶ä½¿ç”¨è¯¥å‘½ä»¤sudo rabbitmqctl start_app åœæ­¢ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨ 1234567# åœæ­¢ RabbitMQ æœåŠ¡(Erlang VM) + åº”ç”¨sudo systemctl stop rabbitmq-server# æˆ–è€…ï¼Œå•æœºæ¨¡å¼ stopï¼Œé›†ç¾¤æ¨¡å¼ shutdownsudo rabbitmqctl stop / shutdown# å•ç‹¬åœæ­¢ RabbitMQ åº”ç”¨ï¼Œæ­¤æ—¶éœ€è¦ä¿è¯ RabbitMQ æœåŠ¡(Erlang VM) æ­£åœ¨è¿è¡Œï¼Œä¸€èˆ¬é‡å¯ åº”ç”¨ æ—¶ä½¿ç”¨è¯¥å‘½ä»¤sudo rabbitmqctl stop_app æŸ¥çœ‹RabbitMQ æœåŠ¡çŠ¶æ€ 123sudo systemctl status rabbitmq-server# æˆ–è€…sudo rabbitmqctl status RabbitMQ åœ¨ CentOS 9 (RPM å®‰è£…) çš„ç›®å½•ç»“æ„ ç±»å‹ ç›®å½•è·¯å¾„ è¯´æ˜ é…ç½®æ–‡ä»¶ /etc/rabbitmq rabbitmq.confã€advanced.config ç­‰é…ç½® æ—¥å¿—æ–‡ä»¶ /var/log/rabbitmq RabbitMQ è¿è¡Œæ—¥å¿—ï¼Œé»˜è®¤å­˜æ”¾åœ¨è¿™é‡Œ æ•°æ®ç›®å½• /var/lib/rabbitmq/mnesia æ¶ˆæ¯é˜Ÿåˆ—ã€å…ƒæ•°æ®å­˜å‚¨ç›®å½• Erlang Cookie /var/lib/rabbitmq/.erlang.cookie Erlang èŠ‚ç‚¹é—´é€šä¿¡çš„ cookie æ–‡ä»¶ å¯æ‰§è¡Œæ–‡ä»¶ /usr/lib/rabbitmq/bin rabbitmq-serverã€rabbitmqctl ç­‰å‘½ä»¤ å¯åŠ¨è„šæœ¬ /usr/lib/systemd/system/rabbitmq-server.service systemd ç®¡ç† RabbitMQ çš„å¯åŠ¨è„šæœ¬ æ’ä»¶ç›®å½• /usr/lib/rabbitmq/lib/rabbitmq_server-&lt;version&gt;/plugins æ‰€æœ‰æ’ä»¶æ–‡ä»¶å­˜æ”¾è·¯å¾„ æ¿€æ´»Webç®¡ç†æ§åˆ¶å°æ’ä»¶ å¯¹äº RabbitMQ æ‰€æœ‰çš„æ“ä½œåŸºæœ¬éƒ½å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå®Œæˆï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥å¹¶ä¸æ–¹ä¾¿ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥æ¿€æ´» rabbitmq_management æ’ä»¶ï¼Œè¯¥æ’ä»¶æä¾›äº† Web ç®¡ç†æ§åˆ¶å°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Web ç®¡ç†æ§åˆ¶å°æ¥ç®¡ç† RabbitMQ rabbitmq_management æ’ä»¶ä¸º å®˜æ–¹æ’ä»¶ï¼Œé»˜è®¤å·²ç»å®‰è£…ï¼Œä¸éœ€è¦ä¸‹è½½ï¼Œç›´æ¥æ¿€æ´»å³å¯ 12# æ¿€æ´»æ’ä»¶sudo rabbitmq-plugins enable rabbitmq_management è¯¥æ’ä»¶é™¤äº†æä¾›äº† Web ç®¡ç†æ§åˆ¶å° ï¼Œè¿˜æä¾› åŸºäº HTTP çš„ API ç”¨äºç®¡ç†å’Œç›‘æ§ RabbitMQ èŠ‚ç‚¹å’Œé›†ç¾¤ï¼Œä»¥åŠ å‘½ä»¤è¡Œå·¥å…· rabbitmqadminï¼Œè¿™ä¸ªåé¢ä¼šä»‹ç»ã€‚ è®¾ç½®è¿œç¨‹è®¿é—®å¸å· æ’ä»¶æ¿€æ´»åå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® http://&lt;ip&gt;:15672ï¼Œrabbitmq_management æ’ä»¶é»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ guestï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹å…¶åªèƒ½é€šè¿‡ 127.0.0.1 è®¿é—®ï¼Œæ­¤æ—¶æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ 1. å…è®¸ guest è´¦å·è¿œç¨‹è®¿é—® 123456# ä¿®æ”¹ /etc/rabbitmq/rabbitmq.conf æ–‡ä»¶# å…è®¸guestç”¨æˆ·è¿œç¨‹è®¿é—®ï¼Œ`å®˜æ–¹ä¸æ¨è` ä¸€ç›´å¼€å¯ï¼Œå»ºè®®å¼€å¯ååœ¨ web æ§åˆ¶å°ä¸­åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·ï¼Œç„¶åç«‹åˆ»å…³é—­è¯¥é…ç½®loopback_users.guest = false# é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ³¨æ„è¿™é‡Œ user å¦‚æœæ”¹æˆ adminï¼Œåˆ™ä¸Šé¢çš„å¼€å¯è¿œç¨‹è®¿é—®ä¸­çš„ guest ä¹Ÿè¦æ”¹æˆ admindefault_user = guestdefault_pass = guest ä¿®æ”¹å®Œæˆåï¼Œé‡å¯ RabbitMQ æœåŠ¡ 1sudo systemctl restart rabbitmq-server 2. æ–°åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿œç¨‹è®¿é—®çš„ç®¡ç†å‘˜è´¦å· åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œæ¯”å¦‚è¿™é‡Œ ç”¨æˆ·åä¸º adminï¼Œå¯†ç ä¸º rabbitmq 1sudo rabbitmqctl add_user admin rabbitmq ç»™ç®¡ç†å‘˜è´¦å·æ·»åŠ èµ„æºç®¡ç†æƒé™ 1sudo rabbitmqctl set_permissions -p / admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot; éƒ¨åˆ† è§£é‡Š rabbitmqctl RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†ç”¨æˆ·ã€æƒé™ã€é˜Ÿåˆ—ã€äº¤æ¢æœºç­‰ã€‚ set_permissions è®¾ç½®æŒ‡å®šç”¨æˆ·åœ¨æŸä¸ªè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ä¸‹çš„æƒé™ã€‚ -p / æŒ‡å®šè™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ã€‚è¿™é‡Œçš„ / æ˜¯é»˜è®¤è™šæ‹Ÿä¸»æœºã€‚ admin ç”¨æˆ·åï¼Œè¿™é‡Œæ˜¯ä¸º admin ç”¨æˆ·è®¾ç½®æƒé™ã€‚ &quot;.*&quot;ï¼ˆé…ç½®æƒé™ï¼‰ ç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·å¯¹èµ„æºé…ç½®çš„æƒé™ï¼Œæ¯”å¦‚åˆ›å»ºäº¤æ¢æœºã€é˜Ÿåˆ—ã€ç»‘å®šç­‰ã€‚&quot;.*&quot; è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚ &quot;.*&quot;ï¼ˆå†™æƒé™ï¼‰ ç¬¬äºŒä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·å‘å“ªäº›èµ„æºå‘é€æ¶ˆæ¯ã€‚&quot;.*&quot; è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚ &quot;.*&quot;ï¼ˆè¯»æƒé™ï¼‰ ç¬¬ä¸‰ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ§åˆ¶ç”¨æˆ·ä»å“ªäº›èµ„æºæ¶ˆè´¹æ¶ˆæ¯ã€‚&quot;.*&quot; è¡¨ç¤ºå…¨éƒ¨å…è®¸ã€‚ è®¾ç½®adminè´¦å·ä¸ºæ§åˆ¶å°ç®¡ç†å‘˜ 1sudo rabbitmqctl set_user_tags admin administrator éƒ¨åˆ† è§£é‡Š rabbitmqctl RabbitMQ çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ã€‚ set_user_tags ç”¨æ¥ä¸ºç”¨æˆ·è®¾ç½®æ ‡ç­¾ï¼ˆtagï¼‰ï¼Œæ ‡ç­¾å†³å®šäº†ç”¨æˆ·åœ¨ç®¡ç†ç•Œé¢æˆ– API ä¸­çš„æƒé™çº§åˆ«ã€‚ admin ç”¨æˆ·åï¼Œè¿™é‡Œæ˜¯ä¸º admin ç”¨æˆ·è®¾ç½®æ ‡ç­¾ã€‚ administrator æ ‡ç­¾åï¼Œè¡¨ç¤ºç»™è¯¥ç”¨æˆ·èµ‹äºˆç®¡ç†å‘˜æƒé™ã€‚ å¸¸è§çš„ç”¨æˆ·æ ‡ç­¾ æ ‡ç­¾ è¯´æ˜ administrator ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æœ€é«˜æƒé™ï¼Œå¯é€šè¿‡ Web ç®¡ç†ç•Œé¢ã€CLIã€API ç®¡ç† RabbitMQ æ‰€æœ‰å†…å®¹ monitoring ç›‘æ§ç”¨æˆ·ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰ç›‘æ§ä¿¡æ¯ï¼Œä½†ä¸èƒ½ä¿®æ”¹é…ç½® management æ™®é€šç®¡ç†ç”¨æˆ·ï¼Œå¯ä»¥ç™»å½•ç®¡ç†ç•Œé¢ï¼Œä½†æƒé™å—é™ policymaker ç­–ç•¥ç®¡ç†ç”¨æˆ·ï¼Œå¯ä»¥ç®¡ç†ç­–ç•¥å’Œå‚æ•°ï¼Œä½†ä¸èƒ½ç®¡ç†å…¶ä»–ç”¨æˆ· æ— æ ‡ç­¾ æ™®é€šç”¨æˆ·ï¼Œåªèƒ½æ”¶å‘æ¶ˆæ¯ï¼Œä¸èƒ½ç™»å½•ç®¡ç†ç•Œé¢ set_permissions ä¸ set_user_tags æ€»ç»“å¯¹æ¯” å‘½ä»¤ æ§åˆ¶èŒƒå›´ ä¸»è¦ä½œç”¨ set_permissions vhost å†…çš„èµ„æº å‘æ¶ˆæ¯ã€æ”¶æ¶ˆæ¯ã€åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœº set_user_tags ç®¡ç†ç•Œé¢ã€ç®¡ç† API ç”¨æˆ·ç®¡ç†ã€ç­–ç•¥ç®¡ç†ã€é›†ç¾¤ç®¡ç† å¯ç”¨æ‰€æœ‰ç¨³å®šçš„ Feature Flags ç™»å½•æ§åˆ¶å°åæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€æ¡å‘Šè­¦ä¿¡æ¯ï¼Œå‚è€ƒï¼šFeature Flags 1âš  All stable feature flags must be enabled after completing an upgrade. å®ƒçš„æ„æ€æ˜¯ï¼šRabbitMQ åœ¨æ–°ç‰ˆæœ¬ä¸­å¼•å…¥äº†ä¸€äº› Feature Flagsï¼ˆç‰¹æ€§æ ‡å¿—ï¼‰ï¼Œè¿™äº›ç‰¹æ€§æ ‡å¿—ç”¨äºæ§åˆ¶ä¸€äº›æ–°çš„åŠŸèƒ½æˆ–è¡Œä¸ºæ˜¯å¦å¯ç”¨ã€‚å‡çº§ RabbitMQ åï¼Œæœ‰äº›åŠŸèƒ½ä¼šå¤„äº æœªå¯ç”¨çŠ¶æ€ï¼Œéœ€è¦ä½ æ‰‹åŠ¨å¼€å¯ï¼Œç¡®ä¿é›†ç¾¤å®Œå…¨è¿è¡Œåœ¨æœ€æ–°çš„åŠŸèƒ½æ¨¡å¼ä¸‹ã€‚ èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆæœ‰ Feature Flagsï¼Ÿ å‘åå…¼å®¹ï¼šRabbitMQ å‡çº§æ—¶ï¼Œå¯èƒ½å¼•å…¥äº†æ–°çš„æ•°æ®æ ¼å¼æˆ–å†…éƒ¨æœºåˆ¶ï¼Œå¦‚æœç«‹å³å¯ç”¨ï¼Œæ—§ç‰ˆæœ¬èŠ‚ç‚¹å¯èƒ½æ— æ³•ç†è§£ã€‚ æ»šåŠ¨å‡çº§æ”¯æŒï¼šå‡çº§é›†ç¾¤æ—¶ï¼Œå¯ä»¥å…ˆå‡çº§èŠ‚ç‚¹ï¼Œå†ç»Ÿä¸€å¯ç”¨åŠŸèƒ½ï¼Œé¿å…ä¸­é€”å‡ºé—®é¢˜ã€‚ å¯æ§æ€§ï¼šä½ å¯ä»¥é€‰æ‹©åœ¨ç¡®è®¤é›†ç¾¤ç¨³å®šåå†å¯ç”¨æ–°åŠŸèƒ½ã€‚ æŸ¥çœ‹å½“å‰ Feature Flags çŠ¶æ€ 1234567891011121314151617rabbitmqctl -q --formatter pretty_table list_feature_flags# è¾“å‡ºä¼šç±»ä¼¼è¿™æ ·ï¼šâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ name â”‚ state â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ classic_mirrored_queue_version â”‚ enabled â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ classic_queue_type_delivery_support â”‚ enabled â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ detailed_queues_endpoint â”‚ disabled â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ direct_exchange_routing_v2 â”‚ enabled â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&gt; enabledï¼šç‰¹æ€§å·²å¯ç”¨&gt; disabledï¼šç‰¹æ€§æœªå¯ç”¨ å¯ä»¥è¾“å‡º å…¶å®ƒ æ ¼å¼ï¼Œæ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯ 1234# jsonrabbitmqctl -q --formatter json list_feature_flags name state provided_by desc doc_url | jq# tablerabbitmqctl -q --formatter pretty_table list_feature_flags name state provided_by desc doc_url å¯ç”¨æ‰€æœ‰å·²æ ‡è®°ä¸º stable çš„ç‰¹æ€§ï¼Œå»ºè®®å‡çº§ä¸‹ä¸€ä¸ª RabbitMQ ç‰ˆæœ¬ å‰ä¸€å®šè¦ç¡®ä¿å½“å‰ç‰ˆæœ¬çš„ Feature Flags éƒ½æ˜¯å¯ç”¨çš„ï¼Œé¿å…å‡çº§åæ— æ³•é¡ºåˆ©å¯åŠ¨æœåŠ¡ã€‚ 1rabbitmqctl enable_feature_flag all åœ¨æ§åˆ¶å°ä¸­ä¹Ÿå¯ä»¥æŸ¥çœ‹å’Œå¼€å¯è¿™äº› Feature Flags çš„çŠ¶æ€ è¿™é‡Œè¦æ³¨æ„ï¼ŒFeature Flags ä¸€æ—¦å¼€å¯å°±æ— æ³•å…³é—­ã€‚ RabbitMQ é…ç½®æ–‡ä»¶ å¯¹äº RPM/YUM/DNF å®‰è£…çš„ RabbitMQï¼Œé…ç½®æ–‡ä»¶é»˜è®¤è·¯å¾„æ˜¯ æ–‡ä»¶ç±»å‹ é»˜è®¤ä½ç½® ä½œç”¨ ä¸»é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰ /etc/rabbitmq/rabbitmq.conf ä½¿ç”¨ INI æ ¼å¼ï¼Œä¸»è¦é…ç½®éƒ½åœ¨è¿™é‡Œ ç¯å¢ƒå˜é‡é…ç½® /etc/rabbitmq/rabbitmq-env.conf å®šä¹‰èŠ‚ç‚¹åã€Cookie ä½ç½®ã€æ•°æ®/æ—¥å¿—ç›®å½•ç­‰ å®‰è£…å /etc/rabbitmq/ ç›®å½•å¯èƒ½æ˜¯ç©ºçš„ï¼Œä½ éœ€è¦æ‰‹åŠ¨åˆ›å»º rabbitmq.confï¼Œè¯¦ç»†çš„å‚æ•°è¯´æ˜å¯ä»¥å‚çœ‹å®˜ç½‘æŒ‡å—ï¼Œrabbitmq.conf ç¤ºä¾‹ 123456# /etc/rabbitmq/rabbitmq.conf# ç›‘å¬ç«¯å£listeners.tcp.default = 5672# ç®¡ç†ç•Œé¢ç«¯å£management.tcp.port = 15672 rabbitmq-env.conf ç”¨æ¥ å®šä¹‰èŠ‚ç‚¹åã€Cookie ã€æ•°æ®/æ—¥å¿—ç›®å½•ç­‰çš„ç¯å¢ƒå˜é‡ï¼ŒRabbitMQ å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¯»å–è¯¥æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯é€šè¿‡ RPM å®‰è£…çš„ RabbitMQ çš„é»˜è®¤å€¼ 12345678910111213141516171819202122# /etc/rabbitmq/rabbitmq-env.conf# èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤ä½¿ç”¨ä¸»æœºçŸ­å(hostname -s)ï¼Œä¾‹å¦‚ rabbit@myhostNODENAME=rabbit@&lt;hostname&gt;# ç»‘å®šçš„ IP åœ°å€ï¼Œç•™ç©ºè¡¨ç¤ºç›‘å¬æ‰€æœ‰åœ°å€ï¼Œç­‰ä»·äº 0.0.0.0NODE_IP_ADDRESS=# AMQP åè®®ç«¯å£ï¼Œé»˜è®¤ 5672NODE_PORT=5672# RabbitMQ æ•°æ®åº“å­˜å‚¨ç›®å½•MNESIA_BASE=/var/lib/rabbitmq/mnesia# æ—¥å¿—å­˜æ”¾ç›®å½•LOG_BASE=/var/log/rabbitmq# é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œä¸å¸¦ .conf åç¼€CONFIG_FILE=/etc/rabbitmq/rabbitmq# æ˜¯å¦ä½¿ç”¨é•¿ä¸»æœºåï¼Œtrue/false (é•¿ä¸»æœºå hostname -f)USE_LONGNAME=false ä¸¤ä¸ªæ–‡ä»¶çš„ä½œç”¨ æ–‡ä»¶ ä½œç”¨èŒƒå›´ å…¸å‹å‚æ•° ä½•æ—¶åŠ è½½ rabbitmq-env.conf è®¾ç½® RabbitMQ å¯åŠ¨æ—¶çš„ ç¯å¢ƒå˜é‡ NODENAME, NODE_IP_ADDRESS, NODE_PORT, LOG_BASE, MNESIA_BASE åœ¨å¯åŠ¨ RabbitMQ æœåŠ¡å‰ç”± rabbitmq-env è„šæœ¬è¯»å– rabbitmq.conf RabbitMQ è¿è¡Œæ—¶é…ç½®ï¼ˆå†…éƒ¨å‚æ•°ã€æ’ä»¶é…ç½®ç­‰ï¼‰ listeners.tcp.default, log, cluster_formation ç­‰ RabbitMQ å¯åŠ¨åç”± Erlang VM å†…éƒ¨è¯»å– rabbitmq-env.conf å†³å®š RabbitMQ å¯åŠ¨æ—¶çš„åŸºæœ¬ç¯å¢ƒï¼Œæ¯”å¦‚èŠ‚ç‚¹åã€æ•°æ®ç›®å½•ã€ç›‘å¬ IP ç­‰ï¼Œå¿…é¡»åœ¨å¯åŠ¨å‰å°±ç¡®å®šã€‚ rabbitmq.conf å†³å®šè¿è¡Œæ—¶çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç«¯å£ç›‘å¬ã€æ—¥å¿—ç­‰çº§ã€é›†ç¾¤é…ç½®ç­‰ï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œé‡å¯åº”ç”¨åç”Ÿæ•ˆã€‚ rabbitmq-env.conf å˜é‡ rabbitmq.conf å¯¹åº”é…ç½® ä¼˜å…ˆçº§ è¯´æ˜ NODE_IP_ADDRESS listeners.tcp.default = &lt;IP&gt; rabbitmq.conf åªè¦åœ¨ rabbitmq.conf é‡Œé…ç½®ï¼Œå°±è¦†ç›–ç¯å¢ƒå˜é‡ NODE_PORT listeners.tcp.default = &lt;Port&gt; rabbitmq.conf åŒä¸Šï¼ŒIP å’Œç«¯å£å¯ä»¥ä¸€èµ·é…ç½® NODENAME æ— ç›´æ¥å¯¹åº” rabbitmq-env.conf èŠ‚ç‚¹ååªèƒ½é€šè¿‡ rabbitmq-env.conf æˆ–ç¯å¢ƒå˜é‡è®¾å®š MNESIA_BASE æ— ç›´æ¥å¯¹åº” rabbitmq-env.conf æ•°æ®ç›®å½•åªèƒ½åœ¨å¯åŠ¨å‰è®¾å®š LOG_BASE log.dir = &lt;path&gt; rabbitmq.conf è¿è¡Œæ—¶é…ç½®è¦†ç›–ç¯å¢ƒå˜é‡ CONFIG_FILE æ— ç›´æ¥å¯¹åº” rabbitmq-env.conf è¿™ä¸ªåªå†³å®šåŠ è½½å“ªä¸ª rabbitmq.conf æ–‡ä»¶ USE_LONGNAME æ— ç›´æ¥å¯¹åº” rabbitmq-env.conf èŠ‚ç‚¹åæ˜¯å¦ä½¿ç”¨é•¿ä¸»æœºååªèƒ½å¯åŠ¨å‰å†³å®š RabbitMQ ç¯å¢ƒå˜é‡ rabbitmq-env.conf æ–‡ä»¶å°±æ˜¯ç”¨æ¥å®šä¹‰ç¯å¢ƒå˜é‡çš„ï¼Œä½†è¦æ³¨æ„ï¼Œrabbitmq-env.conf æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ å»æ‰äº† RABBITMQ_ å‰ç¼€ï¼Œä¾‹å¦‚åœ¨ç¯å¢ƒä¸­è®¾ç½®çš„å˜é‡åé€šå¸¸æ˜¯ RABBITMQ_NODENAMEï¼Œä½†åœ¨ rabbitmq-env.conf ä¸­ï¼Œè®¾ç½®å˜é‡æ—¶ä¼šå»æ‰ RABBITMQ_ å‰ç¼€ï¼Œç›´æ¥ä½¿ç”¨ NODENAMEã€‚ 123456789# åœ¨ rabbitmq-env.conf ä¸­é…ç½®NODENAME=rabbit@localhostNODE_PORT=5672LOG_BASE=/var/log/rabbitmq# è€Œåœ¨ç¯å¢ƒä¸­ï¼Œä½ å®é™…è®¾ç½®çš„å˜é‡æ˜¯export RABBITMQ_NODENAME=rabbit@localhostexport RABBITMQ_NODE_PORT=5672export RABBITMQ_LOG_BASE=/var/log/rabbitmq ç¯å¢ƒå˜é‡åç§° æè¿° Linux RPM å®‰è£…çš„é»˜è®¤å€¼ RABBITMQ_BASE åªé’ˆå¯¹ Windows ç³»ç»Ÿã€‚è¯¥åŸºç›®å½•åŒ…å« RabbitMQ æœåŠ¡å™¨çš„æ•°æ®åº“å’Œæ—¥å¿—æ–‡ä»¶çš„å­ç›®å½•ã€‚ æ— ï¼ˆä»…é€‚ç”¨äº Windowsï¼‰ RABBITMQ_CONFIG_FILE é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œæ²¡æœ‰ .config æ‰©å±•åã€‚RabbitMQ æœåŠ¡å™¨ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶æ¥é…ç½®ç»„ä»¶ã€‚ é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ï¼š/etc/rabbitmq/rabbitmq.conf RABBITMQ_GENERATED_CONFIG_DIR RabbitMQ å†™å…¥å…¶ç”Ÿæˆçš„é…ç½®æ–‡ä»¶çš„ç›®å½•ã€‚ é»˜è®¤ç”Ÿæˆè·¯å¾„ï¼š/var/lib/rabbitmq/mnesia RABBITMQ_MNESIA_BASE RabbitMQ æœåŠ¡å™¨èŠ‚ç‚¹æ•°æ®åº“ã€æ¶ˆæ¯å­˜å‚¨å’Œé›†ç¾¤çŠ¶æ€æ–‡ä»¶çš„åŸºç›®å½•ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªã€‚é€šå¸¸ä¼šè¦†ç›– RABBITMQ_MNESIA_DIRã€‚ é»˜è®¤å€¼ï¼š/var/lib/rabbitmq/mnesia RABBITMQ_MNESIA_DIR å­˜å‚¨ RabbitMQ èŠ‚ç‚¹æ•°æ®çš„ç›®å½•ï¼ŒåŒ…å«æ¨¡å¼æ•°æ®åº“ã€æ¶ˆæ¯å­˜å‚¨ã€é›†ç¾¤æˆå‘˜ä¿¡æ¯å’Œå…¶ä»–æŒä¹…èŠ‚ç‚¹çŠ¶æ€ã€‚ é»˜è®¤å€¼ï¼š/var/lib/rabbitmq/mnesia/rabbit@&lt;hostname&gt; RABBITMQ_SCHEMA_DIR RabbitMQ ä¿å­˜æ–°æ ¼å¼é…ç½®æ–‡ä»¶ä½¿ç”¨çš„é…ç½®æ¨¡å¼çš„ç›®å½•ã€‚ é»˜è®¤å€¼ï¼š/etc/rabbitmq RABBITMQ_LOG_BASE è¯¥åŸºç›®å½•åŒ…å« RabbitMQ æœåŠ¡å™¨çš„æ—¥å¿—æ–‡ä»¶ã€‚ é»˜è®¤å€¼ï¼š/var/log/rabbitmq RABBITMQ_LOGS RabbitMQ æœåŠ¡å™¨çš„ Erlang æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚ é»˜è®¤å€¼ï¼š/var/log/rabbitmq/rabbitmq.log RABBITMQ_PLUGINS_DIR RabbitMQ çš„æ’ä»¶ç›®å½•ã€‚è·¯å¾„ç”±ç‰¹å®šæ“ä½œç³»ç»Ÿçš„åˆ†éš”ç¬¦å®šä¹‰ï¼ˆUnix ä½¿ç”¨ :ï¼ŒWindows ä½¿ç”¨ ;ï¼‰ã€‚ é»˜è®¤å€¼ï¼š/usr/lib/rabbitmq/plugins RABBITMQ_PLUGINS_EXPAND_DIR ç”¨äºå±•å¼€å¯ç”¨çš„æ’ä»¶çš„å·¥ä½œç›®å½•ã€‚ç¡®ä¿æœ‰æ•ˆçš„ RabbitMQ ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™è¯»å–å’Œåˆ›å»ºè¯¥ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ é»˜è®¤å€¼ï¼š/var/lib/rabbitmq/mnesia RABBITMQ_ENABLED_PLUGINS_FILE æ˜¾å¼è®°å½•å¯ç”¨çš„æ’ä»¶çš„æ–‡ä»¶ï¼Œå¯ç”¨æˆ–ç¦ç”¨æ’ä»¶æ—¶ä¼šé‡æ–°åˆ›å»ºè¯¥æ–‡ä»¶ã€‚ç¡®ä¿æœ‰æ•ˆçš„ RabbitMQ ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™éšæ—¶è¯»å–ã€å†™å…¥å’Œåˆ›å»ºè¯¥æ–‡ä»¶ã€‚ é»˜è®¤å€¼ï¼š/var/lib/rabbitmq/.enabled_plugins RABBITMQ_PID_FILE ç”¨äº rabbitmqctl çš„è¿›ç¨‹ ID æ–‡ä»¶ã€‚ é»˜è®¤å€¼ï¼š/var/run/rabbitmq/rabbitmq.pid å°è´´å£« å®‰è£…å¥½ RabbitMQ åï¼Œä¸è¦éšä¾¿ä¿®æ”¹ hostnameï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQ çš„æ•°æ®ç›®å½•æ˜¯åŸºäº hostname åˆ›å»ºçš„ï¼Œå¦‚æœä¿®æ”¹äº† hostnameï¼ŒRabbitMQ å°±ä¼šæŒ‡å‘æ–°çš„æ•°æ®ç›®å½• æ•°æ®ç›®å½•é»˜è®¤æ˜¯ /var/lib/rabbitmq/mnesia/rabbit@&lt;hostname&gt; å¦‚æœä¿®æ”¹äº† hostnameï¼Œä½†ä»è¦ä½¿ç”¨åŸæ¥çš„æ•°æ®ç›®å½•ï¼Œå¯ä»¥è®¾ç½® RABBITMQ_MNESIA_DIR ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å‘åŸæ¥çš„æ•°æ®ç›®å½• RabbitMQ ç›¸å…³å‘½ä»¤ æ—¥å¸¸ä½¿ç”¨ä¸­ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ Web ç®¡ç†ç•Œé¢æ“ä½œï¼Œè¿™é‡Œä»…å¯¹å‘½ä»¤è¿›è¡Œç®€è¦ä»‹ç»ã€‚ å‘½ä»¤ ä½œç”¨ï¼ˆç®€è¦ï¼‰ å¸¸ç”¨ç¤ºä¾‹ï¼ˆå…¸å‹ç”¨æ³• + ä¸­æ–‡è¯´æ˜ï¼‰ rabbitmq-defaults å®šä¹‰/æ˜¾ç¤º RabbitMQ å®‰è£…é»˜è®¤ç›®å½•å’Œè¿è¡Œæ—¶å‰ç¼€ ç¼–è¾‘ sbin/rabbitmq-defaults ä¸­ PREFIX/SYS_PREFIXï¼ˆä¿®æ”¹é»˜è®¤ç›®å½•åˆ°ç³»ç»Ÿç›®å½•ï¼‰ rabbitmq-diagnostics å¥åº·æ£€æŸ¥ / è¯Šæ–­å·¥å…·ï¼Œå¯ç”¨äºç›‘æ§ rabbitmq-diagnostics -q pingï¼ˆæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ï¼‰rabbitmq-diagnostics -q statusï¼ˆæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼‰rabbitmq-diagnostics -q check_runningï¼ˆç¡®è®¤èŠ‚ç‚¹è¿è¡Œä¸­ï¼‰ rabbitmq-env rabbitmq-env å…¶å®ä¸æ˜¯ä¸€ä¸ªç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œå•ç‹¬ä½¿ç”¨çš„å·¥å…·ï¼Œè€Œæ˜¯ RabbitMQ æœåŠ¡å¯åŠ¨è„šæœ¬ ä¸­ç”¨æ¥åŠ è½½ RabbitMQ ç¯å¢ƒå˜é‡çš„è„šæœ¬ã€‚ åœ¨ /etc/rabbitmq/rabbitmq-env.conf ä¸­è®¾ç½®ï¼šRABBITMQ_NODENAME=myrabbitï¼ˆè®¾ç½®èŠ‚ç‚¹åï¼‰æˆ–ç”¨ rabbitmq-env è¾“å‡ºæŸ¥çœ‹å®é™…ç¯å¢ƒ rabbitmq-plugins æ’ä»¶ç®¡ç†ï¼šåˆ—å‡º/å¯ç”¨/ç¦ç”¨æ’ä»¶ rabbitmq-plugins listï¼ˆåˆ—å‡ºæ‰€æœ‰æ’ä»¶ï¼‰rabbitmq-plugins enable rabbitmq_managementï¼ˆå¯ç”¨ Web ç®¡ç†æ’ä»¶ï¼‰rabbitmq-plugins disable --offline pluginï¼ˆç¦»çº¿ç¦ç”¨æ’ä»¶ï¼‰ rabbitmq-queues é˜Ÿåˆ—å‰¯æœ¬ç®¡ç†ï¼šrebalance/grow/shrink rabbitmq-queues rebalance all --vhost-pattern &quot;.*&quot; --queue-pattern &quot;.*&quot;ï¼ˆé‡å¹³è¡¡æ‰€æœ‰é˜Ÿåˆ—å‰¯æœ¬ï¼‰rabbitmq-queues add_member --vhost / qname rabbit@nodeï¼ˆä¸ºé˜Ÿåˆ—å¢åŠ èŠ‚ç‚¹å‰¯æœ¬ï¼‰ rabbitmq-server å¯åŠ¨ RabbitMQ èŠ‚ç‚¹ï¼ˆå‰å°/åå°ï¼‰ rabbitmq-serverï¼ˆå‰å°å¯åŠ¨ï¼‰rabbitmq-server -detachedï¼ˆåå°å¯åŠ¨ï¼‰ rabbitmq-upgrade å‡çº§ç›¸å…³æ“ä½œï¼šdrain/æ¢å¤ç­‰ rabbitmq-upgrade drainï¼ˆè®©èŠ‚ç‚¹è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œåœæ­¢æ¥æ”¶æ–°è¿æ¥ï¼‰rabbitmq-upgrade post_upgradeï¼ˆæ‰§è¡Œå‡çº§åæ”¶å°¾æ“ä½œï¼‰rabbitmq-upgrade reviveï¼ˆæ¢å¤ç»´æŠ¤æ¨¡å¼ä¸­çš„èŠ‚ç‚¹ï¼‰ rabbitmqctl æœ€å¸¸ç”¨ç®¡ç†å‘½ä»¤ï¼šç”¨æˆ·ã€é˜Ÿåˆ—ã€é›†ç¾¤ç®¡ç† rabbitmqctl statusï¼ˆæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼‰rabbitmqctl list_queuesï¼ˆåˆ—å‡ºæ‰€æœ‰é˜Ÿåˆ—ï¼‰rabbitmqctl add_user bob s3cr3tï¼ˆæ·»åŠ ç”¨æˆ· bobï¼Œå¯†ç  s3cr3tï¼‰ rabbitmq-streams ç®¡ç† Streamsï¼ˆæµå¼é˜Ÿåˆ—ï¼‰ rabbitmq-streams stream_status --vhost / my-streamï¼ˆæŸ¥çœ‹ my-stream çŠ¶æ€ï¼‰rabbitmq-streams add_replica --vhost / my-stream rabbit@nodeï¼ˆä¸º my-stream å¢åŠ å‰¯æœ¬èŠ‚ç‚¹ï¼‰ æœ€å¸¸ç”¨çš„å‘½ä»¤ rabbitmqctl å‘½ä»¤è‡ªåŠ¨è¡¥å…¨ rabbitmqctl æœ‰ä¸€ä¸ª autocomplete å‚æ•°ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆå‘½ä»¤å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‘½ä»¤æ¥å®ç°å‘½ä»¤è‡ªåŠ¨è¡¥å…¨ vim ~/.bashrc æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 12345678_rabbitmqctl_completion() &#123; local cur opts cur=&quot;$&#123;COMP_WORDS[COMP_CWORD]&#125;&quot; # å½“å‰å…‰æ ‡æ‰€åœ¨å•è¯ opts=$(rabbitmqctl autocomplete &quot;$cur&quot;) # åªä¼ å½“å‰å•è¯ä½œä¸ºå‰ç¼€ COMPREPLY=( $(compgen -W &quot;$&#123;opts&#125;&quot; -- &quot;$cur&quot;) )&#125;complete -F _rabbitmqctl_completion rabbitmqctl å®é™…ä¸Š RabbitMQ çš„å¤§éƒ¨åˆ†å‘½ä»¤éƒ½æœ‰ autocomplete å‚æ•°ï¼Œéƒ½å¯ä»¥è‡ªåŠ¨å®Œæˆå‘½ä»¤å‚æ•° 12345678910111213# å®šä¹‰é€šç”¨è¡¥å…¨å‡½æ•°_rabbitmq_completion() &#123; local cur opts cur=&quot;$&#123;COMP_WORDS[COMP_CWORD]&#125;&quot; # å½“å‰å‘½ä»¤åï¼Œè‡ªåŠ¨åˆ¤æ–­ local cmd=&quot;$&#123;COMP_WORDS[0]&#125;&quot; # ç»™å¯¹åº”å‘½ä»¤ä¼ å½“å‰å‰ç¼€ opts=$($cmd autocomplete &quot;$cur&quot; 2&gt;/dev/null) COMPREPLY=( $(compgen -W &quot;$&#123;opts&#125;&quot; -- &quot;$cur&quot;) )&#125;# ä¸€æ¬¡æ€§ç»‘å®šå¤šä¸ªå‘½ä»¤complete -F _rabbitmq_completion rabbitmqctl rabbitmq-plugins rabbitmq-diagnostics rabbitmq-queues rabbitmq-upgrade æµ‹è¯• 123456# ä½¿è¡¥å…¨ç”Ÿæ•ˆsource ~/.bashrc# tab è¡¥å…¨rabbitmqctl st&lt;TAB&gt;# è¾“å‡ºstart_app status stop stop_app å¸¸ç”¨å‘½ä»¤å‚æ•° rabbitmqctl help è·å–æ‰€æœ‰å‘½ä»¤å‚æ•°çš„ç®€ä»‹ rabbitmqctl help &lt;command&gt; è·å–æŒ‡å®šå‘½ä»¤çš„å¸®åŠ© æ—¥å¸¸ä½¿ç”¨ä¸­åŸºæœ¬éƒ½æ˜¯é€šè¿‡ web æ§åˆ¶å° å®Œæˆï¼Œè¿™é‡Œåªåšäº†è§£ã€‚ 1.èŠ‚ç‚¹ç®¡ç† å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ status æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼ŒåŒ…æ‹¬è¿è¡ŒçŠ¶æ€ã€ç‰ˆæœ¬ã€å†…å­˜ã€é˜Ÿåˆ—æ•°é‡ç­‰ rabbitmqctl status stop åœæ­¢ RabbitMQ èŠ‚ç‚¹ rabbitmqctl stop stop_app åœæ­¢ RabbitMQ åº”ç”¨ï¼ˆä¿ç•™èŠ‚ç‚¹è¿è¡Œï¼‰ rabbitmqctl stop_app start_app å¯åŠ¨ RabbitMQ åº”ç”¨ rabbitmqctl start_app reset é‡ç½® RabbitMQ èŠ‚ç‚¹ï¼Œåˆ é™¤æ‰€æœ‰é˜Ÿåˆ—å’Œæ•°æ®ï¼ˆæ…ç”¨ï¼‰ rabbitmqctl reset force_reset å¼ºåˆ¶é‡ç½®èŠ‚ç‚¹ï¼ˆå³ä½¿åœ¨é›†ç¾¤ä¸­ä¹Ÿä¼šé‡ç½®ï¼‰ rabbitmqctl force_reset 2. ç”¨æˆ·å’Œæƒé™ç®¡ç† å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ list_users åˆ—å‡ºæ‰€æœ‰ç”¨æˆ· rabbitmqctl list_users add_user &lt;user&gt; &lt;password&gt; æ·»åŠ æ–°ç”¨æˆ· rabbitmqctl add_user alice mypassword delete_user &lt;user&gt; åˆ é™¤ç”¨æˆ· rabbitmqctl delete_user alice change_password &lt;user&gt; &lt;password&gt; ä¿®æ”¹ç”¨æˆ·å¯†ç  rabbitmqctl change_password alice newpass list_permissions &lt;user&gt; æŸ¥çœ‹æŸç”¨æˆ·çš„æƒé™ rabbitmqctl list_permissions alice set_permissions -p &lt;vhost&gt; &lt;user&gt; &quot;&lt;conf&gt;&quot; &quot;&lt;write&gt;&quot; &quot;&lt;read&gt;&quot; è®¾ç½®ç”¨æˆ·åœ¨è™šæ‹Ÿä¸»æœºçš„æƒé™ rabbitmqctl set_permissions -p / alice &quot;.*&quot; &quot;.*&quot; &quot;.*&quot; 3. è™šæ‹Ÿä¸»æœºï¼ˆvhostï¼‰ç®¡ç† å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ list_vhosts åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿä¸»æœº rabbitmqctl list_vhosts add_vhost &lt;vhost&gt; æ·»åŠ è™šæ‹Ÿä¸»æœº rabbitmqctl add_vhost my_vhost delete_vhost &lt;vhost&gt; åˆ é™¤è™šæ‹Ÿä¸»æœº rabbitmqctl delete_vhost my_vhost 4. é˜Ÿåˆ—ç®¡ç† é˜Ÿåˆ—å¯ä»¥é€šè¿‡ web æ§åˆ¶å° åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ å®¢æˆ·ç«¯(æ¯”å¦‚Java) åˆ›å»ºï¼Œrabbitmqctl åªèƒ½æŸ¥çœ‹å’Œåˆ é™¤é˜Ÿåˆ— å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ list_queues åˆ—å‡ºé˜Ÿåˆ— rabbitmqctl list_queues list_queues name messages consumers åˆ—å‡ºé˜Ÿåˆ—åŠæ¶ˆæ¯æ•°ã€æ¶ˆè´¹è€…æ•° rabbitmqctl list_queues name messages consumers purge_queue &lt;queue&gt; æ¸…ç©ºé˜Ÿåˆ—æ¶ˆæ¯ rabbitmqctl purge_queue my_queue delete_queue &lt;queue&gt; åˆ é™¤é˜Ÿåˆ— rabbitmqctl delete_queue my_queue 5. äº¤æ¢æœºå’Œç»‘å®š äº¤æ¢æœºå¯ä»¥é€šè¿‡ web æ§åˆ¶å° åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ å®¢æˆ·ç«¯(æ¯”å¦‚Java) åˆ›å»ºï¼Œrabbitmqctl åªèƒ½æŸ¥çœ‹ å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ list_exchanges åˆ—å‡ºäº¤æ¢æœº rabbitmqctl list_exchanges list_bindings åˆ—å‡ºç»‘å®šå…³ç³» rabbitmqctl list_bindings 6. é›†ç¾¤ç®¡ç† å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ cluster_status æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ rabbitmqctl cluster_status join_cluster &lt;node&gt; èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ rabbitmqctl join_cluster rabbit@node1 forget_cluster_node &lt;node&gt; å°†èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤ rabbitmqctl forget_cluster_node rabbit@node2 7. æ—¥å¿—å’Œè°ƒè¯• å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ report è¾“å‡ºèŠ‚ç‚¹è¯Šæ–­æŠ¥å‘Š rabbitmqctl report eval &lt;expression&gt; æ‰§è¡Œ Erlang è¡¨è¾¾å¼ rabbitmqctl eval 'rabbit_mnesia:info().' 8. å…¶ä»–å‘½ä»¤ å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ help æŸ¥çœ‹å¸®åŠ©å‘½ä»¤ rabbitmqctl help version æŸ¥çœ‹ RabbitMQ ç‰ˆæœ¬ rabbitmqctl version authenticate_user &lt;user&gt; &lt;password&gt; éªŒè¯ç”¨æˆ·å¯†ç  rabbitmqctl authenticate_user alice mypassword RabbitMQ HTTP API RabbitMQ çš„ HTTP API æ˜¯ä¸€ä¸ª åŸºäº REST çš„ç®¡ç†æ¥å£ï¼Œä¸»è¦ç”¨äºå¯¹ RabbitMQ çš„ èµ„æºç®¡ç†å’Œç›‘æ§ï¼Œå®ƒæ˜¯ ç®¡ç†æ’ä»¶ rabbitmq_management æä¾›çš„åŠŸèƒ½ã€‚é€šè¿‡ HTTP APIï¼Œä½ å¯ä»¥ä¸ç”¨ rabbitmqctl å°±èƒ½æ“ä½œ RabbitMQã€‚ è¦ä½¿ç”¨ HTTP APIï¼Œä½ éœ€è¦åœ¨ RabbitMQ èŠ‚ç‚¹ä¸Šç¡®ä¿ rabbitmq_management æ’ä»¶å·²ç»å¯åŠ¨ã€‚å‰é¢æˆ‘ä»¬ä»‹ç»web ç®¡ç†æ§åˆ¶å°æ—¶å·²ç»å¯åŠ¨äº†è¯¥æ’ä»¶ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ å®é™…ä¸Š Webç®¡ç†æ§åˆ¶å° å°±æ˜¯é€šè¿‡å‘é€ AJAX è¯·æ±‚åˆ° /api/â€¦ æ¥å£æ¥è·å–æ•°æ®å’Œæ‰§è¡Œæ“ä½œã€‚ è¿™é‡Œæœ‰ HTTP API çš„è¯¦ç»†è¯´æ˜ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚ rabbitmqadmin rabbitmqadmin æ˜¯ ç®¡ç†æ’ä»¶ rabbitmq_management æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† RabbitMQ çš„èµ„æºï¼Œå¦‚åˆ›å»ºé˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»ã€æŸ¥çœ‹é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»ç­‰ã€‚ rabbitmqadmin æ˜¯ä¸€ä¸ªä½¿ç”¨ HTTP API çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ‰€ä»¥åº•å±‚å®é™…ä¸Šæ˜¯è°ƒç”¨äº† HTTP API ã€‚ ä¸‹è½½åœ°å€ 12345678910111213# ä¸‹è½½sudo wget -O /usr/local/bin/rabbitmqadmin https://github.com/rabbitmq/rabbitmqadmin-ng/releases/download/v2.10.0/rabbitmqadmin-2.10.0-x86_64-unknown-linux-gnu# è®¾ç½®æƒé™sudo chmod +x /usr/local/bin/rabbitmqadmin# æŸ¥çœ‹å¸®åŠ©rabbitmqadmin help# æŸ¥çœ‹å­å‘½ä»¤å¸®åŠ©rabbitmqadmin help &lt;command&gt;## ç¤ºä¾‹# æŸ¥çœ‹ é˜Ÿåˆ— å¸®åŠ©rabbitmqadmin help queues# æŸ¥çœ‹ é˜Ÿåˆ—å£°æ˜ å¸®åŠ©ï¼Œå­å­å‘½ä»¤rabbitmqadmin help queues declare rabbitmqadmin çš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯å› ä¸ºHTTP APIæ•…æ„æ²¡æœ‰å…¬å¼€æŸäº›æ“ä½œï¼Œæ‰€ä»¥å…¶ä¸èƒ½æ›¿ä»£ rabbitmqctl æˆ– rabbitmq-pluginsç­‰å‘½ä»¤ã€‚ å› ä¸ºå®é™…ä½¿ç”¨ä¸­å¾ˆå°‘ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œï¼Œæ‰€ä»¥è¿™é‡Œåªåšç®€å•ä»‹ç»ã€‚ä¸Šæ–‡æåˆ°äº† rabbitmqctl ä¸æ”¯æŒå£°æ˜(åˆ›å»º) äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼Œè¿™ä¸ªé€šè¿‡ rabbitmqadmin å®ç° 12345678# åˆ›å»ºè™šæ‹Ÿä¸»æœºrabbitmqadmin vhosts declare --name &quot;my-vhost&quot; --default-queue-type &quot;quorum&quot; --description &quot;Used to test&quot;# å£°æ˜é˜Ÿåˆ—rabbitmqadmin queues declare --vhost &quot;my-vhost&quot; --name &quot;target.classic.queue.name&quot; --type &quot;classic&quot; --durable true --auto-delete false# å£°æ˜äº¤æ¢æœºrabbitmqadmin exchanges declare --vhost &quot;my-vhost&quot; --name &quot;target.direct.exchange.name&quot; --type &quot;direct&quot; --durable true --auto-delete false# ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºrabbitmqadmin bindings declare --vhost &quot;my-vhost&quot; --source &quot;target.direct.exchange.name&quot; --destination &quot;target.classic.queue.name&quot; --destination-type &quot;queue&quot; --routing-key &quot;target.routing.key&quot; è¿˜æœ‰å°±æ˜¯å®šæœŸå¤‡ä»½ RabbitMQ çš„ç»“æ„æ•°æ®(ä¸åŒ…æ‹¬æ¶ˆæ¯) 1234# å¯¼å‡ºabbitmqadmin definitions export --file backup.json# å¯¼å…¥rabbitmqadmin definitions import --file backup.json RabbitMQ éœ€è¦å¼€æ”¾å“ªäº›ç«¯å£ ç«¯å£å· åè®® ç”¨é€”è¯´æ˜ é»˜è®¤çŠ¶æ€ å®‰å…¨å»ºè®® 5672 AMQP ä¸»å®¢æˆ·ç«¯è¿æ¥ç«¯å£ å¼€æ”¾ å¿…é¡»å¼€æ”¾ï¼Œé™åˆ¶IP 5671 AMQP/SSL TLSåŠ å¯†è¿æ¥ç«¯å£ å…³é—­ å¦‚ä½¿ç”¨TLSåˆ™å¼€æ”¾ 15672 HTTP ç®¡ç†ç•Œé¢ç«¯å£ å…³é—­ å»ºè®®å†…ç½‘è®¿é—® 15671 HTTPS TLSç®¡ç†ç•Œé¢ç«¯å£ å…³é—­ å¦‚ä½¿ç”¨HTTPSåˆ™å¼€æ”¾ 25672 Erlang Distribution é›†ç¾¤èŠ‚ç‚¹é€šä¿¡ å¼€æ”¾ é›†ç¾¤å†…éƒ¨ä½¿ç”¨ 35672-35682 Erlang Distribution é›†ç¾¤èŠ‚ç‚¹å‘ç° å¼€æ”¾ é›†ç¾¤å†…éƒ¨ä½¿ç”¨ 5552 Stream Protocol æµåè®®ç«¯å£,RabbitMQ 3.9+ å…³é—­ ä½¿ç”¨æµåŠŸèƒ½æ—¶å¼€æ”¾ 5551 Stream Protocol/SSL æµåè®®TLSç«¯å£,RabbitMQ 3.9+ å…³é—­ å¦‚ä½¿ç”¨TLSåˆ™å¼€æ”¾ 61613 STOMP STOMPåè®®æ”¯æŒç«¯å£ å…³é—­ å¦‚ä½¿ç”¨STOMPåè®®åˆ™å¼€æ”¾ 61614 STOMP/SSL STOMP TLSåŠ å¯†ç«¯å£ å…³é—­ å¦‚ä½¿ç”¨STOMP over TLSåˆ™å¼€æ”¾ 1883 MQTT MQTTåè®®æ”¯æŒç«¯å£ å…³é—­ å¦‚ä½¿ç”¨MQTTåè®®åˆ™å¼€æ”¾ 8883 MQTT/SSL MQTT TLSåŠ å¯†ç«¯å£ å…³é—­ å¦‚ä½¿ç”¨MQTT over TLSåˆ™å¼€æ”¾ 15674 Web STOMP WebSocket STOMPæ”¯æŒç«¯å£ å…³é—­ å¦‚ä½¿ç”¨Web STOMPåˆ™å¼€æ”¾ 15675 Web MQTT WebSocket MQTTæ”¯æŒç«¯å£ å…³é—­ å¦‚ä½¿ç”¨Web MQTTåˆ™å¼€æ”¾","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ RabbitMQ çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ RabbitMQ ç‰ˆæœ¬ä¸º 4.1.4ã€‚ Java Client ç¤ºä¾‹","date_published":"2025-09-18T13:30:05.000Z","tags":["æŠ€æœ¯","rabbitmq","åˆ†å¸ƒå¼","rabbitmq"]},{"id":"https://blog.hanqunfeng.com/2025/09/15/zookeeper-study/","url":"https://blog.hanqunfeng.com/2025/09/15/zookeeper-study/","title":"Zookeeper çš„å®‰è£…åŠä½¿ç”¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://zookeeper.apache.org\">Zookeeperå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä½¿ç”¨çš„ Zookeeper ç‰ˆæœ¬ä¸º 3.8.4ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Zookeeper-ç®€ä»‹\">Zookeeper ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper æ˜¯ä¸€ä¸ªé›†ä¸­å¼æœåŠ¡ï¼Œç”¨äºï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>ZooKeeper å®˜æ–¹åŠŸèƒ½</th>\n<th>ä¸»è¦èŠ‚ç‚¹ç±»å‹</th>\n<th>å…·ä½“åœºæ™¯ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>é…ç½®ä¸­å¿ƒ (Config Center)</td>\n<td>ç»´æŠ¤é…ç½®ä¿¡æ¯ (Configuration Management)</td>\n<td>æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰</td>\n<td>æŠŠæ•°æ®åº“è¿æ¥ä¿¡æ¯ã€ç³»ç»Ÿå‚æ•°ç­‰æ”¾åœ¨ ZooKeeper é‡Œï¼ŒåŠ¨æ€æ›´æ–°ï¼Œåƒ Apolloã€Spring Cloud Config ä¸€æ ·ã€‚</td>\n</tr>\n<tr>\n<td>æ³¨å†Œä¸­å¿ƒ (Service Registry)</td>\n<td>æä¾›å‘½åæœåŠ¡ (Naming Service)</td>\n<td>ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEphemeralï¼‰</td>\n<td>æœåŠ¡å®ä¾‹å¯åŠ¨æ—¶åœ¨ ZooKeeper é‡Œæ³¨å†Œè‡ªå·±çš„åœ°å€ï¼Œå®¢æˆ·ç«¯ä» ZooKeeper è·å–æœåŠ¡åˆ—è¡¨ï¼Œç±»ä¼¼äº Nacosã€Eurekaã€‚</td>\n</tr>\n<tr>\n<td>åˆ†å¸ƒå¼é” (Distributed Lock)</td>\n<td>åˆ†å¸ƒå¼åŒæ­¥ (Distributed Synchronization)</td>\n<td>ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEphemeral Sequentialï¼‰</td>\n<td>ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨æ‰§è¡Œå…³é”®ä»»åŠ¡ï¼Œå…¸å‹åº”ç”¨æ˜¯åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚</td>\n</tr>\n<tr>\n<td>æ¶ˆæ¯é˜Ÿåˆ— (Message Queue)</td>\n<td>é›†ç¾¤ç®¡ç†æœåŠ¡ (Cluster Management)</td>\n<td>æŒä¹…/ä¸´æ—¶èŠ‚ç‚¹ + Watch æœºåˆ¶</td>\n<td>é€šè¿‡ Watch æœºåˆ¶ç›‘å¬ ZNode å˜åŒ–ï¼ŒèŠ‚ç‚¹é—´ç”¨æ•°æ®å˜æ›´å½“â€œä¿¡å·â€ä¼ é€’æ¶ˆæ¯ï¼Œæ—©æœŸ Kafka ç”¨è¿‡è¿™ç§æ–¹å¼ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ª ZNodeã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸åŒäºæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä¿å­˜æ•°æ®ï¼Œæ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ 1MB çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬(version)ï¼Œç‰ˆæœ¬ä»0å¼€å§‹è®¡æ•°ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/QgdBSR.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"Zookeeper-å®‰è£…\">Zookeeper å®‰è£…</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œ Zookeeper éœ€è¦å®‰è£… JDK1.8+ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ <a href=\"https://mirrors.tuna.tsinghua.edu.cn/Adoptium/\">OpenJDK11</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /usr/local/jdk</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/jdk</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> wget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">ln</span> -s jdk-11.0.28+6 jdk11</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">vim /etc/profile <span class=\"comment\"># æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class=\"line\">  <span class=\"built_in\">export</span> JAVA_HOME=/usr/local/jdk/jdk11</span><br><span class=\"line\">  <span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"comment\"># ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹javaç‰ˆæœ¬</span></span><br><span class=\"line\">java -version</span><br><span class=\"line\">openjdk version <span class=\"string\">&quot;11.0.28&quot;</span> 2025-07-15</span><br><span class=\"line\">OpenJDK Runtime Environment Temurin-11.0.28+6 (build 11.0.28+6)</span><br><span class=\"line\">OpenJDK 64-Bit Server VM Temurin-11.0.28+6 (build 11.0.28+6, mixed mode)</span><br></pre></td></tr></table></figure>\n<h3 id=\"å•æœºå®‰è£…\">å•æœºå®‰è£…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://zookeeper.apache.org/releases.html\">ä¸‹è½½ Zookeeper</a>ï¼Œç›®å‰æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ä¸º <code>3.8.4</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½</span></span><br><span class=\"line\">wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz</span><br><span class=\"line\"><span class=\"comment\"># è§£å‹</span></span><br><span class=\"line\">tar -zxvf apache-zookeeper-3.8.4-bin.tar.gz</span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ä¸ªè½¯è¿æ¥ï¼Œæ–¹ä¾¿ä»¥åå‡çº§</span></span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s apache-zookeeper-3.8.4-bin zookeeper</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> zookeeper/conf</span><br><span class=\"line\"><span class=\"built_in\">cp</span> zoo_sample.cfg zoo.cfg</span><br><span class=\"line\"><span class=\"comment\"># å»ºè®®ä¿®æ”¹ zoo.cfg é…ç½®æ–‡ä»¶ï¼Œå°† dataDir=/tmp/zookeeper ä¿®æ”¹ä¸ºæŒ‡å®šçš„dataç›®å½•</span></span><br><span class=\"line\">vim zoo.cfg</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>zoo.cfg å‚æ•°è¯´æ˜</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>é…ç½®é¡¹</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼</th>\n<th>å•ä½ / å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>tickTime</strong></td>\n<td>ZooKeeper æ—¶é—´é…ç½®ä¸­çš„åŸºæœ¬å•ä½</td>\n<td>2000</td>\n<td>æ¯«ç§’</td>\n</tr>\n<tr>\n<td><strong>initLimit</strong></td>\n<td>follower åˆå§‹åŒ–è¿æ¥åˆ° leader çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•°</td>\n<td>10</td>\n<td>10 Ã— tickTime = 20000 ms</td>\n</tr>\n<tr>\n<td><strong>syncLimit</strong></td>\n<td>follower ä¸ leader æ•°æ®åŒæ­¥çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•°</td>\n<td>5</td>\n<td>5 Ã— tickTime = 10000 ms</td>\n</tr>\n<tr>\n<td><strong>dataDir</strong></td>\n<td>æ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•ï¼ˆæœªæŒ‡å®š dataLogDir æ—¶ï¼Œæ—¥å¿—ä¹Ÿä¼šä¿å­˜åœ¨æ­¤ç›®å½•ï¼‰</td>\n<td>/tmp/zookeeper</td>\n<td>ç›®å½•è·¯å¾„</td>\n</tr>\n<tr>\n<td><strong>clientPort</strong></td>\n<td>å®¢æˆ·ç«¯è¿æ¥ ZooKeeper çš„ç«¯å£å·</td>\n<td>2181</td>\n<td>é»˜è®¤ 2181</td>\n</tr>\n<tr>\n<td><strong>maxClientCnxns</strong></td>\n<td>å•ä¸ªå®¢æˆ·ç«¯æœ€å¤§å¹¶å‘è¿æ¥æ•°</td>\n<td>60</td>\n<td>è¶…è¿‡é™åˆ¶åæ–°è¿æ¥ä¼šè¢«æ‹’ç»</td>\n</tr>\n<tr>\n<td><strong>autopurge.snapRetainCount</strong></td>\n<td>å¿«ç…§æ–‡ä»¶ä¿ç•™ä¸ªæ•°ï¼Œè¶…è¿‡æ•°é‡çš„å°†ä¼šè¢«æ¸…ç†</td>\n<td>3</td>\n<td>é»˜è®¤ 3</td>\n</tr>\n<tr>\n<td><strong>autopurge.purgeInterval</strong></td>\n<td>æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš”æ—¶é—´ï¼Œå•ä½å°æ—¶ï¼Œ0 è¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†</td>\n<td>1</td>\n<td>1 å°æ—¶</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ zookeeper</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> zookeeper</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨</span></span><br><span class=\"line\">bin/zkServer.sh start</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">bin/zkServer.sh start conf/zoo.cfg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœæ­¢</span></span><br><span class=\"line\">bin/zkServer.sh stop</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class=\"line\">bin/zkServer.sh status</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class=\"line\">./bin/zkServer.sh version</span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤å®‰è£…\">é›†ç¾¤å®‰è£…</h3>\n<h4 id=\"ZooKeeper-é›†ç¾¤è§’è‰²\">ZooKeeper é›†ç¾¤è§’è‰²</h4>\n<h5 id=\"1-Leaderï¼ˆé¢†å¯¼è€…ï¼‰\">1. Leaderï¼ˆé¢†å¯¼è€…ï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>èŒè´£ï¼š</strong></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">äº‹åŠ¡è¯·æ±‚ï¼ˆå†™æ“ä½œï¼‰çš„å”¯ä¸€è°ƒåº¦è€…å’Œå¤„ç†è€…ï¼Œä¿è¯é›†ç¾¤äº‹åŠ¡å¤„ç†çš„é¡ºåºæ€§ï¼›</li>\n<li class=\"lvl-4\">é›†ç¾¤å†…éƒ¨å„ä¸ªæœåŠ¡å™¨çš„è°ƒåº¦è€…ï¼›</li>\n<li class=\"lvl-4\">å¯¹äº <code>create</code>ã€<code>setData</code>ã€<code>delete</code> ç­‰å†™æ“ä½œè¯·æ±‚ï¼Œç»Ÿä¸€è½¬å‘ç»™ Leader å¤„ç†ï¼›</li>\n<li class=\"lvl-4\">Leader è´Ÿè´£å†³å®šç¼–å·ã€æ‰§è¡Œæ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º <strong>äº‹åŠ¡</strong>ã€‚</li>\n</ul>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‰å°è™šæ‹Ÿæœº zoo.cfg æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é€‰ä¸¾å‡º Leader è§’è‰²ï¼Œåˆ™å…¶ä½™å°±æ˜¯ Follower è§’è‰²ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.1=10.250.0.229:2888:3888</span><br><span class=\"line\">server.2=10.250.0.152:2888:3888</span><br><span class=\"line\">server.3=10.250.0.36:2888:3888</span><br></pre></td></tr></table></figure>\n<h5 id=\"2-Followerï¼ˆè·Ÿéšè€…ï¼‰\">2. Followerï¼ˆè·Ÿéšè€…ï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>èŒè´£ï¼š</strong></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡ï¼ˆè¯»æ“ä½œï¼‰è¯·æ±‚ï¼ˆå¯ä»¥ç›´æ¥å“åº”ï¼‰ï¼›</li>\n<li class=\"lvl-4\">è½¬å‘äº‹åŠ¡è¯·æ±‚ç»™ Leaderï¼›</li>\n<li class=\"lvl-4\">å‚ä¸é›†ç¾¤ Leader é€‰ä¸¾æŠ•ç¥¨ã€‚</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>leaderèŠ‚ç‚¹å¯ä»¥å¤„ç†è¯»å†™è¯·æ±‚ï¼Œfolloweråªå¯ä»¥å¤„ç†è¯»è¯·æ±‚ã€‚followeråœ¨æ¥åˆ°å†™è¯·æ±‚æ—¶ä¼šæŠŠå†™è¯·æ±‚è½¬å‘ç»™leaderæ¥å¤„ç†ã€‚</p>\n</blockquote>\n<h5 id=\"3-Observerï¼ˆè§‚å¯Ÿè€…ï¼‰\">3. Observerï¼ˆè§‚å¯Ÿè€…ï¼‰</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>èŒè´£ï¼š</strong></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¯¹äºéäº‹åŠ¡è¯·æ±‚ï¼ˆè¯»æ“ä½œï¼‰å¯ä»¥ç‹¬ç«‹å¤„ç†ï¼›</li>\n<li class=\"lvl-4\">å¯¹äºäº‹åŠ¡è¯·æ±‚ä¼šè½¬å‘ç»™ Leader å¤„ç†ï¼›</li>\n<li class=\"lvl-4\">æ¥æ”¶æ¥è‡ª Leader çš„ <code>inform</code> ä¿¡æ¯ï¼Œæ›´æ–°æœ¬åœ°å­˜å‚¨ï¼›</li>\n<li class=\"lvl-4\">ä¸å‚ä¸æäº¤å’Œé€‰ä¸¾æŠ•ç¥¨ï¼›</li>\n<li class=\"lvl-4\">é€šå¸¸ç”¨äº <strong>æå‡é›†ç¾¤éäº‹åŠ¡å¤„ç†èƒ½åŠ›</strong>ï¼Œä¸å½±å“é›†ç¾¤äº‹åŠ¡å¤„ç†æ€§èƒ½ã€‚</li>\n</ul>\n</li>\n</ul>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®ä¸€ä¸ª ID ä¸º 4 çš„è§‚å¯Ÿè€…èŠ‚ç‚¹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.4=10.250.0.56:2888:3888:observer</span><br></pre></td></tr></table></figure>\n<h4 id=\"é›†ç¾¤æ­å»º\">é›†ç¾¤æ­å»º</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¯å¢ƒå‡†å¤‡ï¼š4å°æœåŠ¡å™¨ï¼ŒæŒ‰ç…§ <code>å•æœºå®‰è£…</code> çš„æ–¹å¼å‡†å¤‡å¥½ Zookeeper ç¯å¢ƒ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">10.250.0.229</span><br><span class=\"line\">10.250.0.152</span><br><span class=\"line\">10.250.0.36</span><br><span class=\"line\">10.250.0.56</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>zoo.cfg</code> æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.1=10.250.0.229:2888:3888</span><br><span class=\"line\">server.2=10.250.0.152:2888:3888</span><br><span class=\"line\">server.3=10.250.0.36:2888:3888</span><br><span class=\"line\">server.4=10.250.0.56:2888:3888:observer</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«åœ¨ <code>dataDir</code> ç›®å½•ä¸‹åˆ›å»º <code>myid</code> æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸ server å¯¹åº”çš„ç¼–å·ï¼ˆæ³¨æ„ï¼šä¸Šä¸‹ä¸è¦æœ‰ç©ºè¡Œï¼Œå·¦å³ä¸è¦æœ‰ç©ºæ ¼ï¼‰</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„ èŠ‚ç‚¹ç¼–å·ä¸èƒ½é‡å¤ï¼Œè€Œä¸”è¦ä¸ zoo.cfg æ–‡ä»¶ä¸­çš„ server.id ä¸€è‡´</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> 1 &gt; myid</span><br><span class=\"line\"><span class=\"comment\"># echo 2 &gt; myid</span></span><br><span class=\"line\"><span class=\"comment\"># echo 3 &gt; myid</span></span><br><span class=\"line\"><span class=\"comment\"># echo 4 &gt; myid</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åˆ«å¯åŠ¨ Zookeeper æœåŠ¡å™¨</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ†åˆ«å¯åŠ¨4ä¸ªèŠ‚ç‚¹çš„zookeeper server</span></span><br><span class=\"line\">bin/zkServer.sh start</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°èŠ‚ç‚¹è§’è‰²ç±»å‹</span></span><br><span class=\"line\">bin/zkServer.sh status</span><br></pre></td></tr></table></figure>\n<h4 id=\"é›†ç¾¤æœ€å°‘èŠ‚ç‚¹è¦æ±‚å’Œæ‰©å®¹è§„åˆ™\">é›†ç¾¤æœ€å°‘èŠ‚ç‚¹è¦æ±‚å’Œæ‰©å®¹è§„åˆ™</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper ä½¿ç”¨ å¤šæ•°æ´¾ï¼ˆquorumï¼‰æœºåˆ¶ æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.é›†ç¾¤æ€»èŠ‚ç‚¹æ•° N</span><br><span class=\"line\">2.å®¹å¿çš„å®•æœºèŠ‚ç‚¹æ•° F = (N-1)/2ï¼ˆå‘ä¸‹å–æ•´ï¼‰</span><br><span class=\"line\">3.è¦ä¿è¯é›†ç¾¤å¯ç”¨ï¼Œéœ€è¦ å¤§äº N/2 çš„èŠ‚ç‚¹å­˜æ´»</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤æ‰©å®¹è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.èŠ‚ç‚¹æ€»æ•°å¿…é¡»æ˜¯å¥‡æ•°</span><br><span class=\"line\">  å¥‡æ•°èŠ‚ç‚¹å¯ä»¥ä¿è¯å¤šæ•°æ´¾æŠ•ç¥¨æœºåˆ¶æ­£å¸¸</span><br><span class=\"line\">  å¶æ•°èŠ‚ç‚¹ä¸æ¨èï¼Œå®¹é”™èƒ½åŠ›ä¸å¢åŠ ï¼ˆæ¯”å¦‚ 4 å°ï¼Œä»ç„¶åªå®¹å¿ 1 å°å®•æœºï¼‰</span><br><span class=\"line\"></span><br><span class=\"line\">2.æ¯æ¬¡æ‰©å®¹å»ºè®® +2 èŠ‚ç‚¹</span><br><span class=\"line\">  è¿™æ ·æ—¢ä¿æŒå¥‡æ•°ï¼Œåˆå¢åŠ  quorum å®¹é”™èƒ½åŠ›</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ€å°‘èŠ‚ç‚¹ä¸å®¹é”™èƒ½åŠ›è¡¨æ ¼</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é›†ç¾¤æ€»èŠ‚ç‚¹æ•° N</th>\n<th>å®¹å¿å®•æœºæ•° F</th>\n<th>å¯ç”¨ quorum èŠ‚ç‚¹æ•°</th>\n<th>å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>0</td>\n<td>1</td>\n<td>ä¸æ¨èï¼Œæ— æ³•å®¹å¿æ•…éšœ</td>\n</tr>\n<tr>\n<td>2</td>\n<td>0</td>\n<td>2</td>\n<td>ä¸æ¨èï¼Œ1 å°å®•æœºå°±ä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td>3</td>\n<td>1</td>\n<td>2</td>\n<td>æœ€å°å¯ç”¨ç”Ÿäº§é›†ç¾¤</td>\n</tr>\n<tr>\n<td>5</td>\n<td>2</td>\n<td>3</td>\n<td>æ¨èç”Ÿäº§é›†ç¾¤è§„æ¨¡</td>\n</tr>\n<tr>\n<td>7</td>\n<td>3</td>\n<td>4</td>\n<td>é«˜å¯ç”¨å¤§é›†ç¾¤</td>\n</tr>\n<tr>\n<td>9</td>\n<td>4</td>\n<td>5</td>\n<td>æ›´å¤§é›†ç¾¤ï¼Œé«˜å®¹é”™</td>\n</tr>\n<tr>\n<td>11</td>\n<td>5</td>\n<td>6</td>\n<td>æé«˜å¯ç”¨åœºæ™¯</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ZooKeeper-é»˜è®¤ç«¯å£è¯´æ˜\">ZooKeeper é»˜è®¤ç«¯å£è¯´æ˜</h2>\n<table>\n<thead>\n<tr>\n<th>ç«¯å£</th>\n<th>ç”¨é€”</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2181</td>\n<td>å®¢æˆ·ç«¯è¿æ¥ç«¯å£</td>\n<td>å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªç«¯å£è®¿é—® ZooKeeper</td>\n</tr>\n<tr>\n<td>2888</td>\n<td>é›†ç¾¤å†…éƒ¨é€šä¿¡</td>\n<td>follower ä¸ leader ä¹‹é—´åŒæ­¥æ•°æ®</td>\n</tr>\n<tr>\n<td>3888</td>\n<td>leader é€‰ä¸¾ç«¯å£</td>\n<td>é›†ç¾¤é€‰ä¸¾ leader ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>8080 (å¯é€‰)</td>\n<td>admin/metrics webç«¯å£</td>\n<td>å¦‚æœå¼€å¯äº† adminServer</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ°¸ä¹…å¼€å¯ç«¯å£</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=2181/tcp</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=2888/tcp</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=3888/tcp</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½¿ç”¨ adminServer</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --permanent --add-port=8080/tcp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --reload</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ˜¯å¦å¼€æ”¾æˆåŠŸ</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --list-all</span><br></pre></td></tr></table></figure>\n<h2 id=\"å®¢æˆ·ç«¯è¿æ¥\">å®¢æˆ·ç«¯è¿æ¥</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œ</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é»˜è®¤è¿æ¥ 127.0.0.1:2181</span></span><br><span class=\"line\">bin/zkCli.sh</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®š -server ip:portï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œåˆ™è¿æ¥ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒZooKeeper ä¼šè‡ªåŠ¨å¤„ç†ä¸ Leader/Follower çš„äº¤äº’</span></span><br><span class=\"line\">bin/zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>å®¢æˆ·ç«¯å‘½ä»¤ç®€ä»‹ï¼š<a href=\"https://zookeeper.apache.org/doc/r3.8.4/zookeeperCLI.html\">å‚è€ƒå®˜ç½‘</a></p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>è¯­æ³•ç¤ºä¾‹</th>\n<th>åŠŸèƒ½æè¿°</th>\n<th>å¸¸ç”¨å‚æ•°åŠè¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>help</strong></td>\n<td><code>help</code></td>\n<td>æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤</td>\n<td>æ— </td>\n<td><code>help</code></td>\n</tr>\n<tr>\n<td><strong>version</strong></td>\n<td><code>version</code></td>\n<td>æŸ¥çœ‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯</td>\n<td>æ— </td>\n<td><code>version</code></td>\n</tr>\n<tr>\n<td><strong>connect</strong></td>\n<td><code>connect host:port</code></td>\n<td>è¿æ¥åˆ°æŒ‡å®š ZooKeeper æœåŠ¡å™¨</td>\n<td><code>host:port</code>: æœåŠ¡å™¨åœ°å€</td>\n<td><code>connect 127.0.0.1:2181</code></td>\n</tr>\n<tr>\n<td><strong>close</strong></td>\n<td><code>close</code></td>\n<td>å…³é—­å½“å‰ä¼šè¯ ,é€šè¿‡ <code>connect</code> å¯é‡è¿</td>\n<td>æ— </td>\n<td><code>close</code></td>\n</tr>\n<tr>\n<td><strong>quit</strong></td>\n<td><code>quit</code></td>\n<td>é€€å‡ºå®¢æˆ·ç«¯</td>\n<td>æ— </td>\n<td><code>quit</code></td>\n</tr>\n<tr>\n<td><strong>ls</strong></td>\n<td><code>ls [-s] [-w] [-R] path</code></td>\n<td>æŸ¥çœ‹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</td>\n<td>- <code>-w</code>: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–<br>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-R</code>: é€’å½’æŸ¥çœ‹</td>\n<td><code>ls -s -w /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>getAllChildrenNumber</strong></td>\n<td><code>getAllChildrenNumber path</code></td>\n<td>è·å–æŸèŠ‚ç‚¹æ‰€æœ‰å­èŠ‚ç‚¹çš„æ€»æ•°</td>\n<td>æ— </td>\n<td><code>getAllChildrenNumber /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>getEphemerals</strong></td>\n<td><code>getEphemerals path</code></td>\n<td>è·å–æŸè·¯å¾„ä¸‹æ‰€æœ‰ä¸´æ—¶èŠ‚ç‚¹</td>\n<td>æ— </td>\n<td><code>getEphemerals /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>create</strong></td>\n<td><code>create [-s] [-e] [-c] [-t ttl] path [data] [acl]</code></td>\n<td>åˆ›å»ºèŠ‚ç‚¹</td>\n<td>- <code>-s</code>: é¡ºåºèŠ‚ç‚¹<br>- <code>-e</code>: ä¸´æ—¶èŠ‚ç‚¹<br>- <code>-c</code>: å®¹å™¨èŠ‚ç‚¹<br>- <code>-t ttl</code>: TTLèŠ‚ç‚¹ï¼Œå•ä½æ¯«ç§’</td>\n<td><code>create -e /zk_test_ephemeral &quot;temp_data&quot;</code></td>\n</tr>\n<tr>\n<td><strong>get</strong></td>\n<td><code>get [-s] [-w] path</code></td>\n<td>è·å–èŠ‚ç‚¹æ•°æ®ä¿¡æ¯</td>\n<td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-w</code>: ç›‘å¬èŠ‚ç‚¹å˜åŒ–</td>\n<td><code>get -s -w /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>set</strong></td>\n<td><code>set [-s] [-v version] path data</code></td>\n<td>è®¾ç½®èŠ‚ç‚¹æ•°æ®</td>\n<td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-v</code>: æŒ‡å®šç‰ˆæœ¬å·</td>\n<td><code>set /zk_test &quot;new_data&quot;</code></td>\n</tr>\n<tr>\n<td><strong>stat</strong></td>\n<td><code>stat [-w] path</code></td>\n<td>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</td>\n<td>- <code>-w</code>: ç›‘å¬èŠ‚ç‚¹å˜åŒ–</td>\n<td><code>stat -w /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>sync</strong></td>\n<td><code>sync path</code></td>\n<td>åŒæ­¥æŒ‡å®šèŠ‚ç‚¹æ•°æ®</td>\n<td>æ— </td>\n<td><code>sync /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>delete</strong></td>\n<td><code>delete [-v version] path</code></td>\n<td>åˆ é™¤æŸä¸€èŠ‚ç‚¹ï¼ˆæ— å­èŠ‚ç‚¹ï¼‰</td>\n<td>- <code>-v</code>: èŠ‚ç‚¹ç‰ˆæœ¬å·</td>\n<td><code>delete /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>deleteall</strong></td>\n<td><code>deleteall path</code></td>\n<td>é€’å½’åˆ é™¤æŸä¸€èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹</td>\n<td>æ— </td>\n<td><code>deleteall /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>getAcl</strong></td>\n<td><code>getAcl [-s] path</code></td>\n<td>è·å–èŠ‚ç‚¹è®¿é—®æ§åˆ¶ä¿¡æ¯</td>\n<td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</td>\n<td><code>getAcl /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>setAcl</strong></td>\n<td><code>setAcl [-s] [-v version] [-R] path acl</code></td>\n<td>è®¾ç½®èŠ‚ç‚¹è®¿é—®æ§åˆ¶åˆ—è¡¨</td>\n<td>- <code>-s</code>: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯<br>- <code>-v</code>: æŒ‡å®šç‰ˆæœ¬å·<br>- <code>-R</code>: é€’å½’è®¾ç½®</td>\n<td><code>setAcl /zk_test world:anyone:r</code></td>\n</tr>\n<tr>\n<td><strong>listquota</strong></td>\n<td><code>listquota path</code></td>\n<td>æŸ¥çœ‹èŠ‚ç‚¹é…é¢ä¿¡æ¯</td>\n<td>æ— </td>\n<td><code>listquota /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>setquota</strong></td>\n<td><code>setquota [-n] [-b] val path</code></td>\n<td>å¯¹èŠ‚ç‚¹å¢åŠ é™åˆ¶</td>\n<td>- <code>-n</code>: å­èŠ‚ç‚¹æœ€å¤§ä¸ªæ•°<br>- <code>-b</code>: æ•°æ®å€¼æœ€å¤§é•¿åº¦ï¼Œ-1 è¡¨ç¤ºæ— é™åˆ¶</td>\n<td><code>setquota -n 5 /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>delquota</strong></td>\n<td><code>delquota [-n                                    | -b] path</code></td>\n<td>åˆ é™¤èŠ‚ç‚¹é…é¢é™åˆ¶</td>\n<td>- <code>-n</code>: åˆ é™¤å­èŠ‚ç‚¹æ•°é™åˆ¶<br>- <code>-b</code>: åˆ é™¤æ•°æ®å€¼å¤§å°é™åˆ¶</td>\n<td><code>delquota -n /zk_test</code></td>\n</tr>\n<tr>\n<td><strong>config</strong></td>\n<td><code>config</code></td>\n<td>æŸ¥çœ‹æœåŠ¡å™¨é…ç½®</td>\n<td>æ— </td>\n<td><code>config</code></td>\n</tr>\n<tr>\n<td><strong>whoami</strong></td>\n<td><code>whoami</code></td>\n<td>æŸ¥çœ‹å½“å‰ä¼šè¯èº«ä»½</td>\n<td>æ— </td>\n<td><code>whoami</code></td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>GUI å·¥å…·</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>ç±»å‹ / è¿è¡Œæ–¹å¼</th>\n<th>ä¼˜ç‚¹</th>\n<th>æ³¨æ„äº‹é¡¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>PrettyZoo</strong></td>\n<td>æ¡Œé¢åº”ç”¨ï¼ˆJavaFXï¼‰(<a href=\"https://github.com/vran-dev/PrettyZoo\" title=\"vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...\">GitHub</a>)</td>\n<td>æ”¯æŒ Mac/Windows/Linuxï¼Œç•Œé¢å‹å¥½ï¼›æ”¯æŒèŠ‚ç‚¹åˆ›å»º/åˆ é™¤/æ›´æ–°/æŸ¥è¯¢ï¼ŒACL ç®¡ç†ï¼Œå¤š ZK å®ä¾‹ç®¡ç†ï¼ŒSSH éš§é“ç­‰åŠŸèƒ½ã€‚(<a href=\"https://github.com/vran-dev/PrettyZoo\" title=\"vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...\">GitHub</a>)</td>\n<td>é¡¹ç›®å·²ç» archivedï¼Œç»´æŠ¤å¯èƒ½ä¸æ´»è·ƒã€‚æœ€æ–°ç‰ˆå¯èƒ½åœ¨å…¼å®¹æ€§æˆ– Bug ä¿®å¤æ–¹é¢ä¸å¦‚æ´»è·ƒé¡¹ç›®ã€‚ä¹Ÿå¯èƒ½éœ€è¦è‡ªå·±æ„å»ºæˆ–è°ƒè¯•ã€‚(<a href=\"https://github.com/vran-dev/PrettyZoo\" title=\"vran-dev/PrettyZoo: ğŸ˜‰ Pretty nice Zookeeper GUI, Support ...\">GitHub</a>)</td>\n</tr>\n<tr>\n<td><strong>ZooNavigator</strong></td>\n<td>Web ç•Œé¢ + å¯ Docker éƒ¨ç½²æˆ–æœ¬åœ°å¯åŠ¨(<a href=\"https://github.com/elkozmon/zoonavigator\" title=\"elkozmon/zoonavigator: Web-based ZooKeeper UI\">GitHub</a>)</td>\n<td>åŠŸèƒ½ä¸°å¯Œï¼›æ”¯æŒå¤šä¸ª Zookeeper ç‰ˆæœ¬ï¼ˆå¦‚ 3.5.x ï½ 3.9.xï¼‰ï¼›æµè§ˆ / ç¼–è¾‘ /æœç´¢èŠ‚ç‚¹ï¼›å¯¼å…¥å¯¼å‡ºé…ç½®ï¼›æ”¯æŒæµè§ˆå™¨è®¿é—®ï¼Œæ— éœ€æœ¬åœ° heavy GUIã€‚(<a href=\"https://github.com/elkozmon/zoonavigator\" title=\"elkozmon/zoonavigator: Web-based ZooKeeper UI\">GitHub</a>)</td>\n<td>å› ä¸º Web åº”ç”¨ï¼Œå¯èƒ½å¯¹æµè§ˆå™¨å®‰å…¨ç­–ç•¥ä¸ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿï¼›éœ€è¦éƒ¨ç½²è‡ªå·±ç‰ˆæœ¬æˆ– Dockerï¼›å¦‚æœè¦æ±‚æœ¬åœ°è„±æœºæ“ä½œæ—¶ï¼Œæœ‰äº›åŠŸèƒ½å¯èƒ½ç¨ä¸å¦‚æ¡Œé¢åº”ç”¨ã€‚</td>\n</tr>\n<tr>\n<td><strong>ZooKeeper Assistant</strong></td>\n<td>æ¡Œé¢ï¼ç®¡ç†å‘˜é¢æ¿ç±»å‹ï¼ˆæ”¯æŒç›‘æ§ç•Œé¢ç­‰ï¼‰(<a href=\"https://dev.to/redisant/an-exciting-apache-zookeeper-desktop-gui-1fdo\" title=\"An exciting Apache ZooKeeper Desktop GUI\">DEV Community</a>)</td>\n<td>é™¤äº†æµè§ˆèŠ‚ç‚¹æ ‘ä»¥å¤–ï¼Œè¿˜æä¾›å¥åº·çŠ¶æ€ç›‘æ§ï¼ˆå»¶è¿Ÿã€è¯·æ±‚æ•°ç­‰ï¼‰ã€ä¸åŒæ•°æ®æ ¼å¼æ”¯æŒï¼ˆJSON/XML ç­‰ï¼‰ã€å¯¼å…¥/å¯¼å‡ºèŠ‚ç‚¹æ•°æ®ã€å‘½ä»¤è¡Œæ“ä½œé›†æˆã€‚(<a href=\"https://dev.to/redisant/an-exciting-apache-zookeeper-desktop-gui-1fdo\" title=\"An exciting Apache ZooKeeper Desktop GUI\">DEV Community</a>)</td>\n<td>æœ‰äº›åŠŸèƒ½å¯èƒ½åœ¨ Mac ä¸Šå…¼å®¹æ€§æˆ–è§†è§‰ä½“éªŒéœ€è¦è°ƒè¯•ï¼›å…·ä½“ç‰ˆæœ¬æ”¯æŒæƒ…å†µè¦çœ‹æœ€è¿‘æ›´æ–°ã€‚æŸäº›ç›‘æ§ç•Œé¢å¯èƒ½ä¾èµ–äº ZK çš„æŒ‡æ ‡æˆ–æ’ä»¶ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Zookeeper-èŠ‚ç‚¹ç±»å‹\">Zookeeper èŠ‚ç‚¹ç±»å‹</h2>\n<table>\n<thead>\n<tr>\n<th>èŠ‚ç‚¹ç±»å‹</th>\n<th>ç”Ÿå‘½å‘¨æœŸè¯´æ˜</th>\n<th>åˆ›å»ºå‘½ä»¤ç¤ºä¾‹</th>\n<th>ç‰¹ç‚¹è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æŒä¹…èŠ‚ç‚¹</strong> (Persistent)</td>\n<td>èŠ‚ç‚¹ä¸€ç›´å­˜åœ¨ï¼Œé™¤éæ‰‹åŠ¨åˆ é™¤ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ŒèŠ‚ç‚¹ä¹Ÿä¸ä¼šæ¶ˆå¤±</td>\n<td><code>create /locks</code></td>\n<td>é€‚åˆå­˜å‚¨é…ç½®ä¿¡æ¯ã€å…ƒæ•°æ®ç­‰æŒä¹…æ•°æ®</td>\n</tr>\n<tr>\n<td><strong>ä¸´æ—¶èŠ‚ç‚¹</strong> (Ephemeral)</td>\n<td>å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ˆå¼‚å¸¸æˆ–è¶…æ—¶ï¼‰æ—¶ï¼ŒèŠ‚ç‚¹è‡ªåŠ¨è¢«åˆ é™¤</td>\n<td><code>create -e /locks/DBLock</code></td>\n<td>å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€ä¸´æ—¶ä¼šè¯æ•°æ®</td>\n</tr>\n<tr>\n<td><strong>æœ‰åºèŠ‚ç‚¹</strong> (Sequential)</td>\n<td>åœ¨æŒä¹…æˆ–ä¸´æ—¶èŠ‚ç‚¹åŸºç¡€ä¸Šï¼Œå¢åŠ æœ‰åºç¼–å·ï¼ŒZooKeeper è‡ªåŠ¨åœ¨èŠ‚ç‚¹åååŠ é€’å¢åºå·</td>\n<td><code>create -e -s /jobs/job</code></td>\n<td>å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€é˜Ÿåˆ—ç­‰éœ€è¦é¡ºåºçš„åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>å®¹å™¨èŠ‚ç‚¹</strong> (Container)</td>\n<td>V3.5.3+ï¼Œå½“å®¹å™¨èŠ‚ç‚¹ä¸‹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œå®¹å™¨èŠ‚ç‚¹ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤</td>\n<td><code>create -c /work</code></td>\n<td>é€‚åˆåˆ†å¸ƒå¼ä»»åŠ¡ä¸´æ—¶ç›®å½•ã€åŠ¨æ€æ•°æ®ç›®å½•</td>\n</tr>\n<tr>\n<td><strong>TTL èŠ‚ç‚¹</strong> (TTL)</td>\n<td>åœ¨æŒ‡å®š TTL æ—¶é—´å†…æœªä¿®æ”¹ä¸”æ— å­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆéœ€å¼€å¯ <code>extendedTypesEnabled=true</code> é…ç½®ï¼‰</td>\n<td><code>create -t 3000 /ttl_node</code></td>\n<td>é€‚åˆä¸´æ—¶ç¼“å­˜ã€ä¸´æ—¶çŠ¶æ€æ•°æ®ï¼Œè¿‡æœŸè‡ªåŠ¨æ¸…ç†</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åŒä¸€çº§èŠ‚ç‚¹ key åç§°æ˜¯å”¯ä¸€çš„</li>\n<li class=\"lvl-4\">åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå¿…é¡»è¦å¸¦ä¸Šå…¨è·¯å¾„</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[zk: localhost:2181(CONNECTED) 16] <span class=\"built_in\">stat</span> /test</span><br><span class=\"line\">cZxid = 0x100000002                   <span class=\"comment\"># Znodeåˆ›å»ºçš„äº‹åŠ¡id</span></span><br><span class=\"line\">ctime = Mon Sep 15 09:44:51 UTC 2025  <span class=\"comment\"># åˆ›å»ºæ—¶é—´</span></span><br><span class=\"line\">mZxid = 0x100000004                   <span class=\"comment\"># æœ€åä¸€æ¬¡ä¿®æ”¹äº‹åŠ¡id</span></span><br><span class=\"line\">mtime = Mon Sep 15 09:47:12 UTC 2025  <span class=\"comment\"># æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´</span></span><br><span class=\"line\">pZxid = 0x400000004                   <span class=\"comment\"># è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡ä¿®æ”¹çš„äº‹åŠ¡IDï¼Œæ·»åŠ å­èŠ‚ç‚¹æˆ–åˆ é™¤å­èŠ‚ç‚¹å°±ä¼šå½±å“å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œä½†æ˜¯ä¿®æ”¹å­èŠ‚ç‚¹çš„æ•°æ®å†…å®¹åˆ™ä¸å½±å“è¯¥IDï¼ˆæ³¨æ„: åªæœ‰å­èŠ‚ç‚¹åˆ—è¡¨å˜æ›´äº†æ‰ä¼šå˜æ›´pzxidï¼Œå­èŠ‚ç‚¹å†…å®¹å˜æ›´ä¸ä¼šå½±å“pzxidï¼‰</span></span><br><span class=\"line\">cversion = 1                          <span class=\"comment\"># å­èŠ‚ç‚¹çš„ç‰ˆæœ¬å·ã€‚å½“znodeçš„å­èŠ‚ç‚¹æœ‰å˜åŒ–æ—¶ï¼Œcversion çš„å€¼å°±ä¼šå¢åŠ 1ã€‚</span></span><br><span class=\"line\">dataVersion = 1                       <span class=\"comment\"># znodeçš„æ•°æ®ç‰ˆæœ¬å·ã€‚æ¯æ¬¡å¯¹èŠ‚ç‚¹è¿›è¡Œsetæ“ä½œï¼ŒdataVersionçš„å€¼éƒ½ä¼šå¢åŠ 1ï¼ˆå³ä½¿è®¾ç½®çš„æ˜¯ç›¸åŒçš„æ•°æ®ï¼‰ï¼Œå¯æœ‰æ•ˆé¿å…äº†æ•°æ®æ›´æ–°æ—¶å‡ºç°çš„å…ˆåé¡ºåºé—®é¢˜</span></span><br><span class=\"line\">aclVersion = 0                        <span class=\"comment\"># znodeçš„ACLç‰ˆæœ¬å·ã€‚æ¯æ¬¡å¯¹èŠ‚ç‚¹è¿›è¡ŒACLè®¾ç½®ï¼ŒaclVersionçš„å€¼éƒ½ä¼šå¢åŠ 1</span></span><br><span class=\"line\">ephemeralOwner = 0x0                  <span class=\"comment\"># å¦‚æœè¯¥èŠ‚ç‚¹ä¸ºä¸´æ—¶èŠ‚ç‚¹, ephemeralOwnerå€¼è¡¨ç¤ºä¸è¯¥èŠ‚ç‚¹ç»‘å®šçš„session idã€‚å¦‚æœä¸æ˜¯, ephemeralOwnerå€¼ä¸º0(æŒä¹…èŠ‚ç‚¹)ã€‚</span></span><br><span class=\"line\">dataLength = 3                        <span class=\"comment\"># znodeçš„æ•°æ®é•¿åº¦</span></span><br><span class=\"line\">numChildren = 1                       <span class=\"comment\"># znodeçš„å­èŠ‚ç‚¹æ•°é‡ï¼ˆåªç»Ÿè®¡ç›´æ¥å­èŠ‚ç‚¹çš„æ•°é‡ï¼‰</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Zookeeper-ç›‘å¬æœºåˆ¶\">Zookeeper ç›‘å¬æœºåˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>watchæœºåˆ¶ï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªç›‘å¬æœºåˆ¶ã€‚Zookeeperä¸­çš„watchæœºåˆ¶ï¼Œå¿…é¡»å®¢æˆ·ç«¯å…ˆå»æœåŠ¡ç«¯æ³¨å†Œç›‘å¬ï¼Œè¿™æ ·äº‹ä»¶å‘ç”Ÿæ—¶æ‰ä¼šè§¦å‘ç›‘å¬ï¼Œé€šçŸ¥ç»™å®¢æˆ·ç«¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›‘å¬çš„å¯¹è±¡æ˜¯äº‹ä»¶ï¼Œæ”¯æŒçš„äº‹ä»¶ç±»å‹å¦‚ä¸‹ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- None: è¿æ¥å»ºç«‹äº‹ä»¶</span><br><span class=\"line\">- NodeCreatedï¼š èŠ‚ç‚¹åˆ›å»º</span><br><span class=\"line\">- NodeDeletedï¼š èŠ‚ç‚¹åˆ é™¤</span><br><span class=\"line\">- NodeDataChangedï¼šèŠ‚ç‚¹æ•°æ®å˜åŒ–</span><br><span class=\"line\">- NodeChildrenChangedï¼šå­èŠ‚ç‚¹åˆ—è¡¨å˜åŒ–</span><br><span class=\"line\">- DataWatchRemovedï¼šèŠ‚ç‚¹ç›‘å¬è¢«ç§»é™¤</span><br><span class=\"line\">- ChildWatchRemovedï¼šå­èŠ‚ç‚¹ç›‘å¬è¢«ç§»é™¤</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›‘å¬ç‰¹æ€§</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ä¸€æ¬¡æ€§è§¦å‘</strong></td>\n<td>Watch æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸€æ—¦è¢«è§¦å‘å°±ä¼šè¢«ç§»é™¤ã€‚å†æ¬¡ä½¿ç”¨æ—¶éœ€è¦é‡æ–°æ³¨å†Œã€‚</td>\n</tr>\n<tr>\n<td><strong>å®¢æˆ·ç«¯é¡ºåºå›è°ƒ</strong></td>\n<td>Watch å›è°ƒæ˜¯é¡ºåºä¸²è¡Œæ‰§è¡Œçš„ï¼Œå®¢æˆ·ç«¯åªæœ‰åœ¨å›è°ƒå®Œæˆåæ‰èƒ½çœ‹åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚</td>\n</tr>\n<tr>\n<td><strong>è½»é‡çº§</strong></td>\n<td>Watcher å›è°ƒé€»è¾‘ä¸åº”è¿‡å¤šï¼Œä»¥å…é˜»å¡æˆ–å½±å“å…¶ä»– Watch çš„æ‰§è¡Œã€‚</td>\n</tr>\n<tr>\n<td><strong>æœ€å°é€šä¿¡å•ä½</strong></td>\n<td><code>WatchEvent</code> æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼ŒåªåŒ…å«é€šçŸ¥çŠ¶æ€ã€äº‹ä»¶ç±»å‹å’ŒèŠ‚ç‚¹è·¯å¾„ï¼Œä¸åŒ…å«èŠ‚ç‚¹æ•°æ®å˜åŒ–å‰åçš„å…·ä½“å†…å®¹ã€‚</td>\n</tr>\n<tr>\n<td><strong>æ—¶æ•ˆæ€§</strong></td>\n<td>Watcher ä»…åœ¨å½“å‰ Session å®Œå…¨å¤±æ•ˆæ—¶æ‰æ— æ•ˆã€‚å¦‚æœ Session å¿«é€Ÿé‡è¿æˆåŠŸï¼ŒWatcher ä¾ç„¶æœ‰æ•ˆï¼Œå¯ç»§ç»­æ¥æ”¶é€šçŸ¥ã€‚</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥å¼€å¯ç›‘å¬çš„å‘½ä»¤</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#ç›‘å¬èŠ‚ç‚¹æ•°æ®çš„å˜åŒ–</span></span><br><span class=\"line\">get -w path</span><br><span class=\"line\"><span class=\"built_in\">stat</span> -w path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#ç›‘å¬å­èŠ‚ç‚¹å¢å‡çš„å˜åŒ–</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -w path</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ°¸ä¹…æ€§-Watch\">æ°¸ä¹…æ€§ Watch</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨è¢«è§¦å‘ä¹‹åï¼Œä»ç„¶ä¿ç•™ï¼Œå¯ä»¥ç»§ç»­ç›‘å¬ZNodeä¸Šçš„å˜æ›´ï¼Œæ˜¯Zookeeper 3.6.0ç‰ˆæœ¬æ–°å¢çš„åŠŸèƒ½</p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç›‘å¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addWatch [-m mode] path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># mode:</span></span><br><span class=\"line\"><span class=\"comment\"># - PERSISTENT: æŒä¹…åŒ–è®¢é˜…ï¼Œé’ˆå¯¹å½“å‰èŠ‚ç‚¹çš„ä¿®æ”¹å’Œåˆ é™¤äº‹ä»¶ï¼Œä»¥åŠå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„åˆ é™¤å’Œæ–°å¢äº‹ä»¶ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># - PERSISTENT_RECURSIVE: æŒä¹…åŒ–é€’å½’è®¢é˜…(è¿™ä¸ªæ˜¯é»˜è®¤å€¼)ï¼Œåœ¨PERSISTENTçš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†å­èŠ‚ç‚¹ä¿®æ”¹çš„äº‹ä»¶è§¦å‘ï¼Œä»¥åŠå­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„æ•°æ®å˜åŒ–éƒ½ä¼šè§¦å‘ç›¸å…³äº‹ä»¶ï¼ˆæ»¡è¶³é€’å½’è®¢é˜…ç‰¹æ€§ï¼‰</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤ç›‘å¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ™®é€šä¸€æ¬¡æ€§ Watch ä¸éœ€è¦æ‰‹åŠ¨åˆ é™¤ï¼Œè§¦å‘åä¼šè‡ªåŠ¨ç§»é™¤ï¼›removewatches ä¸»è¦ç”¨äºæŒä¹… Watchï¼ˆpersistent watchï¼‰ã€‚</span></span><br><span class=\"line\">removewatches path [-c|-d|-a] [-l]</span><br><span class=\"line\"><span class=\"comment\"># -c: ä»…åˆ é™¤å½“å‰å®¢æˆ·ç«¯çš„ Watch</span></span><br><span class=\"line\"><span class=\"comment\"># -d: åˆ é™¤æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰ Watch(åŒ…æ‹¬å…¶ä»–å®¢æˆ·ç«¯æ³¨å†Œçš„)</span></span><br><span class=\"line\"><span class=\"comment\"># -a: åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹çš„æ‰€æœ‰ Watchï¼ˆåŒ…æ‹¬å…¶ä»–å®¢æˆ·ç«¯çš„ Watchï¼‰ï¼Œæ…ç”¨ï¼ï¼ï¼</span></span><br><span class=\"line\"><span class=\"comment\"># -l: æ˜¾ç¤ºè¢«åˆ é™¤çš„ Watch åˆ—è¡¨</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ç›‘å¬å™¨åº”ç”¨åœºæ™¯\">ç›‘å¬å™¨åº”ç”¨åœºæ™¯</h3>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>ç‰¹ç‚¹</th>\n<th>åº”ç”¨åœºæ™¯ä¸¾ä¾‹</th>\n<th>é€‚åˆçš„èŠ‚ç‚¹ç±»å‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ä¸´æ—¶ç›‘å¬</strong>ï¼ˆä¸€æ¬¡æ€§ Watchï¼‰</td>\n<td>- è§¦å‘ä¸€æ¬¡åè‡ªåŠ¨ç§»é™¤<br>- å®¢æˆ·ç«¯éœ€æ‰‹åŠ¨é‡æ–°æ³¨å†Œ<br>- è½»é‡çº§ï¼Œé€‚åˆå•æ¬¡é€šçŸ¥</td>\n<td>1. <strong>é…ç½®ä¸­å¿ƒ</strong>ï¼šé…ç½®å˜åŒ–æ—¶é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥åé‡æ–°æ‹‰å–æœ€æ–°é…ç½® <br> 2. <strong>åˆ†å¸ƒå¼é”</strong>ï¼šèŠ‚ç‚¹åˆ é™¤ï¼ˆé”é‡Šæ”¾ï¼‰åé€šçŸ¥ç­‰å¾…çš„å®¢æˆ·ç«¯é‡æ–°ç«äº‰é” <br> 3. <strong>ä¸»ä»é€‰ä¸¾</strong>ï¼šä¸»èŠ‚ç‚¹å®•æœºåï¼Œå…¶ä»–èŠ‚ç‚¹æ”¶åˆ°é€šçŸ¥é‡æ–°é€‰ä¸»</td>\n<td><strong>æŒä¹…èŠ‚ç‚¹</strong>ï¼ˆPersistentï¼‰ <br><strong>ä¸´æ—¶èŠ‚ç‚¹</strong>ï¼ˆEphemeralï¼Œç”¨äºé”å’Œé€‰ä¸»ï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ°¸ä¹…ç›‘å¬</strong>ï¼ˆPersistent Watchï¼‰</td>\n<td>- æ³¨å†ŒåæŒç»­æœ‰æ•ˆï¼Œç›´åˆ°å®¢æˆ·ç«¯ä¸»åŠ¨ç§»é™¤<br>- æ”¯æŒå­èŠ‚ç‚¹å˜åŒ–ã€æ•°æ®å˜åŒ–çš„é•¿æœŸç›‘å¬</td>\n<td>1. <strong>æœåŠ¡å‘ç°</strong>ï¼šå®¢æˆ·ç«¯é•¿æœŸç›‘å¬æœåŠ¡èŠ‚ç‚¹å˜åŒ–ï¼ŒèŠ‚ç‚¹ä¸Šçº¿/ä¸‹çº¿æ—¶è‡ªåŠ¨æ›´æ–°æœ¬åœ°æœåŠ¡åˆ—è¡¨ <br> 2. <strong>ç›‘æ§å‘Šè­¦</strong>ï¼šç›‘æ§é‡è¦èŠ‚ç‚¹çŠ¶æ€ï¼ŒèŠ‚ç‚¹æ•°æ®å˜åŒ–æˆ–è¢«åˆ é™¤æ—¶è‡ªåŠ¨è§¦å‘å‘Šè­¦ <br> 3. <strong>åˆ†å¸ƒå¼ç¼“å­˜</strong>ï¼šç¼“å­˜èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œé€šçŸ¥å®¢æˆ·ç«¯åˆ·æ–°ç¼“å­˜</td>\n<td><strong>æŒä¹…èŠ‚ç‚¹</strong>ï¼ˆPersistentï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ACLæƒé™æ§åˆ¶\">ACLæƒé™æ§åˆ¶</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æƒé™éƒ½æ˜¯ <code>OPEN_ACL_UNSAFE</code> ï¼Œä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¯»å†™ä»»æ„èŠ‚ç‚¹æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸éœ€è¦é™åˆ¶å¯¹èŠ‚ç‚¹çš„è®¿é—®æƒé™ï¼Œå³ <code>ACL</code> æƒé™æ§åˆ¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ZooKeeper é‡Œçš„ ACLï¼ˆAccess Control Listï¼Œè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ ä¸»è¦ç”¨äºæ§åˆ¶ è°å¯ä»¥å¯¹æŸä¸ªèŠ‚ç‚¹åšä»€ä¹ˆæ“ä½œï¼Œå®ƒæ˜¯ ZooKeeper æä¾›çš„å®‰å…¨æœºåˆ¶ä¹‹ä¸€ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ACL-çš„ä½œç”¨\">ACL çš„ä½œç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é™åˆ¶è®¿é—®ï¼šåªå…è®¸æˆæƒç”¨æˆ·æˆ–å®¢æˆ·ç«¯å¯¹æŒ‡å®šèŠ‚ç‚¹è¿›è¡Œè¯»ã€å†™ã€åˆ é™¤ç­‰æ“ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é˜²æ­¢è¯¯æ“ä½œï¼šä¿æŠ¤é‡è¦èŠ‚ç‚¹ä¸è¢«æœªæˆæƒçš„å®¢æˆ·ç«¯ä¿®æ”¹æˆ–åˆ é™¤ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰å…¨éš”ç¦»ï¼šä¸åŒçš„åº”ç”¨æˆ–å›¢é˜Ÿå¯ä»¥åœ¨åŒä¸€ ZooKeeper é›†ç¾¤é‡Œå®‰å…¨å…±å­˜ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ACL-çš„ç»„æˆ\">ACL çš„ç»„æˆ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>zookeeper çš„ acl é€šè¿‡ <code>scheme:id:permissions</code> æ¥æ„æˆæƒé™åˆ—è¡¨ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">schemeï¼šæˆæƒçš„æ¨¡å¼ï¼Œä»£è¡¨é‡‡ç”¨çš„æŸç§æƒé™æœºåˆ¶ï¼ŒåŒ…æ‹¬ worldã€authã€digestã€ipã€super å‡ ç§ã€‚</li>\n<li class=\"lvl-4\">idï¼šæˆæƒå¯¹è±¡ï¼Œä»£è¡¨å…è®¸è®¿é—®çš„ç”¨æˆ·ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹©é‡‡ç”¨ IP æ–¹å¼ï¼Œä½¿ç”¨çš„æˆæƒå¯¹è±¡å¯ä»¥æ˜¯ä¸€ä¸ª IP åœ°å€æˆ– IP åœ°å€æ®µï¼›è€Œå¦‚æœä½¿ç”¨ Digest æˆ– Super æ–¹å¼ï¼Œåˆ™å¯¹åº”äºä¸€ä¸ªç”¨æˆ·åã€‚å¦‚æœæ˜¯ World æ¨¡å¼ï¼Œæ˜¯æˆæƒç³»ç»Ÿä¸­æ‰€æœ‰çš„ç”¨æˆ·ã€‚</li>\n<li class=\"lvl-4\">permissionsï¼šæˆæƒçš„æƒé™ï¼Œæƒé™ç»„åˆå­—ç¬¦ä¸²ï¼Œç”± cdrwa ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªå­—æ¯ä»£è¡¨æ”¯æŒä¸åŒæƒé™ï¼Œ åˆ›å»ºæƒé™ createÂ©ã€åˆ é™¤æƒé™ delete(d)ã€è¯»æƒé™ readÂ®ã€å†™æƒé™ write(w)ã€ç®¡ç†æƒé™admin(a)ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å¸¸è§çš„-scheme-ç±»å‹\">å¸¸è§çš„ scheme ç±»å‹</h3>\n<table>\n<thead>\n<tr>\n<th>Scheme</th>\n<th>è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>world</code></td>\n<td>å¼€æ”¾ç»™æ‰€æœ‰ç”¨æˆ·ï¼Œä»…å¯è®¾ç½®ä¸º <code>anyone</code> ä»£è¡¨æ‰€æœ‰å®¢æˆ·ç«¯</td>\n<td><code>world:anyone:r</code></td>\n</tr>\n<tr>\n<td><code>auth</code></td>\n<td>å·²é€šè¿‡ <code>addauth</code> æ·»åŠ è®¤è¯çš„å®¢æˆ·ç«¯</td>\n<td><code>auth:user1:rw</code></td>\n</tr>\n<tr>\n<td><code>digest</code></td>\n<td>ç”¨æˆ·å+å¯†ç è®¤è¯ï¼ˆå¸¸ç”¨ï¼‰ï¼Œ<code>user:pwd</code> éœ€è¦åŠ å¯†å­˜å‚¨</td>\n<td><code>digest:user1:password:rw</code></td>\n</tr>\n<tr>\n<td><code>ip</code></td>\n<td>åŸºäº IP åœ°å€æ§åˆ¶è®¿é—®</td>\n<td><code>ip:192.168.1.10:r</code></td>\n</tr>\n<tr>\n<td><code>super</code></td>\n<td>è¶…çº§ç”¨æˆ·ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™</td>\n<td><code>super:admin:secret</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"æƒé™ç±»å‹\">æƒé™ç±»å‹</h3>\n<table>\n<thead>\n<tr>\n<th>æƒé™å­—ç¬¦</th>\n<th>æƒé™åç§°</th>\n<th>å…è®¸çš„æ“ä½œ/å‘½ä»¤ç¤ºä¾‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><code>r</code></strong></td>\n<td>è¯»å–(Read)</td>\n<td><code>get /node</code> <br> <code>ls /node</code> <br> <code>getAcl /node</code></td>\n<td>å…è®¸è¯»å–èŠ‚ç‚¹æ•°æ®å’Œå­èŠ‚ç‚¹åˆ—è¡¨</td>\n</tr>\n<tr>\n<td><strong><code>w</code></strong></td>\n<td>å†™å…¥(Write)</td>\n<td><code>set /node data</code></td>\n<td>å…è®¸ä¿®æ”¹èŠ‚ç‚¹æ•°æ®</td>\n</tr>\n<tr>\n<td><strong><code>c</code></strong></td>\n<td>åˆ›å»º(Create)</td>\n<td><code>create /node/sub &quot;data&quot;</code></td>\n<td>å…è®¸åœ¨å½“å‰èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹</td>\n</tr>\n<tr>\n<td><strong><code>d</code></strong></td>\n<td>åˆ é™¤(Delete)</td>\n<td><code>delete /node/sub</code></td>\n<td>å…è®¸åˆ é™¤å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</td>\n</tr>\n<tr>\n<td><strong><code>a</code></strong></td>\n<td>ç®¡ç†(Admin)</td>\n<td><code>setAcl /node acl</code></td>\n<td>å…è®¸ä¿®æ”¹ ACL æƒé™</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å…¸å‹åº”ç”¨åœºæ™¯\">å…¸å‹åº”ç”¨åœºæ™¯</h3>\n<table>\n<thead>\n<tr>\n<th>è®¤è¯æ–¹å¼ï¼ˆschemeï¼‰</th>\n<th>æƒé™ç±»å‹ï¼ˆpermissionsï¼‰</th>\n<th>å…¸å‹ ACL é…ç½®ç¤ºä¾‹</th>\n<th>åº”ç”¨åœºæ™¯</th>\n<th>ç‰¹ç‚¹è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>world</strong></td>\n<td><code>r</code>ï¼ˆåªè¯»ï¼‰</td>\n<td><code>world:anyone:r</code></td>\n<td>å…¬å…±é…ç½®èŠ‚ç‚¹ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½å¯è¯»å–</td>\n<td>ç®€å•ã€æ— è®¤è¯ï¼Œé€‚åˆå¯¹å®‰å…¨æ€§è¦æ±‚ä¸é«˜çš„åªè¯»åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong>auth</strong></td>\n<td><code>r,w,c,d,a</code>ï¼ˆå¯ç»„åˆï¼‰</td>\n<td><code>auth:user:rwcd</code></td>\n<td>å†…éƒ¨åº”ç”¨å…±äº«èŠ‚ç‚¹ï¼Œéœ€å®¢æˆ·ç«¯è®¤è¯</td>\n<td>éœ€å…ˆ <code>addauth digest user1:password</code> æ·»åŠ è®¤è¯ï¼Œé€‚åˆå¤šå®¢æˆ·ç«¯å…±äº«</td>\n</tr>\n<tr>\n<td><strong>digest</strong>ï¼ˆå¸¸ç”¨ï¼‰</td>\n<td><code>r,w,c,d,a</code>ï¼ˆå¯ç»„åˆï¼‰</td>\n<td><code>digest:user:secret:crwda</code></td>\n<td>é«˜å®‰å…¨èŠ‚ç‚¹ï¼Œé…ç½®ä¸­å¿ƒï¼Œåˆ†å¸ƒå¼é”</td>\n<td>ç”¨æˆ·å+å¯†ç è®¤è¯ï¼Œéœ€åŠ å¯†å­˜å‚¨å¯†ç ï¼Œçµæ´»å®‰å…¨</td>\n</tr>\n<tr>\n<td><strong>ip</strong></td>\n<td><code>r,w,c,d,a</code>ï¼ˆå¯ç»„åˆï¼‰</td>\n<td><code>ip:192.168.1.100:r</code></td>\n<td>åŸºäº IP é™åˆ¶è®¿é—®çš„åœºæ™¯</td>\n<td>å¿«é€Ÿæ§åˆ¶æŸäº›å›ºå®š IP å¯è®¿é—®ï¼Œé€‚åˆå†…éƒ¨ç½‘ç»œåº”ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"ACL-ç›¸å…³å‘½ä»¤\">ACL ç›¸å…³å‘½ä»¤</h3>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>è¯­æ³•</th>\n<th>åŠŸèƒ½è¯´æ˜</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>getAcl</strong></td>\n<td><code>getAcl path</code></td>\n<td>è¯»å–æŒ‡å®šèŠ‚ç‚¹çš„ ACL</td>\n<td><code>getAcl /my_node</code></td>\n</tr>\n<tr>\n<td><strong>setAcl</strong></td>\n<td><code>setAcl path acl</code></td>\n<td>è®¾ç½®æŒ‡å®šèŠ‚ç‚¹çš„ ACL</td>\n<td><code>setAcl /my_node world:anyone:crdwa</code></td>\n</tr>\n<tr>\n<td><strong>create</strong></td>\n<td><code>create path data [acl]</code></td>\n<td>åˆ›å»ºèŠ‚ç‚¹æ—¶æŒ‡å®š ACL</td>\n<td><code>create /secure_node &quot;secret_data&quot; digest:user1:pwd:crwa</code></td>\n</tr>\n<tr>\n<td><strong>addAuth</strong></td>\n<td><code>addauth scheme auth</code></td>\n<td>æ·»åŠ è®¤è¯ç”¨æˆ·ï¼ˆç±»ä¼¼ç™»å½•ï¼‰</td>\n<td><code>addauth digest user1:password</code></td>\n</tr>\n<tr>\n<td><strong>deleteAcl(ä¸å­˜åœ¨)</strong></td>\n<td><code>setAcl path world:anyone:</code></td>\n<td>åˆ é™¤èŠ‚ç‚¹ ACLï¼ˆè®¾ä¸ºç©ºæˆ–å…¨å¼€æ”¾ï¼‰</td>\n<td><code>setAcl /my_node world:anyone:</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"auth-ä¸-digest-çš„åŒºåˆ«\"><code>auth</code> ä¸ <code>digest</code> çš„åŒºåˆ«</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ <code>auth</code> æ—¶ï¼Œéœ€å…ˆ <code>addauth digest user1:password</code> æ·»åŠ è®¤è¯ï¼Œ<code>setAcl</code> æ—¶ï¼Œä½¿ç”¨ <code>auth:user1:rw</code>ï¼Œè¿™é‡Œæ˜¯ä¸ºå·²ç»ç™»å½•çš„ç”¨æˆ·è®¾ç½®èŠ‚ç‚¹æƒé™ï¼Œæ‰€ä»¥ä¸éœ€è¦è®¾ç½®å¯†ç </p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ <code>digest</code> æ—¶ï¼Œæ— éœ€è¿›è¡Œç™»å½•è®¤è¯ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šå¯†ç ï¼Œå³<code>setAcl</code> æ—¶ï¼Œä½¿ç”¨ <code>digest:user1:password:rw</code></p>\n</li>\n<li class=\"lvl-2\">\n<p><code>digest</code> çš„å¯†ç æ˜¯ç»è¿‡åŠ å¯†çš„ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨æ˜æ–‡å¯†ç </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŠ å¯†å¯†ç </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n user:123456 | openssl dgst -binary -sha1 | openssl <span class=\"built_in\">base64</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">6DY5WhzOfGsWQ1XFuIyzxkpwdPo=</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># zookeeperå®¢æˆ·ç«¯ä¸­è®¾ç½®æƒé™</span></span><br><span class=\"line\">setAcl /name digest:user:6DY5WhzOfGsWQ1XFuIyzxkpwdPo=:cdrwa</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•æ—¶å¯†ç æ˜¯æ˜æ–‡</span></span><br><span class=\"line\">addauth digest user:123456</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ— è®ºä½¿ç”¨ <code>digest</code> è¿˜æ˜¯ <code>auth</code>ï¼Œåœ¨éœ€è¦è®¿é—®èŠ‚ç‚¹å‰ï¼Œéƒ½éœ€è¦å…ˆç™»å½•ã€‚</p>\n</li>\n</ul>\n<h3 id=\"super-è¶…çº§ç®¡ç†å‘˜\"><code>super</code> è¶…çº§ç®¡ç†å‘˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ‹¥æœ‰å…¨éƒ¨èŠ‚ç‚¹çš„æ‰€æœ‰æƒé™: <code>crwda</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>è®¾ç½®è¶…çº§ç®¡ç†å‘˜</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŠ å¯†å¯†ç ï¼Œç”¨æˆ·å’Œå¯†ç å¯ä»¥éšæ„è®¾ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n admin:123456 | openssl dgst -binary -sha1 | openssl <span class=\"built_in\">base64</span></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡º</span></span><br><span class=\"line\">0uek/hZ/V9fgiM35b0Z2226acMQ=</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰“å¼€ conf/zoo.cfg æ–‡ä»¶å¹¶ç¼–è¾‘ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢å†…å®¹</span></span><br><span class=\"line\">DigestAuthenticationProvider.superDigest=admin:0uek/hZ/V9fgiM35b0Z2226acMQ=</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é‡æ–°å¯åŠ¨æœåŠ¡åç™»å½•å®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºèŠ‚ç‚¹å¹¶è®¾ç½®æƒé™ï¼Œè¿™é‡Œå°†èŠ‚ç‚¹æˆæƒç»™ç”¨æˆ·user</span></span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 10] create /testNode 666 digest:user:6DY5WhzOfGsWQ1XFuIyzxkpwdPo=:rw</span><br><span class=\"line\">Created /testNode</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹è¢«æ‹’ç»</span></span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 11] get /testNode</span><br><span class=\"line\">Insufficient permission : /testNode</span><br><span class=\"line\"><span class=\"comment\"># ç™»å½•superç”¨æˆ·ï¼ŒéªŒè¯è¶…çº§ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®èŠ‚ç‚¹</span></span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 12] addauth digest admin:123456</span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹å°±å¯ä»¥äº†</span></span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 13] get /testNode</span><br><span class=\"line\">666</span><br></pre></td></tr></table></figure>\n<h2 id=\"4å­—æ¯å‘½ä»¤\">4å­—æ¯å‘½ä»¤</h2>\n<h3 id=\"ä»€ä¹ˆæ˜¯-4-å­—æ¯å‘½ä»¤\">ä»€ä¹ˆæ˜¯ <code>4 å­—æ¯å‘½ä»¤</code>?</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeper æä¾›äº†ä¸€ç»„ç®€çŸ­çš„ <code>4ä¸ªå­—æ¯çš„ç®¡ç†å‘½ä»¤</code>(Four Letter Words Commands, 4lw)ï¼Œå¯ä»¥é€šè¿‡ TCP è¿æ¥ ZooKeeper ç«¯å£ï¼ˆé»˜è®¤ 2181ï¼‰å‘é€è¿™äº›å‘½ä»¤ï¼Œå¿«é€ŸæŸ¥çœ‹æˆ–ç®¡ç† ZooKeeper çŠ¶æ€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¸¸ç”¨çš„ <code>4å­—æ¯å‘½ä»¤</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‘½ä»¤</th>\n<th>å¼•å…¥ç‰ˆæœ¬</th>\n<th>åŠŸèƒ½æè¿°</th>\n<th>ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>conf</code></td>\n<td>3.3.0</td>\n<td>æ‰“å°æœåŠ¡ç›¸å…³é…ç½®çš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo conf | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>cons</code></td>\n<td>3.3.0</td>\n<td>åˆ—å‡ºæ‰€æœ‰è¿æ¥åˆ°è¯¥æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥/ä¼šè¯è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥æ”¶/å‘é€çš„åŒ…æ•°é‡ã€ä¼šè¯IDã€æ“ä½œå»¶è¿Ÿã€æœ€åæ“ä½œæ‰§è¡Œæ—¶é—´ç­‰</td>\n<td><code>echo cons | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>crst</code></td>\n<td>3.3.0</td>\n<td>é‡ç½®æ‰€æœ‰è¿æ¥çš„è¿æ¥å’Œä¼šè¯ç»Ÿè®¡ä¿¡æ¯</td>\n<td><code>echo crst | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>dump</code></td>\n<td>-</td>\n<td>åˆ—å‡ºé‡è¦çš„ä¼šè¯å’Œä¸´æ—¶èŠ‚ç‚¹ä¿¡æ¯ï¼Œä»…åœ¨ Leader èŠ‚ç‚¹ä¸Šæœ‰æ•ˆ</td>\n<td><code>echo dump | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>envi</code></td>\n<td>-</td>\n<td>æ‰“å°æœåŠ¡ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo envi | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>reqs</code></td>\n<td>-</td>\n<td>åˆ—å‡ºæœªç»å¤„ç†çš„è¯·æ±‚</td>\n<td><code>echo reqs | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>ruok</code></td>\n<td>-</td>\n<td>æµ‹è¯•æœåŠ¡æ˜¯å¦å¤„äºæ­£å¸¸çŠ¶æ€ï¼›æ­£å¸¸è¿”å› <code>imok</code></td>\n<td><code>echo ruok | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>stat</code></td>\n<td>-</td>\n<td>è¾“å‡ºå…³äºæ€§èƒ½å’Œå®¢æˆ·ç«¯è¿æ¥çš„åˆ—è¡¨ä¿¡æ¯</td>\n<td><code>echo stat | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>srst</code></td>\n<td>-</td>\n<td>é‡ç½®æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯</td>\n<td><code>echo srst | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>srvr</code></td>\n<td>3.3.0</td>\n<td>åˆ—å‡ºè¿æ¥æœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo srvr | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>wchs</code></td>\n<td>3.3.0</td>\n<td>åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯</td>\n<td><code>echo wchs | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>wchc</code></td>\n<td>3.3.0</td>\n<td>é€šè¿‡ä¼šè¯åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ Watch ç›¸å…³çš„ä¼šè¯åˆ—è¡¨</td>\n<td><code>echo wchc | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>wchp</code></td>\n<td>3.3.0</td>\n<td>é€šè¿‡è·¯å¾„åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ä¼šè¯ç›¸å…³çš„è·¯å¾„</td>\n<td><code>echo wchp | nc 127.0.0.1 2181</code></td>\n</tr>\n<tr>\n<td><code>mntr</code></td>\n<td>3.4.0</td>\n<td>è¾“å‡ºå¯ç”¨äºæ£€æµ‹é›†ç¾¤å¥åº·çŠ¶æ€çš„å…³é”®æŒ‡æ ‡å˜é‡åˆ—è¡¨</td>\n<td><code>echo mntr | nc 127.0.0.1 2181</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å¼€å¯-4å­—æ¯å‘½ä»¤\">å¼€å¯ <code>4å­—æ¯å‘½ä»¤</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ ZooKeeper 3.5.0 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œ4lw å‘½ä»¤é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå¿…é¡»åœ¨é…ç½®æ–‡ä»¶(zoo.cfg)ä¸­æ˜¾å¼å¼€å¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¡¨ç¤ºå…è®¸æ‰€æœ‰ 4lw å‘½ä»¤éƒ½èƒ½ç”¨ï¼ˆé£é™©æœ€å¤§ï¼‰</span></span><br><span class=\"line\">4lw.commands.whitelist=*</span><br><span class=\"line\"><span class=\"comment\"># è¿™æ ·åªå…è®¸æ‰§è¡Œ statã€confã€ruok è¿™å‡ ä¸ªå‘½ä»¤ã€‚</span></span><br><span class=\"line\">4lw.commands.whitelist=<span class=\"built_in\">stat</span>,conf,ruok</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨æ–¹æ³•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœæ²¡æœ‰å®‰è£… ncï¼Œå¯ä»¥ä½¿ç”¨ yum å®‰è£…</span></span><br><span class=\"line\">yum install nc -y</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"built_in\">stat</span> | nc 127.0.0.1 2181</span><br></pre></td></tr></table></figure>\n<h2 id=\"Zookeeper-Java-Client\">Zookeeper Java Client</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é¡¹ç›®ç¤ºä¾‹ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/zookeeper-demo/\">Githubåœ°å€</a>ï¼Œå•å…ƒæµ‹è¯•ã€‚</p>\n</li>\n</ul>\n<h3 id=\"Zookeeper-å®˜æ–¹Javaå®¢æˆ·ç«¯\">Zookeeper å®˜æ–¹Javaå®¢æˆ·ç«¯</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ZooKeeperå®˜æ–¹çš„å®¢æˆ·ç«¯APIæä¾›äº†åŸºæœ¬çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¼šè¯ã€åˆ›å»ºèŠ‚ç‚¹ã€è¯»å–èŠ‚ç‚¹ã€æ›´æ–°æ•°æ®ã€åˆ é™¤èŠ‚ç‚¹å’Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ç­‰ã€‚ä¸è¿‡ï¼Œå¯¹äºå®é™…å¼€å‘æ¥è¯´ï¼ŒZooKeeperå®˜æ–¹APIæœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ZooKeeperçš„Watcherç›‘æµ‹æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ¯æ¬¡è§¦å‘ä¹‹åéƒ½éœ€è¦é‡æ–°è¿›è¡Œæ³¨å†Œã€‚</li>\n<li class=\"lvl-4\">ä¼šè¯è¶…æ—¶ä¹‹åæ²¡æœ‰å®ç°é‡è¿æœºåˆ¶ã€‚</li>\n<li class=\"lvl-4\">å¼‚å¸¸å¤„ç†çƒ¦çï¼ŒZooKeeperæä¾›äº†å¾ˆå¤šå¼‚å¸¸ï¼Œå¯¹äºå¼€å‘äººå‘˜æ¥è¯´å¯èƒ½æ ¹æœ¬ä¸çŸ¥é“åº”è¯¥å¦‚ä½•å¤„ç†è¿™äº›æŠ›å‡ºçš„å¼‚å¸¸ã€‚</li>\n<li class=\"lvl-4\">ä»…æä¾›äº†ç®€å•çš„byte[]æ•°ç»„ç±»å‹çš„æ¥å£ï¼Œæ²¡æœ‰æä¾›Java POJOçº§åˆ«çš„åºåˆ—åŒ–æ•°æ®å¤„ç†æ¥å£ã€‚</li>\n<li class=\"lvl-4\">åˆ›å»ºèŠ‚ç‚¹æ—¶å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦è‡ªè¡Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ã€‚</li>\n<li class=\"lvl-4\">æ— æ³•å®ç°çº§è”åˆ é™¤ã€‚</li>\n<li class=\"lvl-4\">æ€»ä¹‹ï¼ŒZooKeeperå®˜æ–¹APIåŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­æ¯”è¾ƒç¬¨é‡ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>é¡¹ç›®å¼•å…¥ä¾èµ–æ—¶ï¼Œæœ€å¥½ä¿æŒä¸æœåŠ¡ç«¯ç‰ˆæœ¬ä¸€è‡´ï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰ä¸€äº›å…¼å®¹æ€§çš„é—®é¢˜</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- zookeeper client --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.zookeeper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.8.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Zookeeper-ç¬¬ä¸‰æ–¹Javaå®¢æˆ·ç«¯-Curator\">Zookeeper ç¬¬ä¸‰æ–¹Javaå®¢æˆ·ç«¯ Curator</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://curator.apache.org/docs/about\">Curator</a>æ˜¯Netflixå…¬å¸å¼€æºçš„ä¸€å¥—ZooKeeperå®¢æˆ·ç«¯æ¡†æ¶ï¼Œå’ŒZkClientä¸€æ ·å®ƒè§£å†³äº†éå¸¸åº•å±‚çš„ç»†èŠ‚å¼€å‘å·¥ä½œï¼ŒåŒ…æ‹¬è¿æ¥ã€é‡è¿ã€åå¤æ³¨å†ŒWatcherçš„é—®é¢˜ä»¥åŠNodeExistsExceptionå¼‚å¸¸ç­‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Curatoræ˜¯ApacheåŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ä¹‹ä¸€ï¼ŒCuratorå…·æœ‰æ›´åŠ å®Œå–„çš„æ–‡æ¡£ï¼Œå¦å¤–è¿˜æä¾›äº†ä¸€å¥—æ˜“ç”¨æ€§å’Œå¯è¯»æ€§æ›´å¼ºçš„Fluenté£æ ¼çš„å®¢æˆ·ç«¯APIæ¡†æ¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Curatorè¿˜ä¸ºZooKeeperå®¢æˆ·ç«¯æ¡†æ¶æä¾›äº†ä¸€äº›æ¯”è¾ƒæ™®éçš„ã€å¼€ç®±å³ç”¨çš„ã€åˆ†å¸ƒå¼å¼€å‘ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚Recipeã€å…±äº«é”æœåŠ¡ã€Masteré€‰ä¸¾æœºåˆ¶å’Œåˆ†å¸ƒå¼è®¡ç®—å™¨ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…é¿å…äº†â€œé‡å¤é€ è½®å­â€çš„æ— æ•ˆå¼€å‘å·¥ä½œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨å®é™…çš„å¼€å‘åœºæ™¯ä¸­ï¼Œä½¿ç”¨Curatorå®¢æˆ·ç«¯å°±è¶³ä»¥åº”ä»˜æ—¥å¸¸çš„ZooKeeperé›†ç¾¤æ“ä½œçš„éœ€æ±‚ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¼•å…¥ä¾èµ–è¯´æ˜ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ¨¡å—</th>\n<th>ä¾èµ–å…³ç³»</th>\n<th>åŠŸèƒ½å®šä½</th>\n<th>å…¸å‹åŠŸèƒ½ä¸¾ä¾‹</th>\n<th>å¸¸ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>curator-client</strong></td>\n<td>ä¾èµ– zookeeper</td>\n<td>è¿æ¥ç®¡ç†ã€é‡è¯•ç­–ç•¥ã€åº•å±‚ API</td>\n<td>è¿æ¥ä¼šè¯ç®¡ç†ã€RetryPolicy</td>\n<td>éœ€è¦æœ€è½»é‡çš„ ZooKeeper å®¢æˆ·ç«¯</td>\n</tr>\n<tr>\n<td><strong>curator-framework</strong></td>\n<td>ä¾èµ– curator-client</td>\n<td>é«˜å±‚ API å°è£…ï¼Œç®€åŒ– ZK æ“ä½œ</td>\n<td>åˆ›å»ºèŠ‚ç‚¹ã€Watcher ç®¡ç†ã€è‡ªåŠ¨é‡è¿</td>\n<td>é€šç”¨ ZooKeeper å®¢æˆ·ç«¯å¼€å‘</td>\n</tr>\n<tr>\n<td><strong>curator-recipes</strong></td>\n<td>ä¾èµ– curator-framework â†’ curator-client</td>\n<td>åˆ†å¸ƒå¼æ¨¡å¼ç°æˆå®ç°</td>\n<td>åˆ†å¸ƒå¼é”ã€Leader é€‰ä¸¾ã€é˜Ÿåˆ—ã€Barrier</td>\n<td>ç›´æ¥ç”¨åˆ†å¸ƒå¼å·¥å…·ï¼Œæ— éœ€è‡ªå·±å®ç°</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>ä½¿ç”¨å»ºè®®</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-4\">\n<p>å¦‚æœä½ åªæƒ³è½»é‡è®¿é—® ZooKeeper â†’ <code>curator-client</code> å°±å¤Ÿäº†ï¼Œä½†å‡ ä¹æ²¡äººå•ç‹¬ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-4\">\n<p>å¦‚æœä½ æƒ³æ–¹ä¾¿æ“ä½œ ZooKeeper API â†’ <code>curator-framework</code>ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½é€‚ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-4\">\n<p>å¦‚æœä½ æƒ³ç”¨åˆ†å¸ƒå¼é”ã€é€‰ä¸¾ã€Barrier â†’ <code>curator-recipes</code>ï¼ˆå®ƒä¼šè‡ªåŠ¨å¼•å…¥å‰ä¸¤ä¸ªï¼‰ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- zookeeper client --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.zookeeper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.8.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!--curator--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-recipes<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.9.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.zookeeper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Zookeeper ç‰ˆæœ¬ä¸º 3.8.4ã€‚ Zookeeper ç®€ä»‹ ZooKeeper æ˜¯ä¸€ä¸ªé›†ä¸­å¼æœåŠ¡ï¼Œç”¨äºï¼š åœºæ™¯ ZooKeeper å®˜æ–¹åŠŸèƒ½ ä¸»è¦èŠ‚ç‚¹ç±»å‹ å…·ä½“åœºæ™¯ç¤ºä¾‹ é…ç½®ä¸­å¿ƒ (Config Center) ç»´æŠ¤é…ç½®ä¿¡æ¯ (Configuration Management) æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰ æŠŠæ•°æ®åº“è¿æ¥ä¿¡æ¯ã€ç³»ç»Ÿå‚æ•°ç­‰æ”¾åœ¨ ZooKeeper é‡Œï¼ŒåŠ¨æ€æ›´æ–°ï¼Œåƒ Apolloã€Spring Cloud Config ä¸€æ ·ã€‚ æ³¨å†Œä¸­å¿ƒ (Service Registry) æä¾›å‘½åæœåŠ¡ (Naming Service) ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEphemeralï¼‰ æœåŠ¡å®ä¾‹å¯åŠ¨æ—¶åœ¨ ZooKeeper é‡Œæ³¨å†Œè‡ªå·±çš„åœ°å€ï¼Œå®¢æˆ·ç«¯ä» ZooKeeper è·å–æœåŠ¡åˆ—è¡¨ï¼Œç±»ä¼¼äº Nacosã€Eurekaã€‚ åˆ†å¸ƒå¼é” (Distributed Lock) åˆ†å¸ƒå¼åŒæ­¥ (Distributed Synchronization) ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEphemeral Sequentialï¼‰ ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨æ‰§è¡Œå…³é”®ä»»åŠ¡ï¼Œå…¸å‹åº”ç”¨æ˜¯åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚ æ¶ˆæ¯é˜Ÿåˆ— (Message Queue) é›†ç¾¤ç®¡ç†æœåŠ¡ (Cluster Management) æŒä¹…/ä¸´æ—¶èŠ‚ç‚¹ + Watch æœºåˆ¶ é€šè¿‡ Watch æœºåˆ¶ç›‘å¬ ZNode å˜åŒ–ï¼ŒèŠ‚ç‚¹é—´ç”¨æ•°æ®å˜æ›´å½“â€œä¿¡å·â€ä¼ é€’æ¶ˆæ¯ï¼Œæ—©æœŸ Kafka ç”¨è¿‡è¿™ç§æ–¹å¼ã€‚ ZooKeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸ Unix æ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ª ZNodeã€‚ ä¸åŒäºæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä¿å­˜æ•°æ®ï¼Œæ¯ä¸€ä¸ª ZNode é»˜è®¤èƒ½å¤Ÿå­˜å‚¨ 1MB çš„æ•°æ®ï¼Œæ¯ä¸ª ZNode éƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬(version)ï¼Œç‰ˆæœ¬ä»0å¼€å§‹è®¡æ•°ã€‚ Zookeeper å®‰è£… è¿è¡Œ Zookeeper éœ€è¦å®‰è£… JDK1.8+ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ OpenJDK11 12345678910111213141516sudo mkdir -p /usr/local/jdkcd /usr/local/jdksudo wget https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gzsudo tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gzsudo ln -s jdk-11.0.28+6 jdk11# é…ç½®ç¯å¢ƒå˜é‡vim /etc/profile # æ·»åŠ å¦‚ä¸‹å†…å®¹ export JAVA_HOME=/usr/local/jdk/jdk11 export PATH=$JAVA_HOME/bin:$PATH# ç«‹å³ç”Ÿæ•ˆsource /etc/profile# æŸ¥çœ‹javaç‰ˆæœ¬java -versionopenjdk version &quot;11.0.28&quot; 2025-07-15OpenJDK Runtime Environment Temurin-11.0.28+6 (build 11.0.28+6)OpenJDK 64-Bit Server VM Temurin-11.0.28+6 (build 11.0.28+6, mixed mode) å•æœºå®‰è£… ä¸‹è½½ Zookeeperï¼Œç›®å‰æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ä¸º 3.8.4 123456# ä¸‹è½½wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz# è§£å‹tar -zxvf apache-zookeeper-3.8.4-bin.tar.gz# é…ç½®ä¸ªè½¯è¿æ¥ï¼Œæ–¹ä¾¿ä»¥åå‡çº§ln -s apache-zookeeper-3.8.4-bin zookeeper ä¿®æ”¹é…ç½®æ–‡ä»¶ 1234cd zookeeper/confcp zoo_sample.cfg zoo.cfg# å»ºè®®ä¿®æ”¹ zoo.cfg é…ç½®æ–‡ä»¶ï¼Œå°† dataDir=/tmp/zookeeper ä¿®æ”¹ä¸ºæŒ‡å®šçš„dataç›®å½•vim zoo.cfg zoo.cfg å‚æ•°è¯´æ˜ é…ç½®é¡¹ è¯´æ˜ é»˜è®¤å€¼ å•ä½ / å¤‡æ³¨ tickTime ZooKeeper æ—¶é—´é…ç½®ä¸­çš„åŸºæœ¬å•ä½ 2000 æ¯«ç§’ initLimit follower åˆå§‹åŒ–è¿æ¥åˆ° leader çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•° 10 10 Ã— tickTime = 20000 ms syncLimit follower ä¸ leader æ•°æ®åŒæ­¥çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸º tickTime å€æ•° 5 5 Ã— tickTime = 10000 ms dataDir æ•°æ®å’Œæ—¥å¿—å­˜å‚¨ç›®å½•ï¼ˆæœªæŒ‡å®š dataLogDir æ—¶ï¼Œæ—¥å¿—ä¹Ÿä¼šä¿å­˜åœ¨æ­¤ç›®å½•ï¼‰ /tmp/zookeeper ç›®å½•è·¯å¾„ clientPort å®¢æˆ·ç«¯è¿æ¥ ZooKeeper çš„ç«¯å£å· 2181 é»˜è®¤ 2181 maxClientCnxns å•ä¸ªå®¢æˆ·ç«¯æœ€å¤§å¹¶å‘è¿æ¥æ•° 60 è¶…è¿‡é™åˆ¶åæ–°è¿æ¥ä¼šè¢«æ‹’ç» autopurge.snapRetainCount å¿«ç…§æ–‡ä»¶ä¿ç•™ä¸ªæ•°ï¼Œè¶…è¿‡æ•°é‡çš„å°†ä¼šè¢«æ¸…ç† 3 é»˜è®¤ 3 autopurge.purgeInterval æ¸…ç†ä»»åŠ¡æ‰§è¡Œé—´éš”æ—¶é—´ï¼Œå•ä½å°æ—¶ï¼Œ0 è¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç† 1 1 å°æ—¶ å¯åŠ¨ zookeeper 123456789101112cd zookeeper# å¯åŠ¨bin/zkServer.sh start# æŒ‡å®šé…ç½®æ–‡ä»¶bin/zkServer.sh start conf/zoo.cfg# åœæ­¢bin/zkServer.sh stop# æŸ¥çœ‹çŠ¶æ€bin/zkServer.sh status# æŸ¥çœ‹ç‰ˆæœ¬./bin/zkServer.sh version é›†ç¾¤å®‰è£… ZooKeeper é›†ç¾¤è§’è‰² 1. Leaderï¼ˆé¢†å¯¼è€…ï¼‰ èŒè´£ï¼š äº‹åŠ¡è¯·æ±‚ï¼ˆå†™æ“ä½œï¼‰çš„å”¯ä¸€è°ƒåº¦è€…å’Œå¤„ç†è€…ï¼Œä¿è¯é›†ç¾¤äº‹åŠ¡å¤„ç†çš„é¡ºåºæ€§ï¼› é›†ç¾¤å†…éƒ¨å„ä¸ªæœåŠ¡å™¨çš„è°ƒåº¦è€…ï¼› å¯¹äº createã€setDataã€delete ç­‰å†™æ“ä½œè¯·æ±‚ï¼Œç»Ÿä¸€è½¬å‘ç»™ Leader å¤„ç†ï¼› Leader è´Ÿè´£å†³å®šç¼–å·ã€æ‰§è¡Œæ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º äº‹åŠ¡ã€‚ ä¸‰å°è™šæ‹Ÿæœº zoo.cfg æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é€‰ä¸¾å‡º Leader è§’è‰²ï¼Œåˆ™å…¶ä½™å°±æ˜¯ Follower è§’è‰²ã€‚ 123server.1=10.250.0.229:2888:3888server.2=10.250.0.152:2888:3888server.3=10.250.0.36:2888:3888 2. Followerï¼ˆè·Ÿéšè€…ï¼‰ èŒè´£ï¼š å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡ï¼ˆè¯»æ“ä½œï¼‰è¯·æ±‚ï¼ˆå¯ä»¥ç›´æ¥å“åº”ï¼‰ï¼› è½¬å‘äº‹åŠ¡è¯·æ±‚ç»™ Leaderï¼› å‚ä¸é›†ç¾¤ Leader é€‰ä¸¾æŠ•ç¥¨ã€‚ leaderèŠ‚ç‚¹å¯ä»¥å¤„ç†è¯»å†™è¯·æ±‚ï¼Œfolloweråªå¯ä»¥å¤„ç†è¯»è¯·æ±‚ã€‚followeråœ¨æ¥åˆ°å†™è¯·æ±‚æ—¶ä¼šæŠŠå†™è¯·æ±‚è½¬å‘ç»™leaderæ¥å¤„ç†ã€‚ 3. Observerï¼ˆè§‚å¯Ÿè€…ï¼‰ èŒè´£ï¼š å¯¹äºéäº‹åŠ¡è¯·æ±‚ï¼ˆè¯»æ“ä½œï¼‰å¯ä»¥ç‹¬ç«‹å¤„ç†ï¼› å¯¹äºäº‹åŠ¡è¯·æ±‚ä¼šè½¬å‘ç»™ Leader å¤„ç†ï¼› æ¥æ”¶æ¥è‡ª Leader çš„ inform ä¿¡æ¯ï¼Œæ›´æ–°æœ¬åœ°å­˜å‚¨ï¼› ä¸å‚ä¸æäº¤å’Œé€‰ä¸¾æŠ•ç¥¨ï¼› é€šå¸¸ç”¨äº æå‡é›†ç¾¤éäº‹åŠ¡å¤„ç†èƒ½åŠ›ï¼Œä¸å½±å“é›†ç¾¤äº‹åŠ¡å¤„ç†æ€§èƒ½ã€‚ é…ç½®ä¸€ä¸ª ID ä¸º 4 çš„è§‚å¯Ÿè€…èŠ‚ç‚¹ï¼š 1server.4=10.250.0.56:2888:3888:observer é›†ç¾¤æ­å»º ç¯å¢ƒå‡†å¤‡ï¼š4å°æœåŠ¡å™¨ï¼ŒæŒ‰ç…§ å•æœºå®‰è£… çš„æ–¹å¼å‡†å¤‡å¥½ Zookeeper ç¯å¢ƒ 123410.250.0.22910.250.0.15210.250.0.3610.250.0.56 zoo.cfg æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½® 1234server.1=10.250.0.229:2888:3888server.2=10.250.0.152:2888:3888server.3=10.250.0.36:2888:3888server.4=10.250.0.56:2888:3888:observer åˆ†åˆ«åœ¨ dataDir ç›®å½•ä¸‹åˆ›å»º myid æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸ server å¯¹åº”çš„ç¼–å·ï¼ˆæ³¨æ„ï¼šä¸Šä¸‹ä¸è¦æœ‰ç©ºè¡Œï¼Œå·¦å³ä¸è¦æœ‰ç©ºæ ¼ï¼‰ 12345# æ³¨æ„ èŠ‚ç‚¹ç¼–å·ä¸èƒ½é‡å¤ï¼Œè€Œä¸”è¦ä¸ zoo.cfg æ–‡ä»¶ä¸­çš„ server.id ä¸€è‡´echo 1 &gt; myid# echo 2 &gt; myid# echo 3 &gt; myid# echo 4 &gt; myid åˆ†åˆ«å¯åŠ¨ Zookeeper æœåŠ¡å™¨ 12345# åˆ†åˆ«å¯åŠ¨4ä¸ªèŠ‚ç‚¹çš„zookeeper serverbin/zkServer.sh start# æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°èŠ‚ç‚¹è§’è‰²ç±»å‹bin/zkServer.sh status é›†ç¾¤æœ€å°‘èŠ‚ç‚¹è¦æ±‚å’Œæ‰©å®¹è§„åˆ™ ZooKeeper ä½¿ç”¨ å¤šæ•°æ´¾ï¼ˆquorumï¼‰æœºåˆ¶ æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ 1231.é›†ç¾¤æ€»èŠ‚ç‚¹æ•° N2.å®¹å¿çš„å®•æœºèŠ‚ç‚¹æ•° F = (N-1)/2ï¼ˆå‘ä¸‹å–æ•´ï¼‰3.è¦ä¿è¯é›†ç¾¤å¯ç”¨ï¼Œéœ€è¦ å¤§äº N/2 çš„èŠ‚ç‚¹å­˜æ´» é›†ç¾¤æ‰©å®¹è§„åˆ™ 1234561.èŠ‚ç‚¹æ€»æ•°å¿…é¡»æ˜¯å¥‡æ•° å¥‡æ•°èŠ‚ç‚¹å¯ä»¥ä¿è¯å¤šæ•°æ´¾æŠ•ç¥¨æœºåˆ¶æ­£å¸¸ å¶æ•°èŠ‚ç‚¹ä¸æ¨èï¼Œå®¹é”™èƒ½åŠ›ä¸å¢åŠ ï¼ˆæ¯”å¦‚ 4 å°ï¼Œä»ç„¶åªå®¹å¿ 1 å°å®•æœºï¼‰2.æ¯æ¬¡æ‰©å®¹å»ºè®® +2 èŠ‚ç‚¹ è¿™æ ·æ—¢ä¿æŒå¥‡æ•°ï¼Œåˆå¢åŠ  quorum å®¹é”™èƒ½åŠ› æœ€å°‘èŠ‚ç‚¹ä¸å®¹é”™èƒ½åŠ›è¡¨æ ¼ é›†ç¾¤æ€»èŠ‚ç‚¹æ•° N å®¹å¿å®•æœºæ•° F å¯ç”¨ quorum èŠ‚ç‚¹æ•° å¤‡æ³¨ 1 0 1 ä¸æ¨èï¼Œæ— æ³•å®¹å¿æ•…éšœ 2 0 2 ä¸æ¨èï¼Œ1 å°å®•æœºå°±ä¸å¯ç”¨ 3 1 2 æœ€å°å¯ç”¨ç”Ÿäº§é›†ç¾¤ 5 2 3 æ¨èç”Ÿäº§é›†ç¾¤è§„æ¨¡ 7 3 4 é«˜å¯ç”¨å¤§é›†ç¾¤ 9 4 5 æ›´å¤§é›†ç¾¤ï¼Œé«˜å®¹é”™ 11 5 6 æé«˜å¯ç”¨åœºæ™¯ ZooKeeper é»˜è®¤ç«¯å£è¯´æ˜ ç«¯å£ ç”¨é€” è¯´æ˜ 2181 å®¢æˆ·ç«¯è¿æ¥ç«¯å£ å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªç«¯å£è®¿é—® ZooKeeper 2888 é›†ç¾¤å†…éƒ¨é€šä¿¡ follower ä¸ leader ä¹‹é—´åŒæ­¥æ•°æ® 3888 leader é€‰ä¸¾ç«¯å£ é›†ç¾¤é€‰ä¸¾ leader ä½¿ç”¨ 8080 (å¯é€‰) admin/metrics webç«¯å£ å¦‚æœå¼€å¯äº† adminServer 123456789101112# æ°¸ä¹…å¼€å¯ç«¯å£sudo firewall-cmd --permanent --add-port=2181/tcpsudo firewall-cmd --permanent --add-port=2888/tcpsudo firewall-cmd --permanent --add-port=3888/tcp# å¦‚æœä½¿ç”¨ adminServersudo firewall-cmd --permanent --add-port=8080/tcp# é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½®sudo firewall-cmd --reload# æŸ¥çœ‹æ˜¯å¦å¼€æ”¾æˆåŠŸsudo firewall-cmd --list-all å®¢æˆ·ç«¯è¿æ¥ å‘½ä»¤è¡Œ 1234# é»˜è®¤è¿æ¥ 127.0.0.1:2181bin/zkCli.sh# æŒ‡å®š -server ip:portï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œåˆ™è¿æ¥ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒZooKeeper ä¼šè‡ªåŠ¨å¤„ç†ä¸ Leader/Follower çš„äº¤äº’bin/zkCli.sh -server 127.0.0.1:2181 å®¢æˆ·ç«¯å‘½ä»¤ç®€ä»‹ï¼šå‚è€ƒå®˜ç½‘ å‘½ä»¤ è¯­æ³•ç¤ºä¾‹ åŠŸèƒ½æè¿° å¸¸ç”¨å‚æ•°åŠè¯´æ˜ ç¤ºä¾‹ help help æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤ æ—  help version version æŸ¥çœ‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯ æ—  version connect connect host:port è¿æ¥åˆ°æŒ‡å®š ZooKeeper æœåŠ¡å™¨ host:port: æœåŠ¡å™¨åœ°å€ connect 127.0.0.1:2181 close close å…³é—­å½“å‰ä¼šè¯ ,é€šè¿‡ connect å¯é‡è¿ æ—  close quit quit é€€å‡ºå®¢æˆ·ç«¯ æ—  quit ls ls [-s] [-w] [-R] path æŸ¥çœ‹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ - -w: ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–- -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯- -R: é€’å½’æŸ¥çœ‹ ls -s -w /zk_test getAllChildrenNumber getAllChildrenNumber path è·å–æŸèŠ‚ç‚¹æ‰€æœ‰å­èŠ‚ç‚¹çš„æ€»æ•° æ—  getAllChildrenNumber /zk_test getEphemerals getEphemerals path è·å–æŸè·¯å¾„ä¸‹æ‰€æœ‰ä¸´æ—¶èŠ‚ç‚¹ æ—  getEphemerals /zk_test create create [-s] [-e] [-c] [-t ttl] path [data] [acl] åˆ›å»ºèŠ‚ç‚¹ - -s: é¡ºåºèŠ‚ç‚¹- -e: ä¸´æ—¶èŠ‚ç‚¹- -c: å®¹å™¨èŠ‚ç‚¹- -t ttl: TTLèŠ‚ç‚¹ï¼Œå•ä½æ¯«ç§’ create -e /zk_test_ephemeral &quot;temp_data&quot; get get [-s] [-w] path è·å–èŠ‚ç‚¹æ•°æ®ä¿¡æ¯ - -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯- -w: ç›‘å¬èŠ‚ç‚¹å˜åŒ– get -s -w /zk_test set set [-s] [-v version] path data è®¾ç½®èŠ‚ç‚¹æ•°æ® - -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯- -v: æŒ‡å®šç‰ˆæœ¬å· set /zk_test &quot;new_data&quot; stat stat [-w] path æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ - -w: ç›‘å¬èŠ‚ç‚¹å˜åŒ– stat -w /zk_test sync sync path åŒæ­¥æŒ‡å®šèŠ‚ç‚¹æ•°æ® æ—  sync /zk_test delete delete [-v version] path åˆ é™¤æŸä¸€èŠ‚ç‚¹ï¼ˆæ— å­èŠ‚ç‚¹ï¼‰ - -v: èŠ‚ç‚¹ç‰ˆæœ¬å· delete /zk_test deleteall deleteall path é€’å½’åˆ é™¤æŸä¸€èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ æ—  deleteall /zk_test getAcl getAcl [-s] path è·å–èŠ‚ç‚¹è®¿é—®æ§åˆ¶ä¿¡æ¯ - -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ getAcl /zk_test setAcl setAcl [-s] [-v version] [-R] path acl è®¾ç½®èŠ‚ç‚¹è®¿é—®æ§åˆ¶åˆ—è¡¨ - -s: æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯- -v: æŒ‡å®šç‰ˆæœ¬å·- -R: é€’å½’è®¾ç½® setAcl /zk_test world:anyone:r listquota listquota path æŸ¥çœ‹èŠ‚ç‚¹é…é¢ä¿¡æ¯ æ—  listquota /zk_test setquota setquota [-n] [-b] val path å¯¹èŠ‚ç‚¹å¢åŠ é™åˆ¶ - -n: å­èŠ‚ç‚¹æœ€å¤§ä¸ªæ•°- -b: æ•°æ®å€¼æœ€å¤§é•¿åº¦ï¼Œ-1 è¡¨ç¤ºæ— é™åˆ¶ setquota -n 5 /zk_test delquota delquota [-n | -b] path åˆ é™¤èŠ‚ç‚¹é…é¢é™åˆ¶ - -n: åˆ é™¤å­èŠ‚ç‚¹æ•°é™åˆ¶- -b: åˆ é™¤æ•°æ®å€¼å¤§å°é™åˆ¶ delquota -n /zk_test config config æŸ¥çœ‹æœåŠ¡å™¨é…ç½® æ—  config whoami whoami æŸ¥çœ‹å½“å‰ä¼šè¯èº«ä»½ æ—  whoami GUI å·¥å…· åç§° ç±»å‹ / è¿è¡Œæ–¹å¼ ä¼˜ç‚¹ æ³¨æ„äº‹é¡¹ PrettyZoo æ¡Œé¢åº”ç”¨ï¼ˆJavaFXï¼‰(GitHub) æ”¯æŒ Mac/Windows/Linuxï¼Œç•Œé¢å‹å¥½ï¼›æ”¯æŒèŠ‚ç‚¹åˆ›å»º/åˆ é™¤/æ›´æ–°/æŸ¥è¯¢ï¼ŒACL ç®¡ç†ï¼Œå¤š ZK å®ä¾‹ç®¡ç†ï¼ŒSSH éš§é“ç­‰åŠŸèƒ½ã€‚(GitHub) é¡¹ç›®å·²ç» archivedï¼Œç»´æŠ¤å¯èƒ½ä¸æ´»è·ƒã€‚æœ€æ–°ç‰ˆå¯èƒ½åœ¨å…¼å®¹æ€§æˆ– Bug ä¿®å¤æ–¹é¢ä¸å¦‚æ´»è·ƒé¡¹ç›®ã€‚ä¹Ÿå¯èƒ½éœ€è¦è‡ªå·±æ„å»ºæˆ–è°ƒè¯•ã€‚(GitHub) ZooNavigator Web ç•Œé¢ + å¯ Docker éƒ¨ç½²æˆ–æœ¬åœ°å¯åŠ¨(GitHub) åŠŸèƒ½ä¸°å¯Œï¼›æ”¯æŒå¤šä¸ª Zookeeper ç‰ˆæœ¬ï¼ˆå¦‚ 3.5.x ï½ 3.9.xï¼‰ï¼›æµè§ˆ / ç¼–è¾‘ /æœç´¢èŠ‚ç‚¹ï¼›å¯¼å…¥å¯¼å‡ºé…ç½®ï¼›æ”¯æŒæµè§ˆå™¨è®¿é—®ï¼Œæ— éœ€æœ¬åœ° heavy GUIã€‚(GitHub) å› ä¸º Web åº”ç”¨ï¼Œå¯èƒ½å¯¹æµè§ˆå™¨å®‰å…¨ç­–ç•¥ä¸ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿï¼›éœ€è¦éƒ¨ç½²è‡ªå·±ç‰ˆæœ¬æˆ– Dockerï¼›å¦‚æœè¦æ±‚æœ¬åœ°è„±æœºæ“ä½œæ—¶ï¼Œæœ‰äº›åŠŸèƒ½å¯èƒ½ç¨ä¸å¦‚æ¡Œé¢åº”ç”¨ã€‚ ZooKeeper Assistant æ¡Œé¢ï¼ç®¡ç†å‘˜é¢æ¿ç±»å‹ï¼ˆæ”¯æŒç›‘æ§ç•Œé¢ç­‰ï¼‰(DEV Community) é™¤äº†æµè§ˆèŠ‚ç‚¹æ ‘ä»¥å¤–ï¼Œè¿˜æä¾›å¥åº·çŠ¶æ€ç›‘æ§ï¼ˆå»¶è¿Ÿã€è¯·æ±‚æ•°ç­‰ï¼‰ã€ä¸åŒæ•°æ®æ ¼å¼æ”¯æŒï¼ˆJSON/XML ç­‰ï¼‰ã€å¯¼å…¥/å¯¼å‡ºèŠ‚ç‚¹æ•°æ®ã€å‘½ä»¤è¡Œæ“ä½œé›†æˆã€‚(DEV Community) æœ‰äº›åŠŸèƒ½å¯èƒ½åœ¨ Mac ä¸Šå…¼å®¹æ€§æˆ–è§†è§‰ä½“éªŒéœ€è¦è°ƒè¯•ï¼›å…·ä½“ç‰ˆæœ¬æ”¯æŒæƒ…å†µè¦çœ‹æœ€è¿‘æ›´æ–°ã€‚æŸäº›ç›‘æ§ç•Œé¢å¯èƒ½ä¾èµ–äº ZK çš„æŒ‡æ ‡æˆ–æ’ä»¶ã€‚ Zookeeper èŠ‚ç‚¹ç±»å‹ èŠ‚ç‚¹ç±»å‹ ç”Ÿå‘½å‘¨æœŸè¯´æ˜ åˆ›å»ºå‘½ä»¤ç¤ºä¾‹ ç‰¹ç‚¹è¯´æ˜ æŒä¹…èŠ‚ç‚¹ (Persistent) èŠ‚ç‚¹ä¸€ç›´å­˜åœ¨ï¼Œé™¤éæ‰‹åŠ¨åˆ é™¤ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ŒèŠ‚ç‚¹ä¹Ÿä¸ä¼šæ¶ˆå¤± create /locks é€‚åˆå­˜å‚¨é…ç½®ä¿¡æ¯ã€å…ƒæ•°æ®ç­‰æŒä¹…æ•°æ® ä¸´æ—¶èŠ‚ç‚¹ (Ephemeral) å®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼ˆå¼‚å¸¸æˆ–è¶…æ—¶ï¼‰æ—¶ï¼ŒèŠ‚ç‚¹è‡ªåŠ¨è¢«åˆ é™¤ create -e /locks/DBLock å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€ä¸´æ—¶ä¼šè¯æ•°æ® æœ‰åºèŠ‚ç‚¹ (Sequential) åœ¨æŒä¹…æˆ–ä¸´æ—¶èŠ‚ç‚¹åŸºç¡€ä¸Šï¼Œå¢åŠ æœ‰åºç¼–å·ï¼ŒZooKeeper è‡ªåŠ¨åœ¨èŠ‚ç‚¹åååŠ é€’å¢åºå· create -e -s /jobs/job å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€é˜Ÿåˆ—ç­‰éœ€è¦é¡ºåºçš„åœºæ™¯ å®¹å™¨èŠ‚ç‚¹ (Container) V3.5.3+ï¼Œå½“å®¹å™¨èŠ‚ç‚¹ä¸‹çš„æœ€åä¸€ä¸ªå­èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œå®¹å™¨èŠ‚ç‚¹ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤ create -c /work é€‚åˆåˆ†å¸ƒå¼ä»»åŠ¡ä¸´æ—¶ç›®å½•ã€åŠ¨æ€æ•°æ®ç›®å½• TTL èŠ‚ç‚¹ (TTL) åœ¨æŒ‡å®š TTL æ—¶é—´å†…æœªä¿®æ”¹ä¸”æ— å­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆéœ€å¼€å¯ extendedTypesEnabled=true é…ç½®ï¼‰ create -t 3000 /ttl_node é€‚åˆä¸´æ—¶ç¼“å­˜ã€ä¸´æ—¶çŠ¶æ€æ•°æ®ï¼Œè¿‡æœŸè‡ªåŠ¨æ¸…ç† æ³¨æ„ åŒä¸€çº§èŠ‚ç‚¹ key åç§°æ˜¯å”¯ä¸€çš„ åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œå¿…é¡»è¦å¸¦ä¸Šå…¨è·¯å¾„ èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ 123456789101112[zk: localhost:2181(CONNECTED) 16] stat /testcZxid = 0x100000002 # Znodeåˆ›å»ºçš„äº‹åŠ¡idctime = Mon Sep 15 09:44:51 UTC 2025 # åˆ›å»ºæ—¶é—´mZxid = 0x100000004 # æœ€åä¸€æ¬¡ä¿®æ”¹äº‹åŠ¡idmtime = Mon Sep 15 09:47:12 UTC 2025 # æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´pZxid = 0x400000004 # è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡ä¿®æ”¹çš„äº‹åŠ¡IDï¼Œæ·»åŠ å­èŠ‚ç‚¹æˆ–åˆ é™¤å­èŠ‚ç‚¹å°±ä¼šå½±å“å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œä½†æ˜¯ä¿®æ”¹å­èŠ‚ç‚¹çš„æ•°æ®å†…å®¹åˆ™ä¸å½±å“è¯¥IDï¼ˆæ³¨æ„: åªæœ‰å­èŠ‚ç‚¹åˆ—è¡¨å˜æ›´äº†æ‰ä¼šå˜æ›´pzxidï¼Œå­èŠ‚ç‚¹å†…å®¹å˜æ›´ä¸ä¼šå½±å“pzxidï¼‰cversion = 1 # å­èŠ‚ç‚¹çš„ç‰ˆæœ¬å·ã€‚å½“znodeçš„å­èŠ‚ç‚¹æœ‰å˜åŒ–æ—¶ï¼Œcversion çš„å€¼å°±ä¼šå¢åŠ 1ã€‚dataVersion = 1 # znodeçš„æ•°æ®ç‰ˆæœ¬å·ã€‚æ¯æ¬¡å¯¹èŠ‚ç‚¹è¿›è¡Œsetæ“ä½œï¼ŒdataVersionçš„å€¼éƒ½ä¼šå¢åŠ 1ï¼ˆå³ä½¿è®¾ç½®çš„æ˜¯ç›¸åŒçš„æ•°æ®ï¼‰ï¼Œå¯æœ‰æ•ˆé¿å…äº†æ•°æ®æ›´æ–°æ—¶å‡ºç°çš„å…ˆåé¡ºåºé—®é¢˜aclVersion = 0 # znodeçš„ACLç‰ˆæœ¬å·ã€‚æ¯æ¬¡å¯¹èŠ‚ç‚¹è¿›è¡ŒACLè®¾ç½®ï¼ŒaclVersionçš„å€¼éƒ½ä¼šå¢åŠ 1ephemeralOwner = 0x0 # å¦‚æœè¯¥èŠ‚ç‚¹ä¸ºä¸´æ—¶èŠ‚ç‚¹, ephemeralOwnerå€¼è¡¨ç¤ºä¸è¯¥èŠ‚ç‚¹ç»‘å®šçš„session idã€‚å¦‚æœä¸æ˜¯, ephemeralOwnerå€¼ä¸º0(æŒä¹…èŠ‚ç‚¹)ã€‚dataLength = 3 # znodeçš„æ•°æ®é•¿åº¦numChildren = 1 # znodeçš„å­èŠ‚ç‚¹æ•°é‡ï¼ˆåªç»Ÿè®¡ç›´æ¥å­èŠ‚ç‚¹çš„æ•°é‡ï¼‰ Zookeeper ç›‘å¬æœºåˆ¶ watchæœºåˆ¶ï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªç›‘å¬æœºåˆ¶ã€‚Zookeeperä¸­çš„watchæœºåˆ¶ï¼Œå¿…é¡»å®¢æˆ·ç«¯å…ˆå»æœåŠ¡ç«¯æ³¨å†Œç›‘å¬ï¼Œè¿™æ ·äº‹ä»¶å‘ç”Ÿæ—¶æ‰ä¼šè§¦å‘ç›‘å¬ï¼Œé€šçŸ¥ç»™å®¢æˆ·ç«¯ã€‚ ç›‘å¬çš„å¯¹è±¡æ˜¯äº‹ä»¶ï¼Œæ”¯æŒçš„äº‹ä»¶ç±»å‹å¦‚ä¸‹ï¼š 1234567- None: è¿æ¥å»ºç«‹äº‹ä»¶- NodeCreatedï¼š èŠ‚ç‚¹åˆ›å»º- NodeDeletedï¼š èŠ‚ç‚¹åˆ é™¤- NodeDataChangedï¼šèŠ‚ç‚¹æ•°æ®å˜åŒ–- NodeChildrenChangedï¼šå­èŠ‚ç‚¹åˆ—è¡¨å˜åŒ–- DataWatchRemovedï¼šèŠ‚ç‚¹ç›‘å¬è¢«ç§»é™¤- ChildWatchRemovedï¼šå­èŠ‚ç‚¹ç›‘å¬è¢«ç§»é™¤ ç›‘å¬ç‰¹æ€§ ç‰¹æ€§ è¯´æ˜ ä¸€æ¬¡æ€§è§¦å‘ Watch æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸€æ—¦è¢«è§¦å‘å°±ä¼šè¢«ç§»é™¤ã€‚å†æ¬¡ä½¿ç”¨æ—¶éœ€è¦é‡æ–°æ³¨å†Œã€‚ å®¢æˆ·ç«¯é¡ºåºå›è°ƒ Watch å›è°ƒæ˜¯é¡ºåºä¸²è¡Œæ‰§è¡Œçš„ï¼Œå®¢æˆ·ç«¯åªæœ‰åœ¨å›è°ƒå®Œæˆåæ‰èƒ½çœ‹åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚ è½»é‡çº§ Watcher å›è°ƒé€»è¾‘ä¸åº”è¿‡å¤šï¼Œä»¥å…é˜»å¡æˆ–å½±å“å…¶ä»– Watch çš„æ‰§è¡Œã€‚ æœ€å°é€šä¿¡å•ä½ WatchEvent æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼ŒåªåŒ…å«é€šçŸ¥çŠ¶æ€ã€äº‹ä»¶ç±»å‹å’ŒèŠ‚ç‚¹è·¯å¾„ï¼Œä¸åŒ…å«èŠ‚ç‚¹æ•°æ®å˜åŒ–å‰åçš„å…·ä½“å†…å®¹ã€‚ æ—¶æ•ˆæ€§ Watcher ä»…åœ¨å½“å‰ Session å®Œå…¨å¤±æ•ˆæ—¶æ‰æ— æ•ˆã€‚å¦‚æœ Session å¿«é€Ÿé‡è¿æˆåŠŸï¼ŒWatcher ä¾ç„¶æœ‰æ•ˆï¼Œå¯ç»§ç»­æ¥æ”¶é€šçŸ¥ã€‚ å¯ä»¥å¼€å¯ç›‘å¬çš„å‘½ä»¤ 123456#ç›‘å¬èŠ‚ç‚¹æ•°æ®çš„å˜åŒ–get -w pathstat -w path#ç›‘å¬å­èŠ‚ç‚¹å¢å‡çš„å˜åŒ–ls -w path æ°¸ä¹…æ€§ Watch åœ¨è¢«è§¦å‘ä¹‹åï¼Œä»ç„¶ä¿ç•™ï¼Œå¯ä»¥ç»§ç»­ç›‘å¬ZNodeä¸Šçš„å˜æ›´ï¼Œæ˜¯Zookeeper 3.6.0ç‰ˆæœ¬æ–°å¢çš„åŠŸèƒ½ åˆ›å»ºç›‘å¬ 12345addWatch [-m mode] path# mode:# - PERSISTENT: æŒä¹…åŒ–è®¢é˜…ï¼Œé’ˆå¯¹å½“å‰èŠ‚ç‚¹çš„ä¿®æ”¹å’Œåˆ é™¤äº‹ä»¶ï¼Œä»¥åŠå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„åˆ é™¤å’Œæ–°å¢äº‹ä»¶ã€‚# - PERSISTENT_RECURSIVE: æŒä¹…åŒ–é€’å½’è®¢é˜…(è¿™ä¸ªæ˜¯é»˜è®¤å€¼)ï¼Œåœ¨PERSISTENTçš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†å­èŠ‚ç‚¹ä¿®æ”¹çš„äº‹ä»¶è§¦å‘ï¼Œä»¥åŠå­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„æ•°æ®å˜åŒ–éƒ½ä¼šè§¦å‘ç›¸å…³äº‹ä»¶ï¼ˆæ»¡è¶³é€’å½’è®¢é˜…ç‰¹æ€§ï¼‰ åˆ é™¤ç›‘å¬ 123456# æ™®é€šä¸€æ¬¡æ€§ Watch ä¸éœ€è¦æ‰‹åŠ¨åˆ é™¤ï¼Œè§¦å‘åä¼šè‡ªåŠ¨ç§»é™¤ï¼›removewatches ä¸»è¦ç”¨äºæŒä¹… Watchï¼ˆpersistent watchï¼‰ã€‚removewatches path [-c|-d|-a] [-l]# -c: ä»…åˆ é™¤å½“å‰å®¢æˆ·ç«¯çš„ Watch# -d: åˆ é™¤æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰ Watch(åŒ…æ‹¬å…¶ä»–å®¢æˆ·ç«¯æ³¨å†Œçš„)# -a: åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹çš„æ‰€æœ‰ Watchï¼ˆåŒ…æ‹¬å…¶ä»–å®¢æˆ·ç«¯çš„ Watchï¼‰ï¼Œæ…ç”¨ï¼ï¼ï¼# -l: æ˜¾ç¤ºè¢«åˆ é™¤çš„ Watch åˆ—è¡¨ ç›‘å¬å™¨åº”ç”¨åœºæ™¯ ç±»å‹ ç‰¹ç‚¹ åº”ç”¨åœºæ™¯ä¸¾ä¾‹ é€‚åˆçš„èŠ‚ç‚¹ç±»å‹ ä¸´æ—¶ç›‘å¬ï¼ˆä¸€æ¬¡æ€§ Watchï¼‰ - è§¦å‘ä¸€æ¬¡åè‡ªåŠ¨ç§»é™¤- å®¢æˆ·ç«¯éœ€æ‰‹åŠ¨é‡æ–°æ³¨å†Œ- è½»é‡çº§ï¼Œé€‚åˆå•æ¬¡é€šçŸ¥ 1. é…ç½®ä¸­å¿ƒï¼šé…ç½®å˜åŒ–æ—¶é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥åé‡æ–°æ‹‰å–æœ€æ–°é…ç½® 2. åˆ†å¸ƒå¼é”ï¼šèŠ‚ç‚¹åˆ é™¤ï¼ˆé”é‡Šæ”¾ï¼‰åé€šçŸ¥ç­‰å¾…çš„å®¢æˆ·ç«¯é‡æ–°ç«äº‰é” 3. ä¸»ä»é€‰ä¸¾ï¼šä¸»èŠ‚ç‚¹å®•æœºåï¼Œå…¶ä»–èŠ‚ç‚¹æ”¶åˆ°é€šçŸ¥é‡æ–°é€‰ä¸» æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰ ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEphemeralï¼Œç”¨äºé”å’Œé€‰ä¸»ï¼‰ æ°¸ä¹…ç›‘å¬ï¼ˆPersistent Watchï¼‰ - æ³¨å†ŒåæŒç»­æœ‰æ•ˆï¼Œç›´åˆ°å®¢æˆ·ç«¯ä¸»åŠ¨ç§»é™¤- æ”¯æŒå­èŠ‚ç‚¹å˜åŒ–ã€æ•°æ®å˜åŒ–çš„é•¿æœŸç›‘å¬ 1. æœåŠ¡å‘ç°ï¼šå®¢æˆ·ç«¯é•¿æœŸç›‘å¬æœåŠ¡èŠ‚ç‚¹å˜åŒ–ï¼ŒèŠ‚ç‚¹ä¸Šçº¿/ä¸‹çº¿æ—¶è‡ªåŠ¨æ›´æ–°æœ¬åœ°æœåŠ¡åˆ—è¡¨ 2. ç›‘æ§å‘Šè­¦ï¼šç›‘æ§é‡è¦èŠ‚ç‚¹çŠ¶æ€ï¼ŒèŠ‚ç‚¹æ•°æ®å˜åŒ–æˆ–è¢«åˆ é™¤æ—¶è‡ªåŠ¨è§¦å‘å‘Šè­¦ 3. åˆ†å¸ƒå¼ç¼“å­˜ï¼šç¼“å­˜èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œé€šçŸ¥å®¢æˆ·ç«¯åˆ·æ–°ç¼“å­˜ æŒä¹…èŠ‚ç‚¹ï¼ˆPersistentï¼‰ ACLæƒé™æ§åˆ¶ ZooKeeper é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æƒé™éƒ½æ˜¯ OPEN_ACL_UNSAFE ï¼Œä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¯»å†™ä»»æ„èŠ‚ç‚¹æ•°æ®ã€‚ ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸éœ€è¦é™åˆ¶å¯¹èŠ‚ç‚¹çš„è®¿é—®æƒé™ï¼Œå³ ACL æƒé™æ§åˆ¶ã€‚ ZooKeeper é‡Œçš„ ACLï¼ˆAccess Control Listï¼Œè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ ä¸»è¦ç”¨äºæ§åˆ¶ è°å¯ä»¥å¯¹æŸä¸ªèŠ‚ç‚¹åšä»€ä¹ˆæ“ä½œï¼Œå®ƒæ˜¯ ZooKeeper æä¾›çš„å®‰å…¨æœºåˆ¶ä¹‹ä¸€ã€‚ ACL çš„ä½œç”¨ é™åˆ¶è®¿é—®ï¼šåªå…è®¸æˆæƒç”¨æˆ·æˆ–å®¢æˆ·ç«¯å¯¹æŒ‡å®šèŠ‚ç‚¹è¿›è¡Œè¯»ã€å†™ã€åˆ é™¤ç­‰æ“ä½œã€‚ é˜²æ­¢è¯¯æ“ä½œï¼šä¿æŠ¤é‡è¦èŠ‚ç‚¹ä¸è¢«æœªæˆæƒçš„å®¢æˆ·ç«¯ä¿®æ”¹æˆ–åˆ é™¤ã€‚ å®‰å…¨éš”ç¦»ï¼šä¸åŒçš„åº”ç”¨æˆ–å›¢é˜Ÿå¯ä»¥åœ¨åŒä¸€ ZooKeeper é›†ç¾¤é‡Œå®‰å…¨å…±å­˜ã€‚ ACL çš„ç»„æˆ zookeeper çš„ acl é€šè¿‡ scheme:id:permissions æ¥æ„æˆæƒé™åˆ—è¡¨ã€‚ schemeï¼šæˆæƒçš„æ¨¡å¼ï¼Œä»£è¡¨é‡‡ç”¨çš„æŸç§æƒé™æœºåˆ¶ï¼ŒåŒ…æ‹¬ worldã€authã€digestã€ipã€super å‡ ç§ã€‚ idï¼šæˆæƒå¯¹è±¡ï¼Œä»£è¡¨å…è®¸è®¿é—®çš„ç”¨æˆ·ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹©é‡‡ç”¨ IP æ–¹å¼ï¼Œä½¿ç”¨çš„æˆæƒå¯¹è±¡å¯ä»¥æ˜¯ä¸€ä¸ª IP åœ°å€æˆ– IP åœ°å€æ®µï¼›è€Œå¦‚æœä½¿ç”¨ Digest æˆ– Super æ–¹å¼ï¼Œåˆ™å¯¹åº”äºä¸€ä¸ªç”¨æˆ·åã€‚å¦‚æœæ˜¯ World æ¨¡å¼ï¼Œæ˜¯æˆæƒç³»ç»Ÿä¸­æ‰€æœ‰çš„ç”¨æˆ·ã€‚ permissionsï¼šæˆæƒçš„æƒé™ï¼Œæƒé™ç»„åˆå­—ç¬¦ä¸²ï¼Œç”± cdrwa ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªå­—æ¯ä»£è¡¨æ”¯æŒä¸åŒæƒé™ï¼Œ åˆ›å»ºæƒé™ createÂ©ã€åˆ é™¤æƒé™ delete(d)ã€è¯»æƒé™ readÂ®ã€å†™æƒé™ write(w)ã€ç®¡ç†æƒé™admin(a)ã€‚ å¸¸è§çš„ scheme ç±»å‹ Scheme è¯´æ˜ ç¤ºä¾‹ world å¼€æ”¾ç»™æ‰€æœ‰ç”¨æˆ·ï¼Œä»…å¯è®¾ç½®ä¸º anyone ä»£è¡¨æ‰€æœ‰å®¢æˆ·ç«¯ world:anyone:r auth å·²é€šè¿‡ addauth æ·»åŠ è®¤è¯çš„å®¢æˆ·ç«¯ auth:user1:rw digest ç”¨æˆ·å+å¯†ç è®¤è¯ï¼ˆå¸¸ç”¨ï¼‰ï¼Œuser:pwd éœ€è¦åŠ å¯†å­˜å‚¨ digest:user1:password:rw ip åŸºäº IP åœ°å€æ§åˆ¶è®¿é—® ip:192.168.1.10:r super è¶…çº§ç”¨æˆ·ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ super:admin:secret æƒé™ç±»å‹ æƒé™å­—ç¬¦ æƒé™åç§° å…è®¸çš„æ“ä½œ/å‘½ä»¤ç¤ºä¾‹ è¯´æ˜ r è¯»å–(Read) get /node ls /node getAcl /node å…è®¸è¯»å–èŠ‚ç‚¹æ•°æ®å’Œå­èŠ‚ç‚¹åˆ—è¡¨ w å†™å…¥(Write) set /node data å…è®¸ä¿®æ”¹èŠ‚ç‚¹æ•°æ® c åˆ›å»º(Create) create /node/sub &quot;data&quot; å…è®¸åœ¨å½“å‰èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹ d åˆ é™¤(Delete) delete /node/sub å…è®¸åˆ é™¤å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ a ç®¡ç†(Admin) setAcl /node acl å…è®¸ä¿®æ”¹ ACL æƒé™ å…¸å‹åº”ç”¨åœºæ™¯ è®¤è¯æ–¹å¼ï¼ˆschemeï¼‰ æƒé™ç±»å‹ï¼ˆpermissionsï¼‰ å…¸å‹ ACL é…ç½®ç¤ºä¾‹ åº”ç”¨åœºæ™¯ ç‰¹ç‚¹è¯´æ˜ world rï¼ˆåªè¯»ï¼‰ world:anyone:r å…¬å…±é…ç½®èŠ‚ç‚¹ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½å¯è¯»å– ç®€å•ã€æ— è®¤è¯ï¼Œé€‚åˆå¯¹å®‰å…¨æ€§è¦æ±‚ä¸é«˜çš„åªè¯»åœºæ™¯ auth r,w,c,d,aï¼ˆå¯ç»„åˆï¼‰ auth:user:rwcd å†…éƒ¨åº”ç”¨å…±äº«èŠ‚ç‚¹ï¼Œéœ€å®¢æˆ·ç«¯è®¤è¯ éœ€å…ˆ addauth digest user1:password æ·»åŠ è®¤è¯ï¼Œé€‚åˆå¤šå®¢æˆ·ç«¯å…±äº« digestï¼ˆå¸¸ç”¨ï¼‰ r,w,c,d,aï¼ˆå¯ç»„åˆï¼‰ digest:user:secret:crwda é«˜å®‰å…¨èŠ‚ç‚¹ï¼Œé…ç½®ä¸­å¿ƒï¼Œåˆ†å¸ƒå¼é” ç”¨æˆ·å+å¯†ç è®¤è¯ï¼Œéœ€åŠ å¯†å­˜å‚¨å¯†ç ï¼Œçµæ´»å®‰å…¨ ip r,w,c,d,aï¼ˆå¯ç»„åˆï¼‰ ip:192.168.1.100:r åŸºäº IP é™åˆ¶è®¿é—®çš„åœºæ™¯ å¿«é€Ÿæ§åˆ¶æŸäº›å›ºå®š IP å¯è®¿é—®ï¼Œé€‚åˆå†…éƒ¨ç½‘ç»œåº”ç”¨ ACL ç›¸å…³å‘½ä»¤ å‘½ä»¤ è¯­æ³• åŠŸèƒ½è¯´æ˜ ç¤ºä¾‹ getAcl getAcl path è¯»å–æŒ‡å®šèŠ‚ç‚¹çš„ ACL getAcl /my_node setAcl setAcl path acl è®¾ç½®æŒ‡å®šèŠ‚ç‚¹çš„ ACL setAcl /my_node world:anyone:crdwa create create path data [acl] åˆ›å»ºèŠ‚ç‚¹æ—¶æŒ‡å®š ACL create /secure_node &quot;secret_data&quot; digest:user1:pwd:crwa addAuth addauth scheme auth æ·»åŠ è®¤è¯ç”¨æˆ·ï¼ˆç±»ä¼¼ç™»å½•ï¼‰ addauth digest user1:password deleteAcl(ä¸å­˜åœ¨) setAcl path world:anyone: åˆ é™¤èŠ‚ç‚¹ ACLï¼ˆè®¾ä¸ºç©ºæˆ–å…¨å¼€æ”¾ï¼‰ setAcl /my_node world:anyone: auth ä¸ digest çš„åŒºåˆ« ä½¿ç”¨ auth æ—¶ï¼Œéœ€å…ˆ addauth digest user1:password æ·»åŠ è®¤è¯ï¼ŒsetAcl æ—¶ï¼Œä½¿ç”¨ auth:user1:rwï¼Œè¿™é‡Œæ˜¯ä¸ºå·²ç»ç™»å½•çš„ç”¨æˆ·è®¾ç½®èŠ‚ç‚¹æƒé™ï¼Œæ‰€ä»¥ä¸éœ€è¦è®¾ç½®å¯†ç  ä½¿ç”¨ digest æ—¶ï¼Œæ— éœ€è¿›è¡Œç™»å½•è®¤è¯ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šå¯†ç ï¼Œå³setAcl æ—¶ï¼Œä½¿ç”¨ digest:user1:password:rw digest çš„å¯†ç æ˜¯ç»è¿‡åŠ å¯†çš„ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ä½¿ç”¨æ˜æ–‡å¯†ç  12345678910# åŠ å¯†å¯†ç echo -n user:123456 | openssl dgst -binary -sha1 | openssl base64# è¾“å‡º6DY5WhzOfGsWQ1XFuIyzxkpwdPo=# zookeeperå®¢æˆ·ç«¯ä¸­è®¾ç½®æƒé™setAcl /name digest:user:6DY5WhzOfGsWQ1XFuIyzxkpwdPo=:cdrwa# ç™»å½•æ—¶å¯†ç æ˜¯æ˜æ–‡addauth digest user:123456 æ— è®ºä½¿ç”¨ digest è¿˜æ˜¯ authï¼Œåœ¨éœ€è¦è®¿é—®èŠ‚ç‚¹å‰ï¼Œéƒ½éœ€è¦å…ˆç™»å½•ã€‚ super è¶…çº§ç®¡ç†å‘˜ æ‹¥æœ‰å…¨éƒ¨èŠ‚ç‚¹çš„æ‰€æœ‰æƒé™: crwda è®¾ç½®è¶…çº§ç®¡ç†å‘˜ 1234567# åŠ å¯†å¯†ç ï¼Œç”¨æˆ·å’Œå¯†ç å¯ä»¥éšæ„è®¾ç½®echo -n admin:123456 | openssl dgst -binary -sha1 | openssl base64# è¾“å‡º0uek/hZ/V9fgiM35b0Z2226acMQ=# æ‰“å¼€ conf/zoo.cfg æ–‡ä»¶å¹¶ç¼–è¾‘ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢å†…å®¹DigestAuthenticationProvider.superDigest=admin:0uek/hZ/V9fgiM35b0Z2226acMQ= é‡æ–°å¯åŠ¨æœåŠ¡åç™»å½•å®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯• 1234567891011# åˆ›å»ºèŠ‚ç‚¹å¹¶è®¾ç½®æƒé™ï¼Œè¿™é‡Œå°†èŠ‚ç‚¹æˆæƒç»™ç”¨æˆ·user[zk: localhost:2181(CONNECTED) 10] create /testNode 666 digest:user:6DY5WhzOfGsWQ1XFuIyzxkpwdPo=:rwCreated /testNode# æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹è¢«æ‹’ç»[zk: localhost:2181(CONNECTED) 11] get /testNodeInsufficient permission : /testNode# ç™»å½•superç”¨æˆ·ï¼ŒéªŒè¯è¶…çº§ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®èŠ‚ç‚¹[zk: localhost:2181(CONNECTED) 12] addauth digest admin:123456# æ­¤æ—¶æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹å°±å¯ä»¥äº†[zk: localhost:2181(CONNECTED) 13] get /testNode666 4å­—æ¯å‘½ä»¤ ä»€ä¹ˆæ˜¯ 4 å­—æ¯å‘½ä»¤? ZooKeeper æä¾›äº†ä¸€ç»„ç®€çŸ­çš„ 4ä¸ªå­—æ¯çš„ç®¡ç†å‘½ä»¤(Four Letter Words Commands, 4lw)ï¼Œå¯ä»¥é€šè¿‡ TCP è¿æ¥ ZooKeeper ç«¯å£ï¼ˆé»˜è®¤ 2181ï¼‰å‘é€è¿™äº›å‘½ä»¤ï¼Œå¿«é€ŸæŸ¥çœ‹æˆ–ç®¡ç† ZooKeeper çŠ¶æ€ã€‚ å¸¸ç”¨çš„ 4å­—æ¯å‘½ä»¤ å‘½ä»¤ å¼•å…¥ç‰ˆæœ¬ åŠŸèƒ½æè¿° ç¤ºä¾‹ conf 3.3.0 æ‰“å°æœåŠ¡ç›¸å…³é…ç½®çš„è¯¦ç»†ä¿¡æ¯ echo conf | nc 127.0.0.1 2181 cons 3.3.0 åˆ—å‡ºæ‰€æœ‰è¿æ¥åˆ°è¯¥æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥/ä¼šè¯è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥æ”¶/å‘é€çš„åŒ…æ•°é‡ã€ä¼šè¯IDã€æ“ä½œå»¶è¿Ÿã€æœ€åæ“ä½œæ‰§è¡Œæ—¶é—´ç­‰ echo cons | nc 127.0.0.1 2181 crst 3.3.0 é‡ç½®æ‰€æœ‰è¿æ¥çš„è¿æ¥å’Œä¼šè¯ç»Ÿè®¡ä¿¡æ¯ echo crst | nc 127.0.0.1 2181 dump - åˆ—å‡ºé‡è¦çš„ä¼šè¯å’Œä¸´æ—¶èŠ‚ç‚¹ä¿¡æ¯ï¼Œä»…åœ¨ Leader èŠ‚ç‚¹ä¸Šæœ‰æ•ˆ echo dump | nc 127.0.0.1 2181 envi - æ‰“å°æœåŠ¡ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯ echo envi | nc 127.0.0.1 2181 reqs - åˆ—å‡ºæœªç»å¤„ç†çš„è¯·æ±‚ echo reqs | nc 127.0.0.1 2181 ruok - æµ‹è¯•æœåŠ¡æ˜¯å¦å¤„äºæ­£å¸¸çŠ¶æ€ï¼›æ­£å¸¸è¿”å› imok echo ruok | nc 127.0.0.1 2181 stat - è¾“å‡ºå…³äºæ€§èƒ½å’Œå®¢æˆ·ç«¯è¿æ¥çš„åˆ—è¡¨ä¿¡æ¯ echo stat | nc 127.0.0.1 2181 srst - é‡ç½®æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯ echo srst | nc 127.0.0.1 2181 srvr 3.3.0 åˆ—å‡ºè¿æ¥æœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯ echo srvr | nc 127.0.0.1 2181 wchs 3.3.0 åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ echo wchs | nc 127.0.0.1 2181 wchc 3.3.0 é€šè¿‡ä¼šè¯åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ Watch ç›¸å…³çš„ä¼šè¯åˆ—è¡¨ echo wchc | nc 127.0.0.1 2181 wchp 3.3.0 é€šè¿‡è·¯å¾„åˆ—å‡ºæœåŠ¡å™¨ Watch çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¾“å‡ºä¸ä¼šè¯ç›¸å…³çš„è·¯å¾„ echo wchp | nc 127.0.0.1 2181 mntr 3.4.0 è¾“å‡ºå¯ç”¨äºæ£€æµ‹é›†ç¾¤å¥åº·çŠ¶æ€çš„å…³é”®æŒ‡æ ‡å˜é‡åˆ—è¡¨ echo mntr | nc 127.0.0.1 2181 å¼€å¯ 4å­—æ¯å‘½ä»¤ åœ¨ ZooKeeper 3.5.0 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œ4lw å‘½ä»¤é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå¿…é¡»åœ¨é…ç½®æ–‡ä»¶(zoo.cfg)ä¸­æ˜¾å¼å¼€å¯ã€‚ 1234# è¡¨ç¤ºå…è®¸æ‰€æœ‰ 4lw å‘½ä»¤éƒ½èƒ½ç”¨ï¼ˆé£é™©æœ€å¤§ï¼‰4lw.commands.whitelist=*# è¿™æ ·åªå…è®¸æ‰§è¡Œ statã€confã€ruok è¿™å‡ ä¸ªå‘½ä»¤ã€‚4lw.commands.whitelist=stat,conf,ruok ä½¿ç”¨æ–¹æ³• 1234# å¦‚æœæ²¡æœ‰å®‰è£… ncï¼Œå¯ä»¥ä½¿ç”¨ yum å®‰è£…yum install nc -y# æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€echo stat | nc 127.0.0.1 2181 Zookeeper Java Client é¡¹ç›®ç¤ºä¾‹ï¼šGithubåœ°å€ï¼Œå•å…ƒæµ‹è¯•ã€‚ Zookeeper å®˜æ–¹Javaå®¢æˆ·ç«¯ ZooKeeperå®˜æ–¹çš„å®¢æˆ·ç«¯APIæä¾›äº†åŸºæœ¬çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¼šè¯ã€åˆ›å»ºèŠ‚ç‚¹ã€è¯»å–èŠ‚ç‚¹ã€æ›´æ–°æ•°æ®ã€åˆ é™¤èŠ‚ç‚¹å’Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ç­‰ã€‚ä¸è¿‡ï¼Œå¯¹äºå®é™…å¼€å‘æ¥è¯´ï¼ŒZooKeeperå®˜æ–¹APIæœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š ZooKeeperçš„Watcherç›‘æµ‹æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ¯æ¬¡è§¦å‘ä¹‹åéƒ½éœ€è¦é‡æ–°è¿›è¡Œæ³¨å†Œã€‚ ä¼šè¯è¶…æ—¶ä¹‹åæ²¡æœ‰å®ç°é‡è¿æœºåˆ¶ã€‚ å¼‚å¸¸å¤„ç†çƒ¦çï¼ŒZooKeeperæä¾›äº†å¾ˆå¤šå¼‚å¸¸ï¼Œå¯¹äºå¼€å‘äººå‘˜æ¥è¯´å¯èƒ½æ ¹æœ¬ä¸çŸ¥é“åº”è¯¥å¦‚ä½•å¤„ç†è¿™äº›æŠ›å‡ºçš„å¼‚å¸¸ã€‚ ä»…æä¾›äº†ç®€å•çš„byte[]æ•°ç»„ç±»å‹çš„æ¥å£ï¼Œæ²¡æœ‰æä¾›Java POJOçº§åˆ«çš„åºåˆ—åŒ–æ•°æ®å¤„ç†æ¥å£ã€‚ åˆ›å»ºèŠ‚ç‚¹æ—¶å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦è‡ªè¡Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ã€‚ æ— æ³•å®ç°çº§è”åˆ é™¤ã€‚ æ€»ä¹‹ï¼ŒZooKeeperå®˜æ–¹APIåŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­æ¯”è¾ƒç¬¨é‡ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚ é¡¹ç›®å¼•å…¥ä¾èµ–æ—¶ï¼Œæœ€å¥½ä¿æŒä¸æœåŠ¡ç«¯ç‰ˆæœ¬ä¸€è‡´ï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰ä¸€äº›å…¼å®¹æ€§çš„é—®é¢˜ 123456&lt;!-- zookeeper client --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.8.4&lt;/version&gt;&lt;/dependency&gt; Zookeeper ç¬¬ä¸‰æ–¹Javaå®¢æˆ·ç«¯ Curator Curatoræ˜¯Netflixå…¬å¸å¼€æºçš„ä¸€å¥—ZooKeeperå®¢æˆ·ç«¯æ¡†æ¶ï¼Œå’ŒZkClientä¸€æ ·å®ƒè§£å†³äº†éå¸¸åº•å±‚çš„ç»†èŠ‚å¼€å‘å·¥ä½œï¼ŒåŒ…æ‹¬è¿æ¥ã€é‡è¿ã€åå¤æ³¨å†ŒWatcherçš„é—®é¢˜ä»¥åŠNodeExistsExceptionå¼‚å¸¸ç­‰ã€‚ Curatoræ˜¯ApacheåŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ä¹‹ä¸€ï¼ŒCuratorå…·æœ‰æ›´åŠ å®Œå–„çš„æ–‡æ¡£ï¼Œå¦å¤–è¿˜æä¾›äº†ä¸€å¥—æ˜“ç”¨æ€§å’Œå¯è¯»æ€§æ›´å¼ºçš„Fluenté£æ ¼çš„å®¢æˆ·ç«¯APIæ¡†æ¶ã€‚ Curatorè¿˜ä¸ºZooKeeperå®¢æˆ·ç«¯æ¡†æ¶æä¾›äº†ä¸€äº›æ¯”è¾ƒæ™®éçš„ã€å¼€ç®±å³ç”¨çš„ã€åˆ†å¸ƒå¼å¼€å‘ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚Recipeã€å…±äº«é”æœåŠ¡ã€Masteré€‰ä¸¾æœºåˆ¶å’Œåˆ†å¸ƒå¼è®¡ç®—å™¨ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…é¿å…äº†â€œé‡å¤é€ è½®å­â€çš„æ— æ•ˆå¼€å‘å·¥ä½œã€‚ åœ¨å®é™…çš„å¼€å‘åœºæ™¯ä¸­ï¼Œä½¿ç”¨Curatorå®¢æˆ·ç«¯å°±è¶³ä»¥åº”ä»˜æ—¥å¸¸çš„ZooKeeperé›†ç¾¤æ“ä½œçš„éœ€æ±‚ã€‚ å¼•å…¥ä¾èµ–è¯´æ˜ï¼š æ¨¡å— ä¾èµ–å…³ç³» åŠŸèƒ½å®šä½ å…¸å‹åŠŸèƒ½ä¸¾ä¾‹ å¸¸ç”¨åœºæ™¯ curator-client ä¾èµ– zookeeper è¿æ¥ç®¡ç†ã€é‡è¯•ç­–ç•¥ã€åº•å±‚ API è¿æ¥ä¼šè¯ç®¡ç†ã€RetryPolicy éœ€è¦æœ€è½»é‡çš„ ZooKeeper å®¢æˆ·ç«¯ curator-framework ä¾èµ– curator-client é«˜å±‚ API å°è£…ï¼Œç®€åŒ– ZK æ“ä½œ åˆ›å»ºèŠ‚ç‚¹ã€Watcher ç®¡ç†ã€è‡ªåŠ¨é‡è¿ é€šç”¨ ZooKeeper å®¢æˆ·ç«¯å¼€å‘ curator-recipes ä¾èµ– curator-framework â†’ curator-client åˆ†å¸ƒå¼æ¨¡å¼ç°æˆå®ç° åˆ†å¸ƒå¼é”ã€Leader é€‰ä¸¾ã€é˜Ÿåˆ—ã€Barrier ç›´æ¥ç”¨åˆ†å¸ƒå¼å·¥å…·ï¼Œæ— éœ€è‡ªå·±å®ç° ä½¿ç”¨å»ºè®® å¦‚æœä½ åªæƒ³è½»é‡è®¿é—® ZooKeeper â†’ curator-client å°±å¤Ÿäº†ï¼Œä½†å‡ ä¹æ²¡äººå•ç‹¬ç”¨ã€‚ å¦‚æœä½ æƒ³æ–¹ä¾¿æ“ä½œ ZooKeeper API â†’ curator-frameworkï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½é€‚ç”¨ã€‚ å¦‚æœä½ æƒ³ç”¨åˆ†å¸ƒå¼é”ã€é€‰ä¸¾ã€Barrier â†’ curator-recipesï¼ˆå®ƒä¼šè‡ªåŠ¨å¼•å…¥å‰ä¸¤ä¸ªï¼‰ã€‚ 12345678910111213141516171819&lt;!-- zookeeper client --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.8.4&lt;/version&gt;&lt;/dependency&gt;&lt;!--curator--&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.curator&lt;/groupId&gt; &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt; &lt;version&gt;5.9.0&lt;/version&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» CentOS9 ä¸­ Zookeeper çš„å®‰è£…ä¸ä½¿ç”¨ã€‚ Zookeeperå®˜ç½‘ æœ¬æ–‡ä½¿ç”¨çš„ Zookeeper ç‰ˆæœ¬ä¸º 3.8.4ã€‚","date_published":"2025-09-15T13:30:05.000Z","tags":["æŠ€æœ¯","zookeeper","åˆ†å¸ƒå¼","zookeeper"]},{"id":"https://blog.hanqunfeng.com/2025/09/11/springboot3-shardingsphere-proxy-distsql/","url":"https://blog.hanqunfeng.com/2025/09/11/springboot3-shardingsphere-proxy-distsql/","title":"ShardingSphere-Proxy5.5.2 DistSQL","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» ShardingSphere-Proxy5.5.2 DistSQL çš„ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/index_zh.html\">ShardingSphereå®˜ç½‘</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"DistSQL\">DistSQL</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/\">DistSQL</a>ï¼ˆDistributed SQLï¼‰æ˜¯ Apache ShardingSphere ç‰¹æœ‰çš„æ“ä½œè¯­è¨€ã€‚ å®ƒä¸æ ‡å‡† SQL çš„ä½¿ç”¨æ–¹å¼å®Œå…¨ä¸€è‡´ï¼Œç”¨äºæä¾›å¢é‡åŠŸèƒ½çš„ SQL çº§åˆ«æ“ä½œèƒ½åŠ›ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>çµæ´»çš„è§„åˆ™é…ç½®å’Œèµ„æºç®¡æ§èƒ½åŠ›æ˜¯ Apache ShardingSphere çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ä½¿ç”¨ 4.x åŠå…¶ä¹‹å‰ç‰ˆæœ¬æ—¶ï¼Œå¼€å‘è€…è™½ç„¶å¯ä»¥åƒä½¿ç”¨åŸç”Ÿæ•°æ®åº“ä¸€æ ·æ“ä½œæ•°æ®ï¼Œä½†å´éœ€è¦é€šè¿‡æœ¬åœ°æ–‡ä»¶æˆ–æ³¨å†Œä¸­å¿ƒé…ç½®èµ„æºå’Œè§„åˆ™ã€‚ç„¶è€Œï¼Œæ“ä½œä¹ æƒ¯å˜æ›´ï¼Œå¯¹äºè¿ç»´å·¥ç¨‹å¸ˆå¹¶ä¸å‹å¥½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä» 5.x ç‰ˆæœ¬å¼€å§‹ï¼ŒDistSQLï¼ˆDistributed SQLï¼‰è®©ç”¨æˆ·å¯ä»¥åƒæ“ä½œæ•°æ®åº“ä¸€æ ·æ“ä½œ Apache ShardingSphereï¼Œä½¿å…¶ä»é¢å‘å¼€å‘äººå‘˜çš„æ¡†æ¶å’Œä¸­é—´ä»¶è½¬å˜ä¸ºé¢å‘è¿ç»´äººå‘˜çš„æ•°æ®åº“äº§å“ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>DistSQL ç»†åˆ†ä¸º RDLã€RQLã€RAL å’Œ RUL å››ç§ç±»å‹ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">RDL: Resource &amp; Rule Definition Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤ã€‚</li>\n<li class=\"lvl-4\">RQL: Resource &amp; Rule Query Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„æŸ¥è¯¢å’Œå±•ç°ã€‚</li>\n<li class=\"lvl-4\">RAL: Resource &amp; Rule Administration Languageï¼Œè´Ÿè´£å¼ºåˆ¶è·¯ç”±ã€ç†”æ–­ã€é…ç½®å¯¼å…¥å¯¼å‡ºã€æ•°æ®è¿ç§»æ§åˆ¶ç­‰ç®¡ç†åŠŸèƒ½ã€‚</li>\n<li class=\"lvl-4\">RUL: Resource &amp; Rule Utility Languageï¼Œè´Ÿè´£ SQL è§£æã€SQL æ ¼å¼åŒ–ã€æ‰§è¡Œè®¡åˆ’é¢„è§ˆç­‰åŠŸèƒ½ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>DistSQL ä»…å¯ä»¥åœ¨ ShardingSphere-Proxy ä¸­ä½¿ç”¨ï¼Œä¸èƒ½åœ¨ ShardingSphere-JDBC ä¸­ä½¿ç”¨ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ç¤ºä¾‹å‡†å¤‡\">ç¤ºä¾‹å‡†å¤‡</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…·ä½“çš„è¯­æ³•ï¼Œå®˜ç½‘ä»‹ç»çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡ŒåŸºäº <a href=\"/2025/09/04/springboot3-shardingsphere-proxy/\" title=\"SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨\">SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨</a> ä¸­çš„é…ç½®è¿›è¡Œç¤ºä¾‹è¯´æ˜ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ºäº†å°½å¯èƒ½å¤šçš„ä½¿ç”¨ DistSQL è¯­æ³•ï¼Œè¿™é‡Œä»…åœ¨ <code>global.yaml</code> ä¸­é…ç½®å¦‚ä¸‹å†…å®¹:</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é…ç½®ä¸ºåŸºäº zookeeper é›†ç¾¤æ¨¡å¼ï¼Œä¸ºäº†æ¼”ç¤º DistSQL è¯­æ³•ï¼Œè¿™é‡Œéœ€è¦å°†é…ç½®æŒä¹…åŒ–ï¼Œä½¿ç”¨ JDBC çš„å•æœºæ¨¡å¼ä¹Ÿå¯ä»¥</span></span><br><span class=\"line\"><span class=\"attr\">mode:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">Cluster</span>                 <span class=\"comment\"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class=\"line\">  <span class=\"attr\">repository:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">ZooKeeper</span>             <span class=\"comment\"># æ³¨å†Œä¸­å¿ƒç±»å‹</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">governance_ds</span>  <span class=\"comment\"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class=\"line\">      <span class=\"attr\">server-lists:</span> <span class=\"string\">localhost:2181</span> <span class=\"comment\"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class=\"line\">      <span class=\"attr\">retryIntervalMilliseconds:</span> <span class=\"number\">500</span> <span class=\"comment\"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">timeToLiveSeconds:</span> <span class=\"number\">60</span>     <span class=\"comment\"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"attr\">maxRetries:</span> <span class=\"number\">3</span>             <span class=\"comment\"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">operationTimeoutMilliseconds:</span> <span class=\"number\">500</span>  <span class=\"comment\"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é…ç½®ç”¨æˆ·å’Œæƒé™ï¼Œå› ä¸º DistSQL æš‚ä¸æ”¯æŒ ç”¨æˆ·å’Œæƒé™ç®¡ç†ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å…ˆé…ç½®ç”¨æˆ·å’Œæƒé™</span></span><br><span class=\"line\"><span class=\"attr\">authority:</span></span><br><span class=\"line\">  <span class=\"attr\">users:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">user:</span> <span class=\"string\">root@127.0.0.1</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">root</span></span><br><span class=\"line\">      <span class=\"attr\">admin:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">user:</span> <span class=\"string\">sharding@%</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">sharding</span></span><br><span class=\"line\">  <span class=\"attr\">privilege:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">DATABASE_PERMITTED</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">user-database-mappings:</span> <span class=\"string\">root@127.0.0.1=*,sharding@%=sharding_db</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ ShardingSphere-Proxy æœåŠ¡ï¼Œå¹¶ç™»å½•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ ShardingSphere-Proxy</span></span><br><span class=\"line\">./shardingsphere-proxy-bin/bin/start.sh</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ç®¡ç†å‘˜ç™»å½•</span></span><br><span class=\"line\">mysql -h127.0.0.1 -uroot -proot -P3307</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™</span></span><br><span class=\"line\">mysql&gt; SHOW AUTHORITY RULE;</span><br><span class=\"line\">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class=\"line\">| <span class=\"built_in\">users</span>                      | provider           | props                                                                |</span><br><span class=\"line\">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class=\"line\">| root@127.0.0.1; sharding@% | DATABASE_PERMITTED | &#123;<span class=\"string\">&quot;user-database-mappings&quot;</span>:<span class=\"string\">&quot;root@127.0.0.1=*,sharding@%=sharding_db&quot;</span>&#125; |</span><br><span class=\"line\">+----------------------------+--------------------+----------------------------------------------------------------------+</span><br><span class=\"line\">1 row <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.49 sec)</span><br></pre></td></tr></table></figure>\n<h2 id=\"å…¨å±€é…ç½®ï¼Œå³global-yamlä¸­çš„é…ç½®\">å…¨å±€é…ç½®ï¼Œå³<code>global.yaml</code>ä¸­çš„é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å…¨å±€é…ç½®å¯¹æ‰€æœ‰é€»è¾‘æ•°æ®åº“æœ‰æ•ˆ</p>\n</li>\n</ul>\n<h3 id=\"å±æ€§é…ç½®\">å±æ€§é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">props:</span></span><br><span class=\"line\">  <span class=\"attr\">sql-show:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"DistSQL-è¯­æ³•\">DistSQL è¯­æ³•</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¾ç½®å±æ€§ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/set-dist-vairable/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè¦æ³¨æ„ï¼Œå±æ€§åéœ€è¦ä½¿ç”¨ä¸‹åˆ’çº¿æ ¼å¼</span></span><br><span class=\"line\">SET DIST VARIABLE sql_show = <span class=\"literal\">true</span>;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å±æ€§ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/show-dist-variable/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; SHOW DIST VARIABLES;</span><br><span class=\"line\">+-----------------------------------------+-----------------+</span><br><span class=\"line\">| variable_name                           | variable_value  |</span><br><span class=\"line\">+-----------------------------------------+-----------------+</span><br><span class=\"line\">| agent_plugins_enabled                   | <span class=\"literal\">true</span>            |</span><br><span class=\"line\">| cached_connections                      | 0               |</span><br><span class=\"line\">| cdc_server_port                         | 33071           |</span><br><span class=\"line\">| check_table_metadata_enabled            | <span class=\"literal\">false</span>           |</span><br><span class=\"line\">| kernel_executor_size                    | 0               |</span><br><span class=\"line\">| load_table_metadata_batch_size          | 1000            |</span><br><span class=\"line\">| max_connections_size_per_query          | 1               |</span><br><span class=\"line\">| proxy_backend_query_fetch_size          | -1              |</span><br><span class=\"line\">| proxy_default_port                      | 3307            |</span><br><span class=\"line\">| proxy_frontend_database_protocol_type   |                 |</span><br><span class=\"line\">| proxy_frontend_executor_size            | 0               |</span><br><span class=\"line\">| proxy_frontend_flush_threshold          | 128             |</span><br><span class=\"line\">| proxy_frontend_max_connections          | 0               |</span><br><span class=\"line\">| proxy_frontend_ssl_cipher               |                 |</span><br><span class=\"line\">| proxy_frontend_ssl_enabled              | <span class=\"literal\">false</span>           |</span><br><span class=\"line\">| proxy_frontend_ssl_version              | TLSv1.2,TLSv1.3 |</span><br><span class=\"line\">| proxy_meta_data_collector_enabled       | <span class=\"literal\">false</span>           |</span><br><span class=\"line\">| proxy_netty_backlog                     | 1024            |</span><br><span class=\"line\">| sql_show                                | <span class=\"literal\">true</span>            |</span><br><span class=\"line\">| sql_simple                              | <span class=\"literal\">false</span>           |</span><br><span class=\"line\">| system_log_level                        | INFO            |</span><br><span class=\"line\">| system_schema_metadata_assembly_enabled | <span class=\"literal\">true</span>            |</span><br><span class=\"line\">+-----------------------------------------+-----------------+</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ†å¸ƒå¼äº‹åŠ¡é…ç½®\">åˆ†å¸ƒå¼äº‹åŠ¡é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">transaction:</span></span><br><span class=\"line\">  <span class=\"attr\">defaultType:</span> <span class=\"string\">XA</span></span><br><span class=\"line\">  <span class=\"attr\">providerType:</span> <span class=\"string\">Atomikos</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"DistSQL-è¯­æ³•-2\">DistSQL è¯­æ³•</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹äº‹åŠ¡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/global-rule/show-transaction-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW TRANSACTION RULE;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹äº‹åŠ¡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/ral/global-rule/alter-transaction-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TRANSACTION RULE(</span><br><span class=\"line\">  DEFAULT=<span class=\"string\">&quot;XA&quot;</span>, TYPE(NAME=<span class=\"string\">&quot;Atomikos&quot;</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h2 id=\"è§„åˆ™é…ç½®ï¼Œå³database-xxx-yamlä¸­çš„é…ç½®\">è§„åˆ™é…ç½®ï¼Œå³<code>database-xxx.yaml</code>ä¸­çš„é…ç½®</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä»¥ä¸‹ DistSQL ä»…å¯ä»¥åœ¨é€»è¾‘åº“ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªé€»è¾‘æ•°æ®åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; CREATE DATABASE sharding_db;</span><br><span class=\"line\">Query OK, 0 rows affected (0.03 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; use sharding_db;</span><br><span class=\"line\">Database changed</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ•°æ®æºé…ç½®\">æ•°æ®æºé…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ DistSQLä¸­ï¼Œå®˜æ–¹å°†æ•°æ®æºå«åš<code>å­˜å‚¨å•å…ƒ(STORAGE UNIT)</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_0:</span> <span class=\"comment\"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>  <span class=\"comment\"># æ³¨æ„è¿™é‡Œå±æ€§ä¸º url</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">ds_1:</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"DistSQL-è¯­æ³•-3\">DistSQL è¯­æ³•</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨å†Œå­˜å‚¨å•å…ƒï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/register-storage-unit/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">REGISTER STORAGE UNIT ds_0 (</span><br><span class=\"line\">    URL=<span class=\"string\">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class=\"line\">    USER=<span class=\"string\">&quot;root&quot;</span>,</span><br><span class=\"line\">    PASSWORD=<span class=\"string\">&quot;newpwd&quot;</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">REGISTER STORAGE UNIT ds_1 (</span><br><span class=\"line\">    URL=<span class=\"string\">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class=\"line\">    USER=<span class=\"string\">&quot;root&quot;</span>,</span><br><span class=\"line\">    PASSWORD=<span class=\"string\">&quot;newpwd&quot;</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢å­˜å‚¨å•å…ƒï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/storage-unit-query/show-storage-units/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW STORAGE UNITS FROM sharding_db \\G;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹å­˜å‚¨å•å…ƒï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/alter-storage-unit/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER STORAGE UNIT ds_1 (</span><br><span class=\"line\">    URL=<span class=\"string\">&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>,</span><br><span class=\"line\">    USER=<span class=\"string\">&quot;root&quot;</span>,</span><br><span class=\"line\">    PASSWORD=<span class=\"string\">&quot;newpwd&quot;</span>,</span><br><span class=\"line\">    PROPERTIES(<span class=\"string\">&quot;maximumPoolSize&quot;</span>=10,<span class=\"string\">&quot;idleTimeout&quot;</span>=30000)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å–æ¶ˆæ³¨å†Œå­˜å‚¨å•å…ƒï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/storage-unit-definition/unregister-storage-unit/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ— æ³•ç§»é™¤å·²ç»è¢«è§„åˆ™ä½¿ç”¨çš„å­˜å‚¨å•å…ƒ</span></span><br><span class=\"line\">UNREGISTER STORAGE UNIT ds_0;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å•è¡¨é…ç½®\">å•è¡¨é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SINGLE</span> <span class=\"comment\"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"comment\"># MySQL é£æ ¼</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ds_0.t_address</span> <span class=\"comment\"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"DistSQL-è¯­æ³•-4\">DistSQL è¯­æ³•</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŠ è½½å•è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/single-table/load-single-table/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LOAD SINGLE TABLE ds_0.t_address;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢å•è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/single-table/show-single-table/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW SINGLE TABLES;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸è½½å•è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/single-table/unload-single-table/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UNLOAD SINGLE TABLE ds_0.t_address;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¹¿æ’­è¡¨é…ç½®\">å¹¿æ’­è¡¨é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!BROADCAST</span>  <span class=\"comment\"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">dict</span>    <span class=\"comment\"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"DistSQL-è¯­æ³•-5\">DistSQL è¯­æ³•</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºå¹¿æ’­è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/broadcast-table/create-broadcast-table-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE BROADCAST TABLE RULE dict;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤å¹¿æ’­è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/broadcast-table/drop-broadcast-table-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP BROADCAST TABLE RULE dict;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢å¹¿æ’­è¡¨ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/broadcast-table/show-broadcast-table-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨</span></span><br><span class=\"line\">SHOW BROADCAST TABLE RULES;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æŒ‡å®šæ•°æ®åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨</span></span><br><span class=\"line\">SHOW BROADCAST TABLE RULES FROM sharding_db;</span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ†åº“åˆ†è¡¨é…ç½®\">åˆ†åº“åˆ†è¡¨é…ç½®</h3>\n<h4 id=\"å•åˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹\">å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">course:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">cid</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_inline</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">cid</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">course_inline:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># å±æ€§</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">course_$&#123;cid</span> <span class=\"string\">%</span> <span class=\"number\">2</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class=\"line\">          <span class=\"attr\">allow-range-query-with-inline-sharding:</span> <span class=\"literal\">true</span> <span class=\"comment\"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class=\"line\">      <span class=\"attr\">course_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-6\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/create-sharding-table-rule/#1%E6%A0%87%E5%87%86%E5%88%86%E7%89%87%E8%A7%84%E5%88%99\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE SHARDING TABLE RULE course (</span><br><span class=\"line\">  DATANODES(<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;0..1&#125;</span>.course_<span class=\"variable\">$&#123;1..2&#125;</span>&quot;</span>),</span><br><span class=\"line\">  DATABASE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  TABLE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=cid,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;course_<span class=\"variable\">$&#123;cid % 2 + 1&#125;</span>&quot;</span>,<span class=\"string\">&quot;allow-range-query-with-inline-sharding&quot;</span>=<span class=\"literal\">true</span> )))),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=cid,TYPE(NAME=<span class=\"string\">&quot;snowflake&quot;</span>))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h4 id=\"å•åˆ†ç‰‡é”®ï¼ŒString-ç±»å‹\">å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class=\"line\"><span class=\"comment\">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">custom_snowflake_string</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span> <span class=\"comment\"># åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®—</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span> <span class=\"comment\"># åˆ†è¡¨ï¼Œt_user_0, t_user_1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">uuid:</span>    <span class=\"comment\"># å®šä¹‰åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">UUID</span> <span class=\"comment\"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class=\"line\">      <span class=\"attr\">custom_snowflake_string:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CUSTOM_SNOWFLAKE_STRING</span> <span class=\"comment\"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">workerId:</span> <span class=\"number\">2</span></span><br><span class=\"line\">          <span class=\"attr\">datacenterId:</span> <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-7\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE SHARDING TABLE RULE t_user (</span><br><span class=\"line\">  DATANODES(<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;0..1&#125;</span>.t_user_<span class=\"variable\">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class=\"line\">  DATABASE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=<span class=\"built_in\">id</span>,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;Math.abs(id.hashCode()%2)&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  TABLE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=<span class=\"built_in\">id</span>,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;t_user_<span class=\"variable\">$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=<span class=\"built_in\">id</span>,TYPE(NAME=<span class=\"string\">&quot;CUSTOM_SNOWFLAKE_STRING&quot;</span>))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¤šåˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹\">å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order-complex-algorithm</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class=\"line\"><span class=\"comment\">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_item-class-based-algorithm_spi</span> <span class=\"comment\"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order-complex-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">COMPLEX_INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_order_complex_$&#123;(user_id</span> <span class=\"string\">+</span> <span class=\"string\">order_id</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">)</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm_spi:</span> <span class=\"comment\"># SPI</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">T_ORDER_ITEM_COMPLEX</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-8\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE SHARDING TABLE RULE t_order_complex (</span><br><span class=\"line\">  DATANODES(<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;0..1&#125;</span>.t_order_complex_<span class=\"variable\">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class=\"line\">  DATABASE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  TABLE_STRATEGY(TYPE=<span class=\"string\">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;complex_inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;t_order_complex_<span class=\"variable\">$&#123;(user_id + order_id + 1) % 2&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=<span class=\"string\">&quot;snowflake&quot;</span>))</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE SHARDING TABLE RULE t_order_item_complex (</span><br><span class=\"line\">  DATANODES(<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;0..1&#125;</span>.t_order_item_complex_<span class=\"variable\">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class=\"line\">  DATABASE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  TABLE_STRATEGY(TYPE=<span class=\"string\">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;T_ORDER_ITEM_COMPLEX&quot;</span>))),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class=\"string\">&quot;SNOWFLAKE&quot;</span>))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h4 id=\"è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™\">è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">   <span class=\"comment\"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">bindingTables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">t_order,t_order_item</span></span><br><span class=\"line\">    <span class=\"attr\">autoTables:</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">mod_2:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MOD</span> <span class=\"comment\"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">sharding-count:</span> <span class=\"number\">2</span> <span class=\"comment\"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-9\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåˆ†ç‰‡è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE SHARDING TABLE RULE t_order (</span><br><span class=\"line\">  STORAGE_UNITS(ds_0,ds_1),</span><br><span class=\"line\">  SHARDING_COLUMN=user_id,TYPE(NAME=<span class=\"string\">&quot;mod&quot;</span>,PROPERTIES(<span class=\"string\">&quot;sharding-count&quot;</span>=<span class=\"string\">&quot;2&quot;</span>)),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=<span class=\"string\">&quot;snowflake&quot;</span>))</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">CREATE SHARDING TABLE RULE t_order_item (</span><br><span class=\"line\">  STORAGE_UNITS(ds_0,ds_1),</span><br><span class=\"line\">  SHARDING_COLUMN=user_id,TYPE(NAME=<span class=\"string\">&quot;mod&quot;</span>,PROPERTIES(<span class=\"string\">&quot;sharding-count&quot;</span>=<span class=\"string\">&quot;2&quot;</span>)),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class=\"string\">&quot;snowflake&quot;</span>))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h4 id=\"å…¶å®ƒåˆ†ç‰‡æ“ä½œè¯­å¥\">å…¶å®ƒåˆ†ç‰‡æ“ä½œè¯­å¥</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢åˆ†ç‰‡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/sharding/show-sharding-table-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰é€»è¾‘åº“ä¸‹çš„æ‰€æœ‰åˆ†ç‰‡è§„åˆ™</span></span><br><span class=\"line\">SHOW SHARDING TABLE RULES \\G;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šé€»è¾‘åº“ä¸‹çš„åˆ†ç‰‡è§„åˆ™</span></span><br><span class=\"line\">SHOW SHARDING TABLE RULES FROM sharding_db; \\G;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šåˆ†ç‰‡è§„åˆ™</span></span><br><span class=\"line\">SHOW SHARDING TABLE RULE t_user \\G;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹åˆ†ç‰‡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/alter-sharding-table-rule/\">å®˜ç½‘æ–‡æ¡£</a>ï¼Œä¸åˆ›å»ºåˆ†ç‰‡è§„åˆ™ç±»ä¼¼ï¼Œå°†<code>CREATE</code>æ”¹ä¸º<code>ALTER</code>å³å¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER SHARDING TABLE RULE t_order_item_complex (</span><br><span class=\"line\">  DATANODES(<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;0..1&#125;</span>.t_order_item_complex_<span class=\"variable\">$&#123;0..1&#125;</span>&quot;</span>),</span><br><span class=\"line\">  DATABASE_STRATEGY(TYPE=<span class=\"string\">&quot;standard&quot;</span>,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;inline&quot;</span>,PROPERTIES(<span class=\"string\">&quot;algorithm-expression&quot;</span>=<span class=\"string\">&quot;ds_<span class=\"variable\">$&#123;user_id % 2&#125;</span>&quot;</span>)))),</span><br><span class=\"line\">  TABLE_STRATEGY(TYPE=<span class=\"string\">&quot;complex&quot;</span>,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=<span class=\"string\">&quot;T_ORDER_ITEM_COMPLEX&quot;</span>))),</span><br><span class=\"line\">  KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=<span class=\"string\">&quot;SNOWFLAKE&quot;</span>))</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤åˆ†ç‰‡è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/drop-sharding-table-rule/\">å®˜ç½‘æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP SHARDING TABLE RULE t_order;</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤å¤šä¸ªè¡¨</span></span><br><span class=\"line\">DROP SHARDING TABLE RULE t_order,t_order_item;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ•°æ®åŠ å¯†è§„åˆ™\">æ•°æ®åŠ å¯†è§„åˆ™</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!ENCRYPT</span>    <span class=\"comment\"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># åŠ å¯†è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># åŠ å¯†åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">cipher:</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">password</span> <span class=\"comment\"># å¯†æ–‡åˆ—åç§°</span></span><br><span class=\"line\">              <span class=\"attr\">encryptorName:</span> <span class=\"string\">aes_encryptor</span> <span class=\"comment\"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class=\"line\">    <span class=\"attr\">encryptors:</span></span><br><span class=\"line\">      <span class=\"attr\">aes_encryptor:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">AES</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">aes-key-value:</span> <span class=\"string\">123456abc</span>     <span class=\"comment\"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class=\"line\">          <span class=\"attr\">digest-algorithm-name:</span> <span class=\"string\">SHA-1</span> <span class=\"comment\"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-10\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåŠ å¯†è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/encrypt/create-encrypt-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE ENCRYPT RULE t_user (</span><br><span class=\"line\">COLUMNS(</span><br><span class=\"line\">  (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=<span class=\"string\">&#x27;AES&#x27;</span>,PROPERTIES(<span class=\"string\">&#x27;aes-key-value&#x27;</span>=<span class=\"string\">&#x27;123456abc&#x27;</span>, <span class=\"string\">&#x27;digest-algorithm-name&#x27;</span>=<span class=\"string\">&#x27;SHA-1&#x27;</span>))))</span><br><span class=\"line\">));</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹åŠ å¯†è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER ENCRYPT RULE t_user (</span><br><span class=\"line\">COLUMNS(</span><br><span class=\"line\">  (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=<span class=\"string\">&#x27;AES&#x27;</span>,PROPERTIES(<span class=\"string\">&#x27;aes-key-value&#x27;</span>=<span class=\"string\">&#x27;123456abc&#x27;</span>, <span class=\"string\">&#x27;digest-algorithm-name&#x27;</span>=<span class=\"string\">&#x27;SHA-1&#x27;</span>))))</span><br><span class=\"line\">));</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤åŠ å¯†è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP ENCRYPT RULE t_user;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢åŠ å¯†è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/encrypt/show-encrypt-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰åŠ å¯†è§„åˆ™</span></span><br><span class=\"line\">SHOW ENCRYPT RULES \\G;</span><br><span class=\"line\"><span class=\"comment\"># è·å–æŒ‡å®šé€»è¾‘åº“ä¸­çš„åŠ å¯†è§„åˆ™</span></span><br><span class=\"line\">SHOW ENCRYPT RULES FROM sharding_db \\G;</span><br><span class=\"line\"><span class=\"comment\"># è·å–æŒ‡å®šé€»è¾‘è¡¨ä¸­çš„åŠ å¯†è§„åˆ™</span></span><br><span class=\"line\">SHOW ENCRYPT RULE t_user \\G;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ•°æ®è„±æ•è§„åˆ™\">æ•°æ®è„±æ•è§„åˆ™</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!MASK</span>  <span class=\"comment\"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># è„±æ•è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span>  <span class=\"comment\"># è„±æ•åˆ—é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># è„±æ•åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">md5_mask</span> <span class=\"comment\"># è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">email:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">mask_before_special_chars_mask</span></span><br><span class=\"line\">          <span class=\"attr\">telephone:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">keep_first_n_last_m_mask</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">my_mask</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">maskAlgorithms:</span> <span class=\"comment\"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">md5_mask:</span> <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span>  <span class=\"comment\"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class=\"line\">      <span class=\"attr\">mask_before_special_chars_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MASK_BEFORE_SPECIAL_CHARS</span> <span class=\"comment\"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">special-chars:</span> <span class=\"string\">&#x27;@&#x27;</span>  <span class=\"comment\"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span>   <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">keep_first_n_last_m_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">KEEP_FIRST_N_LAST_M</span> <span class=\"comment\"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">first-n:</span> <span class=\"number\">3</span>     <span class=\"comment\"># ä¿ç•™å‰ 3 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">last-m:</span> <span class=\"number\">4</span>      <span class=\"comment\"># ä¿ç•™å 4 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">my_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MY_CUSTOM_MASK</span>  <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&quot;#&quot;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"DistSQL-è¯­æ³•-11\">DistSQL è¯­æ³•</h5>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºè„±æ•è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/mask/create-mask-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE MASK RULE t_user (</span><br><span class=\"line\">  COLUMNS(</span><br><span class=\"line\">    (NAME=password, TYPE(NAME=<span class=\"string\">&#x27;MD5&#x27;</span>)),</span><br><span class=\"line\">    (NAME=email, TYPE(NAME=<span class=\"string\">&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;special-chars&quot;</span>=<span class=\"string\">&quot;@&quot;</span>,  <span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;*&quot;</span>))),</span><br><span class=\"line\">    (NAME=telephone, TYPE(NAME=<span class=\"string\">&#x27;KEEP_FIRST_N_LAST_M&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;first-n&quot;</span>=3, <span class=\"string\">&quot;last-m&quot;</span>=4, <span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;*&quot;</span>))),</span><br><span class=\"line\">    (NAME=`name`, TYPE(NAME=<span class=\"string\">&#x27;MY_CUSTOM_MASK&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;#&quot;</span>)))</span><br><span class=\"line\">  )</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œæ³¨æ„ name æ˜¯å…³é”®å­—ï¼Œæ‰€ä»¥éœ€è¦ç”¨ `` åŒ…èµ·æ¥</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹è„±æ•è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER MASK RULE t_user (</span><br><span class=\"line\">  COLUMNS(</span><br><span class=\"line\">    (NAME=password, TYPE(NAME=<span class=\"string\">&#x27;MD5&#x27;</span>)),</span><br><span class=\"line\">    (NAME=email, TYPE(NAME=<span class=\"string\">&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;special-chars&quot;</span>=<span class=\"string\">&quot;@&quot;</span>,  <span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;*&quot;</span>))),</span><br><span class=\"line\">    (NAME=telephone, TYPE(NAME=<span class=\"string\">&#x27;KEEP_FIRST_N_LAST_M&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;first-n&quot;</span>=3, <span class=\"string\">&quot;last-m&quot;</span>=4, <span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;*&quot;</span>))),</span><br><span class=\"line\">    (NAME=`name`, TYPE(NAME=<span class=\"string\">&#x27;MY_CUSTOM_MASK&#x27;</span>, PROPERTIES(<span class=\"string\">&quot;replace-char&quot;</span>=<span class=\"string\">&quot;#&quot;</span>)))</span><br><span class=\"line\">  )</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤è„±æ•è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP MASK RULE t_user;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥è¯¢è„±æ•è§„åˆ™ï¼Œ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/syntax/rql/rule-query/mask/show-mask-rule/\">å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰è„±æ•è§„åˆ™</span></span><br><span class=\"line\">SHOW MASK RULES;</span><br><span class=\"line\"><span class=\"comment\"># ä»…æŸ¥è¯¢æŒ‡å®šé€»è¾‘åº“ä¸­çš„è„±æ•è§„åˆ™</span></span><br><span class=\"line\">SHOW MASK RULES FROM sharding_db;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢æŒ‡å®šè§„åˆ™</span></span><br><span class=\"line\">mysql&gt; SHOW MASK RULE t_user;</span><br><span class=\"line\">+--------+-----------+---------------------------+-------------------------------------------------+</span><br><span class=\"line\">| table  | column    | algorithm_type            | algorithm_props                                 |</span><br><span class=\"line\">+--------+-----------+---------------------------+-------------------------------------------------+</span><br><span class=\"line\">| t_user | password  | MD5                       |                                                 |</span><br><span class=\"line\">| t_user | email     | MASK_BEFORE_SPECIAL_CHARS | &#123;<span class=\"string\">&quot;replace-char&quot;</span>:<span class=\"string\">&quot;*&quot;</span>,<span class=\"string\">&quot;special-chars&quot;</span>:<span class=\"string\">&quot;@&quot;</span>&#125;        |</span><br><span class=\"line\">| t_user | telephone | KEEP_FIRST_N_LAST_M       | &#123;<span class=\"string\">&quot;first-n&quot;</span>:<span class=\"string\">&quot;3&quot;</span>,<span class=\"string\">&quot;last-m&quot;</span>:<span class=\"string\">&quot;4&quot;</span>,<span class=\"string\">&quot;replace-char&quot;</span>:<span class=\"string\">&quot;*&quot;</span>&#125; |</span><br><span class=\"line\">| t_user | name      | MY_CUSTOM_MASK            | &#123;<span class=\"string\">&quot;replace-char&quot;</span>:<span class=\"string\">&quot;#&quot;</span>&#125;                            |</span><br><span class=\"line\">+--------+-----------+---------------------------+-------------------------------------------------+</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» ShardingSphere-Proxy5.5.2 DistSQL çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ DistSQL DistSQLï¼ˆDistributed SQLï¼‰æ˜¯ Apache ShardingSphere ç‰¹æœ‰çš„æ“ä½œè¯­è¨€ã€‚ å®ƒä¸æ ‡å‡† SQL çš„ä½¿ç”¨æ–¹å¼å®Œå…¨ä¸€è‡´ï¼Œç”¨äºæä¾›å¢é‡åŠŸèƒ½çš„ SQL çº§åˆ«æ“ä½œèƒ½åŠ›ã€‚ çµæ´»çš„è§„åˆ™é…ç½®å’Œèµ„æºç®¡æ§èƒ½åŠ›æ˜¯ Apache ShardingSphere çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚ åœ¨ä½¿ç”¨ 4.x åŠå…¶ä¹‹å‰ç‰ˆæœ¬æ—¶ï¼Œå¼€å‘è€…è™½ç„¶å¯ä»¥åƒä½¿ç”¨åŸç”Ÿæ•°æ®åº“ä¸€æ ·æ“ä½œæ•°æ®ï¼Œä½†å´éœ€è¦é€šè¿‡æœ¬åœ°æ–‡ä»¶æˆ–æ³¨å†Œä¸­å¿ƒé…ç½®èµ„æºå’Œè§„åˆ™ã€‚ç„¶è€Œï¼Œæ“ä½œä¹ æƒ¯å˜æ›´ï¼Œå¯¹äºè¿ç»´å·¥ç¨‹å¸ˆå¹¶ä¸å‹å¥½ã€‚ ä» 5.x ç‰ˆæœ¬å¼€å§‹ï¼ŒDistSQLï¼ˆDistributed SQLï¼‰è®©ç”¨æˆ·å¯ä»¥åƒæ“ä½œæ•°æ®åº“ä¸€æ ·æ“ä½œ Apache ShardingSphereï¼Œä½¿å…¶ä»é¢å‘å¼€å‘äººå‘˜çš„æ¡†æ¶å’Œä¸­é—´ä»¶è½¬å˜ä¸ºé¢å‘è¿ç»´äººå‘˜çš„æ•°æ®åº“äº§å“ã€‚ DistSQL ç»†åˆ†ä¸º RDLã€RQLã€RAL å’Œ RUL å››ç§ç±»å‹ã€‚ RDL: Resource &amp; Rule Definition Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤ã€‚ RQL: Resource &amp; Rule Query Languageï¼Œè´Ÿè´£èµ„æºå’Œè§„åˆ™çš„æŸ¥è¯¢å’Œå±•ç°ã€‚ RAL: Resource &amp; Rule Administration Languageï¼Œè´Ÿè´£å¼ºåˆ¶è·¯ç”±ã€ç†”æ–­ã€é…ç½®å¯¼å…¥å¯¼å‡ºã€æ•°æ®è¿ç§»æ§åˆ¶ç­‰ç®¡ç†åŠŸèƒ½ã€‚ RUL: Resource &amp; Rule Utility Languageï¼Œè´Ÿè´£ SQL è§£æã€SQL æ ¼å¼åŒ–ã€æ‰§è¡Œè®¡åˆ’é¢„è§ˆç­‰åŠŸèƒ½ã€‚ DistSQL ä»…å¯ä»¥åœ¨ ShardingSphere-Proxy ä¸­ä½¿ç”¨ï¼Œä¸èƒ½åœ¨ ShardingSphere-JDBC ä¸­ä½¿ç”¨ã€‚ ç¤ºä¾‹å‡†å¤‡ å…·ä½“çš„è¯­æ³•ï¼Œå®˜ç½‘ä»‹ç»çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡ŒåŸºäº SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨ ä¸­çš„é…ç½®è¿›è¡Œç¤ºä¾‹è¯´æ˜ã€‚ ä¸ºäº†å°½å¯èƒ½å¤šçš„ä½¿ç”¨ DistSQL è¯­æ³•ï¼Œè¿™é‡Œä»…åœ¨ global.yaml ä¸­é…ç½®å¦‚ä¸‹å†…å®¹: 12345678910111213141516171819202122232425# é…ç½®ä¸ºåŸºäº zookeeper é›†ç¾¤æ¨¡å¼ï¼Œä¸ºäº†æ¼”ç¤º DistSQL è¯­æ³•ï¼Œè¿™é‡Œéœ€è¦å°†é…ç½®æŒä¹…åŒ–ï¼Œä½¿ç”¨ JDBC çš„å•æœºæ¨¡å¼ä¹Ÿå¯ä»¥mode: type: Cluster # è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone repository: type: ZooKeeper # æ³¨å†Œä¸­å¿ƒç±»å‹ props: namespace: governance_ds # ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹ server-lists: localhost:2181 # ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨ retryIntervalMilliseconds: 500 # ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚ timeToLiveSeconds: 60 # è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥ maxRetries: 3 # æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚ operationTimeoutMilliseconds: 500 # å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚# é…ç½®ç”¨æˆ·å’Œæƒé™ï¼Œå› ä¸º DistSQL æš‚ä¸æ”¯æŒ ç”¨æˆ·å’Œæƒé™ç®¡ç†ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å…ˆé…ç½®ç”¨æˆ·å’Œæƒé™authority: users: - user: root@127.0.0.1 password: root admin: true - user: sharding@% password: sharding privilege: type: DATABASE_PERMITTED props: user-database-mappings: root@127.0.0.1=*,sharding@%=sharding_db å¯åŠ¨ ShardingSphere-Proxy æœåŠ¡ï¼Œå¹¶ç™»å½• 12345678910111213# å¯åŠ¨ ShardingSphere-Proxy./shardingsphere-proxy-bin/bin/start.sh# ä½¿ç”¨ç®¡ç†å‘˜ç™»å½•mysql -h127.0.0.1 -uroot -proot -P3307# æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™mysql&gt; SHOW AUTHORITY RULE;+----------------------------+--------------------+----------------------------------------------------------------------+| users | provider | props |+----------------------------+--------------------+----------------------------------------------------------------------+| root@127.0.0.1; sharding@% | DATABASE_PERMITTED | &#123;&quot;user-database-mappings&quot;:&quot;root@127.0.0.1=*,sharding@%=sharding_db&quot;&#125; |+----------------------------+--------------------+----------------------------------------------------------------------+1 row in set (0.49 sec) å…¨å±€é…ç½®ï¼Œå³global.yamlä¸­çš„é…ç½® å…¨å±€é…ç½®å¯¹æ‰€æœ‰é€»è¾‘æ•°æ®åº“æœ‰æ•ˆ å±æ€§é…ç½® é…ç½®æ–‡ä»¶ä¸­çš„é…ç½® 12props: sql-show: true # æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false DistSQL è¯­æ³• è®¾ç½®å±æ€§ï¼Œå®˜æ–¹æ–‡æ¡£ 12# è¿™é‡Œè¦æ³¨æ„ï¼Œå±æ€§åéœ€è¦ä½¿ç”¨ä¸‹åˆ’çº¿æ ¼å¼SET DIST VARIABLE sql_show = true; æŸ¥çœ‹å±æ€§ï¼Œå®˜æ–¹æ–‡æ¡£ 123456789101112131415161718192021222324252627mysql&gt; SHOW DIST VARIABLES;+-----------------------------------------+-----------------+| variable_name | variable_value |+-----------------------------------------+-----------------+| agent_plugins_enabled | true || cached_connections | 0 || cdc_server_port | 33071 || check_table_metadata_enabled | false || kernel_executor_size | 0 || load_table_metadata_batch_size | 1000 || max_connections_size_per_query | 1 || proxy_backend_query_fetch_size | -1 || proxy_default_port | 3307 || proxy_frontend_database_protocol_type | || proxy_frontend_executor_size | 0 || proxy_frontend_flush_threshold | 128 || proxy_frontend_max_connections | 0 || proxy_frontend_ssl_cipher | || proxy_frontend_ssl_enabled | false || proxy_frontend_ssl_version | TLSv1.2,TLSv1.3 || proxy_meta_data_collector_enabled | false || proxy_netty_backlog | 1024 || sql_show | true || sql_simple | false || system_log_level | INFO || system_schema_metadata_assembly_enabled | true |+-----------------------------------------+-----------------+ åˆ†å¸ƒå¼äº‹åŠ¡é…ç½® é…ç½®æ–‡ä»¶ä¸­çš„é…ç½® 123transaction: defaultType: XA providerType: Atomikos DistSQL è¯­æ³• æŸ¥çœ‹äº‹åŠ¡è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 1SHOW TRANSACTION RULE; ä¿®æ”¹äº‹åŠ¡è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 123ALTER TRANSACTION RULE( DEFAULT=&quot;XA&quot;, TYPE(NAME=&quot;Atomikos&quot;)); è§„åˆ™é…ç½®ï¼Œå³database-xxx.yamlä¸­çš„é…ç½® ä»¥ä¸‹ DistSQL ä»…å¯ä»¥åœ¨é€»è¾‘åº“ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªé€»è¾‘æ•°æ®åº“ 12345mysql&gt; CREATE DATABASE sharding_db;Query OK, 0 rows affected (0.03 sec)mysql&gt; use sharding_db;Database changed æ•°æ®æºé…ç½® åœ¨ DistSQLä¸­ï¼Œå®˜æ–¹å°†æ•°æ®æºå«åšå­˜å‚¨å•å…ƒ(STORAGE UNIT) é…ç½®æ–‡ä»¶ä¸­çš„é…ç½® 12345678910dataSources: ds_0: # é€»è¾‘æ•°æ®æºåç§° url: jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 # æ³¨æ„è¿™é‡Œå±æ€§ä¸º url username: root password: newpwd ds_1: url: jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd DistSQL è¯­æ³• æ³¨å†Œå­˜å‚¨å•å…ƒï¼Œå®˜æ–¹æ–‡æ¡£ 1234567891011REGISTER STORAGE UNIT ds_0 ( URL=&quot;jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;, USER=&quot;root&quot;, PASSWORD=&quot;newpwd&quot;);REGISTER STORAGE UNIT ds_1 ( URL=&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;, USER=&quot;root&quot;, PASSWORD=&quot;newpwd&quot;); æŸ¥è¯¢å­˜å‚¨å•å…ƒï¼Œå®˜æ–¹æ–‡æ¡£ 1SHOW STORAGE UNITS FROM sharding_db \\G; ä¿®æ”¹å­˜å‚¨å•å…ƒï¼Œå®˜æ–¹æ–‡æ¡£ 123456ALTER STORAGE UNIT ds_1 ( URL=&quot;jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8&quot;, USER=&quot;root&quot;, PASSWORD=&quot;newpwd&quot;, PROPERTIES(&quot;maximumPoolSize&quot;=10,&quot;idleTimeout&quot;=30000)); å–æ¶ˆæ³¨å†Œå­˜å‚¨å•å…ƒï¼Œå®˜æ–¹æ–‡æ¡£ 12# æ— æ³•ç§»é™¤å·²ç»è¢«è§„åˆ™ä½¿ç”¨çš„å­˜å‚¨å•å…ƒUNREGISTER STORAGE UNIT ds_0; å•è¡¨é…ç½® é…ç½®æ–‡ä»¶ä¸­çš„é…ç½® 12345rules: - !SINGLE # å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™ tables: # MySQL é£æ ¼ - ds_0.t_address # åŠ è½½æŒ‡å®šå•è¡¨ DistSQL è¯­æ³• åŠ è½½å•è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1LOAD SINGLE TABLE ds_0.t_address; æŸ¥è¯¢å•è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1SHOW SINGLE TABLES; å¸è½½å•è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1UNLOAD SINGLE TABLE ds_0.t_address; å¹¿æ’­è¡¨é…ç½® å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨ 1234rules: - !BROADCAST # å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª tables: - dict # å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚ DistSQL è¯­æ³• åˆ›å»ºå¹¿æ’­è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1CREATE BROADCAST TABLE RULE dict; åˆ é™¤å¹¿æ’­è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1DROP BROADCAST TABLE RULE dict; æŸ¥è¯¢å¹¿æ’­è¡¨ï¼Œå®˜æ–¹æ–‡æ¡£ 1234# æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨SHOW BROADCAST TABLE RULES;# æŸ¥è¯¢æŒ‡å®šæ•°æ®åº“ä¸­å…·æœ‰å¹¿æ’­è§„åˆ™çš„è¡¨SHOW BROADCAST TABLE RULES FROM sharding_db; åˆ†åº“åˆ†è¡¨é…ç½® å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹ 12345678910111213141516171819202122232425262728293031rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® course: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.course_$&#123;1..2&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1 databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: course_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: cid shardingAlgorithmName: course_inline keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: cid # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• course_inline: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™ props: # å±æ€§ algorithm-expression: course_$&#123;cid % 2 + 1&#125; # è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2 allow-range-query-with-inline-sharding: true # å…è®¸èŒƒå›´æŸ¥è¯¢ course_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; # è¡¨ç¤º ds_0, ds_1 keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong DistSQL è¯­æ³• åˆ›å»ºåˆ†ç‰‡è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 123456CREATE SHARDING TABLE RULE course ( DATANODES(&quot;ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;&quot;), DATABASE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;ds_$&#123;user_id % 2&#125;&quot;)))), TABLE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=cid,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;course_$&#123;cid % 2 + 1&#125;&quot;,&quot;allow-range-query-with-inline-sharding&quot;=true )))), KEY_GENERATE_STRATEGY(COLUMN=cid,TYPE(NAME=&quot;snowflake&quot;))); å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹ 123456789101112131415161718192021222324252627282930313233343536rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® t_user: actualDataNodes: ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_inline # åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: id # è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹# keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° keyGeneratorName: custom_snowflake_string # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• t_user_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;Math.abs(id.hashCode()%2)&#125; # åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®— t_user_inline: type: INLINE props: algorithm-expression: t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125; # åˆ†è¡¨ï¼Œt_user_0, t_user_1 keyGenerators: # åˆ†å¸ƒå¼åºåˆ—ç®—æ³• uuid: # å®šä¹‰åç§° type: UUID # å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString custom_snowflake_string: type: CUSTOM_SNOWFLAKE_STRING # è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi props: workerId: 2 datacenterId: 2 DistSQL è¯­æ³• åˆ›å»ºåˆ†ç‰‡è§„åˆ™ 123456CREATE SHARDING TABLE RULE t_user ( DATANODES(&quot;ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;&quot;), DATABASE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;ds_$&#123;Math.abs(id.hashCode()%2)&#125;&quot;)))), TABLE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;&quot;)))), KEY_GENERATE_STRATEGY(COLUMN=id,TYPE(NAME=&quot;CUSTOM_SNOWFLAKE_STRING&quot;))); å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® t_order_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id shardingAlgorithmName: t_order-complex-algorithm keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id # åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”# shardingAlgorithmName: t_order_item-class-based-algorithm # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• shardingAlgorithmName: t_order_item-class-based-algorithm_spi # åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• t_order_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; t_order-complex-algorithm: type: COMPLEX_INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³• props: algorithm-expression: t_order_complex_$&#123;(user_id + order_id + 1) % 2&#125; t_order_item-class-based-algorithm_spi: # SPI type: T_ORDER_ITEM_COMPLEX # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong DistSQL è¯­æ³• åˆ›å»ºåˆ†ç‰‡è§„åˆ™ 12345678910111213CREATE SHARDING TABLE RULE t_order_complex ( DATANODES(&quot;ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;&quot;), DATABASE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;ds_$&#123;user_id % 2&#125;&quot;)))), TABLE_STRATEGY(TYPE=&quot;complex&quot;,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;complex_inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;t_order_complex_$&#123;(user_id + order_id + 1) % 2&#125;&quot;)))), KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=&quot;snowflake&quot;)));CREATE SHARDING TABLE RULE t_order_item_complex ( DATANODES(&quot;ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;&quot;), DATABASE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;ds_$&#123;user_id % 2&#125;&quot;)))), TABLE_STRATEGY(TYPE=&quot;complex&quot;,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;T_ORDER_ITEM_COMPLEX&quot;))), KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=&quot;SNOWFLAKE&quot;))); è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™ ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™ 12345678910111213141516171819202122232425262728293031323334rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® # ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´ bindingTables: - t_order,t_order_item autoTables: # è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½® t_order: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• mod_2: type: MOD # åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³• props: sharding-count: 2 # åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™ keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong DistSQL è¯­æ³• åˆ›å»ºåˆ†ç‰‡è§„åˆ™ 1234567891011CREATE SHARDING TABLE RULE t_order ( STORAGE_UNITS(ds_0,ds_1), SHARDING_COLUMN=user_id,TYPE(NAME=&quot;mod&quot;,PROPERTIES(&quot;sharding-count&quot;=&quot;2&quot;)), KEY_GENERATE_STRATEGY(COLUMN=order_id,TYPE(NAME=&quot;snowflake&quot;)));CREATE SHARDING TABLE RULE t_order_item ( STORAGE_UNITS(ds_0,ds_1), SHARDING_COLUMN=user_id,TYPE(NAME=&quot;mod&quot;,PROPERTIES(&quot;sharding-count&quot;=&quot;2&quot;)), KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=&quot;snowflake&quot;))); å…¶å®ƒåˆ†ç‰‡æ“ä½œè¯­å¥ æŸ¥è¯¢åˆ†ç‰‡è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 123456# æŸ¥çœ‹å½“å‰é€»è¾‘åº“ä¸‹çš„æ‰€æœ‰åˆ†ç‰‡è§„åˆ™SHOW SHARDING TABLE RULES \\G;# æŸ¥çœ‹æŒ‡å®šé€»è¾‘åº“ä¸‹çš„åˆ†ç‰‡è§„åˆ™SHOW SHARDING TABLE RULES FROM sharding_db; \\G;# æŸ¥çœ‹æŒ‡å®šåˆ†ç‰‡è§„åˆ™SHOW SHARDING TABLE RULE t_user \\G; ä¿®æ”¹åˆ†ç‰‡è§„åˆ™ï¼Œå®˜ç½‘æ–‡æ¡£ï¼Œä¸åˆ›å»ºåˆ†ç‰‡è§„åˆ™ç±»ä¼¼ï¼Œå°†CREATEæ”¹ä¸ºALTERå³å¯ 123456ALTER SHARDING TABLE RULE t_order_item_complex ( DATANODES(&quot;ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;&quot;), DATABASE_STRATEGY(TYPE=&quot;standard&quot;,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;inline&quot;,PROPERTIES(&quot;algorithm-expression&quot;=&quot;ds_$&#123;user_id % 2&#125;&quot;)))), TABLE_STRATEGY(TYPE=&quot;complex&quot;,SHARDING_COLUMNS=user_id,order_id,SHARDING_ALGORITHM(TYPE(NAME=&quot;T_ORDER_ITEM_COMPLEX&quot;))), KEY_GENERATE_STRATEGY(COLUMN=item_id,TYPE(NAME=&quot;SNOWFLAKE&quot;))); åˆ é™¤åˆ†ç‰‡è§„åˆ™ï¼Œå®˜ç½‘æ–‡æ¡£ 123DROP SHARDING TABLE RULE t_order;# åˆ é™¤å¤šä¸ªè¡¨DROP SHARDING TABLE RULE t_order,t_order_item; æ•°æ®åŠ å¯†è§„åˆ™ 12345678910111213141516rules: - !ENCRYPT # æ•°æ®åŠ å¯†é…ç½® tables: t_user: # åŠ å¯†è¡¨åç§° columns: password: # åŠ å¯†åˆ—åç§° cipher: name: password # å¯†æ–‡åˆ—åç§° encryptorName: aes_encryptor # å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§° # åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/ encryptors: aes_encryptor: # åŠ è§£å¯†ç®—æ³•åç§° type: AES # åŠ è§£å¯†ç®—æ³•ç±»å‹ props: # åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½® aes-key-value: 123456abc # AES ä½¿ç”¨çš„ KEY digest-algorithm-name: SHA-1 # AES KEY çš„æ‘˜è¦ç®—æ³• DistSQL è¯­æ³• åˆ›å»ºåŠ å¯†è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 1234CREATE ENCRYPT RULE t_user (COLUMNS( (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=&#x27;AES&#x27;,PROPERTIES(&#x27;aes-key-value&#x27;=&#x27;123456abc&#x27;, &#x27;digest-algorithm-name&#x27;=&#x27;SHA-1&#x27;)))))); ä¿®æ”¹åŠ å¯†è§„åˆ™ 1234ALTER ENCRYPT RULE t_user (COLUMNS( (NAME=password,CIPHER=password,ENCRYPT_ALGORITHM(TYPE(NAME=&#x27;AES&#x27;,PROPERTIES(&#x27;aes-key-value&#x27;=&#x27;123456abc&#x27;, &#x27;digest-algorithm-name&#x27;=&#x27;SHA-1&#x27;)))))); åˆ é™¤åŠ å¯†è§„åˆ™ 1DROP ENCRYPT RULE t_user; æŸ¥è¯¢åŠ å¯†è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 123456# æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰åŠ å¯†è§„åˆ™SHOW ENCRYPT RULES \\G;# è·å–æŒ‡å®šé€»è¾‘åº“ä¸­çš„åŠ å¯†è§„åˆ™SHOW ENCRYPT RULES FROM sharding_db \\G;# è·å–æŒ‡å®šé€»è¾‘è¡¨ä¸­çš„åŠ å¯†è§„åˆ™SHOW ENCRYPT RULE t_user \\G; æ•°æ®è„±æ•è§„åˆ™ 1234567891011121314151617181920212223242526272829303132rules: - !MASK # æ•°æ®è„±æ•é…ç½® tables: t_user: # è„±æ•è¡¨åç§° columns: # è„±æ•åˆ—é…ç½® password: # è„±æ•åˆ—åç§° maskAlgorithm: md5_mask # è„±æ•ç®—æ³•åç§° email: maskAlgorithm: mask_before_special_chars_mask telephone: maskAlgorithm: keep_first_n_last_m_mask name: maskAlgorithm: my_mask maskAlgorithms: # è„±æ•ç®—æ³•é…ç½® md5_mask: # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° type: MD5 # è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º mask_before_special_chars_mask: type: MASK_BEFORE_SPECIAL_CHARS # åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com props: special-chars: &#x27;@&#x27; # é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ• replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ keep_first_n_last_m_mask: type: KEEP_FIRST_N_LAST_M # ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678 props: first-n: 3 # ä¿ç•™å‰ 3 ä½ last-m: 4 # ä¿ç•™å 4 ä½ replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ my_mask: type: MY_CUSTOM_MASK # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° props: replace-char: &quot;#&quot; DistSQL è¯­æ³• åˆ›å»ºè„±æ•è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 123456789CREATE MASK RULE t_user ( COLUMNS( (NAME=password, TYPE(NAME=&#x27;MD5&#x27;)), (NAME=email, TYPE(NAME=&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;, PROPERTIES(&quot;special-chars&quot;=&quot;@&quot;, &quot;replace-char&quot;=&quot;*&quot;))), (NAME=telephone, TYPE(NAME=&#x27;KEEP_FIRST_N_LAST_M&#x27;, PROPERTIES(&quot;first-n&quot;=3, &quot;last-m&quot;=4, &quot;replace-char&quot;=&quot;*&quot;))), (NAME=`name`, TYPE(NAME=&#x27;MY_CUSTOM_MASK&#x27;, PROPERTIES(&quot;replace-char&quot;=&quot;#&quot;))) ));# è¿™é‡Œæ³¨æ„ name æ˜¯å…³é”®å­—ï¼Œæ‰€ä»¥éœ€è¦ç”¨ `` åŒ…èµ·æ¥ ä¿®æ”¹è„±æ•è§„åˆ™ 12345678ALTER MASK RULE t_user ( COLUMNS( (NAME=password, TYPE(NAME=&#x27;MD5&#x27;)), (NAME=email, TYPE(NAME=&#x27;MASK_BEFORE_SPECIAL_CHARS&#x27;, PROPERTIES(&quot;special-chars&quot;=&quot;@&quot;, &quot;replace-char&quot;=&quot;*&quot;))), (NAME=telephone, TYPE(NAME=&#x27;KEEP_FIRST_N_LAST_M&#x27;, PROPERTIES(&quot;first-n&quot;=3, &quot;last-m&quot;=4, &quot;replace-char&quot;=&quot;*&quot;))), (NAME=`name`, TYPE(NAME=&#x27;MY_CUSTOM_MASK&#x27;, PROPERTIES(&quot;replace-char&quot;=&quot;#&quot;))) )); åˆ é™¤è„±æ•è§„åˆ™ 1DROP MASK RULE t_user; æŸ¥è¯¢è„±æ•è§„åˆ™ï¼Œå®˜æ–¹æ–‡æ¡£ 1234567891011121314# æŸ¥è¯¢å½“å‰é€»è¾‘åº“ä¸­æ‰€æœ‰è„±æ•è§„åˆ™SHOW MASK RULES;# ä»…æŸ¥è¯¢æŒ‡å®šé€»è¾‘åº“ä¸­çš„è„±æ•è§„åˆ™SHOW MASK RULES FROM sharding_db;# æŸ¥è¯¢æŒ‡å®šè§„åˆ™mysql&gt; SHOW MASK RULE t_user;+--------+-----------+---------------------------+-------------------------------------------------+| table | column | algorithm_type | algorithm_props |+--------+-----------+---------------------------+-------------------------------------------------+| t_user | password | MD5 | || t_user | email | MASK_BEFORE_SPECIAL_CHARS | &#123;&quot;replace-char&quot;:&quot;*&quot;,&quot;special-chars&quot;:&quot;@&quot;&#125; || t_user | telephone | KEEP_FIRST_N_LAST_M | &#123;&quot;first-n&quot;:&quot;3&quot;,&quot;last-m&quot;:&quot;4&quot;,&quot;replace-char&quot;:&quot;*&quot;&#125; || t_user | name | MY_CUSTOM_MASK | &#123;&quot;replace-char&quot;:&quot;#&quot;&#125; |+--------+-----------+---------------------------+-------------------------------------------------+","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» ShardingSphere-Proxy5.5.2 DistSQL çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘","date_published":"2025-09-11T13:30:05.000Z","tags":["æŠ€æœ¯","springboot","sharding-sphere","springboot","sharding-sphere"]},{"id":"https://blog.hanqunfeng.com/2025/09/10/springboot3-shardingsphere-proxy-mode/","url":"https://blog.hanqunfeng.com/2025/09/10/springboot3-shardingsphere-proxy-mode/","title":"SpringBoot3 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/index_zh.html\">ShardingSphereå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åœ¨ <a href=\"/2025/09/04/springboot3-shardingsphere-proxy/\" title=\"SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨\">SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨</a> çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è¿è¡Œæ¨¡å¼è¯´æ˜\">è¿è¡Œæ¨¡å¼è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/dev-manual/mode/\">è¿è¡Œæ¨¡å¼</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy è¿è¡Œæ¨¡å¼åˆ†ä¸ºä¸¤ç§ï¼šå•æœºæ¨¡å¼(Standalone) å’Œ é›†ç¾¤æ¨¡å¼(Cluster)ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿è¡Œæ¨¡å¼å°±æ˜¯æŒ‡å®šå°†<code>å…ƒæ•°æ®</code>(è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ç­‰)æŒä¹…åŒ–çš„å­˜å‚¨æ–¹å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é»˜è®¤è¿è¡Œæ¨¡å¼ä¸ºå•æœºæ¨¡å¼ï¼Œä½¿ç”¨<code>H2</code>çš„å†…å­˜æ–¹å¼ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å•æœºæ¨¡å¼-Standalone\">å•æœºæ¨¡å¼(Standalone)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å•æœºæ¨¡å¼èƒ½å¤Ÿå°†æ•°æ®æºå’Œè§„åˆ™ç­‰å…ƒæ•°æ®ä¿¡æ¯æŒä¹…åŒ–ï¼Œä½†æ— æ³•å°†å…ƒæ•°æ®åŒæ­¥è‡³å¤šä¸ª Apache ShardingSphere å®ä¾‹ï¼Œæ— æ³•åœ¨é›†ç¾¤ç¯å¢ƒä¸­ç›¸äº’æ„ŸçŸ¥ã€‚ é€šè¿‡æŸä¸€å®ä¾‹æ›´æ–°å…ƒæ•°æ®ä¹‹åï¼Œä¼šå¯¼è‡´å…¶ä»–å®ä¾‹ç”±äºè·å–ä¸åˆ°æœ€æ–°çš„å…ƒæ•°æ®è€Œäº§ç”Ÿä¸ä¸€è‡´çš„é”™è¯¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>é€‚ç”¨äºå·¥ç¨‹å¸ˆåœ¨æœ¬åœ°æ­å»º Apache ShardingSphere ç¯å¢ƒã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å•æœºæ¨¡å¼ç›®å‰ä»…æ”¯æŒä¸€ç§ï¼šJDBCï¼Œå³æ•°æ®åº“æŒä¹…åŒ–ã€‚ä»¥ä¸‹ä¸ºé»˜è®¤å€¼(<code>JDBCRepositoryPropertyKey</code>)ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>æ•°æ®ç±»å‹</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>provider</td>\n<td>String</td>\n<td>å…ƒæ•°æ®å­˜å‚¨ç±»å‹ï¼Œå¯é€‰å€¼ä¸º <code>H2</code>ã€<code>MySQL</code> ã€<code>EmbeddedDerby</code>ã€<code>DerbyNetworkServer</code>ã€<code>HSQLDB</code></td>\n<td>H2</td>\n</tr>\n<tr>\n<td>jdbc_url</td>\n<td>String</td>\n<td>JDBC URL</td>\n<td><code>jdbc:h2:mem:config;DB_CLOSE_DELAY=0;DATABASE_TO_UPPER=false;MODE=MYSQL</code></td>\n</tr>\n<tr>\n<td>username</td>\n<td>String</td>\n<td>è´¦å·</td>\n<td>sa</td>\n</tr>\n<tr>\n<td>password</td>\n<td>String</td>\n<td>å¯†ç </td>\n<td>ç©ºï¼ˆæ— é»˜è®¤å€¼ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä»¥ Mysql å­˜å‚¨å…ƒæ•°æ®ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/common-config/builtin-algorithm/metadata-repository/#jdbc-%E6%8C%81%E4%B9%85%E5%8C%96\">å®˜ç½‘è¯´æ˜</a></p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">mode:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">Standalone</span></span><br><span class=\"line\">  <span class=\"attr\">repository:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">JDBC</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">provider:</span> <span class=\"string\">MySQL</span></span><br><span class=\"line\">      <span class=\"attr\">jdbc_url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶éœ€è¦å°† mysql çš„é©±åŠ¨ jar åŒ… æ·»åŠ åˆ° <code>ext-lib</code> ç›®å½•ä¸‹</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ ShardingSphere Proxy æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ä¸Šé¢çš„æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¼ è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„ä¸­çš„å…ƒæ•°æ®å­˜å‚¨è¿›å»</p>\n</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `repository` (</span><br><span class=\"line\">  `id` <span class=\"type\">varchar</span>(<span class=\"number\">36</span>) <span class=\"keyword\">COLLATE</span> utf8mb4_bin <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `key` text <span class=\"keyword\">COLLATE</span> utf8mb4_bin,</span><br><span class=\"line\">  `<span class=\"keyword\">value</span>` text <span class=\"keyword\">COLLATE</span> utf8mb4_bin,</span><br><span class=\"line\">  `parent` text <span class=\"keyword\">COLLATE</span> utf8mb4_bin,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB <span class=\"keyword\">DEFAULT</span> CHARSET<span class=\"operator\">=</span>utf8mb4 <span class=\"keyword\">COLLATE</span><span class=\"operator\">=</span>utf8mb4_bin;</span><br></pre></td></tr></table></figure>\n<h3 id=\"é‡ç‚¹è¯´æ˜\">é‡ç‚¹è¯´æ˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æ•°æ®åº“ä¸­ä¸å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¯¥è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„å…ƒæ•°æ®æ’å…¥è¯¥è¡¨ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“æ•°æ®åº“ä¸­å·²å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè¯»å–è¯¥è¡¨ä¸­çš„æ•°æ®å¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ï¼Œè€Œä¸ä¼šè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚å³æ­¤æ—¶é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ä¸ä¼šç”Ÿæ•ˆã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è‹¥æ­¤æ—¶æƒ³ä¿®æ”¹é…ç½®è§„åˆ™ï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">1.åˆ é™¤è¯¥è¡¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åé‡æ–°å¯åŠ¨Proxyï¼Œæ­¤æ—¶ä¼šé‡æ–°åˆ›å»ºè¯¥è¡¨å¹¶åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚</li>\n<li class=\"lvl-4\">2.æ‰‹å·¥ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„å…ƒæ•°æ®ï¼Œä½†ä¿®æ”¹åéœ€è¦é‡æ–°å¯åŠ¨Proxyæ‰ä¼šåŠ è½½æ–°çš„å…ƒæ•°æ®ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚</li>\n<li class=\"lvl-4\">3.<code>[æ¨è]</code>ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ <a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/\">DistSQL</a> åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œä¿®æ”¹åçš„é…ç½®ä¼šè¢«ä¿å­˜åœ¨è¯¥è¡¨ä¸­ï¼Œå¹¶ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯Proxyã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒå¯ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤çš„ H2 å†…å­˜æ•°æ®åº“ï¼Œç”Ÿäº§ç¯å¢ƒå¯ä»¥ä½¿ç”¨ MySQLç­‰æ•°æ®åº“å¯¹å…ƒæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„é›†ç¾¤æ¨¡å¼ã€‚</p>\n</li>\n</ul>\n<h2 id=\"é›†ç¾¤æ¨¡å¼-Cluster\">é›†ç¾¤æ¨¡å¼(Cluster)</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é›†ç¾¤æ¨¡å¼æä¾›äº†å¤šä¸ª Apache ShardingSphere å®ä¾‹ä¹‹é—´çš„å…ƒæ•°æ®å…±äº«å’Œåˆ†å¸ƒå¼åœºæ™¯ä¸‹çŠ¶æ€åè°ƒçš„èƒ½åŠ›ã€‚ å®ƒèƒ½å¤Ÿæä¾›è®¡ç®—èƒ½åŠ›æ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨ç­‰åˆ†å¸ƒå¼ç³»ç»Ÿå¿…å¤‡çš„èƒ½åŠ›ï¼Œé›†ç¾¤ç¯å¢ƒéœ€è¦é€šè¿‡ç‹¬ç«‹éƒ¨ç½²çš„æ³¨å†Œä¸­å¿ƒæ¥å­˜å‚¨å…ƒæ•°æ®å’Œåè°ƒèŠ‚ç‚¹çŠ¶æ€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨é›†ç¾¤æ¨¡å¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä»¥ zookeeper é›†ç¾¤æ¨¡å¼ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒ<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/common-config/builtin-algorithm/metadata-repository/#zookeeper-%E6%8C%81%E4%B9%85%E5%8C%96\">å®˜ç½‘è¯´æ˜</a></p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">mode:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">Cluster</span>                 <span class=\"comment\"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class=\"line\">  <span class=\"attr\">repository:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">ZooKeeper</span>             <span class=\"comment\"># æ³¨å†Œä¸­å¿ƒç±»å‹ï¼Œå½“å‰ç‰ˆæœ¬ä»…æ”¯æŒ ZooKeeper å’Œ etcd</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">governance_ds</span>  <span class=\"comment\"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class=\"line\">      <span class=\"attr\">server-lists:</span> <span class=\"string\">localhost:2181</span> <span class=\"comment\"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class=\"line\">      <span class=\"attr\">retryIntervalMilliseconds:</span> <span class=\"number\">500</span> <span class=\"comment\"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">timeToLiveSeconds:</span> <span class=\"number\">60</span>     <span class=\"comment\"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"attr\">maxRetries:</span> <span class=\"number\">3</span>             <span class=\"comment\"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">operationTimeoutMilliseconds:</span> <span class=\"number\">500</span>  <span class=\"comment\"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"é‡ç‚¹è¯´æ˜-2\">é‡ç‚¹è¯´æ˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸è¦æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­çš„ namespace ä¸‹çš„é…ç½®ä¿¡æ¯!</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ—¢ç„¶æ˜¯é›†ç¾¤ï¼Œå°±éœ€è¦å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ã€‚ å½“ç¬¬ä¸€ä¸ª ShardingSphere-Proxy å®ä¾‹ å¯åŠ¨åï¼Œå…¶å®ƒç›¸åŒé…ç½®çš„ ShardingSphere-Proxy å®ä¾‹ä»…éœ€è¦ä¸€ä¸ª <code>global.yaml</code> å…¨å±€é…ç½®æ–‡ä»¶å³å¯ï¼Œå¹¶ä»…éœ€åœ¨å…¶ä¸­é…ç½®ä¸Šé¢çš„<code>è¿è¡Œæ¨¡å¼</code>ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å†é…ç½®å…¶å®ƒé…ç½®ï¼Œæ¯”å¦‚è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šé€šè¿‡ Zookeeper é›†ç¾¤ä¸­çš„ namespace è·å–å¹¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª ShardingSphere-Proxy å®ä¾‹å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨å°†è‡ªå·±æ³¨å†Œåˆ° Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹ï¼Œå¹¶è‡ªåŠ¨è·å–è¯¥ namespace ä¸‹çš„é…ç½®ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ Zookeeper é›†ç¾¤ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶ç¬¬ä¸€æ¬¡å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨åœ¨ Zookeeper ä¸­åˆ›å»º namespaceï¼Œå¹¶å†™å…¥é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯åˆ° Zookeeper ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶å†å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨ä» Zookeeper ä¸­è¯»å– namespace ä¸‹çš„é…ç½®ä¿¡æ¯ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä¸ä¼šå†è¯»å–æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ ¹æ®ä¸Šé¢çš„è§„åˆ™ï¼Œæ­¤æ—¶ä¿®æ”¹æœ¬åœ°çš„é…ç½®æ–‡ä»¶ä¸­çš„åˆ†ç‰‡è§„åˆ™åé‡å¯ShardingSphere-Proxy å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ­¤æ—¶æœ‰ä¸‰ç§æ–¹æ³•ï¼š\n<ul class=\"lvl-4\">\n<li class=\"lvl-6\">\n<ol>\n<li class=\"lvl-9\">åˆ é™¤ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespaceï¼Œç„¶åé‡å¯ ShardingSphere-Proxyã€‚è¿™ç§æ–¹æ³•æœ‰ä¸ªå¼Šç«¯ï¼Œå³ä¼šå¯¼è‡´è¿æ¥åˆ°ç›¸åŒ ZooKeeper é›†ç¾¤çš„ namespace çš„å…¶å®ƒ ShardingSphere-Proxy å®ä¾‹æ•°æ®ä¸¢å¤±(å®Œå…¨ä¸å¯ç”¨)ï¼Œä¹Ÿéœ€è¦é‡å¯æ‰èƒ½é‡æ–°è·å–åˆ°æ•°æ®ã€‚</li>\n</ol>\n</li>\n<li class=\"lvl-6\">\n<ol start=\"2\">\n<li class=\"lvl-9\">æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹çš„åˆ†ç‰‡è§„åˆ™ï¼Œä¿®æ”¹åä¼šç«‹å³åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚</li>\n</ol>\n</li>\n<li class=\"lvl-6\">\n<ol start=\"3\">\n<li class=\"lvl-9\"><code>[æ¨è]</code>ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ <a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-proxy/distsql/\">DistSQL</a> åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚æ‰€ä»¥ï¼Œçµæ´»æŒæ¡ <code>DistSQL</code> æ˜¯ç»´æŠ¤ ShardingSphere-Proxy é›†ç¾¤çš„å…³é”®ã€‚</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ å¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡å™¨ï¼Œæ¯”å¦‚ Nginxï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„ ShardingSphere-Proxy å®ä¾‹ã€‚æ¯”å¦‚ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stream&#123;</span><br><span class=\"line\">    upstream shardingsphere_proxy&#123;</span><br><span class=\"line\">        server  10.10.21.35:3307;</span><br><span class=\"line\">        server  10.10.21.36:3307;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    server&#123;</span><br><span class=\"line\">        listen 3310;</span><br><span class=\"line\">        proxy_connect_timeout 20s;</span><br><span class=\"line\">        proxy_timeout 5m;</span><br><span class=\"line\">        proxy_pass shardingsphere_proxy;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"ä¸-Spring-Boot3-æ•´åˆ\">ä¸ Spring Boot3 æ•´åˆ</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ— è®ºæ˜¯ <code>å•æœºæ¨¡å¼</code> è¿˜æ˜¯ <code>é›†ç¾¤æ¨¡å¼</code>ï¼Œå…¶ç›®çš„éƒ½æ˜¯å°† <code>é…ç½®</code> ä¿å­˜åˆ°ç‹¬ç«‹çš„ <code>é…ç½®ä¸­å¿ƒ(æ•°æ®åº“ æˆ– Zookeeper)</code>ä¸­ï¼Œå¹¶è®©å…¶å®ƒ <code>ShardingSphere-Proxy</code> å®ä¾‹ä»è¯¥é…ç½®ä¸­å¿ƒä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å‰æ–‡æˆ‘ä»¬ä»‹ç»è¿‡ <code>Spring Boot3</code> + <code>ShardingSphere-Proxy</code> å°±ç›¸å½“äºæ˜¯é›†æˆæ™®é€šçš„MySqlæ•°æ®åº“ï¼Œè€Œ <code>Spring Boot3</code> + <code>ShardingSphere-JDBC</code> å°±éœ€è¦å•ç‹¬åœ¨æœ¬åœ°é…ç½®å„ç§è§„åˆ™ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Š <code>ShardingSphere-JDBC</code> ä¹Ÿå¯ä»¥ä» <code>é…ç½®ä¸­å¿ƒ</code> ä¸­è¯»å–é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦åœ¨æœ¬åœ°é…ç½®ä»»ä½•è§„åˆ™äº†ï¼Œæˆ‘ä»¬ä»…éœ€è¦åœ¨ <code>sharding.yaml</code> ä¸­é…ç½®å¥½<code>è¿è¡Œæ¨¡å¼</code>ï¼Œå¹¶é…ç½®å¥½ <code>databaseName</code> çš„åç§°å³å¯ã€‚æ³¨æ„ï¼Œæ­¤æ—¶é…ç½®ä¸­å¿ƒçš„çš„äº‹åŠ¡ä¸èƒ½æ˜¯ <code>XA</code>ï¼Œå› ä¸º<code>Spring Boot3</code> + <code>ShardingSphere-JDBC</code>ç›®å‰ä¸æ”¯æŒ <code>XA</code> äº‹åŠ¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ­¤æ—¶ï¼Œspringbooté¡¹ç›®å¯åŠ¨åä¼šæ‹‰å–<code>é…ç½®ä¸­å¿ƒ</code>ä¸­çš„é…ç½®ä¿¡æ¯å¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„å…¶å®ƒé…ç½®ä¿¡æ¯ä¼šè¢«å¿½ç•¥ã€‚<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/G3kESF.png\" alt=\"\"></p>\n</li>\n</ul>\n<h3 id=\"å•æœºæ¨¡å¼\">å•æœºæ¨¡å¼</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-03\">ä»£ç ç¤ºä¾‹</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œå¿…é¡»é‡å¯åº”ç”¨æ‰èƒ½ç”Ÿæ•ˆ</p>\n</li>\n<li class=\"lvl-2\">\n<p>sharding.yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">mode:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">Standalone</span></span><br><span class=\"line\">  <span class=\"attr\">repository:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">JDBC</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">provider:</span> <span class=\"string\">MySQL</span></span><br><span class=\"line\">      <span class=\"attr\">jdbc_url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">      <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">      <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class=\"line\"><span class=\"attr\">databaseName:</span> <span class=\"string\">sharding_db</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Maven ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- MySQL Connector/J --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.baomidou<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.5.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.shardingsphere<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>shardingsphere-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.5.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.hanqf<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>algorithm-swapper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤æ¨¡å¼\">é›†ç¾¤æ¨¡å¼</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-04\">ä»£ç ç¤ºä¾‹</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œç«‹å³æ¨é€åˆ°æ‰€æœ‰å®ä¾‹ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>sharding.yamlï¼Œæ³¨æ„è¿™é‡Œä¸€å®šè¦é…ç½® <code>databaseName</code></p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># # å¼€å¯é›†ç¾¤æ¨¡å¼</span></span><br><span class=\"line\"><span class=\"attr\">mode:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">Cluster</span>                 <span class=\"comment\"># è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone</span></span><br><span class=\"line\">  <span class=\"attr\">repository:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">ZooKeeper</span>             <span class=\"comment\"># æ³¨å†Œä¸­å¿ƒç±»å‹</span></span><br><span class=\"line\">    <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">namespace:</span> <span class=\"string\">governance_ds</span>  <span class=\"comment\"># ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹</span></span><br><span class=\"line\">      <span class=\"attr\">server-lists:</span> <span class=\"string\">localhost:2181</span> <span class=\"comment\"># ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨</span></span><br><span class=\"line\">      <span class=\"attr\">retryIntervalMilliseconds:</span> <span class=\"number\">500</span> <span class=\"comment\"># ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">timeToLiveSeconds:</span> <span class=\"number\">60</span>     <span class=\"comment\"># è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥</span></span><br><span class=\"line\">      <span class=\"attr\">maxRetries:</span> <span class=\"number\">3</span>             <span class=\"comment\"># æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚</span></span><br><span class=\"line\">      <span class=\"attr\">operationTimeoutMilliseconds:</span> <span class=\"number\">500</span>  <span class=\"comment\"># å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class=\"line\"><span class=\"attr\">databaseName:</span> <span class=\"string\">sharding_db</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Maven ä¾èµ–ï¼Œæ³¨æ„è¦åŠ ä¸Š <code>shardingsphere-cluster-mode-repository-zookeeper</code> çš„ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- MySQL Connector/J --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.baomidou<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.5.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.shardingsphere<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>shardingsphere-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.5.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.hanqf<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>algorithm-swapper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- shardingsphere-cluster-mode-repository-zookeeper --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.shardingsphere<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>shardingsphere-cluster-mode-repository-zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.5.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å¦‚ä½•é€‰æ‹©\">å¦‚ä½•é€‰æ‹©</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å½“æˆ‘ä½¿ç”¨<code>springboot3+shardingSphere-JDBC5.5.2</code>æ—¶ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨æœ¬åœ°<code>é…ç½®æ–‡ä»¶</code>çš„æ–¹å¼è¿˜æ˜¯ä½¿ç”¨<code>é…ç½®ä¸­å¿ƒ</code>ï¼ˆæ¯”å¦‚ï¼šzookeeperï¼‰çš„æ–¹å¼å‘¢ï¼Ÿ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ–¹å¼</th>\n<th>éƒ¨ç½²å¤æ‚åº¦</th>\n<th>é…ç½®åŠ¨æ€æ›´æ–°</th>\n<th>å¤šå®ä¾‹å…±äº«é…ç½®</th>\n<th>çƒ­æ›´æ–°æ”¯æŒ</th>\n<th>é€‚ç”¨ç¯å¢ƒ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æœ¬åœ°é…ç½®æ–‡ä»¶</td>\n<td>ç®€å•</td>\n<td>ä¸æ”¯æŒ</td>\n<td>ä¸æ”¯æŒ</td>\n<td>å¦</td>\n<td>å¼€å‘/æµ‹è¯•/å°å‹é¡¹ç›®</td>\n</tr>\n<tr>\n<td>é…ç½®ä¸­å¿ƒï¼ˆZooKeeper/etcdï¼‰</td>\n<td>ç•¥é«˜</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n<td>æ˜¯</td>\n<td>ç”Ÿäº§/åˆ†å¸ƒå¼ç¯å¢ƒ</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ³¨æ„</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">DistSQL ç›®å‰ç¡®å®åªæ”¯æŒåœ¨ ShardingSphere-Proxy ä¸Šæ‰§è¡Œï¼Œå¹¶ä¸” Proxy åªæ”¯æŒ MySQL å’Œ PostgreSQL åè®®ã€‚</li>\n<li class=\"lvl-4\">å¦‚æœä½ åœ¨ Spring Boot + ShardingSphere-JDBC é‡Œç”¨ å…¶å®ƒæ•°æ®åº“ï¼ˆæ¯”å¦‚ SQL Serverã€Oracleã€DB2 ç­‰ï¼‰ï¼Œå°±æ— æ³•ç›´æ¥é€šè¿‡ DistSQL å»åŠ¨æ€æ”¹é…ç½®ã€‚</li>\n<li class=\"lvl-4\">æ­¤æ—¶ä½ å¯ä»¥é€‰æ‹©é€šè¿‡ Zookeeper çš„å®¢æˆ·ç«¯ç›´æ¥ä¿®æ”¹æˆ–é…ç½®è§„åˆ™ï¼Œä¹Ÿå¯ä»¥ä¸é€‰æ‹© <code>é…ç½®ä¸­å¿ƒ</code> çš„æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨ <code>æœ¬åœ°é…ç½®æ–‡ä»¶</code>ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†åº“åˆ†è¡¨\">ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†åº“åˆ†è¡¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åº“åˆ†è¡¨çš„ä¸»è¦ç›®çš„æ˜¯ <strong>è§£å†³æ•°æ®é‡å¤§å¸¦æ¥çš„æ€§èƒ½ã€å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§é—®é¢˜</strong>ã€‚é€šå¸¸éœ€è¦è€ƒè™‘çš„å‡ ä¸ªå…³é”®æŒ‡æ ‡ï¼š</p>\n</li>\n</ul>\n<h3 id=\"1-æ•°æ®é‡æŒ‡æ ‡\">1. æ•°æ®é‡æŒ‡æ ‡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>å•è¡¨æ•°æ®é‡è¿‡å¤§</strong>ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå•è¡¨æ•°æ®é‡åœ¨ <strong>åƒä¸‡çº§</strong> ä»¥ä¸Šæ—¶ï¼ŒæŸ¥è¯¢ã€å†™å…¥å’Œç´¢å¼•çš„æ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¾‹å¦‚ï¼šä¸€ä¸ªè®¢å•è¡¨ä¸€å¤©æœ‰ä¸Šç™¾ä¸‡æ¡æ•°æ®ï¼Œä¸€å¹´ä¸‹æ¥å¯èƒ½æœ‰ä¸Šäº¿æ¡ï¼Œå•è¡¨æ€§èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚</p>\n</li>\n</ul>\n<h3 id=\"2-è®¿é—®é‡æŒ‡æ ‡\">2. è®¿é—®é‡æŒ‡æ ‡</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>é«˜å¹¶å‘å†™å…¥æˆ–æŸ¥è¯¢</strong>ï¼šæ•°æ®åº“è¿æ¥ã€äº‹åŠ¡é”ã€IO ç­‰èµ„æºä¼šæˆä¸ºç“¶é¢ˆã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœä½ çš„ç³»ç»Ÿæ¯å¤©æœ‰ä¸Šåƒä¸‡çš„è¯·æ±‚ï¼Œæ•°æ®åº“å¯èƒ½æ— æ³•æ‰¿å—ã€‚</p>\n</li>\n</ul>\n<h3 id=\"3-ä¸šåŠ¡éš”ç¦»éœ€æ±‚\">3. ä¸šåŠ¡éš”ç¦»éœ€æ±‚</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸åŒä¸šåŠ¡çš„æ•°æ®åˆ†ç¦»ï¼Œé¿å…å•ä¸ªä¸šåŠ¡å½±å“æ•´ä¸ªæ•°æ®åº“çš„ç¨³å®šæ€§ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¾‹å¦‚ï¼šç”µå•†ç³»ç»Ÿä¸­çš„è®¢å•å’Œæ—¥å¿—æ•°æ®ï¼Œæ—¥å¿—é‡éå¸¸å¤§ï¼Œå’Œè®¢å•åˆ†å¼€å­˜å‚¨æ›´åˆç†ã€‚</p>\n</li>\n</ul>\n<h3 id=\"4-è¿è¥ä¸æˆæœ¬å› ç´ \">4. è¿è¥ä¸æˆæœ¬å› ç´ </h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†åº“åˆ†è¡¨åï¼Œå¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸Šï¼Œæ”¯æŒ <strong>æ°´å¹³æ‰©å±•</strong>ï¼Œè€Œä¸å¿…ä¾èµ–æ˜‚è´µçš„å•æœºæ•°æ®åº“ã€‚</p>\n</li>\n</ul>\n<h2 id=\"ä½¿ç”¨-ShardingSphere-å¯èƒ½å¸¦æ¥çš„é—®é¢˜\">ä½¿ç”¨ ShardingSphere å¯èƒ½å¸¦æ¥çš„é—®é¢˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨ <strong>ShardingSphere</strong> å¯ä»¥æ–¹ä¾¿åœ°è§£å†³åˆ†åº“åˆ†è¡¨é—®é¢˜ï¼Œä½†åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œå®ƒä¼šå¸¦æ¥ä¸€äº›æ–°çš„å¤æ‚æ€§å’Œæ½œåœ¨é—®é¢˜ï¼Œä¸»è¦ä½“ç°åœ¨æ€§èƒ½ã€è¿ç»´ã€åŠŸèƒ½é™åˆ¶ç­‰æ–¹é¢ã€‚</p>\n</li>\n</ul>\n<h3 id=\"1-æ€§èƒ½ä¸å»¶è¿Ÿ\">1. æ€§èƒ½ä¸å»¶è¿Ÿ</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>è·¨åº“ JOIN æ€§èƒ½å·®</strong><br>\nåˆ†åº“åˆ†è¡¨åï¼Œè·¨åº“çš„ <code>JOIN</code> æŸ¥è¯¢ä¼šåœ¨å„ä¸ªåˆ†ç‰‡ä¸Šåˆ†åˆ«æ‰§è¡Œï¼Œç„¶ååœ¨ ShardingSphere å±‚åˆå¹¶ç»“æœï¼Œæ€§èƒ½æ˜æ˜¾ä¸‹é™ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ä¾‹å¦‚ï¼šè®¢å•è¡¨åœ¨å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢è®¢å• + ç”¨æˆ·ä¿¡æ¯æ—¶å¿…é¡»è·¨åº“ JOINï¼Œæ‰§è¡Œæ•ˆç‡æ¯”å•åº“ä½å¾ˆå¤šã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p><strong>åˆ†é¡µæŸ¥è¯¢æ…¢</strong><br>\nåˆ†åº“åˆ†è¡¨åï¼Œå¦‚æœè¦å…¨å±€æ’åº + åˆ†é¡µï¼Œéœ€è¦æ‰€æœ‰åˆ†ç‰‡æŸ¥å‡ºæ•°æ®å†åˆå¹¶ï¼Œä»£ä»·éå¸¸å¤§ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">è§£å†³æ–¹å¼ï¼šä½¿ç”¨åˆ†ç‰‡é”®èŒƒå›´åˆ†é¡µï¼Œæˆ–å¼•å…¥ ElasticSearch/ClickHouse åšæœç´¢å’Œç»Ÿè®¡ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p><strong>å¹¿æ’­è¡¨å‹åŠ›</strong><br>\né…ç½®äº†å¹¿æ’­è¡¨ï¼ˆæ¯ä¸ªåº“ä¸€ä»½å®Œæ•´æ•°æ®ï¼‰åï¼Œæ›´æ–°éœ€è¦åŒæ­¥æ‰€æœ‰åº“ï¼Œå†™å…¥æ€§èƒ½ä¸‹é™ã€‚</p>\n</li>\n</ul>\n<h3 id=\"2-SQL-å…¼å®¹æ€§é™åˆ¶\">2. SQL å…¼å®¹æ€§é™åˆ¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>å¤æ‚ SQL æ”¯æŒä¸å®Œæ•´</strong><br>\nShardingSphere å¯¹æŸäº›å¤æ‚ SQLï¼ˆå¦‚å­æŸ¥è¯¢ã€çª—å£å‡½æ•°ï¼‰æ”¯æŒæœ‰é™ï¼Œå¯èƒ½æŠ¥é”™æˆ–æ€§èƒ½æå·®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><strong>å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨å—é™</strong><br>\nåˆ†åº“åˆ†è¡¨åï¼Œå­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨åœ¨åˆ†ç‰‡æ•°æ®åº“æ‰§è¡Œå¯èƒ½ä¸ä¸€è‡´ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚</p>\n</li>\n</ul>\n<h3 id=\"3-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜\">3. åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere æ”¯æŒ <strong>XA åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼Œä½†æ€§èƒ½ä¸å¦‚å•æœºäº‹åŠ¡ï¼Œå‡ºç°ç½‘ç»œæŠ–åŠ¨æ—¶å¯èƒ½ä¼šå¡ä½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœä¸šåŠ¡éœ€è¦å¼ºä¸€è‡´æ€§ï¼Œå¿…é¡»ç»“åˆå¯é æ¶ˆæ¯æˆ– TCCã€SAGA ç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼ï¼Œæ¶æ„ä¼šæ›´å¤æ‚ã€‚</p>\n</li>\n</ul>\n<h3 id=\"4-è¿ç»´ä¸ç®¡ç†å¤æ‚åº¦\">4. è¿ç»´ä¸ç®¡ç†å¤æ‚åº¦</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><strong>åˆ†ç‰‡è§„åˆ™å˜æ›´å›°éš¾</strong><br>\nä¾‹å¦‚ï¼Œæœ€åˆæŒ‰ <code>user_id % 2</code> åˆ†æˆä¸¤ä¸ªåº“ï¼Œåç»­æƒ³å¢åŠ åˆ° 4 ä¸ªåº“ï¼Œéœ€è¦è¿ç§»æ•°æ®ï¼Œéå¸¸éº»çƒ¦ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><strong>ç›‘æ§ä¸è°ƒä¼˜</strong><br>\nShardingSphere å¢åŠ äº†ä¸­é—´å±‚ï¼ŒSQL è·¯ç”±ã€æ‰§è¡Œè®¡åˆ’ã€æ•°æ®èŠ‚ç‚¹çŠ¶æ€éƒ½éœ€è¦é¢å¤–çš„ç›‘æ§å·¥å…·æ”¯æŒã€‚</p>\n</li>\n</ul>\n<h3 id=\"5-æˆæœ¬ä¸å­¦ä¹ æ›²çº¿\">5. æˆæœ¬ä¸å­¦ä¹ æ›²çº¿</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®ç›¸å¯¹å¤æ‚ï¼šåˆ†ç‰‡è§„åˆ™ã€è¯»å†™åˆ†ç¦»ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€å¼¹æ€§æ‰©å®¹éƒ½éœ€è¦ä»”ç»†è®¾è®¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼šå¼€å‘å’Œè¿ç»´äººå‘˜å¿…é¡»äº†è§£ ShardingSphere çš„å·¥ä½œæœºåˆ¶ï¼Œå¦åˆ™å®šä½é—®é¢˜å¾ˆå›°éš¾ã€‚</p>\n</li>\n</ul>\n<h3 id=\"6-é«˜å¯ç”¨ä¸æ‰©å±•é—®é¢˜\">6. é«˜å¯ç”¨ä¸æ‰©å±•é—®é¢˜</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere-JDBC æ˜¯åº”ç”¨å†…åº“ï¼Œæ— æ³•ç‹¬ç«‹æ‰©å±•ï¼Œéœ€è¦ä¾èµ–åº”ç”¨æ‰©å®¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy æ”¯æŒé›†ç¾¤ï¼Œä½†éœ€è¦è‡ªå·±æ­å»ºé«˜å¯ç”¨æ¶æ„ï¼Œæ¶‰åŠè´Ÿè½½å‡è¡¡ã€æ•…éšœåˆ‡æ¢ç­‰é—®é¢˜ã€‚</p>\n</li>\n</ul>\n<h2 id=\"å…¶å®ƒæŠ€æœ¯æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼æ•°æ®åº“\">å…¶å®ƒæŠ€æœ¯æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼æ•°æ®åº“</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¼€æºäº§å“: æ ¸å¿ƒåŠŸèƒ½å®Œå…¨å¼€æºï¼Œä¼ä¸šç‰ˆæä¾›é¢å¤–å•†ä¸šç‰¹æ€§</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ•°æ®åº“</th>\n<th>æ¶æ„ç±»å‹</th>\n<th>SQL å…¼å®¹æ€§</th>\n<th>åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ</th>\n<th>æ•°æ®å­˜å‚¨æ¨¡å‹</th>\n<th>ä¸»è¦ç‰¹ç‚¹</th>\n<th>å…¸å‹åº”ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><a href=\"https://www.pingcap.com/\">TiDB</a></strong></td>\n<td>åˆ†å¸ƒå¼ HTAP</td>\n<td>MySQL åè®®å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆPercolator æ¨¡å‹ï¼‰</td>\n<td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td>\n<td>å¼€æºã€äº‘åŸç”Ÿã€å¼ºä¸€è‡´æ€§ã€å¼¹æ€§æ‰©å±•</td>\n<td>åœ¨çº¿äº‹åŠ¡å¤„ç† + å®æ—¶åˆ†æ</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://en.oceanbase.com/\">OceanBase</a></strong></td>\n<td>åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td>\n<td>MySQL/Oracle å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>é«˜æ€§èƒ½ã€é‡‘èçº§äº‹åŠ¡ã€é˜¿é‡Œèš‚èšé‡‘æœæ ¸å¿ƒç³»ç»Ÿä½¿ç”¨</td>\n<td>é‡‘èã€ç”µå•†ã€æ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿ</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://www.cockroachlabs.com/\">CockroachDB</a></strong></td>\n<td>åˆ†å¸ƒå¼ NewSQL</td>\n<td>PostgreSQL å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>ç±» Spanner æ¶æ„ï¼Œå…¨çƒåˆ†å¸ƒï¼Œå¼ºä¸€è‡´æ€§</td>\n<td>å…¨çƒåŒ–åˆ†å¸ƒå¼åº”ç”¨</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://www.citusdata.com/\">Citus</a> (PostgreSQL)</strong></td>\n<td>PostgreSQL æ‰©å±•</td>\n<td>PostgreSQL å…¼å®¹</td>\n<td>éƒ¨åˆ†æ”¯æŒï¼ˆåŸºäºé€»è¾‘åˆ†ç‰‡ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>åŸºäº PostgreSQL çš„åˆ†å¸ƒå¼æ‰©å±•ï¼Œæ”¯æŒå¤§è§„æ¨¡ OLAP</td>\n<td>å¤§æ•°æ®å®æ—¶åˆ†æã€BI åœºæ™¯</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://vitess.io/\">Vitess</a></strong></td>\n<td>åˆ†å¸ƒå¼ä¸­é—´ä»¶ + å­˜å‚¨</td>\n<td>MySQL åè®®å…¼å®¹</td>\n<td>å¼±äº‹åŠ¡ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>YouTube å¼€æºï¼ŒK8s å‹å¥½ï¼Œåˆ†åº“åˆ†è¡¨è‡ªåŠ¨åŒ–</td>\n<td>å¤§è§„æ¨¡ Web åº”ç”¨ï¼Œåœ¨çº¿æœåŠ¡</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://www.yugabyte.com/\">YugabyteDB</a></strong></td>\n<td>åˆ†å¸ƒå¼ SQL + NoSQL</td>\n<td>PostgreSQL å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</td>\n<td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td>\n<td>èåˆ NewSQL å’Œ NoSQLï¼Œå¼ºä¸€è‡´æ€§ï¼Œè·¨åŒºåŸŸéƒ¨ç½²</td>\n<td>é‡‘èçº§äº‹åŠ¡ + åˆ†ææ··åˆåœºæ™¯</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å•†ä¸šäº§å“</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ•°æ®åº“</th>\n<th>æ¶æ„ç±»å‹</th>\n<th>SQL å…¼å®¹æ€§</th>\n<th>åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ</th>\n<th>æ•°æ®å­˜å‚¨æ¨¡å‹</th>\n<th>ä¸»è¦ç‰¹ç‚¹</th>\n<th>å…¸å‹åº”ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><a href=\"https://www.alibabacloud.com/product/polardb\">PolarDB</a></strong></td>\n<td>äº‘åŸç”Ÿåˆ†å¸ƒå¼æ•°æ®åº“</td>\n<td>MySQL/PostgreSQL å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆäº‘ç«¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>é˜¿é‡Œäº‘äº§å“ï¼Œå¼¹æ€§æ‰©å®¹ï¼Œå­˜å‚¨è®¡ç®—åˆ†ç¦»</td>\n<td>äº‘ä¸Šä¼ä¸šæ•°æ®åº“è§£å†³æ–¹æ¡ˆ</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://www.huaweicloud.com/product/gaussdb.html\">GaussDB</a></strong></td>\n<td>åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td>\n<td>MySQL/Oracle å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</td>\n<td>è¡Œå­˜ + åˆ—å­˜æ··åˆ</td>\n<td>åä¸ºæ¨å‡ºï¼Œåˆ†å¸ƒå¼ HTAPï¼Œäº‘åŸç”Ÿæ¶æ„</td>\n<td>ä¼ä¸šçº§ OLTP + OLAP æ··åˆè´Ÿè½½</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://cloud.google.com/spanner\">Spanner</a></strong></td>\n<td>å…¨çƒåˆ†å¸ƒå¼æ•°æ®åº“</td>\n<td>ç±» SQL</td>\n<td>æ”¯æŒï¼ˆTrueTime åè®®ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>Google äº‘äº§å“ï¼Œå…¨çƒåˆ†å¸ƒå¼å¼ºä¸€è‡´äº‹åŠ¡</td>\n<td>å…¨çƒåŒ–åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé‡‘èåœºæ™¯</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://aws.amazon.com/rds/aurora/\">Amazon Aurora</a></strong></td>\n<td>äº‘åŸç”Ÿåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“</td>\n<td>MySQL/PostgreSQL å…¼å®¹</td>\n<td>æ”¯æŒï¼ˆå•å®ä¾‹äº‹åŠ¡ï¼Œå¤š AZ é«˜å¯ç”¨ï¼‰</td>\n<td>è¡Œå­˜</td>\n<td>AWS æ‰˜ç®¡ï¼Œè‡ªåŠ¨æ‰©å±•å­˜å‚¨ï¼Œå¤šå¯ç”¨åŒºé«˜å¯ç”¨</td>\n<td>OLTPã€ä¼ä¸šçº§ä¸šåŠ¡</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡åœ¨ SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨ çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚ è¿è¡Œæ¨¡å¼è¯´æ˜ è¿è¡Œæ¨¡å¼ ShardingSphere-Proxy è¿è¡Œæ¨¡å¼åˆ†ä¸ºä¸¤ç§ï¼šå•æœºæ¨¡å¼(Standalone) å’Œ é›†ç¾¤æ¨¡å¼(Cluster)ã€‚ è¿è¡Œæ¨¡å¼å°±æ˜¯æŒ‡å®šå°†å…ƒæ•°æ®(è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ç­‰)æŒä¹…åŒ–çš„å­˜å‚¨æ–¹å¼ã€‚ é»˜è®¤è¿è¡Œæ¨¡å¼ä¸ºå•æœºæ¨¡å¼ï¼Œä½¿ç”¨H2çš„å†…å­˜æ–¹å¼ã€‚ å•æœºæ¨¡å¼(Standalone) å•æœºæ¨¡å¼èƒ½å¤Ÿå°†æ•°æ®æºå’Œè§„åˆ™ç­‰å…ƒæ•°æ®ä¿¡æ¯æŒä¹…åŒ–ï¼Œä½†æ— æ³•å°†å…ƒæ•°æ®åŒæ­¥è‡³å¤šä¸ª Apache ShardingSphere å®ä¾‹ï¼Œæ— æ³•åœ¨é›†ç¾¤ç¯å¢ƒä¸­ç›¸äº’æ„ŸçŸ¥ã€‚ é€šè¿‡æŸä¸€å®ä¾‹æ›´æ–°å…ƒæ•°æ®ä¹‹åï¼Œä¼šå¯¼è‡´å…¶ä»–å®ä¾‹ç”±äºè·å–ä¸åˆ°æœ€æ–°çš„å…ƒæ•°æ®è€Œäº§ç”Ÿä¸ä¸€è‡´çš„é”™è¯¯ã€‚ é€‚ç”¨äºå·¥ç¨‹å¸ˆåœ¨æœ¬åœ°æ­å»º Apache ShardingSphere ç¯å¢ƒã€‚ å•æœºæ¨¡å¼ç›®å‰ä»…æ”¯æŒä¸€ç§ï¼šJDBCï¼Œå³æ•°æ®åº“æŒä¹…åŒ–ã€‚ä»¥ä¸‹ä¸ºé»˜è®¤å€¼(JDBCRepositoryPropertyKey)ã€‚ åç§° æ•°æ®ç±»å‹ è¯´æ˜ é»˜è®¤å€¼ provider String å…ƒæ•°æ®å­˜å‚¨ç±»å‹ï¼Œå¯é€‰å€¼ä¸º H2ã€MySQL ã€EmbeddedDerbyã€DerbyNetworkServerã€HSQLDB H2 jdbc_url String JDBC URL jdbc:h2:mem:config;DB_CLOSE_DELAY=0;DATABASE_TO_UPPER=false;MODE=MYSQL username String è´¦å· sa password String å¯†ç  ç©ºï¼ˆæ— é»˜è®¤å€¼ï¼‰ è¿™é‡Œä»¥ Mysql å­˜å‚¨å…ƒæ•°æ®ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒå®˜ç½‘è¯´æ˜ 123456789mode: type: Standalone repository: type: JDBC props: provider: MySQL jdbc_url: jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd æ­¤æ—¶éœ€è¦å°† mysql çš„é©±åŠ¨ jar åŒ… æ·»åŠ åˆ° ext-lib ç›®å½•ä¸‹ å¯åŠ¨ ShardingSphere Proxy æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ä¸Šé¢çš„æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¼ è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„ä¸­çš„å…ƒæ•°æ®å­˜å‚¨è¿›å» 1234567CREATE TABLE `repository` ( `id` varchar(36) COLLATE utf8mb4_bin NOT NULL, `key` text COLLATE utf8mb4_bin, `value` text COLLATE utf8mb4_bin, `parent` text COLLATE utf8mb4_bin, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin; é‡ç‚¹è¯´æ˜ å½“æ•°æ®åº“ä¸­ä¸å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¯¥è¡¨ï¼Œå¹¶å°†é…ç½®æ–‡ä»¶çš„å…ƒæ•°æ®æ’å…¥è¯¥è¡¨ä¸­ã€‚ å½“æ•°æ®åº“ä¸­å·²å­˜åœ¨è¯¥è¡¨æ—¶ï¼Œä¼šè¯»å–è¯¥è¡¨ä¸­çš„æ•°æ®å¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ï¼Œè€Œä¸ä¼šè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚å³æ­¤æ—¶é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ä¸ä¼šç”Ÿæ•ˆã€‚ è‹¥æ­¤æ—¶æƒ³ä¿®æ”¹é…ç½®è§„åˆ™ï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š 1.åˆ é™¤è¯¥è¡¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åé‡æ–°å¯åŠ¨Proxyï¼Œæ­¤æ—¶ä¼šé‡æ–°åˆ›å»ºè¯¥è¡¨å¹¶åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„å…ƒæ•°æ®ã€‚ 2.æ‰‹å·¥ä¿®æ”¹æ•°æ®è¡¨ä¸­çš„å…ƒæ•°æ®ï¼Œä½†ä¿®æ”¹åéœ€è¦é‡æ–°å¯åŠ¨Proxyæ‰ä¼šåŠ è½½æ–°çš„å…ƒæ•°æ®ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚ 3.[æ¨è]ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ DistSQL åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œä¿®æ”¹åçš„é…ç½®ä¼šè¢«ä¿å­˜åœ¨è¯¥è¡¨ä¸­ï¼Œå¹¶ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯Proxyã€‚ å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒå¯ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤çš„ H2 å†…å­˜æ•°æ®åº“ï¼Œç”Ÿäº§ç¯å¢ƒå¯ä»¥ä½¿ç”¨ MySQLç­‰æ•°æ®åº“å¯¹å…ƒæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„é›†ç¾¤æ¨¡å¼ã€‚ é›†ç¾¤æ¨¡å¼(Cluster) é›†ç¾¤æ¨¡å¼æä¾›äº†å¤šä¸ª Apache ShardingSphere å®ä¾‹ä¹‹é—´çš„å…ƒæ•°æ®å…±äº«å’Œåˆ†å¸ƒå¼åœºæ™¯ä¸‹çŠ¶æ€åè°ƒçš„èƒ½åŠ›ã€‚ å®ƒèƒ½å¤Ÿæä¾›è®¡ç®—èƒ½åŠ›æ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨ç­‰åˆ†å¸ƒå¼ç³»ç»Ÿå¿…å¤‡çš„èƒ½åŠ›ï¼Œé›†ç¾¤ç¯å¢ƒéœ€è¦é€šè¿‡ç‹¬ç«‹éƒ¨ç½²çš„æ³¨å†Œä¸­å¿ƒæ¥å­˜å‚¨å…ƒæ•°æ®å’Œåè°ƒèŠ‚ç‚¹çŠ¶æ€ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨é›†ç¾¤æ¨¡å¼ã€‚ è¿™é‡Œä»¥ zookeeper é›†ç¾¤æ¨¡å¼ä¸ºä¾‹ï¼Œç›¸å…³å±æ€§å‚è€ƒå®˜ç½‘è¯´æ˜ 1234567891011mode: type: Cluster # è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone repository: type: ZooKeeper # æ³¨å†Œä¸­å¿ƒç±»å‹ï¼Œå½“å‰ç‰ˆæœ¬ä»…æ”¯æŒ ZooKeeper å’Œ etcd props: namespace: governance_ds # ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹ server-lists: localhost:2181 # ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨ retryIntervalMilliseconds: 500 # ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚ timeToLiveSeconds: 60 # è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥ maxRetries: 3 # æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚ operationTimeoutMilliseconds: 500 # å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚ é‡ç‚¹è¯´æ˜ ä¸è¦æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­çš„ namespace ä¸‹çš„é…ç½®ä¿¡æ¯! æ—¢ç„¶æ˜¯é›†ç¾¤ï¼Œå°±éœ€è¦å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ã€‚ å½“ç¬¬ä¸€ä¸ª ShardingSphere-Proxy å®ä¾‹ å¯åŠ¨åï¼Œå…¶å®ƒç›¸åŒé…ç½®çš„ ShardingSphere-Proxy å®ä¾‹ä»…éœ€è¦ä¸€ä¸ª global.yaml å…¨å±€é…ç½®æ–‡ä»¶å³å¯ï¼Œå¹¶ä»…éœ€åœ¨å…¶ä¸­é…ç½®ä¸Šé¢çš„è¿è¡Œæ¨¡å¼ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å†é…ç½®å…¶å®ƒé…ç½®ï¼Œæ¯”å¦‚è®¤è¯ã€æ•°æ®æºã€åˆ†ç‰‡è§„åˆ™ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šé€šè¿‡ Zookeeper é›†ç¾¤ä¸­çš„ namespace è·å–å¹¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ä¸­ã€‚ æ¯ä¸ª ShardingSphere-Proxy å®ä¾‹å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨å°†è‡ªå·±æ³¨å†Œåˆ° Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹ï¼Œå¹¶è‡ªåŠ¨è·å–è¯¥ namespace ä¸‹çš„é…ç½®ä¿¡æ¯ã€‚ å½“ Zookeeper é›†ç¾¤ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶ç¬¬ä¸€æ¬¡å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨åœ¨ Zookeeper ä¸­åˆ›å»º namespaceï¼Œå¹¶å†™å…¥é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯åˆ° Zookeeper ä¸­ã€‚ å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ­¤æ—¶å†å¯åŠ¨ ShardingSphere-Proxy ä¼šè‡ªåŠ¨ä» Zookeeper ä¸­è¯»å– namespace ä¸‹çš„é…ç½®ä¿¡æ¯ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä¸ä¼šå†è¯»å–æœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚ å½“ Zookeeper é›†ç¾¤ä¸­å·²å­˜åœ¨æŒ‡å®šçš„ namespace æ—¶ï¼Œæ ¹æ®ä¸Šé¢çš„è§„åˆ™ï¼Œæ­¤æ—¶ä¿®æ”¹æœ¬åœ°çš„é…ç½®æ–‡ä»¶ä¸­çš„åˆ†ç‰‡è§„åˆ™åé‡å¯ShardingSphere-Proxy å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚ æ­¤æ—¶æœ‰ä¸‰ç§æ–¹æ³•ï¼š åˆ é™¤ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespaceï¼Œç„¶åé‡å¯ ShardingSphere-Proxyã€‚è¿™ç§æ–¹æ³•æœ‰ä¸ªå¼Šç«¯ï¼Œå³ä¼šå¯¼è‡´è¿æ¥åˆ°ç›¸åŒ ZooKeeper é›†ç¾¤çš„ namespace çš„å…¶å®ƒ ShardingSphere-Proxy å®ä¾‹æ•°æ®ä¸¢å¤±(å®Œå…¨ä¸å¯ç”¨)ï¼Œä¹Ÿéœ€è¦é‡å¯æ‰èƒ½é‡æ–°è·å–åˆ°æ•°æ®ã€‚ æ‰‹å·¥ä¿®æ”¹ Zookeeper é›†ç¾¤ä¸­æŒ‡å®šçš„ namespace ä¸‹çš„åˆ†ç‰‡è§„åˆ™ï¼Œä¿®æ”¹åä¼šç«‹å³åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚ä½†æ‰‹å·¥ä¿®æ”¹éœ€è¦å¯¹æ•°æ®çš„ç»„ç»‡å½¢å¼éå¸¸æ¸…æ¥šï¼Œå¦åˆ™ææ˜“å‡ºé”™ã€‚ [æ¨è]ç™»å½•é€»è¾‘æ•°æ®åº“åï¼Œä½¿ç”¨ DistSQL åŠ¨æ€ä¿®æ”¹é…ç½®ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰ ShardingSphere-Proxy å®ä¾‹ã€‚æ‰€ä»¥ï¼Œçµæ´»æŒæ¡ DistSQL æ˜¯ç»´æŠ¤ ShardingSphere-Proxy é›†ç¾¤çš„å…³é”®ã€‚ å¤šä¸ª ShardingSphere-Proxy å®ä¾‹ å¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡å™¨ï¼Œæ¯”å¦‚ Nginxï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„ ShardingSphere-Proxy å®ä¾‹ã€‚æ¯”å¦‚ï¼š 123456789101112stream&#123; upstream shardingsphere_proxy&#123; server 10.10.21.35:3307; server 10.10.21.36:3307; &#125; server&#123; listen 3310; proxy_connect_timeout 20s; proxy_timeout 5m; proxy_pass shardingsphere_proxy; &#125;&#125; ä¸ Spring Boot3 æ•´åˆ æ— è®ºæ˜¯ å•æœºæ¨¡å¼ è¿˜æ˜¯ é›†ç¾¤æ¨¡å¼ï¼Œå…¶ç›®çš„éƒ½æ˜¯å°† é…ç½® ä¿å­˜åˆ°ç‹¬ç«‹çš„ é…ç½®ä¸­å¿ƒ(æ•°æ®åº“ æˆ– Zookeeper)ä¸­ï¼Œå¹¶è®©å…¶å®ƒ ShardingSphere-Proxy å®ä¾‹ä»è¯¥é…ç½®ä¸­å¿ƒä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚ å‰æ–‡æˆ‘ä»¬ä»‹ç»è¿‡ Spring Boot3 + ShardingSphere-Proxy å°±ç›¸å½“äºæ˜¯é›†æˆæ™®é€šçš„MySqlæ•°æ®åº“ï¼Œè€Œ Spring Boot3 + ShardingSphere-JDBC å°±éœ€è¦å•ç‹¬åœ¨æœ¬åœ°é…ç½®å„ç§è§„åˆ™ã€‚ å®é™…ä¸Š ShardingSphere-JDBC ä¹Ÿå¯ä»¥ä» é…ç½®ä¸­å¿ƒ ä¸­è¯»å–é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦åœ¨æœ¬åœ°é…ç½®ä»»ä½•è§„åˆ™äº†ï¼Œæˆ‘ä»¬ä»…éœ€è¦åœ¨ sharding.yaml ä¸­é…ç½®å¥½è¿è¡Œæ¨¡å¼ï¼Œå¹¶é…ç½®å¥½ databaseName çš„åç§°å³å¯ã€‚æ³¨æ„ï¼Œæ­¤æ—¶é…ç½®ä¸­å¿ƒçš„çš„äº‹åŠ¡ä¸èƒ½æ˜¯ XAï¼Œå› ä¸ºSpring Boot3 + ShardingSphere-JDBCç›®å‰ä¸æ”¯æŒ XA äº‹åŠ¡ã€‚ æ­¤æ—¶ï¼Œspringbooté¡¹ç›®å¯åŠ¨åä¼šæ‹‰å–é…ç½®ä¸­å¿ƒä¸­çš„é…ç½®ä¿¡æ¯å¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°é…ç½®æ–‡ä»¶ä¸­çš„å…¶å®ƒé…ç½®ä¿¡æ¯ä¼šè¢«å¿½ç•¥ã€‚ å•æœºæ¨¡å¼ ä»£ç ç¤ºä¾‹ é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œå¿…é¡»é‡å¯åº”ç”¨æ‰èƒ½ç”Ÿæ•ˆ sharding.yaml 1234567891011mode: type: Standalone repository: type: JDBC props: provider: MySQL jdbc_url: jdbc:mysql://127.0.0.1:3306/shardingsphere?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd# æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_dbdatabaseName: sharding_db Maven ä¾èµ– 123456789101112131415161718192021222324&lt;!-- MySQL Connector/J --&gt;&lt;dependency&gt; &lt;groupId&gt;com.mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-spring-boot3-starter&lt;/artifactId&gt; &lt;version&gt;3.5.12&lt;/version&gt;&lt;/dependency&gt;&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;shardingsphere-jdbc&lt;/artifactId&gt; &lt;version&gt;5.5.2&lt;/version&gt;&lt;/dependency&gt;&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;&lt;dependency&gt; &lt;groupId&gt;com.hanqf&lt;/groupId&gt; &lt;artifactId&gt;algorithm-swapper&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;/dependency&gt; é›†ç¾¤æ¨¡å¼ ä»£ç ç¤ºä¾‹ é€šè¿‡ DistSQL æ”¹è§„åˆ™åï¼Œç«‹å³æ¨é€åˆ°æ‰€æœ‰å®ä¾‹ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚ sharding.yamlï¼Œæ³¨æ„è¿™é‡Œä¸€å®šè¦é…ç½® databaseName 1234567891011121314# # å¼€å¯é›†ç¾¤æ¨¡å¼mode: type: Cluster # è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤æ˜¯å•æœºæ¨¡å¼ Standalone repository: type: ZooKeeper # æ³¨å†Œä¸­å¿ƒç±»å‹ props: namespace: governance_ds # ZooKeeper ä¸Šçš„æ ¹è·¯å¾„ï¼ˆé€»è¾‘å‘½åç©ºé—´ï¼‰ï¼ŒShardingSphere ä¼šæŠŠæ‰€æœ‰å…ƒæ•°æ®ï¼ˆschema çš„ data_sourcesã€rulesã€ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œæ—¶å®ä¾‹èŠ‚ç‚¹ç­‰ï¼‰æ”¾åœ¨è¯¥ namespace ä¸‹ server-lists: localhost:2181 # ZooKeeper é›†ç¾¤åœ°å€åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”çš„ host:port åˆ—è¡¨ retryIntervalMilliseconds: 500 # ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’å¤±è´¥åçš„é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ã€‚ç½‘ç»œä¸ç¨³å®šæˆ–çŸ­æš‚æ•…éšœæ—¶ç”¨äºé‡è¯•å›é€€ã€‚ timeToLiveSeconds: 60 # è¡¨ç¤ºâ€œä¸´æ—¶/çŸ­æœŸæ•°æ®â€çš„ç”Ÿå­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ§åˆ¶æŸäº›ä¸´æ—¶èŠ‚ç‚¹/å®ä¾‹ä¿¡æ¯çš„å­˜æ´»ç­–ç•¥ maxRetries: 3 # æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¶…è¿‡åˆ™è®¤ä¸ºæ“ä½œå¤±è´¥ï¼‰ã€‚ operationTimeoutMilliseconds: 500 # å•æ¬¡ ZooKeeper æ“ä½œï¼ˆè¯»å†™ï¼‰çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚# æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_dbdatabaseName: sharding_db Maven ä¾èµ–ï¼Œæ³¨æ„è¦åŠ ä¸Š shardingsphere-cluster-mode-repository-zookeeper çš„ä¾èµ– 123456789101112131415161718192021222324252627282930&lt;!-- MySQL Connector/J --&gt;&lt;dependency&gt; &lt;groupId&gt;com.mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-spring-boot3-starter&lt;/artifactId&gt; &lt;version&gt;3.5.12&lt;/version&gt;&lt;/dependency&gt;&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;shardingsphere-jdbc&lt;/artifactId&gt; &lt;version&gt;5.5.2&lt;/version&gt;&lt;/dependency&gt;&lt;!-- è‡ªå®šä¹‰ çš„ SPI --&gt;&lt;dependency&gt; &lt;groupId&gt;com.hanqf&lt;/groupId&gt; &lt;artifactId&gt;algorithm-swapper&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- shardingsphere-cluster-mode-repository-zookeeper --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;shardingsphere-cluster-mode-repository-zookeeper&lt;/artifactId&gt; &lt;version&gt;5.5.2&lt;/version&gt;&lt;/dependency&gt; å¦‚ä½•é€‰æ‹© å½“æˆ‘ä½¿ç”¨springboot3+shardingSphere-JDBC5.5.2æ—¶ï¼Œæˆ‘åº”è¯¥ä½¿ç”¨æœ¬åœ°é…ç½®æ–‡ä»¶çš„æ–¹å¼è¿˜æ˜¯ä½¿ç”¨é…ç½®ä¸­å¿ƒï¼ˆæ¯”å¦‚ï¼šzookeeperï¼‰çš„æ–¹å¼å‘¢ï¼Ÿ æ–¹å¼ éƒ¨ç½²å¤æ‚åº¦ é…ç½®åŠ¨æ€æ›´æ–° å¤šå®ä¾‹å…±äº«é…ç½® çƒ­æ›´æ–°æ”¯æŒ é€‚ç”¨ç¯å¢ƒ æœ¬åœ°é…ç½®æ–‡ä»¶ ç®€å• ä¸æ”¯æŒ ä¸æ”¯æŒ å¦ å¼€å‘/æµ‹è¯•/å°å‹é¡¹ç›® é…ç½®ä¸­å¿ƒï¼ˆZooKeeper/etcdï¼‰ ç•¥é«˜ æ”¯æŒ æ”¯æŒ æ˜¯ ç”Ÿäº§/åˆ†å¸ƒå¼ç¯å¢ƒ æ³¨æ„ DistSQL ç›®å‰ç¡®å®åªæ”¯æŒåœ¨ ShardingSphere-Proxy ä¸Šæ‰§è¡Œï¼Œå¹¶ä¸” Proxy åªæ”¯æŒ MySQL å’Œ PostgreSQL åè®®ã€‚ å¦‚æœä½ åœ¨ Spring Boot + ShardingSphere-JDBC é‡Œç”¨ å…¶å®ƒæ•°æ®åº“ï¼ˆæ¯”å¦‚ SQL Serverã€Oracleã€DB2 ç­‰ï¼‰ï¼Œå°±æ— æ³•ç›´æ¥é€šè¿‡ DistSQL å»åŠ¨æ€æ”¹é…ç½®ã€‚ æ­¤æ—¶ä½ å¯ä»¥é€‰æ‹©é€šè¿‡ Zookeeper çš„å®¢æˆ·ç«¯ç›´æ¥ä¿®æ”¹æˆ–é…ç½®è§„åˆ™ï¼Œä¹Ÿå¯ä»¥ä¸é€‰æ‹© é…ç½®ä¸­å¿ƒ çš„æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨ æœ¬åœ°é…ç½®æ–‡ä»¶ã€‚ ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†åº“åˆ†è¡¨ åˆ†åº“åˆ†è¡¨çš„ä¸»è¦ç›®çš„æ˜¯ è§£å†³æ•°æ®é‡å¤§å¸¦æ¥çš„æ€§èƒ½ã€å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§é—®é¢˜ã€‚é€šå¸¸éœ€è¦è€ƒè™‘çš„å‡ ä¸ªå…³é”®æŒ‡æ ‡ï¼š 1. æ•°æ®é‡æŒ‡æ ‡ å•è¡¨æ•°æ®é‡è¿‡å¤§ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå•è¡¨æ•°æ®é‡åœ¨ åƒä¸‡çº§ ä»¥ä¸Šæ—¶ï¼ŒæŸ¥è¯¢ã€å†™å…¥å’Œç´¢å¼•çš„æ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ã€‚ ä¾‹å¦‚ï¼šä¸€ä¸ªè®¢å•è¡¨ä¸€å¤©æœ‰ä¸Šç™¾ä¸‡æ¡æ•°æ®ï¼Œä¸€å¹´ä¸‹æ¥å¯èƒ½æœ‰ä¸Šäº¿æ¡ï¼Œå•è¡¨æ€§èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚ 2. è®¿é—®é‡æŒ‡æ ‡ é«˜å¹¶å‘å†™å…¥æˆ–æŸ¥è¯¢ï¼šæ•°æ®åº“è¿æ¥ã€äº‹åŠ¡é”ã€IO ç­‰èµ„æºä¼šæˆä¸ºç“¶é¢ˆã€‚ å¦‚æœä½ çš„ç³»ç»Ÿæ¯å¤©æœ‰ä¸Šåƒä¸‡çš„è¯·æ±‚ï¼Œæ•°æ®åº“å¯èƒ½æ— æ³•æ‰¿å—ã€‚ 3. ä¸šåŠ¡éš”ç¦»éœ€æ±‚ ä¸åŒä¸šåŠ¡çš„æ•°æ®åˆ†ç¦»ï¼Œé¿å…å•ä¸ªä¸šåŠ¡å½±å“æ•´ä¸ªæ•°æ®åº“çš„ç¨³å®šæ€§ã€‚ ä¾‹å¦‚ï¼šç”µå•†ç³»ç»Ÿä¸­çš„è®¢å•å’Œæ—¥å¿—æ•°æ®ï¼Œæ—¥å¿—é‡éå¸¸å¤§ï¼Œå’Œè®¢å•åˆ†å¼€å­˜å‚¨æ›´åˆç†ã€‚ 4. è¿è¥ä¸æˆæœ¬å› ç´  åˆ†åº“åˆ†è¡¨åï¼Œå¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸Šï¼Œæ”¯æŒ æ°´å¹³æ‰©å±•ï¼Œè€Œä¸å¿…ä¾èµ–æ˜‚è´µçš„å•æœºæ•°æ®åº“ã€‚ ä½¿ç”¨ ShardingSphere å¯èƒ½å¸¦æ¥çš„é—®é¢˜ ä½¿ç”¨ ShardingSphere å¯ä»¥æ–¹ä¾¿åœ°è§£å†³åˆ†åº“åˆ†è¡¨é—®é¢˜ï¼Œä½†åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œå®ƒä¼šå¸¦æ¥ä¸€äº›æ–°çš„å¤æ‚æ€§å’Œæ½œåœ¨é—®é¢˜ï¼Œä¸»è¦ä½“ç°åœ¨æ€§èƒ½ã€è¿ç»´ã€åŠŸèƒ½é™åˆ¶ç­‰æ–¹é¢ã€‚ 1. æ€§èƒ½ä¸å»¶è¿Ÿ è·¨åº“ JOIN æ€§èƒ½å·® åˆ†åº“åˆ†è¡¨åï¼Œè·¨åº“çš„ JOIN æŸ¥è¯¢ä¼šåœ¨å„ä¸ªåˆ†ç‰‡ä¸Šåˆ†åˆ«æ‰§è¡Œï¼Œç„¶ååœ¨ ShardingSphere å±‚åˆå¹¶ç»“æœï¼Œæ€§èƒ½æ˜æ˜¾ä¸‹é™ã€‚ ä¾‹å¦‚ï¼šè®¢å•è¡¨åœ¨å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢è®¢å• + ç”¨æˆ·ä¿¡æ¯æ—¶å¿…é¡»è·¨åº“ JOINï¼Œæ‰§è¡Œæ•ˆç‡æ¯”å•åº“ä½å¾ˆå¤šã€‚ åˆ†é¡µæŸ¥è¯¢æ…¢ åˆ†åº“åˆ†è¡¨åï¼Œå¦‚æœè¦å…¨å±€æ’åº + åˆ†é¡µï¼Œéœ€è¦æ‰€æœ‰åˆ†ç‰‡æŸ¥å‡ºæ•°æ®å†åˆå¹¶ï¼Œä»£ä»·éå¸¸å¤§ã€‚ è§£å†³æ–¹å¼ï¼šä½¿ç”¨åˆ†ç‰‡é”®èŒƒå›´åˆ†é¡µï¼Œæˆ–å¼•å…¥ ElasticSearch/ClickHouse åšæœç´¢å’Œç»Ÿè®¡ã€‚ å¹¿æ’­è¡¨å‹åŠ› é…ç½®äº†å¹¿æ’­è¡¨ï¼ˆæ¯ä¸ªåº“ä¸€ä»½å®Œæ•´æ•°æ®ï¼‰åï¼Œæ›´æ–°éœ€è¦åŒæ­¥æ‰€æœ‰åº“ï¼Œå†™å…¥æ€§èƒ½ä¸‹é™ã€‚ 2. SQL å…¼å®¹æ€§é™åˆ¶ å¤æ‚ SQL æ”¯æŒä¸å®Œæ•´ ShardingSphere å¯¹æŸäº›å¤æ‚ SQLï¼ˆå¦‚å­æŸ¥è¯¢ã€çª—å£å‡½æ•°ï¼‰æ”¯æŒæœ‰é™ï¼Œå¯èƒ½æŠ¥é”™æˆ–æ€§èƒ½æå·®ã€‚ å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨å—é™ åˆ†åº“åˆ†è¡¨åï¼Œå­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨åœ¨åˆ†ç‰‡æ•°æ®åº“æ‰§è¡Œå¯èƒ½ä¸ä¸€è‡´ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚ 3. åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ ShardingSphere æ”¯æŒ XA åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†æ€§èƒ½ä¸å¦‚å•æœºäº‹åŠ¡ï¼Œå‡ºç°ç½‘ç»œæŠ–åŠ¨æ—¶å¯èƒ½ä¼šå¡ä½ã€‚ å¦‚æœä¸šåŠ¡éœ€è¦å¼ºä¸€è‡´æ€§ï¼Œå¿…é¡»ç»“åˆå¯é æ¶ˆæ¯æˆ– TCCã€SAGA ç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼ï¼Œæ¶æ„ä¼šæ›´å¤æ‚ã€‚ 4. è¿ç»´ä¸ç®¡ç†å¤æ‚åº¦ åˆ†ç‰‡è§„åˆ™å˜æ›´å›°éš¾ ä¾‹å¦‚ï¼Œæœ€åˆæŒ‰ user_id % 2 åˆ†æˆä¸¤ä¸ªåº“ï¼Œåç»­æƒ³å¢åŠ åˆ° 4 ä¸ªåº“ï¼Œéœ€è¦è¿ç§»æ•°æ®ï¼Œéå¸¸éº»çƒ¦ã€‚ ç›‘æ§ä¸è°ƒä¼˜ ShardingSphere å¢åŠ äº†ä¸­é—´å±‚ï¼ŒSQL è·¯ç”±ã€æ‰§è¡Œè®¡åˆ’ã€æ•°æ®èŠ‚ç‚¹çŠ¶æ€éƒ½éœ€è¦é¢å¤–çš„ç›‘æ§å·¥å…·æ”¯æŒã€‚ 5. æˆæœ¬ä¸å­¦ä¹ æ›²çº¿ é…ç½®ç›¸å¯¹å¤æ‚ï¼šåˆ†ç‰‡è§„åˆ™ã€è¯»å†™åˆ†ç¦»ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€å¼¹æ€§æ‰©å®¹éƒ½éœ€è¦ä»”ç»†è®¾è®¡ã€‚ å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼šå¼€å‘å’Œè¿ç»´äººå‘˜å¿…é¡»äº†è§£ ShardingSphere çš„å·¥ä½œæœºåˆ¶ï¼Œå¦åˆ™å®šä½é—®é¢˜å¾ˆå›°éš¾ã€‚ 6. é«˜å¯ç”¨ä¸æ‰©å±•é—®é¢˜ ShardingSphere-JDBC æ˜¯åº”ç”¨å†…åº“ï¼Œæ— æ³•ç‹¬ç«‹æ‰©å±•ï¼Œéœ€è¦ä¾èµ–åº”ç”¨æ‰©å®¹ã€‚ ShardingSphere-Proxy æ”¯æŒé›†ç¾¤ï¼Œä½†éœ€è¦è‡ªå·±æ­å»ºé«˜å¯ç”¨æ¶æ„ï¼Œæ¶‰åŠè´Ÿè½½å‡è¡¡ã€æ•…éšœåˆ‡æ¢ç­‰é—®é¢˜ã€‚ å…¶å®ƒæŠ€æœ¯æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼æ•°æ®åº“ å¼€æºäº§å“: æ ¸å¿ƒåŠŸèƒ½å®Œå…¨å¼€æºï¼Œä¼ä¸šç‰ˆæä¾›é¢å¤–å•†ä¸šç‰¹æ€§ æ•°æ®åº“ æ¶æ„ç±»å‹ SQL å…¼å®¹æ€§ åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ æ•°æ®å­˜å‚¨æ¨¡å‹ ä¸»è¦ç‰¹ç‚¹ å…¸å‹åº”ç”¨åœºæ™¯ TiDB åˆ†å¸ƒå¼ HTAP MySQL åè®®å…¼å®¹ æ”¯æŒï¼ˆPercolator æ¨¡å‹ï¼‰ è¡Œå­˜ + åˆ—å­˜æ··åˆ å¼€æºã€äº‘åŸç”Ÿã€å¼ºä¸€è‡´æ€§ã€å¼¹æ€§æ‰©å±• åœ¨çº¿äº‹åŠ¡å¤„ç† + å®æ—¶åˆ†æ OceanBase åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ MySQL/Oracle å…¼å®¹ æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰ è¡Œå­˜ é«˜æ€§èƒ½ã€é‡‘èçº§äº‹åŠ¡ã€é˜¿é‡Œèš‚èšé‡‘æœæ ¸å¿ƒç³»ç»Ÿä½¿ç”¨ é‡‘èã€ç”µå•†ã€æ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿ CockroachDB åˆ†å¸ƒå¼ NewSQL PostgreSQL å…¼å®¹ æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ è¡Œå­˜ ç±» Spanner æ¶æ„ï¼Œå…¨çƒåˆ†å¸ƒï¼Œå¼ºä¸€è‡´æ€§ å…¨çƒåŒ–åˆ†å¸ƒå¼åº”ç”¨ Citus (PostgreSQL) PostgreSQL æ‰©å±• PostgreSQL å…¼å®¹ éƒ¨åˆ†æ”¯æŒï¼ˆåŸºäºé€»è¾‘åˆ†ç‰‡ï¼‰ è¡Œå­˜ åŸºäº PostgreSQL çš„åˆ†å¸ƒå¼æ‰©å±•ï¼Œæ”¯æŒå¤§è§„æ¨¡ OLAP å¤§æ•°æ®å®æ—¶åˆ†æã€BI åœºæ™¯ Vitess åˆ†å¸ƒå¼ä¸­é—´ä»¶ + å­˜å‚¨ MySQL åè®®å…¼å®¹ å¼±äº‹åŠ¡ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ è¡Œå­˜ YouTube å¼€æºï¼ŒK8s å‹å¥½ï¼Œåˆ†åº“åˆ†è¡¨è‡ªåŠ¨åŒ– å¤§è§„æ¨¡ Web åº”ç”¨ï¼Œåœ¨çº¿æœåŠ¡ YugabyteDB åˆ†å¸ƒå¼ SQL + NoSQL PostgreSQL å…¼å®¹ æ”¯æŒï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰ è¡Œå­˜ + åˆ—å­˜æ··åˆ èåˆ NewSQL å’Œ NoSQLï¼Œå¼ºä¸€è‡´æ€§ï¼Œè·¨åŒºåŸŸéƒ¨ç½² é‡‘èçº§äº‹åŠ¡ + åˆ†ææ··åˆåœºæ™¯ å•†ä¸šäº§å“ æ•°æ®åº“ æ¶æ„ç±»å‹ SQL å…¼å®¹æ€§ åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ æ•°æ®å­˜å‚¨æ¨¡å‹ ä¸»è¦ç‰¹ç‚¹ å…¸å‹åº”ç”¨åœºæ™¯ PolarDB äº‘åŸç”Ÿåˆ†å¸ƒå¼æ•°æ®åº“ MySQL/PostgreSQL å…¼å®¹ æ”¯æŒï¼ˆäº‘ç«¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ è¡Œå­˜ é˜¿é‡Œäº‘äº§å“ï¼Œå¼¹æ€§æ‰©å®¹ï¼Œå­˜å‚¨è®¡ç®—åˆ†ç¦» äº‘ä¸Šä¼ä¸šæ•°æ®åº“è§£å†³æ–¹æ¡ˆ GaussDB åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ MySQL/Oracle å…¼å®¹ æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ è¡Œå­˜ + åˆ—å­˜æ··åˆ åä¸ºæ¨å‡ºï¼Œåˆ†å¸ƒå¼ HTAPï¼Œäº‘åŸç”Ÿæ¶æ„ ä¼ä¸šçº§ OLTP + OLAP æ··åˆè´Ÿè½½ Spanner å…¨çƒåˆ†å¸ƒå¼æ•°æ®åº“ ç±» SQL æ”¯æŒï¼ˆTrueTime åè®®ï¼‰ è¡Œå­˜ Google äº‘äº§å“ï¼Œå…¨çƒåˆ†å¸ƒå¼å¼ºä¸€è‡´äº‹åŠ¡ å…¨çƒåŒ–åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé‡‘èåœºæ™¯ Amazon Aurora äº‘åŸç”Ÿåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ MySQL/PostgreSQL å…¼å®¹ æ”¯æŒï¼ˆå•å®ä¾‹äº‹åŠ¡ï¼Œå¤š AZ é«˜å¯ç”¨ï¼‰ è¡Œå­˜ AWS æ‰˜ç®¡ï¼Œè‡ªåŠ¨æ‰©å±•å­˜å‚¨ï¼Œå¤šå¯ç”¨åŒºé«˜å¯ç”¨ OLTPã€ä¼ä¸šçº§ä¸šåŠ¡","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 è¿è¡Œæ¨¡å¼çš„é…ç½®ä¸ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡åœ¨ SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨ çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚","date_published":"2025-09-10T13:30:05.000Z","tags":["æŠ€æœ¯","springboot","sharding-sphere","springboot","sharding-sphere"]},{"id":"https://blog.hanqunfeng.com/2025/09/08/maven-nexus-upgrade/","url":"https://blog.hanqunfeng.com/2025/09/08/maven-nexus-upgrade/","title":"Maven ç§æœ Nexus å‡çº§å®å½•","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» Mavne ç§æœ Nexus å‡çº§çš„å…¨è¿‡ç¨‹ï¼Œä» <code>3.29.2-02</code> å‡çº§åˆ° <code>3.83.2-01</code></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://help.sonatype.com/en/sonatype-nexus-repository.html\">Nexuså®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://mirrors.tuna.tsinghua.edu.cn/Adoptium/\">OpenJdkä¸‹è½½åœ°å€</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://help.sonatype.com/en/sonatype-nexus-repository-system-requirements.html\">Nexusç³»ç»Ÿé…ç½®è¦æ±‚</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"å‡çº§è¿‡ç¨‹è¯´æ˜\">å‡çº§è¿‡ç¨‹è¯´æ˜</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Nexus ä» <code>3.71.x</code> å¼€å§‹ï¼Œä¸å†æ”¯æŒ <code>OrientDB</code>ï¼Œåç»­ç‰ˆæœ¬ä»…æ”¯æŒ <code>H2</code> å’Œ <code>PostgreSQL</code> ï¼Œæ ¹æ®<a href=\"https://help.sonatype.com/en/upgrading-to-nexus-repository-3-71-0-and-beyond.html\">å®˜ç½‘è¯´æ˜</a>ï¼Œ<code>3.70.x</code> ä»¥ä¸‹çš„ç‰ˆæœ¬éœ€è¦å°† Nexus å…ˆå‡çº§åˆ° <code>3.70.x</code> çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç„¶åä½¿ç”¨å®˜æ–¹æä¾›çš„æ•°æ®åº“è¿ç§»å·¥å…·ï¼Œå°†æ•°æ®åº“è¿ç§»åˆ° <code>H2</code> åï¼Œå†å‡çº§åˆ° <code>3.71.x</code> ä»¥åçš„ç‰ˆæœ¬</p>\n</li>\n</ul>\n<h2 id=\"ä»-3-29-2-02-å‡çº§åˆ°-nexus-3-70-4-02\">ä» <code>3.29.2-02</code> å‡çº§åˆ° <code>nexus-3.70.4-02</code></h2>\n<h3 id=\"å®‰è£…-OpenJDK\">å®‰è£… <code>OpenJDK</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>éœ€è¦å…ˆå®‰è£…å¥½ <code>OpenJDK</code>ï¼ŒåŸå› æ˜¯<code>Nexusçš„æ•°æ®åº“è¿ç§»å·¥å…·</code>ä»…æ”¯æŒ <code>OpenJDK</code>ï¼Œä¸æ”¯æŒ <code>Oracle JDK</code>ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©å®‰è£… <code>OpenJDK11</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local</span><br><span class=\"line\">curl -O https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\">tar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /usr/local/jdk-11.0.28+6/bin/java /usr/bin/java</span><br><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/usr/local/jdk-11.0.28+6</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å®‰è£…-nexus-3-70-x\">å®‰è£… <code>nexus-3.70.x</code></h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç›®å‰å®˜ç½‘å‘å¸ƒçš„<code>nexus-3.70.x</code>çš„æœ€æ–°ç‰ˆæœ¬ä¸º <code>nexus-3.70.4-02</code>ï¼Œ<a href=\"https://help.sonatype.com/en/orientdb-downloads.html\">ä¸‹è½½é¡µé¢</a>ï¼Œå…¶å¯¹åº”çš„æ•°æ®åº“è¿ç§»å·¥å…·ä¹Ÿå¯ä»¥ä»è¯¥é¡µé¢ä¸‹è½½ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹© <a href=\"https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gz\">Java 11 çš„ç‰ˆæœ¬</a>ï¼Œå‡çº§å®‰è£…ä¸ç¬¬ä¸€æ¬¡å®‰è£…æ–¹å¼ä¸€æ ·ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢åˆ° nexus ç”¨æˆ·ï¼ŒåŸ nexus-3.29.2-02 å°±å®‰è£…åœ¨ è¯¥ç”¨æˆ·çš„ `home` ç›®å½•ä¸‹</span></span><br><span class=\"line\">su - nexus</span><br><span class=\"line\"><span class=\"comment\"># å…³é—­ åŸ nexus æœåŠ¡ï¼Œå…³äºå¦‚ä½•å°† Nexus é…ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://help.sonatype.com/en/run-as-a-service.html</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl stop nexus</span><br><span class=\"line\"><span class=\"comment\">#~/nexus3/bin/nexus stop</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éœ€è¦ç§‘å­¦ä¸Šç½‘</span></span><br><span class=\"line\">curl -O https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gz</span><br><span class=\"line\">tar -zxvf nexus-3.70.4-02-java11-unix.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -f ~/nexus3</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /usr/local/nexus-3.70.4-02 ~/nexus3</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ nexus</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start nexus</span><br><span class=\"line\"><span class=\"comment\"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è¿ç§»æ•°æ®åˆ°-H2\">è¿ç§»æ•°æ®åˆ° H2</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸‹è½½æ•°æ®åº“è¿ç§»å·¥å…·</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> ~/backup</span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~/backup</span><br><span class=\"line\"><span class=\"comment\"># ä¸ nexus ç‰ˆæœ¬ä¸€è‡´</span></span><br><span class=\"line\">curl -O https://download.sonatype.com/nexus/nxrm3-migrator/nexus-db-migrator-3.70.4-02.jar</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç™»å½• Nexus å¯¼å‡ºæ•°æ®: è®¾ç½® -&gt; System -&gt; Tasks -&gt; Create task -&gt; Admin - Export databases for backup<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/MS26e5.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»»åŠ¡åˆ›å»ºåç‚¹å‡»<code>Run</code>ï¼Œå³å¯åœ¨ <code>/home/nexus/backup</code> ç›®å½•ä¸‹çœ‹åˆ°å¤‡ä»½æ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ll /home/nexus/backup</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus   121066 Sep  8 07:25 analytics-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus 19349428 Sep  8 07:25 component-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus   266208 Sep  8 07:25 config-2025-09-08-07-25-57-3.70.4-02.bak</span><br><span class=\"line\">-rw-r--r-- 1 nexus nexus 56809625 Sep  8 06:41 nexus-db-migrator-3.70.4-02.jar</span><br><span class=\"line\">-rw-rw-r-- 1 nexus nexus   132802 Sep  8 07:25 security-2025-09-08-07-25-57-3.70.4-02.bak</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨è¿ç§»å·¥å…·ç”ŸæˆH2æ•°æ®åº“æ–‡ä»¶ï¼Œå®˜ç½‘å‚è€ƒèµ„æ–™: <a href=\"https://help.sonatype.com/en/migrating-to-a-new-database.html#migrating-from-orientdb-to-h2\">Migrating From OrientDB to H2</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¼€å§‹è¿ç§»å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl stop nexus</span><br><span class=\"line\"><span class=\"comment\"># ~/nexus3/bin/nexus stop</span></span><br><span class=\"line\"><span class=\"comment\"># è¿›å…¥å¤‡ä»½ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /home/nexus/backup</span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œè¦ä½¿ç”¨ OpenJDK 11 è¿è¡Œï¼Œæ ¹æ®éœ€è¦é€‚å½“è°ƒæ•´å†…å­˜å‚æ•°</span></span><br><span class=\"line\">java -Xmx2G -Xms2G -XX:+UseG1GC -jar nexus-db-migrator-3.70.4-02.jar --migration_type=h2</span><br><span class=\"line\"><span class=\"comment\"># è¿è¡Œåä¼šæç¤ºä½ è¿ç§»æ•°æ®åº“å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡ï¼Œæˆ‘ä»¬è¾“å…¥ y ç»§ç»­</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡ŒæˆåŠŸåä¼šç”Ÿæˆ <code>nexus.mv.db</code>ï¼Œå°†å…¶ç§»åŠ¨åˆ° <code>/home/nexus/sonatype-work/nexus3/db/</code> ç›®å½•ä¸‹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mv</span> nexus.mv.db /home/nexus/sonatype-work/nexus3/db/</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¼–è¾‘<code>/home/nexus/sonatype-work/nexus3/etc/nexus.properties</code> æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># enable db h2</span></span><br><span class=\"line\">nexus.datastore.enabled=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯åŠ¨ nexusï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å®Œæˆäº† ä» <code>3.29.2-02</code> åˆ° <code>nexus-3.70.4-02</code> çš„å‡çº§</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start nexus</span><br><span class=\"line\"><span class=\"comment\"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"ä»-nexus-3-70-4-02-å‡çº§åˆ°-nexus-3-83-2-01\">ä» <code>nexus-3.70.4-02</code> å‡çº§åˆ° <code>nexus-3.83.2-01</code></h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™ä¸ªå‡çº§å°±æ¯”è¾ƒç®€å•äº†ï¼Œå’Œæˆ‘ä»¬æ­¤å‰çš„å‡çº§æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œä¸‹è½½è§£å‹åæ›¿æ¢å®‰è£…ç›®å½•å³å¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œä»<code>nexus-3.71.0+</code>å¼€å§‹ä»…æ”¯æŒ<code>jdk17</code>ï¼Œæ‰€ä»¥éœ€è¦æå‰å®‰è£…å¥½<code>jdk17</code>ï¼Œå¦å¤–ä»<code>nexus-3.78.0</code>å¼€å§‹ï¼ŒNexus å†…ç½®äº†<code>openjdk17</code>ï¼Œæ‰€ä»¥ä¸éœ€è¦å†é¢å¤–å®‰è£…jdkã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>nexus-3.83.2-01</code> æ˜¯ç›®å‰çš„æœ€æ–°ç‰ˆï¼Œ<a href=\"https://help.sonatype.com/en/download.html\">æœ€æ–°ç‰ˆä¸‹è½½é¡µé¢</a>ï¼Œ<a href=\"https://help.sonatype.com/en/download-archives---repository-manager-3.html\">å†å²ç‰ˆæœ¬ä¸‹è½½é¡µé¢åœ°å€</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å…³é—­ Nexus æœåŠ¡</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl stop nexus</span><br><span class=\"line\"><span class=\"comment\"># ~/nexus3/bin/nexus stop</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~</span><br><span class=\"line\">curl -O https://download.sonatype.com/nexus/3/nexus-3.83.2-01-linux-x86_64.tar.gz</span><br><span class=\"line\">tar -zxvf nexus-3.83.2-01-linux-x86_64.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -f nexus3</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s nexus-3.83.2-01 nexus3</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ Nexusï¼Œnexus-3.83.2-01 è‡ªå¸¦ openjdk17ï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬å®‰è£… openjdk</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start nexus</span><br><span class=\"line\"><span class=\"comment\"># ~/nexus3/bin/nexus start</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/rgLwWf.png\" alt=\"\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/mdWh22.png\" alt=\"\" width=\"1400\" height=\"1000\"><br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/56aOWz.png\" alt=\"\"></p>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Mavne ç§æœ Nexus å‡çº§çš„å…¨è¿‡ç¨‹ï¼Œä» 3.29.2-02 å‡çº§åˆ° 3.83.2-01 Nexuså®˜ç½‘ OpenJdkä¸‹è½½åœ°å€ Nexusç³»ç»Ÿé…ç½®è¦æ±‚ å‡çº§è¿‡ç¨‹è¯´æ˜ Nexus ä» 3.71.x å¼€å§‹ï¼Œä¸å†æ”¯æŒ OrientDBï¼Œåç»­ç‰ˆæœ¬ä»…æ”¯æŒ H2 å’Œ PostgreSQL ï¼Œæ ¹æ®å®˜ç½‘è¯´æ˜ï¼Œ3.70.x ä»¥ä¸‹çš„ç‰ˆæœ¬éœ€è¦å°† Nexus å…ˆå‡çº§åˆ° 3.70.x çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç„¶åä½¿ç”¨å®˜æ–¹æä¾›çš„æ•°æ®åº“è¿ç§»å·¥å…·ï¼Œå°†æ•°æ®åº“è¿ç§»åˆ° H2 åï¼Œå†å‡çº§åˆ° 3.71.x ä»¥åçš„ç‰ˆæœ¬ ä» 3.29.2-02 å‡çº§åˆ° nexus-3.70.4-02 å®‰è£… OpenJDK éœ€è¦å…ˆå®‰è£…å¥½ OpenJDKï¼ŒåŸå› æ˜¯Nexusçš„æ•°æ®åº“è¿ç§»å·¥å…·ä»…æ”¯æŒ OpenJDKï¼Œä¸æ”¯æŒ Oracle JDKï¼Œæˆ‘è¿™é‡Œé€‰æ‹©å®‰è£… OpenJDK11 123456cd /usr/localcurl -O https://mirrors.tuna.tsinghua.edu.cn/Adoptium/11/jdk/x64/linux/OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gztar -zxvf OpenJDK11U-jdk_x64_linux_hotspot_11.0.28_6.tar.gzln -s /usr/local/jdk-11.0.28+6/bin/java /usr/bin/javaexport JAVA_HOME=/usr/local/jdk-11.0.28+6export PATH=$JAVA_HOME/bin:$PATH å®‰è£… nexus-3.70.x ç›®å‰å®˜ç½‘å‘å¸ƒçš„nexus-3.70.xçš„æœ€æ–°ç‰ˆæœ¬ä¸º nexus-3.70.4-02ï¼Œä¸‹è½½é¡µé¢ï¼Œå…¶å¯¹åº”çš„æ•°æ®åº“è¿ç§»å·¥å…·ä¹Ÿå¯ä»¥ä»è¯¥é¡µé¢ä¸‹è½½ã€‚ è¿™é‡Œæˆ‘ä»¬é€‰æ‹© Java 11 çš„ç‰ˆæœ¬ï¼Œå‡çº§å®‰è£…ä¸ç¬¬ä¸€æ¬¡å®‰è£…æ–¹å¼ä¸€æ ·ã€‚ 1234567891011121314# åˆ‡æ¢åˆ° nexus ç”¨æˆ·ï¼ŒåŸ nexus-3.29.2-02 å°±å®‰è£…åœ¨ è¯¥ç”¨æˆ·çš„ `home` ç›®å½•ä¸‹su - nexus# å…³é—­ åŸ nexus æœåŠ¡ï¼Œå…³äºå¦‚ä½•å°† Nexus é…ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://help.sonatype.com/en/run-as-a-service.htmlsudo systemctl stop nexus#~/nexus3/bin/nexus stop# éœ€è¦ç§‘å­¦ä¸Šç½‘curl -O https://download.sonatype.com/nexus/3/nexus-3.70.4-02-java11-unix.tar.gztar -zxvf nexus-3.70.4-02-java11-unix.tar.gzrm -f ~/nexus3ln -s /usr/local/nexus-3.70.4-02 ~/nexus3# å¯åŠ¨ nexussudo systemctl start nexus# ~/nexus3/bin/nexus start è¿ç§»æ•°æ®åˆ° H2 ä¸‹è½½æ•°æ®åº“è¿ç§»å·¥å…· 1234mkdir ~/backupcd ~/backup# ä¸ nexus ç‰ˆæœ¬ä¸€è‡´curl -O https://download.sonatype.com/nexus/nxrm3-migrator/nexus-db-migrator-3.70.4-02.jar ç™»å½• Nexus å¯¼å‡ºæ•°æ®: è®¾ç½® -&gt; System -&gt; Tasks -&gt; Create task -&gt; Admin - Export databases for backup ä»»åŠ¡åˆ›å»ºåç‚¹å‡»Runï¼Œå³å¯åœ¨ /home/nexus/backup ç›®å½•ä¸‹çœ‹åˆ°å¤‡ä»½æ–‡ä»¶ 123456ll /home/nexus/backup-rw-rw-r-- 1 nexus nexus 121066 Sep 8 07:25 analytics-2025-09-08-07-25-57-3.70.4-02.bak-rw-rw-r-- 1 nexus nexus 19349428 Sep 8 07:25 component-2025-09-08-07-25-57-3.70.4-02.bak-rw-rw-r-- 1 nexus nexus 266208 Sep 8 07:25 config-2025-09-08-07-25-57-3.70.4-02.bak-rw-r--r-- 1 nexus nexus 56809625 Sep 8 06:41 nexus-db-migrator-3.70.4-02.jar-rw-rw-r-- 1 nexus nexus 132802 Sep 8 07:25 security-2025-09-08-07-25-57-3.70.4-02.bak ä½¿ç”¨è¿ç§»å·¥å…·ç”ŸæˆH2æ•°æ®åº“æ–‡ä»¶ï¼Œå®˜ç½‘å‚è€ƒèµ„æ–™: Migrating From OrientDB to H2 12345678# å¼€å§‹è¿ç§»å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡sudo systemctl stop nexus# ~/nexus3/bin/nexus stop# è¿›å…¥å¤‡ä»½ç›®å½•cd /home/nexus/backup# è¿™é‡Œè¦ä½¿ç”¨ OpenJDK 11 è¿è¡Œï¼Œæ ¹æ®éœ€è¦é€‚å½“è°ƒæ•´å†…å­˜å‚æ•°java -Xmx2G -Xms2G -XX:+UseG1GC -jar nexus-db-migrator-3.70.4-02.jar --migration_type=h2# è¿è¡Œåä¼šæç¤ºä½ è¿ç§»æ•°æ®åº“å‰éœ€è¦å…ˆå…³é—­ nexus æœåŠ¡ï¼Œæˆ‘ä»¬è¾“å…¥ y ç»§ç»­ è¿è¡ŒæˆåŠŸåä¼šç”Ÿæˆ nexus.mv.dbï¼Œå°†å…¶ç§»åŠ¨åˆ° /home/nexus/sonatype-work/nexus3/db/ ç›®å½•ä¸‹ 1mv nexus.mv.db /home/nexus/sonatype-work/nexus3/db/ ç¼–è¾‘/home/nexus/sonatype-work/nexus3/etc/nexus.properties æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ 12# enable db h2nexus.datastore.enabled=true å¯åŠ¨ nexusï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å®Œæˆäº† ä» 3.29.2-02 åˆ° nexus-3.70.4-02 çš„å‡çº§ 12sudo systemctl start nexus# ~/nexus3/bin/nexus start ä» nexus-3.70.4-02 å‡çº§åˆ° nexus-3.83.2-01 è¿™ä¸ªå‡çº§å°±æ¯”è¾ƒç®€å•äº†ï¼Œå’Œæˆ‘ä»¬æ­¤å‰çš„å‡çº§æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œä¸‹è½½è§£å‹åæ›¿æ¢å®‰è£…ç›®å½•å³å¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œä»nexus-3.71.0+å¼€å§‹ä»…æ”¯æŒjdk17ï¼Œæ‰€ä»¥éœ€è¦æå‰å®‰è£…å¥½jdk17ï¼Œå¦å¤–ä»nexus-3.78.0å¼€å§‹ï¼ŒNexus å†…ç½®äº†openjdk17ï¼Œæ‰€ä»¥ä¸éœ€è¦å†é¢å¤–å®‰è£…jdkã€‚ nexus-3.83.2-01 æ˜¯ç›®å‰çš„æœ€æ–°ç‰ˆï¼Œæœ€æ–°ç‰ˆä¸‹è½½é¡µé¢ï¼Œå†å²ç‰ˆæœ¬ä¸‹è½½é¡µé¢åœ°å€ 1234567891011# å…³é—­ Nexus æœåŠ¡sudo systemctl stop nexus# ~/nexus3/bin/nexus stopcd ~curl -O https://download.sonatype.com/nexus/3/nexus-3.83.2-01-linux-x86_64.tar.gztar -zxvf nexus-3.83.2-01-linux-x86_64.tar.gzrm -f nexus3ln -s nexus-3.83.2-01 nexus3# å¯åŠ¨ Nexusï¼Œnexus-3.83.2-01 è‡ªå¸¦ openjdk17ï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬å®‰è£… openjdksudo systemctl start nexus# ~/nexus3/bin/nexus start","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» Mavne ç§æœ Nexus å‡çº§çš„å…¨è¿‡ç¨‹ï¼Œä» 3.29.2-02 å‡çº§åˆ° 3.83.2-01 Nexuså®˜ç½‘ OpenJdkä¸‹è½½åœ°å€ Nexusç³»ç»Ÿé…ç½®è¦æ±‚","date_published":"2025-09-08T13:30:05.000Z","tags":["æŠ€æœ¯","maven","nexus","mavne","nexus"]},{"id":"https://blog.hanqunfeng.com/2025/09/04/springboot3-shardingsphere-proxy/","url":"https://blog.hanqunfeng.com/2025/09/04/springboot3-shardingsphere-proxy/","title":"SpringBoot3 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/index_zh.html\">ShardingSphereå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy\">æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡å°† <a href=\"/2025/09/01/springboot3-shardingsphere/\" title=\"SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨\">SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨</a> ä¿®æ”¹ä¸º <code>ShardingSphere-Proxy</code> çš„æ¨¡å¼</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ShardingSphere-Proxy-ç®€ä»‹\">ShardingSphere-Proxy ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy å®šä½ä¸ºé€æ˜åŒ–çš„æ•°æ®åº“ä»£ç†ç«¯ï¼Œé€šè¿‡å®ç°æ•°æ®åº“äºŒè¿›åˆ¶åè®®ï¼Œå¯¹å¼‚æ„è¯­è¨€æä¾›æ”¯æŒã€‚ ç›®å‰æä¾› MySQL å’Œ PostgreSQL åè®®ï¼Œé€æ˜åŒ–æ•°æ®åº“æ“ä½œï¼Œå¯¹ DBA æ›´åŠ å‹å¥½ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å‘åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ï¼Œå¯ç›´æ¥å½“åš MySQL/PostgreSQL ä½¿ç”¨ï¼›</li>\n<li class=\"lvl-4\">å…¼å®¹ MariaDB ç­‰åŸºäº MySQL åè®®çš„æ•°æ®åº“ï¼Œä»¥åŠ openGauss ç­‰åŸºäº PostgreSQL åè®®çš„æ•°æ®åº“ï¼›</li>\n<li class=\"lvl-4\">é€‚ç”¨äºä»»ä½•å…¼å®¹ MySQL/PostgreSQL åè®®çš„çš„å®¢æˆ·ç«¯ï¼Œå¦‚ï¼šMySQL Command Client, MySQL Workbench, Navicat ç­‰ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/AMn2pu.png\" alt=\"\"></p>\n</li>\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy ä¸ ShardingSphere-JDBC çš„ç‰¹æ€§æ¯”è¾ƒ</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>ShardingSphere-JDBC</th>\n<th>ShardingSphere-Proxy</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>æ•°æ®åº“æ”¯æŒ</strong></td>\n<td>ä»»æ„æ•°æ®åº“</td>\n<td>MySQL / PostgreSQL</td>\n</tr>\n<tr>\n<td><strong>è¿æ¥æ¶ˆè€—æ•°</strong></td>\n<td>é«˜</td>\n<td>ä½</td>\n</tr>\n<tr>\n<td><strong>å¼‚æ„è¯­è¨€æ”¯æŒ</strong></td>\n<td>ä»…æ”¯æŒ Java</td>\n<td>æ”¯æŒä»»æ„è¯­è¨€</td>\n</tr>\n<tr>\n<td><strong>æ€§èƒ½</strong></td>\n<td>æŸè€—ä½</td>\n<td>æŸè€—ç•¥é«˜</td>\n</tr>\n<tr>\n<td><strong>æ— ä¸­å¿ƒåŒ–</strong></td>\n<td>æ˜¯</td>\n<td>å¦</td>\n</tr>\n<tr>\n<td><strong>é™æ€å…¥å£</strong></td>\n<td>æ— </td>\n<td>æœ‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"éƒ¨ç½²-ShardingSphere-Proxy\">éƒ¨ç½² ShardingSphere-Proxy</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿è¡Œ ShardingSphere-Proxy è¦æ±‚ JDK 1.8+</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸‹è½½ <a href=\"https://shardingsphere.apache.org/document/current/cn/downloads/\">ShardingSphere-Proxy5.5.2</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://www.apache.org/dyn/closer.lua/shardingsphere/5.5.2/apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxvf apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/</span><br></pre></td></tr></table></figure>\n<h2 id=\"é…ç½®-ShardingSphere-Proxy\">é…ç½® ShardingSphere-Proxy</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>conf/global.yaml</code>: å…¨å±€é…ç½®ï¼Œæ‰€è°“å…¨å±€ï¼Œå°±æ˜¯å¯¹æ‰€æœ‰é€»è¾‘åº“éƒ½ç”Ÿæ•ˆçš„é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/authority/</span></span><br><span class=\"line\"><span class=\"attr\">authority:</span></span><br><span class=\"line\"> <span class=\"attr\">users:</span></span><br><span class=\"line\">   <span class=\"bullet\">-</span> <span class=\"attr\">user:</span> <span class=\"string\">root@127.0.0.1</span> <span class=\"comment\"># æ ¼å¼ï¼šç”¨æˆ·å@IP</span></span><br><span class=\"line\">     <span class=\"attr\">password:</span> <span class=\"string\">root</span></span><br><span class=\"line\">     <span class=\"attr\">admin:</span> <span class=\"literal\">true</span>          <span class=\"comment\"># æ˜¯å¦æ˜¯ç®¡ç†å‘˜</span></span><br><span class=\"line\">   <span class=\"bullet\">-</span> <span class=\"attr\">user:</span> <span class=\"string\">sharding@%</span>     <span class=\"comment\"># æ‰€æœ‰IPéƒ½å¯ä»¥è®¿é—®</span></span><br><span class=\"line\">     <span class=\"attr\">password:</span> <span class=\"string\">sharding</span></span><br><span class=\"line\"> <span class=\"attr\">privilege:</span></span><br><span class=\"line\">   <span class=\"attr\">type:</span> <span class=\"string\">DATABASE_PERMITTED</span> <span class=\"comment\"># æƒé™ç±»å‹</span></span><br><span class=\"line\">   <span class=\"attr\">props:</span></span><br><span class=\"line\">      <span class=\"attr\">user-database-mappings:</span> <span class=\"string\">root@127.0.0.1=*,sharding@%=sharding_db</span> <span class=\"comment\"># ç”¨æˆ·æƒé™æ˜ å°„ï¼Œ*è¡¨ç¤ºæ‰€æœ‰æ•°æ®åº“</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¼€å¯XAäº‹åŠ¡ï¼Œå¦‚æœæ˜¯ springbooté¡¹ç›®ï¼Œåªéœ€è¦åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Š @Transactional æ³¨è§£å³å¯å¼€å¯äº‹åŠ¡(ä» MySQL 5.7 å¼€å§‹å°±å…¨é¢æ”¯æŒ XA åˆ†å¸ƒå¼äº‹åŠ¡)</span></span><br><span class=\"line\"><span class=\"comment\"># https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/</span></span><br><span class=\"line\"><span class=\"attr\">transaction:</span>  <span class=\"comment\"># é…ç½®äº‹åŠ¡</span></span><br><span class=\"line\">  <span class=\"attr\">defaultType:</span> <span class=\"string\">XA</span>        <span class=\"comment\"># äº‹åŠ¡ç±»å‹ï¼Œé»˜è®¤ LOCAL</span></span><br><span class=\"line\">  <span class=\"attr\">providerType:</span> <span class=\"string\">Atomikos</span> <span class=\"comment\"># äº‹åŠ¡ç®¡ç†å™¨å…·ä½“å®ç°ï¼Œé»˜è®¤å°±æ˜¯ Atomikos</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/props/</span></span><br><span class=\"line\"><span class=\"attr\">props:</span></span><br><span class=\"line\">  <span class=\"attr\">sql-show:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class=\"line\">  <span class=\"attr\">check-table-metadata-enabled:</span> <span class=\"literal\">false</span> <span class=\"comment\"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>conf/database-my.yaml</code>: è‡ªå®šä¹‰åˆ†é…è§„åˆ™é…ç½®</p>\n</li>\n</ul>\n<blockquote>\n<p>æ³¨æ„:<br>\n1.åç§°å¿…é¡»ä»¥ <code>database-</code>å¼€å¤´ï¼Œå®é™…ä¸Š<code>conf</code>ç›®å½•ä¸‹æœ‰å¾ˆå¤šç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®<br>\n2.<code>global.yaml</code>ä¸­çš„é…ç½®é¡¹ä¸èƒ½é…ç½®åˆ° <code>database-my.yaml</code>ä¸­</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_db</span></span><br><span class=\"line\"><span class=\"attr\">databaseName:</span> <span class=\"string\">sharding_db</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/</span></span><br><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_0:</span> <span class=\"comment\"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># dataSourceClassName: com.zaxxer.hikari.HikariDataSource # ä¸è¦æŒ‡å®š</span></span><br><span class=\"line\">    <span class=\"comment\"># driverClassName: com.mysql.cj.jdbc.Driver               # ä¸è¦æŒ‡å®š</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span>  <span class=\"comment\"># æ³¨æ„è¿™é‡Œå±æ€§ä¸º url</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">ds_1:</span></span><br><span class=\"line\">    <span class=\"comment\"># dataSourceClassName: com.zaxxer.hikari.HikariDataSource</span></span><br><span class=\"line\">    <span class=\"comment\"># driverClassName: com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»¥ä¸‹è§„åˆ™ä¸å‰æ–‡ä¸­çš„ shardingsphere-jdbc ä¸­çš„ rules ç›¸åŒ</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"comment\"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">bindingTables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">t_order,t_order_item</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">course:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">cid</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_inline</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">cid</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order-complex-algorithm</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_item-class-based-algorithm_spi</span> <span class=\"comment\"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class=\"line\">          <span class=\"comment\">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">custom_snowflake_string</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#       t_address:      # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜</span></span><br><span class=\"line\">    <span class=\"comment\">#         actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">autoTables:</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/</span></span><br><span class=\"line\">      <span class=\"attr\">course_inline:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># å±æ€§</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">course_$&#123;cid</span> <span class=\"string\">%</span> <span class=\"number\">2</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class=\"line\">          <span class=\"attr\">allow-range-query-with-inline-sharding:</span> <span class=\"literal\">true</span> <span class=\"comment\"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class=\"line\">      <span class=\"attr\">course_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class=\"line\">      <span class=\"attr\">mod_2:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MOD</span> <span class=\"comment\"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">sharding-count:</span> <span class=\"number\">2</span> <span class=\"comment\"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order-complex-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">COMPLEX_INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_order_complex_$&#123;(user_id</span> <span class=\"string\">+</span> <span class=\"string\">order_id</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">)</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm_spi:</span> <span class=\"comment\"># SPI</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">T_ORDER_ITEM_COMPLEX</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br><span class=\"line\">      <span class=\"attr\">uuid:</span> <span class=\"comment\"># å®šä¹‰åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">UUID</span> <span class=\"comment\"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class=\"line\">      <span class=\"attr\">custom_snowflake_string:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CUSTOM_SNOWFLAKE_STRING</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">workerId:</span> <span class=\"number\">2</span></span><br><span class=\"line\">          <span class=\"attr\">datacenterId:</span> <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!BROADCAST</span>  <span class=\"comment\"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">dict</span>    <span class=\"comment\"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!ENCRYPT</span>    <span class=\"comment\"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span> <span class=\"comment\"># åŠ å¯†è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># åŠ å¯†åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">cipher:</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">password</span> <span class=\"comment\"># å¯†æ–‡åˆ—åç§°</span></span><br><span class=\"line\">              <span class=\"attr\">encryptorName:</span> <span class=\"string\">aes_encryptor</span> <span class=\"comment\"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class=\"line\">    <span class=\"attr\">encryptors:</span></span><br><span class=\"line\">      <span class=\"attr\">aes_encryptor:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">AES</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">aes-key-value:</span> <span class=\"string\">123456abc</span>     <span class=\"comment\"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class=\"line\">          <span class=\"attr\">digest-algorithm-name:</span> <span class=\"string\">SHA-1</span> <span class=\"comment\"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">md5_encryptor:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">salt:</span> <span class=\"number\">123456</span>  <span class=\"comment\"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!MASK</span>  <span class=\"comment\"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span> <span class=\"comment\"># è„±æ•è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span> <span class=\"comment\"># è„±æ•åˆ—é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># è„±æ•åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">md5_mask</span> <span class=\"comment\"># è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">email:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">mask_before_special_chars_mask</span></span><br><span class=\"line\">          <span class=\"attr\">telephone:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">keep_first_n_last_m_mask</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">my_mask</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">maskAlgorithms:</span> <span class=\"comment\"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">md5_mask:</span> <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span>  <span class=\"comment\"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class=\"line\">      <span class=\"attr\">mask_before_special_chars_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MASK_BEFORE_SPECIAL_CHARS</span> <span class=\"comment\"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">special-chars:</span> <span class=\"string\">&#x27;@&#x27;</span>  <span class=\"comment\"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span>   <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">keep_first_n_last_m_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">KEEP_FIRST_N_LAST_M</span> <span class=\"comment\"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">first-n:</span> <span class=\"number\">3</span>     <span class=\"comment\"># ä¿ç•™å‰ 3 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">last-m:</span> <span class=\"number\">4</span>      <span class=\"comment\"># ä¿ç•™å 4 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">my_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MY_CUSTOM_MASK</span>  <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&quot;#&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SINGLE</span> <span class=\"comment\"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"comment\"># MySQL é£æ ¼</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ds_0.t_address</span> <span class=\"comment\"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br><span class=\"line\"><span class=\"comment\">#       - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨</span></span><br><span class=\"line\"><span class=\"comment\">#       - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çš„<code>rules</code>ä¸­ä½¿ç”¨çš„æ˜¯<code>mysql</code>æ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥<code>mysql</code>æ•°æ®åº“çš„ä¾èµ–</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> ext-lib</span><br><span class=\"line\"><span class=\"built_in\">cd</span> ext-lib</span><br><span class=\"line\">wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åŒæ—¶<code>rules</code>ä¸­åŒ…å«ä¸€äº›è‡ªå®šä¹‰çš„ç®—æ³•ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†è¿™äº›ç®—æ³•ä½œä¸ºä¾èµ–è¿›è¡Œå¼•å…¥ï¼Œå°†è¿™äº›ç®—æ³•ç±»æ‰“æˆ<code>jar</code>ï¼Œç„¶åä¹Ÿæ‹·è´åˆ°<code>ext-lib</code>ç›®å½•ä¸‹ï¼Œæˆ‘å·²ç»å°†å…¶å‘å¸ƒåˆ°äº†githubä¸Šï¼Œå®é™…ä¸Šå’Œå‰æ–‡ä¸­çš„ <code>shardingsphere-jdbc</code> é¡¹ç›®ä¸­å°†ç®—æ³•é…ç½®ä¸º <code>spi</code> çš„æ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. åªå…‹éš†ä»“åº“çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¸ä¸‹è½½æ‰€æœ‰æ–‡ä»¶</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> --filter=blob:none --sparse https://github.com/hanqunfeng/springbootchapter.git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. è¿›å…¥ä»“åº“ç›®å½•</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> springbootchapter</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. è®¾ç½®åªæ£€å‡ºä½ éœ€è¦çš„ç›®å½•</span></span><br><span class=\"line\">git sparse-checkout <span class=\"built_in\">set</span> springboot3-demo/shardingsphere-demo/algorithm-swapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. ç¼–è¯‘æ‰“åŒ…</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> springboot3-demo/shardingsphere-demo/algorithm-swapper</span><br><span class=\"line\">mvn clean package -DskipTests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. å°†æ‰“å¥½çš„åŒ…å¤åˆ¶åˆ° shardingsphere-proxy çš„ ext-lib ç›®å½•ä¸‹</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> target/algorithm-swapper-1.0.0.jar <span class=\"variable\">$shardingsphere</span>-proxy$/ext-lib</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¯åŠ¨ä¸å…³é—­-ShardingSphere-Proxy\">å¯åŠ¨ä¸å…³é—­ ShardingSphere Proxy</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere Proxy è¦æ±‚ JDK 1.8 æˆ–ä»¥ä¸Šç‰ˆæœ¬</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$shardingsphere</span>-proxy$/bin</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨</span></span><br><span class=\"line\">./start.sh</span><br><span class=\"line\"><span class=\"comment\"># å…³é—­</span></span><br><span class=\"line\">./stop.sh</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‚æ•°è¯´æ˜</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>è¯´æ˜</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-a</code></td>\n<td>ç»‘å®šåœ°å€ï¼Œå¯ä»¥æ˜¯ IPv4ã€IPv6 æˆ–ä¸»æœºåï¼Œå¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”ã€‚</td>\n<td><code>0.0.0.0</code></td>\n</tr>\n<tr>\n<td><code>-p</code></td>\n<td>ç»‘å®šç«¯å£å·ï¼Œå¯ä»¥åœ¨ <code>global.yaml</code> ä¸­ä¿®æ”¹ã€‚<code>-p</code> ä¼˜å…ˆçº§æ›´é«˜</td>\n<td><code>3307</code></td>\n</tr>\n<tr>\n<td><code>-c</code></td>\n<td>ShardingSphere-Proxy é…ç½®ç›®å½•è·¯å¾„ã€‚</td>\n<td><code>conf</code></td>\n</tr>\n<tr>\n<td><code>-f</code></td>\n<td>å¼ºåˆ¶å¯åŠ¨ ShardingSphere-Proxyã€‚</td>\n<td>æ— </td>\n</tr>\n<tr>\n<td><code>-g</code></td>\n<td>å¦‚æœåœ¨ <code>agent</code> ç›®å½•ä¸‹éƒ¨ç½²äº† <code>shardingsphere-agent</code>ï¼Œå¯ç”¨ agent åŠŸèƒ½ã€‚</td>\n<td>æ— </td>\n</tr>\n<tr>\n<td><code>-s</code></td>\n<td>æŒ‡å®šç”¨äºè¿æ¥çš„ socket æ–‡ä»¶è·¯å¾„ã€‚</td>\n<td>æ— </td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere-Proxy å¯åŠ¨å‘½ä»¤é€ŸæŸ¥è¡¨</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>å‘½ä»¤ç¤ºä¾‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>é»˜è®¤å¯åŠ¨</strong></td>\n<td><code>./start.sh</code></td>\n<td>é»˜è®¤ç«¯å£ <code>3307</code>ï¼Œé…ç½®ç›®å½• <code>conf</code></td>\n</tr>\n<tr>\n<td><strong>æŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½•</strong></td>\n<td><code>./start.sh 3308 /opt/shardingsphere-proxy/conf</code></td>\n<td>ç®€å†™æ¨¡å¼ï¼ŒæŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½•</td>\n</tr>\n<tr>\n<td><strong>å‚æ•°å½¢å¼å¯åŠ¨</strong></td>\n<td><code>./start.sh -p 3308 -c /opt/shardingsphere-proxy/conf</code></td>\n<td>ä¸ä¸Šé¢ç­‰æ•ˆï¼Œä½†æ›´æ˜ç¡®</td>\n</tr>\n<tr>\n<td><strong>æŒ‡å®šç›‘å¬åœ°å€</strong></td>\n<td><code>./start.sh -a 192.168.1.100 -p 3307 -c conf</code></td>\n<td>æŒ‡å®šå•ä¸ª IP åœ°å€</td>\n</tr>\n<tr>\n<td><strong>æŒ‡å®šå¤šä¸ªç›‘å¬åœ°å€</strong></td>\n<td><code>./start.sh -a 192.168.1.100,127.0.0.1 -p 3307 -c conf</code></td>\n<td>å¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”</td>\n</tr>\n<tr>\n<td><strong>å¼ºåˆ¶å¯åŠ¨</strong></td>\n<td><code>./start.sh -p 3307 -c conf -f</code></td>\n<td>é‡åˆ°æ®‹ç•™ PID æ–‡ä»¶æ—¶ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><strong>å¯ç”¨ agent</strong></td>\n<td><code>./start.sh -p 3307 -c conf -g</code></td>\n<td>å¯åŠ¨ ShardingSphere-Agent</td>\n</tr>\n<tr>\n<td><strong>ä½¿ç”¨ Unix Socket</strong></td>\n<td><code>./start.sh -p 3307 -c conf -s /tmp/sharding-proxy.sock</code></td>\n<td>é€šè¿‡ Socket æ–‡ä»¶è¿›è¡Œè¿æ¥</td>\n</tr>\n<tr>\n<td><strong>å¤šé€‰é¡¹ç»„åˆ</strong></td>\n<td><code>./start.sh -a 127.0.0.1 -p 3310 -c /opt/proxy/conf -f -g -s /tmp/proxy.sock</code></td>\n<td>ä¸€æ¬¡æ€§æŒ‡å®šå¤šä¸ªé€‰é¡¹</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"é¡¹ç›®è¿æ¥-ShardingSphere-Proxy-æ—¶ï¼Œå°±åƒè¿æ¥æ™®é€šçš„-mysql-æœåŠ¡ä¸€æ ·\">é¡¹ç›®è¿æ¥ ShardingSphere-Proxy æ—¶ï¼Œå°±åƒè¿æ¥æ™®é€šçš„ mysql æœåŠ¡ä¸€æ ·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ç¤ºä¾‹é¡¹ç›®ï¼š<a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy\">https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy</a></p>\n</li>\n</ul>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åœ¨ <code>ShardingSphere-JDBC</code> å’Œ <code>ShardingSphere-Proxy</code> ä¸­ï¼Œå­˜åœ¨éƒ¨åˆ† MySQL(å…¶å®ƒæ•°æ®åº“ä¹Ÿç±»ä¼¼) çš„ SQL è¯­æ³•æˆ–åŠŸèƒ½ç›®å‰è¿˜ä¸å®Œå…¨æ”¯æŒçš„æƒ…å†µã€‚<code>ShardingSphere</code> åœ¨åš SQL è·¯ç”±ã€æ”¹å†™ã€æ‰§è¡Œæ—¶ï¼Œå¿…é¡»èƒ½è§£æ SQL å¹¶ç†è§£å…¶è¯­ä¹‰ï¼Œä½†å¹¶ä¸æ˜¯ MySQL çš„ 100% å®Œå…¨ä»£ç†ã€‚å› æ­¤ï¼Œæœ‰äº›å¤æ‚æˆ–ç‰¹å®šåœºæ™¯ä¸‹çš„ SQL å¯èƒ½æ— æ³•è¢«æ­£ç¡®è§£ææˆ–æ‰§è¡Œã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ”¯æŒè‰¯å¥½çš„ SQL è¯­æ³•</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">åŸºç¡€ DML<br>\nSELECTã€INSERTã€UPDATEã€DELETE<br>\nåŸºæœ¬çš„æ¡ä»¶æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µã€åˆ†ç»„ã€èšåˆå‡½æ•°ï¼ˆå¦‚ COUNTã€SUMã€AVGï¼‰</li>\n<li class=\"lvl-4\">DCL<br>\nåŸºæœ¬çš„äº‹åŠ¡è¯­å¥ï¼šBEGINã€COMMITã€ROLLBACK</li>\n<li class=\"lvl-4\">DDL<br>\néƒ¨åˆ†è¡¨ç»“æ„ç®¡ç†è¯­å¥ï¼šCREATE TABLEã€ALTER TABLEã€DROP TABLE</li>\n<li class=\"lvl-4\">å‡½æ•°æ”¯æŒ<br>\nå¤§éƒ¨åˆ†å¸¸ç”¨çš„ MySQL å†…ç½®å‡½æ•°ï¼Œå¦‚å­—ç¬¦ä¸²ã€æ•°å­¦ã€æ—¥æœŸå‡½æ•°</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"åœ¨-ShardingSphere-MySQL-ä¸‹å»ºè®®é¿å…æˆ–è°¨æ…ä½¿ç”¨çš„-SQL-æ¸…å•\">åœ¨ ShardingSphere + MySQL ä¸‹å»ºè®®é¿å…æˆ–è°¨æ…ä½¿ç”¨çš„ SQL æ¸…å•</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol>\n<li class=\"lvl-5\">è·¨åˆ†ç‰‡å¤æ‚æŸ¥è¯¢</li>\n</ol>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>SQL åœºæ™¯</th>\n<th>åŸå› </th>\n<th>å»ºè®®å¤„ç†æ–¹å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å¤šè¡¨å¤æ‚ JOINï¼ˆç‰¹åˆ«æ˜¯è·¨åˆ†ç‰‡ï¼‰</td>\n<td>éœ€è¦è·¨åº“æ•°æ®èšåˆï¼Œæ€§èƒ½å·®ï¼Œå¯èƒ½æŠ¥é”™</td>\n<td>ä½¿ç”¨å¹¿æ’­è¡¨/ç»‘å®šè¡¨ï¼Œæˆ–åœ¨åº”ç”¨å±‚å®Œæˆ</td>\n</tr>\n<tr>\n<td>è·¨åˆ†ç‰‡å­æŸ¥è¯¢</td>\n<td>SQL è·¯ç”±å›°éš¾ï¼Œå¯èƒ½ä¸æ”¯æŒ</td>\n<td>å°½é‡æ”¹æˆå•è¡¨æŸ¥è¯¢æˆ–åˆ†æ­¥æŸ¥è¯¢</td>\n</tr>\n<tr>\n<td>è·¨åˆ†ç‰‡çš„ GROUP BY / ORDER BY</td>\n<td>åœ¨ Proxy å±‚èšåˆï¼Œæ€§èƒ½å¾ˆå·®</td>\n<td>å°½é‡é¿å…ï¼Œæˆ–æ§åˆ¶æ•°æ®é‡</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"2\">\n<li class=\"lvl-5\">DDL ç›¸å…³</li>\n</ol>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>SQL åœºæ™¯</th>\n<th>åŸå› </th>\n<th>å»ºè®®å¤„ç†æ–¹å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>ALTER TABLE</code> å¤æ‚å˜æ›´</td>\n<td>éœ€åœ¨æ‰€æœ‰åˆ†ç‰‡æ‰§è¡Œï¼Œå¯èƒ½æ‰§è¡Œå¤±è´¥</td>\n<td>æ‰‹åŠ¨åœ¨æ¯ä¸ªåˆ†ç‰‡åº“æ‰§è¡Œ</td>\n</tr>\n<tr>\n<td><code>CREATE TRIGGER</code>ã€<code>PROCEDURE</code></td>\n<td>Proxy ä¸è§£æè¿™äº›è¯­æ³•ï¼Œç›´æ¥é€ä¼ ä¸å®‰å…¨</td>\n<td>å°½é‡åœ¨å•åº“æ‰‹åŠ¨åˆ›å»º</td>\n</tr>\n<tr>\n<td><code>CREATE FUNCTION</code></td>\n<td>åŒä¸Š</td>\n<td>å•åº“æ‰§è¡Œæˆ–åº”ç”¨å±‚æ›¿ä»£</td>\n</tr>\n<tr>\n<td><code>FULLTEXT INDEX</code>ã€<code>SPATIAL INDEX</code></td>\n<td>åˆ†ç‰‡ç¯å¢ƒä¸‹æ— æ³•è‡ªåŠ¨ç»´æŠ¤ç´¢å¼•</td>\n<td>å•åº“æ‰‹åŠ¨ç»´æŠ¤æˆ–é¿å…ä½¿ç”¨</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"3\">\n<li class=\"lvl-5\">æ–‡ä»¶å¯¼å…¥å¯¼å‡º</li>\n</ol>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>SQL åœºæ™¯</th>\n<th>åŸå› </th>\n<th>å»ºè®®å¤„ç†æ–¹å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>LOAD DATA INFILE</code></td>\n<td>Proxy ä¸æ”¯æŒæ–‡ä»¶ç³»ç»Ÿç›´æ¥è®¿é—®</td>\n<td>åœ¨åˆ†ç‰‡åº“æ‰‹åŠ¨æ‰§è¡Œæˆ–é€šè¿‡åº”ç”¨å¯¼å…¥</td>\n</tr>\n<tr>\n<td><code>SELECT ... INTO OUTFILE</code></td>\n<td>åŒä¸Š</td>\n<td>åº”ç”¨å±‚å¤„ç†å¯¼å‡º</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<ol start=\"4\">\n<li class=\"lvl-5\">MySQL ç‰¹æœ‰åŠŸèƒ½</li>\n</ol>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŠŸèƒ½</th>\n<th>æ”¯æŒæƒ…å†µ</th>\n<th>å»ºè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>MySQL 8.0 å…¬å…±è¡¨è¡¨è¾¾å¼ï¼ˆCTEï¼‰</td>\n<td>éƒ¨åˆ†æ”¯æŒ</td>\n<td>é¿å…è·¨åˆ†ç‰‡ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>çª—å£å‡½æ•°ï¼ˆ<code>OVER() PARTITION BY</code>ï¼‰</td>\n<td>éƒ¨åˆ†æ”¯æŒ</td>\n<td>é¿å…è·¨åˆ†ç‰‡å¤§æ•°æ®é‡ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>JSON å‡½æ•°</td>\n<td>åŸºæœ¬æ”¯æŒ</td>\n<td>å•è¡¨åœºæ™¯å¯ç”¨ï¼Œè·¨åˆ†ç‰‡éœ€è°¨æ…</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ†å¸ƒå¼äº‹åŠ¡</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åœºæ™¯</th>\n<th>é—®é¢˜åŸå› </th>\n<th>å»ºè®®å¤„ç†æ–¹å¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>è·¨åˆ†ç‰‡åŸç”Ÿäº‹åŠ¡</td>\n<td>MySQL åŸç”Ÿäº‹åŠ¡ä¸æ”¯æŒè·¨åº“</td>\n<td>ä½¿ç”¨ ShardingSphere XA / BASE</td>\n</tr>\n<tr>\n<td>å¤§äº‹åŠ¡ + åˆ†å¸ƒå¼äº‹åŠ¡</td>\n<td>æ€§èƒ½å¼€é”€å¤§</td>\n<td>å°½é‡æ§åˆ¶äº‹åŠ¡èŒƒå›´</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€ æœ¬æ–‡å°† SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨ ä¿®æ”¹ä¸º ShardingSphere-Proxy çš„æ¨¡å¼ ShardingSphere-Proxy ç®€ä»‹ ShardingSphere-Proxy å®šä½ä¸ºé€æ˜åŒ–çš„æ•°æ®åº“ä»£ç†ç«¯ï¼Œé€šè¿‡å®ç°æ•°æ®åº“äºŒè¿›åˆ¶åè®®ï¼Œå¯¹å¼‚æ„è¯­è¨€æä¾›æ”¯æŒã€‚ ç›®å‰æä¾› MySQL å’Œ PostgreSQL åè®®ï¼Œé€æ˜åŒ–æ•°æ®åº“æ“ä½œï¼Œå¯¹ DBA æ›´åŠ å‹å¥½ã€‚ å‘åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ï¼Œå¯ç›´æ¥å½“åš MySQL/PostgreSQL ä½¿ç”¨ï¼› å…¼å®¹ MariaDB ç­‰åŸºäº MySQL åè®®çš„æ•°æ®åº“ï¼Œä»¥åŠ openGauss ç­‰åŸºäº PostgreSQL åè®®çš„æ•°æ®åº“ï¼› é€‚ç”¨äºä»»ä½•å…¼å®¹ MySQL/PostgreSQL åè®®çš„çš„å®¢æˆ·ç«¯ï¼Œå¦‚ï¼šMySQL Command Client, MySQL Workbench, Navicat ç­‰ã€‚ ShardingSphere-Proxy ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾ ShardingSphere-Proxy ä¸ ShardingSphere-JDBC çš„ç‰¹æ€§æ¯”è¾ƒ ç‰¹æ€§ ShardingSphere-JDBC ShardingSphere-Proxy æ•°æ®åº“æ”¯æŒ ä»»æ„æ•°æ®åº“ MySQL / PostgreSQL è¿æ¥æ¶ˆè€—æ•° é«˜ ä½ å¼‚æ„è¯­è¨€æ”¯æŒ ä»…æ”¯æŒ Java æ”¯æŒä»»æ„è¯­è¨€ æ€§èƒ½ æŸè€—ä½ æŸè€—ç•¥é«˜ æ— ä¸­å¿ƒåŒ– æ˜¯ å¦ é™æ€å…¥å£ æ—  æœ‰ éƒ¨ç½² ShardingSphere-Proxy è¿è¡Œ ShardingSphere-Proxy è¦æ±‚ JDK 1.8+ ä¸‹è½½ ShardingSphere-Proxy5.5.2 1234wget https://www.apache.org/dyn/closer.lua/shardingsphere/5.5.2/apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gztar -zxvf apache-shardingsphere-5.5.2-shardingsphere-proxy-bin.tar.gzcd apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/ é…ç½® ShardingSphere-Proxy conf/global.yaml: å…¨å±€é…ç½®ï¼Œæ‰€è°“å…¨å±€ï¼Œå°±æ˜¯å¯¹æ‰€æœ‰é€»è¾‘åº“éƒ½ç”Ÿæ•ˆçš„é…ç½® 1234567891011121314151617181920212223# https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/authority/authority: users: - user: root@127.0.0.1 # æ ¼å¼ï¼šç”¨æˆ·å@IP password: root admin: true # æ˜¯å¦æ˜¯ç®¡ç†å‘˜ - user: sharding@% # æ‰€æœ‰IPéƒ½å¯ä»¥è®¿é—® password: sharding privilege: type: DATABASE_PERMITTED # æƒé™ç±»å‹ props: user-database-mappings: root@127.0.0.1=*,sharding@%=sharding_db # ç”¨æˆ·æƒé™æ˜ å°„ï¼Œ*è¡¨ç¤ºæ‰€æœ‰æ•°æ®åº“# å¼€å¯XAäº‹åŠ¡ï¼Œå¦‚æœæ˜¯ springbooté¡¹ç›®ï¼Œåªéœ€è¦åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Š @Transactional æ³¨è§£å³å¯å¼€å¯äº‹åŠ¡(ä» MySQL 5.7 å¼€å§‹å°±å…¨é¢æ”¯æŒ XA åˆ†å¸ƒå¼äº‹åŠ¡)# https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/transaction: # é…ç½®äº‹åŠ¡ defaultType: XA # äº‹åŠ¡ç±»å‹ï¼Œé»˜è®¤ LOCAL providerType: Atomikos # äº‹åŠ¡ç®¡ç†å™¨å…·ä½“å®ç°ï¼Œé»˜è®¤å°±æ˜¯ Atomikos# å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/props/props: sql-show: true # æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false check-table-metadata-enabled: false # åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false conf/database-my.yaml: è‡ªå®šä¹‰åˆ†é…è§„åˆ™é…ç½® æ³¨æ„: 1.åç§°å¿…é¡»ä»¥ database-å¼€å¤´ï¼Œå®é™…ä¸Šconfç›®å½•ä¸‹æœ‰å¾ˆå¤šç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé…ç½® 2.global.yamlä¸­çš„é…ç½®é¡¹ä¸èƒ½é…ç½®åˆ° database-my.yamlä¸­ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214# æ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šlogic_dbdatabaseName: sharding_db# æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/dataSources: ds_0: # é€»è¾‘æ•°æ®æºåç§° # dataSourceClassName: com.zaxxer.hikari.HikariDataSource # ä¸è¦æŒ‡å®š # driverClassName: com.mysql.cj.jdbc.Driver # ä¸è¦æŒ‡å®š url: jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 # æ³¨æ„è¿™é‡Œå±æ€§ä¸º url username: root password: newpwd ds_1: # dataSourceClassName: com.zaxxer.hikari.HikariDataSource # driverClassName: com.mysql.cj.jdbc.Driver url: jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd# ä»¥ä¸‹è§„åˆ™ä¸å‰æ–‡ä¸­çš„ shardingsphere-jdbc ä¸­çš„ rules ç›¸åŒ# åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® # ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´ bindingTables: - t_order,t_order_item tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® course: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.course_$&#123;1..2&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: course_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: cid shardingAlgorithmName: course_inline keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: cid # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id shardingAlgorithmName: t_order-complex-algorithm keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id # åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš” shardingAlgorithmName: t_order_item-class-based-algorithm_spi # åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_user: actualDataNodes: ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_inline # åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: id # è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹ # keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° keyGeneratorName: custom_snowflake_string # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° # t_address: # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜ # actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹ autoTables: # è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½® t_order: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/ course_inline: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™ props: # å±æ€§ algorithm-expression: course_$&#123;cid % 2 + 1&#125; # è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2 allow-range-query-with-inline-sharding: true # å…è®¸èŒƒå›´æŸ¥è¯¢ course_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; # è¡¨ç¤º ds_0, ds_1 mod_2: type: MOD # åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³• props: sharding-count: 2 # åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™ t_order_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; t_order-complex-algorithm: type: COMPLEX_INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³• props: algorithm-expression: t_order_complex_$&#123;(user_id + order_id + 1) % 2&#125; t_order_item-class-based-algorithm_spi: # SPI type: T_ORDER_ITEM_COMPLEX # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• t_user_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;Math.abs(id.hashCode()%2)&#125; t_user_inline: type: INLINE props: algorithm-expression: t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125; keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong uuid: # å®šä¹‰åç§° type: UUID # å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString custom_snowflake_string: type: CUSTOM_SNOWFLAKE_STRING props: workerId: 2 datacenterId: 2 - !BROADCAST # å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª tables: - dict # å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚ - !ENCRYPT # æ•°æ®åŠ å¯†é…ç½® tables: t_user: # åŠ å¯†è¡¨åç§° columns: password: # åŠ å¯†åˆ—åç§° cipher: name: password # å¯†æ–‡åˆ—åç§° encryptorName: aes_encryptor # å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§° # åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/ encryptors: aes_encryptor: # åŠ è§£å¯†ç®—æ³•åç§° type: AES # åŠ è§£å¯†ç®—æ³•ç±»å‹ props: # åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½® aes-key-value: 123456abc # AES ä½¿ç”¨çš„ KEY digest-algorithm-name: SHA-1 # AES KEY çš„æ‘˜è¦ç®—æ³• md5_encryptor: type: MD5 props: salt: 123456 # ç›å€¼ï¼ˆå¯é€‰ï¼‰ - !MASK # æ•°æ®è„±æ•é…ç½® tables: t_user: # è„±æ•è¡¨åç§° columns: # è„±æ•åˆ—é…ç½® password: # è„±æ•åˆ—åç§° maskAlgorithm: md5_mask # è„±æ•ç®—æ³•åç§° email: maskAlgorithm: mask_before_special_chars_mask telephone: maskAlgorithm: keep_first_n_last_m_mask name: maskAlgorithm: my_mask maskAlgorithms: # è„±æ•ç®—æ³•é…ç½® md5_mask: # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° type: MD5 # è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º mask_before_special_chars_mask: type: MASK_BEFORE_SPECIAL_CHARS # åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com props: special-chars: &#x27;@&#x27; # é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ• replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ keep_first_n_last_m_mask: type: KEEP_FIRST_N_LAST_M # ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678 props: first-n: 3 # ä¿ç•™å‰ 3 ä½ last-m: 4 # ä¿ç•™å 4 ä½ replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ my_mask: type: MY_CUSTOM_MASK # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° props: replace-char: &quot;#&quot; - !SINGLE # å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™ tables: # MySQL é£æ ¼ - ds_0.t_address # åŠ è½½æŒ‡å®šå•è¡¨# - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨# - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨ ä¸Šé¢çš„rulesä¸­ä½¿ç”¨çš„æ˜¯mysqlæ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥mysqlæ•°æ®åº“çš„ä¾èµ– 1234cd apache-shardingsphere-5.5.2-shardingsphere-proxy-bin/mkdir ext-libcd ext-libwget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar åŒæ—¶rulesä¸­åŒ…å«ä¸€äº›è‡ªå®šä¹‰çš„ç®—æ³•ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†è¿™äº›ç®—æ³•ä½œä¸ºä¾èµ–è¿›è¡Œå¼•å…¥ï¼Œå°†è¿™äº›ç®—æ³•ç±»æ‰“æˆjarï¼Œç„¶åä¹Ÿæ‹·è´åˆ°ext-libç›®å½•ä¸‹ï¼Œæˆ‘å·²ç»å°†å…¶å‘å¸ƒåˆ°äº†githubä¸Šï¼Œå®é™…ä¸Šå’Œå‰æ–‡ä¸­çš„ shardingsphere-jdbc é¡¹ç›®ä¸­å°†ç®—æ³•é…ç½®ä¸º spi çš„æ–¹å¼æ˜¯ä¸€è‡´çš„ã€‚ 123456789101112131415# 1. åªå…‹éš†ä»“åº“çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¸ä¸‹è½½æ‰€æœ‰æ–‡ä»¶git clone --filter=blob:none --sparse https://github.com/hanqunfeng/springbootchapter.git# 2. è¿›å…¥ä»“åº“ç›®å½•cd springbootchapter# 3. è®¾ç½®åªæ£€å‡ºä½ éœ€è¦çš„ç›®å½•git sparse-checkout set springboot3-demo/shardingsphere-demo/algorithm-swapper# 4. ç¼–è¯‘æ‰“åŒ…cd springboot3-demo/shardingsphere-demo/algorithm-swappermvn clean package -DskipTests# 5. å°†æ‰“å¥½çš„åŒ…å¤åˆ¶åˆ° shardingsphere-proxy çš„ ext-lib ç›®å½•ä¸‹cp target/algorithm-swapper-1.0.0.jar $shardingsphere-proxy$/ext-lib å¯åŠ¨ä¸å…³é—­ ShardingSphere Proxy ShardingSphere Proxy è¦æ±‚ JDK 1.8 æˆ–ä»¥ä¸Šç‰ˆæœ¬ 12345cd $shardingsphere-proxy$/bin# å¯åŠ¨./start.sh# å…³é—­./stop.sh å‚æ•°è¯´æ˜ å‚æ•° è¯´æ˜ é»˜è®¤å€¼ -a ç»‘å®šåœ°å€ï¼Œå¯ä»¥æ˜¯ IPv4ã€IPv6 æˆ–ä¸»æœºåï¼Œå¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”ã€‚ 0.0.0.0 -p ç»‘å®šç«¯å£å·ï¼Œå¯ä»¥åœ¨ global.yaml ä¸­ä¿®æ”¹ã€‚-p ä¼˜å…ˆçº§æ›´é«˜ 3307 -c ShardingSphere-Proxy é…ç½®ç›®å½•è·¯å¾„ã€‚ conf -f å¼ºåˆ¶å¯åŠ¨ ShardingSphere-Proxyã€‚ æ—  -g å¦‚æœåœ¨ agent ç›®å½•ä¸‹éƒ¨ç½²äº† shardingsphere-agentï¼Œå¯ç”¨ agent åŠŸèƒ½ã€‚ æ—  -s æŒ‡å®šç”¨äºè¿æ¥çš„ socket æ–‡ä»¶è·¯å¾„ã€‚ æ—  ShardingSphere-Proxy å¯åŠ¨å‘½ä»¤é€ŸæŸ¥è¡¨ åœºæ™¯ å‘½ä»¤ç¤ºä¾‹ è¯´æ˜ é»˜è®¤å¯åŠ¨ ./start.sh é»˜è®¤ç«¯å£ 3307ï¼Œé…ç½®ç›®å½• conf æŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½• ./start.sh 3308 /opt/shardingsphere-proxy/conf ç®€å†™æ¨¡å¼ï¼ŒæŒ‡å®šç«¯å£å’Œé…ç½®ç›®å½• å‚æ•°å½¢å¼å¯åŠ¨ ./start.sh -p 3308 -c /opt/shardingsphere-proxy/conf ä¸ä¸Šé¢ç­‰æ•ˆï¼Œä½†æ›´æ˜ç¡® æŒ‡å®šç›‘å¬åœ°å€ ./start.sh -a 192.168.1.100 -p 3307 -c conf æŒ‡å®šå•ä¸ª IP åœ°å€ æŒ‡å®šå¤šä¸ªç›‘å¬åœ°å€ ./start.sh -a 192.168.1.100,127.0.0.1 -p 3307 -c conf å¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš” å¼ºåˆ¶å¯åŠ¨ ./start.sh -p 3307 -c conf -f é‡åˆ°æ®‹ç•™ PID æ–‡ä»¶æ—¶ä½¿ç”¨ å¯ç”¨ agent ./start.sh -p 3307 -c conf -g å¯åŠ¨ ShardingSphere-Agent ä½¿ç”¨ Unix Socket ./start.sh -p 3307 -c conf -s /tmp/sharding-proxy.sock é€šè¿‡ Socket æ–‡ä»¶è¿›è¡Œè¿æ¥ å¤šé€‰é¡¹ç»„åˆ ./start.sh -a 127.0.0.1 -p 3310 -c /opt/proxy/conf -f -g -s /tmp/proxy.sock ä¸€æ¬¡æ€§æŒ‡å®šå¤šä¸ªé€‰é¡¹ é¡¹ç›®è¿æ¥ ShardingSphere-Proxy æ—¶ï¼Œå°±åƒè¿æ¥æ™®é€šçš„ mysql æœåŠ¡ä¸€æ · ç¤ºä¾‹é¡¹ç›®ï¼šhttps://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-proxy åè®° åœ¨ ShardingSphere-JDBC å’Œ ShardingSphere-Proxy ä¸­ï¼Œå­˜åœ¨éƒ¨åˆ† MySQL(å…¶å®ƒæ•°æ®åº“ä¹Ÿç±»ä¼¼) çš„ SQL è¯­æ³•æˆ–åŠŸèƒ½ç›®å‰è¿˜ä¸å®Œå…¨æ”¯æŒçš„æƒ…å†µã€‚ShardingSphere åœ¨åš SQL è·¯ç”±ã€æ”¹å†™ã€æ‰§è¡Œæ—¶ï¼Œå¿…é¡»èƒ½è§£æ SQL å¹¶ç†è§£å…¶è¯­ä¹‰ï¼Œä½†å¹¶ä¸æ˜¯ MySQL çš„ 100% å®Œå…¨ä»£ç†ã€‚å› æ­¤ï¼Œæœ‰äº›å¤æ‚æˆ–ç‰¹å®šåœºæ™¯ä¸‹çš„ SQL å¯èƒ½æ— æ³•è¢«æ­£ç¡®è§£ææˆ–æ‰§è¡Œã€‚ æ”¯æŒè‰¯å¥½çš„ SQL è¯­æ³• åŸºç¡€ DML SELECTã€INSERTã€UPDATEã€DELETE åŸºæœ¬çš„æ¡ä»¶æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µã€åˆ†ç»„ã€èšåˆå‡½æ•°ï¼ˆå¦‚ COUNTã€SUMã€AVGï¼‰ DCL åŸºæœ¬çš„äº‹åŠ¡è¯­å¥ï¼šBEGINã€COMMITã€ROLLBACK DDL éƒ¨åˆ†è¡¨ç»“æ„ç®¡ç†è¯­å¥ï¼šCREATE TABLEã€ALTER TABLEã€DROP TABLE å‡½æ•°æ”¯æŒ å¤§éƒ¨åˆ†å¸¸ç”¨çš„ MySQL å†…ç½®å‡½æ•°ï¼Œå¦‚å­—ç¬¦ä¸²ã€æ•°å­¦ã€æ—¥æœŸå‡½æ•° åœ¨ ShardingSphere + MySQL ä¸‹å»ºè®®é¿å…æˆ–è°¨æ…ä½¿ç”¨çš„ SQL æ¸…å• è·¨åˆ†ç‰‡å¤æ‚æŸ¥è¯¢ SQL åœºæ™¯ åŸå›  å»ºè®®å¤„ç†æ–¹å¼ å¤šè¡¨å¤æ‚ JOINï¼ˆç‰¹åˆ«æ˜¯è·¨åˆ†ç‰‡ï¼‰ éœ€è¦è·¨åº“æ•°æ®èšåˆï¼Œæ€§èƒ½å·®ï¼Œå¯èƒ½æŠ¥é”™ ä½¿ç”¨å¹¿æ’­è¡¨/ç»‘å®šè¡¨ï¼Œæˆ–åœ¨åº”ç”¨å±‚å®Œæˆ è·¨åˆ†ç‰‡å­æŸ¥è¯¢ SQL è·¯ç”±å›°éš¾ï¼Œå¯èƒ½ä¸æ”¯æŒ å°½é‡æ”¹æˆå•è¡¨æŸ¥è¯¢æˆ–åˆ†æ­¥æŸ¥è¯¢ è·¨åˆ†ç‰‡çš„ GROUP BY / ORDER BY åœ¨ Proxy å±‚èšåˆï¼Œæ€§èƒ½å¾ˆå·® å°½é‡é¿å…ï¼Œæˆ–æ§åˆ¶æ•°æ®é‡ DDL ç›¸å…³ SQL åœºæ™¯ åŸå›  å»ºè®®å¤„ç†æ–¹å¼ ALTER TABLE å¤æ‚å˜æ›´ éœ€åœ¨æ‰€æœ‰åˆ†ç‰‡æ‰§è¡Œï¼Œå¯èƒ½æ‰§è¡Œå¤±è´¥ æ‰‹åŠ¨åœ¨æ¯ä¸ªåˆ†ç‰‡åº“æ‰§è¡Œ CREATE TRIGGERã€PROCEDURE Proxy ä¸è§£æè¿™äº›è¯­æ³•ï¼Œç›´æ¥é€ä¼ ä¸å®‰å…¨ å°½é‡åœ¨å•åº“æ‰‹åŠ¨åˆ›å»º CREATE FUNCTION åŒä¸Š å•åº“æ‰§è¡Œæˆ–åº”ç”¨å±‚æ›¿ä»£ FULLTEXT INDEXã€SPATIAL INDEX åˆ†ç‰‡ç¯å¢ƒä¸‹æ— æ³•è‡ªåŠ¨ç»´æŠ¤ç´¢å¼• å•åº“æ‰‹åŠ¨ç»´æŠ¤æˆ–é¿å…ä½¿ç”¨ æ–‡ä»¶å¯¼å…¥å¯¼å‡º SQL åœºæ™¯ åŸå›  å»ºè®®å¤„ç†æ–¹å¼ LOAD DATA INFILE Proxy ä¸æ”¯æŒæ–‡ä»¶ç³»ç»Ÿç›´æ¥è®¿é—® åœ¨åˆ†ç‰‡åº“æ‰‹åŠ¨æ‰§è¡Œæˆ–é€šè¿‡åº”ç”¨å¯¼å…¥ SELECT ... INTO OUTFILE åŒä¸Š åº”ç”¨å±‚å¤„ç†å¯¼å‡º MySQL ç‰¹æœ‰åŠŸèƒ½ åŠŸèƒ½ æ”¯æŒæƒ…å†µ å»ºè®® MySQL 8.0 å…¬å…±è¡¨è¡¨è¾¾å¼ï¼ˆCTEï¼‰ éƒ¨åˆ†æ”¯æŒ é¿å…è·¨åˆ†ç‰‡ä½¿ç”¨ çª—å£å‡½æ•°ï¼ˆOVER() PARTITION BYï¼‰ éƒ¨åˆ†æ”¯æŒ é¿å…è·¨åˆ†ç‰‡å¤§æ•°æ®é‡ä½¿ç”¨ JSON å‡½æ•° åŸºæœ¬æ”¯æŒ å•è¡¨åœºæ™¯å¯ç”¨ï¼Œè·¨åˆ†ç‰‡éœ€è°¨æ… åˆ†å¸ƒå¼äº‹åŠ¡ åœºæ™¯ é—®é¢˜åŸå›  å»ºè®®å¤„ç†æ–¹å¼ è·¨åˆ†ç‰‡åŸç”Ÿäº‹åŠ¡ MySQL åŸç”Ÿäº‹åŠ¡ä¸æ”¯æŒè·¨åº“ ä½¿ç”¨ ShardingSphere XA / BASE å¤§äº‹åŠ¡ + åˆ†å¸ƒå¼äº‹åŠ¡ æ€§èƒ½å¼€é”€å¤§ å°½é‡æ§åˆ¶äº‹åŠ¡èŒƒå›´","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-Proxy5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€ æœ¬æ–‡å°† SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨ ä¿®æ”¹ä¸º ShardingSphere-Proxy çš„æ¨¡å¼","date_published":"2025-09-04T13:30:05.000Z","tags":["æŠ€æœ¯","springboot","sharding-sphere","springboot","sharding-sphere"]},{"id":"https://blog.hanqunfeng.com/2025/09/01/springboot3-shardingsphere/","url":"https://blog.hanqunfeng.com/2025/09/01/springboot3-shardingsphere/","title":"SpringBoot3 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://shardingsphere.apache.org/index_zh.html\">ShardingSphereå®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/hanqunfeng/springbootchapter/tree/master/springboot3-demo/shardingsphere-demo/shardingsphere-demo-01\">æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ShardingSphere-JDBC-ç®€ä»‹\">ShardingSphere-JDBC ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ShardingSphere-JDBC å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">é€‚ç”¨äºä»»ä½•åŸºäº JDBC çš„ ORM æ¡†æ¶ï¼Œå¦‚ï¼šJPA, Hibernate, Mybatis, Spring JDBC Template æˆ–ç›´æ¥ä½¿ç”¨ JDBCï¼›</li>\n<li class=\"lvl-4\">æ”¯æŒä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, HikariCP ç­‰ï¼›</li>\n<li class=\"lvl-4\">æ”¯æŒä»»æ„å®ç° JDBC è§„èŒƒçš„æ•°æ®åº“ï¼Œç›®å‰æ”¯æŒ MySQLï¼ŒPostgreSQLï¼ŒOracleï¼ŒSQLServer ä»¥åŠä»»ä½•å¯ä½¿ç”¨ JDBC è®¿é—®çš„æ•°æ®åº“ã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ShardingSphere-JDBC ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾<br>\n<img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/RgXClY.png\" alt=\"\"></p>\n</li>\n</ul>\n<h2 id=\"mavenä¾èµ–\">mavenä¾èµ–</h2>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- æœ¬é¡¹ç›® åŸºäº mysql --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.baomidou<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.5.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.shardingsphere<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>shardingsphere-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.5.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"application-yml\">application.yml</h2>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">org.apache.shardingsphere.driver.ShardingSphereDriver</span></span><br><span class=\"line\">    <span class=\"comment\"># æŒ‡å‘ç±»è·¯å¾„ä¸‹çš„ sharding.yamlï¼ˆä¹Ÿå¯ absolute path / file: / http: ç­‰ï¼Œè§å®˜æ–¹è¯´æ˜ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:shardingsphere:classpath:sharding.yaml</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥ä¸åœ¨ <code>application.yml</code> ä¸­é…ç½®ï¼Œè€Œæ˜¯é€šè¿‡ <code>@Configuration</code> åˆ›å»º <code>@Bean</code>ï¼Œè¿™æ ·å°±å¯ä»¥é…ç½®å¤šæ•°æ®æºäº†ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DataSourceConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean(name = &quot;shardingDataSource&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DataSource <span class=\"title function_\">shardingDataSource</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> SQLException, IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ShardingSphere æä¾›çš„å·¥å‚æ–¹æ³•ï¼Œæ ¹æ®é…ç½®æ„å»º DataSource</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">InputStream</span> <span class=\"variable\">inputStream</span> <span class=\"operator\">=</span> getClass().getClassLoader().getResourceAsStream(<span class=\"string\">&quot;sharding.yaml&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (inputStream == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalStateException</span>(<span class=\"string\">&quot;Cannot find sharding.yaml in classpath&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"type\">byte</span>[] yamlBytes = inputStream.readAllBytes();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> YamlShardingSphereDataSourceFactory.createDataSource(yamlBytes);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"sharding-yaml\">sharding.yaml</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®Œæ•´é…ç½®ï¼Œä¸‹æ–‡ä¼šä»‹ç»éƒ¨åˆ†é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/</span></span><br><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_0:</span> <span class=\"comment\"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.zaxxer.hikari.HikariDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">jdbcUrl:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">ds_1:</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.zaxxer.hikari.HikariDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">jdbcUrl:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"comment\"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">bindingTables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">t_order,t_order_item</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">course:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">cid</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_inline</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">cid</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order-complex-algorithm</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class=\"line\"><span class=\"comment\">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_item-class-based-algorithm_spi</span> <span class=\"comment\"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class=\"line\"><span class=\"comment\">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">custom_snowflake_string</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#       t_address:      # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜</span></span><br><span class=\"line\"><span class=\"comment\">#         actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">autoTables:</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/</span></span><br><span class=\"line\">      <span class=\"attr\">course_inline:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># å±æ€§</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">course_$&#123;cid</span> <span class=\"string\">%</span> <span class=\"number\">2</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class=\"line\">          <span class=\"attr\">allow-range-query-with-inline-sharding:</span> <span class=\"literal\">true</span> <span class=\"comment\"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class=\"line\">      <span class=\"attr\">course_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class=\"line\">      <span class=\"attr\">mod_2:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MOD</span> <span class=\"comment\"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">sharding-count:</span> <span class=\"number\">2</span> <span class=\"comment\"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order-complex-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">COMPLEX_INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_order_complex_$&#123;(user_id</span> <span class=\"string\">+</span> <span class=\"string\">order_id</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">)</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CLASS_BASED</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">strategy:</span> <span class=\"string\">COMPLEX</span> <span class=\"comment\"># æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">algorithmClassName:</span> <span class=\"string\">com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm</span> <span class=\"comment\"># æŒ‡å®šç®—æ³•ç±»</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm_spi:</span> <span class=\"comment\"># SPI</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">T_ORDER_ITEM_COMPLEX</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br><span class=\"line\">      <span class=\"attr\">uuid:</span>    <span class=\"comment\"># å®šä¹‰åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">UUID</span> <span class=\"comment\"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class=\"line\">      <span class=\"attr\">custom_snowflake_string:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CUSTOM_SNOWFLAKE_STRING</span>  <span class=\"comment\"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒString</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">workerId:</span> <span class=\"number\">2</span></span><br><span class=\"line\">          <span class=\"attr\">datacenterId:</span> <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!BROADCAST</span>  <span class=\"comment\"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">dict</span>    <span class=\"comment\"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!ENCRYPT</span>    <span class=\"comment\"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># åŠ å¯†è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># åŠ å¯†åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">cipher:</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">password</span> <span class=\"comment\"># å¯†æ–‡åˆ—åç§°</span></span><br><span class=\"line\">              <span class=\"attr\">encryptorName:</span> <span class=\"string\">aes_encryptor</span> <span class=\"comment\"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class=\"line\">    <span class=\"attr\">encryptors:</span></span><br><span class=\"line\">      <span class=\"attr\">aes_encryptor:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">AES</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">aes-key-value:</span> <span class=\"string\">123456abc</span>     <span class=\"comment\"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class=\"line\">          <span class=\"attr\">digest-algorithm-name:</span> <span class=\"string\">SHA-1</span> <span class=\"comment\"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">md5_encryptor:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">salt:</span> <span class=\"number\">123456</span>  <span class=\"comment\"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!MASK</span>  <span class=\"comment\"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># è„±æ•è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span>  <span class=\"comment\"># è„±æ•åˆ—é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># è„±æ•åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">md5_mask</span> <span class=\"comment\"># è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">email:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">mask_before_special_chars_mask</span></span><br><span class=\"line\">          <span class=\"attr\">telephone:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">keep_first_n_last_m_mask</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">my_mask</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">maskAlgorithms:</span> <span class=\"comment\"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">md5_mask:</span> <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span>  <span class=\"comment\"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class=\"line\">      <span class=\"attr\">mask_before_special_chars_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MASK_BEFORE_SPECIAL_CHARS</span> <span class=\"comment\"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">special-chars:</span> <span class=\"string\">&#x27;@&#x27;</span>  <span class=\"comment\"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span>   <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">keep_first_n_last_m_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">KEEP_FIRST_N_LAST_M</span> <span class=\"comment\"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">first-n:</span> <span class=\"number\">3</span>     <span class=\"comment\"># ä¿ç•™å‰ 3 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">last-m:</span> <span class=\"number\">4</span>      <span class=\"comment\"># ä¿ç•™å 4 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">my_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MY_CUSTOM_MASK</span>  <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&quot;#&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SINGLE</span> <span class=\"comment\"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"comment\"># MySQL é£æ ¼</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ds_0.t_address</span> <span class=\"comment\"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br><span class=\"line\"><span class=\"comment\">#       - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨</span></span><br><span class=\"line\"><span class=\"comment\">#       - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/</span></span><br><span class=\"line\"><span class=\"attr\">props:</span></span><br><span class=\"line\">  <span class=\"attr\">sql-show:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class=\"line\">  <span class=\"attr\">check-table-metadata-enabled:</span> <span class=\"literal\">false</span> <span class=\"comment\"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"æ•°æ®æºé…ç½®\">æ•°æ®æºé…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>hikari + mysql</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_0:</span> <span class=\"comment\"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.zaxxer.hikari.HikariDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">jdbcUrl:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">ds_1:</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.zaxxer.hikari.HikariDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">jdbcUrl:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>druid + mysql</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_1:</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\">    <span class=\"comment\"># Druid ç‰¹æœ‰é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">initialSize:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">minIdle:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">maxActive:</span> <span class=\"number\">20</span></span><br><span class=\"line\">    <span class=\"attr\">maxWait:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">    <span class=\"attr\">testWhileIdle:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">validationQuery:</span> <span class=\"string\">SELECT</span> <span class=\"number\">1</span> <span class=\"string\">FROM</span> <span class=\"string\">DUAL</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>druid + mysql + p6spy</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dataSources:</span></span><br><span class=\"line\">  <span class=\"attr\">ds_0:</span> <span class=\"comment\"># é€»è¾‘æ•°æ®æºåç§°</span></span><br><span class=\"line\">    <span class=\"attr\">dataSourceClassName:</span> <span class=\"string\">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">driverClassName:</span> <span class=\"string\">com.p6spy.engine.spy.P6SpyDriver</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:p6spy:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">newpwd</span></span><br><span class=\"line\">    <span class=\"comment\"># Druid ç‰¹æœ‰é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">initialSize:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">minIdle:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">maxActive:</span> <span class=\"number\">20</span></span><br><span class=\"line\">    <span class=\"attr\">maxWait:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">    <span class=\"attr\">testWhileIdle:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">validationQuery:</span> <span class=\"string\">SELECT</span> <span class=\"number\">1</span> <span class=\"string\">FROM</span> <span class=\"string\">DUAL</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"åˆ†åº“åˆ†è¡¨é…ç½®\">åˆ†åº“åˆ†è¡¨é…ç½®</h3>\n<h4 id=\"å•åˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹\">å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">course:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.course_$&#123;1..2&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">cid</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">course_inline</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">cid</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">course_inline:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># å±æ€§</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">course_$&#123;cid</span> <span class=\"string\">%</span> <span class=\"number\">2</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2</span></span><br><span class=\"line\">          <span class=\"attr\">allow-range-query-with-inline-sharding:</span> <span class=\"literal\">true</span> <span class=\"comment\"># å…è®¸èŒƒå›´æŸ¥è¯¢</span></span><br><span class=\"line\">      <span class=\"attr\">course_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span> <span class=\"comment\"># è¡¨ç¤º ds_0, ds_1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ä¸åŒçš„å­—æ®µï¼Œåˆ†åº“ä½¿ç”¨ user_idï¼Œåˆ†è¡¨ä½¿ç”¨ cid</p>\n</li>\n<li class=\"lvl-2\">\n<p>allow-range-query-with-inline-sharding: true ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå…è®¸èŒƒå›´æŸ¥è¯¢ï¼Œé»˜è®¤å€¼æ˜¯ falseï¼Œä¸å…è®¸ between æŸ¥è¯¢</p>\n</li>\n</ul>\n<h4 id=\"å•åˆ†ç‰‡é”®ï¼ŒString-ç±»å‹\">å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_user_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class=\"line\"><span class=\"comment\">#           keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">custom_snowflake_string</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;Math.abs(id.hashCode()%2)&#125;</span> <span class=\"comment\"># åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®—</span></span><br><span class=\"line\">      <span class=\"attr\">t_user_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125;</span> <span class=\"comment\"># åˆ†è¡¨ï¼Œt_user_0, t_user_1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">uuid:</span>    <span class=\"comment\"># å®šä¹‰åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">UUID</span> <span class=\"comment\"># å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString</span></span><br><span class=\"line\">      <span class=\"attr\">custom_snowflake_string:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CUSTOM_SNOWFLAKE_STRING</span> <span class=\"comment\"># è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">workerId:</span> <span class=\"number\">2</span></span><br><span class=\"line\">          <span class=\"attr\">datacenterId:</span> <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ç›¸åŒçš„å­—æ®µï¼Œå³ä¸»é”®idï¼Œå› å…¶ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ hashCode() è·å–æ•°å­—ï¼Œå†è¿›è¡Œè¿ç®—</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸»é”®è·å–è§„åˆ™ä½¿ç”¨çš„è‡ªå®šä¹‰çš„é›ªèŠ±ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.infra.algorithm.keygen.core.KeyGenerateAlgorithm</code>ï¼Œè¿™é‡Œæ³¨æ„ï¼Œä» <code>5.5.3</code> å¼€å§‹ä¼šæ›´æ¢ä¸º <code>org.apache.shardingsphere.infra.algorithm.keygen.spi.KeyGenerateAlgorithm</code></p>\n</li>\n</ul>\n<h4 id=\"å¤šåˆ†ç‰‡é”®ï¼ŒLong-ç±»å‹\">å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span> <span class=\"comment\"># æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order-complex-algorithm</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item_complex:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataNodes:</span> <span class=\"string\">ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125;</span> <span class=\"comment\"># å®é™…æ•°æ®èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"attr\">databaseStrategy:</span> <span class=\"comment\"># åˆ†åº“ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_db_inline</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">tableStrategy:</span> <span class=\"comment\"># åˆ†è¡¨ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">complex:</span> <span class=\"comment\"># ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumns:</span> <span class=\"string\">user_id,order_id</span>  <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”</span></span><br><span class=\"line\"><span class=\"comment\">#             shardingAlgorithmName: t_order_item-class-based-algorithm   # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">t_order_item-class-based-algorithm_spi</span> <span class=\"comment\"># åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_db_inline:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">INLINE</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">ds_$&#123;user_id</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order-complex-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">COMPLEX_INLINE</span> <span class=\"comment\"># åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">algorithm-expression:</span> <span class=\"string\">t_order_complex_$&#123;(user_id</span> <span class=\"string\">+</span> <span class=\"string\">order_id</span> <span class=\"string\">+</span> <span class=\"number\">1</span><span class=\"string\">)</span> <span class=\"string\">%</span> <span class=\"number\">2</span><span class=\"string\">&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">CLASS_BASED</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">strategy:</span> <span class=\"string\">COMPLEX</span> <span class=\"comment\"># æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">algorithmClassName:</span> <span class=\"string\">com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm</span> <span class=\"comment\"># æŒ‡å®šç®—æ³•ç±»</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item-class-based-algorithm_spi:</span> <span class=\"comment\"># SPI</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">T_ORDER_ITEM_COMPLEX</span> <span class=\"comment\"># åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¤šä¸ªåˆ†ç‰‡é”®ï¼Œ<code>t_order_complex</code>è¡¨ä½¿ç”¨äº†å†…ç½®çš„<code>COMPLEX_INLINE</code>ç®—æ³•ï¼Œè€Œ<code>t_order_item_complex</code>è¡¨ä½¿ç”¨äº†è‡ªå®šä¹‰çš„çš„åˆ†ç‰‡ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.sharding.spi.ShardingAlgorithm</code></p>\n</li>\n</ul>\n<h4 id=\"è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™\">è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SHARDING</span> <span class=\"comment\"># åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">   <span class=\"comment\"># ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">bindingTables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">t_order,t_order_item</span></span><br><span class=\"line\">    <span class=\"attr\">autoTables:</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">t_order:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">order_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\">      <span class=\"attr\">t_order_item:</span> <span class=\"comment\"># é€»è¾‘è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">actualDataSources:</span> <span class=\"string\">ds_$&#123;0..1&#125;</span> <span class=\"comment\"># æ•°æ®æºåç§°</span></span><br><span class=\"line\">        <span class=\"attr\">shardingStrategy:</span> <span class=\"comment\"># åˆ‡åˆ†ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">standard:</span> <span class=\"comment\"># ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯</span></span><br><span class=\"line\">            <span class=\"attr\">shardingColumn:</span> <span class=\"string\">user_id</span> <span class=\"comment\"># åˆ†ç‰‡åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">shardingAlgorithmName:</span> <span class=\"string\">mod_2</span> <span class=\"comment\"># è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">keyGenerateStrategy:</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥</span></span><br><span class=\"line\">          <span class=\"attr\">column:</span> <span class=\"string\">item_id</span> <span class=\"comment\"># è‡ªå¢åˆ—åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">keyGeneratorName:</span> <span class=\"string\">snowflake</span> <span class=\"comment\"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">shardingAlgorithms:</span> <span class=\"comment\"># åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">mod_2:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MOD</span> <span class=\"comment\"># åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³•</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">sharding-count:</span> <span class=\"number\">2</span> <span class=\"comment\"># åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">keyGenerators:</span> <span class=\"comment\"># åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨</span></span><br><span class=\"line\">      <span class=\"attr\">snowflake:</span> <span class=\"comment\"># å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">SNOWFLAKE</span> <span class=\"comment\"># ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™éœ€è¦å£°æ˜æ•°æ®åº“ï¼Œä½†ä¸éœ€è¦å£°æ˜è¡¨åˆ†é…è§„åˆ™ï¼Œå…¶æ ¹æ®åˆ†ç‰‡ç®—æ³•è‡ªåŠ¨ç¡®å®šå…·ä½“çš„æ•°æ®è¡¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>åŒæ—¶è¿™é‡Œè¿˜é…ç½®äº†<code>bindingTables</code>ï¼Œç”¨æ¥æŒ‡å®šå…¶åˆ†ç‰‡è·¯ç”±ä¸€è‡´ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å¹¿æ’­è¡¨é…ç½®\">å¹¿æ’­è¡¨é…ç½®</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!BROADCAST</span>  <span class=\"comment\"># å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">dict</span>    <span class=\"comment\"># å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"æ•°æ®åŠ å¯†è§„åˆ™\">æ•°æ®åŠ å¯†è§„åˆ™</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!ENCRYPT</span>    <span class=\"comment\"># æ•°æ®åŠ å¯†é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># åŠ å¯†è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># åŠ å¯†åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">cipher:</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">password</span> <span class=\"comment\"># å¯†æ–‡åˆ—åç§°</span></span><br><span class=\"line\">              <span class=\"attr\">encryptorName:</span> <span class=\"string\">aes_encryptor</span> <span class=\"comment\"># å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">    <span class=\"comment\"># åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/</span></span><br><span class=\"line\">    <span class=\"attr\">encryptors:</span></span><br><span class=\"line\">      <span class=\"attr\">aes_encryptor:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">AES</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•ç±»å‹</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span> <span class=\"comment\"># åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">aes-key-value:</span> <span class=\"string\">123456abc</span>     <span class=\"comment\"># AES ä½¿ç”¨çš„ KEY</span></span><br><span class=\"line\">          <span class=\"attr\">digest-algorithm-name:</span> <span class=\"string\">SHA-1</span> <span class=\"comment\"># AES KEY çš„æ‘˜è¦ç®—æ³•</span></span><br><span class=\"line\">      <span class=\"attr\">md5_encryptor:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">salt:</span> <span class=\"number\">123456</span>  <span class=\"comment\"># ç›å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>é…ç½®åŠ å¯†å­—æ®µè§„åˆ™åï¼Œæ–°å¢æ•°æ®æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¹åŠ å¯†å­—æ®µåŠ å¯†åå­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶ä¹Ÿä¼šåŠ å¯†åè¿›è¡Œæ¯”è¾ƒæŸ¥è¯¢ã€‚</p>\n</li>\n</ul>\n<h3 id=\"æ•°æ®è„±æ•è§„åˆ™\">æ•°æ®è„±æ•è§„åˆ™</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!MASK</span>  <span class=\"comment\"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"attr\">t_user:</span>  <span class=\"comment\"># è„±æ•è¡¨åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">columns:</span>  <span class=\"comment\"># è„±æ•åˆ—é…ç½®</span></span><br><span class=\"line\">          <span class=\"attr\">password:</span> <span class=\"comment\"># è„±æ•åˆ—åç§°</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">md5_mask</span> <span class=\"comment\"># è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">email:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">mask_before_special_chars_mask</span></span><br><span class=\"line\">          <span class=\"attr\">telephone:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">keep_first_n_last_m_mask</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span></span><br><span class=\"line\">            <span class=\"attr\">maskAlgorithm:</span> <span class=\"string\">my_mask</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">maskAlgorithms:</span> <span class=\"comment\"># è„±æ•ç®—æ³•é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">md5_mask:</span> <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MD5</span>  <span class=\"comment\"># è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º</span></span><br><span class=\"line\">      <span class=\"attr\">mask_before_special_chars_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MASK_BEFORE_SPECIAL_CHARS</span> <span class=\"comment\"># åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">special-chars:</span> <span class=\"string\">&#x27;@&#x27;</span>  <span class=\"comment\"># é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ•</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span>   <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">keep_first_n_last_m_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">KEEP_FIRST_N_LAST_M</span> <span class=\"comment\"># ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">first-n:</span> <span class=\"number\">3</span>     <span class=\"comment\"># ä¿ç•™å‰ 3 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">last-m:</span> <span class=\"number\">4</span>      <span class=\"comment\"># ä¿ç•™å 4 ä½</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿</span></span><br><span class=\"line\">      <span class=\"attr\">my_mask:</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">MY_CUSTOM_MASK</span>  <span class=\"comment\"># è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">props:</span></span><br><span class=\"line\">          <span class=\"attr\">replace-char:</span> <span class=\"string\">&quot;#&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¢«è„±æ•çš„å­—æ®µåœ¨æŸ¥è¯¢æ—¶ä¼šè¿›è¡Œè„±æ•å±•ç¤ºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è¿™é‡Œè¿˜è‡ªå®šä¹‰äº†è„±æ•ç®—æ³•ï¼Œspiï¼Œè¯¦è§<code>src/main/resources/META-INF/services/org.apache.shardingsphere.mask.spi.MaskAlgorithm</code></p>\n</li>\n</ul>\n<h3 id=\"å•è¡¨è§„åˆ™\">å•è¡¨è§„åˆ™</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å³ä¸éœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨çš„è¡¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"type\">!SINGLE</span> <span class=\"comment\"># å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™</span></span><br><span class=\"line\">    <span class=\"attr\">tables:</span></span><br><span class=\"line\">      <span class=\"comment\"># MySQL é£æ ¼</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">ds_0.t_address</span> <span class=\"comment\"># åŠ è½½æŒ‡å®šå•è¡¨</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å±æ€§é…ç½®\">å±æ€§é…ç½®</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/</span></span><br><span class=\"line\"><span class=\"attr\">props:</span></span><br><span class=\"line\">  <span class=\"attr\">sql-show:</span> <span class=\"literal\">true</span> <span class=\"comment\"># æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false</span></span><br><span class=\"line\">  <span class=\"attr\">check-table-metadata-enabled:</span> <span class=\"literal\">false</span> <span class=\"comment\"># åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"äº‹åŠ¡é…ç½®\">äº‹åŠ¡é…ç½®</h3>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/</span></span><br><span class=\"line\"><span class=\"attr\">transaction:</span></span><br><span class=\"line\">  <span class=\"attr\">defaultType:</span> <span class=\"string\">LOCAL</span> <span class=\"comment\"># é»˜è®¤äº‹åŠ¡ç±»å‹å°±æ˜¯ LOCAL</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ä¸ springboot2 ä¸åŒï¼Œä¸å†æä¾› <code>springboot-starter-shardingsphere</code>ï¼Œç›¸å…³é…ç½®ä¹Ÿé‡‡ç”¨äº†ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä»£ç ä¸­åŒ…å«ä¸¤ä¸ªåº“ä¸­ä½¿ç”¨åˆ°çš„æ•°æ®åº“è„šæœ¬ï¼Œ<code>shardingsphere-demo/shardingsphere-demo-01/sql</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>å…·ä½“ä½¿ç”¨æ•ˆæœå¯ä»¥é€šè¿‡é¡¹ç›®ä¸­æä¾›çš„å•å…ƒæµ‹è¯•ç±»è¿›è¡ŒéªŒè¯ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ç›®å‰<a href=\"https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/jdbc-driver/spring-boot/\">å°šä¸æ”¯æŒ <code>XA</code> åˆ†å¸ƒå¼äº‹åŠ¡</a>ï¼Œè¿™æ˜¯å› ä¸ºä» <code>Spring Boot 3.x</code> å¼€å§‹ï¼Œå°±å…¨é¢è¿ç§»åˆ°äº† <code>Jakarta EE 9+</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ <code>javax.*</code> çš„ç±»éƒ½è¿ç§»åˆ° <code>jakarta.*</code> å‘½åç©ºé—´(äº‹åŠ¡ã€JPAã€Servlet ç­‰ API éƒ½å—å½±å“)ï¼Œè€Œ <code>ShardingSphere 5.5</code> ä¸­çš„ XA äº‹åŠ¡ä¸»è¦ä¾èµ– <code>Atomikos</code> æˆ– <code>Narayana</code> ç­‰ç¬¬ä¸‰æ–¹åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†å™¨ï¼Œè¿™äº›åº“ç›®å‰å¤§éƒ¨åˆ†è¿˜æ˜¯åŸºäº <code>javax.transaction.*</code> çš„ APIã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€ ShardingSphere-JDBC ç®€ä»‹ ShardingSphere-JDBC å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚ é€‚ç”¨äºä»»ä½•åŸºäº JDBC çš„ ORM æ¡†æ¶ï¼Œå¦‚ï¼šJPA, Hibernate, Mybatis, Spring JDBC Template æˆ–ç›´æ¥ä½¿ç”¨ JDBCï¼› æ”¯æŒä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, HikariCP ç­‰ï¼› æ”¯æŒä»»æ„å®ç° JDBC è§„èŒƒçš„æ•°æ®åº“ï¼Œç›®å‰æ”¯æŒ MySQLï¼ŒPostgreSQLï¼ŒOracleï¼ŒSQLServer ä»¥åŠä»»ä½•å¯ä½¿ç”¨ JDBC è®¿é—®çš„æ•°æ®åº“ã€‚ ShardingSphere-JDBC ç‹¬ç«‹éƒ¨ç½²æ¶æ„å›¾ mavenä¾èµ– 123456789101112131415161718&lt;!-- æœ¬é¡¹ç›® åŸºäº mysql --&gt;&lt;dependency&gt; &lt;groupId&gt;com.mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- mybatis plusï¼Œæœ¬é¡¹ç›®ç”¨åˆ°ï¼Œéå¿…é¡» --&gt;&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-spring-boot3-starter&lt;/artifactId&gt; &lt;version&gt;3.5.12&lt;/version&gt;&lt;/dependency&gt;&lt;!-- ShardingSphere JDBC ä¸»ä¾èµ–ï¼ˆ5.5.2 å»ºè®®ï¼‰ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;shardingsphere-jdbc&lt;/artifactId&gt; &lt;version&gt;5.5.2&lt;/version&gt;&lt;/dependency&gt; application.yml 12345spring: datasource: driver-class-name: org.apache.shardingsphere.driver.ShardingSphereDriver # æŒ‡å‘ç±»è·¯å¾„ä¸‹çš„ sharding.yamlï¼ˆä¹Ÿå¯ absolute path / file: / http: ç­‰ï¼Œè§å®˜æ–¹è¯´æ˜ï¼‰ url: jdbc:shardingsphere:classpath:sharding.yaml ä¹Ÿå¯ä»¥ä¸åœ¨ application.yml ä¸­é…ç½®ï¼Œè€Œæ˜¯é€šè¿‡ @Configuration åˆ›å»º @Beanï¼Œè¿™æ ·å°±å¯ä»¥é…ç½®å¤šæ•°æ®æºäº†ã€‚ 123456789101112131415@Configurationpublic class DataSourceConfig &#123; @Bean(name = &quot;shardingDataSource&quot;) public DataSource shardingDataSource() throws SQLException, IOException &#123; // ShardingSphere æä¾›çš„å·¥å‚æ–¹æ³•ï¼Œæ ¹æ®é…ç½®æ„å»º DataSource try (InputStream inputStream = getClass().getClassLoader().getResourceAsStream(&quot;sharding.yaml&quot;)) &#123; if (inputStream == null) &#123; throw new IllegalStateException(&quot;Cannot find sharding.yaml in classpath&quot;); &#125; byte[] yamlBytes = inputStream.readAllBytes(); return YamlShardingSphereDataSourceFactory.createDataSource(yamlBytes); &#125; &#125;&#125; sharding.yaml å®Œæ•´é…ç½®ï¼Œä¸‹æ–‡ä¼šä»‹ç»éƒ¨åˆ†é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221# æ•°æ®æºé…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/data-source/dataSources: ds_0: # é€»è¾‘æ•°æ®æºåç§° dataSourceClassName: com.zaxxer.hikari.HikariDataSource driverClassName: com.mysql.cj.jdbc.Driver jdbcUrl: jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd ds_1: dataSourceClassName: com.zaxxer.hikari.HikariDataSource driverClassName: com.mysql.cj.jdbc.Driver jdbcUrl: jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd# åˆ†ç‰‡è§„åˆ™é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/sharding/rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® # ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå‡å°‘å¹¿æ’­,å¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´ bindingTables: - t_order,t_order_item tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® course: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.course_$&#123;1..2&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: course_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: cid shardingAlgorithmName: course_inline keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: cid # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id shardingAlgorithmName: t_order-complex-algorithm keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id # åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”# shardingAlgorithmName: t_order_item-class-based-algorithm # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• shardingAlgorithmName: t_order_item-class-based-algorithm_spi # åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_user: actualDataNodes: ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_inline # åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: id # è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹# keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° keyGeneratorName: custom_snowflake_string # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°# t_address: # æ™®é€šè¡¨ï¼ˆä¸åˆ†åº“åˆ†è¡¨ï¼Œç»‘å®šåˆ° ds_0ï¼‰,æ²¡æœ‰é»˜è®¤çš„æ•°æ®æºé…ç½®ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½è¦æ˜¾ç¤ºå£°æ˜# actualDataNodes: ds_0.t_address # å®é™…æ•°æ®èŠ‚ç‚¹ autoTables: # è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½® t_order: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• https://shardingsphere.apache.org/document/current/cn/dev-manual/sharding/ course_inline: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™ props: # å±æ€§ algorithm-expression: course_$&#123;cid % 2 + 1&#125; # è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2 allow-range-query-with-inline-sharding: true # å…è®¸èŒƒå›´æŸ¥è¯¢ course_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; # è¡¨ç¤º ds_0, ds_1 mod_2: type: MOD # åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³• props: sharding-count: 2 # åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™ t_order_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; t_order-complex-algorithm: type: COMPLEX_INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³• props: algorithm-expression: t_order_complex_$&#123;(user_id + order_id + 1) % 2&#125; t_order_item-class-based-algorithm: type: CLASS_BASED # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• props: strategy: COMPLEX # æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥ algorithmClassName: com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm # æŒ‡å®šç®—æ³•ç±» t_order_item-class-based-algorithm_spi: # SPI type: T_ORDER_ITEM_COMPLEX # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• t_user_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;Math.abs(id.hashCode()%2)&#125; t_user_inline: type: INLINE props: algorithm-expression: t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125; keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/keygen/ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong uuid: # å®šä¹‰åç§° type: UUID # å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString custom_snowflake_string: type: CUSTOM_SNOWFLAKE_STRING # è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒString props: workerId: 2 datacenterId: 2 - !BROADCAST # å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª tables: - dict # å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚ - !ENCRYPT # æ•°æ®åŠ å¯†é…ç½® tables: t_user: # åŠ å¯†è¡¨åç§° columns: password: # åŠ å¯†åˆ—åç§° cipher: name: password # å¯†æ–‡åˆ—åç§° encryptorName: aes_encryptor # å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§° # åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/ encryptors: aes_encryptor: # åŠ è§£å¯†ç®—æ³•åç§° type: AES # åŠ è§£å¯†ç®—æ³•ç±»å‹ props: # åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½® aes-key-value: 123456abc # AES ä½¿ç”¨çš„ KEY digest-algorithm-name: SHA-1 # AES KEY çš„æ‘˜è¦ç®—æ³• md5_encryptor: type: MD5 props: salt: 123456 # ç›å€¼ï¼ˆå¯é€‰ï¼‰ - !MASK # æ•°æ®è„±æ•é…ç½® tables: t_user: # è„±æ•è¡¨åç§° columns: # è„±æ•åˆ—é…ç½® password: # è„±æ•åˆ—åç§° maskAlgorithm: md5_mask # è„±æ•ç®—æ³•åç§° email: maskAlgorithm: mask_before_special_chars_mask telephone: maskAlgorithm: keep_first_n_last_m_mask name: maskAlgorithm: my_mask maskAlgorithms: # è„±æ•ç®—æ³•é…ç½® md5_mask: # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° type: MD5 # è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º mask_before_special_chars_mask: type: MASK_BEFORE_SPECIAL_CHARS # åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com props: special-chars: &#x27;@&#x27; # é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ• replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ keep_first_n_last_m_mask: type: KEEP_FIRST_N_LAST_M # ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678 props: first-n: 3 # ä¿ç•™å‰ 3 ä½ last-m: 4 # ä¿ç•™å 4 ä½ replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ my_mask: type: MY_CUSTOM_MASK # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° props: replace-char: &quot;#&quot; - !SINGLE # å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™ tables: # MySQL é£æ ¼ - ds_0.t_address # åŠ è½½æŒ‡å®šå•è¡¨# - ds_1.* # åŠ è½½æŒ‡å®šæ•°æ®æºä¸­çš„å…¨éƒ¨å•è¡¨# - &quot;*.*&quot; # åŠ è½½å…¨éƒ¨å•è¡¨# å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/props: sql-show: true # æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false check-table-metadata-enabled: false # åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false æ•°æ®æºé…ç½® hikari + mysql 1234567891011121314dataSources: ds_0: # é€»è¾‘æ•°æ®æºåç§° dataSourceClassName: com.zaxxer.hikari.HikariDataSource driverClassName: com.mysql.cj.jdbc.Driver jdbcUrl: jdbc:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd ds_1: dataSourceClassName: com.zaxxer.hikari.HikariDataSource driverClassName: com.mysql.cj.jdbc.Driver jdbcUrl: jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8 username: root password: newpwd druid + mysql 1234567891011121314dataSources: ds_1: dataSourceClassName: com.alibaba.druid.pool.DruidDataSource driverClassName: com.mysql.cj.jdbc.Driver url: jdbc:mysql://127.0.0.1:3306/shardingdb1?useSSL=false&amp;serverTimezone=UTC username: root password: newpwd # Druid ç‰¹æœ‰é…ç½® initialSize: 5 minIdle: 5 maxActive: 20 maxWait: 60000 testWhileIdle: true validationQuery: SELECT 1 FROM DUAL druid + mysql + p6spy 1234567891011121314dataSources: ds_0: # é€»è¾‘æ•°æ®æºåç§° dataSourceClassName: com.alibaba.druid.pool.DruidDataSource driverClassName: com.p6spy.engine.spy.P6SpyDriver url: jdbc:p6spy:mysql://127.0.0.1:3306/shardingdb0?useSSL=false&amp;serverTimezone=UTC username: root password: newpwd # Druid ç‰¹æœ‰é…ç½® initialSize: 5 minIdle: 5 maxActive: 20 maxWait: 60000 testWhileIdle: true validationQuery: SELECT 1 FROM DUAL åˆ†åº“åˆ†è¡¨é…ç½® å•åˆ†ç‰‡é”®ï¼ŒLong ç±»å‹ 12345678910111213141516171819202122232425262728293031rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® course: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.course_$&#123;1..2&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œå»ºè¡¨æ—¶å†™æˆäº† 1å’Œ2ï¼Œæ‡’å¾—æ”¹äº†ï¼Œæ‰€ä»¥ä¸‹é¢åˆ†è¡¨è§„åˆ™ä¸­å¯¹2å–ä½™åè¦+1 databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: course_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: cid shardingAlgorithmName: course_inline keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: cid # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• course_inline: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„åˆ†ç‰‡ç®—æ³•ï¼Œè¿™é‡Œä½¿ç”¨ MOD ä¼šæŠ¥é”™ props: # å±æ€§ algorithm-expression: course_$&#123;cid % 2 + 1&#125; # è¡¨è¾¾å¼ï¼Œè¿™æ˜¯å› ä¸ºè¡¨åç§°ä¸º course_1, course_2 allow-range-query-with-inline-sharding: true # å…è®¸èŒƒå›´æŸ¥è¯¢ course_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; # è¡¨ç¤º ds_0, ds_1 keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ä¸åŒçš„å­—æ®µï¼Œåˆ†åº“ä½¿ç”¨ user_idï¼Œåˆ†è¡¨ä½¿ç”¨ cid allow-range-query-with-inline-sharding: true ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå…è®¸èŒƒå›´æŸ¥è¯¢ï¼Œé»˜è®¤å€¼æ˜¯ falseï¼Œä¸å…è®¸ between æŸ¥è¯¢ å•åˆ†ç‰‡é”®ï¼ŒString ç±»å‹ 123456789101112131415161718192021222324252627282930313233343536rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® t_user: actualDataNodes: ds_$&#123;0..1&#125;.t_user_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ standard: shardingColumn: id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_user_inline # åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: id # è‡ªå¢åˆ—åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹# keyGeneratorName: uuid # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° keyGeneratorName: custom_snowflake_string # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• t_user_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;Math.abs(id.hashCode()%2)&#125; # åˆ†åº“ï¼Œds_0, ds_1ï¼Œid ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬æ¢ä¸ºæ•°å­—å†è¿›è¡Œè¿ç®— t_user_inline: type: INLINE props: algorithm-expression: t_user_$&#123;Math.abs(id.hashCode()%4).intdiv(2)&#125; # åˆ†è¡¨ï¼Œt_user_0, t_user_1 keyGenerators: # åˆ†å¸ƒå¼åºåˆ—ç®—æ³• uuid: # å®šä¹‰åç§° type: UUID # å­—ç¬¦ä¸²ä¸»é”®ï¼ŒString custom_snowflake_string: type: CUSTOM_SNOWFLAKE_STRING # è‡ªå®šä¹‰é›ªèŠ±ç®—æ³•ï¼ŒStringï¼Œspi props: workerId: 2 datacenterId: 2 è¿™é‡Œåˆ†åº“ä¸åˆ†è¡¨é‡‡ç”¨äº†ç›¸åŒçš„å­—æ®µï¼Œå³ä¸»é”®idï¼Œå› å…¶ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ hashCode() è·å–æ•°å­—ï¼Œå†è¿›è¡Œè¿ç®— ä¸»é”®è·å–è§„åˆ™ä½¿ç”¨çš„è‡ªå®šä¹‰çš„é›ªèŠ±ç®—æ³•ï¼Œspiï¼Œè¯¦è§src/main/resources/META-INF/services/org.apache.shardingsphere.infra.algorithm.keygen.core.KeyGenerateAlgorithmï¼Œè¿™é‡Œæ³¨æ„ï¼Œä» 5.5.3 å¼€å§‹ä¼šæ›´æ¢ä¸º org.apache.shardingsphere.infra.algorithm.keygen.spi.KeyGenerateAlgorithm å¤šåˆ†ç‰‡é”®ï¼ŒLong ç±»å‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® tables: # æ‰‹å·¥åˆ†ç‰‡è§„åˆ™é…ç½® t_order_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id shardingAlgorithmName: t_order-complex-algorithm keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item_complex: # é€»è¾‘è¡¨åç§° actualDataNodes: ds_$&#123;0..1&#125;.t_order_item_complex_$&#123;0..1&#125; # å®é™…æ•°æ®èŠ‚ç‚¹ databaseStrategy: # åˆ†åº“ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: t_order_db_inline # åˆ†ç‰‡ç®—æ³•åç§° tableStrategy: # åˆ†è¡¨ç­–ç•¥ complex: # ç”¨äºå¤šåˆ†ç‰‡é”®çš„å¤æ‚åˆ†ç‰‡åœºæ™¯ shardingColumns: user_id,order_id # åˆ†ç‰‡åˆ—åç§°,å¤šä¸ªé€—å·åˆ†éš”# shardingAlgorithmName: t_order_item-class-based-algorithm # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• shardingAlgorithmName: t_order_item-class-based-algorithm_spi # åŸºäº SPI çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ•ˆæœåŒä¸Šï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ SPI keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• t_order_db_inline: type: INLINE props: algorithm-expression: ds_$&#123;user_id % 2&#125; t_order-complex-algorithm: type: COMPLEX_INLINE # åŸºäºè¡Œè¡¨è¾¾å¼çš„å¤åˆåˆ†ç‰‡ç®—æ³• props: algorithm-expression: t_order_complex_$&#123;(user_id + order_id + 1) % 2&#125; t_order_item-class-based-algorithm: type: CLASS_BASED # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• props: strategy: COMPLEX # æŒ‡å®šç­–ç•¥ STANDARD|COMPLEX|HINT ï¼Œå‘Šè¯‰ ShardingSphere åˆ†ç‰‡ç®—æ³•ç±»å®ç°äº†ä»€ä¹ˆç­–ç•¥ algorithmClassName: com.hanqf.demo.support.algorithm.OrderItemComplexAlgorithm # æŒ‡å®šç®—æ³•ç±» t_order_item-class-based-algorithm_spi: # SPI type: T_ORDER_ITEM_COMPLEX # åŸºäºè‡ªå®šä¹‰ç±»çš„åˆ†ç‰‡ç®—æ³• keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong å¤šä¸ªåˆ†ç‰‡é”®ï¼Œt_order_complexè¡¨ä½¿ç”¨äº†å†…ç½®çš„COMPLEX_INLINEç®—æ³•ï¼Œè€Œt_order_item_complexè¡¨ä½¿ç”¨äº†è‡ªå®šä¹‰çš„çš„åˆ†ç‰‡ç®—æ³•ï¼Œspiï¼Œè¯¦è§src/main/resources/META-INF/services/org.apache.shardingsphere.sharding.spi.ShardingAlgorithm è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™ ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯æ‰‹å·¥é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œç”¨äºé…ç½®è¾ƒä¸ºå¤æ‚çš„åˆ†ç‰‡è§„åˆ™ï¼Œå¦‚æœåˆ†ç‰‡è§„åˆ™æ¯”ä»·ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™ 12345678910111213141516171819202122232425262728293031323334rules: - !SHARDING # åˆ†ç‰‡è§„åˆ™é…ç½® # ç»‘å®šè¡¨ï¼šåŒåˆ†ç‰‡é”® join æ—¶èµ°åŒè·¯ç”±ï¼Œå¤šä¸ªé€—å·åˆ†éš”ï¼Œè¦æ±‚åˆ†ç‰‡è§„åˆ™ä¸€è‡´ bindingTables: - t_order,t_order_item autoTables: # è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™é…ç½® t_order: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: order_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° t_order_item: # é€»è¾‘è¡¨åç§° actualDataSources: ds_$&#123;0..1&#125; # æ•°æ®æºåç§° shardingStrategy: # åˆ‡åˆ†ç­–ç•¥ standard: # ç”¨äºå•åˆ†ç‰‡é”®çš„æ ‡å‡†åˆ†ç‰‡åœºæ™¯ shardingColumn: user_id # åˆ†ç‰‡åˆ—åç§° shardingAlgorithmName: mod_2 # è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•åç§° keyGenerateStrategy: # åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥ column: item_id # è‡ªå¢åˆ—åç§° keyGeneratorName: snowflake # åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§° shardingAlgorithms: # åˆ†ç‰‡ç®—æ³• mod_2: type: MOD # åŸºäº MOD çš„åˆ†ç‰‡ç®—æ³• props: sharding-count: 2 # åˆ†ç‰‡æ•°é‡ï¼Œå³ å¯¹ 2 è¿›è¡Œå–ä½™ keyGenerators: # åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ snowflake: # å®šä¹‰åç§°ï¼Œåœ¨ä¸Šé¢å¼•ç”¨ type: SNOWFLAKE # ä½¿ç”¨é›ªèŠ±ç®—æ³•ï¼ŒLong è‡ªåŠ¨åˆ†ç‰‡è§„åˆ™éœ€è¦å£°æ˜æ•°æ®åº“ï¼Œä½†ä¸éœ€è¦å£°æ˜è¡¨åˆ†é…è§„åˆ™ï¼Œå…¶æ ¹æ®åˆ†ç‰‡ç®—æ³•è‡ªåŠ¨ç¡®å®šå…·ä½“çš„æ•°æ®è¡¨ã€‚ åŒæ—¶è¿™é‡Œè¿˜é…ç½®äº†bindingTablesï¼Œç”¨æ¥æŒ‡å®šå…¶åˆ†ç‰‡è·¯ç”±ä¸€è‡´ã€‚ å¹¿æ’­è¡¨é…ç½® å¹¿æ’­è¡¨ï¼Œå³æ‰€æœ‰æ•°æ®æºéƒ½åŒ…å«çš„è¡¨ï¼Œæ¯”å¦‚å­—å…¸è¡¨ 1234rules: - !BROADCAST # å¹¿æ’­è¡¨é…ç½®ï¼Œå³æ‰€æœ‰çš„åº“ä¸­éƒ½åŒ…å«æŒ‡å®šçš„è¡¨ï¼Œå†™å…¥æ•°æ®æ—¶åŒæ—¶å†™å…¥å¤šä¸ªåº“ï¼ŒæŸ¥è¯¢æ—¶éšæœºè¯»ä¸€ä¸ª tables: - dict # å¹¿æ’­è¡¨åç§°ï¼Œâ¼´æ’­è¡¨ä¸èƒ½é…ç½®åˆ†è¡¨é€»è¾‘ï¼Œåªå¾€å¤šä¸ªåº“çš„åŒâ¼€ä¸ªè¡¨ä¸­æ’â¼Šæ•°æ®ã€‚ æ•°æ®åŠ å¯†è§„åˆ™ 1234567891011121314151617181920rules: - !ENCRYPT # æ•°æ®åŠ å¯†é…ç½® tables: t_user: # åŠ å¯†è¡¨åç§° columns: password: # åŠ å¯†åˆ—åç§° cipher: name: password # å¯†æ–‡åˆ—åç§° encryptorName: aes_encryptor # å¯†æ–‡åˆ—åŠ å¯†ç®—æ³•åç§° # åŠ å¯†ç®—æ³•é…ç½®: https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/encrypt/ encryptors: aes_encryptor: # åŠ è§£å¯†ç®—æ³•åç§° type: AES # åŠ è§£å¯†ç®—æ³•ç±»å‹ props: # åŠ è§£å¯†ç®—æ³•å±æ€§é…ç½® aes-key-value: 123456abc # AES ä½¿ç”¨çš„ KEY digest-algorithm-name: SHA-1 # AES KEY çš„æ‘˜è¦ç®—æ³• md5_encryptor: type: MD5 props: salt: 123456 # ç›å€¼ï¼ˆå¯é€‰ï¼‰ é…ç½®åŠ å¯†å­—æ®µè§„åˆ™åï¼Œæ–°å¢æ•°æ®æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¹åŠ å¯†å­—æ®µåŠ å¯†åå­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶ä¹Ÿä¼šåŠ å¯†åè¿›è¡Œæ¯”è¾ƒæŸ¥è¯¢ã€‚ æ•°æ®è„±æ•è§„åˆ™ 1234567891011121314151617181920212223242526272829303132rules: - !MASK # æ•°æ®è„±æ•é…ç½® tables: t_user: # è„±æ•è¡¨åç§° columns: # è„±æ•åˆ—é…ç½® password: # è„±æ•åˆ—åç§° maskAlgorithm: md5_mask # è„±æ•ç®—æ³•åç§° email: maskAlgorithm: mask_before_special_chars_mask telephone: maskAlgorithm: keep_first_n_last_m_mask name: maskAlgorithm: my_mask maskAlgorithms: # è„±æ•ç®—æ³•é…ç½® md5_mask: # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° type: MD5 # è„±æ•ç®—æ³•ç±»å‹ï¼Œmd5åŠ å¯†åå±•ç¤º mask_before_special_chars_mask: type: MASK_BEFORE_SPECIAL_CHARS # åœ¨ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚é‚®ç®±é‡Œçš„ @ï¼‰å‰é¢åšè„±æ•ï¼Œç¤ºä¾‹ï¼šmyemail@example.com â†’ *******@example.com props: special-chars: &#x27;@&#x27; # é‡åˆ° @ ä¹‹å‰çš„éƒ¨åˆ†åšè„±æ• replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ keep_first_n_last_m_mask: type: KEEP_FIRST_N_LAST_M # ä¿ç•™å‰ n ä½å’Œå m ä½ï¼Œå…¶ä½™ç”¨æ›¿æ¢å­—ç¬¦å¡«å……ï¼Œç¤ºä¾‹ï¼š13812345678 â†’ 138****5678 props: first-n: 3 # ä¿ç•™å‰ 3 ä½ last-m: 4 # ä¿ç•™å 4 ä½ replace-char: &#x27;*&#x27; # è„±æ•å­—ç¬¦ç”¨ * ä»£æ›¿ my_mask: type: MY_CUSTOM_MASK # è‡ªå®šä¹‰è„±æ•ç®—æ³•åç§° props: replace-char: &quot;#&quot; è¢«è„±æ•çš„å­—æ®µåœ¨æŸ¥è¯¢æ—¶ä¼šè¿›è¡Œè„±æ•å±•ç¤ºã€‚ è¿™é‡Œè¿˜è‡ªå®šä¹‰äº†è„±æ•ç®—æ³•ï¼Œspiï¼Œè¯¦è§src/main/resources/META-INF/services/org.apache.shardingsphere.mask.spi.MaskAlgorithm å•è¡¨è§„åˆ™ å³ä¸éœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨çš„è¡¨ 12345rules: - !SINGLE # å•è¡¨è§„åˆ™é…ç½®ï¼Œå•è¡¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºåˆ†åº“åˆ†è¡¨è§„åˆ™ tables: # MySQL é£æ ¼ - ds_0.t_address # åŠ è½½æŒ‡å®šå•è¡¨ å±æ€§é…ç½® 1234# å±æ€§é…ç½®ï¼šhttps://shardingsphere.apache.org/document/current/cn/user-manual/common-config/props/props: sql-show: true # æ§åˆ¶å°æ‰“å°æ”¹å†™åçš„ SQLï¼Œä¾¿äºæ’é”™ï¼Œé»˜è®¤ä¸º false check-table-metadata-enabled: false # åœ¨ç¨‹åºå¯åŠ¨å’Œæ›´æ–°æ—¶ï¼Œæ˜¯å¦æ£€æŸ¥åˆ†ç‰‡å…ƒæ•°æ®çš„ç»“æ„ä¸€è‡´æ€§ï¼Œé»˜è®¤ä¸º false äº‹åŠ¡é…ç½® 123# https://shardingsphere.apache.org/document/5.5.2/cn/user-manual/shardingsphere-jdbc/yaml-config/rules/transaction/transaction: defaultType: LOCAL # é»˜è®¤äº‹åŠ¡ç±»å‹å°±æ˜¯ LOCAL åè®° springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ä¸ springboot2 ä¸åŒï¼Œä¸å†æä¾› springboot-starter-shardingsphereï¼Œç›¸å…³é…ç½®ä¹Ÿé‡‡ç”¨äº†ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ã€‚ ä»£ç ä¸­åŒ…å«ä¸¤ä¸ªåº“ä¸­ä½¿ç”¨åˆ°çš„æ•°æ®åº“è„šæœ¬ï¼Œshardingsphere-demo/shardingsphere-demo-01/sql å…·ä½“ä½¿ç”¨æ•ˆæœå¯ä»¥é€šè¿‡é¡¹ç›®ä¸­æä¾›çš„å•å…ƒæµ‹è¯•ç±»è¿›è¡ŒéªŒè¯ã€‚ springboot3 é›†æˆ shardingsphere-JDBC5.5.2 ç›®å‰å°šä¸æ”¯æŒ XA åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè¿™æ˜¯å› ä¸ºä» Spring Boot 3.x å¼€å§‹ï¼Œå°±å…¨é¢è¿ç§»åˆ°äº† Jakarta EE 9+ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ javax.* çš„ç±»éƒ½è¿ç§»åˆ° jakarta.* å‘½åç©ºé—´(äº‹åŠ¡ã€JPAã€Servlet ç­‰ API éƒ½å—å½±å“)ï¼Œè€Œ ShardingSphere 5.5 ä¸­çš„ XA äº‹åŠ¡ä¸»è¦ä¾èµ– Atomikos æˆ– Narayana ç­‰ç¬¬ä¸‰æ–¹åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†å™¨ï¼Œè¿™äº›åº“ç›®å‰å¤§éƒ¨åˆ†è¿˜æ˜¯åŸºäº javax.transaction.* çš„ APIã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» SpringBoot3.5.5 + ShardingSphere-JDBC5.5.2 åˆ†åº“åˆ†è¡¨çš„ä½¿ç”¨ã€‚ ShardingSphereå®˜ç½‘ æœ¬æ–‡é¡¹ç›®ä»£ç Githubåœ°å€","date_published":"2025-09-01T13:30:05.000Z","tags":["æŠ€æœ¯","springboot","sharding-sphere","springboot","sharding-sphere"]},{"id":"https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/","url":"https://blog.hanqunfeng.com/2025/07/25/k8s-ui-rancher/","title":"K8S UI ä¹‹ Rancher","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://ranchermanager.docs.rancher.com/zh/\">Rancher å®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/rancher/rancher\">Rancher Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Rancher-ç®€ä»‹\">Rancher ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Rancher æ˜¯ä¸€ä¸ª å¼€æºçš„ Kubernetes ç®¡ç†å¹³å°ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·éƒ¨ç½²ã€ç®¡ç†å’Œè¿ç»´å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œå…·æœ‰æ˜“ç”¨çš„ Web UIã€æƒé™æ§åˆ¶ã€é›†ç¾¤ç›‘æ§ã€åº”ç”¨ç®¡ç†ç­‰åŠŸèƒ½ï¼Œå¹¿æ³›åº”ç”¨äºä¼ä¸šçš„äº‘åŸç”Ÿå¹³å°å»ºè®¾ä¸­ã€‚</p>\n</li>\n</ul>\n<h2 id=\"éƒ¨ç½²-Rancher\">éƒ¨ç½² Rancher</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://ranchermanager.docs.rancher.com/zh/getting-started/quick-start-guides/deploy-rancher-manager/helm-cli#%E4%BD%BF%E7%94%A8-helm-%E6%9D%A5%E5%AE%89%E8%A3%85-rancher\">ä½¿ç”¨ Helm å®‰è£… Rancher</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ  rancher çš„ Helm ä»“åº“</span></span><br><span class=\"line\">helm repo add rancher-latest https://releases.rancher.com/server-charts/latest</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–° rancher çš„ Helm ä»“åº“</span></span><br><span class=\"line\">helm repo update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ rancher çš„ç‰ˆæœ¬</span></span><br><span class=\"line\">$ helm search repo rancher -l | <span class=\"built_in\">head</span></span><br><span class=\"line\">NAME                  \tCHART VERSION\tAPP VERSION\tDESCRIPTION</span><br><span class=\"line\">rancher-latest/rancher\t2.11.3       \tv2.11.3    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.11.2       \tv2.11.2    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.11.1       \tv2.11.1    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.11.0       \tv2.11.0    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.3       \tv2.10.3    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.2       \tv2.10.2    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.1       \tv2.10.1    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.10.0       \tv2.10.0    \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\">rancher-latest/rancher\t2.9.3        \tv2.9.3     \tInstall Rancher Server to manage Kubernetes clu...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class=\"line\">kubectl create namespace cattle-system</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºè¯ä¹¦ï¼Œè¯ä¹¦æ˜¯æœºæ„é¢å‘çš„</span></span><br><span class=\"line\">kubectl create secret tls tls-rancher-ingress \\</span><br><span class=\"line\">  --key=nginx_ssl/nginx.hanqunfeng.com.key \\</span><br><span class=\"line\">  --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\</span><br><span class=\"line\">  -n cattle-system</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… Rancher  --version v2.11.3 å¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼Œé»˜è®¤æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">helm install rancher rancher-latest/rancher \\</span><br><span class=\"line\">  --namespace cattle-system \\</span><br><span class=\"line\">  --create-namespace \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> hostname=rancher.hanqunfeng.com \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> ingress.tls.source=secret \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> replicas=3 \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> bootstrapPassword=rancher#2025</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å‚æ•°è¯´æ˜</span></span><br><span class=\"line\"><span class=\"comment\"># --set hostname=rancher.hanqunfeng.com è®¾ç½® rancher çš„åŸŸå</span></span><br><span class=\"line\"><span class=\"comment\"># --set ingress.tls.source=secret é…ç½® rancher çš„è¯ä¹¦ï¼Œåç§°ä¸º tls-rancher-ingress</span></span><br><span class=\"line\"><span class=\"comment\"># --set replicas=3 è®¾ç½® rancher çš„å‰¯æœ¬æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># --set bootstrapPassword=rancher#2025 è®¾ç½® rancher çš„åˆå§‹å¯†ç </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## ä¸è¿‡æ‰§è¡Œä¸Šé¢çš„å®‰è£…å‘½ä»¤ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯å½“å‰çš„ rancher ç‰ˆæœ¬ä¸æ”¯æŒ Kubernetes v1.33.2</span></span><br><span class=\"line\">Error: INSTALLATION FAILED: chart requires kubeVersion: &lt; 1.33.0-0 <span class=\"built_in\">which</span> is incompatible with Kubernetes v1.33.2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è§£å†³åŠæ³•</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸‹è½½å¹¶è§£å‹ rancher å®‰è£…åŒ…</span></span><br><span class=\"line\">helm pull rancher-latest/rancher --untar --untardir ./</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å…¶ä¸­çš„ Chart.yaml æ–‡ä»¶</span></span><br><span class=\"line\">kubeVersion: &lt; 1.33.0-0 ==&gt; kubeVersion: &lt; 1.34.0-0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… rancher</span></span><br><span class=\"line\">helm install rancher rancher \\</span><br><span class=\"line\">  --namespace cattle-system \\</span><br><span class=\"line\">  --create-namespace \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> hostname=rancher.hanqunfeng.com \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> ingress.tls.source=secret \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> replicas=3 \\</span><br><span class=\"line\">  --<span class=\"built_in\">set</span> bootstrapPassword=rancher#2025</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">NAME: rancher</span><br><span class=\"line\">LAST DEPLOYED: Thu Jul 24 23:55:24 2025</span><br><span class=\"line\">NAMESPACE: cattle-system</span><br><span class=\"line\">STATUS: deployed</span><br><span class=\"line\">REVISION: 1</span><br><span class=\"line\">TEST SUITE: None</span><br><span class=\"line\">NOTES:</span><br><span class=\"line\">Rancher Server has been installed.</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: Rancher may take several minutes to fully initialize. Please standby <span class=\"keyword\">while</span> Certificates are being issued, Containers are started and the Ingress rule comes up.</span><br><span class=\"line\"></span><br><span class=\"line\">Check out our docs at https://rancher.com/docs/</span><br><span class=\"line\"></span><br><span class=\"line\">If you provided your own bootstrap password during installation, browse to https://rancher.hanqunfeng.com to get started.</span><br><span class=\"line\"></span><br><span class=\"line\">If this is the first time you installed Rancher, get started by running this <span class=\"built_in\">command</span> and clicking the URL it generates:</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> https://rancher.hanqunfeng.com/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class=\"string\">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">To get just the bootstrap password on its own, run:</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class=\"string\">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123; &quot;\\n&quot; &#125;&#125;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Happy Containering!</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹åˆ›å»ºçš„èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get all,ing -n cattle-system</span><br><span class=\"line\">NAME                                   READY   STATUS      RESTARTS   AGE</span><br><span class=\"line\">pod/helm-operation-8257k               0/2     Completed   0          11m</span><br><span class=\"line\">pod/helm-operation-g8blp               0/2     Completed   0          12m</span><br><span class=\"line\">pod/helm-operation-hwpbp               0/2     Completed   0          10m</span><br><span class=\"line\">pod/helm-operation-qbs5n               0/2     Completed   0          10m</span><br><span class=\"line\">pod/helm-operation-wlptb               0/2     Completed   0          13m</span><br><span class=\"line\">pod/rancher-56689b7d8c-v7hpd           1/1     Running     0          21m</span><br><span class=\"line\">pod/rancher-56689b7d8c-xnrbf           1/1     Running     0          21m</span><br><span class=\"line\">pod/rancher-56689b7d8c-xvqgs           1/1     Running     0          21m</span><br><span class=\"line\">pod/rancher-webhook-5fd5fc44f9-8xwjk   1/1     Running     0          11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE</span><br><span class=\"line\">service/imperative-api-extension   ClusterIP   10.96.188.28   &lt;none&gt;        6666/TCP         15m</span><br><span class=\"line\">service/rancher                    ClusterIP   10.96.21.41    &lt;none&gt;        80/TCP,443/TCP   21m</span><br><span class=\"line\">service/rancher-webhook            ClusterIP   10.96.85.153   &lt;none&gt;        443/TCP          11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                              READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/rancher           3/3     3            3           21m</span><br><span class=\"line\">deployment.apps/rancher-webhook   1/1     1            1           11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                         DESIRED   CURRENT   READY   AGE</span><br><span class=\"line\">replicaset.apps/rancher-56689b7d8c           3         3         3       21m</span><br><span class=\"line\">replicaset.apps/rancher-webhook-5fd5fc44f9   1         1         1       11m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                CLASS   HOSTS                    ADDRESS         PORTS     AGE</span><br><span class=\"line\">ingress.networking.k8s.io/rancher   nginx   rancher.hanqunfeng.com   10.211.55.201   80, 443   21m</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµè§ˆå™¨è®¿é—®ï¼š<a href=\"https://rancher.hanqunfeng.com\">https://rancher.hanqunfeng.com</a>ï¼Œè¾“å…¥ä¸Šé¢è®¾ç½®çš„å¯†ç å³å¯ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœå¿˜è®°åˆå§‹å¯†ç å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯†ç </span></span><br><span class=\"line\">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class=\"string\">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123;&quot;\\n&quot;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/rHDDMN.png\" alt=\"\"></p>\n<h2 id=\"å¸è½½-Rancher\">å¸è½½ Rancher</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¸è½½ Rancher</span></span><br><span class=\"line\">helm uninstall rancher -n cattle-system</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ cattle-system å‘½åç©ºé—´</span></span><br><span class=\"line\">kubectl delete namespace cattle-system</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Rancher å®˜ç½‘ Rancher Github Rancher ç®€ä»‹ Rancher æ˜¯ä¸€ä¸ª å¼€æºçš„ Kubernetes ç®¡ç†å¹³å°ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·éƒ¨ç½²ã€ç®¡ç†å’Œè¿ç»´å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œå…·æœ‰æ˜“ç”¨çš„ Web UIã€æƒé™æ§åˆ¶ã€é›†ç¾¤ç›‘æ§ã€åº”ç”¨ç®¡ç†ç­‰åŠŸèƒ½ï¼Œå¹¿æ³›åº”ç”¨äºä¼ä¸šçš„äº‘åŸç”Ÿå¹³å°å»ºè®¾ä¸­ã€‚ éƒ¨ç½² Rancher ä½¿ç”¨ Helm å®‰è£… Rancher 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788# æ·»åŠ  rancher çš„ Helm ä»“åº“helm repo add rancher-latest https://releases.rancher.com/server-charts/latest# æ›´æ–° rancher çš„ Helm ä»“åº“helm repo update# æŸ¥çœ‹ rancher çš„ç‰ˆæœ¬$ helm search repo rancher -l | headNAME CHART VERSION APP VERSION DESCRIPTIONrancher-latest/rancher 2.11.3 v2.11.3 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.11.2 v2.11.2 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.11.1 v2.11.1 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.11.0 v2.11.0 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.3 v2.10.3 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.2 v2.10.2 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.1 v2.10.1 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.10.0 v2.10.0 Install Rancher Server to manage Kubernetes clu...rancher-latest/rancher 2.9.3 v2.9.3 Install Rancher Server to manage Kubernetes clu...# åˆ›å»ºå‘½åç©ºé—´kubectl create namespace cattle-system# åˆ›å»ºè¯ä¹¦ï¼Œè¯ä¹¦æ˜¯æœºæ„é¢å‘çš„kubectl create secret tls tls-rancher-ingress \\ --key=nginx_ssl/nginx.hanqunfeng.com.key \\ --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\ -n cattle-system# å®‰è£… Rancher --version v2.11.3 å¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼Œé»˜è®¤æœ€æ–°ç‰ˆhelm install rancher rancher-latest/rancher \\ --namespace cattle-system \\ --create-namespace \\ --set hostname=rancher.hanqunfeng.com \\ --set ingress.tls.source=secret \\ --set replicas=3 \\ --set bootstrapPassword=rancher#2025## å‚æ•°è¯´æ˜# --set hostname=rancher.hanqunfeng.com è®¾ç½® rancher çš„åŸŸå# --set ingress.tls.source=secret é…ç½® rancher çš„è¯ä¹¦ï¼Œåç§°ä¸º tls-rancher-ingress# --set replicas=3 è®¾ç½® rancher çš„å‰¯æœ¬æ•°# --set bootstrapPassword=rancher#2025 è®¾ç½® rancher çš„åˆå§‹å¯†ç ## ä¸è¿‡æ‰§è¡Œä¸Šé¢çš„å®‰è£…å‘½ä»¤ä¼šæŠ¥é”™ï¼Œåº”è¯¥æ˜¯å½“å‰çš„ rancher ç‰ˆæœ¬ä¸æ”¯æŒ Kubernetes v1.33.2Error: INSTALLATION FAILED: chart requires kubeVersion: &lt; 1.33.0-0 which is incompatible with Kubernetes v1.33.2## è§£å†³åŠæ³•# ä¸‹è½½å¹¶è§£å‹ rancher å®‰è£…åŒ…helm pull rancher-latest/rancher --untar --untardir ./# ä¿®æ”¹å…¶ä¸­çš„ Chart.yaml æ–‡ä»¶kubeVersion: &lt; 1.33.0-0 ==&gt; kubeVersion: &lt; 1.34.0-0# å®‰è£… rancherhelm install rancher rancher \\ --namespace cattle-system \\ --create-namespace \\ --set hostname=rancher.hanqunfeng.com \\ --set ingress.tls.source=secret \\ --set replicas=3 \\ --set bootstrapPassword=rancher#2025## è¾“å‡ºNAME: rancherLAST DEPLOYED: Thu Jul 24 23:55:24 2025NAMESPACE: cattle-systemSTATUS: deployedREVISION: 1TEST SUITE: NoneNOTES:Rancher Server has been installed.NOTE: Rancher may take several minutes to fully initialize. Please standby while Certificates are being issued, Containers are started and the Ingress rule comes up.Check out our docs at https://rancher.com/docs/If you provided your own bootstrap password during installation, browse to https://rancher.hanqunfeng.com to get started.If this is the first time you installed Rancher, get started by running this command and clicking the URL it generates:echo https://rancher.hanqunfeng.com/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#x27;)To get just the bootstrap password on its own, run:kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123; &quot;\\n&quot; &#125;&#125;&#x27;Happy Containering! æŸ¥çœ‹åˆ›å»ºçš„èµ„æº 123456789101112131415161718192021222324252627$ k get all,ing -n cattle-systemNAME READY STATUS RESTARTS AGEpod/helm-operation-8257k 0/2 Completed 0 11mpod/helm-operation-g8blp 0/2 Completed 0 12mpod/helm-operation-hwpbp 0/2 Completed 0 10mpod/helm-operation-qbs5n 0/2 Completed 0 10mpod/helm-operation-wlptb 0/2 Completed 0 13mpod/rancher-56689b7d8c-v7hpd 1/1 Running 0 21mpod/rancher-56689b7d8c-xnrbf 1/1 Running 0 21mpod/rancher-56689b7d8c-xvqgs 1/1 Running 0 21mpod/rancher-webhook-5fd5fc44f9-8xwjk 1/1 Running 0 11mNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/imperative-api-extension ClusterIP 10.96.188.28 &lt;none&gt; 6666/TCP 15mservice/rancher ClusterIP 10.96.21.41 &lt;none&gt; 80/TCP,443/TCP 21mservice/rancher-webhook ClusterIP 10.96.85.153 &lt;none&gt; 443/TCP 11mNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/rancher 3/3 3 3 21mdeployment.apps/rancher-webhook 1/1 1 1 11mNAME DESIRED CURRENT READY AGEreplicaset.apps/rancher-56689b7d8c 3 3 3 21mreplicaset.apps/rancher-webhook-5fd5fc44f9 1 1 1 11mNAME CLASS HOSTS ADDRESS PORTS AGEingress.networking.k8s.io/rancher nginx rancher.hanqunfeng.com 10.211.55.201 80, 443 21m æµè§ˆå™¨è®¿é—®ï¼šhttps://rancher.hanqunfeng.comï¼Œè¾“å…¥ä¸Šé¢è®¾ç½®çš„å¯†ç å³å¯ã€‚ 12# å¦‚æœå¿˜è®°åˆå§‹å¯†ç å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å¯†ç kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123;&quot;\\n&quot;&#125;&#125;&#x27; å¸è½½ Rancher 1234# å¸è½½ Rancherhelm uninstall rancher -n cattle-system# åˆ é™¤ cattle-system å‘½åç©ºé—´kubectl delete namespace cattle-system","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Rancher ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Rancher å®˜ç½‘ Rancher Github","date_published":"2025-07-25T14:33:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-kubesphere/","title":"K8S UI ä¹‹ Kubesphere","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubesphere.io/zh/\">Kubesphere å®˜ç½‘</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Kubesphere-ç®€ä»‹\">Kubesphere ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>KubeSphere æ˜¯ä¸€ä¸ªåŸºäº Kubernetes æ„å»ºçš„ ä¼ä¸šçº§å¤šç§Ÿæˆ·å®¹å™¨ç®¡ç†å¹³å°ï¼Œæä¾›äº†ä¸€å¥—å®Œæ•´çš„å®¹å™¨å¹³å°è§£å†³æ–¹æ¡ˆï¼Œè®©ç”¨æˆ·ä»¥å›¾å½¢åŒ–æ–¹å¼è½»æ¾ä½¿ç”¨ Kubernetes å’Œ DevOps èƒ½åŠ›ï¼Œä¸éœ€è¦æ·±å…¥ç†è§£å¤æ‚çš„åº•å±‚æ¶æ„ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ K8S çš„ Dashboard ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŠŸèƒ½ / ç‰¹æ€§</th>\n<th>Kubernetes Dashboard</th>\n<th><strong>KubeSphere</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>âœ… åŸºç¡€èµ„æºç®¡ç†</td>\n<td>âœ… æ”¯æŒ</td>\n<td>âœ… æ›´ä¸°å¯Œï¼Œæ”¯æŒæ›´å¤šç»†ç²’åº¦æ§åˆ¶</td>\n</tr>\n<tr>\n<td>ğŸ‘¥ å¤šç§Ÿæˆ·æ”¯æŒ</td>\n<td>âŒ æ— </td>\n<td>âœ… å†…å»ºä¼ä¸šçº§å¤šç§Ÿæˆ·ã€ç©ºé—´ï¼ˆWorkspaceï¼‰éš”ç¦»</td>\n</tr>\n<tr>\n<td>ğŸ” èº«ä»½è®¤è¯ä¸æƒé™æ§åˆ¶</td>\n<td>âš ï¸ éœ€æ‰‹åŠ¨æ•´åˆ RBAC</td>\n<td>âœ… å†…å»ºç”¨æˆ·ç®¡ç†ã€è§’è‰²ã€å›¢é˜Ÿã€ä¼ä¸šç»„ç»‡æ¶æ„</td>\n</tr>\n<tr>\n<td>ğŸŒ å¤šé›†ç¾¤æ”¯æŒ</td>\n<td>âŒ ä¸æ”¯æŒ</td>\n<td>âœ… æ”¯æŒè·¨åŒºåŸŸå¤šé›†ç¾¤ç»Ÿä¸€ç®¡ç†</td>\n</tr>\n<tr>\n<td>ğŸš€ DevOpsï¼ˆCI/CD æµæ°´çº¿ï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å†…ç½®å›¾å½¢åŒ–æµæ°´çº¿ï¼ˆJenkins é©±åŠ¨ï¼‰</td>\n</tr>\n<tr>\n<td>ğŸ“Š ç›‘æ§ä¸æŒ‡æ ‡ï¼ˆPrometheusï¼‰</td>\n<td>âŒ æ‰‹åŠ¨å®‰è£…</td>\n<td>âœ… å†…ç½®ï¼Œå›¾å½¢åŒ–å±•ç¤º Pod/Node/æœåŠ¡ç­‰ç›‘æ§æ•°æ®</td>\n</tr>\n<tr>\n<td>ğŸ“ æ—¥å¿—æŸ¥è¯¢ä¸åˆ†æï¼ˆEFKï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å†…å»º Fluent Bit + Elasticsearch + Kibana</td>\n</tr>\n<tr>\n<td>ğŸ’¡ å¾®æœåŠ¡æ²»ç†ï¼ˆIstioï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å¯é€‰å¯ç”¨ï¼Œæ”¯æŒæœåŠ¡æ‹“æ‰‘ã€ç°åº¦å‘å¸ƒã€æµé‡æ²»ç†ç­‰</td>\n</tr>\n<tr>\n<td>ğŸ§° åº”ç”¨å•†åº—ï¼ˆHelm å¯è§†åŒ–éƒ¨ç½²ï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… æ”¯æŒ Helm åº”ç”¨å¸‚åœºï¼Œç‚¹å‡»å³å¯å®‰è£…å¸¸è§ä¸­é—´ä»¶</td>\n</tr>\n<tr>\n<td>ğŸ”Œ æ’ä»¶æ¶æ„</td>\n<td>âŒ æ— </td>\n<td>âœ… æ”¯æŒæ¨¡å—æŒ‰éœ€å¯ç”¨/å…³é—­</td>\n</tr>\n<tr>\n<td>ğŸ§ª å®¹å™¨é•œåƒä»“åº“ï¼ˆHarborï¼‰</td>\n<td>âŒ æ— </td>\n<td>âœ… å¯é›†æˆæˆ–å†…å»º Harbor å®¹å™¨ä»“åº“</td>\n</tr>\n<tr>\n<td>ğŸ“¦ å®‰è£…å¤æ‚åº¦</td>\n<td>âœ… ç®€å•</td>\n<td>âš ï¸ ç•¥å¤æ‚ï¼Œä½†å¯æŒ‰éœ€å¯ç”¨æ¨¡å—</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"éƒ¨ç½²-Kubesphere\">éƒ¨ç½² Kubesphere</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubesphere å¯¹ç³»ç»Ÿèµ„æºæœ‰æœ€ä½è¦æ±‚ï¼Œå…·ä½“å‚è€ƒ<a href=\"https://kubesphere.io/zh/docs/v4.1/03-installation-and-upgrade/01-preparations/01-supported-k8s/\">å®˜ç½‘:ç¯å¢ƒè¦æ±‚</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>éƒ¨ç½²</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœæ— æ³•è®¿é—® charts.kubesphere.io, å¯å°† charts.kubesphere.io æ›¿æ¢ä¸º charts.kubesphere.com.cn</span></span><br><span class=\"line\">helm upgrade --install -n kubesphere-system --create-namespace ks-core https://charts.kubesphere.io/main/ks-core-1.1.4.tgz --debug --<span class=\"built_in\">wait</span></span><br><span class=\"line\"><span class=\"comment\">## å®‰è£…æˆåŠŸåä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</span></span><br><span class=\"line\">NOTES:</span><br><span class=\"line\">Thank you <span class=\"keyword\">for</span> choosing KubeSphere Helm Chart.</span><br><span class=\"line\"></span><br><span class=\"line\">Please be patient and <span class=\"built_in\">wait</span> <span class=\"keyword\">for</span> several seconds <span class=\"keyword\">for</span> the KubeSphere deployment to complete.</span><br><span class=\"line\"></span><br><span class=\"line\">1. Wait <span class=\"keyword\">for</span> Deployment Completion</span><br><span class=\"line\"></span><br><span class=\"line\">    Confirm that all KubeSphere components are running by executing the following <span class=\"built_in\">command</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    kubectl get pods -n kubesphere-system</span><br><span class=\"line\">2. Access the KubeSphere Console</span><br><span class=\"line\"></span><br><span class=\"line\">    Once the deployment is complete, you can access the KubeSphere console using the following URL:</span><br><span class=\"line\"></span><br><span class=\"line\">    http://10.211.55.11:30880</span><br><span class=\"line\"></span><br><span class=\"line\">3. Login to KubeSphere Console</span><br><span class=\"line\"></span><br><span class=\"line\">    Use the following credentials to <span class=\"built_in\">log</span> <span class=\"keyword\">in</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    Account: admin</span><br><span class=\"line\">    Password: P@88w0rd</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: It is highly recommended to change the default password immediately after the first login.</span><br><span class=\"line\">For additional information and details, please visit https://kubesphere.io.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶</span></span><br><span class=\"line\">$ kubectl get pod,deploy,svc -n kubesphere-system</span><br><span class=\"line\">NAME                                         READY   STATUS    RESTARTS       AGE</span><br><span class=\"line\">pod/extensions-museum-ffd8bd9d8-fvcw4        1/1     Running   1 (28m ago)    5h5m</span><br><span class=\"line\">pod/ks-apiserver-7b4479d5f5-2k4c9            1/1     Running   2 (27m ago)    5h5m</span><br><span class=\"line\">pod/ks-console-6bd9b9f5d9-xqlzs              1/1     Running   0              26m</span><br><span class=\"line\">pod/ks-controller-manager-547f9fc8c9-5b88z   1/1     Running   10 (27m ago)   5h5m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/extensions-museum       1/1     1            1           5h14m</span><br><span class=\"line\">deployment.apps/ks-apiserver            1/1     1            1           5h14m</span><br><span class=\"line\">deployment.apps/ks-console              1/1     1            1           5h14m</span><br><span class=\"line\">deployment.apps/ks-controller-manager   1/1     1            1           5h14m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span><br><span class=\"line\">service/extensions-museum       ClusterIP   10.96.95.71    &lt;none&gt;        443/TCP        5h14m</span><br><span class=\"line\">service/ks-apiserver            ClusterIP   10.96.12.106   &lt;none&gt;        80/TCP         5h14m</span><br><span class=\"line\">service/ks-console              NodePort    10.96.55.165   &lt;none&gt;        80:30880/TCP   5h14m</span><br><span class=\"line\">service/ks-controller-manager   ClusterIP   10.96.13.243   &lt;none&gt;        443/TCP        5h14m</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµè§ˆå™¨è®¿é—®ï¼š<a href=\"http://10.211.55.11:30880\">http://10.211.55.11:30880</a>ï¼Œè¾“å…¥è´¦å·å¯†ç ï¼šadmin/P@88w0rdï¼Œé¦–æ¬¡ç™»å½•éœ€è¦ä¿®æ”¹å¯†ç ã€‚</p>\n</li>\n</ul>\n<h2 id=\"é…ç½®-ingress\">é…ç½® ingress</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºè¯ä¹¦</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create secret tls nginx-tls \\</span><br><span class=\"line\">    --key=nginx_ssl/nginx.hanqunfeng.com.key \\</span><br><span class=\"line\">    --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\</span><br><span class=\"line\">    -n kubesphere-system</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º ingress</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># kubesphere-ingress.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Ingress</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kubesphere-nginx</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">nginx.ingress.kubernetes.io/force-ssl-redirect:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ingressClassName:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">tls:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">kubesphere.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">secretName:</span> <span class=\"string\">nginx-tls</span></span><br><span class=\"line\">  <span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">host:</span> <span class=\"string\">kubesphere.hanqunfeng.com</span></span><br><span class=\"line\">    <span class=\"attr\">http:</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">pathType:</span> <span class=\"string\">Prefix</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/</span></span><br><span class=\"line\">        <span class=\"attr\">backend:</span></span><br><span class=\"line\">          <span class=\"attr\">service:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">ks-console</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span></span><br><span class=\"line\">              <span class=\"attr\">number:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸è½½-Kubesphere\">å¸è½½ Kubesphere</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm uninstall ks-core -n kubesphere-system</span><br><span class=\"line\">kubectl delete namespace kubesphere-system</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Kubesphere å®˜ç½‘ Kubesphere ç®€ä»‹ KubeSphere æ˜¯ä¸€ä¸ªåŸºäº Kubernetes æ„å»ºçš„ ä¼ä¸šçº§å¤šç§Ÿæˆ·å®¹å™¨ç®¡ç†å¹³å°ï¼Œæä¾›äº†ä¸€å¥—å®Œæ•´çš„å®¹å™¨å¹³å°è§£å†³æ–¹æ¡ˆï¼Œè®©ç”¨æˆ·ä»¥å›¾å½¢åŒ–æ–¹å¼è½»æ¾ä½¿ç”¨ Kubernetes å’Œ DevOps èƒ½åŠ›ï¼Œä¸éœ€è¦æ·±å…¥ç†è§£å¤æ‚çš„åº•å±‚æ¶æ„ã€‚ ä¸ K8S çš„ Dashboard ç›¸æ¯”å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š åŠŸèƒ½ / ç‰¹æ€§ Kubernetes Dashboard KubeSphere âœ… åŸºç¡€èµ„æºç®¡ç† âœ… æ”¯æŒ âœ… æ›´ä¸°å¯Œï¼Œæ”¯æŒæ›´å¤šç»†ç²’åº¦æ§åˆ¶ ğŸ‘¥ å¤šç§Ÿæˆ·æ”¯æŒ âŒ æ—  âœ… å†…å»ºä¼ä¸šçº§å¤šç§Ÿæˆ·ã€ç©ºé—´ï¼ˆWorkspaceï¼‰éš”ç¦» ğŸ” èº«ä»½è®¤è¯ä¸æƒé™æ§åˆ¶ âš ï¸ éœ€æ‰‹åŠ¨æ•´åˆ RBAC âœ… å†…å»ºç”¨æˆ·ç®¡ç†ã€è§’è‰²ã€å›¢é˜Ÿã€ä¼ä¸šç»„ç»‡æ¶æ„ ğŸŒ å¤šé›†ç¾¤æ”¯æŒ âŒ ä¸æ”¯æŒ âœ… æ”¯æŒè·¨åŒºåŸŸå¤šé›†ç¾¤ç»Ÿä¸€ç®¡ç† ğŸš€ DevOpsï¼ˆCI/CD æµæ°´çº¿ï¼‰ âŒ æ—  âœ… å†…ç½®å›¾å½¢åŒ–æµæ°´çº¿ï¼ˆJenkins é©±åŠ¨ï¼‰ ğŸ“Š ç›‘æ§ä¸æŒ‡æ ‡ï¼ˆPrometheusï¼‰ âŒ æ‰‹åŠ¨å®‰è£… âœ… å†…ç½®ï¼Œå›¾å½¢åŒ–å±•ç¤º Pod/Node/æœåŠ¡ç­‰ç›‘æ§æ•°æ® ğŸ“ æ—¥å¿—æŸ¥è¯¢ä¸åˆ†æï¼ˆEFKï¼‰ âŒ æ—  âœ… å†…å»º Fluent Bit + Elasticsearch + Kibana ğŸ’¡ å¾®æœåŠ¡æ²»ç†ï¼ˆIstioï¼‰ âŒ æ—  âœ… å¯é€‰å¯ç”¨ï¼Œæ”¯æŒæœåŠ¡æ‹“æ‰‘ã€ç°åº¦å‘å¸ƒã€æµé‡æ²»ç†ç­‰ ğŸ§° åº”ç”¨å•†åº—ï¼ˆHelm å¯è§†åŒ–éƒ¨ç½²ï¼‰ âŒ æ—  âœ… æ”¯æŒ Helm åº”ç”¨å¸‚åœºï¼Œç‚¹å‡»å³å¯å®‰è£…å¸¸è§ä¸­é—´ä»¶ ğŸ”Œ æ’ä»¶æ¶æ„ âŒ æ—  âœ… æ”¯æŒæ¨¡å—æŒ‰éœ€å¯ç”¨/å…³é—­ ğŸ§ª å®¹å™¨é•œåƒä»“åº“ï¼ˆHarborï¼‰ âŒ æ—  âœ… å¯é›†æˆæˆ–å†…å»º Harbor å®¹å™¨ä»“åº“ ğŸ“¦ å®‰è£…å¤æ‚åº¦ âœ… ç®€å• âš ï¸ ç•¥å¤æ‚ï¼Œä½†å¯æŒ‰éœ€å¯ç”¨æ¨¡å— éƒ¨ç½² Kubesphere Kubesphere å¯¹ç³»ç»Ÿèµ„æºæœ‰æœ€ä½è¦æ±‚ï¼Œå…·ä½“å‚è€ƒå®˜ç½‘:ç¯å¢ƒè¦æ±‚ éƒ¨ç½² 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748# å¦‚æœæ— æ³•è®¿é—® charts.kubesphere.io, å¯å°† charts.kubesphere.io æ›¿æ¢ä¸º charts.kubesphere.com.cnhelm upgrade --install -n kubesphere-system --create-namespace ks-core https://charts.kubesphere.io/main/ks-core-1.1.4.tgz --debug --wait## å®‰è£…æˆåŠŸåä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼šNOTES:Thank you for choosing KubeSphere Helm Chart.Please be patient and wait for several seconds for the KubeSphere deployment to complete.1. Wait for Deployment Completion Confirm that all KubeSphere components are running by executing the following command: kubectl get pods -n kubesphere-system2. Access the KubeSphere Console Once the deployment is complete, you can access the KubeSphere console using the following URL: http://10.211.55.11:308803. Login to KubeSphere Console Use the following credentials to log in: Account: admin Password: P@88w0rdNOTE: It is highly recommended to change the default password immediately after the first login.For additional information and details, please visit https://kubesphere.io.# æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶$ kubectl get pod,deploy,svc -n kubesphere-systemNAME READY STATUS RESTARTS AGEpod/extensions-museum-ffd8bd9d8-fvcw4 1/1 Running 1 (28m ago) 5h5mpod/ks-apiserver-7b4479d5f5-2k4c9 1/1 Running 2 (27m ago) 5h5mpod/ks-console-6bd9b9f5d9-xqlzs 1/1 Running 0 26mpod/ks-controller-manager-547f9fc8c9-5b88z 1/1 Running 10 (27m ago) 5h5mNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/extensions-museum 1/1 1 1 5h14mdeployment.apps/ks-apiserver 1/1 1 1 5h14mdeployment.apps/ks-console 1/1 1 1 5h14mdeployment.apps/ks-controller-manager 1/1 1 1 5h14mNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/extensions-museum ClusterIP 10.96.95.71 &lt;none&gt; 443/TCP 5h14mservice/ks-apiserver ClusterIP 10.96.12.106 &lt;none&gt; 80/TCP 5h14mservice/ks-console NodePort 10.96.55.165 &lt;none&gt; 80:30880/TCP 5h14mservice/ks-controller-manager ClusterIP 10.96.13.243 &lt;none&gt; 443/TCP 5h14m æµè§ˆå™¨è®¿é—®ï¼šhttp://10.211.55.11:30880ï¼Œè¾“å…¥è´¦å·å¯†ç ï¼šadmin/P@88w0rdï¼Œé¦–æ¬¡ç™»å½•éœ€è¦ä¿®æ”¹å¯†ç ã€‚ é…ç½® ingress åˆ›å»ºè¯ä¹¦ 1234kubectl create secret tls nginx-tls \\ --key=nginx_ssl/nginx.hanqunfeng.com.key \\ --cert=nginx_ssl/nginx.hanqunfeng.com.pem \\ -n kubesphere-system åˆ›å»º ingress 12345678910111213141516171819202122232425# kubesphere-ingress.yamlapiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: kubesphere-nginx namespace: kubesphere-system annotations: nginx.ingress.kubernetes.io/force-ssl-redirect: &quot;true&quot;spec: ingressClassName: nginx tls: - hosts: - kubesphere.hanqunfeng.com secretName: nginx-tls rules: - host: kubesphere.hanqunfeng.com http: paths: - pathType: Prefix path: / backend: service: name: ks-console port: number: 80 å¸è½½ Kubesphere 12helm uninstall ks-core -n kubesphere-systemkubectl delete namespace kubesphere-system","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Kubesphereï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Kubesphere å®˜ç½‘","date_published":"2025-07-24T14:33:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-dashboard/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-ui-dashboard/","title":"K8S UI ä¹‹ Dashboard","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/\">Dashboard k8sä»‹ç»</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Dashboard-ç®€ä»‹\">Dashboard ç®€ä»‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Dashboard æ˜¯åŸºäºç½‘é¡µçš„ Kubernetes ç”¨æˆ·ç•Œé¢ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½ å¯ä»¥ä½¿ç”¨ Dashboard å°†å®¹å™¨åº”ç”¨éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œä¹Ÿå¯ä»¥å¯¹å®¹å™¨åº”ç”¨æ’é”™ï¼Œè¿˜èƒ½ç®¡ç†é›†ç¾¤èµ„æºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½ å¯ä»¥ä½¿ç”¨ Dashboard è·å–è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„åº”ç”¨çš„æ¦‚è§ˆä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæˆ–è€…ä¿®æ”¹ Kubernetes èµ„æº ï¼ˆå¦‚ Deploymentã€Jobã€DaemonSet ç­‰ç­‰ï¼‰ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥å¯¹ Deployment å®ç°å¼¹æ€§ä¼¸ç¼©ã€å‘èµ·æ»šåŠ¨å‡çº§ã€é‡å¯ Pod æˆ–è€…ä½¿ç”¨å‘å¯¼åˆ›å»ºæ–°çš„åº”ç”¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Dashboard åŒæ—¶å±•ç¤ºäº† Kubernetes é›†ç¾¤ä¸­çš„èµ„æºçŠ¶æ€ä¿¡æ¯å’Œæ‰€æœ‰æŠ¥é”™ä¿¡æ¯ã€‚</p>\n</li>\n</ul>\n<h2 id=\"éƒ¨ç½²-Dashboard\">éƒ¨ç½² Dashboard</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Kubernetes Dashboard ç›®å‰ä»…æ”¯æŒåŸºäº Helm çš„å®‰è£…ï¼Œå› ä¸ºå®ƒé€Ÿåº¦æ›´å¿«ï¼Œ å¹¶ä¸”å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°æ§åˆ¶ Dashboard è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ  kubernetes-dashboard ä»“åº“</span></span><br><span class=\"line\">helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ kubernetes-dashboard Chart éƒ¨ç½²åä¸º `kubernetes-dashboard` çš„ Helm Release</span></span><br><span class=\"line\">$ helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\</span><br><span class=\"line\">    --create-namespace \\</span><br><span class=\"line\">    --namespace kubernetes-dashboard</span><br><span class=\"line\"><span class=\"comment\">## è¾“å‡º</span></span><br><span class=\"line\">Release <span class=\"string\">&quot;kubernetes-dashboard&quot;</span> does not exist. Installing it now.</span><br><span class=\"line\">NAME: kubernetes-dashboard</span><br><span class=\"line\">LAST DEPLOYED: Sun Jul  6 00:40:02 2025</span><br><span class=\"line\">NAMESPACE: kubernetes-dashboard</span><br><span class=\"line\">STATUS: deployed</span><br><span class=\"line\">REVISION: 1</span><br><span class=\"line\">TEST SUITE: None</span><br><span class=\"line\">NOTES:</span><br><span class=\"line\">*************************************************************************************************</span><br><span class=\"line\">*** PLEASE BE PATIENT: Kubernetes Dashboard may need a few minutes to get up and become ready ***</span><br><span class=\"line\">*************************************************************************************************</span><br><span class=\"line\"></span><br><span class=\"line\">Congratulations! You have just installed Kubernetes Dashboard <span class=\"keyword\">in</span> your cluster.</span><br><span class=\"line\"></span><br><span class=\"line\">To access Dashboard run:</span><br><span class=\"line\">  kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443</span><br><span class=\"line\"></span><br><span class=\"line\">NOTE: In <span class=\"keyword\">case</span> port-forward <span class=\"built_in\">command</span> does not work, make sure that kong service name is correct.</span><br><span class=\"line\">      Check the services <span class=\"keyword\">in</span> Kubernetes Dashboard namespace using:</span><br><span class=\"line\">        kubectl -n kubernetes-dashboard get svc</span><br><span class=\"line\"></span><br><span class=\"line\">Dashboard will be available at:</span><br><span class=\"line\">  https://localhost:8443</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ helm å®‰è£…çš„åŒ…ï¼Œæ³¨æ„æŒ‡å®š å‘½åç©ºé—´</span></span><br><span class=\"line\">$ helm list -n kubernetes-dashboard</span><br><span class=\"line\">NAME                \tNAMESPACE           \tREVISION\tUPDATED                                \tSTATUS  \tCHART                      \tAPP VERSION</span><br><span class=\"line\">kubernetes-dashboard\tkubernetes-dashboard\t1       \t2025-07-24 14:01:06.678570212 +0800 CST\tdeployed\tkubernetes-dashboard-7.13.0</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹å¯åŠ¨çš„èµ„æº</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl -n kubernetes-dashboard get all</span><br><span class=\"line\">NAME                                                       READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">pod/kubernetes-dashboard-api-568f47ddd7-tx6f8              1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-auth-645b944589-t6v2m             1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-kong-648658d45f-7qsm9             1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-metrics-scraper-547874fcf-87mrv   1/1     Running   0          20m</span><br><span class=\"line\">pod/kubernetes-dashboard-web-7796b9fbbb-xsdlw              1/1     Running   0          20m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class=\"line\">service/kubernetes-dashboard-api               ClusterIP   10.96.149.59    &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\">service/kubernetes-dashboard-auth              ClusterIP   10.96.145.120   &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\">service/kubernetes-dashboard-kong-proxy        ClusterIP   10.96.171.40    &lt;none&gt;        443/TCP    20m</span><br><span class=\"line\">service/kubernetes-dashboard-metrics-scraper   ClusterIP   10.96.79.48     &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\">service/kubernetes-dashboard-web               ClusterIP   10.96.247.143   &lt;none&gt;        8000/TCP   20m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                                   READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-api               1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-auth              1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-kong              1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-metrics-scraper   1/1     1            1           20m</span><br><span class=\"line\">deployment.apps/kubernetes-dashboard-web               1/1     1            1           20m</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                                             DESIRED   CURRENT   READY   AGE</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-api-568f47ddd7              1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-auth-645b944589             1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-kong-648658d45f             1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-metrics-scraper-547874fcf   1         1         1       20m</span><br><span class=\"line\">replicaset.apps/kubernetes-dashboard-web-7796b9fbbb              1         1         1       20m</span><br></pre></td></tr></table></figure>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">ç¬¬ä¸€æ¬¡åˆ›å»ºkubernetes-dashboardæ—¶ï¼Œæœ‰å‡ ä¸ª pod ä¸€ç›´å¤„äº ContainerCreating çŠ¶æ€ï¼Œé€šè¿‡ describe å‘½ä»¤ï¼ŒæŸ¥çœ‹ pod çš„çŠ¶æ€å‘ç°æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Warning  FailedCreatePodSandBox  4m52s                kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network <span class=\"keyword\">for</span> sandbox <span class=\"string\">&quot;cfa0b6062fabd77353e6d832ab0e62f96787b4d59346d9e57c28dbc0e19a3127&quot;</span>: plugin <span class=\"built_in\">type</span>=<span class=\"string\">&quot;calico&quot;</span> failed (add): error getting ClusterInformation: connection is unauthorized: Unauthorized</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>è¿™æ¡é”™è¯¯è¯´æ˜ï¼š</p>\n<ul class=\"lvl-3\">\n<li class=\"lvl-6\">å®¹å™¨ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰ä½¿ç”¨çš„æ˜¯ Calico</li>\n<li class=\"lvl-6\">Calico åœ¨å°è¯•è·å– Kubernetes é›†ç¾¤çš„ ClusterInformation æ—¶ è®¤è¯å¤±è´¥</li>\n<li class=\"lvl-6\">é”™è¯¯å…³é”®è¯ï¼šconnection is unauthorized: Unauthorized</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>ä¸ç¡®å®šå¯¼è‡´è¿™ä¸€é—®é¢˜çš„åŸå› ï¼Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯é‡æ–°å®‰è£… Calico</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete -f calico.yaml</span><br><span class=\"line\">kubectl apply -f calico.yaml</span><br></pre></td></tr></table></figure>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¼€æ”¾ä»£ç†ç«¯å£</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨å“ªä¸ªæœºå™¨ä¸Šè¿è¡Œçš„å‘½ä»¤ï¼Œå¼€æ”¾çš„å°±æ˜¯å“ªä¸ªæœºå™¨çš„ç«¯å£</span></span><br><span class=\"line\">kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®ï¼šåœ¨å¼€æ”¾ä»£ç†ç«¯å£çš„æœºå™¨ä¸Šä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼š<a href=\"https://localhost:8443\">https://localhost:8443</a></p>\n</li>\n</ul>\n<h2 id=\"ç™»å½•å¸å·\">ç™»å½•å¸å·</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># dashboard-adminuser.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span>                    <span class=\"comment\"># åˆ›å»º ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span>                      <span class=\"comment\"># SA åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubernetes-dashboard</span>       <span class=\"comment\"># SA æ‰€åœ¨å‘½åç©ºé—´</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span>                <span class=\"comment\"># é›†ç¾¤è§’è‰²ç»‘å®š</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span>   <span class=\"comment\"># é›†ç¾¤è§’è‰²ç»„ï¼Œè¿™ä¸ªæ˜¯ k8s å†…ç½®çš„</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span>                     <span class=\"comment\"># é›†ç¾¤è§’è‰²</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">cluster-admin</span>                   <span class=\"comment\"># é›†ç¾¤ç®¡ç†å‘˜è§’è‰²</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span>                  <span class=\"comment\"># æœåŠ¡è´¦å·</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span>                      <span class=\"comment\"># æœåŠ¡è´¦å·åç§°</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubernetes-dashboard</span>       <span class=\"comment\"># æœåŠ¡è´¦å·å‘½åç©ºé—´</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºå¹¶è·å–token</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f dashboard-adminuser.yaml</span><br><span class=\"line\"><span class=\"comment\"># è·å–tokenï¼Œè¯¥ token æœ‰æ•ˆæœŸä¸º 1 å°æ—¶ï¼Œtokenæ ¼å¼ä¸º jwtï¼Œå¯ä»¥é€šè¿‡ jwt.io è§£æ</span></span><br><span class=\"line\">kubectl -n kubernetes-dashboard create token admin-user</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å–é•¿æ•ˆtoken</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># dashboard-secret.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">admin-user</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubernetes-dashboard</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">kubernetes.io/service-account.name:</span> <span class=\"string\">&quot;admin-user&quot;</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">kubernetes.io/service-account-token</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f dashboard-secret.yaml</span><br><span class=\"line\"><span class=\"comment\"># è¯¥å‘½ä»¤è·å–tokenï¼Œæ°¸ä¸è¿‡æœŸï¼Œå°†å…¶ä¿å­˜ä¸‹æ¥</span></span><br><span class=\"line\">kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath=<span class=\"string\">&quot;&#123;.data.token&#125;&quot;</span> | <span class=\"built_in\">base64</span> -d</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¸è½½-kubernetes-dashboard\">å¸è½½ kubernetes-dashboard</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸è½½ kubernetes-dashboard</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm uninstall kubernetes-dashboard --namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¸…ç†ç”¨æˆ·ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl -n kubernetes-dashboard delete serviceaccount admin-user</span><br><span class=\"line\">kubectl -n kubernetes-dashboard delete clusterrolebinding admin-user</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ å‘½åç©ºé—´ï¼Œåˆ é™¤å‘½åç©ºé—´ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰èµ„æº</span></span><br><span class=\"line\">kubectl delete namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Dashboard k8sä»‹ç» Dashboard ç®€ä»‹ Dashboard æ˜¯åŸºäºç½‘é¡µçš„ Kubernetes ç”¨æˆ·ç•Œé¢ã€‚ ä½ å¯ä»¥ä½¿ç”¨ Dashboard å°†å®¹å™¨åº”ç”¨éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œä¹Ÿå¯ä»¥å¯¹å®¹å™¨åº”ç”¨æ’é”™ï¼Œè¿˜èƒ½ç®¡ç†é›†ç¾¤èµ„æºã€‚ ä½ å¯ä»¥ä½¿ç”¨ Dashboard è·å–è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„åº”ç”¨çš„æ¦‚è§ˆä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæˆ–è€…ä¿®æ”¹ Kubernetes èµ„æº ï¼ˆå¦‚ Deploymentã€Jobã€DaemonSet ç­‰ç­‰ï¼‰ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥å¯¹ Deployment å®ç°å¼¹æ€§ä¼¸ç¼©ã€å‘èµ·æ»šåŠ¨å‡çº§ã€é‡å¯ Pod æˆ–è€…ä½¿ç”¨å‘å¯¼åˆ›å»ºæ–°çš„åº”ç”¨ã€‚ Dashboard åŒæ—¶å±•ç¤ºäº† Kubernetes é›†ç¾¤ä¸­çš„èµ„æºçŠ¶æ€ä¿¡æ¯å’Œæ‰€æœ‰æŠ¥é”™ä¿¡æ¯ã€‚ éƒ¨ç½² Dashboard Kubernetes Dashboard ç›®å‰ä»…æ”¯æŒåŸºäº Helm çš„å®‰è£…ï¼Œå› ä¸ºå®ƒé€Ÿåº¦æ›´å¿«ï¼Œ å¹¶ä¸”å¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°æ§åˆ¶ Dashboard è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚ 1234567891011121314151617181920212223242526272829303132333435# æ·»åŠ  kubernetes-dashboard ä»“åº“helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/# ä½¿ç”¨ kubernetes-dashboard Chart éƒ¨ç½²åä¸º `kubernetes-dashboard` çš„ Helm Release$ helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\ --create-namespace \\ --namespace kubernetes-dashboard## è¾“å‡ºRelease &quot;kubernetes-dashboard&quot; does not exist. Installing it now.NAME: kubernetes-dashboardLAST DEPLOYED: Sun Jul 6 00:40:02 2025NAMESPACE: kubernetes-dashboardSTATUS: deployedREVISION: 1TEST SUITE: NoneNOTES:**************************************************************************************************** PLEASE BE PATIENT: Kubernetes Dashboard may need a few minutes to get up and become ready ****************************************************************************************************Congratulations! You have just installed Kubernetes Dashboard in your cluster.To access Dashboard run: kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443NOTE: In case port-forward command does not work, make sure that kong service name is correct. Check the services in Kubernetes Dashboard namespace using: kubectl -n kubernetes-dashboard get svcDashboard will be available at: https://localhost:8443# æŸ¥çœ‹ helm å®‰è£…çš„åŒ…ï¼Œæ³¨æ„æŒ‡å®š å‘½åç©ºé—´$ helm list -n kubernetes-dashboardNAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSIONkubernetes-dashboard kubernetes-dashboard 1 2025-07-24 14:01:06.678570212 +0800 CST deployed kubernetes-dashboard-7.13.0 æŸ¥çœ‹å¯åŠ¨çš„èµ„æº 12345678910111213141516171819202122232425262728$ kubectl -n kubernetes-dashboard get allNAME READY STATUS RESTARTS AGEpod/kubernetes-dashboard-api-568f47ddd7-tx6f8 1/1 Running 0 20mpod/kubernetes-dashboard-auth-645b944589-t6v2m 1/1 Running 0 20mpod/kubernetes-dashboard-kong-648658d45f-7qsm9 1/1 Running 0 20mpod/kubernetes-dashboard-metrics-scraper-547874fcf-87mrv 1/1 Running 0 20mpod/kubernetes-dashboard-web-7796b9fbbb-xsdlw 1/1 Running 0 20mNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/kubernetes-dashboard-api ClusterIP 10.96.149.59 &lt;none&gt; 8000/TCP 20mservice/kubernetes-dashboard-auth ClusterIP 10.96.145.120 &lt;none&gt; 8000/TCP 20mservice/kubernetes-dashboard-kong-proxy ClusterIP 10.96.171.40 &lt;none&gt; 443/TCP 20mservice/kubernetes-dashboard-metrics-scraper ClusterIP 10.96.79.48 &lt;none&gt; 8000/TCP 20mservice/kubernetes-dashboard-web ClusterIP 10.96.247.143 &lt;none&gt; 8000/TCP 20mNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/kubernetes-dashboard-api 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-auth 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-kong 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-metrics-scraper 1/1 1 1 20mdeployment.apps/kubernetes-dashboard-web 1/1 1 1 20mNAME DESIRED CURRENT READY AGEreplicaset.apps/kubernetes-dashboard-api-568f47ddd7 1 1 1 20mreplicaset.apps/kubernetes-dashboard-auth-645b944589 1 1 1 20mreplicaset.apps/kubernetes-dashboard-kong-648658d45f 1 1 1 20mreplicaset.apps/kubernetes-dashboard-metrics-scraper-547874fcf 1 1 1 20mreplicaset.apps/kubernetes-dashboard-web-7796b9fbbb 1 1 1 20m å°è´´å£« ç¬¬ä¸€æ¬¡åˆ›å»ºkubernetes-dashboardæ—¶ï¼Œæœ‰å‡ ä¸ª pod ä¸€ç›´å¤„äº ContainerCreating çŠ¶æ€ï¼Œé€šè¿‡ describe å‘½ä»¤ï¼ŒæŸ¥çœ‹ pod çš„çŠ¶æ€å‘ç°æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š 1Warning FailedCreatePodSandBox 4m52s kubelet Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network for sandbox &quot;cfa0b6062fabd77353e6d832ab0e62f96787b4d59346d9e57c28dbc0e19a3127&quot;: plugin type=&quot;calico&quot; failed (add): error getting ClusterInformation: connection is unauthorized: Unauthorized è¿™æ¡é”™è¯¯è¯´æ˜ï¼š å®¹å™¨ç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰ä½¿ç”¨çš„æ˜¯ Calico Calico åœ¨å°è¯•è·å– Kubernetes é›†ç¾¤çš„ ClusterInformation æ—¶ è®¤è¯å¤±è´¥ é”™è¯¯å…³é”®è¯ï¼šconnection is unauthorized: Unauthorized ä¸ç¡®å®šå¯¼è‡´è¿™ä¸€é—®é¢˜çš„åŸå› ï¼Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯é‡æ–°å®‰è£… Calico 12kubectl delete -f calico.yamlkubectl apply -f calico.yaml å¼€æ”¾ä»£ç†ç«¯å£ 12# åœ¨å“ªä¸ªæœºå™¨ä¸Šè¿è¡Œçš„å‘½ä»¤ï¼Œå¼€æ”¾çš„å°±æ˜¯å“ªä¸ªæœºå™¨çš„ç«¯å£kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443 è®¿é—®ï¼šåœ¨å¼€æ”¾ä»£ç†ç«¯å£çš„æœºå™¨ä¸Šä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼šhttps://localhost:8443 ç™»å½•å¸å· åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ· 12345678910111213141516171819# dashboard-adminuser.yamlapiVersion: v1kind: ServiceAccount # åˆ›å»º ServiceAccountmetadata: name: admin-user # SA åç§° namespace: kubernetes-dashboard # SA æ‰€åœ¨å‘½åç©ºé—´---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBinding # é›†ç¾¤è§’è‰²ç»‘å®šmetadata: name: admin-userroleRef: apiGroup: rbac.authorization.k8s.io # é›†ç¾¤è§’è‰²ç»„ï¼Œè¿™ä¸ªæ˜¯ k8s å†…ç½®çš„ kind: ClusterRole # é›†ç¾¤è§’è‰² name: cluster-admin # é›†ç¾¤ç®¡ç†å‘˜è§’è‰²subjects:- kind: ServiceAccount # æœåŠ¡è´¦å· name: admin-user # æœåŠ¡è´¦å·åç§° namespace: kubernetes-dashboard # æœåŠ¡è´¦å·å‘½åç©ºé—´ åˆ›å»ºå¹¶è·å–token 123kubectl apply -f dashboard-adminuser.yaml# è·å–tokenï¼Œè¯¥ token æœ‰æ•ˆæœŸä¸º 1 å°æ—¶ï¼Œtokenæ ¼å¼ä¸º jwtï¼Œå¯ä»¥é€šè¿‡ jwt.io è§£ækubectl -n kubernetes-dashboard create token admin-user è·å–é•¿æ•ˆtoken 123456789# dashboard-secret.yamlapiVersion: v1kind: Secretmetadata: name: admin-user namespace: kubernetes-dashboard annotations: kubernetes.io/service-account.name: &quot;admin-user&quot;type: kubernetes.io/service-account-token 123kubectl apply -f dashboard-secret.yaml# è¯¥å‘½ä»¤è·å–tokenï¼Œæ°¸ä¸è¿‡æœŸï¼Œå°†å…¶ä¿å­˜ä¸‹æ¥kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath=&quot;&#123;.data.token&#125;&quot; | base64 -d å¸è½½ kubernetes-dashboard å¸è½½ kubernetes-dashboard 1helm uninstall kubernetes-dashboard --namespace kubernetes-dashboard æ¸…ç†ç”¨æˆ·ä¿¡æ¯ 12345kubectl -n kubernetes-dashboard delete serviceaccount admin-userkubectl -n kubernetes-dashboard delete clusterrolebinding admin-user# ä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ å‘½åç©ºé—´ï¼Œåˆ é™¤å‘½åç©ºé—´ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰èµ„æºkubectl delete namespace kubernetes-dashboard","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ UI ç®¡ç†å·¥å…· Dashboardï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github Dashboard k8sä»‹ç»","date_published":"2025-07-24T13:33:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-tools/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-tools/","title":"K8S ä¹‹ Tools","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-3\">\n<p>K8S çš„ Tools: crictlã€nerdctlã€helm ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"crictl-å‘½ä»¤\">crictl å‘½ä»¤</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>crictl</code> æ˜¯k8så®˜æ–¹å‡ºå“çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ containerd è¿›è¡Œé€šä¿¡ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><code>crictl</code> å‘½ä»¤é»˜è®¤éœ€è¦ sudo æƒé™ï¼Œå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ  sudoï¼Œå¯ä»¥å°†ç”¨æˆ·åŠ å…¥ containerd çš„ socket æƒé™ç»„</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># containerd çš„é»˜è®¤ socket æ˜¯ /var/run/containerd/containerd.sock</span></span><br><span class=\"line\">$ <span class=\"built_in\">ls</span> -l /var/run/containerd/containerd.sock</span><br><span class=\"line\">srw-rw---- 1 root root 0 7æœˆ   1 10:57 /var/run/containerd/containerd.sock</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœ group æ˜¯ rootï¼šä½ å¯ä»¥æ”¹ä¸ºå…¶å®ƒç»„ï¼Œæ¯”å¦‚ docker</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœ docker ç»„ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> groupadd docker</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹æ–‡ä»¶æ‰€å±ç»„ä¸º docker</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chgrp</span> docker /var/run/containerd/containerd.sock</span><br><span class=\"line\"><span class=\"comment\"># ä¸ºç»„æ·»åŠ è¯»å†™æƒé™</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> g+rw /var/run/containerd/containerd.sock</span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ ç”¨æˆ·åˆ° docker ç»„</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> usermod -aG docker <span class=\"variable\">$USER</span></span><br><span class=\"line\"><span class=\"comment\"># åˆ·æ–°æƒé™</span></span><br><span class=\"line\">newgrp docker</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶è™½ç„¶å·²ç»å¯ä»¥ä¸ç”¨ sudo äº†ï¼Œä½†æ˜¯ä¸€æ—¦é‡å¯ containerd å°±ä¼šé‡æ–°å›åˆ° root æƒé™ï¼Œå› æ­¤éœ€è¦æ·»åŠ å¦‚ä¸‹é…ç½®</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /etc/systemd/system/containerd.service.d/</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/systemd/system/containerd.service.d/override.conf &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">[Service]</span></span><br><span class=\"line\"><span class=\"string\">ExecStartPost=/bin/bash -c &#x27;chmod 660 /run/containerd/containerd.sock &amp;&amp; chgrp docker /run/containerd/containerd.sock&#x27;</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl daemon-reload</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart containerd</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>crictl</code> å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç±»ä¼¼<code>docker</code>å‘½ä»¤</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ“ä½œ</th>\n<th><code>docker</code> å‘½ä»¤</th>\n<th><code>crictl</code> å‘½ä»¤</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</td>\n<td><code>docker ps</code></td>\n<td><code>crictl ps</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢ï¼‰</td>\n<td><code>docker ps -a</code></td>\n<td><code>crictl ps -a</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹é•œåƒ</td>\n<td><code>docker images</code></td>\n<td><code>crictl images</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</td>\n<td><code>docker logs &lt;container_id&gt;</code></td>\n<td><code>crictl logs &lt;container_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>è¿›å…¥å®¹å™¨äº¤äº’</td>\n<td><code>docker exec -it &lt;id&gt; sh</code></td>\n<td><code>crictl exec -it &lt;id&gt; sh</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</td>\n<td><code>docker inspect &lt;container_id&gt;</code></td>\n<td><code>crictl inspect &lt;container_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯</td>\n<td>âŒï¼ˆä¸æ”¯æŒï¼‰</td>\n<td><code>crictl inspectp &lt;pod_id&gt;</code></td>\n<td>K8s ä¸“å±</td>\n</tr>\n<tr>\n<td>åˆ é™¤å®¹å™¨</td>\n<td><code>docker rm &lt;container_id&gt;</code></td>\n<td><code>crictl rm &lt;container_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>åˆ é™¤é•œåƒ</td>\n<td><code>docker rmi &lt;image_id&gt;</code></td>\n<td><code>crictl rmi &lt;image_id&gt;</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æ‹‰å–é•œåƒ</td>\n<td><code>docker pull nginx</code></td>\n<td><code>crictl pull nginx</code></td>\n<td></td>\n</tr>\n<tr>\n<td>è¿è¡Œå®¹å™¨ï¼ˆé K8s åœºæ™¯ï¼‰</td>\n<td><code>docker run -it nginx</code></td>\n<td>âŒï¼ˆä¸æ”¯æŒï¼‰</td>\n<td><code>crictl</code> ä¸è¿è¡Œå®¹å™¨ï¼Œä»…è°ƒè¯•ç°æœ‰å®¹å™¨</td>\n</tr>\n<tr>\n<td>åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶ä¿¡æ¯</td>\n<td><code>docker info</code></td>\n<td><code>crictl info</code></td>\n<td></td>\n</tr>\n<tr>\n<td>æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€</td>\n<td><code>docker stats</code></td>\n<td><code>crictl stats</code></td>\n<td>ç®€è¦ç‰ˆ</td>\n</tr>\n<tr>\n<td>è®¾ç½®é…ç½®æ–‡ä»¶</td>\n<td><code>~/.docker/config.json</code></td>\n<td><code>/etc/crictl.yaml</code></td>\n<td>å¦‚è®¾ç½® endpoint</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"nerdctl\">nerdctl</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/containerd/nerdctl\">nerdctl</a> æ˜¯ä¸€ä¸ª å…¼å®¹ Docker CLI çš„å®¹å™¨å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† containerd å®¹å™¨è¿è¡Œæ—¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®ƒæ˜¯ containerd å®˜æ–¹å­é¡¹ç›®ï¼Œç”± CNCF ç»´æŠ¤ï¼Œå…¶å‘½ä»¤è¯­æ³•ä¸ Docker CLI å…¼å®¹ï¼Œç›®æ ‡æ˜¯è®©ä¹ æƒ¯ Docker çš„ç”¨æˆ·ä¹Ÿèƒ½è½»æ¾ä½¿ç”¨ containerdã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£… nerdctl</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</span></span><br><span class=\"line\">VERSION=2.1.3</span><br><span class=\"line\">wget https://github.com/containerd/nerdctl/releases/download/v<span class=\"variable\">$&#123;VERSION&#125;</span>/nerdctl-<span class=\"variable\">$&#123;VERSION&#125;</span>-linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. è§£å‹</span></span><br><span class=\"line\">tar -xvf nerdctl-<span class=\"variable\">$&#123;VERSION&#125;</span>-linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. ç§»åŠ¨åˆ°ç³»ç»Ÿ PATH</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mv</span> nerdctl /usr/local/bin/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># nerdctl éœ€è¦ sudo æƒé™</span></span><br><span class=\"line\"><span class=\"comment\">## ä¸º sudo æ·»åŠ  PATH</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> visudo</span><br><span class=\"line\"><span class=\"comment\">## æ‰¾åˆ°è¿™ä¸€è¡Œ</span></span><br><span class=\"line\">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin</span><br><span class=\"line\"><span class=\"comment\">## ä¿®æ”¹ä¸ºï¼Œå³å°† nerdctl æ‰€åœ¨çš„ç›®å½•åŠ å…¥ PATH</span></span><br><span class=\"line\">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin:/usr/local/bin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.æµ‹è¯•</span></span><br><span class=\"line\"><span class=\"comment\">## æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> nerdctl version</span><br><span class=\"line\"><span class=\"comment\">## åˆ—å‡ºå®¹å™¨ï¼Œ--namespace k8s.io è¡¨ç¤ºæŸ¥çœ‹ k8s ä¸­çš„å®¹å™¨</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> nerdctl ps --namespace k8s.io</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ ä¸Š --namespace k8s.ioï¼Œå¯ä»¥è®¾ç½®åˆ«å</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;alias kps=&#x27;sudo nerdctl --namespace=k8s.io ps&#x27;&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"><span class=\"comment\">## æµ‹è¯•</span></span><br><span class=\"line\">kps</span><br></pre></td></tr></table></figure>\n<h2 id=\"Helm\">Helm</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://helm.sh/zh/docs/\">å®˜ç½‘æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Helm æ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼äº Linux ä¸‹çš„åŒ…ç®¡ç†å·¥å…·å¦‚ yumã€apt ç­‰ã€‚å¯ä»¥æ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„ yaml æ–‡ä»¶éƒ¨ç½²åˆ° Kunernetes ä¸Šã€‚</p>\n</li>\n</ul>\n<h3 id=\"Helmçš„å®‰è£…\">Helmçš„å®‰è£…</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®˜ç½‘<a href=\"https://helm.sh/zh/docs/intro/install/\">å®‰è£…æ–¹æ³•</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://get.helm.sh/helm-v3.17.4-linux-amd64.tar.gz</span><br><span class=\"line\">tar -zxvf helm-v3.17.4-linux-amd64.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mv</span> linux-amd64/helm /usr/local/bin/helm</span><br><span class=\"line\">$ helm version</span><br><span class=\"line\">version.BuildInfo&#123;Version:<span class=\"string\">&quot;v3.17.4&quot;</span>, GitCommit:<span class=\"string\">&quot;595a05da6166037d0abebaa27ac8a498fa4d7ed2&quot;</span>, GitTreeState:<span class=\"string\">&quot;clean&quot;</span>, GoVersion:<span class=\"string\">&quot;go1.23.10&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Helm<a href=\"https://helm.sh/zh/docs/helm/helm_completion_bash/\">è‡ªåŠ¨è¡¥å…¨</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£… helm çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½</span></span><br><span class=\"line\"><span class=\"comment\"># 1 å½“å‰ç”¨æˆ·</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;source &lt;(helm completion bash)&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bashrc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2 æ‰€æœ‰ç”¨æˆ·</span></span><br><span class=\"line\">helm completion bash | <span class=\"built_in\">sudo</span> <span class=\"built_in\">tee</span> /etc/bash_completion.d/helm &gt; /dev/null</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chmod</span> a+r /etc/bash_completion.d/helm</span><br></pre></td></tr></table></figure>\n<h3 id=\"Helmçš„ä½¿ç”¨\">Helmçš„ä½¿ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¯ä»¥å‚è€ƒ <a href=\"/2023/07/10/aws-eks14-helm/\" title=\"AWS-EKS-14--Helm\">AWS-EKS-14--Helm</a></p>\n</li>\n</ul>\n<h4 id=\"ä»“åº“ç®¡ç†\">ä»“åº“ç®¡ç†</h4>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>addï¼šæ·»åŠ å›¾è¡¨å­˜å‚¨åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>listï¼šåˆ—å‡ºå›¾è¡¨å­˜å‚¨åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm repo list</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>removeï¼šåˆ é™¤å›¾è¡¨å­˜å‚¨åº“</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm repo remove bitnami</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>updateï¼šä»å›¾è¡¨å­˜å‚¨åº“æ›´æ–°æœ¬åœ°å¯ç”¨å›¾è¡¨çš„ä¿¡æ¯</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ›´æ–°æ‰€æœ‰ä»“åº“</span></span><br><span class=\"line\">helm repo update</span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°æŒ‡å®šçš„ä»“åº“</span></span><br><span class=\"line\">helm repo update bitnami</span><br></pre></td></tr></table></figure>\n<h4 id=\"åœ¨ä»“åº“ä¸­æœç´¢\">åœ¨ä»“åº“ä¸­æœç´¢</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨æ‰€æœ‰ä»“åº“ä¸­æœç´¢ï¼Œé»˜è®¤åªå±•ç¤ºæœ€æ–°çš„ç‰ˆæœ¬</span></span><br><span class=\"line\">helm search repo nginx</span><br><span class=\"line\"><span class=\"comment\"># åœ¨æŒ‡å®šçš„ä»“åº“ä¸­æœç´¢</span></span><br><span class=\"line\">helm search repo bitnami/wordpress</span><br><span class=\"line\"><span class=\"comment\"># æ˜¾ç¤ºæ‰€æœ‰ç‰ˆæœ¬</span></span><br><span class=\"line\">helm search repo nginx -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åœ¨å…¨éƒ¨ç‰ˆæœ¬ä¸­æœç´¢å¤§äºç­‰äºæŒ‡å®šç‰ˆæœ¬</span></span><br><span class=\"line\">$ helm search repo nginx --version ^21.0.0 -l</span><br><span class=\"line\">NAME         \tCHART VERSION\tAPP VERSION\tDESCRIPTION</span><br><span class=\"line\">bitnami/nginx\t21.0.8       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.7       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.6       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.4       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.3       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.2       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.1       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br><span class=\"line\">bitnami/nginx\t21.0.0       \t1.29.0     \tNGINX Open Source is a web server that can be a...</span><br></pre></td></tr></table></figure>\n<h4 id=\"å®‰è£…åŒ…\">å®‰è£…åŒ…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®‰è£…æœ€æ–°ç‰ˆ</span></span><br><span class=\"line\">helm install nginx bitnami/nginx</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br><span class=\"line\">helm install nginx bitnami/nginx --version 21.0.3</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…åŒ…åˆ°æŒ‡å®šå‘½åç©ºé—´</span></span><br><span class=\"line\">helm install nginx bitnami/nginx -n &lt;namespace&gt;</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…åŒ…å¹¶åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class=\"line\">helm install nginx bitnami/nginx -n &lt;namespace&gt; --create-namespace</span><br><span class=\"line\"><span class=\"comment\"># ociï¼š ä» docker ä»“åº“ä¸­å®‰è£…</span></span><br><span class=\"line\">helm pull oci://registry-1.docker.io/bitnamicharts/nginx --version 21.0.8</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æœ¬åœ° chart ç›®å½•</span></span><br><span class=\"line\">helm install my-release ./nginx</span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… .tgz æ ¼å¼çš„æ‰“åŒ… chart</span></span><br><span class=\"line\">helm install my-release ./nginx-1.2.3.tgz</span><br><span class=\"line\"><span class=\"comment\"># ä»è¿œç¨‹tgzå®‰è£…</span></span><br><span class=\"line\">helm install my-release https://example.com/charts/nginx-1.2.3.tgz</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£… Git ä»“åº“ä¸­çš„ chartï¼ˆç»“åˆ pluginï¼‰</span></span><br><span class=\"line\">helm plugin install https://github.com/aslafy-z/helm-git</span><br><span class=\"line\">helm repo add mychart <span class=\"string\">&#x27;git+https://github.com/myorg/mychart.git&#x27;</span></span><br><span class=\"line\">helm install my-release mychart/nginx</span><br><span class=\"line\"><span class=\"comment\"># å¸è½½helm-gitæ’ä»¶</span></span><br><span class=\"line\">helm plugin remove helm-git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ --set ä¼ é€’å•ä¸ªæˆ–å¤šä¸ªå€¼</span></span><br><span class=\"line\">helm install my-release bitnami/nginx --<span class=\"built_in\">set</span> service.type=NodePort</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ --values æˆ– -f åŠ è½½ YAML é…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">helm install my-release bitnami/nginx -f custom-values.yaml</span><br><span class=\"line\"><span class=\"comment\"># åŒæ—¶ä½¿ç”¨å¤šç§ values æ–‡ä»¶ + --set</span></span><br><span class=\"line\">helm install my-release bitnami/nginx -f base.yaml -f prod.yaml --<span class=\"built_in\">set</span> replicaCount=3</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…\">æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´å·²å®‰è£…çš„åŒ…</span></span><br><span class=\"line\">helm list -n &lt;namespace&gt;</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„åŒ…</span></span><br><span class=\"line\">helm list -A</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å·²å®‰è£…çš„åŒ…çŠ¶æ€</span></span><br><span class=\"line\">helm status ngxin -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¸è½½åŒ…\">å¸è½½åŒ…</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm uninstall nginx -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>","content_text":"æ‘˜è¦ K8S çš„ Tools: crictlã€nerdctlã€helm ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github crictl å‘½ä»¤ crictl æ˜¯k8så®˜æ–¹å‡ºå“çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ containerd è¿›è¡Œé€šä¿¡ã€‚ crictl å‘½ä»¤é»˜è®¤éœ€è¦ sudo æƒé™ï¼Œå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ  sudoï¼Œå¯ä»¥å°†ç”¨æˆ·åŠ å…¥ containerd çš„ socket æƒé™ç»„ 123456789101112131415161718192021222324# containerd çš„é»˜è®¤ socket æ˜¯ /var/run/containerd/containerd.sock$ ls -l /var/run/containerd/containerd.socksrw-rw---- 1 root root 0 7æœˆ 1 10:57 /var/run/containerd/containerd.sock# å¦‚æœ group æ˜¯ rootï¼šä½ å¯ä»¥æ”¹ä¸ºå…¶å®ƒç»„ï¼Œæ¯”å¦‚ docker# å¦‚æœ docker ç»„ä¸å­˜åœ¨åˆ™åˆ›å»ºsudo groupadd docker# ä¿®æ”¹æ–‡ä»¶æ‰€å±ç»„ä¸º dockersudo chgrp docker /var/run/containerd/containerd.sock# ä¸ºç»„æ·»åŠ è¯»å†™æƒé™sudo chmod g+rw /var/run/containerd/containerd.sock# æ·»åŠ ç”¨æˆ·åˆ° docker ç»„sudo usermod -aG docker $USER# åˆ·æ–°æƒé™newgrp docker# æ­¤æ—¶è™½ç„¶å·²ç»å¯ä»¥ä¸ç”¨ sudo äº†ï¼Œä½†æ˜¯ä¸€æ—¦é‡å¯ containerd å°±ä¼šé‡æ–°å›åˆ° root æƒé™ï¼Œå› æ­¤éœ€è¦æ·»åŠ å¦‚ä¸‹é…ç½®sudo mkdir -p /etc/systemd/system/containerd.service.d/sudo tee /etc/systemd/system/containerd.service.d/override.conf &lt;&lt;EOF[Service]ExecStartPost=/bin/bash -c &#x27;chmod 660 /run/containerd/containerd.sock &amp;&amp; chgrp docker /run/containerd/containerd.sock&#x27;EOFsudo systemctl daemon-reloadsudo systemctl restart containerd crictl å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç±»ä¼¼dockerå‘½ä»¤ æ“ä½œ docker å‘½ä»¤ crictl å‘½ä»¤ è¯´æ˜ æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker ps crictl ps æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢ï¼‰ docker ps -a crictl ps -a æŸ¥çœ‹é•œåƒ docker images crictl images æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs &lt;container_id&gt; crictl logs &lt;container_id&gt; è¿›å…¥å®¹å™¨äº¤äº’ docker exec -it &lt;id&gt; sh crictl exec -it &lt;id&gt; sh æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ docker inspect &lt;container_id&gt; crictl inspect &lt;container_id&gt; æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯ âŒï¼ˆä¸æ”¯æŒï¼‰ crictl inspectp &lt;pod_id&gt; K8s ä¸“å± åˆ é™¤å®¹å™¨ docker rm &lt;container_id&gt; crictl rm &lt;container_id&gt; åˆ é™¤é•œåƒ docker rmi &lt;image_id&gt; crictl rmi &lt;image_id&gt; æ‹‰å–é•œåƒ docker pull nginx crictl pull nginx è¿è¡Œå®¹å™¨ï¼ˆé K8s åœºæ™¯ï¼‰ docker run -it nginx âŒï¼ˆä¸æ”¯æŒï¼‰ crictl ä¸è¿è¡Œå®¹å™¨ï¼Œä»…è°ƒè¯•ç°æœ‰å®¹å™¨ åˆ—å‡ºå®¹å™¨è¿è¡Œæ—¶ä¿¡æ¯ docker info crictl info æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€ docker stats crictl stats ç®€è¦ç‰ˆ è®¾ç½®é…ç½®æ–‡ä»¶ ~/.docker/config.json /etc/crictl.yaml å¦‚è®¾ç½® endpoint nerdctl nerdctl æ˜¯ä¸€ä¸ª å…¼å®¹ Docker CLI çš„å®¹å™¨å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† containerd å®¹å™¨è¿è¡Œæ—¶ã€‚ å®ƒæ˜¯ containerd å®˜æ–¹å­é¡¹ç›®ï¼Œç”± CNCF ç»´æŠ¤ï¼Œå…¶å‘½ä»¤è¯­æ³•ä¸ Docker CLI å…¼å®¹ï¼Œç›®æ ‡æ˜¯è®©ä¹ æƒ¯ Docker çš„ç”¨æˆ·ä¹Ÿèƒ½è½»æ¾ä½¿ç”¨ containerdã€‚ å®‰è£… nerdctl 1234567891011121314151617181920212223242526272829# 1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬VERSION=2.1.3wget https://github.com/containerd/nerdctl/releases/download/v$&#123;VERSION&#125;/nerdctl-$&#123;VERSION&#125;-linux-amd64.tar.gz# 2. è§£å‹tar -xvf nerdctl-$&#123;VERSION&#125;-linux-amd64.tar.gz# 3. ç§»åŠ¨åˆ°ç³»ç»Ÿ PATHsudo mv nerdctl /usr/local/bin/# nerdctl éœ€è¦ sudo æƒé™## ä¸º sudo æ·»åŠ  PATHsudo visudo## æ‰¾åˆ°è¿™ä¸€è¡ŒDefaults secure_path = /sbin:/bin:/usr/sbin:/usr/bin## ä¿®æ”¹ä¸ºï¼Œå³å°† nerdctl æ‰€åœ¨çš„ç›®å½•åŠ å…¥ PATHDefaults secure_path = /sbin:/bin:/usr/sbin:/usr/bin:/usr/local/bin# 4.æµ‹è¯•## æŸ¥çœ‹ç‰ˆæœ¬sudo nerdctl version## åˆ—å‡ºå®¹å™¨ï¼Œ--namespace k8s.io è¡¨ç¤ºæŸ¥çœ‹ k8s ä¸­çš„å®¹å™¨sudo nerdctl ps --namespace k8s.io## å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½åŠ ä¸Š --namespace k8s.ioï¼Œå¯ä»¥è®¾ç½®åˆ«åecho &quot;alias kps=&#x27;sudo nerdctl --namespace=k8s.io ps&#x27;&quot; &gt;&gt; ~/.bashrcsource ~/.bashrc## æµ‹è¯•kps Helm å®˜ç½‘æ–‡æ¡£ Helm æ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨ï¼Œç±»ä¼¼äº Linux ä¸‹çš„åŒ…ç®¡ç†å·¥å…·å¦‚ yumã€apt ç­‰ã€‚å¯ä»¥æ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„ yaml æ–‡ä»¶éƒ¨ç½²åˆ° Kunernetes ä¸Šã€‚ Helmçš„å®‰è£… å®˜ç½‘å®‰è£…æ–¹æ³• 12345wget https://get.helm.sh/helm-v3.17.4-linux-amd64.tar.gztar -zxvf helm-v3.17.4-linux-amd64.tar.gzsudo mv linux-amd64/helm /usr/local/bin/helm$ helm versionversion.BuildInfo&#123;Version:&quot;v3.17.4&quot;, GitCommit:&quot;595a05da6166037d0abebaa27ac8a498fa4d7ed2&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.23.10&quot;&#125; Helmè‡ªåŠ¨è¡¥å…¨ 12345678# å®‰è£… helm çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½# 1 å½“å‰ç”¨æˆ·echo &#x27;source &lt;(helm completion bash)&#x27; &gt;&gt; ~/.bashrcsource ~/.bashrc# 2 æ‰€æœ‰ç”¨æˆ·helm completion bash | sudo tee /etc/bash_completion.d/helm &gt; /dev/nullsudo chmod a+r /etc/bash_completion.d/helm Helmçš„ä½¿ç”¨ å¯ä»¥å‚è€ƒ AWS-EKS-14--Helm ä»“åº“ç®¡ç† addï¼šæ·»åŠ å›¾è¡¨å­˜å‚¨åº“ 1helm repo add bitnami https://charts.bitnami.com/bitnami listï¼šåˆ—å‡ºå›¾è¡¨å­˜å‚¨åº“ 1helm repo list removeï¼šåˆ é™¤å›¾è¡¨å­˜å‚¨åº“ 1helm repo remove bitnami updateï¼šä»å›¾è¡¨å­˜å‚¨åº“æ›´æ–°æœ¬åœ°å¯ç”¨å›¾è¡¨çš„ä¿¡æ¯ 1234# æ›´æ–°æ‰€æœ‰ä»“åº“helm repo update# æ›´æ–°æŒ‡å®šçš„ä»“åº“helm repo update bitnami åœ¨ä»“åº“ä¸­æœç´¢ 123456789101112131415161718# åœ¨æ‰€æœ‰ä»“åº“ä¸­æœç´¢ï¼Œé»˜è®¤åªå±•ç¤ºæœ€æ–°çš„ç‰ˆæœ¬helm search repo nginx# åœ¨æŒ‡å®šçš„ä»“åº“ä¸­æœç´¢helm search repo bitnami/wordpress# æ˜¾ç¤ºæ‰€æœ‰ç‰ˆæœ¬helm search repo nginx -l# åœ¨å…¨éƒ¨ç‰ˆæœ¬ä¸­æœç´¢å¤§äºç­‰äºæŒ‡å®šç‰ˆæœ¬$ helm search repo nginx --version ^21.0.0 -lNAME CHART VERSION APP VERSION DESCRIPTIONbitnami/nginx 21.0.8 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.7 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.6 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.4 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.3 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.2 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.1 1.29.0 NGINX Open Source is a web server that can be a...bitnami/nginx 21.0.0 1.29.0 NGINX Open Source is a web server that can be a... å®‰è£…åŒ… 123456789101112131415161718192021222324252627282930313233# å®‰è£…æœ€æ–°ç‰ˆhelm install nginx bitnami/nginx# å®‰è£…æŒ‡å®šç‰ˆæœ¬helm install nginx bitnami/nginx --version 21.0.3# å®‰è£…åŒ…åˆ°æŒ‡å®šå‘½åç©ºé—´helm install nginx bitnami/nginx -n &lt;namespace&gt;# å®‰è£…åŒ…å¹¶åˆ›å»ºå‘½åç©ºé—´helm install nginx bitnami/nginx -n &lt;namespace&gt; --create-namespace# ociï¼š ä» docker ä»“åº“ä¸­å®‰è£…helm pull oci://registry-1.docker.io/bitnamicharts/nginx --version 21.0.8# å®‰è£…æœ¬åœ° chart ç›®å½•helm install my-release ./nginx# å®‰è£… .tgz æ ¼å¼çš„æ‰“åŒ… charthelm install my-release ./nginx-1.2.3.tgz# ä»è¿œç¨‹tgzå®‰è£…helm install my-release https://example.com/charts/nginx-1.2.3.tgz# å®‰è£… Git ä»“åº“ä¸­çš„ chartï¼ˆç»“åˆ pluginï¼‰helm plugin install https://github.com/aslafy-z/helm-githelm repo add mychart &#x27;git+https://github.com/myorg/mychart.git&#x27;helm install my-release mychart/nginx# å¸è½½helm-gitæ’ä»¶helm plugin remove helm-git# ä½¿ç”¨ --set ä¼ é€’å•ä¸ªæˆ–å¤šä¸ªå€¼helm install my-release bitnami/nginx --set service.type=NodePort# ä½¿ç”¨ --values æˆ– -f åŠ è½½ YAML é…ç½®æ–‡ä»¶helm install my-release bitnami/nginx -f custom-values.yaml# åŒæ—¶ä½¿ç”¨å¤šç§ values æ–‡ä»¶ + --sethelm install my-release bitnami/nginx -f base.yaml -f prod.yaml --set replicaCount=3 æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ… 123456# æŸ¥çœ‹æŒ‡å®šå‘½åç©ºé—´å·²å®‰è£…çš„åŒ…helm list -n &lt;namespace&gt;# æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„åŒ…helm list -A# æŸ¥çœ‹å·²å®‰è£…çš„åŒ…çŠ¶æ€helm status ngxin -n &lt;namespace&gt; å¸è½½åŒ… 1helm uninstall nginx -n &lt;namespace&gt;","summary":"æ‘˜è¦ K8S çš„ Tools: crictlã€nerdctlã€helm ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-24T13:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/24/k8s-connection/","url":"https://blog.hanqunfeng.com/2025/07/24/k8s-connection/","title":"K8S ä¹‹ è¿œç¨‹è¿æ¥","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç»  K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"è¿œç¨‹è¿æ¥-k8s-é›†ç¾¤\">è¿œç¨‹è¿æ¥ k8s é›†ç¾¤</h2>\n<h3 id=\"æœ¬åœ°ä¸å­˜åœ¨-kubeconfig-æ–‡ä»¶\">æœ¬åœ°ä¸å­˜åœ¨ kubeconfig æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å– kubeconfig æ–‡ä»¶ï¼Œä½äº Master èŠ‚ç‚¹ï¼š/etc/kubernetes/admin.confï¼Œå°†å…¶æ‹·è´åˆ°æœ¬åœ°</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/config</span><br></pre></td></tr></table></figure>\n<h3 id=\"æœ¬åœ°å·²å­˜åœ¨-kubeconfig-æ–‡ä»¶\">æœ¬åœ°å·²å­˜åœ¨ kubeconfig æ–‡ä»¶</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å·²ç»é…ç½®äº†ä¸€ä¸ªé›†ç¾¤çš„è¿æ¥ï¼Œè¿˜æƒ³å†æ·»åŠ ä¸€ä¸ªé›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡é€šè¿‡åˆå¹¶çš„æ–¹å¼æ·»åŠ </p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°†æ–°é›†ç¾¤çš„ kubeconfig æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°</span></span><br><span class=\"line\">scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/new-cluster.conf</span><br><span class=\"line\"><span class=\"comment\"># åˆå¹¶</span></span><br><span class=\"line\">KUBECONFIG=~/.kube/config:new-cluster.conf kubectl config view --flatten &gt; merged-config.yaml</span><br><span class=\"line\"><span class=\"comment\"># æ›¿æ¢</span></span><br><span class=\"line\"><span class=\"built_in\">mv</span> merged-config.yaml ~/.kube/config</span><br></pre></td></tr></table></figure>\n<h3 id=\"é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤\">é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è·å–é›†ç¾¤é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è·å–æ‰€æœ‰é›†ç¾¤é…ç½®</span></span><br><span class=\"line\">kubectl config get-contexts</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹å½“å‰é»˜è®¤çš„ context</span></span><br><span class=\"line\">kubectl config current-context</span><br><span class=\"line\"><span class=\"comment\"># åˆ‡æ¢ context</span></span><br><span class=\"line\">kubectl config use-context &lt;context_name&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è·å–é›†ç¾¤åç§°</span></span><br><span class=\"line\">kubectl config get-clusters</span><br><span class=\"line\"><span class=\"comment\"># è·å–ç”¨æˆ·åç§°</span></span><br><span class=\"line\">kubectl config get-users</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æµ‹è¯•</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get node</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤é›†ç¾¤é…ç½®</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤ context</span></span><br><span class=\"line\">kubectl config delete-context &lt;context_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ cluster</span></span><br><span class=\"line\">kubectl config delete-cluster &lt;cluster_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ user</span></span><br><span class=\"line\">kubectl config delete-user &lt;user_name&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘ kubeconfigï¼ˆ~/.kube/configï¼‰ æ–‡ä»¶ï¼Œæ·»åŠ æˆ–åˆ é™¤ä¸éœ€è¦çš„é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github è¿œç¨‹è¿æ¥ k8s é›†ç¾¤ æœ¬åœ°ä¸å­˜åœ¨ kubeconfig æ–‡ä»¶ è·å– kubeconfig æ–‡ä»¶ï¼Œä½äº Master èŠ‚ç‚¹ï¼š/etc/kubernetes/admin.confï¼Œå°†å…¶æ‹·è´åˆ°æœ¬åœ° 1scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/config æœ¬åœ°å·²å­˜åœ¨ kubeconfig æ–‡ä»¶ å·²ç»é…ç½®äº†ä¸€ä¸ªé›†ç¾¤çš„è¿æ¥ï¼Œè¿˜æƒ³å†æ·»åŠ ä¸€ä¸ªé›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡é€šè¿‡åˆå¹¶çš„æ–¹å¼æ·»åŠ  123456# å°†æ–°é›†ç¾¤çš„ kubeconfig æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°scp k8s-master:/etc/kubernetes/admin.conf ~/.kube/new-cluster.conf# åˆå¹¶KUBECONFIG=~/.kube/config:new-cluster.conf kubectl config view --flatten &gt; merged-config.yaml# æ›¿æ¢mv merged-config.yaml ~/.kube/config é›†ç¾¤é…ç½®ç›¸å…³å‘½ä»¤ è·å–é›†ç¾¤é…ç½® 1234567891011# è·å–æ‰€æœ‰é›†ç¾¤é…ç½®kubectl config get-contexts# æŸ¥çœ‹å½“å‰é»˜è®¤çš„ contextkubectl config current-context# åˆ‡æ¢ contextkubectl config use-context &lt;context_name&gt;# è·å–é›†ç¾¤åç§°kubectl config get-clusters# è·å–ç”¨æˆ·åç§°kubectl config get-users æµ‹è¯• 1kubectl get node åˆ é™¤é›†ç¾¤é…ç½® 123456# åˆ é™¤ contextkubectl config delete-context &lt;context_name&gt;# åˆ é™¤ clusterkubectl config delete-cluster &lt;cluster_name&gt;# åˆ é™¤ userkubectl config delete-user &lt;user_name&gt; åè®° ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘ kubeconfigï¼ˆ~/.kube/configï¼‰ æ–‡ä»¶ï¼Œæ·»åŠ æˆ–åˆ é™¤ä¸éœ€è¦çš„é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ è¿œç¨‹è¿æ¥ æ–¹æ³•ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github","date_published":"2025-07-24T12:30:05.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/23/k8s-secret/","url":"https://blog.hanqunfeng.com/2025/07/23/k8s-secret/","title":"K8S ä¹‹ Secret","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/\">k8s Secret å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"Secret-ä»‹ç»\">Secret ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Secret æ˜¯ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€ä»¤ç‰Œæˆ–å¯†é’¥çš„å¯¹è±¡ã€‚ è¿™æ ·çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«æ”¾åœ¨ Pod è§„çº¦ä¸­æˆ–è€…é•œåƒä¸­ã€‚ ä½¿ç”¨ Secret æ„å‘³ç€ä½ ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­åŒ…å«æœºå¯†æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç”±äºåˆ›å»º Secret å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„ Podï¼Œ å› æ­¤åœ¨åˆ›å»ºã€æŸ¥çœ‹å’Œç¼–è¾‘ Pod çš„å·¥ä½œæµç¨‹ä¸­æš´éœ² Secretï¼ˆåŠå…¶æ•°æ®ï¼‰çš„é£é™©è¾ƒå°ã€‚ Kubernetes å’Œåœ¨é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å¯¹ Secret é‡‡å–é¢å¤–çš„é¢„é˜²æªæ–½ï¼Œ ä¾‹å¦‚é¿å…å°†æ•æ„Ÿæ•°æ®å†™å…¥éæ˜“å¤±æ€§å­˜å‚¨ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Secret ç±»ä¼¼äº ConfigMap ä½†ä¸“é—¨ç”¨äºä¿å­˜æœºå¯†æ•°æ®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª Secret çš„å°ºå¯¸æœ€å¤šä¸º 1MiB</p>\n</li>\n<li class=\"lvl-2\">\n<p>åœ¨ K8S ä¸­ï¼ŒSecret æœ‰å¤šç§ç±»å‹ï¼šæœ¬æ–‡åªè®²è§£ <code>Opaque</code> ç±»å‹ï¼Œå…¶ä½™ç±»å‹å‚è€ƒ[å®˜ç½‘]((<a href=\"https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/\">https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/</a>)ã€‚</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å†…ç½®ç±»å‹</th>\n<th>ç”¨æ³•æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Opaque</code></td>\n<td>ç”¨æˆ·è‡ªå®šä¹‰çš„ä»»æ„æ•°æ®ï¼ˆé»˜è®¤ç±»å‹ï¼‰</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/service-account-token</code></td>\n<td>è‡ªåŠ¨æŒ‚è½½çš„æœåŠ¡è´¦å·ä»¤ç‰Œï¼Œä¾› Pod è®¿é—® API ä½¿ç”¨</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/dockercfg</code></td>\n<td>åºåˆ—åŒ–çš„ <code>~/.dockercfg</code> æ–‡ä»¶ï¼Œç”¨äºç§æœ‰ä»“åº“è®¤è¯ï¼ˆæ—§æ ¼å¼ï¼‰</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/dockerconfigjson</code></td>\n<td>åºåˆ—åŒ–çš„ <code>~/.docker/config.json</code> æ–‡ä»¶ï¼ˆæ¨èï¼‰</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/basic-auth</code></td>\n<td>å­˜å‚¨ç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨äº HTTP åŸºæœ¬è®¤è¯</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/ssh-auth</code></td>\n<td>å­˜å‚¨ SSH ç§é’¥ï¼Œç”¨äº SSH èº«ä»½è®¤è¯</td>\n</tr>\n<tr>\n<td><code>kubernetes.io/tls</code></td>\n<td>å­˜å‚¨ TLS å¯†é’¥å’Œè¯ä¹¦ï¼Œç”¨äº HTTPS æˆ–æœåŠ¡åŠ å¯†é€šä¿¡</td>\n</tr>\n<tr>\n<td><code>bootstrap.kubernetes.io/token</code></td>\n<td>ç”¨äº kubelet åŠ å…¥é›†ç¾¤çš„å¼•å¯¼ä»¤ç‰Œ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Secret-åˆ›å»ºåŠä½¿ç”¨\">Secret åˆ›å»ºåŠä½¿ç”¨</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Secret ä¸ ConfigMap åˆ›å»ºåŠä½¿ç”¨ç±»ä¼¼ï¼Œéƒ½æ˜¯å­˜å‚¨é”®å€¼å¯¹ï¼Œä½†å­˜å‚¨å†…å®¹ä¸åŒï¼ŒSecret å­˜å‚¨çš„æ˜¯ Base64 ç¼–ç åçš„å†…å®¹ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ç¯å¢ƒå˜é‡å¼•ç”¨\">ç¯å¢ƒå˜é‡å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># mysevret.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">Opaque</span>                  <span class=\"comment\"># é»˜è®¤ç±»å‹ ï¼Œå¯ä»¥çœç•¥</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">YWRtaW4=</span>          <span class=\"comment\"># &quot;admin&quot; çš„ base64 ç¼–ç </span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">MWYyZDFlMmU2N2Rm</span>  <span class=\"comment\"># &quot;1f2d1e2e67df&quot; çš„ base64 ç¼–ç </span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># keyï¼švalue æ–¹å¼åˆ›å»ºï¼Œè¿™é‡Œ value å€¼æ˜¯ æ˜æ–‡ï¼Œk8s ä¼šè¿›è¡Œ base64 ç¼–ç </span></span><br><span class=\"line\">kubectl create secret generic my-secret \\</span><br><span class=\"line\">  --from-literal=username=admin \\</span><br><span class=\"line\">  --from-literal=password=1f2d1e2e67df</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶æ–¹å¼åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\"># --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ Secret ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚</span></span><br><span class=\"line\">kubectl create secret generic my-secret \\</span><br><span class=\"line\">  --from-env-file=username.env \\</span><br><span class=\"line\">  --from-env-file=password.env</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># username.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># username=admin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># password.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># password=1f2d1e2e67df</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ Secret çš„å†…å®¹</span></span><br><span class=\"line\">$ k get secrets my-secret -o yaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  password: MWYyZDFlMmU2N2Rm</span><br><span class=\"line\">  username: YWRtaW4=</span><br><span class=\"line\">kind: Secret</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T13:21:22Z&quot;</span></span><br><span class=\"line\">  name: my-secret</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;747355&quot;</span></span><br><span class=\"line\">  uid: 4f77269d-d4c3-4ae8-aafc-7cfa56b84a5d</span><br><span class=\"line\"><span class=\"built_in\">type</span>: Opaque</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-secret</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">      <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;printenv&quot;</span>] <span class=\"comment\"># æ‰“å°ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">      <span class=\"attr\">envFrom:</span>                  <span class=\"comment\"># ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€ Secret ï¼Œç­‰ç­‰</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">secretRef:</span>            <span class=\"comment\"># è¿™é‡Œå¼•ç”¨ Secret ï¼Œæ­¤å¤„å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span>     <span class=\"comment\"># Secret åç§°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† Secret ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod2.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-secret2</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">args:</span>                       <span class=\"comment\"># å®¹å™¨å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;username: $&#123;SECRET_USERNAME&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;password: $&#123;SECRET_PASSWORD&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span>    <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">    <span class=\"attr\">env:</span>                        <span class=\"comment\"># ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">SECRET_USERNAME</span>     <span class=\"comment\"># è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span>                <span class=\"comment\"># value æ¥æº</span></span><br><span class=\"line\">        <span class=\"attr\">secretKeyRef:</span>           <span class=\"comment\"># å¼•ç”¨ Secret ä¸­çš„ key</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span>       <span class=\"comment\"># Secret åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">username</span>         <span class=\"comment\"># Secret ä¸­ key çš„åç§°</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">SECRET_PASSWORD</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">        <span class=\"attr\">secretKeyRef:</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">password</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹podæ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k logs pods/env-secret</span><br><span class=\"line\">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT=443</span><br><span class=\"line\">HOSTNAME=env-secret</span><br><span class=\"line\">SHLVL=1</span><br><span class=\"line\">username=admin</span><br><span class=\"line\">HOME=/root</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br><span class=\"line\">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class=\"line\">password=1f2d1e2e67df</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class=\"line\">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br><span class=\"line\">PWD=/</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ k logs pods/env-secret2</span><br><span class=\"line\">username: admin</span><br><span class=\"line\">password: 1f2d1e2e67df</span><br></pre></td></tr></table></figure>\n<h3 id=\"å­˜å‚¨å·å¼•ç”¨\">å­˜å‚¨å·å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># secret-configfile.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">Opaque</span></span><br><span class=\"line\"><span class=\"attr\">stringData:</span>                          <span class=\"comment\"># ä½¿ç”¨ stringDataï¼ŒK8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç </span></span><br><span class=\"line\">  <span class=\"attr\">app.properties:</span> <span class=\"string\">|</span>                  <span class=\"comment\"># æ–‡ä»¶å</span></span><br><span class=\"line\">    <span class=\"string\">server.port=8080</span></span><br><span class=\"line\">    <span class=\"string\">log.level=INFO</span></span><br><span class=\"line\">  <span class=\"attr\">db.properties:</span> <span class=\"string\">|</span>                   <span class=\"comment\"># æ–‡ä»¶å</span></span><br><span class=\"line\">    <span class=\"string\">db.host=localhost</span></span><br><span class=\"line\">    <span class=\"string\">db.port=5432</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶å†…å®¹æ˜¯æ˜æ–‡ï¼Œk8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç </span></span><br><span class=\"line\">kubectl create secret generic my-secret \\</span><br><span class=\"line\">  --from-file=app.properties \\</span><br><span class=\"line\">  --from-file=db.properties</span><br><span class=\"line\"><span class=\"comment\"># app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># server.port=8080</span></span><br><span class=\"line\"><span class=\"comment\"># log.level=INFO</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># db.host=localhost</span></span><br><span class=\"line\"><span class=\"comment\"># db.port=5432</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ k get secrets my-secret -oyaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  app.properties: c2VydmVyLnBvcnQ9ODA4MApsb2cubGV2ZWw9SU5GTwo=</span><br><span class=\"line\">  db.properties: ZGIuaG9zdD1sb2NhbGhvc3QKZGIucG9ydD0xMjU0MzIK</span><br><span class=\"line\">kind: Secret</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T13:45:14Z&quot;</span></span><br><span class=\"line\">  name: my-secret</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;750742&quot;</span></span><br><span class=\"line\">  uid: 35ffcdd6-d70a-4f3a-9246-5c56da630bc1</span><br><span class=\"line\"><span class=\"built_in\">type</span>: Opaque</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod æŒ‚è½½ Secret ä¸ºæ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># secret-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">secret-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span>              <span class=\"comment\"># æŒ‚è½½è·¯å¾„</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span>                   <span class=\"comment\"># å­˜å‚¨å· åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">secret:</span>                               <span class=\"comment\"># å­˜å‚¨å·ç±»å‹ä¸º Secret</span></span><br><span class=\"line\">      <span class=\"attr\">secretName:</span> <span class=\"string\">my-secret</span>               <span class=\"comment\"># æŒ‚è½½çš„ Secret åç§°ï¼Œæœ¬åˆ©ä¸­å°† Secret ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å™¨å†…çš„ <code>/etc/config/</code> ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/config/app.properties</span><br><span class=\"line\">/etc/config/db.properties</span><br><span class=\"line\"></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it secret-demo -- <span class=\"built_in\">ls</span> /etc/config/</span><br><span class=\"line\">app.properties  db.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæƒ³æŒ‚è½½ Secret ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>items</code> å­—æ®µæŒ‡å®šï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># secret-pod2.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">secret-demo2</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">    <span class=\"attr\">secret:</span></span><br><span class=\"line\">      <span class=\"attr\">secretName:</span> <span class=\"string\">my-secret</span></span><br><span class=\"line\">      <span class=\"attr\">items:</span>                   <span class=\"comment\"># æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">app.properties</span>    <span class=\"comment\"># secret ä¸­çš„key</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">app.properties</span>   <span class=\"comment\"># æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Secret çš„ç‰¹ç‚¹ä¸ä½¿ç”¨æ–¹æ³•ä¸ ConfigMap éå¸¸ç±»ä¼¼ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ğŸ” ConfigMap vs Secret å¯¹æ¯”è¡¨ï¼š</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>ConfigMap</th>\n<th>Secret</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ç”¨é€”</strong></td>\n<td>å­˜å‚¨éæ•æ„Ÿé…ç½®ä¿¡æ¯ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ï¼‰</td>\n<td>å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€è¯ä¹¦ã€tokenï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ•°æ®æ˜¯å¦åŠ å¯†</strong></td>\n<td>å¦ï¼Œæ˜æ–‡å­˜å‚¨ï¼ˆBase64 ç¼–ç å¯è¯»ï¼‰</td>\n<td>å¦ï¼ˆé»˜è®¤ Base64 ç¼–ç ï¼‰ï¼Œå¯é…ç½®åŠ å¯†å­˜å‚¨ï¼ˆå¦‚ä½¿ç”¨ KMSï¼‰</td>\n</tr>\n<tr>\n<td><strong>å­—æ®µå</strong></td>\n<td><code>data</code> / <code>binaryData</code></td>\n<td><code>data</code>ï¼ˆéœ€ base64ï¼‰ / <code>stringData</code>ï¼ˆæ˜æ–‡ï¼‰</td>\n</tr>\n<tr>\n<td><strong>å¯å­˜å‚¨çš„æœ€å¤§å¤§å°</strong></td>\n<td>æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB</td>\n<td>æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB</td>\n</tr>\n<tr>\n<td><strong>æ”¯æŒçš„æŒ‚è½½æ–¹å¼</strong></td>\n<td>- ç¯å¢ƒå˜é‡<br>- å·ï¼ˆæ–‡ä»¶ï¼‰</td>\n<td>- ç¯å¢ƒå˜é‡<br>- å·ï¼ˆæ–‡ä»¶ï¼‰</td>\n</tr>\n<tr>\n<td><strong>é»˜è®¤ç±»å‹ï¼ˆtypeï¼‰</strong></td>\n<td>æ— ç±»å‹å­—æ®µ</td>\n<td>é»˜è®¤ä¸º <code>Opaque</code></td>\n</tr>\n<tr>\n<td><strong>å¯å®šä¹‰ä¸ºå¤šä¸ªæ–‡ä»¶æŒ‚è½½</strong></td>\n<td>âœ…</td>\n<td>âœ…</td>\n</tr>\n<tr>\n<td><strong>é»˜è®¤ RBAC è®¿é—®æ§åˆ¶å¼ºåº¦</strong></td>\n<td>å¼±ï¼ˆå¤šæ•°ç”¨æˆ·/Pod å¯è¯»å–ï¼‰</td>\n<td>å¼ºï¼ˆé»˜è®¤å—é™è®¿é—®ï¼‰</td>\n</tr>\n<tr>\n<td><strong>æ”¯æŒçš„å†…ç½®ç±»å‹</strong></td>\n<td>æ— </td>\n<td>âœ… å¦‚ï¼š<code>kubernetes.io/tls</code>ã€<code>kubernetes.io/basic-auth</code> ç­‰</td>\n</tr>\n<tr>\n<td><strong>æ˜¯å¦é€‚åˆå­˜å‚¨å¯†é’¥/å¯†ç </strong></td>\n<td>âŒ ä¸æ¨è</td>\n<td>âœ… æ¨è</td>\n</tr>\n<tr>\n<td><strong>å¯è§†åŒ–æ˜æ–‡è¯»å–</strong></td>\n<td>âœ… ç›´æ¥è¯»å–</td>\n<td>âœ… ä½† Base64 ç¼–ç åéœ€è¦è§£ç </td>\n</tr>\n<tr>\n<td><strong>å¸¸è§ç”¨é€”ç¤ºä¾‹</strong></td>\n<td>App é…ç½®ã€æ—¥å¿—çº§åˆ«ã€è¿æ¥å‚æ•°ç­‰</td>\n<td>æ•°æ®åº“å¯†ç ã€TLS è¯ä¹¦ã€API Token ç­‰</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Secret å®˜æ–¹æ–‡æ¡£ Secret ä»‹ç» Secret æ˜¯ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€ä»¤ç‰Œæˆ–å¯†é’¥çš„å¯¹è±¡ã€‚ è¿™æ ·çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«æ”¾åœ¨ Pod è§„çº¦ä¸­æˆ–è€…é•œåƒä¸­ã€‚ ä½¿ç”¨ Secret æ„å‘³ç€ä½ ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­åŒ…å«æœºå¯†æ•°æ®ã€‚ ç”±äºåˆ›å»º Secret å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„ Podï¼Œ å› æ­¤åœ¨åˆ›å»ºã€æŸ¥çœ‹å’Œç¼–è¾‘ Pod çš„å·¥ä½œæµç¨‹ä¸­æš´éœ² Secretï¼ˆåŠå…¶æ•°æ®ï¼‰çš„é£é™©è¾ƒå°ã€‚ Kubernetes å’Œåœ¨é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å¯¹ Secret é‡‡å–é¢å¤–çš„é¢„é˜²æªæ–½ï¼Œ ä¾‹å¦‚é¿å…å°†æ•æ„Ÿæ•°æ®å†™å…¥éæ˜“å¤±æ€§å­˜å‚¨ã€‚ Secret ç±»ä¼¼äº ConfigMap ä½†ä¸“é—¨ç”¨äºä¿å­˜æœºå¯†æ•°æ®ã€‚ æ¯ä¸ª Secret çš„å°ºå¯¸æœ€å¤šä¸º 1MiB åœ¨ K8S ä¸­ï¼ŒSecret æœ‰å¤šç§ç±»å‹ï¼šæœ¬æ–‡åªè®²è§£ Opaque ç±»å‹ï¼Œå…¶ä½™ç±»å‹å‚è€ƒ[å®˜ç½‘]((https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/)ã€‚ å†…ç½®ç±»å‹ ç”¨æ³•æè¿° Opaque ç”¨æˆ·è‡ªå®šä¹‰çš„ä»»æ„æ•°æ®ï¼ˆé»˜è®¤ç±»å‹ï¼‰ kubernetes.io/service-account-token è‡ªåŠ¨æŒ‚è½½çš„æœåŠ¡è´¦å·ä»¤ç‰Œï¼Œä¾› Pod è®¿é—® API ä½¿ç”¨ kubernetes.io/dockercfg åºåˆ—åŒ–çš„ ~/.dockercfg æ–‡ä»¶ï¼Œç”¨äºç§æœ‰ä»“åº“è®¤è¯ï¼ˆæ—§æ ¼å¼ï¼‰ kubernetes.io/dockerconfigjson åºåˆ—åŒ–çš„ ~/.docker/config.json æ–‡ä»¶ï¼ˆæ¨èï¼‰ kubernetes.io/basic-auth å­˜å‚¨ç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨äº HTTP åŸºæœ¬è®¤è¯ kubernetes.io/ssh-auth å­˜å‚¨ SSH ç§é’¥ï¼Œç”¨äº SSH èº«ä»½è®¤è¯ kubernetes.io/tls å­˜å‚¨ TLS å¯†é’¥å’Œè¯ä¹¦ï¼Œç”¨äº HTTPS æˆ–æœåŠ¡åŠ å¯†é€šä¿¡ bootstrap.kubernetes.io/token ç”¨äº kubelet åŠ å…¥é›†ç¾¤çš„å¼•å¯¼ä»¤ç‰Œ Secret åˆ›å»ºåŠä½¿ç”¨ Secret ä¸ ConfigMap åˆ›å»ºåŠä½¿ç”¨ç±»ä¼¼ï¼Œéƒ½æ˜¯å­˜å‚¨é”®å€¼å¯¹ï¼Œä½†å­˜å‚¨å†…å®¹ä¸åŒï¼ŒSecret å­˜å‚¨çš„æ˜¯ Base64 ç¼–ç åçš„å†…å®¹ã€‚ ç¯å¢ƒå˜é‡å¼•ç”¨ yamlåˆ›å»º 12345678910# mysevret.yamlapiVersion: v1kind: Secretmetadata: name: my-secrettype: Opaque # é»˜è®¤ç±»å‹ ï¼Œå¯ä»¥çœç•¥data: username: YWRtaW4= # &quot;admin&quot; çš„ base64 ç¼–ç  password: MWYyZDFlMmU2N2Rm # &quot;1f2d1e2e67df&quot; çš„ base64 ç¼–ç  å‘½ä»¤è¡Œåˆ›å»º 12345678910111213141516171819202122232425262728293031# keyï¼švalue æ–¹å¼åˆ›å»ºï¼Œè¿™é‡Œ value å€¼æ˜¯ æ˜æ–‡ï¼Œk8s ä¼šè¿›è¡Œ base64 ç¼–ç kubectl create secret generic my-secret \\ --from-literal=username=admin \\ --from-literal=password=1f2d1e2e67df# æ–‡ä»¶æ–¹å¼åˆ›å»º# --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ Secret ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚kubectl create secret generic my-secret \\ --from-env-file=username.env \\ --from-env-file=password.env# username.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# username=admin# password.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# password=1f2d1e2e67df# åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ Secret çš„å†…å®¹$ k get secrets my-secret -o yamlapiVersion: v1data: password: MWYyZDFlMmU2N2Rm username: YWRtaW4=kind: Secretmetadata: creationTimestamp: &quot;2025-07-05T13:21:22Z&quot; name: my-secret namespace: default resourceVersion: &quot;747355&quot; uid: 4f77269d-d4c3-4ae8-aafc-7cfa56b84a5dtype: Opaque å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213# pod.yamlapiVersion: v1kind: Podmetadata: name: env-secretspec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;printenv&quot;] # æ‰“å°ç¯å¢ƒå˜é‡ image: busybox:latest envFrom: # ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€ Secret ï¼Œç­‰ç­‰ - secretRef: # è¿™é‡Œå¼•ç”¨ Secret ï¼Œæ­¤å¤„å°† Secret ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ name: my-secret # Secret åç§° å°† Secret ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213141516171819202122232425# pod2.yamlapiVersion: v1kind: Podmetadata: name: env-secret2spec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;] args: # å®¹å™¨å¯åŠ¨å‘½ä»¤ - | echo &quot;username: $&#123;SECRET_USERNAME&#125;&quot; echo &quot;password: $&#123;SECRET_PASSWORD&#125;&quot; image: busybox:latest env: # ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼ - name: SECRET_USERNAME # è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key valueFrom: # value æ¥æº secretKeyRef: # å¼•ç”¨ Secret ä¸­çš„ key name: my-secret # Secret åç§° key: username # Secret ä¸­ key çš„åç§° - name: SECRET_PASSWORD valueFrom: secretKeyRef: name: my-secret key: password æŸ¥çœ‹podæ—¥å¿— 123456789101112131415161718192021$ k logs pods/env-secretKUBERNETES_PORT=tcp://10.96.0.1:443KUBERNETES_SERVICE_PORT=443HOSTNAME=env-secretSHLVL=1username=adminHOME=/rootKUBERNETES_PORT_443_TCP_ADDR=10.96.0.1PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binKUBERNETES_PORT_443_TCP_PORT=443password=1f2d1e2e67dfKUBERNETES_PORT_443_TCP_PROTO=tcpKUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443KUBERNETES_SERVICE_PORT_HTTPS=443KUBERNETES_SERVICE_HOST=10.96.0.1PWD=/$ k logs pods/env-secret2username: adminpassword: 1f2d1e2e67df å­˜å‚¨å·å¼•ç”¨ yamlåˆ›å»º 1234567891011121314# secret-configfile.yamlapiVersion: v1kind: Secretmetadata: name: my-secrettype: OpaquestringData: # ä½¿ç”¨ stringDataï¼ŒK8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç  app.properties: | # æ–‡ä»¶å server.port=8080 log.level=INFO db.properties: | # æ–‡ä»¶å db.host=localhost db.port=5432 å‘½ä»¤è¡Œåˆ›å»º 1234567891011121314151617181920212223242526# æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡# æ–‡ä»¶å†…å®¹æ˜¯æ˜æ–‡ï¼Œk8s ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º base64 ç¼–ç kubectl create secret generic my-secret \\ --from-file=app.properties \\ --from-file=db.properties# app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# server.port=8080# log.level=INFO# db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# db.host=localhost# db.port=5432$ k get secrets my-secret -oyamlapiVersion: v1data: app.properties: c2VydmVyLnBvcnQ9ODA4MApsb2cubGV2ZWw9SU5GTwo= db.properties: ZGIuaG9zdD1sb2NhbGhvc3QKZGIucG9ydD0xMjU0MzIKkind: Secretmetadata: creationTimestamp: &quot;2025-07-05T13:45:14Z&quot; name: my-secret namespace: default resourceVersion: &quot;750742&quot; uid: 35ffcdd6-d70a-4f3a-9246-5c56da630bc1type: Opaque Pod æŒ‚è½½ Secret ä¸ºæ–‡ä»¶ 123456789101112131415161718# secret-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼šapiVersion: v1kind: Podmetadata: name: secret-demospec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config # æŒ‚è½½è·¯å¾„ readOnly: true volumes: - name: config-volume # å­˜å‚¨å· åç§° secret: # å­˜å‚¨å·ç±»å‹ä¸º Secret secretName: my-secret # æŒ‚è½½çš„ Secret åç§°ï¼Œæœ¬åˆ©ä¸­å°† Secret ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹ å®¹å™¨å†…çš„ /etc/config/ ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š 12345/etc/config/app.properties/etc/config/db.properties$ k exec -it secret-demo -- ls /etc/config/app.properties db.properties å¦‚æœåªæƒ³æŒ‚è½½ Secret ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ items å­—æ®µæŒ‡å®šï¼š 123456789101112131415161718192021# secret-pod2.yamlapiVersion: v1kind: Podmetadata: name: secret-demo2spec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config readOnly: true volumes: - name: config-volume secret: secretName: my-secret items: # æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key - key: app.properties # secret ä¸­çš„key path: app.properties # æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties åè®° Secret çš„ç‰¹ç‚¹ä¸ä½¿ç”¨æ–¹æ³•ä¸ ConfigMap éå¸¸ç±»ä¼¼ã€‚ ğŸ” ConfigMap vs Secret å¯¹æ¯”è¡¨ï¼š ç‰¹æ€§ ConfigMap Secret ç”¨é€” å­˜å‚¨éæ•æ„Ÿé…ç½®ä¿¡æ¯ï¼ˆå¦‚ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ï¼‰ å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€è¯ä¹¦ã€tokenï¼‰ æ•°æ®æ˜¯å¦åŠ å¯† å¦ï¼Œæ˜æ–‡å­˜å‚¨ï¼ˆBase64 ç¼–ç å¯è¯»ï¼‰ å¦ï¼ˆé»˜è®¤ Base64 ç¼–ç ï¼‰ï¼Œå¯é…ç½®åŠ å¯†å­˜å‚¨ï¼ˆå¦‚ä½¿ç”¨ KMSï¼‰ å­—æ®µå data / binaryData dataï¼ˆéœ€ base64ï¼‰ / stringDataï¼ˆæ˜æ–‡ï¼‰ å¯å­˜å‚¨çš„æœ€å¤§å¤§å° æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB æ¯ä¸ªå¯¹è±¡æœ€å¤šçº¦ 1MB æ”¯æŒçš„æŒ‚è½½æ–¹å¼ - ç¯å¢ƒå˜é‡- å·ï¼ˆæ–‡ä»¶ï¼‰ - ç¯å¢ƒå˜é‡- å·ï¼ˆæ–‡ä»¶ï¼‰ é»˜è®¤ç±»å‹ï¼ˆtypeï¼‰ æ— ç±»å‹å­—æ®µ é»˜è®¤ä¸º Opaque å¯å®šä¹‰ä¸ºå¤šä¸ªæ–‡ä»¶æŒ‚è½½ âœ… âœ… é»˜è®¤ RBAC è®¿é—®æ§åˆ¶å¼ºåº¦ å¼±ï¼ˆå¤šæ•°ç”¨æˆ·/Pod å¯è¯»å–ï¼‰ å¼ºï¼ˆé»˜è®¤å—é™è®¿é—®ï¼‰ æ”¯æŒçš„å†…ç½®ç±»å‹ æ—  âœ… å¦‚ï¼škubernetes.io/tlsã€kubernetes.io/basic-auth ç­‰ æ˜¯å¦é€‚åˆå­˜å‚¨å¯†é’¥/å¯†ç  âŒ ä¸æ¨è âœ… æ¨è å¯è§†åŒ–æ˜æ–‡è¯»å– âœ… ç›´æ¥è¯»å– âœ… ä½† Base64 ç¼–ç åéœ€è¦è§£ç  å¸¸è§ç”¨é€”ç¤ºä¾‹ App é…ç½®ã€æ—¥å¿—çº§åˆ«ã€è¿æ¥å‚æ•°ç­‰ æ•°æ®åº“å¯†ç ã€TLS è¯ä¹¦ã€API Token ç­‰","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ Secret ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s Secret å®˜æ–¹æ–‡æ¡£","date_published":"2025-07-23T13:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/23/k8s-configmap/","url":"https://blog.hanqunfeng.com/2025/07/23/k8s-configmap/","title":"K8S ä¹‹ ConfigMap","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/\">k8s ConfigMap å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"ConfigMap-åˆ«åcm-ä»‹ç»\">ConfigMap(åˆ«åcm) ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ConfigMap æ˜¯ä¸€ç§ API å¯¹è±¡ï¼Œç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨æ—¶ï¼Œ Pod å¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ConfigMap å°†ä½ çš„ç¯å¢ƒé…ç½®ä¿¡æ¯å’Œå®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¤šä¸ª Pod å¯ä»¥å…³è”åŒä¸€ä¸ª ConfigMap</p>\n</li>\n</ul>\n<h2 id=\"ConfigMap-åˆ›å»ºåŠä½¿ç”¨\">ConfigMap åˆ›å»ºåŠä½¿ç”¨</h2>\n<h3 id=\"ç¯å¢ƒå˜é‡å¼•ç”¨\">ç¯å¢ƒå˜é‡å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># configmap.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span>       <span class=\"comment\"># ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span>   <span class=\"comment\"># configmap åç§°</span></span><br><span class=\"line\"><span class=\"attr\">data:</span>                 <span class=\"comment\"># data å­—æ®µè®¾è®¡ç”¨æ¥ä¿å­˜ UTF-8 å­—ç¬¦ä¸²ï¼Œæœ€å¤§å€¼ä¸º 1M</span></span><br><span class=\"line\">  <span class=\"attr\">username:</span> <span class=\"string\">k8s-admin</span> <span class=\"comment\"># key: value</span></span><br><span class=\"line\">  <span class=\"attr\">access_level:</span> <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">&quot;123456&quot;</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># keyï¼švalue æ–¹å¼åˆ›å»º</span></span><br><span class=\"line\">kubectl create configmap myconfigmap --from-literal=username=k8s-admin --from-literal=access_level=1 --from-literal=password=123456</span><br><span class=\"line\"><span class=\"comment\"># æ–‡ä»¶æ–¹å¼åˆ›å»º</span></span><br><span class=\"line\"><span class=\"comment\"># --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ ConfigMap ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚</span></span><br><span class=\"line\">kubectl create configmap myconfigmap --from-env-file=app.env --from-env-file=other.env</span><br><span class=\"line\"><span class=\"comment\"># app.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># username=k8s-admin</span></span><br><span class=\"line\"><span class=\"comment\"># access_level=1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># other.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># password=123456</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ ConfigMap çš„å†…å®¹</span></span><br><span class=\"line\">$ k get cm myconfigmap -oyaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  access_level: <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">  password: <span class=\"string\">&quot;123456&quot;</span></span><br><span class=\"line\">  username: k8s-admin</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T10:29:15Z&quot;</span></span><br><span class=\"line\">  name: myconfigmap</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;723770&quot;</span></span><br><span class=\"line\">  uid: ee850cf9-9014-4be2-97d8-5d1840e78d54</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-configmap</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">      <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;printenv&quot;</span>] <span class=\"comment\"># æ‰“å°ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">      <span class=\"attr\">envFrom:</span>                  <span class=\"comment\"># ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€configMapï¼Œç­‰ç­‰</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">configMapRef:</span>         <span class=\"comment\"># è¿™é‡Œå¼•ç”¨ ConfigMapï¼Œæ­¤å¤„å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span>   <span class=\"comment\"># configMap åç§°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å°† ConfigMap ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pod2.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">env-configmap2</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">app</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;/bin/sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">args:</span>                       <span class=\"comment\"># å®¹å™¨å¯åŠ¨å‘½ä»¤</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;username: $&#123;CONFIGMAP_USERNAME&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        echo &quot;password: $&#123;CONFIGMAP_PASSWORD&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span>    <span class=\"attr\">image:</span> <span class=\"string\">busybox:latest</span></span><br><span class=\"line\">    <span class=\"attr\">env:</span>                        <span class=\"comment\"># ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">CONFIGMAP_USERNAME</span>  <span class=\"comment\"># è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span>                <span class=\"comment\"># value æ¥æº</span></span><br><span class=\"line\">        <span class=\"attr\">configMapKeyRef:</span>        <span class=\"comment\"># å¼•ç”¨ ConfigMap ä¸­çš„ key</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span>     <span class=\"comment\"># configMap åç§°</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">username</span>         <span class=\"comment\"># configMap ä¸­ key çš„åç§°</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">CONFIGMAP_PASSWORD</span></span><br><span class=\"line\">      <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">        <span class=\"attr\">configMapKeyRef:</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">myconfigmap</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">password</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æŸ¥çœ‹podæ—¥å¿—</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl logs pods/env-configmap</span><br><span class=\"line\">access_level=1</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT=443</span><br><span class=\"line\">KUBERNETES_PORT=tcp://10.96.0.1:443</span><br><span class=\"line\">HOSTNAME=env-configmap</span><br><span class=\"line\">SHLVL=1</span><br><span class=\"line\">username=k8s-admin</span><br><span class=\"line\">HOME=/root</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span><br><span class=\"line\">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class=\"line\">password=123456</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class=\"line\">KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span><br><span class=\"line\">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class=\"line\">KUBERNETES_SERVICE_HOST=10.96.0.1</span><br><span class=\"line\">PWD=/</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl logs pods/env-configmap2</span><br><span class=\"line\">username: k8s-admin</span><br><span class=\"line\">password: 123456</span><br></pre></td></tr></table></figure>\n<h3 id=\"å­˜å‚¨å·å¼•ç”¨\">å­˜å‚¨å·å¼•ç”¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>yamlåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># configmap-configfile.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">app-config</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">app.properties:</span> <span class=\"string\">|</span>  <span class=\"comment\"># æ–‡ä»¶åç§° ï¼Œä½¿ç”¨ | åˆ›å»ºå¤šè¡Œ</span></span><br><span class=\"line\">    <span class=\"string\">server.port=8080</span></span><br><span class=\"line\">    <span class=\"string\">log.level=INFO</span></span><br><span class=\"line\">  <span class=\"attr\">db.properties:</span> <span class=\"string\">|</span>   <span class=\"comment\"># æ–‡ä»¶åç§°</span></span><br><span class=\"line\">    <span class=\"string\">db.host=localhost</span></span><br><span class=\"line\">    <span class=\"string\">db.port=5432</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å‘½ä»¤è¡Œåˆ›å»º</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\"># æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡</span></span><br><span class=\"line\">kubectl create configmap app-config \\</span><br><span class=\"line\">  --from-file=app.properties \\</span><br><span class=\"line\">  --from-file=db.properties</span><br><span class=\"line\"><span class=\"comment\"># app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># server.port=8080</span></span><br><span class=\"line\"><span class=\"comment\"># log.level=INFO</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"># db.host=localhost</span></span><br><span class=\"line\"><span class=\"comment\"># db.port=5432</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ k get cm app-config -oyaml</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">data:</span><br><span class=\"line\">  app.properties: |</span><br><span class=\"line\">    server.port=8080</span><br><span class=\"line\">    log.level=INFO</span><br><span class=\"line\">  db.properties: |</span><br><span class=\"line\">    db.host=localhost</span><br><span class=\"line\">    db.port=5432</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  creationTimestamp: <span class=\"string\">&quot;2025-07-05T10:49:00Z&quot;</span></span><br><span class=\"line\">  name: app-config</span><br><span class=\"line\">  namespace: default</span><br><span class=\"line\">  resourceVersion: <span class=\"string\">&quot;726507&quot;</span></span><br><span class=\"line\">  uid: 05c9a228-ec69-4e88-b8d8-63f97eff2651</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod æŒ‚è½½ ConfigMap ä¸ºæ–‡ä»¶</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># configmap-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">configmap-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span>              <span class=\"comment\"># æŒ‚è½½è·¯å¾„</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span>                   <span class=\"comment\"># å­˜å‚¨å· åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">configMap:</span>                            <span class=\"comment\"># å­˜å‚¨å·ç±»å‹ä¸º ConfigMap</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">app-config</span>                    <span class=\"comment\"># æŒ‚è½½çš„ ConfigMap åç§°ï¼Œæœ¬åˆ©ä¸­å°† configMap ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®¹å™¨å†…çš„ <code>/etc/config/</code> ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/config/app.properties</span><br><span class=\"line\">/etc/config/db.properties</span><br><span class=\"line\"></span><br><span class=\"line\">$ k <span class=\"built_in\">exec</span> -it configmap-demo -- <span class=\"built_in\">ls</span> /etc/config/</span><br><span class=\"line\">app.properties  db.properties</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¦‚æœåªæƒ³æŒ‚è½½ ConfigMap ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>items</code> å­—æ®µæŒ‡å®šï¼š</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">configmap-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sleep&quot;</span>, <span class=\"string\">&quot;3600&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">      <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/config</span></span><br><span class=\"line\">      <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">config-volume</span></span><br><span class=\"line\">    <span class=\"attr\">configMap:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">app-config</span></span><br><span class=\"line\">      <span class=\"attr\">items:</span>                   <span class=\"comment\"># æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">app.properties</span>    <span class=\"comment\"># configMapä¸­çš„key</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">app.properties</span>   <span class=\"comment\"># æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><code>--from-env-file=app.env</code> ä¸ <code>--from-file=app.env</code> çš„åŒºåˆ«</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>é¡¹ç›®</th>\n<th><code>--from-env-file=app.env</code></th>\n<th><code>--from-file=app.env</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ç”¨é€”</td>\n<td>è§£æä¸ºç¯å¢ƒå˜é‡å½¢å¼é”®å€¼å¯¹</td>\n<td>æŒ‰æ–‡ä»¶æ•´ä½“è¯»å…¥ä¸ºå†…å®¹</td>\n</tr>\n<tr>\n<td>é€‚åˆåœºæ™¯</td>\n<td>æƒ³æŠŠæ¯ä¸ªå˜é‡éƒ½å•ç‹¬ç”¨æ‰</td>\n<td>æŒ‚è½½ä¸ºé…ç½®æ–‡ä»¶ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>data ç»“æ„</td>\n<td>æ¯ä¸€è¡Œå˜ä¸€ä¸ªé”®å€¼å¯¹</td>\n<td>æ–‡ä»¶åä¸º keyï¼Œå†…å®¹ä¸ºå€¼</td>\n</tr>\n<tr>\n<td>è¯»å–æ–¹å¼</td>\n<td>ç”¨ <code>envFrom</code> æ³¨å…¥ç¯å¢ƒå˜é‡</td>\n<td>ç”¨ <code>volumeMount</code> æŒ‚è½½æ•´ä¸ªæ–‡ä»¶</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ConfigMap ä¹Ÿæ”¯æŒ <code>äºŒè¿›åˆ¶</code> æ•°æ®ï¼Œä½†éœ€è¦ç”¨ <code>base64</code> ç¼–ç </p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-config</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">config.txt:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    Hello, world!</span></span><br><span class=\"line\"><span class=\"string\"></span><span class=\"attr\">binaryData:</span></span><br><span class=\"line\">  <span class=\"attr\">config.bin:</span> <span class=\"string\">aGVsbG8gd29ybGQK</span>   <span class=\"comment\"># è¿™æ˜¯ &quot;hello world&quot; çš„ base64 ç¼–ç </span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>binaryData å’Œ data çš„åŒºåˆ«</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>å­—æ®µ</th>\n<th>å†…å®¹ç±»å‹</th>\n<th>ç¼–ç æ–¹å¼</th>\n<th>é€‚åˆå­˜å‚¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>data</code></td>\n<td>æ–‡æœ¬ï¼ˆUTF-8ï¼‰</td>\n<td>æ˜æ–‡</td>\n<td>é…ç½®æ–‡ä»¶ã€å‚æ•°ã€è„šæœ¬ç­‰</td>\n</tr>\n<tr>\n<td><code>binaryData</code></td>\n<td>ä»»æ„äºŒè¿›åˆ¶æ•°æ®</td>\n<td>base64 ç¼–ç </td>\n<td>å›¾ç‰‡ã€è¯ä¹¦ã€éUTF-8æ–‡ä»¶ç­‰</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>â—æ³¨æ„äº‹é¡¹</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>é¡¹ç›®</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>base64 ç¼–ç æ ¼å¼</td>\n<td><code>binaryData</code> ä¸­çš„å€¼å¿…é¡»æ˜¯æ ‡å‡† base64ï¼Œä¸æ”¯æŒæ¢è¡Œ</td>\n</tr>\n<tr>\n<td>è§£ç åå¤§å°é™åˆ¶</td>\n<td>ConfigMap å•ä¸ªå¯¹è±¡æœ€å¤§ 1MBï¼ˆæ— è®º data è¿˜æ˜¯ binaryDataï¼‰</td>\n</tr>\n<tr>\n<td>äºŒè€…å¯å…±å­˜</td>\n<td><code>data</code> ä¸ <code>binaryData</code> å¯ä»¥åŒæ—¶å‡ºç°åœ¨åŒä¸€ä¸ª ConfigMap ä¸­ï¼ˆå­—æ®µåä¸èƒ½é‡å¤ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¿®æ”¹ ConfigMap å ï¼š<code>k edit configmap &lt;configmap-name&gt;</code></p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">å¦‚æœ Pod æ˜¯ä½œä¸º ç¯å¢ƒå˜é‡ å…³è”çš„ï¼ŒPod ä¸ä¼šæ›´æ–°ï¼Œåªèƒ½é‡æ–°åˆ›å»º</li>\n<li class=\"lvl-4\">å¦‚æœ Pod æ˜¯ä½œä¸º volume æŒ‚è½½çš„ï¼ŒPod ä¼šè‡ªåŠ¨æ›´æ–°(å¤§çº¦å‡ ç§’å)</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ é™¤ ConfigMap åï¼š<code>k delete configmap &lt;configmap-name&gt;</code></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Pod çŠ¶æ€</th>\n<th>ConfigMap åˆ é™¤åå½±å“</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ­£åœ¨è¿è¡Œ</td>\n<td>ä¸å—å½±å“</td>\n</tr>\n<tr>\n<td>é‡å¯ / æ‰©å®¹</td>\n<td><strong>å¤±è´¥</strong>ï¼šæ‰¾ä¸åˆ° ConfigMapï¼Œæ— æ³•åˆ›å»ºå®¹å™¨</td>\n</tr>\n</tbody>\n</table>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s ConfigMap å®˜æ–¹æ–‡æ¡£ ConfigMap(åˆ«åcm) ä»‹ç» ConfigMap æ˜¯ä¸€ç§ API å¯¹è±¡ï¼Œç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚ ä½¿ç”¨æ—¶ï¼Œ Pod å¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚ ConfigMap å°†ä½ çš„ç¯å¢ƒé…ç½®ä¿¡æ¯å’Œå®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹ã€‚ å¤šä¸ª Pod å¯ä»¥å…³è”åŒä¸€ä¸ª ConfigMap ConfigMap åˆ›å»ºåŠä½¿ç”¨ ç¯å¢ƒå˜é‡å¼•ç”¨ yamlåˆ›å»º 123456789# configmap.yamlapiVersion: v1kind: ConfigMap # ConfigMapmetadata: name: myconfigmap # configmap åç§°data: # data å­—æ®µè®¾è®¡ç”¨æ¥ä¿å­˜ UTF-8 å­—ç¬¦ä¸²ï¼Œæœ€å¤§å€¼ä¸º 1M username: k8s-admin # key: value access_level: &quot;1&quot; password: &quot;123456&quot; å‘½ä»¤è¡Œåˆ›å»º 1234567891011121314151617181920212223242526# keyï¼švalue æ–¹å¼åˆ›å»ºkubectl create configmap myconfigmap --from-literal=username=k8s-admin --from-literal=access_level=1 --from-literal=password=123456# æ–‡ä»¶æ–¹å¼åˆ›å»º# --from-env-file=app.env ä½œç”¨ï¼šå°† app.env ä¸­çš„æ¯ä¸€è¡Œè§£æä¸º key=valueï¼Œæ¯ä¸€è¡Œå˜æˆ ConfigMap ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚kubectl create configmap myconfigmap --from-env-file=app.env --from-env-file=other.env# app.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# username=k8s-admin# access_level=1# other.env æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# password=123456# åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ ConfigMap çš„å†…å®¹$ k get cm myconfigmap -oyamlapiVersion: v1data: access_level: &quot;1&quot; password: &quot;123456&quot; username: k8s-adminkind: ConfigMapmetadata: creationTimestamp: &quot;2025-07-05T10:29:15Z&quot; name: myconfigmap namespace: default resourceVersion: &quot;723770&quot; uid: ee850cf9-9014-4be2-97d8-5d1840e78d54 å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213# pod.yamlapiVersion: v1kind: Podmetadata: name: env-configmapspec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;printenv&quot;] # æ‰“å°ç¯å¢ƒå˜é‡ image: busybox:latest envFrom: # ç¯å¢ƒå˜é‡å¼•ç”¨æ–‡ä»¶ã€configMapï¼Œç­‰ç­‰ - configMapRef: # è¿™é‡Œå¼•ç”¨ ConfigMapï¼Œæ­¤å¤„å°† ConfigMap ä¸­çš„å…¨éƒ¨æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ name: myconfigmap # configMap åç§° å°† ConfigMap ä¸­çš„éƒ¨åˆ†æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ 12345678910111213141516171819202122232425# pod2.yamlapiVersion: v1kind: Podmetadata: name: env-configmap2spec: containers: - name: app command: [&quot;/bin/sh&quot;, &quot;-c&quot;] args: # å®¹å™¨å¯åŠ¨å‘½ä»¤ - | echo &quot;username: $&#123;CONFIGMAP_USERNAME&#125;&quot; echo &quot;password: $&#123;CONFIGMAP_PASSWORD&#125;&quot; image: busybox:latest env: # ç¯å¢ƒå˜é‡é…ç½®ï¼Œkey: value å½¢å¼ - name: CONFIGMAP_USERNAME # è¦åœ¨podä¸­é…ç½®çš„ç¯å¢ƒå˜é‡çš„ key valueFrom: # value æ¥æº configMapKeyRef: # å¼•ç”¨ ConfigMap ä¸­çš„ key name: myconfigmap # configMap åç§° key: username # configMap ä¸­ key çš„åç§° - name: CONFIGMAP_PASSWORD valueFrom: configMapKeyRef: name: myconfigmap key: password æŸ¥çœ‹podæ—¥å¿— 12345678910111213141516171819202122$ kubectl logs pods/env-configmapaccess_level=1KUBERNETES_SERVICE_PORT=443KUBERNETES_PORT=tcp://10.96.0.1:443HOSTNAME=env-configmapSHLVL=1username=k8s-adminHOME=/rootKUBERNETES_PORT_443_TCP_ADDR=10.96.0.1PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binKUBERNETES_PORT_443_TCP_PORT=443password=123456KUBERNETES_PORT_443_TCP_PROTO=tcpKUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443KUBERNETES_SERVICE_PORT_HTTPS=443KUBERNETES_SERVICE_HOST=10.96.0.1PWD=/$ kubectl logs pods/env-configmap2username: k8s-adminpassword: 123456 å­˜å‚¨å·å¼•ç”¨ yamlåˆ›å»º 123456789101112# configmap-configfile.yamlapiVersion: v1kind: ConfigMapmetadata: name: app-configdata: app.properties: | # æ–‡ä»¶åç§° ï¼Œä½¿ç”¨ | åˆ›å»ºå¤šè¡Œ server.port=8080 log.level=INFO db.properties: | # æ–‡ä»¶åç§° db.host=localhost db.port=5432 å‘½ä»¤è¡Œåˆ›å»º 12345678910111213141516171819202122232425262728 # æ³¨æ„è¿™é‡Œæ˜¯ --from-fileï¼Œä½œä¸ºæ–‡ä»¶é…ç½®ï¼Œè€Œéç¯å¢ƒå˜é‡kubectl create configmap app-config \\ --from-file=app.properties \\ --from-file=db.properties# app.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# server.port=8080# log.level=INFO# db.properties æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š# db.host=localhost# db.port=5432$ k get cm app-config -oyamlapiVersion: v1data: app.properties: | server.port=8080 log.level=INFO db.properties: | db.host=localhost db.port=5432kind: ConfigMapmetadata: creationTimestamp: &quot;2025-07-05T10:49:00Z&quot; name: app-config namespace: default resourceVersion: &quot;726507&quot; uid: 05c9a228-ec69-4e88-b8d8-63f97eff2651 Pod æŒ‚è½½ ConfigMap ä¸ºæ–‡ä»¶ 123456789101112131415161718# configmap-pod.yaml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼šapiVersion: v1kind: Podmetadata: name: configmap-demospec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config # æŒ‚è½½è·¯å¾„ readOnly: true volumes: - name: config-volume # å­˜å‚¨å· åç§° configMap: # å­˜å‚¨å·ç±»å‹ä¸º ConfigMap name: app-config # æŒ‚è½½çš„ ConfigMap åç§°ï¼Œæœ¬åˆ©ä¸­å°† configMap ä¸­çš„å…¨éƒ¨æ–‡ä»¶éƒ½æŒ‚è½½åˆ°podç›®å½•ä¸‹ å®¹å™¨å†…çš„ /etc/config/ ç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š 12345/etc/config/app.properties/etc/config/db.properties$ k exec -it configmap-demo -- ls /etc/config/app.properties db.properties å¦‚æœåªæƒ³æŒ‚è½½ ConfigMap ä¸­çš„æŸäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ items å­—æ®µæŒ‡å®šï¼š 1234567891011121314151617181920apiVersion: v1kind: Podmetadata: name: configmap-demospec: containers: - name: myapp image: busybox command: [&quot;sleep&quot;, &quot;3600&quot;] volumeMounts: - name: config-volume mountPath: /etc/config readOnly: true volumes: - name: config-volume configMap: name: app-config items: # æ˜ç¡®æŒ‡å®šæŒ‚è½½çš„key - key: app.properties # configMapä¸­çš„key path: app.properties # æ˜ å°„åˆ°å®¹å™¨å†…çš„è·¯å¾„ï¼Œæœ€ç»ˆæŒ‚è½½è·¯å¾„ä¸º /etc/config/app.properties åè®° --from-env-file=app.env ä¸ --from-file=app.env çš„åŒºåˆ« é¡¹ç›® --from-env-file=app.env --from-file=app.env ç”¨é€” è§£æä¸ºç¯å¢ƒå˜é‡å½¢å¼é”®å€¼å¯¹ æŒ‰æ–‡ä»¶æ•´ä½“è¯»å…¥ä¸ºå†…å®¹ é€‚åˆåœºæ™¯ æƒ³æŠŠæ¯ä¸ªå˜é‡éƒ½å•ç‹¬ç”¨æ‰ æŒ‚è½½ä¸ºé…ç½®æ–‡ä»¶ä½¿ç”¨ data ç»“æ„ æ¯ä¸€è¡Œå˜ä¸€ä¸ªé”®å€¼å¯¹ æ–‡ä»¶åä¸º keyï¼Œå†…å®¹ä¸ºå€¼ è¯»å–æ–¹å¼ ç”¨ envFrom æ³¨å…¥ç¯å¢ƒå˜é‡ ç”¨ volumeMount æŒ‚è½½æ•´ä¸ªæ–‡ä»¶ ConfigMap ä¹Ÿæ”¯æŒ äºŒè¿›åˆ¶ æ•°æ®ï¼Œä½†éœ€è¦ç”¨ base64 ç¼–ç  123456789apiVersion: v1kind: ConfigMapmetadata: name: my-configdata: config.txt: | Hello, world!binaryData: config.bin: aGVsbG8gd29ybGQK # è¿™æ˜¯ &quot;hello world&quot; çš„ base64 ç¼–ç  binaryData å’Œ data çš„åŒºåˆ« å­—æ®µ å†…å®¹ç±»å‹ ç¼–ç æ–¹å¼ é€‚åˆå­˜å‚¨ data æ–‡æœ¬ï¼ˆUTF-8ï¼‰ æ˜æ–‡ é…ç½®æ–‡ä»¶ã€å‚æ•°ã€è„šæœ¬ç­‰ binaryData ä»»æ„äºŒè¿›åˆ¶æ•°æ® base64 ç¼–ç  å›¾ç‰‡ã€è¯ä¹¦ã€éUTF-8æ–‡ä»¶ç­‰ â—æ³¨æ„äº‹é¡¹ é¡¹ç›® è¯´æ˜ base64 ç¼–ç æ ¼å¼ binaryData ä¸­çš„å€¼å¿…é¡»æ˜¯æ ‡å‡† base64ï¼Œä¸æ”¯æŒæ¢è¡Œ è§£ç åå¤§å°é™åˆ¶ ConfigMap å•ä¸ªå¯¹è±¡æœ€å¤§ 1MBï¼ˆæ— è®º data è¿˜æ˜¯ binaryDataï¼‰ äºŒè€…å¯å…±å­˜ data ä¸ binaryData å¯ä»¥åŒæ—¶å‡ºç°åœ¨åŒä¸€ä¸ª ConfigMap ä¸­ï¼ˆå­—æ®µåä¸èƒ½é‡å¤ï¼‰ ä¿®æ”¹ ConfigMap å ï¼šk edit configmap &lt;configmap-name&gt; å¦‚æœ Pod æ˜¯ä½œä¸º ç¯å¢ƒå˜é‡ å…³è”çš„ï¼ŒPod ä¸ä¼šæ›´æ–°ï¼Œåªèƒ½é‡æ–°åˆ›å»º å¦‚æœ Pod æ˜¯ä½œä¸º volume æŒ‚è½½çš„ï¼ŒPod ä¼šè‡ªåŠ¨æ›´æ–°(å¤§çº¦å‡ ç§’å) åˆ é™¤ ConfigMap åï¼šk delete configmap &lt;configmap-name&gt; Pod çŠ¶æ€ ConfigMap åˆ é™¤åå½±å“ æ­£åœ¨è¿è¡Œ ä¸å—å½±å“ é‡å¯ / æ‰©å®¹ å¤±è´¥ï¼šæ‰¾ä¸åˆ° ConfigMapï¼Œæ— æ³•åˆ›å»ºå®¹å™¨","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ ConfigMap ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s ConfigMap å®˜æ–¹æ–‡æ¡£","date_published":"2025-07-23T12:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/22/k8s-storageclass/","url":"https://blog.hanqunfeng.com/2025/07/22/k8s-storageclass/","title":"K8S ä¹‹ StorageClass","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/\">k8s StorageClass å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"StorageClass-åˆ«åsc-ä»‹ç»\">StorageClass(åˆ«åsc) ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>K8s çš„å­˜å‚¨èµ„æºåˆ†ä¸ºä¸¤ç§ä¾›åº”æ¨¡å¼ï¼šé™æ€ä¾›åº”æ¨¡å¼ å’Œ åŠ¨æ€ä¾›åº”æ¨¡å¼ã€‚</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">é™æ€æ¨¡å¼ä¸‹ï¼Œç®¡ç†å‘˜éœ€è¦é¢„å…ˆåˆ›å»ºè®¸å¤šPVï¼Œç­‰å¾… PVC  æ¥ç»‘å®šã€‚</li>\n<li class=\"lvl-4\">åŠ¨æ€æ¨¡å¼ä¸‹ï¼ŒKubernetes ä¼šé€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»º PVï¼Œå¹¶å®Œæˆä¸ PVC çš„ç»‘å®šã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>StorageClass æ˜¯ Kubernetes ä¸­ç”¨æ¥å®šä¹‰ <code>å­˜å‚¨åç«¯ç±»å‹å’Œé…ç½®å‚æ•°</code> çš„èµ„æº</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½œç”¨ï¼š è‡ªåŠ¨åˆ›å»º PVï¼ˆPersistentVolumeï¼‰çš„â€œæ¨¡æ¿â€æˆ–â€œè§„åˆ™â€</p>\n</li>\n<li class=\"lvl-2\">\n<p>ä½¿ç”¨åœºæ™¯ï¼š é…åˆ PVC ä½¿ç”¨æ—¶ï¼ŒKubernetes å¯ä»¥æ ¹æ® StorageClass è‡ªåŠ¨ åŠ¨æ€åˆ›å»º å¯¹åº”çš„æŒä¹…å·ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>âœ… æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">æ— éœ€æ‰‹åŠ¨åˆ›å»º PV</li>\n<li class=\"lvl-4\">æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆNFSã€äº‘ç›˜ã€Cephã€GlusterFSã€iSCSIâ€¦ï¼‰</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/OGGWYb.png\" alt=\"\"></p>\n<h2 id=\"åˆ›å»º-StorageClass\">åˆ›å»º StorageClass</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ª NFS çš„ StorageClass çš„ yaml ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nfs-storage.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">storage.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StorageClass</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-csi</span>                                           <span class=\"comment\"># å­˜å‚¨ç±»åç§°</span></span><br><span class=\"line\"><span class=\"attr\">provisioner:</span> <span class=\"string\">nfs.csi.k8s.io</span>                               <span class=\"comment\"># æŒ‡å®šå­˜å‚¨æ’ä»¶çš„ CSI é©±åŠ¨åç§°ï¼Œéœ€è¦å®‰è£… nfs-csi-driver</span></span><br><span class=\"line\"><span class=\"attr\">reclaimPolicy:</span> <span class=\"string\">Delete</span>                                     <span class=\"comment\"># Retainï¼šPVC åˆ é™¤åï¼ŒPV ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆæ•°æ®ä¿ç•™ï¼‰ï¼Œé»˜è®¤æ˜¯ Delete,ç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚</span></span><br><span class=\"line\"><span class=\"attr\">allowVolumeExpansion:</span> <span class=\"literal\">true</span>                                <span class=\"comment\"># æ˜¯å¦å…è®¸ PVC è‡ªåŠ¨æ‰©å®¹ï¼Œnfs æ”¯æŒæ‰©å®¹</span></span><br><span class=\"line\"><span class=\"attr\">mountOptions:</span>                                             <span class=\"comment\"># æŒ‚è½½é€‰é¡¹ï¼Œcsiæ’ä»¶ä¸åŒï¼Œé€‰é¡¹ä¸åŒã€‚è¿™é‡Œæ˜¯ nfsçš„</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">hard</span>                                                  <span class=\"comment\"># æœåŠ¡å™¨å¼‚å¸¸æ—¶å®¢æˆ·ç«¯ä¼šä¸€ç›´å‘è¯·æ±‚ç›´åˆ°æŒ‚è½½æˆåŠŸ</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nfsvers=4.1</span>                                           <span class=\"comment\"># nfsç‰ˆæœ¬    nfs4.1</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nolock</span>                                                <span class=\"comment\"># å…è®¸å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®</span></span><br><span class=\"line\"><span class=\"attr\">volumeBindingMode:</span> <span class=\"string\">Immediate</span>                              <span class=\"comment\"># é»˜è®¤å€¼ï¼šImmediate: åˆ›å»ºPVCæ—¶ç«‹å³ç»‘å®š ,WaitForFirstConsumerï¼šç­‰åˆ° Pod è°ƒåº¦åˆ°èŠ‚ç‚¹åå†åˆ†é…å·ï¼Œé€‚åˆå¤šå¯ç”¨åŒºåœºæ™¯</span></span><br><span class=\"line\"><span class=\"attr\">parameters:</span>                                               <span class=\"comment\"># å‚æ•°é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">server:</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.88</span>                                    <span class=\"comment\"># nfsæœåŠ¡å™¨åœ°å€</span></span><br><span class=\"line\">  <span class=\"attr\">share:</span> <span class=\"string\">/nfs-server/data</span>                                 <span class=\"comment\"># nfs-serverä¸Šçš„å­˜å‚¨ç›®å½•</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>csi-driver-nfs ä» v4.x èµ·ï¼Œå·²ç»æ”¯æŒ Delete reclaimPolicy å’Œ allowVolumeExpansion è‡ªåŠ¨æ‰©å®¹ã€‚<br>\nç”Ÿäº§ç¯å¢ƒæ…ç”¨ Delete reclaimPolicyï¼Œå› ä¸ºæ­¤æ—¶åˆ é™¤ PVC åï¼Œnfs-server ä¸Šçš„å­˜å‚¨ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</p>\n</blockquote>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª StorageClass é…ç½®ä¸­æœ‰ä¸‰ä¸ªå¿…å¡«çš„å‚æ•°ï¼š<code>provisioner</code>ã€<code>parameters</code> å’Œ <code>reclaimPolicy</code> å­—æ®µï¼Œ è¿™äº›å­—æ®µä¼šåœ¨ StorageClass éœ€è¦åŠ¨æ€åˆ¶å¤‡ PersistentVolume (PV) ä»¥æ»¡è¶³ PersistentVolumeClaim (PVC) æ—¶ä½¿ç”¨åˆ°ã€‚</p>\n</li>\n</ul>\n<h3 id=\"provisioner-å­˜å‚¨åˆ¶å¤‡å™¨\">provisioner: å­˜å‚¨åˆ¶å¤‡å™¨</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æ¯ä¸ª StorageClass éƒ½æœ‰ä¸€ä¸ªåˆ¶å¤‡å™¨ï¼ˆProvisionerï¼‰ï¼Œç”¨æ¥å†³å®šä½¿ç”¨å“ªä¸ªå·æ’ä»¶åˆ¶å¤‡ PVã€‚ è¯¥å­—æ®µå¿…é¡»æŒ‡å®šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>æ¯”å¦‚ NFS å­˜å‚¨åˆ¶å¤‡å™¨ï¼š<code>provisioner: nfs.csi.k8s.io</code>ï¼Œæ˜¯ K8S å®˜æ–¹ç»´æŠ¤çš„ NFS CSI æ’ä»¶ã€‚<a href=\"https://github.com/kubernetes-csi/csi-driver-nfs\">Github</a>ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å®‰è£… NFS CSI æ’ä»¶ï¼š<a href=\"https://github.com/kubernetes-csi/csi-driver-nfs/blob/master/docs/install-csi-driver-master.md\">Install NFS CSI Driver</a></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨çº¿å®‰è£…</span></span><br><span class=\"line\">curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/install-driver.sh | bash -s master --</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯</span></span><br><span class=\"line\">kubectl -n kube-system get pod -o wide -l app=csi-nfs-controller</span><br><span class=\"line\">kubectl -n kube-system get pod -o wide -l app=csi-nfs-node</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å¸è½½</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/uninstall-driver.sh | bash -s master --</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç¤ºä¾‹\">ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º StorageClass</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f nfs-storage.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## æŸ¥çœ‹ storageclass</span></span><br><span class=\"line\">$ k get sc</span><br><span class=\"line\">NAME      PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class=\"line\">nfs-csi   nfs.csi.k8s.io   Delete          Immediate           <span class=\"literal\">true</span>                   5s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º PVC æ—¶æŒ‡å®š storageclassï¼ŒStorageClass ä¼šè‡ªåŠ¨åˆ›å»º PV</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nfs-pvc.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-pvc</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">storageClassName:</span> <span class=\"string\">nfs-csi</span>  <span class=\"comment\"># æŒ‡å®š StorageClass çš„åç§°ï¼Œå¦‚æœè®¾ç½®äº†é»˜è®¤çš„scï¼Œæ­¤å¤„å¯ä»¥åˆ é™¤è¯¥é…ç½®</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>          <span class=\"comment\"># æŒ‡å®šè®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">800Mi</span>         <span class=\"comment\"># ç”³è¯·çš„å®¹é‡</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º PVC</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º PVC</span></span><br><span class=\"line\">$ k apply -f nfs-pvc.yaml</span><br><span class=\"line\">persistentvolumeclaim/nfs-pvc created</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ PVå’ŒPVCï¼Œå¯ä»¥çœ‹åˆ° PV è‡ªåŠ¨åˆ›å»ºäº†</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907   800Mi      RWX            Delete           Bound    default/nfs-pvc   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          2m4s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/nfs-pvc   Bound    pvc-c1d33fec-5e16-4156-8405-1af4fc171907   800Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 2m4s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è‡ªåŠ¨æ‰©å®¹ï¼Œä¿®æ”¹ PVC å®¹é‡åˆ° 1Gi</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl edit pvc nfs-pvc</span><br><span class=\"line\"><span class=\"comment\"># ä¿®æ”¹å¦‚ä¸‹</span></span><br><span class=\"line\"><span class=\"comment\"># &quot;storage&quot;:&quot;1Gi&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° è‡ªåŠ¨æ‰©å®¹æˆåŠŸ</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907   1Gi        RWX            Delete           Bound    default/nfs-pvc   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          4m50s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/nfs-pvc   Bound    pvc-c1d33fec-5e16-4156-8405-1af4fc171907   1Gi        RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 4m50s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ é™¤PVCï¼Œè‡ªåŠ¨åˆ é™¤PV</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete pvc nfs-pvc</span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° PV å·²ç»è¢«è‡ªåŠ¨åˆ é™¤ï¼Œ reclaimPolicy: Delete</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">No resources found</span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶ nfs-server çš„ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"è®¾ç½®é»˜è®¤çš„-StorageClass\">è®¾ç½®é»˜è®¤çš„ StorageClass</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢æˆ‘ä»¬åˆ›å»º PVC çš„æ—¶å€™éœ€è¦æŒ‡å®š StorageClassï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œé‚£ä¹ˆåœ¨PVCé‡Œå°±å¯ä»¥çœç•¥æ‰ StorageClass çš„è®¾ç½®ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>K8S ä¸­åªèƒ½è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>è®¾ç½®é»˜è®¤çš„ StorageClass</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸º sc æ·»åŠ  `é»˜è®¤` æ³¨è§£ï¼Œå»æ‰è¯¥æ³¨è§£ æˆ–è€… è®¾ç½®ä¸º false å°±å–æ¶ˆé»˜è®¤äº†ã€‚</span></span><br><span class=\"line\">$ kubectl patch storageclass nfs-csi -p <span class=\"string\">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class=\"line\">storageclass.storage.k8s.io/nfs-csi patched</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹scï¼Œæ­¤æ—¶çœ‹åˆ°åç§°åé¢å¤šäº†ä¸€ä¸ª (default) ï¼Œè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ StorageClass</span></span><br><span class=\"line\">$ k get sc</span><br><span class=\"line\">NAME                PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class=\"line\">nfs-csi (default)   nfs.csi.k8s.io   Delete          Immediate           <span class=\"literal\">true</span>                   14m</span><br></pre></td></tr></table></figure>\n<h2 id=\"StatefulSet-è‡ªåŠ¨åˆ›å»º-PVC\">StatefulSet: è‡ªåŠ¨åˆ›å»º PVC</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸Šé¢çš„æ–¹å¼è¿˜æ˜¯è¦æ±‚æˆ‘ä»¬å¿…é¡»åˆ›å»º PVCï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä¸ç”¨åˆ›å»º PVC ï¼Œè€Œæ˜¯åœ¨åˆ›å»ºæ§åˆ¶å™¨çš„æ—¶å€™å°±ä¸€èµ·æŠŠ PVC åˆ›å»ºå¥½å‘¢ï¼Ÿ</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç›®å‰åªæœ‰ <code>StatefulSet</code>æ§åˆ¶å™¨ æ‰æ”¯æŒè‡ªåŠ¨åˆ›å»º PVC</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># redis-statefulset.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span>                  <span class=\"comment\"># æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æº</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span>                    <span class=\"comment\"># Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">redis-sts</span>                    <span class=\"comment\"># èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">sts-ns</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span>                                <span class=\"comment\"># é…ç½®é¡¹</span></span><br><span class=\"line\">  <span class=\"attr\">revisionHistoryLimit:</span> <span class=\"number\">10</span>           <span class=\"comment\"># ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span>                          <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span>                     <span class=\"comment\"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                     <span class=\"comment\"># é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰</span></span><br><span class=\"line\">  <span class=\"attr\">updateStrategy:</span>                    <span class=\"comment\"># æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ ·</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">RollingUpdate</span>              <span class=\"comment\"># 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚</span></span><br><span class=\"line\">                                     <span class=\"comment\"># 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span>                   <span class=\"comment\"># æ»šåŠ¨å‡çº§çš„é…ç½®</span></span><br><span class=\"line\">      <span class=\"attr\">partition:</span> <span class=\"number\">0</span>                   <span class=\"comment\"># ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§</span></span><br><span class=\"line\">  <span class=\"attr\">serviceName:</span> <span class=\"string\">redis-svc</span>             <span class=\"comment\"># æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹ï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºå¥½</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">2</span>                        <span class=\"comment\"># å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span>                          <span class=\"comment\"># æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½®</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">redis</span>                   <span class=\"comment\"># Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">image:</span> <span class=\"string\">redis:6.2</span>             <span class=\"comment\"># å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">redis</span>                  <span class=\"comment\"># å®¹å™¨çš„åç§°</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span>                <span class=\"comment\"># æŒ‚è½½æ•°æ®å·</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">redis-data</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/data</span>           <span class=\"comment\"># Redis æŒä¹…åŒ–æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹</span></span><br><span class=\"line\">  <span class=\"attr\">volumeClaimTemplates:</span>              <span class=\"comment\"># é…ç½® PVC æ¨¡æ¿</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">redis-data</span>               <span class=\"comment\"># PVC åç§°</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>              <span class=\"comment\"># è®¿é—®æ¨¡å¼ï¼šå¤šèŠ‚ç‚¹è¯»å†™</span></span><br><span class=\"line\">      <span class=\"attr\">resources:</span></span><br><span class=\"line\">        <span class=\"attr\">requests:</span></span><br><span class=\"line\">          <span class=\"attr\">storage:</span> <span class=\"string\">500Mi</span>             <span class=\"comment\"># è¯·æ±‚çš„å­˜å‚¨å®¹é‡ï¼Œæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´</span></span><br><span class=\"line\">      <span class=\"attr\">storageClassName:</span> <span class=\"string\">nfs-csi</span>      <span class=\"comment\"># å­˜å‚¨ç±»åç§°ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤å­˜å‚¨ç±»ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®š</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»º StatefulSetï¼Œå¹¶æŸ¥çœ‹ PV,PVC</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º StatefulSet</span></span><br><span class=\"line\">$ kubectl apply -f redis-statefulset.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ PV,PVC</span></span><br><span class=\"line\">$ k get pv,pvc -n sts-ns</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-1   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          19s</span><br><span class=\"line\">persistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-0   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          22s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-0   Bound    pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 22s</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-1   Bound    pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 20s</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>StatefulSet çš„ volumeClaimTemplates æ¯ä¸ª Pod å•ç‹¬åˆ›å»º PVCï¼ŒPod å’Œ PVC ä¸€ä¸€å¯¹åº”ï¼Œå³æœ‰å‡ ä¸ªå‰¯æœ¬å°±åˆ›å»ºå‡ ä¸ª PVCã€‚PVC åç§°æ˜¯ï¼š<code>&lt;volumeClaimTemplates.metadata.name&gt;-&lt;statefulset-name&gt;-&lt;pod-ordinal&gt;</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>åˆ é™¤ StatefulSet</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete -f redis-statefulset.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ PV,PVCï¼Œå‘ç°åˆ é™¤ StatefulSet åï¼ŒPV å’Œ PVC æ˜¯ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ PVC</span></span><br><span class=\"line\">$ k get pv,pvc -n sts-ns</span><br><span class=\"line\">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-1   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          6m30s</span><br><span class=\"line\">persistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            Delete           Bound    sts-ns/redis-data-redis-sts-0   nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                          6m33s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                                           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-0   Bound    pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 6m33s</span><br><span class=\"line\">persistentvolumeclaim/redis-data-redis-sts-1   Bound    pvc-748fc0d3-a142-4d08-b5c4-7320daea5618   500Mi      RWX            nfs-csi        &lt;<span class=\"built_in\">unset</span>&gt;                 6m31s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ‰‹åŠ¨åˆ é™¤ PVCï¼Œå› ä¸ºscé…ç½®çš„å›æ”¶ç­–ç•¥ä¸º Deleteï¼Œæ‰€ä»¥ PV ä¹Ÿä¼šè¢«åˆ é™¤</span></span><br><span class=\"line\">k delete pvc -n sts-ns redis-data-redis-sts-0</span><br><span class=\"line\">k delete pvc -n sts-ns redis-data-redis-sts-1</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>å®é™…ä¸Šï¼Œæ— è®ºæ˜¯åˆ é™¤ statefulset è¿˜æ˜¯ç¼©å®¹ statefulsetï¼ŒPVC éƒ½ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</p>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s StorageClass å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS StorageClass(åˆ«åsc) ä»‹ç» K8s çš„å­˜å‚¨èµ„æºåˆ†ä¸ºä¸¤ç§ä¾›åº”æ¨¡å¼ï¼šé™æ€ä¾›åº”æ¨¡å¼ å’Œ åŠ¨æ€ä¾›åº”æ¨¡å¼ã€‚ é™æ€æ¨¡å¼ä¸‹ï¼Œç®¡ç†å‘˜éœ€è¦é¢„å…ˆåˆ›å»ºè®¸å¤šPVï¼Œç­‰å¾… PVC æ¥ç»‘å®šã€‚ åŠ¨æ€æ¨¡å¼ä¸‹ï¼ŒKubernetes ä¼šé€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»º PVï¼Œå¹¶å®Œæˆä¸ PVC çš„ç»‘å®šã€‚ StorageClass æ˜¯ Kubernetes ä¸­ç”¨æ¥å®šä¹‰ å­˜å‚¨åç«¯ç±»å‹å’Œé…ç½®å‚æ•° çš„èµ„æº ä½œç”¨ï¼š è‡ªåŠ¨åˆ›å»º PVï¼ˆPersistentVolumeï¼‰çš„â€œæ¨¡æ¿â€æˆ–â€œè§„åˆ™â€ ä½¿ç”¨åœºæ™¯ï¼š é…åˆ PVC ä½¿ç”¨æ—¶ï¼ŒKubernetes å¯ä»¥æ ¹æ® StorageClass è‡ªåŠ¨ åŠ¨æ€åˆ›å»º å¯¹åº”çš„æŒä¹…å·ã€‚ âœ… æ ¸å¿ƒä¼˜åŠ¿ï¼š æ— éœ€æ‰‹åŠ¨åˆ›å»º PV æ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆNFSã€äº‘ç›˜ã€Cephã€GlusterFSã€iSCSIâ€¦ï¼‰ åˆ›å»º StorageClass ä¸€ä¸ª NFS çš„ StorageClass çš„ yaml ç¤ºä¾‹ 12345678910111213141516# nfs-storage.yamlapiVersion: storage.k8s.io/v1kind: StorageClassmetadata: name: nfs-csi # å­˜å‚¨ç±»åç§°provisioner: nfs.csi.k8s.io # æŒ‡å®šå­˜å‚¨æ’ä»¶çš„ CSI é©±åŠ¨åç§°ï¼Œéœ€è¦å®‰è£… nfs-csi-driverreclaimPolicy: Delete # Retainï¼šPVC åˆ é™¤åï¼ŒPV ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼ˆæ•°æ®ä¿ç•™ï¼‰ï¼Œé»˜è®¤æ˜¯ Delete,ç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚allowVolumeExpansion: true # æ˜¯å¦å…è®¸ PVC è‡ªåŠ¨æ‰©å®¹ï¼Œnfs æ”¯æŒæ‰©å®¹mountOptions: # æŒ‚è½½é€‰é¡¹ï¼Œcsiæ’ä»¶ä¸åŒï¼Œé€‰é¡¹ä¸åŒã€‚è¿™é‡Œæ˜¯ nfsçš„ - hard # æœåŠ¡å™¨å¼‚å¸¸æ—¶å®¢æˆ·ç«¯ä¼šä¸€ç›´å‘è¯·æ±‚ç›´åˆ°æŒ‚è½½æˆåŠŸ - nfsvers=4.1 # nfsç‰ˆæœ¬ nfs4.1 - nolock # å…è®¸å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®volumeBindingMode: Immediate # é»˜è®¤å€¼ï¼šImmediate: åˆ›å»ºPVCæ—¶ç«‹å³ç»‘å®š ,WaitForFirstConsumerï¼šç­‰åˆ° Pod è°ƒåº¦åˆ°èŠ‚ç‚¹åå†åˆ†é…å·ï¼Œé€‚åˆå¤šå¯ç”¨åŒºåœºæ™¯parameters: # å‚æ•°é…ç½® server: 10.211.55.88 # nfsæœåŠ¡å™¨åœ°å€ share: /nfs-server/data # nfs-serverä¸Šçš„å­˜å‚¨ç›®å½• csi-driver-nfs ä» v4.x èµ·ï¼Œå·²ç»æ”¯æŒ Delete reclaimPolicy å’Œ allowVolumeExpansion è‡ªåŠ¨æ‰©å®¹ã€‚ ç”Ÿäº§ç¯å¢ƒæ…ç”¨ Delete reclaimPolicyï¼Œå› ä¸ºæ­¤æ—¶åˆ é™¤ PVC åï¼Œnfs-server ä¸Šçš„å­˜å‚¨ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚ æ¯ä¸ª StorageClass é…ç½®ä¸­æœ‰ä¸‰ä¸ªå¿…å¡«çš„å‚æ•°ï¼šprovisionerã€parameters å’Œ reclaimPolicy å­—æ®µï¼Œ è¿™äº›å­—æ®µä¼šåœ¨ StorageClass éœ€è¦åŠ¨æ€åˆ¶å¤‡ PersistentVolume (PV) ä»¥æ»¡è¶³ PersistentVolumeClaim (PVC) æ—¶ä½¿ç”¨åˆ°ã€‚ provisioner: å­˜å‚¨åˆ¶å¤‡å™¨ æ¯ä¸ª StorageClass éƒ½æœ‰ä¸€ä¸ªåˆ¶å¤‡å™¨ï¼ˆProvisionerï¼‰ï¼Œç”¨æ¥å†³å®šä½¿ç”¨å“ªä¸ªå·æ’ä»¶åˆ¶å¤‡ PVã€‚ è¯¥å­—æ®µå¿…é¡»æŒ‡å®šã€‚ æ¯”å¦‚ NFS å­˜å‚¨åˆ¶å¤‡å™¨ï¼šprovisioner: nfs.csi.k8s.ioï¼Œæ˜¯ K8S å®˜æ–¹ç»´æŠ¤çš„ NFS CSI æ’ä»¶ã€‚Githubã€‚ å®‰è£… NFS CSI æ’ä»¶ï¼šInstall NFS CSI Driver 123456# åœ¨çº¿å®‰è£…curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/install-driver.sh | bash -s master --# éªŒè¯kubectl -n kube-system get pod -o wide -l app=csi-nfs-controllerkubectl -n kube-system get pod -o wide -l app=csi-nfs-node å¸è½½ 1curl -skSL https://raw.githubusercontent.com/kubernetes-csi/csi-driver-nfs/master/deploy/uninstall-driver.sh | bash -s master -- ç¤ºä¾‹ åˆ›å»º StorageClass 123456kubectl apply -f nfs-storage.yaml## æŸ¥çœ‹ storageclass$ k get scNAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGEnfs-csi nfs.csi.k8s.io Delete Immediate true 5s åˆ›å»º PVC æ—¶æŒ‡å®š storageclassï¼ŒStorageClass ä¼šè‡ªåŠ¨åˆ›å»º PV 12345678910111213# nfs-pvc.yamlapiVersion: v1kind: PersistentVolumeClaimmetadata: name: nfs-pvc namespace: defaultspec: storageClassName: nfs-csi # æŒ‡å®š StorageClass çš„åç§°ï¼Œå¦‚æœè®¾ç½®äº†é»˜è®¤çš„scï¼Œæ­¤å¤„å¯ä»¥åˆ é™¤è¯¥é…ç½® accessModes: - ReadWriteMany # æŒ‡å®šè®¿é—®æ¨¡å¼ resources: requests: storage: 800Mi # ç”³è¯·çš„å®¹é‡ åˆ›å»º PVC 1234567891011# åˆ›å»º PVC$ k apply -f nfs-pvc.yamlpersistentvolumeclaim/nfs-pvc created# æŸ¥çœ‹ PVå’ŒPVCï¼Œå¯ä»¥çœ‹åˆ° PV è‡ªåŠ¨åˆ›å»ºäº†$ k get pv,pvcNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907 800Mi RWX Delete Bound default/nfs-pvc nfs-csi &lt;unset&gt; 2m4sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/nfs-pvc Bound pvc-c1d33fec-5e16-4156-8405-1af4fc171907 800Mi RWX nfs-csi &lt;unset&gt; 2m4s è‡ªåŠ¨æ‰©å®¹ï¼Œä¿®æ”¹ PVC å®¹é‡åˆ° 1Gi 1234567891011kubectl edit pvc nfs-pvc# ä¿®æ”¹å¦‚ä¸‹# &quot;storage&quot;:&quot;1Gi&quot;# å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° è‡ªåŠ¨æ‰©å®¹æˆåŠŸ$ k get pv,pvcNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-c1d33fec-5e16-4156-8405-1af4fc171907 1Gi RWX Delete Bound default/nfs-pvc nfs-csi &lt;unset&gt; 4m50sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/nfs-pvc Bound pvc-c1d33fec-5e16-4156-8405-1af4fc171907 1Gi RWX nfs-csi &lt;unset&gt; 4m50s åˆ é™¤PVCï¼Œè‡ªåŠ¨åˆ é™¤PV 12345kubectl delete pvc nfs-pvc# å†æ¬¡æŸ¥çœ‹ PV å’Œ PVCï¼Œå¯ä»¥çœ‹åˆ° PV å·²ç»è¢«è‡ªåŠ¨åˆ é™¤ï¼Œ reclaimPolicy: Delete$ k get pv,pvcNo resources found# æ­¤æ—¶ nfs-server çš„ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨ è®¾ç½®é»˜è®¤çš„ StorageClass ä¸Šé¢æˆ‘ä»¬åˆ›å»º PVC çš„æ—¶å€™éœ€è¦æŒ‡å®š StorageClassï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œé‚£ä¹ˆåœ¨PVCé‡Œå°±å¯ä»¥çœç•¥æ‰ StorageClass çš„è®¾ç½®ã€‚ K8S ä¸­åªèƒ½è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ StorageClassï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚ è®¾ç½®é»˜è®¤çš„ StorageClass 12345678# ä¸º sc æ·»åŠ  `é»˜è®¤` æ³¨è§£ï¼Œå»æ‰è¯¥æ³¨è§£ æˆ–è€… è®¾ç½®ä¸º false å°±å–æ¶ˆé»˜è®¤äº†ã€‚$ kubectl patch storageclass nfs-csi -p &#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;storageclass.storage.k8s.io/nfs-csi patched# æŸ¥çœ‹scï¼Œæ­¤æ—¶çœ‹åˆ°åç§°åé¢å¤šäº†ä¸€ä¸ª (default) ï¼Œè¡¨ç¤ºè¿™æ˜¯é»˜è®¤çš„ StorageClass$ k get scNAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGEnfs-csi (default) nfs.csi.k8s.io Delete Immediate true 14m StatefulSet: è‡ªåŠ¨åˆ›å»º PVC ä¸Šé¢çš„æ–¹å¼è¿˜æ˜¯è¦æ±‚æˆ‘ä»¬å¿…é¡»åˆ›å»º PVCï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä¸ç”¨åˆ›å»º PVC ï¼Œè€Œæ˜¯åœ¨åˆ›å»ºæ§åˆ¶å™¨çš„æ—¶å€™å°±ä¸€èµ·æŠŠ PVC åˆ›å»ºå¥½å‘¢ï¼Ÿ ç›®å‰åªæœ‰ StatefulSetæ§åˆ¶å™¨ æ‰æ”¯æŒè‡ªåŠ¨åˆ›å»º PVC 123456789101112131415161718192021222324252627282930313233343536373839# redis-statefulset.yamlapiVersion: apps/v1 # æŒ‡å®šä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯ apps/v1ï¼Œé€‚ç”¨äº StatefulSet èµ„æºkind: StatefulSet # Kubernetes èµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯éƒ¨ç½²ï¼ˆStatefulSetï¼‰metadata: name: redis-sts # èµ„æºåç§°ï¼Œå¿…é¡»å”¯ä¸€ï¼ˆåœ¨åŒä¸€å‘½åç©ºé—´ä¸‹ï¼‰ namespace: sts-nsspec: # é…ç½®é¡¹ revisionHistoryLimit: 10 # ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œé»˜è®¤å€¼ä¸º 10ï¼ŒDeployment å’Œ StatefulSet éƒ½æœ‰è¿™ä¸ªé…ç½®é¡¹ã€‚å›æ»šæ—¶æœ‰ç”¨ã€‚ selector: # é€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦ç®¡ç†çš„ Pod matchLabels: # æ ‡ç­¾é€‰æ‹©å™¨ app: redis # é€‰æ‹©å™¨ï¼ŒæŒ‡å®š StatefulSet ç®¡ç†å“ªäº› Podï¼ˆæ ‡ç­¾å¿…é¡»ä¸ template ä¸­åŒ¹é…ï¼‰ updateStrategy: # æ›´æ–°ç­–ç•¥ï¼Œè¿™é‡Œè¦æ³¨æ„è¿™ä¸ªæ›´æ–°ç­–ç•¥ä¸Deploymentçš„å±æ€§åå­—ä¸ä¸€æ · type: RollingUpdate # 1.RollingUpdateï¼šè¿™æ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ã€‚ä½¿ç”¨ RollingUpdate æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œ è€çš„ StatefulSet Pod å°†è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”å°†ä»¥å—æ§æ–¹å¼è‡ªåŠ¨åˆ›å»ºæ–°çš„ StatefulSet Podã€‚ æ›´æ–°æœŸé—´ï¼Œæœ€å¤šåªèƒ½æœ‰ StatefulSet çš„ä¸€ä¸ª Pod è¿è¡Œäºæ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚ # 2.OnDeleteï¼šä½¿ç”¨ OnDelete æ›´æ–°ç­–ç•¥æ—¶ï¼Œåœ¨æ›´æ–° StatefulSet æ¨¡æ¿åï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨åˆ é™¤è€çš„ StatefulSet Pod ä¹‹åï¼Œæ–°çš„ StatefulSet Pod æ‰ä¼šè¢«è‡ªåŠ¨åˆ›å»ºã€‚ rollingUpdate: # æ»šåŠ¨å‡çº§çš„é…ç½® partition: 0 # ç”¨äºæ§åˆ¶ä»ç¬¬å‡ ä¸ª Pod å¼€å§‹æ»šåŠ¨å‡çº§ serviceName: redis-svc # æœåŠ¡åç§°,stså¯¹è±¡ä½¿ç”¨æ— å¤´æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯å¿…å¡«é¡¹ï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºå¥½ replicas: 2 # å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ˜¯ 1 template: # æ¨¡æ¿ï¼Œå®šä¹‰ Pod çš„å†…å®¹ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ Pod çš„é…ç½® metadata: labels: app: redis # Pod çš„æ ‡ç­¾ï¼Œå¿…é¡»ä¸ selector ä¸­çš„ matchLabels ä¸€è‡´ spec: containers: - image: redis:6.2 # å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼Œè¿™é‡Œæ˜¯å®˜æ–¹çš„ redis é•œåƒ name: redis # å®¹å™¨çš„åç§° volumeMounts: # æŒ‚è½½æ•°æ®å· - name: redis-data mountPath: /data # Redis æŒä¹…åŒ–æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ volumeClaimTemplates: # é…ç½® PVC æ¨¡æ¿ - metadata: name: redis-data # PVC åç§° spec: accessModes: - ReadWriteMany # è®¿é—®æ¨¡å¼ï¼šå¤šèŠ‚ç‚¹è¯»å†™ resources: requests: storage: 500Mi # è¯·æ±‚çš„å­˜å‚¨å®¹é‡ï¼Œæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ storageClassName: nfs-csi # å­˜å‚¨ç±»åç§°ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤å­˜å‚¨ç±»ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®š åˆ›å»º StatefulSetï¼Œå¹¶æŸ¥çœ‹ PV,PVC 123456789101112# åˆ›å»º StatefulSet$ kubectl apply -f redis-statefulset.yaml# æŸ¥çœ‹ PV,PVC$ k get pv,pvc -n sts-nsNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-1 nfs-csi &lt;unset&gt; 19spersistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-0 nfs-csi &lt;unset&gt; 22sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/redis-data-redis-sts-0 Bound pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX nfs-csi &lt;unset&gt; 22spersistentvolumeclaim/redis-data-redis-sts-1 Bound pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX nfs-csi &lt;unset&gt; 20s StatefulSet çš„ volumeClaimTemplates æ¯ä¸ª Pod å•ç‹¬åˆ›å»º PVCï¼ŒPod å’Œ PVC ä¸€ä¸€å¯¹åº”ï¼Œå³æœ‰å‡ ä¸ªå‰¯æœ¬å°±åˆ›å»ºå‡ ä¸ª PVCã€‚PVC åç§°æ˜¯ï¼š&lt;volumeClaimTemplates.metadata.name&gt;-&lt;statefulset-name&gt;-&lt;pod-ordinal&gt; åˆ é™¤ StatefulSet 123456789101112131415kubectl delete -f redis-statefulset.yaml# æŸ¥çœ‹ PV,PVCï¼Œå‘ç°åˆ é™¤ StatefulSet åï¼ŒPV å’Œ PVC æ˜¯ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ PVC$ k get pv,pvc -n sts-nsNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-1 nfs-csi &lt;unset&gt; 6m30spersistentvolume/pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX Delete Bound sts-ns/redis-data-redis-sts-0 nfs-csi &lt;unset&gt; 6m33sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/redis-data-redis-sts-0 Bound pvc-807018bb-ec66-4a5c-87f1-9c11df6f4784 500Mi RWX nfs-csi &lt;unset&gt; 6m33spersistentvolumeclaim/redis-data-redis-sts-1 Bound pvc-748fc0d3-a142-4d08-b5c4-7320daea5618 500Mi RWX nfs-csi &lt;unset&gt; 6m31s# æ‰‹åŠ¨åˆ é™¤ PVCï¼Œå› ä¸ºscé…ç½®çš„å›æ”¶ç­–ç•¥ä¸º Deleteï¼Œæ‰€ä»¥ PV ä¹Ÿä¼šè¢«åˆ é™¤k delete pvc -n sts-ns redis-data-redis-sts-0k delete pvc -n sts-ns redis-data-redis-sts-1 å®é™…ä¸Šï¼Œæ— è®ºæ˜¯åˆ é™¤ statefulset è¿˜æ˜¯ç¼©å®¹ statefulsetï¼ŒPVC éƒ½ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ StorageClassï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s StorageClass å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS","date_published":"2025-07-22T12:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]},{"id":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-pv-pvc/","url":"https://blog.hanqunfeng.com/2025/07/21/k8s-storage-pv-pvc/","title":"K8S ä¹‹ æŒä¹…å· PV å’Œ PVC","content_html":"<!--\n **åŠ ç²—**\n *æ–œä½“*\n ***åŠ ç²—å¹¶æ–œä½“***\n ~~åˆ é™¤çº¿~~\n ==çªå‡ºæ˜¾ç¤º==\n `çªå‡ºæ˜¾ç¤º(æ¨è)`\n ++ä¸‹åˆ’çº¿++\n ~ä¸‹æ ‡~\n ^ä¸Šæ ‡^\n è„šæ³¨ï¼Œå‚è€ƒæ–‡çŒ®[^1]ï¼Œç„¶ååœ¨æ–‡æ¡£æœ€ä¸‹æ–¹è¦æ·»åŠ è¿™ä¸ª1å¯¹åº”çš„å†…å®¹ï¼Œå¦‚ï¼š[^1]: My reference.\n å›¾ç‰‡è®¾ç½®å®½åº¦å’Œé«˜åº¦(é€šè¿‡uPicä¸Šä¼ åï¼Œéœ€è¦å°†upicä¿®æ”¹è¿‡ä¸ºblogï¼Œç”¨äºæ·»åŠ æ°´å°) ![](https://upic-oss.oss-cn-beijing.aliyuncs.com/blog/innodb_buffer_pool.png =900x600)\n\n +++ **ç‚¹å‡»æŠ˜å **\n è¿™æ˜¯è¢«éšè—çš„å†…å®¹\n +++\n\n::: tips success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n:::\n\n% note info % success warning danger\nè¿™é‡Œæ˜¯å®¹å™¨å†…çš„å†…å®¹\n% endnote %\n\nå¼•ç”¨æœ¬åœ°å…¶å®ƒæ–‡ç« è¿æ¥{}\n å¤§æ‹¬å·å¼€å§‹% post_link æ–‡ä»¶åç§°(ä¸åŒ…å«.md) %å¤§æ‹¬å·ç»“æŸ\n -->\n<h2 id=\"æ‘˜è¦\">æ‘˜è¦</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/\">K8Så®˜ç½‘</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://github.com/kubernetes/kubernetes\">k8s Github</a></p>\n</li>\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/\">k8s PV/PVC å®˜æ–¹æ–‡æ¡£</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS</p>\n</li>\n</ul>\n<span id=\"more\"></span>\n<h2 id=\"PV-å’Œ-PVC-ä»‹ç»\">PV å’Œ PVC ä»‹ç»</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>PV(PersistentVolume) æ˜¯ Kubernetes ä¸­çš„ä¸€ç§å­˜å‚¨èµ„æºï¼Œç”¨äºå°†åº•å±‚çš„ç‰©ç†å­˜å‚¨ï¼ˆå¦‚ NFSã€iSCSIã€Cephã€äº‘å­˜å‚¨ç­‰ï¼‰æŠ½è±¡æˆ Kubernetes èµ„æºï¼Œä¾› Pod ä½¿ç”¨ã€‚å®ƒæ˜¯å¯¹å­˜å‚¨çš„ä¸€ç§â€œå£°æ˜å¼â€ç®¡ç†ï¼Œç±»ä¼¼äº Pod å£°æ˜è®¡ç®—èµ„æºã€‚PV æ˜¯é›†ç¾¤çº§åˆ«çš„å­˜å‚¨èµ„æºï¼Œä¸æ”¯æŒ Namespaceã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>PVC(PersistentVolumeClaim)ï¼ŒæŒä¹…å·å£°æ˜ï¼Œ æ˜¯ Kubernetes ä¸­ç”¨äºç”³è¯·å­˜å‚¨èµ„æºçš„å¯¹è±¡ã€‚PVC æ˜¯ Namespace çº§åˆ«çš„èµ„æºã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>ç®€è€Œè¨€ä¹‹ï¼š</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">PV æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œç”±ç®¡ç†å‘˜æå‰é…ç½®æˆ–åŠ¨æ€åˆ›å»ºã€‚</li>\n<li class=\"lvl-4\">PVCï¼ˆPersistentVolumeClaimï¼‰ æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„ç”³è¯·ã€‚</li>\n<li class=\"lvl-4\">Pod é€šè¿‡ PVC ç»‘å®šåˆ° PVï¼Œä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ã€‚</li>\n<li class=\"lvl-4\">å¼€å‘è€…ç”¨ PVC æ¥ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œä¸å…³å¿ƒå­˜å‚¨çš„å…·ä½“å®ç°æ–¹å¼ã€‚</li>\n<li class=\"lvl-4\">PVC é€šè¿‡ Kubernetes è‡ªåŠ¨åŒ¹é…ä¸€ä¸ªåˆé€‚çš„ PersistentVolumeï¼ˆPVï¼‰è¿›è¡Œç»‘å®šã€‚</li>\n</ul>\n</li>\n<li class=\"lvl-2\">\n<p>PV ä¸ PVC çš„åŸºæœ¬æµç¨‹</p>\n<ul class=\"lvl-2\">\n<li class=\"lvl-4\">ç®¡ç†å‘˜åˆ›å»º PVï¼ˆæˆ–è€…é›†ç¾¤é€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚</li>\n<li class=\"lvl-4\">ç”¨æˆ·æäº¤ PVCï¼Œå£°æ˜è‡ªå·±éœ€è¦å¤šå°‘å®¹é‡ã€ä»€ä¹ˆè®¿é—®æ¨¡å¼ã€‚</li>\n<li class=\"lvl-4\">Kubernetes æŸ¥æ‰¾å¯ç”¨çš„ PVï¼Œæ¡ä»¶ç¬¦åˆï¼ˆå®¹é‡ã€è®¿é—®æ¨¡å¼ã€StorageClassï¼‰å°±è‡ªåŠ¨ç»‘å®šã€‚</li>\n<li class=\"lvl-4\">Pod æŒ‚è½½ PVCï¼Œå®ç°æŒä¹…åŒ–å­˜å‚¨ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"PV-ç¤ºä¾‹\">PV ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ PV ç¤ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pv-nfs.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">pv-nfs-1g</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">volumeMode:</span> <span class=\"string\">Filesystem</span>                 <span class=\"comment\"># å­˜å‚¨å·æ¨¡å¼ï¼Œé»˜è®¤ä¸º Filesystem</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span>                              <span class=\"comment\"># å­˜å‚¨èƒ½åŠ›</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">1Gi</span>                         <span class=\"comment\"># å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span>                           <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteOnce</span>                      <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">persistentVolumeReclaimPolicy:</span> <span class=\"string\">Retain</span>  <span class=\"comment\"># å›æ”¶ç­–ç•¥</span></span><br><span class=\"line\">  <span class=\"attr\">nfs:</span>                                   <span class=\"comment\"># æŒä¹…å·ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/nfs-server/data/pv-nfs-1g</span>     <span class=\"comment\"># å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨</span></span><br><span class=\"line\">    <span class=\"attr\">server:</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.88</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolume</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">pv-nfs-2g</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">capacity:</span>                              <span class=\"comment\"># å­˜å‚¨èƒ½åŠ›</span></span><br><span class=\"line\">    <span class=\"attr\">storage:</span> <span class=\"string\">2Gi</span>                         <span class=\"comment\"># å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span>                           <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>                      <span class=\"comment\"># è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">persistentVolumeReclaimPolicy:</span> <span class=\"string\">Retain</span>  <span class=\"comment\"># å›æ”¶ç­–ç•¥</span></span><br><span class=\"line\">  <span class=\"attr\">nfs:</span>                                   <span class=\"comment\"># å­˜å‚¨ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">/nfs-server/data/pv-nfs-2g</span>     <span class=\"comment\"># å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨</span></span><br><span class=\"line\">    <span class=\"attr\">server:</span> <span class=\"number\">10.211</span><span class=\"number\">.55</span><span class=\"number\">.88</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å­˜å‚¨å·æ¨¡å¼\">å­˜å‚¨å·æ¨¡å¼</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#volume-mode\">å®˜ç½‘æ–‡æ¡£:å­˜å‚¨å·æ¨¡å¼</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>Kubernetes æ”¯æŒä¸¤ç§å·æ¨¡å¼ï¼ˆvolumeModesï¼‰ï¼šFilesystemï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ å’Œ Blockï¼ˆå—ï¼‰ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœè¯¥å‚æ•°è¢«çœç•¥ï¼Œé»˜è®¤çš„å·æ¨¡å¼æ˜¯ Filesystemã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>volumeMode å±æ€§è®¾ç½®ä¸º Filesystem çš„å·ä¼šè¢« Pod æŒ‚è½½ï¼ˆMountï¼‰ åˆ°æŸä¸ªç›®å½•ã€‚</p>\n</li>\n</ul>\n<h3 id=\"æŒä¹…å·ç±»å‹\">æŒä¹…å·ç±»å‹</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes\">å®˜ç½‘æ–‡æ¡£:æŒä¹…å·ç±»å‹</a></p>\n</li>\n<li class=\"lvl-2\">\n<p>âœ… å½“å‰æ”¯æŒçš„æ’ä»¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ’ä»¶ç±»å‹</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>csi</strong></td>\n<td><strong>å®¹å™¨å­˜å‚¨æ¥å£ï¼ˆCSIï¼‰</strong>ï¼Œæ¨èçš„ç°ä»£å­˜å‚¨æ¥å£</td>\n</tr>\n<tr>\n<td><strong>fc</strong></td>\n<td>Fibre Channel å­˜å‚¨</td>\n</tr>\n<tr>\n<td><strong>hostPath</strong></td>\n<td>HostPath å·ï¼ˆä»…ä¾›å•èŠ‚ç‚¹æµ‹è¯•ä½¿ç”¨ï¼›å¤šèŠ‚ç‚¹ä¸æ¨èï¼Œæ¨èä½¿ç”¨ local å·æ›¿ä»£ï¼‰</td>\n</tr>\n<tr>\n<td><strong>iscsi</strong></td>\n<td>iSCSIï¼ˆåŸºäº IP çš„ SCSI å­˜å‚¨ï¼‰</td>\n</tr>\n<tr>\n<td><strong>local</strong></td>\n<td>èŠ‚ç‚¹æœ¬åœ°å­˜å‚¨è®¾å¤‡</td>\n</tr>\n<tr>\n<td><strong>nfs</strong></td>\n<td>ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰å­˜å‚¨</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âš ï¸ å·²å¼ƒç”¨ä½†ä»å¯ç”¨ï¼ˆéœ€ CSI è¿ç§»ï¼‰</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ’ä»¶ç±»å‹</th>\n<th>æè¿°</th>\n<th>CSI è¿ç§»çŠ¶æ€</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>awsElasticBlockStore</strong></td>\n<td>AWS EBS å—å­˜å‚¨</td>\n<td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>azureDisk</strong></td>\n<td>Azure ç£ç›˜å­˜å‚¨</td>\n<td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>azureFile</strong></td>\n<td>Azure æ–‡ä»¶å­˜å‚¨</td>\n<td>ä» v1.24 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>cinder</strong></td>\n<td>OpenStack å—å­˜å‚¨</td>\n<td>ä» v1.21 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>flexVolume</strong></td>\n<td>FlexVolumeï¼ˆæ— è¿ç§»è®¡åˆ’ï¼Œä½†æœªè®¡åˆ’ç§»é™¤ï¼‰</td>\n<td>ä» v1.23 å¼€å§‹å¼ƒç”¨</td>\n</tr>\n<tr>\n<td><strong>gcePersistentDisk</strong></td>\n<td>GCP æŒä¹…ç£ç›˜</td>\n<td>ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>portworxVolume</strong></td>\n<td>Portworx å­˜å‚¨å·</td>\n<td>ä» v1.31 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n<tr>\n<td><strong>vsphereVolume</strong></td>\n<td>vSphere VMDK å·</td>\n<td>ä» v1.25 å¼€å§‹é»˜è®¤è¿ç§»</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>âŒ å·²åºŸå¼ƒ/å³å°†ç§»é™¤çš„ In-Tree æ’ä»¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>æ’ä»¶ç±»å‹</th>\n<th>æè¿°</th>\n<th>å¼ƒç”¨/ç§»é™¤ç‰ˆæœ¬</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>cephfs</strong></td>\n<td>Ceph æ–‡ä»¶ç³»ç»Ÿå·</td>\n<td>v1.31 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>flocker</strong></td>\n<td>Flocker å­˜å‚¨</td>\n<td>v1.25 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>glusterfs</strong></td>\n<td>GlusterFS å­˜å‚¨</td>\n<td>v1.26 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>photonPersistentDisk</strong></td>\n<td>Photon æŒä¹…ç£ç›˜</td>\n<td>v1.15 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>quobyte</strong></td>\n<td>Quobyte å·</td>\n<td>v1.25 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>rbd</strong></td>\n<td>Rados å—è®¾å¤‡ï¼ˆCeph RBDï¼‰</td>\n<td>v1.31 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>scaleIO</strong></td>\n<td>ScaleIO å·</td>\n<td>v1.21 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td><strong>storageos</strong></td>\n<td>StorageOS å·</td>\n<td>v1.25 ä¹‹åä¸å¯ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"accessModes-è®¿é—®æ¨¡å¼\">accessModes è®¿é—®æ¨¡å¼</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#access-modes\">å®˜ç½‘æ–‡æ¡£:è®¿é—®æ¨¡å¼</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>è®¿é—®æ¨¡å¼</th>\n<th>è¯´æ˜</th>\n<th>æ˜¯å¦è·¨èŠ‚ç‚¹æŒ‚è½½</th>\n<th>æ˜¯å¦æ”¯æŒå¤š Pod æŒ‚è½½</th>\n<th>æ˜¯å¦æ”¯æŒè¯»å†™</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>ReadWriteOnce (RWO)</strong></td>\n<td>å·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼ŒåŒä¸€èŠ‚ç‚¹å†…å¤šä¸ª Pod å¯å…±äº«ä½¿ç”¨ã€‚</td>\n<td>âŒ å¦</td>\n<td>âœ… æ˜¯ï¼ˆåŒä¸€èŠ‚ç‚¹ï¼‰</td>\n<td>âœ… æ˜¯</td>\n</tr>\n<tr>\n<td><strong>ReadOnlyMany (ROX)</strong></td>\n<td>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æŒ‚è½½ã€‚</td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n<td>âŒ å¦ï¼ˆåªè¯»ï¼‰</td>\n</tr>\n<tr>\n<td><strong>ReadWriteMany (RWX)</strong></td>\n<td>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ã€‚</td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n<td>âœ… æ˜¯</td>\n</tr>\n<tr>\n<td><strong>ReadWriteOncePod (RWOP)</strong></td>\n<td>å·åªèƒ½è¢«å•ä¸ª Pod ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼Œç¡®ä¿é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª Pod ä½¿ç”¨è¯¥å·ï¼ˆv1.29+ç¨³å®šï¼‰ã€‚</td>\n<td>âŒ å¦</td>\n<td>âŒ å¦ï¼ˆåªèƒ½ä¸€ä¸ª Podï¼‰</td>\n<td>âœ… æ˜¯</td>\n</tr>\n</tbody>\n</table>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>NFS æ”¯æŒå‰ä¸‰ç§è®¿é—®æ¨¡å¼ï¼ŒhostPath åªæ”¯æŒ ReadWriteOnceã€‚</p>\n</li>\n</ul>\n<h3 id=\"persistentVolumeReclaimPolicy-å›æ”¶ç­–ç•¥\">persistentVolumeReclaimPolicy å›æ”¶ç­–ç•¥</h3>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p><a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy\">å®˜æ–¹æ–‡æ¡£:å›æ”¶ç­–ç•¥</a></p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å›æ”¶ç­–ç•¥</th>\n<th>å«ä¹‰</th>\n<th>å›æ”¶è¡Œä¸º</th>\n<th>å…¸å‹ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Retain</strong></td>\n<td><strong>ä¿ç•™</strong>ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨ä»ç„¶ä¿ç•™</td>\n<td>æ‰‹åŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤å PV çŠ¶æ€ä¸º <code>Released</code>ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†æˆ–é‡æ–°ç»‘å®š</td>\n<td>é‡è¦æ•°æ®ï¼Œé¿å…è¯¯åˆ ï¼›å¦‚æ•°æ®åº“æ•°æ®ç›˜</td>\n</tr>\n<tr>\n<td><strong>Delete</strong></td>\n<td><strong>åˆ é™¤</strong>ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨éƒ½ä¼šè¢«åˆ é™¤</td>\n<td>è‡ªåŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤æ—¶è‡ªåŠ¨åˆ é™¤ PV å’Œåç«¯å­˜å‚¨èµ„æºï¼ˆå¦‚äº‘ç›˜ï¼‰</td>\n<td>ä¸´æ—¶æ•°æ®ã€ä¸é‡è¦çš„å­˜å‚¨</td>\n</tr>\n<tr>\n<td><strong>Recycle</strong></td>\n<td><strong>å›æ”¶</strong>ï¼šç®€å•æ¸…ç©ºæ•°æ®</td>\n<td>è‡ªåŠ¨æ‰§è¡Œ <code>rm -rf /thevolume/*</code>ï¼Œç„¶å PV å˜å› <code>Available</code> çŠ¶æ€</td>\n<td>æ—§ç‰ˆæœ¬é›†ç¾¤çš„å°æ–‡ä»¶ä¸´æ—¶å­˜å‚¨</td>\n</tr>\n</tbody>\n</table>\n<div class=\"warning\">\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p><strong>æ³¨æ„</strong>: åˆ›å»º <strong>Recycle</strong> çš„ PV æ—¶ï¼Œä¼šæç¤ºå¦‚ä¸‹å†…å®¹</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Warning: spec.persistentVolumeReclaimPolicy: The Recycle reclaim policy is deprecated. Instead, the recommended approach is to use dynamic provisioning.</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">\n<p>æ„æ€å°±æ˜¯ <strong>Recycle</strong> ç­–ç•¥å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨<code>åŠ¨æ€ä¾›åº”æ¨¡å¼</code>ã€‚ä½†<a href=\"https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy\">å®˜æ–¹æ–‡æ¡£</a>ä¸­å´æç¤º <code>å¯¹äº Kubernetes 1.33 æ¥è¯´ï¼Œåªæœ‰ nfs å’Œ hostPath å·ç±»å‹æ”¯æŒå›æ”¶ï¼ˆRecycleï¼‰ã€‚</code></p>\n</li>\n<li class=\"lvl-2\">\n<p>æœ¬äººåœ¨ Kubernetes 1.33.2 ä¸­æµ‹è¯•ï¼ŒNFS æ”¯æŒ Recycleï¼Œåˆ é™¤ PVC å PV çŠ¶æ€ä¼šå˜ä¸º <strong>Available</strong></p>\n</li>\n</ul>\n</div>\n<h3 id=\"ç®¡ç†-PV\">ç®¡ç† PV</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º</span></span><br><span class=\"line\">kubectl create -f pv-nfs.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹</span></span><br><span class=\"line\">$ k get pv</span><br><span class=\"line\">NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">pv-nfs-1g   1Gi        RWO            Retain           Available                          &lt;<span class=\"built_in\">unset</span>&gt;                          80s</span><br><span class=\"line\">pv-nfs-2g   2Gi        RWX            Retain           Available                          &lt;<span class=\"built_in\">unset</span>&gt;                          80s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤</span></span><br><span class=\"line\">kubectl delete pv pv-nfs-1g</span><br><span class=\"line\">k delete -f pv-nfs.yaml</span><br></pre></td></tr></table></figure>\n<h2 id=\"PVC-ç¤ºä¾‹\">PVC ç¤ºä¾‹</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>Pod é€šè¿‡ PVC å‘ PV ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœ PVC ä¸€ç›´æ— æ³•åŒ¹é…åˆ° PVï¼Œåˆ™ PVC å¤„äº Pending çŠ¶æ€ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>Pod å¿…é¡»ä¸ PVC å¤„äºåŒä¸€å‘½åç©ºé—´ã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>PVC ä¸ PV æ˜¯ 1:1 çš„å…³ç³»ã€‚ä¸€æ—¦ PV ç»‘å®šåˆ° PVCï¼Œåˆ™ PVC çŠ¶æ€å˜ä¸º Boundã€‚è¯¥ PV å°†ä¸å†è¢«å…¶ä»– PVC ç»‘å®šã€‚</p>\n</li>\n<li class=\"lvl-2\">\n<p>PVC ä¸ PV åŒ¹é…çš„æ¡ä»¶</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŒ¹é…æ¡ä»¶</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>å®¹é‡</strong></td>\n<td><strong>PVC è¯·æ±‚çš„å®¹é‡ â‰¤ PV æä¾›çš„å®¹é‡</strong>ã€‚PV å¿…é¡»è‡³å°‘æ»¡è¶³ PVC çš„å®¹é‡è¯·æ±‚ã€‚</td>\n</tr>\n<tr>\n<td><strong>è®¿é—®æ¨¡å¼</strong></td>\n<td><strong>PV æ”¯æŒ PVC è¯·æ±‚çš„è®¿é—®æ¨¡å¼</strong>ã€‚PVC è¦æ±‚çš„æ‰€æœ‰è®¿é—®æ¨¡å¼ï¼ŒPV éƒ½å¿…é¡»å…·å¤‡ã€‚ä¾‹å¦‚ï¼šPVC è¦æ±‚ <code>ReadWriteOnce</code>ï¼ŒPV è‡³å°‘è¦æ”¯æŒ <code>ReadWriteOnce</code>ã€‚</td>\n</tr>\n<tr>\n<td><strong>StorageClass</strong></td>\n<td><strong>PVC å’Œ PV çš„ <code>storageClassName</code> å¿…é¡»ä¸€è‡´</strong>ã€‚å¦‚æœ PVC æŒ‡å®šäº† <code>storageClassName</code>ï¼Œåªèƒ½ç»‘å®šåŒåçš„ PVã€‚</td>\n</tr>\n<tr>\n<td><strong>Selectorï¼ˆå¯é€‰ï¼‰</strong></td>\n<td>å¦‚æœ PVC æœ‰è®¾ç½® <code>selector</code>ï¼ˆåŸºäºæ ‡ç­¾ï¼‰ï¼ŒPV çš„æ ‡ç­¾ä¹Ÿå¿…é¡»åŒ¹é…ã€‚</td>\n</tr>\n</tbody>\n</table>\n<div class=\"tips\">\n<p><em><strong>å°è´´å£«</strong></em></p>\n<ul class=\"lvl-1\">\n<li class=\"lvl-2\">PV ä¸­å£°æ˜çš„ <code>accessModes</code> ä»…ä½œä¸ºä¸ PVC çš„è®¿é—®æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå®é™…æŒ‚è½½åˆ° Pod åï¼Œä¸ä¼šé™åˆ¶ Pod çš„è¯»å†™è®¿é—®</li>\n</ul>\n</div>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ªç®€å•çš„ yaml</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pvc.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PersistentVolumeClaim</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">mypvc</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">accessModes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">ReadWriteMany</span>   <span class=\"comment\"># ç”³è¯·åŒ¹é…çš„è®¿é—®æ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">    <span class=\"attr\">requests:</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"string\">500Mi</span>  <span class=\"comment\"># ç”³è¯·çš„å®¹é‡ï¼Œå®é™…å®¹é‡ä»¥åŒ¹é…çš„ PV ä¸ºå‡†</span></span><br><span class=\"line\">  <span class=\"comment\"># selector:         # åŒ¹é…çš„ PV æ ‡ç­¾</span></span><br><span class=\"line\">  <span class=\"comment\">#   matchLabels:</span></span><br><span class=\"line\">  <span class=\"comment\">#     pv: nfs-pv1   # pv çš„æ ‡ç­¾ï¼Œåˆ›å»º pv æ—¶è¦æŒ‡å®š</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"ç®¡ç†-PVC\">ç®¡ç† PVC</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º PVC</span></span><br><span class=\"line\">kubectl apply -f pvc.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹PVCï¼Œæ­¤æ—¶çœ‹åˆ° pv-nfs-1g ç»‘å®šäº† PVC</span></span><br><span class=\"line\">$ k get pv,pvc</span><br><span class=\"line\">NAME                         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">persistentvolume/pv-nfs-1g   1Gi        RWO            Retain           Available                                  &lt;<span class=\"built_in\">unset</span>&gt;                          16s</span><br><span class=\"line\">persistentvolume/pv-nfs-2g   2Gi        RWX            Retain           Bound       default/mypvc                  &lt;<span class=\"built_in\">unset</span>&gt;                          16s</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                          STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE</span><br><span class=\"line\">persistentvolumeclaim/mypvc   Bound    pv-nfs-2g   2Gi        RWX                           &lt;<span class=\"built_in\">unset</span>&gt;                 9s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ PVC</span></span><br><span class=\"line\">kubectl delete pvc mypvc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶å†æ¬¡æŸ¥çœ‹ PVï¼Œpv-nfs-1g çŠ¶æ€å˜æ›´ä¸º Releasedï¼Œè¡¨ç¤ºå·²ç»é‡Šæ”¾ï¼Œä½†æ˜¯ä¸èƒ½å†è¢«å…¶å®ƒ PVC ç»‘å®šäº†ï¼Œåªèƒ½åˆ é™¤é‡å»ºäº†</span></span><br><span class=\"line\">$ k get pv</span><br><span class=\"line\">NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM           STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE</span><br><span class=\"line\">pv-nfs-1g   1Gi        RWO            Retain           Available                                              &lt;<span class=\"built_in\">unset</span>&gt;                          18m</span><br><span class=\"line\">pv-nfs-2g   2Gi        RWX            Retain           Released     default/mypvc                             &lt;<span class=\"built_in\">unset</span>&gt;                          18m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ PV</span></span><br><span class=\"line\">k delete pv pv-nfs-1g</span><br></pre></td></tr></table></figure>\n<h2 id=\"Pod-ç»‘å®š-PVC\">Pod ç»‘å®š PVC</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è¿™é‡Œä»¥ nginx deployment ä¸ºä¾‹</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nginx-pvc-deployment.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx-pvc-deployment</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span>                              <span class=\"comment\"># 3ä¸ª podä¼šå…±äº«ä¸€ä¸ª PVC</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nginx-pvc</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">nginx-pvc</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx-storage</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/usr/share/nginx/html</span>  <span class=\"comment\"># æŒ‚è½½åˆ° nginx çš„é»˜è®¤ç½‘é¡µç›®å½•</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx-storage</span></span><br><span class=\"line\">        <span class=\"attr\">persistentVolumeClaim:</span>              <span class=\"comment\"># æŒ‡å®šå­˜å‚¨å·ç±»å‹æ˜¯ PVC</span></span><br><span class=\"line\">          <span class=\"attr\">claimName:</span> <span class=\"string\">mypvc</span>                  <span class=\"comment\"># å¯¹åº”ä½ åˆ›å»ºçš„ PVC åç§°</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸€ä¸ª PVC å¯¹åº”ä¸€ä¸ª PVï¼Œä½†æ˜¯ä¸€ä¸ª PVC å¯ä»¥å¯¹åº”å¤šä¸ª Deployment ç­‰æ§åˆ¶å™¨ã€‚ä¸‹é¢æˆ‘ä»¬å°±å†åˆ›å»ºä¸€ä¸ª Deploymentï¼Œå°† ç›¸åŒçš„ PVC æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œå¹¶ä¸”æ¯éš”5ç§’ä¿®æ”¹ä¸€æ¬¡ PVC æŒ‚è½½çš„ç½‘é¡µï¼Œå¹¶é€šè¿‡ nginx å®¹å™¨æŸ¥çœ‹ç»“æœ</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># busybox-deployment.yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">busybox-deployment</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;while true; do echo $(date) &gt; /data/index.html; sleep 5; done&quot;</span>]</span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-volume</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/data</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">shared-volume</span></span><br><span class=\"line\">        <span class=\"attr\">persistentVolumeClaim:</span></span><br><span class=\"line\">          <span class=\"attr\">claimName:</span> <span class=\"string\">mypvc</span></span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>åˆ›å»ºåæŸ¥çœ‹ pod ip</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ k get pod -o wide</span><br><span class=\"line\">NAME                                    READY   STATUS    RESTARTS   AGE     IP               NODE          NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">busybox-deployment-d7589665d-dx2rs      1/1     Running   0          2m59s   10.244.126.6     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">nginx-pvc-deployment-775b8c4f8b-89cw7   1/1     Running   0          44s     10.244.126.8     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">nginx-pvc-deployment-775b8c4f8b-fszlf   1/1     Running   0          44s     10.244.194.123   k8s-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">nginx-pvc-deployment-775b8c4f8b-w9qkt   1/1     Running   0          44s     10.244.126.7     k8s-worker2   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>è®¿é—®ä»»æ„ä¸€ä¸ª nginx pod</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶ä¼šçœ‹åˆ°é¡µé¢å†…å®¹åœ¨å˜åŒ–</span></span><br><span class=\"line\">watch -n 5 curl 10.244.194.123</span><br></pre></td></tr></table></figure>\n<h2 id=\"åè®°\">åè®°</h2>\n<ul class=\"lvl-0\">\n<li class=\"lvl-2\">\n<p>ä¸º pod ç»‘å®š pvcæ—¶ï¼Œæ¯æ¬¡éƒ½è¦å…ˆåˆ›å»º pv å’Œ pvcï¼Œéå¸¸éº»çƒ¦ã€‚æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ</p>\n<blockquote>\n<p>ä½¿ç”¨ StorageClass å®ç°è‡ªåŠ¨åˆ›å»º PVï¼Œæˆ‘ä»¬ä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•å®ç°ã€‚</p>\n</blockquote>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœ PVC è¢« Pod ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PVC å—ï¼Ÿ</p>\n<blockquote>\n<p>ä¸å¯ä»¥ï¼ŒPVC è¢« Pod ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… Pod åˆ é™¤åæ‰èƒ½åˆ é™¤ PVCã€‚<br>\nè‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PVC å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PVC çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PVC çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“å­˜Podå¯¹å‚¨å·çš„ä½¿ç”¨ã€‚<br>\næ­¤æ—¶ä¸€æ—¦Pod åˆ é™¤ï¼ŒPVC å°±ä¼šè¢«åˆ é™¤ã€‚</p>\n</blockquote>\n</li>\n<li class=\"lvl-2\">\n<p>å¦‚æœPV è¢« PVC ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PV å—ï¼Ÿ</p>\n<blockquote>\n<p>ä¸å¯ä»¥ï¼ŒPV è¢« PVC ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… PVC åˆ é™¤åæ‰èƒ½åˆ é™¤ PVã€‚<br>\nè‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PV å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PV çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PV çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“Podå¯¹å­˜å‚¨å·çš„ä½¿ç”¨ã€‚<br>\næ­¤æ—¶ä¸€æ—¦ PVC åˆ é™¤ï¼ŒPV å°±ä¼šè¢«åˆ é™¤ã€‚</p>\n</blockquote>\n</li>\n</ul>\n","content_text":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s PV/PVC å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS PV å’Œ PVC ä»‹ç» PV(PersistentVolume) æ˜¯ Kubernetes ä¸­çš„ä¸€ç§å­˜å‚¨èµ„æºï¼Œç”¨äºå°†åº•å±‚çš„ç‰©ç†å­˜å‚¨ï¼ˆå¦‚ NFSã€iSCSIã€Cephã€äº‘å­˜å‚¨ç­‰ï¼‰æŠ½è±¡æˆ Kubernetes èµ„æºï¼Œä¾› Pod ä½¿ç”¨ã€‚å®ƒæ˜¯å¯¹å­˜å‚¨çš„ä¸€ç§â€œå£°æ˜å¼â€ç®¡ç†ï¼Œç±»ä¼¼äº Pod å£°æ˜è®¡ç®—èµ„æºã€‚PV æ˜¯é›†ç¾¤çº§åˆ«çš„å­˜å‚¨èµ„æºï¼Œä¸æ”¯æŒ Namespaceã€‚ PVC(PersistentVolumeClaim)ï¼ŒæŒä¹…å·å£°æ˜ï¼Œ æ˜¯ Kubernetes ä¸­ç”¨äºç”³è¯·å­˜å‚¨èµ„æºçš„å¯¹è±¡ã€‚PVC æ˜¯ Namespace çº§åˆ«çš„èµ„æºã€‚ ç®€è€Œè¨€ä¹‹ï¼š PV æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œç”±ç®¡ç†å‘˜æå‰é…ç½®æˆ–åŠ¨æ€åˆ›å»ºã€‚ PVCï¼ˆPersistentVolumeClaimï¼‰ æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„ç”³è¯·ã€‚ Pod é€šè¿‡ PVC ç»‘å®šåˆ° PVï¼Œä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ã€‚ å¼€å‘è€…ç”¨ PVC æ¥ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œä¸å…³å¿ƒå­˜å‚¨çš„å…·ä½“å®ç°æ–¹å¼ã€‚ PVC é€šè¿‡ Kubernetes è‡ªåŠ¨åŒ¹é…ä¸€ä¸ªåˆé€‚çš„ PersistentVolumeï¼ˆPVï¼‰è¿›è¡Œç»‘å®šã€‚ PV ä¸ PVC çš„åŸºæœ¬æµç¨‹ ç®¡ç†å‘˜åˆ›å»º PVï¼ˆæˆ–è€…é›†ç¾¤é€šè¿‡ StorageClass è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚ ç”¨æˆ·æäº¤ PVCï¼Œå£°æ˜è‡ªå·±éœ€è¦å¤šå°‘å®¹é‡ã€ä»€ä¹ˆè®¿é—®æ¨¡å¼ã€‚ Kubernetes æŸ¥æ‰¾å¯ç”¨çš„ PVï¼Œæ¡ä»¶ç¬¦åˆï¼ˆå®¹é‡ã€è®¿é—®æ¨¡å¼ã€StorageClassï¼‰å°±è‡ªåŠ¨ç»‘å®šã€‚ Pod æŒ‚è½½ PVCï¼Œå®ç°æŒä¹…åŒ–å­˜å‚¨ã€‚ PV ç¤ºä¾‹ ä¸€ä¸ªä½¿ç”¨ NFS å­˜å‚¨å·çš„ PV ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829# pv-nfs.yamlapiVersion: v1kind: PersistentVolumemetadata: name: pv-nfs-1gspec: volumeMode: Filesystem # å­˜å‚¨å·æ¨¡å¼ï¼Œé»˜è®¤ä¸º Filesystem capacity: # å­˜å‚¨èƒ½åŠ› storage: 1Gi # å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi accessModes: # è®¿é—®æ¨¡å¼ - ReadWriteOnce # è®¿é—®æ¨¡å¼ persistentVolumeReclaimPolicy: Retain # å›æ”¶ç­–ç•¥ nfs: # æŒä¹…å·ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰ path: /nfs-server/data/pv-nfs-1g # å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨ server: 10.211.55.88---apiVersion: v1kind: PersistentVolumemetadata: name: pv-nfs-2gspec: capacity: # å­˜å‚¨èƒ½åŠ› storage: 2Gi # å®¹é‡å¤§å°ï¼ŒGi æˆ– Mi accessModes: # è®¿é—®æ¨¡å¼ - ReadWriteMany # è®¿é—®æ¨¡å¼ persistentVolumeReclaimPolicy: Retain # å›æ”¶ç­–ç•¥ nfs: # å­˜å‚¨ç±»å‹ï¼ˆå¦‚ hostPathã€nfsã€ceph ç­‰ï¼‰ path: /nfs-server/data/pv-nfs-2g # å­˜å‚¨è·¯å¾„è¦ç¡®ä¿å·²ç»å­˜åœ¨ server: 10.211.55.88 å­˜å‚¨å·æ¨¡å¼ å®˜ç½‘æ–‡æ¡£:å­˜å‚¨å·æ¨¡å¼ Kubernetes æ”¯æŒä¸¤ç§å·æ¨¡å¼ï¼ˆvolumeModesï¼‰ï¼šFilesystemï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ å’Œ Blockï¼ˆå—ï¼‰ã€‚ å¦‚æœè¯¥å‚æ•°è¢«çœç•¥ï¼Œé»˜è®¤çš„å·æ¨¡å¼æ˜¯ Filesystemã€‚ volumeMode å±æ€§è®¾ç½®ä¸º Filesystem çš„å·ä¼šè¢« Pod æŒ‚è½½ï¼ˆMountï¼‰ åˆ°æŸä¸ªç›®å½•ã€‚ æŒä¹…å·ç±»å‹ å®˜ç½‘æ–‡æ¡£:æŒä¹…å·ç±»å‹ âœ… å½“å‰æ”¯æŒçš„æ’ä»¶ æ’ä»¶ç±»å‹ æè¿° csi å®¹å™¨å­˜å‚¨æ¥å£ï¼ˆCSIï¼‰ï¼Œæ¨èçš„ç°ä»£å­˜å‚¨æ¥å£ fc Fibre Channel å­˜å‚¨ hostPath HostPath å·ï¼ˆä»…ä¾›å•èŠ‚ç‚¹æµ‹è¯•ä½¿ç”¨ï¼›å¤šèŠ‚ç‚¹ä¸æ¨èï¼Œæ¨èä½¿ç”¨ local å·æ›¿ä»£ï¼‰ iscsi iSCSIï¼ˆåŸºäº IP çš„ SCSI å­˜å‚¨ï¼‰ local èŠ‚ç‚¹æœ¬åœ°å­˜å‚¨è®¾å¤‡ nfs ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰å­˜å‚¨ âš ï¸ å·²å¼ƒç”¨ä½†ä»å¯ç”¨ï¼ˆéœ€ CSI è¿ç§»ï¼‰ æ’ä»¶ç±»å‹ æè¿° CSI è¿ç§»çŠ¶æ€ awsElasticBlockStore AWS EBS å—å­˜å‚¨ ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§» azureDisk Azure ç£ç›˜å­˜å‚¨ ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§» azureFile Azure æ–‡ä»¶å­˜å‚¨ ä» v1.24 å¼€å§‹é»˜è®¤è¿ç§» cinder OpenStack å—å­˜å‚¨ ä» v1.21 å¼€å§‹é»˜è®¤è¿ç§» flexVolume FlexVolumeï¼ˆæ— è¿ç§»è®¡åˆ’ï¼Œä½†æœªè®¡åˆ’ç§»é™¤ï¼‰ ä» v1.23 å¼€å§‹å¼ƒç”¨ gcePersistentDisk GCP æŒä¹…ç£ç›˜ ä» v1.23 å¼€å§‹é»˜è®¤è¿ç§» portworxVolume Portworx å­˜å‚¨å· ä» v1.31 å¼€å§‹é»˜è®¤è¿ç§» vsphereVolume vSphere VMDK å· ä» v1.25 å¼€å§‹é»˜è®¤è¿ç§» âŒ å·²åºŸå¼ƒ/å³å°†ç§»é™¤çš„ In-Tree æ’ä»¶ æ’ä»¶ç±»å‹ æè¿° å¼ƒç”¨/ç§»é™¤ç‰ˆæœ¬ cephfs Ceph æ–‡ä»¶ç³»ç»Ÿå· v1.31 ä¹‹åä¸å¯ç”¨ flocker Flocker å­˜å‚¨ v1.25 ä¹‹åä¸å¯ç”¨ glusterfs GlusterFS å­˜å‚¨ v1.26 ä¹‹åä¸å¯ç”¨ photonPersistentDisk Photon æŒä¹…ç£ç›˜ v1.15 ä¹‹åä¸å¯ç”¨ quobyte Quobyte å· v1.25 ä¹‹åä¸å¯ç”¨ rbd Rados å—è®¾å¤‡ï¼ˆCeph RBDï¼‰ v1.31 ä¹‹åä¸å¯ç”¨ scaleIO ScaleIO å· v1.21 ä¹‹åä¸å¯ç”¨ storageos StorageOS å· v1.25 ä¹‹åä¸å¯ç”¨ accessModes è®¿é—®æ¨¡å¼ å®˜ç½‘æ–‡æ¡£:è®¿é—®æ¨¡å¼ è®¿é—®æ¨¡å¼ è¯´æ˜ æ˜¯å¦è·¨èŠ‚ç‚¹æŒ‚è½½ æ˜¯å¦æ”¯æŒå¤š Pod æŒ‚è½½ æ˜¯å¦æ”¯æŒè¯»å†™ ReadWriteOnce (RWO) å·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼ŒåŒä¸€èŠ‚ç‚¹å†…å¤šä¸ª Pod å¯å…±äº«ä½¿ç”¨ã€‚ âŒ å¦ âœ… æ˜¯ï¼ˆåŒä¸€èŠ‚ç‚¹ï¼‰ âœ… æ˜¯ ReadOnlyMany (ROX) å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æŒ‚è½½ã€‚ âœ… æ˜¯ âœ… æ˜¯ âŒ å¦ï¼ˆåªè¯»ï¼‰ ReadWriteMany (RWX) å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ã€‚ âœ… æ˜¯ âœ… æ˜¯ âœ… æ˜¯ ReadWriteOncePod (RWOP) å·åªèƒ½è¢«å•ä¸ª Pod ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼Œç¡®ä¿é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª Pod ä½¿ç”¨è¯¥å·ï¼ˆv1.29+ç¨³å®šï¼‰ã€‚ âŒ å¦ âŒ å¦ï¼ˆåªèƒ½ä¸€ä¸ª Podï¼‰ âœ… æ˜¯ NFS æ”¯æŒå‰ä¸‰ç§è®¿é—®æ¨¡å¼ï¼ŒhostPath åªæ”¯æŒ ReadWriteOnceã€‚ persistentVolumeReclaimPolicy å›æ”¶ç­–ç•¥ å®˜æ–¹æ–‡æ¡£:å›æ”¶ç­–ç•¥ å›æ”¶ç­–ç•¥ å«ä¹‰ å›æ”¶è¡Œä¸º å…¸å‹ä½¿ç”¨åœºæ™¯ Retain ä¿ç•™ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨ä»ç„¶ä¿ç•™ æ‰‹åŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤å PV çŠ¶æ€ä¸º Releasedï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†æˆ–é‡æ–°ç»‘å®š é‡è¦æ•°æ®ï¼Œé¿å…è¯¯åˆ ï¼›å¦‚æ•°æ®åº“æ•°æ®ç›˜ Delete åˆ é™¤ï¼šåˆ é™¤ PVC åï¼ŒPV å’Œåç«¯å­˜å‚¨éƒ½ä¼šè¢«åˆ é™¤ è‡ªåŠ¨å›æ”¶ï¼ŒPVC åˆ é™¤æ—¶è‡ªåŠ¨åˆ é™¤ PV å’Œåç«¯å­˜å‚¨èµ„æºï¼ˆå¦‚äº‘ç›˜ï¼‰ ä¸´æ—¶æ•°æ®ã€ä¸é‡è¦çš„å­˜å‚¨ Recycle å›æ”¶ï¼šç®€å•æ¸…ç©ºæ•°æ® è‡ªåŠ¨æ‰§è¡Œ rm -rf /thevolume/*ï¼Œç„¶å PV å˜å› Available çŠ¶æ€ æ—§ç‰ˆæœ¬é›†ç¾¤çš„å°æ–‡ä»¶ä¸´æ—¶å­˜å‚¨ æ³¨æ„: åˆ›å»º Recycle çš„ PV æ—¶ï¼Œä¼šæç¤ºå¦‚ä¸‹å†…å®¹ 1Warning: spec.persistentVolumeReclaimPolicy: The Recycle reclaim policy is deprecated. Instead, the recommended approach is to use dynamic provisioning. æ„æ€å°±æ˜¯ Recycle ç­–ç•¥å·²è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½¿ç”¨åŠ¨æ€ä¾›åº”æ¨¡å¼ã€‚ä½†å®˜æ–¹æ–‡æ¡£ä¸­å´æç¤º å¯¹äº Kubernetes 1.33 æ¥è¯´ï¼Œåªæœ‰ nfs å’Œ hostPath å·ç±»å‹æ”¯æŒå›æ”¶ï¼ˆRecycleï¼‰ã€‚ æœ¬äººåœ¨ Kubernetes 1.33.2 ä¸­æµ‹è¯•ï¼ŒNFS æ”¯æŒ Recycleï¼Œåˆ é™¤ PVC å PV çŠ¶æ€ä¼šå˜ä¸º Available ç®¡ç† PV 123456789101112# åˆ›å»ºkubectl create -f pv-nfs.yaml# æŸ¥çœ‹$ k get pvNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpv-nfs-1g 1Gi RWO Retain Available &lt;unset&gt; 80spv-nfs-2g 2Gi RWX Retain Available &lt;unset&gt; 80s# åˆ é™¤kubectl delete pv pv-nfs-1gk delete -f pv-nfs.yaml PVC ç¤ºä¾‹ Pod é€šè¿‡ PVC å‘ PV ç”³è¯·å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœ PVC ä¸€ç›´æ— æ³•åŒ¹é…åˆ° PVï¼Œåˆ™ PVC å¤„äº Pending çŠ¶æ€ã€‚ Pod å¿…é¡»ä¸ PVC å¤„äºåŒä¸€å‘½åç©ºé—´ã€‚ PVC ä¸ PV æ˜¯ 1:1 çš„å…³ç³»ã€‚ä¸€æ—¦ PV ç»‘å®šåˆ° PVCï¼Œåˆ™ PVC çŠ¶æ€å˜ä¸º Boundã€‚è¯¥ PV å°†ä¸å†è¢«å…¶ä»– PVC ç»‘å®šã€‚ PVC ä¸ PV åŒ¹é…çš„æ¡ä»¶ åŒ¹é…æ¡ä»¶ è¯´æ˜ å®¹é‡ PVC è¯·æ±‚çš„å®¹é‡ â‰¤ PV æä¾›çš„å®¹é‡ã€‚PV å¿…é¡»è‡³å°‘æ»¡è¶³ PVC çš„å®¹é‡è¯·æ±‚ã€‚ è®¿é—®æ¨¡å¼ PV æ”¯æŒ PVC è¯·æ±‚çš„è®¿é—®æ¨¡å¼ã€‚PVC è¦æ±‚çš„æ‰€æœ‰è®¿é—®æ¨¡å¼ï¼ŒPV éƒ½å¿…é¡»å…·å¤‡ã€‚ä¾‹å¦‚ï¼šPVC è¦æ±‚ ReadWriteOnceï¼ŒPV è‡³å°‘è¦æ”¯æŒ ReadWriteOnceã€‚ StorageClass PVC å’Œ PV çš„ storageClassName å¿…é¡»ä¸€è‡´ã€‚å¦‚æœ PVC æŒ‡å®šäº† storageClassNameï¼Œåªèƒ½ç»‘å®šåŒåçš„ PVã€‚ Selectorï¼ˆå¯é€‰ï¼‰ å¦‚æœ PVC æœ‰è®¾ç½® selectorï¼ˆåŸºäºæ ‡ç­¾ï¼‰ï¼ŒPV çš„æ ‡ç­¾ä¹Ÿå¿…é¡»åŒ¹é…ã€‚ å°è´´å£« PV ä¸­å£°æ˜çš„ accessModes ä»…ä½œä¸ºä¸ PVC çš„è®¿é—®æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå®é™…æŒ‚è½½åˆ° Pod åï¼Œä¸ä¼šé™åˆ¶ Pod çš„è¯»å†™è®¿é—® ä¸€ä¸ªç®€å•çš„ yaml 123456789101112131415# pvc.yamlapiVersion: v1kind: PersistentVolumeClaimmetadata: name: mypvc namespace: defaultspec: accessModes: - ReadWriteMany # ç”³è¯·åŒ¹é…çš„è®¿é—®æ¨¡å¼ resources: requests: storage: 500Mi # ç”³è¯·çš„å®¹é‡ï¼Œå®é™…å®¹é‡ä»¥åŒ¹é…çš„ PV ä¸ºå‡† # selector: # åŒ¹é…çš„ PV æ ‡ç­¾ # matchLabels: # pv: nfs-pv1 # pv çš„æ ‡ç­¾ï¼Œåˆ›å»º pv æ—¶è¦æŒ‡å®š ç®¡ç† PVC 1234567891011121314151617181920212223# åˆ›å»º PVCkubectl apply -f pvc.yaml# æŸ¥çœ‹PVCï¼Œæ­¤æ—¶çœ‹åˆ° pv-nfs-1g ç»‘å®šäº† PVC$ k get pv,pvcNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpersistentvolume/pv-nfs-1g 1Gi RWO Retain Available &lt;unset&gt; 16spersistentvolume/pv-nfs-2g 2Gi RWX Retain Bound default/mypvc &lt;unset&gt; 16sNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGEpersistentvolumeclaim/mypvc Bound pv-nfs-2g 2Gi RWX &lt;unset&gt; 9s# åˆ é™¤ PVCkubectl delete pvc mypvc# æ­¤æ—¶å†æ¬¡æŸ¥çœ‹ PVï¼Œpv-nfs-1g çŠ¶æ€å˜æ›´ä¸º Releasedï¼Œè¡¨ç¤ºå·²ç»é‡Šæ”¾ï¼Œä½†æ˜¯ä¸èƒ½å†è¢«å…¶å®ƒ PVC ç»‘å®šäº†ï¼Œåªèƒ½åˆ é™¤é‡å»ºäº†$ k get pvNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGEpv-nfs-1g 1Gi RWO Retain Available &lt;unset&gt; 18mpv-nfs-2g 2Gi RWX Retain Released default/mypvc &lt;unset&gt; 18m# åˆ é™¤ PVk delete pv pv-nfs-1g Pod ç»‘å®š PVC è¿™é‡Œä»¥ nginx deployment ä¸ºä¾‹ 12345678910111213141516171819202122232425262728# nginx-pvc-deployment.yamlapiVersion: apps/v1kind: Deploymentmetadata: name: nginx-pvc-deployment namespace: defaultspec: replicas: 3 # 3ä¸ª podä¼šå…±äº«ä¸€ä¸ª PVC selector: matchLabels: app: nginx-pvc template: metadata: labels: app: nginx-pvc spec: containers: - name: nginx image: nginx ports: - containerPort: 80 volumeMounts: - name: nginx-storage mountPath: /usr/share/nginx/html # æŒ‚è½½åˆ° nginx çš„é»˜è®¤ç½‘é¡µç›®å½• volumes: - name: nginx-storage persistentVolumeClaim: # æŒ‡å®šå­˜å‚¨å·ç±»å‹æ˜¯ PVC claimName: mypvc # å¯¹åº”ä½ åˆ›å»ºçš„ PVC åç§° ä¸€ä¸ª PVC å¯¹åº”ä¸€ä¸ª PVï¼Œä½†æ˜¯ä¸€ä¸ª PVC å¯ä»¥å¯¹åº”å¤šä¸ª Deployment ç­‰æ§åˆ¶å™¨ã€‚ä¸‹é¢æˆ‘ä»¬å°±å†åˆ›å»ºä¸€ä¸ª Deploymentï¼Œå°† ç›¸åŒçš„ PVC æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œå¹¶ä¸”æ¯éš”5ç§’ä¿®æ”¹ä¸€æ¬¡ PVC æŒ‚è½½çš„ç½‘é¡µï¼Œå¹¶é€šè¿‡ nginx å®¹å™¨æŸ¥çœ‹ç»“æœ 1234567891011121314151617181920212223242526# busybox-deployment.yamlapiVersion: apps/v1kind: Deploymentmetadata: name: busybox-deploymentspec: replicas: 1 selector: matchLabels: app: busybox template: metadata: labels: app: busybox spec: containers: - name: busybox image: busybox command: [&quot;sh&quot;, &quot;-c&quot;, &quot;while true; do echo $(date) &gt; /data/index.html; sleep 5; done&quot;] volumeMounts: - name: shared-volume mountPath: /data volumes: - name: shared-volume persistentVolumeClaim: claimName: mypvc åˆ›å»ºåæŸ¥çœ‹ pod ip 123456$ k get pod -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATESbusybox-deployment-d7589665d-dx2rs 1/1 Running 0 2m59s 10.244.126.6 k8s-worker2 &lt;none&gt; &lt;none&gt;nginx-pvc-deployment-775b8c4f8b-89cw7 1/1 Running 0 44s 10.244.126.8 k8s-worker2 &lt;none&gt; &lt;none&gt;nginx-pvc-deployment-775b8c4f8b-fszlf 1/1 Running 0 44s 10.244.194.123 k8s-worker1 &lt;none&gt; &lt;none&gt;nginx-pvc-deployment-775b8c4f8b-w9qkt 1/1 Running 0 44s 10.244.126.7 k8s-worker2 &lt;none&gt; &lt;none&gt; è®¿é—®ä»»æ„ä¸€ä¸ª nginx pod 12# æ­¤æ—¶ä¼šçœ‹åˆ°é¡µé¢å†…å®¹åœ¨å˜åŒ–watch -n 5 curl 10.244.194.123 åè®° ä¸º pod ç»‘å®š pvcæ—¶ï¼Œæ¯æ¬¡éƒ½è¦å…ˆåˆ›å»º pv å’Œ pvcï¼Œéå¸¸éº»çƒ¦ã€‚æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ ä½¿ç”¨ StorageClass å®ç°è‡ªåŠ¨åˆ›å»º PVï¼Œæˆ‘ä»¬ä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•å®ç°ã€‚ å¦‚æœ PVC è¢« Pod ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PVC å—ï¼Ÿ ä¸å¯ä»¥ï¼ŒPVC è¢« Pod ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… Pod åˆ é™¤åæ‰èƒ½åˆ é™¤ PVCã€‚ è‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PVC å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PVC çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PVC çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“å­˜Podå¯¹å‚¨å·çš„ä½¿ç”¨ã€‚ æ­¤æ—¶ä¸€æ—¦Pod åˆ é™¤ï¼ŒPVC å°±ä¼šè¢«åˆ é™¤ã€‚ å¦‚æœPV è¢« PVC ä½¿ç”¨ï¼Œåˆ™æ­¤æ—¶å¯ä»¥åˆ é™¤ PV å—ï¼Ÿ ä¸å¯ä»¥ï¼ŒPV è¢« PVC ä½¿ç”¨ï¼Œæ­¤æ—¶åªèƒ½ç­‰å¾… PVC åˆ é™¤åæ‰èƒ½åˆ é™¤ PVã€‚ è‹¥æ­¤æ—¶æ‰§è¡Œäº†åˆ é™¤ PV å‘½ä»¤ï¼Œç»ˆç«¯ä¼šä¸€ç›´ç­‰å¾…ï¼Œctrl + c é€€å‡ºåå†æ¬¡æŸ¥çœ‹ PV çŠ¶æ€ï¼Œä¼šçœ‹åˆ° PV çŠ¶æ€ä¸º Terminatingã€‚ä½†æ­¤æ—¶ä¸ä¼šå½±å“Podå¯¹å­˜å‚¨å·çš„ä½¿ç”¨ã€‚ æ­¤æ—¶ä¸€æ—¦ PVC åˆ é™¤ï¼ŒPV å°±ä¼šè¢«åˆ é™¤ã€‚","summary":"æ‘˜è¦ æœ¬æ–‡ä»‹ç» K8S çš„ æŒä¹…å· PV å’Œ PVC ï¼Œæœ¬æ–‡ä»¥ CentOS 8 ä¸ºä¾‹ã€‚ K8Så®˜ç½‘ k8s Github k8s PV/PVC å®˜æ–¹æ–‡æ¡£ æœ¬æ–‡åº•å±‚å­˜å‚¨å·æ˜¯ NFS","date_published":"2025-07-21T15:35:15.000Z","tags":["æŠ€æœ¯","k8s","K8S"]}]}